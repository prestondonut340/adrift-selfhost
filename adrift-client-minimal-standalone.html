<!DOCTYPE html>
<html lang="en">

<head>
  <title></title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Cabin">
  
  <script src="uv/uv.bundle.js"></script>
  <script src="uv.config.js"></script>

  <script type="module" crossorigin>
import "data:application/javascript;base64,dHJ1ZSYmKGZ1bmN0aW9uIHBvbHlmaWxsKCkgewogICAgY29uc3QgcmVsTGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpbmsnKS5yZWxMaXN0OwogICAgaWYgKHJlbExpc3QgJiYgcmVsTGlzdC5zdXBwb3J0cyAmJiByZWxMaXN0LnN1cHBvcnRzKCdtb2R1bGVwcmVsb2FkJykpIHsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGNvbnN0IGxpbmsgb2YgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnbGlua1tyZWw9Im1vZHVsZXByZWxvYWQiXScpKSB7CiAgICAgICAgcHJvY2Vzc1ByZWxvYWQobGluayk7CiAgICB9CiAgICBuZXcgTXV0YXRpb25PYnNlcnZlcigobXV0YXRpb25zKSA9PiB7CiAgICAgICAgZm9yIChjb25zdCBtdXRhdGlvbiBvZiBtdXRhdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG11dGF0aW9uLnR5cGUgIT09ICdjaGlsZExpc3QnKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2YgbXV0YXRpb24uYWRkZWROb2RlcykgewogICAgICAgICAgICAgICAgaWYgKG5vZGUudGFnTmFtZSA9PT0gJ0xJTksnICYmIG5vZGUucmVsID09PSAnbW9kdWxlcHJlbG9hZCcpCiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1ByZWxvYWQobm9kZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KS5vYnNlcnZlKGRvY3VtZW50LCB7IGNoaWxkTGlzdDogdHJ1ZSwgc3VidHJlZTogdHJ1ZSB9KTsKICAgIGZ1bmN0aW9uIGdldEZldGNoT3B0cyhsaW5rKSB7CiAgICAgICAgY29uc3QgZmV0Y2hPcHRzID0ge307CiAgICAgICAgaWYgKGxpbmsuaW50ZWdyaXR5KQogICAgICAgICAgICBmZXRjaE9wdHMuaW50ZWdyaXR5ID0gbGluay5pbnRlZ3JpdHk7CiAgICAgICAgaWYgKGxpbmsucmVmZXJyZXJQb2xpY3kpCiAgICAgICAgICAgIGZldGNoT3B0cy5yZWZlcnJlclBvbGljeSA9IGxpbmsucmVmZXJyZXJQb2xpY3k7CiAgICAgICAgaWYgKGxpbmsuY3Jvc3NPcmlnaW4gPT09ICd1c2UtY3JlZGVudGlhbHMnKQogICAgICAgICAgICBmZXRjaE9wdHMuY3JlZGVudGlhbHMgPSAnaW5jbHVkZSc7CiAgICAgICAgZWxzZSBpZiAobGluay5jcm9zc09yaWdpbiA9PT0gJ2Fub255bW91cycpCiAgICAgICAgICAgIGZldGNoT3B0cy5jcmVkZW50aWFscyA9ICdvbWl0JzsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGZldGNoT3B0cy5jcmVkZW50aWFscyA9ICdzYW1lLW9yaWdpbic7CiAgICAgICAgcmV0dXJuIGZldGNoT3B0czsKICAgIH0KICAgIGZ1bmN0aW9uIHByb2Nlc3NQcmVsb2FkKGxpbmspIHsKICAgICAgICBpZiAobGluay5lcCkKICAgICAgICAgICAgLy8gZXAgbWFya2VyID0gcHJvY2Vzc2VkCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBsaW5rLmVwID0gdHJ1ZTsKICAgICAgICAvLyBwcmVwb3B1bGF0ZSB0aGUgbG9hZCByZWNvcmQKICAgICAgICBjb25zdCBmZXRjaE9wdHMgPSBnZXRGZXRjaE9wdHMobGluayk7CiAgICAgICAgZmV0Y2gobGluay5ocmVmLCBmZXRjaE9wdHMpOwogICAgfQp9KCkpOwoKLy8gVW5pcXVlIElEIGNyZWF0aW9uIHJlcXVpcmVzIGEgaGlnaCBxdWFsaXR5IHJhbmRvbSAjIGdlbmVyYXRvci4gSW4gdGhlIGJyb3dzZXIgd2UgdGhlcmVmb3JlCi8vIHJlcXVpcmUgdGhlIGNyeXB0byBBUEkgYW5kIGRvIG5vdCBzdXBwb3J0IGJ1aWx0LWluIGZhbGxiYWNrIHRvIGxvd2VyIHF1YWxpdHkgcmFuZG9tIG51bWJlcgovLyBnZW5lcmF0b3JzIChsaWtlIE1hdGgucmFuZG9tKCkpLgpsZXQgZ2V0UmFuZG9tVmFsdWVzOwpjb25zdCBybmRzOCA9IG5ldyBVaW50OEFycmF5KDE2KTsKZnVuY3Rpb24gcm5nKCkgewogIC8vIGxhenkgbG9hZCBzbyB0aGF0IGVudmlyb25tZW50cyB0aGF0IG5lZWQgdG8gcG9seWZpbGwgaGF2ZSBhIGNoYW5jZSB0byBkbyBzbwogIGlmICghZ2V0UmFuZG9tVmFsdWVzKSB7CiAgICAvLyBnZXRSYW5kb21WYWx1ZXMgbmVlZHMgdG8gYmUgaW52b2tlZCBpbiBhIGNvbnRleHQgd2hlcmUgInRoaXMiIGlzIGEgQ3J5cHRvIGltcGxlbWVudGF0aW9uLgogICAgZ2V0UmFuZG9tVmFsdWVzID0gdHlwZW9mIGNyeXB0byAhPT0gJ3VuZGVmaW5lZCcgJiYgY3J5cHRvLmdldFJhbmRvbVZhbHVlcyAmJiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzLmJpbmQoY3J5cHRvKTsKCiAgICBpZiAoIWdldFJhbmRvbVZhbHVlcykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NyeXB0by5nZXRSYW5kb21WYWx1ZXMoKSBub3Qgc3VwcG9ydGVkLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3V1aWRqcy91dWlkI2dldHJhbmRvbXZhbHVlcy1ub3Qtc3VwcG9ydGVkJyk7CiAgICB9CiAgfQoKICByZXR1cm4gZ2V0UmFuZG9tVmFsdWVzKHJuZHM4KTsKfQoKLyoqCiAqIENvbnZlcnQgYXJyYXkgb2YgMTYgYnl0ZSB2YWx1ZXMgdG8gVVVJRCBzdHJpbmcgZm9ybWF0IG9mIHRoZSBmb3JtOgogKiBYWFhYWFhYWC1YWFhYLVhYWFgtWFhYWC1YWFhYWFhYWFhYWFgKICovCgpjb25zdCBieXRlVG9IZXggPSBbXTsKCmZvciAobGV0IGkgPSAwOyBpIDwgMjU2OyArK2kpIHsKICBieXRlVG9IZXgucHVzaCgoaSArIDB4MTAwKS50b1N0cmluZygxNikuc2xpY2UoMSkpOwp9CgpmdW5jdGlvbiB1bnNhZmVTdHJpbmdpZnkoYXJyLCBvZmZzZXQgPSAwKSB7CiAgLy8gTm90ZTogQmUgY2FyZWZ1bCBlZGl0aW5nIHRoaXMgY29kZSEgIEl0J3MgYmVlbiB0dW5lZCBmb3IgcGVyZm9ybWFuY2UKICAvLyBhbmQgd29ya3MgaW4gd2F5cyB5b3UgbWF5IG5vdCBleHBlY3QuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vdXVpZGpzL3V1aWQvcHVsbC80MzQKICByZXR1cm4gKGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgMF1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxXV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDJdXSArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgM11dICsgJy0nICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyA0XV0gKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDVdXSArICctJyArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgNl1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyA3XV0gKyAnLScgKyBieXRlVG9IZXhbYXJyW29mZnNldCArIDhdXSArIGJ5dGVUb0hleFthcnJbb2Zmc2V0ICsgOV1dICsgJy0nICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxMF1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxMV1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxMl1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxM11dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxNF1dICsgYnl0ZVRvSGV4W2FycltvZmZzZXQgKyAxNV1dKS50b0xvd2VyQ2FzZSgpOwp9Cgpjb25zdCByYW5kb21VVUlEID0gdHlwZW9mIGNyeXB0byAhPT0gJ3VuZGVmaW5lZCcgJiYgY3J5cHRvLnJhbmRvbVVVSUQgJiYgY3J5cHRvLnJhbmRvbVVVSUQuYmluZChjcnlwdG8pOwpjb25zdCBuYXRpdmUgPSB7CiAgcmFuZG9tVVVJRAp9OwoKZnVuY3Rpb24gdjQob3B0aW9ucywgYnVmLCBvZmZzZXQpIHsKICBpZiAobmF0aXZlLnJhbmRvbVVVSUQgJiYgIWJ1ZiAmJiAhb3B0aW9ucykgewogICAgcmV0dXJuIG5hdGl2ZS5yYW5kb21VVUlEKCk7CiAgfQoKICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICBjb25zdCBybmRzID0gb3B0aW9ucy5yYW5kb20gfHwgKG9wdGlvbnMucm5nIHx8IHJuZykoKTsgLy8gUGVyIDQuNCwgc2V0IGJpdHMgZm9yIHZlcnNpb24gYW5kIGBjbG9ja19zZXFfaGlfYW5kX3Jlc2VydmVkYAoKICBybmRzWzZdID0gcm5kc1s2XSAmIDB4MGYgfCAweDQwOwogIHJuZHNbOF0gPSBybmRzWzhdICYgMHgzZiB8IDB4ODA7IC8vIENvcHkgYnl0ZXMgdG8gYnVmZmVyLCBpZiBwcm92aWRlZAoKICBpZiAoYnVmKSB7CiAgICBvZmZzZXQgPSBvZmZzZXQgfHwgMDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDE2OyArK2kpIHsKICAgICAgYnVmW29mZnNldCArIGldID0gcm5kc1tpXTsKICAgIH0KCiAgICByZXR1cm4gYnVmOwogIH0KCiAgcmV0dXJuIHVuc2FmZVN0cmluZ2lmeShybmRzKTsKfQoKLy8gVGhlIHVzZXIgbGlrZWx5IGhhcyBvdmVyd3JpdHRlbiBhbGwgbmV0d29ya2luZyBmdW5jdGlvbnMgYWZ0ZXIgaW1wb3J0aW5nIGJhcmUtY2xpZW50Ci8vIEl0IGlzIG91ciByZXNwb25zaWJpbGl0eSB0byBtYWtlIHN1cmUgY29tcG9uZW50cyBvZiBCYXJlLUNsaWVudCBhcmUgdXNpbmcgbmF0aXZlIG5ldHdvcmtpbmcgZnVuY3Rpb25zCi8vIFRoZXNlIGV4cG9ydHMgYXJlIHByb3ZpZGVkIHRvIHBsdWdpbnMgYnkgQHJvbGx1cC9wbHVnaW4taW5qZWN0CmNvbnN0IFdlYlNvY2tldCQyID0gZ2xvYmFsVGhpcy5XZWJTb2NrZXQ7CmNvbnN0IFJlcXVlc3QkMSA9IGdsb2JhbFRoaXMuUmVxdWVzdDsKY29uc3QgUmVzcG9uc2UkMiA9IGdsb2JhbFRoaXMuUmVzcG9uc2U7CmNvbnN0IFdlYlNvY2tldEZpZWxkcyA9IHsKICAgIHByb3RvdHlwZTogewogICAgICAgIHNlbmQ6IFdlYlNvY2tldCQyLnByb3RvdHlwZS5zZW5kLAogICAgfSwKICAgIENMT1NFRDogV2ViU29ja2V0JDIuQ0xPU0VELAogICAgQ0xPU0lORzogV2ViU29ja2V0JDIuQ0xPU0lORywKICAgIENPTk5FQ1RJTkc6IFdlYlNvY2tldCQyLkNPTk5FQ1RJTkcsCiAgICBPUEVOOiBXZWJTb2NrZXQkMi5PUEVOLAp9OwoKY29uc3QgbWF4UmVkaXJlY3RzID0gMjA7Cgpjb25zdCBzdGF0dXNFbXB0eSQxID0gWzEwMSwgMjA0LCAyMDUsIDMwNF07CmNvbnN0IHN0YXR1c1JlZGlyZWN0ID0gWzMwMSwgMzAyLCAzMDMsIDMwNywgMzA4XTsKbGV0IENsaWVudCQxID0gY2xhc3MgQ2xpZW50IHsKfTsKCi8qCiAqIFdlYlNvY2tldCBoZWxwZXJzCiAqLwpjb25zdCB2YWxpZENoYXJzID0gIiEjJCUmJyorLS4wMTIzNDU2Nzg5QUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVpeX2BhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5enx+IjsKZnVuY3Rpb24gdmFsaWRQcm90b2NvbChwcm90b2NvbCkgewogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwcm90b2NvbC5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGNoYXIgPSBwcm90b2NvbFtpXTsKICAgICAgICBpZiAoIXZhbGlkQ2hhcnMuaW5jbHVkZXMoY2hhcikpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB0cnVlOwp9CgpsZXQgUmVtb3RlQ2xpZW50JDEgPSBjbGFzcyBSZW1vdGVDbGllbnQgZXh0ZW5kcyBDbGllbnQkMSB7CiAgICBjYWxsYmFja3MgPSB7fTsKICAgIHVpZCA9IHY0KCk7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIGlmICghKCJTZXJ2aWNlV29ya2VyR2xvYmFsU2NvcGUiIGluIHNlbGYpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkF0dGVtcHQgdG8gY29uc3RydWN0IFJlbW90ZUNsaWVudCBmcm9tIG91dHNpZGUgYSBzZXJ2aWNlIHdvcmtlciIpOwogICAgICAgIH0KICAgICAgICBhZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgKGV2ZW50KSA9PiB7CiAgICAgICAgICAgIGlmIChldmVudC5kYXRhLl9fcmVtb3RlX3RhcmdldCA9PT0gdGhpcy51aWQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNhbGxiYWNrID0gdGhpcy5jYWxsYmFja3NbZXZlbnQuZGF0YS5fX3JlbW90ZV9pZF07CiAgICAgICAgICAgICAgICBjYWxsYmFjayhldmVudC5kYXRhLl9fcmVtb3RlX3ZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQogICAgYXN5bmMgc2VuZChtZXNzYWdlLCBpZCkgewogICAgICAgIGNvbnN0IGNsaWVudHMgPSBhd2FpdCBzZWxmLmNsaWVudHMubWF0Y2hBbGwoKTsKICAgICAgICBpZiAoY2xpZW50cy5sZW5ndGggPCAxKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIm5vIGF2YWlsYWJsZSBjbGllbnRzIik7CiAgICAgICAgZm9yIChjb25zdCBjbGllbnQgb2YgY2xpZW50cykgewogICAgICAgICAgICBjbGllbnQucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgX19yZW1vdGVfdGFyZ2V0OiB0aGlzLnVpZCwKICAgICAgICAgICAgICAgIF9fcmVtb3RlX2lkOiBpZCwKICAgICAgICAgICAgICAgIF9fcmVtb3RlX3ZhbHVlOiBtZXNzYWdlCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KICAgIGFzeW5jIHNlbmRXaXRoUmVzcG9uc2UobWVzc2FnZSkgewogICAgICAgIGNvbnN0IGlkID0gdjQoKTsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgdGhpcy5jYWxsYmFja3NbaWRdID0gcmVzb2x2ZTsKICAgICAgICAgICAgdGhpcy5zZW5kKG1lc3NhZ2UsIGlkKTsKICAgICAgICB9KTsKICAgIH0KICAgIGNvbm5lY3QocmVtb3RlLCBwcm90b2NvbHMsIGdldFJlcXVlc3RIZWFkZXJzLCBvbk1ldGEsIG9uUmVhZHlTdGF0ZSkgewogICAgICAgIHJldHVybiBuZXcgV2ViU29ja2V0JDIoIiIpOwogICAgfQogICAgYXN5bmMgcmVxdWVzdChtZXRob2QsIHJlcXVlc3RIZWFkZXJzLCBib2R5LCByZW1vdGUsIGNhY2hlLCBkdXBsZXgsIHNpZ25hbCkgewogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5zZW5kV2l0aFJlc3BvbnNlKHsKICAgICAgICAgICAgdHlwZTogInJlcXVlc3QiLAogICAgICAgICAgICBvcHRpb25zOiB7CiAgICAgICAgICAgICAgICBtZXRob2QsCiAgICAgICAgICAgICAgICByZXF1ZXN0SGVhZGVycywKICAgICAgICAgICAgICAgIGJvZHksCiAgICAgICAgICAgICAgICByZW1vdGU6IHJlbW90ZS50b1N0cmluZygpLAogICAgICAgICAgICB9LAogICAgICAgIH0pOwogICAgICAgIC8vIGNvbnN0IHJlYWRSZXNwb25zZSA9IGF3YWl0IHRoaXMucmVhZEJhcmVSZXNwb25zZShyZXNwb25zZSk7CiAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV3IFJlc3BvbnNlJDIoc3RhdHVzRW1wdHkkMS5pbmNsdWRlcyhyZXNwb25zZS5zdGF0dXMpID8gdW5kZWZpbmVkIDogcmVzcG9uc2UuYm9keSwgewogICAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cywKICAgICAgICAgICAgc3RhdHVzVGV4dDogcmVzcG9uc2Uuc3RhdHVzVGV4dCA/PyB1bmRlZmluZWQsCiAgICAgICAgICAgIGhlYWRlcnM6IG5ldyBIZWFkZXJzKHJlc3BvbnNlLmhlYWRlcnMpLAogICAgICAgIH0pOwogICAgICAgIHJlc3VsdC5yYXdIZWFkZXJzID0gcmVzcG9uc2UuaGVhZGVyczsKICAgICAgICByZXN1bHQucmF3UmVzcG9uc2UgPSByZXNwb25zZTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQp9OwoKLy8gZ2V0IHRoZSB1bmhvb2tlZCB2YWx1ZQpjb25zdCBnZXRSZWFsUmVhZHlTdGF0ZSA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoV2ViU29ja2V0JDIucHJvdG90eXBlLCAncmVhZHlTdGF0ZScpLmdldDsKY29uc3Qgd3NQcm90b2NvbHMgPSBbJ3dzOicsICd3c3M6J107CnNlbGYuQkNDX1ZFUlNJT04gPSAiMS4yLjEiOwpjb25zb2xlLndhcm4oIkJDQ19WRVJTSU9OOiAiICsgc2VsZi5CQ0NfVkVSU0lPTik7CmZ1bmN0aW9uIHNldEJhcmVDbGllbnRJbXBsZW1lbnRhdGlvbiQxKGltcGxlbWVudGF0aW9uKSB7CiAgICBzZWxmLmdCYXJlQ2xpZW50SW1wbGVtZW50YXRpb24gPSBpbXBsZW1lbnRhdGlvbjsKfQppZiAoIlNlcnZpY2VXb3JrZXJHbG9iYWxTY29wZSIgaW4gc2VsZikgewogICAgc2V0QmFyZUNsaWVudEltcGxlbWVudGF0aW9uJDEobmV3IFJlbW90ZUNsaWVudCQxKCkpOwp9CmVsc2UgewogICAgbGV0IHBhcmVudCA9IHNlbGY7CiAgICBjb25zb2xlLmxvZygiYXR0ZW1wdGluZyB0byBmaW5kIGFuIGltcGxlbWVudGF0aW9uIik7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50OwogICAgICAgICAgICBpZiAocGFyZW50ICYmIHBhcmVudFsiZ0JhcmVDbGllbnRJbXBsZW1lbnRhdGlvbiJdKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oImZvdW5kIGltcGxlbWVudGF0aW9uIG9uIHBhcmVudCIpOwogICAgICAgICAgICAgICAgc2V0QmFyZUNsaWVudEltcGxlbWVudGF0aW9uJDEocGFyZW50WyJnQmFyZUNsaWVudEltcGxlbWVudGF0aW9uIl0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coImNvdWxkIG5vdCBmaW5kIGltcGxlbWVudGF0aW9uIik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KfQpjbGFzcyBCYXJlQ2xpZW50IHsKICAgIGNvbnN0cnVjdG9yKC4uLnVudXNlZCkgewogICAgfQogICAgY3JlYXRlV2ViU29ja2V0KHJlbW90ZSwgcHJvdG9jb2xzID0gW10sIG9wdGlvbnMpIHsKICAgICAgICBpZiAoIXNlbGYuZ0JhcmVDbGllbnRJbXBsZW1lbnRhdGlvbikKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQSByZXF1ZXN0IHdhcyBtYWRlIGJlZm9yZSB0aGUgY2xpZW50IHdhcyByZWFkeSEhIFRoaXMgaXMgYSBwcm9ibGVtIG9uIHRoZSBlbmQgb2Ygd2hvZXZlciBzZXQgdGhlIGJhcmUgY2xpZW50IGltcGxlbWVudGF0aW9uIik7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmVtb3RlID0gbmV3IFVSTChyZW1vdGUpOwogICAgICAgIH0KICAgICAgICBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBET01FeGNlcHRpb24oYEZhaWlsZWQgdG8gY29uc3RydWN0ICdXZWJTb2NrZXQnOiBUaGUgVVJMICcke3JlbW90ZX0nIGlzIGludmFsaWQuYCk7CiAgICAgICAgfQogICAgICAgIGlmICghd3NQcm90b2NvbHMuaW5jbHVkZXMocmVtb3RlLnByb3RvY29sKSkKICAgICAgICAgICAgdGhyb3cgbmV3IERPTUV4Y2VwdGlvbihgRmFpbGVkIHRvIGNvbnN0cnVjdCAnV2ViU29ja2V0JzogVGhlIFVSTCdzIHNjaGVtZSBtdXN0IGJlIGVpdGhlciAnd3MnIG9yICd3c3MnLiAnJHtyZW1vdGUucHJvdG9jb2x9JyBpcyBub3QgYWxsb3dlZC5gKTsKICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocHJvdG9jb2xzKSkKICAgICAgICAgICAgcHJvdG9jb2xzID0gW3Byb3RvY29sc107CiAgICAgICAgcHJvdG9jb2xzID0gcHJvdG9jb2xzLm1hcChTdHJpbmcpOwogICAgICAgIGZvciAoY29uc3QgcHJvdG8gb2YgcHJvdG9jb2xzKQogICAgICAgICAgICBpZiAoIXZhbGlkUHJvdG9jb2wocHJvdG8pKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IERPTUV4Y2VwdGlvbihgRmFpbGVkIHRvIGNvbnN0cnVjdCAnV2ViU29ja2V0JzogVGhlIHN1YnByb3RvY29sICcke3Byb3RvfScgaXMgaW52YWxpZC5gKTsKICAgICAgICBjb25zdCBzb2NrZXQgPSBzZWxmLmdCYXJlQ2xpZW50SW1wbGVtZW50YXRpb24uY29ubmVjdChyZW1vdGUsIHByb3RvY29scywgYXN5bmMgKCkgPT4gewogICAgICAgICAgICBjb25zdCByZXNvbHZlZEhlYWRlcnMgPSB0eXBlb2Ygb3B0aW9ucy5oZWFkZXJzID09PSAnZnVuY3Rpb24nCiAgICAgICAgICAgICAgICA/IGF3YWl0IG9wdGlvbnMuaGVhZGVycygpCiAgICAgICAgICAgICAgICA6IG9wdGlvbnMuaGVhZGVycyB8fCB7fTsKICAgICAgICAgICAgY29uc3QgcmVxdWVzdEhlYWRlcnMgPSByZXNvbHZlZEhlYWRlcnMgaW5zdGFuY2VvZiBIZWFkZXJzCiAgICAgICAgICAgICAgICA/IE9iamVjdC5mcm9tRW50cmllcyhyZXNvbHZlZEhlYWRlcnMpCiAgICAgICAgICAgICAgICA6IHJlc29sdmVkSGVhZGVyczsKICAgICAgICAgICAgLy8gdXNlciBpcyBleHBlY3RlZCB0byBzcGVjaWZ5IHVzZXItYWdlbnQgYW5kIG9yaWdpbgogICAgICAgICAgICAvLyBib3RoIGFyZSBpbiBzcGVjCiAgICAgICAgICAgIHJlcXVlc3RIZWFkZXJzWydIb3N0J10gPSByZW1vdGUuaG9zdDsKICAgICAgICAgICAgLy8gcmVxdWVzdEhlYWRlcnNbJ09yaWdpbiddID0gb3JpZ2luOwogICAgICAgICAgICByZXF1ZXN0SGVhZGVyc1snUHJhZ21hJ10gPSAnbm8tY2FjaGUnOwogICAgICAgICAgICByZXF1ZXN0SGVhZGVyc1snQ2FjaGUtQ29udHJvbCddID0gJ25vLWNhY2hlJzsKICAgICAgICAgICAgcmVxdWVzdEhlYWRlcnNbJ1VwZ3JhZGUnXSA9ICd3ZWJzb2NrZXQnOwogICAgICAgICAgICAvLyByZXF1ZXN0SGVhZGVyc1snVXNlci1BZ2VudCddID0gbmF2aWdhdG9yLnVzZXJBZ2VudDsKICAgICAgICAgICAgcmVxdWVzdEhlYWRlcnNbJ0Nvbm5lY3Rpb24nXSA9ICdVcGdyYWRlJzsKICAgICAgICAgICAgcmV0dXJuIHJlcXVlc3RIZWFkZXJzOwogICAgICAgIH0sIChtZXRhKSA9PiB7CiAgICAgICAgICAgIGZha2VQcm90b2NvbCA9IG1ldGEucHJvdG9jb2w7CiAgICAgICAgICAgIGlmIChvcHRpb25zLnNldENvb2tpZXNDYWxsYmFjaykKICAgICAgICAgICAgICAgIG9wdGlvbnMuc2V0Q29va2llc0NhbGxiYWNrKG1ldGEuc2V0Q29va2llcyk7CiAgICAgICAgfSwgKHJlYWR5U3RhdGUpID0+IHsKICAgICAgICAgICAgZmFrZVJlYWR5U3RhdGUgPSByZWFkeVN0YXRlOwogICAgICAgIH0sIG9wdGlvbnMud2ViU29ja2V0SW1wbCB8fCBXZWJTb2NrZXQkMiwgQXJyYXlCdWZmZXIpOwogICAgICAgIC8vIHByb3RvY29sIGlzIGFsd2F5cyBhbiBlbXB0eSBiZWZvcmUgY29ubmVjdGluZwogICAgICAgIC8vIHVwZGF0ZWQgd2hlbiB3ZSByZWNlaXZlIHRoZSBtZXRhZGF0YQogICAgICAgIC8vIHRoaXMgdmFsdWUgZG9lc24ndCBjaGFuZ2Ugd2hlbiBpdCdzIENMT1NJTkcgb3IgQ0xPU0VEIGV0YwogICAgICAgIGxldCBmYWtlUHJvdG9jb2wgPSAnJzsKICAgICAgICBsZXQgZmFrZVJlYWR5U3RhdGUgPSBXZWJTb2NrZXRGaWVsZHMuQ09OTkVDVElORzsKICAgICAgICBjb25zdCBnZXRSZWFkeVN0YXRlID0gKCkgPT4gewogICAgICAgICAgICBjb25zdCByZWFsUmVhZHlTdGF0ZSA9IGdldFJlYWxSZWFkeVN0YXRlLmNhbGwoc29ja2V0KTsKICAgICAgICAgICAgLy8gcmVhZHlTdGF0ZSBzaG91bGQgb25seSBiZSBmYWtlZCB3aGVuIHRoZSByZWFsIHJlYWR5U3RhdGUgaXMgT1BFTgogICAgICAgICAgICByZXR1cm4gcmVhbFJlYWR5U3RhdGUgPT09IFdlYlNvY2tldEZpZWxkcy5PUEVOCiAgICAgICAgICAgICAgICA/IGZha2VSZWFkeVN0YXRlCiAgICAgICAgICAgICAgICA6IHJlYWxSZWFkeVN0YXRlOwogICAgICAgIH07CiAgICAgICAgaWYgKG9wdGlvbnMucmVhZHlTdGF0ZUhvb2spCiAgICAgICAgICAgIG9wdGlvbnMucmVhZHlTdGF0ZUhvb2soc29ja2V0LCBnZXRSZWFkeVN0YXRlKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gd2UgaGF2ZSB0byBob29rIC5yZWFkeVN0YXRlIG91cnNlbHZlcwogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc29ja2V0LCAncmVhZHlTdGF0ZScsIHsKICAgICAgICAgICAgICAgIGdldDogZ2V0UmVhZHlTdGF0ZSwKICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBpZiAob3B0aW9ucy51cmxIb29rKQogICAgICAgICAgICBvcHRpb25zLnVybEhvb2soc29ja2V0LCByZW1vdGUpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHNvY2tldCwgJ3VybCcsIHsKICAgICAgICAgICAgICAgIGdldDogKCkgPT4gcmVtb3RlLnRvU3RyaW5nKCksCiAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgICB9KTsKICAgICAgICBjb25zdCBnZXRQcm90b2NvbCA9ICgpID0+IGZha2VQcm90b2NvbDsKICAgICAgICBpZiAob3B0aW9ucy5wcm90b2NvbEhvb2spCiAgICAgICAgICAgIG9wdGlvbnMucHJvdG9jb2xIb29rKHNvY2tldCwgZ2V0UHJvdG9jb2wpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHNvY2tldCwgJ3Byb3RvY29sJywgewogICAgICAgICAgICAgICAgZ2V0OiBnZXRQcm90b2NvbCwKICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgIH0pOwogICAgICAgIHJldHVybiBzb2NrZXQ7CiAgICB9CiAgICBhc3luYyBmZXRjaCh1cmwsIGluaXQpIHsKICAgICAgICAvLyBPbmx5IGNyZWF0ZSBhbiBpbnN0YW5jZSBvZiBSZXF1ZXN0IHRvIHBhcnNlIGNlcnRhaW4gcGFyYW1ldGVycyBvZiBpbml0IHN1Y2ggYXMgbWV0aG9kLCBoZWFkZXJzLCByZWRpcmVjdAogICAgICAgIC8vIEJ1dCB1c2UgaW5pdCB2YWx1ZXMgd2hlbmV2ZXIgcG9zc2libGUKICAgICAgICBjb25zdCByZXEgPSBuZXcgUmVxdWVzdCQxKHVybCwgaW5pdCk7CiAgICAgICAgLy8gdHJ5IHRvIHVzZSBpbml0LmhlYWRlcnMgYmVjYXVzZSBpdCBtYXkgY29udGFpbiBjYXBpdGFsaXplZCBoZWFkZXJzCiAgICAgICAgLy8gZnVydGhlcm1vcmUsIGltcG9ydGFudCBoZWFkZXJzIG9uIHRoZSBSZXF1ZXN0IGNsYXNzIGFyZSBibG9ja2VkLi4uCiAgICAgICAgLy8gd2Ugc2hvdWxkIHRyeSB0byBwcmVzZXJ2ZSB0aGUgY2FwaXRhbGl6YXRpb24gZHVlIHRvIHF1aXJrcyB3aXRoIGVhcmxpZXIgc2VydmVycwogICAgICAgIGNvbnN0IGlucHV0SGVhZGVycyA9IGluaXQ/LmhlYWRlcnMgfHwgcmVxLmhlYWRlcnM7CiAgICAgICAgY29uc3QgaGVhZGVycyA9IGlucHV0SGVhZGVycyBpbnN0YW5jZW9mIEhlYWRlcnMKICAgICAgICAgICAgPyBPYmplY3QuZnJvbUVudHJpZXMoaW5wdXRIZWFkZXJzKQogICAgICAgICAgICA6IGlucHV0SGVhZGVyczsKICAgICAgICAvLyBAdHMtaWdub3JlCiAgICAgICAgY29uc3QgZHVwbGV4ID0gaW5pdD8uZHVwbGV4OwogICAgICAgIGNvbnN0IGJvZHkgPSBpbml0Py5ib2R5IHx8IHJlcS5ib2R5OwogICAgICAgIGxldCB1cmxPID0gbmV3IFVSTChyZXEudXJsKTsKICAgICAgICBpZiAoIXNlbGYuZ0JhcmVDbGllbnRJbXBsZW1lbnRhdGlvbikKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQSByZXF1ZXN0IHdhcyBtYWRlIGJlZm9yZSB0aGUgY2xpZW50IHdhcyByZWFkeSEhIFRoaXMgaXMgYSBwcm9ibGVtIG9uIHRoZSBlbmQgb2Ygd2hvZXZlciBzZXQgdGhlIGJhcmUgY2xpZW50IGltcGxlbWVudGF0aW9uIik7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7OyBpKyspIHsKICAgICAgICAgICAgaWYgKCdob3N0JyBpbiBoZWFkZXJzKQogICAgICAgICAgICAgICAgaGVhZGVycy5ob3N0ID0gdXJsTy5ob3N0OwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBoZWFkZXJzLkhvc3QgPSB1cmxPLmhvc3Q7CiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgc2VsZi5nQmFyZUNsaWVudEltcGxlbWVudGF0aW9uLnJlcXVlc3QocmVxLm1ldGhvZCwgaGVhZGVycywgYm9keSwgdXJsTywgcmVxLmNhY2hlLCBkdXBsZXgsIHJlcS5zaWduYWwsIEFycmF5QnVmZmVyKTsKICAgICAgICAgICAgcmVzcG9uc2UuZmluYWxVUkwgPSB1cmxPLnRvU3RyaW5nKCk7CiAgICAgICAgICAgIGNvbnN0IHJlZGlyZWN0ID0gaW5pdD8ucmVkaXJlY3QgfHwgcmVxLnJlZGlyZWN0OwogICAgICAgICAgICBpZiAoc3RhdHVzUmVkaXJlY3QuaW5jbHVkZXMocmVzcG9uc2Uuc3RhdHVzKSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChyZWRpcmVjdCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2ZvbGxvdyc6IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9jYXRpb24gPSByZXNwb25zZS5oZWFkZXJzLmdldCgnbG9jYXRpb24nKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1heFJlZGlyZWN0cyA+IGkgJiYgbG9jYXRpb24gIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybE8gPSBuZXcgVVJMKGxvY2F0aW9uLCB1cmxPKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0ZhaWxlZCB0byBmZXRjaCcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXNlICdlcnJvcic6CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0ZhaWxlZCB0byBmZXRjaCcpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ21hbnVhbCc6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKLyoqIEByZXR1cm5zIHt2b2lkfSAqLwpmdW5jdGlvbiBub29wJDQoKSB7fQoKY29uc3QgaWRlbnRpdHkgPSAoeCkgPT4geDsKCi8qKgogKiBAdGVtcGxhdGUgVAogKiBAdGVtcGxhdGUgUwogKiBAcGFyYW0ge1R9IHRhcgogKiBAcGFyYW0ge1N9IHNyYwogKiBAcmV0dXJucyB7VCAmIFN9CiAqLwpmdW5jdGlvbiBhc3NpZ24odGFyLCBzcmMpIHsKCS8vIEB0cy1pZ25vcmUKCWZvciAoY29uc3QgayBpbiBzcmMpIHRhcltrXSA9IHNyY1trXTsKCXJldHVybiAvKiogQHR5cGUge1QgJiBTfSAqLyAodGFyKTsKfQoKZnVuY3Rpb24gcnVuKGZuKSB7CglyZXR1cm4gZm4oKTsKfQoKZnVuY3Rpb24gYmxhbmtfb2JqZWN0KCkgewoJcmV0dXJuIE9iamVjdC5jcmVhdGUobnVsbCk7Cn0KCi8qKgogKiBAcGFyYW0ge0Z1bmN0aW9uW119IGZucwogKiBAcmV0dXJucyB7dm9pZH0KICovCmZ1bmN0aW9uIHJ1bl9hbGwoZm5zKSB7CglmbnMuZm9yRWFjaChydW4pOwp9CgovKioKICogQHBhcmFtIHthbnl9IHRoaW5nCiAqIEByZXR1cm5zIHt0aGluZyBpcyBGdW5jdGlvbn0KICovCmZ1bmN0aW9uIGlzX2Z1bmN0aW9uKHRoaW5nKSB7CglyZXR1cm4gdHlwZW9mIHRoaW5nID09PSAnZnVuY3Rpb24nOwp9CgovKiogQHJldHVybnMge2Jvb2xlYW59ICovCmZ1bmN0aW9uIHNhZmVfbm90X2VxdWFsKGEsIGIpIHsKCXJldHVybiBhICE9IGEgPyBiID09IGIgOiBhICE9PSBiIHx8IChhICYmIHR5cGVvZiBhID09PSAnb2JqZWN0JykgfHwgdHlwZW9mIGEgPT09ICdmdW5jdGlvbic7Cn0KCi8qKiBAcmV0dXJucyB7Ym9vbGVhbn0gKi8KZnVuY3Rpb24gaXNfZW1wdHkob2JqKSB7CglyZXR1cm4gT2JqZWN0LmtleXMob2JqKS5sZW5ndGggPT09IDA7Cn0KCmZ1bmN0aW9uIGNyZWF0ZV9zbG90KGRlZmluaXRpb24sIGN0eCwgJCRzY29wZSwgZm4pIHsKCWlmIChkZWZpbml0aW9uKSB7CgkJY29uc3Qgc2xvdF9jdHggPSBnZXRfc2xvdF9jb250ZXh0KGRlZmluaXRpb24sIGN0eCwgJCRzY29wZSwgZm4pOwoJCXJldHVybiBkZWZpbml0aW9uWzBdKHNsb3RfY3R4KTsKCX0KfQoKZnVuY3Rpb24gZ2V0X3Nsb3RfY29udGV4dChkZWZpbml0aW9uLCBjdHgsICQkc2NvcGUsIGZuKSB7CglyZXR1cm4gZGVmaW5pdGlvblsxXSAmJiBmbiA/IGFzc2lnbigkJHNjb3BlLmN0eC5zbGljZSgpLCBkZWZpbml0aW9uWzFdKGZuKGN0eCkpKSA6ICQkc2NvcGUuY3R4Owp9CgpmdW5jdGlvbiBnZXRfc2xvdF9jaGFuZ2VzKGRlZmluaXRpb24sICQkc2NvcGUsIGRpcnR5LCBmbikgewoJaWYgKGRlZmluaXRpb25bMl0gJiYgZm4pIHsKCQljb25zdCBsZXRzID0gZGVmaW5pdGlvblsyXShmbihkaXJ0eSkpOwoJCWlmICgkJHNjb3BlLmRpcnR5ID09PSB1bmRlZmluZWQpIHsKCQkJcmV0dXJuIGxldHM7CgkJfQoJCWlmICh0eXBlb2YgbGV0cyA9PT0gJ29iamVjdCcpIHsKCQkJY29uc3QgbWVyZ2VkID0gW107CgkJCWNvbnN0IGxlbiA9IE1hdGgubWF4KCQkc2NvcGUuZGlydHkubGVuZ3RoLCBsZXRzLmxlbmd0aCk7CgkJCWZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpICs9IDEpIHsKCQkJCW1lcmdlZFtpXSA9ICQkc2NvcGUuZGlydHlbaV0gfCBsZXRzW2ldOwoJCQl9CgkJCXJldHVybiBtZXJnZWQ7CgkJfQoJCXJldHVybiAkJHNjb3BlLmRpcnR5IHwgbGV0czsKCX0KCXJldHVybiAkJHNjb3BlLmRpcnR5Owp9CgovKiogQHJldHVybnMge3ZvaWR9ICovCmZ1bmN0aW9uIHVwZGF0ZV9zbG90X2Jhc2UoCglzbG90LAoJc2xvdF9kZWZpbml0aW9uLAoJY3R4LAoJJCRzY29wZSwKCXNsb3RfY2hhbmdlcywKCWdldF9zbG90X2NvbnRleHRfZm4KKSB7CglpZiAoc2xvdF9jaGFuZ2VzKSB7CgkJY29uc3Qgc2xvdF9jb250ZXh0ID0gZ2V0X3Nsb3RfY29udGV4dChzbG90X2RlZmluaXRpb24sIGN0eCwgJCRzY29wZSwgZ2V0X3Nsb3RfY29udGV4dF9mbik7CgkJc2xvdC5wKHNsb3RfY29udGV4dCwgc2xvdF9jaGFuZ2VzKTsKCX0KfQoKLyoqIEByZXR1cm5zIHthbnlbXSB8IC0xfSAqLwpmdW5jdGlvbiBnZXRfYWxsX2RpcnR5X2Zyb21fc2NvcGUoJCRzY29wZSkgewoJaWYgKCQkc2NvcGUuY3R4Lmxlbmd0aCA+IDMyKSB7CgkJY29uc3QgZGlydHkgPSBbXTsKCQljb25zdCBsZW5ndGggPSAkJHNjb3BlLmN0eC5sZW5ndGggLyAzMjsKCQlmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CgkJCWRpcnR5W2ldID0gLTE7CgkJfQoJCXJldHVybiBkaXJ0eTsKCX0KCXJldHVybiAtMTsKfQoKLyoqIEByZXR1cm5zIHt7fX0gKi8KZnVuY3Rpb24gZXhjbHVkZV9pbnRlcm5hbF9wcm9wcyhwcm9wcykgewoJY29uc3QgcmVzdWx0ID0ge307Cglmb3IgKGNvbnN0IGsgaW4gcHJvcHMpIGlmIChrWzBdICE9PSAnJCcpIHJlc3VsdFtrXSA9IHByb3BzW2tdOwoJcmV0dXJuIHJlc3VsdDsKfQoKY29uc3QgaXNfY2xpZW50ID0gdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCc7CgovKiogQHR5cGUgeygpID0+IG51bWJlcn0gKi8KbGV0IG5vdyA9IGlzX2NsaWVudCA/ICgpID0+IHdpbmRvdy5wZXJmb3JtYW5jZS5ub3coKSA6ICgpID0+IERhdGUubm93KCk7CgpsZXQgcmFmID0gaXNfY2xpZW50ID8gKGNiKSA9PiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoY2IpIDogbm9vcCQ0OwoKY29uc3QgdGFza3MgPSBuZXcgU2V0KCk7CgovKioKICogQHBhcmFtIHtudW1iZXJ9IG5vdwogKiBAcmV0dXJucyB7dm9pZH0KICovCmZ1bmN0aW9uIHJ1bl90YXNrcyhub3cpIHsKCXRhc2tzLmZvckVhY2goKHRhc2spID0+IHsKCQlpZiAoIXRhc2suYyhub3cpKSB7CgkJCXRhc2tzLmRlbGV0ZSh0YXNrKTsKCQkJdGFzay5mKCk7CgkJfQoJfSk7CglpZiAodGFza3Muc2l6ZSAhPT0gMCkgcmFmKHJ1bl90YXNrcyk7Cn0KCi8qKgogKiBDcmVhdGVzIGEgbmV3IHRhc2sgdGhhdCBydW5zIG9uIGVhY2ggcmFmIGZyYW1lCiAqIHVudGlsIGl0IHJldHVybnMgYSBmYWxzeSB2YWx1ZSBvciBpcyBhYm9ydGVkCiAqIEBwYXJhbSB7aW1wb3J0KCcuL3ByaXZhdGUuanMnKS5UYXNrQ2FsbGJhY2t9IGNhbGxiYWNrCiAqIEByZXR1cm5zIHtpbXBvcnQoJy4vcHJpdmF0ZS5qcycpLlRhc2t9CiAqLwpmdW5jdGlvbiBsb29wKGNhbGxiYWNrKSB7CgkvKiogQHR5cGUge2ltcG9ydCgnLi9wcml2YXRlLmpzJykuVGFza0VudHJ5fSAqLwoJbGV0IHRhc2s7CglpZiAodGFza3Muc2l6ZSA9PT0gMCkgcmFmKHJ1bl90YXNrcyk7CglyZXR1cm4gewoJCXByb21pc2U6IG5ldyBQcm9taXNlKChmdWxmaWxsKSA9PiB7CgkJCXRhc2tzLmFkZCgodGFzayA9IHsgYzogY2FsbGJhY2ssIGY6IGZ1bGZpbGwgfSkpOwoJCX0pLAoJCWFib3J0KCkgewoJCQl0YXNrcy5kZWxldGUodGFzayk7CgkJfQoJfTsKfQoKLyoqCiAqIEBwYXJhbSB7Tm9kZX0gdGFyZ2V0CiAqIEBwYXJhbSB7Tm9kZX0gbm9kZQogKiBAcmV0dXJucyB7dm9pZH0KICovCmZ1bmN0aW9uIGFwcGVuZCh0YXJnZXQsIG5vZGUpIHsKCXRhcmdldC5hcHBlbmRDaGlsZChub2RlKTsKfQoKLyoqCiAqIEBwYXJhbSB7Tm9kZX0gbm9kZQogKiBAcmV0dXJucyB7U2hhZG93Um9vdCB8IERvY3VtZW50fQogKi8KZnVuY3Rpb24gZ2V0X3Jvb3RfZm9yX3N0eWxlKG5vZGUpIHsKCWlmICghbm9kZSkgcmV0dXJuIGRvY3VtZW50OwoJY29uc3Qgcm9vdCA9IG5vZGUuZ2V0Um9vdE5vZGUgPyBub2RlLmdldFJvb3ROb2RlKCkgOiBub2RlLm93bmVyRG9jdW1lbnQ7CglpZiAocm9vdCAmJiAvKiogQHR5cGUge1NoYWRvd1Jvb3R9ICovIChyb290KS5ob3N0KSB7CgkJcmV0dXJuIC8qKiBAdHlwZSB7U2hhZG93Um9vdH0gKi8gKHJvb3QpOwoJfQoJcmV0dXJuIG5vZGUub3duZXJEb2N1bWVudDsKfQoKLyoqCiAqIEBwYXJhbSB7Tm9kZX0gbm9kZQogKiBAcmV0dXJucyB7Q1NTU3R5bGVTaGVldH0KICovCmZ1bmN0aW9uIGFwcGVuZF9lbXB0eV9zdHlsZXNoZWV0KG5vZGUpIHsKCWNvbnN0IHN0eWxlX2VsZW1lbnQgPSBlbGVtZW50KCdzdHlsZScpOwoJLy8gRm9yIHRyYW5zaXRpb25zIHRvIHdvcmsgd2l0aG91dCAnc3R5bGUtc3JjOiB1bnNhZmUtaW5saW5lJyBDb250ZW50IFNlY3VyaXR5IFBvbGljeSwKCS8vIHRoZXNlIGVtcHR5IHRhZ3MgbmVlZCB0byBiZSBhbGxvd2VkIHdpdGggYSBoYXNoIGFzIGEgd29ya2Fyb3VuZCB1bnRpbCB3ZSBtb3ZlIHRvIHRoZSBXZWIgQW5pbWF0aW9ucyBBUEkuCgkvLyBVc2luZyB0aGUgaGFzaCBmb3IgdGhlIGVtcHR5IHN0cmluZyAoZm9yIGFuIGVtcHR5IHRhZykgd29ya3MgaW4gYWxsIGJyb3dzZXJzIGV4Y2VwdCBTYWZhcmkuCgkvLyBTbyBhcyBhIHdvcmthcm91bmQgZm9yIHRoZSB3b3JrYXJvdW5kLCB3aGVuIHdlIGFwcGVuZCBlbXB0eSBzdHlsZSB0YWdzIHdlIHNldCB0aGVpciBjb250ZW50IHRvIC8qIGVtcHR5ICovLgoJLy8gVGhlIGhhc2ggJ3NoYTI1Ni05T2xOTzBETkVlYVZ6SEw0Ulp3Q0xzQkhBOFdCUTh0b0JwLzRGNVhWMm5jPScgd2lsbCB0aGVuIHdvcmsgZXZlbiBpbiBTYWZhcmkuCglzdHlsZV9lbGVtZW50LnRleHRDb250ZW50ID0gJy8qIGVtcHR5ICovJzsKCWFwcGVuZF9zdHlsZXNoZWV0KGdldF9yb290X2Zvcl9zdHlsZShub2RlKSwgc3R5bGVfZWxlbWVudCk7CglyZXR1cm4gc3R5bGVfZWxlbWVudC5zaGVldDsKfQoKLyoqCiAqIEBwYXJhbSB7U2hhZG93Um9vdCB8IERvY3VtZW50fSBub2RlCiAqIEBwYXJhbSB7SFRNTFN0eWxlRWxlbWVudH0gc3R5bGUKICogQHJldHVybnMge0NTU1N0eWxlU2hlZXR9CiAqLwpmdW5jdGlvbiBhcHBlbmRfc3R5bGVzaGVldChub2RlLCBzdHlsZSkgewoJYXBwZW5kKC8qKiBAdHlwZSB7RG9jdW1lbnR9ICovIChub2RlKS5oZWFkIHx8IG5vZGUsIHN0eWxlKTsKCXJldHVybiBzdHlsZS5zaGVldDsKfQoKLyoqCiAqIEBwYXJhbSB7Tm9kZX0gdGFyZ2V0CiAqIEBwYXJhbSB7Tm9kZX0gbm9kZQogKiBAcGFyYW0ge05vZGV9IFthbmNob3JdCiAqIEByZXR1cm5zIHt2b2lkfQogKi8KZnVuY3Rpb24gaW5zZXJ0KHRhcmdldCwgbm9kZSwgYW5jaG9yKSB7Cgl0YXJnZXQuaW5zZXJ0QmVmb3JlKG5vZGUsIGFuY2hvciB8fCBudWxsKTsKfQoKLyoqCiAqIEBwYXJhbSB7Tm9kZX0gbm9kZQogKiBAcmV0dXJucyB7dm9pZH0KICovCmZ1bmN0aW9uIGRldGFjaChub2RlKSB7CglpZiAobm9kZS5wYXJlbnROb2RlKSB7CgkJbm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5vZGUpOwoJfQp9CgovKioKICogQHJldHVybnMge3ZvaWR9ICovCmZ1bmN0aW9uIGRlc3Ryb3lfZWFjaChpdGVyYXRpb25zLCBkZXRhY2hpbmcpIHsKCWZvciAobGV0IGkgPSAwOyBpIDwgaXRlcmF0aW9ucy5sZW5ndGg7IGkgKz0gMSkgewoJCWlmIChpdGVyYXRpb25zW2ldKSBpdGVyYXRpb25zW2ldLmQoZGV0YWNoaW5nKTsKCX0KfQoKLyoqCiAqIEB0ZW1wbGF0ZSB7a2V5b2YgSFRNTEVsZW1lbnRUYWdOYW1lTWFwfSBLCiAqIEBwYXJhbSB7S30gbmFtZQogKiBAcmV0dXJucyB7SFRNTEVsZW1lbnRUYWdOYW1lTWFwW0tdfQogKi8KZnVuY3Rpb24gZWxlbWVudChuYW1lKSB7CglyZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChuYW1lKTsKfQoKLyoqCiAqIEB0ZW1wbGF0ZSB7a2V5b2YgU1ZHRWxlbWVudFRhZ05hbWVNYXB9IEsKICogQHBhcmFtIHtLfSBuYW1lCiAqIEByZXR1cm5zIHtTVkdFbGVtZW50fQogKi8KZnVuY3Rpb24gc3ZnX2VsZW1lbnQobmFtZSkgewoJcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCBuYW1lKTsKfQoKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSBkYXRhCiAqIEByZXR1cm5zIHtUZXh0fQogKi8KZnVuY3Rpb24gdGV4dChkYXRhKSB7CglyZXR1cm4gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoZGF0YSk7Cn0KCi8qKgogKiBAcmV0dXJucyB7VGV4dH0gKi8KZnVuY3Rpb24gc3BhY2UoKSB7CglyZXR1cm4gdGV4dCgnICcpOwp9CgovKioKICogQHJldHVybnMge1RleHR9ICovCmZ1bmN0aW9uIGVtcHR5KCkgewoJcmV0dXJuIHRleHQoJycpOwp9CgovKioKICogQHBhcmFtIHtFdmVudFRhcmdldH0gbm9kZQogKiBAcGFyYW0ge3N0cmluZ30gZXZlbnQKICogQHBhcmFtIHtFdmVudExpc3RlbmVyT3JFdmVudExpc3RlbmVyT2JqZWN0fSBoYW5kbGVyCiAqIEBwYXJhbSB7Ym9vbGVhbiB8IEFkZEV2ZW50TGlzdGVuZXJPcHRpb25zIHwgRXZlbnRMaXN0ZW5lck9wdGlvbnN9IFtvcHRpb25zXQogKiBAcmV0dXJucyB7KCkgPT4gdm9pZH0KICovCmZ1bmN0aW9uIGxpc3Rlbihub2RlLCBldmVudCwgaGFuZGxlciwgb3B0aW9ucykgewoJbm9kZS5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBoYW5kbGVyLCBvcHRpb25zKTsKCXJldHVybiAoKSA9PiBub2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQsIGhhbmRsZXIsIG9wdGlvbnMpOwp9CgovKioKICogQHJldHVybnMgeyhldmVudDogYW55KSA9PiBhbnl9ICovCmZ1bmN0aW9uIHN0b3BfcHJvcGFnYXRpb24oZm4pIHsKCXJldHVybiBmdW5jdGlvbiAoZXZlbnQpIHsKCQlldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKCQkvLyBAdHMtaWdub3JlCgkJcmV0dXJuIGZuLmNhbGwodGhpcywgZXZlbnQpOwoJfTsKfQoKLyoqCiAqIEByZXR1cm5zIHsoZXZlbnQ6IGFueSkgPT4gdm9pZH0gKi8KZnVuY3Rpb24gc2VsZiQxKGZuKSB7CglyZXR1cm4gZnVuY3Rpb24gKGV2ZW50KSB7CgkJLy8gQHRzLWlnbm9yZQoJCWlmIChldmVudC50YXJnZXQgPT09IHRoaXMpIGZuLmNhbGwodGhpcywgZXZlbnQpOwoJfTsKfQoKLyoqCiAqIEBwYXJhbSB7RWxlbWVudH0gbm9kZQogKiBAcGFyYW0ge3N0cmluZ30gYXR0cmlidXRlCiAqIEBwYXJhbSB7c3RyaW5nfSBbdmFsdWVdCiAqIEByZXR1cm5zIHt2b2lkfQogKi8KZnVuY3Rpb24gYXR0cihub2RlLCBhdHRyaWJ1dGUsIHZhbHVlKSB7CglpZiAodmFsdWUgPT0gbnVsbCkgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoYXR0cmlidXRlKTsKCWVsc2UgaWYgKG5vZGUuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZSkgIT09IHZhbHVlKSBub2RlLnNldEF0dHJpYnV0ZShhdHRyaWJ1dGUsIHZhbHVlKTsKfQovKioKICogTGlzdCBvZiBhdHRyaWJ1dGVzIHRoYXQgc2hvdWxkIGFsd2F5cyBiZSBzZXQgdGhyb3VnaCB0aGUgYXR0ciBtZXRob2QsCiAqIGJlY2F1c2UgdXBkYXRpbmcgdGhlbSB0aHJvdWdoIHRoZSBwcm9wZXJ0eSBzZXR0ZXIgZG9lc24ndCB3b3JrIHJlbGlhYmx5LgogKiBJbiB0aGUgZXhhbXBsZSBvZiBgd2lkdGhgL2BoZWlnaHRgLCB0aGUgcHJvYmxlbSBpcyB0aGF0IHRoZSBzZXR0ZXIgb25seQogKiBhY2NlcHRzIG51bWVyaWMgdmFsdWVzLCBidXQgdGhlIGF0dHJpYnV0ZSBjYW4gYWxzbyBiZSBzZXQgdG8gYSBzdHJpbmcgbGlrZSBgNTAlYC4KICogSWYgdGhpcyBsaXN0IGJlY29tZXMgdG9vIGJpZywgcmV0aGluayB0aGlzIGFwcHJvYWNoLgogKi8KY29uc3QgYWx3YXlzX3NldF90aHJvdWdoX3NldF9hdHRyaWJ1dGUgPSBbJ3dpZHRoJywgJ2hlaWdodCddOwoKLyoqCiAqIEBwYXJhbSB7RWxlbWVudCAmIEVsZW1lbnRDU1NJbmxpbmVTdHlsZX0gbm9kZQogKiBAcGFyYW0ge3sgW3g6IHN0cmluZ106IHN0cmluZyB9fSBhdHRyaWJ1dGVzCiAqIEByZXR1cm5zIHt2b2lkfQogKi8KZnVuY3Rpb24gc2V0X2F0dHJpYnV0ZXMobm9kZSwgYXR0cmlidXRlcykgewoJLy8gQHRzLWlnbm9yZQoJY29uc3QgZGVzY3JpcHRvcnMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhub2RlLl9fcHJvdG9fXyk7Cglmb3IgKGNvbnN0IGtleSBpbiBhdHRyaWJ1dGVzKSB7CgkJaWYgKGF0dHJpYnV0ZXNba2V5XSA9PSBudWxsKSB7CgkJCW5vZGUucmVtb3ZlQXR0cmlidXRlKGtleSk7CgkJfSBlbHNlIGlmIChrZXkgPT09ICdzdHlsZScpIHsKCQkJbm9kZS5zdHlsZS5jc3NUZXh0ID0gYXR0cmlidXRlc1trZXldOwoJCX0gZWxzZSBpZiAoa2V5ID09PSAnX192YWx1ZScpIHsKCQkJLyoqIEB0eXBlIHthbnl9ICovIChub2RlKS52YWx1ZSA9IG5vZGVba2V5XSA9IGF0dHJpYnV0ZXNba2V5XTsKCQl9IGVsc2UgaWYgKAoJCQlkZXNjcmlwdG9yc1trZXldICYmCgkJCWRlc2NyaXB0b3JzW2tleV0uc2V0ICYmCgkJCWFsd2F5c19zZXRfdGhyb3VnaF9zZXRfYXR0cmlidXRlLmluZGV4T2Yoa2V5KSA9PT0gLTEKCQkpIHsKCQkJbm9kZVtrZXldID0gYXR0cmlidXRlc1trZXldOwoJCX0gZWxzZSB7CgkJCWF0dHIobm9kZSwga2V5LCBhdHRyaWJ1dGVzW2tleV0pOwoJCX0KCX0KfQoKLyoqCiAqIEBwYXJhbSB7RWxlbWVudCAmIEVsZW1lbnRDU1NJbmxpbmVTdHlsZX0gbm9kZQogKiBAcGFyYW0ge3sgW3g6IHN0cmluZ106IHN0cmluZyB9fSBhdHRyaWJ1dGVzCiAqIEByZXR1cm5zIHt2b2lkfQogKi8KZnVuY3Rpb24gc2V0X3N2Z19hdHRyaWJ1dGVzKG5vZGUsIGF0dHJpYnV0ZXMpIHsKCWZvciAoY29uc3Qga2V5IGluIGF0dHJpYnV0ZXMpIHsKCQlhdHRyKG5vZGUsIGtleSwgYXR0cmlidXRlc1trZXldKTsKCX0KfQoKLyoqCiAqIEBwYXJhbSB7SFRNTElucHV0RWxlbWVudFtdfSBncm91cAogKiBAcmV0dXJucyB7eyBwKC4uLmlucHV0czogSFRNTElucHV0RWxlbWVudFtdKTogdm9pZDsgcigpOiB2b2lkOyB9fQogKi8KZnVuY3Rpb24gaW5pdF9iaW5kaW5nX2dyb3VwKGdyb3VwKSB7CgkvKioKCSAqIEB0eXBlIHtIVE1MSW5wdXRFbGVtZW50W119ICovCglsZXQgX2lucHV0czsKCXJldHVybiB7CgkJLyogcHVzaCAqLyBwKC4uLmlucHV0cykgewoJCQlfaW5wdXRzID0gaW5wdXRzOwoJCQlfaW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiBncm91cC5wdXNoKGlucHV0KSk7CgkJfSwKCQkvKiByZW1vdmUgKi8gcigpIHsKCQkJX2lucHV0cy5mb3JFYWNoKChpbnB1dCkgPT4gZ3JvdXAuc3BsaWNlKGdyb3VwLmluZGV4T2YoaW5wdXQpLCAxKSk7CgkJfQoJfTsKfQoKLyoqCiAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbWVudAogKiBAcmV0dXJucyB7Q2hpbGROb2RlW119CiAqLwpmdW5jdGlvbiBjaGlsZHJlbihlbGVtZW50KSB7CglyZXR1cm4gQXJyYXkuZnJvbShlbGVtZW50LmNoaWxkTm9kZXMpOwp9CgovKioKICogQHBhcmFtIHtUZXh0fSB0ZXh0CiAqIEBwYXJhbSB7dW5rbm93bn0gZGF0YQogKiBAcmV0dXJucyB7dm9pZH0KICovCmZ1bmN0aW9uIHNldF9kYXRhKHRleHQsIGRhdGEpIHsKCWRhdGEgPSAnJyArIGRhdGE7CglpZiAodGV4dC5kYXRhID09PSBkYXRhKSByZXR1cm47Cgl0ZXh0LmRhdGEgPSAvKiogQHR5cGUge3N0cmluZ30gKi8gKGRhdGEpOwp9CgovKioKICogQHJldHVybnMge3ZvaWR9ICovCmZ1bmN0aW9uIHNldF9pbnB1dF92YWx1ZShpbnB1dCwgdmFsdWUpIHsKCWlucHV0LnZhbHVlID0gdmFsdWUgPT0gbnVsbCA/ICcnIDogdmFsdWU7Cn0KCi8qKgogKiBAcmV0dXJucyB7dm9pZH0gKi8KZnVuY3Rpb24gdG9nZ2xlX2NsYXNzKGVsZW1lbnQsIG5hbWUsIHRvZ2dsZSkgewoJLy8gVGhlIGAhIWAgaXMgcmVxdWlyZWQgYmVjYXVzZSBhbiBgdW5kZWZpbmVkYCBmbGFnIG1lYW5zIGZsaXBwaW5nIHRoZSBjdXJyZW50IHN0YXRlLgoJZWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlKG5hbWUsICEhdG9nZ2xlKTsKfQoKLyoqCiAqIEB0ZW1wbGF0ZSBUCiAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlCiAqIEBwYXJhbSB7VH0gW2RldGFpbF0KICogQHBhcmFtIHt7IGJ1YmJsZXM/OiBib29sZWFuLCBjYW5jZWxhYmxlPzogYm9vbGVhbiB9fSBbb3B0aW9uc10KICogQHJldHVybnMge0N1c3RvbUV2ZW50PFQ+fQogKi8KZnVuY3Rpb24gY3VzdG9tX2V2ZW50KHR5cGUsIGRldGFpbCwgeyBidWJibGVzID0gZmFsc2UsIGNhbmNlbGFibGUgPSBmYWxzZSB9ID0ge30pIHsKCXJldHVybiBuZXcgQ3VzdG9tRXZlbnQodHlwZSwgeyBkZXRhaWwsIGJ1YmJsZXMsIGNhbmNlbGFibGUgfSk7Cn0KLyoqICovCmNsYXNzIEh0bWxUYWcgewoJLyoqCgkgKiBAcHJpdmF0ZQoJICogQGRlZmF1bHQgZmFsc2UKCSAqLwoJaXNfc3ZnID0gZmFsc2U7CgkvKiogcGFyZW50IGZvciBjcmVhdGluZyBub2RlICovCgllID0gdW5kZWZpbmVkOwoJLyoqIGh0bWwgdGFnIG5vZGVzICovCgluID0gdW5kZWZpbmVkOwoJLyoqIHRhcmdldCAqLwoJdCA9IHVuZGVmaW5lZDsKCS8qKiBhbmNob3IgKi8KCWEgPSB1bmRlZmluZWQ7Cgljb25zdHJ1Y3Rvcihpc19zdmcgPSBmYWxzZSkgewoJCXRoaXMuaXNfc3ZnID0gaXNfc3ZnOwoJCXRoaXMuZSA9IHRoaXMubiA9IG51bGw7Cgl9CgoJLyoqCgkgKiBAcGFyYW0ge3N0cmluZ30gaHRtbAoJICogQHJldHVybnMge3ZvaWR9CgkgKi8KCWMoaHRtbCkgewoJCXRoaXMuaChodG1sKTsKCX0KCgkvKioKCSAqIEBwYXJhbSB7c3RyaW5nfSBodG1sCgkgKiBAcGFyYW0ge0hUTUxFbGVtZW50IHwgU1ZHRWxlbWVudH0gdGFyZ2V0CgkgKiBAcGFyYW0ge0hUTUxFbGVtZW50IHwgU1ZHRWxlbWVudH0gYW5jaG9yCgkgKiBAcmV0dXJucyB7dm9pZH0KCSAqLwoJbShodG1sLCB0YXJnZXQsIGFuY2hvciA9IG51bGwpIHsKCQlpZiAoIXRoaXMuZSkgewoJCQlpZiAodGhpcy5pc19zdmcpCgkJCQl0aGlzLmUgPSBzdmdfZWxlbWVudCgvKiogQHR5cGUge2tleW9mIFNWR0VsZW1lbnRUYWdOYW1lTWFwfSAqLyAodGFyZ2V0Lm5vZGVOYW1lKSk7CgkJCS8qKiAjNzM2NCAgdGFyZ2V0IGZvciA8dGVtcGxhdGU+IG1heSBiZSBwcm92aWRlZCBhcyAjZG9jdW1lbnQtZnJhZ21lbnQoMTEpICovIGVsc2UKCQkJCXRoaXMuZSA9IGVsZW1lbnQoCgkJCQkJLyoqIEB0eXBlIHtrZXlvZiBIVE1MRWxlbWVudFRhZ05hbWVNYXB9ICovICgKCQkJCQkJdGFyZ2V0Lm5vZGVUeXBlID09PSAxMSA/ICdURU1QTEFURScgOiB0YXJnZXQubm9kZU5hbWUKCQkJCQkpCgkJCQkpOwoJCQl0aGlzLnQgPQoJCQkJdGFyZ2V0LnRhZ05hbWUgIT09ICdURU1QTEFURScKCQkJCQk/IHRhcmdldAoJCQkJCTogLyoqIEB0eXBlIHtIVE1MVGVtcGxhdGVFbGVtZW50fSAqLyAodGFyZ2V0KS5jb250ZW50OwoJCQl0aGlzLmMoaHRtbCk7CgkJfQoJCXRoaXMuaShhbmNob3IpOwoJfQoKCS8qKgoJICogQHBhcmFtIHtzdHJpbmd9IGh0bWwKCSAqIEByZXR1cm5zIHt2b2lkfQoJICovCgloKGh0bWwpIHsKCQl0aGlzLmUuaW5uZXJIVE1MID0gaHRtbDsKCQl0aGlzLm4gPSBBcnJheS5mcm9tKAoJCQl0aGlzLmUubm9kZU5hbWUgPT09ICdURU1QTEFURScgPyB0aGlzLmUuY29udGVudC5jaGlsZE5vZGVzIDogdGhpcy5lLmNoaWxkTm9kZXMKCQkpOwoJfQoKCS8qKgoJICogQHJldHVybnMge3ZvaWR9ICovCglpKGFuY2hvcikgewoJCWZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5uLmxlbmd0aDsgaSArPSAxKSB7CgkJCWluc2VydCh0aGlzLnQsIHRoaXMubltpXSwgYW5jaG9yKTsKCQl9Cgl9CgoJLyoqCgkgKiBAcGFyYW0ge3N0cmluZ30gaHRtbAoJICogQHJldHVybnMge3ZvaWR9CgkgKi8KCXAoaHRtbCkgewoJCXRoaXMuZCgpOwoJCXRoaXMuaChodG1sKTsKCQl0aGlzLmkodGhpcy5hKTsKCX0KCgkvKioKCSAqIEByZXR1cm5zIHt2b2lkfSAqLwoJZCgpIHsKCQl0aGlzLm4uZm9yRWFjaChkZXRhY2gpOwoJfQp9CgpmdW5jdGlvbiBjb25zdHJ1Y3Rfc3ZlbHRlX2NvbXBvbmVudChjb21wb25lbnQsIHByb3BzKSB7CglyZXR1cm4gbmV3IGNvbXBvbmVudChwcm9wcyk7Cn0KCi8qKgogKiBAdHlwZWRlZiB7Tm9kZSAmIHsKICogCWNsYWltX29yZGVyPzogbnVtYmVyOwogKiAJaHlkcmF0ZV9pbml0PzogdHJ1ZTsKICogCWFjdHVhbF9lbmRfY2hpbGQ/OiBOb2RlRXg7CiAqIAljaGlsZE5vZGVzOiBOb2RlTGlzdE9mPE5vZGVFeD47CiAqIH19IE5vZGVFeAogKi8KCi8qKiBAdHlwZWRlZiB7Q2hpbGROb2RlICYgTm9kZUV4fSBDaGlsZE5vZGVFeCAqLwoKLyoqIEB0eXBlZGVmIHtOb2RlRXggJiB7IGNsYWltX29yZGVyOiBudW1iZXIgfX0gTm9kZUV4MiAqLwoKLyoqCiAqIEB0eXBlZGVmIHtDaGlsZE5vZGVFeFtdICYgewogKiAJY2xhaW1faW5mbz86IHsKICogCQlsYXN0X2luZGV4OiBudW1iZXI7CiAqIAkJdG90YWxfY2xhaW1lZDogbnVtYmVyOwogKiAJfTsKICogfX0gQ2hpbGROb2RlQXJyYXkKICovCgovLyB3ZSBuZWVkIHRvIHN0b3JlIHRoZSBpbmZvcm1hdGlvbiBmb3IgbXVsdGlwbGUgZG9jdW1lbnRzIGJlY2F1c2UgYSBTdmVsdGUgYXBwbGljYXRpb24gY291bGQgYWxzbyBjb250YWluIGlmcmFtZXMKLy8gaHR0cHM6Ly9naXRodWIuY29tL3N2ZWx0ZWpzL3N2ZWx0ZS9pc3N1ZXMvMzYyNAovKiogQHR5cGUge01hcDxEb2N1bWVudCB8IFNoYWRvd1Jvb3QsIGltcG9ydCgnLi9wcml2YXRlLmQudHMnKS5TdHlsZUluZm9ybWF0aW9uPn0gKi8KY29uc3QgbWFuYWdlZF9zdHlsZXMgPSBuZXcgTWFwKCk7CgpsZXQgYWN0aXZlID0gMDsKCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9kYXJrc2t5YXBwL3N0cmluZy1oYXNoL2Jsb2IvbWFzdGVyL2luZGV4LmpzCi8qKgogKiBAcGFyYW0ge3N0cmluZ30gc3RyCiAqIEByZXR1cm5zIHtudW1iZXJ9CiAqLwpmdW5jdGlvbiBoYXNoKHN0cikgewoJbGV0IGhhc2ggPSA1MzgxOwoJbGV0IGkgPSBzdHIubGVuZ3RoOwoJd2hpbGUgKGktLSkgaGFzaCA9ICgoaGFzaCA8PCA1KSAtIGhhc2gpIF4gc3RyLmNoYXJDb2RlQXQoaSk7CglyZXR1cm4gaGFzaCA+Pj4gMDsKfQoKLyoqCiAqIEBwYXJhbSB7RG9jdW1lbnQgfCBTaGFkb3dSb290fSBkb2MKICogQHBhcmFtIHtFbGVtZW50ICYgRWxlbWVudENTU0lubGluZVN0eWxlfSBub2RlCiAqIEByZXR1cm5zIHt7IHN0eWxlc2hlZXQ6IGFueTsgcnVsZXM6IHt9OyB9fQogKi8KZnVuY3Rpb24gY3JlYXRlX3N0eWxlX2luZm9ybWF0aW9uKGRvYywgbm9kZSkgewoJY29uc3QgaW5mbyA9IHsgc3R5bGVzaGVldDogYXBwZW5kX2VtcHR5X3N0eWxlc2hlZXQobm9kZSksIHJ1bGVzOiB7fSB9OwoJbWFuYWdlZF9zdHlsZXMuc2V0KGRvYywgaW5mbyk7CglyZXR1cm4gaW5mbzsKfQoKLyoqCiAqIEBwYXJhbSB7RWxlbWVudCAmIEVsZW1lbnRDU1NJbmxpbmVTdHlsZX0gbm9kZQogKiBAcGFyYW0ge251bWJlcn0gYQogKiBAcGFyYW0ge251bWJlcn0gYgogKiBAcGFyYW0ge251bWJlcn0gZHVyYXRpb24KICogQHBhcmFtIHtudW1iZXJ9IGRlbGF5CiAqIEBwYXJhbSB7KHQ6IG51bWJlcikgPT4gbnVtYmVyfSBlYXNlCiAqIEBwYXJhbSB7KHQ6IG51bWJlciwgdTogbnVtYmVyKSA9PiBzdHJpbmd9IGZuCiAqIEBwYXJhbSB7bnVtYmVyfSB1aWQKICogQHJldHVybnMge3N0cmluZ30KICovCmZ1bmN0aW9uIGNyZWF0ZV9ydWxlKG5vZGUsIGEsIGIsIGR1cmF0aW9uLCBkZWxheSwgZWFzZSwgZm4sIHVpZCA9IDApIHsKCWNvbnN0IHN0ZXAgPSAxNi42NjYgLyBkdXJhdGlvbjsKCWxldCBrZXlmcmFtZXMgPSAne1xuJzsKCWZvciAobGV0IHAgPSAwOyBwIDw9IDE7IHAgKz0gc3RlcCkgewoJCWNvbnN0IHQgPSBhICsgKGIgLSBhKSAqIGVhc2UocCk7CgkJa2V5ZnJhbWVzICs9IHAgKiAxMDAgKyBgJXske2ZuKHQsIDEgLSB0KX19XG5gOwoJfQoJY29uc3QgcnVsZSA9IGtleWZyYW1lcyArIGAxMDAlIHske2ZuKGIsIDEgLSBiKX19XG59YDsKCWNvbnN0IG5hbWUgPSBgX19zdmVsdGVfJHtoYXNoKHJ1bGUpfV8ke3VpZH1gOwoJY29uc3QgZG9jID0gZ2V0X3Jvb3RfZm9yX3N0eWxlKG5vZGUpOwoJY29uc3QgeyBzdHlsZXNoZWV0LCBydWxlcyB9ID0gbWFuYWdlZF9zdHlsZXMuZ2V0KGRvYykgfHwgY3JlYXRlX3N0eWxlX2luZm9ybWF0aW9uKGRvYywgbm9kZSk7CglpZiAoIXJ1bGVzW25hbWVdKSB7CgkJcnVsZXNbbmFtZV0gPSB0cnVlOwoJCXN0eWxlc2hlZXQuaW5zZXJ0UnVsZShgQGtleWZyYW1lcyAke25hbWV9ICR7cnVsZX1gLCBzdHlsZXNoZWV0LmNzc1J1bGVzLmxlbmd0aCk7Cgl9Cgljb25zdCBhbmltYXRpb24gPSBub2RlLnN0eWxlLmFuaW1hdGlvbiB8fCAnJzsKCW5vZGUuc3R5bGUuYW5pbWF0aW9uID0gYCR7CgkJYW5pbWF0aW9uID8gYCR7YW5pbWF0aW9ufSwgYCA6ICcnCgl9JHtuYW1lfSAke2R1cmF0aW9ufW1zIGxpbmVhciAke2RlbGF5fW1zIDEgYm90aGA7CglhY3RpdmUgKz0gMTsKCXJldHVybiBuYW1lOwp9CgovKioKICogQHBhcmFtIHtFbGVtZW50ICYgRWxlbWVudENTU0lubGluZVN0eWxlfSBub2RlCiAqIEBwYXJhbSB7c3RyaW5nfSBbbmFtZV0KICogQHJldHVybnMge3ZvaWR9CiAqLwpmdW5jdGlvbiBkZWxldGVfcnVsZShub2RlLCBuYW1lKSB7Cgljb25zdCBwcmV2aW91cyA9IChub2RlLnN0eWxlLmFuaW1hdGlvbiB8fCAnJykuc3BsaXQoJywgJyk7Cgljb25zdCBuZXh0ID0gcHJldmlvdXMuZmlsdGVyKAoJCW5hbWUKCQkJPyAoYW5pbSkgPT4gYW5pbS5pbmRleE9mKG5hbWUpIDwgMCAvLyByZW1vdmUgc3BlY2lmaWMgYW5pbWF0aW9uCgkJCTogKGFuaW0pID0+IGFuaW0uaW5kZXhPZignX19zdmVsdGUnKSA9PT0gLTEgLy8gcmVtb3ZlIGFsbCBTdmVsdGUgYW5pbWF0aW9ucwoJKTsKCWNvbnN0IGRlbGV0ZWQgPSBwcmV2aW91cy5sZW5ndGggLSBuZXh0Lmxlbmd0aDsKCWlmIChkZWxldGVkKSB7CgkJbm9kZS5zdHlsZS5hbmltYXRpb24gPSBuZXh0LmpvaW4oJywgJyk7CgkJYWN0aXZlIC09IGRlbGV0ZWQ7CgkJaWYgKCFhY3RpdmUpIGNsZWFyX3J1bGVzKCk7Cgl9Cn0KCi8qKiBAcmV0dXJucyB7dm9pZH0gKi8KZnVuY3Rpb24gY2xlYXJfcnVsZXMoKSB7CglyYWYoKCkgPT4gewoJCWlmIChhY3RpdmUpIHJldHVybjsKCQltYW5hZ2VkX3N0eWxlcy5mb3JFYWNoKChpbmZvKSA9PiB7CgkJCWNvbnN0IHsgb3duZXJOb2RlIH0gPSBpbmZvLnN0eWxlc2hlZXQ7CgkJCS8vIHRoZXJlIGlzIG5vIG93bmVyTm9kZSBpZiBpdCBydW5zIG9uIGpzZG9tLgoJCQlpZiAob3duZXJOb2RlKSBkZXRhY2gob3duZXJOb2RlKTsKCQl9KTsKCQltYW5hZ2VkX3N0eWxlcy5jbGVhcigpOwoJfSk7Cn0KCmxldCBjdXJyZW50X2NvbXBvbmVudDsKCi8qKiBAcmV0dXJucyB7dm9pZH0gKi8KZnVuY3Rpb24gc2V0X2N1cnJlbnRfY29tcG9uZW50KGNvbXBvbmVudCkgewoJY3VycmVudF9jb21wb25lbnQgPSBjb21wb25lbnQ7Cn0KCmZ1bmN0aW9uIGdldF9jdXJyZW50X2NvbXBvbmVudCgpIHsKCWlmICghY3VycmVudF9jb21wb25lbnQpIHRocm93IG5ldyBFcnJvcignRnVuY3Rpb24gY2FsbGVkIG91dHNpZGUgY29tcG9uZW50IGluaXRpYWxpemF0aW9uJyk7CglyZXR1cm4gY3VycmVudF9jb21wb25lbnQ7Cn0KCi8qKgogKiBUaGUgYG9uTW91bnRgIGZ1bmN0aW9uIHNjaGVkdWxlcyBhIGNhbGxiYWNrIHRvIHJ1biBhcyBzb29uIGFzIHRoZSBjb21wb25lbnQgaGFzIGJlZW4gbW91bnRlZCB0byB0aGUgRE9NLgogKiBJdCBtdXN0IGJlIGNhbGxlZCBkdXJpbmcgdGhlIGNvbXBvbmVudCdzIGluaXRpYWxpc2F0aW9uIChidXQgZG9lc24ndCBuZWVkIHRvIGxpdmUgKmluc2lkZSogdGhlIGNvbXBvbmVudDsKICogaXQgY2FuIGJlIGNhbGxlZCBmcm9tIGFuIGV4dGVybmFsIG1vZHVsZSkuCiAqCiAqIElmIGEgZnVuY3Rpb24gaXMgcmV0dXJuZWQgX3N5bmNocm9ub3VzbHlfIGZyb20gYG9uTW91bnRgLCBpdCB3aWxsIGJlIGNhbGxlZCB3aGVuIHRoZSBjb21wb25lbnQgaXMgdW5tb3VudGVkLgogKgogKiBgb25Nb3VudGAgZG9lcyBub3QgcnVuIGluc2lkZSBhIFtzZXJ2ZXItc2lkZSBjb21wb25lbnRdKC9kb2NzI3J1bi10aW1lLXNlcnZlci1zaWRlLWNvbXBvbmVudC1hcGkpLgogKgogKiBodHRwczovL3N2ZWx0ZS5kZXYvZG9jcy9zdmVsdGUjb25tb3VudAogKiBAdGVtcGxhdGUgVAogKiBAcGFyYW0geygpID0+IGltcG9ydCgnLi9wcml2YXRlLmpzJykuTm90RnVuY3Rpb248VD4gfCBQcm9taXNlPGltcG9ydCgnLi9wcml2YXRlLmpzJykuTm90RnVuY3Rpb248VD4+IHwgKCgpID0+IGFueSl9IGZuCiAqIEByZXR1cm5zIHt2b2lkfQogKi8KZnVuY3Rpb24gb25Nb3VudChmbikgewoJZ2V0X2N1cnJlbnRfY29tcG9uZW50KCkuJCQub25fbW91bnQucHVzaChmbik7Cn0KCi8qKgogKiBTY2hlZHVsZXMgYSBjYWxsYmFjayB0byBydW4gaW1tZWRpYXRlbHkgYmVmb3JlIHRoZSBjb21wb25lbnQgaXMgdW5tb3VudGVkLgogKgogKiBPdXQgb2YgYG9uTW91bnRgLCBgYmVmb3JlVXBkYXRlYCwgYGFmdGVyVXBkYXRlYCBhbmQgYG9uRGVzdHJveWAsIHRoaXMgaXMgdGhlCiAqIG9ubHkgb25lIHRoYXQgcnVucyBpbnNpZGUgYSBzZXJ2ZXItc2lkZSBjb21wb25lbnQuCiAqCiAqIGh0dHBzOi8vc3ZlbHRlLmRldi9kb2NzL3N2ZWx0ZSNvbmRlc3Ryb3kKICogQHBhcmFtIHsoKSA9PiBhbnl9IGZuCiAqIEByZXR1cm5zIHt2b2lkfQogKi8KZnVuY3Rpb24gb25EZXN0cm95KGZuKSB7CglnZXRfY3VycmVudF9jb21wb25lbnQoKS4kJC5vbl9kZXN0cm95LnB1c2goZm4pOwp9CgovKioKICogQ3JlYXRlcyBhbiBldmVudCBkaXNwYXRjaGVyIHRoYXQgY2FuIGJlIHVzZWQgdG8gZGlzcGF0Y2ggW2NvbXBvbmVudCBldmVudHNdKC9kb2NzI3RlbXBsYXRlLXN5bnRheC1jb21wb25lbnQtZGlyZWN0aXZlcy1vbi1ldmVudG5hbWUpLgogKiBFdmVudCBkaXNwYXRjaGVycyBhcmUgZnVuY3Rpb25zIHRoYXQgY2FuIHRha2UgdHdvIGFyZ3VtZW50czogYG5hbWVgIGFuZCBgZGV0YWlsYC4KICoKICogQ29tcG9uZW50IGV2ZW50cyBjcmVhdGVkIHdpdGggYGNyZWF0ZUV2ZW50RGlzcGF0Y2hlcmAgY3JlYXRlIGEKICogW0N1c3RvbUV2ZW50XShodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvQ3VzdG9tRXZlbnQpLgogKiBUaGVzZSBldmVudHMgZG8gbm90IFtidWJibGVdKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvTGVhcm4vSmF2YVNjcmlwdC9CdWlsZGluZ19ibG9ja3MvRXZlbnRzI0V2ZW50X2J1YmJsaW5nX2FuZF9jYXB0dXJlKS4KICogVGhlIGBkZXRhaWxgIGFyZ3VtZW50IGNvcnJlc3BvbmRzIHRvIHRoZSBbQ3VzdG9tRXZlbnQuZGV0YWlsXShodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvQ3VzdG9tRXZlbnQvZGV0YWlsKQogKiBwcm9wZXJ0eSBhbmQgY2FuIGNvbnRhaW4gYW55IHR5cGUgb2YgZGF0YS4KICoKICogVGhlIGV2ZW50IGRpc3BhdGNoZXIgY2FuIGJlIHR5cGVkIHRvIG5hcnJvdyB0aGUgYWxsb3dlZCBldmVudCBuYW1lcyBhbmQgdGhlIHR5cGUgb2YgdGhlIGBkZXRhaWxgIGFyZ3VtZW50OgogKiBgYGB0cwogKiBjb25zdCBkaXNwYXRjaCA9IGNyZWF0ZUV2ZW50RGlzcGF0Y2hlcjx7CiAqICBsb2FkZWQ6IG5ldmVyOyAvLyBkb2VzIG5vdCB0YWtlIGEgZGV0YWlsIGFyZ3VtZW50CiAqICBjaGFuZ2U6IHN0cmluZzsgLy8gdGFrZXMgYSBkZXRhaWwgYXJndW1lbnQgb2YgdHlwZSBzdHJpbmcsIHdoaWNoIGlzIHJlcXVpcmVkCiAqICBvcHRpb25hbDogbnVtYmVyIHwgbnVsbDsgLy8gdGFrZXMgYW4gb3B0aW9uYWwgZGV0YWlsIGFyZ3VtZW50IG9mIHR5cGUgbnVtYmVyCiAqIH0+KCk7CiAqIGBgYAogKgogKiBodHRwczovL3N2ZWx0ZS5kZXYvZG9jcy9zdmVsdGUjY3JlYXRlZXZlbnRkaXNwYXRjaGVyCiAqIEB0ZW1wbGF0ZSB7UmVjb3JkPHN0cmluZywgYW55Pn0gW0V2ZW50TWFwPWFueV0KICogQHJldHVybnMge2ltcG9ydCgnLi9wdWJsaWMuanMnKS5FdmVudERpc3BhdGNoZXI8RXZlbnRNYXA+fQogKi8KZnVuY3Rpb24gY3JlYXRlRXZlbnREaXNwYXRjaGVyKCkgewoJY29uc3QgY29tcG9uZW50ID0gZ2V0X2N1cnJlbnRfY29tcG9uZW50KCk7CglyZXR1cm4gKHR5cGUsIGRldGFpbCwgeyBjYW5jZWxhYmxlID0gZmFsc2UgfSA9IHt9KSA9PiB7CgkJY29uc3QgY2FsbGJhY2tzID0gY29tcG9uZW50LiQkLmNhbGxiYWNrc1t0eXBlXTsKCQlpZiAoY2FsbGJhY2tzKSB7CgkJCS8vIFRPRE8gYXJlIHRoZXJlIHNpdHVhdGlvbnMgd2hlcmUgZXZlbnRzIGNvdWxkIGJlIGRpc3BhdGNoZWQKCQkJLy8gaW4gYSBzZXJ2ZXIgKG5vbi1ET00pIGVudmlyb25tZW50PwoJCQljb25zdCBldmVudCA9IGN1c3RvbV9ldmVudCgvKiogQHR5cGUge3N0cmluZ30gKi8gKHR5cGUpLCBkZXRhaWwsIHsgY2FuY2VsYWJsZSB9KTsKCQkJY2FsbGJhY2tzLnNsaWNlKCkuZm9yRWFjaCgoZm4pID0+IHsKCQkJCWZuLmNhbGwoY29tcG9uZW50LCBldmVudCk7CgkJCX0pOwoJCQlyZXR1cm4gIWV2ZW50LmRlZmF1bHRQcmV2ZW50ZWQ7CgkJfQoJCXJldHVybiB0cnVlOwoJfTsKfQoKLy8gVE9ETyBmaWd1cmUgb3V0IGlmIHdlIHN0aWxsIHdhbnQgdG8gc3VwcG9ydAovLyBzaG9ydGhhbmQgZXZlbnRzLCBvciBpZiB3ZSB3YW50IHRvIGltcGxlbWVudAovLyBhIHJlYWwgYnViYmxpbmcgbWVjaGFuaXNtCi8qKgogKiBAcGFyYW0gY29tcG9uZW50CiAqIEBwYXJhbSBldmVudAogKiBAcmV0dXJucyB7dm9pZH0KICovCmZ1bmN0aW9uIGJ1YmJsZShjb21wb25lbnQsIGV2ZW50KSB7Cgljb25zdCBjYWxsYmFja3MgPSBjb21wb25lbnQuJCQuY2FsbGJhY2tzW2V2ZW50LnR5cGVdOwoJaWYgKGNhbGxiYWNrcykgewoJCS8vIEB0cy1pZ25vcmUKCQljYWxsYmFja3Muc2xpY2UoKS5mb3JFYWNoKChmbikgPT4gZm4uY2FsbCh0aGlzLCBldmVudCkpOwoJfQp9Cgpjb25zdCBkaXJ0eV9jb21wb25lbnRzID0gW107CmNvbnN0IGJpbmRpbmdfY2FsbGJhY2tzID0gW107CgpsZXQgcmVuZGVyX2NhbGxiYWNrcyA9IFtdOwoKY29uc3QgZmx1c2hfY2FsbGJhY2tzID0gW107Cgpjb25zdCByZXNvbHZlZF9wcm9taXNlID0gLyogQF9fUFVSRV9fICovIFByb21pc2UucmVzb2x2ZSgpOwoKbGV0IHVwZGF0ZV9zY2hlZHVsZWQgPSBmYWxzZTsKCi8qKiBAcmV0dXJucyB7dm9pZH0gKi8KZnVuY3Rpb24gc2NoZWR1bGVfdXBkYXRlKCkgewoJaWYgKCF1cGRhdGVfc2NoZWR1bGVkKSB7CgkJdXBkYXRlX3NjaGVkdWxlZCA9IHRydWU7CgkJcmVzb2x2ZWRfcHJvbWlzZS50aGVuKGZsdXNoKTsKCX0KfQoKLyoqIEByZXR1cm5zIHt2b2lkfSAqLwpmdW5jdGlvbiBhZGRfcmVuZGVyX2NhbGxiYWNrKGZuKSB7CglyZW5kZXJfY2FsbGJhY2tzLnB1c2goZm4pOwp9CgovKiogQHJldHVybnMge3ZvaWR9ICovCmZ1bmN0aW9uIGFkZF9mbHVzaF9jYWxsYmFjayhmbikgewoJZmx1c2hfY2FsbGJhY2tzLnB1c2goZm4pOwp9CgovLyBmbHVzaCgpIGNhbGxzIGNhbGxiYWNrcyBpbiB0aGlzIG9yZGVyOgovLyAxLiBBbGwgYmVmb3JlVXBkYXRlIGNhbGxiYWNrcywgaW4gb3JkZXI6IHBhcmVudHMgYmVmb3JlIGNoaWxkcmVuCi8vIDIuIEFsbCBiaW5kOnRoaXMgY2FsbGJhY2tzLCBpbiByZXZlcnNlIG9yZGVyOiBjaGlsZHJlbiBiZWZvcmUgcGFyZW50cy4KLy8gMy4gQWxsIGFmdGVyVXBkYXRlIGNhbGxiYWNrcywgaW4gb3JkZXI6IHBhcmVudHMgYmVmb3JlIGNoaWxkcmVuLiBFWENFUFQKLy8gICAgZm9yIGFmdGVyVXBkYXRlcyBjYWxsZWQgZHVyaW5nIHRoZSBpbml0aWFsIG9uTW91bnQsIHdoaWNoIGFyZSBjYWxsZWQgaW4KLy8gICAgcmV2ZXJzZSBvcmRlcjogY2hpbGRyZW4gYmVmb3JlIHBhcmVudHMuCi8vIFNpbmNlIGNhbGxiYWNrcyBtaWdodCB1cGRhdGUgY29tcG9uZW50IHZhbHVlcywgd2hpY2ggY291bGQgdHJpZ2dlciBhbm90aGVyCi8vIGNhbGwgdG8gZmx1c2goKSwgdGhlIGZvbGxvd2luZyBzdGVwcyBndWFyZCBhZ2FpbnN0IHRoaXM6Ci8vIDEuIER1cmluZyBiZWZvcmVVcGRhdGUsIGFueSB1cGRhdGVkIGNvbXBvbmVudHMgd2lsbCBiZSBhZGRlZCB0byB0aGUKLy8gICAgZGlydHlfY29tcG9uZW50cyBhcnJheSBhbmQgd2lsbCBjYXVzZSBhIHJlZW50cmFudCBjYWxsIHRvIGZsdXNoKCkuIEJlY2F1c2UKLy8gICAgdGhlIGZsdXNoIGluZGV4IGlzIGtlcHQgb3V0c2lkZSB0aGUgZnVuY3Rpb24sIHRoZSByZWVudHJhbnQgY2FsbCB3aWxsIHBpY2sKLy8gICAgdXAgd2hlcmUgdGhlIGVhcmxpZXIgY2FsbCBsZWZ0IG9mZiBhbmQgZ28gdGhyb3VnaCBhbGwgZGlydHkgY29tcG9uZW50cy4gVGhlCi8vICAgIGN1cnJlbnRfY29tcG9uZW50IHZhbHVlIGlzIHNhdmVkIGFuZCByZXN0b3JlZCBzbyB0aGF0IHRoZSByZWVudHJhbnQgY2FsbCB3aWxsCi8vICAgIG5vdCBpbnRlcmZlcmUgd2l0aCB0aGUgInBhcmVudCIgZmx1c2goKSBjYWxsLgovLyAyLiBiaW5kOnRoaXMgY2FsbGJhY2tzIGNhbm5vdCB0cmlnZ2VyIG5ldyBmbHVzaCgpIGNhbGxzLgovLyAzLiBEdXJpbmcgYWZ0ZXJVcGRhdGUsIGFueSB1cGRhdGVkIGNvbXBvbmVudHMgd2lsbCBOT1QgaGF2ZSB0aGVpciBhZnRlclVwZGF0ZQovLyAgICBjYWxsYmFjayBjYWxsZWQgYSBzZWNvbmQgdGltZTsgdGhlIHNlZW5fY2FsbGJhY2tzIHNldCwgb3V0c2lkZSB0aGUgZmx1c2goKQovLyAgICBmdW5jdGlvbiwgZ3VhcmFudGVlcyB0aGlzIGJlaGF2aW9yLgpjb25zdCBzZWVuX2NhbGxiYWNrcyA9IG5ldyBTZXQoKTsKCmxldCBmbHVzaGlkeCA9IDA7IC8vIERvICpub3QqIG1vdmUgdGhpcyBpbnNpZGUgdGhlIGZsdXNoKCkgZnVuY3Rpb24KCi8qKiBAcmV0dXJucyB7dm9pZH0gKi8KZnVuY3Rpb24gZmx1c2goKSB7CgkvLyBEbyBub3QgcmVlbnRlciBmbHVzaCB3aGlsZSBkaXJ0eSBjb21wb25lbnRzIGFyZSB1cGRhdGVkLCBhcyB0aGlzIGNhbgoJLy8gcmVzdWx0IGluIGFuIGluZmluaXRlIGxvb3AuIEluc3RlYWQsIGxldCB0aGUgaW5uZXIgZmx1c2ggaGFuZGxlIGl0LgoJLy8gUmVlbnRyYW5jeSBpcyBvayBhZnRlcndhcmRzIGZvciBiaW5kaW5ncyBldGMuCglpZiAoZmx1c2hpZHggIT09IDApIHsKCQlyZXR1cm47Cgl9Cgljb25zdCBzYXZlZF9jb21wb25lbnQgPSBjdXJyZW50X2NvbXBvbmVudDsKCWRvIHsKCQkvLyBmaXJzdCwgY2FsbCBiZWZvcmVVcGRhdGUgZnVuY3Rpb25zCgkJLy8gYW5kIHVwZGF0ZSBjb21wb25lbnRzCgkJdHJ5IHsKCQkJd2hpbGUgKGZsdXNoaWR4IDwgZGlydHlfY29tcG9uZW50cy5sZW5ndGgpIHsKCQkJCWNvbnN0IGNvbXBvbmVudCA9IGRpcnR5X2NvbXBvbmVudHNbZmx1c2hpZHhdOwoJCQkJZmx1c2hpZHgrKzsKCQkJCXNldF9jdXJyZW50X2NvbXBvbmVudChjb21wb25lbnQpOwoJCQkJdXBkYXRlKGNvbXBvbmVudC4kJCk7CgkJCX0KCQl9IGNhdGNoIChlKSB7CgkJCS8vIHJlc2V0IGRpcnR5IHN0YXRlIHRvIG5vdCBlbmQgdXAgaW4gYSBkZWFkbG9ja2VkIHN0YXRlIGFuZCB0aGVuIHJldGhyb3cKCQkJZGlydHlfY29tcG9uZW50cy5sZW5ndGggPSAwOwoJCQlmbHVzaGlkeCA9IDA7CgkJCXRocm93IGU7CgkJfQoJCXNldF9jdXJyZW50X2NvbXBvbmVudChudWxsKTsKCQlkaXJ0eV9jb21wb25lbnRzLmxlbmd0aCA9IDA7CgkJZmx1c2hpZHggPSAwOwoJCXdoaWxlIChiaW5kaW5nX2NhbGxiYWNrcy5sZW5ndGgpIGJpbmRpbmdfY2FsbGJhY2tzLnBvcCgpKCk7CgkJLy8gdGhlbiwgb25jZSBjb21wb25lbnRzIGFyZSB1cGRhdGVkLCBjYWxsCgkJLy8gYWZ0ZXJVcGRhdGUgZnVuY3Rpb25zLiBUaGlzIG1heSBjYXVzZQoJCS8vIHN1YnNlcXVlbnQgdXBkYXRlcy4uLgoJCWZvciAobGV0IGkgPSAwOyBpIDwgcmVuZGVyX2NhbGxiYWNrcy5sZW5ndGg7IGkgKz0gMSkgewoJCQljb25zdCBjYWxsYmFjayA9IHJlbmRlcl9jYWxsYmFja3NbaV07CgkJCWlmICghc2Vlbl9jYWxsYmFja3MuaGFzKGNhbGxiYWNrKSkgewoJCQkJLy8gLi4uc28gZ3VhcmQgYWdhaW5zdCBpbmZpbml0ZSBsb29wcwoJCQkJc2Vlbl9jYWxsYmFja3MuYWRkKGNhbGxiYWNrKTsKCQkJCWNhbGxiYWNrKCk7CgkJCX0KCQl9CgkJcmVuZGVyX2NhbGxiYWNrcy5sZW5ndGggPSAwOwoJfSB3aGlsZSAoZGlydHlfY29tcG9uZW50cy5sZW5ndGgpOwoJd2hpbGUgKGZsdXNoX2NhbGxiYWNrcy5sZW5ndGgpIHsKCQlmbHVzaF9jYWxsYmFja3MucG9wKCkoKTsKCX0KCXVwZGF0ZV9zY2hlZHVsZWQgPSBmYWxzZTsKCXNlZW5fY2FsbGJhY2tzLmNsZWFyKCk7CglzZXRfY3VycmVudF9jb21wb25lbnQoc2F2ZWRfY29tcG9uZW50KTsKfQoKLyoqIEByZXR1cm5zIHt2b2lkfSAqLwpmdW5jdGlvbiB1cGRhdGUoJCQpIHsKCWlmICgkJC5mcmFnbWVudCAhPT0gbnVsbCkgewoJCSQkLnVwZGF0ZSgpOwoJCXJ1bl9hbGwoJCQuYmVmb3JlX3VwZGF0ZSk7CgkJY29uc3QgZGlydHkgPSAkJC5kaXJ0eTsKCQkkJC5kaXJ0eSA9IFstMV07CgkJJCQuZnJhZ21lbnQgJiYgJCQuZnJhZ21lbnQucCgkJC5jdHgsIGRpcnR5KTsKCQkkJC5hZnRlcl91cGRhdGUuZm9yRWFjaChhZGRfcmVuZGVyX2NhbGxiYWNrKTsKCX0KfQoKLyoqCiAqIFVzZWZ1bCBmb3IgZXhhbXBsZSB0byBleGVjdXRlIHJlbWFpbmluZyBgYWZ0ZXJVcGRhdGVgIGNhbGxiYWNrcyBiZWZvcmUgZXhlY3V0aW5nIGBkZXN0cm95YC4KICogQHBhcmFtIHtGdW5jdGlvbltdfSBmbnMKICogQHJldHVybnMge3ZvaWR9CiAqLwpmdW5jdGlvbiBmbHVzaF9yZW5kZXJfY2FsbGJhY2tzKGZucykgewoJY29uc3QgZmlsdGVyZWQgPSBbXTsKCWNvbnN0IHRhcmdldHMgPSBbXTsKCXJlbmRlcl9jYWxsYmFja3MuZm9yRWFjaCgoYykgPT4gKGZucy5pbmRleE9mKGMpID09PSAtMSA/IGZpbHRlcmVkLnB1c2goYykgOiB0YXJnZXRzLnB1c2goYykpKTsKCXRhcmdldHMuZm9yRWFjaCgoYykgPT4gYygpKTsKCXJlbmRlcl9jYWxsYmFja3MgPSBmaWx0ZXJlZDsKfQoKLyoqCiAqIEB0eXBlIHtQcm9taXNlPHZvaWQ+IHwgbnVsbH0KICovCmxldCBwcm9taXNlOwoKLyoqCiAqIEByZXR1cm5zIHtQcm9taXNlPHZvaWQ+fQogKi8KZnVuY3Rpb24gd2FpdCgpIHsKCWlmICghcHJvbWlzZSkgewoJCXByb21pc2UgPSBQcm9taXNlLnJlc29sdmUoKTsKCQlwcm9taXNlLnRoZW4oKCkgPT4gewoJCQlwcm9taXNlID0gbnVsbDsKCQl9KTsKCX0KCXJldHVybiBwcm9taXNlOwp9CgovKioKICogQHBhcmFtIHtFbGVtZW50fSBub2RlCiAqIEBwYXJhbSB7SU5UUk8gfCBPVVRSTyB8IGJvb2xlYW59IGRpcmVjdGlvbgogKiBAcGFyYW0geydzdGFydCcgfCAnZW5kJ30ga2luZAogKiBAcmV0dXJucyB7dm9pZH0KICovCmZ1bmN0aW9uIGRpc3BhdGNoKG5vZGUsIGRpcmVjdGlvbiwga2luZCkgewoJbm9kZS5kaXNwYXRjaEV2ZW50KGN1c3RvbV9ldmVudChgJHtkaXJlY3Rpb24gPyAnaW50cm8nIDogJ291dHJvJ30ke2tpbmR9YCkpOwp9Cgpjb25zdCBvdXRyb2luZyA9IG5ldyBTZXQoKTsKCi8qKgogKiBAdHlwZSB7T3V0cm99CiAqLwpsZXQgb3V0cm9zOwoKLyoqCiAqIEByZXR1cm5zIHt2b2lkfSAqLwpmdW5jdGlvbiBncm91cF9vdXRyb3MoKSB7CglvdXRyb3MgPSB7CgkJcjogMCwKCQljOiBbXSwKCQlwOiBvdXRyb3MgLy8gcGFyZW50IGdyb3VwCgl9Owp9CgovKioKICogQHJldHVybnMge3ZvaWR9ICovCmZ1bmN0aW9uIGNoZWNrX291dHJvcygpIHsKCWlmICghb3V0cm9zLnIpIHsKCQlydW5fYWxsKG91dHJvcy5jKTsKCX0KCW91dHJvcyA9IG91dHJvcy5wOwp9CgovKioKICogQHBhcmFtIHtpbXBvcnQoJy4vcHJpdmF0ZS5qcycpLkZyYWdtZW50fSBibG9jawogKiBAcGFyYW0gezAgfCAxfSBbbG9jYWxdCiAqIEByZXR1cm5zIHt2b2lkfQogKi8KZnVuY3Rpb24gdHJhbnNpdGlvbl9pbihibG9jaywgbG9jYWwpIHsKCWlmIChibG9jayAmJiBibG9jay5pKSB7CgkJb3V0cm9pbmcuZGVsZXRlKGJsb2NrKTsKCQlibG9jay5pKGxvY2FsKTsKCX0KfQoKLyoqCiAqIEBwYXJhbSB7aW1wb3J0KCcuL3ByaXZhdGUuanMnKS5GcmFnbWVudH0gYmxvY2sKICogQHBhcmFtIHswIHwgMX0gbG9jYWwKICogQHBhcmFtIHswIHwgMX0gW2RldGFjaF0KICogQHBhcmFtIHsoKSA9PiB2b2lkfSBbY2FsbGJhY2tdCiAqIEByZXR1cm5zIHt2b2lkfQogKi8KZnVuY3Rpb24gdHJhbnNpdGlvbl9vdXQoYmxvY2ssIGxvY2FsLCBkZXRhY2gsIGNhbGxiYWNrKSB7CglpZiAoYmxvY2sgJiYgYmxvY2subykgewoJCWlmIChvdXRyb2luZy5oYXMoYmxvY2spKSByZXR1cm47CgkJb3V0cm9pbmcuYWRkKGJsb2NrKTsKCQlvdXRyb3MuYy5wdXNoKCgpID0+IHsKCQkJb3V0cm9pbmcuZGVsZXRlKGJsb2NrKTsKCQkJaWYgKGNhbGxiYWNrKSB7CgkJCQlpZiAoZGV0YWNoKSBibG9jay5kKDEpOwoJCQkJY2FsbGJhY2soKTsKCQkJfQoJCX0pOwoJCWJsb2NrLm8obG9jYWwpOwoJfSBlbHNlIGlmIChjYWxsYmFjaykgewoJCWNhbGxiYWNrKCk7Cgl9Cn0KCi8qKgogKiBAdHlwZSB7aW1wb3J0KCcuLi90cmFuc2l0aW9uL3B1YmxpYy5qcycpLlRyYW5zaXRpb25Db25maWd9CiAqLwpjb25zdCBudWxsX3RyYW5zaXRpb24gPSB7IGR1cmF0aW9uOiAwIH07CgovKioKICogQHBhcmFtIHtFbGVtZW50ICYgRWxlbWVudENTU0lubGluZVN0eWxlfSBub2RlCiAqIEBwYXJhbSB7VHJhbnNpdGlvbkZufSBmbgogKiBAcGFyYW0ge2FueX0gcGFyYW1zCiAqIEByZXR1cm5zIHt7IGVuZChyZXNldDogYW55KTogdm9pZDsgfX0KICovCmZ1bmN0aW9uIGNyZWF0ZV9vdXRfdHJhbnNpdGlvbihub2RlLCBmbiwgcGFyYW1zKSB7CgkvKiogQHR5cGUge1RyYW5zaXRpb25PcHRpb25zfSAqLwoJY29uc3Qgb3B0aW9ucyA9IHsgZGlyZWN0aW9uOiAnb3V0JyB9OwoJbGV0IGNvbmZpZyA9IGZuKG5vZGUsIHBhcmFtcywgb3B0aW9ucyk7CglsZXQgcnVubmluZyA9IHRydWU7CglsZXQgYW5pbWF0aW9uX25hbWU7Cgljb25zdCBncm91cCA9IG91dHJvczsKCWdyb3VwLnIgKz0gMTsKCS8qKiBAdHlwZSB7Ym9vbGVhbn0gKi8KCWxldCBvcmlnaW5hbF9pbmVydF92YWx1ZTsKCgkvKioKCSAqIEByZXR1cm5zIHt2b2lkfSAqLwoJZnVuY3Rpb24gZ28oKSB7CgkJY29uc3QgewoJCQlkZWxheSA9IDAsCgkJCWR1cmF0aW9uID0gMzAwLAoJCQllYXNpbmcgPSBpZGVudGl0eSwKCQkJdGljayA9IG5vb3AkNCwKCQkJY3NzCgkJfSA9IGNvbmZpZyB8fCBudWxsX3RyYW5zaXRpb247CgoJCWlmIChjc3MpIGFuaW1hdGlvbl9uYW1lID0gY3JlYXRlX3J1bGUobm9kZSwgMSwgMCwgZHVyYXRpb24sIGRlbGF5LCBlYXNpbmcsIGNzcyk7CgoJCWNvbnN0IHN0YXJ0X3RpbWUgPSBub3coKSArIGRlbGF5OwoJCWNvbnN0IGVuZF90aW1lID0gc3RhcnRfdGltZSArIGR1cmF0aW9uOwoJCWFkZF9yZW5kZXJfY2FsbGJhY2soKCkgPT4gZGlzcGF0Y2gobm9kZSwgZmFsc2UsICdzdGFydCcpKTsKCgkJaWYgKCdpbmVydCcgaW4gbm9kZSkgewoJCQlvcmlnaW5hbF9pbmVydF92YWx1ZSA9IC8qKiBAdHlwZSB7SFRNTEVsZW1lbnR9ICovIChub2RlKS5pbmVydDsKCQkJbm9kZS5pbmVydCA9IHRydWU7CgkJfQoKCQlsb29wKChub3cpID0+IHsKCQkJaWYgKHJ1bm5pbmcpIHsKCQkJCWlmIChub3cgPj0gZW5kX3RpbWUpIHsKCQkJCQl0aWNrKDAsIDEpOwoJCQkJCWRpc3BhdGNoKG5vZGUsIGZhbHNlLCAnZW5kJyk7CgkJCQkJaWYgKCEtLWdyb3VwLnIpIHsKCQkJCQkJLy8gdGhpcyB3aWxsIHJlc3VsdCBpbiBgZW5kKClgIGJlaW5nIGNhbGxlZCwKCQkJCQkJLy8gc28gd2UgZG9uJ3QgbmVlZCB0byBjbGVhbiB1cCBoZXJlCgkJCQkJCXJ1bl9hbGwoZ3JvdXAuYyk7CgkJCQkJfQoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCQkJCWlmIChub3cgPj0gc3RhcnRfdGltZSkgewoJCQkJCWNvbnN0IHQgPSBlYXNpbmcoKG5vdyAtIHN0YXJ0X3RpbWUpIC8gZHVyYXRpb24pOwoJCQkJCXRpY2soMSAtIHQsIHQpOwoJCQkJfQoJCQl9CgkJCXJldHVybiBydW5uaW5nOwoJCX0pOwoJfQoKCWlmIChpc19mdW5jdGlvbihjb25maWcpKSB7CgkJd2FpdCgpLnRoZW4oKCkgPT4gewoJCQkvLyBAdHMtaWdub3JlCgkJCWNvbmZpZyA9IGNvbmZpZyhvcHRpb25zKTsKCQkJZ28oKTsKCQl9KTsKCX0gZWxzZSB7CgkJZ28oKTsKCX0KCglyZXR1cm4gewoJCWVuZChyZXNldCkgewoJCQlpZiAocmVzZXQgJiYgJ2luZXJ0JyBpbiBub2RlKSB7CgkJCQlub2RlLmluZXJ0ID0gb3JpZ2luYWxfaW5lcnRfdmFsdWU7CgkJCX0KCQkJaWYgKHJlc2V0ICYmIGNvbmZpZy50aWNrKSB7CgkJCQljb25maWcudGljaygxLCAwKTsKCQkJfQoJCQlpZiAocnVubmluZykgewoJCQkJaWYgKGFuaW1hdGlvbl9uYW1lKSBkZWxldGVfcnVsZShub2RlLCBhbmltYXRpb25fbmFtZSk7CgkJCQlydW5uaW5nID0gZmFsc2U7CgkJCX0KCQl9Cgl9Owp9CgovKiogQHR5cGVkZWYgezF9IElOVFJPICovCi8qKiBAdHlwZWRlZiB7MH0gT1VUUk8gKi8KLyoqIEB0eXBlZGVmIHt7IGRpcmVjdGlvbjogJ2luJyB8ICdvdXQnIHwgJ2JvdGgnIH19IFRyYW5zaXRpb25PcHRpb25zICovCi8qKiBAdHlwZWRlZiB7KG5vZGU6IEVsZW1lbnQsIHBhcmFtczogYW55LCBvcHRpb25zOiBUcmFuc2l0aW9uT3B0aW9ucykgPT4gaW1wb3J0KCcuLi90cmFuc2l0aW9uL3B1YmxpYy5qcycpLlRyYW5zaXRpb25Db25maWd9IFRyYW5zaXRpb25GbiAqLwoKLyoqCiAqIEB0eXBlZGVmIHtPYmplY3R9IE91dHJvCiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSByCiAqIEBwcm9wZXJ0eSB7RnVuY3Rpb25bXX0gYwogKiBAcHJvcGVydHkge09iamVjdH0gcAogKi8KCi8qKgogKiBAdHlwZWRlZiB7T2JqZWN0fSBQZW5kaW5nUHJvZ3JhbQogKiBAcHJvcGVydHkge251bWJlcn0gc3RhcnQKICogQHByb3BlcnR5IHtJTlRST3xPVVRST30gYgogKiBAcHJvcGVydHkge091dHJvfSBbZ3JvdXBdCiAqLwoKLyoqCiAqIEB0eXBlZGVmIHtPYmplY3R9IFByb2dyYW0KICogQHByb3BlcnR5IHtudW1iZXJ9IGEKICogQHByb3BlcnR5IHtJTlRST3xPVVRST30gYgogKiBAcHJvcGVydHkgezF8LTF9IGQKICogQHByb3BlcnR5IHtudW1iZXJ9IGR1cmF0aW9uCiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBzdGFydAogKiBAcHJvcGVydHkge251bWJlcn0gZW5kCiAqIEBwcm9wZXJ0eSB7T3V0cm99IFtncm91cF0KICovCgovLyBnZW5lcmFsIGVhY2ggZnVuY3Rpb25zOgoKZnVuY3Rpb24gZW5zdXJlX2FycmF5X2xpa2UoYXJyYXlfbGlrZV9vcl9pdGVyYXRvcikgewoJcmV0dXJuIGFycmF5X2xpa2Vfb3JfaXRlcmF0b3I/Lmxlbmd0aCAhPT0gdW5kZWZpbmVkCgkJPyBhcnJheV9saWtlX29yX2l0ZXJhdG9yCgkJOiBBcnJheS5mcm9tKGFycmF5X2xpa2Vfb3JfaXRlcmF0b3IpOwp9CgovKiogQHJldHVybnMge3t9fSAqLwpmdW5jdGlvbiBnZXRfc3ByZWFkX3VwZGF0ZShsZXZlbHMsIHVwZGF0ZXMpIHsKCWNvbnN0IHVwZGF0ZSA9IHt9OwoJY29uc3QgdG9fbnVsbF9vdXQgPSB7fTsKCWNvbnN0IGFjY291bnRlZF9mb3IgPSB7ICQkc2NvcGU6IDEgfTsKCWxldCBpID0gbGV2ZWxzLmxlbmd0aDsKCXdoaWxlIChpLS0pIHsKCQljb25zdCBvID0gbGV2ZWxzW2ldOwoJCWNvbnN0IG4gPSB1cGRhdGVzW2ldOwoJCWlmIChuKSB7CgkJCWZvciAoY29uc3Qga2V5IGluIG8pIHsKCQkJCWlmICghKGtleSBpbiBuKSkgdG9fbnVsbF9vdXRba2V5XSA9IDE7CgkJCX0KCQkJZm9yIChjb25zdCBrZXkgaW4gbikgewoJCQkJaWYgKCFhY2NvdW50ZWRfZm9yW2tleV0pIHsKCQkJCQl1cGRhdGVba2V5XSA9IG5ba2V5XTsKCQkJCQlhY2NvdW50ZWRfZm9yW2tleV0gPSAxOwoJCQkJfQoJCQl9CgkJCWxldmVsc1tpXSA9IG47CgkJfSBlbHNlIHsKCQkJZm9yIChjb25zdCBrZXkgaW4gbykgewoJCQkJYWNjb3VudGVkX2ZvcltrZXldID0gMTsKCQkJfQoJCX0KCX0KCWZvciAoY29uc3Qga2V5IGluIHRvX251bGxfb3V0KSB7CgkJaWYgKCEoa2V5IGluIHVwZGF0ZSkpIHVwZGF0ZVtrZXldID0gdW5kZWZpbmVkOwoJfQoJcmV0dXJuIHVwZGF0ZTsKfQoKZnVuY3Rpb24gZ2V0X3NwcmVhZF9vYmplY3Qoc3ByZWFkX3Byb3BzKSB7CglyZXR1cm4gdHlwZW9mIHNwcmVhZF9wcm9wcyA9PT0gJ29iamVjdCcgJiYgc3ByZWFkX3Byb3BzICE9PSBudWxsID8gc3ByZWFkX3Byb3BzIDoge307Cn0KCi8qKiBAcmV0dXJucyB7dm9pZH0gKi8KZnVuY3Rpb24gYmluZChjb21wb25lbnQsIG5hbWUsIGNhbGxiYWNrKSB7Cgljb25zdCBpbmRleCA9IGNvbXBvbmVudC4kJC5wcm9wc1tuYW1lXTsKCWlmIChpbmRleCAhPT0gdW5kZWZpbmVkKSB7CgkJY29tcG9uZW50LiQkLmJvdW5kW2luZGV4XSA9IGNhbGxiYWNrOwoJCWNhbGxiYWNrKGNvbXBvbmVudC4kJC5jdHhbaW5kZXhdKTsKCX0KfQoKLyoqIEByZXR1cm5zIHt2b2lkfSAqLwpmdW5jdGlvbiBjcmVhdGVfY29tcG9uZW50KGJsb2NrKSB7CglibG9jayAmJiBibG9jay5jKCk7Cn0KCi8qKiBAcmV0dXJucyB7dm9pZH0gKi8KZnVuY3Rpb24gbW91bnRfY29tcG9uZW50KGNvbXBvbmVudCwgdGFyZ2V0LCBhbmNob3IpIHsKCWNvbnN0IHsgZnJhZ21lbnQsIGFmdGVyX3VwZGF0ZSB9ID0gY29tcG9uZW50LiQkOwoJZnJhZ21lbnQgJiYgZnJhZ21lbnQubSh0YXJnZXQsIGFuY2hvcik7CgkvLyBvbk1vdW50IGhhcHBlbnMgYmVmb3JlIHRoZSBpbml0aWFsIGFmdGVyVXBkYXRlCglhZGRfcmVuZGVyX2NhbGxiYWNrKCgpID0+IHsKCQljb25zdCBuZXdfb25fZGVzdHJveSA9IGNvbXBvbmVudC4kJC5vbl9tb3VudC5tYXAocnVuKS5maWx0ZXIoaXNfZnVuY3Rpb24pOwoJCS8vIGlmIHRoZSBjb21wb25lbnQgd2FzIGRlc3Ryb3llZCBpbW1lZGlhdGVseQoJCS8vIGl0IHdpbGwgdXBkYXRlIHRoZSBgJCQub25fZGVzdHJveWAgcmVmZXJlbmNlIHRvIGBudWxsYC4KCQkvLyB0aGUgZGVzdHJ1Y3R1cmVkIG9uX2Rlc3Ryb3kgbWF5IHN0aWxsIHJlZmVyZW5jZSB0byB0aGUgb2xkIGFycmF5CgkJaWYgKGNvbXBvbmVudC4kJC5vbl9kZXN0cm95KSB7CgkJCWNvbXBvbmVudC4kJC5vbl9kZXN0cm95LnB1c2goLi4ubmV3X29uX2Rlc3Ryb3kpOwoJCX0gZWxzZSB7CgkJCS8vIEVkZ2UgY2FzZSAtIGNvbXBvbmVudCB3YXMgZGVzdHJveWVkIGltbWVkaWF0ZWx5LAoJCQkvLyBtb3N0IGxpa2VseSBhcyBhIHJlc3VsdCBvZiBhIGJpbmRpbmcgaW5pdGlhbGlzaW5nCgkJCXJ1bl9hbGwobmV3X29uX2Rlc3Ryb3kpOwoJCX0KCQljb21wb25lbnQuJCQub25fbW91bnQgPSBbXTsKCX0pOwoJYWZ0ZXJfdXBkYXRlLmZvckVhY2goYWRkX3JlbmRlcl9jYWxsYmFjayk7Cn0KCi8qKiBAcmV0dXJucyB7dm9pZH0gKi8KZnVuY3Rpb24gZGVzdHJveV9jb21wb25lbnQoY29tcG9uZW50LCBkZXRhY2hpbmcpIHsKCWNvbnN0ICQkID0gY29tcG9uZW50LiQkOwoJaWYgKCQkLmZyYWdtZW50ICE9PSBudWxsKSB7CgkJZmx1c2hfcmVuZGVyX2NhbGxiYWNrcygkJC5hZnRlcl91cGRhdGUpOwoJCXJ1bl9hbGwoJCQub25fZGVzdHJveSk7CgkJJCQuZnJhZ21lbnQgJiYgJCQuZnJhZ21lbnQuZChkZXRhY2hpbmcpOwoJCS8vIFRPRE8gbnVsbCBvdXQgb3RoZXIgcmVmcywgaW5jbHVkaW5nIGNvbXBvbmVudC4kJCAoYnV0IG5lZWQgdG8KCQkvLyBwcmVzZXJ2ZSBmaW5hbCBzdGF0ZT8pCgkJJCQub25fZGVzdHJveSA9ICQkLmZyYWdtZW50ID0gbnVsbDsKCQkkJC5jdHggPSBbXTsKCX0KfQoKLyoqIEByZXR1cm5zIHt2b2lkfSAqLwpmdW5jdGlvbiBtYWtlX2RpcnR5KGNvbXBvbmVudCwgaSkgewoJaWYgKGNvbXBvbmVudC4kJC5kaXJ0eVswXSA9PT0gLTEpIHsKCQlkaXJ0eV9jb21wb25lbnRzLnB1c2goY29tcG9uZW50KTsKCQlzY2hlZHVsZV91cGRhdGUoKTsKCQljb21wb25lbnQuJCQuZGlydHkuZmlsbCgwKTsKCX0KCWNvbXBvbmVudC4kJC5kaXJ0eVsoaSAvIDMxKSB8IDBdIHw9IDEgPDwgaSAlIDMxOwp9CgovKiogQHJldHVybnMge3ZvaWR9ICovCmZ1bmN0aW9uIGluaXQoCgljb21wb25lbnQsCglvcHRpb25zLAoJaW5zdGFuY2UsCgljcmVhdGVfZnJhZ21lbnQsCglub3RfZXF1YWwsCglwcm9wcywKCWFwcGVuZF9zdHlsZXMsCglkaXJ0eSA9IFstMV0KKSB7Cgljb25zdCBwYXJlbnRfY29tcG9uZW50ID0gY3VycmVudF9jb21wb25lbnQ7CglzZXRfY3VycmVudF9jb21wb25lbnQoY29tcG9uZW50KTsKCS8qKiBAdHlwZSB7aW1wb3J0KCcuL3ByaXZhdGUuanMnKS5UJCR9ICovCgljb25zdCAkJCA9IChjb21wb25lbnQuJCQgPSB7CgkJZnJhZ21lbnQ6IG51bGwsCgkJY3R4OiBbXSwKCQkvLyBzdGF0ZQoJCXByb3BzLAoJCXVwZGF0ZTogbm9vcCQ0LAoJCW5vdF9lcXVhbCwKCQlib3VuZDogYmxhbmtfb2JqZWN0KCksCgkJLy8gbGlmZWN5Y2xlCgkJb25fbW91bnQ6IFtdLAoJCW9uX2Rlc3Ryb3k6IFtdLAoJCW9uX2Rpc2Nvbm5lY3Q6IFtdLAoJCWJlZm9yZV91cGRhdGU6IFtdLAoJCWFmdGVyX3VwZGF0ZTogW10sCgkJY29udGV4dDogbmV3IE1hcChvcHRpb25zLmNvbnRleHQgfHwgKHBhcmVudF9jb21wb25lbnQgPyBwYXJlbnRfY29tcG9uZW50LiQkLmNvbnRleHQgOiBbXSkpLAoJCS8vIGV2ZXJ5dGhpbmcgZWxzZQoJCWNhbGxiYWNrczogYmxhbmtfb2JqZWN0KCksCgkJZGlydHksCgkJc2tpcF9ib3VuZDogZmFsc2UsCgkJcm9vdDogb3B0aW9ucy50YXJnZXQgfHwgcGFyZW50X2NvbXBvbmVudC4kJC5yb290Cgl9KTsKCWFwcGVuZF9zdHlsZXMgJiYgYXBwZW5kX3N0eWxlcygkJC5yb290KTsKCWxldCByZWFkeSA9IGZhbHNlOwoJJCQuY3R4ID0gaW5zdGFuY2UKCQk/IGluc3RhbmNlKGNvbXBvbmVudCwgb3B0aW9ucy5wcm9wcyB8fCB7fSwgKGksIHJldCwgLi4ucmVzdCkgPT4gewoJCQkJY29uc3QgdmFsdWUgPSByZXN0Lmxlbmd0aCA/IHJlc3RbMF0gOiByZXQ7CgkJCQlpZiAoJCQuY3R4ICYmIG5vdF9lcXVhbCgkJC5jdHhbaV0sICgkJC5jdHhbaV0gPSB2YWx1ZSkpKSB7CgkJCQkJaWYgKCEkJC5za2lwX2JvdW5kICYmICQkLmJvdW5kW2ldKSAkJC5ib3VuZFtpXSh2YWx1ZSk7CgkJCQkJaWYgKHJlYWR5KSBtYWtlX2RpcnR5KGNvbXBvbmVudCwgaSk7CgkJCQl9CgkJCQlyZXR1cm4gcmV0OwoJCSAgfSkKCQk6IFtdOwoJJCQudXBkYXRlKCk7CglyZWFkeSA9IHRydWU7CglydW5fYWxsKCQkLmJlZm9yZV91cGRhdGUpOwoJLy8gYGZhbHNlYCBhcyBhIHNwZWNpYWwgY2FzZSBvZiBubyBET00gY29tcG9uZW50CgkkJC5mcmFnbWVudCA9IGNyZWF0ZV9mcmFnbWVudCA/IGNyZWF0ZV9mcmFnbWVudCgkJC5jdHgpIDogZmFsc2U7CglpZiAob3B0aW9ucy50YXJnZXQpIHsKCQlpZiAob3B0aW9ucy5oeWRyYXRlKSB7CgkJCWNvbnN0IG5vZGVzID0gY2hpbGRyZW4ob3B0aW9ucy50YXJnZXQpOwoJCQkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5vbi1udWxsLWFzc2VydGlvbgoJCQkkJC5mcmFnbWVudCAmJiAkJC5mcmFnbWVudC5sKG5vZGVzKTsKCQkJbm9kZXMuZm9yRWFjaChkZXRhY2gpOwoJCX0gZWxzZSB7CgkJCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbm9uLW51bGwtYXNzZXJ0aW9uCgkJCSQkLmZyYWdtZW50ICYmICQkLmZyYWdtZW50LmMoKTsKCQl9CgkJaWYgKG9wdGlvbnMuaW50cm8pIHRyYW5zaXRpb25faW4oY29tcG9uZW50LiQkLmZyYWdtZW50KTsKCQltb3VudF9jb21wb25lbnQoY29tcG9uZW50LCBvcHRpb25zLnRhcmdldCwgb3B0aW9ucy5hbmNob3IpOwoJCWZsdXNoKCk7Cgl9CglzZXRfY3VycmVudF9jb21wb25lbnQocGFyZW50X2NvbXBvbmVudCk7Cn0KCi8qKgogKiBCYXNlIGNsYXNzIGZvciBTdmVsdGUgY29tcG9uZW50cy4gVXNlZCB3aGVuIGRldj1mYWxzZS4KICoKICogQHRlbXBsYXRlIHtSZWNvcmQ8c3RyaW5nLCBhbnk+fSBbUHJvcHM9YW55XQogKiBAdGVtcGxhdGUge1JlY29yZDxzdHJpbmcsIGFueT59IFtFdmVudHM9YW55XQogKi8KY2xhc3MgU3ZlbHRlQ29tcG9uZW50IHsKCS8qKgoJICogIyMjIFBSSVZBVEUgQVBJCgkgKgoJICogRG8gbm90IHVzZSwgbWF5IGNoYW5nZSBhdCBhbnkgdGltZQoJICoKCSAqIEB0eXBlIHthbnl9CgkgKi8KCSQkID0gdW5kZWZpbmVkOwoJLyoqCgkgKiAjIyMgUFJJVkFURSBBUEkKCSAqCgkgKiBEbyBub3QgdXNlLCBtYXkgY2hhbmdlIGF0IGFueSB0aW1lCgkgKgoJICogQHR5cGUge2FueX0KCSAqLwoJJCRzZXQgPSB1bmRlZmluZWQ7CgoJLyoqIEByZXR1cm5zIHt2b2lkfSAqLwoJJGRlc3Ryb3koKSB7CgkJZGVzdHJveV9jb21wb25lbnQodGhpcywgMSk7CgkJdGhpcy4kZGVzdHJveSA9IG5vb3AkNDsKCX0KCgkvKioKCSAqIEB0ZW1wbGF0ZSB7RXh0cmFjdDxrZXlvZiBFdmVudHMsIHN0cmluZz59IEsKCSAqIEBwYXJhbSB7S30gdHlwZQoJICogQHBhcmFtIHsoKGU6IEV2ZW50c1tLXSkgPT4gdm9pZCkgfCBudWxsIHwgdW5kZWZpbmVkfSBjYWxsYmFjawoJICogQHJldHVybnMgeygpID0+IHZvaWR9CgkgKi8KCSRvbih0eXBlLCBjYWxsYmFjaykgewoJCWlmICghaXNfZnVuY3Rpb24oY2FsbGJhY2spKSB7CgkJCXJldHVybiBub29wJDQ7CgkJfQoJCWNvbnN0IGNhbGxiYWNrcyA9IHRoaXMuJCQuY2FsbGJhY2tzW3R5cGVdIHx8ICh0aGlzLiQkLmNhbGxiYWNrc1t0eXBlXSA9IFtdKTsKCQljYWxsYmFja3MucHVzaChjYWxsYmFjayk7CgkJcmV0dXJuICgpID0+IHsKCQkJY29uc3QgaW5kZXggPSBjYWxsYmFja3MuaW5kZXhPZihjYWxsYmFjayk7CgkJCWlmIChpbmRleCAhPT0gLTEpIGNhbGxiYWNrcy5zcGxpY2UoaW5kZXgsIDEpOwoJCX07Cgl9CgoJLyoqCgkgKiBAcGFyYW0ge1BhcnRpYWw8UHJvcHM+fSBwcm9wcwoJICogQHJldHVybnMge3ZvaWR9CgkgKi8KCSRzZXQocHJvcHMpIHsKCQlpZiAodGhpcy4kJHNldCAmJiAhaXNfZW1wdHkocHJvcHMpKSB7CgkJCXRoaXMuJCQuc2tpcF9ib3VuZCA9IHRydWU7CgkJCXRoaXMuJCRzZXQocHJvcHMpOwoJCQl0aGlzLiQkLnNraXBfYm91bmQgPSBmYWxzZTsKCQl9Cgl9Cn0KCi8qKgogKiBAdHlwZWRlZiB7T2JqZWN0fSBDdXN0b21FbGVtZW50UHJvcERlZmluaXRpb24KICogQHByb3BlcnR5IHtzdHJpbmd9IFthdHRyaWJ1dGVdCiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW3JlZmxlY3RdCiAqIEBwcm9wZXJ0eSB7J1N0cmluZyd8J0Jvb2xlYW4nfCdOdW1iZXInfCdBcnJheSd8J09iamVjdCd9IFt0eXBlXQogKi8KCi8vIGdlbmVyYXRlZCBkdXJpbmcgcmVsZWFzZSwgZG8gbm90IG1vZGlmeQoKY29uc3QgUFVCTElDX1ZFUlNJT04gPSAnNCc7CgppZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpCgkvLyBAdHMtaWdub3JlCgkod2luZG93Ll9fc3ZlbHRlIHx8ICh3aW5kb3cuX19zdmVsdGUgPSB7IHY6IG5ldyBTZXQoKSB9KSkudi5hZGQoUFVCTElDX1ZFUlNJT04pOwoKLy8gVGhlIHVzZXIgbGlrZWx5IGhhcyBvdmVyd3JpdHRlbiBhbGwgbmV0d29ya2luZyBmdW5jdGlvbnMgYWZ0ZXIgaW1wb3J0aW5nIGJhcmUtY2xpZW50Ci8vIEl0IGlzIG91ciByZXNwb25zaWJpbGl0eSB0byBtYWtlIHN1cmUgY29tcG9uZW50cyBvZiBCYXJlLUNsaWVudCBhcmUgdXNpbmcgbmF0aXZlIG5ldHdvcmtpbmcgZnVuY3Rpb25zCi8vIFRoZXNlIGV4cG9ydHMgYXJlIHByb3ZpZGVkIHRvIHBsdWdpbnMgYnkgQHJvbGx1cC9wbHVnaW4taW5qZWN0CmNvbnN0IFdlYlNvY2tldCQxID0gZ2xvYmFsVGhpcy5XZWJTb2NrZXQ7CmNvbnN0IFJlc3BvbnNlJDEgPSBnbG9iYWxUaGlzLlJlc3BvbnNlOwoKY29uc3Qgc3RhdHVzRW1wdHkgPSBbMTAxLCAyMDQsIDIwNSwgMzA0XTsKY2xhc3MgQ2xpZW50IHsKfQoKY2xhc3MgUmVtb3RlQ2xpZW50IGV4dGVuZHMgQ2xpZW50IHsKICAgIGNhbGxiYWNrcyA9IHt9OwogICAgdWlkID0gdjQoKTsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgaWYgKCEoIlNlcnZpY2VXb3JrZXJHbG9iYWxTY29wZSIgaW4gc2VsZikpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQXR0ZW1wdCB0byBjb25zdHJ1Y3QgUmVtb3RlQ2xpZW50IGZyb20gb3V0c2lkZSBhIHNlcnZpY2Ugd29ya2VyIik7CiAgICAgICAgfQogICAgICAgIGFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCAoZXZlbnQpID0+IHsKICAgICAgICAgICAgaWYgKGV2ZW50LmRhdGEuX19yZW1vdGVfdGFyZ2V0ID09PSB0aGlzLnVpZCkgewogICAgICAgICAgICAgICAgY29uc3QgY2FsbGJhY2sgPSB0aGlzLmNhbGxiYWNrc1tldmVudC5kYXRhLl9fcmVtb3RlX2lkXTsKICAgICAgICAgICAgICAgIGNhbGxiYWNrKGV2ZW50LmRhdGEuX19yZW1vdGVfdmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICBhc3luYyBzZW5kKG1lc3NhZ2UsIGlkKSB7CiAgICAgICAgY29uc3QgY2xpZW50cyA9IGF3YWl0IHNlbGYuY2xpZW50cy5tYXRjaEFsbCgpOwogICAgICAgIGlmIChjbGllbnRzLmxlbmd0aCA8IDEpCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigibm8gYXZhaWxhYmxlIGNsaWVudHMiKTsKICAgICAgICBmb3IgKGNvbnN0IGNsaWVudCBvZiBjbGllbnRzKSB7CiAgICAgICAgICAgIGNsaWVudC5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICBfX3JlbW90ZV90YXJnZXQ6IHRoaXMudWlkLAogICAgICAgICAgICAgICAgX19yZW1vdGVfaWQ6IGlkLAogICAgICAgICAgICAgICAgX19yZW1vdGVfdmFsdWU6IG1lc3NhZ2UKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQogICAgYXN5bmMgc2VuZFdpdGhSZXNwb25zZShtZXNzYWdlKSB7CiAgICAgICAgY29uc3QgaWQgPSB2NCgpOwogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICB0aGlzLmNhbGxiYWNrc1tpZF0gPSByZXNvbHZlOwogICAgICAgICAgICB0aGlzLnNlbmQobWVzc2FnZSwgaWQpOwogICAgICAgIH0pOwogICAgfQogICAgY29ubmVjdChyZW1vdGUsIHByb3RvY29scywgZ2V0UmVxdWVzdEhlYWRlcnMsIG9uTWV0YSwgb25SZWFkeVN0YXRlKSB7CiAgICAgICAgcmV0dXJuIG5ldyBXZWJTb2NrZXQkMSgiIik7CiAgICB9CiAgICBhc3luYyByZXF1ZXN0KG1ldGhvZCwgcmVxdWVzdEhlYWRlcnMsIGJvZHksIHJlbW90ZSwgY2FjaGUsIGR1cGxleCwgc2lnbmFsKSB7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLnNlbmRXaXRoUmVzcG9uc2UoewogICAgICAgICAgICB0eXBlOiAicmVxdWVzdCIsCiAgICAgICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgICAgICAgIG1ldGhvZCwKICAgICAgICAgICAgICAgIHJlcXVlc3RIZWFkZXJzLAogICAgICAgICAgICAgICAgYm9keSwKICAgICAgICAgICAgICAgIHJlbW90ZTogcmVtb3RlLnRvU3RyaW5nKCksCiAgICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICAgICAgLy8gY29uc3QgcmVhZFJlc3BvbnNlID0gYXdhaXQgdGhpcy5yZWFkQmFyZVJlc3BvbnNlKHJlc3BvbnNlKTsKICAgICAgICBjb25zdCByZXN1bHQgPSBuZXcgUmVzcG9uc2UkMShzdGF0dXNFbXB0eS5pbmNsdWRlcyhyZXNwb25zZS5zdGF0dXMpID8gdW5kZWZpbmVkIDogcmVzcG9uc2UuYm9keSwgewogICAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cywKICAgICAgICAgICAgc3RhdHVzVGV4dDogcmVzcG9uc2Uuc3RhdHVzVGV4dCA/PyB1bmRlZmluZWQsCiAgICAgICAgICAgIGhlYWRlcnM6IG5ldyBIZWFkZXJzKHJlc3BvbnNlLmhlYWRlcnMpLAogICAgICAgIH0pOwogICAgICAgIHJlc3VsdC5yYXdIZWFkZXJzID0gcmVzcG9uc2UuaGVhZGVyczsKICAgICAgICByZXN1bHQucmF3UmVzcG9uc2UgPSByZXNwb25zZTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQp9CgovLyBnZXQgdGhlIHVuaG9va2VkIHZhbHVlCk9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoV2ViU29ja2V0JDEucHJvdG90eXBlLCAncmVhZHlTdGF0ZScpLmdldDsKc2VsZi5CQ0NfVkVSU0lPTiA9ICIxLjIuMSI7CmNvbnNvbGUud2FybigiQkNDX1ZFUlNJT046ICIgKyBzZWxmLkJDQ19WRVJTSU9OKTsKZnVuY3Rpb24gc2V0QmFyZUNsaWVudEltcGxlbWVudGF0aW9uKGltcGxlbWVudGF0aW9uKSB7CiAgICBzZWxmLmdCYXJlQ2xpZW50SW1wbGVtZW50YXRpb24gPSBpbXBsZW1lbnRhdGlvbjsKfQppZiAoIlNlcnZpY2VXb3JrZXJHbG9iYWxTY29wZSIgaW4gc2VsZikgewogICAgc2V0QmFyZUNsaWVudEltcGxlbWVudGF0aW9uKG5ldyBSZW1vdGVDbGllbnQoKSk7Cn0KZWxzZSB7CiAgICBsZXQgcGFyZW50ID0gc2VsZjsKICAgIGNvbnNvbGUubG9nKCJhdHRlbXB0aW5nIHRvIGZpbmQgYW4gaW1wbGVtZW50YXRpb24iKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHBhcmVudCA9IHBhcmVudC5wYXJlbnQ7CiAgICAgICAgICAgIGlmIChwYXJlbnQgJiYgcGFyZW50WyJnQmFyZUNsaWVudEltcGxlbWVudGF0aW9uIl0pIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiZm91bmQgaW1wbGVtZW50YXRpb24gb24gcGFyZW50Iik7CiAgICAgICAgICAgICAgICBzZXRCYXJlQ2xpZW50SW1wbGVtZW50YXRpb24ocGFyZW50WyJnQmFyZUNsaWVudEltcGxlbWVudGF0aW9uIl0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coImNvdWxkIG5vdCBmaW5kIGltcGxlbWVudGF0aW9uIik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KfQoKY2xhc3MgVHJhbnNwb3J0IHsKICBjb25zdHJ1Y3Rvcihvbm9wZW4sIG9uY2xvc2UpIHsKICAgIHRoaXMub25vcGVuID0gb25vcGVuOwogICAgdGhpcy5vbmNsb3NlID0gb25jbG9zZTsKICAgIHRoaXMub25kYXRhID0gKCkgPT4gewogICAgfTsKICB9Cn0KCmNvbnN0IEMyU1JlcXVlc3RUeXBlcyA9IHsKICBIVFRQUmVxdWVzdFN0YXJ0OiAwLAogIEhUVFBSZXF1ZXN0Q2h1bms6IDEsCiAgSFRUUFJlcXVlc3RFbmQ6IDIsCiAgV1NPcGVuOiAzLAogIFdTQ2xvc2U6IDQsCiAgV1NTZW5kVGV4dDogNSwKICBXU1NlbmRCaW5hcnk6IDYKfTsKY29uc3QgUzJDUmVxdWVzdFR5cGVzID0gewogIEhUVFBSZXNwb25zZVN0YXJ0OiAwLAogIEhUVFBSZXNwb25zZUNodW5rOiAxLAogIEhUVFBSZXNwb25zZUVuZDogMiwKICBXU09wZW46IDMsCiAgV1NDbG9zZTogNCwKICBXU1RleHRTdGFydDogNSwKICBXU0JpbmFyeVN0YXJ0OiA2LAogIFdTRGF0YUNodW5rOiA3LAogIFdTRGF0YUVuZDogOCwKICBXU0Vycm9yOiA5Cn07CmNvbnN0IE1BWF9DSFVOS19TSVpFID0gMTIgKiAxMDI0Owpjb25zdCBTMkNfSEVMTE9fT0sgPSAiOjMiOwpjb25zdCBDMlNfSEVMTE8gPSAiaGFpaWkgIjsKY29uc3QgUzJDX0hFTExPX0VSUiA9ICI6PCAiOwpjb25zdCBQUk9UT0NPTF9WRVJTSU9OJDEgPSAiMy4wIjsKCmNvbnN0IE5VTExfQk9EWV9TVEFUVVNFUyA9IFsxMDEsIDEwMywgMjA0LCAyMDUsIDMwNF07CmZ1bmN0aW9uIGNyZWF0ZUJvZHlTdHJlYW0oYm9keSwgYXJyYXlCdWZmZXJJbXBsKSB7CiAgaWYgKGJvZHkgPT09IG51bGwgfHwgdHlwZW9mIGJvZHkgPT09ICJ1bmRlZmluZWQiKQogICAgcmV0dXJuIG51bGw7CiAgaWYgKHR5cGVvZiBib2R5ID09PSAic3RyaW5nIikgewogICAgYm9keSA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShib2R5KTsKICB9CiAgaWYgKHdpbmRvdy5BcnJheUJ1ZmZlci5pc1ZpZXcoYm9keSkpIHsKICAgIGJvZHkgPSBib2R5LmJ1ZmZlci5zbGljZSgKICAgICAgYm9keS5ieXRlT2Zmc2V0LAogICAgICBib2R5LmJ5dGVPZmZzZXQgKyBib2R5LmJ5dGVMZW5ndGgKICAgICk7CiAgfQogIGlmIChib2R5IGluc3RhbmNlb2Ygd2luZG93LkFycmF5QnVmZmVyKSB7CiAgICBpZiAoYm9keS5ieXRlTGVuZ3RoID09IDApIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBsZXQgcmVtYWluaW5nID0gYm9keTsKICAgIHJldHVybiBuZXcgUmVhZGFibGVTdHJlYW0oewogICAgICB0eXBlOiAiYnl0ZXMiLAogICAgICBwdWxsOiAoY29udHJvbGxlcikgPT4gewogICAgICAgIGlmIChyZW1haW5pbmcuYnl0ZUxlbmd0aCA8PSAwKSB7CiAgICAgICAgICByZXR1cm4gY29udHJvbGxlci5jbG9zZSgpOwogICAgICAgIH0KICAgICAgICBjb25zdCBjdXJyZW50ID0gcmVtYWluaW5nLnNsaWNlKDAsIE1BWF9DSFVOS19TSVpFKTsKICAgICAgICByZW1haW5pbmcgPSByZW1haW5pbmcuc2xpY2UoTUFYX0NIVU5LX1NJWkUpOwogICAgICAgIGNvbnRyb2xsZXIuZW5xdWV1ZShuZXcgVWludDhBcnJheShjdXJyZW50KSk7CiAgICAgIH0KICAgIH0pOwogIH0KICBpZiAoYm9keSBpbnN0YW5jZW9mIEZvcm1EYXRhKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoImZvcm1kYXRhIHRvZG8iKTsKICB9CiAgY29uc3QgdHJhbnNmb3JtZXIgPSAoKSA9PiBuZXcgVHJhbnNmb3JtU3RyZWFtKHsKICAgIHRyYW5zZm9ybTogYXN5bmMgKGNodW5rLCBjb250cm9sbGVyKSA9PiB7CiAgICAgIGlmICh0eXBlb2YgY2h1bmsgPT09ICJzdHJpbmciKSB7CiAgICAgICAgY2h1bmsgPSBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoY2h1bmspOwogICAgICB9CiAgICAgIGlmIChjaHVuayBpbnN0YW5jZW9mIEJsb2IpIHsKICAgICAgICBjaHVuayA9IGF3YWl0IGNodW5rLmFycmF5QnVmZmVyKCk7CiAgICAgIH0KICAgICAgaWYgKHdpbmRvdy5BcnJheUJ1ZmZlci5pc1ZpZXcoY2h1bmspKSB7CiAgICAgICAgY2h1bmsgPSBjaHVuay5idWZmZXIuc2xpY2UoCiAgICAgICAgICBjaHVuay5ieXRlT2Zmc2V0LAogICAgICAgICAgY2h1bmsuYnl0ZU9mZnNldCArIGNodW5rLmJ5dGVMZW5ndGgKICAgICAgICApOwogICAgICB9CiAgICAgIGlmICghKGNodW5rIGluc3RhbmNlb2Ygd2luZG93LkFycmF5QnVmZmVyKSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoeyBjaHVuayB9KTsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgdHlwZSByZWFkIGZyb20gYm9keSBzdHJlYW06ICIgKyBjaHVuayk7CiAgICAgIH0KICAgICAgbGV0IGN1cnJlbnQgPSBudWxsOwogICAgICBsZXQgcmVtYWluaW5nID0gY2h1bms7CiAgICAgIGRvIHsKICAgICAgICBjdXJyZW50ID0gcmVtYWluaW5nLnNsaWNlKDAsIE1BWF9DSFVOS19TSVpFKTsKICAgICAgICByZW1haW5pbmcgPSByZW1haW5pbmcuc2xpY2UoTUFYX0NIVU5LX1NJWkUpOwogICAgICAgIGNvbnRyb2xsZXIuZW5xdWV1ZShuZXcgVWludDhBcnJheShjdXJyZW50KSk7CiAgICAgIH0gd2hpbGUgKHJlbWFpbmluZy5ieXRlTGVuZ3RoID4gMCk7CiAgICB9CiAgfSk7CiAgaWYgKGJvZHkgaW5zdGFuY2VvZiBSZWFkYWJsZVN0cmVhbSkgewogICAgcmV0dXJuIGJvZHkucGlwZVRocm91Z2godHJhbnNmb3JtZXIoKSk7CiAgfQogIGlmIChib2R5IGluc3RhbmNlb2YgQmxvYikgewogICAgcmV0dXJuIGJvZHkuc3RyZWFtKCkucGlwZVRocm91Z2godHJhbnNmb3JtZXIoKSk7CiAgfQogIHRocm93IG5ldyBFcnJvcigiVW5leHBlY3RlZCBib2R5IHR5cGU6ICIgKyBib2R5KTsKfQpjbGFzcyBBZHJpZnRCYXJlQ2xpZW50IGV4dGVuZHMgQ2xpZW50IHsKICBjb25zdHJ1Y3Rvcihjb25uZWN0aW9uKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5jb25uZWN0aW9uID0gY29ubmVjdGlvbjsKICB9CiAgYXN5bmMgcmVxdWVzdChtZXRob2QsIHJlcXVlc3RIZWFkZXJzLCBib2R5LCByZW1vdGUsIGNhY2hlLCBkdXBsZXgsIHNpZ25hbCwgYXJyYXlCdWZmZXJJbXBsKSB7CiAgICBjb25zdCBib2R5U3RyZWFtID0gY3JlYXRlQm9keVN0cmVhbShib2R5KTsKICAgIGxldCB7IHBheWxvYWQsIGJvZHk6IHJlc3BSYXdCb2R5IH0gPSBhd2FpdCB0aGlzLmNvbm5lY3Rpb24uaHR0cHJlcXVlc3QoCiAgICAgIHsKICAgICAgICBtZXRob2QsCiAgICAgICAgcmVxdWVzdEhlYWRlcnMsCiAgICAgICAgcmVtb3RlCiAgICAgIH0sCiAgICAgIGJvZHlTdHJlYW0KICAgICk7CiAgICBjb25zdCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoKTsKICAgIGZvciAoY29uc3QgW2hlYWRlciwgdmFsdWVzXSBvZiBPYmplY3QuZW50cmllcyhwYXlsb2FkLmhlYWRlcnMpKSB7CiAgICAgIGZvciAoY29uc3QgdmFsdWUgb2YgdmFsdWVzKSB7CiAgICAgICAgaGVhZGVycy5hcHBlbmQoaGVhZGVyLCB2YWx1ZSk7CiAgICAgIH0KICAgIH0KICAgIGxldCByZXNwQm9keSA9IHJlc3BSYXdCb2R5OwogICAgaWYgKHJlc3BCb2R5LmJ5dGVMZW5ndGggPT0gMCB8fCBOVUxMX0JPRFlfU1RBVFVTRVMuaW5jbHVkZXMocGF5bG9hZC5zdGF0dXMpKSB7CiAgICAgIHJlc3BCb2R5ID0gbnVsbDsKICAgIH0KICAgIHJldHVybiBuZXcgUmVzcG9uc2UocmVzcEJvZHksIHsKICAgICAgc3RhdHVzOiBwYXlsb2FkLnN0YXR1cywKICAgICAgc3RhdHVzVGV4dDogcGF5bG9hZC5zdGF0dXNUZXh0LAogICAgICBoZWFkZXJzCiAgICB9KTsKICB9CiAgY29ubmVjdChyZW1vdGUsIHByb3RvY29scywgZ2V0UmVxdWVzdEhlYWRlcnMsIG9uTWV0YSwgb25SZWFkeVN0YXRlLCB3ZWJTb2NrZXRJbXBsLCBhcnJheUJ1ZmZlckltcGwpIHsKICAgIGNvbnN0IHdzID0gbmV3IHdlYlNvY2tldEltcGwoIndzczpudWxsIiwgcHJvdG9jb2xzKTsKICAgIGxldCBpbml0YWxDbG9zZUhhcHBlbmVkID0gZmFsc2U7CiAgICB3cy5hZGRFdmVudExpc3RlbmVyKCJjbG9zZSIsIChlKSA9PiB7CiAgICAgIGlmICghaW5pdGFsQ2xvc2VIYXBwZW5lZCkgewogICAgICAgIG9uUmVhZHlTdGF0ZShXZWJTb2NrZXQuQ09OTkVDVElORyk7CiAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKICAgICAgICBpbml0YWxDbG9zZUhhcHBlbmVkID0gdHJ1ZTsKICAgICAgfQogICAgfSk7CiAgICBsZXQgaW5pdGlhbEVycm9ySGFwcGVuZWQgPSBmYWxzZTsKICAgIHdzLmFkZEV2ZW50TGlzdGVuZXIoImVycm9yIiwgKGUpID0+IHsKICAgICAgaWYgKCFpbml0aWFsRXJyb3JIYXBwZW5lZCkgewogICAgICAgIG9uUmVhZHlTdGF0ZShXZWJTb2NrZXQuQ09OTkVDVElORyk7CiAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKICAgICAgICBpbml0aWFsRXJyb3JIYXBwZW5lZCA9IHRydWU7CiAgICAgIH0KICAgIH0pOwogICAgbGV0IHsgc2VuZCwgY2xvc2UgfSA9IHRoaXMuY29ubmVjdGlvbi53c2Nvbm5lY3QoCiAgICAgIHJlbW90ZSwKICAgICAgcHJvdG9jb2xzLAogICAgICAocHJvdG9jb2wpID0+IHsKICAgICAgICBvblJlYWR5U3RhdGUoV2ViU29ja2V0Lk9QRU4pOwogICAgICAgIHdzLl9fZGVmaW5lR2V0dGVyX18oInByb3RvY29sIiwgKCkgPT4gewogICAgICAgICAgcmV0dXJuIHByb3RvY29sOwogICAgICAgIH0pOwogICAgICAgIHdzLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJvcGVuIikpOwogICAgICB9LAogICAgICAoY29kZSwgcmVhc29uLCB3YXNDbGVhbikgPT4gewogICAgICAgIG9uUmVhZHlTdGF0ZShXZWJTb2NrZXQuQ0xPU0VEKTsKICAgICAgICB3cy5kaXNwYXRjaEV2ZW50KG5ldyBDbG9zZUV2ZW50KCJjbG9zZSIsIHsgY29kZSwgcmVhc29uLCB3YXNDbGVhbiB9KSk7CiAgICAgIH0sCiAgICAgIGFzeW5jIChzdHJlYW0sIGlzQmluYXJ5KSA9PiB7CiAgICAgICAgbGV0IGRhdGEgPSBhd2FpdCBuZXcgUmVzcG9uc2UoCiAgICAgICAgICBzdHJlYW0KICAgICAgICApLmFycmF5QnVmZmVyKCk7CiAgICAgICAgZGF0YS5fX3Byb3RvX18gPSBhcnJheUJ1ZmZlckltcGwucHJvdG90eXBlOwogICAgICAgIGlmICghaXNCaW5hcnkpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGRhdGEgPSBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUoKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB3cy5kaXNwYXRjaEV2ZW50KG5ldyBNZXNzYWdlRXZlbnQoIm1lc3NhZ2UiLCB7IGRhdGEgfSkpOwogICAgICB9LAogICAgICAobWVzc2FnZSkgPT4gewogICAgICAgIGNvbnNvbGUubG9nKHsgbWVzc2FnZSB9KTsKICAgICAgICB3cy5kaXNwYXRjaEV2ZW50KG5ldyBFcnJvckV2ZW50KCJlcnJvciIsIHsgbWVzc2FnZSB9KSk7CiAgICAgIH0sCiAgICAgIGFycmF5QnVmZmVySW1wbAogICAgKTsKICAgIHdzLnNlbmQgPSAoZGF0YSkgPT4gewogICAgICBzZW5kKGRhdGEpOwogICAgfTsKICAgIHdzLmNsb3NlID0gKGNvZGUsIHJlYXNvbikgPT4gewogICAgICBjbG9zZShjb2RlLCByZWFzb24pOwogICAgICBvblJlYWR5U3RhdGUoV2ViU29ja2V0LkNMT1NJTkcpOwogICAgfTsKICAgIHJldHVybiB3czsKICB9Cn0KClJlYWRhYmxlU3RyZWFtLnByb3RvdHlwZVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0gPSBhc3luYyBmdW5jdGlvbiogKCkgewogIGNvbnN0IHJlYWRlciA9IHRoaXMuZ2V0UmVhZGVyKCk7CiAgdHJ5IHsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGNvbnN0IHsgZG9uZSwgdmFsdWUgfSA9IGF3YWl0IHJlYWRlci5yZWFkKCk7CiAgICAgIGlmIChkb25lKQogICAgICAgIHJldHVybjsKICAgICAgeWllbGQgdmFsdWU7CiAgICB9CiAgfSBmaW5hbGx5IHsKICAgIHJlYWRlci5yZWxlYXNlTG9jaygpOwogIH0KfTsKbGV0IENvbm5lY3Rpb24kMSA9IGNsYXNzIENvbm5lY3Rpb24gewogIGNvbnN0cnVjdG9yKHRyYW5zcG9ydCkgewogICAgdGhpcy50cmFuc3BvcnQgPSB0cmFuc3BvcnQ7CiAgICB0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7CiAgICB0aGlzLnJlcXVlc3RDYWxsYmFja3MgPSB7fTsKICAgIHRoaXMub3BlblJlcXVlc3RTdHJlYW1zID0ge307CiAgICB0aGlzLm9wZW5pbmdTb2NrZXRzID0ge307CiAgICB0aGlzLm9wZW5Tb2NrZXRzID0ge307CiAgICB0aGlzLndzTXNnU3RyZWFtcyA9IHt9OwogICAgdGhpcy5jb3VudGVyID0gMDsKICAgIHRyYW5zcG9ydC5vbmRhdGEgPSBDb25uZWN0aW9uLnVuaW5pdGlhbGl6ZWRFcnJvcjsKICB9CiAgc3RhdGljIHVuaW5pdGlhbGl6ZWRFcnJvcigpIHsKICAgIHRocm93IG5ldyBFcnJvcigiQ29ubmVjdGlvbiBub3QgaW5pdGlhbGl6ZWQiKTsKICB9CiAgYXN5bmMgaW5pdGlhbGl6ZSgpIHsKICAgIGNvbnN0IG9uRGF0YVByb21pc2UgPSAoKSA9PiB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzKSA9PiB7CiAgICAgICAgdGhpcy50cmFuc3BvcnQub25kYXRhID0gcmVzOwogICAgICB9KTsKICAgIH07CiAgICB0aGlzLnRyYW5zcG9ydC5zZW5kKG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShDMlNfSEVMTE8gKyBQUk9UT0NPTF9WRVJTSU9OJDEpKTsKICAgIGNvbnN0IG1zZyA9IGF3YWl0IG9uRGF0YVByb21pc2UoKTsKICAgIGNvbnN0IG1zZ1RleHQgPSBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUobXNnKTsKICAgIGlmIChtc2dUZXh0ID09PSBTMkNfSEVMTE9fT0spIHsKICAgICAgdGhpcy50cmFuc3BvcnQub25kYXRhID0gdGhpcy5vbmRhdGEuYmluZCh0aGlzKTsKICAgICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7CiAgICB9IGVsc2UgaWYgKG1zZ1RleHQuc3RhcnRzV2l0aChTMkNfSEVMTE9fRVJSKSkgewogICAgICBjb25zdCBleHBlY3RlZFZlcnNpb24gPSBtc2dUZXh0LnNsaWNlKFMyQ19IRUxMT19FUlIubGVuZ3RoKTsKICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgIGBXZSBhcmUgcnVubmluZyBwcm90b2NvbCB2ZXJzaW9uICR7UFJPVE9DT0xfVkVSU0lPTiQxfSwgYnV0IHNlcnZlciBleHBlY3RlZCAke2V4cGVjdGVkVmVyc2lvbn1gCiAgICAgICk7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIlVuZXhwZWN0ZWQgc2VydmVyIGhlbGxvIHJlc3BvbnNlIik7CiAgICB9CiAgfQogIG5leHRTZXEoKSB7CiAgICByZXR1cm4gKyt0aGlzLmNvdW50ZXI7CiAgfQogIG9uZGF0YShkYXRhKSB7CiAgICBpZiAoIXRoaXMuaW5pdGlhbGl6ZWQpCiAgICAgIHJldHVybjsKICAgIGxldCBjdXJzb3IgPSAwOwogICAgY29uc3QgdmlldyA9IG5ldyBEYXRhVmlldyhkYXRhKTsKICAgIGxldCByZXF1ZXN0SUQgPSB2aWV3LmdldFVpbnQxNihjdXJzb3IpOwogICAgY3Vyc29yICs9IDI7CiAgICBsZXQgcmVxdWVzdFR5cGUgPSB2aWV3LmdldFVpbnQ4KGN1cnNvcik7CiAgICBjdXJzb3IgKz0gMTsKICAgIGNvbnN0IG1zZ1RleHQgPSAoKSA9PiBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUoZGF0YS5zbGljZShjdXJzb3IpKTsKICAgIGNvbnN0IG1zZ0pTT04gPSAoKSA9PiBKU09OLnBhcnNlKG1zZ1RleHQoKSk7CiAgICBzd2l0Y2ggKHJlcXVlc3RUeXBlKSB7CiAgICAgIGNhc2UgUzJDUmVxdWVzdFR5cGVzLkhUVFBSZXNwb25zZVN0YXJ0OgogICAgICAgIGNvbnN0IHBheWxvYWQgPSBtc2dKU09OKCk7CiAgICAgICAgY29uc3Qgc3RyZWFtID0gbmV3IFJlYWRhYmxlU3RyZWFtKHsKICAgICAgICAgIHN0YXJ0OiAoY29udHJvbGxlcikgPT4gewogICAgICAgICAgICB0aGlzLm9wZW5SZXF1ZXN0U3RyZWFtc1tyZXF1ZXN0SURdID0gY29udHJvbGxlcjsKICAgICAgICAgIH0sCiAgICAgICAgICBwdWxsOiAoY29udHJvbGxlcikgPT4gewogICAgICAgICAgfSwKICAgICAgICAgIGNhbmNlbDogKCkgPT4gewogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMucmVxdWVzdENhbGxiYWNrc1tyZXF1ZXN0SURdKHsgcGF5bG9hZCwgYm9keTogc3RyZWFtIH0pOwogICAgICAgIGRlbGV0ZSB0aGlzLnJlcXVlc3RDYWxsYmFja3NbcmVxdWVzdElEXTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBTMkNSZXF1ZXN0VHlwZXMuSFRUUFJlc3BvbnNlQ2h1bms6CiAgICAgICAgdGhpcy5vcGVuUmVxdWVzdFN0cmVhbXNbcmVxdWVzdElEXT8uZW5xdWV1ZSgKICAgICAgICAgIG5ldyBVaW50OEFycmF5KGRhdGEuc2xpY2UoY3Vyc29yKSkKICAgICAgICApOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFMyQ1JlcXVlc3RUeXBlcy5IVFRQUmVzcG9uc2VFbmQ6CiAgICAgICAgdGhpcy5vcGVuUmVxdWVzdFN0cmVhbXNbcmVxdWVzdElEXT8uY2xvc2UoKTsKICAgICAgICBkZWxldGUgdGhpcy5vcGVuUmVxdWVzdFN0cmVhbXNbcmVxdWVzdElEXTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBTMkNSZXF1ZXN0VHlwZXMuV1NPcGVuOiB7CiAgICAgICAgY29uc3Qgc29ja2V0TWV0YSA9IHRoaXMub3BlbmluZ1NvY2tldHNbcmVxdWVzdElEXTsKICAgICAgICBpZiAoIXNvY2tldE1ldGEpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgY29uc3QgcGF5bG9hZDIgPSBtc2dKU09OKCk7CiAgICAgICAgZGVsZXRlIHRoaXMub3BlbmluZ1NvY2tldHNbcmVxdWVzdElEXTsKICAgICAgICB0aGlzLm9wZW5Tb2NrZXRzW3JlcXVlc3RJRF0gPSBzb2NrZXRNZXRhOwogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gc29ja2V0TWV0YS5vbm9wZW4ocGF5bG9hZDIucHJvdG9jb2wpKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjYXNlIFMyQ1JlcXVlc3RUeXBlcy5XU0JpbmFyeVN0YXJ0OgogICAgICBjYXNlIFMyQ1JlcXVlc3RUeXBlcy5XU1RleHRTdGFydDogewogICAgICAgIGNvbnN0IHNvY2tldE1ldGEgPSB0aGlzLm9wZW5Tb2NrZXRzW3JlcXVlc3RJRF07CiAgICAgICAgaWYgKCFzb2NrZXRNZXRhKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIGNvbnN0IHN0cmVhbTIgPSBuZXcgUmVhZGFibGVTdHJlYW0oewogICAgICAgICAgc3RhcnQ6IChjb250cm9sbGVyKSA9PiB7CiAgICAgICAgICAgIHRoaXMud3NNc2dTdHJlYW1zW3JlcXVlc3RJRF0gPSBjb250cm9sbGVyOwogICAgICAgICAgfSwKICAgICAgICAgIHB1bGw6IChjb25zdHJvbGxlcikgPT4gewogICAgICAgICAgfSwKICAgICAgICAgIGNhbmNlbDogKCkgPT4gewogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHNldFRpbWVvdXQoCiAgICAgICAgICAoKSA9PiBzb2NrZXRNZXRhLm9ubWVzc2FnZSgKICAgICAgICAgICAgc3RyZWFtMiwKICAgICAgICAgICAgcmVxdWVzdFR5cGUgPT09IFMyQ1JlcXVlc3RUeXBlcy5XU0JpbmFyeVN0YXJ0ID8gdHJ1ZSA6IHJlcXVlc3RUeXBlID09PSBTMkNSZXF1ZXN0VHlwZXMuV1NUZXh0U3RhcnQgPyBmYWxzZSA6ICgoKSA9PiB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ1bnJlYWNoYWJsZSIpOwogICAgICAgICAgICB9KSgpCiAgICAgICAgICApCiAgICAgICAgKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjYXNlIFMyQ1JlcXVlc3RUeXBlcy5XU0RhdGFDaHVuazogewogICAgICAgIGNvbnN0IHN0cmVhbTIgPSB0aGlzLndzTXNnU3RyZWFtc1tyZXF1ZXN0SURdOwogICAgICAgIHN0cmVhbTI/LmVucXVldWUobmV3IFVpbnQ4QXJyYXkoZGF0YS5zbGljZShjdXJzb3IpKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgY2FzZSBTMkNSZXF1ZXN0VHlwZXMuV1NEYXRhRW5kOiB7CiAgICAgICAgY29uc3Qgc3RyZWFtMiA9IHRoaXMud3NNc2dTdHJlYW1zW3JlcXVlc3RJRF07CiAgICAgICAgc3RyZWFtMj8uY2xvc2UoKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjYXNlIFMyQ1JlcXVlc3RUeXBlcy5XU0Nsb3NlOiB7CiAgICAgICAgY29uc3Qgc29ja2V0TWV0YSA9IHRoaXMub3BlbmluZ1NvY2tldHNbcmVxdWVzdElEXSB8fCB0aGlzLm9wZW5Tb2NrZXRzW3JlcXVlc3RJRF07CiAgICAgICAgaWYgKCFzb2NrZXRNZXRhKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIGNvbnN0IHBheWxvYWQyID0gbXNnSlNPTigpOwogICAgICAgIHNldFRpbWVvdXQoCiAgICAgICAgICAoKSA9PiBzb2NrZXRNZXRhLm9uY2xvc2UoCiAgICAgICAgICAgIHBheWxvYWQyLmNvZGUgfHwgMTAwNSwKICAgICAgICAgICAgcGF5bG9hZDIucmVhc29uIHx8ICIiLAogICAgICAgICAgICAid2FzQ2xlYW4iIGluIHBheWxvYWQyID8gQm9vbGVhbihwYXlsb2FkMi53YXNDbGVhbikgOiBmYWxzZQogICAgICAgICAgKQogICAgICAgICk7CiAgICAgICAgZGVsZXRlIHRoaXMub3BlbmluZ1NvY2tldHNbcmVxdWVzdElEXTsKICAgICAgICBkZWxldGUgdGhpcy5vcGVuU29ja2V0c1tyZXF1ZXN0SURdOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGNhc2UgUzJDUmVxdWVzdFR5cGVzLldTRXJyb3I6IHsKICAgICAgICBjb25zdCBzb2NrZXRNZXRhID0gdGhpcy5vcGVuaW5nU29ja2V0c1tyZXF1ZXN0SURdIHx8IHRoaXMub3BlblNvY2tldHNbcmVxdWVzdElEXTsKICAgICAgICBpZiAoIXNvY2tldE1ldGEpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgY29uc3QgcGF5bG9hZDIgPSBtc2dKU09OKCk7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiBzb2NrZXRNZXRhLm9uZXJyb3IocGF5bG9hZDIubWVzc2FnZSkpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfQogIGFzeW5jIHNlbmQocmVxdWVzdElELCB0eXBlLCBkYXRhKSB7CiAgICBpZiAoIXRoaXMuaW5pdGlhbGl6ZWQpIHsKICAgICAgQ29ubmVjdGlvbi51bmluaXRpYWxpemVkRXJyb3IoKTsKICAgIH0KICAgIGxldCBoZWFkZXIgPSBuZXcgd2luZG93LkFycmF5QnVmZmVyKDIgKyAxKTsKICAgIGxldCB2aWV3ID0gbmV3IERhdGFWaWV3KGhlYWRlcik7CiAgICBsZXQgY3Vyc29yID0gMDsKICAgIHZpZXcuc2V0VWludDE2KGN1cnNvciwgcmVxdWVzdElEKTsKICAgIGN1cnNvciArPSAyOwogICAgdmlldy5zZXRVaW50OChjdXJzb3IsIHR5cGUpOwogICAgY3Vyc29yICs9IDE7CiAgICBsZXQgYnVmID0gaGVhZGVyOwogICAgaWYgKGRhdGEpIHsKICAgICAgYnVmID0gYXdhaXQgbmV3IEJsb2IoW2hlYWRlciwgZGF0YV0pLmFycmF5QnVmZmVyKCk7CiAgICB9CiAgICB0aGlzLnRyYW5zcG9ydC5zZW5kKGJ1Zik7CiAgfQogIGh0dHByZXF1ZXN0KGRhdGEsIGJvZHkpIHsKICAgIGlmICghdGhpcy5pbml0aWFsaXplZCkgewogICAgICBDb25uZWN0aW9uLnVuaW5pdGlhbGl6ZWRFcnJvcigpOwogICAgfQogICAgY29uc3QgcGF5bG9hZCA9IHsgLi4uZGF0YSwgaGFzQm9keTogQm9vbGVhbihib2R5KSB9OwogICAgbGV0IGpzb24gPSBKU09OLnN0cmluZ2lmeShwYXlsb2FkKTsKICAgIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSkgPT4gewogICAgICBsZXQgc2VxID0gdGhpcy5uZXh0U2VxKCk7CiAgICAgIHRoaXMucmVxdWVzdENhbGxiYWNrc1tzZXFdID0gcmVzb2x2ZTsKICAgICAgYXdhaXQgdGhpcy5zZW5kKHNlcSwgQzJTUmVxdWVzdFR5cGVzLkhUVFBSZXF1ZXN0U3RhcnQsIG5ldyBCbG9iKFtqc29uXSkpOwogICAgICBpZiAocGF5bG9hZC5oYXNCb2R5KSB7CiAgICAgICAgZm9yIGF3YWl0IChjb25zdCBjaHVuayBvZiBib2R5KSB7CiAgICAgICAgICBhd2FpdCB0aGlzLnNlbmQoCiAgICAgICAgICAgIHNlcSwKICAgICAgICAgICAgQzJTUmVxdWVzdFR5cGVzLkhUVFBSZXF1ZXN0Q2h1bmssCiAgICAgICAgICAgIG5ldyBVaW50OEFycmF5KGNodW5rKQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgYXdhaXQgdGhpcy5zZW5kKHNlcSwgQzJTUmVxdWVzdFR5cGVzLkhUVFBSZXF1ZXN0RW5kKTsKICAgICAgfQogICAgfSk7CiAgfQogIHdzY29ubmVjdCh1cmwsIHByb3RvY29scywgb25vcGVuLCBvbmNsb3NlLCBvbm1lc3NhZ2UsIG9uZXJyb3IsIGFycmF5QnVmZmVySW1wbCkgewogICAgaWYgKCF0aGlzLmluaXRpYWxpemVkKSB7CiAgICAgIENvbm5lY3Rpb24udW5pbml0aWFsaXplZEVycm9yKCk7CiAgICB9CiAgICBjb25zdCBwYXlsb2FkID0geyB1cmw6IHVybC50b1N0cmluZygpLCBwcm90b2NvbHMgfTsKICAgIGNvbnN0IHBheWxvYWRKU09OID0gSlNPTi5zdHJpbmdpZnkocGF5bG9hZCk7CiAgICBsZXQgc2VxID0gdGhpcy5uZXh0U2VxKCk7CiAgICBjb25zdCBjbG9zZVdpdGhFcnJvciA9ICgpID0+IG9uY2xvc2UoMTAwNiwgIiIsIGZhbHNlKTsKICAgIHRoaXMuc2VuZCgKICAgICAgc2VxLAogICAgICBDMlNSZXF1ZXN0VHlwZXMuV1NPcGVuLAogICAgICBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUocGF5bG9hZEpTT04pCiAgICApLmNhdGNoKChlKSA9PiB7CiAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgIGNsb3NlV2l0aEVycm9yKCk7CiAgICB9KTsKICAgIHRoaXMub3BlbmluZ1NvY2tldHNbc2VxXSA9IHsKICAgICAgb25vcGVuLAogICAgICBvbm1lc3NhZ2UsCiAgICAgIG9uY2xvc2UsCiAgICAgIG9uZXJyb3IKICAgIH07CiAgICByZXR1cm4gewogICAgICBzZW5kOiAoZGF0YSkgPT4gewogICAgICAgIGlmICghdGhpcy5vcGVuU29ja2V0c1tzZXFdKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInNlbmQgb24gY2xvc2VkIHNvY2tldCIpOwogICAgICAgIH0KICAgICAgICBjb25zdCBjbGVhbnVwID0gKGUpID0+IHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgICAgICBkZWxldGUgdGhpcy5vcGVuU29ja2V0c1tzZXFdOwogICAgICAgIH07CiAgICAgICAgaWYgKHR5cGVvZiBkYXRhID09PSAic3RyaW5nIikgewogICAgICAgICAgdGhpcy5zZW5kKAogICAgICAgICAgICBzZXEsCiAgICAgICAgICAgIEMyU1JlcXVlc3RUeXBlcy5XU1NlbmRUZXh0LAogICAgICAgICAgICBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoZGF0YSkKICAgICAgICAgICkuY2F0Y2goY2xlYW51cCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChkYXRhIGluc3RhbmNlb2YgYXJyYXlCdWZmZXJJbXBsKSB7CiAgICAgICAgICB0aGlzLnNlbmQoc2VxLCBDMlNSZXF1ZXN0VHlwZXMuV1NTZW5kQmluYXJ5LCBkYXRhKS5jYXRjaChjbGVhbnVwKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKGFycmF5QnVmZmVySW1wbC5pc1ZpZXcoZGF0YSkpIHsKICAgICAgICAgIHRoaXMuc2VuZCgKICAgICAgICAgICAgc2VxLAogICAgICAgICAgICBDMlNSZXF1ZXN0VHlwZXMuV1NTZW5kQmluYXJ5LAogICAgICAgICAgICBkYXRhLmJ1ZmZlci5zbGljZSgKICAgICAgICAgICAgICBkYXRhLmJ5dGVPZmZzZXQsCiAgICAgICAgICAgICAgZGF0YS5ieXRlT2Zmc2V0ICsgZGF0YS5ieXRlTGVuZ3RoCiAgICAgICAgICAgICkKICAgICAgICAgICkuY2F0Y2goY2xlYW51cCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnNvbGUuZXJyb3IoeyBkYXRhIH0pOwogICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5leHBlY3RlZCB0eXBlIHBhc3NlZCB0byBzZW5kIik7CiAgICAgIH0sCiAgICAgIGNsb3NlOiAoY29kZSwgcmVhc29uKSA9PiB7CiAgICAgICAgY29uc3QgcGF5bG9hZDIgPSB7IGNvZGUsIHJlYXNvbiB9OwogICAgICAgIGNvbnN0IHBheWxvYWRKU09OMiA9IEpTT04uc3RyaW5naWZ5KHBheWxvYWQyKTsKICAgICAgICB0aGlzLnNlbmQoCiAgICAgICAgICBzZXEsCiAgICAgICAgICBDMlNSZXF1ZXN0VHlwZXMuV1NDbG9zZSwKICAgICAgICAgIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShwYXlsb2FkSlNPTjIpCiAgICAgICAgKS5jYXRjaCgoZSkgPT4gewogICAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICB9KTsKICAgICAgICBkZWxldGUgdGhpcy5vcGVuU29ja2V0c1tzZXFdOwogICAgICB9CiAgICB9OwogIH0KfTsKCmNsYXNzIERldldzVHJhbnNwb3J0IGV4dGVuZHMgVHJhbnNwb3J0IHsKICBjb25zdHJ1Y3Rvcihvbm9wZW4sIG9uY2xvc2UpIHsKICAgIHN1cGVyKG9ub3Blbiwgb25jbG9zZSk7CiAgICB0aGlzLndzID0gbmV3IFdlYlNvY2tldCgid3M6Ly9sb2NhbGhvc3Q6MzAwMC9kZXYtd3MiKTsKICAgIHRoaXMud3MuYmluYXJ5VHlwZSA9ICJhcnJheWJ1ZmZlciI7CiAgICB0aGlzLndzLm9ub3BlbiA9IG9ub3BlbjsKICAgIHRoaXMud3Mub25jbG9zZSA9IG9uY2xvc2U7CiAgICB0aGlzLndzLm9ubWVzc2FnZSA9IHRoaXMub25tZXNzYWdlLmJpbmQodGhpcyk7CiAgfQogIG9ubWVzc2FnZShtc2cpIHsKICAgIGlmIChtc2cuZGF0YSBpbnN0YW5jZW9mIHdpbmRvdy5BcnJheUJ1ZmZlcikgewogICAgICB0aGlzLm9uZGF0YShtc2cuZGF0YSk7CiAgICAgIHJldHVybjsKICAgIH0KICB9CiAgc2VuZChkYXRhKSB7CiAgICB0aGlzLndzLnNlbmQoZGF0YSk7CiAgfQogIGNsb3NlKCkgewogICAgdGhpcy53cy5jbG9zZSgpOwogIH0KfQoKY29uc3QgcnRjQ29uZiA9IHsKICBpY2VTZXJ2ZXJzOiBbCiAgICB7CiAgICAgIHVybHM6ICJzdHVuOnN0dW4ubC5nb29nbGUuY29tOjE5MzAyIgogICAgfQogIF0KfTsKY2xhc3MgUlRDVHJhbnNwb3J0IGV4dGVuZHMgVHJhbnNwb3J0IHsKICBjb25zdHJ1Y3Rvcihvbm9wZW4sIG9uY2xvc2UsIG9uY29ubmVjdGlvbnN0YXRlY2hhbmdlLCBvbnNpZ25hbGluZ3N0YXRlY2hhbmdlLCBvbmljZWdhdGhlcmluZ3N0YXRlY2hhbmdlKSB7CiAgICBzdXBlcihvbm9wZW4sIG9uY2xvc2UpOwogICAgdGhpcy5vbm9wZW4gPSBvbm9wZW47CiAgICB0aGlzLm9uY2xvc2UgPSBvbmNsb3NlOwogICAgdGhpcy5vbmNvbm5lY3Rpb25zdGF0ZWNoYW5nZSA9IG9uY29ubmVjdGlvbnN0YXRlY2hhbmdlOwogICAgdGhpcy5vbnNpZ25hbGluZ3N0YXRlY2hhbmdlID0gb25zaWduYWxpbmdzdGF0ZWNoYW5nZTsKICAgIHRoaXMub25pY2VnYXRoZXJpbmdzdGF0ZWNoYW5nZSA9IG9uaWNlZ2F0aGVyaW5nc3RhdGVjaGFuZ2U7CiAgICB0aGlzLnBlZXIgPSBuZXcgUlRDUGVlckNvbm5lY3Rpb24ocnRjQ29uZik7CiAgICB0aGlzLnBlZXIub25jb25uZWN0aW9uc3RhdGVjaGFuZ2UgPSBvbmNvbm5lY3Rpb25zdGF0ZWNoYW5nZTsKICAgIHRoaXMucGVlci5vbnNpZ25hbGluZ3N0YXRlY2hhbmdlID0gb25zaWduYWxpbmdzdGF0ZWNoYW5nZTsKICAgIHRoaXMucGVlci5vbmljZWNvbm5lY3Rpb25zdGF0ZWNoYW5nZSA9IChldmVudCkgPT4gewogICAgICBjb25zb2xlLmxvZygiSUNFIGNvbm5lY3Rpb24gc3RhdGU6IiwgdGhpcy5wZWVyLmljZUNvbm5lY3Rpb25TdGF0ZSk7CiAgICAgIGlmICh0aGlzLnBlZXIuaWNlQ29ubmVjdGlvblN0YXRlID09ICJkaXNjb25uZWN0ZWQiIHx8IHRoaXMucGVlci5pY2VDb25uZWN0aW9uU3RhdGUgPT0gImZhaWxlZCIpIHsKICAgICAgICBjb25zb2xlLmxvZygiZGlzY29ubmVjdGVkIik7CiAgICAgICAgb25jbG9zZSgpOwogICAgICB9CiAgICB9OwogICAgdGhpcy5wZWVyLm9uaWNlZ2F0aGVyaW5nc3RhdGVjaGFuZ2UgPSBvbmljZWdhdGhlcmluZ3N0YXRlY2hhbmdlOwogICAgdGhpcy5kYXRhQ2hhbm5lbCA9IHRoaXMucGVlci5jcmVhdGVEYXRhQ2hhbm5lbCgiaG9zdC1zZXJ2ZXIiKTsKICAgIHRoaXMuZGF0YUNoYW5uZWwub25vcGVuID0gb25vcGVuOwogICAgdGhpcy5kYXRhQ2hhbm5lbC5iaW5hcnlUeXBlID0gImFycmF5YnVmZmVyIjsKICAgIHRoaXMuZGF0YUNoYW5uZWwub25jbG9zZSA9IG9uY2xvc2U7CiAgICB0aGlzLmRhdGFDaGFubmVsLm9ubWVzc2FnZSA9IGFzeW5jIChldmVudCkgPT4gewogICAgICBsZXQgYnVmID0gZXZlbnQuZGF0YTsKICAgICAgdGhpcy5vbmRhdGEoYnVmKTsKICAgIH07CiAgfQogIHNlbmQoZGF0YSkgewogICAgdGhpcy5kYXRhQ2hhbm5lbC5zZW5kKGRhdGEpOwogIH0KICBjbG9zZSgpIHsKICAgIHRoaXMuZGF0YUNoYW5uZWwuY2xvc2UoKTsKICB9CiAgYXN5bmMgY3JlYXRlT2ZmZXIoKSB7CiAgICBjb25zdCBsb2NhbENhbmRpZGF0ZXMgPSBbXTsKICAgIGxldCByZWFkeVByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgIHRoaXMucGVlci5vbmljZWNhbmRpZGF0ZSA9IGFzeW5jIChldmVudCkgPT4gewogICAgICAgIGlmIChldmVudC5jYW5kaWRhdGUpIHsKICAgICAgICAgIGxvY2FsQ2FuZGlkYXRlcy5wdXNoKGV2ZW50LmNhbmRpZGF0ZSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHJlc29sdmUoeyBvZmZlciwgbG9jYWxDYW5kaWRhdGVzIH0pOwogICAgICB9OwogICAgfSk7CiAgICBjb25zdCBvZmZlciA9IGF3YWl0IHRoaXMucGVlci5jcmVhdGVPZmZlcigpOwogICAgYXdhaXQgdGhpcy5wZWVyLnNldExvY2FsRGVzY3JpcHRpb24ob2ZmZXIpOwogICAgcmV0dXJuIHJlYWR5UHJvbWlzZTsKICB9CiAgYXN5bmMgYW5zd2VyKGFuc3dlciwgY2FuZGlkYXRlcykgewogICAgYXdhaXQgdGhpcy5wZWVyLnNldFJlbW90ZURlc2NyaXB0aW9uKGFuc3dlcik7CiAgICBmb3IgKGxldCBjYW5kaWRhdGUgb2YgY2FuZGlkYXRlcykgewogICAgICBhd2FpdCB0aGlzLnBlZXIuYWRkSWNlQ2FuZGlkYXRlKGNhbmRpZGF0ZSk7CiAgICB9CiAgfQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIEBmaWxlb3ZlcnZpZXcgRmlyZWJhc2UgY29uc3RhbnRzLiAgU29tZSBvZiB0aGVzZSAoQGRlZmluZXMpIGNhbiBiZSBvdmVycmlkZGVuIGF0IGNvbXBpbGUtdGltZS4NCiAqLw0KY29uc3QgQ09OU1RBTlRTID0gew0KICAgIC8qKg0KICAgICAqIEBkZWZpbmUge2Jvb2xlYW59IFdoZXRoZXIgdGhpcyBpcyB0aGUgY2xpZW50IE5vZGUuanMgU0RLLg0KICAgICAqLw0KICAgIE5PREVfQ0xJRU5UOiBmYWxzZSwNCiAgICAvKioNCiAgICAgKiBAZGVmaW5lIHtib29sZWFufSBXaGV0aGVyIHRoaXMgaXMgdGhlIEFkbWluIE5vZGUuanMgU0RLLg0KICAgICAqLw0KICAgIE5PREVfQURNSU46IGZhbHNlLA0KICAgIC8qKg0KICAgICAqIEZpcmViYXNlIFNESyBWZXJzaW9uDQogICAgICovDQogICAgU0RLX1ZFUlNJT046ICcke0pTQ09SRV9WRVJTSU9OfScNCn07CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIFRocm93cyBhbiBlcnJvciBpZiB0aGUgcHJvdmlkZWQgYXNzZXJ0aW9uIGlzIGZhbHN5DQogKi8NCmNvbnN0IGFzc2VydCA9IGZ1bmN0aW9uIChhc3NlcnRpb24sIG1lc3NhZ2UpIHsNCiAgICBpZiAoIWFzc2VydGlvbikgew0KICAgICAgICB0aHJvdyBhc3NlcnRpb25FcnJvcihtZXNzYWdlKTsNCiAgICB9DQp9Ow0KLyoqDQogKiBSZXR1cm5zIGFuIEVycm9yIG9iamVjdCBzdWl0YWJsZSBmb3IgdGhyb3dpbmcuDQogKi8NCmNvbnN0IGFzc2VydGlvbkVycm9yID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHsNCiAgICByZXR1cm4gbmV3IEVycm9yKCdGaXJlYmFzZSBEYXRhYmFzZSAoJyArDQogICAgICAgIENPTlNUQU5UUy5TREtfVkVSU0lPTiArDQogICAgICAgICcpIElOVEVSTkFMIEFTU0VSVCBGQUlMRUQ6ICcgKw0KICAgICAgICBtZXNzYWdlKTsNCn07CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjb25zdCBzdHJpbmdUb0J5dGVBcnJheSQxID0gZnVuY3Rpb24gKHN0cikgew0KICAgIC8vIFRPRE8odXNlcik6IFVzZSBuYXRpdmUgaW1wbGVtZW50YXRpb25zIGlmL3doZW4gYXZhaWxhYmxlDQogICAgY29uc3Qgb3V0ID0gW107DQogICAgbGV0IHAgPSAwOw0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGxldCBjID0gc3RyLmNoYXJDb2RlQXQoaSk7DQogICAgICAgIGlmIChjIDwgMTI4KSB7DQogICAgICAgICAgICBvdXRbcCsrXSA9IGM7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoYyA8IDIwNDgpIHsNCiAgICAgICAgICAgIG91dFtwKytdID0gKGMgPj4gNikgfCAxOTI7DQogICAgICAgICAgICBvdXRbcCsrXSA9IChjICYgNjMpIHwgMTI4Ow0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKChjICYgMHhmYzAwKSA9PT0gMHhkODAwICYmDQogICAgICAgICAgICBpICsgMSA8IHN0ci5sZW5ndGggJiYNCiAgICAgICAgICAgIChzdHIuY2hhckNvZGVBdChpICsgMSkgJiAweGZjMDApID09PSAweGRjMDApIHsNCiAgICAgICAgICAgIC8vIFN1cnJvZ2F0ZSBQYWlyDQogICAgICAgICAgICBjID0gMHgxMDAwMCArICgoYyAmIDB4MDNmZikgPDwgMTApICsgKHN0ci5jaGFyQ29kZUF0KCsraSkgJiAweDAzZmYpOw0KICAgICAgICAgICAgb3V0W3ArK10gPSAoYyA+PiAxOCkgfCAyNDA7DQogICAgICAgICAgICBvdXRbcCsrXSA9ICgoYyA+PiAxMikgJiA2MykgfCAxMjg7DQogICAgICAgICAgICBvdXRbcCsrXSA9ICgoYyA+PiA2KSAmIDYzKSB8IDEyODsNCiAgICAgICAgICAgIG91dFtwKytdID0gKGMgJiA2MykgfCAxMjg7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBvdXRbcCsrXSA9IChjID4+IDEyKSB8IDIyNDsNCiAgICAgICAgICAgIG91dFtwKytdID0gKChjID4+IDYpICYgNjMpIHwgMTI4Ow0KICAgICAgICAgICAgb3V0W3ArK10gPSAoYyAmIDYzKSB8IDEyODsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gb3V0Ow0KfTsNCi8qKg0KICogVHVybnMgYW4gYXJyYXkgb2YgbnVtYmVycyBpbnRvIHRoZSBzdHJpbmcgZ2l2ZW4gYnkgdGhlIGNvbmNhdGVuYXRpb24gb2YgdGhlDQogKiBjaGFyYWN0ZXJzIHRvIHdoaWNoIHRoZSBudW1iZXJzIGNvcnJlc3BvbmQuDQogKiBAcGFyYW0gYnl0ZXMgQXJyYXkgb2YgbnVtYmVycyByZXByZXNlbnRpbmcgY2hhcmFjdGVycy4NCiAqIEByZXR1cm4gU3RyaW5naWZpY2F0aW9uIG9mIHRoZSBhcnJheS4NCiAqLw0KY29uc3QgYnl0ZUFycmF5VG9TdHJpbmcgPSBmdW5jdGlvbiAoYnl0ZXMpIHsNCiAgICAvLyBUT0RPKHVzZXIpOiBVc2UgbmF0aXZlIGltcGxlbWVudGF0aW9ucyBpZi93aGVuIGF2YWlsYWJsZQ0KICAgIGNvbnN0IG91dCA9IFtdOw0KICAgIGxldCBwb3MgPSAwLCBjID0gMDsNCiAgICB3aGlsZSAocG9zIDwgYnl0ZXMubGVuZ3RoKSB7DQogICAgICAgIGNvbnN0IGMxID0gYnl0ZXNbcG9zKytdOw0KICAgICAgICBpZiAoYzEgPCAxMjgpIHsNCiAgICAgICAgICAgIG91dFtjKytdID0gU3RyaW5nLmZyb21DaGFyQ29kZShjMSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoYzEgPiAxOTEgJiYgYzEgPCAyMjQpIHsNCiAgICAgICAgICAgIGNvbnN0IGMyID0gYnl0ZXNbcG9zKytdOw0KICAgICAgICAgICAgb3V0W2MrK10gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYzEgJiAzMSkgPDwgNikgfCAoYzIgJiA2MykpOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKGMxID4gMjM5ICYmIGMxIDwgMzY1KSB7DQogICAgICAgICAgICAvLyBTdXJyb2dhdGUgUGFpcg0KICAgICAgICAgICAgY29uc3QgYzIgPSBieXRlc1twb3MrK107DQogICAgICAgICAgICBjb25zdCBjMyA9IGJ5dGVzW3BvcysrXTsNCiAgICAgICAgICAgIGNvbnN0IGM0ID0gYnl0ZXNbcG9zKytdOw0KICAgICAgICAgICAgY29uc3QgdSA9ICgoKGMxICYgNykgPDwgMTgpIHwgKChjMiAmIDYzKSA8PCAxMikgfCAoKGMzICYgNjMpIDw8IDYpIHwgKGM0ICYgNjMpKSAtDQogICAgICAgICAgICAgICAgMHgxMDAwMDsNCiAgICAgICAgICAgIG91dFtjKytdID0gU3RyaW5nLmZyb21DaGFyQ29kZSgweGQ4MDAgKyAodSA+PiAxMCkpOw0KICAgICAgICAgICAgb3V0W2MrK10gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4ZGMwMCArICh1ICYgMTAyMykpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29uc3QgYzIgPSBieXRlc1twb3MrK107DQogICAgICAgICAgICBjb25zdCBjMyA9IGJ5dGVzW3BvcysrXTsNCiAgICAgICAgICAgIG91dFtjKytdID0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMxICYgMTUpIDw8IDEyKSB8ICgoYzIgJiA2MykgPDwgNikgfCAoYzMgJiA2MykpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBvdXQuam9pbignJyk7DQp9Ow0KLy8gV2UgZGVmaW5lIGl0IGFzIGFuIG9iamVjdCBsaXRlcmFsIGluc3RlYWQgb2YgYSBjbGFzcyBiZWNhdXNlIGEgY2xhc3MgY29tcGlsZWQgZG93biB0byBlczUgY2FuJ3QNCi8vIGJlIHRyZWVzaGFrZWQuIGh0dHBzOi8vZ2l0aHViLmNvbS9yb2xsdXAvcm9sbHVwL2lzc3Vlcy8xNjkxDQovLyBTdGF0aWMgbG9va3VwIG1hcHMsIGxhemlseSBwb3B1bGF0ZWQgYnkgaW5pdF8oKQ0KY29uc3QgYmFzZTY0JDMgPSB7DQogICAgLyoqDQogICAgICogTWFwcyBieXRlcyB0byBjaGFyYWN0ZXJzLg0KICAgICAqLw0KICAgIGJ5dGVUb0NoYXJNYXBfOiBudWxsLA0KICAgIC8qKg0KICAgICAqIE1hcHMgY2hhcmFjdGVycyB0byBieXRlcy4NCiAgICAgKi8NCiAgICBjaGFyVG9CeXRlTWFwXzogbnVsbCwNCiAgICAvKioNCiAgICAgKiBNYXBzIGJ5dGVzIHRvIHdlYnNhZmUgY2hhcmFjdGVycy4NCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqLw0KICAgIGJ5dGVUb0NoYXJNYXBXZWJTYWZlXzogbnVsbCwNCiAgICAvKioNCiAgICAgKiBNYXBzIHdlYnNhZmUgY2hhcmFjdGVycyB0byBieXRlcy4NCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqLw0KICAgIGNoYXJUb0J5dGVNYXBXZWJTYWZlXzogbnVsbCwNCiAgICAvKioNCiAgICAgKiBPdXIgZGVmYXVsdCBhbHBoYWJldCwgc2hhcmVkIGJldHdlZW4NCiAgICAgKiBFTkNPREVEX1ZBTFMgYW5kIEVOQ09ERURfVkFMU19XRUJTQUZFDQogICAgICovDQogICAgRU5DT0RFRF9WQUxTX0JBU0U6ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWicgKyAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXonICsgJzAxMjM0NTY3ODknLA0KICAgIC8qKg0KICAgICAqIE91ciBkZWZhdWx0IGFscGhhYmV0LiBWYWx1ZSA2NCAoPSkgaXMgc3BlY2lhbDsgaXQgbWVhbnMgIm5vdGhpbmcuIg0KICAgICAqLw0KICAgIGdldCBFTkNPREVEX1ZBTFMoKSB7DQogICAgICAgIHJldHVybiB0aGlzLkVOQ09ERURfVkFMU19CQVNFICsgJysvPSc7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBPdXIgd2Vic2FmZSBhbHBoYWJldC4NCiAgICAgKi8NCiAgICBnZXQgRU5DT0RFRF9WQUxTX1dFQlNBRkUoKSB7DQogICAgICAgIHJldHVybiB0aGlzLkVOQ09ERURfVkFMU19CQVNFICsgJy1fLic7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBXaGV0aGVyIHRoaXMgYnJvd3NlciBzdXBwb3J0cyB0aGUgYXRvYiBhbmQgYnRvYSBmdW5jdGlvbnMuIFRoaXMgZXh0ZW5zaW9uDQogICAgICogc3RhcnRlZCBhdCBNb3ppbGxhIGJ1dCBpcyBub3cgaW1wbGVtZW50ZWQgYnkgbWFueSBicm93c2Vycy4gV2UgdXNlIHRoZQ0KICAgICAqIEFTU1VNRV8qIHZhcmlhYmxlcyB0byBhdm9pZCBwdWxsaW5nIGluIHRoZSBmdWxsIHVzZXJhZ2VudCBkZXRlY3Rpb24gbGlicmFyeQ0KICAgICAqIGJ1dCBzdGlsbCBhbGxvd2luZyB0aGUgc3RhbmRhcmQgcGVyLWJyb3dzZXIgY29tcGlsYXRpb25zLg0KICAgICAqDQogICAgICovDQogICAgSEFTX05BVElWRV9TVVBQT1JUOiB0eXBlb2YgYXRvYiA9PT0gJ2Z1bmN0aW9uJywNCiAgICAvKioNCiAgICAgKiBCYXNlNjQtZW5jb2RlIGFuIGFycmF5IG9mIGJ5dGVzLg0KICAgICAqDQogICAgICogQHBhcmFtIGlucHV0IEFuIGFycmF5IG9mIGJ5dGVzIChudW1iZXJzIHdpdGgNCiAgICAgKiAgICAgdmFsdWUgaW4gWzAsIDI1NV0pIHRvIGVuY29kZS4NCiAgICAgKiBAcGFyYW0gd2ViU2FmZSBCb29sZWFuIGluZGljYXRpbmcgd2Ugc2hvdWxkIHVzZSB0aGUNCiAgICAgKiAgICAgYWx0ZXJuYXRpdmUgYWxwaGFiZXQuDQogICAgICogQHJldHVybiBUaGUgYmFzZTY0IGVuY29kZWQgc3RyaW5nLg0KICAgICAqLw0KICAgIGVuY29kZUJ5dGVBcnJheShpbnB1dCwgd2ViU2FmZSkgew0KICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoaW5wdXQpKSB7DQogICAgICAgICAgICB0aHJvdyBFcnJvcignZW5jb2RlQnl0ZUFycmF5IHRha2VzIGFuIGFycmF5IGFzIGEgcGFyYW1ldGVyJyk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5pbml0XygpOw0KICAgICAgICBjb25zdCBieXRlVG9DaGFyTWFwID0gd2ViU2FmZQ0KICAgICAgICAgICAgPyB0aGlzLmJ5dGVUb0NoYXJNYXBXZWJTYWZlXw0KICAgICAgICAgICAgOiB0aGlzLmJ5dGVUb0NoYXJNYXBfOw0KICAgICAgICBjb25zdCBvdXRwdXQgPSBbXTsNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbnB1dC5sZW5ndGg7IGkgKz0gMykgew0KICAgICAgICAgICAgY29uc3QgYnl0ZTEgPSBpbnB1dFtpXTsNCiAgICAgICAgICAgIGNvbnN0IGhhdmVCeXRlMiA9IGkgKyAxIDwgaW5wdXQubGVuZ3RoOw0KICAgICAgICAgICAgY29uc3QgYnl0ZTIgPSBoYXZlQnl0ZTIgPyBpbnB1dFtpICsgMV0gOiAwOw0KICAgICAgICAgICAgY29uc3QgaGF2ZUJ5dGUzID0gaSArIDIgPCBpbnB1dC5sZW5ndGg7DQogICAgICAgICAgICBjb25zdCBieXRlMyA9IGhhdmVCeXRlMyA/IGlucHV0W2kgKyAyXSA6IDA7DQogICAgICAgICAgICBjb25zdCBvdXRCeXRlMSA9IGJ5dGUxID4+IDI7DQogICAgICAgICAgICBjb25zdCBvdXRCeXRlMiA9ICgoYnl0ZTEgJiAweDAzKSA8PCA0KSB8IChieXRlMiA+PiA0KTsNCiAgICAgICAgICAgIGxldCBvdXRCeXRlMyA9ICgoYnl0ZTIgJiAweDBmKSA8PCAyKSB8IChieXRlMyA+PiA2KTsNCiAgICAgICAgICAgIGxldCBvdXRCeXRlNCA9IGJ5dGUzICYgMHgzZjsNCiAgICAgICAgICAgIGlmICghaGF2ZUJ5dGUzKSB7DQogICAgICAgICAgICAgICAgb3V0Qnl0ZTQgPSA2NDsNCiAgICAgICAgICAgICAgICBpZiAoIWhhdmVCeXRlMikgew0KICAgICAgICAgICAgICAgICAgICBvdXRCeXRlMyA9IDY0Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIG91dHB1dC5wdXNoKGJ5dGVUb0NoYXJNYXBbb3V0Qnl0ZTFdLCBieXRlVG9DaGFyTWFwW291dEJ5dGUyXSwgYnl0ZVRvQ2hhck1hcFtvdXRCeXRlM10sIGJ5dGVUb0NoYXJNYXBbb3V0Qnl0ZTRdKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gb3V0cHV0LmpvaW4oJycpOw0KICAgIH0sDQogICAgLyoqDQogICAgICogQmFzZTY0LWVuY29kZSBhIHN0cmluZy4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBpbnB1dCBBIHN0cmluZyB0byBlbmNvZGUuDQogICAgICogQHBhcmFtIHdlYlNhZmUgSWYgdHJ1ZSwgd2Ugc2hvdWxkIHVzZSB0aGUNCiAgICAgKiAgICAgYWx0ZXJuYXRpdmUgYWxwaGFiZXQuDQogICAgICogQHJldHVybiBUaGUgYmFzZTY0IGVuY29kZWQgc3RyaW5nLg0KICAgICAqLw0KICAgIGVuY29kZVN0cmluZyhpbnB1dCwgd2ViU2FmZSkgew0KICAgICAgICAvLyBTaG9ydGN1dCBmb3IgTW96aWxsYSBicm93c2VycyB0aGF0IGltcGxlbWVudA0KICAgICAgICAvLyBhIG5hdGl2ZSBiYXNlNjQgZW5jb2RlciBpbiB0aGUgZm9ybSBvZiAiYnRvYS9hdG9iIg0KICAgICAgICBpZiAodGhpcy5IQVNfTkFUSVZFX1NVUFBPUlQgJiYgIXdlYlNhZmUpIHsNCiAgICAgICAgICAgIHJldHVybiBidG9hKGlucHV0KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpcy5lbmNvZGVCeXRlQXJyYXkoc3RyaW5nVG9CeXRlQXJyYXkkMShpbnB1dCksIHdlYlNhZmUpOw0KICAgIH0sDQogICAgLyoqDQogICAgICogQmFzZTY0LWRlY29kZSBhIHN0cmluZy4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBpbnB1dCB0byBkZWNvZGUuDQogICAgICogQHBhcmFtIHdlYlNhZmUgVHJ1ZSBpZiB3ZSBzaG91bGQgdXNlIHRoZQ0KICAgICAqICAgICBhbHRlcm5hdGl2ZSBhbHBoYWJldC4NCiAgICAgKiBAcmV0dXJuIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIGRlY29kZWQgdmFsdWUuDQogICAgICovDQogICAgZGVjb2RlU3RyaW5nKGlucHV0LCB3ZWJTYWZlKSB7DQogICAgICAgIC8vIFNob3J0Y3V0IGZvciBNb3ppbGxhIGJyb3dzZXJzIHRoYXQgaW1wbGVtZW50DQogICAgICAgIC8vIGEgbmF0aXZlIGJhc2U2NCBlbmNvZGVyIGluIHRoZSBmb3JtIG9mICJidG9hL2F0b2IiDQogICAgICAgIGlmICh0aGlzLkhBU19OQVRJVkVfU1VQUE9SVCAmJiAhd2ViU2FmZSkgew0KICAgICAgICAgICAgcmV0dXJuIGF0b2IoaW5wdXQpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBieXRlQXJyYXlUb1N0cmluZyh0aGlzLmRlY29kZVN0cmluZ1RvQnl0ZUFycmF5KGlucHV0LCB3ZWJTYWZlKSk7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBCYXNlNjQtZGVjb2RlIGEgc3RyaW5nLg0KICAgICAqDQogICAgICogSW4gYmFzZS02NCBkZWNvZGluZywgZ3JvdXBzIG9mIGZvdXIgY2hhcmFjdGVycyBhcmUgY29udmVydGVkIGludG8gdGhyZWUNCiAgICAgKiBieXRlcy4gIElmIHRoZSBlbmNvZGVyIGRpZCBub3QgYXBwbHkgcGFkZGluZywgdGhlIGlucHV0IGxlbmd0aCBtYXkgbm90DQogICAgICogYmUgYSBtdWx0aXBsZSBvZiA0Lg0KICAgICAqDQogICAgICogSW4gdGhpcyBjYXNlLCB0aGUgbGFzdCBncm91cCB3aWxsIGhhdmUgZmV3ZXIgdGhhbiA0IGNoYXJhY3RlcnMsIGFuZA0KICAgICAqIHBhZGRpbmcgd2lsbCBiZSBpbmZlcnJlZC4gIElmIHRoZSBncm91cCBoYXMgb25lIG9yIHR3byBjaGFyYWN0ZXJzLCBpdCBkZWNvZGVzDQogICAgICogdG8gb25lIGJ5dGUuICBJZiB0aGUgZ3JvdXAgaGFzIHRocmVlIGNoYXJhY3RlcnMsIGl0IGRlY29kZXMgdG8gdHdvIGJ5dGVzLg0KICAgICAqDQogICAgICogQHBhcmFtIGlucHV0IElucHV0IHRvIGRlY29kZS4NCiAgICAgKiBAcGFyYW0gd2ViU2FmZSBUcnVlIGlmIHdlIHNob3VsZCB1c2UgdGhlIHdlYi1zYWZlIGFscGhhYmV0Lg0KICAgICAqIEByZXR1cm4gYnl0ZXMgcmVwcmVzZW50aW5nIHRoZSBkZWNvZGVkIHZhbHVlLg0KICAgICAqLw0KICAgIGRlY29kZVN0cmluZ1RvQnl0ZUFycmF5KGlucHV0LCB3ZWJTYWZlKSB7DQogICAgICAgIHRoaXMuaW5pdF8oKTsNCiAgICAgICAgY29uc3QgY2hhclRvQnl0ZU1hcCA9IHdlYlNhZmUNCiAgICAgICAgICAgID8gdGhpcy5jaGFyVG9CeXRlTWFwV2ViU2FmZV8NCiAgICAgICAgICAgIDogdGhpcy5jaGFyVG9CeXRlTWFwXzsNCiAgICAgICAgY29uc3Qgb3V0cHV0ID0gW107DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5wdXQubGVuZ3RoOykgew0KICAgICAgICAgICAgY29uc3QgYnl0ZTEgPSBjaGFyVG9CeXRlTWFwW2lucHV0LmNoYXJBdChpKyspXTsNCiAgICAgICAgICAgIGNvbnN0IGhhdmVCeXRlMiA9IGkgPCBpbnB1dC5sZW5ndGg7DQogICAgICAgICAgICBjb25zdCBieXRlMiA9IGhhdmVCeXRlMiA/IGNoYXJUb0J5dGVNYXBbaW5wdXQuY2hhckF0KGkpXSA6IDA7DQogICAgICAgICAgICArK2k7DQogICAgICAgICAgICBjb25zdCBoYXZlQnl0ZTMgPSBpIDwgaW5wdXQubGVuZ3RoOw0KICAgICAgICAgICAgY29uc3QgYnl0ZTMgPSBoYXZlQnl0ZTMgPyBjaGFyVG9CeXRlTWFwW2lucHV0LmNoYXJBdChpKV0gOiA2NDsNCiAgICAgICAgICAgICsraTsNCiAgICAgICAgICAgIGNvbnN0IGhhdmVCeXRlNCA9IGkgPCBpbnB1dC5sZW5ndGg7DQogICAgICAgICAgICBjb25zdCBieXRlNCA9IGhhdmVCeXRlNCA/IGNoYXJUb0J5dGVNYXBbaW5wdXQuY2hhckF0KGkpXSA6IDY0Ow0KICAgICAgICAgICAgKytpOw0KICAgICAgICAgICAgaWYgKGJ5dGUxID09IG51bGwgfHwgYnl0ZTIgPT0gbnVsbCB8fCBieXRlMyA9PSBudWxsIHx8IGJ5dGU0ID09IG51bGwpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRGVjb2RlQmFzZTY0U3RyaW5nRXJyb3IoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IG91dEJ5dGUxID0gKGJ5dGUxIDw8IDIpIHwgKGJ5dGUyID4+IDQpOw0KICAgICAgICAgICAgb3V0cHV0LnB1c2gob3V0Qnl0ZTEpOw0KICAgICAgICAgICAgaWYgKGJ5dGUzICE9PSA2NCkgew0KICAgICAgICAgICAgICAgIGNvbnN0IG91dEJ5dGUyID0gKChieXRlMiA8PCA0KSAmIDB4ZjApIHwgKGJ5dGUzID4+IDIpOw0KICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKG91dEJ5dGUyKTsNCiAgICAgICAgICAgICAgICBpZiAoYnl0ZTQgIT09IDY0KSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG91dEJ5dGUzID0gKChieXRlMyA8PCA2KSAmIDB4YzApIHwgYnl0ZTQ7DQogICAgICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKG91dEJ5dGUzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG91dHB1dDsNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIExhenkgc3RhdGljIGluaXRpYWxpemF0aW9uIGZ1bmN0aW9uLiBDYWxsZWQgYmVmb3JlDQogICAgICogYWNjZXNzaW5nIGFueSBvZiB0aGUgc3RhdGljIG1hcCB2YXJpYWJsZXMuDQogICAgICogQHByaXZhdGUNCiAgICAgKi8NCiAgICBpbml0XygpIHsNCiAgICAgICAgaWYgKCF0aGlzLmJ5dGVUb0NoYXJNYXBfKSB7DQogICAgICAgICAgICB0aGlzLmJ5dGVUb0NoYXJNYXBfID0ge307DQogICAgICAgICAgICB0aGlzLmNoYXJUb0J5dGVNYXBfID0ge307DQogICAgICAgICAgICB0aGlzLmJ5dGVUb0NoYXJNYXBXZWJTYWZlXyA9IHt9Ow0KICAgICAgICAgICAgdGhpcy5jaGFyVG9CeXRlTWFwV2ViU2FmZV8gPSB7fTsNCiAgICAgICAgICAgIC8vIFdlIHdhbnQgcXVpY2sgbWFwcGluZ3MgYmFjayBhbmQgZm9ydGgsIHNvIHdlIHByZWNvbXB1dGUgdHdvIG1hcHMuDQogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuRU5DT0RFRF9WQUxTLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgdGhpcy5ieXRlVG9DaGFyTWFwX1tpXSA9IHRoaXMuRU5DT0RFRF9WQUxTLmNoYXJBdChpKTsNCiAgICAgICAgICAgICAgICB0aGlzLmNoYXJUb0J5dGVNYXBfW3RoaXMuYnl0ZVRvQ2hhck1hcF9baV1dID0gaTsNCiAgICAgICAgICAgICAgICB0aGlzLmJ5dGVUb0NoYXJNYXBXZWJTYWZlX1tpXSA9IHRoaXMuRU5DT0RFRF9WQUxTX1dFQlNBRkUuY2hhckF0KGkpOw0KICAgICAgICAgICAgICAgIHRoaXMuY2hhclRvQnl0ZU1hcFdlYlNhZmVfW3RoaXMuYnl0ZVRvQ2hhck1hcFdlYlNhZmVfW2ldXSA9IGk7DQogICAgICAgICAgICAgICAgLy8gQmUgZm9yZ2l2aW5nIHdoZW4gZGVjb2RpbmcgYW5kIGNvcnJlY3RseSBkZWNvZGUgYm90aCBlbmNvZGluZ3MuDQogICAgICAgICAgICAgICAgaWYgKGkgPj0gdGhpcy5FTkNPREVEX1ZBTFNfQkFTRS5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGFyVG9CeXRlTWFwX1t0aGlzLkVOQ09ERURfVkFMU19XRUJTQUZFLmNoYXJBdChpKV0gPSBpOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXJUb0J5dGVNYXBXZWJTYWZlX1t0aGlzLkVOQ09ERURfVkFMUy5jaGFyQXQoaSldID0gaTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQp9Ow0KLyoqDQogKiBBbiBlcnJvciBlbmNvdW50ZXJlZCB3aGlsZSBkZWNvZGluZyBiYXNlNjQgc3RyaW5nLg0KICovDQpjbGFzcyBEZWNvZGVCYXNlNjRTdHJpbmdFcnJvciBleHRlbmRzIEVycm9yIHsNCiAgICBjb25zdHJ1Y3RvcigpIHsNCiAgICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTsNCiAgICAgICAgdGhpcy5uYW1lID0gJ0RlY29kZUJhc2U2NFN0cmluZ0Vycm9yJzsNCiAgICB9DQp9DQovKioNCiAqIFVSTC1zYWZlIGJhc2U2NCBlbmNvZGluZw0KICovDQpjb25zdCBiYXNlNjRFbmNvZGUgPSBmdW5jdGlvbiAoc3RyKSB7DQogICAgY29uc3QgdXRmOEJ5dGVzID0gc3RyaW5nVG9CeXRlQXJyYXkkMShzdHIpOw0KICAgIHJldHVybiBiYXNlNjQkMy5lbmNvZGVCeXRlQXJyYXkodXRmOEJ5dGVzLCB0cnVlKTsNCn07DQovKioNCiAqIFVSTC1zYWZlIGJhc2U2NCBlbmNvZGluZyAod2l0aG91dCAiLiIgcGFkZGluZyBpbiB0aGUgZW5kKS4NCiAqIGUuZy4gVXNlZCBpbiBKU09OIFdlYiBUb2tlbiAoSldUKSBwYXJ0cy4NCiAqLw0KY29uc3QgYmFzZTY0dXJsRW5jb2RlV2l0aG91dFBhZGRpbmcgPSBmdW5jdGlvbiAoc3RyKSB7DQogICAgLy8gVXNlIGJhc2U2NHVybCBlbmNvZGluZyBhbmQgcmVtb3ZlIHBhZGRpbmcgaW4gdGhlIGVuZCAoZG90IGNoYXJhY3RlcnMpLg0KICAgIHJldHVybiBiYXNlNjRFbmNvZGUoc3RyKS5yZXBsYWNlKC9cLi9nLCAnJyk7DQp9Ow0KLyoqDQogKiBVUkwtc2FmZSBiYXNlNjQgZGVjb2RpbmcNCiAqDQogKiBOT1RFOiBETyBOT1QgdXNlIHRoZSBnbG9iYWwgYXRvYigpIGZ1bmN0aW9uIC0gaXQgZG9lcyBOT1Qgc3VwcG9ydCB0aGUNCiAqIGJhc2U2NFVybCB2YXJpYW50IGVuY29kaW5nLg0KICoNCiAqIEBwYXJhbSBzdHIgVG8gYmUgZGVjb2RlZA0KICogQHJldHVybiBEZWNvZGVkIHJlc3VsdCwgaWYgcG9zc2libGUNCiAqLw0KY29uc3QgYmFzZTY0RGVjb2RlID0gZnVuY3Rpb24gKHN0cikgew0KICAgIHRyeSB7DQogICAgICAgIHJldHVybiBiYXNlNjQkMy5kZWNvZGVTdHJpbmcoc3RyLCB0cnVlKTsNCiAgICB9DQogICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignYmFzZTY0RGVjb2RlIGZhaWxlZDogJywgZSk7DQogICAgfQ0KICAgIHJldHVybiBudWxsOw0KfTsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogRG8gYSBkZWVwLWNvcHkgb2YgYmFzaWMgSmF2YVNjcmlwdCBPYmplY3RzIG9yIEFycmF5cy4NCiAqLw0KZnVuY3Rpb24gZGVlcENvcHkodmFsdWUpIHsNCiAgICByZXR1cm4gZGVlcEV4dGVuZCh1bmRlZmluZWQsIHZhbHVlKTsNCn0NCi8qKg0KICogQ29weSBwcm9wZXJ0aWVzIGZyb20gc291cmNlIHRvIHRhcmdldCAocmVjdXJzaXZlbHkgYWxsb3dzIGV4dGVuc2lvbg0KICogb2YgT2JqZWN0cyBhbmQgQXJyYXlzKS4gIFNjYWxhciB2YWx1ZXMgaW4gdGhlIHRhcmdldCBhcmUgb3Zlci13cml0dGVuLg0KICogSWYgdGFyZ2V0IGlzIHVuZGVmaW5lZCwgYW4gb2JqZWN0IG9mIHRoZSBhcHByb3ByaWF0ZSB0eXBlIHdpbGwgYmUgY3JlYXRlZA0KICogKGFuZCByZXR1cm5lZCkuDQogKg0KICogV2UgcmVjdXJzaXZlbHkgY29weSBhbGwgY2hpbGQgcHJvcGVydGllcyBvZiBwbGFpbiBPYmplY3RzIGluIHRoZSBzb3VyY2UtIHNvDQogKiB0aGF0IG5hbWVzcGFjZS0gbGlrZSBkaWN0aW9uYXJpZXMgYXJlIG1lcmdlZC4NCiAqDQogKiBOb3RlIHRoYXQgdGhlIHRhcmdldCBjYW4gYmUgYSBmdW5jdGlvbiwgaW4gd2hpY2ggY2FzZSB0aGUgcHJvcGVydGllcyBpbg0KICogdGhlIHNvdXJjZSBPYmplY3QgYXJlIGNvcGllZCBvbnRvIGl0IGFzIHN0YXRpYyBwcm9wZXJ0aWVzIG9mIHRoZSBGdW5jdGlvbi4NCiAqDQogKiBOb3RlOiB3ZSBkb24ndCBtZXJnZSBfX3Byb3RvX18gdG8gcHJldmVudCBwcm90b3R5cGUgcG9sbHV0aW9uDQogKi8NCmZ1bmN0aW9uIGRlZXBFeHRlbmQodGFyZ2V0LCBzb3VyY2UpIHsNCiAgICBpZiAoIShzb3VyY2UgaW5zdGFuY2VvZiBPYmplY3QpKSB7DQogICAgICAgIHJldHVybiBzb3VyY2U7DQogICAgfQ0KICAgIHN3aXRjaCAoc291cmNlLmNvbnN0cnVjdG9yKSB7DQogICAgICAgIGNhc2UgRGF0ZToNCiAgICAgICAgICAgIC8vIFRyZWF0IERhdGVzIGxpa2Ugc2NhbGFyczsgaWYgdGhlIHRhcmdldCBkYXRlIG9iamVjdCBoYWQgYW55IGNoaWxkDQogICAgICAgICAgICAvLyBwcm9wZXJ0aWVzIC0gdGhleSB3aWxsIGJlIGxvc3QhDQogICAgICAgICAgICBjb25zdCBkYXRlVmFsdWUgPSBzb3VyY2U7DQogICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoZGF0ZVZhbHVlLmdldFRpbWUoKSk7DQogICAgICAgIGNhc2UgT2JqZWN0Og0KICAgICAgICAgICAgaWYgKHRhcmdldCA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgdGFyZ2V0ID0ge307DQogICAgICAgICAgICB9DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSBBcnJheToNCiAgICAgICAgICAgIC8vIEFsd2F5cyBjb3B5IHRoZSBhcnJheSBzb3VyY2UgYW5kIG92ZXJ3cml0ZSB0aGUgdGFyZ2V0Lg0KICAgICAgICAgICAgdGFyZ2V0ID0gW107DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgIC8vIE5vdCBhIHBsYWluIE9iamVjdCAtIHRyZWF0IGl0IGFzIGEgc2NhbGFyLg0KICAgICAgICAgICAgcmV0dXJuIHNvdXJjZTsNCiAgICB9DQogICAgZm9yIChjb25zdCBwcm9wIGluIHNvdXJjZSkgew0KICAgICAgICAvLyB1c2UgaXNWYWxpZEtleSB0byBndWFyZCBhZ2FpbnN0IHByb3RvdHlwZSBwb2xsdXRpb24uIFNlZSBodHRwczovL3NueWsuaW8vdnVsbi9TTllLLUpTLUxPREFTSC00NTAyMDINCiAgICAgICAgaWYgKCFzb3VyY2UuaGFzT3duUHJvcGVydHkocHJvcCkgfHwgIWlzVmFsaWRLZXkkMShwcm9wKSkgew0KICAgICAgICAgICAgY29udGludWU7DQogICAgICAgIH0NCiAgICAgICAgdGFyZ2V0W3Byb3BdID0gZGVlcEV4dGVuZCh0YXJnZXRbcHJvcF0sIHNvdXJjZVtwcm9wXSk7DQogICAgfQ0KICAgIHJldHVybiB0YXJnZXQ7DQp9DQpmdW5jdGlvbiBpc1ZhbGlkS2V5JDEoa2V5KSB7DQogICAgcmV0dXJuIGtleSAhPT0gJ19fcHJvdG9fXyc7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIFBvbHlmaWxsIGZvciBgZ2xvYmFsVGhpc2Agb2JqZWN0Lg0KICogQHJldHVybnMgdGhlIGBnbG9iYWxUaGlzYCBvYmplY3QgZm9yIHRoZSBnaXZlbiBlbnZpcm9ubWVudC4NCiAqIEBwdWJsaWMNCiAqLw0KZnVuY3Rpb24gZ2V0R2xvYmFsKCkgew0KICAgIGlmICh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgICAgcmV0dXJuIHNlbGY7DQogICAgfQ0KICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykgew0KICAgICAgICByZXR1cm4gd2luZG93Ow0KICAgIH0NCiAgICBpZiAodHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgICAgcmV0dXJuIGdsb2JhbDsNCiAgICB9DQogICAgdGhyb3cgbmV3IEVycm9yKCdVbmFibGUgdG8gbG9jYXRlIGdsb2JhbCBvYmplY3QuJyk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjb25zdCBnZXREZWZhdWx0c0Zyb21HbG9iYWwgPSAoKSA9PiBnZXRHbG9iYWwoKS5fX0ZJUkVCQVNFX0RFRkFVTFRTX187DQovKioNCiAqIEF0dGVtcHQgdG8gcmVhZCBkZWZhdWx0cyBmcm9tIGEgSlNPTiBzdHJpbmcgcHJvdmlkZWQgdG8NCiAqIHByb2Nlc3MoLillbnYoLilfX0ZJUkVCQVNFX0RFRkFVTFRTX18gb3IgYSBKU09OIGZpbGUgd2hvc2UgcGF0aCBpcyBpbg0KICogcHJvY2VzcyguKWVudiguKV9fRklSRUJBU0VfREVGQVVMVFNfUEFUSF9fDQogKiBUaGUgZG90cyBhcmUgaW4gcGFyZW5zIGJlY2F1c2UgY2VydGFpbiBjb21waWxlcnMgKFZpdGU/KSBjYW5ub3QNCiAqIGhhbmRsZSBzZWVpbmcgdGhhdCB2YXJpYWJsZSBpbiBjb21tZW50cy4NCiAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20vZmlyZWJhc2UvZmlyZWJhc2UtanMtc2RrL2lzc3Vlcy82ODM4DQogKi8NCmNvbnN0IGdldERlZmF1bHRzRnJvbUVudlZhcmlhYmxlID0gKCkgPT4gew0KICAgIGlmICh0eXBlb2YgcHJvY2VzcyA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIHByb2Nlc3MuZW52ID09PSAndW5kZWZpbmVkJykgew0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIGNvbnN0IGRlZmF1bHRzSnNvblN0cmluZyA9ICh7fSkuX19GSVJFQkFTRV9ERUZBVUxUU19fOw0KICAgIGlmIChkZWZhdWx0c0pzb25TdHJpbmcpIHsNCiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoZGVmYXVsdHNKc29uU3RyaW5nKTsNCiAgICB9DQp9Ow0KY29uc3QgZ2V0RGVmYXVsdHNGcm9tQ29va2llID0gKCkgPT4gew0KICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgPT09ICd1bmRlZmluZWQnKSB7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgbGV0IG1hdGNoOw0KICAgIHRyeSB7DQogICAgICAgIG1hdGNoID0gZG9jdW1lbnQuY29va2llLm1hdGNoKC9fX0ZJUkVCQVNFX0RFRkFVTFRTX189KFteO10rKS8pOw0KICAgIH0NCiAgICBjYXRjaCAoZSkgew0KICAgICAgICAvLyBTb21lIGVudmlyb25tZW50cyBzdWNoIGFzIEFuZ3VsYXIgVW5pdmVyc2FsIFNTUiBoYXZlIGENCiAgICAgICAgLy8gYGRvY3VtZW50YCBvYmplY3QgYnV0IGVycm9yIG9uIGFjY2Vzc2luZyBgZG9jdW1lbnQuY29va2llYC4NCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICBjb25zdCBkZWNvZGVkID0gbWF0Y2ggJiYgYmFzZTY0RGVjb2RlKG1hdGNoWzFdKTsNCiAgICByZXR1cm4gZGVjb2RlZCAmJiBKU09OLnBhcnNlKGRlY29kZWQpOw0KfTsNCi8qKg0KICogR2V0IHRoZSBfX0ZJUkVCQVNFX0RFRkFVTFRTX18gb2JqZWN0LiBJdCBjaGVja3MgaW4gb3JkZXI6DQogKiAoMSkgaWYgc3VjaCBhbiBvYmplY3QgZXhpc3RzIGFzIGEgcHJvcGVydHkgb2YgYGdsb2JhbFRoaXNgDQogKiAoMikgaWYgc3VjaCBhbiBvYmplY3Qgd2FzIHByb3ZpZGVkIG9uIGEgc2hlbGwgZW52aXJvbm1lbnQgdmFyaWFibGUNCiAqICgzKSBpZiBzdWNoIGFuIG9iamVjdCBleGlzdHMgaW4gYSBjb29raWUNCiAqIEBwdWJsaWMNCiAqLw0KY29uc3QgZ2V0RGVmYXVsdHMgPSAoKSA9PiB7DQogICAgdHJ5IHsNCiAgICAgICAgcmV0dXJuIChnZXREZWZhdWx0c0Zyb21HbG9iYWwoKSB8fA0KICAgICAgICAgICAgZ2V0RGVmYXVsdHNGcm9tRW52VmFyaWFibGUoKSB8fA0KICAgICAgICAgICAgZ2V0RGVmYXVsdHNGcm9tQ29va2llKCkpOw0KICAgIH0NCiAgICBjYXRjaCAoZSkgew0KICAgICAgICAvKioNCiAgICAgICAgICogQ2F0Y2gtYWxsIGZvciBiZWluZyB1bmFibGUgdG8gZ2V0IF9fRklSRUJBU0VfREVGQVVMVFNfXyBkdWUNCiAgICAgICAgICogdG8gYW55IGVudmlyb25tZW50IGNhc2Ugd2UgaGF2ZSBub3QgYWNjb3VudGVkIGZvci4gTG9nIHRvDQogICAgICAgICAqIGluZm8gaW5zdGVhZCBvZiBzd2FsbG93aW5nIHNvIHdlIGNhbiBmaW5kIHRoZXNlIHVua25vd24gY2FzZXMNCiAgICAgICAgICogYW5kIGFkZCBwYXRocyBmb3IgdGhlbSBpZiBuZWVkZWQuDQogICAgICAgICAqLw0KICAgICAgICBjb25zb2xlLmluZm8oYFVuYWJsZSB0byBnZXQgX19GSVJFQkFTRV9ERUZBVUxUU19fIGR1ZSB0bzogJHtlfWApOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KfTsNCi8qKg0KICogUmV0dXJucyBlbXVsYXRvciBob3N0IHN0b3JlZCBpbiB0aGUgX19GSVJFQkFTRV9ERUZBVUxUU19fIG9iamVjdA0KICogZm9yIHRoZSBnaXZlbiBwcm9kdWN0Lg0KICogQHJldHVybnMgYSBVUkwgaG9zdCBmb3JtYXR0ZWQgbGlrZSBgMTI3LjAuMC4xOjk5OTlgIG9yIGBbOjoxXTo0MDAwYCBpZiBhdmFpbGFibGUNCiAqIEBwdWJsaWMNCiAqLw0KY29uc3QgZ2V0RGVmYXVsdEVtdWxhdG9ySG9zdCA9IChwcm9kdWN0TmFtZSkgPT4geyB2YXIgX2EsIF9iOyByZXR1cm4gKF9iID0gKF9hID0gZ2V0RGVmYXVsdHMoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmVtdWxhdG9ySG9zdHMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYltwcm9kdWN0TmFtZV07IH07DQovKioNCiAqIFJldHVybnMgZW11bGF0b3IgaG9zdG5hbWUgYW5kIHBvcnQgc3RvcmVkIGluIHRoZSBfX0ZJUkVCQVNFX0RFRkFVTFRTX18gb2JqZWN0DQogKiBmb3IgdGhlIGdpdmVuIHByb2R1Y3QuDQogKiBAcmV0dXJucyBhIHBhaXIgb2YgaG9zdG5hbWUgYW5kIHBvcnQgbGlrZSBgWyI6OjEiLCA0MDAwXWAgaWYgYXZhaWxhYmxlDQogKiBAcHVibGljDQogKi8NCmNvbnN0IGdldERlZmF1bHRFbXVsYXRvckhvc3RuYW1lQW5kUG9ydCA9IChwcm9kdWN0TmFtZSkgPT4gew0KICAgIGNvbnN0IGhvc3QgPSBnZXREZWZhdWx0RW11bGF0b3JIb3N0KHByb2R1Y3ROYW1lKTsNCiAgICBpZiAoIWhvc3QpIHsNCiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsNCiAgICB9DQogICAgY29uc3Qgc2VwYXJhdG9ySW5kZXggPSBob3N0Lmxhc3RJbmRleE9mKCc6Jyk7IC8vIEZpbmRpbmcgdGhlIGxhc3Qgc2luY2UgSVB2NiBhZGRyIGFsc28gaGFzIGNvbG9ucy4NCiAgICBpZiAoc2VwYXJhdG9ySW5kZXggPD0gMCB8fCBzZXBhcmF0b3JJbmRleCArIDEgPT09IGhvc3QubGVuZ3RoKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBob3N0ICR7aG9zdH0gd2l0aCBubyBzZXBhcmF0ZSBob3N0bmFtZSBhbmQgcG9ydCFgKTsNCiAgICB9DQogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXJlc3RyaWN0ZWQtZ2xvYmFscw0KICAgIGNvbnN0IHBvcnQgPSBwYXJzZUludChob3N0LnN1YnN0cmluZyhzZXBhcmF0b3JJbmRleCArIDEpLCAxMCk7DQogICAgaWYgKGhvc3RbMF0gPT09ICdbJykgew0KICAgICAgICAvLyBCcmFja2V0LXF1b3RlZCBgW2lwdjZhZGRyXTpwb3J0YCA9PiByZXR1cm4gImlwdjZhZGRyIiAod2l0aG91dCBicmFja2V0cykuDQogICAgICAgIHJldHVybiBbaG9zdC5zdWJzdHJpbmcoMSwgc2VwYXJhdG9ySW5kZXggLSAxKSwgcG9ydF07DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICByZXR1cm4gW2hvc3Quc3Vic3RyaW5nKDAsIHNlcGFyYXRvckluZGV4KSwgcG9ydF07DQogICAgfQ0KfTsNCi8qKg0KICogUmV0dXJucyBGaXJlYmFzZSBhcHAgY29uZmlnIHN0b3JlZCBpbiB0aGUgX19GSVJFQkFTRV9ERUZBVUxUU19fIG9iamVjdC4NCiAqIEBwdWJsaWMNCiAqLw0KY29uc3QgZ2V0RGVmYXVsdEFwcENvbmZpZyA9ICgpID0+IHsgdmFyIF9hOyByZXR1cm4gKF9hID0gZ2V0RGVmYXVsdHMoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNvbmZpZzsgfTsNCi8qKg0KICogUmV0dXJucyBhbiBleHBlcmltZW50YWwgc2V0dGluZyBvbiB0aGUgX19GSVJFQkFTRV9ERUZBVUxUU19fIG9iamVjdCAocHJvcGVydGllcw0KICogcHJlZml4ZWQgYnkgIl8iKQ0KICogQHB1YmxpYw0KICovDQpjb25zdCBnZXRFeHBlcmltZW50YWxTZXR0aW5nID0gKG5hbWUpID0+IHsgdmFyIF9hOyByZXR1cm4gKF9hID0gZ2V0RGVmYXVsdHMoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hW2BfJHtuYW1lfWBdOyB9OwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY2xhc3MgRGVmZXJyZWQgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICB0aGlzLnJlamVjdCA9ICgpID0+IHsgfTsNCiAgICAgICAgdGhpcy5yZXNvbHZlID0gKCkgPT4geyB9Ow0KICAgICAgICB0aGlzLnByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgICAgICB0aGlzLnJlc29sdmUgPSByZXNvbHZlOw0KICAgICAgICAgICAgdGhpcy5yZWplY3QgPSByZWplY3Q7DQogICAgICAgIH0pOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBPdXIgQVBJIGludGVybmFscyBhcmUgbm90IHByb21pc2VpZmllZCBhbmQgY2Fubm90IGJlY2F1c2Ugb3VyIGNhbGxiYWNrIEFQSXMgaGF2ZSBzdWJ0bGUgZXhwZWN0YXRpb25zIGFyb3VuZA0KICAgICAqIGludm9raW5nIHByb21pc2VzIGlubGluZSwgd2hpY2ggUHJvbWlzZXMgYXJlIGZvcmJpZGRlbiB0byBkby4gVGhpcyBtZXRob2QgYWNjZXB0cyBhbiBvcHRpb25hbCBub2RlLXN0eWxlIGNhbGxiYWNrDQogICAgICogYW5kIHJldHVybnMgYSBub2RlLXN0eWxlIGNhbGxiYWNrIHdoaWNoIHdpbGwgcmVzb2x2ZSBvciByZWplY3QgdGhlIERlZmVycmVkJ3MgcHJvbWlzZS4NCiAgICAgKi8NCiAgICB3cmFwQ2FsbGJhY2soY2FsbGJhY2spIHsNCiAgICAgICAgcmV0dXJuIChlcnJvciwgdmFsdWUpID0+IHsNCiAgICAgICAgICAgIGlmIChlcnJvcikgew0KICAgICAgICAgICAgICAgIHRoaXMucmVqZWN0KGVycm9yKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIHRoaXMucmVzb2x2ZSh2YWx1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgICAgICAgICAgLy8gQXR0YWNoaW5nIG5vb3AgaGFuZGxlciBqdXN0IGluIGNhc2UgZGV2ZWxvcGVyIHdhc24ndCBleHBlY3RpbmcNCiAgICAgICAgICAgICAgICAvLyBwcm9taXNlcw0KICAgICAgICAgICAgICAgIHRoaXMucHJvbWlzZS5jYXRjaCgoKSA9PiB7IH0pOw0KICAgICAgICAgICAgICAgIC8vIFNvbWUgb2Ygb3VyIGNhbGxiYWNrcyBkb24ndCBleHBlY3QgYSB2YWx1ZSBhbmQgb3VyIG93biB0ZXN0cw0KICAgICAgICAgICAgICAgIC8vIGFzc2VydCB0aGF0IHRoZSBwYXJhbWV0ZXIgbGVuZ3RoIGlzIDENCiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2subGVuZ3RoID09PSAxKSB7DQogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCB2YWx1ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmZ1bmN0aW9uIGNyZWF0ZU1vY2tVc2VyVG9rZW4odG9rZW4sIHByb2plY3RJZCkgew0KICAgIGlmICh0b2tlbi51aWQpIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgInVpZCIgZmllbGQgaXMgbm8gbG9uZ2VyIHN1cHBvcnRlZCBieSBtb2NrVXNlclRva2VuLiBQbGVhc2UgdXNlICJzdWIiIGluc3RlYWQgZm9yIEZpcmViYXNlIEF1dGggVXNlciBJRC4nKTsNCiAgICB9DQogICAgLy8gVW5zZWN1cmVkIEpXVHMgdXNlICJub25lIiBhcyB0aGUgYWxnb3JpdGhtLg0KICAgIGNvbnN0IGhlYWRlciA9IHsNCiAgICAgICAgYWxnOiAnbm9uZScsDQogICAgICAgIHR5cGU6ICdKV1QnDQogICAgfTsNCiAgICBjb25zdCBwcm9qZWN0ID0gcHJvamVjdElkIHx8ICdkZW1vLXByb2plY3QnOw0KICAgIGNvbnN0IGlhdCA9IHRva2VuLmlhdCB8fCAwOw0KICAgIGNvbnN0IHN1YiA9IHRva2VuLnN1YiB8fCB0b2tlbi51c2VyX2lkOw0KICAgIGlmICghc3ViKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcigibW9ja1VzZXJUb2tlbiBtdXN0IGNvbnRhaW4gJ3N1Yicgb3IgJ3VzZXJfaWQnIGZpZWxkISIpOw0KICAgIH0NCiAgICBjb25zdCBwYXlsb2FkID0gT2JqZWN0LmFzc2lnbih7IA0KICAgICAgICAvLyBTZXQgYWxsIHJlcXVpcmVkIGZpZWxkcyB0byBkZWNlbnQgZGVmYXVsdHMNCiAgICAgICAgaXNzOiBgaHR0cHM6Ly9zZWN1cmV0b2tlbi5nb29nbGUuY29tLyR7cHJvamVjdH1gLCBhdWQ6IHByb2plY3QsIGlhdCwgZXhwOiBpYXQgKyAzNjAwLCBhdXRoX3RpbWU6IGlhdCwgc3ViLCB1c2VyX2lkOiBzdWIsIGZpcmViYXNlOiB7DQogICAgICAgICAgICBzaWduX2luX3Byb3ZpZGVyOiAnY3VzdG9tJywNCiAgICAgICAgICAgIGlkZW50aXRpZXM6IHt9DQogICAgICAgIH0gfSwgdG9rZW4pOw0KICAgIC8vIFVuc2VjdXJlZCBKV1RzIHVzZSB0aGUgZW1wdHkgc3RyaW5nIGFzIGEgc2lnbmF0dXJlLg0KICAgIGNvbnN0IHNpZ25hdHVyZSA9ICcnOw0KICAgIHJldHVybiBbDQogICAgICAgIGJhc2U2NHVybEVuY29kZVdpdGhvdXRQYWRkaW5nKEpTT04uc3RyaW5naWZ5KGhlYWRlcikpLA0KICAgICAgICBiYXNlNjR1cmxFbmNvZGVXaXRob3V0UGFkZGluZyhKU09OLnN0cmluZ2lmeShwYXlsb2FkKSksDQogICAgICAgIHNpZ25hdHVyZQ0KICAgIF0uam9pbignLicpOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBSZXR1cm5zIG5hdmlnYXRvci51c2VyQWdlbnQgc3RyaW5nIG9yICcnIGlmIGl0J3Mgbm90IGRlZmluZWQuDQogKiBAcmV0dXJuIHVzZXIgYWdlbnQgc3RyaW5nDQogKi8NCmZ1bmN0aW9uIGdldFVBKCkgew0KICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yICE9PSAndW5kZWZpbmVkJyAmJg0KICAgICAgICB0eXBlb2YgbmF2aWdhdG9yWyd1c2VyQWdlbnQnXSA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgcmV0dXJuIG5hdmlnYXRvclsndXNlckFnZW50J107DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICByZXR1cm4gJyc7DQogICAgfQ0KfQ0KLyoqDQogKiBEZXRlY3QgQ29yZG92YSAvIFBob25lR2FwIC8gSW9uaWMgZnJhbWV3b3JrcyBvbiBhIG1vYmlsZSBkZXZpY2UuDQogKg0KICogRGVsaWJlcmF0ZWx5IGRvZXMgbm90IHJlbHkgb24gY2hlY2tpbmcgYGZpbGU6Ly9gIFVSTHMgKGFzIHRoaXMgZmFpbHMgUGhvbmVHYXANCiAqIGluIHRoZSBSaXBwbGUgZW11bGF0b3IpIG5vciBDb3Jkb3ZhIGBvbkRldmljZVJlYWR5YCwgd2hpY2ggd291bGQgbm9ybWFsbHkNCiAqIHdhaXQgZm9yIGEgY2FsbGJhY2suDQogKi8NCmZ1bmN0aW9uIGlzTW9iaWxlQ29yZG92YSgpIHsNCiAgICByZXR1cm4gKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmDQogICAgICAgIC8vIEB0cy1pZ25vcmUgU2V0dGluZyB1cCBhbiBicm9hZGx5IGFwcGxpY2FibGUgaW5kZXggc2lnbmF0dXJlIGZvciBXaW5kb3cNCiAgICAgICAgLy8ganVzdCB0byBkZWFsIHdpdGggdGhpcyBjYXNlIHdvdWxkIHByb2JhYmx5IGJlIGEgYmFkIGlkZWEuDQogICAgICAgICEhKHdpbmRvd1snY29yZG92YSddIHx8IHdpbmRvd1sncGhvbmVnYXAnXSB8fCB3aW5kb3dbJ1Bob25lR2FwJ10pICYmDQogICAgICAgIC9pb3N8aXBob25lfGlwb2R8aXBhZHxhbmRyb2lkfGJsYWNrYmVycnl8aWVtb2JpbGUvaS50ZXN0KGdldFVBKCkpKTsNCn0NCmZ1bmN0aW9uIGlzQnJvd3NlckV4dGVuc2lvbigpIHsNCiAgICBjb25zdCBydW50aW1lID0gdHlwZW9mIGNocm9tZSA9PT0gJ29iamVjdCcNCiAgICAgICAgPyBjaHJvbWUucnVudGltZQ0KICAgICAgICA6IHR5cGVvZiBicm93c2VyID09PSAnb2JqZWN0Jw0KICAgICAgICAgICAgPyBicm93c2VyLnJ1bnRpbWUNCiAgICAgICAgICAgIDogdW5kZWZpbmVkOw0KICAgIHJldHVybiB0eXBlb2YgcnVudGltZSA9PT0gJ29iamVjdCcgJiYgcnVudGltZS5pZCAhPT0gdW5kZWZpbmVkOw0KfQ0KLyoqDQogKiBEZXRlY3QgUmVhY3QgTmF0aXZlLg0KICoNCiAqIEByZXR1cm4gdHJ1ZSBpZiBSZWFjdE5hdGl2ZSBlbnZpcm9ubWVudCBpcyBkZXRlY3RlZC4NCiAqLw0KZnVuY3Rpb24gaXNSZWFjdE5hdGl2ZSgpIHsNCiAgICByZXR1cm4gKHR5cGVvZiBuYXZpZ2F0b3IgPT09ICdvYmplY3QnICYmIG5hdmlnYXRvclsncHJvZHVjdCddID09PSAnUmVhY3ROYXRpdmUnKTsNCn0NCi8qKiBEZXRlY3RzIEludGVybmV0IEV4cGxvcmVyLiAqLw0KZnVuY3Rpb24gaXNJRSgpIHsNCiAgICBjb25zdCB1YSA9IGdldFVBKCk7DQogICAgcmV0dXJuIHVhLmluZGV4T2YoJ01TSUUgJykgPj0gMCB8fCB1YS5pbmRleE9mKCdUcmlkZW50LycpID49IDA7DQp9DQovKioNCiAqIERldGVjdCB3aGV0aGVyIHRoZSBjdXJyZW50IFNESyBidWlsZCBpcyB0aGUgTm9kZSB2ZXJzaW9uLg0KICoNCiAqIEByZXR1cm4gdHJ1ZSBpZiBpdCdzIHRoZSBOb2RlIFNESyBidWlsZC4NCiAqLw0KZnVuY3Rpb24gaXNOb2RlU2RrKCkgew0KICAgIHJldHVybiBDT05TVEFOVFMuTk9ERV9BRE1JTiA9PT0gdHJ1ZTsNCn0NCi8qKg0KICogVGhpcyBtZXRob2QgY2hlY2tzIGlmIGluZGV4ZWREQiBpcyBzdXBwb3J0ZWQgYnkgY3VycmVudCBicm93c2VyL3NlcnZpY2Ugd29ya2VyIGNvbnRleHQNCiAqIEByZXR1cm4gdHJ1ZSBpZiBpbmRleGVkREIgaXMgc3VwcG9ydGVkIGJ5IGN1cnJlbnQgYnJvd3Nlci9zZXJ2aWNlIHdvcmtlciBjb250ZXh0DQogKi8NCmZ1bmN0aW9uIGlzSW5kZXhlZERCQXZhaWxhYmxlKCkgew0KICAgIHRyeSB7DQogICAgICAgIHJldHVybiB0eXBlb2YgaW5kZXhlZERCID09PSAnb2JqZWN0JzsNCiAgICB9DQogICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCn0NCi8qKg0KICogVGhpcyBtZXRob2QgdmFsaWRhdGVzIGJyb3dzZXIvc3cgY29udGV4dCBmb3IgaW5kZXhlZERCIGJ5IG9wZW5pbmcgYSBkdW1teSBpbmRleGVkREIgZGF0YWJhc2UgYW5kIHJlamVjdA0KICogaWYgZXJyb3JzIG9jY3VyIGR1cmluZyB0aGUgZGF0YWJhc2Ugb3BlbiBvcGVyYXRpb24uDQogKg0KICogQHRocm93cyBleGNlcHRpb24gaWYgY3VycmVudCBicm93c2VyL3N3IGNvbnRleHQgY2FuJ3QgcnVuIGlkYi5vcGVuIChleDogU2FmYXJpIGlmcmFtZSwgRmlyZWZveA0KICogcHJpdmF0ZSBicm93c2luZykNCiAqLw0KZnVuY3Rpb24gdmFsaWRhdGVJbmRleGVkREJPcGVuYWJsZSgpIHsNCiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgbGV0IHByZUV4aXN0ID0gdHJ1ZTsNCiAgICAgICAgICAgIGNvbnN0IERCX0NIRUNLX05BTUUgPSAndmFsaWRhdGUtYnJvd3Nlci1jb250ZXh0LWZvci1pbmRleGVkZGItYW5hbHl0aWNzLW1vZHVsZSc7DQogICAgICAgICAgICBjb25zdCByZXF1ZXN0ID0gc2VsZi5pbmRleGVkREIub3BlbihEQl9DSEVDS19OQU1FKTsNCiAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gKCkgPT4gew0KICAgICAgICAgICAgICAgIHJlcXVlc3QucmVzdWx0LmNsb3NlKCk7DQogICAgICAgICAgICAgICAgLy8gZGVsZXRlIGRhdGFiYXNlIG9ubHkgd2hlbiBpdCBkb2Vzbid0IHByZS1leGlzdA0KICAgICAgICAgICAgICAgIGlmICghcHJlRXhpc3QpIHsNCiAgICAgICAgICAgICAgICAgICAgc2VsZi5pbmRleGVkREIuZGVsZXRlRGF0YWJhc2UoREJfQ0hFQ0tfTkFNRSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgcHJlRXhpc3QgPSBmYWxzZTsNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgdmFyIF9hOw0KICAgICAgICAgICAgICAgIHJlamVjdCgoKF9hID0gcmVxdWVzdC5lcnJvcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm1lc3NhZ2UpIHx8ICcnKTsNCiAgICAgICAgICAgIH07DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICByZWplY3QoZXJyb3IpOw0KICAgICAgICB9DQogICAgfSk7DQp9DQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBAZmlsZW92ZXJ2aWV3IFN0YW5kYXJkaXplZCBGaXJlYmFzZSBFcnJvci4NCiAqDQogKiBVc2FnZToNCiAqDQogKiAgIC8vIFR5cGVzY3JpcHQgc3RyaW5nIGxpdGVyYWxzIGZvciB0eXBlLXNhZmUgY29kZXMNCiAqICAgdHlwZSBFcnIgPQ0KICogICAgICd1bmtub3duJyB8DQogKiAgICAgJ29iamVjdC1ub3QtZm91bmQnDQogKiAgICAgOw0KICoNCiAqICAgLy8gQ2xvc3VyZSBlbnVtIGZvciB0eXBlLXNhZmUgZXJyb3IgY29kZXMNCiAqICAgLy8gYXQtZW51bSB7c3RyaW5nfQ0KICogICB2YXIgRXJyID0gew0KICogICAgIFVOS05PV046ICd1bmtub3duJywNCiAqICAgICBPQkpFQ1RfTk9UX0ZPVU5EOiAnb2JqZWN0LW5vdC1mb3VuZCcsDQogKiAgIH0NCiAqDQogKiAgIGxldCBlcnJvcnM6IE1hcDxFcnIsIHN0cmluZz4gPSB7DQogKiAgICAgJ2dlbmVyaWMtZXJyb3InOiAiVW5rbm93biBlcnJvciIsDQogKiAgICAgJ2ZpbGUtbm90LWZvdW5kJzogIkNvdWxkIG5vdCBmaW5kIGZpbGU6IHskZmlsZX0iLA0KICogICB9Ow0KICoNCiAqICAgLy8gVHlwZS1zYWZlIGZ1bmN0aW9uIC0gbXVzdCBwYXNzIGEgdmFsaWQgZXJyb3IgY29kZSBhcyBwYXJhbS4NCiAqICAgbGV0IGVycm9yID0gbmV3IEVycm9yRmFjdG9yeTxFcnI+KCdzZXJ2aWNlJywgJ1NlcnZpY2UnLCBlcnJvcnMpOw0KICoNCiAqICAgLi4uDQogKiAgIHRocm93IGVycm9yLmNyZWF0ZShFcnIuR0VORVJJQyk7DQogKiAgIC4uLg0KICogICB0aHJvdyBlcnJvci5jcmVhdGUoRXJyLkZJTEVfTk9UX0ZPVU5ELCB7J2ZpbGUnOiBmaWxlTmFtZX0pOw0KICogICAuLi4NCiAqICAgLy8gU2VydmljZTogQ291bGQgbm90IGZpbGUgZmlsZTogZm9vLnR4dCAoc2VydmljZS9maWxlLW5vdC1mb3VuZCkuDQogKg0KICogICBjYXRjaCAoZSkgew0KICogICAgIGFzc2VydChlLm1lc3NhZ2UgPT09ICJDb3VsZCBub3QgZmluZCBmaWxlOiBmb28udHh0LiIpOw0KICogICAgIGlmICgoZSBhcyBGaXJlYmFzZUVycm9yKT8uY29kZSA9PT0gJ3NlcnZpY2UvZmlsZS1ub3QtZm91bmQnKSB7DQogKiAgICAgICBjb25zb2xlLmxvZygiQ291bGQgbm90IHJlYWQgZmlsZTogIiArIGVbJ2ZpbGUnXSk7DQogKiAgICAgfQ0KICogICB9DQogKi8NCmNvbnN0IEVSUk9SX05BTUUgPSAnRmlyZWJhc2VFcnJvcic7DQovLyBCYXNlZCBvbiBjb2RlIGZyb206DQovLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9FcnJvciNDdXN0b21fRXJyb3JfVHlwZXMNCmNsYXNzIEZpcmViYXNlRXJyb3IgZXh0ZW5kcyBFcnJvciB7DQogICAgY29uc3RydWN0b3IoDQogICAgLyoqIFRoZSBlcnJvciBjb2RlIGZvciB0aGlzIGVycm9yLiAqLw0KICAgIGNvZGUsIG1lc3NhZ2UsIA0KICAgIC8qKiBDdXN0b20gZGF0YSBmb3IgdGhpcyBlcnJvci4gKi8NCiAgICBjdXN0b21EYXRhKSB7DQogICAgICAgIHN1cGVyKG1lc3NhZ2UpOw0KICAgICAgICB0aGlzLmNvZGUgPSBjb2RlOw0KICAgICAgICB0aGlzLmN1c3RvbURhdGEgPSBjdXN0b21EYXRhOw0KICAgICAgICAvKiogVGhlIGN1c3RvbSBuYW1lIGZvciBhbGwgRmlyZWJhc2VFcnJvcnMuICovDQogICAgICAgIHRoaXMubmFtZSA9IEVSUk9SX05BTUU7DQogICAgICAgIC8vIEZpeCBGb3IgRVM1DQogICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9NaWNyb3NvZnQvVHlwZVNjcmlwdC13aWtpL2Jsb2IvbWFzdGVyL0JyZWFraW5nLUNoYW5nZXMubWQjZXh0ZW5kaW5nLWJ1aWx0LWlucy1saWtlLWVycm9yLWFycmF5LWFuZC1tYXAtbWF5LW5vLWxvbmdlci13b3JrDQogICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLCBGaXJlYmFzZUVycm9yLnByb3RvdHlwZSk7DQogICAgICAgIC8vIE1haW50YWlucyBwcm9wZXIgc3RhY2sgdHJhY2UgZm9yIHdoZXJlIG91ciBlcnJvciB3YXMgdGhyb3duLg0KICAgICAgICAvLyBPbmx5IGF2YWlsYWJsZSBvbiBWOC4NCiAgICAgICAgaWYgKEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKSB7DQogICAgICAgICAgICBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSh0aGlzLCBFcnJvckZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZSk7DQogICAgICAgIH0NCiAgICB9DQp9DQpjbGFzcyBFcnJvckZhY3Rvcnkgew0KICAgIGNvbnN0cnVjdG9yKHNlcnZpY2UsIHNlcnZpY2VOYW1lLCBlcnJvcnMpIHsNCiAgICAgICAgdGhpcy5zZXJ2aWNlID0gc2VydmljZTsNCiAgICAgICAgdGhpcy5zZXJ2aWNlTmFtZSA9IHNlcnZpY2VOYW1lOw0KICAgICAgICB0aGlzLmVycm9ycyA9IGVycm9yczsNCiAgICB9DQogICAgY3JlYXRlKGNvZGUsIC4uLmRhdGEpIHsNCiAgICAgICAgY29uc3QgY3VzdG9tRGF0YSA9IGRhdGFbMF0gfHwge307DQogICAgICAgIGNvbnN0IGZ1bGxDb2RlID0gYCR7dGhpcy5zZXJ2aWNlfS8ke2NvZGV9YDsNCiAgICAgICAgY29uc3QgdGVtcGxhdGUgPSB0aGlzLmVycm9yc1tjb2RlXTsNCiAgICAgICAgY29uc3QgbWVzc2FnZSA9IHRlbXBsYXRlID8gcmVwbGFjZVRlbXBsYXRlKHRlbXBsYXRlLCBjdXN0b21EYXRhKSA6ICdFcnJvcic7DQogICAgICAgIC8vIFNlcnZpY2UgTmFtZTogRXJyb3IgbWVzc2FnZSAoc2VydmljZS9jb2RlKS4NCiAgICAgICAgY29uc3QgZnVsbE1lc3NhZ2UgPSBgJHt0aGlzLnNlcnZpY2VOYW1lfTogJHttZXNzYWdlfSAoJHtmdWxsQ29kZX0pLmA7DQogICAgICAgIGNvbnN0IGVycm9yID0gbmV3IEZpcmViYXNlRXJyb3IoZnVsbENvZGUsIGZ1bGxNZXNzYWdlLCBjdXN0b21EYXRhKTsNCiAgICAgICAgcmV0dXJuIGVycm9yOw0KICAgIH0NCn0NCmZ1bmN0aW9uIHJlcGxhY2VUZW1wbGF0ZSh0ZW1wbGF0ZSwgZGF0YSkgew0KICAgIHJldHVybiB0ZW1wbGF0ZS5yZXBsYWNlKFBBVFRFUk4sIChfLCBrZXkpID0+IHsNCiAgICAgICAgY29uc3QgdmFsdWUgPSBkYXRhW2tleV07DQogICAgICAgIHJldHVybiB2YWx1ZSAhPSBudWxsID8gU3RyaW5nKHZhbHVlKSA6IGA8JHtrZXl9Pz5gOw0KICAgIH0pOw0KfQ0KY29uc3QgUEFUVEVSTiA9IC9ce1wkKFtefV0rKX0vZzsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogRXZhbHVhdGVzIGEgSlNPTiBzdHJpbmcgaW50byBhIGphdmFzY3JpcHQgb2JqZWN0Lg0KICoNCiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgQSBzdHJpbmcgY29udGFpbmluZyBKU09OLg0KICogQHJldHVybiB7Kn0gVGhlIGphdmFzY3JpcHQgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgc3BlY2lmaWVkIEpTT04uDQogKi8NCmZ1bmN0aW9uIGpzb25FdmFsKHN0cikgew0KICAgIHJldHVybiBKU09OLnBhcnNlKHN0cik7DQp9DQovKioNCiAqIFJldHVybnMgSlNPTiByZXByZXNlbnRpbmcgYSBqYXZhc2NyaXB0IG9iamVjdC4NCiAqIEBwYXJhbSB7Kn0gZGF0YSBKYXZhc2NyaXB0IG9iamVjdCB0byBiZSBzdHJpbmdpZmllZC4NCiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIEpTT04gY29udGVudHMgb2YgdGhlIG9iamVjdC4NCiAqLw0KZnVuY3Rpb24gc3RyaW5naWZ5KGRhdGEpIHsNCiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoZGF0YSk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIERlY29kZXMgYSBGaXJlYmFzZSBhdXRoLiB0b2tlbiBpbnRvIGNvbnN0aXR1ZW50IHBhcnRzLg0KICoNCiAqIE5vdGVzOg0KICogLSBNYXkgcmV0dXJuIHdpdGggaW52YWxpZCAvIGluY29tcGxldGUgY2xhaW1zIGlmIHRoZXJlJ3Mgbm8gbmF0aXZlIGJhc2U2NCBkZWNvZGluZyBzdXBwb3J0Lg0KICogLSBEb2Vzbid0IGNoZWNrIGlmIHRoZSB0b2tlbiBpcyBhY3R1YWxseSB2YWxpZC4NCiAqLw0KY29uc3QgZGVjb2RlJDQgPSBmdW5jdGlvbiAodG9rZW4pIHsNCiAgICBsZXQgaGVhZGVyID0ge30sIGNsYWltcyA9IHt9LCBkYXRhID0ge30sIHNpZ25hdHVyZSA9ICcnOw0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IHBhcnRzID0gdG9rZW4uc3BsaXQoJy4nKTsNCiAgICAgICAgaGVhZGVyID0ganNvbkV2YWwoYmFzZTY0RGVjb2RlKHBhcnRzWzBdKSB8fCAnJyk7DQogICAgICAgIGNsYWltcyA9IGpzb25FdmFsKGJhc2U2NERlY29kZShwYXJ0c1sxXSkgfHwgJycpOw0KICAgICAgICBzaWduYXR1cmUgPSBwYXJ0c1syXTsNCiAgICAgICAgZGF0YSA9IGNsYWltc1snZCddIHx8IHt9Ow0KICAgICAgICBkZWxldGUgY2xhaW1zWydkJ107DQogICAgfQ0KICAgIGNhdGNoIChlKSB7IH0NCiAgICByZXR1cm4gew0KICAgICAgICBoZWFkZXIsDQogICAgICAgIGNsYWltcywNCiAgICAgICAgZGF0YSwNCiAgICAgICAgc2lnbmF0dXJlDQogICAgfTsNCn07DQovKioNCiAqIERlY29kZXMgYSBGaXJlYmFzZSBhdXRoLiB0b2tlbiBhbmQgY2hlY2tzIHRoZSB2YWxpZGl0eSBvZiBpdHMgZm9ybWF0LiBFeHBlY3RzIGEgdmFsaWQgaXNzdWVkLWF0IHRpbWUuDQogKg0KICogTm90ZXM6DQogKiAtIE1heSByZXR1cm4gYSBmYWxzZSBuZWdhdGl2ZSBpZiB0aGVyZSdzIG5vIG5hdGl2ZSBiYXNlNjQgZGVjb2Rpbmcgc3VwcG9ydC4NCiAqIC0gRG9lc24ndCBjaGVjayBpZiB0aGUgdG9rZW4gaXMgYWN0dWFsbHkgdmFsaWQuDQogKi8NCmNvbnN0IGlzVmFsaWRGb3JtYXQgPSBmdW5jdGlvbiAodG9rZW4pIHsNCiAgICBjb25zdCBkZWNvZGVkID0gZGVjb2RlJDQodG9rZW4pLCBjbGFpbXMgPSBkZWNvZGVkLmNsYWltczsNCiAgICByZXR1cm4gISFjbGFpbXMgJiYgdHlwZW9mIGNsYWltcyA9PT0gJ29iamVjdCcgJiYgY2xhaW1zLmhhc093blByb3BlcnR5KCdpYXQnKTsNCn07DQovKioNCiAqIEF0dGVtcHRzIHRvIHBlZXIgaW50byBhbiBhdXRoIHRva2VuIGFuZCBkZXRlcm1pbmUgaWYgaXQncyBhbiBhZG1pbiBhdXRoIHRva2VuIGJ5IGxvb2tpbmcgYXQgdGhlIGNsYWltcyBwb3J0aW9uLg0KICoNCiAqIE5vdGVzOg0KICogLSBNYXkgcmV0dXJuIGEgZmFsc2UgbmVnYXRpdmUgaWYgdGhlcmUncyBubyBuYXRpdmUgYmFzZTY0IGRlY29kaW5nIHN1cHBvcnQuDQogKiAtIERvZXNuJ3QgY2hlY2sgaWYgdGhlIHRva2VuIGlzIGFjdHVhbGx5IHZhbGlkLg0KICovDQpjb25zdCBpc0FkbWluID0gZnVuY3Rpb24gKHRva2VuKSB7DQogICAgY29uc3QgY2xhaW1zID0gZGVjb2RlJDQodG9rZW4pLmNsYWltczsNCiAgICByZXR1cm4gdHlwZW9mIGNsYWltcyA9PT0gJ29iamVjdCcgJiYgY2xhaW1zWydhZG1pbiddID09PSB0cnVlOw0KfTsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmZ1bmN0aW9uIGNvbnRhaW5zKG9iaiwga2V5KSB7DQogICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSk7DQp9DQpmdW5jdGlvbiBzYWZlR2V0KG9iaiwga2V5KSB7DQogICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsNCiAgICAgICAgcmV0dXJuIG9ialtrZXldOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsNCiAgICB9DQp9DQpmdW5jdGlvbiBpc0VtcHR5KG9iaikgew0KICAgIGZvciAoY29uc3Qga2V5IGluIG9iaikgew0KICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiB0cnVlOw0KfQ0KZnVuY3Rpb24gbWFwJDEob2JqLCBmbiwgY29udGV4dE9iaikgew0KICAgIGNvbnN0IHJlcyA9IHt9Ow0KICAgIGZvciAoY29uc3Qga2V5IGluIG9iaikgew0KICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgew0KICAgICAgICAgICAgcmVzW2tleV0gPSBmbi5jYWxsKGNvbnRleHRPYmosIG9ialtrZXldLCBrZXksIG9iaik7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHJlczsNCn0NCi8qKg0KICogRGVlcCBlcXVhbCB0d28gb2JqZWN0cy4gU3VwcG9ydCBBcnJheXMgYW5kIE9iamVjdHMuDQogKi8NCmZ1bmN0aW9uIGRlZXBFcXVhbChhLCBiKSB7DQogICAgaWYgKGEgPT09IGIpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIGNvbnN0IGFLZXlzID0gT2JqZWN0LmtleXMoYSk7DQogICAgY29uc3QgYktleXMgPSBPYmplY3Qua2V5cyhiKTsNCiAgICBmb3IgKGNvbnN0IGsgb2YgYUtleXMpIHsNCiAgICAgICAgaWYgKCFiS2V5cy5pbmNsdWRlcyhrKSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IGFQcm9wID0gYVtrXTsNCiAgICAgICAgY29uc3QgYlByb3AgPSBiW2tdOw0KICAgICAgICBpZiAoaXNPYmplY3QkMShhUHJvcCkgJiYgaXNPYmplY3QkMShiUHJvcCkpIHsNCiAgICAgICAgICAgIGlmICghZGVlcEVxdWFsKGFQcm9wLCBiUHJvcCkpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoYVByb3AgIT09IGJQcm9wKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICB9DQogICAgZm9yIChjb25zdCBrIG9mIGJLZXlzKSB7DQogICAgICAgIGlmICghYUtleXMuaW5jbHVkZXMoaykpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gdHJ1ZTsNCn0NCmZ1bmN0aW9uIGlzT2JqZWN0JDEodGhpbmcpIHsNCiAgICByZXR1cm4gdGhpbmcgIT09IG51bGwgJiYgdHlwZW9mIHRoaW5nID09PSAnb2JqZWN0JzsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogUmV0dXJucyBhIHF1ZXJ5c3RyaW5nLWZvcm1hdHRlZCBzdHJpbmcgKGUuZy4gJmFyZz12YWwmYXJnMj12YWwyKSBmcm9tIGENCiAqIHBhcmFtcyBvYmplY3QgKGUuZy4ge2FyZzogJ3ZhbCcsIGFyZzI6ICd2YWwyJ30pDQogKiBOb3RlOiBZb3UgbXVzdCBwcmVwZW5kIGl0IHdpdGggPyB3aGVuIGFkZGluZyBpdCB0byBhIFVSTC4NCiAqLw0KZnVuY3Rpb24gcXVlcnlzdHJpbmckMShxdWVyeXN0cmluZ1BhcmFtcykgew0KICAgIGNvbnN0IHBhcmFtcyA9IFtdOw0KICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHF1ZXJ5c3RyaW5nUGFyYW1zKSkgew0KICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsNCiAgICAgICAgICAgIHZhbHVlLmZvckVhY2goYXJyYXlWYWwgPT4gew0KICAgICAgICAgICAgICAgIHBhcmFtcy5wdXNoKGVuY29kZVVSSUNvbXBvbmVudChrZXkpICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGFycmF5VmFsKSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHBhcmFtcy5wdXNoKGVuY29kZVVSSUNvbXBvbmVudChrZXkpICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKSk7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHBhcmFtcy5sZW5ndGggPyAnJicgKyBwYXJhbXMuam9pbignJicpIDogJyc7DQp9DQovKioNCiAqIERlY29kZXMgYSBxdWVyeXN0cmluZyAoZS5nLiA/YXJnPXZhbCZhcmcyPXZhbDIpIGludG8gYSBwYXJhbXMgb2JqZWN0DQogKiAoZS5nLiB7YXJnOiAndmFsJywgYXJnMjogJ3ZhbDInfSkNCiAqLw0KZnVuY3Rpb24gcXVlcnlzdHJpbmdEZWNvZGUocXVlcnlzdHJpbmcpIHsNCiAgICBjb25zdCBvYmogPSB7fTsNCiAgICBjb25zdCB0b2tlbnMgPSBxdWVyeXN0cmluZy5yZXBsYWNlKC9eXD8vLCAnJykuc3BsaXQoJyYnKTsNCiAgICB0b2tlbnMuZm9yRWFjaCh0b2tlbiA9PiB7DQogICAgICAgIGlmICh0b2tlbikgew0KICAgICAgICAgICAgY29uc3QgW2tleSwgdmFsdWVdID0gdG9rZW4uc3BsaXQoJz0nKTsNCiAgICAgICAgICAgIG9ialtkZWNvZGVVUklDb21wb25lbnQoa2V5KV0gPSBkZWNvZGVVUklDb21wb25lbnQodmFsdWUpOw0KICAgICAgICB9DQogICAgfSk7DQogICAgcmV0dXJuIG9iajsNCn0NCi8qKg0KICogRXh0cmFjdCB0aGUgcXVlcnkgc3RyaW5nIHBhcnQgb2YgYSBVUkwsIGluY2x1ZGluZyB0aGUgbGVhZGluZyBxdWVzdGlvbiBtYXJrIChpZiBwcmVzZW50KS4NCiAqLw0KZnVuY3Rpb24gZXh0cmFjdFF1ZXJ5c3RyaW5nKHVybCkgew0KICAgIGNvbnN0IHF1ZXJ5U3RhcnQgPSB1cmwuaW5kZXhPZignPycpOw0KICAgIGlmICghcXVlcnlTdGFydCkgew0KICAgICAgICByZXR1cm4gJyc7DQogICAgfQ0KICAgIGNvbnN0IGZyYWdtZW50U3RhcnQgPSB1cmwuaW5kZXhPZignIycsIHF1ZXJ5U3RhcnQpOw0KICAgIHJldHVybiB1cmwuc3Vic3RyaW5nKHF1ZXJ5U3RhcnQsIGZyYWdtZW50U3RhcnQgPiAwID8gZnJhZ21lbnRTdGFydCA6IHVuZGVmaW5lZCk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIEBmaWxlb3ZlcnZpZXcgU0hBLTEgY3J5cHRvZ3JhcGhpYyBoYXNoLg0KICogVmFyaWFibGUgbmFtZXMgZm9sbG93IHRoZSBub3RhdGlvbiBpbiBGSVBTIFBVQiAxODAtMzoNCiAqIGh0dHA6Ly9jc3JjLm5pc3QuZ292L3B1YmxpY2F0aW9ucy9maXBzL2ZpcHMxODAtMy9maXBzMTgwLTNfZmluYWwucGRmLg0KICoNCiAqIFVzYWdlOg0KICogICB2YXIgc2hhMSA9IG5ldyBzaGExKCk7DQogKiAgIHNoYTEudXBkYXRlKGJ5dGVzKTsNCiAqICAgdmFyIGhhc2ggPSBzaGExLmRpZ2VzdCgpOw0KICoNCiAqIFBlcmZvcm1hbmNlOg0KICogICBDaHJvbWUgMjM6ICAgfjQwMCBNYml0L3MNCiAqICAgRmlyZWZveCAxNjogIH4yNTAgTWJpdC9zDQogKg0KICovDQovKioNCiAqIFNIQS0xIGNyeXB0b2dyYXBoaWMgaGFzaCBjb25zdHJ1Y3Rvci4NCiAqDQogKiBUaGUgcHJvcGVydGllcyBkZWNsYXJlZCBoZXJlIGFyZSBkaXNjdXNzZWQgaW4gdGhlIGFib3ZlIGFsZ29yaXRobSBkb2N1bWVudC4NCiAqIEBjb25zdHJ1Y3Rvcg0KICogQGZpbmFsDQogKiBAc3RydWN0DQogKi8NCmNsYXNzIFNoYTEgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICAvKioNCiAgICAgICAgICogSG9sZHMgdGhlIHByZXZpb3VzIHZhbHVlcyBvZiBhY2N1bXVsYXRlZCB2YXJpYWJsZXMgYS1lIGluIHRoZSBjb21wcmVzc18NCiAgICAgICAgICogZnVuY3Rpb24uDQogICAgICAgICAqIEBwcml2YXRlDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLmNoYWluXyA9IFtdOw0KICAgICAgICAvKioNCiAgICAgICAgICogQSBidWZmZXIgaG9sZGluZyB0aGUgcGFydGlhbGx5IGNvbXB1dGVkIGhhc2ggcmVzdWx0Lg0KICAgICAgICAgKiBAcHJpdmF0ZQ0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5idWZfID0gW107DQogICAgICAgIC8qKg0KICAgICAgICAgKiBBbiBhcnJheSBvZiA4MCBieXRlcywgZWFjaCBhIHBhcnQgb2YgdGhlIG1lc3NhZ2UgdG8gYmUgaGFzaGVkLiAgUmVmZXJyZWQgdG8NCiAgICAgICAgICogYXMgdGhlIG1lc3NhZ2Ugc2NoZWR1bGUgaW4gdGhlIGRvY3MuDQogICAgICAgICAqIEBwcml2YXRlDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLldfID0gW107DQogICAgICAgIC8qKg0KICAgICAgICAgKiBDb250YWlucyBkYXRhIG5lZWRlZCB0byBwYWQgbWVzc2FnZXMgbGVzcyB0aGFuIDY0IGJ5dGVzLg0KICAgICAgICAgKiBAcHJpdmF0ZQ0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5wYWRfID0gW107DQogICAgICAgIC8qKg0KICAgICAgICAgKiBAcHJpdmF0ZSB7bnVtYmVyfQ0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5pbmJ1Zl8gPSAwOw0KICAgICAgICAvKioNCiAgICAgICAgICogQHByaXZhdGUge251bWJlcn0NCiAgICAgICAgICovDQogICAgICAgIHRoaXMudG90YWxfID0gMDsNCiAgICAgICAgdGhpcy5ibG9ja1NpemUgPSA1MTIgLyA4Ow0KICAgICAgICB0aGlzLnBhZF9bMF0gPSAxMjg7DQogICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgdGhpcy5ibG9ja1NpemU7ICsraSkgew0KICAgICAgICAgICAgdGhpcy5wYWRfW2ldID0gMDsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnJlc2V0KCk7DQogICAgfQ0KICAgIHJlc2V0KCkgew0KICAgICAgICB0aGlzLmNoYWluX1swXSA9IDB4Njc0NTIzMDE7DQogICAgICAgIHRoaXMuY2hhaW5fWzFdID0gMHhlZmNkYWI4OTsNCiAgICAgICAgdGhpcy5jaGFpbl9bMl0gPSAweDk4YmFkY2ZlOw0KICAgICAgICB0aGlzLmNoYWluX1szXSA9IDB4MTAzMjU0NzY7DQogICAgICAgIHRoaXMuY2hhaW5fWzRdID0gMHhjM2QyZTFmMDsNCiAgICAgICAgdGhpcy5pbmJ1Zl8gPSAwOw0KICAgICAgICB0aGlzLnRvdGFsXyA9IDA7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEludGVybmFsIGNvbXByZXNzIGhlbHBlciBmdW5jdGlvbi4NCiAgICAgKiBAcGFyYW0gYnVmIEJsb2NrIHRvIGNvbXByZXNzLg0KICAgICAqIEBwYXJhbSBvZmZzZXQgT2Zmc2V0IG9mIHRoZSBibG9jayBpbiB0aGUgYnVmZmVyLg0KICAgICAqIEBwcml2YXRlDQogICAgICovDQogICAgY29tcHJlc3NfKGJ1Ziwgb2Zmc2V0KSB7DQogICAgICAgIGlmICghb2Zmc2V0KSB7DQogICAgICAgICAgICBvZmZzZXQgPSAwOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IFcgPSB0aGlzLldfOw0KICAgICAgICAvLyBnZXQgMTYgYmlnIGVuZGlhbiB3b3Jkcw0KICAgICAgICBpZiAodHlwZW9mIGJ1ZiA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTY7IGkrKykgew0KICAgICAgICAgICAgICAgIC8vIFRPRE8odXNlcik6IFtidWcgODE0MDEyMl0gUmVjZW50IHZlcnNpb25zIG9mIFNhZmFyaSBmb3IgTWFjIE9TIGFuZCBpT1MNCiAgICAgICAgICAgICAgICAvLyBoYXZlIGEgYnVnIHRoYXQgdHVybnMgdGhlIHBvc3QtaW5jcmVtZW50ICsrIG9wZXJhdG9yIGludG8gcHJlLWluY3JlbWVudA0KICAgICAgICAgICAgICAgIC8vIGR1cmluZyBKSVQgY29tcGlsYXRpb24uICBXZSBoYXZlIGNvZGUgdGhhdCBkZXBlbmRzIGhlYXZpbHkgb24gU0hBLTEgZm9yDQogICAgICAgICAgICAgICAgLy8gY29ycmVjdG5lc3MgYW5kIHdoaWNoIGlzIGFmZmVjdGVkIGJ5IHRoaXMgYnVnLCBzbyBJJ3ZlIHJlbW92ZWQgYWxsIHVzZXMNCiAgICAgICAgICAgICAgICAvLyBvZiBwb3N0LWluY3JlbWVudCArKyBpbiB3aGljaCB0aGUgcmVzdWx0IHZhbHVlIGlzIHVzZWQuICBXZSBjYW4gcmV2ZXJ0DQogICAgICAgICAgICAgICAgLy8gdGhpcyBjaGFuZ2Ugb25jZSB0aGUgU2FmYXJpIGJ1Zw0KICAgICAgICAgICAgICAgIC8vIChodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTA5MDM2KSBoYXMgYmVlbiBmaXhlZCBhbmQNCiAgICAgICAgICAgICAgICAvLyBtb3N0IGNsaWVudHMgaGF2ZSBiZWVuIHVwZGF0ZWQuDQogICAgICAgICAgICAgICAgV1tpXSA9DQogICAgICAgICAgICAgICAgICAgIChidWYuY2hhckNvZGVBdChvZmZzZXQpIDw8IDI0KSB8DQogICAgICAgICAgICAgICAgICAgICAgICAoYnVmLmNoYXJDb2RlQXQob2Zmc2V0ICsgMSkgPDwgMTYpIHwNCiAgICAgICAgICAgICAgICAgICAgICAgIChidWYuY2hhckNvZGVBdChvZmZzZXQgKyAyKSA8PCA4KSB8DQogICAgICAgICAgICAgICAgICAgICAgICBidWYuY2hhckNvZGVBdChvZmZzZXQgKyAzKTsNCiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gNDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTY7IGkrKykgew0KICAgICAgICAgICAgICAgIFdbaV0gPQ0KICAgICAgICAgICAgICAgICAgICAoYnVmW29mZnNldF0gPDwgMjQpIHwNCiAgICAgICAgICAgICAgICAgICAgICAgIChidWZbb2Zmc2V0ICsgMV0gPDwgMTYpIHwNCiAgICAgICAgICAgICAgICAgICAgICAgIChidWZbb2Zmc2V0ICsgMl0gPDwgOCkgfA0KICAgICAgICAgICAgICAgICAgICAgICAgYnVmW29mZnNldCArIDNdOw0KICAgICAgICAgICAgICAgIG9mZnNldCArPSA0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIC8vIGV4cGFuZCB0byA4MCB3b3Jkcw0KICAgICAgICBmb3IgKGxldCBpID0gMTY7IGkgPCA4MDsgaSsrKSB7DQogICAgICAgICAgICBjb25zdCB0ID0gV1tpIC0gM10gXiBXW2kgLSA4XSBeIFdbaSAtIDE0XSBeIFdbaSAtIDE2XTsNCiAgICAgICAgICAgIFdbaV0gPSAoKHQgPDwgMSkgfCAodCA+Pj4gMzEpKSAmIDB4ZmZmZmZmZmY7DQogICAgICAgIH0NCiAgICAgICAgbGV0IGEgPSB0aGlzLmNoYWluX1swXTsNCiAgICAgICAgbGV0IGIgPSB0aGlzLmNoYWluX1sxXTsNCiAgICAgICAgbGV0IGMgPSB0aGlzLmNoYWluX1syXTsNCiAgICAgICAgbGV0IGQgPSB0aGlzLmNoYWluX1szXTsNCiAgICAgICAgbGV0IGUgPSB0aGlzLmNoYWluX1s0XTsNCiAgICAgICAgbGV0IGYsIGs7DQogICAgICAgIC8vIFRPRE8odXNlcik6IFRyeSB0byB1bnJvbGwgdGhpcyBsb29wIHRvIHNwZWVkIHVwIHRoZSBjb21wdXRhdGlvbi4NCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA4MDsgaSsrKSB7DQogICAgICAgICAgICBpZiAoaSA8IDQwKSB7DQogICAgICAgICAgICAgICAgaWYgKGkgPCAyMCkgew0KICAgICAgICAgICAgICAgICAgICBmID0gZCBeIChiICYgKGMgXiBkKSk7DQogICAgICAgICAgICAgICAgICAgIGsgPSAweDVhODI3OTk5Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgZiA9IGIgXiBjIF4gZDsNCiAgICAgICAgICAgICAgICAgICAgayA9IDB4NmVkOWViYTE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgaWYgKGkgPCA2MCkgew0KICAgICAgICAgICAgICAgICAgICBmID0gKGIgJiBjKSB8IChkICYgKGIgfCBjKSk7DQogICAgICAgICAgICAgICAgICAgIGsgPSAweDhmMWJiY2RjOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgZiA9IGIgXiBjIF4gZDsNCiAgICAgICAgICAgICAgICAgICAgayA9IDB4Y2E2MmMxZDY7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgdCA9ICgoKGEgPDwgNSkgfCAoYSA+Pj4gMjcpKSArIGYgKyBlICsgayArIFdbaV0pICYgMHhmZmZmZmZmZjsNCiAgICAgICAgICAgIGUgPSBkOw0KICAgICAgICAgICAgZCA9IGM7DQogICAgICAgICAgICBjID0gKChiIDw8IDMwKSB8IChiID4+PiAyKSkgJiAweGZmZmZmZmZmOw0KICAgICAgICAgICAgYiA9IGE7DQogICAgICAgICAgICBhID0gdDsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmNoYWluX1swXSA9ICh0aGlzLmNoYWluX1swXSArIGEpICYgMHhmZmZmZmZmZjsNCiAgICAgICAgdGhpcy5jaGFpbl9bMV0gPSAodGhpcy5jaGFpbl9bMV0gKyBiKSAmIDB4ZmZmZmZmZmY7DQogICAgICAgIHRoaXMuY2hhaW5fWzJdID0gKHRoaXMuY2hhaW5fWzJdICsgYykgJiAweGZmZmZmZmZmOw0KICAgICAgICB0aGlzLmNoYWluX1szXSA9ICh0aGlzLmNoYWluX1szXSArIGQpICYgMHhmZmZmZmZmZjsNCiAgICAgICAgdGhpcy5jaGFpbl9bNF0gPSAodGhpcy5jaGFpbl9bNF0gKyBlKSAmIDB4ZmZmZmZmZmY7DQogICAgfQ0KICAgIHVwZGF0ZShieXRlcywgbGVuZ3RoKSB7DQogICAgICAgIC8vIFRPRE8oam9obmxlbnopOiB0aWdodGVuIHRoZSBmdW5jdGlvbiBzaWduYXR1cmUgYW5kIHJlbW92ZSB0aGlzIGNoZWNrDQogICAgICAgIGlmIChieXRlcyA9PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgaWYgKGxlbmd0aCA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICBsZW5ndGggPSBieXRlcy5sZW5ndGg7DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgbGVuZ3RoTWludXNCbG9jayA9IGxlbmd0aCAtIHRoaXMuYmxvY2tTaXplOw0KICAgICAgICBsZXQgbiA9IDA7DQogICAgICAgIC8vIFVzaW5nIGxvY2FsIGluc3RlYWQgb2YgbWVtYmVyIHZhcmlhYmxlcyBnaXZlcyB+NSUgc3BlZWR1cCBvbiBGaXJlZm94IDE2Lg0KICAgICAgICBjb25zdCBidWYgPSB0aGlzLmJ1Zl87DQogICAgICAgIGxldCBpbmJ1ZiA9IHRoaXMuaW5idWZfOw0KICAgICAgICAvLyBUaGUgb3V0ZXIgd2hpbGUgbG9vcCBzaG91bGQgZXhlY3V0ZSBhdCBtb3N0IHR3aWNlLg0KICAgICAgICB3aGlsZSAobiA8IGxlbmd0aCkgew0KICAgICAgICAgICAgLy8gV2hlbiB3ZSBoYXZlIG5vIGRhdGEgaW4gdGhlIGJsb2NrIHRvIHRvcCB1cCwgd2UgY2FuIGRpcmVjdGx5IHByb2Nlc3MgdGhlDQogICAgICAgICAgICAvLyBpbnB1dCBidWZmZXIgKGFzc3VtaW5nIGl0IGNvbnRhaW5zIHN1ZmZpY2llbnQgZGF0YSkuIFRoaXMgZ2l2ZXMgfjI1JQ0KICAgICAgICAgICAgLy8gc3BlZWR1cCBvbiBDaHJvbWUgMjMgYW5kIH4xNSUgc3BlZWR1cCBvbiBGaXJlZm94IDE2LCBidXQgcmVxdWlyZXMgdGhhdA0KICAgICAgICAgICAgLy8gdGhlIGRhdGEgaXMgcHJvdmlkZWQgaW4gbGFyZ2UgY2h1bmtzIChvciBpbiBtdWx0aXBsZXMgb2YgNjQgYnl0ZXMpLg0KICAgICAgICAgICAgaWYgKGluYnVmID09PSAwKSB7DQogICAgICAgICAgICAgICAgd2hpbGUgKG4gPD0gbGVuZ3RoTWludXNCbG9jaykgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXByZXNzXyhieXRlcywgbik7DQogICAgICAgICAgICAgICAgICAgIG4gKz0gdGhpcy5ibG9ja1NpemU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHR5cGVvZiBieXRlcyA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgICAgICB3aGlsZSAobiA8IGxlbmd0aCkgew0KICAgICAgICAgICAgICAgICAgICBidWZbaW5idWZdID0gYnl0ZXMuY2hhckNvZGVBdChuKTsNCiAgICAgICAgICAgICAgICAgICAgKytpbmJ1ZjsNCiAgICAgICAgICAgICAgICAgICAgKytuOw0KICAgICAgICAgICAgICAgICAgICBpZiAoaW5idWYgPT09IHRoaXMuYmxvY2tTaXplKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXByZXNzXyhidWYpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaW5idWYgPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gSnVtcCB0byB0aGUgb3V0ZXIgbG9vcCBzbyB3ZSB1c2UgdGhlIGZ1bGwtYmxvY2sgb3B0aW1pemF0aW9uLg0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICB3aGlsZSAobiA8IGxlbmd0aCkgew0KICAgICAgICAgICAgICAgICAgICBidWZbaW5idWZdID0gYnl0ZXNbbl07DQogICAgICAgICAgICAgICAgICAgICsraW5idWY7DQogICAgICAgICAgICAgICAgICAgICsrbjsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGluYnVmID09PSB0aGlzLmJsb2NrU2l6ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wcmVzc18oYnVmKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGluYnVmID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEp1bXAgdG8gdGhlIG91dGVyIGxvb3Agc28gd2UgdXNlIHRoZSBmdWxsLWJsb2NrIG9wdGltaXphdGlvbi4NCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHRoaXMuaW5idWZfID0gaW5idWY7DQogICAgICAgIHRoaXMudG90YWxfICs9IGxlbmd0aDsNCiAgICB9DQogICAgLyoqIEBvdmVycmlkZSAqLw0KICAgIGRpZ2VzdCgpIHsNCiAgICAgICAgY29uc3QgZGlnZXN0ID0gW107DQogICAgICAgIGxldCB0b3RhbEJpdHMgPSB0aGlzLnRvdGFsXyAqIDg7DQogICAgICAgIC8vIEFkZCBwYWQgMHg4MCAweDAwKi4NCiAgICAgICAgaWYgKHRoaXMuaW5idWZfIDwgNTYpIHsNCiAgICAgICAgICAgIHRoaXMudXBkYXRlKHRoaXMucGFkXywgNTYgLSB0aGlzLmluYnVmXyk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICB0aGlzLnVwZGF0ZSh0aGlzLnBhZF8sIHRoaXMuYmxvY2tTaXplIC0gKHRoaXMuaW5idWZfIC0gNTYpKTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBBZGQgIyBiaXRzLg0KICAgICAgICBmb3IgKGxldCBpID0gdGhpcy5ibG9ja1NpemUgLSAxOyBpID49IDU2OyBpLS0pIHsNCiAgICAgICAgICAgIHRoaXMuYnVmX1tpXSA9IHRvdGFsQml0cyAmIDI1NTsNCiAgICAgICAgICAgIHRvdGFsQml0cyAvPSAyNTY7IC8vIERvbid0IHVzZSBiaXQtc2hpZnRpbmcgaGVyZSENCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmNvbXByZXNzXyh0aGlzLmJ1Zl8pOw0KICAgICAgICBsZXQgbiA9IDA7DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTsgaSsrKSB7DQogICAgICAgICAgICBmb3IgKGxldCBqID0gMjQ7IGogPj0gMDsgaiAtPSA4KSB7DQogICAgICAgICAgICAgICAgZGlnZXN0W25dID0gKHRoaXMuY2hhaW5fW2ldID4+IGopICYgMjU1Ow0KICAgICAgICAgICAgICAgICsrbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZGlnZXN0Ow0KICAgIH0NCn0KCi8qKg0KICogSGVscGVyIHRvIG1ha2UgYSBTdWJzY3JpYmUgZnVuY3Rpb24gKGp1c3QgbGlrZSBQcm9taXNlIGhlbHBzIG1ha2UgYQ0KICogVGhlbmFibGUpLg0KICoNCiAqIEBwYXJhbSBleGVjdXRvciBGdW5jdGlvbiB3aGljaCBjYW4gbWFrZSBjYWxscyB0byBhIHNpbmdsZSBPYnNlcnZlcg0KICogICAgIGFzIGEgcHJveHkuDQogKiBAcGFyYW0gb25Ob09ic2VydmVycyBDYWxsYmFjayB3aGVuIGNvdW50IG9mIE9ic2VydmVycyBnb2VzIHRvIHplcm8uDQogKi8NCmZ1bmN0aW9uIGNyZWF0ZVN1YnNjcmliZShleGVjdXRvciwgb25Ob09ic2VydmVycykgew0KICAgIGNvbnN0IHByb3h5ID0gbmV3IE9ic2VydmVyUHJveHkoZXhlY3V0b3IsIG9uTm9PYnNlcnZlcnMpOw0KICAgIHJldHVybiBwcm94eS5zdWJzY3JpYmUuYmluZChwcm94eSk7DQp9DQovKioNCiAqIEltcGxlbWVudCBmYW4tb3V0IGZvciBhbnkgbnVtYmVyIG9mIE9ic2VydmVycyBhdHRhY2hlZCB2aWEgYSBzdWJzY3JpYmUNCiAqIGZ1bmN0aW9uLg0KICovDQpjbGFzcyBPYnNlcnZlclByb3h5IHsNCiAgICAvKioNCiAgICAgKiBAcGFyYW0gZXhlY3V0b3IgRnVuY3Rpb24gd2hpY2ggY2FuIG1ha2UgY2FsbHMgdG8gYSBzaW5nbGUgT2JzZXJ2ZXINCiAgICAgKiAgICAgYXMgYSBwcm94eS4NCiAgICAgKiBAcGFyYW0gb25Ob09ic2VydmVycyBDYWxsYmFjayB3aGVuIGNvdW50IG9mIE9ic2VydmVycyBnb2VzIHRvIHplcm8uDQogICAgICovDQogICAgY29uc3RydWN0b3IoZXhlY3V0b3IsIG9uTm9PYnNlcnZlcnMpIHsNCiAgICAgICAgdGhpcy5vYnNlcnZlcnMgPSBbXTsNCiAgICAgICAgdGhpcy51bnN1YnNjcmliZXMgPSBbXTsNCiAgICAgICAgdGhpcy5vYnNlcnZlckNvdW50ID0gMDsNCiAgICAgICAgLy8gTWljcm8tdGFzayBzY2hlZHVsaW5nIGJ5IGNhbGxpbmcgdGFzay50aGVuKCkuDQogICAgICAgIHRoaXMudGFzayA9IFByb21pc2UucmVzb2x2ZSgpOw0KICAgICAgICB0aGlzLmZpbmFsaXplZCA9IGZhbHNlOw0KICAgICAgICB0aGlzLm9uTm9PYnNlcnZlcnMgPSBvbk5vT2JzZXJ2ZXJzOw0KICAgICAgICAvLyBDYWxsIHRoZSBleGVjdXRvciBhc3luY2hyb25vdXNseSBzbyBzdWJzY3JpYmVycyB0aGF0IGFyZSBjYWxsZWQNCiAgICAgICAgLy8gc3luY2hyb25vdXNseSBhZnRlciB0aGUgY3JlYXRpb24gb2YgdGhlIHN1YnNjcmliZSBmdW5jdGlvbg0KICAgICAgICAvLyBjYW4gc3RpbGwgcmVjZWl2ZSB0aGUgdmVyeSBmaXJzdCB2YWx1ZSBnZW5lcmF0ZWQgaW4gdGhlIGV4ZWN1dG9yLg0KICAgICAgICB0aGlzLnRhc2sNCiAgICAgICAgICAgIC50aGVuKCgpID0+IHsNCiAgICAgICAgICAgIGV4ZWN1dG9yKHRoaXMpOw0KICAgICAgICB9KQ0KICAgICAgICAgICAgLmNhdGNoKGUgPT4gew0KICAgICAgICAgICAgdGhpcy5lcnJvcihlKTsNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIG5leHQodmFsdWUpIHsNCiAgICAgICAgdGhpcy5mb3JFYWNoT2JzZXJ2ZXIoKG9ic2VydmVyKSA9PiB7DQogICAgICAgICAgICBvYnNlcnZlci5uZXh0KHZhbHVlKTsNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGVycm9yKGVycm9yKSB7DQogICAgICAgIHRoaXMuZm9yRWFjaE9ic2VydmVyKChvYnNlcnZlcikgPT4gew0KICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IoZXJyb3IpOw0KICAgICAgICB9KTsNCiAgICAgICAgdGhpcy5jbG9zZShlcnJvcik7DQogICAgfQ0KICAgIGNvbXBsZXRlKCkgew0KICAgICAgICB0aGlzLmZvckVhY2hPYnNlcnZlcigob2JzZXJ2ZXIpID0+IHsNCiAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7DQogICAgICAgIH0pOw0KICAgICAgICB0aGlzLmNsb3NlKCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFN1YnNjcmliZSBmdW5jdGlvbiB0aGF0IGNhbiBiZSB1c2VkIHRvIGFkZCBhbiBPYnNlcnZlciB0byB0aGUgZmFuLW91dCBsaXN0Lg0KICAgICAqDQogICAgICogLSBXZSByZXF1aXJlIHRoYXQgbm8gZXZlbnQgaXMgc2VudCB0byBhIHN1YnNjcmliZXIgc3ljaHJvbm91c2x5IHRvIHRoZWlyDQogICAgICogICBjYWxsIHRvIHN1YnNjcmliZSgpLg0KICAgICAqLw0KICAgIHN1YnNjcmliZShuZXh0T3JPYnNlcnZlciwgZXJyb3IsIGNvbXBsZXRlKSB7DQogICAgICAgIGxldCBvYnNlcnZlcjsNCiAgICAgICAgaWYgKG5leHRPck9ic2VydmVyID09PSB1bmRlZmluZWQgJiYNCiAgICAgICAgICAgIGVycm9yID09PSB1bmRlZmluZWQgJiYNCiAgICAgICAgICAgIGNvbXBsZXRlID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTWlzc2luZyBPYnNlcnZlci4nKTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBBc3NlbWJsZSBhbiBPYnNlcnZlciBvYmplY3Qgd2hlbiBwYXNzZWQgYXMgY2FsbGJhY2sgZnVuY3Rpb25zLg0KICAgICAgICBpZiAoaW1wbGVtZW50c0FueU1ldGhvZHMobmV4dE9yT2JzZXJ2ZXIsIFsNCiAgICAgICAgICAgICduZXh0JywNCiAgICAgICAgICAgICdlcnJvcicsDQogICAgICAgICAgICAnY29tcGxldGUnDQogICAgICAgIF0pKSB7DQogICAgICAgICAgICBvYnNlcnZlciA9IG5leHRPck9ic2VydmVyOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgb2JzZXJ2ZXIgPSB7DQogICAgICAgICAgICAgICAgbmV4dDogbmV4dE9yT2JzZXJ2ZXIsDQogICAgICAgICAgICAgICAgZXJyb3IsDQogICAgICAgICAgICAgICAgY29tcGxldGUNCiAgICAgICAgICAgIH07DQogICAgICAgIH0NCiAgICAgICAgaWYgKG9ic2VydmVyLm5leHQgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dCA9IG5vb3AkMzsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob2JzZXJ2ZXIuZXJyb3IgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IgPSBub29wJDM7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG9ic2VydmVyLmNvbXBsZXRlID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlID0gbm9vcCQzOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IHVuc3ViID0gdGhpcy51bnN1YnNjcmliZU9uZS5iaW5kKHRoaXMsIHRoaXMub2JzZXJ2ZXJzLmxlbmd0aCk7DQogICAgICAgIC8vIEF0dGVtcHQgdG8gc3Vic2NyaWJlIHRvIGEgdGVybWluYXRlZCBPYnNlcnZhYmxlIC0gd2UNCiAgICAgICAgLy8ganVzdCByZXNwb25kIHRvIHRoZSBPYnNlcnZlciB3aXRoIHRoZSBmaW5hbCBlcnJvciBvciBjb21wbGV0ZQ0KICAgICAgICAvLyBldmVudC4NCiAgICAgICAgaWYgKHRoaXMuZmluYWxpemVkKSB7DQogICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzDQogICAgICAgICAgICB0aGlzLnRhc2sudGhlbigoKSA9PiB7DQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZmluYWxFcnJvcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IodGhpcy5maW5hbEVycm9yKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gbm90aGluZw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLm9ic2VydmVycy5wdXNoKG9ic2VydmVyKTsNCiAgICAgICAgcmV0dXJuIHVuc3ViOw0KICAgIH0NCiAgICAvLyBVbnN1YnNjcmliZSBpcyBzeW5jaHJvbm91cyAtIHdlIGd1YXJhbnRlZSB0aGF0IG5vIGV2ZW50cyBhcmUgc2VudCB0bw0KICAgIC8vIGFueSB1bnN1YnNjcmliZWQgT2JzZXJ2ZXIuDQogICAgdW5zdWJzY3JpYmVPbmUoaSkgew0KICAgICAgICBpZiAodGhpcy5vYnNlcnZlcnMgPT09IHVuZGVmaW5lZCB8fCB0aGlzLm9ic2VydmVyc1tpXSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgZGVsZXRlIHRoaXMub2JzZXJ2ZXJzW2ldOw0KICAgICAgICB0aGlzLm9ic2VydmVyQ291bnQgLT0gMTsNCiAgICAgICAgaWYgKHRoaXMub2JzZXJ2ZXJDb3VudCA9PT0gMCAmJiB0aGlzLm9uTm9PYnNlcnZlcnMgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgdGhpcy5vbk5vT2JzZXJ2ZXJzKHRoaXMpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGZvckVhY2hPYnNlcnZlcihmbikgew0KICAgICAgICBpZiAodGhpcy5maW5hbGl6ZWQpIHsNCiAgICAgICAgICAgIC8vIEFscmVhZHkgY2xvc2VkIGJ5IHByZXZpb3VzIGV2ZW50Li4uLmp1c3QgZWF0IHRoZSBhZGRpdGlvbmFsIHZhbHVlcy4NCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICAvLyBTaW5jZSBzZW5kT25lIGNhbGxzIGFzeW5jaHJvbm91c2x5IC0gdGhlcmUgaXMgbm8gY2hhbmNlIHRoYXQNCiAgICAgICAgLy8gdGhpcy5vYnNlcnZlcnMgd2lsbCBiZWNvbWUgdW5kZWZpbmVkLg0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMub2JzZXJ2ZXJzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICB0aGlzLnNlbmRPbmUoaSwgZm4pOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8vIENhbGwgdGhlIE9ic2VydmVyIHZpYSBvbmUgb2YgaXQncyBjYWxsYmFjayBmdW5jdGlvbi4gV2UgYXJlIGNhcmVmdWwgdG8NCiAgICAvLyBjb25maXJtIHRoYXQgdGhlIG9ic2VydmUgaGFzIG5vdCBiZWVuIHVuc3Vic2NyaWJlZCBzaW5jZSB0aGlzIGFzeW5jaHJvbm91cw0KICAgIC8vIGZ1bmN0aW9uIGhhZCBiZWVuIHF1ZXVlZC4NCiAgICBzZW5kT25lKGksIGZuKSB7DQogICAgICAgIC8vIEV4ZWN1dGUgdGhlIGNhbGxiYWNrIGFzeW5jaHJvbm91c2x5DQogICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZmxvYXRpbmctcHJvbWlzZXMNCiAgICAgICAgdGhpcy50YXNrLnRoZW4oKCkgPT4gew0KICAgICAgICAgICAgaWYgKHRoaXMub2JzZXJ2ZXJzICE9PSB1bmRlZmluZWQgJiYgdGhpcy5vYnNlcnZlcnNbaV0gIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgIGZuKHRoaXMub2JzZXJ2ZXJzW2ldKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JlIGV4Y2VwdGlvbnMgcmFpc2VkIGluIE9ic2VydmVycyBvciBtaXNzaW5nIG1ldGhvZHMgb2YgYW4NCiAgICAgICAgICAgICAgICAgICAgLy8gT2JzZXJ2ZXIuDQogICAgICAgICAgICAgICAgICAgIC8vIExvZyBlcnJvciB0byBjb25zb2xlLiBiLzMxNDA0ODA2DQogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29uc29sZS5lcnJvcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGNsb3NlKGVycikgew0KICAgICAgICBpZiAodGhpcy5maW5hbGl6ZWQpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmZpbmFsaXplZCA9IHRydWU7DQogICAgICAgIGlmIChlcnIgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgdGhpcy5maW5hbEVycm9yID0gZXJyOw0KICAgICAgICB9DQogICAgICAgIC8vIFByb3h5IGlzIG5vIGxvbmdlciBuZWVkZWQgLSBnYXJiYWdlIGNvbGxlY3QgcmVmZXJlbmNlcw0KICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzDQogICAgICAgIHRoaXMudGFzay50aGVuKCgpID0+IHsNCiAgICAgICAgICAgIHRoaXMub2JzZXJ2ZXJzID0gdW5kZWZpbmVkOw0KICAgICAgICAgICAgdGhpcy5vbk5vT2JzZXJ2ZXJzID0gdW5kZWZpbmVkOw0KICAgICAgICB9KTsNCiAgICB9DQp9DQovKioNCiAqIFJldHVybiB0cnVlIGlmIHRoZSBvYmplY3QgcGFzc2VkIGluIGltcGxlbWVudHMgYW55IG9mIHRoZSBuYW1lZCBtZXRob2RzLg0KICovDQpmdW5jdGlvbiBpbXBsZW1lbnRzQW55TWV0aG9kcyhvYmosIG1ldGhvZHMpIHsNCiAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgfHwgb2JqID09PSBudWxsKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgZm9yIChjb25zdCBtZXRob2Qgb2YgbWV0aG9kcykgew0KICAgICAgICBpZiAobWV0aG9kIGluIG9iaiAmJiB0eXBlb2Ygb2JqW21ldGhvZF0gPT09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBmYWxzZTsNCn0NCmZ1bmN0aW9uIG5vb3AkMygpIHsNCiAgICAvLyBkbyBub3RoaW5nDQp9Ci8qKg0KICogR2VuZXJhdGVzIGEgc3RyaW5nIHRvIHByZWZpeCBhbiBlcnJvciBtZXNzYWdlIGFib3V0IGZhaWxlZCBhcmd1bWVudCB2YWxpZGF0aW9uDQogKg0KICogQHBhcmFtIGZuTmFtZSBUaGUgZnVuY3Rpb24gbmFtZQ0KICogQHBhcmFtIGFyZ05hbWUgVGhlIG5hbWUgb2YgdGhlIGFyZ3VtZW50DQogKiBAcmV0dXJuIFRoZSBwcmVmaXggdG8gYWRkIHRvIHRoZSBlcnJvciB0aHJvd24gZm9yIHZhbGlkYXRpb24uDQogKi8NCmZ1bmN0aW9uIGVycm9yUHJlZml4KGZuTmFtZSwgYXJnTmFtZSkgew0KICAgIHJldHVybiBgJHtmbk5hbWV9IGZhaWxlZDogJHthcmdOYW1lfSBhcmd1bWVudCBgOw0KfQ0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8vIENvZGUgb3JpZ2luYWxseSBjYW1lIGZyb20gZ29vZy5jcnlwdC5zdHJpbmdUb1V0ZjhCeXRlQXJyYXksIGJ1dCBmb3Igc29tZSByZWFzb24gdGhleQ0KLy8gYXV0b21hdGljYWxseSByZXBsYWNlZCAnXHJcbicgd2l0aCAnXG4nLCBhbmQgdGhleSBkaWRuJ3QgaGFuZGxlIHN1cnJvZ2F0ZSBwYWlycywNCi8vIHNvIGl0J3MgYmVlbiBtb2RpZmllZC4NCi8vIE5vdGUgdGhhdCBub3QgYWxsIFVuaWNvZGUgY2hhcmFjdGVycyBhcHBlYXIgYXMgc2luZ2xlIGNoYXJhY3RlcnMgaW4gSmF2YVNjcmlwdCBzdHJpbmdzLg0KLy8gZnJvbUNoYXJDb2RlIHJldHVybnMgdGhlIFVURi0xNiBlbmNvZGluZyBvZiBhIGNoYXJhY3RlciAtIHNvIHNvbWUgVW5pY29kZSBjaGFyYWN0ZXJzDQovLyB1c2UgMiBjaGFyYWN0ZXJzIGluIEphdmFzY3JpcHQuICBBbGwgNC1ieXRlIFVURi04IGNoYXJhY3RlcnMgYmVnaW4gd2l0aCBhIGZpcnN0DQovLyBjaGFyYWN0ZXIgaW4gdGhlIHJhbmdlIDB4RDgwMCAtIDB4REJGRiAodGhlIGZpcnN0IGNoYXJhY3RlciBvZiBhIHNvLWNhbGxlZCBzdXJyb2dhdGUNCi8vIHBhaXIpLg0KLy8gU2VlIGh0dHA6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi81LjEvI3NlYy0xNS4xLjMNCi8qKg0KICogQHBhcmFtIHtzdHJpbmd9IHN0cg0KICogQHJldHVybiB7QXJyYXl9DQogKi8NCmNvbnN0IHN0cmluZ1RvQnl0ZUFycmF5ID0gZnVuY3Rpb24gKHN0cikgew0KICAgIGNvbnN0IG91dCA9IFtdOw0KICAgIGxldCBwID0gMDsNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykgew0KICAgICAgICBsZXQgYyA9IHN0ci5jaGFyQ29kZUF0KGkpOw0KICAgICAgICAvLyBJcyB0aGlzIHRoZSBsZWFkIHN1cnJvZ2F0ZSBpbiBhIHN1cnJvZ2F0ZSBwYWlyPw0KICAgICAgICBpZiAoYyA+PSAweGQ4MDAgJiYgYyA8PSAweGRiZmYpIHsNCiAgICAgICAgICAgIGNvbnN0IGhpZ2ggPSBjIC0gMHhkODAwOyAvLyB0aGUgaGlnaCAxMCBiaXRzLg0KICAgICAgICAgICAgaSsrOw0KICAgICAgICAgICAgYXNzZXJ0KGkgPCBzdHIubGVuZ3RoLCAnU3Vycm9nYXRlIHBhaXIgbWlzc2luZyB0cmFpbCBzdXJyb2dhdGUuJyk7DQogICAgICAgICAgICBjb25zdCBsb3cgPSBzdHIuY2hhckNvZGVBdChpKSAtIDB4ZGMwMDsgLy8gdGhlIGxvdyAxMCBiaXRzLg0KICAgICAgICAgICAgYyA9IDB4MTAwMDAgKyAoaGlnaCA8PCAxMCkgKyBsb3c7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGMgPCAxMjgpIHsNCiAgICAgICAgICAgIG91dFtwKytdID0gYzsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChjIDwgMjA0OCkgew0KICAgICAgICAgICAgb3V0W3ArK10gPSAoYyA+PiA2KSB8IDE5MjsNCiAgICAgICAgICAgIG91dFtwKytdID0gKGMgJiA2MykgfCAxMjg7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoYyA8IDY1NTM2KSB7DQogICAgICAgICAgICBvdXRbcCsrXSA9IChjID4+IDEyKSB8IDIyNDsNCiAgICAgICAgICAgIG91dFtwKytdID0gKChjID4+IDYpICYgNjMpIHwgMTI4Ow0KICAgICAgICAgICAgb3V0W3ArK10gPSAoYyAmIDYzKSB8IDEyODsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIG91dFtwKytdID0gKGMgPj4gMTgpIHwgMjQwOw0KICAgICAgICAgICAgb3V0W3ArK10gPSAoKGMgPj4gMTIpICYgNjMpIHwgMTI4Ow0KICAgICAgICAgICAgb3V0W3ArK10gPSAoKGMgPj4gNikgJiA2MykgfCAxMjg7DQogICAgICAgICAgICBvdXRbcCsrXSA9IChjICYgNjMpIHwgMTI4Ow0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBvdXQ7DQp9Ow0KLyoqDQogKiBDYWxjdWxhdGUgbGVuZ3RoIHdpdGhvdXQgYWN0dWFsbHkgY29udmVydGluZzsgdXNlZnVsIGZvciBkb2luZyBjaGVhcGVyIHZhbGlkYXRpb24uDQogKiBAcGFyYW0ge3N0cmluZ30gc3RyDQogKiBAcmV0dXJuIHtudW1iZXJ9DQogKi8NCmNvbnN0IHN0cmluZ0xlbmd0aCA9IGZ1bmN0aW9uIChzdHIpIHsNCiAgICBsZXQgcCA9IDA7DQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgY29uc3QgYyA9IHN0ci5jaGFyQ29kZUF0KGkpOw0KICAgICAgICBpZiAoYyA8IDEyOCkgew0KICAgICAgICAgICAgcCsrOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKGMgPCAyMDQ4KSB7DQogICAgICAgICAgICBwICs9IDI7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoYyA+PSAweGQ4MDAgJiYgYyA8PSAweGRiZmYpIHsNCiAgICAgICAgICAgIC8vIExlYWQgc3Vycm9nYXRlIG9mIGEgc3Vycm9nYXRlIHBhaXIuICBUaGUgcGFpciB0b2dldGhlciB3aWxsIHRha2UgNCBieXRlcyB0byByZXByZXNlbnQuDQogICAgICAgICAgICBwICs9IDQ7DQogICAgICAgICAgICBpKys7IC8vIHNraXAgdHJhaWwgc3Vycm9nYXRlLg0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcCArPSAzOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBwOw0KfTsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmZ1bmN0aW9uIGdldE1vZHVsYXJJbnN0YW5jZShzZXJ2aWNlKSB7DQogICAgaWYgKHNlcnZpY2UgJiYgc2VydmljZS5fZGVsZWdhdGUpIHsNCiAgICAgICAgcmV0dXJuIHNlcnZpY2UuX2RlbGVnYXRlOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgcmV0dXJuIHNlcnZpY2U7DQogICAgfQ0KfQoKLyoqDQogKiBDb21wb25lbnQgZm9yIHNlcnZpY2UgbmFtZSBULCBlLmcuIGBhdXRoYCwgYGF1dGgtaW50ZXJuYWxgDQogKi8NCmNsYXNzIENvbXBvbmVudCB7DQogICAgLyoqDQogICAgICoNCiAgICAgKiBAcGFyYW0gbmFtZSBUaGUgcHVibGljIHNlcnZpY2UgbmFtZSwgZS5nLiBhcHAsIGF1dGgsIGZpcmVzdG9yZSwgZGF0YWJhc2UNCiAgICAgKiBAcGFyYW0gaW5zdGFuY2VGYWN0b3J5IFNlcnZpY2UgZmFjdG9yeSByZXNwb25zaWJsZSBmb3IgY3JlYXRpbmcgdGhlIHB1YmxpYyBpbnRlcmZhY2UNCiAgICAgKiBAcGFyYW0gdHlwZSB3aGV0aGVyIHRoZSBzZXJ2aWNlIHByb3ZpZGVkIGJ5IHRoZSBjb21wb25lbnQgaXMgcHVibGljIG9yIHByaXZhdGUNCiAgICAgKi8NCiAgICBjb25zdHJ1Y3RvcihuYW1lLCBpbnN0YW5jZUZhY3RvcnksIHR5cGUpIHsNCiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTsNCiAgICAgICAgdGhpcy5pbnN0YW5jZUZhY3RvcnkgPSBpbnN0YW5jZUZhY3Rvcnk7DQogICAgICAgIHRoaXMudHlwZSA9IHR5cGU7DQogICAgICAgIHRoaXMubXVsdGlwbGVJbnN0YW5jZXMgPSBmYWxzZTsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFByb3BlcnRpZXMgdG8gYmUgYWRkZWQgdG8gdGhlIHNlcnZpY2UgbmFtZXNwYWNlDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnNlcnZpY2VQcm9wcyA9IHt9Ow0KICAgICAgICB0aGlzLmluc3RhbnRpYXRpb25Nb2RlID0gIkxBWlkiIC8qIEluc3RhbnRpYXRpb25Nb2RlLkxBWlkgKi87DQogICAgICAgIHRoaXMub25JbnN0YW5jZUNyZWF0ZWQgPSBudWxsOw0KICAgIH0NCiAgICBzZXRJbnN0YW50aWF0aW9uTW9kZShtb2RlKSB7DQogICAgICAgIHRoaXMuaW5zdGFudGlhdGlvbk1vZGUgPSBtb2RlOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogICAgc2V0TXVsdGlwbGVJbnN0YW5jZXMobXVsdGlwbGVJbnN0YW5jZXMpIHsNCiAgICAgICAgdGhpcy5tdWx0aXBsZUluc3RhbmNlcyA9IG11bHRpcGxlSW5zdGFuY2VzOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogICAgc2V0U2VydmljZVByb3BzKHByb3BzKSB7DQogICAgICAgIHRoaXMuc2VydmljZVByb3BzID0gcHJvcHM7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgICBzZXRJbnN0YW5jZUNyZWF0ZWRDYWxsYmFjayhjYWxsYmFjaykgew0KICAgICAgICB0aGlzLm9uSW5zdGFuY2VDcmVhdGVkID0gY2FsbGJhY2s7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNvbnN0IERFRkFVTFRfRU5UUllfTkFNRSQxID0gJ1tERUZBVUxUXSc7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIFByb3ZpZGVyIGZvciBpbnN0YW5jZSBmb3Igc2VydmljZSBuYW1lIFQsIGUuZy4gJ2F1dGgnLCAnYXV0aC1pbnRlcm5hbCcNCiAqIE5hbWVTZXJ2aWNlTWFwcGluZ1tUXSBpcyBhbiBhbGlhcyBmb3IgdGhlIHR5cGUgb2YgdGhlIGluc3RhbmNlDQogKi8NCmNsYXNzIFByb3ZpZGVyIHsNCiAgICBjb25zdHJ1Y3RvcihuYW1lLCBjb250YWluZXIpIHsNCiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTsNCiAgICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7DQogICAgICAgIHRoaXMuY29tcG9uZW50ID0gbnVsbDsNCiAgICAgICAgdGhpcy5pbnN0YW5jZXMgPSBuZXcgTWFwKCk7DQogICAgICAgIHRoaXMuaW5zdGFuY2VzRGVmZXJyZWQgPSBuZXcgTWFwKCk7DQogICAgICAgIHRoaXMuaW5zdGFuY2VzT3B0aW9ucyA9IG5ldyBNYXAoKTsNCiAgICAgICAgdGhpcy5vbkluaXRDYWxsYmFja3MgPSBuZXcgTWFwKCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEBwYXJhbSBpZGVudGlmaWVyIEEgcHJvdmlkZXIgY2FuIHByb3ZpZGUgbXVsaXRwbGUgaW5zdGFuY2VzIG9mIGEgc2VydmljZQ0KICAgICAqIGlmIHRoaXMuY29tcG9uZW50Lm11bHRpcGxlSW5zdGFuY2VzIGlzIHRydWUuDQogICAgICovDQogICAgZ2V0KGlkZW50aWZpZXIpIHsNCiAgICAgICAgLy8gaWYgbXVsdGlwbGVJbnN0YW5jZXMgaXMgbm90IHN1cHBvcnRlZCwgdXNlIHRoZSBkZWZhdWx0IG5hbWUNCiAgICAgICAgY29uc3Qgbm9ybWFsaXplZElkZW50aWZpZXIgPSB0aGlzLm5vcm1hbGl6ZUluc3RhbmNlSWRlbnRpZmllcihpZGVudGlmaWVyKTsNCiAgICAgICAgaWYgKCF0aGlzLmluc3RhbmNlc0RlZmVycmVkLmhhcyhub3JtYWxpemVkSWRlbnRpZmllcikpIHsNCiAgICAgICAgICAgIGNvbnN0IGRlZmVycmVkID0gbmV3IERlZmVycmVkKCk7DQogICAgICAgICAgICB0aGlzLmluc3RhbmNlc0RlZmVycmVkLnNldChub3JtYWxpemVkSWRlbnRpZmllciwgZGVmZXJyZWQpOw0KICAgICAgICAgICAgaWYgKHRoaXMuaXNJbml0aWFsaXplZChub3JtYWxpemVkSWRlbnRpZmllcikgfHwNCiAgICAgICAgICAgICAgICB0aGlzLnNob3VsZEF1dG9Jbml0aWFsaXplKCkpIHsNCiAgICAgICAgICAgICAgICAvLyBpbml0aWFsaXplIHRoZSBzZXJ2aWNlIGlmIGl0IGNhbiBiZSBhdXRvLWluaXRpYWxpemVkDQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLmdldE9ySW5pdGlhbGl6ZVNlcnZpY2Uoew0KICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2VJZGVudGlmaWVyOiBub3JtYWxpemVkSWRlbnRpZmllcg0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGluc3RhbmNlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGluc3RhbmNlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgICAgICAvLyB3aGVuIHRoZSBpbnN0YW5jZSBmYWN0b3J5IHRocm93cyBhbiBleGNlcHRpb24gZHVyaW5nIGdldCgpLCBpdCBzaG91bGQgbm90IGNhdXNlDQogICAgICAgICAgICAgICAgICAgIC8vIGEgZmF0YWwgZXJyb3IuIFdlIGp1c3QgcmV0dXJuIHRoZSB1bnJlc29sdmVkIHByb21pc2UgaW4gdGhpcyBjYXNlLg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpcy5pbnN0YW5jZXNEZWZlcnJlZC5nZXQobm9ybWFsaXplZElkZW50aWZpZXIpLnByb21pc2U7DQogICAgfQ0KICAgIGdldEltbWVkaWF0ZShvcHRpb25zKSB7DQogICAgICAgIHZhciBfYTsNCiAgICAgICAgLy8gaWYgbXVsdGlwbGVJbnN0YW5jZXMgaXMgbm90IHN1cHBvcnRlZCwgdXNlIHRoZSBkZWZhdWx0IG5hbWUNCiAgICAgICAgY29uc3Qgbm9ybWFsaXplZElkZW50aWZpZXIgPSB0aGlzLm5vcm1hbGl6ZUluc3RhbmNlSWRlbnRpZmllcihvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMuaWRlbnRpZmllcik7DQogICAgICAgIGNvbnN0IG9wdGlvbmFsID0gKF9hID0gb3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLm9wdGlvbmFsKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBmYWxzZTsNCiAgICAgICAgaWYgKHRoaXMuaXNJbml0aWFsaXplZChub3JtYWxpemVkSWRlbnRpZmllcikgfHwNCiAgICAgICAgICAgIHRoaXMuc2hvdWxkQXV0b0luaXRpYWxpemUoKSkgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRPckluaXRpYWxpemVTZXJ2aWNlKHsNCiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2VJZGVudGlmaWVyOiBub3JtYWxpemVkSWRlbnRpZmllcg0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICBpZiAob3B0aW9uYWwpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIC8vIEluIGNhc2UgYSBjb21wb25lbnQgaXMgbm90IGluaXRpYWxpemVkIGFuZCBzaG91bGQvY2FuIG5vdCBiZSBhdXRvLWluaXRpYWxpemVkIGF0IHRoZSBtb21lbnQsIHJldHVybiBudWxsIGlmIHRoZSBvcHRpb25hbCBmbGFnIGlzIHNldCwgb3IgdGhyb3cNCiAgICAgICAgICAgIGlmIChvcHRpb25hbCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoYFNlcnZpY2UgJHt0aGlzLm5hbWV9IGlzIG5vdCBhdmFpbGFibGVgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBnZXRDb21wb25lbnQoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmNvbXBvbmVudDsNCiAgICB9DQogICAgc2V0Q29tcG9uZW50KGNvbXBvbmVudCkgew0KICAgICAgICBpZiAoY29tcG9uZW50Lm5hbWUgIT09IHRoaXMubmFtZSkgew0KICAgICAgICAgICAgdGhyb3cgRXJyb3IoYE1pc21hdGNoaW5nIENvbXBvbmVudCAke2NvbXBvbmVudC5uYW1lfSBmb3IgUHJvdmlkZXIgJHt0aGlzLm5hbWV9LmApOw0KICAgICAgICB9DQogICAgICAgIGlmICh0aGlzLmNvbXBvbmVudCkgew0KICAgICAgICAgICAgdGhyb3cgRXJyb3IoYENvbXBvbmVudCBmb3IgJHt0aGlzLm5hbWV9IGhhcyBhbHJlYWR5IGJlZW4gcHJvdmlkZWRgKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmNvbXBvbmVudCA9IGNvbXBvbmVudDsNCiAgICAgICAgLy8gcmV0dXJuIGVhcmx5IHdpdGhvdXQgYXR0ZW1wdGluZyB0byBpbml0aWFsaXplIHRoZSBjb21wb25lbnQgaWYgdGhlIGNvbXBvbmVudCByZXF1aXJlcyBleHBsaWNpdCBpbml0aWFsaXphdGlvbiAoY2FsbGluZyBgUHJvdmlkZXIuaW5pdGlhbGl6ZSgpYCkNCiAgICAgICAgaWYgKCF0aGlzLnNob3VsZEF1dG9Jbml0aWFsaXplKCkpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICAvLyBpZiB0aGUgc2VydmljZSBpcyBlYWdlciwgaW5pdGlhbGl6ZSB0aGUgZGVmYXVsdCBpbnN0YW5jZQ0KICAgICAgICBpZiAoaXNDb21wb25lbnRFYWdlcihjb21wb25lbnQpKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIHRoaXMuZ2V0T3JJbml0aWFsaXplU2VydmljZSh7IGluc3RhbmNlSWRlbnRpZmllcjogREVGQVVMVF9FTlRSWV9OQU1FJDEgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIC8vIHdoZW4gdGhlIGluc3RhbmNlIGZhY3RvcnkgZm9yIGFuIGVhZ2VyIENvbXBvbmVudCB0aHJvd3MgYW4gZXhjZXB0aW9uIGR1cmluZyB0aGUgZWFnZXINCiAgICAgICAgICAgICAgICAvLyBpbml0aWFsaXphdGlvbiwgaXQgc2hvdWxkIG5vdCBjYXVzZSBhIGZhdGFsIGVycm9yLg0KICAgICAgICAgICAgICAgIC8vIFRPRE86IEludmVzdGlnYXRlIGlmIHdlIG5lZWQgdG8gbWFrZSBpdCBjb25maWd1cmFibGUsIGJlY2F1c2Ugc29tZSBjb21wb25lbnQgbWF5IHdhbnQgdG8gY2F1c2UNCiAgICAgICAgICAgICAgICAvLyBhIGZhdGFsIGVycm9yIGluIHRoaXMgY2FzZT8NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAvLyBDcmVhdGUgc2VydmljZSBpbnN0YW5jZXMgZm9yIHRoZSBwZW5kaW5nIHByb21pc2VzIGFuZCByZXNvbHZlIHRoZW0NCiAgICAgICAgLy8gTk9URTogaWYgdGhpcy5tdWx0aXBsZUluc3RhbmNlcyBpcyBmYWxzZSwgb25seSB0aGUgZGVmYXVsdCBpbnN0YW5jZSB3aWxsIGJlIGNyZWF0ZWQNCiAgICAgICAgLy8gYW5kIGFsbCBwcm9taXNlcyB3aXRoIHJlc29sdmUgd2l0aCBpdCByZWdhcmRsZXNzIG9mIHRoZSBpZGVudGlmaWVyLg0KICAgICAgICBmb3IgKGNvbnN0IFtpbnN0YW5jZUlkZW50aWZpZXIsIGluc3RhbmNlRGVmZXJyZWRdIG9mIHRoaXMuaW5zdGFuY2VzRGVmZXJyZWQuZW50cmllcygpKSB7DQogICAgICAgICAgICBjb25zdCBub3JtYWxpemVkSWRlbnRpZmllciA9IHRoaXMubm9ybWFsaXplSW5zdGFuY2VJZGVudGlmaWVyKGluc3RhbmNlSWRlbnRpZmllcik7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIC8vIGBnZXRPckluaXRpYWxpemVTZXJ2aWNlKClgIHNob3VsZCBhbHdheXMgcmV0dXJuIGEgdmFsaWQgaW5zdGFuY2Ugc2luY2UgYSBjb21wb25lbnQgaXMgZ3VhcmFudGVlZC4gdXNlICEgdG8gbWFrZSB0eXBlc2NyaXB0IGhhcHB5Lg0KICAgICAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5nZXRPckluaXRpYWxpemVTZXJ2aWNlKHsNCiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2VJZGVudGlmaWVyOiBub3JtYWxpemVkSWRlbnRpZmllcg0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIGluc3RhbmNlRGVmZXJyZWQucmVzb2x2ZShpbnN0YW5jZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIC8vIHdoZW4gdGhlIGluc3RhbmNlIGZhY3RvcnkgdGhyb3dzIGFuIGV4Y2VwdGlvbiwgaXQgc2hvdWxkIG5vdCBjYXVzZQ0KICAgICAgICAgICAgICAgIC8vIGEgZmF0YWwgZXJyb3IuIFdlIGp1c3QgbGVhdmUgdGhlIHByb21pc2UgdW5yZXNvbHZlZC4NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBjbGVhckluc3RhbmNlKGlkZW50aWZpZXIgPSBERUZBVUxUX0VOVFJZX05BTUUkMSkgew0KICAgICAgICB0aGlzLmluc3RhbmNlc0RlZmVycmVkLmRlbGV0ZShpZGVudGlmaWVyKTsNCiAgICAgICAgdGhpcy5pbnN0YW5jZXNPcHRpb25zLmRlbGV0ZShpZGVudGlmaWVyKTsNCiAgICAgICAgdGhpcy5pbnN0YW5jZXMuZGVsZXRlKGlkZW50aWZpZXIpOw0KICAgIH0NCiAgICAvLyBhcHAuZGVsZXRlKCkgd2lsbCBjYWxsIHRoaXMgbWV0aG9kIG9uIGV2ZXJ5IHByb3ZpZGVyIHRvIGRlbGV0ZSB0aGUgc2VydmljZXMNCiAgICAvLyBUT0RPOiBzaG91bGQgd2UgbWFyayB0aGUgcHJvdmlkZXIgYXMgZGVsZXRlZD8NCiAgICBhc3luYyBkZWxldGUoKSB7DQogICAgICAgIGNvbnN0IHNlcnZpY2VzID0gQXJyYXkuZnJvbSh0aGlzLmluc3RhbmNlcy52YWx1ZXMoKSk7DQogICAgICAgIGF3YWl0IFByb21pc2UuYWxsKFsNCiAgICAgICAgICAgIC4uLnNlcnZpY2VzDQogICAgICAgICAgICAgICAgLmZpbHRlcihzZXJ2aWNlID0+ICdJTlRFUk5BTCcgaW4gc2VydmljZSkgLy8gbGVnYWN5IHNlcnZpY2VzDQogICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgICAgICAgICAubWFwKHNlcnZpY2UgPT4gc2VydmljZS5JTlRFUk5BTC5kZWxldGUoKSksDQogICAgICAgICAgICAuLi5zZXJ2aWNlcw0KICAgICAgICAgICAgICAgIC5maWx0ZXIoc2VydmljZSA9PiAnX2RlbGV0ZScgaW4gc2VydmljZSkgLy8gbW9kdWxhcml6ZWQgc2VydmljZXMNCiAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgICAgICAgICAgICAgIC5tYXAoc2VydmljZSA9PiBzZXJ2aWNlLl9kZWxldGUoKSkNCiAgICAgICAgXSk7DQogICAgfQ0KICAgIGlzQ29tcG9uZW50U2V0KCkgew0KICAgICAgICByZXR1cm4gdGhpcy5jb21wb25lbnQgIT0gbnVsbDsNCiAgICB9DQogICAgaXNJbml0aWFsaXplZChpZGVudGlmaWVyID0gREVGQVVMVF9FTlRSWV9OQU1FJDEpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2VzLmhhcyhpZGVudGlmaWVyKTsNCiAgICB9DQogICAgZ2V0T3B0aW9ucyhpZGVudGlmaWVyID0gREVGQVVMVF9FTlRSWV9OQU1FJDEpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2VzT3B0aW9ucy5nZXQoaWRlbnRpZmllcikgfHwge307DQogICAgfQ0KICAgIGluaXRpYWxpemUob3B0cyA9IHt9KSB7DQogICAgICAgIGNvbnN0IHsgb3B0aW9ucyA9IHt9IH0gPSBvcHRzOw0KICAgICAgICBjb25zdCBub3JtYWxpemVkSWRlbnRpZmllciA9IHRoaXMubm9ybWFsaXplSW5zdGFuY2VJZGVudGlmaWVyKG9wdHMuaW5zdGFuY2VJZGVudGlmaWVyKTsNCiAgICAgICAgaWYgKHRoaXMuaXNJbml0aWFsaXplZChub3JtYWxpemVkSWRlbnRpZmllcikpIHsNCiAgICAgICAgICAgIHRocm93IEVycm9yKGAke3RoaXMubmFtZX0oJHtub3JtYWxpemVkSWRlbnRpZmllcn0pIGhhcyBhbHJlYWR5IGJlZW4gaW5pdGlhbGl6ZWRgKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXRoaXMuaXNDb21wb25lbnRTZXQoKSkgew0KICAgICAgICAgICAgdGhyb3cgRXJyb3IoYENvbXBvbmVudCAke3RoaXMubmFtZX0gaGFzIG5vdCBiZWVuIHJlZ2lzdGVyZWQgeWV0YCk7DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLmdldE9ySW5pdGlhbGl6ZVNlcnZpY2Uoew0KICAgICAgICAgICAgaW5zdGFuY2VJZGVudGlmaWVyOiBub3JtYWxpemVkSWRlbnRpZmllciwNCiAgICAgICAgICAgIG9wdGlvbnMNCiAgICAgICAgfSk7DQogICAgICAgIC8vIHJlc29sdmUgYW55IHBlbmRpbmcgcHJvbWlzZSB3YWl0aW5nIGZvciB0aGUgc2VydmljZSBpbnN0YW5jZQ0KICAgICAgICBmb3IgKGNvbnN0IFtpbnN0YW5jZUlkZW50aWZpZXIsIGluc3RhbmNlRGVmZXJyZWRdIG9mIHRoaXMuaW5zdGFuY2VzRGVmZXJyZWQuZW50cmllcygpKSB7DQogICAgICAgICAgICBjb25zdCBub3JtYWxpemVkRGVmZXJyZWRJZGVudGlmaWVyID0gdGhpcy5ub3JtYWxpemVJbnN0YW5jZUlkZW50aWZpZXIoaW5zdGFuY2VJZGVudGlmaWVyKTsNCiAgICAgICAgICAgIGlmIChub3JtYWxpemVkSWRlbnRpZmllciA9PT0gbm9ybWFsaXplZERlZmVycmVkSWRlbnRpZmllcikgew0KICAgICAgICAgICAgICAgIGluc3RhbmNlRGVmZXJyZWQucmVzb2x2ZShpbnN0YW5jZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGluc3RhbmNlOw0KICAgIH0NCiAgICAvKioNCiAgICAgKg0KICAgICAqIEBwYXJhbSBjYWxsYmFjayAtIGEgZnVuY3Rpb24gdGhhdCB3aWxsIGJlIGludm9rZWQgIGFmdGVyIHRoZSBwcm92aWRlciBoYXMgYmVlbiBpbml0aWFsaXplZCBieSBjYWxsaW5nIHByb3ZpZGVyLmluaXRpYWxpemUoKS4NCiAgICAgKiBUaGUgZnVuY3Rpb24gaXMgaW52b2tlZCBTWU5DSFJPTk9VU0xZLCBzbyBpdCBzaG91bGQgbm90IGV4ZWN1dGUgYW55IGxvbmdydW5uaW5nIHRhc2tzIGluIG9yZGVyIHRvIG5vdCBibG9jayB0aGUgcHJvZ3JhbS4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBpZGVudGlmaWVyIEFuIG9wdGlvbmFsIGluc3RhbmNlIGlkZW50aWZpZXINCiAgICAgKiBAcmV0dXJucyBhIGZ1bmN0aW9uIHRvIHVucmVnaXN0ZXIgdGhlIGNhbGxiYWNrDQogICAgICovDQogICAgb25Jbml0KGNhbGxiYWNrLCBpZGVudGlmaWVyKSB7DQogICAgICAgIHZhciBfYTsNCiAgICAgICAgY29uc3Qgbm9ybWFsaXplZElkZW50aWZpZXIgPSB0aGlzLm5vcm1hbGl6ZUluc3RhbmNlSWRlbnRpZmllcihpZGVudGlmaWVyKTsNCiAgICAgICAgY29uc3QgZXhpc3RpbmdDYWxsYmFja3MgPSAoX2EgPSB0aGlzLm9uSW5pdENhbGxiYWNrcy5nZXQobm9ybWFsaXplZElkZW50aWZpZXIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBuZXcgU2V0KCk7DQogICAgICAgIGV4aXN0aW5nQ2FsbGJhY2tzLmFkZChjYWxsYmFjayk7DQogICAgICAgIHRoaXMub25Jbml0Q2FsbGJhY2tzLnNldChub3JtYWxpemVkSWRlbnRpZmllciwgZXhpc3RpbmdDYWxsYmFja3MpOw0KICAgICAgICBjb25zdCBleGlzdGluZ0luc3RhbmNlID0gdGhpcy5pbnN0YW5jZXMuZ2V0KG5vcm1hbGl6ZWRJZGVudGlmaWVyKTsNCiAgICAgICAgaWYgKGV4aXN0aW5nSW5zdGFuY2UpIHsNCiAgICAgICAgICAgIGNhbGxiYWNrKGV4aXN0aW5nSW5zdGFuY2UsIG5vcm1hbGl6ZWRJZGVudGlmaWVyKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gKCkgPT4gew0KICAgICAgICAgICAgZXhpc3RpbmdDYWxsYmFja3MuZGVsZXRlKGNhbGxiYWNrKTsNCiAgICAgICAgfTsNCiAgICB9DQogICAgLyoqDQogICAgICogSW52b2tlIG9uSW5pdCBjYWxsYmFja3Mgc3luY2hyb25vdXNseQ0KICAgICAqIEBwYXJhbSBpbnN0YW5jZSB0aGUgc2VydmljZSBpbnN0YW5jZWANCiAgICAgKi8NCiAgICBpbnZva2VPbkluaXRDYWxsYmFja3MoaW5zdGFuY2UsIGlkZW50aWZpZXIpIHsNCiAgICAgICAgY29uc3QgY2FsbGJhY2tzID0gdGhpcy5vbkluaXRDYWxsYmFja3MuZ2V0KGlkZW50aWZpZXIpOw0KICAgICAgICBpZiAoIWNhbGxiYWNrcykgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIGZvciAoY29uc3QgY2FsbGJhY2sgb2YgY2FsbGJhY2tzKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGNhbGxiYWNrKGluc3RhbmNlLCBpZGVudGlmaWVyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChfYSkgew0KICAgICAgICAgICAgICAgIC8vIGlnbm9yZSBlcnJvcnMgaW4gdGhlIG9uSW5pdCBjYWxsYmFjaw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIGdldE9ySW5pdGlhbGl6ZVNlcnZpY2UoeyBpbnN0YW5jZUlkZW50aWZpZXIsIG9wdGlvbnMgPSB7fSB9KSB7DQogICAgICAgIGxldCBpbnN0YW5jZSA9IHRoaXMuaW5zdGFuY2VzLmdldChpbnN0YW5jZUlkZW50aWZpZXIpOw0KICAgICAgICBpZiAoIWluc3RhbmNlICYmIHRoaXMuY29tcG9uZW50KSB7DQogICAgICAgICAgICBpbnN0YW5jZSA9IHRoaXMuY29tcG9uZW50Lmluc3RhbmNlRmFjdG9yeSh0aGlzLmNvbnRhaW5lciwgew0KICAgICAgICAgICAgICAgIGluc3RhbmNlSWRlbnRpZmllcjogbm9ybWFsaXplSWRlbnRpZmllckZvckZhY3RvcnkoaW5zdGFuY2VJZGVudGlmaWVyKSwNCiAgICAgICAgICAgICAgICBvcHRpb25zDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2VzLnNldChpbnN0YW5jZUlkZW50aWZpZXIsIGluc3RhbmNlKTsNCiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2VzT3B0aW9ucy5zZXQoaW5zdGFuY2VJZGVudGlmaWVyLCBvcHRpb25zKTsNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogSW52b2tlIG9uSW5pdCBsaXN0ZW5lcnMuDQogICAgICAgICAgICAgKiBOb3RlIHRoaXMuY29tcG9uZW50Lm9uSW5zdGFuY2VDcmVhdGVkIGlzIGRpZmZlcmVudCwgd2hpY2ggaXMgdXNlZCBieSB0aGUgY29tcG9uZW50IGNyZWF0b3IsDQogICAgICAgICAgICAgKiB3aGlsZSBvbkluaXQgbGlzdGVuZXJzIGFyZSByZWdpc3RlcmVkIGJ5IGNvbnN1bWVycyBvZiB0aGUgcHJvdmlkZXIuDQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIHRoaXMuaW52b2tlT25Jbml0Q2FsbGJhY2tzKGluc3RhbmNlLCBpbnN0YW5jZUlkZW50aWZpZXIpOw0KICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgKiBPcmRlciBpcyBpbXBvcnRhbnQNCiAgICAgICAgICAgICAqIG9uSW5zdGFuY2VDcmVhdGVkKCkgc2hvdWxkIGJlIGNhbGxlZCBhZnRlciB0aGlzLmluc3RhbmNlcy5zZXQoaW5zdGFuY2VJZGVudGlmaWVyLCBpbnN0YW5jZSk7IHdoaWNoDQogICAgICAgICAgICAgKiBtYWtlcyBgaXNJbml0aWFsaXplZCgpYCByZXR1cm4gdHJ1ZS4NCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgaWYgKHRoaXMuY29tcG9uZW50Lm9uSW5zdGFuY2VDcmVhdGVkKSB7DQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wb25lbnQub25JbnN0YW5jZUNyZWF0ZWQodGhpcy5jb250YWluZXIsIGluc3RhbmNlSWRlbnRpZmllciwgaW5zdGFuY2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoX2EpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gaWdub3JlIGVycm9ycyBpbiB0aGUgb25JbnN0YW5jZUNyZWF0ZWRDYWxsYmFjaw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gaW5zdGFuY2UgfHwgbnVsbDsNCiAgICB9DQogICAgbm9ybWFsaXplSW5zdGFuY2VJZGVudGlmaWVyKGlkZW50aWZpZXIgPSBERUZBVUxUX0VOVFJZX05BTUUkMSkgew0KICAgICAgICBpZiAodGhpcy5jb21wb25lbnQpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbXBvbmVudC5tdWx0aXBsZUluc3RhbmNlcyA/IGlkZW50aWZpZXIgOiBERUZBVUxUX0VOVFJZX05BTUUkMTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBpZGVudGlmaWVyOyAvLyBhc3N1bWUgbXVsdGlwbGUgaW5zdGFuY2VzIGFyZSBzdXBwb3J0ZWQgYmVmb3JlIHRoZSBjb21wb25lbnQgaXMgcHJvdmlkZWQuDQogICAgICAgIH0NCiAgICB9DQogICAgc2hvdWxkQXV0b0luaXRpYWxpemUoKSB7DQogICAgICAgIHJldHVybiAoISF0aGlzLmNvbXBvbmVudCAmJg0KICAgICAgICAgICAgdGhpcy5jb21wb25lbnQuaW5zdGFudGlhdGlvbk1vZGUgIT09ICJFWFBMSUNJVCIgLyogSW5zdGFudGlhdGlvbk1vZGUuRVhQTElDSVQgKi8pOw0KICAgIH0NCn0NCi8vIHVuZGVmaW5lZCBzaG91bGQgYmUgcGFzc2VkIHRvIHRoZSBzZXJ2aWNlIGZhY3RvcnkgZm9yIHRoZSBkZWZhdWx0IGluc3RhbmNlDQpmdW5jdGlvbiBub3JtYWxpemVJZGVudGlmaWVyRm9yRmFjdG9yeShpZGVudGlmaWVyKSB7DQogICAgcmV0dXJuIGlkZW50aWZpZXIgPT09IERFRkFVTFRfRU5UUllfTkFNRSQxID8gdW5kZWZpbmVkIDogaWRlbnRpZmllcjsNCn0NCmZ1bmN0aW9uIGlzQ29tcG9uZW50RWFnZXIoY29tcG9uZW50KSB7DQogICAgcmV0dXJuIGNvbXBvbmVudC5pbnN0YW50aWF0aW9uTW9kZSA9PT0gIkVBR0VSIiAvKiBJbnN0YW50aWF0aW9uTW9kZS5FQUdFUiAqLzsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogQ29tcG9uZW50Q29udGFpbmVyIHRoYXQgcHJvdmlkZXMgUHJvdmlkZXJzIGZvciBzZXJ2aWNlIG5hbWUgVCwgZS5nLiBgYXV0aGAsIGBhdXRoLWludGVybmFsYA0KICovDQpjbGFzcyBDb21wb25lbnRDb250YWluZXIgew0KICAgIGNvbnN0cnVjdG9yKG5hbWUpIHsNCiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTsNCiAgICAgICAgdGhpcy5wcm92aWRlcnMgPSBuZXcgTWFwKCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqDQogICAgICogQHBhcmFtIGNvbXBvbmVudCBDb21wb25lbnQgYmVpbmcgYWRkZWQNCiAgICAgKiBAcGFyYW0gb3ZlcndyaXRlIFdoZW4gYSBjb21wb25lbnQgd2l0aCB0aGUgc2FtZSBuYW1lIGhhcyBhbHJlYWR5IGJlZW4gcmVnaXN0ZXJlZCwNCiAgICAgKiBpZiBvdmVyd3JpdGUgaXMgdHJ1ZTogb3ZlcndyaXRlIHRoZSBleGlzdGluZyBjb21wb25lbnQgd2l0aCB0aGUgbmV3IGNvbXBvbmVudCBhbmQgY3JlYXRlIGEgbmV3DQogICAgICogcHJvdmlkZXIgd2l0aCB0aGUgbmV3IGNvbXBvbmVudC4gSXQgY2FuIGJlIHVzZWZ1bCBpbiB0ZXN0cyB3aGVyZSB5b3Ugd2FudCB0byB1c2UgZGlmZmVyZW50IG1vY2tzDQogICAgICogZm9yIGRpZmZlcmVudCB0ZXN0cy4NCiAgICAgKiBpZiBvdmVyd3JpdGUgaXMgZmFsc2U6IHRocm93IGFuIGV4Y2VwdGlvbg0KICAgICAqLw0KICAgIGFkZENvbXBvbmVudChjb21wb25lbnQpIHsNCiAgICAgICAgY29uc3QgcHJvdmlkZXIgPSB0aGlzLmdldFByb3ZpZGVyKGNvbXBvbmVudC5uYW1lKTsNCiAgICAgICAgaWYgKHByb3ZpZGVyLmlzQ29tcG9uZW50U2V0KCkpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQ29tcG9uZW50ICR7Y29tcG9uZW50Lm5hbWV9IGhhcyBhbHJlYWR5IGJlZW4gcmVnaXN0ZXJlZCB3aXRoICR7dGhpcy5uYW1lfWApOw0KICAgICAgICB9DQogICAgICAgIHByb3ZpZGVyLnNldENvbXBvbmVudChjb21wb25lbnQpOw0KICAgIH0NCiAgICBhZGRPck92ZXJ3cml0ZUNvbXBvbmVudChjb21wb25lbnQpIHsNCiAgICAgICAgY29uc3QgcHJvdmlkZXIgPSB0aGlzLmdldFByb3ZpZGVyKGNvbXBvbmVudC5uYW1lKTsNCiAgICAgICAgaWYgKHByb3ZpZGVyLmlzQ29tcG9uZW50U2V0KCkpIHsNCiAgICAgICAgICAgIC8vIGRlbGV0ZSB0aGUgZXhpc3RpbmcgcHJvdmlkZXIgZnJvbSB0aGUgY29udGFpbmVyLCBzbyB3ZSBjYW4gcmVnaXN0ZXIgdGhlIG5ldyBjb21wb25lbnQNCiAgICAgICAgICAgIHRoaXMucHJvdmlkZXJzLmRlbGV0ZShjb21wb25lbnQubmFtZSk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5hZGRDb21wb25lbnQoY29tcG9uZW50KTsNCiAgICB9DQogICAgLyoqDQogICAgICogZ2V0UHJvdmlkZXIgcHJvdmlkZXMgYSB0eXBlIHNhZmUgaW50ZXJmYWNlIHdoZXJlIGl0IGNhbiBvbmx5IGJlIGNhbGxlZCB3aXRoIGEgZmllbGQgbmFtZQ0KICAgICAqIHByZXNlbnQgaW4gTmFtZVNlcnZpY2VNYXBwaW5nIGludGVyZmFjZS4NCiAgICAgKg0KICAgICAqIEZpcmViYXNlIFNES3MgcHJvdmlkaW5nIHNlcnZpY2VzIHNob3VsZCBleHRlbmQgTmFtZVNlcnZpY2VNYXBwaW5nIGludGVyZmFjZSB0byByZWdpc3Rlcg0KICAgICAqIHRoZW1zZWx2ZXMuDQogICAgICovDQogICAgZ2V0UHJvdmlkZXIobmFtZSkgew0KICAgICAgICBpZiAodGhpcy5wcm92aWRlcnMuaGFzKG5hbWUpKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5wcm92aWRlcnMuZ2V0KG5hbWUpOw0KICAgICAgICB9DQogICAgICAgIC8vIGNyZWF0ZSBhIFByb3ZpZGVyIGZvciBhIHNlcnZpY2UgdGhhdCBoYXNuJ3QgcmVnaXN0ZXJlZCB3aXRoIEZpcmViYXNlDQogICAgICAgIGNvbnN0IHByb3ZpZGVyID0gbmV3IFByb3ZpZGVyKG5hbWUsIHRoaXMpOw0KICAgICAgICB0aGlzLnByb3ZpZGVycy5zZXQobmFtZSwgcHJvdmlkZXIpOw0KICAgICAgICByZXR1cm4gcHJvdmlkZXI7DQogICAgfQ0KICAgIGdldFByb3ZpZGVycygpIHsNCiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5wcm92aWRlcnMudmFsdWVzKCkpOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogQSBjb250YWluZXIgZm9yIGFsbCBvZiB0aGUgTG9nZ2VyIGluc3RhbmNlcw0KICovDQovKioNCiAqIFRoZSBKUyBTREsgc3VwcG9ydHMgNSBsb2cgbGV2ZWxzIGFuZCBhbHNvIGFsbG93cyBhIHVzZXIgdGhlIGFiaWxpdHkgdG8NCiAqIHNpbGVuY2UgdGhlIGxvZ3MgYWx0b2dldGhlci4NCiAqDQogKiBUaGUgb3JkZXIgaXMgYSBmb2xsb3dzOg0KICogREVCVUcgPCBWRVJCT1NFIDwgSU5GTyA8IFdBUk4gPCBFUlJPUg0KICoNCiAqIEFsbCBvZiB0aGUgbG9nIHR5cGVzIGFib3ZlIHRoZSBjdXJyZW50IGxvZyBsZXZlbCB3aWxsIGJlIGNhcHR1cmVkIChpLmUuIGlmDQogKiB5b3Ugc2V0IHRoZSBsb2cgbGV2ZWwgdG8gYElORk9gLCBlcnJvcnMgd2lsbCBzdGlsbCBiZSBsb2dnZWQsIGJ1dCBgREVCVUdgIGFuZA0KICogYFZFUkJPU0VgIGxvZ3Mgd2lsbCBub3QpDQogKi8NCnZhciBMb2dMZXZlbDsNCihmdW5jdGlvbiAoTG9nTGV2ZWwpIHsNCiAgICBMb2dMZXZlbFtMb2dMZXZlbFsiREVCVUciXSA9IDBdID0gIkRFQlVHIjsNCiAgICBMb2dMZXZlbFtMb2dMZXZlbFsiVkVSQk9TRSJdID0gMV0gPSAiVkVSQk9TRSI7DQogICAgTG9nTGV2ZWxbTG9nTGV2ZWxbIklORk8iXSA9IDJdID0gIklORk8iOw0KICAgIExvZ0xldmVsW0xvZ0xldmVsWyJXQVJOIl0gPSAzXSA9ICJXQVJOIjsNCiAgICBMb2dMZXZlbFtMb2dMZXZlbFsiRVJST1IiXSA9IDRdID0gIkVSUk9SIjsNCiAgICBMb2dMZXZlbFtMb2dMZXZlbFsiU0lMRU5UIl0gPSA1XSA9ICJTSUxFTlQiOw0KfSkoTG9nTGV2ZWwgfHwgKExvZ0xldmVsID0ge30pKTsNCmNvbnN0IGxldmVsU3RyaW5nVG9FbnVtID0gew0KICAgICdkZWJ1Zyc6IExvZ0xldmVsLkRFQlVHLA0KICAgICd2ZXJib3NlJzogTG9nTGV2ZWwuVkVSQk9TRSwNCiAgICAnaW5mbyc6IExvZ0xldmVsLklORk8sDQogICAgJ3dhcm4nOiBMb2dMZXZlbC5XQVJOLA0KICAgICdlcnJvcic6IExvZ0xldmVsLkVSUk9SLA0KICAgICdzaWxlbnQnOiBMb2dMZXZlbC5TSUxFTlQNCn07DQovKioNCiAqIFRoZSBkZWZhdWx0IGxvZyBsZXZlbA0KICovDQpjb25zdCBkZWZhdWx0TG9nTGV2ZWwgPSBMb2dMZXZlbC5JTkZPOw0KLyoqDQogKiBCeSBkZWZhdWx0LCBgY29uc29sZS5kZWJ1Z2AgaXMgbm90IGRpc3BsYXllZCBpbiB0aGUgZGV2ZWxvcGVyIGNvbnNvbGUgKGluDQogKiBjaHJvbWUpLiBUbyBhdm9pZCBmb3JjaW5nIHVzZXJzIHRvIGhhdmUgdG8gb3B0LWluIHRvIHRoZXNlIGxvZ3MgdHdpY2UNCiAqIChpLmUuIG9uY2UgZm9yIGZpcmViYXNlLCBhbmQgb25jZSBpbiB0aGUgY29uc29sZSksIHdlIGFyZSBzZW5kaW5nIGBERUJVR2ANCiAqIGxvZ3MgdG8gdGhlIGBjb25zb2xlLmxvZ2AgZnVuY3Rpb24uDQogKi8NCmNvbnN0IENvbnNvbGVNZXRob2QgPSB7DQogICAgW0xvZ0xldmVsLkRFQlVHXTogJ2xvZycsDQogICAgW0xvZ0xldmVsLlZFUkJPU0VdOiAnbG9nJywNCiAgICBbTG9nTGV2ZWwuSU5GT106ICdpbmZvJywNCiAgICBbTG9nTGV2ZWwuV0FSTl06ICd3YXJuJywNCiAgICBbTG9nTGV2ZWwuRVJST1JdOiAnZXJyb3InDQp9Ow0KLyoqDQogKiBUaGUgZGVmYXVsdCBsb2cgaGFuZGxlciB3aWxsIGZvcndhcmQgREVCVUcsIFZFUkJPU0UsIElORk8sIFdBUk4sIGFuZCBFUlJPUg0KICogbWVzc2FnZXMgb24gdG8gdGhlaXIgY29ycmVzcG9uZGluZyBjb25zb2xlIGNvdW50ZXJwYXJ0cyAoaWYgdGhlIGxvZyBtZXRob2QNCiAqIGlzIHN1cHBvcnRlZCBieSB0aGUgY3VycmVudCBsb2cgbGV2ZWwpDQogKi8NCmNvbnN0IGRlZmF1bHRMb2dIYW5kbGVyID0gKGluc3RhbmNlLCBsb2dUeXBlLCAuLi5hcmdzKSA9PiB7DQogICAgaWYgKGxvZ1R5cGUgPCBpbnN0YW5jZS5sb2dMZXZlbCkgew0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTsNCiAgICBjb25zdCBtZXRob2QgPSBDb25zb2xlTWV0aG9kW2xvZ1R5cGVdOw0KICAgIGlmIChtZXRob2QpIHsNCiAgICAgICAgY29uc29sZVttZXRob2RdKGBbJHtub3d9XSAgJHtpbnN0YW5jZS5uYW1lfTpgLCAuLi5hcmdzKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcihgQXR0ZW1wdGVkIHRvIGxvZyBhIG1lc3NhZ2Ugd2l0aCBhbiBpbnZhbGlkIGxvZ1R5cGUgKHZhbHVlOiAke2xvZ1R5cGV9KWApOw0KICAgIH0NCn07DQpjbGFzcyBMb2dnZXIgew0KICAgIC8qKg0KICAgICAqIEdpdmVzIHlvdSBhbiBpbnN0YW5jZSBvZiBhIExvZ2dlciB0byBjYXB0dXJlIG1lc3NhZ2VzIGFjY29yZGluZyB0bw0KICAgICAqIEZpcmViYXNlJ3MgbG9nZ2luZyBzY2hlbWUuDQogICAgICoNCiAgICAgKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSB0aGF0IHRoZSBsb2dzIHdpbGwgYmUgYXNzb2NpYXRlZCB3aXRoDQogICAgICovDQogICAgY29uc3RydWN0b3IobmFtZSkgew0KICAgICAgICB0aGlzLm5hbWUgPSBuYW1lOw0KICAgICAgICAvKioNCiAgICAgICAgICogVGhlIGxvZyBsZXZlbCBvZiB0aGUgZ2l2ZW4gTG9nZ2VyIGluc3RhbmNlLg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5fbG9nTGV2ZWwgPSBkZWZhdWx0TG9nTGV2ZWw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBUaGUgbWFpbiAoaW50ZXJuYWwpIGxvZyBoYW5kbGVyIGZvciB0aGUgTG9nZ2VyIGluc3RhbmNlLg0KICAgICAgICAgKiBDYW4gYmUgc2V0IHRvIGEgbmV3IGZ1bmN0aW9uIGluIGludGVybmFsIHBhY2thZ2UgY29kZSBidXQgbm90IGJ5IHVzZXIuDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLl9sb2dIYW5kbGVyID0gZGVmYXVsdExvZ0hhbmRsZXI7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBUaGUgb3B0aW9uYWwsIGFkZGl0aW9uYWwsIHVzZXItZGVmaW5lZCBsb2cgaGFuZGxlciBmb3IgdGhlIExvZ2dlciBpbnN0YW5jZS4NCiAgICAgICAgICovDQogICAgICAgIHRoaXMuX3VzZXJMb2dIYW5kbGVyID0gbnVsbDsNCiAgICB9DQogICAgZ2V0IGxvZ0xldmVsKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5fbG9nTGV2ZWw7DQogICAgfQ0KICAgIHNldCBsb2dMZXZlbCh2YWwpIHsNCiAgICAgICAgaWYgKCEodmFsIGluIExvZ0xldmVsKSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgSW52YWxpZCB2YWx1ZSAiJHt2YWx9IiBhc3NpZ25lZCB0byBcYGxvZ0xldmVsXGBgKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLl9sb2dMZXZlbCA9IHZhbDsNCiAgICB9DQogICAgLy8gV29ya2Fyb3VuZCBmb3Igc2V0dGVyL2dldHRlciBoYXZpbmcgdG8gYmUgdGhlIHNhbWUgdHlwZS4NCiAgICBzZXRMb2dMZXZlbCh2YWwpIHsNCiAgICAgICAgdGhpcy5fbG9nTGV2ZWwgPSB0eXBlb2YgdmFsID09PSAnc3RyaW5nJyA/IGxldmVsU3RyaW5nVG9FbnVtW3ZhbF0gOiB2YWw7DQogICAgfQ0KICAgIGdldCBsb2dIYW5kbGVyKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5fbG9nSGFuZGxlcjsNCiAgICB9DQogICAgc2V0IGxvZ0hhbmRsZXIodmFsKSB7DQogICAgICAgIGlmICh0eXBlb2YgdmFsICE9PSAnZnVuY3Rpb24nKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdWYWx1ZSBhc3NpZ25lZCB0byBgbG9nSGFuZGxlcmAgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5fbG9nSGFuZGxlciA9IHZhbDsNCiAgICB9DQogICAgZ2V0IHVzZXJMb2dIYW5kbGVyKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5fdXNlckxvZ0hhbmRsZXI7DQogICAgfQ0KICAgIHNldCB1c2VyTG9nSGFuZGxlcih2YWwpIHsNCiAgICAgICAgdGhpcy5fdXNlckxvZ0hhbmRsZXIgPSB2YWw7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFRoZSBmdW5jdGlvbnMgYmVsb3cgYXJlIGFsbCBiYXNlZCBvbiB0aGUgYGNvbnNvbGVgIGludGVyZmFjZQ0KICAgICAqLw0KICAgIGRlYnVnKC4uLmFyZ3MpIHsNCiAgICAgICAgdGhpcy5fdXNlckxvZ0hhbmRsZXIgJiYgdGhpcy5fdXNlckxvZ0hhbmRsZXIodGhpcywgTG9nTGV2ZWwuREVCVUcsIC4uLmFyZ3MpOw0KICAgICAgICB0aGlzLl9sb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLkRFQlVHLCAuLi5hcmdzKTsNCiAgICB9DQogICAgbG9nKC4uLmFyZ3MpIHsNCiAgICAgICAgdGhpcy5fdXNlckxvZ0hhbmRsZXIgJiYNCiAgICAgICAgICAgIHRoaXMuX3VzZXJMb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLlZFUkJPU0UsIC4uLmFyZ3MpOw0KICAgICAgICB0aGlzLl9sb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLlZFUkJPU0UsIC4uLmFyZ3MpOw0KICAgIH0NCiAgICBpbmZvKC4uLmFyZ3MpIHsNCiAgICAgICAgdGhpcy5fdXNlckxvZ0hhbmRsZXIgJiYgdGhpcy5fdXNlckxvZ0hhbmRsZXIodGhpcywgTG9nTGV2ZWwuSU5GTywgLi4uYXJncyk7DQogICAgICAgIHRoaXMuX2xvZ0hhbmRsZXIodGhpcywgTG9nTGV2ZWwuSU5GTywgLi4uYXJncyk7DQogICAgfQ0KICAgIHdhcm4oLi4uYXJncykgew0KICAgICAgICB0aGlzLl91c2VyTG9nSGFuZGxlciAmJiB0aGlzLl91c2VyTG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5XQVJOLCAuLi5hcmdzKTsNCiAgICAgICAgdGhpcy5fbG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5XQVJOLCAuLi5hcmdzKTsNCiAgICB9DQogICAgZXJyb3IoLi4uYXJncykgew0KICAgICAgICB0aGlzLl91c2VyTG9nSGFuZGxlciAmJiB0aGlzLl91c2VyTG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5FUlJPUiwgLi4uYXJncyk7DQogICAgICAgIHRoaXMuX2xvZ0hhbmRsZXIodGhpcywgTG9nTGV2ZWwuRVJST1IsIC4uLmFyZ3MpOw0KICAgIH0NCn0KCmNvbnN0IGluc3RhbmNlT2ZBbnkgPSAob2JqZWN0LCBjb25zdHJ1Y3RvcnMpID0+IGNvbnN0cnVjdG9ycy5zb21lKChjKSA9PiBvYmplY3QgaW5zdGFuY2VvZiBjKTsKCmxldCBpZGJQcm94eWFibGVUeXBlczsKbGV0IGN1cnNvckFkdmFuY2VNZXRob2RzOwovLyBUaGlzIGlzIGEgZnVuY3Rpb24gdG8gcHJldmVudCBpdCB0aHJvd2luZyB1cCBpbiBub2RlIGVudmlyb25tZW50cy4KZnVuY3Rpb24gZ2V0SWRiUHJveHlhYmxlVHlwZXMoKSB7CiAgICByZXR1cm4gKGlkYlByb3h5YWJsZVR5cGVzIHx8CiAgICAgICAgKGlkYlByb3h5YWJsZVR5cGVzID0gWwogICAgICAgICAgICBJREJEYXRhYmFzZSwKICAgICAgICAgICAgSURCT2JqZWN0U3RvcmUsCiAgICAgICAgICAgIElEQkluZGV4LAogICAgICAgICAgICBJREJDdXJzb3IsCiAgICAgICAgICAgIElEQlRyYW5zYWN0aW9uLAogICAgICAgIF0pKTsKfQovLyBUaGlzIGlzIGEgZnVuY3Rpb24gdG8gcHJldmVudCBpdCB0aHJvd2luZyB1cCBpbiBub2RlIGVudmlyb25tZW50cy4KZnVuY3Rpb24gZ2V0Q3Vyc29yQWR2YW5jZU1ldGhvZHMoKSB7CiAgICByZXR1cm4gKGN1cnNvckFkdmFuY2VNZXRob2RzIHx8CiAgICAgICAgKGN1cnNvckFkdmFuY2VNZXRob2RzID0gWwogICAgICAgICAgICBJREJDdXJzb3IucHJvdG90eXBlLmFkdmFuY2UsCiAgICAgICAgICAgIElEQkN1cnNvci5wcm90b3R5cGUuY29udGludWUsCiAgICAgICAgICAgIElEQkN1cnNvci5wcm90b3R5cGUuY29udGludWVQcmltYXJ5S2V5LAogICAgICAgIF0pKTsKfQpjb25zdCBjdXJzb3JSZXF1ZXN0TWFwID0gbmV3IFdlYWtNYXAoKTsKY29uc3QgdHJhbnNhY3Rpb25Eb25lTWFwID0gbmV3IFdlYWtNYXAoKTsKY29uc3QgdHJhbnNhY3Rpb25TdG9yZU5hbWVzTWFwID0gbmV3IFdlYWtNYXAoKTsKY29uc3QgdHJhbnNmb3JtQ2FjaGUgPSBuZXcgV2Vha01hcCgpOwpjb25zdCByZXZlcnNlVHJhbnNmb3JtQ2FjaGUgPSBuZXcgV2Vha01hcCgpOwpmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpIHsKICAgIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgY29uc3QgdW5saXN0ZW4gPSAoKSA9PiB7CiAgICAgICAgICAgIHJlcXVlc3QucmVtb3ZlRXZlbnRMaXN0ZW5lcignc3VjY2VzcycsIHN1Y2Nlc3MpOwogICAgICAgICAgICByZXF1ZXN0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZXJyb3IpOwogICAgICAgIH07CiAgICAgICAgY29uc3Qgc3VjY2VzcyA9ICgpID0+IHsKICAgICAgICAgICAgcmVzb2x2ZSh3cmFwKHJlcXVlc3QucmVzdWx0KSk7CiAgICAgICAgICAgIHVubGlzdGVuKCk7CiAgICAgICAgfTsKICAgICAgICBjb25zdCBlcnJvciA9ICgpID0+IHsKICAgICAgICAgICAgcmVqZWN0KHJlcXVlc3QuZXJyb3IpOwogICAgICAgICAgICB1bmxpc3RlbigpOwogICAgICAgIH07CiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdzdWNjZXNzJywgc3VjY2Vzcyk7CiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTsKICAgIH0pOwogICAgcHJvbWlzZQogICAgICAgIC50aGVuKCh2YWx1ZSkgPT4gewogICAgICAgIC8vIFNpbmNlIGN1cnNvcmluZyByZXVzZXMgdGhlIElEQlJlcXVlc3QgKCpzaWdoKiksIHdlIGNhY2hlIGl0IGZvciBsYXRlciByZXRyaWV2YWwKICAgICAgICAvLyAoc2VlIHdyYXBGdW5jdGlvbikuCiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgSURCQ3Vyc29yKSB7CiAgICAgICAgICAgIGN1cnNvclJlcXVlc3RNYXAuc2V0KHZhbHVlLCByZXF1ZXN0KTsKICAgICAgICB9CiAgICAgICAgLy8gQ2F0Y2hpbmcgdG8gYXZvaWQgIlVuY2F1Z2h0IFByb21pc2UgZXhjZXB0aW9ucyIKICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsgfSk7CiAgICAvLyBUaGlzIG1hcHBpbmcgZXhpc3RzIGluIHJldmVyc2VUcmFuc2Zvcm1DYWNoZSBidXQgZG9lc24ndCBkb2Vzbid0IGV4aXN0IGluIHRyYW5zZm9ybUNhY2hlLiBUaGlzCiAgICAvLyBpcyBiZWNhdXNlIHdlIGNyZWF0ZSBtYW55IHByb21pc2VzIGZyb20gYSBzaW5nbGUgSURCUmVxdWVzdC4KICAgIHJldmVyc2VUcmFuc2Zvcm1DYWNoZS5zZXQocHJvbWlzZSwgcmVxdWVzdCk7CiAgICByZXR1cm4gcHJvbWlzZTsKfQpmdW5jdGlvbiBjYWNoZURvbmVQcm9taXNlRm9yVHJhbnNhY3Rpb24odHgpIHsKICAgIC8vIEVhcmx5IGJhaWwgaWYgd2UndmUgYWxyZWFkeSBjcmVhdGVkIGEgZG9uZSBwcm9taXNlIGZvciB0aGlzIHRyYW5zYWN0aW9uLgogICAgaWYgKHRyYW5zYWN0aW9uRG9uZU1hcC5oYXModHgpKQogICAgICAgIHJldHVybjsKICAgIGNvbnN0IGRvbmUgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgY29uc3QgdW5saXN0ZW4gPSAoKSA9PiB7CiAgICAgICAgICAgIHR4LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NvbXBsZXRlJywgY29tcGxldGUpOwogICAgICAgICAgICB0eC5yZW1vdmVFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTsKICAgICAgICAgICAgdHgucmVtb3ZlRXZlbnRMaXN0ZW5lcignYWJvcnQnLCBlcnJvcik7CiAgICAgICAgfTsKICAgICAgICBjb25zdCBjb21wbGV0ZSA9ICgpID0+IHsKICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgICB1bmxpc3RlbigpOwogICAgICAgIH07CiAgICAgICAgY29uc3QgZXJyb3IgPSAoKSA9PiB7CiAgICAgICAgICAgIHJlamVjdCh0eC5lcnJvciB8fCBuZXcgRE9NRXhjZXB0aW9uKCdBYm9ydEVycm9yJywgJ0Fib3J0RXJyb3InKSk7CiAgICAgICAgICAgIHVubGlzdGVuKCk7CiAgICAgICAgfTsKICAgICAgICB0eC5hZGRFdmVudExpc3RlbmVyKCdjb21wbGV0ZScsIGNvbXBsZXRlKTsKICAgICAgICB0eC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTsKICAgICAgICB0eC5hZGRFdmVudExpc3RlbmVyKCdhYm9ydCcsIGVycm9yKTsKICAgIH0pOwogICAgLy8gQ2FjaGUgaXQgZm9yIGxhdGVyIHJldHJpZXZhbC4KICAgIHRyYW5zYWN0aW9uRG9uZU1hcC5zZXQodHgsIGRvbmUpOwp9CmxldCBpZGJQcm94eVRyYXBzID0gewogICAgZ2V0KHRhcmdldCwgcHJvcCwgcmVjZWl2ZXIpIHsKICAgICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgSURCVHJhbnNhY3Rpb24pIHsKICAgICAgICAgICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgdHJhbnNhY3Rpb24uZG9uZS4KICAgICAgICAgICAgaWYgKHByb3AgPT09ICdkb25lJykKICAgICAgICAgICAgICAgIHJldHVybiB0cmFuc2FjdGlvbkRvbmVNYXAuZ2V0KHRhcmdldCk7CiAgICAgICAgICAgIC8vIFBvbHlmaWxsIGZvciBvYmplY3RTdG9yZU5hbWVzIGJlY2F1c2Ugb2YgRWRnZS4KICAgICAgICAgICAgaWYgKHByb3AgPT09ICdvYmplY3RTdG9yZU5hbWVzJykgewogICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldC5vYmplY3RTdG9yZU5hbWVzIHx8IHRyYW5zYWN0aW9uU3RvcmVOYW1lc01hcC5nZXQodGFyZ2V0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBNYWtlIHR4LnN0b3JlIHJldHVybiB0aGUgb25seSBzdG9yZSBpbiB0aGUgdHJhbnNhY3Rpb24sIG9yIHVuZGVmaW5lZCBpZiB0aGVyZSBhcmUgbWFueS4KICAgICAgICAgICAgaWYgKHByb3AgPT09ICdzdG9yZScpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZWNlaXZlci5vYmplY3RTdG9yZU5hbWVzWzFdCiAgICAgICAgICAgICAgICAgICAgPyB1bmRlZmluZWQKICAgICAgICAgICAgICAgICAgICA6IHJlY2VpdmVyLm9iamVjdFN0b3JlKHJlY2VpdmVyLm9iamVjdFN0b3JlTmFtZXNbMF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIEVsc2UgdHJhbnNmb3JtIHdoYXRldmVyIHdlIGdldCBiYWNrLgogICAgICAgIHJldHVybiB3cmFwKHRhcmdldFtwcm9wXSk7CiAgICB9LAogICAgc2V0KHRhcmdldCwgcHJvcCwgdmFsdWUpIHsKICAgICAgICB0YXJnZXRbcHJvcF0gPSB2YWx1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0sCiAgICBoYXModGFyZ2V0LCBwcm9wKSB7CiAgICAgICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIElEQlRyYW5zYWN0aW9uICYmCiAgICAgICAgICAgIChwcm9wID09PSAnZG9uZScgfHwgcHJvcCA9PT0gJ3N0b3JlJykpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwcm9wIGluIHRhcmdldDsKICAgIH0sCn07CmZ1bmN0aW9uIHJlcGxhY2VUcmFwcyhjYWxsYmFjaykgewogICAgaWRiUHJveHlUcmFwcyA9IGNhbGxiYWNrKGlkYlByb3h5VHJhcHMpOwp9CmZ1bmN0aW9uIHdyYXBGdW5jdGlvbihmdW5jKSB7CiAgICAvLyBEdWUgdG8gZXhwZWN0ZWQgb2JqZWN0IGVxdWFsaXR5ICh3aGljaCBpcyBlbmZvcmNlZCBieSB0aGUgY2FjaGluZyBpbiBgd3JhcGApLCB3ZQogICAgLy8gb25seSBjcmVhdGUgb25lIG5ldyBmdW5jIHBlciBmdW5jLgogICAgLy8gRWRnZSBkb2Vzbid0IHN1cHBvcnQgb2JqZWN0U3RvcmVOYW1lcyAoYm9vbyksIHNvIHdlIHBvbHlmaWxsIGl0IGhlcmUuCiAgICBpZiAoZnVuYyA9PT0gSURCRGF0YWJhc2UucHJvdG90eXBlLnRyYW5zYWN0aW9uICYmCiAgICAgICAgISgnb2JqZWN0U3RvcmVOYW1lcycgaW4gSURCVHJhbnNhY3Rpb24ucHJvdG90eXBlKSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoc3RvcmVOYW1lcywgLi4uYXJncykgewogICAgICAgICAgICBjb25zdCB0eCA9IGZ1bmMuY2FsbCh1bndyYXAodGhpcyksIHN0b3JlTmFtZXMsIC4uLmFyZ3MpOwogICAgICAgICAgICB0cmFuc2FjdGlvblN0b3JlTmFtZXNNYXAuc2V0KHR4LCBzdG9yZU5hbWVzLnNvcnQgPyBzdG9yZU5hbWVzLnNvcnQoKSA6IFtzdG9yZU5hbWVzXSk7CiAgICAgICAgICAgIHJldHVybiB3cmFwKHR4KTsKICAgICAgICB9OwogICAgfQogICAgLy8gQ3Vyc29yIG1ldGhvZHMgYXJlIHNwZWNpYWwsIGFzIHRoZSBiZWhhdmlvdXIgaXMgYSBsaXR0bGUgbW9yZSBkaWZmZXJlbnQgdG8gc3RhbmRhcmQgSURCLiBJbgogICAgLy8gSURCLCB5b3UgYWR2YW5jZSB0aGUgY3Vyc29yIGFuZCB3YWl0IGZvciBhIG5ldyAnc3VjY2Vzcycgb24gdGhlIElEQlJlcXVlc3QgdGhhdCBnYXZlIHlvdSB0aGUKICAgIC8vIGN1cnNvci4gSXQncyBraW5kYSBsaWtlIGEgcHJvbWlzZSB0aGF0IGNhbiByZXNvbHZlIHdpdGggbWFueSB2YWx1ZXMuIFRoYXQgZG9lc24ndCBtYWtlIHNlbnNlCiAgICAvLyB3aXRoIHJlYWwgcHJvbWlzZXMsIHNvIGVhY2ggYWR2YW5jZSBtZXRob2RzIHJldHVybnMgYSBuZXcgcHJvbWlzZSBmb3IgdGhlIGN1cnNvciBvYmplY3QsIG9yCiAgICAvLyB1bmRlZmluZWQgaWYgdGhlIGVuZCBvZiB0aGUgY3Vyc29yIGhhcyBiZWVuIHJlYWNoZWQuCiAgICBpZiAoZ2V0Q3Vyc29yQWR2YW5jZU1ldGhvZHMoKS5pbmNsdWRlcyhmdW5jKSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoLi4uYXJncykgewogICAgICAgICAgICAvLyBDYWxsaW5nIHRoZSBvcmlnaW5hbCBmdW5jdGlvbiB3aXRoIHRoZSBwcm94eSBhcyAndGhpcycgY2F1c2VzIElMTEVHQUwgSU5WT0NBVElPTiwgc28gd2UgdXNlCiAgICAgICAgICAgIC8vIHRoZSBvcmlnaW5hbCBvYmplY3QuCiAgICAgICAgICAgIGZ1bmMuYXBwbHkodW53cmFwKHRoaXMpLCBhcmdzKTsKICAgICAgICAgICAgcmV0dXJuIHdyYXAoY3Vyc29yUmVxdWVzdE1hcC5nZXQodGhpcykpOwogICAgICAgIH07CiAgICB9CiAgICByZXR1cm4gZnVuY3Rpb24gKC4uLmFyZ3MpIHsKICAgICAgICAvLyBDYWxsaW5nIHRoZSBvcmlnaW5hbCBmdW5jdGlvbiB3aXRoIHRoZSBwcm94eSBhcyAndGhpcycgY2F1c2VzIElMTEVHQUwgSU5WT0NBVElPTiwgc28gd2UgdXNlCiAgICAgICAgLy8gdGhlIG9yaWdpbmFsIG9iamVjdC4KICAgICAgICByZXR1cm4gd3JhcChmdW5jLmFwcGx5KHVud3JhcCh0aGlzKSwgYXJncykpOwogICAgfTsKfQpmdW5jdGlvbiB0cmFuc2Zvcm1DYWNoYWJsZVZhbHVlKHZhbHVlKSB7CiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKQogICAgICAgIHJldHVybiB3cmFwRnVuY3Rpb24odmFsdWUpOwogICAgLy8gVGhpcyBkb2Vzbid0IHJldHVybiwgaXQganVzdCBjcmVhdGVzIGEgJ2RvbmUnIHByb21pc2UgZm9yIHRoZSB0cmFuc2FjdGlvbiwKICAgIC8vIHdoaWNoIGlzIGxhdGVyIHJldHVybmVkIGZvciB0cmFuc2FjdGlvbi5kb25lIChzZWUgaWRiT2JqZWN0SGFuZGxlcikuCiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBJREJUcmFuc2FjdGlvbikKICAgICAgICBjYWNoZURvbmVQcm9taXNlRm9yVHJhbnNhY3Rpb24odmFsdWUpOwogICAgaWYgKGluc3RhbmNlT2ZBbnkodmFsdWUsIGdldElkYlByb3h5YWJsZVR5cGVzKCkpKQogICAgICAgIHJldHVybiBuZXcgUHJveHkodmFsdWUsIGlkYlByb3h5VHJhcHMpOwogICAgLy8gUmV0dXJuIHRoZSBzYW1lIHZhbHVlIGJhY2sgaWYgd2UncmUgbm90IGdvaW5nIHRvIHRyYW5zZm9ybSBpdC4KICAgIHJldHVybiB2YWx1ZTsKfQpmdW5jdGlvbiB3cmFwKHZhbHVlKSB7CiAgICAvLyBXZSBzb21ldGltZXMgZ2VuZXJhdGUgbXVsdGlwbGUgcHJvbWlzZXMgZnJvbSBhIHNpbmdsZSBJREJSZXF1ZXN0IChlZyB3aGVuIGN1cnNvcmluZyksIGJlY2F1c2UKICAgIC8vIElEQiBpcyB3ZWlyZCBhbmQgYSBzaW5nbGUgSURCUmVxdWVzdCBjYW4geWllbGQgbWFueSByZXNwb25zZXMsIHNvIHRoZXNlIGNhbid0IGJlIGNhY2hlZC4KICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEQlJlcXVlc3QpCiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3QodmFsdWUpOwogICAgLy8gSWYgd2UndmUgYWxyZWFkeSB0cmFuc2Zvcm1lZCB0aGlzIHZhbHVlIGJlZm9yZSwgcmV1c2UgdGhlIHRyYW5zZm9ybWVkIHZhbHVlLgogICAgLy8gVGhpcyBpcyBmYXN0ZXIsIGJ1dCBpdCBhbHNvIHByb3ZpZGVzIG9iamVjdCBlcXVhbGl0eS4KICAgIGlmICh0cmFuc2Zvcm1DYWNoZS5oYXModmFsdWUpKQogICAgICAgIHJldHVybiB0cmFuc2Zvcm1DYWNoZS5nZXQodmFsdWUpOwogICAgY29uc3QgbmV3VmFsdWUgPSB0cmFuc2Zvcm1DYWNoYWJsZVZhbHVlKHZhbHVlKTsKICAgIC8vIE5vdCBhbGwgdHlwZXMgYXJlIHRyYW5zZm9ybWVkLgogICAgLy8gVGhlc2UgbWF5IGJlIHByaW1pdGl2ZSB0eXBlcywgc28gdGhleSBjYW4ndCBiZSBXZWFrTWFwIGtleXMuCiAgICBpZiAobmV3VmFsdWUgIT09IHZhbHVlKSB7CiAgICAgICAgdHJhbnNmb3JtQ2FjaGUuc2V0KHZhbHVlLCBuZXdWYWx1ZSk7CiAgICAgICAgcmV2ZXJzZVRyYW5zZm9ybUNhY2hlLnNldChuZXdWYWx1ZSwgdmFsdWUpOwogICAgfQogICAgcmV0dXJuIG5ld1ZhbHVlOwp9CmNvbnN0IHVud3JhcCA9ICh2YWx1ZSkgPT4gcmV2ZXJzZVRyYW5zZm9ybUNhY2hlLmdldCh2YWx1ZSk7CgovKioKICogT3BlbiBhIGRhdGFiYXNlLgogKgogKiBAcGFyYW0gbmFtZSBOYW1lIG9mIHRoZSBkYXRhYmFzZS4KICogQHBhcmFtIHZlcnNpb24gU2NoZW1hIHZlcnNpb24uCiAqIEBwYXJhbSBjYWxsYmFja3MgQWRkaXRpb25hbCBjYWxsYmFja3MuCiAqLwpmdW5jdGlvbiBvcGVuREIobmFtZSwgdmVyc2lvbiwgeyBibG9ja2VkLCB1cGdyYWRlLCBibG9ja2luZywgdGVybWluYXRlZCB9ID0ge30pIHsKICAgIGNvbnN0IHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihuYW1lLCB2ZXJzaW9uKTsKICAgIGNvbnN0IG9wZW5Qcm9taXNlID0gd3JhcChyZXF1ZXN0KTsKICAgIGlmICh1cGdyYWRlKSB7CiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCd1cGdyYWRlbmVlZGVkJywgKGV2ZW50KSA9PiB7CiAgICAgICAgICAgIHVwZ3JhZGUod3JhcChyZXF1ZXN0LnJlc3VsdCksIGV2ZW50Lm9sZFZlcnNpb24sIGV2ZW50Lm5ld1ZlcnNpb24sIHdyYXAocmVxdWVzdC50cmFuc2FjdGlvbiksIGV2ZW50KTsKICAgICAgICB9KTsKICAgIH0KICAgIGlmIChibG9ja2VkKSB7CiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdibG9ja2VkJywgKGV2ZW50KSA9PiBibG9ja2VkKAogICAgICAgIC8vIENhc3RpbmcgZHVlIHRvIGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvVHlwZVNjcmlwdC1ET00tbGliLWdlbmVyYXRvci9wdWxsLzE0MDUKICAgICAgICBldmVudC5vbGRWZXJzaW9uLCBldmVudC5uZXdWZXJzaW9uLCBldmVudCkpOwogICAgfQogICAgb3BlblByb21pc2UKICAgICAgICAudGhlbigoZGIpID0+IHsKICAgICAgICBpZiAodGVybWluYXRlZCkKICAgICAgICAgICAgZGIuYWRkRXZlbnRMaXN0ZW5lcignY2xvc2UnLCAoKSA9PiB0ZXJtaW5hdGVkKCkpOwogICAgICAgIGlmIChibG9ja2luZykgewogICAgICAgICAgICBkYi5hZGRFdmVudExpc3RlbmVyKCd2ZXJzaW9uY2hhbmdlJywgKGV2ZW50KSA9PiBibG9ja2luZyhldmVudC5vbGRWZXJzaW9uLCBldmVudC5uZXdWZXJzaW9uLCBldmVudCkpOwogICAgICAgIH0KICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsgfSk7CiAgICByZXR1cm4gb3BlblByb21pc2U7Cn0KCmNvbnN0IHJlYWRNZXRob2RzID0gWydnZXQnLCAnZ2V0S2V5JywgJ2dldEFsbCcsICdnZXRBbGxLZXlzJywgJ2NvdW50J107CmNvbnN0IHdyaXRlTWV0aG9kcyA9IFsncHV0JywgJ2FkZCcsICdkZWxldGUnLCAnY2xlYXInXTsKY29uc3QgY2FjaGVkTWV0aG9kcyA9IG5ldyBNYXAoKTsKZnVuY3Rpb24gZ2V0TWV0aG9kKHRhcmdldCwgcHJvcCkgewogICAgaWYgKCEodGFyZ2V0IGluc3RhbmNlb2YgSURCRGF0YWJhc2UgJiYKICAgICAgICAhKHByb3AgaW4gdGFyZ2V0KSAmJgogICAgICAgIHR5cGVvZiBwcm9wID09PSAnc3RyaW5nJykpIHsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoY2FjaGVkTWV0aG9kcy5nZXQocHJvcCkpCiAgICAgICAgcmV0dXJuIGNhY2hlZE1ldGhvZHMuZ2V0KHByb3ApOwogICAgY29uc3QgdGFyZ2V0RnVuY05hbWUgPSBwcm9wLnJlcGxhY2UoL0Zyb21JbmRleCQvLCAnJyk7CiAgICBjb25zdCB1c2VJbmRleCA9IHByb3AgIT09IHRhcmdldEZ1bmNOYW1lOwogICAgY29uc3QgaXNXcml0ZSA9IHdyaXRlTWV0aG9kcy5pbmNsdWRlcyh0YXJnZXRGdW5jTmFtZSk7CiAgICBpZiAoCiAgICAvLyBCYWlsIGlmIHRoZSB0YXJnZXQgZG9lc24ndCBleGlzdCBvbiB0aGUgdGFyZ2V0LiBFZywgZ2V0QWxsIGlzbid0IGluIEVkZ2UuCiAgICAhKHRhcmdldEZ1bmNOYW1lIGluICh1c2VJbmRleCA/IElEQkluZGV4IDogSURCT2JqZWN0U3RvcmUpLnByb3RvdHlwZSkgfHwKICAgICAgICAhKGlzV3JpdGUgfHwgcmVhZE1ldGhvZHMuaW5jbHVkZXModGFyZ2V0RnVuY05hbWUpKSkgewogICAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG1ldGhvZCA9IGFzeW5jIGZ1bmN0aW9uIChzdG9yZU5hbWUsIC4uLmFyZ3MpIHsKICAgICAgICAvLyBpc1dyaXRlID8gJ3JlYWR3cml0ZScgOiB1bmRlZmluZWQgZ3ppcHBzIGJldHRlciwgYnV0IGZhaWxzIGluIEVkZ2UgOigKICAgICAgICBjb25zdCB0eCA9IHRoaXMudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBpc1dyaXRlID8gJ3JlYWR3cml0ZScgOiAncmVhZG9ubHknKTsKICAgICAgICBsZXQgdGFyZ2V0ID0gdHguc3RvcmU7CiAgICAgICAgaWYgKHVzZUluZGV4KQogICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXQuaW5kZXgoYXJncy5zaGlmdCgpKTsKICAgICAgICAvLyBNdXN0IHJlamVjdCBpZiBvcCByZWplY3RzLgogICAgICAgIC8vIElmIGl0J3MgYSB3cml0ZSBvcGVyYXRpb24sIG11c3QgcmVqZWN0IGlmIHR4LmRvbmUgcmVqZWN0cy4KICAgICAgICAvLyBNdXN0IHJlamVjdCB3aXRoIG9wIHJlamVjdGlvbiBmaXJzdC4KICAgICAgICAvLyBNdXN0IHJlc29sdmUgd2l0aCBvcCB2YWx1ZS4KICAgICAgICAvLyBNdXN0IGhhbmRsZSBib3RoIHByb21pc2VzIChubyB1bmhhbmRsZWQgcmVqZWN0aW9ucykKICAgICAgICByZXR1cm4gKGF3YWl0IFByb21pc2UuYWxsKFsKICAgICAgICAgICAgdGFyZ2V0W3RhcmdldEZ1bmNOYW1lXSguLi5hcmdzKSwKICAgICAgICAgICAgaXNXcml0ZSAmJiB0eC5kb25lLAogICAgICAgIF0pKVswXTsKICAgIH07CiAgICBjYWNoZWRNZXRob2RzLnNldChwcm9wLCBtZXRob2QpOwogICAgcmV0dXJuIG1ldGhvZDsKfQpyZXBsYWNlVHJhcHMoKG9sZFRyYXBzKSA9PiAoewogICAgLi4ub2xkVHJhcHMsCiAgICBnZXQ6ICh0YXJnZXQsIHByb3AsIHJlY2VpdmVyKSA9PiBnZXRNZXRob2QodGFyZ2V0LCBwcm9wKSB8fCBvbGRUcmFwcy5nZXQodGFyZ2V0LCBwcm9wLCByZWNlaXZlciksCiAgICBoYXM6ICh0YXJnZXQsIHByb3ApID0+ICEhZ2V0TWV0aG9kKHRhcmdldCwgcHJvcCkgfHwgb2xkVHJhcHMuaGFzKHRhcmdldCwgcHJvcCksCn0pKTsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNsYXNzIFBsYXRmb3JtTG9nZ2VyU2VydmljZUltcGwgew0KICAgIGNvbnN0cnVjdG9yKGNvbnRhaW5lcikgew0KICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjsNCiAgICB9DQogICAgLy8gSW4gaW5pdGlhbCBpbXBsZW1lbnRhdGlvbiwgdGhpcyB3aWxsIGJlIGNhbGxlZCBieSBpbnN0YWxsYXRpb25zIG9uDQogICAgLy8gYXV0aCB0b2tlbiByZWZyZXNoLCBhbmQgaW5zdGFsbGF0aW9ucyB3aWxsIHNlbmQgdGhpcyBzdHJpbmcuDQogICAgZ2V0UGxhdGZvcm1JbmZvU3RyaW5nKCkgew0KICAgICAgICBjb25zdCBwcm92aWRlcnMgPSB0aGlzLmNvbnRhaW5lci5nZXRQcm92aWRlcnMoKTsNCiAgICAgICAgLy8gTG9vcCB0aHJvdWdoIHByb3ZpZGVycyBhbmQgZ2V0IGxpYnJhcnkvdmVyc2lvbiBwYWlycyBmcm9tIGFueSB0aGF0IGFyZQ0KICAgICAgICAvLyB2ZXJzaW9uIGNvbXBvbmVudHMuDQogICAgICAgIHJldHVybiBwcm92aWRlcnMNCiAgICAgICAgICAgIC5tYXAocHJvdmlkZXIgPT4gew0KICAgICAgICAgICAgaWYgKGlzVmVyc2lvblNlcnZpY2VQcm92aWRlcihwcm92aWRlcikpIHsNCiAgICAgICAgICAgICAgICBjb25zdCBzZXJ2aWNlID0gcHJvdmlkZXIuZ2V0SW1tZWRpYXRlKCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGAke3NlcnZpY2UubGlicmFyeX0vJHtzZXJ2aWNlLnZlcnNpb259YDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgICAgICAgICAgLmZpbHRlcihsb2dTdHJpbmcgPT4gbG9nU3RyaW5nKQ0KICAgICAgICAgICAgLmpvaW4oJyAnKTsNCiAgICB9DQp9DQovKioNCiAqDQogKiBAcGFyYW0gcHJvdmlkZXIgY2hlY2sgaWYgdGhpcyBwcm92aWRlciBwcm92aWRlcyBhIFZlcnNpb25TZXJ2aWNlDQogKg0KICogTk9URTogVXNpbmcgUHJvdmlkZXI8J2FwcC12ZXJzaW9uJz4gaXMgYSBoYWNrIHRvIGluZGljYXRlIHRoYXQgdGhlIHByb3ZpZGVyDQogKiBwcm92aWRlcyBWZXJzaW9uU2VydmljZS4gVGhlIHByb3ZpZGVyIGlzIG5vdCBuZWNlc3NhcmlseSBhICdhcHAtdmVyc2lvbicNCiAqIHByb3ZpZGVyLg0KICovDQpmdW5jdGlvbiBpc1ZlcnNpb25TZXJ2aWNlUHJvdmlkZXIocHJvdmlkZXIpIHsNCiAgICBjb25zdCBjb21wb25lbnQgPSBwcm92aWRlci5nZXRDb21wb25lbnQoKTsNCiAgICByZXR1cm4gKGNvbXBvbmVudCA9PT0gbnVsbCB8fCBjb21wb25lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbXBvbmVudC50eXBlKSA9PT0gIlZFUlNJT04iIC8qIENvbXBvbmVudFR5cGUuVkVSU0lPTiAqLzsNCn0KCmNvbnN0IG5hbWUkbyQxID0gIkBmaXJlYmFzZS9hcHAiOwpjb25zdCB2ZXJzaW9uJDEkMSA9ICIwLjkuMTUiOwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY29uc3QgbG9nZ2VyJDEgPSBuZXcgTG9nZ2VyKCdAZmlyZWJhc2UvYXBwJyk7Cgpjb25zdCBuYW1lJG4kMSA9ICJAZmlyZWJhc2UvYXBwLWNvbXBhdCI7Cgpjb25zdCBuYW1lJG0kMSA9ICJAZmlyZWJhc2UvYW5hbHl0aWNzLWNvbXBhdCI7Cgpjb25zdCBuYW1lJGwkMSA9ICJAZmlyZWJhc2UvYW5hbHl0aWNzIjsKCmNvbnN0IG5hbWUkayQxID0gIkBmaXJlYmFzZS9hcHAtY2hlY2stY29tcGF0IjsKCmNvbnN0IG5hbWUkaiQxID0gIkBmaXJlYmFzZS9hcHAtY2hlY2siOwoKY29uc3QgbmFtZSRpJDEgPSAiQGZpcmViYXNlL2F1dGgiOwoKY29uc3QgbmFtZSRoJDEgPSAiQGZpcmViYXNlL2F1dGgtY29tcGF0IjsKCmNvbnN0IG5hbWUkZyQxID0gIkBmaXJlYmFzZS9kYXRhYmFzZSI7Cgpjb25zdCBuYW1lJGYkMSA9ICJAZmlyZWJhc2UvZGF0YWJhc2UtY29tcGF0IjsKCmNvbnN0IG5hbWUkZSQxID0gIkBmaXJlYmFzZS9mdW5jdGlvbnMiOwoKY29uc3QgbmFtZSRkJDEgPSAiQGZpcmViYXNlL2Z1bmN0aW9ucy1jb21wYXQiOwoKY29uc3QgbmFtZSRjJDEgPSAiQGZpcmViYXNlL2luc3RhbGxhdGlvbnMiOwoKY29uc3QgbmFtZSRiJDEgPSAiQGZpcmViYXNlL2luc3RhbGxhdGlvbnMtY29tcGF0IjsKCmNvbnN0IG5hbWUkYSQxID0gIkBmaXJlYmFzZS9tZXNzYWdpbmciOwoKY29uc3QgbmFtZSQ5JDEgPSAiQGZpcmViYXNlL21lc3NhZ2luZy1jb21wYXQiOwoKY29uc3QgbmFtZSQ4JDEgPSAiQGZpcmViYXNlL3BlcmZvcm1hbmNlIjsKCmNvbnN0IG5hbWUkNyQxID0gIkBmaXJlYmFzZS9wZXJmb3JtYW5jZS1jb21wYXQiOwoKY29uc3QgbmFtZSQ2JDEgPSAiQGZpcmViYXNlL3JlbW90ZS1jb25maWciOwoKY29uc3QgbmFtZSQ1JDEgPSAiQGZpcmViYXNlL3JlbW90ZS1jb25maWctY29tcGF0IjsKCmNvbnN0IG5hbWUkNCQxID0gIkBmaXJlYmFzZS9zdG9yYWdlIjsKCmNvbnN0IG5hbWUkMyQxID0gIkBmaXJlYmFzZS9zdG9yYWdlLWNvbXBhdCI7Cgpjb25zdCBuYW1lJDIkMSA9ICJAZmlyZWJhc2UvZmlyZXN0b3JlIjsKCmNvbnN0IG5hbWUkMSQxID0gIkBmaXJlYmFzZS9maXJlc3RvcmUtY29tcGF0IjsKCmNvbnN0IG5hbWUkSiA9ICJmaXJlYmFzZSI7CmNvbnN0IHZlcnNpb24kNSA9ICIxMC4xLjAiOwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBUaGUgZGVmYXVsdCBhcHAgbmFtZQ0KICoNCiAqIEBpbnRlcm5hbA0KICovDQpjb25zdCBERUZBVUxUX0VOVFJZX05BTUUgPSAnW0RFRkFVTFRdJzsNCmNvbnN0IFBMQVRGT1JNX0xPR19TVFJJTkcgPSB7DQogICAgW25hbWUkbyQxXTogJ2ZpcmUtY29yZScsDQogICAgW25hbWUkbiQxXTogJ2ZpcmUtY29yZS1jb21wYXQnLA0KICAgIFtuYW1lJGwkMV06ICdmaXJlLWFuYWx5dGljcycsDQogICAgW25hbWUkbSQxXTogJ2ZpcmUtYW5hbHl0aWNzLWNvbXBhdCcsDQogICAgW25hbWUkaiQxXTogJ2ZpcmUtYXBwLWNoZWNrJywNCiAgICBbbmFtZSRrJDFdOiAnZmlyZS1hcHAtY2hlY2stY29tcGF0JywNCiAgICBbbmFtZSRpJDFdOiAnZmlyZS1hdXRoJywNCiAgICBbbmFtZSRoJDFdOiAnZmlyZS1hdXRoLWNvbXBhdCcsDQogICAgW25hbWUkZyQxXTogJ2ZpcmUtcnRkYicsDQogICAgW25hbWUkZiQxXTogJ2ZpcmUtcnRkYi1jb21wYXQnLA0KICAgIFtuYW1lJGUkMV06ICdmaXJlLWZuJywNCiAgICBbbmFtZSRkJDFdOiAnZmlyZS1mbi1jb21wYXQnLA0KICAgIFtuYW1lJGMkMV06ICdmaXJlLWlpZCcsDQogICAgW25hbWUkYiQxXTogJ2ZpcmUtaWlkLWNvbXBhdCcsDQogICAgW25hbWUkYSQxXTogJ2ZpcmUtZmNtJywNCiAgICBbbmFtZSQ5JDFdOiAnZmlyZS1mY20tY29tcGF0JywNCiAgICBbbmFtZSQ4JDFdOiAnZmlyZS1wZXJmJywNCiAgICBbbmFtZSQ3JDFdOiAnZmlyZS1wZXJmLWNvbXBhdCcsDQogICAgW25hbWUkNiQxXTogJ2ZpcmUtcmMnLA0KICAgIFtuYW1lJDUkMV06ICdmaXJlLXJjLWNvbXBhdCcsDQogICAgW25hbWUkNCQxXTogJ2ZpcmUtZ2NzJywNCiAgICBbbmFtZSQzJDFdOiAnZmlyZS1nY3MtY29tcGF0JywNCiAgICBbbmFtZSQyJDFdOiAnZmlyZS1mc3QnLA0KICAgIFtuYW1lJDEkMV06ICdmaXJlLWZzdC1jb21wYXQnLA0KICAgICdmaXJlLWpzJzogJ2ZpcmUtanMnLA0KICAgIFtuYW1lJEpdOiAnZmlyZS1qcy1hbGwnDQp9OwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBAaW50ZXJuYWwNCiAqLw0KY29uc3QgX2FwcHMgPSBuZXcgTWFwKCk7DQovKioNCiAqIFJlZ2lzdGVyZWQgY29tcG9uZW50cy4NCiAqDQogKiBAaW50ZXJuYWwNCiAqLw0KLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCmNvbnN0IF9jb21wb25lbnRzID0gbmV3IE1hcCgpOw0KLyoqDQogKiBAcGFyYW0gY29tcG9uZW50IC0gdGhlIGNvbXBvbmVudCBiZWluZyBhZGRlZCB0byB0aGlzIGFwcCdzIGNvbnRhaW5lcg0KICoNCiAqIEBpbnRlcm5hbA0KICovDQpmdW5jdGlvbiBfYWRkQ29tcG9uZW50KGFwcCwgY29tcG9uZW50KSB7DQogICAgdHJ5IHsNCiAgICAgICAgYXBwLmNvbnRhaW5lci5hZGRDb21wb25lbnQoY29tcG9uZW50KTsNCiAgICB9DQogICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgbG9nZ2VyJDEuZGVidWcoYENvbXBvbmVudCAke2NvbXBvbmVudC5uYW1lfSBmYWlsZWQgdG8gcmVnaXN0ZXIgd2l0aCBGaXJlYmFzZUFwcCAke2FwcC5uYW1lfWAsIGUpOw0KICAgIH0NCn0NCi8qKg0KICoNCiAqIEBwYXJhbSBjb21wb25lbnQgLSB0aGUgY29tcG9uZW50IHRvIHJlZ2lzdGVyDQogKiBAcmV0dXJucyB3aGV0aGVyIG9yIG5vdCB0aGUgY29tcG9uZW50IGlzIHJlZ2lzdGVyZWQgc3VjY2Vzc2Z1bGx5DQogKg0KICogQGludGVybmFsDQogKi8NCmZ1bmN0aW9uIF9yZWdpc3RlckNvbXBvbmVudChjb21wb25lbnQpIHsNCiAgICBjb25zdCBjb21wb25lbnROYW1lID0gY29tcG9uZW50Lm5hbWU7DQogICAgaWYgKF9jb21wb25lbnRzLmhhcyhjb21wb25lbnROYW1lKSkgew0KICAgICAgICBsb2dnZXIkMS5kZWJ1ZyhgVGhlcmUgd2VyZSBtdWx0aXBsZSBhdHRlbXB0cyB0byByZWdpc3RlciBjb21wb25lbnQgJHtjb21wb25lbnROYW1lfS5gKTsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBfY29tcG9uZW50cy5zZXQoY29tcG9uZW50TmFtZSwgY29tcG9uZW50KTsNCiAgICAvLyBhZGQgdGhlIGNvbXBvbmVudCB0byBleGlzdGluZyBhcHAgaW5zdGFuY2VzDQogICAgZm9yIChjb25zdCBhcHAgb2YgX2FwcHMudmFsdWVzKCkpIHsNCiAgICAgICAgX2FkZENvbXBvbmVudChhcHAsIGNvbXBvbmVudCk7DQogICAgfQ0KICAgIHJldHVybiB0cnVlOw0KfQ0KLyoqDQogKg0KICogQHBhcmFtIGFwcCAtIEZpcmViYXNlQXBwIGluc3RhbmNlDQogKiBAcGFyYW0gbmFtZSAtIHNlcnZpY2UgbmFtZQ0KICoNCiAqIEByZXR1cm5zIHRoZSBwcm92aWRlciBmb3IgdGhlIHNlcnZpY2Ugd2l0aCB0aGUgbWF0Y2hpbmcgbmFtZQ0KICoNCiAqIEBpbnRlcm5hbA0KICovDQpmdW5jdGlvbiBfZ2V0UHJvdmlkZXIoYXBwLCBuYW1lKSB7DQogICAgY29uc3QgaGVhcnRiZWF0Q29udHJvbGxlciA9IGFwcC5jb250YWluZXINCiAgICAgICAgLmdldFByb3ZpZGVyKCdoZWFydGJlYXQnKQ0KICAgICAgICAuZ2V0SW1tZWRpYXRlKHsgb3B0aW9uYWw6IHRydWUgfSk7DQogICAgaWYgKGhlYXJ0YmVhdENvbnRyb2xsZXIpIHsNCiAgICAgICAgdm9pZCBoZWFydGJlYXRDb250cm9sbGVyLnRyaWdnZXJIZWFydGJlYXQoKTsNCiAgICB9DQogICAgcmV0dXJuIGFwcC5jb250YWluZXIuZ2V0UHJvdmlkZXIobmFtZSk7DQp9DQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY29uc3QgRVJST1JTID0gew0KICAgIFsibm8tYXBwIiAvKiBBcHBFcnJvci5OT19BUFAgKi9dOiAiTm8gRmlyZWJhc2UgQXBwICd7JGFwcE5hbWV9JyBoYXMgYmVlbiBjcmVhdGVkIC0gIiArDQogICAgICAgICdjYWxsIGluaXRpYWxpemVBcHAoKSBmaXJzdCcsDQogICAgWyJiYWQtYXBwLW5hbWUiIC8qIEFwcEVycm9yLkJBRF9BUFBfTkFNRSAqL106ICJJbGxlZ2FsIEFwcCBuYW1lOiAneyRhcHBOYW1lfSIsDQogICAgWyJkdXBsaWNhdGUtYXBwIiAvKiBBcHBFcnJvci5EVVBMSUNBVEVfQVBQICovXTogIkZpcmViYXNlIEFwcCBuYW1lZCAneyRhcHBOYW1lfScgYWxyZWFkeSBleGlzdHMgd2l0aCBkaWZmZXJlbnQgb3B0aW9ucyBvciBjb25maWciLA0KICAgIFsiYXBwLWRlbGV0ZWQiIC8qIEFwcEVycm9yLkFQUF9ERUxFVEVEICovXTogIkZpcmViYXNlIEFwcCBuYW1lZCAneyRhcHBOYW1lfScgYWxyZWFkeSBkZWxldGVkIiwNCiAgICBbIm5vLW9wdGlvbnMiIC8qIEFwcEVycm9yLk5PX09QVElPTlMgKi9dOiAnTmVlZCB0byBwcm92aWRlIG9wdGlvbnMsIHdoZW4gbm90IGJlaW5nIGRlcGxveWVkIHRvIGhvc3RpbmcgdmlhIHNvdXJjZS4nLA0KICAgIFsiaW52YWxpZC1hcHAtYXJndW1lbnQiIC8qIEFwcEVycm9yLklOVkFMSURfQVBQX0FSR1VNRU5UICovXTogJ2ZpcmViYXNlLnskYXBwTmFtZX0oKSB0YWtlcyBlaXRoZXIgbm8gYXJndW1lbnQgb3IgYSAnICsNCiAgICAgICAgJ0ZpcmViYXNlIEFwcCBpbnN0YW5jZS4nLA0KICAgIFsiaW52YWxpZC1sb2ctYXJndW1lbnQiIC8qIEFwcEVycm9yLklOVkFMSURfTE9HX0FSR1VNRU5UICovXTogJ0ZpcnN0IGFyZ3VtZW50IHRvIGBvbkxvZ2AgbXVzdCBiZSBudWxsIG9yIGEgZnVuY3Rpb24uJywNCiAgICBbImlkYi1vcGVuIiAvKiBBcHBFcnJvci5JREJfT1BFTiAqL106ICdFcnJvciB0aHJvd24gd2hlbiBvcGVuaW5nIEluZGV4ZWREQi4gT3JpZ2luYWwgZXJyb3I6IHskb3JpZ2luYWxFcnJvck1lc3NhZ2V9LicsDQogICAgWyJpZGItZ2V0IiAvKiBBcHBFcnJvci5JREJfR0VUICovXTogJ0Vycm9yIHRocm93biB3aGVuIHJlYWRpbmcgZnJvbSBJbmRleGVkREIuIE9yaWdpbmFsIGVycm9yOiB7JG9yaWdpbmFsRXJyb3JNZXNzYWdlfS4nLA0KICAgIFsiaWRiLXNldCIgLyogQXBwRXJyb3IuSURCX1dSSVRFICovXTogJ0Vycm9yIHRocm93biB3aGVuIHdyaXRpbmcgdG8gSW5kZXhlZERCLiBPcmlnaW5hbCBlcnJvcjogeyRvcmlnaW5hbEVycm9yTWVzc2FnZX0uJywNCiAgICBbImlkYi1kZWxldGUiIC8qIEFwcEVycm9yLklEQl9ERUxFVEUgKi9dOiAnRXJyb3IgdGhyb3duIHdoZW4gZGVsZXRpbmcgZnJvbSBJbmRleGVkREIuIE9yaWdpbmFsIGVycm9yOiB7JG9yaWdpbmFsRXJyb3JNZXNzYWdlfS4nDQp9Ow0KY29uc3QgRVJST1JfRkFDVE9SWSA9IG5ldyBFcnJvckZhY3RvcnkoJ2FwcCcsICdGaXJlYmFzZScsIEVSUk9SUyk7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBGaXJlYmFzZUFwcEltcGwgew0KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMsIGNvbmZpZywgY29udGFpbmVyKSB7DQogICAgICAgIHRoaXMuX2lzRGVsZXRlZCA9IGZhbHNlOw0KICAgICAgICB0aGlzLl9vcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucyk7DQogICAgICAgIHRoaXMuX2NvbmZpZyA9IE9iamVjdC5hc3NpZ24oe30sIGNvbmZpZyk7DQogICAgICAgIHRoaXMuX25hbWUgPSBjb25maWcubmFtZTsNCiAgICAgICAgdGhpcy5fYXV0b21hdGljRGF0YUNvbGxlY3Rpb25FbmFibGVkID0NCiAgICAgICAgICAgIGNvbmZpZy5hdXRvbWF0aWNEYXRhQ29sbGVjdGlvbkVuYWJsZWQ7DQogICAgICAgIHRoaXMuX2NvbnRhaW5lciA9IGNvbnRhaW5lcjsNCiAgICAgICAgdGhpcy5jb250YWluZXIuYWRkQ29tcG9uZW50KG5ldyBDb21wb25lbnQoJ2FwcCcsICgpID0+IHRoaXMsICJQVUJMSUMiIC8qIENvbXBvbmVudFR5cGUuUFVCTElDICovKSk7DQogICAgfQ0KICAgIGdldCBhdXRvbWF0aWNEYXRhQ29sbGVjdGlvbkVuYWJsZWQoKSB7DQogICAgICAgIHRoaXMuY2hlY2tEZXN0cm95ZWQoKTsNCiAgICAgICAgcmV0dXJuIHRoaXMuX2F1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZDsNCiAgICB9DQogICAgc2V0IGF1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZCh2YWwpIHsNCiAgICAgICAgdGhpcy5jaGVja0Rlc3Ryb3llZCgpOw0KICAgICAgICB0aGlzLl9hdXRvbWF0aWNEYXRhQ29sbGVjdGlvbkVuYWJsZWQgPSB2YWw7DQogICAgfQ0KICAgIGdldCBuYW1lKCkgew0KICAgICAgICB0aGlzLmNoZWNrRGVzdHJveWVkKCk7DQogICAgICAgIHJldHVybiB0aGlzLl9uYW1lOw0KICAgIH0NCiAgICBnZXQgb3B0aW9ucygpIHsNCiAgICAgICAgdGhpcy5jaGVja0Rlc3Ryb3llZCgpOw0KICAgICAgICByZXR1cm4gdGhpcy5fb3B0aW9uczsNCiAgICB9DQogICAgZ2V0IGNvbmZpZygpIHsNCiAgICAgICAgdGhpcy5jaGVja0Rlc3Ryb3llZCgpOw0KICAgICAgICByZXR1cm4gdGhpcy5fY29uZmlnOw0KICAgIH0NCiAgICBnZXQgY29udGFpbmVyKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5fY29udGFpbmVyOw0KICAgIH0NCiAgICBnZXQgaXNEZWxldGVkKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5faXNEZWxldGVkOw0KICAgIH0NCiAgICBzZXQgaXNEZWxldGVkKHZhbCkgew0KICAgICAgICB0aGlzLl9pc0RlbGV0ZWQgPSB2YWw7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFRoaXMgZnVuY3Rpb24gd2lsbCB0aHJvdyBhbiBFcnJvciBpZiB0aGUgQXBwIGhhcyBhbHJlYWR5IGJlZW4gZGVsZXRlZCAtDQogICAgICogdXNlIGJlZm9yZSBwZXJmb3JtaW5nIEFQSSBhY3Rpb25zIG9uIHRoZSBBcHAuDQogICAgICovDQogICAgY2hlY2tEZXN0cm95ZWQoKSB7DQogICAgICAgIGlmICh0aGlzLmlzRGVsZXRlZCkgew0KICAgICAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoImFwcC1kZWxldGVkIiAvKiBBcHBFcnJvci5BUFBfREVMRVRFRCAqLywgeyBhcHBOYW1lOiB0aGlzLl9uYW1lIH0pOw0KICAgICAgICB9DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBUaGUgY3VycmVudCBTREsgdmVyc2lvbi4NCiAqDQogKiBAcHVibGljDQogKi8NCmNvbnN0IFNES19WRVJTSU9OJDEgPSB2ZXJzaW9uJDU7DQpmdW5jdGlvbiBpbml0aWFsaXplQXBwKF9vcHRpb25zLCByYXdDb25maWcgPSB7fSkgew0KICAgIGxldCBvcHRpb25zID0gX29wdGlvbnM7DQogICAgaWYgKHR5cGVvZiByYXdDb25maWcgIT09ICdvYmplY3QnKSB7DQogICAgICAgIGNvbnN0IG5hbWUgPSByYXdDb25maWc7DQogICAgICAgIHJhd0NvbmZpZyA9IHsgbmFtZSB9Ow0KICAgIH0NCiAgICBjb25zdCBjb25maWcgPSBPYmplY3QuYXNzaWduKHsgbmFtZTogREVGQVVMVF9FTlRSWV9OQU1FLCBhdXRvbWF0aWNEYXRhQ29sbGVjdGlvbkVuYWJsZWQ6IGZhbHNlIH0sIHJhd0NvbmZpZyk7DQogICAgY29uc3QgbmFtZSA9IGNvbmZpZy5uYW1lOw0KICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gJ3N0cmluZycgfHwgIW5hbWUpIHsNCiAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoImJhZC1hcHAtbmFtZSIgLyogQXBwRXJyb3IuQkFEX0FQUF9OQU1FICovLCB7DQogICAgICAgICAgICBhcHBOYW1lOiBTdHJpbmcobmFtZSkNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSBnZXREZWZhdWx0QXBwQ29uZmlnKCkpOw0KICAgIGlmICghb3B0aW9ucykgew0KICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZSgibm8tb3B0aW9ucyIgLyogQXBwRXJyb3IuTk9fT1BUSU9OUyAqLyk7DQogICAgfQ0KICAgIGNvbnN0IGV4aXN0aW5nQXBwID0gX2FwcHMuZ2V0KG5hbWUpOw0KICAgIGlmIChleGlzdGluZ0FwcCkgew0KICAgICAgICAvLyByZXR1cm4gdGhlIGV4aXN0aW5nIGFwcCBpZiBvcHRpb25zIGFuZCBjb25maWcgZGVlcCBlcXVhbCB0aGUgb25lcyBpbiB0aGUgZXhpc3RpbmcgYXBwLg0KICAgICAgICBpZiAoZGVlcEVxdWFsKG9wdGlvbnMsIGV4aXN0aW5nQXBwLm9wdGlvbnMpICYmDQogICAgICAgICAgICBkZWVwRXF1YWwoY29uZmlnLCBleGlzdGluZ0FwcC5jb25maWcpKSB7DQogICAgICAgICAgICByZXR1cm4gZXhpc3RpbmdBcHA7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZSgiZHVwbGljYXRlLWFwcCIgLyogQXBwRXJyb3IuRFVQTElDQVRFX0FQUCAqLywgeyBhcHBOYW1lOiBuYW1lIH0pOw0KICAgICAgICB9DQogICAgfQ0KICAgIGNvbnN0IGNvbnRhaW5lciA9IG5ldyBDb21wb25lbnRDb250YWluZXIobmFtZSk7DQogICAgZm9yIChjb25zdCBjb21wb25lbnQgb2YgX2NvbXBvbmVudHMudmFsdWVzKCkpIHsNCiAgICAgICAgY29udGFpbmVyLmFkZENvbXBvbmVudChjb21wb25lbnQpOw0KICAgIH0NCiAgICBjb25zdCBuZXdBcHAgPSBuZXcgRmlyZWJhc2VBcHBJbXBsKG9wdGlvbnMsIGNvbmZpZywgY29udGFpbmVyKTsNCiAgICBfYXBwcy5zZXQobmFtZSwgbmV3QXBwKTsNCiAgICByZXR1cm4gbmV3QXBwOw0KfQ0KLyoqDQogKiBSZXRyaWV2ZXMgYSB7QGxpbmsgQGZpcmViYXNlL2FwcCNGaXJlYmFzZUFwcH0gaW5zdGFuY2UuDQogKg0KICogV2hlbiBjYWxsZWQgd2l0aCBubyBhcmd1bWVudHMsIHRoZSBkZWZhdWx0IGFwcCBpcyByZXR1cm5lZC4gV2hlbiBhbiBhcHAgbmFtZQ0KICogaXMgcHJvdmlkZWQsIHRoZSBhcHAgY29ycmVzcG9uZGluZyB0byB0aGF0IG5hbWUgaXMgcmV0dXJuZWQuDQogKg0KICogQW4gZXhjZXB0aW9uIGlzIHRocm93biBpZiB0aGUgYXBwIGJlaW5nIHJldHJpZXZlZCBoYXMgbm90IHlldCBiZWVuDQogKiBpbml0aWFsaXplZC4NCiAqDQogKiBAZXhhbXBsZQ0KICogYGBgamF2YXNjcmlwdA0KICogLy8gUmV0dXJuIHRoZSBkZWZhdWx0IGFwcA0KICogY29uc3QgYXBwID0gZ2V0QXBwKCk7DQogKiBgYGANCiAqDQogKiBAZXhhbXBsZQ0KICogYGBgamF2YXNjcmlwdA0KICogLy8gUmV0dXJuIGEgbmFtZWQgYXBwDQogKiBjb25zdCBvdGhlckFwcCA9IGdldEFwcCgib3RoZXJBcHAiKTsNCiAqIGBgYA0KICoNCiAqIEBwYXJhbSBuYW1lIC0gT3B0aW9uYWwgbmFtZSBvZiB0aGUgYXBwIHRvIHJldHVybi4gSWYgbm8gbmFtZSBpcw0KICogICBwcm92aWRlZCwgdGhlIGRlZmF1bHQgaXMgYCJbREVGQVVMVF0iYC4NCiAqDQogKiBAcmV0dXJucyBUaGUgYXBwIGNvcnJlc3BvbmRpbmcgdG8gdGhlIHByb3ZpZGVkIGFwcCBuYW1lLg0KICogICBJZiBubyBhcHAgbmFtZSBpcyBwcm92aWRlZCwgdGhlIGRlZmF1bHQgYXBwIGlzIHJldHVybmVkLg0KICoNCiAqIEBwdWJsaWMNCiAqLw0KZnVuY3Rpb24gZ2V0QXBwKG5hbWUgPSBERUZBVUxUX0VOVFJZX05BTUUpIHsNCiAgICBjb25zdCBhcHAgPSBfYXBwcy5nZXQobmFtZSk7DQogICAgaWYgKCFhcHAgJiYgbmFtZSA9PT0gREVGQVVMVF9FTlRSWV9OQU1FICYmIGdldERlZmF1bHRBcHBDb25maWcoKSkgew0KICAgICAgICByZXR1cm4gaW5pdGlhbGl6ZUFwcCgpOw0KICAgIH0NCiAgICBpZiAoIWFwcCkgew0KICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZSgibm8tYXBwIiAvKiBBcHBFcnJvci5OT19BUFAgKi8sIHsgYXBwTmFtZTogbmFtZSB9KTsNCiAgICB9DQogICAgcmV0dXJuIGFwcDsNCn0NCi8qKg0KICogUmVnaXN0ZXJzIGEgbGlicmFyeSdzIG5hbWUgYW5kIHZlcnNpb24gZm9yIHBsYXRmb3JtIGxvZ2dpbmcgcHVycG9zZXMuDQogKiBAcGFyYW0gbGlicmFyeSAtIE5hbWUgb2YgMXAgb3IgM3AgbGlicmFyeSAoZS5nLiBmaXJlc3RvcmUsIGFuZ3VsYXJmaXJlKQ0KICogQHBhcmFtIHZlcnNpb24gLSBDdXJyZW50IHZlcnNpb24gb2YgdGhhdCBsaWJyYXJ5Lg0KICogQHBhcmFtIHZhcmlhbnQgLSBCdW5kbGUgdmFyaWFudCwgZS5nLiwgbm9kZSwgcm4sIGV0Yy4NCiAqDQogKiBAcHVibGljDQogKi8NCmZ1bmN0aW9uIHJlZ2lzdGVyVmVyc2lvbihsaWJyYXJ5S2V5T3JOYW1lLCB2ZXJzaW9uLCB2YXJpYW50KSB7DQogICAgdmFyIF9hOw0KICAgIC8vIFRPRE86IFdlIGNhbiB1c2UgdGhpcyBjaGVjayB0byB3aGl0ZWxpc3Qgc3RyaW5ncyB3aGVuL2lmIHdlIHNldCB1cA0KICAgIC8vIGEgZ29vZCB3aGl0ZWxpc3Qgc3lzdGVtLg0KICAgIGxldCBsaWJyYXJ5ID0gKF9hID0gUExBVEZPUk1fTE9HX1NUUklOR1tsaWJyYXJ5S2V5T3JOYW1lXSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogbGlicmFyeUtleU9yTmFtZTsNCiAgICBpZiAodmFyaWFudCkgew0KICAgICAgICBsaWJyYXJ5ICs9IGAtJHt2YXJpYW50fWA7DQogICAgfQ0KICAgIGNvbnN0IGxpYnJhcnlNaXNtYXRjaCA9IGxpYnJhcnkubWF0Y2goL1xzfFwvLyk7DQogICAgY29uc3QgdmVyc2lvbk1pc21hdGNoID0gdmVyc2lvbi5tYXRjaCgvXHN8XC8vKTsNCiAgICBpZiAobGlicmFyeU1pc21hdGNoIHx8IHZlcnNpb25NaXNtYXRjaCkgew0KICAgICAgICBjb25zdCB3YXJuaW5nID0gWw0KICAgICAgICAgICAgYFVuYWJsZSB0byByZWdpc3RlciBsaWJyYXJ5ICIke2xpYnJhcnl9IiB3aXRoIHZlcnNpb24gIiR7dmVyc2lvbn0iOmANCiAgICAgICAgXTsNCiAgICAgICAgaWYgKGxpYnJhcnlNaXNtYXRjaCkgew0KICAgICAgICAgICAgd2FybmluZy5wdXNoKGBsaWJyYXJ5IG5hbWUgIiR7bGlicmFyeX0iIGNvbnRhaW5zIGlsbGVnYWwgY2hhcmFjdGVycyAod2hpdGVzcGFjZSBvciAiLyIpYCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGxpYnJhcnlNaXNtYXRjaCAmJiB2ZXJzaW9uTWlzbWF0Y2gpIHsNCiAgICAgICAgICAgIHdhcm5pbmcucHVzaCgnYW5kJyk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHZlcnNpb25NaXNtYXRjaCkgew0KICAgICAgICAgICAgd2FybmluZy5wdXNoKGB2ZXJzaW9uIG5hbWUgIiR7dmVyc2lvbn0iIGNvbnRhaW5zIGlsbGVnYWwgY2hhcmFjdGVycyAod2hpdGVzcGFjZSBvciAiLyIpYCk7DQogICAgICAgIH0NCiAgICAgICAgbG9nZ2VyJDEud2Fybih3YXJuaW5nLmpvaW4oJyAnKSk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgX3JlZ2lzdGVyQ29tcG9uZW50KG5ldyBDb21wb25lbnQoYCR7bGlicmFyeX0tdmVyc2lvbmAsICgpID0+ICh7IGxpYnJhcnksIHZlcnNpb24gfSksICJWRVJTSU9OIiAvKiBDb21wb25lbnRUeXBlLlZFUlNJT04gKi8pKTsNCn0NCgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjb25zdCBEQl9OQU1FJDEgPSAnZmlyZWJhc2UtaGVhcnRiZWF0LWRhdGFiYXNlJzsNCmNvbnN0IERCX1ZFUlNJT04kMSA9IDE7DQpjb25zdCBTVE9SRV9OQU1FID0gJ2ZpcmViYXNlLWhlYXJ0YmVhdC1zdG9yZSc7DQpsZXQgZGJQcm9taXNlID0gbnVsbDsNCmZ1bmN0aW9uIGdldERiUHJvbWlzZSgpIHsNCiAgICBpZiAoIWRiUHJvbWlzZSkgew0KICAgICAgICBkYlByb21pc2UgPSBvcGVuREIoREJfTkFNRSQxLCBEQl9WRVJTSU9OJDEsIHsNCiAgICAgICAgICAgIHVwZ3JhZGU6IChkYiwgb2xkVmVyc2lvbikgPT4gew0KICAgICAgICAgICAgICAgIC8vIFdlIGRvbid0IHVzZSAnYnJlYWsnIGluIHRoaXMgc3dpdGNoIHN0YXRlbWVudCwgdGhlIGZhbGwtdGhyb3VnaA0KICAgICAgICAgICAgICAgIC8vIGJlaGF2aW9yIGlzIHdoYXQgd2Ugd2FudCwgYmVjYXVzZSBpZiB0aGVyZSBhcmUgbXVsdGlwbGUgdmVyc2lvbnMgYmV0d2Vlbg0KICAgICAgICAgICAgICAgIC8vIHRoZSBvbGQgdmVyc2lvbiBhbmQgdGhlIGN1cnJlbnQgdmVyc2lvbiwgd2Ugd2FudCBBTEwgdGhlIG1pZ3JhdGlvbnMNCiAgICAgICAgICAgICAgICAvLyB0aGF0IGNvcnJlc3BvbmQgdG8gdGhvc2UgdmVyc2lvbnMgdG8gcnVuLCBub3Qgb25seSB0aGUgbGFzdCBvbmUuDQogICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlZmF1bHQtY2FzZQ0KICAgICAgICAgICAgICAgIHN3aXRjaCAob2xkVmVyc2lvbikgew0KICAgICAgICAgICAgICAgICAgICBjYXNlIDA6DQogICAgICAgICAgICAgICAgICAgICAgICBkYi5jcmVhdGVPYmplY3RTdG9yZShTVE9SRV9OQU1FKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0pLmNhdGNoKGUgPT4gew0KICAgICAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoImlkYi1vcGVuIiAvKiBBcHBFcnJvci5JREJfT1BFTiAqLywgew0KICAgICAgICAgICAgICAgIG9yaWdpbmFsRXJyb3JNZXNzYWdlOiBlLm1lc3NhZ2UNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCiAgICB9DQogICAgcmV0dXJuIGRiUHJvbWlzZTsNCn0NCmFzeW5jIGZ1bmN0aW9uIHJlYWRIZWFydGJlYXRzRnJvbUluZGV4ZWREQihhcHApIHsNCiAgICB0cnkgew0KICAgICAgICBjb25zdCBkYiA9IGF3YWl0IGdldERiUHJvbWlzZSgpOw0KICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYg0KICAgICAgICAgICAgLnRyYW5zYWN0aW9uKFNUT1JFX05BTUUpDQogICAgICAgICAgICAub2JqZWN0U3RvcmUoU1RPUkVfTkFNRSkNCiAgICAgICAgICAgIC5nZXQoY29tcHV0ZUtleShhcHApKTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQogICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBGaXJlYmFzZUVycm9yKSB7DQogICAgICAgICAgICBsb2dnZXIkMS53YXJuKGUubWVzc2FnZSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBjb25zdCBpZGJHZXRFcnJvciA9IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKCJpZGItZ2V0IiAvKiBBcHBFcnJvci5JREJfR0VUICovLCB7DQogICAgICAgICAgICAgICAgb3JpZ2luYWxFcnJvck1lc3NhZ2U6IGUgPT09IG51bGwgfHwgZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZS5tZXNzYWdlDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGxvZ2dlciQxLndhcm4oaWRiR2V0RXJyb3IubWVzc2FnZSk7DQogICAgICAgIH0NCiAgICB9DQp9DQphc3luYyBmdW5jdGlvbiB3cml0ZUhlYXJ0YmVhdHNUb0luZGV4ZWREQihhcHAsIGhlYXJ0YmVhdE9iamVjdCkgew0KICAgIHRyeSB7DQogICAgICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0RGJQcm9taXNlKCk7DQogICAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oU1RPUkVfTkFNRSwgJ3JlYWR3cml0ZScpOw0KICAgICAgICBjb25zdCBvYmplY3RTdG9yZSA9IHR4Lm9iamVjdFN0b3JlKFNUT1JFX05BTUUpOw0KICAgICAgICBhd2FpdCBvYmplY3RTdG9yZS5wdXQoaGVhcnRiZWF0T2JqZWN0LCBjb21wdXRlS2V5KGFwcCkpOw0KICAgICAgICBhd2FpdCB0eC5kb25lOw0KICAgIH0NCiAgICBjYXRjaCAoZSkgew0KICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEZpcmViYXNlRXJyb3IpIHsNCiAgICAgICAgICAgIGxvZ2dlciQxLndhcm4oZS5tZXNzYWdlKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IGlkYkdldEVycm9yID0gRVJST1JfRkFDVE9SWS5jcmVhdGUoImlkYi1zZXQiIC8qIEFwcEVycm9yLklEQl9XUklURSAqLywgew0KICAgICAgICAgICAgICAgIG9yaWdpbmFsRXJyb3JNZXNzYWdlOiBlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUubWVzc2FnZQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBsb2dnZXIkMS53YXJuKGlkYkdldEVycm9yLm1lc3NhZ2UpOw0KICAgICAgICB9DQogICAgfQ0KfQ0KZnVuY3Rpb24gY29tcHV0ZUtleShhcHApIHsNCiAgICByZXR1cm4gYCR7YXBwLm5hbWV9ISR7YXBwLm9wdGlvbnMuYXBwSWR9YDsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNvbnN0IE1BWF9IRUFERVJfQllURVMgPSAxMDI0Ow0KLy8gMzAgZGF5cw0KY29uc3QgU1RPUkVEX0hFQVJUQkVBVF9SRVRFTlRJT05fTUFYX01JTExJUyA9IDMwICogMjQgKiA2MCAqIDYwICogMTAwMDsNCmNsYXNzIEhlYXJ0YmVhdFNlcnZpY2VJbXBsIHsNCiAgICBjb25zdHJ1Y3Rvcihjb250YWluZXIpIHsNCiAgICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbi1tZW1vcnkgY2FjaGUgZm9yIGhlYXJ0YmVhdHMsIHVzZWQgYnkgZ2V0SGVhcnRiZWF0c0hlYWRlcigpIHRvIGdlbmVyYXRlDQogICAgICAgICAqIHRoZSBoZWFkZXIgc3RyaW5nLg0KICAgICAgICAgKiBTdG9yZXMgb25lIHJlY29yZCBwZXIgZGF0ZS4gVGhpcyB3aWxsIGJlIGNvbnNvbGlkYXRlZCBpbnRvIHRoZSBzdGFuZGFyZA0KICAgICAgICAgKiBmb3JtYXQgb2Ygb25lIHJlY29yZCBwZXIgdXNlciBhZ2VudCBzdHJpbmcgYmVmb3JlIGJlaW5nIHNlbnQgYXMgYSBoZWFkZXIuDQogICAgICAgICAqIFBvcHVsYXRlZCBmcm9tIGluZGV4ZWREQiB3aGVuIHRoZSBjb250cm9sbGVyIGlzIGluc3RhbnRpYXRlZCBhbmQgc2hvdWxkDQogICAgICAgICAqIGJlIGtlcHQgaW4gc3luYyB3aXRoIGluZGV4ZWREQi4NCiAgICAgICAgICogTGVhdmUgcHVibGljIGZvciBlYXNpZXIgdGVzdGluZy4NCiAgICAgICAgICovDQogICAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZSA9IG51bGw7DQogICAgICAgIGNvbnN0IGFwcCA9IHRoaXMuY29udGFpbmVyLmdldFByb3ZpZGVyKCdhcHAnKS5nZXRJbW1lZGlhdGUoKTsNCiAgICAgICAgdGhpcy5fc3RvcmFnZSA9IG5ldyBIZWFydGJlYXRTdG9yYWdlSW1wbChhcHApOw0KICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGVQcm9taXNlID0gdGhpcy5fc3RvcmFnZS5yZWFkKCkudGhlbihyZXN1bHQgPT4gew0KICAgICAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlID0gcmVzdWx0Ow0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIENhbGxlZCB0byByZXBvcnQgYSBoZWFydGJlYXQuIFRoZSBmdW5jdGlvbiB3aWxsIGdlbmVyYXRlDQogICAgICogYSBIZWFydGJlYXRzQnlVc2VyQWdlbnQgb2JqZWN0LCB1cGRhdGUgaGVhcnRiZWF0c0NhY2hlLCBhbmQgcGVyc2lzdCBpdA0KICAgICAqIHRvIEluZGV4ZWREQi4NCiAgICAgKiBOb3RlIHRoYXQgd2Ugb25seSBzdG9yZSBvbmUgaGVhcnRiZWF0IHBlciBkYXkuIFNvIGlmIGEgaGVhcnRiZWF0IGZvciB0b2RheSBpcw0KICAgICAqIGFscmVhZHkgbG9nZ2VkLCBzdWJzZXF1ZW50IGNhbGxzIHRvIHRoaXMgZnVuY3Rpb24gaW4gdGhlIHNhbWUgZGF5IHdpbGwgYmUgaWdub3JlZC4NCiAgICAgKi8NCiAgICBhc3luYyB0cmlnZ2VySGVhcnRiZWF0KCkgew0KICAgICAgICBjb25zdCBwbGF0Zm9ybUxvZ2dlciA9IHRoaXMuY29udGFpbmVyDQogICAgICAgICAgICAuZ2V0UHJvdmlkZXIoJ3BsYXRmb3JtLWxvZ2dlcicpDQogICAgICAgICAgICAuZ2V0SW1tZWRpYXRlKCk7DQogICAgICAgIC8vIFRoaXMgaXMgdGhlICJGaXJlYmFzZSB1c2VyIGFnZW50IiBzdHJpbmcgZnJvbSB0aGUgcGxhdGZvcm0gbG9nZ2VyDQogICAgICAgIC8vIHNlcnZpY2UsIG5vdCB0aGUgYnJvd3NlciB1c2VyIGFnZW50Lg0KICAgICAgICBjb25zdCBhZ2VudCA9IHBsYXRmb3JtTG9nZ2VyLmdldFBsYXRmb3JtSW5mb1N0cmluZygpOw0KICAgICAgICBjb25zdCBkYXRlID0gZ2V0VVRDRGF0ZVN0cmluZygpOw0KICAgICAgICBpZiAodGhpcy5faGVhcnRiZWF0c0NhY2hlID09PSBudWxsKSB7DQogICAgICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGUgPSBhd2FpdCB0aGlzLl9oZWFydGJlYXRzQ2FjaGVQcm9taXNlOw0KICAgICAgICB9DQogICAgICAgIC8vIERvIG5vdCBzdG9yZSBhIGhlYXJ0YmVhdCBpZiBvbmUgaXMgYWxyZWFkeSBzdG9yZWQgZm9yIHRoaXMgZGF5DQogICAgICAgIC8vIG9yIGlmIGEgaGVhZGVyIGhhcyBhbHJlYWR5IGJlZW4gc2VudCB0b2RheS4NCiAgICAgICAgaWYgKHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5sYXN0U2VudEhlYXJ0YmVhdERhdGUgPT09IGRhdGUgfHwNCiAgICAgICAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5oZWFydGJlYXRzLnNvbWUoc2luZ2xlRGF0ZUhlYXJ0YmVhdCA9PiBzaW5nbGVEYXRlSGVhcnRiZWF0LmRhdGUgPT09IGRhdGUpKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAvLyBUaGVyZSBpcyBubyBlbnRyeSBmb3IgdGhpcyBkYXRlLiBDcmVhdGUgb25lLg0KICAgICAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlLmhlYXJ0YmVhdHMucHVzaCh7IGRhdGUsIGFnZW50IH0pOw0KICAgICAgICB9DQogICAgICAgIC8vIFJlbW92ZSBlbnRyaWVzIG9sZGVyIHRoYW4gMzAgZGF5cy4NCiAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlLmhlYXJ0YmVhdHMgPSB0aGlzLl9oZWFydGJlYXRzQ2FjaGUuaGVhcnRiZWF0cy5maWx0ZXIoc2luZ2xlRGF0ZUhlYXJ0YmVhdCA9PiB7DQogICAgICAgICAgICBjb25zdCBoYlRpbWVzdGFtcCA9IG5ldyBEYXRlKHNpbmdsZURhdGVIZWFydGJlYXQuZGF0ZSkudmFsdWVPZigpOw0KICAgICAgICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsNCiAgICAgICAgICAgIHJldHVybiBub3cgLSBoYlRpbWVzdGFtcCA8PSBTVE9SRURfSEVBUlRCRUFUX1JFVEVOVElPTl9NQVhfTUlMTElTOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIHRoaXMuX3N0b3JhZ2Uub3ZlcndyaXRlKHRoaXMuX2hlYXJ0YmVhdHNDYWNoZSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJldHVybnMgYSBiYXNlNjQgZW5jb2RlZCBzdHJpbmcgd2hpY2ggY2FuIGJlIGF0dGFjaGVkIHRvIHRoZSBoZWFydGJlYXQtc3BlY2lmaWMgaGVhZGVyIGRpcmVjdGx5Lg0KICAgICAqIEl0IGFsc28gY2xlYXJzIGFsbCBoZWFydGJlYXRzIGZyb20gbWVtb3J5IGFzIHdlbGwgYXMgaW4gSW5kZXhlZERCLg0KICAgICAqDQogICAgICogTk9URTogQ29uc3VtaW5nIHByb2R1Y3QgU0RLcyBzaG91bGQgbm90IHNlbmQgdGhlIGhlYWRlciBpZiB0aGlzIG1ldGhvZA0KICAgICAqIHJldHVybnMgYW4gZW1wdHkgc3RyaW5nLg0KICAgICAqLw0KICAgIGFzeW5jIGdldEhlYXJ0YmVhdHNIZWFkZXIoKSB7DQogICAgICAgIGlmICh0aGlzLl9oZWFydGJlYXRzQ2FjaGUgPT09IG51bGwpIHsNCiAgICAgICAgICAgIGF3YWl0IHRoaXMuX2hlYXJ0YmVhdHNDYWNoZVByb21pc2U7DQogICAgICAgIH0NCiAgICAgICAgLy8gSWYgaXQncyBzdGlsbCBudWxsIG9yIHRoZSBhcnJheSBpcyBlbXB0eSwgdGhlcmUgaXMgbm8gZGF0YSB0byBzZW5kLg0KICAgICAgICBpZiAodGhpcy5faGVhcnRiZWF0c0NhY2hlID09PSBudWxsIHx8DQogICAgICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGUuaGVhcnRiZWF0cy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgIHJldHVybiAnJzsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBkYXRlID0gZ2V0VVRDRGF0ZVN0cmluZygpOw0KICAgICAgICAvLyBFeHRyYWN0IGFzIG1hbnkgaGVhcnRiZWF0cyBmcm9tIHRoZSBjYWNoZSBhcyB3aWxsIGZpdCB1bmRlciB0aGUgc2l6ZSBsaW1pdC4NCiAgICAgICAgY29uc3QgeyBoZWFydGJlYXRzVG9TZW5kLCB1bnNlbnRFbnRyaWVzIH0gPSBleHRyYWN0SGVhcnRiZWF0c0ZvckhlYWRlcih0aGlzLl9oZWFydGJlYXRzQ2FjaGUuaGVhcnRiZWF0cyk7DQogICAgICAgIGNvbnN0IGhlYWRlclN0cmluZyA9IGJhc2U2NHVybEVuY29kZVdpdGhvdXRQYWRkaW5nKEpTT04uc3RyaW5naWZ5KHsgdmVyc2lvbjogMiwgaGVhcnRiZWF0czogaGVhcnRiZWF0c1RvU2VuZCB9KSk7DQogICAgICAgIC8vIFN0b3JlIGxhc3Qgc2VudCBkYXRlIHRvIHByZXZlbnQgYW5vdGhlciBiZWluZyBsb2dnZWQvc2VudCBmb3IgdGhlIHNhbWUgZGF5Lg0KICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGUubGFzdFNlbnRIZWFydGJlYXREYXRlID0gZGF0ZTsNCiAgICAgICAgaWYgKHVuc2VudEVudHJpZXMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgLy8gU3RvcmUgYW55IHVuc2VudCBlbnRyaWVzIGlmIHRoZXkgZXhpc3QuDQogICAgICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGUuaGVhcnRiZWF0cyA9IHVuc2VudEVudHJpZXM7DQogICAgICAgICAgICAvLyBUaGlzIHNlZW1zIG1vcmUgbGlrZWx5IHRoYW4gZW1wdHlpbmcgdGhlIGFycmF5IChiZWxvdykgdG8gbGVhZCB0byBzb21lIG9kZCBzdGF0ZQ0KICAgICAgICAgICAgLy8gc2luY2UgdGhlIGNhY2hlIGlzbid0IGVtcHR5IGFuZCB0aGlzIHdpbGwgYmUgY2FsbGVkIGFnYWluIG9uIHRoZSBuZXh0IHJlcXVlc3QsDQogICAgICAgICAgICAvLyBhbmQgaXMgcHJvYmFibHkgc2FmZXN0IGlmIHdlIGF3YWl0IGl0Lg0KICAgICAgICAgICAgYXdhaXQgdGhpcy5fc3RvcmFnZS5vdmVyd3JpdGUodGhpcy5faGVhcnRiZWF0c0NhY2hlKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5oZWFydGJlYXRzID0gW107DQogICAgICAgICAgICAvLyBEbyBub3Qgd2FpdCBmb3IgdGhpcywgdG8gcmVkdWNlIGxhdGVuY3kuDQogICAgICAgICAgICB2b2lkIHRoaXMuX3N0b3JhZ2Uub3ZlcndyaXRlKHRoaXMuX2hlYXJ0YmVhdHNDYWNoZSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGhlYWRlclN0cmluZzsNCiAgICB9DQp9DQpmdW5jdGlvbiBnZXRVVENEYXRlU3RyaW5nKCkgew0KICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKTsNCiAgICAvLyBSZXR1cm5zIGRhdGUgZm9ybWF0ICdZWVlZLU1NLUREJw0KICAgIHJldHVybiB0b2RheS50b0lTT1N0cmluZygpLnN1YnN0cmluZygwLCAxMCk7DQp9DQpmdW5jdGlvbiBleHRyYWN0SGVhcnRiZWF0c0ZvckhlYWRlcihoZWFydGJlYXRzQ2FjaGUsIG1heFNpemUgPSBNQVhfSEVBREVSX0JZVEVTKSB7DQogICAgLy8gSGVhcnRiZWF0cyBncm91cGVkIGJ5IHVzZXIgYWdlbnQgaW4gdGhlIHN0YW5kYXJkIGZvcm1hdCB0byBiZSBzZW50IGluDQogICAgLy8gdGhlIGhlYWRlci4NCiAgICBjb25zdCBoZWFydGJlYXRzVG9TZW5kID0gW107DQogICAgLy8gU2luZ2xlIGRhdGUgZm9ybWF0IGhlYXJ0YmVhdHMgdGhhdCBhcmUgbm90IHNlbnQuDQogICAgbGV0IHVuc2VudEVudHJpZXMgPSBoZWFydGJlYXRzQ2FjaGUuc2xpY2UoKTsNCiAgICBmb3IgKGNvbnN0IHNpbmdsZURhdGVIZWFydGJlYXQgb2YgaGVhcnRiZWF0c0NhY2hlKSB7DQogICAgICAgIC8vIExvb2sgZm9yIGFuIGV4aXN0aW5nIGVudHJ5IHdpdGggdGhlIHNhbWUgdXNlciBhZ2VudC4NCiAgICAgICAgY29uc3QgaGVhcnRiZWF0RW50cnkgPSBoZWFydGJlYXRzVG9TZW5kLmZpbmQoaGIgPT4gaGIuYWdlbnQgPT09IHNpbmdsZURhdGVIZWFydGJlYXQuYWdlbnQpOw0KICAgICAgICBpZiAoIWhlYXJ0YmVhdEVudHJ5KSB7DQogICAgICAgICAgICAvLyBJZiBubyBlbnRyeSBmb3IgdGhpcyB1c2VyIGFnZW50IGV4aXN0cywgY3JlYXRlIG9uZS4NCiAgICAgICAgICAgIGhlYXJ0YmVhdHNUb1NlbmQucHVzaCh7DQogICAgICAgICAgICAgICAgYWdlbnQ6IHNpbmdsZURhdGVIZWFydGJlYXQuYWdlbnQsDQogICAgICAgICAgICAgICAgZGF0ZXM6IFtzaW5nbGVEYXRlSGVhcnRiZWF0LmRhdGVdDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGlmIChjb3VudEJ5dGVzKGhlYXJ0YmVhdHNUb1NlbmQpID4gbWF4U2l6ZSkgew0KICAgICAgICAgICAgICAgIC8vIElmIHRoZSBoZWFkZXIgd291bGQgZXhjZWVkIG1heCBzaXplLCByZW1vdmUgdGhlIGFkZGVkIGhlYXJ0YmVhdA0KICAgICAgICAgICAgICAgIC8vIGVudHJ5IGFuZCBzdG9wIGFkZGluZyB0byB0aGUgaGVhZGVyLg0KICAgICAgICAgICAgICAgIGhlYXJ0YmVhdHNUb1NlbmQucG9wKCk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBoZWFydGJlYXRFbnRyeS5kYXRlcy5wdXNoKHNpbmdsZURhdGVIZWFydGJlYXQuZGF0ZSk7DQogICAgICAgICAgICAvLyBJZiB0aGUgaGVhZGVyIHdvdWxkIGV4Y2VlZCBtYXggc2l6ZSwgcmVtb3ZlIHRoZSBhZGRlZCBkYXRlDQogICAgICAgICAgICAvLyBhbmQgc3RvcCBhZGRpbmcgdG8gdGhlIGhlYWRlci4NCiAgICAgICAgICAgIGlmIChjb3VudEJ5dGVzKGhlYXJ0YmVhdHNUb1NlbmQpID4gbWF4U2l6ZSkgew0KICAgICAgICAgICAgICAgIGhlYXJ0YmVhdEVudHJ5LmRhdGVzLnBvcCgpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIC8vIFBvcCB1bnNlbnQgZW50cnkgZnJvbSBxdWV1ZS4gKFNraXBwZWQgaWYgYWRkaW5nIHRoZSBlbnRyeSBleGNlZWRlZA0KICAgICAgICAvLyBxdW90YSBhbmQgdGhlIGxvb3AgYnJlYWtzIGVhcmx5LikNCiAgICAgICAgdW5zZW50RW50cmllcyA9IHVuc2VudEVudHJpZXMuc2xpY2UoMSk7DQogICAgfQ0KICAgIHJldHVybiB7DQogICAgICAgIGhlYXJ0YmVhdHNUb1NlbmQsDQogICAgICAgIHVuc2VudEVudHJpZXMNCiAgICB9Ow0KfQ0KY2xhc3MgSGVhcnRiZWF0U3RvcmFnZUltcGwgew0KICAgIGNvbnN0cnVjdG9yKGFwcCkgew0KICAgICAgICB0aGlzLmFwcCA9IGFwcDsNCiAgICAgICAgdGhpcy5fY2FuVXNlSW5kZXhlZERCUHJvbWlzZSA9IHRoaXMucnVuSW5kZXhlZERCRW52aXJvbm1lbnRDaGVjaygpOw0KICAgIH0NCiAgICBhc3luYyBydW5JbmRleGVkREJFbnZpcm9ubWVudENoZWNrKCkgew0KICAgICAgICBpZiAoIWlzSW5kZXhlZERCQXZhaWxhYmxlKCkpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB2YWxpZGF0ZUluZGV4ZWREQk9wZW5hYmxlKCkNCiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB0cnVlKQ0KICAgICAgICAgICAgICAgIC5jYXRjaCgoKSA9PiBmYWxzZSk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogUmVhZCBhbGwgaGVhcnRiZWF0cy4NCiAgICAgKi8NCiAgICBhc3luYyByZWFkKCkgew0KICAgICAgICBjb25zdCBjYW5Vc2VJbmRleGVkREIgPSBhd2FpdCB0aGlzLl9jYW5Vc2VJbmRleGVkREJQcm9taXNlOw0KICAgICAgICBpZiAoIWNhblVzZUluZGV4ZWREQikgew0KICAgICAgICAgICAgcmV0dXJuIHsgaGVhcnRiZWF0czogW10gfTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IGlkYkhlYXJ0YmVhdE9iamVjdCA9IGF3YWl0IHJlYWRIZWFydGJlYXRzRnJvbUluZGV4ZWREQih0aGlzLmFwcCk7DQogICAgICAgICAgICByZXR1cm4gaWRiSGVhcnRiZWF0T2JqZWN0IHx8IHsgaGVhcnRiZWF0czogW10gfTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvLyBvdmVyd3JpdGUgdGhlIHN0b3JhZ2Ugd2l0aCB0aGUgcHJvdmlkZWQgaGVhcnRiZWF0cw0KICAgIGFzeW5jIG92ZXJ3cml0ZShoZWFydGJlYXRzT2JqZWN0KSB7DQogICAgICAgIHZhciBfYTsNCiAgICAgICAgY29uc3QgY2FuVXNlSW5kZXhlZERCID0gYXdhaXQgdGhpcy5fY2FuVXNlSW5kZXhlZERCUHJvbWlzZTsNCiAgICAgICAgaWYgKCFjYW5Vc2VJbmRleGVkREIpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nSGVhcnRiZWF0c09iamVjdCA9IGF3YWl0IHRoaXMucmVhZCgpOw0KICAgICAgICAgICAgcmV0dXJuIHdyaXRlSGVhcnRiZWF0c1RvSW5kZXhlZERCKHRoaXMuYXBwLCB7DQogICAgICAgICAgICAgICAgbGFzdFNlbnRIZWFydGJlYXREYXRlOiAoX2EgPSBoZWFydGJlYXRzT2JqZWN0Lmxhc3RTZW50SGVhcnRiZWF0RGF0ZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogZXhpc3RpbmdIZWFydGJlYXRzT2JqZWN0Lmxhc3RTZW50SGVhcnRiZWF0RGF0ZSwNCiAgICAgICAgICAgICAgICBoZWFydGJlYXRzOiBoZWFydGJlYXRzT2JqZWN0LmhlYXJ0YmVhdHMNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8vIGFkZCBoZWFydGJlYXRzDQogICAgYXN5bmMgYWRkKGhlYXJ0YmVhdHNPYmplY3QpIHsNCiAgICAgICAgdmFyIF9hOw0KICAgICAgICBjb25zdCBjYW5Vc2VJbmRleGVkREIgPSBhd2FpdCB0aGlzLl9jYW5Vc2VJbmRleGVkREJQcm9taXNlOw0KICAgICAgICBpZiAoIWNhblVzZUluZGV4ZWREQikgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdIZWFydGJlYXRzT2JqZWN0ID0gYXdhaXQgdGhpcy5yZWFkKCk7DQogICAgICAgICAgICByZXR1cm4gd3JpdGVIZWFydGJlYXRzVG9JbmRleGVkREIodGhpcy5hcHAsIHsNCiAgICAgICAgICAgICAgICBsYXN0U2VudEhlYXJ0YmVhdERhdGU6IChfYSA9IGhlYXJ0YmVhdHNPYmplY3QubGFzdFNlbnRIZWFydGJlYXREYXRlKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBleGlzdGluZ0hlYXJ0YmVhdHNPYmplY3QubGFzdFNlbnRIZWFydGJlYXREYXRlLA0KICAgICAgICAgICAgICAgIGhlYXJ0YmVhdHM6IFsNCiAgICAgICAgICAgICAgICAgICAgLi4uZXhpc3RpbmdIZWFydGJlYXRzT2JqZWN0LmhlYXJ0YmVhdHMsDQogICAgICAgICAgICAgICAgICAgIC4uLmhlYXJ0YmVhdHNPYmplY3QuaGVhcnRiZWF0cw0KICAgICAgICAgICAgICAgIF0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfQ0KfQ0KLyoqDQogKiBDYWxjdWxhdGUgYnl0ZXMgb2YgYSBIZWFydGJlYXRzQnlVc2VyQWdlbnQgYXJyYXkgYWZ0ZXIgYmVpbmcgd3JhcHBlZA0KICogaW4gYSBwbGF0Zm9ybSBsb2dnaW5nIGhlYWRlciBKU09OIG9iamVjdCwgc3RyaW5naWZpZWQsIGFuZCBjb252ZXJ0ZWQNCiAqIHRvIGJhc2UgNjQuDQogKi8NCmZ1bmN0aW9uIGNvdW50Qnl0ZXMoaGVhcnRiZWF0c0NhY2hlKSB7DQogICAgLy8gYmFzZTY0IGhhcyBhIHJlc3RyaWN0ZWQgc2V0IG9mIGNoYXJhY3RlcnMsIGFsbCBvZiB3aGljaCBzaG91bGQgYmUgMSBieXRlLg0KICAgIHJldHVybiBiYXNlNjR1cmxFbmNvZGVXaXRob3V0UGFkZGluZygNCiAgICAvLyBoZWFydGJlYXRzQ2FjaGUgd3JhcHBlciBwcm9wZXJ0aWVzDQogICAgSlNPTi5zdHJpbmdpZnkoeyB2ZXJzaW9uOiAyLCBoZWFydGJlYXRzOiBoZWFydGJlYXRzQ2FjaGUgfSkpLmxlbmd0aDsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmZ1bmN0aW9uIHJlZ2lzdGVyQ29yZUNvbXBvbmVudHModmFyaWFudCkgew0KICAgIF9yZWdpc3RlckNvbXBvbmVudChuZXcgQ29tcG9uZW50KCdwbGF0Zm9ybS1sb2dnZXInLCBjb250YWluZXIgPT4gbmV3IFBsYXRmb3JtTG9nZ2VyU2VydmljZUltcGwoY29udGFpbmVyKSwgIlBSSVZBVEUiIC8qIENvbXBvbmVudFR5cGUuUFJJVkFURSAqLykpOw0KICAgIF9yZWdpc3RlckNvbXBvbmVudChuZXcgQ29tcG9uZW50KCdoZWFydGJlYXQnLCBjb250YWluZXIgPT4gbmV3IEhlYXJ0YmVhdFNlcnZpY2VJbXBsKGNvbnRhaW5lciksICJQUklWQVRFIiAvKiBDb21wb25lbnRUeXBlLlBSSVZBVEUgKi8pKTsNCiAgICAvLyBSZWdpc3RlciBgYXBwYCBwYWNrYWdlLg0KICAgIHJlZ2lzdGVyVmVyc2lvbihuYW1lJG8kMSwgdmVyc2lvbiQxJDEsIHZhcmlhbnQpOw0KICAgIC8vIEJVSUxEX1RBUkdFVCB3aWxsIGJlIHJlcGxhY2VkIGJ5IHZhbHVlcyBsaWtlIGVzbTUsIGVzbTIwMTcsIGNqczUsIGV0YyBkdXJpbmcgdGhlIGNvbXBpbGF0aW9uDQogICAgcmVnaXN0ZXJWZXJzaW9uKG5hbWUkbyQxLCB2ZXJzaW9uJDEkMSwgJ2VzbTIwMTcnKTsNCiAgICAvLyBSZWdpc3RlciBwbGF0Zm9ybSBTREsgaWRlbnRpZmllciAobm8gdmVyc2lvbikuDQogICAgcmVnaXN0ZXJWZXJzaW9uKCdmaXJlLWpzJywgJycpOw0KfQoKLyoqDQogKiBGaXJlYmFzZSBBcHANCiAqDQogKiBAcmVtYXJrcyBUaGlzIHBhY2thZ2UgY29vcmRpbmF0ZXMgdGhlIGNvbW11bmljYXRpb24gYmV0d2VlbiB0aGUgZGlmZmVyZW50IEZpcmViYXNlIGNvbXBvbmVudHMNCiAqIEBwYWNrYWdlRG9jdW1lbnRhdGlvbg0KICovDQpyZWdpc3RlckNvcmVDb21wb25lbnRzKCcnKTsKCmNvbnN0IG5hbWUkSSA9ICJAZmlyZWJhc2UvZGF0YWJhc2UiOwpjb25zdCB2ZXJzaW9uJDQgPSAiMS4wLjEiOwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqIFRoZSBzZW12ZXIgKHd3dy5zZW12ZXIub3JnKSB2ZXJzaW9uIG9mIHRoZSBTREsuICovDQpsZXQgU0RLX1ZFUlNJT04gPSAnJzsNCi8qKg0KICogU0RLX1ZFUlNJT04gc2hvdWxkIGJlIHNldCBiZWZvcmUgYW55IGRhdGFiYXNlIGluc3RhbmNlIGlzIGNyZWF0ZWQNCiAqIEBpbnRlcm5hbA0KICovDQpmdW5jdGlvbiBzZXRTREtWZXJzaW9uKHZlcnNpb24pIHsNCiAgICBTREtfVkVSU0lPTiA9IHZlcnNpb247DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIFdyYXBzIGEgRE9NIFN0b3JhZ2Ugb2JqZWN0IGFuZDoNCiAqIC0gYXV0b21hdGljYWxseSBlbmNvZGUgb2JqZWN0cyBhcyBKU09OIHN0cmluZ3MgYmVmb3JlIHN0b3JpbmcgdGhlbSB0byBhbGxvdyB1cyB0byBzdG9yZSBhcmJpdHJhcnkgdHlwZXMuDQogKiAtIHByZWZpeGVzIG5hbWVzIHdpdGggImZpcmViYXNlOiIgdG8gYXZvaWQgY29sbGlzaW9ucyB3aXRoIGFwcCBkYXRhLg0KICoNCiAqIFdlIGF1dG9tYXRpY2FsbHkgKHNlZSBzdG9yYWdlLmpzKSBjcmVhdGUgdHdvIHN1Y2ggd3JhcHBlcnMsIG9uZSBmb3Igc2Vzc2lvblN0b3JhZ2UsDQogKiBhbmQgb25lIGZvciBsb2NhbFN0b3JhZ2UuDQogKg0KICovDQpjbGFzcyBET01TdG9yYWdlV3JhcHBlciB7DQogICAgLyoqDQogICAgICogQHBhcmFtIGRvbVN0b3JhZ2VfIC0gVGhlIHVuZGVybHlpbmcgc3RvcmFnZSBvYmplY3QgKGUuZy4gbG9jYWxTdG9yYWdlIG9yIHNlc3Npb25TdG9yYWdlKQ0KICAgICAqLw0KICAgIGNvbnN0cnVjdG9yKGRvbVN0b3JhZ2VfKSB7DQogICAgICAgIHRoaXMuZG9tU3RvcmFnZV8gPSBkb21TdG9yYWdlXzsNCiAgICAgICAgLy8gVXNlIGEgcHJlZml4IHRvIGF2b2lkIGNvbGxpc2lvbnMgd2l0aCBvdGhlciBzdHVmZiBzYXZlZCBieSB0aGUgYXBwLg0KICAgICAgICB0aGlzLnByZWZpeF8gPSAnZmlyZWJhc2U6JzsNCiAgICB9DQogICAgLyoqDQogICAgICogQHBhcmFtIGtleSAtIFRoZSBrZXkgdG8gc2F2ZSB0aGUgdmFsdWUgdW5kZXINCiAgICAgKiBAcGFyYW0gdmFsdWUgLSBUaGUgdmFsdWUgYmVpbmcgc3RvcmVkLCBvciBudWxsIHRvIHJlbW92ZSB0aGUga2V5Lg0KICAgICAqLw0KICAgIHNldChrZXksIHZhbHVlKSB7DQogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7DQogICAgICAgICAgICB0aGlzLmRvbVN0b3JhZ2VfLnJlbW92ZUl0ZW0odGhpcy5wcmVmaXhlZE5hbWVfKGtleSkpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgdGhpcy5kb21TdG9yYWdlXy5zZXRJdGVtKHRoaXMucHJlZml4ZWROYW1lXyhrZXkpLCBzdHJpbmdpZnkodmFsdWUpKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBUaGUgdmFsdWUgdGhhdCB3YXMgc3RvcmVkIHVuZGVyIHRoaXMga2V5LCBvciBudWxsDQogICAgICovDQogICAgZ2V0KGtleSkgew0KICAgICAgICBjb25zdCBzdG9yZWRWYWwgPSB0aGlzLmRvbVN0b3JhZ2VfLmdldEl0ZW0odGhpcy5wcmVmaXhlZE5hbWVfKGtleSkpOw0KICAgICAgICBpZiAoc3RvcmVkVmFsID09IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIGpzb25FdmFsKHN0b3JlZFZhbCk7DQogICAgICAgIH0NCiAgICB9DQogICAgcmVtb3ZlKGtleSkgew0KICAgICAgICB0aGlzLmRvbVN0b3JhZ2VfLnJlbW92ZUl0ZW0odGhpcy5wcmVmaXhlZE5hbWVfKGtleSkpOw0KICAgIH0NCiAgICBwcmVmaXhlZE5hbWVfKG5hbWUpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucHJlZml4XyArIG5hbWU7DQogICAgfQ0KICAgIHRvU3RyaW5nKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5kb21TdG9yYWdlXy50b1N0cmluZygpOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogQW4gaW4tbWVtb3J5IHN0b3JhZ2UgaW1wbGVtZW50YXRpb24gdGhhdCBtYXRjaGVzIHRoZSBBUEkgb2YgRE9NU3RvcmFnZVdyYXBwZXINCiAqIChUT0RPOiBjcmVhdGUgaW50ZXJmYWNlIGZvciBib3RoIHRvIGltcGxlbWVudCkuDQogKi8NCmNsYXNzIE1lbW9yeVN0b3JhZ2Ugew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICB0aGlzLmNhY2hlXyA9IHt9Ow0KICAgICAgICB0aGlzLmlzSW5NZW1vcnlTdG9yYWdlID0gdHJ1ZTsNCiAgICB9DQogICAgc2V0KGtleSwgdmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsNCiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNhY2hlX1trZXldOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgdGhpcy5jYWNoZV9ba2V5XSA9IHZhbHVlOw0KICAgICAgICB9DQogICAgfQ0KICAgIGdldChrZXkpIHsNCiAgICAgICAgaWYgKGNvbnRhaW5zKHRoaXMuY2FjaGVfLCBrZXkpKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5jYWNoZV9ba2V5XTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgcmVtb3ZlKGtleSkgew0KICAgICAgICBkZWxldGUgdGhpcy5jYWNoZV9ba2V5XTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIEhlbHBlciB0byBjcmVhdGUgYSBET01TdG9yYWdlV3JhcHBlciBvciBlbHNlIGZhbGwgYmFjayB0byBNZW1vcnlTdG9yYWdlLg0KICogVE9ETzogT25jZSBNZW1vcnlTdG9yYWdlIGFuZCBET01TdG9yYWdlV3JhcHBlciBoYXZlIGEgc2hhcmVkIGludGVyZmFjZSB0aGlzIG1ldGhvZCBhbm5vdGF0aW9uIHNob3VsZCBjaGFuZ2UNCiAqIHRvIHJlZmxlY3QgdGhpcyB0eXBlDQogKg0KICogQHBhcmFtIGRvbVN0b3JhZ2VOYW1lIC0gTmFtZSBvZiB0aGUgdW5kZXJseWluZyBzdG9yYWdlIG9iamVjdA0KICogICAoZS5nLiAnbG9jYWxTdG9yYWdlJyBvciAnc2Vzc2lvblN0b3JhZ2UnKS4NCiAqIEByZXR1cm5zIFR1cm5pbmcgb2ZmIHR5cGUgaW5mb3JtYXRpb24gdW50aWwgYSBjb21tb24gaW50ZXJmYWNlIGlzIGRlZmluZWQuDQogKi8NCmNvbnN0IGNyZWF0ZVN0b3JhZ2Vmb3IgPSBmdW5jdGlvbiAoZG9tU3RvcmFnZU5hbWUpIHsNCiAgICB0cnkgew0KICAgICAgICAvLyBOT1RFOiBqdXN0IGFjY2Vzc2luZyAibG9jYWxTdG9yYWdlIiBvciAid2luZG93Wydsb2NhbFN0b3JhZ2UnXSIgbWF5IHRocm93IGEgc2VjdXJpdHkgZXhjZXB0aW9uLA0KICAgICAgICAvLyBzbyBpdCBtdXN0IGJlIGluc2lkZSB0aGUgdHJ5L2NhdGNoLg0KICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYNCiAgICAgICAgICAgIHR5cGVvZiB3aW5kb3dbZG9tU3RvcmFnZU5hbWVdICE9PSAndW5kZWZpbmVkJykgew0KICAgICAgICAgICAgLy8gTmVlZCB0byB0ZXN0IGNhY2hlLiBKdXN0IGJlY2F1c2UgaXQncyBoZXJlIGRvZXNuJ3QgbWVhbiBpdCB3b3Jrcw0KICAgICAgICAgICAgY29uc3QgZG9tU3RvcmFnZSA9IHdpbmRvd1tkb21TdG9yYWdlTmFtZV07DQogICAgICAgICAgICBkb21TdG9yYWdlLnNldEl0ZW0oJ2ZpcmViYXNlOnNlbnRpbmVsJywgJ2NhY2hlJyk7DQogICAgICAgICAgICBkb21TdG9yYWdlLnJlbW92ZUl0ZW0oJ2ZpcmViYXNlOnNlbnRpbmVsJyk7DQogICAgICAgICAgICByZXR1cm4gbmV3IERPTVN0b3JhZ2VXcmFwcGVyKGRvbVN0b3JhZ2UpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGNhdGNoIChlKSB7IH0NCiAgICAvLyBGYWlsZWQgdG8gY3JlYXRlIHdyYXBwZXIuICBKdXN0IHJldHVybiBpbi1tZW1vcnkgc3RvcmFnZS4NCiAgICAvLyBUT0RPOiBsb2c/DQogICAgcmV0dXJuIG5ldyBNZW1vcnlTdG9yYWdlKCk7DQp9Ow0KLyoqIEEgc3RvcmFnZSBvYmplY3QgdGhhdCBsYXN0cyBhY3Jvc3Mgc2Vzc2lvbnMgKi8NCmNvbnN0IFBlcnNpc3RlbnRTdG9yYWdlID0gY3JlYXRlU3RvcmFnZWZvcignbG9jYWxTdG9yYWdlJyk7DQovKiogQSBzdG9yYWdlIG9iamVjdCB0aGF0IG9ubHkgbGFzdHMgb25lIHNlc3Npb24gKi8NCmNvbnN0IFNlc3Npb25TdG9yYWdlID0gY3JlYXRlU3RvcmFnZWZvcignc2Vzc2lvblN0b3JhZ2UnKTsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNvbnN0IGxvZ0NsaWVudCQxID0gbmV3IExvZ2dlcignQGZpcmViYXNlL2RhdGFiYXNlJyk7DQovKioNCiAqIFJldHVybnMgYSBsb2NhbGx5LXVuaXF1ZSBJRCAoZ2VuZXJhdGVkIGJ5IGp1c3QgaW5jcmVtZW50aW5nIHVwIGZyb20gMCBlYWNoIHRpbWUgaXRzIGNhbGxlZCkuDQogKi8NCmNvbnN0IExVSURHZW5lcmF0b3IgPSAoZnVuY3Rpb24gKCkgew0KICAgIGxldCBpZCA9IDE7DQogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIGlkKys7DQogICAgfTsNCn0pKCk7DQovKioNCiAqIFNoYTEgaGFzaCBvZiB0aGUgaW5wdXQgc3RyaW5nDQogKiBAcGFyYW0gc3RyIC0gVGhlIHN0cmluZyB0byBoYXNoDQogKiBAcmV0dXJucyB7IXN0cmluZ30gVGhlIHJlc3VsdGluZyBoYXNoDQogKi8NCmNvbnN0IHNoYTEgPSBmdW5jdGlvbiAoc3RyKSB7DQogICAgY29uc3QgdXRmOEJ5dGVzID0gc3RyaW5nVG9CeXRlQXJyYXkoc3RyKTsNCiAgICBjb25zdCBzaGExID0gbmV3IFNoYTEoKTsNCiAgICBzaGExLnVwZGF0ZSh1dGY4Qnl0ZXMpOw0KICAgIGNvbnN0IHNoYTFCeXRlcyA9IHNoYTEuZGlnZXN0KCk7DQogICAgcmV0dXJuIGJhc2U2NCQzLmVuY29kZUJ5dGVBcnJheShzaGExQnl0ZXMpOw0KfTsNCmNvbnN0IGJ1aWxkTG9nTWVzc2FnZV8gPSBmdW5jdGlvbiAoLi4udmFyQXJncykgew0KICAgIGxldCBtZXNzYWdlID0gJyc7DQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YXJBcmdzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGNvbnN0IGFyZyA9IHZhckFyZ3NbaV07DQogICAgICAgIGlmIChBcnJheS5pc0FycmF5KGFyZykgfHwNCiAgICAgICAgICAgIChhcmcgJiYNCiAgICAgICAgICAgICAgICB0eXBlb2YgYXJnID09PSAnb2JqZWN0JyAmJg0KICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55DQogICAgICAgICAgICAgICAgdHlwZW9mIGFyZy5sZW5ndGggPT09ICdudW1iZXInKSkgew0KICAgICAgICAgICAgbWVzc2FnZSArPSBidWlsZExvZ01lc3NhZ2VfLmFwcGx5KG51bGwsIGFyZyk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAodHlwZW9mIGFyZyA9PT0gJ29iamVjdCcpIHsNCiAgICAgICAgICAgIG1lc3NhZ2UgKz0gc3RyaW5naWZ5KGFyZyk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBtZXNzYWdlICs9IGFyZzsNCiAgICAgICAgfQ0KICAgICAgICBtZXNzYWdlICs9ICcgJzsNCiAgICB9DQogICAgcmV0dXJuIG1lc3NhZ2U7DQp9Ow0KLyoqDQogKiBVc2UgdGhpcyBmb3IgYWxsIGRlYnVnIG1lc3NhZ2VzIGluIEZpcmViYXNlLg0KICovDQpsZXQgbG9nZ2VyID0gbnVsbDsNCi8qKg0KICogRmxhZyB0byBjaGVjayBmb3IgbG9nIGF2YWlsYWJpbGl0eSBvbiBmaXJzdCBsb2cgbWVzc2FnZQ0KICovDQpsZXQgZmlyc3RMb2dfID0gdHJ1ZTsNCi8qKg0KICogVGhlIGltcGxlbWVudGF0aW9uIG9mIEZpcmViYXNlLmVuYWJsZUxvZ2dpbmcgKGRlZmluZWQgaGVyZSB0byBicmVhayBkZXBlbmRlbmNpZXMpDQogKiBAcGFyYW0gbG9nZ2VyXyAtIEEgZmxhZyB0byB0dXJuIG9uIGxvZ2dpbmcsIG9yIGEgY3VzdG9tIGxvZ2dlcg0KICogQHBhcmFtIHBlcnNpc3RlbnQgLSBXaGV0aGVyIG9yIG5vdCB0byBwZXJzaXN0IGxvZ2dpbmcgc2V0dGluZ3MgYWNyb3NzIHJlZnJlc2hlcw0KICovDQpjb25zdCBlbmFibGVMb2dnaW5nJDEgPSBmdW5jdGlvbiAobG9nZ2VyXywgcGVyc2lzdGVudCkgew0KICAgIGFzc2VydCghcGVyc2lzdGVudCB8fCBsb2dnZXJfID09PSB0cnVlIHx8IGxvZ2dlcl8gPT09IGZhbHNlLCAiQ2FuJ3QgdHVybiBvbiBjdXN0b20gbG9nZ2VycyBwZXJzaXN0ZW50bHkuIik7DQogICAgaWYgKGxvZ2dlcl8gPT09IHRydWUpIHsNCiAgICAgICAgbG9nQ2xpZW50JDEubG9nTGV2ZWwgPSBMb2dMZXZlbC5WRVJCT1NFOw0KICAgICAgICBsb2dnZXIgPSBsb2dDbGllbnQkMS5sb2cuYmluZChsb2dDbGllbnQkMSk7DQogICAgICAgIGlmIChwZXJzaXN0ZW50KSB7DQogICAgICAgICAgICBTZXNzaW9uU3RvcmFnZS5zZXQoJ2xvZ2dpbmdfZW5hYmxlZCcsIHRydWUpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGVsc2UgaWYgKHR5cGVvZiBsb2dnZXJfID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgIGxvZ2dlciA9IGxvZ2dlcl87DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBsb2dnZXIgPSBudWxsOw0KICAgICAgICBTZXNzaW9uU3RvcmFnZS5yZW1vdmUoJ2xvZ2dpbmdfZW5hYmxlZCcpOw0KICAgIH0NCn07DQpjb25zdCBsb2cgPSBmdW5jdGlvbiAoLi4udmFyQXJncykgew0KICAgIGlmIChmaXJzdExvZ18gPT09IHRydWUpIHsNCiAgICAgICAgZmlyc3RMb2dfID0gZmFsc2U7DQogICAgICAgIGlmIChsb2dnZXIgPT09IG51bGwgJiYgU2Vzc2lvblN0b3JhZ2UuZ2V0KCdsb2dnaW5nX2VuYWJsZWQnKSA9PT0gdHJ1ZSkgew0KICAgICAgICAgICAgZW5hYmxlTG9nZ2luZyQxKHRydWUpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChsb2dnZXIpIHsNCiAgICAgICAgY29uc3QgbWVzc2FnZSA9IGJ1aWxkTG9nTWVzc2FnZV8uYXBwbHkobnVsbCwgdmFyQXJncyk7DQogICAgICAgIGxvZ2dlcihtZXNzYWdlKTsNCiAgICB9DQp9Ow0KY29uc3QgbG9nV3JhcHBlciA9IGZ1bmN0aW9uIChwcmVmaXgpIHsNCiAgICByZXR1cm4gZnVuY3Rpb24gKC4uLnZhckFyZ3MpIHsNCiAgICAgICAgbG9nKHByZWZpeCwgLi4udmFyQXJncyk7DQogICAgfTsNCn07DQpjb25zdCBlcnJvciQxID0gZnVuY3Rpb24gKC4uLnZhckFyZ3MpIHsNCiAgICBjb25zdCBtZXNzYWdlID0gJ0ZJUkVCQVNFIElOVEVSTkFMIEVSUk9SOiAnICsgYnVpbGRMb2dNZXNzYWdlXyguLi52YXJBcmdzKTsNCiAgICBsb2dDbGllbnQkMS5lcnJvcihtZXNzYWdlKTsNCn07DQpjb25zdCBmYXRhbCA9IGZ1bmN0aW9uICguLi52YXJBcmdzKSB7DQogICAgY29uc3QgbWVzc2FnZSA9IGBGSVJFQkFTRSBGQVRBTCBFUlJPUjogJHtidWlsZExvZ01lc3NhZ2VfKC4uLnZhckFyZ3MpfWA7DQogICAgbG9nQ2xpZW50JDEuZXJyb3IobWVzc2FnZSk7DQogICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpOw0KfTsNCmNvbnN0IHdhcm4gPSBmdW5jdGlvbiAoLi4udmFyQXJncykgew0KICAgIGNvbnN0IG1lc3NhZ2UgPSAnRklSRUJBU0UgV0FSTklORzogJyArIGJ1aWxkTG9nTWVzc2FnZV8oLi4udmFyQXJncyk7DQogICAgbG9nQ2xpZW50JDEud2FybihtZXNzYWdlKTsNCn07DQovKioNCiAqIExvZ3MgYSB3YXJuaW5nIGlmIHRoZSBjb250YWluaW5nIHBhZ2UgdXNlcyBodHRwcy4gQ2FsbGVkIHdoZW4gYSBjYWxsIHRvIG5ldyBGaXJlYmFzZQ0KICogZG9lcyBub3QgdXNlIGh0dHBzLg0KICovDQpjb25zdCB3YXJuSWZQYWdlSXNTZWN1cmUgPSBmdW5jdGlvbiAoKSB7DQogICAgLy8gQmUgdmVyeSBjYXJlZnVsIGFjY2Vzc2luZyBicm93c2VyIGdsb2JhbHMuIFdobyBrbm93cyB3aGF0IG1heSBvciBtYXkgbm90IGV4aXN0Lg0KICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJg0KICAgICAgICB3aW5kb3cubG9jYXRpb24gJiYNCiAgICAgICAgd2luZG93LmxvY2F0aW9uLnByb3RvY29sICYmDQogICAgICAgIHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbC5pbmRleE9mKCdodHRwczonKSAhPT0gLTEpIHsNCiAgICAgICAgd2FybignSW5zZWN1cmUgRmlyZWJhc2UgYWNjZXNzIGZyb20gYSBzZWN1cmUgcGFnZS4gJyArDQogICAgICAgICAgICAnUGxlYXNlIHVzZSBodHRwcyBpbiBjYWxscyB0byBuZXcgRmlyZWJhc2UoKS4nKTsNCiAgICB9DQp9Ow0KLyoqDQogKiBSZXR1cm5zIHRydWUgaWYgZGF0YSBpcyBOYU4sIG9yICsvLSBJbmZpbml0eS4NCiAqLw0KY29uc3QgaXNJbnZhbGlkSlNPTk51bWJlciA9IGZ1bmN0aW9uIChkYXRhKSB7DQogICAgcmV0dXJuICh0eXBlb2YgZGF0YSA9PT0gJ251bWJlcicgJiYNCiAgICAgICAgKGRhdGEgIT09IGRhdGEgfHwgLy8gTmFODQogICAgICAgICAgICBkYXRhID09PSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkgfHwNCiAgICAgICAgICAgIGRhdGEgPT09IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSkpOw0KfTsNCmNvbnN0IGV4ZWN1dGVXaGVuRE9NUmVhZHkgPSBmdW5jdGlvbiAoZm4pIHsNCiAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2NvbXBsZXRlJykgew0KICAgICAgICBmbigpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgLy8gTW9kZWxlZCBhZnRlciBqUXVlcnkuIFRyeSBET01Db250ZW50TG9hZGVkIGFuZCBvbnJlYWR5c3RhdGVjaGFuZ2UgKHdoaWNoDQogICAgICAgIC8vIGZpcmUgYmVmb3JlIG9ubG9hZCksIGJ1dCBmYWxsIGJhY2sgdG8gb25sb2FkLg0KICAgICAgICBsZXQgY2FsbGVkID0gZmFsc2U7DQogICAgICAgIGNvbnN0IHdyYXBwZWRGbiA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGlmICghZG9jdW1lbnQuYm9keSkgew0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQod3JhcHBlZEZuLCBNYXRoLmZsb29yKDEwKSk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFjYWxsZWQpIHsNCiAgICAgICAgICAgICAgICBjYWxsZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIGZuKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH07DQogICAgICAgIGlmIChkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKSB7DQogICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgd3JhcHBlZEZuLCBmYWxzZSk7DQogICAgICAgICAgICAvLyBmYWxsYmFjayB0byBvbmxvYWQuDQogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIHdyYXBwZWRGbiwgZmFsc2UpOw0KICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChkb2N1bWVudC5hdHRhY2hFdmVudCkgew0KICAgICAgICAgICAgLy8gSUUuDQogICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgICAgICAgICAgZG9jdW1lbnQuYXR0YWNoRXZlbnQoJ29ucmVhZHlzdGF0ZWNoYW5nZScsICgpID0+IHsNCiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2NvbXBsZXRlJykgew0KICAgICAgICAgICAgICAgICAgICB3cmFwcGVkRm4oKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIC8vIGZhbGxiYWNrIHRvIG9ubG9hZC4NCiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55DQogICAgICAgICAgICB3aW5kb3cuYXR0YWNoRXZlbnQoJ29ubG9hZCcsIHdyYXBwZWRGbik7DQogICAgICAgICAgICAvLyBqUXVlcnkgaGFzIGFuIGV4dHJhIGhhY2sgZm9yIElFIHRoYXQgd2UgY291bGQgZW1wbG95IChiYXNlZCBvbg0KICAgICAgICAgICAgLy8gaHR0cDovL2phdmFzY3JpcHQubndib3guY29tL0lFQ29udGVudExvYWRlZC8pIEJ1dCBpdCBsb29rcyByZWFsbHkgb2xkLg0KICAgICAgICAgICAgLy8gSSdtIGhvcGluZyB3ZSBkb24ndCBuZWVkIGl0Lg0KICAgICAgICB9DQogICAgfQ0KfTsNCi8qKg0KICogTWluaW11bSBrZXkgbmFtZS4gSW52YWxpZCBmb3IgYWN0dWFsIGRhdGEsIHVzZWQgYXMgYSBtYXJrZXIgdG8gc29ydCBiZWZvcmUgYW55IHZhbGlkIG5hbWVzDQogKi8NCmNvbnN0IE1JTl9OQU1FID0gJ1tNSU5fTkFNRV0nOw0KLyoqDQogKiBNYXhpbXVtIGtleSBuYW1lLiBJbnZhbGlkIGZvciBhY3R1YWwgZGF0YSwgdXNlZCBhcyBhIG1hcmtlciB0byBzb3J0IGFib3ZlIGFueSB2YWxpZCBuYW1lcw0KICovDQpjb25zdCBNQVhfTkFNRSA9ICdbTUFYX05BTUVdJzsNCi8qKg0KICogQ29tcGFyZXMgdmFsaWQgRmlyZWJhc2Uga2V5IG5hbWVzLCBwbHVzIG1pbiBhbmQgbWF4IG5hbWUNCiAqLw0KY29uc3QgbmFtZUNvbXBhcmUgPSBmdW5jdGlvbiAoYSwgYikgew0KICAgIGlmIChhID09PSBiKSB7DQogICAgICAgIHJldHVybiAwOw0KICAgIH0NCiAgICBlbHNlIGlmIChhID09PSBNSU5fTkFNRSB8fCBiID09PSBNQVhfTkFNRSkgew0KICAgICAgICByZXR1cm4gLTE7DQogICAgfQ0KICAgIGVsc2UgaWYgKGIgPT09IE1JTl9OQU1FIHx8IGEgPT09IE1BWF9OQU1FKSB7DQogICAgICAgIHJldHVybiAxOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3QgYUFzSW50ID0gdHJ5UGFyc2VJbnQoYSksIGJBc0ludCA9IHRyeVBhcnNlSW50KGIpOw0KICAgICAgICBpZiAoYUFzSW50ICE9PSBudWxsKSB7DQogICAgICAgICAgICBpZiAoYkFzSW50ICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGFBc0ludCAtIGJBc0ludCA9PT0gMCA/IGEubGVuZ3RoIC0gYi5sZW5ndGggOiBhQXNJbnQgLSBiQXNJbnQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoYkFzSW50ICE9PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBhIDwgYiA/IC0xIDogMTsNCiAgICAgICAgfQ0KICAgIH0NCn07DQovKioNCiAqIEByZXR1cm5zIHshbnVtYmVyfSBjb21wYXJpc29uIHJlc3VsdC4NCiAqLw0KY29uc3Qgc3RyaW5nQ29tcGFyZSA9IGZ1bmN0aW9uIChhLCBiKSB7DQogICAgaWYgKGEgPT09IGIpIHsNCiAgICAgICAgcmV0dXJuIDA7DQogICAgfQ0KICAgIGVsc2UgaWYgKGEgPCBiKSB7DQogICAgICAgIHJldHVybiAtMTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIHJldHVybiAxOw0KICAgIH0NCn07DQpjb25zdCByZXF1aXJlS2V5ID0gZnVuY3Rpb24gKGtleSwgb2JqKSB7DQogICAgaWYgKG9iaiAmJiBrZXkgaW4gb2JqKSB7DQogICAgICAgIHJldHVybiBvYmpba2V5XTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcignTWlzc2luZyByZXF1aXJlZCBrZXkgKCcgKyBrZXkgKyAnKSBpbiBvYmplY3Q6ICcgKyBzdHJpbmdpZnkob2JqKSk7DQogICAgfQ0KfTsNCmNvbnN0IE9iamVjdFRvVW5pcXVlS2V5ID0gZnVuY3Rpb24gKG9iaikgew0KICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyB8fCBvYmogPT09IG51bGwpIHsNCiAgICAgICAgcmV0dXJuIHN0cmluZ2lmeShvYmopOw0KICAgIH0NCiAgICBjb25zdCBrZXlzID0gW107DQogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGd1YXJkLWZvci1pbg0KICAgIGZvciAoY29uc3QgayBpbiBvYmopIHsNCiAgICAgICAga2V5cy5wdXNoKGspOw0KICAgIH0NCiAgICAvLyBFeHBvcnQgYXMganNvbiwgYnV0IHdpdGggdGhlIGtleXMgc29ydGVkLg0KICAgIGtleXMuc29ydCgpOw0KICAgIGxldCBrZXkgPSAneyc7DQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGlmIChpICE9PSAwKSB7DQogICAgICAgICAgICBrZXkgKz0gJywnOw0KICAgICAgICB9DQogICAgICAgIGtleSArPSBzdHJpbmdpZnkoa2V5c1tpXSk7DQogICAgICAgIGtleSArPSAnOic7DQogICAgICAgIGtleSArPSBPYmplY3RUb1VuaXF1ZUtleShvYmpba2V5c1tpXV0pOw0KICAgIH0NCiAgICBrZXkgKz0gJ30nOw0KICAgIHJldHVybiBrZXk7DQp9Ow0KLyoqDQogKiBTcGxpdHMgYSBzdHJpbmcgaW50byBhIG51bWJlciBvZiBzbWFsbGVyIHNlZ21lbnRzIG9mIG1heGltdW0gc2l6ZQ0KICogQHBhcmFtIHN0ciAtIFRoZSBzdHJpbmcNCiAqIEBwYXJhbSBzZWdzaXplIC0gVGhlIG1heGltdW0gbnVtYmVyIG9mIGNoYXJzIGluIHRoZSBzdHJpbmcuDQogKiBAcmV0dXJucyBUaGUgc3RyaW5nLCBzcGxpdCBpbnRvIGFwcHJvcHJpYXRlbHktc2l6ZWQgY2h1bmtzDQogKi8NCmNvbnN0IHNwbGl0U3RyaW5nQnlTaXplID0gZnVuY3Rpb24gKHN0ciwgc2Vnc2l6ZSkgew0KICAgIGNvbnN0IGxlbiA9IHN0ci5sZW5ndGg7DQogICAgaWYgKGxlbiA8PSBzZWdzaXplKSB7DQogICAgICAgIHJldHVybiBbc3RyXTsNCiAgICB9DQogICAgY29uc3QgZGF0YVNlZ3MgPSBbXTsNCiAgICBmb3IgKGxldCBjID0gMDsgYyA8IGxlbjsgYyArPSBzZWdzaXplKSB7DQogICAgICAgIGlmIChjICsgc2Vnc2l6ZSA+IGxlbikgew0KICAgICAgICAgICAgZGF0YVNlZ3MucHVzaChzdHIuc3Vic3RyaW5nKGMsIGxlbikpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgZGF0YVNlZ3MucHVzaChzdHIuc3Vic3RyaW5nKGMsIGMgKyBzZWdzaXplKSk7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGRhdGFTZWdzOw0KfTsNCi8qKg0KICogQXBwbHkgYSBmdW5jdGlvbiB0byBlYWNoIChrZXksIHZhbHVlKSBwYWlyIGluIGFuIG9iamVjdCBvcg0KICogYXBwbHkgYSBmdW5jdGlvbiB0byBlYWNoIChpbmRleCwgdmFsdWUpIHBhaXIgaW4gYW4gYXJyYXkNCiAqIEBwYXJhbSBvYmogLSBUaGUgb2JqZWN0IG9yIGFycmF5IHRvIGl0ZXJhdGUgb3Zlcg0KICogQHBhcmFtIGZuIC0gVGhlIGZ1bmN0aW9uIHRvIGFwcGx5DQogKi8NCmZ1bmN0aW9uIGVhY2gob2JqLCBmbikgew0KICAgIGZvciAoY29uc3Qga2V5IGluIG9iaikgew0KICAgICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KGtleSkpIHsNCiAgICAgICAgICAgIGZuKGtleSwgb2JqW2tleV0pOw0KICAgICAgICB9DQogICAgfQ0KfQ0KLyoqDQogKiBCb3Jyb3dlZCBmcm9tIGh0dHA6Ly9oZy5zZWNvbmRsaWZlLmNvbS9sbHNkL3NyYy90aXAvanMvdHlwZWRhcnJheS5qcyAoTUlUIExpY2Vuc2UpDQogKiBJIG1hZGUgb25lIG1vZGlmaWNhdGlvbiBhdCB0aGUgZW5kIGFuZCByZW1vdmVkIHRoZSBOYU4gLyBJbmZpbml0eQ0KICogaGFuZGxpbmcgKHNpbmNlIGl0IHNlZW1lZCBicm9rZW4gW2NhdXNlZCBhbiBvdmVyZmxvd10gYW5kIHdlIGRvbid0IG5lZWQgaXQpLiAgU2VlIE1KTCBjb21tZW50cy4NCiAqIEBwYXJhbSB2IC0gQSBkb3VibGUNCiAqDQogKi8NCmNvbnN0IGRvdWJsZVRvSUVFRTc1NFN0cmluZyA9IGZ1bmN0aW9uICh2KSB7DQogICAgYXNzZXJ0KCFpc0ludmFsaWRKU09OTnVtYmVyKHYpLCAnSW52YWxpZCBKU09OIG51bWJlcicpOyAvLyBNSkwNCiAgICBjb25zdCBlYml0cyA9IDExLCBmYml0cyA9IDUyOw0KICAgIGNvbnN0IGJpYXMgPSAoMSA8PCAoZWJpdHMgLSAxKSkgLSAxOw0KICAgIGxldCBzLCBlLCBmLCBsbiwgaTsNCiAgICAvLyBDb21wdXRlIHNpZ24sIGV4cG9uZW50LCBmcmFjdGlvbg0KICAgIC8vIFNraXAgTmFOIC8gSW5maW5pdHkgaGFuZGxpbmcgLS1NSkwuDQogICAgaWYgKHYgPT09IDApIHsNCiAgICAgICAgZSA9IDA7DQogICAgICAgIGYgPSAwOw0KICAgICAgICBzID0gMSAvIHYgPT09IC1JbmZpbml0eSA/IDEgOiAwOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgcyA9IHYgPCAwOw0KICAgICAgICB2ID0gTWF0aC5hYnModik7DQogICAgICAgIGlmICh2ID49IE1hdGgucG93KDIsIDEgLSBiaWFzKSkgew0KICAgICAgICAgICAgLy8gTm9ybWFsaXplZA0KICAgICAgICAgICAgbG4gPSBNYXRoLm1pbihNYXRoLmZsb29yKE1hdGgubG9nKHYpIC8gTWF0aC5MTjIpLCBiaWFzKTsNCiAgICAgICAgICAgIGUgPSBsbiArIGJpYXM7DQogICAgICAgICAgICBmID0gTWF0aC5yb3VuZCh2ICogTWF0aC5wb3coMiwgZmJpdHMgLSBsbikgLSBNYXRoLnBvdygyLCBmYml0cykpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgLy8gRGVub3JtYWxpemVkDQogICAgICAgICAgICBlID0gMDsNCiAgICAgICAgICAgIGYgPSBNYXRoLnJvdW5kKHYgLyBNYXRoLnBvdygyLCAxIC0gYmlhcyAtIGZiaXRzKSk7DQogICAgICAgIH0NCiAgICB9DQogICAgLy8gUGFjayBzaWduLCBleHBvbmVudCwgZnJhY3Rpb24NCiAgICBjb25zdCBiaXRzID0gW107DQogICAgZm9yIChpID0gZmJpdHM7IGk7IGkgLT0gMSkgew0KICAgICAgICBiaXRzLnB1c2goZiAlIDIgPyAxIDogMCk7DQogICAgICAgIGYgPSBNYXRoLmZsb29yKGYgLyAyKTsNCiAgICB9DQogICAgZm9yIChpID0gZWJpdHM7IGk7IGkgLT0gMSkgew0KICAgICAgICBiaXRzLnB1c2goZSAlIDIgPyAxIDogMCk7DQogICAgICAgIGUgPSBNYXRoLmZsb29yKGUgLyAyKTsNCiAgICB9DQogICAgYml0cy5wdXNoKHMgPyAxIDogMCk7DQogICAgYml0cy5yZXZlcnNlKCk7DQogICAgY29uc3Qgc3RyID0gYml0cy5qb2luKCcnKTsNCiAgICAvLyBSZXR1cm4gdGhlIGRhdGEgYXMgYSBoZXggc3RyaW5nLiAtLU1KTA0KICAgIGxldCBoZXhCeXRlU3RyaW5nID0gJyc7DQogICAgZm9yIChpID0gMDsgaSA8IDY0OyBpICs9IDgpIHsNCiAgICAgICAgbGV0IGhleEJ5dGUgPSBwYXJzZUludChzdHIuc3Vic3RyKGksIDgpLCAyKS50b1N0cmluZygxNik7DQogICAgICAgIGlmIChoZXhCeXRlLmxlbmd0aCA9PT0gMSkgew0KICAgICAgICAgICAgaGV4Qnl0ZSA9ICcwJyArIGhleEJ5dGU7DQogICAgICAgIH0NCiAgICAgICAgaGV4Qnl0ZVN0cmluZyA9IGhleEJ5dGVTdHJpbmcgKyBoZXhCeXRlOw0KICAgIH0NCiAgICByZXR1cm4gaGV4Qnl0ZVN0cmluZy50b0xvd2VyQ2FzZSgpOw0KfTsNCi8qKg0KICogVXNlZCB0byBkZXRlY3QgaWYgd2UncmUgaW4gYSBDaHJvbWUgY29udGVudCBzY3JpcHQgKHdoaWNoIGV4ZWN1dGVzIGluIGFuDQogKiBpc29sYXRlZCBlbnZpcm9ubWVudCB3aGVyZSBsb25nLXBvbGxpbmcgZG9lc24ndCB3b3JrKS4NCiAqLw0KY29uc3QgaXNDaHJvbWVFeHRlbnNpb25Db250ZW50U2NyaXB0ID0gZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiAhISh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JyAmJg0KICAgICAgICB3aW5kb3dbJ2Nocm9tZSddICYmDQogICAgICAgIHdpbmRvd1snY2hyb21lJ11bJ2V4dGVuc2lvbiddICYmDQogICAgICAgICEvXmNocm9tZS8udGVzdCh3aW5kb3cubG9jYXRpb24uaHJlZikpOw0KfTsNCi8qKg0KICogVXNlZCB0byBkZXRlY3QgaWYgd2UncmUgaW4gYSBXaW5kb3dzIDggU3RvcmUgYXBwLg0KICovDQpjb25zdCBpc1dpbmRvd3NTdG9yZUFwcCA9IGZ1bmN0aW9uICgpIHsNCiAgICAvLyBDaGVjayBmb3IgdGhlIHByZXNlbmNlIG9mIGEgY291cGxlIFdpblJUIGdsb2JhbHMNCiAgICByZXR1cm4gdHlwZW9mIFdpbmRvd3MgPT09ICdvYmplY3QnICYmIHR5cGVvZiBXaW5kb3dzLlVJID09PSAnb2JqZWN0JzsNCn07DQovKioNCiAqIENvbnZlcnRzIGEgc2VydmVyIGVycm9yIGNvZGUgdG8gYSBKYXZhc2NyaXB0IEVycm9yDQogKi8NCmZ1bmN0aW9uIGVycm9yRm9yU2VydmVyQ29kZShjb2RlLCBxdWVyeSkgew0KICAgIGxldCByZWFzb24gPSAnVW5rbm93biBFcnJvcic7DQogICAgaWYgKGNvZGUgPT09ICd0b29fYmlnJykgew0KICAgICAgICByZWFzb24gPQ0KICAgICAgICAgICAgJ1RoZSBkYXRhIHJlcXVlc3RlZCBleGNlZWRzIHRoZSBtYXhpbXVtIHNpemUgJyArDQogICAgICAgICAgICAgICAgJ3RoYXQgY2FuIGJlIGFjY2Vzc2VkIHdpdGggYSBzaW5nbGUgcmVxdWVzdC4nOw0KICAgIH0NCiAgICBlbHNlIGlmIChjb2RlID09PSAncGVybWlzc2lvbl9kZW5pZWQnKSB7DQogICAgICAgIHJlYXNvbiA9ICJDbGllbnQgZG9lc24ndCBoYXZlIHBlcm1pc3Npb24gdG8gYWNjZXNzIHRoZSBkZXNpcmVkIGRhdGEuIjsNCiAgICB9DQogICAgZWxzZSBpZiAoY29kZSA9PT0gJ3VuYXZhaWxhYmxlJykgew0KICAgICAgICByZWFzb24gPSAnVGhlIHNlcnZpY2UgaXMgdW5hdmFpbGFibGUnOw0KICAgIH0NCiAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcihjb2RlICsgJyBhdCAnICsgcXVlcnkuX3BhdGgudG9TdHJpbmcoKSArICc6ICcgKyByZWFzb24pOw0KICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55DQogICAgZXJyb3IuY29kZSA9IGNvZGUudG9VcHBlckNhc2UoKTsNCiAgICByZXR1cm4gZXJyb3I7DQp9DQovKioNCiAqIFVzZWQgdG8gdGVzdCBmb3IgaW50ZWdlci1sb29raW5nIHN0cmluZ3MNCiAqLw0KY29uc3QgSU5URUdFUl9SRUdFWFBfID0gbmV3IFJlZ0V4cCgnXi0/KDAqKVxcZHsxLDEwfSQnKTsNCi8qKg0KICogRm9yIHVzZSBpbiBrZXlzLCB0aGUgbWluaW11bSBwb3NzaWJsZSAzMi1iaXQgaW50ZWdlci4NCiAqLw0KY29uc3QgSU5URUdFUl8zMl9NSU4gPSAtMjE0NzQ4MzY0ODsNCi8qKg0KICogRm9yIHVzZSBpbiBreWVzLCB0aGUgbWF4aW11bSBwb3NzaWJsZSAzMi1iaXQgaW50ZWdlci4NCiAqLw0KY29uc3QgSU5URUdFUl8zMl9NQVggPSAyMTQ3NDgzNjQ3Ow0KLyoqDQogKiBJZiB0aGUgc3RyaW5nIGNvbnRhaW5zIGEgMzItYml0IGludGVnZXIsIHJldHVybiBpdC4gIEVsc2UgcmV0dXJuIG51bGwuDQogKi8NCmNvbnN0IHRyeVBhcnNlSW50ID0gZnVuY3Rpb24gKHN0cikgew0KICAgIGlmIChJTlRFR0VSX1JFR0VYUF8udGVzdChzdHIpKSB7DQogICAgICAgIGNvbnN0IGludFZhbCA9IE51bWJlcihzdHIpOw0KICAgICAgICBpZiAoaW50VmFsID49IElOVEVHRVJfMzJfTUlOICYmIGludFZhbCA8PSBJTlRFR0VSXzMyX01BWCkgew0KICAgICAgICAgICAgcmV0dXJuIGludFZhbDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gbnVsbDsNCn07DQovKioNCiAqIEhlbHBlciB0byBydW4gc29tZSBjb2RlIGJ1dCBjYXRjaCBhbnkgZXhjZXB0aW9ucyBhbmQgcmUtdGhyb3cgdGhlbSBsYXRlci4NCiAqIFVzZWZ1bCBmb3IgcHJldmVudGluZyB1c2VyIGNhbGxiYWNrcyBmcm9tIGJyZWFraW5nIGludGVybmFsIGNvZGUuDQogKg0KICogUmUtdGhyb3dpbmcgdGhlIGV4Y2VwdGlvbiBmcm9tIGEgc2V0VGltZW91dCBpcyBhIGxpdHRsZSBldmlsLCBidXQgaXQncyB2ZXJ5DQogKiBjb252ZW5pZW50ICh3ZSBkb24ndCBoYXZlIHRvIHRyeSB0byBmaWd1cmUgb3V0IHdoZW4gaXMgYSBzYWZlIHBvaW50IHRvDQogKiByZS10aHJvdyBpdCksIGFuZCB0aGUgYmVoYXZpb3Igc2VlbXMgcmVhc29uYWJsZToNCiAqDQogKiAqIElmIHlvdSBhcmVuJ3QgcGF1c2luZyBvbiBleGNlcHRpb25zLCB5b3UgZ2V0IGFuIGVycm9yIGluIHRoZSBjb25zb2xlIHdpdGgNCiAqICAgdGhlIGNvcnJlY3Qgc3RhY2sgdHJhY2UuDQogKiAqIElmIHlvdSdyZSBwYXVzaW5nIG9uIGFsbCBleGNlcHRpb25zLCB0aGUgZGVidWdnZXIgd2lsbCBwYXVzZSBvbiB5b3VyDQogKiAgIGV4Y2VwdGlvbiBhbmQgdGhlbiBhZ2FpbiB3aGVuIHdlIHJldGhyb3cgaXQuDQogKiAqIElmIHlvdSdyZSBvbmx5IHBhdXNpbmcgb24gdW5jYXVnaHQgZXhjZXB0aW9ucywgdGhlIGRlYnVnZ2VyIHdpbGwgb25seSBwYXVzZQ0KICogICBvbiB1cyByZS10aHJvd2luZyBpdC4NCiAqDQogKiBAcGFyYW0gZm4gLSBUaGUgY29kZSB0byBndWFyZC4NCiAqLw0KY29uc3QgZXhjZXB0aW9uR3VhcmQgPSBmdW5jdGlvbiAoZm4pIHsNCiAgICB0cnkgew0KICAgICAgICBmbigpOw0KICAgIH0NCiAgICBjYXRjaCAoZSkgew0KICAgICAgICAvLyBSZS10aHJvdyBleGNlcHRpb24gd2hlbiBpdCdzIHNhZmUuDQogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgLy8gSXQgdXNlZCB0byBiZSB0aGF0ICJ0aHJvdyBlIiB3b3VsZCByZXN1bHQgaW4gYSBnb29kIGNvbnNvbGUgZXJyb3Igd2l0aA0KICAgICAgICAgICAgLy8gcmVsZXZhbnQgY29udGV4dCwgYnV0IGFzIG9mIENocm9tZSAzOSwgeW91IGp1c3QgZ2V0IHRoZSBmaXJlYmFzZS5qcw0KICAgICAgICAgICAgLy8gZmlsZS9saW5lIG51bWJlciB3aGVyZSB3ZSByZS10aHJvdyBpdCwgd2hpY2ggaXMgdXNlbGVzcy4gU28gd2UgbG9nDQogICAgICAgICAgICAvLyBlLnN0YWNrIGV4cGxpY2l0bHkuDQogICAgICAgICAgICBjb25zdCBzdGFjayA9IGUuc3RhY2sgfHwgJyc7DQogICAgICAgICAgICB3YXJuKCdFeGNlcHRpb24gd2FzIHRocm93biBieSB1c2VyIGNhbGxiYWNrLicsIHN0YWNrKTsNCiAgICAgICAgICAgIHRocm93IGU7DQogICAgICAgIH0sIE1hdGguZmxvb3IoMCkpOw0KICAgIH0NCn07DQovKioNCiAqIEByZXR1cm5zIHtib29sZWFufSB0cnVlIGlmIHdlIHRoaW5rIHdlJ3JlIGN1cnJlbnRseSBiZWluZyBjcmF3bGVkLg0KICovDQpjb25zdCBiZWluZ0NyYXdsZWQgPSBmdW5jdGlvbiAoKSB7DQogICAgY29uc3QgdXNlckFnZW50ID0gKHR5cGVvZiB3aW5kb3cgPT09ICdvYmplY3QnICYmDQogICAgICAgIHdpbmRvd1snbmF2aWdhdG9yJ10gJiYNCiAgICAgICAgd2luZG93WyduYXZpZ2F0b3InXVsndXNlckFnZW50J10pIHx8DQogICAgICAgICcnOw0KICAgIC8vIEZvciBub3cgd2Ugd2hpdGVsaXN0IHRoZSBtb3N0IHBvcHVsYXIgY3Jhd2xlcnMuICBXZSBzaG91bGQgcmVmaW5lIHRoaXMgdG8gYmUgdGhlIHNldCBvZiBjcmF3bGVycyB3ZQ0KICAgIC8vIGJlbGlldmUgdG8gc3VwcG9ydCBKYXZhU2NyaXB0L0FKQVggcmVuZGVyaW5nLg0KICAgIC8vIE5PVEU6IEdvb2dsZSBXZWJtYXN0ZXIgVG9vbHMgZG9lc24ndCByZWFsbHkgYmVsb25nLCBidXQgdGhlaXIgIlRoaXMgaXMgaG93IGEgdmlzaXRvciB0byB5b3VyIHdlYnNpdGUNCiAgICAvLyB3b3VsZCBoYXZlIHNlZW4gdGhlIHBhZ2UiIGlzIGZsYWt5IGlmIHdlIGRvbid0IHRyZWF0IGl0IGFzIGEgY3Jhd2xlci4NCiAgICByZXR1cm4gKHVzZXJBZ2VudC5zZWFyY2goL2dvb2dsZWJvdHxnb29nbGUgd2VibWFzdGVyIHRvb2xzfGJpbmdib3R8eWFob28hIHNsdXJwfGJhaWR1c3BpZGVyfHlhbmRleGJvdHxkdWNrZHVja2JvdC9pKSA+PSAwKTsNCn07DQovKioNCiAqIFNhbWUgYXMgc2V0VGltZW91dCgpIGV4Y2VwdCBvbiBOb2RlLkpTIGl0IHdpbGwgL25vdC8gcHJldmVudCB0aGUgcHJvY2VzcyBmcm9tIGV4aXRpbmcuDQogKg0KICogSXQgaXMgcmVtb3ZlZCB3aXRoIGNsZWFyVGltZW91dCgpIGFzIG5vcm1hbC4NCiAqDQogKiBAcGFyYW0gZm4gLSBGdW5jdGlvbiB0byBydW4uDQogKiBAcGFyYW0gdGltZSAtIE1pbGxpc2Vjb25kcyB0byB3YWl0IGJlZm9yZSBydW5uaW5nLg0KICogQHJldHVybnMgVGhlIHNldFRpbWVvdXQoKSByZXR1cm4gdmFsdWUuDQogKi8NCmNvbnN0IHNldFRpbWVvdXROb25CbG9ja2luZyA9IGZ1bmN0aW9uIChmbiwgdGltZSkgew0KICAgIGNvbnN0IHRpbWVvdXQgPSBzZXRUaW1lb3V0KGZuLCB0aW1lKTsNCiAgICAvLyBOb3RlOiBhdCB0aGUgdGltZSBvZiB0aGlzIGNvbW1lbnQsIHVucmVmVGltZXIgaXMgdW5kZXIgdGhlIHVuc3RhYmxlIHNldCBvZiBBUElzLiBSdW4gd2l0aCAtLXVuc3RhYmxlIHRvIGVuYWJsZSB0aGUgQVBJLg0KICAgIGlmICh0eXBlb2YgdGltZW91dCA9PT0gJ251bWJlcicgJiYNCiAgICAgICAgLy8gQHRzLWlnbm9yZSBJcyBvbmx5IGRlZmluZWQgaW4gRGVubyBlbnZpcm9ubWVudHMuDQogICAgICAgIHR5cGVvZiBEZW5vICE9PSAndW5kZWZpbmVkJyAmJg0KICAgICAgICAvLyBAdHMtaWdub3JlIERlbm8gYW5kIHVucmVmVGltZXIgYXJlIG9ubHkgZGVmaW5lZCBpbiBEZW5vIGVudmlyb25tZW50cy4NCiAgICAgICAgRGVub1sndW5yZWZUaW1lciddKSB7DQogICAgICAgIC8vIEB0cy1pZ25vcmUgRGVubyBhbmQgdW5yZWZUaW1lciBhcmUgb25seSBkZWZpbmVkIGluIERlbm8gZW52aXJvbm1lbnRzLg0KICAgICAgICBEZW5vLnVucmVmVGltZXIodGltZW91dCk7DQogICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55DQogICAgfQ0KICAgIGVsc2UgaWYgKHR5cGVvZiB0aW1lb3V0ID09PSAnb2JqZWN0JyAmJiB0aW1lb3V0Wyd1bnJlZiddKSB7DQogICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55DQogICAgICAgIHRpbWVvdXRbJ3VucmVmJ10oKTsNCiAgICB9DQogICAgcmV0dXJuIHRpbWVvdXQ7DQp9OwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBBYnN0cmFjdGlvbiBhcm91bmQgQXBwQ2hlY2sncyB0b2tlbiBmZXRjaGluZyBjYXBhYmlsaXRpZXMuDQogKi8NCmNsYXNzIEFwcENoZWNrVG9rZW5Qcm92aWRlciB7DQogICAgY29uc3RydWN0b3IoYXBwTmFtZV8sIGFwcENoZWNrUHJvdmlkZXIpIHsNCiAgICAgICAgdGhpcy5hcHBOYW1lXyA9IGFwcE5hbWVfOw0KICAgICAgICB0aGlzLmFwcENoZWNrUHJvdmlkZXIgPSBhcHBDaGVja1Byb3ZpZGVyOw0KICAgICAgICB0aGlzLmFwcENoZWNrID0gYXBwQ2hlY2tQcm92aWRlciA9PT0gbnVsbCB8fCBhcHBDaGVja1Byb3ZpZGVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhcHBDaGVja1Byb3ZpZGVyLmdldEltbWVkaWF0ZSh7IG9wdGlvbmFsOiB0cnVlIH0pOw0KICAgICAgICBpZiAoIXRoaXMuYXBwQ2hlY2spIHsNCiAgICAgICAgICAgIGFwcENoZWNrUHJvdmlkZXIgPT09IG51bGwgfHwgYXBwQ2hlY2tQcm92aWRlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXBwQ2hlY2tQcm92aWRlci5nZXQoKS50aGVuKGFwcENoZWNrID0+ICh0aGlzLmFwcENoZWNrID0gYXBwQ2hlY2spKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBnZXRUb2tlbihmb3JjZVJlZnJlc2gpIHsNCiAgICAgICAgaWYgKCF0aGlzLmFwcENoZWNrKSB7DQogICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICAgICAgICAgIC8vIFN1cHBvcnQgZGVsYXllZCBpbml0aWFsaXphdGlvbiBvZiBGaXJlYmFzZUFwcENoZWNrLiBUaGlzIGFsbG93cyBvdXINCiAgICAgICAgICAgICAgICAvLyBjdXN0b21lcnMgdG8gaW5pdGlhbGl6ZSB0aGUgUlREQiBTREsgYmVmb3JlIGluaXRpYWxpemluZyBGaXJlYmFzZQ0KICAgICAgICAgICAgICAgIC8vIEFwcENoZWNrIGFuZCBlbnN1cmVzIHRoYXQgYWxsIHJlcXVlc3RzIGFyZSBhdXRoZW50aWNhdGVkIGlmIGEgdG9rZW4NCiAgICAgICAgICAgICAgICAvLyBiZWNvbWVzIGF2YWlsYWJsZSBiZWZvcmUgdGhlIHRpbW9lb3V0IGJlbG93IGV4cGlyZXMuDQogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmFwcENoZWNrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldFRva2VuKGZvcmNlUmVmcmVzaCkudGhlbihyZXNvbHZlLCByZWplY3QpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0sIDApOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXMuYXBwQ2hlY2suZ2V0VG9rZW4oZm9yY2VSZWZyZXNoKTsNCiAgICB9DQogICAgYWRkVG9rZW5DaGFuZ2VMaXN0ZW5lcihsaXN0ZW5lcikgew0KICAgICAgICB2YXIgX2E7DQogICAgICAgIChfYSA9IHRoaXMuYXBwQ2hlY2tQcm92aWRlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmdldCgpLnRoZW4oYXBwQ2hlY2sgPT4gYXBwQ2hlY2suYWRkVG9rZW5MaXN0ZW5lcihsaXN0ZW5lcikpOw0KICAgIH0NCiAgICBub3RpZnlGb3JJbnZhbGlkVG9rZW4oKSB7DQogICAgICAgIHdhcm4oYFByb3ZpZGVkIEFwcENoZWNrIGNyZWRlbnRpYWxzIGZvciB0aGUgYXBwIG5hbWVkICIke3RoaXMuYXBwTmFtZV99IiBgICsNCiAgICAgICAgICAgICdhcmUgaW52YWxpZC4gVGhpcyB1c3VhbGx5IGluZGljYXRlcyB5b3VyIGFwcCB3YXMgbm90IGluaXRpYWxpemVkIGNvcnJlY3RseS4nKTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIEFic3RyYWN0aW9uIGFyb3VuZCBGaXJlYmFzZUFwcCdzIHRva2VuIGZldGNoaW5nIGNhcGFiaWxpdGllcy4NCiAqLw0KY2xhc3MgRmlyZWJhc2VBdXRoVG9rZW5Qcm92aWRlciB7DQogICAgY29uc3RydWN0b3IoYXBwTmFtZV8sIGZpcmViYXNlT3B0aW9uc18sIGF1dGhQcm92aWRlcl8pIHsNCiAgICAgICAgdGhpcy5hcHBOYW1lXyA9IGFwcE5hbWVfOw0KICAgICAgICB0aGlzLmZpcmViYXNlT3B0aW9uc18gPSBmaXJlYmFzZU9wdGlvbnNfOw0KICAgICAgICB0aGlzLmF1dGhQcm92aWRlcl8gPSBhdXRoUHJvdmlkZXJfOw0KICAgICAgICB0aGlzLmF1dGhfID0gbnVsbDsNCiAgICAgICAgdGhpcy5hdXRoXyA9IGF1dGhQcm92aWRlcl8uZ2V0SW1tZWRpYXRlKHsgb3B0aW9uYWw6IHRydWUgfSk7DQogICAgICAgIGlmICghdGhpcy5hdXRoXykgew0KICAgICAgICAgICAgYXV0aFByb3ZpZGVyXy5vbkluaXQoYXV0aCA9PiAodGhpcy5hdXRoXyA9IGF1dGgpKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBnZXRUb2tlbihmb3JjZVJlZnJlc2gpIHsNCiAgICAgICAgaWYgKCF0aGlzLmF1dGhfKSB7DQogICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICAgICAgICAgIC8vIFN1cHBvcnQgZGVsYXllZCBpbml0aWFsaXphdGlvbiBvZiBGaXJlYmFzZUF1dGguIFRoaXMgYWxsb3dzIG91cg0KICAgICAgICAgICAgICAgIC8vIGN1c3RvbWVycyB0byBpbml0aWFsaXplIHRoZSBSVERCIFNESyBiZWZvcmUgaW5pdGlhbGl6aW5nIEZpcmViYXNlDQogICAgICAgICAgICAgICAgLy8gQXV0aCBhbmQgZW5zdXJlcyB0aGF0IGFsbCByZXF1ZXN0cyBhcmUgYXV0aGVudGljYXRlZCBpZiBhIHRva2VuDQogICAgICAgICAgICAgICAgLy8gYmVjb21lcyBhdmFpbGFibGUgYmVmb3JlIHRoZSB0aW1vZW91dCBiZWxvdyBleHBpcmVzLg0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5hdXRoXykgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRUb2tlbihmb3JjZVJlZnJlc2gpLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUobnVsbCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LCAwKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzLmF1dGhfLmdldFRva2VuKGZvcmNlUmVmcmVzaCkuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgLy8gVE9ETzogTmVlZCB0byBmaWd1cmUgb3V0IGFsbCB0aGUgY2FzZXMgdGhpcyBpcyByYWlzZWQgYW5kIHdoZXRoZXINCiAgICAgICAgICAgIC8vIHRoaXMgbWFrZXMgc2Vuc2UuDQogICAgICAgICAgICBpZiAoZXJyb3IgJiYgZXJyb3IuY29kZSA9PT0gJ2F1dGgvdG9rZW4tbm90LWluaXRpYWxpemVkJykgew0KICAgICAgICAgICAgICAgIGxvZygnR290IGF1dGgvdG9rZW4tbm90LWluaXRpYWxpemVkIGVycm9yLiAgVHJlYXRpbmcgYXMgbnVsbCB0b2tlbi4nKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0NCiAgICBhZGRUb2tlbkNoYW5nZUxpc3RlbmVyKGxpc3RlbmVyKSB7DQogICAgICAgIC8vIFRPRE86IFdlIG1pZ2h0IHdhbnQgdG8gd3JhcCB0aGUgbGlzdGVuZXIgYW5kIGNhbGwgaXQgd2l0aCBubyBhcmdzIHRvDQogICAgICAgIC8vIGF2b2lkIGEgbGVha3kgYWJzdHJhY3Rpb24sIGJ1dCB0aGF0IG1ha2VzIHJlbW92aW5nIHRoZSBsaXN0ZW5lciBoYXJkZXIuDQogICAgICAgIGlmICh0aGlzLmF1dGhfKSB7DQogICAgICAgICAgICB0aGlzLmF1dGhfLmFkZEF1dGhUb2tlbkxpc3RlbmVyKGxpc3RlbmVyKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMuYXV0aFByb3ZpZGVyXw0KICAgICAgICAgICAgICAgIC5nZXQoKQ0KICAgICAgICAgICAgICAgIC50aGVuKGF1dGggPT4gYXV0aC5hZGRBdXRoVG9rZW5MaXN0ZW5lcihsaXN0ZW5lcikpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJlbW92ZVRva2VuQ2hhbmdlTGlzdGVuZXIobGlzdGVuZXIpIHsNCiAgICAgICAgdGhpcy5hdXRoUHJvdmlkZXJfDQogICAgICAgICAgICAuZ2V0KCkNCiAgICAgICAgICAgIC50aGVuKGF1dGggPT4gYXV0aC5yZW1vdmVBdXRoVG9rZW5MaXN0ZW5lcihsaXN0ZW5lcikpOw0KICAgIH0NCiAgICBub3RpZnlGb3JJbnZhbGlkVG9rZW4oKSB7DQogICAgICAgIGxldCBlcnJvck1lc3NhZ2UgPSAnUHJvdmlkZWQgYXV0aGVudGljYXRpb24gY3JlZGVudGlhbHMgZm9yIHRoZSBhcHAgbmFtZWQgIicgKw0KICAgICAgICAgICAgdGhpcy5hcHBOYW1lXyArDQogICAgICAgICAgICAnIiBhcmUgaW52YWxpZC4gVGhpcyB1c3VhbGx5IGluZGljYXRlcyB5b3VyIGFwcCB3YXMgbm90ICcgKw0KICAgICAgICAgICAgJ2luaXRpYWxpemVkIGNvcnJlY3RseS4gJzsNCiAgICAgICAgaWYgKCdjcmVkZW50aWFsJyBpbiB0aGlzLmZpcmViYXNlT3B0aW9uc18pIHsNCiAgICAgICAgICAgIGVycm9yTWVzc2FnZSArPQ0KICAgICAgICAgICAgICAgICdNYWtlIHN1cmUgdGhlICJjcmVkZW50aWFsIiBwcm9wZXJ0eSBwcm92aWRlZCB0byBpbml0aWFsaXplQXBwKCkgJyArDQogICAgICAgICAgICAgICAgICAgICdpcyBhdXRob3JpemVkIHRvIGFjY2VzcyB0aGUgc3BlY2lmaWVkICJkYXRhYmFzZVVSTCIgYW5kIGlzIGZyb20gdGhlIGNvcnJlY3QgJyArDQogICAgICAgICAgICAgICAgICAgICdwcm9qZWN0Lic7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoJ3NlcnZpY2VBY2NvdW50JyBpbiB0aGlzLmZpcmViYXNlT3B0aW9uc18pIHsNCiAgICAgICAgICAgIGVycm9yTWVzc2FnZSArPQ0KICAgICAgICAgICAgICAgICdNYWtlIHN1cmUgdGhlICJzZXJ2aWNlQWNjb3VudCIgcHJvcGVydHkgcHJvdmlkZWQgdG8gaW5pdGlhbGl6ZUFwcCgpICcgKw0KICAgICAgICAgICAgICAgICAgICAnaXMgYXV0aG9yaXplZCB0byBhY2Nlc3MgdGhlIHNwZWNpZmllZCAiZGF0YWJhc2VVUkwiIGFuZCBpcyBmcm9tIHRoZSBjb3JyZWN0ICcgKw0KICAgICAgICAgICAgICAgICAgICAncHJvamVjdC4nOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgZXJyb3JNZXNzYWdlICs9DQogICAgICAgICAgICAgICAgJ01ha2Ugc3VyZSB0aGUgImFwaUtleSIgYW5kICJkYXRhYmFzZVVSTCIgcHJvcGVydGllcyBwcm92aWRlZCB0byAnICsNCiAgICAgICAgICAgICAgICAgICAgJ2luaXRpYWxpemVBcHAoKSBtYXRjaCB0aGUgdmFsdWVzIHByb3ZpZGVkIGZvciB5b3VyIGFwcCBhdCAnICsNCiAgICAgICAgICAgICAgICAgICAgJ2h0dHBzOi8vY29uc29sZS5maXJlYmFzZS5nb29nbGUuY29tLy4nOw0KICAgICAgICB9DQogICAgICAgIHdhcm4oZXJyb3JNZXNzYWdlKTsNCiAgICB9DQp9DQovKiBBdXRoVG9rZW5Qcm92aWRlciB0aGF0IHN1cHBsaWVzIGEgY29uc3RhbnQgdG9rZW4uIFVzZWQgYnkgQWRtaW4gU0RLIG9yIG1vY2tVc2VyVG9rZW4gd2l0aCBlbXVsYXRvcnMuICovDQpjbGFzcyBFbXVsYXRvclRva2VuUHJvdmlkZXIgew0KICAgIGNvbnN0cnVjdG9yKGFjY2Vzc1Rva2VuKSB7DQogICAgICAgIHRoaXMuYWNjZXNzVG9rZW4gPSBhY2Nlc3NUb2tlbjsNCiAgICB9DQogICAgZ2V0VG9rZW4oZm9yY2VSZWZyZXNoKSB7DQogICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoew0KICAgICAgICAgICAgYWNjZXNzVG9rZW46IHRoaXMuYWNjZXNzVG9rZW4NCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGFkZFRva2VuQ2hhbmdlTGlzdGVuZXIobGlzdGVuZXIpIHsNCiAgICAgICAgLy8gSW52b2tlIHRoZSBsaXN0ZW5lciBpbW1lZGlhdGVseSB0byBtYXRjaCB0aGUgYmVoYXZpb3IgaW4gRmlyZWJhc2UgQXV0aA0KICAgICAgICAvLyAoc2VlIHBhY2thZ2VzL2F1dGgvc3JjL2F1dGguanMjTDE4MDcpDQogICAgICAgIGxpc3RlbmVyKHRoaXMuYWNjZXNzVG9rZW4pOw0KICAgIH0NCiAgICByZW1vdmVUb2tlbkNoYW5nZUxpc3RlbmVyKGxpc3RlbmVyKSB7IH0NCiAgICBub3RpZnlGb3JJbnZhbGlkVG9rZW4oKSB7IH0NCn0NCi8qKiBBIHN0cmluZyB0aGF0IGlzIHRyZWF0ZWQgYXMgYW4gYWRtaW4gYWNjZXNzIHRva2VuIGJ5IHRoZSBSVERCIGVtdWxhdG9yLiBVc2VkIGJ5IEFkbWluIFNESy4gKi8NCkVtdWxhdG9yVG9rZW5Qcm92aWRlci5PV05FUiA9ICdvd25lcic7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjb25zdCBQUk9UT0NPTF9WRVJTSU9OID0gJzUnOw0KY29uc3QgVkVSU0lPTl9QQVJBTSA9ICd2JzsNCmNvbnN0IFRSQU5TUE9SVF9TRVNTSU9OX1BBUkFNID0gJ3MnOw0KY29uc3QgUkVGRVJFUl9QQVJBTSA9ICdyJzsNCmNvbnN0IEZPUkdFX1JFRiA9ICdmJzsNCi8vIE1hdGNoZXMgY29uc29sZS5maXJlYmFzZS5nb29nbGUuY29tLCBmaXJlYmFzZS1jb25zb2xlLSouY29ycC5nb29nbGUuY29tIGFuZA0KLy8gZmlyZWJhc2UuY29ycC5nb29nbGUuY29tDQpjb25zdCBGT1JHRV9ET01BSU5fUkUgPSAvKGNvbnNvbGVcLmZpcmViYXNlfGZpcmViYXNlLWNvbnNvbGUtXHcrXC5jb3JwfGZpcmViYXNlXC5jb3JwKVwuZ29vZ2xlXC5jb20vOw0KY29uc3QgTEFTVF9TRVNTSU9OX1BBUkFNID0gJ2xzJzsNCmNvbnN0IEFQUExJQ0FUSU9OX0lEX1BBUkFNID0gJ3AnOw0KY29uc3QgQVBQX0NIRUNLX1RPS0VOX1BBUkFNID0gJ2FjJzsNCmNvbnN0IFdFQlNPQ0tFVCA9ICd3ZWJzb2NrZXQnOw0KY29uc3QgTE9OR19QT0xMSU5HID0gJ2xvbmdfcG9sbGluZyc7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIEEgY2xhc3MgdGhhdCBob2xkcyBtZXRhZGF0YSBhYm91dCBhIFJlcG8gb2JqZWN0DQogKi8NCmNsYXNzIFJlcG9JbmZvIHsNCiAgICAvKioNCiAgICAgKiBAcGFyYW0gaG9zdCAtIEhvc3RuYW1lIHBvcnRpb24gb2YgdGhlIHVybCBmb3IgdGhlIHJlcG8NCiAgICAgKiBAcGFyYW0gc2VjdXJlIC0gV2hldGhlciBvciBub3QgdGhpcyByZXBvIGlzIGFjY2Vzc2VkIG92ZXIgc3NsDQogICAgICogQHBhcmFtIG5hbWVzcGFjZSAtIFRoZSBuYW1lc3BhY2UgcmVwcmVzZW50ZWQgYnkgdGhlIHJlcG8NCiAgICAgKiBAcGFyYW0gd2ViU29ja2V0T25seSAtIFdoZXRoZXIgdG8gcHJlZmVyIHdlYnNvY2tldHMgb3ZlciBhbGwgb3RoZXIgdHJhbnNwb3J0cyAodXNlZCBieSBOZXN0KS4NCiAgICAgKiBAcGFyYW0gbm9kZUFkbWluIC0gV2hldGhlciB0aGlzIGluc3RhbmNlIHVzZXMgQWRtaW4gU0RLIGNyZWRlbnRpYWxzDQogICAgICogQHBhcmFtIHBlcnNpc3RlbmNlS2V5IC0gT3ZlcnJpZGUgdGhlIGRlZmF1bHQgc2Vzc2lvbiBwZXJzaXN0ZW5jZSBzdG9yYWdlIGtleQ0KICAgICAqLw0KICAgIGNvbnN0cnVjdG9yKGhvc3QsIHNlY3VyZSwgbmFtZXNwYWNlLCB3ZWJTb2NrZXRPbmx5LCBub2RlQWRtaW4gPSBmYWxzZSwgcGVyc2lzdGVuY2VLZXkgPSAnJywgaW5jbHVkZU5hbWVzcGFjZUluUXVlcnlQYXJhbXMgPSBmYWxzZSwgaXNVc2luZ0VtdWxhdG9yID0gZmFsc2UpIHsNCiAgICAgICAgdGhpcy5zZWN1cmUgPSBzZWN1cmU7DQogICAgICAgIHRoaXMubmFtZXNwYWNlID0gbmFtZXNwYWNlOw0KICAgICAgICB0aGlzLndlYlNvY2tldE9ubHkgPSB3ZWJTb2NrZXRPbmx5Ow0KICAgICAgICB0aGlzLm5vZGVBZG1pbiA9IG5vZGVBZG1pbjsNCiAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZUtleSA9IHBlcnNpc3RlbmNlS2V5Ow0KICAgICAgICB0aGlzLmluY2x1ZGVOYW1lc3BhY2VJblF1ZXJ5UGFyYW1zID0gaW5jbHVkZU5hbWVzcGFjZUluUXVlcnlQYXJhbXM7DQogICAgICAgIHRoaXMuaXNVc2luZ0VtdWxhdG9yID0gaXNVc2luZ0VtdWxhdG9yOw0KICAgICAgICB0aGlzLl9ob3N0ID0gaG9zdC50b0xvd2VyQ2FzZSgpOw0KICAgICAgICB0aGlzLl9kb21haW4gPSB0aGlzLl9ob3N0LnN1YnN0cih0aGlzLl9ob3N0LmluZGV4T2YoJy4nKSArIDEpOw0KICAgICAgICB0aGlzLmludGVybmFsSG9zdCA9DQogICAgICAgICAgICBQZXJzaXN0ZW50U3RvcmFnZS5nZXQoJ2hvc3Q6JyArIGhvc3QpIHx8IHRoaXMuX2hvc3Q7DQogICAgfQ0KICAgIGlzQ2FjaGVhYmxlSG9zdCgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuaW50ZXJuYWxIb3N0LnN1YnN0cigwLCAyKSA9PT0gJ3MtJzsNCiAgICB9DQogICAgaXNDdXN0b21Ib3N0KCkgew0KICAgICAgICByZXR1cm4gKHRoaXMuX2RvbWFpbiAhPT0gJ2ZpcmViYXNlaW8uY29tJyAmJg0KICAgICAgICAgICAgdGhpcy5fZG9tYWluICE9PSAnZmlyZWJhc2Vpby1kZW1vLmNvbScpOw0KICAgIH0NCiAgICBnZXQgaG9zdCgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuX2hvc3Q7DQogICAgfQ0KICAgIHNldCBob3N0KG5ld0hvc3QpIHsNCiAgICAgICAgaWYgKG5ld0hvc3QgIT09IHRoaXMuaW50ZXJuYWxIb3N0KSB7DQogICAgICAgICAgICB0aGlzLmludGVybmFsSG9zdCA9IG5ld0hvc3Q7DQogICAgICAgICAgICBpZiAodGhpcy5pc0NhY2hlYWJsZUhvc3QoKSkgew0KICAgICAgICAgICAgICAgIFBlcnNpc3RlbnRTdG9yYWdlLnNldCgnaG9zdDonICsgdGhpcy5faG9zdCwgdGhpcy5pbnRlcm5hbEhvc3QpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIHRvU3RyaW5nKCkgew0KICAgICAgICBsZXQgc3RyID0gdGhpcy50b1VSTFN0cmluZygpOw0KICAgICAgICBpZiAodGhpcy5wZXJzaXN0ZW5jZUtleSkgew0KICAgICAgICAgICAgc3RyICs9ICc8JyArIHRoaXMucGVyc2lzdGVuY2VLZXkgKyAnPic7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHN0cjsNCiAgICB9DQogICAgdG9VUkxTdHJpbmcoKSB7DQogICAgICAgIGNvbnN0IHByb3RvY29sID0gdGhpcy5zZWN1cmUgPyAnaHR0cHM6Ly8nIDogJ2h0dHA6Ly8nOw0KICAgICAgICBjb25zdCBxdWVyeSA9IHRoaXMuaW5jbHVkZU5hbWVzcGFjZUluUXVlcnlQYXJhbXMNCiAgICAgICAgICAgID8gYD9ucz0ke3RoaXMubmFtZXNwYWNlfWANCiAgICAgICAgICAgIDogJyc7DQogICAgICAgIHJldHVybiBgJHtwcm90b2NvbH0ke3RoaXMuaG9zdH0vJHtxdWVyeX1gOw0KICAgIH0NCn0NCmZ1bmN0aW9uIHJlcG9JbmZvTmVlZHNRdWVyeVBhcmFtKHJlcG9JbmZvKSB7DQogICAgcmV0dXJuIChyZXBvSW5mby5ob3N0ICE9PSByZXBvSW5mby5pbnRlcm5hbEhvc3QgfHwNCiAgICAgICAgcmVwb0luZm8uaXNDdXN0b21Ib3N0KCkgfHwNCiAgICAgICAgcmVwb0luZm8uaW5jbHVkZU5hbWVzcGFjZUluUXVlcnlQYXJhbXMpOw0KfQ0KLyoqDQogKiBSZXR1cm5zIHRoZSB3ZWJzb2NrZXQgVVJMIGZvciB0aGlzIHJlcG8NCiAqIEBwYXJhbSByZXBvSW5mbyAtIFJlcG9JbmZvIG9iamVjdA0KICogQHBhcmFtIHR5cGUgLSBvZiBjb25uZWN0aW9uDQogKiBAcGFyYW0gcGFyYW1zIC0gbGlzdA0KICogQHJldHVybnMgVGhlIFVSTCBmb3IgdGhpcyByZXBvDQogKi8NCmZ1bmN0aW9uIHJlcG9JbmZvQ29ubmVjdGlvblVSTChyZXBvSW5mbywgdHlwZSwgcGFyYW1zKSB7DQogICAgYXNzZXJ0KHR5cGVvZiB0eXBlID09PSAnc3RyaW5nJywgJ3R5cGVvZiB0eXBlIG11c3QgPT0gc3RyaW5nJyk7DQogICAgYXNzZXJ0KHR5cGVvZiBwYXJhbXMgPT09ICdvYmplY3QnLCAndHlwZW9mIHBhcmFtcyBtdXN0ID09IG9iamVjdCcpOw0KICAgIGxldCBjb25uVVJMOw0KICAgIGlmICh0eXBlID09PSBXRUJTT0NLRVQpIHsNCiAgICAgICAgY29ublVSTCA9DQogICAgICAgICAgICAocmVwb0luZm8uc2VjdXJlID8gJ3dzczovLycgOiAnd3M6Ly8nKSArIHJlcG9JbmZvLmludGVybmFsSG9zdCArICcvLndzPyc7DQogICAgfQ0KICAgIGVsc2UgaWYgKHR5cGUgPT09IExPTkdfUE9MTElORykgew0KICAgICAgICBjb25uVVJMID0NCiAgICAgICAgICAgIChyZXBvSW5mby5zZWN1cmUgPyAnaHR0cHM6Ly8nIDogJ2h0dHA6Ly8nKSArDQogICAgICAgICAgICAgICAgcmVwb0luZm8uaW50ZXJuYWxIb3N0ICsNCiAgICAgICAgICAgICAgICAnLy5scD8nOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIGNvbm5lY3Rpb24gdHlwZTogJyArIHR5cGUpOw0KICAgIH0NCiAgICBpZiAocmVwb0luZm9OZWVkc1F1ZXJ5UGFyYW0ocmVwb0luZm8pKSB7DQogICAgICAgIHBhcmFtc1snbnMnXSA9IHJlcG9JbmZvLm5hbWVzcGFjZTsNCiAgICB9DQogICAgY29uc3QgcGFpcnMgPSBbXTsNCiAgICBlYWNoKHBhcmFtcywgKGtleSwgdmFsdWUpID0+IHsNCiAgICAgICAgcGFpcnMucHVzaChrZXkgKyAnPScgKyB2YWx1ZSk7DQogICAgfSk7DQogICAgcmV0dXJuIGNvbm5VUkwgKyBwYWlycy5qb2luKCcmJyk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIFRyYWNrcyBhIGNvbGxlY3Rpb24gb2Ygc3RhdHMuDQogKi8NCmNsYXNzIFN0YXRzQ29sbGVjdGlvbiB7DQogICAgY29uc3RydWN0b3IoKSB7DQogICAgICAgIHRoaXMuY291bnRlcnNfID0ge307DQogICAgfQ0KICAgIGluY3JlbWVudENvdW50ZXIobmFtZSwgYW1vdW50ID0gMSkgew0KICAgICAgICBpZiAoIWNvbnRhaW5zKHRoaXMuY291bnRlcnNfLCBuYW1lKSkgew0KICAgICAgICAgICAgdGhpcy5jb3VudGVyc19bbmFtZV0gPSAwOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuY291bnRlcnNfW25hbWVdICs9IGFtb3VudDsNCiAgICB9DQogICAgZ2V0KCkgew0KICAgICAgICByZXR1cm4gZGVlcENvcHkodGhpcy5jb3VudGVyc18pOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNvbnN0IGNvbGxlY3Rpb25zID0ge307DQpjb25zdCByZXBvcnRlcnMgPSB7fTsNCmZ1bmN0aW9uIHN0YXRzTWFuYWdlckdldENvbGxlY3Rpb24ocmVwb0luZm8pIHsNCiAgICBjb25zdCBoYXNoU3RyaW5nID0gcmVwb0luZm8udG9TdHJpbmcoKTsNCiAgICBpZiAoIWNvbGxlY3Rpb25zW2hhc2hTdHJpbmddKSB7DQogICAgICAgIGNvbGxlY3Rpb25zW2hhc2hTdHJpbmddID0gbmV3IFN0YXRzQ29sbGVjdGlvbigpOw0KICAgIH0NCiAgICByZXR1cm4gY29sbGVjdGlvbnNbaGFzaFN0cmluZ107DQp9DQpmdW5jdGlvbiBzdGF0c01hbmFnZXJHZXRPckNyZWF0ZVJlcG9ydGVyKHJlcG9JbmZvLCBjcmVhdG9yRnVuY3Rpb24pIHsNCiAgICBjb25zdCBoYXNoU3RyaW5nID0gcmVwb0luZm8udG9TdHJpbmcoKTsNCiAgICBpZiAoIXJlcG9ydGVyc1toYXNoU3RyaW5nXSkgew0KICAgICAgICByZXBvcnRlcnNbaGFzaFN0cmluZ10gPSBjcmVhdG9yRnVuY3Rpb24oKTsNCiAgICB9DQogICAgcmV0dXJuIHJlcG9ydGVyc1toYXNoU3RyaW5nXTsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogVGhpcyBjbGFzcyBlbnN1cmVzIHRoZSBwYWNrZXRzIGZyb20gdGhlIHNlcnZlciBhcnJpdmUgaW4gb3JkZXINCiAqIFRoaXMgY2xhc3MgdGFrZXMgZGF0YSBmcm9tIHRoZSBzZXJ2ZXIgYW5kIGVuc3VyZXMgaXQgZ2V0cyBwYXNzZWQgaW50byB0aGUgY2FsbGJhY2tzIGluIG9yZGVyLg0KICovDQpjbGFzcyBQYWNrZXRSZWNlaXZlciB7DQogICAgLyoqDQogICAgICogQHBhcmFtIG9uTWVzc2FnZV8NCiAgICAgKi8NCiAgICBjb25zdHJ1Y3Rvcihvbk1lc3NhZ2VfKSB7DQogICAgICAgIHRoaXMub25NZXNzYWdlXyA9IG9uTWVzc2FnZV87DQogICAgICAgIHRoaXMucGVuZGluZ1Jlc3BvbnNlcyA9IFtdOw0KICAgICAgICB0aGlzLmN1cnJlbnRSZXNwb25zZU51bSA9IDA7DQogICAgICAgIHRoaXMuY2xvc2VBZnRlclJlc3BvbnNlID0gLTE7DQogICAgICAgIHRoaXMub25DbG9zZSA9IG51bGw7DQogICAgfQ0KICAgIGNsb3NlQWZ0ZXIocmVzcG9uc2VOdW0sIGNhbGxiYWNrKSB7DQogICAgICAgIHRoaXMuY2xvc2VBZnRlclJlc3BvbnNlID0gcmVzcG9uc2VOdW07DQogICAgICAgIHRoaXMub25DbG9zZSA9IGNhbGxiYWNrOw0KICAgICAgICBpZiAodGhpcy5jbG9zZUFmdGVyUmVzcG9uc2UgPCB0aGlzLmN1cnJlbnRSZXNwb25zZU51bSkgew0KICAgICAgICAgICAgdGhpcy5vbkNsb3NlKCk7DQogICAgICAgICAgICB0aGlzLm9uQ2xvc2UgPSBudWxsOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEVhY2ggbWVzc2FnZSBmcm9tIHRoZSBzZXJ2ZXIgY29tZXMgd2l0aCBhIHJlc3BvbnNlIG51bWJlciwgYW5kIGFuIGFycmF5IG9mIGRhdGEuIFRoZSByZXNwb25zZU51bWJlcg0KICAgICAqIGFsbG93cyB1cyB0byBlbnN1cmUgdGhhdCB3ZSBwcm9jZXNzIHRoZW0gaW4gdGhlIHJpZ2h0IG9yZGVyLCBzaW5jZSB3ZSBjYW4ndCBiZSBndWFyYW50ZWVkIHRoYXQgYWxsDQogICAgICogYnJvd3NlcnMgd2lsbCByZXNwb25kIGluIHRoZSBzYW1lIG9yZGVyIGFzIHRoZSByZXF1ZXN0cyB3ZSBzZW50DQogICAgICovDQogICAgaGFuZGxlUmVzcG9uc2UocmVxdWVzdE51bSwgZGF0YSkgew0KICAgICAgICB0aGlzLnBlbmRpbmdSZXNwb25zZXNbcmVxdWVzdE51bV0gPSBkYXRhOw0KICAgICAgICB3aGlsZSAodGhpcy5wZW5kaW5nUmVzcG9uc2VzW3RoaXMuY3VycmVudFJlc3BvbnNlTnVtXSkgew0KICAgICAgICAgICAgY29uc3QgdG9Qcm9jZXNzID0gdGhpcy5wZW5kaW5nUmVzcG9uc2VzW3RoaXMuY3VycmVudFJlc3BvbnNlTnVtXTsNCiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnBlbmRpbmdSZXNwb25zZXNbdGhpcy5jdXJyZW50UmVzcG9uc2VOdW1dOw0KICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b1Byb2Nlc3MubGVuZ3RoOyArK2kpIHsNCiAgICAgICAgICAgICAgICBpZiAodG9Qcm9jZXNzW2ldKSB7DQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdGlvbkd1YXJkKCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25NZXNzYWdlXyh0b1Byb2Nlc3NbaV0pOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50UmVzcG9uc2VOdW0gPT09IHRoaXMuY2xvc2VBZnRlclJlc3BvbnNlKSB7DQogICAgICAgICAgICAgICAgaWYgKHRoaXMub25DbG9zZSkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLm9uQ2xvc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkNsb3NlID0gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLmN1cnJlbnRSZXNwb25zZU51bSsrOw0KICAgICAgICB9DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLy8gVVJMIHF1ZXJ5IHBhcmFtZXRlcnMgYXNzb2NpYXRlZCB3aXRoIGxvbmdwb2xsaW5nDQpjb25zdCBGSVJFQkFTRV9MT05HUE9MTF9TVEFSVF9QQVJBTSA9ICdzdGFydCc7DQpjb25zdCBGSVJFQkFTRV9MT05HUE9MTF9DTE9TRV9DT01NQU5EID0gJ2Nsb3NlJzsNCmNvbnN0IEZJUkVCQVNFX0xPTkdQT0xMX0NPTU1BTkRfQ0JfTkFNRSA9ICdwTFBDb21tYW5kJzsNCmNvbnN0IEZJUkVCQVNFX0xPTkdQT0xMX0RBVEFfQ0JfTkFNRSA9ICdwUlRMUENCJzsNCmNvbnN0IEZJUkVCQVNFX0xPTkdQT0xMX0lEX1BBUkFNID0gJ2lkJzsNCmNvbnN0IEZJUkVCQVNFX0xPTkdQT0xMX1BXX1BBUkFNID0gJ3B3JzsNCmNvbnN0IEZJUkVCQVNFX0xPTkdQT0xMX1NFUklBTF9QQVJBTSA9ICdzZXInOw0KY29uc3QgRklSRUJBU0VfTE9OR1BPTExfQ0FMTEJBQ0tfSURfUEFSQU0gPSAnY2InOw0KY29uc3QgRklSRUJBU0VfTE9OR1BPTExfU0VHTUVOVF9OVU1fUEFSQU0gPSAnc2VnJzsNCmNvbnN0IEZJUkVCQVNFX0xPTkdQT0xMX1NFR01FTlRTX0lOX1BBQ0tFVCA9ICd0cyc7DQpjb25zdCBGSVJFQkFTRV9MT05HUE9MTF9EQVRBX1BBUkFNID0gJ2QnOw0KY29uc3QgRklSRUJBU0VfTE9OR1BPTExfRElTQ09OTl9GUkFNRV9SRVFVRVNUX1BBUkFNID0gJ2RmcmFtZSc7DQovL0RhdGEgc2l6ZSBjb25zdGFudHMuDQovL1RPRE86IFBlcmY6IHRoZSBtYXhpbXVtIGxlbmd0aCBhY3R1YWxseSBkaWZmZXJzIGZyb20gYnJvd3NlciB0byBicm93c2VyLg0KLy8gV2Ugc2hvdWxkIGNoZWNrIHdoYXQgYnJvd3NlciB3ZSdyZSBvbiBhbmQgc2V0IGFjY29yZGluZ2x5Lg0KY29uc3QgTUFYX1VSTF9EQVRBX1NJWkUgPSAxODcwOw0KY29uc3QgU0VHX0hFQURFUl9TSVpFID0gMzA7IC8vaWU6ICZzZWc9ODI5OTIzNCZ0cz05ODIzODkxMjMmZD0NCmNvbnN0IE1BWF9QQVlMT0FEX1NJWkUgPSBNQVhfVVJMX0RBVEFfU0laRSAtIFNFR19IRUFERVJfU0laRTsNCi8qKg0KICogS2VlcGFsaXZlIHBlcmlvZA0KICogc2VuZCBhIGZyZXNoIHJlcXVlc3QgYXQgbWluaW11bSBldmVyeSAyNSBzZWNvbmRzLiBPcGVyYSBoYXMgYSBtYXhpbXVtIHJlcXVlc3QNCiAqIGxlbmd0aCBvZiAzMCBzZWNvbmRzIHRoYXQgd2UgY2FuJ3QgZXhjZWVkLg0KICovDQpjb25zdCBLRUVQQUxJVkVfUkVRVUVTVF9JTlRFUlZBTCA9IDI1MDAwOw0KLyoqDQogKiBIb3cgbG9uZyB0byB3YWl0IGJlZm9yZSBhYm9ydGluZyBhIGxvbmctcG9sbGluZyBjb25uZWN0aW9uIGF0dGVtcHQuDQogKi8NCmNvbnN0IExQX0NPTk5FQ1RfVElNRU9VVCA9IDMwMDAwOw0KLyoqDQogKiBUaGlzIGNsYXNzIG1hbmFnZXMgYSBzaW5nbGUgbG9uZy1wb2xsaW5nIGNvbm5lY3Rpb24uDQogKi8NCmNsYXNzIEJyb3dzZXJQb2xsQ29ubmVjdGlvbiB7DQogICAgLyoqDQogICAgICogQHBhcmFtIGNvbm5JZCBBbiBpZGVudGlmaWVyIGZvciB0aGlzIGNvbm5lY3Rpb24sIHVzZWQgZm9yIGxvZ2dpbmcNCiAgICAgKiBAcGFyYW0gcmVwb0luZm8gVGhlIGluZm8gZm9yIHRoZSBlbmRwb2ludCB0byBzZW5kIGRhdGEgdG8uDQogICAgICogQHBhcmFtIGFwcGxpY2F0aW9uSWQgVGhlIEZpcmViYXNlIEFwcCBJRCBmb3IgdGhpcyBwcm9qZWN0Lg0KICAgICAqIEBwYXJhbSBhcHBDaGVja1Rva2VuIFRoZSBBcHBDaGVjayB0b2tlbiBmb3IgdGhpcyBjbGllbnQuDQogICAgICogQHBhcmFtIGF1dGhUb2tlbiBUaGUgQXV0aFRva2VuIHRvIHVzZSBmb3IgdGhpcyBjb25uZWN0aW9uLg0KICAgICAqIEBwYXJhbSB0cmFuc3BvcnRTZXNzaW9uSWQgT3B0aW9uYWwgdHJhbnNwb3J0U2Vzc2lvbmlkIGlmIHdlIGFyZQ0KICAgICAqIHJlY29ubmVjdGluZyBmb3IgYW4gZXhpc3RpbmcgdHJhbnNwb3J0IHNlc3Npb24NCiAgICAgKiBAcGFyYW0gbGFzdFNlc3Npb25JZCBPcHRpb25hbCBsYXN0U2Vzc2lvbklkIGlmIHRoZSBQZXJzaXN0ZW50Q29ubmVjdGlvbiBoYXMNCiAgICAgKiBhbHJlYWR5IGNyZWF0ZWQgYSBjb25uZWN0aW9uIHByZXZpb3VzbHkNCiAgICAgKi8NCiAgICBjb25zdHJ1Y3Rvcihjb25uSWQsIHJlcG9JbmZvLCBhcHBsaWNhdGlvbklkLCBhcHBDaGVja1Rva2VuLCBhdXRoVG9rZW4sIHRyYW5zcG9ydFNlc3Npb25JZCwgbGFzdFNlc3Npb25JZCkgew0KICAgICAgICB0aGlzLmNvbm5JZCA9IGNvbm5JZDsNCiAgICAgICAgdGhpcy5yZXBvSW5mbyA9IHJlcG9JbmZvOw0KICAgICAgICB0aGlzLmFwcGxpY2F0aW9uSWQgPSBhcHBsaWNhdGlvbklkOw0KICAgICAgICB0aGlzLmFwcENoZWNrVG9rZW4gPSBhcHBDaGVja1Rva2VuOw0KICAgICAgICB0aGlzLmF1dGhUb2tlbiA9IGF1dGhUb2tlbjsNCiAgICAgICAgdGhpcy50cmFuc3BvcnRTZXNzaW9uSWQgPSB0cmFuc3BvcnRTZXNzaW9uSWQ7DQogICAgICAgIHRoaXMubGFzdFNlc3Npb25JZCA9IGxhc3RTZXNzaW9uSWQ7DQogICAgICAgIHRoaXMuYnl0ZXNTZW50ID0gMDsNCiAgICAgICAgdGhpcy5ieXRlc1JlY2VpdmVkID0gMDsNCiAgICAgICAgdGhpcy5ldmVyQ29ubmVjdGVkXyA9IGZhbHNlOw0KICAgICAgICB0aGlzLmxvZ18gPSBsb2dXcmFwcGVyKGNvbm5JZCk7DQogICAgICAgIHRoaXMuc3RhdHNfID0gc3RhdHNNYW5hZ2VyR2V0Q29sbGVjdGlvbihyZXBvSW5mbyk7DQogICAgICAgIHRoaXMudXJsRm4gPSAocGFyYW1zKSA9PiB7DQogICAgICAgICAgICAvLyBBbHdheXMgYWRkIHRoZSB0b2tlbiBpZiB3ZSBoYXZlIG9uZS4NCiAgICAgICAgICAgIGlmICh0aGlzLmFwcENoZWNrVG9rZW4pIHsNCiAgICAgICAgICAgICAgICBwYXJhbXNbQVBQX0NIRUNLX1RPS0VOX1BBUkFNXSA9IHRoaXMuYXBwQ2hlY2tUb2tlbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiByZXBvSW5mb0Nvbm5lY3Rpb25VUkwocmVwb0luZm8sIExPTkdfUE9MTElORywgcGFyYW1zKTsNCiAgICAgICAgfTsNCiAgICB9DQogICAgLyoqDQogICAgICogQHBhcmFtIG9uTWVzc2FnZSAtIENhbGxiYWNrIHdoZW4gbWVzc2FnZXMgYXJyaXZlDQogICAgICogQHBhcmFtIG9uRGlzY29ubmVjdCAtIENhbGxiYWNrIHdpdGggY29ubmVjdGlvbiBsb3N0Lg0KICAgICAqLw0KICAgIG9wZW4ob25NZXNzYWdlLCBvbkRpc2Nvbm5lY3QpIHsNCiAgICAgICAgdGhpcy5jdXJTZWdtZW50TnVtID0gMDsNCiAgICAgICAgdGhpcy5vbkRpc2Nvbm5lY3RfID0gb25EaXNjb25uZWN0Ow0KICAgICAgICB0aGlzLm15UGFja2V0T3JkZXJlciA9IG5ldyBQYWNrZXRSZWNlaXZlcihvbk1lc3NhZ2UpOw0KICAgICAgICB0aGlzLmlzQ2xvc2VkXyA9IGZhbHNlOw0KICAgICAgICB0aGlzLmNvbm5lY3RUaW1lb3V0VGltZXJfID0gc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICB0aGlzLmxvZ18oJ1RpbWVkIG91dCB0cnlpbmcgdG8gY29ubmVjdC4nKTsNCiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB3ZSBjbGVhciB0aGUgaG9zdCBjYWNoZQ0KICAgICAgICAgICAgdGhpcy5vbkNsb3NlZF8oKTsNCiAgICAgICAgICAgIHRoaXMuY29ubmVjdFRpbWVvdXRUaW1lcl8gPSBudWxsOw0KICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgfSwgTWF0aC5mbG9vcihMUF9DT05ORUNUX1RJTUVPVVQpKTsNCiAgICAgICAgLy8gRW5zdXJlIHdlIGRlbGF5IHRoZSBjcmVhdGlvbiBvZiB0aGUgaWZyYW1lIHVudGlsIHRoZSBET00gaXMgbG9hZGVkLg0KICAgICAgICBleGVjdXRlV2hlbkRPTVJlYWR5KCgpID0+IHsNCiAgICAgICAgICAgIGlmICh0aGlzLmlzQ2xvc2VkXykgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vU2V0IHVwIGEgY2FsbGJhY2sgdGhhdCBnZXRzIHRyaWdnZXJlZCBvbmNlIGEgY29ubmVjdGlvbiBpcyBzZXQgdXAuDQogICAgICAgICAgICB0aGlzLnNjcmlwdFRhZ0hvbGRlciA9IG5ldyBGaXJlYmFzZUlGcmFtZVNjcmlwdEhvbGRlcigoLi4uYXJncykgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IFtjb21tYW5kLCBhcmcxLCBhcmcyLCBhcmczLCBhcmc0XSA9IGFyZ3M7DQogICAgICAgICAgICAgICAgdGhpcy5pbmNyZW1lbnRJbmNvbWluZ0J5dGVzXyhhcmdzKTsNCiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuc2NyaXB0VGFnSG9sZGVyKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsgLy8gd2UgY2xvc2VkIHRoZSBjb25uZWN0aW9uLg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb25uZWN0VGltZW91dFRpbWVyXykgew0KICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5jb25uZWN0VGltZW91dFRpbWVyXyk7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdFRpbWVvdXRUaW1lcl8gPSBudWxsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB0aGlzLmV2ZXJDb25uZWN0ZWRfID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBpZiAoY29tbWFuZCA9PT0gRklSRUJBU0VfTE9OR1BPTExfU1RBUlRfUEFSQU0pIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5pZCA9IGFyZzE7DQogICAgICAgICAgICAgICAgICAgIHRoaXMucGFzc3dvcmQgPSBhcmcyOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChjb21tYW5kID09PSBGSVJFQkFTRV9MT05HUE9MTF9DTE9TRV9DT01NQU5EKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIERvbid0IGNsZWFyIHRoZSBob3N0IGNhY2hlLiBXZSBnb3QgYSByZXNwb25zZSBmcm9tIHRoZSBzZXJ2ZXIsIHNvIHdlIGtub3cgaXQncyByZWFjaGFibGUNCiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZzEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlIGFyZW4ndCBleHBlY3RpbmcgYW55IG1vcmUgZGF0YSAob3RoZXIgdGhhbiB3aGF0IHRoZSBzZXJ2ZXIncyBhbHJlYWR5IGluIHRoZSBwcm9jZXNzIG9mIHNlbmRpbmcgdXMNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRocm91Z2ggb3VyIGFscmVhZHkgb3BlbiBwb2xscyksIHNvIGRvbid0IHNlbmQgYW55IG1vcmUuDQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNjcmlwdFRhZ0hvbGRlci5zZW5kTmV3UG9sbHMgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFyZzEgaW4gdGhpcyBjYXNlIGlzIHRoZSBsYXN0IHJlc3BvbnNlIG51bWJlciBzZW50IGJ5IHRoZSBzZXJ2ZXIuIFdlIHNob3VsZCB0cnkgdG8gcmVjZWl2ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWxsIG9mIHRoZSByZXNwb25zZXMgdXAgdG8gdGhpcyBvbmUgYmVmb3JlIGNsb3NpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubXlQYWNrZXRPcmRlcmVyLmNsb3NlQWZ0ZXIoYXJnMSwgKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25DbG9zZWRfKCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25DbG9zZWRfKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5yZWNvZ25pemVkIGNvbW1hbmQgcmVjZWl2ZWQ6ICcgKyBjb21tYW5kKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LCAoLi4uYXJncykgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IFtwTiwgZGF0YV0gPSBhcmdzOw0KICAgICAgICAgICAgICAgIHRoaXMuaW5jcmVtZW50SW5jb21pbmdCeXRlc18oYXJncyk7DQogICAgICAgICAgICAgICAgdGhpcy5teVBhY2tldE9yZGVyZXIuaGFuZGxlUmVzcG9uc2UocE4sIGRhdGEpOw0KICAgICAgICAgICAgfSwgKCkgPT4gew0KICAgICAgICAgICAgICAgIHRoaXMub25DbG9zZWRfKCk7DQogICAgICAgICAgICB9LCB0aGlzLnVybEZuKTsNCiAgICAgICAgICAgIC8vU2VuZCB0aGUgaW5pdGlhbCByZXF1ZXN0IHRvIGNvbm5lY3QuIFRoZSBzZXJpYWwgbnVtYmVyIGlzIHNpbXBseSB0byBrZWVwIHRoZSBicm93c2VyIGZyb20gcHVsbGluZyBwcmV2aW91cyByZXN1bHRzDQogICAgICAgICAgICAvL2Zyb20gY2FjaGUuDQogICAgICAgICAgICBjb25zdCB1cmxQYXJhbXMgPSB7fTsNCiAgICAgICAgICAgIHVybFBhcmFtc1tGSVJFQkFTRV9MT05HUE9MTF9TVEFSVF9QQVJBTV0gPSAndCc7DQogICAgICAgICAgICB1cmxQYXJhbXNbRklSRUJBU0VfTE9OR1BPTExfU0VSSUFMX1BBUkFNXSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwMDAwMCk7DQogICAgICAgICAgICBpZiAodGhpcy5zY3JpcHRUYWdIb2xkZXIudW5pcXVlQ2FsbGJhY2tJZGVudGlmaWVyKSB7DQogICAgICAgICAgICAgICAgdXJsUGFyYW1zW0ZJUkVCQVNFX0xPTkdQT0xMX0NBTExCQUNLX0lEX1BBUkFNXSA9DQogICAgICAgICAgICAgICAgICAgIHRoaXMuc2NyaXB0VGFnSG9sZGVyLnVuaXF1ZUNhbGxiYWNrSWRlbnRpZmllcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHVybFBhcmFtc1tWRVJTSU9OX1BBUkFNXSA9IFBST1RPQ09MX1ZFUlNJT047DQogICAgICAgICAgICBpZiAodGhpcy50cmFuc3BvcnRTZXNzaW9uSWQpIHsNCiAgICAgICAgICAgICAgICB1cmxQYXJhbXNbVFJBTlNQT1JUX1NFU1NJT05fUEFSQU1dID0gdGhpcy50cmFuc3BvcnRTZXNzaW9uSWQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodGhpcy5sYXN0U2Vzc2lvbklkKSB7DQogICAgICAgICAgICAgICAgdXJsUGFyYW1zW0xBU1RfU0VTU0lPTl9QQVJBTV0gPSB0aGlzLmxhc3RTZXNzaW9uSWQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodGhpcy5hcHBsaWNhdGlvbklkKSB7DQogICAgICAgICAgICAgICAgdXJsUGFyYW1zW0FQUExJQ0FUSU9OX0lEX1BBUkFNXSA9IHRoaXMuYXBwbGljYXRpb25JZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICh0aGlzLmFwcENoZWNrVG9rZW4pIHsNCiAgICAgICAgICAgICAgICB1cmxQYXJhbXNbQVBQX0NIRUNLX1RPS0VOX1BBUkFNXSA9IHRoaXMuYXBwQ2hlY2tUb2tlbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICh0eXBlb2YgbG9jYXRpb24gIT09ICd1bmRlZmluZWQnICYmDQogICAgICAgICAgICAgICAgbG9jYXRpb24uaG9zdG5hbWUgJiYNCiAgICAgICAgICAgICAgICBGT1JHRV9ET01BSU5fUkUudGVzdChsb2NhdGlvbi5ob3N0bmFtZSkpIHsNCiAgICAgICAgICAgICAgICB1cmxQYXJhbXNbUkVGRVJFUl9QQVJBTV0gPSBGT1JHRV9SRUY7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBjb25uZWN0VVJMID0gdGhpcy51cmxGbih1cmxQYXJhbXMpOw0KICAgICAgICAgICAgdGhpcy5sb2dfKCdDb25uZWN0aW5nIHZpYSBsb25nLXBvbGwgdG8gJyArIGNvbm5lY3RVUkwpOw0KICAgICAgICAgICAgdGhpcy5zY3JpcHRUYWdIb2xkZXIuYWRkVGFnKGNvbm5lY3RVUkwsICgpID0+IHsNCiAgICAgICAgICAgICAgICAvKiBkbyBub3RoaW5nICovDQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIENhbGwgdGhpcyB3aGVuIGEgaGFuZHNoYWtlIGhhcyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5IGFuZCB3ZSB3YW50IHRvIGNvbnNpZGVyIHRoZSBjb25uZWN0aW9uIGVzdGFibGlzaGVkDQogICAgICovDQogICAgc3RhcnQoKSB7DQogICAgICAgIHRoaXMuc2NyaXB0VGFnSG9sZGVyLnN0YXJ0TG9uZ1BvbGwodGhpcy5pZCwgdGhpcy5wYXNzd29yZCk7DQogICAgICAgIHRoaXMuYWRkRGlzY29ubmVjdFBpbmdGcmFtZSh0aGlzLmlkLCB0aGlzLnBhc3N3b3JkKTsNCiAgICB9DQogICAgLyoqDQogICAgICogRm9yY2VzIGxvbmcgcG9sbGluZyB0byBiZSBjb25zaWRlcmVkIGFzIGEgcG90ZW50aWFsIHRyYW5zcG9ydA0KICAgICAqLw0KICAgIHN0YXRpYyBmb3JjZUFsbG93KCkgew0KICAgICAgICBCcm93c2VyUG9sbENvbm5lY3Rpb24uZm9yY2VBbGxvd18gPSB0cnVlOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBGb3JjZXMgbG9uZ3BvbGxpbmcgdG8gbm90IGJlIGNvbnNpZGVyZWQgYXMgYSBwb3RlbnRpYWwgdHJhbnNwb3J0DQogICAgICovDQogICAgc3RhdGljIGZvcmNlRGlzYWxsb3coKSB7DQogICAgICAgIEJyb3dzZXJQb2xsQ29ubmVjdGlvbi5mb3JjZURpc2FsbG93XyA9IHRydWU7DQogICAgfQ0KICAgIC8vIFN0YXRpYyBtZXRob2QsIHVzZSBzdHJpbmcgbGl0ZXJhbCBzbyBpdCBjYW4gYmUgYWNjZXNzZWQgaW4gYSBnZW5lcmljIHdheQ0KICAgIHN0YXRpYyBpc0F2YWlsYWJsZSgpIHsNCiAgICAgICAgaWYgKEJyb3dzZXJQb2xsQ29ubmVjdGlvbi5mb3JjZUFsbG93Xykgew0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAvLyBOT1RFOiBJbiBSZWFjdC1OYXRpdmUgdGhlcmUncyBub3JtYWxseSBubyAnZG9jdW1lbnQnLCBidXQgaWYgeW91IGRlYnVnIGEgUmVhY3QtTmF0aXZlIGFwcCBpbg0KICAgICAgICAgICAgLy8gdGhlIENocm9tZSBkZWJ1Z2dlciwgJ2RvY3VtZW50JyBpcyBkZWZpbmVkLCBidXQgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCBpcyBudWxsICgyMDE1LzA2LzA4KS4NCiAgICAgICAgICAgIHJldHVybiAoIUJyb3dzZXJQb2xsQ29ubmVjdGlvbi5mb3JjZURpc2FsbG93XyAmJg0KICAgICAgICAgICAgICAgIHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcgJiYNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5jcmVhdGVFbGVtZW50ICE9IG51bGwgJiYNCiAgICAgICAgICAgICAgICAhaXNDaHJvbWVFeHRlbnNpb25Db250ZW50U2NyaXB0KCkgJiYNCiAgICAgICAgICAgICAgICAhaXNXaW5kb3dzU3RvcmVBcHAoKSk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogTm8tb3AgZm9yIHBvbGxpbmcNCiAgICAgKi8NCiAgICBtYXJrQ29ubmVjdGlvbkhlYWx0aHkoKSB7IH0NCiAgICAvKioNCiAgICAgKiBTdG9wcyBwb2xsaW5nIGFuZCBjbGVhbnMgdXAgdGhlIGlmcmFtZQ0KICAgICAqLw0KICAgIHNodXRkb3duXygpIHsNCiAgICAgICAgdGhpcy5pc0Nsb3NlZF8gPSB0cnVlOw0KICAgICAgICBpZiAodGhpcy5zY3JpcHRUYWdIb2xkZXIpIHsNCiAgICAgICAgICAgIHRoaXMuc2NyaXB0VGFnSG9sZGVyLmNsb3NlKCk7DQogICAgICAgICAgICB0aGlzLnNjcmlwdFRhZ0hvbGRlciA9IG51bGw7DQogICAgICAgIH0NCiAgICAgICAgLy9yZW1vdmUgdGhlIGRpc2Nvbm5lY3QgZnJhbWUsIHdoaWNoIHdpbGwgdHJpZ2dlciBhbiBYSFIgY2FsbCB0byB0aGUgc2VydmVyIHRvIHRlbGwgaXQgd2UncmUgbGVhdmluZy4NCiAgICAgICAgaWYgKHRoaXMubXlEaXNjb25uRnJhbWUpIHsNCiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5teURpc2Nvbm5GcmFtZSk7DQogICAgICAgICAgICB0aGlzLm15RGlzY29ubkZyYW1lID0gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodGhpcy5jb25uZWN0VGltZW91dFRpbWVyXykgew0KICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuY29ubmVjdFRpbWVvdXRUaW1lcl8pOw0KICAgICAgICAgICAgdGhpcy5jb25uZWN0VGltZW91dFRpbWVyXyA9IG51bGw7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogVHJpZ2dlcmVkIHdoZW4gdGhpcyB0cmFuc3BvcnQgaXMgY2xvc2VkDQogICAgICovDQogICAgb25DbG9zZWRfKCkgew0KICAgICAgICBpZiAoIXRoaXMuaXNDbG9zZWRfKSB7DQogICAgICAgICAgICB0aGlzLmxvZ18oJ0xvbmdwb2xsIGlzIGNsb3NpbmcgaXRzZWxmJyk7DQogICAgICAgICAgICB0aGlzLnNodXRkb3duXygpOw0KICAgICAgICAgICAgaWYgKHRoaXMub25EaXNjb25uZWN0Xykgew0KICAgICAgICAgICAgICAgIHRoaXMub25EaXNjb25uZWN0Xyh0aGlzLmV2ZXJDb25uZWN0ZWRfKTsNCiAgICAgICAgICAgICAgICB0aGlzLm9uRGlzY29ubmVjdF8gPSBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEV4dGVybmFsLWZhY2luZyBjbG9zZSBoYW5kbGVyLiBSZWFsVGltZSBoYXMgcmVxdWVzdGVkIHdlIHNodXQgZG93bi4gS2lsbCBvdXIgY29ubmVjdGlvbiBhbmQgdGVsbCB0aGUgc2VydmVyDQogICAgICogdGhhdCB3ZSd2ZSBsZWZ0Lg0KICAgICAqLw0KICAgIGNsb3NlKCkgew0KICAgICAgICBpZiAoIXRoaXMuaXNDbG9zZWRfKSB7DQogICAgICAgICAgICB0aGlzLmxvZ18oJ0xvbmdwb2xsIGlzIGJlaW5nIGNsb3NlZC4nKTsNCiAgICAgICAgICAgIHRoaXMuc2h1dGRvd25fKCk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogU2VuZCB0aGUgSlNPTiBvYmplY3QgZG93biB0byB0aGUgc2VydmVyLiBJdCB3aWxsIG5lZWQgdG8gYmUgc3RyaW5naWZpZWQsIGJhc2U2NCBlbmNvZGVkLCBhbmQgdGhlbg0KICAgICAqIGJyb2tlbiBpbnRvIGNodW5rcyAoc2luY2UgVVJMcyBoYXZlIGEgc21hbGwgbWF4aW11bSBsZW5ndGgpLg0KICAgICAqIEBwYXJhbSBkYXRhIC0gVGhlIEpTT04gZGF0YSB0byB0cmFuc21pdC4NCiAgICAgKi8NCiAgICBzZW5kKGRhdGEpIHsNCiAgICAgICAgY29uc3QgZGF0YVN0ciA9IHN0cmluZ2lmeShkYXRhKTsNCiAgICAgICAgdGhpcy5ieXRlc1NlbnQgKz0gZGF0YVN0ci5sZW5ndGg7DQogICAgICAgIHRoaXMuc3RhdHNfLmluY3JlbWVudENvdW50ZXIoJ2J5dGVzX3NlbnQnLCBkYXRhU3RyLmxlbmd0aCk7DQogICAgICAgIC8vZmlyc3QsIGxldHMgZ2V0IHRoZSBiYXNlNjQtZW5jb2RlZCBkYXRhDQogICAgICAgIGNvbnN0IGJhc2U2NGRhdGEgPSBiYXNlNjRFbmNvZGUoZGF0YVN0cik7DQogICAgICAgIC8vV2UgY2FuIG9ubHkgZml0IGEgY2VydGFpbiBhbW91bnQgaW4gZWFjaCBVUkwsIHNvIHdlIG5lZWQgdG8gc3BsaXQgdGhpcyByZXF1ZXN0DQogICAgICAgIC8vdXAgaW50byBtdWx0aXBsZSBwaWVjZXMgaWYgaXQgZG9lc24ndCBmaXQgaW4gb25lIHJlcXVlc3QuDQogICAgICAgIGNvbnN0IGRhdGFTZWdzID0gc3BsaXRTdHJpbmdCeVNpemUoYmFzZTY0ZGF0YSwgTUFYX1BBWUxPQURfU0laRSk7DQogICAgICAgIC8vRW5xdWV1ZSBlYWNoIHNlZ21lbnQgZm9yIHRyYW5zbWlzc2lvbi4gV2UgYXNzaWduIGVhY2ggY2h1bmsgYSBzZXF1ZW50aWFsIElEIGFuZCBhIHRvdGFsIG51bWJlcg0KICAgICAgICAvL29mIHNlZ21lbnRzIHNvIHRoYXQgd2UgY2FuIHJlYXNzZW1ibGUgdGhlIHBhY2tldCBvbiB0aGUgc2VydmVyLg0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGFTZWdzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICB0aGlzLnNjcmlwdFRhZ0hvbGRlci5lbnF1ZXVlU2VnbWVudCh0aGlzLmN1clNlZ21lbnROdW0sIGRhdGFTZWdzLmxlbmd0aCwgZGF0YVNlZ3NbaV0pOw0KICAgICAgICAgICAgdGhpcy5jdXJTZWdtZW50TnVtKys7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogVGhpcyBpcyBob3cgd2Ugbm90aWZ5IHRoZSBzZXJ2ZXIgdGhhdCB3ZSdyZSBsZWF2aW5nLg0KICAgICAqIFdlIGFyZW4ndCBhYmxlIHRvIHNlbmQgcmVxdWVzdHMgd2l0aCBESFRNTCBvbiBhIHdpbmRvdyBjbG9zZSBldmVudCwgYnV0IHdlIGNhbg0KICAgICAqIHRyaWdnZXIgWEhSIHJlcXVlc3RzIGluIHNvbWUgYnJvd3NlcnMgKGV2ZXJ5dGhpbmcgYnV0IE9wZXJhIGJhc2ljYWxseSkuDQogICAgICovDQogICAgYWRkRGlzY29ubmVjdFBpbmdGcmFtZShpZCwgcHcpIHsNCiAgICAgICAgdGhpcy5teURpc2Nvbm5GcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpOw0KICAgICAgICBjb25zdCB1cmxQYXJhbXMgPSB7fTsNCiAgICAgICAgdXJsUGFyYW1zW0ZJUkVCQVNFX0xPTkdQT0xMX0RJU0NPTk5fRlJBTUVfUkVRVUVTVF9QQVJBTV0gPSAndCc7DQogICAgICAgIHVybFBhcmFtc1tGSVJFQkFTRV9MT05HUE9MTF9JRF9QQVJBTV0gPSBpZDsNCiAgICAgICAgdXJsUGFyYW1zW0ZJUkVCQVNFX0xPTkdQT0xMX1BXX1BBUkFNXSA9IHB3Ow0KICAgICAgICB0aGlzLm15RGlzY29ubkZyYW1lLnNyYyA9IHRoaXMudXJsRm4odXJsUGFyYW1zKTsNCiAgICAgICAgdGhpcy5teURpc2Nvbm5GcmFtZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMubXlEaXNjb25uRnJhbWUpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBVc2VkIHRvIHRyYWNrIHRoZSBieXRlcyByZWNlaXZlZCBieSB0aGlzIGNsaWVudA0KICAgICAqLw0KICAgIGluY3JlbWVudEluY29taW5nQnl0ZXNfKGFyZ3MpIHsNCiAgICAgICAgLy8gVE9ETzogVGhpcyBpcyBhbiBhbm5veWluZyBwZXJmIGhpdCBqdXN0IHRvIHRyYWNrIHRoZSBudW1iZXIgb2YgaW5jb21pbmcgYnl0ZXMuICBNYXliZSBpdCBzaG91bGQgYmUgb3B0LWluLg0KICAgICAgICBjb25zdCBieXRlc1JlY2VpdmVkID0gc3RyaW5naWZ5KGFyZ3MpLmxlbmd0aDsNCiAgICAgICAgdGhpcy5ieXRlc1JlY2VpdmVkICs9IGJ5dGVzUmVjZWl2ZWQ7DQogICAgICAgIHRoaXMuc3RhdHNfLmluY3JlbWVudENvdW50ZXIoJ2J5dGVzX3JlY2VpdmVkJywgYnl0ZXNSZWNlaXZlZCk7DQogICAgfQ0KfQ0KLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICogQSB3cmFwcGVyIGFyb3VuZCBhbiBpZnJhbWUgdGhhdCBpcyB1c2VkIGFzIGEgbG9uZy1wb2xsaW5nIHNjcmlwdCBob2xkZXIuDQogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KY2xhc3MgRmlyZWJhc2VJRnJhbWVTY3JpcHRIb2xkZXIgew0KICAgIC8qKg0KICAgICAqIEBwYXJhbSBjb21tYW5kQ0IgLSBUaGUgY2FsbGJhY2sgdG8gYmUgY2FsbGVkIHdoZW4gY29udHJvbCBjb21tYW5kcyBhcmUgcmVjZXZpZWQgZnJvbSB0aGUgc2VydmVyLg0KICAgICAqIEBwYXJhbSBvbk1lc3NhZ2VDQiAtIFRoZSBjYWxsYmFjayB0byBiZSB0cmlnZ2VyZWQgd2hlbiByZXNwb25zZXMgYXJyaXZlIGZyb20gdGhlIHNlcnZlci4NCiAgICAgKiBAcGFyYW0gb25EaXNjb25uZWN0IC0gVGhlIGNhbGxiYWNrIHRvIGJlIHRyaWdnZXJlZCB3aGVuIHRoaXMgdGFnIGhvbGRlciBpcyBjbG9zZWQNCiAgICAgKiBAcGFyYW0gdXJsRm4gLSBBIGZ1bmN0aW9uIHRoYXQgcHJvdmlkZXMgdGhlIFVSTCBvZiB0aGUgZW5kcG9pbnQgdG8gc2VuZCBkYXRhIHRvLg0KICAgICAqLw0KICAgIGNvbnN0cnVjdG9yKGNvbW1hbmRDQiwgb25NZXNzYWdlQ0IsIG9uRGlzY29ubmVjdCwgdXJsRm4pIHsNCiAgICAgICAgdGhpcy5vbkRpc2Nvbm5lY3QgPSBvbkRpc2Nvbm5lY3Q7DQogICAgICAgIHRoaXMudXJsRm4gPSB1cmxGbjsNCiAgICAgICAgLy9XZSBtYWludGFpbiBhIGNvdW50IG9mIGFsbCBvZiB0aGUgb3V0c3RhbmRpbmcgcmVxdWVzdHMsIGJlY2F1c2UgaWYgd2UgaGF2ZSB0b28gbWFueSBhY3RpdmUgYXQgb25jZSBpdCBjYW4gY2F1c2UNCiAgICAgICAgLy9wcm9ibGVtcyBpbiBzb21lIGJyb3dzZXJzLg0KICAgICAgICB0aGlzLm91dHN0YW5kaW5nUmVxdWVzdHMgPSBuZXcgU2V0KCk7DQogICAgICAgIC8vQSBxdWV1ZSBvZiB0aGUgcGVuZGluZyBzZWdtZW50cyB3YWl0aW5nIGZvciB0cmFuc21pc3Npb24gdG8gdGhlIHNlcnZlci4NCiAgICAgICAgdGhpcy5wZW5kaW5nU2VncyA9IFtdOw0KICAgICAgICAvL0Egc2VyaWFsIG51bWJlci4gV2UgdXNlIHRoaXMgZm9yIHR3byB0aGluZ3M6DQogICAgICAgIC8vIDEpIEEgd2F5IHRvIGVuc3VyZSB0aGUgYnJvd3NlciBkb2Vzbid0IGNhY2hlIHJlc3BvbnNlcyB0byBwb2xscw0KICAgICAgICAvLyAyKSBBIHdheSB0byBtYWtlIHRoZSBzZXJ2ZXIgYXdhcmUgd2hlbiBsb25nLXBvbGxzIGFycml2ZSBpbiBhIGRpZmZlcmVudCBvcmRlciB0aGFuIHdlIHN0YXJ0ZWQgdGhlbS4gVGhlDQogICAgICAgIC8vICAgIHNlcnZlciBuZWVkcyB0byByZWxlYXNlIGJvdGggcG9sbHMgaW4gdGhpcyBjYXNlIG9yIGl0IHdpbGwgY2F1c2UgcHJvYmxlbXMgaW4gT3BlcmEgc2luY2UgT3BlcmEgY2FuIG9ubHkgZXhlY3V0ZQ0KICAgICAgICAvLyAgICBKU09OUCBjb2RlIGluIHRoZSBvcmRlciBpdCB3YXMgYWRkZWQgdG8gdGhlIGlmcmFtZS4NCiAgICAgICAgdGhpcy5jdXJyZW50U2VyaWFsID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDAwMDAwKTsNCiAgICAgICAgLy8gVGhpcyBnZXRzIHNldCB0byBmYWxzZSB3aGVuIHdlJ3JlICJjbG9zaW5nIGRvd24iIHRoZSBjb25uZWN0aW9uIChlLmcuIHdlJ3JlIHN3aXRjaGluZyB0cmFuc3BvcnRzIGJ1dCB0aGVyZSdzIHN0aWxsDQogICAgICAgIC8vIGluY29taW5nIGRhdGEgZnJvbSB0aGUgc2VydmVyIHRoYXQgd2UncmUgd2FpdGluZyBmb3IpLg0KICAgICAgICB0aGlzLnNlbmROZXdQb2xscyA9IHRydWU7DQogICAgICAgIHsNCiAgICAgICAgICAgIC8vRWFjaCBzY3JpcHQgaG9sZGVyIHJlZ2lzdGVycyBhIGNvdXBsZSBvZiB1bmlxdWVseSBuYW1lZCBjYWxsYmFja3Mgd2l0aCB0aGUgd2luZG93LiBUaGVzZSBhcmUgY2FsbGVkIGZyb20gdGhlDQogICAgICAgICAgICAvL2lmcmFtZXMgd2hlcmUgd2UgcHV0IHRoZSBsb25nLXBvbGxpbmcgc2NyaXB0IHRhZ3MuIFdlIGhhdmUgdHdvIGNhbGxiYWNrczoNCiAgICAgICAgICAgIC8vICAgMSkgQ29tbWFuZCBDYWxsYmFjayAtIFRyaWdnZXJlZCBmb3IgY29udHJvbCBpc3N1ZXMsIGxpa2Ugc3RhcnRpbmcgYSBjb25uZWN0aW9uLg0KICAgICAgICAgICAgLy8gICAyKSBNZXNzYWdlIENhbGxiYWNrIC0gVHJpZ2dlcmVkIHdoZW4gbmV3IGRhdGEgYXJyaXZlcy4NCiAgICAgICAgICAgIHRoaXMudW5pcXVlQ2FsbGJhY2tJZGVudGlmaWVyID0gTFVJREdlbmVyYXRvcigpOw0KICAgICAgICAgICAgd2luZG93W0ZJUkVCQVNFX0xPTkdQT0xMX0NPTU1BTkRfQ0JfTkFNRSArIHRoaXMudW5pcXVlQ2FsbGJhY2tJZGVudGlmaWVyXSA9IGNvbW1hbmRDQjsNCiAgICAgICAgICAgIHdpbmRvd1tGSVJFQkFTRV9MT05HUE9MTF9EQVRBX0NCX05BTUUgKyB0aGlzLnVuaXF1ZUNhbGxiYWNrSWRlbnRpZmllcl0gPQ0KICAgICAgICAgICAgICAgIG9uTWVzc2FnZUNCOw0KICAgICAgICAgICAgLy9DcmVhdGUgYW4gaWZyYW1lIGZvciB1cyB0byBhZGQgc2NyaXB0IHRhZ3MgdG8uDQogICAgICAgICAgICB0aGlzLm15SUZyYW1lID0gRmlyZWJhc2VJRnJhbWVTY3JpcHRIb2xkZXIuY3JlYXRlSUZyYW1lXygpOw0KICAgICAgICAgICAgLy8gU2V0IHRoZSBpZnJhbWUncyBjb250ZW50cy4NCiAgICAgICAgICAgIGxldCBzY3JpcHQgPSAnJzsNCiAgICAgICAgICAgIC8vIGlmIHdlIHNldCBhIGphdmFzY3JpcHQgdXJsLCBpdCdzIElFIGFuZCB3ZSBuZWVkIHRvIHNldCB0aGUgZG9jdW1lbnQgZG9tYWluLiBUaGUgamF2YXNjcmlwdCB1cmwgaXMgc3VmZmljaWVudA0KICAgICAgICAgICAgLy8gZm9yIGllOSwgYnV0IGllOCBuZWVkcyB0byBkbyBpdCBhZ2FpbiBpbiB0aGUgZG9jdW1lbnQgaXRzZWxmLg0KICAgICAgICAgICAgaWYgKHRoaXMubXlJRnJhbWUuc3JjICYmDQogICAgICAgICAgICAgICAgdGhpcy5teUlGcmFtZS5zcmMuc3Vic3RyKDAsICdqYXZhc2NyaXB0OicubGVuZ3RoKSA9PT0gJ2phdmFzY3JpcHQ6Jykgew0KICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnREb21haW4gPSBkb2N1bWVudC5kb21haW47DQogICAgICAgICAgICAgICAgc2NyaXB0ID0gJzxzY3JpcHQ+ZG9jdW1lbnQuZG9tYWluPSInICsgY3VycmVudERvbWFpbiArICciOzwvc2NyaXB0Pic7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBpZnJhbWVDb250ZW50cyA9ICc8aHRtbD48Ym9keT4nICsgc2NyaXB0ICsgJzwvYm9keT48L2h0bWw+JzsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgdGhpcy5teUlGcmFtZS5kb2Mub3BlbigpOw0KICAgICAgICAgICAgICAgIHRoaXMubXlJRnJhbWUuZG9jLndyaXRlKGlmcmFtZUNvbnRlbnRzKTsNCiAgICAgICAgICAgICAgICB0aGlzLm15SUZyYW1lLmRvYy5jbG9zZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICBsb2coJ2ZyYW1lIHdyaXRpbmcgZXhjZXB0aW9uJyk7DQogICAgICAgICAgICAgICAgaWYgKGUuc3RhY2spIHsNCiAgICAgICAgICAgICAgICAgICAgbG9nKGUuc3RhY2spOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBsb2coZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogRWFjaCBicm93c2VyIGhhcyBpdHMgb3duIGZ1bm55IHdheSB0byBoYW5kbGUgaWZyYW1lcy4gSGVyZSB3ZSBtdXNoIHRoZW0gYWxsIHRvZ2V0aGVyIGludG8gb25lIG9iamVjdCB0aGF0IEkgY2FuDQogICAgICogYWN0dWFsbHkgdXNlLg0KICAgICAqLw0KICAgIHN0YXRpYyBjcmVhdGVJRnJhbWVfKCkgew0KICAgICAgICBjb25zdCBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKTsNCiAgICAgICAgaWZyYW1lLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgIC8vIFRoaXMgaXMgbmVjZXNzYXJ5IGluIG9yZGVyIHRvIGluaXRpYWxpemUgdGhlIGRvY3VtZW50IGluc2lkZSB0aGUgaWZyYW1lDQogICAgICAgIGlmIChkb2N1bWVudC5ib2R5KSB7DQogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGlmcmFtZSk7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIC8vIElmIGRvY3VtZW50LmRvbWFpbiBoYXMgYmVlbiBtb2RpZmllZCBpbiBJRSwgdGhpcyB3aWxsIHRocm93IGFuIGVycm9yLCBhbmQgd2UgbmVlZCB0byBzZXQgdGhlDQogICAgICAgICAgICAgICAgLy8gZG9tYWluIG9mIHRoZSBpZnJhbWUncyBkb2N1bWVudCBtYW51YWxseS4gV2UgY2FuIGRvIHRoaXMgdmlhIGEgamF2YXNjcmlwdDogdXJsIGFzIHRoZSBzcmMgYXR0cmlidXRlDQogICAgICAgICAgICAgICAgLy8gQWxzbyBub3RlIHRoYXQgd2UgbXVzdCBkbyB0aGlzICphZnRlciogdGhlIGlmcmFtZSBoYXMgYmVlbiBhcHBlbmRlZCB0byB0aGUgcGFnZS4gT3RoZXJ3aXNlIGl0IGRvZXNuJ3Qgd29yay4NCiAgICAgICAgICAgICAgICBjb25zdCBhID0gaWZyYW1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQ7DQogICAgICAgICAgICAgICAgaWYgKCFhKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIEFwb2xvZ2llcyBmb3IgdGhlIGxvZy1zcGFtLCBJIG5lZWQgdG8gZG8gc29tZXRoaW5nIHRvIGtlZXAgY2xvc3VyZSBmcm9tIG9wdGltaXppbmcgb3V0IHRoZSBhc3NpZ25tZW50IGFib3ZlLg0KICAgICAgICAgICAgICAgICAgICBsb2coJ05vIElFIGRvbWFpbiBzZXR0aW5nIHJlcXVpcmVkJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICBjb25zdCBkb21haW4gPSBkb2N1bWVudC5kb21haW47DQogICAgICAgICAgICAgICAgaWZyYW1lLnNyYyA9DQogICAgICAgICAgICAgICAgICAgICJqYXZhc2NyaXB0OnZvaWQoKGZ1bmN0aW9uKCl7ZG9jdW1lbnQub3BlbigpO2RvY3VtZW50LmRvbWFpbj0nIiArDQogICAgICAgICAgICAgICAgICAgICAgICBkb21haW4gKw0KICAgICAgICAgICAgICAgICAgICAgICAgIic7ZG9jdW1lbnQuY2xvc2UoKTt9KSgpKSI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAvLyBMb25nUG9sbENvbm5lY3Rpb24gYXR0ZW1wdHMgdG8gZGVsYXkgaW5pdGlhbGl6YXRpb24gdW50aWwgdGhlIGRvY3VtZW50IGlzIHJlYWR5LCBzbyBob3BlZnVsbHkgdGhpcw0KICAgICAgICAgICAgLy8gbmV2ZXIgZ2V0cyBoaXQuDQogICAgICAgICAgICB0aHJvdyAnRG9jdW1lbnQgYm9keSBoYXMgbm90IGluaXRpYWxpemVkLiBXYWl0IHRvIGluaXRpYWxpemUgRmlyZWJhc2UgdW50aWwgYWZ0ZXIgdGhlIGRvY3VtZW50IGlzIHJlYWR5Lic7DQogICAgICAgIH0NCiAgICAgICAgLy8gR2V0IHRoZSBkb2N1bWVudCBvZiB0aGUgaWZyYW1lIGluIGEgYnJvd3Nlci1zcGVjaWZpYyB3YXkuDQogICAgICAgIGlmIChpZnJhbWUuY29udGVudERvY3VtZW50KSB7DQogICAgICAgICAgICBpZnJhbWUuZG9jID0gaWZyYW1lLmNvbnRlbnREb2N1bWVudDsgLy8gRmlyZWZveCwgT3BlcmEsIFNhZmFyaQ0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKGlmcmFtZS5jb250ZW50V2luZG93KSB7DQogICAgICAgICAgICBpZnJhbWUuZG9jID0gaWZyYW1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQ7IC8vIEludGVybmV0IEV4cGxvcmVyDQogICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKGlmcmFtZS5kb2N1bWVudCkgew0KICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgICAgIGlmcmFtZS5kb2MgPSBpZnJhbWUuZG9jdW1lbnQ7IC8vb3RoZXJzPw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBpZnJhbWU7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIENhbmNlbCBhbGwgb3V0c3RhbmRpbmcgcXVlcmllcyBhbmQgcmVtb3ZlIHRoZSBmcmFtZS4NCiAgICAgKi8NCiAgICBjbG9zZSgpIHsNCiAgICAgICAgLy9NYXJrIHRoaXMgaWZyYW1lIGFzIGRlYWQsIHNvIG5vIG5ldyByZXF1ZXN0cyBhcmUgc2VudC4NCiAgICAgICAgdGhpcy5hbGl2ZSA9IGZhbHNlOw0KICAgICAgICBpZiAodGhpcy5teUlGcmFtZSkgew0KICAgICAgICAgICAgLy9XZSBoYXZlIHRvIGFjdHVhbGx5IHJlbW92ZSBhbGwgb2YgdGhlIGh0bWwgaW5zaWRlIHRoaXMgaWZyYW1lIGJlZm9yZSByZW1vdmluZyBpdCBmcm9tIHRoZQ0KICAgICAgICAgICAgLy93aW5kb3csIG9yIElFIHdpbGwgY29udGludWUgbG9hZGluZyBhbmQgZXhlY3V0aW5nIHRoZSBzY3JpcHQgdGFncyB3ZSd2ZSBhbHJlYWR5IGFkZGVkLCB3aGljaA0KICAgICAgICAgICAgLy9jYW4gbGVhZCB0byBzb21lIGVycm9ycyBiZWluZyB0aHJvd24uIFNldHRpbmcgdGV4dENvbnRlbnQgc2VlbXMgdG8gYmUgdGhlIHNhZmVzdCB3YXkgdG8gZG8gdGhpcy4NCiAgICAgICAgICAgIHRoaXMubXlJRnJhbWUuZG9jLmJvZHkudGV4dENvbnRlbnQgPSAnJzsNCiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgICAgIGlmICh0aGlzLm15SUZyYW1lICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGhpcy5teUlGcmFtZSk7DQogICAgICAgICAgICAgICAgICAgIHRoaXMubXlJRnJhbWUgPSBudWxsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sIE1hdGguZmxvb3IoMCkpOw0KICAgICAgICB9DQogICAgICAgIC8vIFByb3RlY3QgZnJvbSBiZWluZyBjYWxsZWQgcmVjdXJzaXZlbHkuDQogICAgICAgIGNvbnN0IG9uRGlzY29ubmVjdCA9IHRoaXMub25EaXNjb25uZWN0Ow0KICAgICAgICBpZiAob25EaXNjb25uZWN0KSB7DQogICAgICAgICAgICB0aGlzLm9uRGlzY29ubmVjdCA9IG51bGw7DQogICAgICAgICAgICBvbkRpc2Nvbm5lY3QoKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBBY3R1YWxseSBzdGFydCB0aGUgbG9uZy1wb2xsaW5nIHNlc3Npb24gYnkgYWRkaW5nIHRoZSBmaXJzdCBzY3JpcHQgdGFnKHMpIHRvIHRoZSBpZnJhbWUuDQogICAgICogQHBhcmFtIGlkIC0gVGhlIElEIG9mIHRoaXMgY29ubmVjdGlvbg0KICAgICAqIEBwYXJhbSBwdyAtIFRoZSBwYXNzd29yZCBmb3IgdGhpcyBjb25uZWN0aW9uDQogICAgICovDQogICAgc3RhcnRMb25nUG9sbChpZCwgcHcpIHsNCiAgICAgICAgdGhpcy5teUlEID0gaWQ7DQogICAgICAgIHRoaXMubXlQVyA9IHB3Ow0KICAgICAgICB0aGlzLmFsaXZlID0gdHJ1ZTsNCiAgICAgICAgLy9zZW5kIHRoZSBpbml0aWFsIHJlcXVlc3QuIElmIHRoZXJlIGFyZSByZXF1ZXN0cyBxdWV1ZWQsIG1ha2Ugc3VyZSB0aGF0IHdlIHRyYW5zbWl0IGFzIG1hbnkgYXMgd2UgYXJlIGN1cnJlbnRseSBhYmxlIHRvLg0KICAgICAgICB3aGlsZSAodGhpcy5uZXdSZXF1ZXN0XygpKSB7IH0NCiAgICB9DQogICAgLyoqDQogICAgICogVGhpcyBpcyBjYWxsZWQgYW55IHRpbWUgc29tZW9uZSBtaWdodCB3YW50IGEgc2NyaXB0IHRhZyB0byBiZSBhZGRlZC4gSXQgYWRkcyBhIHNjcmlwdCB0YWcgd2hlbiB0aGVyZSBhcmVuJ3QNCiAgICAgKiB0b28gbWFueSBvdXRzdGFuZGluZyByZXF1ZXN0cyBhbmQgd2UgYXJlIHN0aWxsIGFsaXZlLg0KICAgICAqDQogICAgICogSWYgdGhlcmUgYXJlIG91dHN0YW5kaW5nIHBhY2tldCBzZWdtZW50cyB0byBzZW5kLCBpdCBzZW5kcyBvbmUuIElmIHRoZXJlIGFyZW4ndCwgaXQgc2VuZHMgYSBsb25nLXBvbGwgYW55d2F5cyBpZg0KICAgICAqIG5lZWRlZC4NCiAgICAgKi8NCiAgICBuZXdSZXF1ZXN0XygpIHsNCiAgICAgICAgLy8gV2Uga2VlcCBvbmUgb3V0c3RhbmRpbmcgcmVxdWVzdCBvcGVuIGFsbCB0aGUgdGltZSB0byByZWNlaXZlIGRhdGEsIGJ1dCBpZiB3ZSBuZWVkIHRvIHNlbmQgZGF0YQ0KICAgICAgICAvLyAocGVuZGluZ1NlZ3MubGVuZ3RoID4gMCkgdGhlbiB3ZSBjcmVhdGUgYSBuZXcgcmVxdWVzdCB0byBzZW5kIHRoZSBkYXRhLiAgVGhlIHNlcnZlciB3aWxsIGF1dG9tYXRpY2FsbHkNCiAgICAgICAgLy8gY2xvc2UgdGhlIG9sZCByZXF1ZXN0Lg0KICAgICAgICBpZiAodGhpcy5hbGl2ZSAmJg0KICAgICAgICAgICAgdGhpcy5zZW5kTmV3UG9sbHMgJiYNCiAgICAgICAgICAgIHRoaXMub3V0c3RhbmRpbmdSZXF1ZXN0cy5zaXplIDwgKHRoaXMucGVuZGluZ1NlZ3MubGVuZ3RoID4gMCA/IDIgOiAxKSkgew0KICAgICAgICAgICAgLy9jb25zdHJ1Y3Qgb3VyIHVybA0KICAgICAgICAgICAgdGhpcy5jdXJyZW50U2VyaWFsKys7DQogICAgICAgICAgICBjb25zdCB1cmxQYXJhbXMgPSB7fTsNCiAgICAgICAgICAgIHVybFBhcmFtc1tGSVJFQkFTRV9MT05HUE9MTF9JRF9QQVJBTV0gPSB0aGlzLm15SUQ7DQogICAgICAgICAgICB1cmxQYXJhbXNbRklSRUJBU0VfTE9OR1BPTExfUFdfUEFSQU1dID0gdGhpcy5teVBXOw0KICAgICAgICAgICAgdXJsUGFyYW1zW0ZJUkVCQVNFX0xPTkdQT0xMX1NFUklBTF9QQVJBTV0gPSB0aGlzLmN1cnJlbnRTZXJpYWw7DQogICAgICAgICAgICBsZXQgdGhlVVJMID0gdGhpcy51cmxGbih1cmxQYXJhbXMpOw0KICAgICAgICAgICAgLy9Ob3cgYWRkIGFzIG11Y2ggZGF0YSBhcyB3ZSBjYW4uDQogICAgICAgICAgICBsZXQgY3VyRGF0YVN0cmluZyA9ICcnOw0KICAgICAgICAgICAgbGV0IGkgPSAwOw0KICAgICAgICAgICAgd2hpbGUgKHRoaXMucGVuZGluZ1NlZ3MubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgIC8vZmlyc3QsIGxldHMgc2VlIGlmIHRoZSBuZXh0IHNlZ21lbnQgd2lsbCBmaXQuDQogICAgICAgICAgICAgICAgY29uc3QgbmV4dFNlZyA9IHRoaXMucGVuZGluZ1NlZ3NbMF07DQogICAgICAgICAgICAgICAgaWYgKG5leHRTZWcuZC5sZW5ndGggKw0KICAgICAgICAgICAgICAgICAgICBTRUdfSEVBREVSX1NJWkUgKw0KICAgICAgICAgICAgICAgICAgICBjdXJEYXRhU3RyaW5nLmxlbmd0aCA8PQ0KICAgICAgICAgICAgICAgICAgICBNQVhfVVJMX0RBVEFfU0laRSkgew0KICAgICAgICAgICAgICAgICAgICAvL2dyZWF0LCB0aGUgc2VnbWVudCB3aWxsIGZpdC4gTGV0cyBhcHBlbmQgaXQuDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRoZVNlZyA9IHRoaXMucGVuZGluZ1NlZ3Muc2hpZnQoKTsNCiAgICAgICAgICAgICAgICAgICAgY3VyRGF0YVN0cmluZyA9DQogICAgICAgICAgICAgICAgICAgICAgICBjdXJEYXRhU3RyaW5nICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnJicgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZJUkVCQVNFX0xPTkdQT0xMX1NFR01FTlRfTlVNX1BBUkFNICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPScgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZVNlZy5zZWcgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICcmJyArDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRklSRUJBU0VfTE9OR1BPTExfU0VHTUVOVFNfSU5fUEFDS0VUICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPScgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZVNlZy50cyArDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJyYnICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGSVJFQkFTRV9MT05HUE9MTF9EQVRBX1BBUkFNICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPScgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZVNlZy5kOw0KICAgICAgICAgICAgICAgICAgICBpKys7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGVVUkwgPSB0aGVVUkwgKyBjdXJEYXRhU3RyaW5nOw0KICAgICAgICAgICAgdGhpcy5hZGRMb25nUG9sbFRhZ18odGhlVVJMLCB0aGlzLmN1cnJlbnRTZXJpYWwpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogUXVldWUgYSBwYWNrZXQgZm9yIHRyYW5zbWlzc2lvbiB0byB0aGUgc2VydmVyLg0KICAgICAqIEBwYXJhbSBzZWdudW0gLSBBIHNlcXVlbnRpYWwgaWQgZm9yIHRoaXMgcGFja2V0IHNlZ21lbnQgdXNlZCBmb3IgcmVhc3NlbWJseQ0KICAgICAqIEBwYXJhbSB0b3RhbHNlZ3MgLSBUaGUgdG90YWwgbnVtYmVyIG9mIHNlZ21lbnRzIGluIHRoaXMgcGFja2V0DQogICAgICogQHBhcmFtIGRhdGEgLSBUaGUgZGF0YSBmb3IgdGhpcyBzZWdtZW50Lg0KICAgICAqLw0KICAgIGVucXVldWVTZWdtZW50KHNlZ251bSwgdG90YWxzZWdzLCBkYXRhKSB7DQogICAgICAgIC8vYWRkIHRoaXMgdG8gdGhlIHF1ZXVlIG9mIHNlZ21lbnRzIHRvIHNlbmQuDQogICAgICAgIHRoaXMucGVuZGluZ1NlZ3MucHVzaCh7IHNlZzogc2VnbnVtLCB0czogdG90YWxzZWdzLCBkOiBkYXRhIH0pOw0KICAgICAgICAvL3NlbmQgdGhlIGRhdGEgaW1tZWRpYXRlbHkgaWYgdGhlcmUgaXNuJ3QgYWxyZWFkeSBkYXRhIGJlaW5nIHRyYW5zbWl0dGVkLCB1bmxlc3MNCiAgICAgICAgLy9zdGFydExvbmdQb2xsIGhhc24ndCBiZWVuIGNhbGxlZCB5ZXQuDQogICAgICAgIGlmICh0aGlzLmFsaXZlKSB7DQogICAgICAgICAgICB0aGlzLm5ld1JlcXVlc3RfKCk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogQWRkIGEgc2NyaXB0IHRhZyBmb3IgYSByZWd1bGFyIGxvbmctcG9sbCByZXF1ZXN0Lg0KICAgICAqIEBwYXJhbSB1cmwgLSBUaGUgVVJMIG9mIHRoZSBzY3JpcHQgdGFnLg0KICAgICAqIEBwYXJhbSBzZXJpYWwgLSBUaGUgc2VyaWFsIG51bWJlciBvZiB0aGUgcmVxdWVzdC4NCiAgICAgKi8NCiAgICBhZGRMb25nUG9sbFRhZ18odXJsLCBzZXJpYWwpIHsNCiAgICAgICAgLy9yZW1lbWJlciB0aGF0IHdlIHNlbnQgdGhpcyByZXF1ZXN0Lg0KICAgICAgICB0aGlzLm91dHN0YW5kaW5nUmVxdWVzdHMuYWRkKHNlcmlhbCk7DQogICAgICAgIGNvbnN0IGRvTmV3UmVxdWVzdCA9ICgpID0+IHsNCiAgICAgICAgICAgIHRoaXMub3V0c3RhbmRpbmdSZXF1ZXN0cy5kZWxldGUoc2VyaWFsKTsNCiAgICAgICAgICAgIHRoaXMubmV3UmVxdWVzdF8oKTsNCiAgICAgICAgfTsNCiAgICAgICAgLy8gSWYgdGhpcyByZXF1ZXN0IGRvZXNuJ3QgcmV0dXJuIG9uIGl0cyBvd24gYWNjb3JkIChieSB0aGUgc2VydmVyIHNlbmRpbmcgdXMgc29tZSBkYXRhKSwgd2UnbGwNCiAgICAgICAgLy8gY3JlYXRlIGEgbmV3IG9uZSBhZnRlciB0aGUgS0VFUEFMSVZFIGludGVydmFsIHRvIG1ha2Ugc3VyZSB3ZSBhbHdheXMga2VlcCBhIGZyZXNoIHJlcXVlc3Qgb3Blbi4NCiAgICAgICAgY29uc3Qga2VlcGFsaXZlVGltZW91dCA9IHNldFRpbWVvdXQoZG9OZXdSZXF1ZXN0LCBNYXRoLmZsb29yKEtFRVBBTElWRV9SRVFVRVNUX0lOVEVSVkFMKSk7DQogICAgICAgIGNvbnN0IHJlYWR5U3RhdGVDQiA9ICgpID0+IHsNCiAgICAgICAgICAgIC8vIFJlcXVlc3QgY29tcGxldGVkLiAgQ2FuY2VsIHRoZSBrZWVwYWxpdmUuDQogICAgICAgICAgICBjbGVhclRpbWVvdXQoa2VlcGFsaXZlVGltZW91dCk7DQogICAgICAgICAgICAvLyBUcmlnZ2VyIGEgbmV3IHJlcXVlc3Qgc28gd2UgY2FuIGNvbnRpbnVlIHJlY2VpdmluZyBkYXRhLg0KICAgICAgICAgICAgZG9OZXdSZXF1ZXN0KCk7DQogICAgICAgIH07DQogICAgICAgIHRoaXMuYWRkVGFnKHVybCwgcmVhZHlTdGF0ZUNCKTsNCiAgICB9DQogICAgLyoqDQogICAgICogQWRkIGFuIGFyYml0cmFyeSBzY3JpcHQgdGFnIHRvIHRoZSBpZnJhbWUuDQogICAgICogQHBhcmFtIHVybCAtIFRoZSBVUkwgZm9yIHRoZSBzY3JpcHQgdGFnIHNvdXJjZS4NCiAgICAgKiBAcGFyYW0gbG9hZENCIC0gQSBjYWxsYmFjayB0byBiZSB0cmlnZ2VyZWQgb25jZSB0aGUgc2NyaXB0IGhhcyBsb2FkZWQuDQogICAgICovDQogICAgYWRkVGFnKHVybCwgbG9hZENCKSB7DQogICAgICAgIHsNCiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgIC8vIGlmIHdlJ3JlIGFscmVhZHkgY2xvc2VkLCBkb24ndCBhZGQgdGhpcyBwb2xsDQogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5zZW5kTmV3UG9sbHMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdTY3JpcHQgPSB0aGlzLm15SUZyYW1lLmRvYy5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTsNCiAgICAgICAgICAgICAgICAgICAgbmV3U2NyaXB0LnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JzsNCiAgICAgICAgICAgICAgICAgICAgbmV3U2NyaXB0LmFzeW5jID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgbmV3U2NyaXB0LnNyYyA9IHVybDsNCiAgICAgICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgICAgICAgICAgICAgbmV3U2NyaXB0Lm9ubG9hZCA9IG5ld1NjcmlwdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPQ0KICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcnN0YXRlID0gbmV3U2NyaXB0LnJlYWR5U3RhdGU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyc3RhdGUgfHwgcnN0YXRlID09PSAnbG9hZGVkJyB8fCByc3RhdGUgPT09ICdjb21wbGV0ZScpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3U2NyaXB0Lm9ubG9hZCA9IG5ld1NjcmlwdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3U2NyaXB0LnBhcmVudE5vZGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1NjcmlwdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5ld1NjcmlwdCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZENCKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgbmV3U2NyaXB0Lm9uZXJyb3IgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBsb2coJ0xvbmctcG9sbCBzY3JpcHQgZmFpbGVkIHRvIGxvYWQ6ICcgKyB1cmwpOw0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZW5kTmV3UG9sbHMgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5teUlGcmFtZS5kb2MuYm9keS5hcHBlbmRDaGlsZChuZXdTY3JpcHQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiB3ZSBzaG91bGQgbWFrZSB0aGlzIGVycm9yIHZpc2libGUgc29tZWhvdw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sIE1hdGguZmxvb3IoMSkpOw0KICAgICAgICB9DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY29uc3QgV0VCU09DS0VUX01BWF9GUkFNRV9TSVpFID0gMTYzODQ7DQpjb25zdCBXRUJTT0NLRVRfS0VFUEFMSVZFX0lOVEVSVkFMID0gNDUwMDA7DQpsZXQgV2ViU29ja2V0SW1wbCA9IG51bGw7DQppZiAodHlwZW9mIE1veldlYlNvY2tldCAhPT0gJ3VuZGVmaW5lZCcpIHsNCiAgICBXZWJTb2NrZXRJbXBsID0gTW96V2ViU29ja2V0Ow0KfQ0KZWxzZSBpZiAodHlwZW9mIFdlYlNvY2tldCAhPT0gJ3VuZGVmaW5lZCcpIHsNCiAgICBXZWJTb2NrZXRJbXBsID0gV2ViU29ja2V0Ow0KfQ0KLyoqDQogKiBDcmVhdGUgYSBuZXcgd2Vic29ja2V0IGNvbm5lY3Rpb24gd2l0aCB0aGUgZ2l2ZW4gY2FsbGJhY2tzLg0KICovDQpjbGFzcyBXZWJTb2NrZXRDb25uZWN0aW9uIHsNCiAgICAvKioNCiAgICAgKiBAcGFyYW0gY29ubklkIGlkZW50aWZpZXIgZm9yIHRoaXMgdHJhbnNwb3J0DQogICAgICogQHBhcmFtIHJlcG9JbmZvIFRoZSBpbmZvIGZvciB0aGUgd2Vic29ja2V0IGVuZHBvaW50Lg0KICAgICAqIEBwYXJhbSBhcHBsaWNhdGlvbklkIFRoZSBGaXJlYmFzZSBBcHAgSUQgZm9yIHRoaXMgcHJvamVjdC4NCiAgICAgKiBAcGFyYW0gYXBwQ2hlY2tUb2tlbiBUaGUgQXBwIENoZWNrIFRva2VuIGZvciB0aGlzIGNsaWVudC4NCiAgICAgKiBAcGFyYW0gYXV0aFRva2VuIFRoZSBBdXRoIFRva2VuIGZvciB0aGlzIGNsaWVudC4NCiAgICAgKiBAcGFyYW0gdHJhbnNwb3J0U2Vzc2lvbklkIE9wdGlvbmFsIHRyYW5zcG9ydFNlc3Npb25JZCBpZiB0aGlzIGlzIGNvbm5lY3RpbmcNCiAgICAgKiB0byBhbiBleGlzdGluZyB0cmFuc3BvcnQgc2Vzc2lvbg0KICAgICAqIEBwYXJhbSBsYXN0U2Vzc2lvbklkIE9wdGlvbmFsIGxhc3RTZXNzaW9uSWQgaWYgdGhlcmUgd2FzIGEgcHJldmlvdXMNCiAgICAgKiBjb25uZWN0aW9uDQogICAgICovDQogICAgY29uc3RydWN0b3IoY29ubklkLCByZXBvSW5mbywgYXBwbGljYXRpb25JZCwgYXBwQ2hlY2tUb2tlbiwgYXV0aFRva2VuLCB0cmFuc3BvcnRTZXNzaW9uSWQsIGxhc3RTZXNzaW9uSWQpIHsNCiAgICAgICAgdGhpcy5jb25uSWQgPSBjb25uSWQ7DQogICAgICAgIHRoaXMuYXBwbGljYXRpb25JZCA9IGFwcGxpY2F0aW9uSWQ7DQogICAgICAgIHRoaXMuYXBwQ2hlY2tUb2tlbiA9IGFwcENoZWNrVG9rZW47DQogICAgICAgIHRoaXMuYXV0aFRva2VuID0gYXV0aFRva2VuOw0KICAgICAgICB0aGlzLmtlZXBhbGl2ZVRpbWVyID0gbnVsbDsNCiAgICAgICAgdGhpcy5mcmFtZXMgPSBudWxsOw0KICAgICAgICB0aGlzLnRvdGFsRnJhbWVzID0gMDsNCiAgICAgICAgdGhpcy5ieXRlc1NlbnQgPSAwOw0KICAgICAgICB0aGlzLmJ5dGVzUmVjZWl2ZWQgPSAwOw0KICAgICAgICB0aGlzLmxvZ18gPSBsb2dXcmFwcGVyKHRoaXMuY29ubklkKTsNCiAgICAgICAgdGhpcy5zdGF0c18gPSBzdGF0c01hbmFnZXJHZXRDb2xsZWN0aW9uKHJlcG9JbmZvKTsNCiAgICAgICAgdGhpcy5jb25uVVJMID0gV2ViU29ja2V0Q29ubmVjdGlvbi5jb25uZWN0aW9uVVJMXyhyZXBvSW5mbywgdHJhbnNwb3J0U2Vzc2lvbklkLCBsYXN0U2Vzc2lvbklkLCBhcHBDaGVja1Rva2VuLCBhcHBsaWNhdGlvbklkKTsNCiAgICAgICAgdGhpcy5ub2RlQWRtaW4gPSByZXBvSW5mby5ub2RlQWRtaW47DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEBwYXJhbSByZXBvSW5mbyAtIFRoZSBpbmZvIGZvciB0aGUgd2Vic29ja2V0IGVuZHBvaW50Lg0KICAgICAqIEBwYXJhbSB0cmFuc3BvcnRTZXNzaW9uSWQgLSBPcHRpb25hbCB0cmFuc3BvcnRTZXNzaW9uSWQgaWYgdGhpcyBpcyBjb25uZWN0aW5nIHRvIGFuIGV4aXN0aW5nIHRyYW5zcG9ydA0KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uDQogICAgICogQHBhcmFtIGxhc3RTZXNzaW9uSWQgLSBPcHRpb25hbCBsYXN0U2Vzc2lvbklkIGlmIHRoZXJlIHdhcyBhIHByZXZpb3VzIGNvbm5lY3Rpb24NCiAgICAgKiBAcmV0dXJucyBjb25uZWN0aW9uIHVybA0KICAgICAqLw0KICAgIHN0YXRpYyBjb25uZWN0aW9uVVJMXyhyZXBvSW5mbywgdHJhbnNwb3J0U2Vzc2lvbklkLCBsYXN0U2Vzc2lvbklkLCBhcHBDaGVja1Rva2VuLCBhcHBsaWNhdGlvbklkKSB7DQogICAgICAgIGNvbnN0IHVybFBhcmFtcyA9IHt9Ow0KICAgICAgICB1cmxQYXJhbXNbVkVSU0lPTl9QQVJBTV0gPSBQUk9UT0NPTF9WRVJTSU9OOw0KICAgICAgICBpZiAodHlwZW9mIGxvY2F0aW9uICE9PSAndW5kZWZpbmVkJyAmJg0KICAgICAgICAgICAgbG9jYXRpb24uaG9zdG5hbWUgJiYNCiAgICAgICAgICAgIEZPUkdFX0RPTUFJTl9SRS50ZXN0KGxvY2F0aW9uLmhvc3RuYW1lKSkgew0KICAgICAgICAgICAgdXJsUGFyYW1zW1JFRkVSRVJfUEFSQU1dID0gRk9SR0VfUkVGOw0KICAgICAgICB9DQogICAgICAgIGlmICh0cmFuc3BvcnRTZXNzaW9uSWQpIHsNCiAgICAgICAgICAgIHVybFBhcmFtc1tUUkFOU1BPUlRfU0VTU0lPTl9QQVJBTV0gPSB0cmFuc3BvcnRTZXNzaW9uSWQ7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGxhc3RTZXNzaW9uSWQpIHsNCiAgICAgICAgICAgIHVybFBhcmFtc1tMQVNUX1NFU1NJT05fUEFSQU1dID0gbGFzdFNlc3Npb25JZDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoYXBwQ2hlY2tUb2tlbikgew0KICAgICAgICAgICAgdXJsUGFyYW1zW0FQUF9DSEVDS19UT0tFTl9QQVJBTV0gPSBhcHBDaGVja1Rva2VuOw0KICAgICAgICB9DQogICAgICAgIGlmIChhcHBsaWNhdGlvbklkKSB7DQogICAgICAgICAgICB1cmxQYXJhbXNbQVBQTElDQVRJT05fSURfUEFSQU1dID0gYXBwbGljYXRpb25JZDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVwb0luZm9Db25uZWN0aW9uVVJMKHJlcG9JbmZvLCBXRUJTT0NLRVQsIHVybFBhcmFtcyk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEBwYXJhbSBvbk1lc3NhZ2UgLSBDYWxsYmFjayB3aGVuIG1lc3NhZ2VzIGFycml2ZQ0KICAgICAqIEBwYXJhbSBvbkRpc2Nvbm5lY3QgLSBDYWxsYmFjayB3aXRoIGNvbm5lY3Rpb24gbG9zdC4NCiAgICAgKi8NCiAgICBvcGVuKG9uTWVzc2FnZSwgb25EaXNjb25uZWN0KSB7DQogICAgICAgIHRoaXMub25EaXNjb25uZWN0ID0gb25EaXNjb25uZWN0Ow0KICAgICAgICB0aGlzLm9uTWVzc2FnZSA9IG9uTWVzc2FnZTsNCiAgICAgICAgdGhpcy5sb2dfKCdXZWJzb2NrZXQgY29ubmVjdGluZyB0byAnICsgdGhpcy5jb25uVVJMKTsNCiAgICAgICAgdGhpcy5ldmVyQ29ubmVjdGVkXyA9IGZhbHNlOw0KICAgICAgICAvLyBBc3N1bWUgZmFpbHVyZSB1bnRpbCBwcm92ZW4gb3RoZXJ3aXNlLg0KICAgICAgICBQZXJzaXN0ZW50U3RvcmFnZS5zZXQoJ3ByZXZpb3VzX3dlYnNvY2tldF9mYWlsdXJlJywgdHJ1ZSk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBsZXQgb3B0aW9uczsNCiAgICAgICAgICAgIGlmIChpc05vZGVTZGsoKSkgOw0KICAgICAgICAgICAgdGhpcy5teVNvY2sgPSBuZXcgV2ViU29ja2V0SW1wbCh0aGlzLmNvbm5VUkwsIFtdLCBvcHRpb25zKTsNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgdGhpcy5sb2dfKCdFcnJvciBpbnN0YW50aWF0aW5nIFdlYlNvY2tldC4nKTsNCiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gZS5tZXNzYWdlIHx8IGUuZGF0YTsNCiAgICAgICAgICAgIGlmIChlcnJvcikgew0KICAgICAgICAgICAgICAgIHRoaXMubG9nXyhlcnJvcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLm9uQ2xvc2VkXygpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHRoaXMubXlTb2NrLm9ub3BlbiA9ICgpID0+IHsNCiAgICAgICAgICAgIHRoaXMubG9nXygnV2Vic29ja2V0IGNvbm5lY3RlZC4nKTsNCiAgICAgICAgICAgIHRoaXMuZXZlckNvbm5lY3RlZF8gPSB0cnVlOw0KICAgICAgICB9Ow0KICAgICAgICB0aGlzLm15U29jay5vbmNsb3NlID0gKCkgPT4gew0KICAgICAgICAgICAgdGhpcy5sb2dfKCdXZWJzb2NrZXQgY29ubmVjdGlvbiB3YXMgZGlzY29ubmVjdGVkLicpOw0KICAgICAgICAgICAgdGhpcy5teVNvY2sgPSBudWxsOw0KICAgICAgICAgICAgdGhpcy5vbkNsb3NlZF8oKTsNCiAgICAgICAgfTsNCiAgICAgICAgdGhpcy5teVNvY2sub25tZXNzYWdlID0gbSA9PiB7DQogICAgICAgICAgICB0aGlzLmhhbmRsZUluY29taW5nRnJhbWUobSk7DQogICAgICAgIH07DQogICAgICAgIHRoaXMubXlTb2NrLm9uZXJyb3IgPSBlID0+IHsNCiAgICAgICAgICAgIHRoaXMubG9nXygnV2ViU29ja2V0IGVycm9yLiAgQ2xvc2luZyBjb25uZWN0aW9uLicpOw0KICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gZS5tZXNzYWdlIHx8IGUuZGF0YTsNCiAgICAgICAgICAgIGlmIChlcnJvcikgew0KICAgICAgICAgICAgICAgIHRoaXMubG9nXyhlcnJvcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLm9uQ2xvc2VkXygpOw0KICAgICAgICB9Ow0KICAgIH0NCiAgICAvKioNCiAgICAgKiBOby1vcCBmb3Igd2Vic29ja2V0cywgd2UgZG9uJ3QgbmVlZCB0byBkbyBhbnl0aGluZyBvbmNlIHRoZSBjb25uZWN0aW9uIGlzIGNvbmZpcm1lZCBhcyBvcGVuDQogICAgICovDQogICAgc3RhcnQoKSB7IH0NCiAgICBzdGF0aWMgZm9yY2VEaXNhbGxvdygpIHsNCiAgICAgICAgV2ViU29ja2V0Q29ubmVjdGlvbi5mb3JjZURpc2FsbG93XyA9IHRydWU7DQogICAgfQ0KICAgIHN0YXRpYyBpc0F2YWlsYWJsZSgpIHsNCiAgICAgICAgbGV0IGlzT2xkQW5kcm9pZCA9IGZhbHNlOw0KICAgICAgICBpZiAodHlwZW9mIG5hdmlnYXRvciAhPT0gJ3VuZGVmaW5lZCcgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudCkgew0KICAgICAgICAgICAgY29uc3Qgb2xkQW5kcm9pZFJlZ2V4ID0gL0FuZHJvaWQgKFswLTldezAsfVwuWzAtOV17MCx9KS87DQogICAgICAgICAgICBjb25zdCBvbGRBbmRyb2lkTWF0Y2ggPSBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKG9sZEFuZHJvaWRSZWdleCk7DQogICAgICAgICAgICBpZiAob2xkQW5kcm9pZE1hdGNoICYmIG9sZEFuZHJvaWRNYXRjaC5sZW5ndGggPiAxKSB7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlRmxvYXQob2xkQW5kcm9pZE1hdGNoWzFdKSA8IDQuNCkgew0KICAgICAgICAgICAgICAgICAgICBpc09sZEFuZHJvaWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gKCFpc09sZEFuZHJvaWQgJiYNCiAgICAgICAgICAgIFdlYlNvY2tldEltcGwgIT09IG51bGwgJiYNCiAgICAgICAgICAgICFXZWJTb2NrZXRDb25uZWN0aW9uLmZvcmNlRGlzYWxsb3dfKTsNCiAgICB9DQogICAgLyoqDQogICAgICogUmV0dXJucyB0cnVlIGlmIHdlIHByZXZpb3VzbHkgZmFpbGVkIHRvIGNvbm5lY3Qgd2l0aCB0aGlzIHRyYW5zcG9ydC4NCiAgICAgKi8NCiAgICBzdGF0aWMgcHJldmlvdXNseUZhaWxlZCgpIHsNCiAgICAgICAgLy8gSWYgb3VyIHBlcnNpc3RlbnQgc3RvcmFnZSBpcyBhY3R1YWxseSBvbmx5IGluLW1lbW9yeSBzdG9yYWdlLA0KICAgICAgICAvLyB3ZSBkZWZhdWx0IHRvIGFzc3VtaW5nIHRoYXQgaXQgcHJldmlvdXNseSBmYWlsZWQgdG8gYmUgc2FmZS4NCiAgICAgICAgcmV0dXJuIChQZXJzaXN0ZW50U3RvcmFnZS5pc0luTWVtb3J5U3RvcmFnZSB8fA0KICAgICAgICAgICAgUGVyc2lzdGVudFN0b3JhZ2UuZ2V0KCdwcmV2aW91c193ZWJzb2NrZXRfZmFpbHVyZScpID09PSB0cnVlKTsNCiAgICB9DQogICAgbWFya0Nvbm5lY3Rpb25IZWFsdGh5KCkgew0KICAgICAgICBQZXJzaXN0ZW50U3RvcmFnZS5yZW1vdmUoJ3ByZXZpb3VzX3dlYnNvY2tldF9mYWlsdXJlJyk7DQogICAgfQ0KICAgIGFwcGVuZEZyYW1lXyhkYXRhKSB7DQogICAgICAgIHRoaXMuZnJhbWVzLnB1c2goZGF0YSk7DQogICAgICAgIGlmICh0aGlzLmZyYW1lcy5sZW5ndGggPT09IHRoaXMudG90YWxGcmFtZXMpIHsNCiAgICAgICAgICAgIGNvbnN0IGZ1bGxNZXNzID0gdGhpcy5mcmFtZXMuam9pbignJyk7DQogICAgICAgICAgICB0aGlzLmZyYW1lcyA9IG51bGw7DQogICAgICAgICAgICBjb25zdCBqc29uTWVzcyA9IGpzb25FdmFsKGZ1bGxNZXNzKTsNCiAgICAgICAgICAgIC8vaGFuZGxlIHRoZSBtZXNzYWdlDQogICAgICAgICAgICB0aGlzLm9uTWVzc2FnZShqc29uTWVzcyk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogQHBhcmFtIGZyYW1lQ291bnQgLSBUaGUgbnVtYmVyIG9mIGZyYW1lcyB3ZSBhcmUgZXhwZWN0aW5nIGZyb20gdGhlIHNlcnZlcg0KICAgICAqLw0KICAgIGhhbmRsZU5ld0ZyYW1lQ291bnRfKGZyYW1lQ291bnQpIHsNCiAgICAgICAgdGhpcy50b3RhbEZyYW1lcyA9IGZyYW1lQ291bnQ7DQogICAgICAgIHRoaXMuZnJhbWVzID0gW107DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEF0dGVtcHRzIHRvIHBhcnNlIGEgZnJhbWUgY291bnQgb3V0IG9mIHNvbWUgdGV4dC4gSWYgaXQgY2FuJ3QsIGFzc3VtZXMgYSB2YWx1ZSBvZiAxDQogICAgICogQHJldHVybnMgQW55IHJlbWFpbmluZyBkYXRhIHRvIGJlIHByb2Nlc3MsIG9yIG51bGwgaWYgdGhlcmUgaXMgbm9uZQ0KICAgICAqLw0KICAgIGV4dHJhY3RGcmFtZUNvdW50XyhkYXRhKSB7DQogICAgICAgIGFzc2VydCh0aGlzLmZyYW1lcyA9PT0gbnVsbCwgJ1dlIGFscmVhZHkgaGF2ZSBhIGZyYW1lIGJ1ZmZlcicpOw0KICAgICAgICAvLyBUT0RPOiBUaGUgc2VydmVyIGlzIG9ubHkgc3VwcG9zZWQgdG8gc2VuZCB1cCB0byA5OTk5IGZyYW1lcyAoaS5lLiBsZW5ndGggPD0gNCksIGJ1dCB0aGF0IGlzbid0IGJlaW5nIGVuZm9yY2VkDQogICAgICAgIC8vIGN1cnJlbnRseS4gIFNvIGFsbG93aW5nIGxhcmdlciBmcmFtZSBjb3VudHMgKGxlbmd0aCA8PSA2KS4gIFNlZSBodHRwczovL2FwcC5hc2FuYS5jb20vMC9zZWFyY2gvODY4ODU5ODk5ODM4MC84MjM3NjA4MDQyNTA4DQogICAgICAgIGlmIChkYXRhLmxlbmd0aCA8PSA2KSB7DQogICAgICAgICAgICBjb25zdCBmcmFtZUNvdW50ID0gTnVtYmVyKGRhdGEpOw0KICAgICAgICAgICAgaWYgKCFpc05hTihmcmFtZUNvdW50KSkgew0KICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlTmV3RnJhbWVDb3VudF8oZnJhbWVDb3VudCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5oYW5kbGVOZXdGcmFtZUNvdW50XygxKTsNCiAgICAgICAgcmV0dXJuIGRhdGE7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFByb2Nlc3MgYSB3ZWJzb2NrZXQgZnJhbWUgdGhhdCBoYXMgYXJyaXZlZCBmcm9tIHRoZSBzZXJ2ZXIuDQogICAgICogQHBhcmFtIG1lc3MgLSBUaGUgZnJhbWUgZGF0YQ0KICAgICAqLw0KICAgIGhhbmRsZUluY29taW5nRnJhbWUobWVzcykgew0KICAgICAgICBpZiAodGhpcy5teVNvY2sgPT09IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybjsgLy8gQ2hyb21lIGFwcGFyZW50bHkgZGVsaXZlcnMgaW5jb21pbmcgcGFja2V0cyBldmVuIGFmdGVyIHdlIC5jbG9zZSgpIHRoZSBjb25uZWN0aW9uIHNvbWV0aW1lcy4NCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBkYXRhID0gbWVzc1snZGF0YSddOw0KICAgICAgICB0aGlzLmJ5dGVzUmVjZWl2ZWQgKz0gZGF0YS5sZW5ndGg7DQogICAgICAgIHRoaXMuc3RhdHNfLmluY3JlbWVudENvdW50ZXIoJ2J5dGVzX3JlY2VpdmVkJywgZGF0YS5sZW5ndGgpOw0KICAgICAgICB0aGlzLnJlc2V0S2VlcEFsaXZlKCk7DQogICAgICAgIGlmICh0aGlzLmZyYW1lcyAhPT0gbnVsbCkgew0KICAgICAgICAgICAgLy8gd2UncmUgYnVmZmVyaW5nDQogICAgICAgICAgICB0aGlzLmFwcGVuZEZyYW1lXyhkYXRhKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIC8vIHRyeSB0byBwYXJzZSBvdXQgYSBmcmFtZSBjb3VudCwgb3RoZXJ3aXNlLCBhc3N1bWUgMSBhbmQgcHJvY2VzcyBpdA0KICAgICAgICAgICAgY29uc3QgcmVtYWluaW5nRGF0YSA9IHRoaXMuZXh0cmFjdEZyYW1lQ291bnRfKGRhdGEpOw0KICAgICAgICAgICAgaWYgKHJlbWFpbmluZ0RhdGEgIT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZEZyYW1lXyhyZW1haW5pbmdEYXRhKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBTZW5kIGEgbWVzc2FnZSB0byB0aGUgc2VydmVyDQogICAgICogQHBhcmFtIGRhdGEgLSBUaGUgSlNPTiBvYmplY3QgdG8gdHJhbnNtaXQNCiAgICAgKi8NCiAgICBzZW5kKGRhdGEpIHsNCiAgICAgICAgdGhpcy5yZXNldEtlZXBBbGl2ZSgpOw0KICAgICAgICBjb25zdCBkYXRhU3RyID0gc3RyaW5naWZ5KGRhdGEpOw0KICAgICAgICB0aGlzLmJ5dGVzU2VudCArPSBkYXRhU3RyLmxlbmd0aDsNCiAgICAgICAgdGhpcy5zdGF0c18uaW5jcmVtZW50Q291bnRlcignYnl0ZXNfc2VudCcsIGRhdGFTdHIubGVuZ3RoKTsNCiAgICAgICAgLy9XZSBjYW4gb25seSBmaXQgYSBjZXJ0YWluIGFtb3VudCBpbiBlYWNoIHdlYnNvY2tldCBmcmFtZSwgc28gd2UgbmVlZCB0byBzcGxpdCB0aGlzIHJlcXVlc3QNCiAgICAgICAgLy91cCBpbnRvIG11bHRpcGxlIHBpZWNlcyBpZiBpdCBkb2Vzbid0IGZpdCBpbiBvbmUgcmVxdWVzdC4NCiAgICAgICAgY29uc3QgZGF0YVNlZ3MgPSBzcGxpdFN0cmluZ0J5U2l6ZShkYXRhU3RyLCBXRUJTT0NLRVRfTUFYX0ZSQU1FX1NJWkUpOw0KICAgICAgICAvL1NlbmQgdGhlIGxlbmd0aCBoZWFkZXINCiAgICAgICAgaWYgKGRhdGFTZWdzLmxlbmd0aCA+IDEpIHsNCiAgICAgICAgICAgIHRoaXMuc2VuZFN0cmluZ18oU3RyaW5nKGRhdGFTZWdzLmxlbmd0aCkpOw0KICAgICAgICB9DQogICAgICAgIC8vU2VuZCB0aGUgYWN0dWFsIGRhdGEgaW4gc2VnbWVudHMuDQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YVNlZ3MubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHRoaXMuc2VuZFN0cmluZ18oZGF0YVNlZ3NbaV0pOw0KICAgICAgICB9DQogICAgfQ0KICAgIHNodXRkb3duXygpIHsNCiAgICAgICAgdGhpcy5pc0Nsb3NlZF8gPSB0cnVlOw0KICAgICAgICBpZiAodGhpcy5rZWVwYWxpdmVUaW1lcikgew0KICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmtlZXBhbGl2ZVRpbWVyKTsNCiAgICAgICAgICAgIHRoaXMua2VlcGFsaXZlVGltZXIgPSBudWxsOw0KICAgICAgICB9DQogICAgICAgIGlmICh0aGlzLm15U29jaykgew0KICAgICAgICAgICAgdGhpcy5teVNvY2suY2xvc2UoKTsNCiAgICAgICAgICAgIHRoaXMubXlTb2NrID0gbnVsbDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBvbkNsb3NlZF8oKSB7DQogICAgICAgIGlmICghdGhpcy5pc0Nsb3NlZF8pIHsNCiAgICAgICAgICAgIHRoaXMubG9nXygnV2ViU29ja2V0IGlzIGNsb3NpbmcgaXRzZWxmJyk7DQogICAgICAgICAgICB0aGlzLnNodXRkb3duXygpOw0KICAgICAgICAgICAgLy8gc2luY2UgdGhpcyBpcyBhbiBpbnRlcm5hbCBjbG9zZSwgdHJpZ2dlciB0aGUgY2xvc2UgbGlzdGVuZXINCiAgICAgICAgICAgIGlmICh0aGlzLm9uRGlzY29ubmVjdCkgew0KICAgICAgICAgICAgICAgIHRoaXMub25EaXNjb25uZWN0KHRoaXMuZXZlckNvbm5lY3RlZF8pOw0KICAgICAgICAgICAgICAgIHRoaXMub25EaXNjb25uZWN0ID0gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBFeHRlcm5hbC1mYWNpbmcgY2xvc2UgaGFuZGxlci4NCiAgICAgKiBDbG9zZSB0aGUgd2Vic29ja2V0IGFuZCBraWxsIHRoZSBjb25uZWN0aW9uLg0KICAgICAqLw0KICAgIGNsb3NlKCkgew0KICAgICAgICBpZiAoIXRoaXMuaXNDbG9zZWRfKSB7DQogICAgICAgICAgICB0aGlzLmxvZ18oJ1dlYlNvY2tldCBpcyBiZWluZyBjbG9zZWQnKTsNCiAgICAgICAgICAgIHRoaXMuc2h1dGRvd25fKCk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogS2lsbCB0aGUgY3VycmVudCBrZWVwYWxpdmUgdGltZXIgYW5kIHN0YXJ0IGEgbmV3IG9uZSwgdG8gZW5zdXJlIHRoYXQgaXQgYWx3YXlzIGZpcmVzIE4gc2Vjb25kcyBhZnRlcg0KICAgICAqIHRoZSBsYXN0IGFjdGl2aXR5Lg0KICAgICAqLw0KICAgIHJlc2V0S2VlcEFsaXZlKCkgew0KICAgICAgICBjbGVhckludGVydmFsKHRoaXMua2VlcGFsaXZlVGltZXIpOw0KICAgICAgICB0aGlzLmtlZXBhbGl2ZVRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4gew0KICAgICAgICAgICAgLy9JZiB0aGVyZSBoYXMgYmVlbiBubyB3ZWJzb2NrZXQgYWN0aXZpdHkgZm9yIGEgd2hpbGUsIHNlbmQgYSBuby1vcA0KICAgICAgICAgICAgaWYgKHRoaXMubXlTb2NrKSB7DQogICAgICAgICAgICAgICAgdGhpcy5zZW5kU3RyaW5nXygnMCcpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5yZXNldEtlZXBBbGl2ZSgpOw0KICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgfSwgTWF0aC5mbG9vcihXRUJTT0NLRVRfS0VFUEFMSVZFX0lOVEVSVkFMKSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFNlbmQgYSBzdHJpbmcgb3ZlciB0aGUgd2Vic29ja2V0Lg0KICAgICAqDQogICAgICogQHBhcmFtIHN0ciAtIFN0cmluZyB0byBzZW5kLg0KICAgICAqLw0KICAgIHNlbmRTdHJpbmdfKHN0cikgew0KICAgICAgICAvLyBGaXJlZm94IHNlZW1zIHRvIHNvbWV0aW1lcyB0aHJvdyBleGNlcHRpb25zIChOU19FUlJPUl9VTkVYUEVDVEVEKSBmcm9tIHdlYnNvY2tldCAuc2VuZCgpDQogICAgICAgIC8vIGNhbGxzIGZvciBzb21lIHVua25vd24gcmVhc29uLiAgV2UgdHJlYXQgdGhlc2UgYXMgYW4gZXJyb3IgYW5kIGRpc2Nvbm5lY3QuDQogICAgICAgIC8vIFNlZSBodHRwczovL2FwcC5hc2FuYS5jb20vMC81ODkyNjExMTQwMjI5Mi82ODAyMTM0MDI1MDQxMA0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgdGhpcy5teVNvY2suc2VuZChzdHIpOw0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICB0aGlzLmxvZ18oJ0V4Y2VwdGlvbiB0aHJvd24gZnJvbSBXZWJTb2NrZXQuc2VuZCgpOicsIGUubWVzc2FnZSB8fCBlLmRhdGEsICdDbG9zaW5nIGNvbm5lY3Rpb24uJyk7DQogICAgICAgICAgICBzZXRUaW1lb3V0KHRoaXMub25DbG9zZWRfLmJpbmQodGhpcyksIDApOw0KICAgICAgICB9DQogICAgfQ0KfQ0KLyoqDQogKiBOdW1iZXIgb2YgcmVzcG9uc2UgYmVmb3JlIHdlIGNvbnNpZGVyIHRoZSBjb25uZWN0aW9uICJoZWFsdGh5LiINCiAqLw0KV2ViU29ja2V0Q29ubmVjdGlvbi5yZXNwb25zZXNSZXF1aXJlZFRvQmVIZWFsdGh5ID0gMjsNCi8qKg0KICogVGltZSB0byB3YWl0IGZvciB0aGUgY29ubmVjdGlvbiB0ZSBiZWNvbWUgaGVhbHRoeSBiZWZvcmUgZ2l2aW5nIHVwLg0KICovDQpXZWJTb2NrZXRDb25uZWN0aW9uLmhlYWx0aHlUaW1lb3V0ID0gMzAwMDA7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIEN1cnJlbnRseSBzaW1wbGlzdGljLCB0aGlzIGNsYXNzIG1hbmFnZXMgd2hhdCB0cmFuc3BvcnQgYSBDb25uZWN0aW9uIHNob3VsZCB1c2UgYXQgdmFyaW91cyBzdGFnZXMgb2YgaXRzDQogKiBsaWZlY3ljbGUuDQogKg0KICogSXQgc3RhcnRzIHdpdGggbG9uZ3BvbGxpbmcgaW4gYSBicm93c2VyLCBhbmQgaHR0cHBvbGxpbmcgb24gbm9kZS4gSXQgdGhlbiB1cGdyYWRlcyB0byB3ZWJzb2NrZXRzIGlmDQogKiB0aGV5IGFyZSBhdmFpbGFibGUuDQogKi8NCmNsYXNzIFRyYW5zcG9ydE1hbmFnZXIgew0KICAgIC8qKg0KICAgICAqIEBwYXJhbSByZXBvSW5mbyAtIE1ldGFkYXRhIGFyb3VuZCB0aGUgbmFtZXNwYWNlIHdlJ3JlIGNvbm5lY3RpbmcgdG8NCiAgICAgKi8NCiAgICBjb25zdHJ1Y3RvcihyZXBvSW5mbykgew0KICAgICAgICB0aGlzLmluaXRUcmFuc3BvcnRzXyhyZXBvSW5mbyk7DQogICAgfQ0KICAgIHN0YXRpYyBnZXQgQUxMX1RSQU5TUE9SVFMoKSB7DQogICAgICAgIHJldHVybiBbQnJvd3NlclBvbGxDb25uZWN0aW9uLCBXZWJTb2NrZXRDb25uZWN0aW9uXTsNCiAgICB9DQogICAgLyoqDQogICAgICogUmV0dXJucyB3aGV0aGVyIHRyYW5zcG9ydCBoYXMgYmVlbiBzZWxlY3RlZCB0byBlbnN1cmUgV2ViU29ja2V0Q29ubmVjdGlvbiBvciBCcm93c2VyUG9sbENvbm5lY3Rpb24gYXJlIG5vdCBjYWxsZWQgYWZ0ZXINCiAgICAgKiBUcmFuc3BvcnRNYW5hZ2VyIGhhcyBhbHJlYWR5IHNldCB1cCB0cmFuc3BvcnRzXw0KICAgICAqLw0KICAgIHN0YXRpYyBnZXQgSVNfVFJBTlNQT1JUX0lOSVRJQUxJWkVEKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5nbG9iYWxUcmFuc3BvcnRJbml0aWFsaXplZF87DQogICAgfQ0KICAgIGluaXRUcmFuc3BvcnRzXyhyZXBvSW5mbykgew0KICAgICAgICBjb25zdCBpc1dlYlNvY2tldHNBdmFpbGFibGUgPSBXZWJTb2NrZXRDb25uZWN0aW9uICYmIFdlYlNvY2tldENvbm5lY3Rpb25bJ2lzQXZhaWxhYmxlJ10oKTsNCiAgICAgICAgbGV0IGlzU2tpcFBvbGxDb25uZWN0aW9uID0gaXNXZWJTb2NrZXRzQXZhaWxhYmxlICYmICFXZWJTb2NrZXRDb25uZWN0aW9uLnByZXZpb3VzbHlGYWlsZWQoKTsNCiAgICAgICAgaWYgKHJlcG9JbmZvLndlYlNvY2tldE9ubHkpIHsNCiAgICAgICAgICAgIGlmICghaXNXZWJTb2NrZXRzQXZhaWxhYmxlKSB7DQogICAgICAgICAgICAgICAgd2Fybigid3NzOi8vIFVSTCB1c2VkLCBidXQgYnJvd3NlciBpc24ndCBrbm93biB0byBzdXBwb3J0IHdlYnNvY2tldHMuICBUcnlpbmcgYW55d2F5LiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaXNTa2lwUG9sbENvbm5lY3Rpb24gPSB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGlmIChpc1NraXBQb2xsQ29ubmVjdGlvbikgew0KICAgICAgICAgICAgdGhpcy50cmFuc3BvcnRzXyA9IFtXZWJTb2NrZXRDb25uZWN0aW9uXTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IHRyYW5zcG9ydHMgPSAodGhpcy50cmFuc3BvcnRzXyA9IFtdKTsNCiAgICAgICAgICAgIGZvciAoY29uc3QgdHJhbnNwb3J0IG9mIFRyYW5zcG9ydE1hbmFnZXIuQUxMX1RSQU5TUE9SVFMpIHsNCiAgICAgICAgICAgICAgICBpZiAodHJhbnNwb3J0ICYmIHRyYW5zcG9ydFsnaXNBdmFpbGFibGUnXSgpKSB7DQogICAgICAgICAgICAgICAgICAgIHRyYW5zcG9ydHMucHVzaCh0cmFuc3BvcnQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIFRyYW5zcG9ydE1hbmFnZXIuZ2xvYmFsVHJhbnNwb3J0SW5pdGlhbGl6ZWRfID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBUaGUgY29uc3RydWN0b3IgZm9yIHRoZSBpbml0aWFsIHRyYW5zcG9ydCB0byB1c2UNCiAgICAgKi8NCiAgICBpbml0aWFsVHJhbnNwb3J0KCkgew0KICAgICAgICBpZiAodGhpcy50cmFuc3BvcnRzXy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy50cmFuc3BvcnRzX1swXTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gdHJhbnNwb3J0cyBhdmFpbGFibGUnKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBUaGUgY29uc3RydWN0b3IgZm9yIHRoZSBuZXh0IHRyYW5zcG9ydCwgb3IgbnVsbA0KICAgICAqLw0KICAgIHVwZ3JhZGVUcmFuc3BvcnQoKSB7DQogICAgICAgIGlmICh0aGlzLnRyYW5zcG9ydHNfLmxlbmd0aCA+IDEpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLnRyYW5zcG9ydHNfWzFdOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICB9DQp9DQovLyBLZWVwcyB0cmFjayBvZiB3aGV0aGVyIHRoZSBUcmFuc3BvcnRNYW5hZ2VyIGhhcyBhbHJlYWR5IGNob3NlbiBhIHRyYW5zcG9ydCB0byB1c2UNClRyYW5zcG9ydE1hbmFnZXIuZ2xvYmFsVHJhbnNwb3J0SW5pdGlhbGl6ZWRfID0gZmFsc2U7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovLyBBYm9ydCB1cGdyYWRlIGF0dGVtcHQgaWYgaXQgdGFrZXMgbG9uZ2VyIHRoYW4gNjBzLg0KY29uc3QgVVBHUkFERV9USU1FT1VUID0gNjAwMDA7DQovLyBGb3Igc29tZSB0cmFuc3BvcnRzIChXZWJTb2NrZXRzKSwgd2UgbmVlZCB0byAidmFsaWRhdGUiIHRoZSB0cmFuc3BvcnQgYnkgZXhjaGFuZ2luZyBhIGZldyByZXF1ZXN0cyBhbmQgcmVzcG9uc2VzLg0KLy8gSWYgd2UgaGF2ZW4ndCBzZW50IGVub3VnaCByZXF1ZXN0cyB3aXRoaW4gNXMsIHdlJ2xsIHN0YXJ0IHNlbmRpbmcgbm9vcCBwaW5nIHJlcXVlc3RzLg0KY29uc3QgREVMQVlfQkVGT1JFX1NFTkRJTkdfRVhUUkFfUkVRVUVTVFMgPSA1MDAwOw0KLy8gSWYgdGhlIGluaXRpYWwgZGF0YSBzZW50IHRyaWdnZXJzIGEgbG90IG9mIGJhbmR3aWR0aCAoaS5lLiBpdCdzIGEgbGFyZ2UgcHV0IG9yIGEgbGlzdGVuIGZvciBhIGxhcmdlIGFtb3VudCBvZiBkYXRhKQ0KLy8gdGhlbiB3ZSBtYXkgbm90IGJlIGFibGUgdG8gZXhjaGFuZ2Ugb3VyIHBpbmcvcG9uZyByZXF1ZXN0cyB3aXRoaW4gdGhlIGhlYWx0aHkgdGltZW91dC4gIFNvIGlmIHdlIHJlYWNoIHRoZSB0aW1lb3V0DQovLyBidXQgd2UndmUgc2VudC9yZWNlaXZlZCBlbm91Z2ggYnl0ZXMsIHdlIGRvbid0IGNhbmNlbCB0aGUgY29ubmVjdGlvbi4NCmNvbnN0IEJZVEVTX1NFTlRfSEVBTFRIWV9PVkVSUklERSA9IDEwICogMTAyNDsNCmNvbnN0IEJZVEVTX1JFQ0VJVkVEX0hFQUxUSFlfT1ZFUlJJREUgPSAxMDAgKiAxMDI0Ow0KY29uc3QgTUVTU0FHRV9UWVBFID0gJ3QnOw0KY29uc3QgTUVTU0FHRV9EQVRBID0gJ2QnOw0KY29uc3QgQ09OVFJPTF9TSFVURE9XTiA9ICdzJzsNCmNvbnN0IENPTlRST0xfUkVTRVQgPSAncic7DQpjb25zdCBDT05UUk9MX0VSUk9SID0gJ2UnOw0KY29uc3QgQ09OVFJPTF9QT05HID0gJ28nOw0KY29uc3QgU1dJVENIX0FDSyA9ICdhJzsNCmNvbnN0IEVORF9UUkFOU01JU1NJT04gPSAnbic7DQpjb25zdCBQSU5HID0gJ3AnOw0KY29uc3QgU0VSVkVSX0hFTExPID0gJ2gnOw0KLyoqDQogKiBDcmVhdGVzIGEgbmV3IHJlYWwtdGltZSBjb25uZWN0aW9uIHRvIHRoZSBzZXJ2ZXIgdXNpbmcgd2hpY2hldmVyIG1ldGhvZCB3b3Jrcw0KICogYmVzdCBpbiB0aGUgY3VycmVudCBicm93c2VyLg0KICovDQpjbGFzcyBDb25uZWN0aW9uIHsNCiAgICAvKioNCiAgICAgKiBAcGFyYW0gaWQgLSBhbiBpZCBmb3IgdGhpcyBjb25uZWN0aW9uDQogICAgICogQHBhcmFtIHJlcG9JbmZvXyAtIHRoZSBpbmZvIGZvciB0aGUgZW5kcG9pbnQgdG8gY29ubmVjdCB0bw0KICAgICAqIEBwYXJhbSBhcHBsaWNhdGlvbklkXyAtIHRoZSBGaXJlYmFzZSBBcHAgSUQgZm9yIHRoaXMgcHJvamVjdA0KICAgICAqIEBwYXJhbSBhcHBDaGVja1Rva2VuXyAtIFRoZSBBcHAgQ2hlY2sgVG9rZW4gZm9yIHRoaXMgZGV2aWNlLg0KICAgICAqIEBwYXJhbSBhdXRoVG9rZW5fIC0gVGhlIGF1dGggdG9rZW4gZm9yIHRoaXMgc2Vzc2lvbi4NCiAgICAgKiBAcGFyYW0gb25NZXNzYWdlXyAtIHRoZSBjYWxsYmFjayB0byBiZSB0cmlnZ2VyZWQgd2hlbiBhIHNlcnZlci1wdXNoIG1lc3NhZ2UgYXJyaXZlcw0KICAgICAqIEBwYXJhbSBvblJlYWR5XyAtIHRoZSBjYWxsYmFjayB0byBiZSB0cmlnZ2VyZWQgd2hlbiB0aGlzIGNvbm5lY3Rpb24gaXMgcmVhZHkgdG8gc2VuZCBtZXNzYWdlcy4NCiAgICAgKiBAcGFyYW0gb25EaXNjb25uZWN0XyAtIHRoZSBjYWxsYmFjayB0byBiZSB0cmlnZ2VyZWQgd2hlbiBhIGNvbm5lY3Rpb24gd2FzIGxvc3QNCiAgICAgKiBAcGFyYW0gb25LaWxsXyAtIHRoZSBjYWxsYmFjayB0byBiZSB0cmlnZ2VyZWQgd2hlbiB0aGlzIGNvbm5lY3Rpb24gaGFzIHBlcm1hbmVudGx5IHNodXQgZG93bi4NCiAgICAgKiBAcGFyYW0gbGFzdFNlc3Npb25JZCAtIGxhc3Qgc2Vzc2lvbiBpZCBpbiBwZXJzaXN0ZW50IGNvbm5lY3Rpb24uIGlzIHVzZWQgdG8gY2xlYW4gdXAgb2xkIHNlc3Npb24gaW4gcmVhbC10aW1lIHNlcnZlcg0KICAgICAqLw0KICAgIGNvbnN0cnVjdG9yKGlkLCByZXBvSW5mb18sIGFwcGxpY2F0aW9uSWRfLCBhcHBDaGVja1Rva2VuXywgYXV0aFRva2VuXywgb25NZXNzYWdlXywgb25SZWFkeV8sIG9uRGlzY29ubmVjdF8sIG9uS2lsbF8sIGxhc3RTZXNzaW9uSWQpIHsNCiAgICAgICAgdGhpcy5pZCA9IGlkOw0KICAgICAgICB0aGlzLnJlcG9JbmZvXyA9IHJlcG9JbmZvXzsNCiAgICAgICAgdGhpcy5hcHBsaWNhdGlvbklkXyA9IGFwcGxpY2F0aW9uSWRfOw0KICAgICAgICB0aGlzLmFwcENoZWNrVG9rZW5fID0gYXBwQ2hlY2tUb2tlbl87DQogICAgICAgIHRoaXMuYXV0aFRva2VuXyA9IGF1dGhUb2tlbl87DQogICAgICAgIHRoaXMub25NZXNzYWdlXyA9IG9uTWVzc2FnZV87DQogICAgICAgIHRoaXMub25SZWFkeV8gPSBvblJlYWR5XzsNCiAgICAgICAgdGhpcy5vbkRpc2Nvbm5lY3RfID0gb25EaXNjb25uZWN0XzsNCiAgICAgICAgdGhpcy5vbktpbGxfID0gb25LaWxsXzsNCiAgICAgICAgdGhpcy5sYXN0U2Vzc2lvbklkID0gbGFzdFNlc3Npb25JZDsNCiAgICAgICAgdGhpcy5jb25uZWN0aW9uQ291bnQgPSAwOw0KICAgICAgICB0aGlzLnBlbmRpbmdEYXRhTWVzc2FnZXMgPSBbXTsNCiAgICAgICAgdGhpcy5zdGF0ZV8gPSAwIC8qIFJlYWx0aW1lU3RhdGUuQ09OTkVDVElORyAqLzsNCiAgICAgICAgdGhpcy5sb2dfID0gbG9nV3JhcHBlcignYzonICsgdGhpcy5pZCArICc6Jyk7DQogICAgICAgIHRoaXMudHJhbnNwb3J0TWFuYWdlcl8gPSBuZXcgVHJhbnNwb3J0TWFuYWdlcihyZXBvSW5mb18pOw0KICAgICAgICB0aGlzLmxvZ18oJ0Nvbm5lY3Rpb24gY3JlYXRlZCcpOw0KICAgICAgICB0aGlzLnN0YXJ0XygpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBTdGFydHMgYSBjb25uZWN0aW9uIGF0dGVtcHQNCiAgICAgKi8NCiAgICBzdGFydF8oKSB7DQogICAgICAgIGNvbnN0IGNvbm4gPSB0aGlzLnRyYW5zcG9ydE1hbmFnZXJfLmluaXRpYWxUcmFuc3BvcnQoKTsNCiAgICAgICAgdGhpcy5jb25uXyA9IG5ldyBjb25uKHRoaXMubmV4dFRyYW5zcG9ydElkXygpLCB0aGlzLnJlcG9JbmZvXywgdGhpcy5hcHBsaWNhdGlvbklkXywgdGhpcy5hcHBDaGVja1Rva2VuXywgdGhpcy5hdXRoVG9rZW5fLCBudWxsLCB0aGlzLmxhc3RTZXNzaW9uSWQpOw0KICAgICAgICAvLyBGb3IgY2VydGFpbiB0cmFuc3BvcnRzIChXZWJTb2NrZXRzKSwgd2UgbmVlZCB0byBzZW5kIGFuZCByZWNlaXZlIHNldmVyYWwgbWVzc2FnZXMgYmFjayBhbmQgZm9ydGggYmVmb3JlIHdlDQogICAgICAgIC8vIGNhbiBjb25zaWRlciB0aGUgdHJhbnNwb3J0IGhlYWx0aHkuDQogICAgICAgIHRoaXMucHJpbWFyeVJlc3BvbnNlc1JlcXVpcmVkXyA9IGNvbm5bJ3Jlc3BvbnNlc1JlcXVpcmVkVG9CZUhlYWx0aHknXSB8fCAwOw0KICAgICAgICBjb25zdCBvbk1lc3NhZ2VSZWNlaXZlZCA9IHRoaXMuY29ublJlY2VpdmVyXyh0aGlzLmNvbm5fKTsNCiAgICAgICAgY29uc3Qgb25Db25uZWN0aW9uTG9zdCA9IHRoaXMuZGlzY29ublJlY2VpdmVyXyh0aGlzLmNvbm5fKTsNCiAgICAgICAgdGhpcy50eF8gPSB0aGlzLmNvbm5fOw0KICAgICAgICB0aGlzLnJ4XyA9IHRoaXMuY29ubl87DQogICAgICAgIHRoaXMuc2Vjb25kYXJ5Q29ubl8gPSBudWxsOw0KICAgICAgICB0aGlzLmlzSGVhbHRoeV8gPSBmYWxzZTsNCiAgICAgICAgLyoNCiAgICAgICAgICogRmlyZWZveCBkb2Vzbid0IGxpa2Ugd2hlbiBjb2RlIGZyb20gb25lIGlmcmFtZSB0cmllcyB0byBjcmVhdGUgYW5vdGhlciBpZnJhbWUgYnkgd2F5IG9mIHRoZSBwYXJlbnQgZnJhbWUuDQogICAgICAgICAqIFRoaXMgY2FuIG9jY3VyIGluIHRoZSBjYXNlIG9mIGEgcmVkaXJlY3QsIGkuZS4gd2UgZ3Vlc3NlZCB3cm9uZyBvbiB3aGF0IHNlcnZlciB0byBjb25uZWN0IHRvIGFuZCByZWNlaXZlZCBhIHJlc2V0Lg0KICAgICAgICAgKiBTb21laG93LCBzZXRUaW1lb3V0IHNlZW1zIHRvIG1ha2UgdGhpcyBvay4gVGhhdCBkb2Vzbid0IG1ha2Ugc2Vuc2UgZnJvbSBhIHNlY3VyaXR5IHBlcnNwZWN0aXZlLCBzaW5jZSB5b3Ugc2hvdWxkDQogICAgICAgICAqIHN0aWxsIGhhdmUgdGhlIGNvbnRleHQgb2YgeW91ciBvcmlnaW5hdGluZyBmcmFtZS4NCiAgICAgICAgICovDQogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgLy8gdGhpcy5jb25uXyBnZXRzIHNldCB0byBudWxsIGluIHNvbWUgb2YgdGhlIHRlc3RzLiBDaGVjayB0byBtYWtlIHN1cmUgaXQgc3RpbGwgZXhpc3RzIGJlZm9yZSB1c2luZyBpdA0KICAgICAgICAgICAgdGhpcy5jb25uXyAmJiB0aGlzLmNvbm5fLm9wZW4ob25NZXNzYWdlUmVjZWl2ZWQsIG9uQ29ubmVjdGlvbkxvc3QpOw0KICAgICAgICB9LCBNYXRoLmZsb29yKDApKTsNCiAgICAgICAgY29uc3QgaGVhbHRoeVRpbWVvdXRNUyA9IGNvbm5bJ2hlYWx0aHlUaW1lb3V0J10gfHwgMDsNCiAgICAgICAgaWYgKGhlYWx0aHlUaW1lb3V0TVMgPiAwKSB7DQogICAgICAgICAgICB0aGlzLmhlYWx0aHlUaW1lb3V0XyA9IHNldFRpbWVvdXROb25CbG9ja2luZygoKSA9PiB7DQogICAgICAgICAgICAgICAgdGhpcy5oZWFsdGh5VGltZW91dF8gPSBudWxsOw0KICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0hlYWx0aHlfKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbm5fICYmDQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5fLmJ5dGVzUmVjZWl2ZWQgPiBCWVRFU19SRUNFSVZFRF9IRUFMVEhZX09WRVJSSURFKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ18oJ0Nvbm5lY3Rpb24gZXhjZWVkZWQgaGVhbHRoeSB0aW1lb3V0IGJ1dCBoYXMgcmVjZWl2ZWQgJyArDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uXy5ieXRlc1JlY2VpdmVkICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIGJ5dGVzLiAgTWFya2luZyBjb25uZWN0aW9uIGhlYWx0aHkuJyk7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzSGVhbHRoeV8gPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uXy5tYXJrQ29ubmVjdGlvbkhlYWx0aHkoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLmNvbm5fICYmDQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5fLmJ5dGVzU2VudCA+IEJZVEVTX1NFTlRfSEVBTFRIWV9PVkVSUklERSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dfKCdDb25uZWN0aW9uIGV4Y2VlZGVkIGhlYWx0aHkgdGltZW91dCBidXQgaGFzIHNlbnQgJyArDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uXy5ieXRlc1NlbnQgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgYnl0ZXMuICBMZWF2aW5nIGNvbm5lY3Rpb24gYWxpdmUuJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBOT1RFOiBXZSBkb24ndCB3YW50IHRvIG1hcmsgaXQgaGVhbHRoeSwgc2luY2Ugd2UgaGF2ZSBubyBndWFyYW50ZWUgdGhhdCB0aGUgYnl0ZXMgaGF2ZSBtYWRlIGl0IHRvDQogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgc2VydmVyLg0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dfKCdDbG9zaW5nIHVuaGVhbHRoeSBjb25uZWN0aW9uIGFmdGVyIHRpbWVvdXQuJyk7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgICAgIH0sIE1hdGguZmxvb3IoaGVhbHRoeVRpbWVvdXRNUykpOw0KICAgICAgICB9DQogICAgfQ0KICAgIG5leHRUcmFuc3BvcnRJZF8oKSB7DQogICAgICAgIHJldHVybiAnYzonICsgdGhpcy5pZCArICc6JyArIHRoaXMuY29ubmVjdGlvbkNvdW50Kys7DQogICAgfQ0KICAgIGRpc2Nvbm5SZWNlaXZlcl8oY29ubikgew0KICAgICAgICByZXR1cm4gZXZlckNvbm5lY3RlZCA9PiB7DQogICAgICAgICAgICBpZiAoY29ubiA9PT0gdGhpcy5jb25uXykgew0KICAgICAgICAgICAgICAgIHRoaXMub25Db25uZWN0aW9uTG9zdF8oZXZlckNvbm5lY3RlZCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChjb25uID09PSB0aGlzLnNlY29uZGFyeUNvbm5fKSB7DQogICAgICAgICAgICAgICAgdGhpcy5sb2dfKCdTZWNvbmRhcnkgY29ubmVjdGlvbiBsb3N0LicpOw0KICAgICAgICAgICAgICAgIHRoaXMub25TZWNvbmRhcnlDb25uZWN0aW9uTG9zdF8oKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIHRoaXMubG9nXygnY2xvc2luZyBhbiBvbGQgY29ubmVjdGlvbicpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgIH0NCiAgICBjb25uUmVjZWl2ZXJfKGNvbm4pIHsNCiAgICAgICAgcmV0dXJuIChtZXNzYWdlKSA9PiB7DQogICAgICAgICAgICBpZiAodGhpcy5zdGF0ZV8gIT09IDIgLyogUmVhbHRpbWVTdGF0ZS5ESVNDT05ORUNURUQgKi8pIHsNCiAgICAgICAgICAgICAgICBpZiAoY29ubiA9PT0gdGhpcy5yeF8pIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5vblByaW1hcnlNZXNzYWdlUmVjZWl2ZWRfKG1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChjb25uID09PSB0aGlzLnNlY29uZGFyeUNvbm5fKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMub25TZWNvbmRhcnlNZXNzYWdlUmVjZWl2ZWRfKG1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dfKCdtZXNzYWdlIG9uIG9sZCBjb25uZWN0aW9uJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcGFyYW0gZGF0YU1zZyAtIEFuIGFyYml0cmFyeSBkYXRhIG1lc3NhZ2UgdG8gYmUgc2VudCB0byB0aGUgc2VydmVyDQogICAgICovDQogICAgc2VuZFJlcXVlc3QoZGF0YU1zZykgew0KICAgICAgICAvLyB3cmFwIGluIGEgZGF0YSBtZXNzYWdlIGVudmVsb3BlIGFuZCBzZW5kIGl0IG9uDQogICAgICAgIGNvbnN0IG1zZyA9IHsgdDogJ2QnLCBkOiBkYXRhTXNnIH07DQogICAgICAgIHRoaXMuc2VuZERhdGFfKG1zZyk7DQogICAgfQ0KICAgIHRyeUNsZWFudXBDb25uZWN0aW9uKCkgew0KICAgICAgICBpZiAodGhpcy50eF8gPT09IHRoaXMuc2Vjb25kYXJ5Q29ubl8gJiYgdGhpcy5yeF8gPT09IHRoaXMuc2Vjb25kYXJ5Q29ubl8pIHsNCiAgICAgICAgICAgIHRoaXMubG9nXygnY2xlYW5pbmcgdXAgYW5kIHByb21vdGluZyBhIGNvbm5lY3Rpb246ICcgKyB0aGlzLnNlY29uZGFyeUNvbm5fLmNvbm5JZCk7DQogICAgICAgICAgICB0aGlzLmNvbm5fID0gdGhpcy5zZWNvbmRhcnlDb25uXzsNCiAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5Q29ubl8gPSBudWxsOw0KICAgICAgICAgICAgLy8gdGhlIHNlcnZlciB3aWxsIHNodXRkb3duIHRoZSBvbGQgY29ubmVjdGlvbg0KICAgICAgICB9DQogICAgfQ0KICAgIG9uU2Vjb25kYXJ5Q29udHJvbF8oY29udHJvbERhdGEpIHsNCiAgICAgICAgaWYgKE1FU1NBR0VfVFlQRSBpbiBjb250cm9sRGF0YSkgew0KICAgICAgICAgICAgY29uc3QgY21kID0gY29udHJvbERhdGFbTUVTU0FHRV9UWVBFXTsNCiAgICAgICAgICAgIGlmIChjbWQgPT09IFNXSVRDSF9BQ0spIHsNCiAgICAgICAgICAgICAgICB0aGlzLnVwZ3JhZGVJZlNlY29uZGFyeUhlYWx0aHlfKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChjbWQgPT09IENPTlRST0xfUkVTRVQpIHsNCiAgICAgICAgICAgICAgICAvLyBNb3N0IGxpa2VseSB0aGUgc2Vzc2lvbiB3YXNuJ3QgdmFsaWQuIEFiYW5kb24gdGhlIHN3aXRjaCBhdHRlbXB0DQogICAgICAgICAgICAgICAgdGhpcy5sb2dfKCdHb3QgYSByZXNldCBvbiBzZWNvbmRhcnksIGNsb3NpbmcgaXQnKTsNCiAgICAgICAgICAgICAgICB0aGlzLnNlY29uZGFyeUNvbm5fLmNsb3NlKCk7DQogICAgICAgICAgICAgICAgLy8gSWYgd2Ugd2VyZSBhbHJlYWR5IHVzaW5nIHRoaXMgY29ubmVjdGlvbiBmb3Igc29tZXRoaW5nLCB0aGFuIHdlIG5lZWQgdG8gZnVsbHkgY2xvc2UNCiAgICAgICAgICAgICAgICBpZiAodGhpcy50eF8gPT09IHRoaXMuc2Vjb25kYXJ5Q29ubl8gfHwNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5yeF8gPT09IHRoaXMuc2Vjb25kYXJ5Q29ubl8pIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKGNtZCA9PT0gQ09OVFJPTF9QT05HKSB7DQogICAgICAgICAgICAgICAgdGhpcy5sb2dfKCdnb3QgcG9uZyBvbiBzZWNvbmRhcnkuJyk7DQogICAgICAgICAgICAgICAgdGhpcy5zZWNvbmRhcnlSZXNwb25zZXNSZXF1aXJlZF8tLTsNCiAgICAgICAgICAgICAgICB0aGlzLnVwZ3JhZGVJZlNlY29uZGFyeUhlYWx0aHlfKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgb25TZWNvbmRhcnlNZXNzYWdlUmVjZWl2ZWRfKHBhcnNlZERhdGEpIHsNCiAgICAgICAgY29uc3QgbGF5ZXIgPSByZXF1aXJlS2V5KCd0JywgcGFyc2VkRGF0YSk7DQogICAgICAgIGNvbnN0IGRhdGEgPSByZXF1aXJlS2V5KCdkJywgcGFyc2VkRGF0YSk7DQogICAgICAgIGlmIChsYXllciA9PT0gJ2MnKSB7DQogICAgICAgICAgICB0aGlzLm9uU2Vjb25kYXJ5Q29udHJvbF8oZGF0YSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAobGF5ZXIgPT09ICdkJykgew0KICAgICAgICAgICAgLy8gZ290IGEgZGF0YSBtZXNzYWdlLCBidXQgd2UncmUgc3RpbGwgc2Vjb25kIGNvbm5lY3Rpb24uIE5lZWQgdG8gYnVmZmVyIGl0IHVwDQogICAgICAgICAgICB0aGlzLnBlbmRpbmdEYXRhTWVzc2FnZXMucHVzaChkYXRhKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5rbm93biBwcm90b2NvbCBsYXllcjogJyArIGxheWVyKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICB1cGdyYWRlSWZTZWNvbmRhcnlIZWFsdGh5XygpIHsNCiAgICAgICAgaWYgKHRoaXMuc2Vjb25kYXJ5UmVzcG9uc2VzUmVxdWlyZWRfIDw9IDApIHsNCiAgICAgICAgICAgIHRoaXMubG9nXygnU2Vjb25kYXJ5IGNvbm5lY3Rpb24gaXMgaGVhbHRoeS4nKTsNCiAgICAgICAgICAgIHRoaXMuaXNIZWFsdGh5XyA9IHRydWU7DQogICAgICAgICAgICB0aGlzLnNlY29uZGFyeUNvbm5fLm1hcmtDb25uZWN0aW9uSGVhbHRoeSgpOw0KICAgICAgICAgICAgdGhpcy5wcm9jZWVkV2l0aFVwZ3JhZGVfKCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAvLyBTZW5kIGEgcGluZyB0byBtYWtlIHN1cmUgdGhlIGNvbm5lY3Rpb24gaXMgaGVhbHRoeS4NCiAgICAgICAgICAgIHRoaXMubG9nXygnc2VuZGluZyBwaW5nIG9uIHNlY29uZGFyeS4nKTsNCiAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5Q29ubl8uc2VuZCh7IHQ6ICdjJywgZDogeyB0OiBQSU5HLCBkOiB7fSB9IH0pOw0KICAgICAgICB9DQogICAgfQ0KICAgIHByb2NlZWRXaXRoVXBncmFkZV8oKSB7DQogICAgICAgIC8vIHRlbGwgdGhpcyBjb25uZWN0aW9uIHRvIGNvbnNpZGVyIGl0c2VsZiBvcGVuDQogICAgICAgIHRoaXMuc2Vjb25kYXJ5Q29ubl8uc3RhcnQoKTsNCiAgICAgICAgLy8gc2VuZCBhY2sNCiAgICAgICAgdGhpcy5sb2dfKCdzZW5kaW5nIGNsaWVudCBhY2sgb24gc2Vjb25kYXJ5Jyk7DQogICAgICAgIHRoaXMuc2Vjb25kYXJ5Q29ubl8uc2VuZCh7IHQ6ICdjJywgZDogeyB0OiBTV0lUQ0hfQUNLLCBkOiB7fSB9IH0pOw0KICAgICAgICAvLyBzZW5kIGVuZCBwYWNrZXQgb24gcHJpbWFyeSB0cmFuc3BvcnQsIHN3aXRjaCB0byBzZW5kaW5nIG9uIHRoaXMgb25lDQogICAgICAgIC8vIGNhbiByZWNlaXZlIG9uIHRoaXMgb25lLCBidWZmZXIgcmVzcG9uc2VzIHVudGlsIGVuZCByZWNlaXZlZCBvbiBwcmltYXJ5IHRyYW5zcG9ydA0KICAgICAgICB0aGlzLmxvZ18oJ0VuZGluZyB0cmFuc21pc3Npb24gb24gcHJpbWFyeScpOw0KICAgICAgICB0aGlzLmNvbm5fLnNlbmQoeyB0OiAnYycsIGQ6IHsgdDogRU5EX1RSQU5TTUlTU0lPTiwgZDoge30gfSB9KTsNCiAgICAgICAgdGhpcy50eF8gPSB0aGlzLnNlY29uZGFyeUNvbm5fOw0KICAgICAgICB0aGlzLnRyeUNsZWFudXBDb25uZWN0aW9uKCk7DQogICAgfQ0KICAgIG9uUHJpbWFyeU1lc3NhZ2VSZWNlaXZlZF8ocGFyc2VkRGF0YSkgew0KICAgICAgICAvLyBNdXN0IHJlZmVyIHRvIHBhcnNlZERhdGEgcHJvcGVydGllcyBpbiBxdW90ZXMsIHNvIGNsb3N1cmUgZG9lc24ndCB0b3VjaCB0aGVtLg0KICAgICAgICBjb25zdCBsYXllciA9IHJlcXVpcmVLZXkoJ3QnLCBwYXJzZWREYXRhKTsNCiAgICAgICAgY29uc3QgZGF0YSA9IHJlcXVpcmVLZXkoJ2QnLCBwYXJzZWREYXRhKTsNCiAgICAgICAgaWYgKGxheWVyID09PSAnYycpIHsNCiAgICAgICAgICAgIHRoaXMub25Db250cm9sXyhkYXRhKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChsYXllciA9PT0gJ2QnKSB7DQogICAgICAgICAgICB0aGlzLm9uRGF0YU1lc3NhZ2VfKGRhdGEpOw0KICAgICAgICB9DQogICAgfQ0KICAgIG9uRGF0YU1lc3NhZ2VfKG1lc3NhZ2UpIHsNCiAgICAgICAgdGhpcy5vblByaW1hcnlSZXNwb25zZV8oKTsNCiAgICAgICAgLy8gV2UgZG9uJ3QgZG8gYW55dGhpbmcgd2l0aCBkYXRhIG1lc3NhZ2VzLCBqdXN0IGtpY2sgdGhlbSB1cCBhIGxldmVsDQogICAgICAgIHRoaXMub25NZXNzYWdlXyhtZXNzYWdlKTsNCiAgICB9DQogICAgb25QcmltYXJ5UmVzcG9uc2VfKCkgew0KICAgICAgICBpZiAoIXRoaXMuaXNIZWFsdGh5Xykgew0KICAgICAgICAgICAgdGhpcy5wcmltYXJ5UmVzcG9uc2VzUmVxdWlyZWRfLS07DQogICAgICAgICAgICBpZiAodGhpcy5wcmltYXJ5UmVzcG9uc2VzUmVxdWlyZWRfIDw9IDApIHsNCiAgICAgICAgICAgICAgICB0aGlzLmxvZ18oJ1ByaW1hcnkgY29ubmVjdGlvbiBpcyBoZWFsdGh5LicpOw0KICAgICAgICAgICAgICAgIHRoaXMuaXNIZWFsdGh5XyA9IHRydWU7DQogICAgICAgICAgICAgICAgdGhpcy5jb25uXy5tYXJrQ29ubmVjdGlvbkhlYWx0aHkoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBvbkNvbnRyb2xfKGNvbnRyb2xEYXRhKSB7DQogICAgICAgIGNvbnN0IGNtZCA9IHJlcXVpcmVLZXkoTUVTU0FHRV9UWVBFLCBjb250cm9sRGF0YSk7DQogICAgICAgIGlmIChNRVNTQUdFX0RBVEEgaW4gY29udHJvbERhdGEpIHsNCiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSBjb250cm9sRGF0YVtNRVNTQUdFX0RBVEFdOw0KICAgICAgICAgICAgaWYgKGNtZCA9PT0gU0VSVkVSX0hFTExPKSB7DQogICAgICAgICAgICAgICAgY29uc3QgaGFuZHNoYWtlUGF5bG9hZCA9IE9iamVjdC5hc3NpZ24oe30sIHBheWxvYWQpOw0KICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlcG9JbmZvXy5pc1VzaW5nRW11bGF0b3IpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gVXBvbiBjb25uZWN0aW5nLCB0aGUgZW11bGF0b3Igd2lsbCBwYXNzIHRoZSBob3N0bmFtZSB0aGF0IGl0J3MgYXdhcmUgb2YsIGJ1dCB3ZSBwcmVmZXIgdGhlIHVzZXIncyBzZXQgaG9zdG5hbWUgdmlhIGBjb25uZWN0RGF0YWJhc2VFbXVsYXRvcmAgb3ZlciB3aGF0IHRoZSBlbXVsYXRvciBwYXNzZXMuDQogICAgICAgICAgICAgICAgICAgIGhhbmRzaGFrZVBheWxvYWQuaCA9IHRoaXMucmVwb0luZm9fLmhvc3Q7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHRoaXMub25IYW5kc2hha2VfKGhhbmRzaGFrZVBheWxvYWQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoY21kID09PSBFTkRfVFJBTlNNSVNTSU9OKSB7DQogICAgICAgICAgICAgICAgdGhpcy5sb2dfKCdyZWN2ZCBlbmQgdHJhbnNtaXNzaW9uIG9uIHByaW1hcnknKTsNCiAgICAgICAgICAgICAgICB0aGlzLnJ4XyA9IHRoaXMuc2Vjb25kYXJ5Q29ubl87DQogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBlbmRpbmdEYXRhTWVzc2FnZXMubGVuZ3RoOyArK2kpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkRhdGFNZXNzYWdlXyh0aGlzLnBlbmRpbmdEYXRhTWVzc2FnZXNbaV0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB0aGlzLnBlbmRpbmdEYXRhTWVzc2FnZXMgPSBbXTsNCiAgICAgICAgICAgICAgICB0aGlzLnRyeUNsZWFudXBDb25uZWN0aW9uKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChjbWQgPT09IENPTlRST0xfU0hVVERPV04pIHsNCiAgICAgICAgICAgICAgICAvLyBUaGlzIHdhcyBwcmV2aW91c2x5IHRoZSAnb25LaWxsJyBjYWxsYmFjayBwYXNzZWQgdG8gdGhlIGxvd2VyLWxldmVsIGNvbm5lY3Rpb24NCiAgICAgICAgICAgICAgICAvLyBwYXlsb2FkIGluIHRoaXMgY2FzZSBpcyB0aGUgcmVhc29uIGZvciB0aGUgc2h1dGRvd24uIEdlbmVyYWxseSBhIGh1bWFuLXJlYWRhYmxlIGVycm9yDQogICAgICAgICAgICAgICAgdGhpcy5vbkNvbm5lY3Rpb25TaHV0ZG93bl8ocGF5bG9hZCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChjbWQgPT09IENPTlRST0xfUkVTRVQpIHsNCiAgICAgICAgICAgICAgICAvLyBwYXlsb2FkIGluIHRoaXMgY2FzZSBpcyB0aGUgaG9zdCB3ZSBzaG91bGQgY29udGFjdA0KICAgICAgICAgICAgICAgIHRoaXMub25SZXNldF8ocGF5bG9hZCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChjbWQgPT09IENPTlRST0xfRVJST1IpIHsNCiAgICAgICAgICAgICAgICBlcnJvciQxKCdTZXJ2ZXIgRXJyb3I6ICcgKyBwYXlsb2FkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKGNtZCA9PT0gQ09OVFJPTF9QT05HKSB7DQogICAgICAgICAgICAgICAgdGhpcy5sb2dfKCdnb3QgcG9uZyBvbiBwcmltYXJ5LicpOw0KICAgICAgICAgICAgICAgIHRoaXMub25QcmltYXJ5UmVzcG9uc2VfKCk7DQogICAgICAgICAgICAgICAgdGhpcy5zZW5kUGluZ09uUHJpbWFyeUlmTmVjZXNzYXJ5XygpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgZXJyb3IkMSgnVW5rbm93biBjb250cm9sIHBhY2tldCBjb21tYW5kOiAnICsgY21kKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcGFyYW0gaGFuZHNoYWtlIC0gVGhlIGhhbmRzaGFrZSBkYXRhIHJldHVybmVkIGZyb20gdGhlIHNlcnZlcg0KICAgICAqLw0KICAgIG9uSGFuZHNoYWtlXyhoYW5kc2hha2UpIHsNCiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gaGFuZHNoYWtlLnRzOw0KICAgICAgICBjb25zdCB2ZXJzaW9uID0gaGFuZHNoYWtlLnY7DQogICAgICAgIGNvbnN0IGhvc3QgPSBoYW5kc2hha2UuaDsNCiAgICAgICAgdGhpcy5zZXNzaW9uSWQgPSBoYW5kc2hha2UuczsNCiAgICAgICAgdGhpcy5yZXBvSW5mb18uaG9zdCA9IGhvc3Q7DQogICAgICAgIC8vIGlmIHdlJ3ZlIGFscmVhZHkgY2xvc2VkIHRoZSBjb25uZWN0aW9uLCB0aGVuIGRvbid0IGJvdGhlciB0cnlpbmcgdG8gcHJvZ3Jlc3MgZnVydGhlcg0KICAgICAgICBpZiAodGhpcy5zdGF0ZV8gPT09IDAgLyogUmVhbHRpbWVTdGF0ZS5DT05ORUNUSU5HICovKSB7DQogICAgICAgICAgICB0aGlzLmNvbm5fLnN0YXJ0KCk7DQogICAgICAgICAgICB0aGlzLm9uQ29ubmVjdGlvbkVzdGFibGlzaGVkXyh0aGlzLmNvbm5fLCB0aW1lc3RhbXApOw0KICAgICAgICAgICAgaWYgKFBST1RPQ09MX1ZFUlNJT04gIT09IHZlcnNpb24pIHsNCiAgICAgICAgICAgICAgICB3YXJuKCdQcm90b2NvbCB2ZXJzaW9uIG1pc21hdGNoIGRldGVjdGVkJyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvLyBUT0RPOiBkbyB3ZSB3YW50IHRvIHVwZ3JhZGU/IHdoZW4/IG1heWJlIGEgZGVsYXk/DQogICAgICAgICAgICB0aGlzLnRyeVN0YXJ0VXBncmFkZV8oKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICB0cnlTdGFydFVwZ3JhZGVfKCkgew0KICAgICAgICBjb25zdCBjb25uID0gdGhpcy50cmFuc3BvcnRNYW5hZ2VyXy51cGdyYWRlVHJhbnNwb3J0KCk7DQogICAgICAgIGlmIChjb25uKSB7DQogICAgICAgICAgICB0aGlzLnN0YXJ0VXBncmFkZV8oY29ubik7DQogICAgICAgIH0NCiAgICB9DQogICAgc3RhcnRVcGdyYWRlXyhjb25uKSB7DQogICAgICAgIHRoaXMuc2Vjb25kYXJ5Q29ubl8gPSBuZXcgY29ubih0aGlzLm5leHRUcmFuc3BvcnRJZF8oKSwgdGhpcy5yZXBvSW5mb18sIHRoaXMuYXBwbGljYXRpb25JZF8sIHRoaXMuYXBwQ2hlY2tUb2tlbl8sIHRoaXMuYXV0aFRva2VuXywgdGhpcy5zZXNzaW9uSWQpOw0KICAgICAgICAvLyBGb3IgY2VydGFpbiB0cmFuc3BvcnRzIChXZWJTb2NrZXRzKSwgd2UgbmVlZCB0byBzZW5kIGFuZCByZWNlaXZlIHNldmVyYWwgbWVzc2FnZXMgYmFjayBhbmQgZm9ydGggYmVmb3JlIHdlDQogICAgICAgIC8vIGNhbiBjb25zaWRlciB0aGUgdHJhbnNwb3J0IGhlYWx0aHkuDQogICAgICAgIHRoaXMuc2Vjb25kYXJ5UmVzcG9uc2VzUmVxdWlyZWRfID0NCiAgICAgICAgICAgIGNvbm5bJ3Jlc3BvbnNlc1JlcXVpcmVkVG9CZUhlYWx0aHknXSB8fCAwOw0KICAgICAgICBjb25zdCBvbk1lc3NhZ2UgPSB0aGlzLmNvbm5SZWNlaXZlcl8odGhpcy5zZWNvbmRhcnlDb25uXyk7DQogICAgICAgIGNvbnN0IG9uRGlzY29ubmVjdCA9IHRoaXMuZGlzY29ublJlY2VpdmVyXyh0aGlzLnNlY29uZGFyeUNvbm5fKTsNCiAgICAgICAgdGhpcy5zZWNvbmRhcnlDb25uXy5vcGVuKG9uTWVzc2FnZSwgb25EaXNjb25uZWN0KTsNCiAgICAgICAgLy8gSWYgd2UgaGF2ZW4ndCBzdWNjZXNzZnVsbHkgdXBncmFkZWQgYWZ0ZXIgVVBHUkFERV9USU1FT1VULCBnaXZlIHVwIGFuZCBraWxsIHRoZSBzZWNvbmRhcnkuDQogICAgICAgIHNldFRpbWVvdXROb25CbG9ja2luZygoKSA9PiB7DQogICAgICAgICAgICBpZiAodGhpcy5zZWNvbmRhcnlDb25uXykgew0KICAgICAgICAgICAgICAgIHRoaXMubG9nXygnVGltZWQgb3V0IHRyeWluZyB0byB1cGdyYWRlLicpOw0KICAgICAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5Q29ubl8uY2xvc2UoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwgTWF0aC5mbG9vcihVUEdSQURFX1RJTUVPVVQpKTsNCiAgICB9DQogICAgb25SZXNldF8oaG9zdCkgew0KICAgICAgICB0aGlzLmxvZ18oJ1Jlc2V0IHBhY2tldCByZWNlaXZlZC4gIE5ldyBob3N0OiAnICsgaG9zdCk7DQogICAgICAgIHRoaXMucmVwb0luZm9fLmhvc3QgPSBob3N0Ow0KICAgICAgICAvLyBUT0RPOiBpZiB3ZSdyZSBhbHJlYWR5ICJjb25uZWN0ZWQiLCB3ZSBuZWVkIHRvIHRyaWdnZXIgYSBkaXNjb25uZWN0IGF0IHRoZSBuZXh0IGxheWVyIHVwLg0KICAgICAgICAvLyBXZSBkb24ndCBjdXJyZW50bHkgc3VwcG9ydCByZXNldHMgYWZ0ZXIgdGhlIGNvbm5lY3Rpb24gaGFzIGFscmVhZHkgYmVlbiBlc3RhYmxpc2hlZA0KICAgICAgICBpZiAodGhpcy5zdGF0ZV8gPT09IDEgLyogUmVhbHRpbWVTdGF0ZS5DT05ORUNURUQgKi8pIHsNCiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIC8vIENsb3NlIHdoYXRldmVyIGNvbm5lY3Rpb25zIHdlIGhhdmUgb3BlbiBhbmQgc3RhcnQgYWdhaW4uDQogICAgICAgICAgICB0aGlzLmNsb3NlQ29ubmVjdGlvbnNfKCk7DQogICAgICAgICAgICB0aGlzLnN0YXJ0XygpOw0KICAgICAgICB9DQogICAgfQ0KICAgIG9uQ29ubmVjdGlvbkVzdGFibGlzaGVkXyhjb25uLCB0aW1lc3RhbXApIHsNCiAgICAgICAgdGhpcy5sb2dfKCdSZWFsdGltZSBjb25uZWN0aW9uIGVzdGFibGlzaGVkLicpOw0KICAgICAgICB0aGlzLmNvbm5fID0gY29ubjsNCiAgICAgICAgdGhpcy5zdGF0ZV8gPSAxIC8qIFJlYWx0aW1lU3RhdGUuQ09OTkVDVEVEICovOw0KICAgICAgICBpZiAodGhpcy5vblJlYWR5Xykgew0KICAgICAgICAgICAgdGhpcy5vblJlYWR5Xyh0aW1lc3RhbXAsIHRoaXMuc2Vzc2lvbklkKTsNCiAgICAgICAgICAgIHRoaXMub25SZWFkeV8gPSBudWxsOw0KICAgICAgICB9DQogICAgICAgIC8vIElmIGFmdGVyIDUgc2Vjb25kcyB3ZSBoYXZlbid0IHNlbnQgZW5vdWdoIHJlcXVlc3RzIHRvIHRoZSBzZXJ2ZXIgdG8gZ2V0IHRoZSBjb25uZWN0aW9uIGhlYWx0aHksDQogICAgICAgIC8vIHNlbmQgc29tZSBwaW5ncy4NCiAgICAgICAgaWYgKHRoaXMucHJpbWFyeVJlc3BvbnNlc1JlcXVpcmVkXyA9PT0gMCkgew0KICAgICAgICAgICAgdGhpcy5sb2dfKCdQcmltYXJ5IGNvbm5lY3Rpb24gaXMgaGVhbHRoeS4nKTsNCiAgICAgICAgICAgIHRoaXMuaXNIZWFsdGh5XyA9IHRydWU7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBzZXRUaW1lb3V0Tm9uQmxvY2tpbmcoKCkgPT4gew0KICAgICAgICAgICAgICAgIHRoaXMuc2VuZFBpbmdPblByaW1hcnlJZk5lY2Vzc2FyeV8oKTsNCiAgICAgICAgICAgIH0sIE1hdGguZmxvb3IoREVMQVlfQkVGT1JFX1NFTkRJTkdfRVhUUkFfUkVRVUVTVFMpKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBzZW5kUGluZ09uUHJpbWFyeUlmTmVjZXNzYXJ5XygpIHsNCiAgICAgICAgLy8gSWYgdGhlIGNvbm5lY3Rpb24gaXNuJ3QgY29uc2lkZXJlZCBoZWFsdGh5IHlldCwgd2UnbGwgc2VuZCBhIG5vb3AgcGluZyBwYWNrZXQgcmVxdWVzdC4NCiAgICAgICAgaWYgKCF0aGlzLmlzSGVhbHRoeV8gJiYgdGhpcy5zdGF0ZV8gPT09IDEgLyogUmVhbHRpbWVTdGF0ZS5DT05ORUNURUQgKi8pIHsNCiAgICAgICAgICAgIHRoaXMubG9nXygnc2VuZGluZyBwaW5nIG9uIHByaW1hcnkuJyk7DQogICAgICAgICAgICB0aGlzLnNlbmREYXRhXyh7IHQ6ICdjJywgZDogeyB0OiBQSU5HLCBkOiB7fSB9IH0pOw0KICAgICAgICB9DQogICAgfQ0KICAgIG9uU2Vjb25kYXJ5Q29ubmVjdGlvbkxvc3RfKCkgew0KICAgICAgICBjb25zdCBjb25uID0gdGhpcy5zZWNvbmRhcnlDb25uXzsNCiAgICAgICAgdGhpcy5zZWNvbmRhcnlDb25uXyA9IG51bGw7DQogICAgICAgIGlmICh0aGlzLnR4XyA9PT0gY29ubiB8fCB0aGlzLnJ4XyA9PT0gY29ubikgew0KICAgICAgICAgICAgLy8gd2UgYXJlIHJlbHlpbmcgb24gdGhpcyBjb25uZWN0aW9uIGFscmVhZHkgaW4gc29tZSBjYXBhY2l0eS4gVGhlcmVmb3JlLCBhIGZhaWx1cmUgaXMgcmVhbA0KICAgICAgICAgICAgdGhpcy5jbG9zZSgpOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEBwYXJhbSBldmVyQ29ubmVjdGVkIC0gV2hldGhlciBvciBub3QgdGhlIGNvbm5lY3Rpb24gZXZlciByZWFjaGVkIGEgc2VydmVyLiBVc2VkIHRvIGRldGVybWluZSBpZg0KICAgICAqIHdlIHNob3VsZCBmbHVzaCB0aGUgaG9zdCBjYWNoZQ0KICAgICAqLw0KICAgIG9uQ29ubmVjdGlvbkxvc3RfKGV2ZXJDb25uZWN0ZWQpIHsNCiAgICAgICAgdGhpcy5jb25uXyA9IG51bGw7DQogICAgICAgIC8vIE5PVEU6IElGIHlvdSdyZSBzZWVpbmcgYSBGaXJlZm94IGVycm9yIGZvciB0aGlzIGxpbmUsIEkgdGhpbmsgaXQgbWlnaHQgYmUgYmVjYXVzZSBpdCdzIGdldHRpbmcNCiAgICAgICAgLy8gY2FsbGVkIG9uIHdpbmRvdyBjbG9zZSBhbmQgUmVhbHRpbWVTdGF0ZS5DT05ORUNUSU5HIGlzIG5vIGxvbmdlciBkZWZpbmVkLiAgSnVzdCBhIGd1ZXNzLg0KICAgICAgICBpZiAoIWV2ZXJDb25uZWN0ZWQgJiYgdGhpcy5zdGF0ZV8gPT09IDAgLyogUmVhbHRpbWVTdGF0ZS5DT05ORUNUSU5HICovKSB7DQogICAgICAgICAgICB0aGlzLmxvZ18oJ1JlYWx0aW1lIGNvbm5lY3Rpb24gZmFpbGVkLicpOw0KICAgICAgICAgICAgLy8gU2luY2Ugd2UgZmFpbGVkIHRvIGNvbm5lY3QgYXQgYWxsLCBjbGVhciBhbnkgY2FjaGVkIGVudHJ5IGZvciB0aGlzIG5hbWVzcGFjZSBpbiBjYXNlIHRoZSBtYWNoaW5lIHdlbnQgYXdheQ0KICAgICAgICAgICAgaWYgKHRoaXMucmVwb0luZm9fLmlzQ2FjaGVhYmxlSG9zdCgpKSB7DQogICAgICAgICAgICAgICAgUGVyc2lzdGVudFN0b3JhZ2UucmVtb3ZlKCdob3N0OicgKyB0aGlzLnJlcG9JbmZvXy5ob3N0KTsNCiAgICAgICAgICAgICAgICAvLyByZXNldCB0aGUgaW50ZXJuYWwgaG9zdCB0byB3aGF0IHdlIHdvdWxkIHNob3cgdGhlIHVzZXIsIGkuZS4gPG5zPi5maXJlYmFzZWlvLmNvbQ0KICAgICAgICAgICAgICAgIHRoaXMucmVwb0luZm9fLmludGVybmFsSG9zdCA9IHRoaXMucmVwb0luZm9fLmhvc3Q7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAodGhpcy5zdGF0ZV8gPT09IDEgLyogUmVhbHRpbWVTdGF0ZS5DT05ORUNURUQgKi8pIHsNCiAgICAgICAgICAgIHRoaXMubG9nXygnUmVhbHRpbWUgY29ubmVjdGlvbiBsb3N0LicpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuY2xvc2UoKTsNCiAgICB9DQogICAgb25Db25uZWN0aW9uU2h1dGRvd25fKHJlYXNvbikgew0KICAgICAgICB0aGlzLmxvZ18oJ0Nvbm5lY3Rpb24gc2h1dGRvd24gY29tbWFuZCByZWNlaXZlZC4gU2h1dHRpbmcgZG93bi4uLicpOw0KICAgICAgICBpZiAodGhpcy5vbktpbGxfKSB7DQogICAgICAgICAgICB0aGlzLm9uS2lsbF8ocmVhc29uKTsNCiAgICAgICAgICAgIHRoaXMub25LaWxsXyA9IG51bGw7DQogICAgICAgIH0NCiAgICAgICAgLy8gV2UgaW50ZW50aW9uYWxseSBkb24ndCB3YW50IHRvIGZpcmUgb25EaXNjb25uZWN0IChraWxsIGlzIGEgZGlmZmVyZW50IGNhc2UpLA0KICAgICAgICAvLyBzbyBjbGVhciB0aGUgY2FsbGJhY2suDQogICAgICAgIHRoaXMub25EaXNjb25uZWN0XyA9IG51bGw7DQogICAgICAgIHRoaXMuY2xvc2UoKTsNCiAgICB9DQogICAgc2VuZERhdGFfKGRhdGEpIHsNCiAgICAgICAgaWYgKHRoaXMuc3RhdGVfICE9PSAxIC8qIFJlYWx0aW1lU3RhdGUuQ09OTkVDVEVEICovKSB7DQogICAgICAgICAgICB0aHJvdyAnQ29ubmVjdGlvbiBpcyBub3QgY29ubmVjdGVkJzsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMudHhfLnNlbmQoZGF0YSk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogQ2xlYW5zIHVwIHRoaXMgY29ubmVjdGlvbiwgY2FsbGluZyB0aGUgYXBwcm9wcmlhdGUgY2FsbGJhY2tzDQogICAgICovDQogICAgY2xvc2UoKSB7DQogICAgICAgIGlmICh0aGlzLnN0YXRlXyAhPT0gMiAvKiBSZWFsdGltZVN0YXRlLkRJU0NPTk5FQ1RFRCAqLykgew0KICAgICAgICAgICAgdGhpcy5sb2dfKCdDbG9zaW5nIHJlYWx0aW1lIGNvbm5lY3Rpb24uJyk7DQogICAgICAgICAgICB0aGlzLnN0YXRlXyA9IDIgLyogUmVhbHRpbWVTdGF0ZS5ESVNDT05ORUNURUQgKi87DQogICAgICAgICAgICB0aGlzLmNsb3NlQ29ubmVjdGlvbnNfKCk7DQogICAgICAgICAgICBpZiAodGhpcy5vbkRpc2Nvbm5lY3RfKSB7DQogICAgICAgICAgICAgICAgdGhpcy5vbkRpc2Nvbm5lY3RfKCk7DQogICAgICAgICAgICAgICAgdGhpcy5vbkRpc2Nvbm5lY3RfID0gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBjbG9zZUNvbm5lY3Rpb25zXygpIHsNCiAgICAgICAgdGhpcy5sb2dfKCdTaHV0dGluZyBkb3duIGFsbCBjb25uZWN0aW9ucycpOw0KICAgICAgICBpZiAodGhpcy5jb25uXykgew0KICAgICAgICAgICAgdGhpcy5jb25uXy5jbG9zZSgpOw0KICAgICAgICAgICAgdGhpcy5jb25uXyA9IG51bGw7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHRoaXMuc2Vjb25kYXJ5Q29ubl8pIHsNCiAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5Q29ubl8uY2xvc2UoKTsNCiAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5Q29ubl8gPSBudWxsOw0KICAgICAgICB9DQogICAgICAgIGlmICh0aGlzLmhlYWx0aHlUaW1lb3V0Xykgew0KICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuaGVhbHRoeVRpbWVvdXRfKTsNCiAgICAgICAgICAgIHRoaXMuaGVhbHRoeVRpbWVvdXRfID0gbnVsbDsNCiAgICAgICAgfQ0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogSW50ZXJmYWNlIGRlZmluaW5nIHRoZSBzZXQgb2YgYWN0aW9ucyB0aGF0IGNhbiBiZSBwZXJmb3JtZWQgYWdhaW5zdCB0aGUgRmlyZWJhc2Ugc2VydmVyDQogKiAoYmFzaWNhbGx5IGNvcnJlc3BvbmRzIHRvIG91ciB3aXJlIHByb3RvY29sKS4NCiAqDQogKiBAaW50ZXJmYWNlDQogKi8NCmNsYXNzIFNlcnZlckFjdGlvbnMgew0KICAgIHB1dChwYXRoU3RyaW5nLCBkYXRhLCBvbkNvbXBsZXRlLCBoYXNoKSB7IH0NCiAgICBtZXJnZShwYXRoU3RyaW5nLCBkYXRhLCBvbkNvbXBsZXRlLCBoYXNoKSB7IH0NCiAgICAvKioNCiAgICAgKiBSZWZyZXNoZXMgdGhlIGF1dGggdG9rZW4gZm9yIHRoZSBjdXJyZW50IGNvbm5lY3Rpb24uDQogICAgICogQHBhcmFtIHRva2VuIC0gVGhlIGF1dGhlbnRpY2F0aW9uIHRva2VuDQogICAgICovDQogICAgcmVmcmVzaEF1dGhUb2tlbih0b2tlbikgeyB9DQogICAgLyoqDQogICAgICogUmVmcmVzaGVzIHRoZSBhcHAgY2hlY2sgdG9rZW4gZm9yIHRoZSBjdXJyZW50IGNvbm5lY3Rpb24uDQogICAgICogQHBhcmFtIHRva2VuIFRoZSBhcHAgY2hlY2sgdG9rZW4NCiAgICAgKi8NCiAgICByZWZyZXNoQXBwQ2hlY2tUb2tlbih0b2tlbikgeyB9DQogICAgb25EaXNjb25uZWN0UHV0KHBhdGhTdHJpbmcsIGRhdGEsIG9uQ29tcGxldGUpIHsgfQ0KICAgIG9uRGlzY29ubmVjdE1lcmdlKHBhdGhTdHJpbmcsIGRhdGEsIG9uQ29tcGxldGUpIHsgfQ0KICAgIG9uRGlzY29ubmVjdENhbmNlbChwYXRoU3RyaW5nLCBvbkNvbXBsZXRlKSB7IH0NCiAgICByZXBvcnRTdGF0cyhzdGF0cykgeyB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIEJhc2UgY2xhc3MgdG8gYmUgdXNlZCBpZiB5b3Ugd2FudCB0byBlbWl0IGV2ZW50cy4gQ2FsbCB0aGUgY29uc3RydWN0b3Igd2l0aA0KICogdGhlIHNldCBvZiBhbGxvd2VkIGV2ZW50IG5hbWVzLg0KICovDQpjbGFzcyBFdmVudEVtaXR0ZXIgew0KICAgIGNvbnN0cnVjdG9yKGFsbG93ZWRFdmVudHNfKSB7DQogICAgICAgIHRoaXMuYWxsb3dlZEV2ZW50c18gPSBhbGxvd2VkRXZlbnRzXzsNCiAgICAgICAgdGhpcy5saXN0ZW5lcnNfID0ge307DQogICAgICAgIGFzc2VydChBcnJheS5pc0FycmF5KGFsbG93ZWRFdmVudHNfKSAmJiBhbGxvd2VkRXZlbnRzXy5sZW5ndGggPiAwLCAnUmVxdWlyZXMgYSBub24tZW1wdHkgYXJyYXknKTsNCiAgICB9DQogICAgLyoqDQogICAgICogVG8gYmUgY2FsbGVkIGJ5IGRlcml2ZWQgY2xhc3NlcyB0byB0cmlnZ2VyIGV2ZW50cy4NCiAgICAgKi8NCiAgICB0cmlnZ2VyKGV2ZW50VHlwZSwgLi4udmFyQXJncykgew0KICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLmxpc3RlbmVyc19bZXZlbnRUeXBlXSkpIHsNCiAgICAgICAgICAgIC8vIENsb25lIHRoZSBsaXN0LCBzaW5jZSBjYWxsYmFja3MgY291bGQgYWRkL3JlbW92ZSBsaXN0ZW5lcnMuDQogICAgICAgICAgICBjb25zdCBsaXN0ZW5lcnMgPSBbLi4udGhpcy5saXN0ZW5lcnNfW2V2ZW50VHlwZV1dOw0KICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaXN0ZW5lcnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICBsaXN0ZW5lcnNbaV0uY2FsbGJhY2suYXBwbHkobGlzdGVuZXJzW2ldLmNvbnRleHQsIHZhckFyZ3MpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIG9uKGV2ZW50VHlwZSwgY2FsbGJhY2ssIGNvbnRleHQpIHsNCiAgICAgICAgdGhpcy52YWxpZGF0ZUV2ZW50VHlwZV8oZXZlbnRUeXBlKTsNCiAgICAgICAgdGhpcy5saXN0ZW5lcnNfW2V2ZW50VHlwZV0gPSB0aGlzLmxpc3RlbmVyc19bZXZlbnRUeXBlXSB8fCBbXTsNCiAgICAgICAgdGhpcy5saXN0ZW5lcnNfW2V2ZW50VHlwZV0ucHVzaCh7IGNhbGxiYWNrLCBjb250ZXh0IH0pOw0KICAgICAgICBjb25zdCBldmVudERhdGEgPSB0aGlzLmdldEluaXRpYWxFdmVudChldmVudFR5cGUpOw0KICAgICAgICBpZiAoZXZlbnREYXRhKSB7DQogICAgICAgICAgICBjYWxsYmFjay5hcHBseShjb250ZXh0LCBldmVudERhdGEpOw0KICAgICAgICB9DQogICAgfQ0KICAgIG9mZihldmVudFR5cGUsIGNhbGxiYWNrLCBjb250ZXh0KSB7DQogICAgICAgIHRoaXMudmFsaWRhdGVFdmVudFR5cGVfKGV2ZW50VHlwZSk7DQogICAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMubGlzdGVuZXJzX1tldmVudFR5cGVdIHx8IFtdOw0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpc3RlbmVycy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKGxpc3RlbmVyc1tpXS5jYWxsYmFjayA9PT0gY2FsbGJhY2sgJiYNCiAgICAgICAgICAgICAgICAoIWNvbnRleHQgfHwgY29udGV4dCA9PT0gbGlzdGVuZXJzW2ldLmNvbnRleHQpKSB7DQogICAgICAgICAgICAgICAgbGlzdGVuZXJzLnNwbGljZShpLCAxKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgdmFsaWRhdGVFdmVudFR5cGVfKGV2ZW50VHlwZSkgew0KICAgICAgICBhc3NlcnQodGhpcy5hbGxvd2VkRXZlbnRzXy5maW5kKGV0ID0+IHsNCiAgICAgICAgICAgIHJldHVybiBldCA9PT0gZXZlbnRUeXBlOw0KICAgICAgICB9KSwgJ1Vua25vd24gZXZlbnQ6ICcgKyBldmVudFR5cGUpOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogTW9uaXRvcnMgb25saW5lIHN0YXRlIChhcyByZXBvcnRlZCBieSB3aW5kb3cub25saW5lL29mZmxpbmUgZXZlbnRzKS4NCiAqDQogKiBUaGUgZXhwZWN0YXRpb24gaXMgdGhhdCB0aGlzIGNvdWxkIGhhdmUgbWFueSBmYWxzZSBwb3NpdGl2ZXMgKHRoaW5rcyB3ZSBhcmUgb25saW5lDQogKiB3aGVuIHdlJ3JlIG5vdCksIGJ1dCBubyBmYWxzZSBuZWdhdGl2ZXMuICBTbyB3ZSBjYW4gc2FmZWx5IHVzZSBpdCB0byBkZXRlcm1pbmUgd2hlbg0KICogd2UgZGVmaW5pdGVseSBjYW5ub3QgcmVhY2ggdGhlIGludGVybmV0Lg0KICovDQpjbGFzcyBPbmxpbmVNb25pdG9yIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHsNCiAgICBjb25zdHJ1Y3RvcigpIHsNCiAgICAgICAgc3VwZXIoWydvbmxpbmUnXSk7DQogICAgICAgIHRoaXMub25saW5lXyA9IHRydWU7DQogICAgICAgIC8vIFdlJ3ZlIGhhZCByZXBlYXRlZCBjb21wbGFpbnRzIHRoYXQgQ29yZG92YSBhcHBzIGNhbiBnZXQgc3R1Y2sgIm9mZmxpbmUiLCBlLmcuDQogICAgICAgIC8vIGh0dHBzOi8vZm9ydW0uaW9uaWNmcmFtZXdvcmsuY29tL3QvZmlyZWJhc2UtY29ubmVjdGlvbi1pcy1sb3N0LWFuZC1uZXZlci1jb21lLWJhY2svNDM4MTANCiAgICAgICAgLy8gSXQgd291bGQgc2VlbSB0aGF0IHRoZSAnb25saW5lJyBldmVudCBkb2VzIG5vdCBhbHdheXMgZmlyZSBjb25zaXN0ZW50bHkuIFNvIHdlIGRpc2FibGUgaXQNCiAgICAgICAgLy8gZm9yIENvcmRvdmEuDQogICAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJg0KICAgICAgICAgICAgdHlwZW9mIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyICE9PSAndW5kZWZpbmVkJyAmJg0KICAgICAgICAgICAgIWlzTW9iaWxlQ29yZG92YSgpKSB7DQogICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb25saW5lJywgKCkgPT4gew0KICAgICAgICAgICAgICAgIGlmICghdGhpcy5vbmxpbmVfKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMub25saW5lXyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcignb25saW5lJywgdHJ1ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwgZmFsc2UpOw0KICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29mZmxpbmUnLCAoKSA9PiB7DQogICAgICAgICAgICAgICAgaWYgKHRoaXMub25saW5lXykgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLm9ubGluZV8gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdvbmxpbmUnLCBmYWxzZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwgZmFsc2UpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHN0YXRpYyBnZXRJbnN0YW5jZSgpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBPbmxpbmVNb25pdG9yKCk7DQogICAgfQ0KICAgIGdldEluaXRpYWxFdmVudChldmVudFR5cGUpIHsNCiAgICAgICAgYXNzZXJ0KGV2ZW50VHlwZSA9PT0gJ29ubGluZScsICdVbmtub3duIGV2ZW50IHR5cGU6ICcgKyBldmVudFR5cGUpOw0KICAgICAgICByZXR1cm4gW3RoaXMub25saW5lX107DQogICAgfQ0KICAgIGN1cnJlbnRseU9ubGluZSgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMub25saW5lXzsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKiogTWF4aW11bSBrZXkgZGVwdGguICovDQpjb25zdCBNQVhfUEFUSF9ERVBUSCA9IDMyOw0KLyoqIE1heGltdW0gbnVtYmVyIG9mIChVVEY4KSBieXRlcyBpbiBhIEZpcmViYXNlIHBhdGguICovDQpjb25zdCBNQVhfUEFUSF9MRU5HVEhfQllURVMgPSA3Njg7DQovKioNCiAqIEFuIGltbXV0YWJsZSBvYmplY3QgcmVwcmVzZW50aW5nIGEgcGFyc2VkIHBhdGguICBJdCdzIGltbXV0YWJsZSBzbyB0aGF0IHlvdQ0KICogY2FuIHBhc3MgdGhlbSBhcm91bmQgdG8gb3RoZXIgZnVuY3Rpb25zIHdpdGhvdXQgd29ycnlpbmcgYWJvdXQgdGhlbSBjaGFuZ2luZw0KICogaXQuDQogKi8NCmNsYXNzIFBhdGggew0KICAgIC8qKg0KICAgICAqIEBwYXJhbSBwYXRoT3JTdHJpbmcgLSBQYXRoIHN0cmluZyB0byBwYXJzZSwgb3IgYW5vdGhlciBwYXRoLCBvciB0aGUgcmF3DQogICAgICogdG9rZW5zIGFycmF5DQogICAgICovDQogICAgY29uc3RydWN0b3IocGF0aE9yU3RyaW5nLCBwaWVjZU51bSkgew0KICAgICAgICBpZiAocGllY2VOdW0gPT09IHZvaWQgMCkgew0KICAgICAgICAgICAgdGhpcy5waWVjZXNfID0gcGF0aE9yU3RyaW5nLnNwbGl0KCcvJyk7DQogICAgICAgICAgICAvLyBSZW1vdmUgZW1wdHkgcGllY2VzLg0KICAgICAgICAgICAgbGV0IGNvcHlUbyA9IDA7DQogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGllY2VzXy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIGlmICh0aGlzLnBpZWNlc19baV0ubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLnBpZWNlc19bY29weVRvXSA9IHRoaXMucGllY2VzX1tpXTsNCiAgICAgICAgICAgICAgICAgICAgY29weVRvKys7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5waWVjZXNfLmxlbmd0aCA9IGNvcHlUbzsNCiAgICAgICAgICAgIHRoaXMucGllY2VOdW1fID0gMDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMucGllY2VzXyA9IHBhdGhPclN0cmluZzsNCiAgICAgICAgICAgIHRoaXMucGllY2VOdW1fID0gcGllY2VOdW07DQogICAgICAgIH0NCiAgICB9DQogICAgdG9TdHJpbmcoKSB7DQogICAgICAgIGxldCBwYXRoU3RyaW5nID0gJyc7DQogICAgICAgIGZvciAobGV0IGkgPSB0aGlzLnBpZWNlTnVtXzsgaSA8IHRoaXMucGllY2VzXy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKHRoaXMucGllY2VzX1tpXSAhPT0gJycpIHsNCiAgICAgICAgICAgICAgICBwYXRoU3RyaW5nICs9ICcvJyArIHRoaXMucGllY2VzX1tpXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcGF0aFN0cmluZyB8fCAnLyc7DQogICAgfQ0KfQ0KZnVuY3Rpb24gbmV3RW1wdHlQYXRoKCkgew0KICAgIHJldHVybiBuZXcgUGF0aCgnJyk7DQp9DQpmdW5jdGlvbiBwYXRoR2V0RnJvbnQocGF0aCkgew0KICAgIGlmIChwYXRoLnBpZWNlTnVtXyA+PSBwYXRoLnBpZWNlc18ubGVuZ3RoKSB7DQogICAgICAgIHJldHVybiBudWxsOw0KICAgIH0NCiAgICByZXR1cm4gcGF0aC5waWVjZXNfW3BhdGgucGllY2VOdW1fXTsNCn0NCi8qKg0KICogQHJldHVybnMgVGhlIG51bWJlciBvZiBzZWdtZW50cyBpbiB0aGlzIHBhdGgNCiAqLw0KZnVuY3Rpb24gcGF0aEdldExlbmd0aChwYXRoKSB7DQogICAgcmV0dXJuIHBhdGgucGllY2VzXy5sZW5ndGggLSBwYXRoLnBpZWNlTnVtXzsNCn0NCmZ1bmN0aW9uIHBhdGhQb3BGcm9udChwYXRoKSB7DQogICAgbGV0IHBpZWNlTnVtID0gcGF0aC5waWVjZU51bV87DQogICAgaWYgKHBpZWNlTnVtIDwgcGF0aC5waWVjZXNfLmxlbmd0aCkgew0KICAgICAgICBwaWVjZU51bSsrOw0KICAgIH0NCiAgICByZXR1cm4gbmV3IFBhdGgocGF0aC5waWVjZXNfLCBwaWVjZU51bSk7DQp9DQpmdW5jdGlvbiBwYXRoR2V0QmFjayhwYXRoKSB7DQogICAgaWYgKHBhdGgucGllY2VOdW1fIDwgcGF0aC5waWVjZXNfLmxlbmd0aCkgew0KICAgICAgICByZXR1cm4gcGF0aC5waWVjZXNfW3BhdGgucGllY2VzXy5sZW5ndGggLSAxXTsNCiAgICB9DQogICAgcmV0dXJuIG51bGw7DQp9DQpmdW5jdGlvbiBwYXRoVG9VcmxFbmNvZGVkU3RyaW5nKHBhdGgpIHsNCiAgICBsZXQgcGF0aFN0cmluZyA9ICcnOw0KICAgIGZvciAobGV0IGkgPSBwYXRoLnBpZWNlTnVtXzsgaSA8IHBhdGgucGllY2VzXy5sZW5ndGg7IGkrKykgew0KICAgICAgICBpZiAocGF0aC5waWVjZXNfW2ldICE9PSAnJykgew0KICAgICAgICAgICAgcGF0aFN0cmluZyArPSAnLycgKyBlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKHBhdGgucGllY2VzX1tpXSkpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBwYXRoU3RyaW5nIHx8ICcvJzsNCn0NCi8qKg0KICogU2hhbGxvdyBjb3B5IG9mIHRoZSBwYXJ0cyBvZiB0aGUgcGF0aC4NCiAqDQogKi8NCmZ1bmN0aW9uIHBhdGhTbGljZShwYXRoLCBiZWdpbiA9IDApIHsNCiAgICByZXR1cm4gcGF0aC5waWVjZXNfLnNsaWNlKHBhdGgucGllY2VOdW1fICsgYmVnaW4pOw0KfQ0KZnVuY3Rpb24gcGF0aFBhcmVudChwYXRoKSB7DQogICAgaWYgKHBhdGgucGllY2VOdW1fID49IHBhdGgucGllY2VzXy5sZW5ndGgpIHsNCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KICAgIGNvbnN0IHBpZWNlcyA9IFtdOw0KICAgIGZvciAobGV0IGkgPSBwYXRoLnBpZWNlTnVtXzsgaSA8IHBhdGgucGllY2VzXy5sZW5ndGggLSAxOyBpKyspIHsNCiAgICAgICAgcGllY2VzLnB1c2gocGF0aC5waWVjZXNfW2ldKTsNCiAgICB9DQogICAgcmV0dXJuIG5ldyBQYXRoKHBpZWNlcywgMCk7DQp9DQpmdW5jdGlvbiBwYXRoQ2hpbGQocGF0aCwgY2hpbGRQYXRoT2JqKSB7DQogICAgY29uc3QgcGllY2VzID0gW107DQogICAgZm9yIChsZXQgaSA9IHBhdGgucGllY2VOdW1fOyBpIDwgcGF0aC5waWVjZXNfLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIHBpZWNlcy5wdXNoKHBhdGgucGllY2VzX1tpXSk7DQogICAgfQ0KICAgIGlmIChjaGlsZFBhdGhPYmogaW5zdGFuY2VvZiBQYXRoKSB7DQogICAgICAgIGZvciAobGV0IGkgPSBjaGlsZFBhdGhPYmoucGllY2VOdW1fOyBpIDwgY2hpbGRQYXRoT2JqLnBpZWNlc18ubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHBpZWNlcy5wdXNoKGNoaWxkUGF0aE9iai5waWVjZXNfW2ldKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3QgY2hpbGRQaWVjZXMgPSBjaGlsZFBhdGhPYmouc3BsaXQoJy8nKTsNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaGlsZFBpZWNlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKGNoaWxkUGllY2VzW2ldLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICBwaWVjZXMucHVzaChjaGlsZFBpZWNlc1tpXSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIG5ldyBQYXRoKHBpZWNlcywgMCk7DQp9DQovKioNCiAqIEByZXR1cm5zIFRydWUgaWYgdGhlcmUgYXJlIG5vIHNlZ21lbnRzIGluIHRoaXMgcGF0aA0KICovDQpmdW5jdGlvbiBwYXRoSXNFbXB0eShwYXRoKSB7DQogICAgcmV0dXJuIHBhdGgucGllY2VOdW1fID49IHBhdGgucGllY2VzXy5sZW5ndGg7DQp9DQovKioNCiAqIEByZXR1cm5zIFRoZSBwYXRoIGZyb20gb3V0ZXJQYXRoIHRvIGlubmVyUGF0aA0KICovDQpmdW5jdGlvbiBuZXdSZWxhdGl2ZVBhdGgob3V0ZXJQYXRoLCBpbm5lclBhdGgpIHsNCiAgICBjb25zdCBvdXRlciA9IHBhdGhHZXRGcm9udChvdXRlclBhdGgpLCBpbm5lciA9IHBhdGhHZXRGcm9udChpbm5lclBhdGgpOw0KICAgIGlmIChvdXRlciA9PT0gbnVsbCkgew0KICAgICAgICByZXR1cm4gaW5uZXJQYXRoOw0KICAgIH0NCiAgICBlbHNlIGlmIChvdXRlciA9PT0gaW5uZXIpIHsNCiAgICAgICAgcmV0dXJuIG5ld1JlbGF0aXZlUGF0aChwYXRoUG9wRnJvbnQob3V0ZXJQYXRoKSwgcGF0aFBvcEZyb250KGlubmVyUGF0aCkpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJTlRFUk5BTCBFUlJPUjogaW5uZXJQYXRoICgnICsNCiAgICAgICAgICAgIGlubmVyUGF0aCArDQogICAgICAgICAgICAnKSBpcyBub3Qgd2l0aGluICcgKw0KICAgICAgICAgICAgJ291dGVyUGF0aCAoJyArDQogICAgICAgICAgICBvdXRlclBhdGggKw0KICAgICAgICAgICAgJyknKTsNCiAgICB9DQp9DQovKioNCiAqIEByZXR1cm5zIHRydWUgaWYgcGF0aHMgYXJlIHRoZSBzYW1lLg0KICovDQpmdW5jdGlvbiBwYXRoRXF1YWxzKHBhdGgsIG90aGVyKSB7DQogICAgaWYgKHBhdGhHZXRMZW5ndGgocGF0aCkgIT09IHBhdGhHZXRMZW5ndGgob3RoZXIpKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgZm9yIChsZXQgaSA9IHBhdGgucGllY2VOdW1fLCBqID0gb3RoZXIucGllY2VOdW1fOyBpIDw9IHBhdGgucGllY2VzXy5sZW5ndGg7IGkrKywgaisrKSB7DQogICAgICAgIGlmIChwYXRoLnBpZWNlc19baV0gIT09IG90aGVyLnBpZWNlc19bal0pIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gdHJ1ZTsNCn0NCi8qKg0KICogQHJldHVybnMgVHJ1ZSBpZiB0aGlzIHBhdGggaXMgYSBwYXJlbnQgb2YgKG9yIHRoZSBzYW1lIGFzKSBvdGhlcg0KICovDQpmdW5jdGlvbiBwYXRoQ29udGFpbnMocGF0aCwgb3RoZXIpIHsNCiAgICBsZXQgaSA9IHBhdGgucGllY2VOdW1fOw0KICAgIGxldCBqID0gb3RoZXIucGllY2VOdW1fOw0KICAgIGlmIChwYXRoR2V0TGVuZ3RoKHBhdGgpID4gcGF0aEdldExlbmd0aChvdGhlcikpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICB3aGlsZSAoaSA8IHBhdGgucGllY2VzXy5sZW5ndGgpIHsNCiAgICAgICAgaWYgKHBhdGgucGllY2VzX1tpXSAhPT0gb3RoZXIucGllY2VzX1tqXSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgICsraTsNCiAgICAgICAgKytqOw0KICAgIH0NCiAgICByZXR1cm4gdHJ1ZTsNCn0NCi8qKg0KICogRHluYW1pYyAobXV0YWJsZSkgcGF0aCB1c2VkIHRvIGNvdW50IHBhdGggbGVuZ3Rocy4NCiAqDQogKiBUaGlzIGNsYXNzIGlzIHVzZWQgdG8gZWZmaWNpZW50bHkgY2hlY2sgcGF0aHMgZm9yIHZhbGlkDQogKiBsZW5ndGggKGluIFVURjggYnl0ZXMpIGFuZCBkZXB0aCAodXNlZCBpbiBwYXRoIHZhbGlkYXRpb24pLg0KICoNCiAqIFRocm93cyBFcnJvciBleGNlcHRpb24gaWYgcGF0aCBpcyBldmVyIGludmFsaWQuDQogKg0KICogVGhlIGRlZmluaXRpb24gb2YgYSBwYXRoIGFsd2F5cyBiZWdpbnMgd2l0aCAnLycuDQogKi8NCmNsYXNzIFZhbGlkYXRpb25QYXRoIHsNCiAgICAvKioNCiAgICAgKiBAcGFyYW0gcGF0aCAtIEluaXRpYWwgUGF0aC4NCiAgICAgKiBAcGFyYW0gZXJyb3JQcmVmaXhfIC0gUHJlZml4IGZvciBhbnkgZXJyb3IgbWVzc2FnZXMuDQogICAgICovDQogICAgY29uc3RydWN0b3IocGF0aCwgZXJyb3JQcmVmaXhfKSB7DQogICAgICAgIHRoaXMuZXJyb3JQcmVmaXhfID0gZXJyb3JQcmVmaXhfOw0KICAgICAgICB0aGlzLnBhcnRzXyA9IHBhdGhTbGljZShwYXRoLCAwKTsNCiAgICAgICAgLyoqIEluaXRpYWxpemUgdG8gbnVtYmVyIG9mICcvJyBjaGFycyBuZWVkZWQgaW4gcGF0aC4gKi8NCiAgICAgICAgdGhpcy5ieXRlTGVuZ3RoXyA9IE1hdGgubWF4KDEsIHRoaXMucGFydHNfLmxlbmd0aCk7DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wYXJ0c18ubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHRoaXMuYnl0ZUxlbmd0aF8gKz0gc3RyaW5nTGVuZ3RoKHRoaXMucGFydHNfW2ldKTsNCiAgICAgICAgfQ0KICAgICAgICB2YWxpZGF0aW9uUGF0aENoZWNrVmFsaWQodGhpcyk7DQogICAgfQ0KfQ0KZnVuY3Rpb24gdmFsaWRhdGlvblBhdGhQdXNoKHZhbGlkYXRpb25QYXRoLCBjaGlsZCkgew0KICAgIC8vIENvdW50IHRoZSBuZWVkZWQgJy8nDQogICAgaWYgKHZhbGlkYXRpb25QYXRoLnBhcnRzXy5sZW5ndGggPiAwKSB7DQogICAgICAgIHZhbGlkYXRpb25QYXRoLmJ5dGVMZW5ndGhfICs9IDE7DQogICAgfQ0KICAgIHZhbGlkYXRpb25QYXRoLnBhcnRzXy5wdXNoKGNoaWxkKTsNCiAgICB2YWxpZGF0aW9uUGF0aC5ieXRlTGVuZ3RoXyArPSBzdHJpbmdMZW5ndGgoY2hpbGQpOw0KICAgIHZhbGlkYXRpb25QYXRoQ2hlY2tWYWxpZCh2YWxpZGF0aW9uUGF0aCk7DQp9DQpmdW5jdGlvbiB2YWxpZGF0aW9uUGF0aFBvcCh2YWxpZGF0aW9uUGF0aCkgew0KICAgIGNvbnN0IGxhc3QgPSB2YWxpZGF0aW9uUGF0aC5wYXJ0c18ucG9wKCk7DQogICAgdmFsaWRhdGlvblBhdGguYnl0ZUxlbmd0aF8gLT0gc3RyaW5nTGVuZ3RoKGxhc3QpOw0KICAgIC8vIFVuLWNvdW50IHRoZSBwcmV2aW91cyAnLycNCiAgICBpZiAodmFsaWRhdGlvblBhdGgucGFydHNfLmxlbmd0aCA+IDApIHsNCiAgICAgICAgdmFsaWRhdGlvblBhdGguYnl0ZUxlbmd0aF8gLT0gMTsNCiAgICB9DQp9DQpmdW5jdGlvbiB2YWxpZGF0aW9uUGF0aENoZWNrVmFsaWQodmFsaWRhdGlvblBhdGgpIHsNCiAgICBpZiAodmFsaWRhdGlvblBhdGguYnl0ZUxlbmd0aF8gPiBNQVhfUEFUSF9MRU5HVEhfQllURVMpIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKHZhbGlkYXRpb25QYXRoLmVycm9yUHJlZml4XyArDQogICAgICAgICAgICAnaGFzIGEga2V5IHBhdGggbG9uZ2VyIHRoYW4gJyArDQogICAgICAgICAgICBNQVhfUEFUSF9MRU5HVEhfQllURVMgKw0KICAgICAgICAgICAgJyBieXRlcyAoJyArDQogICAgICAgICAgICB2YWxpZGF0aW9uUGF0aC5ieXRlTGVuZ3RoXyArDQogICAgICAgICAgICAnKS4nKTsNCiAgICB9DQogICAgaWYgKHZhbGlkYXRpb25QYXRoLnBhcnRzXy5sZW5ndGggPiBNQVhfUEFUSF9ERVBUSCkgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IodmFsaWRhdGlvblBhdGguZXJyb3JQcmVmaXhfICsNCiAgICAgICAgICAgICdwYXRoIHNwZWNpZmllZCBleGNlZWRzIHRoZSBtYXhpbXVtIGRlcHRoIHRoYXQgY2FuIGJlIHdyaXR0ZW4gKCcgKw0KICAgICAgICAgICAgTUFYX1BBVEhfREVQVEggKw0KICAgICAgICAgICAgJykgb3Igb2JqZWN0IGNvbnRhaW5zIGEgY3ljbGUgJyArDQogICAgICAgICAgICB2YWxpZGF0aW9uUGF0aFRvRXJyb3JTdHJpbmcodmFsaWRhdGlvblBhdGgpKTsNCiAgICB9DQp9DQovKioNCiAqIFN0cmluZyBmb3IgdXNlIGluIGVycm9yIG1lc3NhZ2VzIC0gdXNlcyAnLicgbm90YXRpb24gZm9yIHBhdGguDQogKi8NCmZ1bmN0aW9uIHZhbGlkYXRpb25QYXRoVG9FcnJvclN0cmluZyh2YWxpZGF0aW9uUGF0aCkgew0KICAgIGlmICh2YWxpZGF0aW9uUGF0aC5wYXJ0c18ubGVuZ3RoID09PSAwKSB7DQogICAgICAgIHJldHVybiAnJzsNCiAgICB9DQogICAgcmV0dXJuICJpbiBwcm9wZXJ0eSAnIiArIHZhbGlkYXRpb25QYXRoLnBhcnRzXy5qb2luKCcuJykgKyAiJyI7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBWaXNpYmlsaXR5TW9uaXRvciBleHRlbmRzIEV2ZW50RW1pdHRlciB7DQogICAgY29uc3RydWN0b3IoKSB7DQogICAgICAgIHN1cGVyKFsndmlzaWJsZSddKTsNCiAgICAgICAgbGV0IGhpZGRlbjsNCiAgICAgICAgbGV0IHZpc2liaWxpdHlDaGFuZ2U7DQogICAgICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnICYmDQogICAgICAgICAgICB0eXBlb2YgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciAhPT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgICAgICAgIGlmICh0eXBlb2YgZG9jdW1lbnRbJ2hpZGRlbiddICE9PSAndW5kZWZpbmVkJykgew0KICAgICAgICAgICAgICAgIC8vIE9wZXJhIDEyLjEwIGFuZCBGaXJlZm94IDE4IGFuZCBsYXRlciBzdXBwb3J0DQogICAgICAgICAgICAgICAgdmlzaWJpbGl0eUNoYW5nZSA9ICd2aXNpYmlsaXR5Y2hhbmdlJzsNCiAgICAgICAgICAgICAgICBoaWRkZW4gPSAnaGlkZGVuJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBkb2N1bWVudFsnbW96SGlkZGVuJ10gIT09ICd1bmRlZmluZWQnKSB7DQogICAgICAgICAgICAgICAgdmlzaWJpbGl0eUNoYW5nZSA9ICdtb3p2aXNpYmlsaXR5Y2hhbmdlJzsNCiAgICAgICAgICAgICAgICBoaWRkZW4gPSAnbW96SGlkZGVuJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBkb2N1bWVudFsnbXNIaWRkZW4nXSAhPT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5Q2hhbmdlID0gJ21zdmlzaWJpbGl0eWNoYW5nZSc7DQogICAgICAgICAgICAgICAgaGlkZGVuID0gJ21zSGlkZGVuJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBkb2N1bWVudFsnd2Via2l0SGlkZGVuJ10gIT09ICd1bmRlZmluZWQnKSB7DQogICAgICAgICAgICAgICAgdmlzaWJpbGl0eUNoYW5nZSA9ICd3ZWJraXR2aXNpYmlsaXR5Y2hhbmdlJzsNCiAgICAgICAgICAgICAgICBoaWRkZW4gPSAnd2Via2l0SGlkZGVuJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAvLyBJbml0aWFsbHksIHdlIGFsd2F5cyBhc3N1bWUgd2UgYXJlIHZpc2libGUuIFRoaXMgZW5zdXJlcyB0aGF0IGluIGJyb3dzZXJzDQogICAgICAgIC8vIHdpdGhvdXQgcGFnZSB2aXNpYmlsaXR5IHN1cHBvcnQgb3IgaW4gY2FzZXMgd2hlcmUgd2UgYXJlIG5ldmVyIHZpc2libGUNCiAgICAgICAgLy8gKGUuZy4gY2hyb21lIGV4dGVuc2lvbiksIHdlIGFjdCBhcyBpZiB3ZSBhcmUgdmlzaWJsZSwgaS5lLiBkb24ndCBkZWxheQ0KICAgICAgICAvLyByZWNvbm5lY3RzDQogICAgICAgIHRoaXMudmlzaWJsZV8gPSB0cnVlOw0KICAgICAgICBpZiAodmlzaWJpbGl0eUNoYW5nZSkgew0KICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcih2aXNpYmlsaXR5Q2hhbmdlLCAoKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc3QgdmlzaWJsZSA9ICFkb2N1bWVudFtoaWRkZW5dOw0KICAgICAgICAgICAgICAgIGlmICh2aXNpYmxlICE9PSB0aGlzLnZpc2libGVfKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMudmlzaWJsZV8gPSB2aXNpYmxlOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoJ3Zpc2libGUnLCB2aXNpYmxlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LCBmYWxzZSk7DQogICAgICAgIH0NCiAgICB9DQogICAgc3RhdGljIGdldEluc3RhbmNlKCkgew0KICAgICAgICByZXR1cm4gbmV3IFZpc2liaWxpdHlNb25pdG9yKCk7DQogICAgfQ0KICAgIGdldEluaXRpYWxFdmVudChldmVudFR5cGUpIHsNCiAgICAgICAgYXNzZXJ0KGV2ZW50VHlwZSA9PT0gJ3Zpc2libGUnLCAnVW5rbm93biBldmVudCB0eXBlOiAnICsgZXZlbnRUeXBlKTsNCiAgICAgICAgcmV0dXJuIFt0aGlzLnZpc2libGVfXTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjb25zdCBSRUNPTk5FQ1RfTUlOX0RFTEFZID0gMTAwMDsNCmNvbnN0IFJFQ09OTkVDVF9NQVhfREVMQVlfREVGQVVMVCA9IDYwICogNSAqIDEwMDA7IC8vIDUgbWludXRlcyBpbiBtaWxsaXNlY29uZHMgKENhc2U6IDE4NTgpDQpjb25zdCBSRUNPTk5FQ1RfTUFYX0RFTEFZX0ZPUl9BRE1JTlMgPSAzMCAqIDEwMDA7IC8vIDMwIHNlY29uZHMgZm9yIGFkbWluIGNsaWVudHMgKGxpa2VseSB0byBiZSBhIGJhY2tlbmQgc2VydmVyKQ0KY29uc3QgUkVDT05ORUNUX0RFTEFZX01VTFRJUExJRVIgPSAxLjM7DQpjb25zdCBSRUNPTk5FQ1RfREVMQVlfUkVTRVRfVElNRU9VVCA9IDMwMDAwOyAvLyBSZXNldCBkZWxheSBiYWNrIHRvIE1JTl9ERUxBWSBhZnRlciBiZWluZyBjb25uZWN0ZWQgZm9yIDMwc2VjLg0KY29uc3QgU0VSVkVSX0tJTExfSU5URVJSVVBUX1JFQVNPTiA9ICdzZXJ2ZXJfa2lsbCc7DQovLyBJZiBhdXRoIGZhaWxzIHJlcGVhdGVkbHksIHdlJ2xsIGFzc3VtZSBzb21ldGhpbmcgaXMgd3JvbmcgYW5kIGxvZyBhIHdhcm5pbmcgLyBiYWNrIG9mZi4NCmNvbnN0IElOVkFMSURfVE9LRU5fVEhSRVNIT0xEID0gMzsNCi8qKg0KICogRmlyZWJhc2UgY29ubmVjdGlvbi4gIEFic3RyYWN0cyB3aXJlIHByb3RvY29sIGFuZCBoYW5kbGVzIHJlY29ubmVjdGluZy4NCiAqDQogKiBOT1RFOiBBbGwgSlNPTiBvYmplY3RzIHNlbnQgdG8gdGhlIHJlYWx0aW1lIGNvbm5lY3Rpb24gbXVzdCBoYXZlIHByb3BlcnR5IG5hbWVzIGVuY2xvc2VkDQogKiBpbiBxdW90ZXMgdG8gbWFrZSBzdXJlIHRoZSBjbG9zdXJlIGNvbXBpbGVyIGRvZXMgbm90IG1pbmlmeSB0aGVtLg0KICovDQpjbGFzcyBQZXJzaXN0ZW50Q29ubmVjdGlvbiBleHRlbmRzIFNlcnZlckFjdGlvbnMgew0KICAgIC8qKg0KICAgICAqIEBwYXJhbSByZXBvSW5mb18gLSBEYXRhIGFib3V0IHRoZSBuYW1lc3BhY2Ugd2UgYXJlIGNvbm5lY3RpbmcgdG8NCiAgICAgKiBAcGFyYW0gYXBwbGljYXRpb25JZF8gLSBUaGUgRmlyZWJhc2UgQXBwIElEIGZvciB0aGlzIHByb2plY3QNCiAgICAgKiBAcGFyYW0gb25EYXRhVXBkYXRlXyAtIEEgY2FsbGJhY2sgZm9yIG5ldyBkYXRhIGZyb20gdGhlIHNlcnZlcg0KICAgICAqLw0KICAgIGNvbnN0cnVjdG9yKHJlcG9JbmZvXywgYXBwbGljYXRpb25JZF8sIG9uRGF0YVVwZGF0ZV8sIG9uQ29ubmVjdFN0YXR1c18sIG9uU2VydmVySW5mb1VwZGF0ZV8sIGF1dGhUb2tlblByb3ZpZGVyXywgYXBwQ2hlY2tUb2tlblByb3ZpZGVyXywgYXV0aE92ZXJyaWRlXykgew0KICAgICAgICBzdXBlcigpOw0KICAgICAgICB0aGlzLnJlcG9JbmZvXyA9IHJlcG9JbmZvXzsNCiAgICAgICAgdGhpcy5hcHBsaWNhdGlvbklkXyA9IGFwcGxpY2F0aW9uSWRfOw0KICAgICAgICB0aGlzLm9uRGF0YVVwZGF0ZV8gPSBvbkRhdGFVcGRhdGVfOw0KICAgICAgICB0aGlzLm9uQ29ubmVjdFN0YXR1c18gPSBvbkNvbm5lY3RTdGF0dXNfOw0KICAgICAgICB0aGlzLm9uU2VydmVySW5mb1VwZGF0ZV8gPSBvblNlcnZlckluZm9VcGRhdGVfOw0KICAgICAgICB0aGlzLmF1dGhUb2tlblByb3ZpZGVyXyA9IGF1dGhUb2tlblByb3ZpZGVyXzsNCiAgICAgICAgdGhpcy5hcHBDaGVja1Rva2VuUHJvdmlkZXJfID0gYXBwQ2hlY2tUb2tlblByb3ZpZGVyXzsNCiAgICAgICAgdGhpcy5hdXRoT3ZlcnJpZGVfID0gYXV0aE92ZXJyaWRlXzsNCiAgICAgICAgLy8gVXNlZCBmb3IgZGlhZ25vc3RpYyBsb2dnaW5nLg0KICAgICAgICB0aGlzLmlkID0gUGVyc2lzdGVudENvbm5lY3Rpb24ubmV4dFBlcnNpc3RlbnRDb25uZWN0aW9uSWRfKys7DQogICAgICAgIHRoaXMubG9nXyA9IGxvZ1dyYXBwZXIoJ3A6JyArIHRoaXMuaWQgKyAnOicpOw0KICAgICAgICB0aGlzLmludGVycnVwdFJlYXNvbnNfID0ge307DQogICAgICAgIHRoaXMubGlzdGVucyA9IG5ldyBNYXAoKTsNCiAgICAgICAgdGhpcy5vdXRzdGFuZGluZ1B1dHNfID0gW107DQogICAgICAgIHRoaXMub3V0c3RhbmRpbmdHZXRzXyA9IFtdOw0KICAgICAgICB0aGlzLm91dHN0YW5kaW5nUHV0Q291bnRfID0gMDsNCiAgICAgICAgdGhpcy5vdXRzdGFuZGluZ0dldENvdW50XyA9IDA7DQogICAgICAgIHRoaXMub25EaXNjb25uZWN0UmVxdWVzdFF1ZXVlXyA9IFtdOw0KICAgICAgICB0aGlzLmNvbm5lY3RlZF8gPSBmYWxzZTsNCiAgICAgICAgdGhpcy5yZWNvbm5lY3REZWxheV8gPSBSRUNPTk5FQ1RfTUlOX0RFTEFZOw0KICAgICAgICB0aGlzLm1heFJlY29ubmVjdERlbGF5XyA9IFJFQ09OTkVDVF9NQVhfREVMQVlfREVGQVVMVDsNCiAgICAgICAgdGhpcy5zZWN1cml0eURlYnVnQ2FsbGJhY2tfID0gbnVsbDsNCiAgICAgICAgdGhpcy5sYXN0U2Vzc2lvbklkID0gbnVsbDsNCiAgICAgICAgdGhpcy5lc3RhYmxpc2hDb25uZWN0aW9uVGltZXJfID0gbnVsbDsNCiAgICAgICAgdGhpcy52aXNpYmxlXyA9IGZhbHNlOw0KICAgICAgICAvLyBCZWZvcmUgd2UgZ2V0IGNvbm5lY3RlZCwgd2Uga2VlcCBhIHF1ZXVlIG9mIHBlbmRpbmcgbWVzc2FnZXMgdG8gc2VuZC4NCiAgICAgICAgdGhpcy5yZXF1ZXN0Q0JIYXNoXyA9IHt9Ow0KICAgICAgICB0aGlzLnJlcXVlc3ROdW1iZXJfID0gMDsNCiAgICAgICAgdGhpcy5yZWFsdGltZV8gPSBudWxsOw0KICAgICAgICB0aGlzLmF1dGhUb2tlbl8gPSBudWxsOw0KICAgICAgICB0aGlzLmFwcENoZWNrVG9rZW5fID0gbnVsbDsNCiAgICAgICAgdGhpcy5mb3JjZVRva2VuUmVmcmVzaF8gPSBmYWxzZTsNCiAgICAgICAgdGhpcy5pbnZhbGlkQXV0aFRva2VuQ291bnRfID0gMDsNCiAgICAgICAgdGhpcy5pbnZhbGlkQXBwQ2hlY2tUb2tlbkNvdW50XyA9IDA7DQogICAgICAgIHRoaXMuZmlyc3RDb25uZWN0aW9uXyA9IHRydWU7DQogICAgICAgIHRoaXMubGFzdENvbm5lY3Rpb25BdHRlbXB0VGltZV8gPSBudWxsOw0KICAgICAgICB0aGlzLmxhc3RDb25uZWN0aW9uRXN0YWJsaXNoZWRUaW1lXyA9IG51bGw7DQogICAgICAgIGlmIChhdXRoT3ZlcnJpZGVfICYmICFpc05vZGVTZGsoKSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBdXRoIG92ZXJyaWRlIHNwZWNpZmllZCBpbiBvcHRpb25zLCBidXQgbm90IHN1cHBvcnRlZCBvbiBub24gTm9kZS5qcyBwbGF0Zm9ybXMnKTsNCiAgICAgICAgfQ0KICAgICAgICBWaXNpYmlsaXR5TW9uaXRvci5nZXRJbnN0YW5jZSgpLm9uKCd2aXNpYmxlJywgdGhpcy5vblZpc2libGVfLCB0aGlzKTsNCiAgICAgICAgaWYgKHJlcG9JbmZvXy5ob3N0LmluZGV4T2YoJ2ZibG9jYWwnKSA9PT0gLTEpIHsNCiAgICAgICAgICAgIE9ubGluZU1vbml0b3IuZ2V0SW5zdGFuY2UoKS5vbignb25saW5lJywgdGhpcy5vbk9ubGluZV8sIHRoaXMpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHNlbmRSZXF1ZXN0KGFjdGlvbiwgYm9keSwgb25SZXNwb25zZSkgew0KICAgICAgICBjb25zdCBjdXJSZXFOdW0gPSArK3RoaXMucmVxdWVzdE51bWJlcl87DQogICAgICAgIGNvbnN0IG1zZyA9IHsgcjogY3VyUmVxTnVtLCBhOiBhY3Rpb24sIGI6IGJvZHkgfTsNCiAgICAgICAgdGhpcy5sb2dfKHN0cmluZ2lmeShtc2cpKTsNCiAgICAgICAgYXNzZXJ0KHRoaXMuY29ubmVjdGVkXywgInNlbmRSZXF1ZXN0IGNhbGwgd2hlbiB3ZSdyZSBub3QgY29ubmVjdGVkIG5vdCBhbGxvd2VkLiIpOw0KICAgICAgICB0aGlzLnJlYWx0aW1lXy5zZW5kUmVxdWVzdChtc2cpOw0KICAgICAgICBpZiAob25SZXNwb25zZSkgew0KICAgICAgICAgICAgdGhpcy5yZXF1ZXN0Q0JIYXNoX1tjdXJSZXFOdW1dID0gb25SZXNwb25zZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBnZXQocXVlcnkpIHsNCiAgICAgICAgdGhpcy5pbml0Q29ubmVjdGlvbl8oKTsNCiAgICAgICAgY29uc3QgZGVmZXJyZWQgPSBuZXcgRGVmZXJyZWQoKTsNCiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHsNCiAgICAgICAgICAgIHA6IHF1ZXJ5Ll9wYXRoLnRvU3RyaW5nKCksDQogICAgICAgICAgICBxOiBxdWVyeS5fcXVlcnlPYmplY3QNCiAgICAgICAgfTsNCiAgICAgICAgY29uc3Qgb3V0c3RhbmRpbmdHZXQgPSB7DQogICAgICAgICAgICBhY3Rpb246ICdnJywNCiAgICAgICAgICAgIHJlcXVlc3QsDQogICAgICAgICAgICBvbkNvbXBsZXRlOiAobWVzc2FnZSkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSBtZXNzYWdlWydkJ107DQogICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2VbJ3MnXSA9PT0gJ29rJykgew0KICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHBheWxvYWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KHBheWxvYWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgdGhpcy5vdXRzdGFuZGluZ0dldHNfLnB1c2gob3V0c3RhbmRpbmdHZXQpOw0KICAgICAgICB0aGlzLm91dHN0YW5kaW5nR2V0Q291bnRfKys7DQogICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5vdXRzdGFuZGluZ0dldHNfLmxlbmd0aCAtIDE7DQogICAgICAgIGlmICh0aGlzLmNvbm5lY3RlZF8pIHsNCiAgICAgICAgICAgIHRoaXMuc2VuZEdldF8oaW5kZXgpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlOw0KICAgIH0NCiAgICBsaXN0ZW4ocXVlcnksIGN1cnJlbnRIYXNoRm4sIHRhZywgb25Db21wbGV0ZSkgew0KICAgICAgICB0aGlzLmluaXRDb25uZWN0aW9uXygpOw0KICAgICAgICBjb25zdCBxdWVyeUlkID0gcXVlcnkuX3F1ZXJ5SWRlbnRpZmllcjsNCiAgICAgICAgY29uc3QgcGF0aFN0cmluZyA9IHF1ZXJ5Ll9wYXRoLnRvU3RyaW5nKCk7DQogICAgICAgIHRoaXMubG9nXygnTGlzdGVuIGNhbGxlZCBmb3IgJyArIHBhdGhTdHJpbmcgKyAnICcgKyBxdWVyeUlkKTsNCiAgICAgICAgaWYgKCF0aGlzLmxpc3RlbnMuaGFzKHBhdGhTdHJpbmcpKSB7DQogICAgICAgICAgICB0aGlzLmxpc3RlbnMuc2V0KHBhdGhTdHJpbmcsIG5ldyBNYXAoKSk7DQogICAgICAgIH0NCiAgICAgICAgYXNzZXJ0KHF1ZXJ5Ll9xdWVyeVBhcmFtcy5pc0RlZmF1bHQoKSB8fCAhcXVlcnkuX3F1ZXJ5UGFyYW1zLmxvYWRzQWxsRGF0YSgpLCAnbGlzdGVuKCkgY2FsbGVkIGZvciBub24tZGVmYXVsdCBidXQgY29tcGxldGUgcXVlcnknKTsNCiAgICAgICAgYXNzZXJ0KCF0aGlzLmxpc3RlbnMuZ2V0KHBhdGhTdHJpbmcpLmhhcyhxdWVyeUlkKSwgYGxpc3RlbigpIGNhbGxlZCB0d2ljZSBmb3Igc2FtZSBwYXRoL3F1ZXJ5SWQuYCk7DQogICAgICAgIGNvbnN0IGxpc3RlblNwZWMgPSB7DQogICAgICAgICAgICBvbkNvbXBsZXRlLA0KICAgICAgICAgICAgaGFzaEZuOiBjdXJyZW50SGFzaEZuLA0KICAgICAgICAgICAgcXVlcnksDQogICAgICAgICAgICB0YWcNCiAgICAgICAgfTsNCiAgICAgICAgdGhpcy5saXN0ZW5zLmdldChwYXRoU3RyaW5nKS5zZXQocXVlcnlJZCwgbGlzdGVuU3BlYyk7DQogICAgICAgIGlmICh0aGlzLmNvbm5lY3RlZF8pIHsNCiAgICAgICAgICAgIHRoaXMuc2VuZExpc3Rlbl8obGlzdGVuU3BlYyk7DQogICAgICAgIH0NCiAgICB9DQogICAgc2VuZEdldF8oaW5kZXgpIHsNCiAgICAgICAgY29uc3QgZ2V0ID0gdGhpcy5vdXRzdGFuZGluZ0dldHNfW2luZGV4XTsNCiAgICAgICAgdGhpcy5zZW5kUmVxdWVzdCgnZycsIGdldC5yZXF1ZXN0LCAobWVzc2FnZSkgPT4gew0KICAgICAgICAgICAgZGVsZXRlIHRoaXMub3V0c3RhbmRpbmdHZXRzX1tpbmRleF07DQogICAgICAgICAgICB0aGlzLm91dHN0YW5kaW5nR2V0Q291bnRfLS07DQogICAgICAgICAgICBpZiAodGhpcy5vdXRzdGFuZGluZ0dldENvdW50XyA9PT0gMCkgew0KICAgICAgICAgICAgICAgIHRoaXMub3V0c3RhbmRpbmdHZXRzXyA9IFtdOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGdldC5vbkNvbXBsZXRlKSB7DQogICAgICAgICAgICAgICAgZ2V0Lm9uQ29tcGxldGUobWVzc2FnZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0NCiAgICBzZW5kTGlzdGVuXyhsaXN0ZW5TcGVjKSB7DQogICAgICAgIGNvbnN0IHF1ZXJ5ID0gbGlzdGVuU3BlYy5xdWVyeTsNCiAgICAgICAgY29uc3QgcGF0aFN0cmluZyA9IHF1ZXJ5Ll9wYXRoLnRvU3RyaW5nKCk7DQogICAgICAgIGNvbnN0IHF1ZXJ5SWQgPSBxdWVyeS5fcXVlcnlJZGVudGlmaWVyOw0KICAgICAgICB0aGlzLmxvZ18oJ0xpc3RlbiBvbiAnICsgcGF0aFN0cmluZyArICcgZm9yICcgKyBxdWVyeUlkKTsNCiAgICAgICAgY29uc3QgcmVxID0geyAvKnBhdGgqLyBwOiBwYXRoU3RyaW5nIH07DQogICAgICAgIGNvbnN0IGFjdGlvbiA9ICdxJzsNCiAgICAgICAgLy8gT25seSBib3RoZXIgdG8gc2VuZCBxdWVyeSBpZiBpdCdzIG5vbi1kZWZhdWx0Lg0KICAgICAgICBpZiAobGlzdGVuU3BlYy50YWcpIHsNCiAgICAgICAgICAgIHJlcVsncSddID0gcXVlcnkuX3F1ZXJ5T2JqZWN0Ow0KICAgICAgICAgICAgcmVxWyd0J10gPSBsaXN0ZW5TcGVjLnRhZzsNCiAgICAgICAgfQ0KICAgICAgICByZXFbIC8qaGFzaCovJ2gnXSA9IGxpc3RlblNwZWMuaGFzaEZuKCk7DQogICAgICAgIHRoaXMuc2VuZFJlcXVlc3QoYWN0aW9uLCByZXEsIChtZXNzYWdlKSA9PiB7DQogICAgICAgICAgICBjb25zdCBwYXlsb2FkID0gbWVzc2FnZVsgLypkYXRhKi8nZCddOw0KICAgICAgICAgICAgY29uc3Qgc3RhdHVzID0gbWVzc2FnZVsgLypzdGF0dXMqLydzJ107DQogICAgICAgICAgICAvLyBwcmludCB3YXJuaW5ncyBpbiBhbnkgY2FzZS4uLg0KICAgICAgICAgICAgUGVyc2lzdGVudENvbm5lY3Rpb24ud2Fybk9uTGlzdGVuV2FybmluZ3NfKHBheWxvYWQsIHF1ZXJ5KTsNCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRMaXN0ZW5TcGVjID0gdGhpcy5saXN0ZW5zLmdldChwYXRoU3RyaW5nKSAmJg0KICAgICAgICAgICAgICAgIHRoaXMubGlzdGVucy5nZXQocGF0aFN0cmluZykuZ2V0KHF1ZXJ5SWQpOw0KICAgICAgICAgICAgLy8gb25seSB0cmlnZ2VyIGFjdGlvbnMgaWYgdGhlIGxpc3RlbiBoYXNuJ3QgYmVlbiByZW1vdmVkIGFuZCByZWFkZGVkDQogICAgICAgICAgICBpZiAoY3VycmVudExpc3RlblNwZWMgPT09IGxpc3RlblNwZWMpIHsNCiAgICAgICAgICAgICAgICB0aGlzLmxvZ18oJ2xpc3RlbiByZXNwb25zZScsIG1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgIT09ICdvaycpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVMaXN0ZW5fKHBhdGhTdHJpbmcsIHF1ZXJ5SWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAobGlzdGVuU3BlYy5vbkNvbXBsZXRlKSB7DQogICAgICAgICAgICAgICAgICAgIGxpc3RlblNwZWMub25Db21wbGV0ZShzdGF0dXMsIHBheWxvYWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KICAgIHN0YXRpYyB3YXJuT25MaXN0ZW5XYXJuaW5nc18ocGF5bG9hZCwgcXVlcnkpIHsNCiAgICAgICAgaWYgKHBheWxvYWQgJiYgdHlwZW9mIHBheWxvYWQgPT09ICdvYmplY3QnICYmIGNvbnRhaW5zKHBheWxvYWQsICd3JykpIHsNCiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55DQogICAgICAgICAgICBjb25zdCB3YXJuaW5ncyA9IHNhZmVHZXQocGF5bG9hZCwgJ3cnKTsNCiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHdhcm5pbmdzKSAmJiB+d2FybmluZ3MuaW5kZXhPZignbm9faW5kZXgnKSkgew0KICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4U3BlYyA9ICciLmluZGV4T24iOiAiJyArIHF1ZXJ5Ll9xdWVyeVBhcmFtcy5nZXRJbmRleCgpLnRvU3RyaW5nKCkgKyAnIic7DQogICAgICAgICAgICAgICAgY29uc3QgaW5kZXhQYXRoID0gcXVlcnkuX3BhdGgudG9TdHJpbmcoKTsNCiAgICAgICAgICAgICAgICB3YXJuKGBVc2luZyBhbiB1bnNwZWNpZmllZCBpbmRleC4gWW91ciBkYXRhIHdpbGwgYmUgZG93bmxvYWRlZCBhbmQgYCArDQogICAgICAgICAgICAgICAgICAgIGBmaWx0ZXJlZCBvbiB0aGUgY2xpZW50LiBDb25zaWRlciBhZGRpbmcgJHtpbmRleFNwZWN9IGF0IGAgKw0KICAgICAgICAgICAgICAgICAgICBgJHtpbmRleFBhdGh9IHRvIHlvdXIgc2VjdXJpdHkgcnVsZXMgZm9yIGJldHRlciBwZXJmb3JtYW5jZS5gKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICByZWZyZXNoQXV0aFRva2VuKHRva2VuKSB7DQogICAgICAgIHRoaXMuYXV0aFRva2VuXyA9IHRva2VuOw0KICAgICAgICB0aGlzLmxvZ18oJ0F1dGggdG9rZW4gcmVmcmVzaGVkJyk7DQogICAgICAgIGlmICh0aGlzLmF1dGhUb2tlbl8pIHsNCiAgICAgICAgICAgIHRoaXMudHJ5QXV0aCgpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgLy9JZiB3ZSdyZSBjb25uZWN0ZWQgd2Ugd2FudCB0byBsZXQgdGhlIHNlcnZlciBrbm93IHRvIHVuYXV0aGVudGljYXRlIHVzLiBJZiB3ZSdyZSBub3QgY29ubmVjdGVkLCBzaW1wbHkgZGVsZXRlDQogICAgICAgICAgICAvL3RoZSBjcmVkZW50aWFsIHNvIHdlIGRvbnQgYmVjb21lIGF1dGhlbnRpY2F0ZWQgbmV4dCB0aW1lIHdlIGNvbm5lY3QuDQogICAgICAgICAgICBpZiAodGhpcy5jb25uZWN0ZWRfKSB7DQogICAgICAgICAgICAgICAgdGhpcy5zZW5kUmVxdWVzdCgndW5hdXRoJywge30sICgpID0+IHsgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5yZWR1Y2VSZWNvbm5lY3REZWxheUlmQWRtaW5DcmVkZW50aWFsXyh0b2tlbik7DQogICAgfQ0KICAgIHJlZHVjZVJlY29ubmVjdERlbGF5SWZBZG1pbkNyZWRlbnRpYWxfKGNyZWRlbnRpYWwpIHsNCiAgICAgICAgLy8gTk9URTogVGhpcyBpc24ndCBpbnRlbmRlZCB0byBiZSBidWxsZXRwcm9vZiAoYSBtYWxpY2lvdXMgZGV2ZWxvcGVyIGNhbiBhbHdheXMganVzdCBtb2RpZnkgdGhlIGNsaWVudCkuDQogICAgICAgIC8vIEFkZGl0aW9uYWxseSwgd2UgZG9uJ3QgYm90aGVyIHJlc2V0dGluZyB0aGUgbWF4IGRlbGF5IGJhY2sgdG8gdGhlIGRlZmF1bHQgaWYgYXV0aCBmYWlscyAvIGV4cGlyZXMuDQogICAgICAgIGNvbnN0IGlzRmlyZWJhc2VTZWNyZXQgPSBjcmVkZW50aWFsICYmIGNyZWRlbnRpYWwubGVuZ3RoID09PSA0MDsNCiAgICAgICAgaWYgKGlzRmlyZWJhc2VTZWNyZXQgfHwgaXNBZG1pbihjcmVkZW50aWFsKSkgew0KICAgICAgICAgICAgdGhpcy5sb2dfKCdBZG1pbiBhdXRoIGNyZWRlbnRpYWwgZGV0ZWN0ZWQuICBSZWR1Y2luZyBtYXggcmVjb25uZWN0IHRpbWUuJyk7DQogICAgICAgICAgICB0aGlzLm1heFJlY29ubmVjdERlbGF5XyA9IFJFQ09OTkVDVF9NQVhfREVMQVlfRk9SX0FETUlOUzsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZWZyZXNoQXBwQ2hlY2tUb2tlbih0b2tlbikgew0KICAgICAgICB0aGlzLmFwcENoZWNrVG9rZW5fID0gdG9rZW47DQogICAgICAgIHRoaXMubG9nXygnQXBwIGNoZWNrIHRva2VuIHJlZnJlc2hlZCcpOw0KICAgICAgICBpZiAodGhpcy5hcHBDaGVja1Rva2VuXykgew0KICAgICAgICAgICAgdGhpcy50cnlBcHBDaGVjaygpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgLy9JZiB3ZSdyZSBjb25uZWN0ZWQgd2Ugd2FudCB0byBsZXQgdGhlIHNlcnZlciBrbm93IHRvIHVuYXV0aGVudGljYXRlIHVzLg0KICAgICAgICAgICAgLy9JZiB3ZSdyZSBub3QgY29ubmVjdGVkLCBzaW1wbHkgZGVsZXRlIHRoZSBjcmVkZW50aWFsIHNvIHdlIGRvbnQgYmVjb21lDQogICAgICAgICAgICAvLyBhdXRoZW50aWNhdGVkIG5leHQgdGltZSB3ZSBjb25uZWN0Lg0KICAgICAgICAgICAgaWYgKHRoaXMuY29ubmVjdGVkXykgew0KICAgICAgICAgICAgICAgIHRoaXMuc2VuZFJlcXVlc3QoJ3VuYXBwZWNrJywge30sICgpID0+IHsgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogQXR0ZW1wdHMgdG8gYXV0aGVudGljYXRlIHdpdGggdGhlIGdpdmVuIGNyZWRlbnRpYWxzLiBJZiB0aGUgYXV0aGVudGljYXRpb24gYXR0ZW1wdCBmYWlscywgaXQncyB0cmlnZ2VyZWQgbGlrZQ0KICAgICAqIGEgYXV0aCByZXZva2VkICh0aGUgY29ubmVjdGlvbiBpcyBjbG9zZWQpLg0KICAgICAqLw0KICAgIHRyeUF1dGgoKSB7DQogICAgICAgIGlmICh0aGlzLmNvbm5lY3RlZF8gJiYgdGhpcy5hdXRoVG9rZW5fKSB7DQogICAgICAgICAgICBjb25zdCB0b2tlbiA9IHRoaXMuYXV0aFRva2VuXzsNCiAgICAgICAgICAgIGNvbnN0IGF1dGhNZXRob2QgPSBpc1ZhbGlkRm9ybWF0KHRva2VuKSA/ICdhdXRoJyA6ICdnYXV0aCc7DQogICAgICAgICAgICBjb25zdCByZXF1ZXN0RGF0YSA9IHsgY3JlZDogdG9rZW4gfTsNCiAgICAgICAgICAgIGlmICh0aGlzLmF1dGhPdmVycmlkZV8gPT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICByZXF1ZXN0RGF0YVsnbm9hdXRoJ10gPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHRoaXMuYXV0aE92ZXJyaWRlXyA9PT0gJ29iamVjdCcpIHsNCiAgICAgICAgICAgICAgICByZXF1ZXN0RGF0YVsnYXV0aHZhciddID0gdGhpcy5hdXRoT3ZlcnJpZGVfOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5zZW5kUmVxdWVzdChhdXRoTWV0aG9kLCByZXF1ZXN0RGF0YSwgKHJlcykgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IHN0YXR1cyA9IHJlc1sgLypzdGF0dXMqLydzJ107DQogICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJlc1sgLypkYXRhKi8nZCddIHx8ICdlcnJvcic7DQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYXV0aFRva2VuXyA9PT0gdG9rZW4pIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gJ29rJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnZhbGlkQXV0aFRva2VuQ291bnRfID0gMDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRyaWdnZXJzIHJlY29ubmVjdCBhbmQgZm9yY2UgcmVmcmVzaCBmb3IgYXV0aCB0b2tlbg0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkF1dGhSZXZva2VkXyhzdGF0dXMsIGRhdGEpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogQXR0ZW1wdHMgdG8gYXV0aGVudGljYXRlIHdpdGggdGhlIGdpdmVuIHRva2VuLiBJZiB0aGUgYXV0aGVudGljYXRpb24NCiAgICAgKiBhdHRlbXB0IGZhaWxzLCBpdCdzIHRyaWdnZXJlZCBsaWtlIHRoZSB0b2tlbiB3YXMgcmV2b2tlZCAodGhlIGNvbm5lY3Rpb24gaXMNCiAgICAgKiBjbG9zZWQpLg0KICAgICAqLw0KICAgIHRyeUFwcENoZWNrKCkgew0KICAgICAgICBpZiAodGhpcy5jb25uZWN0ZWRfICYmIHRoaXMuYXBwQ2hlY2tUb2tlbl8pIHsNCiAgICAgICAgICAgIHRoaXMuc2VuZFJlcXVlc3QoJ2FwcGNoZWNrJywgeyAndG9rZW4nOiB0aGlzLmFwcENoZWNrVG9rZW5fIH0sIChyZXMpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBzdGF0dXMgPSByZXNbIC8qc3RhdHVzKi8ncyddOw0KICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSByZXNbIC8qZGF0YSovJ2QnXSB8fCAnZXJyb3InOw0KICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09ICdvaycpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnZhbGlkQXBwQ2hlY2tUb2tlbkNvdW50XyA9IDA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB0aGlzLm9uQXBwQ2hlY2tSZXZva2VkXyhzdGF0dXMsIGRhdGEpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEBpbmhlcml0RG9jDQogICAgICovDQogICAgdW5saXN0ZW4ocXVlcnksIHRhZykgew0KICAgICAgICBjb25zdCBwYXRoU3RyaW5nID0gcXVlcnkuX3BhdGgudG9TdHJpbmcoKTsNCiAgICAgICAgY29uc3QgcXVlcnlJZCA9IHF1ZXJ5Ll9xdWVyeUlkZW50aWZpZXI7DQogICAgICAgIHRoaXMubG9nXygnVW5saXN0ZW4gY2FsbGVkIGZvciAnICsgcGF0aFN0cmluZyArICcgJyArIHF1ZXJ5SWQpOw0KICAgICAgICBhc3NlcnQocXVlcnkuX3F1ZXJ5UGFyYW1zLmlzRGVmYXVsdCgpIHx8ICFxdWVyeS5fcXVlcnlQYXJhbXMubG9hZHNBbGxEYXRhKCksICd1bmxpc3RlbigpIGNhbGxlZCBmb3Igbm9uLWRlZmF1bHQgYnV0IGNvbXBsZXRlIHF1ZXJ5Jyk7DQogICAgICAgIGNvbnN0IGxpc3RlbiA9IHRoaXMucmVtb3ZlTGlzdGVuXyhwYXRoU3RyaW5nLCBxdWVyeUlkKTsNCiAgICAgICAgaWYgKGxpc3RlbiAmJiB0aGlzLmNvbm5lY3RlZF8pIHsNCiAgICAgICAgICAgIHRoaXMuc2VuZFVubGlzdGVuXyhwYXRoU3RyaW5nLCBxdWVyeUlkLCBxdWVyeS5fcXVlcnlPYmplY3QsIHRhZyk7DQogICAgICAgIH0NCiAgICB9DQogICAgc2VuZFVubGlzdGVuXyhwYXRoU3RyaW5nLCBxdWVyeUlkLCBxdWVyeU9iaiwgdGFnKSB7DQogICAgICAgIHRoaXMubG9nXygnVW5saXN0ZW4gb24gJyArIHBhdGhTdHJpbmcgKyAnIGZvciAnICsgcXVlcnlJZCk7DQogICAgICAgIGNvbnN0IHJlcSA9IHsgLypwYXRoKi8gcDogcGF0aFN0cmluZyB9Ow0KICAgICAgICBjb25zdCBhY3Rpb24gPSAnbic7DQogICAgICAgIC8vIE9ubHkgYm90aGVyIHNlbmRpbmcgcXVlcnlJZCBpZiBpdCdzIG5vbi1kZWZhdWx0Lg0KICAgICAgICBpZiAodGFnKSB7DQogICAgICAgICAgICByZXFbJ3EnXSA9IHF1ZXJ5T2JqOw0KICAgICAgICAgICAgcmVxWyd0J10gPSB0YWc7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5zZW5kUmVxdWVzdChhY3Rpb24sIHJlcSk7DQogICAgfQ0KICAgIG9uRGlzY29ubmVjdFB1dChwYXRoU3RyaW5nLCBkYXRhLCBvbkNvbXBsZXRlKSB7DQogICAgICAgIHRoaXMuaW5pdENvbm5lY3Rpb25fKCk7DQogICAgICAgIGlmICh0aGlzLmNvbm5lY3RlZF8pIHsNCiAgICAgICAgICAgIHRoaXMuc2VuZE9uRGlzY29ubmVjdF8oJ28nLCBwYXRoU3RyaW5nLCBkYXRhLCBvbkNvbXBsZXRlKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMub25EaXNjb25uZWN0UmVxdWVzdFF1ZXVlXy5wdXNoKHsNCiAgICAgICAgICAgICAgICBwYXRoU3RyaW5nLA0KICAgICAgICAgICAgICAgIGFjdGlvbjogJ28nLA0KICAgICAgICAgICAgICAgIGRhdGEsDQogICAgICAgICAgICAgICAgb25Db21wbGV0ZQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9DQogICAgb25EaXNjb25uZWN0TWVyZ2UocGF0aFN0cmluZywgZGF0YSwgb25Db21wbGV0ZSkgew0KICAgICAgICB0aGlzLmluaXRDb25uZWN0aW9uXygpOw0KICAgICAgICBpZiAodGhpcy5jb25uZWN0ZWRfKSB7DQogICAgICAgICAgICB0aGlzLnNlbmRPbkRpc2Nvbm5lY3RfKCdvbScsIHBhdGhTdHJpbmcsIGRhdGEsIG9uQ29tcGxldGUpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgdGhpcy5vbkRpc2Nvbm5lY3RSZXF1ZXN0UXVldWVfLnB1c2goew0KICAgICAgICAgICAgICAgIHBhdGhTdHJpbmcsDQogICAgICAgICAgICAgICAgYWN0aW9uOiAnb20nLA0KICAgICAgICAgICAgICAgIGRhdGEsDQogICAgICAgICAgICAgICAgb25Db21wbGV0ZQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9DQogICAgb25EaXNjb25uZWN0Q2FuY2VsKHBhdGhTdHJpbmcsIG9uQ29tcGxldGUpIHsNCiAgICAgICAgdGhpcy5pbml0Q29ubmVjdGlvbl8oKTsNCiAgICAgICAgaWYgKHRoaXMuY29ubmVjdGVkXykgew0KICAgICAgICAgICAgdGhpcy5zZW5kT25EaXNjb25uZWN0Xygnb2MnLCBwYXRoU3RyaW5nLCBudWxsLCBvbkNvbXBsZXRlKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMub25EaXNjb25uZWN0UmVxdWVzdFF1ZXVlXy5wdXNoKHsNCiAgICAgICAgICAgICAgICBwYXRoU3RyaW5nLA0KICAgICAgICAgICAgICAgIGFjdGlvbjogJ29jJywNCiAgICAgICAgICAgICAgICBkYXRhOiBudWxsLA0KICAgICAgICAgICAgICAgIG9uQ29tcGxldGUNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfQ0KICAgIHNlbmRPbkRpc2Nvbm5lY3RfKGFjdGlvbiwgcGF0aFN0cmluZywgZGF0YSwgb25Db21wbGV0ZSkgew0KICAgICAgICBjb25zdCByZXF1ZXN0ID0geyAvKnBhdGgqLyBwOiBwYXRoU3RyaW5nLCAvKmRhdGEqLyBkOiBkYXRhIH07DQogICAgICAgIHRoaXMubG9nXygnb25EaXNjb25uZWN0ICcgKyBhY3Rpb24sIHJlcXVlc3QpOw0KICAgICAgICB0aGlzLnNlbmRSZXF1ZXN0KGFjdGlvbiwgcmVxdWVzdCwgKHJlc3BvbnNlKSA9PiB7DQogICAgICAgICAgICBpZiAob25Db21wbGV0ZSkgew0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBvbkNvbXBsZXRlKHJlc3BvbnNlWyAvKnN0YXR1cyovJ3MnXSwgcmVzcG9uc2VbIC8qIGRhdGEgKi8nZCddKTsNCiAgICAgICAgICAgICAgICB9LCBNYXRoLmZsb29yKDApKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KICAgIHB1dChwYXRoU3RyaW5nLCBkYXRhLCBvbkNvbXBsZXRlLCBoYXNoKSB7DQogICAgICAgIHRoaXMucHV0SW50ZXJuYWwoJ3AnLCBwYXRoU3RyaW5nLCBkYXRhLCBvbkNvbXBsZXRlLCBoYXNoKTsNCiAgICB9DQogICAgbWVyZ2UocGF0aFN0cmluZywgZGF0YSwgb25Db21wbGV0ZSwgaGFzaCkgew0KICAgICAgICB0aGlzLnB1dEludGVybmFsKCdtJywgcGF0aFN0cmluZywgZGF0YSwgb25Db21wbGV0ZSwgaGFzaCk7DQogICAgfQ0KICAgIHB1dEludGVybmFsKGFjdGlvbiwgcGF0aFN0cmluZywgZGF0YSwgb25Db21wbGV0ZSwgaGFzaCkgew0KICAgICAgICB0aGlzLmluaXRDb25uZWN0aW9uXygpOw0KICAgICAgICBjb25zdCByZXF1ZXN0ID0gew0KICAgICAgICAgICAgLypwYXRoKi8gcDogcGF0aFN0cmluZywNCiAgICAgICAgICAgIC8qZGF0YSovIGQ6IGRhdGENCiAgICAgICAgfTsNCiAgICAgICAgaWYgKGhhc2ggIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgcmVxdWVzdFsgLypoYXNoKi8naCddID0gaGFzaDsNCiAgICAgICAgfQ0KICAgICAgICAvLyBUT0RPOiBPbmx5IGtlZXAgdHJhY2sgb2YgdGhlIG1vc3QgcmVjZW50IHB1dCBmb3IgYSBnaXZlbiBwYXRoPw0KICAgICAgICB0aGlzLm91dHN0YW5kaW5nUHV0c18ucHVzaCh7DQogICAgICAgICAgICBhY3Rpb24sDQogICAgICAgICAgICByZXF1ZXN0LA0KICAgICAgICAgICAgb25Db21wbGV0ZQ0KICAgICAgICB9KTsNCiAgICAgICAgdGhpcy5vdXRzdGFuZGluZ1B1dENvdW50XysrOw0KICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMub3V0c3RhbmRpbmdQdXRzXy5sZW5ndGggLSAxOw0KICAgICAgICBpZiAodGhpcy5jb25uZWN0ZWRfKSB7DQogICAgICAgICAgICB0aGlzLnNlbmRQdXRfKGluZGV4KTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMubG9nXygnQnVmZmVyaW5nIHB1dDogJyArIHBhdGhTdHJpbmcpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHNlbmRQdXRfKGluZGV4KSB7DQogICAgICAgIGNvbnN0IGFjdGlvbiA9IHRoaXMub3V0c3RhbmRpbmdQdXRzX1tpbmRleF0uYWN0aW9uOw0KICAgICAgICBjb25zdCByZXF1ZXN0ID0gdGhpcy5vdXRzdGFuZGluZ1B1dHNfW2luZGV4XS5yZXF1ZXN0Ow0KICAgICAgICBjb25zdCBvbkNvbXBsZXRlID0gdGhpcy5vdXRzdGFuZGluZ1B1dHNfW2luZGV4XS5vbkNvbXBsZXRlOw0KICAgICAgICB0aGlzLm91dHN0YW5kaW5nUHV0c19baW5kZXhdLnF1ZXVlZCA9IHRoaXMuY29ubmVjdGVkXzsNCiAgICAgICAgdGhpcy5zZW5kUmVxdWVzdChhY3Rpb24sIHJlcXVlc3QsIChtZXNzYWdlKSA9PiB7DQogICAgICAgICAgICB0aGlzLmxvZ18oYWN0aW9uICsgJyByZXNwb25zZScsIG1lc3NhZ2UpOw0KICAgICAgICAgICAgZGVsZXRlIHRoaXMub3V0c3RhbmRpbmdQdXRzX1tpbmRleF07DQogICAgICAgICAgICB0aGlzLm91dHN0YW5kaW5nUHV0Q291bnRfLS07DQogICAgICAgICAgICAvLyBDbGVhbiB1cCBhcnJheSBvY2Nhc2lvbmFsbHkuDQogICAgICAgICAgICBpZiAodGhpcy5vdXRzdGFuZGluZ1B1dENvdW50XyA9PT0gMCkgew0KICAgICAgICAgICAgICAgIHRoaXMub3V0c3RhbmRpbmdQdXRzXyA9IFtdOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKG9uQ29tcGxldGUpIHsNCiAgICAgICAgICAgICAgICBvbkNvbXBsZXRlKG1lc3NhZ2VbIC8qc3RhdHVzKi8ncyddLCBtZXNzYWdlWyAvKiBkYXRhICovJ2QnXSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0NCiAgICByZXBvcnRTdGF0cyhzdGF0cykgew0KICAgICAgICAvLyBJZiB3ZSdyZSBub3QgY29ubmVjdGVkLCB3ZSBqdXN0IGRyb3AgdGhlIHN0YXRzLg0KICAgICAgICBpZiAodGhpcy5jb25uZWN0ZWRfKSB7DQogICAgICAgICAgICBjb25zdCByZXF1ZXN0ID0geyAvKmNvdW50ZXJzKi8gYzogc3RhdHMgfTsNCiAgICAgICAgICAgIHRoaXMubG9nXygncmVwb3J0U3RhdHMnLCByZXF1ZXN0KTsNCiAgICAgICAgICAgIHRoaXMuc2VuZFJlcXVlc3QoLypzdGF0cyovICdzJywgcmVxdWVzdCwgcmVzdWx0ID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBzdGF0dXMgPSByZXN1bHRbIC8qc3RhdHVzKi8ncyddOw0KICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgIT09ICdvaycpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXJyb3JSZWFzb24gPSByZXN1bHRbIC8qIGRhdGEgKi8nZCddOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ18oJ3JlcG9ydFN0YXRzJywgJ0Vycm9yIHNlbmRpbmcgc3RhdHM6ICcgKyBlcnJvclJlYXNvbik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9DQogICAgb25EYXRhTWVzc2FnZV8obWVzc2FnZSkgew0KICAgICAgICBpZiAoJ3InIGluIG1lc3NhZ2UpIHsNCiAgICAgICAgICAgIC8vIHRoaXMgaXMgYSByZXNwb25zZQ0KICAgICAgICAgICAgdGhpcy5sb2dfKCdmcm9tIHNlcnZlcjogJyArIHN0cmluZ2lmeShtZXNzYWdlKSk7DQogICAgICAgICAgICBjb25zdCByZXFOdW0gPSBtZXNzYWdlWydyJ107DQogICAgICAgICAgICBjb25zdCBvblJlc3BvbnNlID0gdGhpcy5yZXF1ZXN0Q0JIYXNoX1tyZXFOdW1dOw0KICAgICAgICAgICAgaWYgKG9uUmVzcG9uc2UpIHsNCiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5yZXF1ZXN0Q0JIYXNoX1tyZXFOdW1dOw0KICAgICAgICAgICAgICAgIG9uUmVzcG9uc2UobWVzc2FnZVsgLypib2R5Ki8nYiddKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmICgnZXJyb3InIGluIG1lc3NhZ2UpIHsNCiAgICAgICAgICAgIHRocm93ICdBIHNlcnZlci1zaWRlIGVycm9yIGhhcyBvY2N1cnJlZDogJyArIG1lc3NhZ2VbJ2Vycm9yJ107DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoJ2EnIGluIG1lc3NhZ2UpIHsNCiAgICAgICAgICAgIC8vIGEgYW5kIGIgYXJlIGFjdGlvbiBhbmQgYm9keSwgcmVzcGVjdGl2ZWx5DQogICAgICAgICAgICB0aGlzLm9uRGF0YVB1c2hfKG1lc3NhZ2VbJ2EnXSwgbWVzc2FnZVsnYiddKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBvbkRhdGFQdXNoXyhhY3Rpb24sIGJvZHkpIHsNCiAgICAgICAgdGhpcy5sb2dfKCdoYW5kbGVTZXJ2ZXJNZXNzYWdlJywgYWN0aW9uLCBib2R5KTsNCiAgICAgICAgaWYgKGFjdGlvbiA9PT0gJ2QnKSB7DQogICAgICAgICAgICB0aGlzLm9uRGF0YVVwZGF0ZV8oYm9keVsgLypwYXRoKi8ncCddLCBib2R5WyAvKmRhdGEqLydkJ10sIA0KICAgICAgICAgICAgLyppc01lcmdlKi8gZmFsc2UsIGJvZHlbJ3QnXSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoYWN0aW9uID09PSAnbScpIHsNCiAgICAgICAgICAgIHRoaXMub25EYXRhVXBkYXRlXyhib2R5WyAvKnBhdGgqLydwJ10sIGJvZHlbIC8qZGF0YSovJ2QnXSwgDQogICAgICAgICAgICAvKmlzTWVyZ2U9Ki8gdHJ1ZSwgYm9keVsndCddKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChhY3Rpb24gPT09ICdjJykgew0KICAgICAgICAgICAgdGhpcy5vbkxpc3RlblJldm9rZWRfKGJvZHlbIC8qcGF0aCovJ3AnXSwgYm9keVsgLypxdWVyeSovJ3EnXSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoYWN0aW9uID09PSAnYWMnKSB7DQogICAgICAgICAgICB0aGlzLm9uQXV0aFJldm9rZWRfKGJvZHlbIC8qc3RhdHVzIGNvZGUqLydzJ10sIGJvZHlbIC8qIGV4cGxhbmF0aW9uICovJ2QnXSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoYWN0aW9uID09PSAnYXBjJykgew0KICAgICAgICAgICAgdGhpcy5vbkFwcENoZWNrUmV2b2tlZF8oYm9keVsgLypzdGF0dXMgY29kZSovJ3MnXSwgYm9keVsgLyogZXhwbGFuYXRpb24gKi8nZCddKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChhY3Rpb24gPT09ICdzZCcpIHsNCiAgICAgICAgICAgIHRoaXMub25TZWN1cml0eURlYnVnUGFja2V0Xyhib2R5KTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGVycm9yJDEoJ1VucmVjb2duaXplZCBhY3Rpb24gcmVjZWl2ZWQgZnJvbSBzZXJ2ZXI6ICcgKw0KICAgICAgICAgICAgICAgIHN0cmluZ2lmeShhY3Rpb24pICsNCiAgICAgICAgICAgICAgICAnXG5BcmUgeW91IHVzaW5nIHRoZSBsYXRlc3QgY2xpZW50PycpOw0KICAgICAgICB9DQogICAgfQ0KICAgIG9uUmVhZHlfKHRpbWVzdGFtcCwgc2Vzc2lvbklkKSB7DQogICAgICAgIHRoaXMubG9nXygnY29ubmVjdGlvbiByZWFkeScpOw0KICAgICAgICB0aGlzLmNvbm5lY3RlZF8gPSB0cnVlOw0KICAgICAgICB0aGlzLmxhc3RDb25uZWN0aW9uRXN0YWJsaXNoZWRUaW1lXyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOw0KICAgICAgICB0aGlzLmhhbmRsZVRpbWVzdGFtcF8odGltZXN0YW1wKTsNCiAgICAgICAgdGhpcy5sYXN0U2Vzc2lvbklkID0gc2Vzc2lvbklkOw0KICAgICAgICBpZiAodGhpcy5maXJzdENvbm5lY3Rpb25fKSB7DQogICAgICAgICAgICB0aGlzLnNlbmRDb25uZWN0U3RhdHNfKCk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5yZXN0b3JlU3RhdGVfKCk7DQogICAgICAgIHRoaXMuZmlyc3RDb25uZWN0aW9uXyA9IGZhbHNlOw0KICAgICAgICB0aGlzLm9uQ29ubmVjdFN0YXR1c18odHJ1ZSk7DQogICAgfQ0KICAgIHNjaGVkdWxlQ29ubmVjdF8odGltZW91dCkgew0KICAgICAgICBhc3NlcnQoIXRoaXMucmVhbHRpbWVfLCAiU2NoZWR1bGluZyBhIGNvbm5lY3Qgd2hlbiB3ZSdyZSBhbHJlYWR5IGNvbm5lY3RlZC9pbmc/Iik7DQogICAgICAgIGlmICh0aGlzLmVzdGFibGlzaENvbm5lY3Rpb25UaW1lcl8pIHsNCiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmVzdGFibGlzaENvbm5lY3Rpb25UaW1lcl8pOw0KICAgICAgICB9DQogICAgICAgIC8vIE5PVEU6IEV2ZW4gd2hlbiB0aW1lb3V0IGlzIDAsIGl0J3MgaW1wb3J0YW50IHRvIGRvIGEgc2V0VGltZW91dCB0byB3b3JrIGFyb3VuZCBhbiBpbmZ1cmlhdGluZyAiU2VjdXJpdHkgRXJyb3IiIGluDQogICAgICAgIC8vIEZpcmVmb3ggd2hlbiB0cnlpbmcgdG8gd3JpdGUgdG8gb3VyIGxvbmctcG9sbGluZyBpZnJhbWUgaW4gc29tZSBzY2VuYXJpb3MgKGUuZy4gRm9yZ2Ugb3Igb3VyIHVuaXQgdGVzdHMpLg0KICAgICAgICB0aGlzLmVzdGFibGlzaENvbm5lY3Rpb25UaW1lcl8gPSBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgIHRoaXMuZXN0YWJsaXNoQ29ubmVjdGlvblRpbWVyXyA9IG51bGw7DQogICAgICAgICAgICB0aGlzLmVzdGFibGlzaENvbm5lY3Rpb25fKCk7DQogICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgICAgICB9LCBNYXRoLmZsb29yKHRpbWVvdXQpKTsNCiAgICB9DQogICAgaW5pdENvbm5lY3Rpb25fKCkgew0KICAgICAgICBpZiAoIXRoaXMucmVhbHRpbWVfICYmIHRoaXMuZmlyc3RDb25uZWN0aW9uXykgew0KICAgICAgICAgICAgdGhpcy5zY2hlZHVsZUNvbm5lY3RfKDApOw0KICAgICAgICB9DQogICAgfQ0KICAgIG9uVmlzaWJsZV8odmlzaWJsZSkgew0KICAgICAgICAvLyBOT1RFOiBUYWJiaW5nIGF3YXkgYW5kIGJhY2sgdG8gYSB3aW5kb3cgd2lsbCBkZWZlYXQgb3VyIHJlY29ubmVjdCBiYWNrb2ZmLCBidXQgSSB0aGluayB0aGF0J3MgZmluZS4NCiAgICAgICAgaWYgKHZpc2libGUgJiYNCiAgICAgICAgICAgICF0aGlzLnZpc2libGVfICYmDQogICAgICAgICAgICB0aGlzLnJlY29ubmVjdERlbGF5XyA9PT0gdGhpcy5tYXhSZWNvbm5lY3REZWxheV8pIHsNCiAgICAgICAgICAgIHRoaXMubG9nXygnV2luZG93IGJlY2FtZSB2aXNpYmxlLiAgUmVkdWNpbmcgZGVsYXkuJyk7DQogICAgICAgICAgICB0aGlzLnJlY29ubmVjdERlbGF5XyA9IFJFQ09OTkVDVF9NSU5fREVMQVk7DQogICAgICAgICAgICBpZiAoIXRoaXMucmVhbHRpbWVfKSB7DQogICAgICAgICAgICAgICAgdGhpcy5zY2hlZHVsZUNvbm5lY3RfKDApOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHRoaXMudmlzaWJsZV8gPSB2aXNpYmxlOw0KICAgIH0NCiAgICBvbk9ubGluZV8ob25saW5lKSB7DQogICAgICAgIGlmIChvbmxpbmUpIHsNCiAgICAgICAgICAgIHRoaXMubG9nXygnQnJvd3NlciB3ZW50IG9ubGluZS4nKTsNCiAgICAgICAgICAgIHRoaXMucmVjb25uZWN0RGVsYXlfID0gUkVDT05ORUNUX01JTl9ERUxBWTsNCiAgICAgICAgICAgIGlmICghdGhpcy5yZWFsdGltZV8pIHsNCiAgICAgICAgICAgICAgICB0aGlzLnNjaGVkdWxlQ29ubmVjdF8oMCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICB0aGlzLmxvZ18oJ0Jyb3dzZXIgd2VudCBvZmZsaW5lLiAgS2lsbGluZyBjb25uZWN0aW9uLicpOw0KICAgICAgICAgICAgaWYgKHRoaXMucmVhbHRpbWVfKSB7DQogICAgICAgICAgICAgICAgdGhpcy5yZWFsdGltZV8uY2xvc2UoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBvblJlYWx0aW1lRGlzY29ubmVjdF8oKSB7DQogICAgICAgIHRoaXMubG9nXygnZGF0YSBjbGllbnQgZGlzY29ubmVjdGVkJyk7DQogICAgICAgIHRoaXMuY29ubmVjdGVkXyA9IGZhbHNlOw0KICAgICAgICB0aGlzLnJlYWx0aW1lXyA9IG51bGw7DQogICAgICAgIC8vIFNpbmNlIHdlIGRvbid0IGtub3cgaWYgb3VyIHNlbnQgdHJhbnNhY3Rpb25zIHN1Y2NlZWRlZCBvciBub3QsIHdlIG5lZWQgdG8gY2FuY2VsIHRoZW0uDQogICAgICAgIHRoaXMuY2FuY2VsU2VudFRyYW5zYWN0aW9uc18oKTsNCiAgICAgICAgLy8gQ2xlYXIgb3V0IHRoZSBwZW5kaW5nIHJlcXVlc3RzLg0KICAgICAgICB0aGlzLnJlcXVlc3RDQkhhc2hfID0ge307DQogICAgICAgIGlmICh0aGlzLnNob3VsZFJlY29ubmVjdF8oKSkgew0KICAgICAgICAgICAgaWYgKCF0aGlzLnZpc2libGVfKSB7DQogICAgICAgICAgICAgICAgdGhpcy5sb2dfKCJXaW5kb3cgaXNuJ3QgdmlzaWJsZS4gIERlbGF5aW5nIHJlY29ubmVjdC4iKTsNCiAgICAgICAgICAgICAgICB0aGlzLnJlY29ubmVjdERlbGF5XyA9IHRoaXMubWF4UmVjb25uZWN0RGVsYXlfOw0KICAgICAgICAgICAgICAgIHRoaXMubGFzdENvbm5lY3Rpb25BdHRlbXB0VGltZV8gPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMubGFzdENvbm5lY3Rpb25Fc3RhYmxpc2hlZFRpbWVfKSB7DQogICAgICAgICAgICAgICAgLy8gSWYgd2UndmUgYmVlbiBjb25uZWN0ZWQgbG9uZyBlbm91Z2gsIHJlc2V0IHJlY29ubmVjdCBkZWxheSB0byBtaW5pbXVtLg0KICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVTaW5jZUxhc3RDb25uZWN0U3VjY2VlZGVkID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aGlzLmxhc3RDb25uZWN0aW9uRXN0YWJsaXNoZWRUaW1lXzsNCiAgICAgICAgICAgICAgICBpZiAodGltZVNpbmNlTGFzdENvbm5lY3RTdWNjZWVkZWQgPiBSRUNPTk5FQ1RfREVMQVlfUkVTRVRfVElNRU9VVCkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLnJlY29ubmVjdERlbGF5XyA9IFJFQ09OTkVDVF9NSU5fREVMQVk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHRoaXMubGFzdENvbm5lY3Rpb25Fc3RhYmxpc2hlZFRpbWVfID0gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHRpbWVTaW5jZUxhc3RDb25uZWN0QXR0ZW1wdCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gdGhpcy5sYXN0Q29ubmVjdGlvbkF0dGVtcHRUaW1lXzsNCiAgICAgICAgICAgIGxldCByZWNvbm5lY3REZWxheSA9IE1hdGgubWF4KDAsIHRoaXMucmVjb25uZWN0RGVsYXlfIC0gdGltZVNpbmNlTGFzdENvbm5lY3RBdHRlbXB0KTsNCiAgICAgICAgICAgIHJlY29ubmVjdERlbGF5ID0gTWF0aC5yYW5kb20oKSAqIHJlY29ubmVjdERlbGF5Ow0KICAgICAgICAgICAgdGhpcy5sb2dfKCdUcnlpbmcgdG8gcmVjb25uZWN0IGluICcgKyByZWNvbm5lY3REZWxheSArICdtcycpOw0KICAgICAgICAgICAgdGhpcy5zY2hlZHVsZUNvbm5lY3RfKHJlY29ubmVjdERlbGF5KTsNCiAgICAgICAgICAgIC8vIEFkanVzdCByZWNvbm5lY3QgZGVsYXkgZm9yIG5leHQgdGltZS4NCiAgICAgICAgICAgIHRoaXMucmVjb25uZWN0RGVsYXlfID0gTWF0aC5taW4odGhpcy5tYXhSZWNvbm5lY3REZWxheV8sIHRoaXMucmVjb25uZWN0RGVsYXlfICogUkVDT05ORUNUX0RFTEFZX01VTFRJUExJRVIpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMub25Db25uZWN0U3RhdHVzXyhmYWxzZSk7DQogICAgfQ0KICAgIGFzeW5jIGVzdGFibGlzaENvbm5lY3Rpb25fKCkgew0KICAgICAgICBpZiAodGhpcy5zaG91bGRSZWNvbm5lY3RfKCkpIHsNCiAgICAgICAgICAgIHRoaXMubG9nXygnTWFraW5nIGEgY29ubmVjdGlvbiBhdHRlbXB0Jyk7DQogICAgICAgICAgICB0aGlzLmxhc3RDb25uZWN0aW9uQXR0ZW1wdFRpbWVfID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7DQogICAgICAgICAgICB0aGlzLmxhc3RDb25uZWN0aW9uRXN0YWJsaXNoZWRUaW1lXyA9IG51bGw7DQogICAgICAgICAgICBjb25zdCBvbkRhdGFNZXNzYWdlID0gdGhpcy5vbkRhdGFNZXNzYWdlXy5iaW5kKHRoaXMpOw0KICAgICAgICAgICAgY29uc3Qgb25SZWFkeSA9IHRoaXMub25SZWFkeV8uYmluZCh0aGlzKTsNCiAgICAgICAgICAgIGNvbnN0IG9uRGlzY29ubmVjdCA9IHRoaXMub25SZWFsdGltZURpc2Nvbm5lY3RfLmJpbmQodGhpcyk7DQogICAgICAgICAgICBjb25zdCBjb25uSWQgPSB0aGlzLmlkICsgJzonICsgUGVyc2lzdGVudENvbm5lY3Rpb24ubmV4dENvbm5lY3Rpb25JZF8rKzsNCiAgICAgICAgICAgIGNvbnN0IGxhc3RTZXNzaW9uSWQgPSB0aGlzLmxhc3RTZXNzaW9uSWQ7DQogICAgICAgICAgICBsZXQgY2FuY2VsZWQgPSBmYWxzZTsNCiAgICAgICAgICAgIGxldCBjb25uZWN0aW9uID0gbnVsbDsNCiAgICAgICAgICAgIGNvbnN0IGNsb3NlRm4gPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgaWYgKGNvbm5lY3Rpb24pIHsNCiAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbi5jbG9zZSgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY2FuY2VsZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICBvbkRpc2Nvbm5lY3QoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgY29uc3Qgc2VuZFJlcXVlc3RGbiA9IGZ1bmN0aW9uIChtc2cpIHsNCiAgICAgICAgICAgICAgICBhc3NlcnQoY29ubmVjdGlvbiwgInNlbmRSZXF1ZXN0IGNhbGwgd2hlbiB3ZSdyZSBub3QgY29ubmVjdGVkIG5vdCBhbGxvd2VkLiIpOw0KICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24uc2VuZFJlcXVlc3QobXNnKTsNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICB0aGlzLnJlYWx0aW1lXyA9IHsNCiAgICAgICAgICAgICAgICBjbG9zZTogY2xvc2VGbiwNCiAgICAgICAgICAgICAgICBzZW5kUmVxdWVzdDogc2VuZFJlcXVlc3RGbg0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIGNvbnN0IGZvcmNlUmVmcmVzaCA9IHRoaXMuZm9yY2VUb2tlblJlZnJlc2hfOw0KICAgICAgICAgICAgdGhpcy5mb3JjZVRva2VuUmVmcmVzaF8gPSBmYWxzZTsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgLy8gRmlyc3QgZmV0Y2ggYXV0aCBhbmQgYXBwIGNoZWNrIHRva2VuLCBhbmQgZXN0YWJsaXNoIGNvbm5lY3Rpb24gYWZ0ZXINCiAgICAgICAgICAgICAgICAvLyBmZXRjaGluZyB0aGUgdG9rZW4gd2FzIHN1Y2Nlc3NmdWwNCiAgICAgICAgICAgICAgICBjb25zdCBbYXV0aFRva2VuLCBhcHBDaGVja1Rva2VuXSA9IGF3YWl0IFByb21pc2UuYWxsKFsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5hdXRoVG9rZW5Qcm92aWRlcl8uZ2V0VG9rZW4oZm9yY2VSZWZyZXNoKSwNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBDaGVja1Rva2VuUHJvdmlkZXJfLmdldFRva2VuKGZvcmNlUmVmcmVzaCkNCiAgICAgICAgICAgICAgICBdKTsNCiAgICAgICAgICAgICAgICBpZiAoIWNhbmNlbGVkKSB7DQogICAgICAgICAgICAgICAgICAgIGxvZygnZ2V0VG9rZW4oKSBjb21wbGV0ZWQuIENyZWF0aW5nIGNvbm5lY3Rpb24uJyk7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuYXV0aFRva2VuXyA9IGF1dGhUb2tlbiAmJiBhdXRoVG9rZW4uYWNjZXNzVG9rZW47DQogICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwQ2hlY2tUb2tlbl8gPSBhcHBDaGVja1Rva2VuICYmIGFwcENoZWNrVG9rZW4udG9rZW47DQogICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24gPSBuZXcgQ29ubmVjdGlvbihjb25uSWQsIHRoaXMucmVwb0luZm9fLCB0aGlzLmFwcGxpY2F0aW9uSWRfLCB0aGlzLmFwcENoZWNrVG9rZW5fLCB0aGlzLmF1dGhUb2tlbl8sIG9uRGF0YU1lc3NhZ2UsIG9uUmVhZHksIG9uRGlzY29ubmVjdCwgDQogICAgICAgICAgICAgICAgICAgIC8qIG9uS2lsbD0gKi8gcmVhc29uID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm4ocmVhc29uICsgJyAoJyArIHRoaXMucmVwb0luZm9fLnRvU3RyaW5nKCkgKyAnKScpOw0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnRlcnJ1cHQoU0VSVkVSX0tJTExfSU5URVJSVVBUX1JFQVNPTik7DQogICAgICAgICAgICAgICAgICAgIH0sIGxhc3RTZXNzaW9uSWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgbG9nKCdnZXRUb2tlbigpIGNvbXBsZXRlZCBidXQgd2FzIGNhbmNlbGVkJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgICAgdGhpcy5sb2dfKCdGYWlsZWQgdG8gZ2V0IHRva2VuOiAnICsgZXJyb3IpOw0KICAgICAgICAgICAgICAgIGlmICghY2FuY2VsZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVwb0luZm9fLm5vZGVBZG1pbikgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBtYXkgYmUgYSBjcml0aWNhbCBlcnJvciBmb3IgdGhlIEFkbWluIE5vZGUuanMgU0RLLCBzbyBsb2cgYSB3YXJuaW5nLg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gQnV0IGdldFRva2VuKCkgbWF5IGFsc28ganVzdCBoYXZlIHRlbXBvcmFyaWx5IGZhaWxlZCwgc28gd2Ugc3RpbGwgd2FudCB0bw0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29udGludWUgcmV0cnlpbmcuDQogICAgICAgICAgICAgICAgICAgICAgICB3YXJuKGVycm9yKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBjbG9zZUZuKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIGludGVycnVwdChyZWFzb24pIHsNCiAgICAgICAgbG9nKCdJbnRlcnJ1cHRpbmcgY29ubmVjdGlvbiBmb3IgcmVhc29uOiAnICsgcmVhc29uKTsNCiAgICAgICAgdGhpcy5pbnRlcnJ1cHRSZWFzb25zX1tyZWFzb25dID0gdHJ1ZTsNCiAgICAgICAgaWYgKHRoaXMucmVhbHRpbWVfKSB7DQogICAgICAgICAgICB0aGlzLnJlYWx0aW1lXy5jbG9zZSgpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgaWYgKHRoaXMuZXN0YWJsaXNoQ29ubmVjdGlvblRpbWVyXykgew0KICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmVzdGFibGlzaENvbm5lY3Rpb25UaW1lcl8pOw0KICAgICAgICAgICAgICAgIHRoaXMuZXN0YWJsaXNoQ29ubmVjdGlvblRpbWVyXyA9IG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodGhpcy5jb25uZWN0ZWRfKSB7DQogICAgICAgICAgICAgICAgdGhpcy5vblJlYWx0aW1lRGlzY29ubmVjdF8oKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXN1bWUocmVhc29uKSB7DQogICAgICAgIGxvZygnUmVzdW1pbmcgY29ubmVjdGlvbiBmb3IgcmVhc29uOiAnICsgcmVhc29uKTsNCiAgICAgICAgZGVsZXRlIHRoaXMuaW50ZXJydXB0UmVhc29uc19bcmVhc29uXTsNCiAgICAgICAgaWYgKGlzRW1wdHkodGhpcy5pbnRlcnJ1cHRSZWFzb25zXykpIHsNCiAgICAgICAgICAgIHRoaXMucmVjb25uZWN0RGVsYXlfID0gUkVDT05ORUNUX01JTl9ERUxBWTsNCiAgICAgICAgICAgIGlmICghdGhpcy5yZWFsdGltZV8pIHsNCiAgICAgICAgICAgICAgICB0aGlzLnNjaGVkdWxlQ29ubmVjdF8oMCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgaGFuZGxlVGltZXN0YW1wXyh0aW1lc3RhbXApIHsNCiAgICAgICAgY29uc3QgZGVsdGEgPSB0aW1lc3RhbXAgLSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsNCiAgICAgICAgdGhpcy5vblNlcnZlckluZm9VcGRhdGVfKHsgc2VydmVyVGltZU9mZnNldDogZGVsdGEgfSk7DQogICAgfQ0KICAgIGNhbmNlbFNlbnRUcmFuc2FjdGlvbnNfKCkgew0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMub3V0c3RhbmRpbmdQdXRzXy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgY29uc3QgcHV0ID0gdGhpcy5vdXRzdGFuZGluZ1B1dHNfW2ldOw0KICAgICAgICAgICAgaWYgKHB1dCAmJiAvKmhhc2gqLyAnaCcgaW4gcHV0LnJlcXVlc3QgJiYgcHV0LnF1ZXVlZCkgew0KICAgICAgICAgICAgICAgIGlmIChwdXQub25Db21wbGV0ZSkgew0KICAgICAgICAgICAgICAgICAgICBwdXQub25Db21wbGV0ZSgnZGlzY29ubmVjdCcpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5vdXRzdGFuZGluZ1B1dHNfW2ldOw0KICAgICAgICAgICAgICAgIHRoaXMub3V0c3RhbmRpbmdQdXRDb3VudF8tLTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAvLyBDbGVhbiB1cCBhcnJheSBvY2Nhc2lvbmFsbHkuDQogICAgICAgIGlmICh0aGlzLm91dHN0YW5kaW5nUHV0Q291bnRfID09PSAwKSB7DQogICAgICAgICAgICB0aGlzLm91dHN0YW5kaW5nUHV0c18gPSBbXTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBvbkxpc3RlblJldm9rZWRfKHBhdGhTdHJpbmcsIHF1ZXJ5KSB7DQogICAgICAgIC8vIFJlbW92ZSB0aGUgbGlzdGVuIGFuZCBtYW51ZmFjdHVyZSBhICJwZXJtaXNzaW9uX2RlbmllZCIgZXJyb3IgZm9yIHRoZSBmYWlsZWQgbGlzdGVuLg0KICAgICAgICBsZXQgcXVlcnlJZDsNCiAgICAgICAgaWYgKCFxdWVyeSkgew0KICAgICAgICAgICAgcXVlcnlJZCA9ICdkZWZhdWx0JzsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHF1ZXJ5SWQgPSBxdWVyeS5tYXAocSA9PiBPYmplY3RUb1VuaXF1ZUtleShxKSkuam9pbignJCcpOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IGxpc3RlbiA9IHRoaXMucmVtb3ZlTGlzdGVuXyhwYXRoU3RyaW5nLCBxdWVyeUlkKTsNCiAgICAgICAgaWYgKGxpc3RlbiAmJiBsaXN0ZW4ub25Db21wbGV0ZSkgew0KICAgICAgICAgICAgbGlzdGVuLm9uQ29tcGxldGUoJ3Blcm1pc3Npb25fZGVuaWVkJyk7DQogICAgICAgIH0NCiAgICB9DQogICAgcmVtb3ZlTGlzdGVuXyhwYXRoU3RyaW5nLCBxdWVyeUlkKSB7DQogICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRQYXRoU3RyaW5nID0gbmV3IFBhdGgocGF0aFN0cmluZykudG9TdHJpbmcoKTsgLy8gbm9ybWFsaXplIHBhdGguDQogICAgICAgIGxldCBsaXN0ZW47DQogICAgICAgIGlmICh0aGlzLmxpc3RlbnMuaGFzKG5vcm1hbGl6ZWRQYXRoU3RyaW5nKSkgew0KICAgICAgICAgICAgY29uc3QgbWFwID0gdGhpcy5saXN0ZW5zLmdldChub3JtYWxpemVkUGF0aFN0cmluZyk7DQogICAgICAgICAgICBsaXN0ZW4gPSBtYXAuZ2V0KHF1ZXJ5SWQpOw0KICAgICAgICAgICAgbWFwLmRlbGV0ZShxdWVyeUlkKTsNCiAgICAgICAgICAgIGlmIChtYXAuc2l6ZSA9PT0gMCkgew0KICAgICAgICAgICAgICAgIHRoaXMubGlzdGVucy5kZWxldGUobm9ybWFsaXplZFBhdGhTdHJpbmcpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgLy8gYWxsIGxpc3RlbnMgZm9yIHRoaXMgcGF0aCBoYXMgYWxyZWFkeSBiZWVuIHJlbW92ZWQNCiAgICAgICAgICAgIGxpc3RlbiA9IHVuZGVmaW5lZDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbGlzdGVuOw0KICAgIH0NCiAgICBvbkF1dGhSZXZva2VkXyhzdGF0dXNDb2RlLCBleHBsYW5hdGlvbikgew0KICAgICAgICBsb2coJ0F1dGggdG9rZW4gcmV2b2tlZDogJyArIHN0YXR1c0NvZGUgKyAnLycgKyBleHBsYW5hdGlvbik7DQogICAgICAgIHRoaXMuYXV0aFRva2VuXyA9IG51bGw7DQogICAgICAgIHRoaXMuZm9yY2VUb2tlblJlZnJlc2hfID0gdHJ1ZTsNCiAgICAgICAgdGhpcy5yZWFsdGltZV8uY2xvc2UoKTsNCiAgICAgICAgaWYgKHN0YXR1c0NvZGUgPT09ICdpbnZhbGlkX3Rva2VuJyB8fCBzdGF0dXNDb2RlID09PSAncGVybWlzc2lvbl9kZW5pZWQnKSB7DQogICAgICAgICAgICAvLyBXZSdsbCB3YWl0IGEgY291cGxlIHRpbWVzIGJlZm9yZSBsb2dnaW5nIHRoZSB3YXJuaW5nIC8gaW5jcmVhc2luZyB0aGUNCiAgICAgICAgICAgIC8vIHJldHJ5IHBlcmlvZCBzaW5jZSBvYXV0aCB0b2tlbnMgd2lsbCByZXBvcnQgYXMgImludmFsaWQiIGlmIHRoZXkncmUNCiAgICAgICAgICAgIC8vIGp1c3QgZXhwaXJlZC4gUGx1cyB0aGVyZSBtYXkgYmUgdHJhbnNpZW50IGlzc3VlcyB0aGF0IHJlc29sdmUgdGhlbXNlbHZlcy4NCiAgICAgICAgICAgIHRoaXMuaW52YWxpZEF1dGhUb2tlbkNvdW50XysrOw0KICAgICAgICAgICAgaWYgKHRoaXMuaW52YWxpZEF1dGhUb2tlbkNvdW50XyA+PSBJTlZBTElEX1RPS0VOX1RIUkVTSE9MRCkgew0KICAgICAgICAgICAgICAgIC8vIFNldCBhIGxvbmcgcmVjb25uZWN0IGRlbGF5IGJlY2F1c2UgcmVjb3ZlcnkgaXMgdW5saWtlbHkNCiAgICAgICAgICAgICAgICB0aGlzLnJlY29ubmVjdERlbGF5XyA9IFJFQ09OTkVDVF9NQVhfREVMQVlfRk9SX0FETUlOUzsNCiAgICAgICAgICAgICAgICAvLyBOb3RpZnkgdGhlIGF1dGggdG9rZW4gcHJvdmlkZXIgdGhhdCB0aGUgdG9rZW4gaXMgaW52YWxpZCwgd2hpY2ggd2lsbCBsb2cNCiAgICAgICAgICAgICAgICAvLyBhIHdhcm5pbmcNCiAgICAgICAgICAgICAgICB0aGlzLmF1dGhUb2tlblByb3ZpZGVyXy5ub3RpZnlGb3JJbnZhbGlkVG9rZW4oKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBvbkFwcENoZWNrUmV2b2tlZF8oc3RhdHVzQ29kZSwgZXhwbGFuYXRpb24pIHsNCiAgICAgICAgbG9nKCdBcHAgY2hlY2sgdG9rZW4gcmV2b2tlZDogJyArIHN0YXR1c0NvZGUgKyAnLycgKyBleHBsYW5hdGlvbik7DQogICAgICAgIHRoaXMuYXBwQ2hlY2tUb2tlbl8gPSBudWxsOw0KICAgICAgICB0aGlzLmZvcmNlVG9rZW5SZWZyZXNoXyA9IHRydWU7DQogICAgICAgIC8vIE5vdGU6IFdlIGRvbid0IGNsb3NlIHRoZSBjb25uZWN0aW9uIGFzIHRoZSBkZXZlbG9wZXIgbWF5IG5vdCBoYXZlDQogICAgICAgIC8vIGVuZm9yY2VtZW50IGVuYWJsZWQuIFRoZSBiYWNrZW5kIGNsb3NlcyBjb25uZWN0aW9ucyB3aXRoIGVuZm9yY2VtZW50cy4NCiAgICAgICAgaWYgKHN0YXR1c0NvZGUgPT09ICdpbnZhbGlkX3Rva2VuJyB8fCBzdGF0dXNDb2RlID09PSAncGVybWlzc2lvbl9kZW5pZWQnKSB7DQogICAgICAgICAgICAvLyBXZSdsbCB3YWl0IGEgY291cGxlIHRpbWVzIGJlZm9yZSBsb2dnaW5nIHRoZSB3YXJuaW5nIC8gaW5jcmVhc2luZyB0aGUNCiAgICAgICAgICAgIC8vIHJldHJ5IHBlcmlvZCBzaW5jZSBvYXV0aCB0b2tlbnMgd2lsbCByZXBvcnQgYXMgImludmFsaWQiIGlmIHRoZXkncmUNCiAgICAgICAgICAgIC8vIGp1c3QgZXhwaXJlZC4gUGx1cyB0aGVyZSBtYXkgYmUgdHJhbnNpZW50IGlzc3VlcyB0aGF0IHJlc29sdmUgdGhlbXNlbHZlcy4NCiAgICAgICAgICAgIHRoaXMuaW52YWxpZEFwcENoZWNrVG9rZW5Db3VudF8rKzsNCiAgICAgICAgICAgIGlmICh0aGlzLmludmFsaWRBcHBDaGVja1Rva2VuQ291bnRfID49IElOVkFMSURfVE9LRU5fVEhSRVNIT0xEKSB7DQogICAgICAgICAgICAgICAgdGhpcy5hcHBDaGVja1Rva2VuUHJvdmlkZXJfLm5vdGlmeUZvckludmFsaWRUb2tlbigpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIG9uU2VjdXJpdHlEZWJ1Z1BhY2tldF8oYm9keSkgew0KICAgICAgICBpZiAodGhpcy5zZWN1cml0eURlYnVnQ2FsbGJhY2tfKSB7DQogICAgICAgICAgICB0aGlzLnNlY3VyaXR5RGVidWdDYWxsYmFja18oYm9keSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBpZiAoJ21zZycgaW4gYm9keSkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGSVJFQkFTRTogJyArIGJvZHlbJ21zZyddLnJlcGxhY2UoJ1xuJywgJ1xuRklSRUJBU0U6ICcpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXN0b3JlU3RhdGVfKCkgew0KICAgICAgICAvL1JlLWF1dGhlbnRpY2F0ZSBvdXJzZWx2ZXMgaWYgd2UgaGF2ZSBhIGNyZWRlbnRpYWwgc3RvcmVkLg0KICAgICAgICB0aGlzLnRyeUF1dGgoKTsNCiAgICAgICAgdGhpcy50cnlBcHBDaGVjaygpOw0KICAgICAgICAvLyBQdXRzIGRlcGVuZCBvbiBoYXZpbmcgcmVjZWl2ZWQgdGhlIGNvcnJlc3BvbmRpbmcgZGF0YSB1cGRhdGUgZnJvbSB0aGUgc2VydmVyIGJlZm9yZSB0aGV5IGNvbXBsZXRlLCBzbyB3ZSBtdXN0DQogICAgICAgIC8vIG1ha2Ugc3VyZSB0byBzZW5kIGxpc3RlbnMgYmVmb3JlIHB1dHMuDQogICAgICAgIGZvciAoY29uc3QgcXVlcmllcyBvZiB0aGlzLmxpc3RlbnMudmFsdWVzKCkpIHsNCiAgICAgICAgICAgIGZvciAoY29uc3QgbGlzdGVuU3BlYyBvZiBxdWVyaWVzLnZhbHVlcygpKSB7DQogICAgICAgICAgICAgICAgdGhpcy5zZW5kTGlzdGVuXyhsaXN0ZW5TcGVjKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMub3V0c3RhbmRpbmdQdXRzXy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKHRoaXMub3V0c3RhbmRpbmdQdXRzX1tpXSkgew0KICAgICAgICAgICAgICAgIHRoaXMuc2VuZFB1dF8oaSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgd2hpbGUgKHRoaXMub25EaXNjb25uZWN0UmVxdWVzdFF1ZXVlXy5sZW5ndGgpIHsNCiAgICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSB0aGlzLm9uRGlzY29ubmVjdFJlcXVlc3RRdWV1ZV8uc2hpZnQoKTsNCiAgICAgICAgICAgIHRoaXMuc2VuZE9uRGlzY29ubmVjdF8ocmVxdWVzdC5hY3Rpb24sIHJlcXVlc3QucGF0aFN0cmluZywgcmVxdWVzdC5kYXRhLCByZXF1ZXN0Lm9uQ29tcGxldGUpOw0KICAgICAgICB9DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5vdXRzdGFuZGluZ0dldHNfLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBpZiAodGhpcy5vdXRzdGFuZGluZ0dldHNfW2ldKSB7DQogICAgICAgICAgICAgICAgdGhpcy5zZW5kR2V0XyhpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBTZW5kcyBjbGllbnQgc3RhdHMgZm9yIGZpcnN0IGNvbm5lY3Rpb24NCiAgICAgKi8NCiAgICBzZW5kQ29ubmVjdFN0YXRzXygpIHsNCiAgICAgICAgY29uc3Qgc3RhdHMgPSB7fTsNCiAgICAgICAgbGV0IGNsaWVudE5hbWUgPSAnanMnOw0KICAgICAgICBzdGF0c1snc2RrLicgKyBjbGllbnROYW1lICsgJy4nICsgU0RLX1ZFUlNJT04ucmVwbGFjZSgvXC4vZywgJy0nKV0gPSAxOw0KICAgICAgICBpZiAoaXNNb2JpbGVDb3Jkb3ZhKCkpIHsNCiAgICAgICAgICAgIHN0YXRzWydmcmFtZXdvcmsuY29yZG92YSddID0gMTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChpc1JlYWN0TmF0aXZlKCkpIHsNCiAgICAgICAgICAgIHN0YXRzWydmcmFtZXdvcmsucmVhY3RuYXRpdmUnXSA9IDE7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5yZXBvcnRTdGF0cyhzdGF0cyk7DQogICAgfQ0KICAgIHNob3VsZFJlY29ubmVjdF8oKSB7DQogICAgICAgIGNvbnN0IG9ubGluZSA9IE9ubGluZU1vbml0b3IuZ2V0SW5zdGFuY2UoKS5jdXJyZW50bHlPbmxpbmUoKTsNCiAgICAgICAgcmV0dXJuIGlzRW1wdHkodGhpcy5pbnRlcnJ1cHRSZWFzb25zXykgJiYgb25saW5lOw0KICAgIH0NCn0NClBlcnNpc3RlbnRDb25uZWN0aW9uLm5leHRQZXJzaXN0ZW50Q29ubmVjdGlvbklkXyA9IDA7DQovKioNCiAqIENvdW50ZXIgZm9yIG51bWJlciBvZiBjb25uZWN0aW9ucyBjcmVhdGVkLiBNYWlubHkgdXNlZCBmb3IgdGFnZ2luZyBpbiB0aGUgbG9ncw0KICovDQpQZXJzaXN0ZW50Q29ubmVjdGlvbi5uZXh0Q29ubmVjdGlvbklkXyA9IDA7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBOYW1lZE5vZGUgew0KICAgIGNvbnN0cnVjdG9yKG5hbWUsIG5vZGUpIHsNCiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTsNCiAgICAgICAgdGhpcy5ub2RlID0gbm9kZTsNCiAgICB9DQogICAgc3RhdGljIFdyYXAobmFtZSwgbm9kZSkgew0KICAgICAgICByZXR1cm4gbmV3IE5hbWVkTm9kZShuYW1lLCBub2RlKTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBJbmRleCB7DQogICAgLyoqDQogICAgICogQHJldHVybnMgQSBzdGFuZGFsb25lIGNvbXBhcmlzb24gZnVuY3Rpb24gZm9yDQogICAgICogdGhpcyBpbmRleA0KICAgICAqLw0KICAgIGdldENvbXBhcmUoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmNvbXBhcmUuYmluZCh0aGlzKTsNCiAgICB9DQogICAgLyoqDQogICAgICogR2l2ZW4gYSBiZWZvcmUgYW5kIGFmdGVyIHZhbHVlIGZvciBhIG5vZGUsIGRldGVybWluZSBpZiB0aGUgaW5kZXhlZCB2YWx1ZSBoYXMgY2hhbmdlZC4gRXZlbiBpZiB0aGV5IGFyZSBkaWZmZXJlbnQsDQogICAgICogaXQncyBwb3NzaWJsZSB0aGF0IHRoZSBjaGFuZ2VzIGFyZSBpc29sYXRlZCB0byBwYXJ0cyBvZiB0aGUgc25hcHNob3QgdGhhdCBhcmUgbm90IGluZGV4ZWQuDQogICAgICoNCiAgICAgKg0KICAgICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIHBvcnRpb24gb2YgdGhlIHNuYXBzaG90IGJlaW5nIGluZGV4ZWQgY2hhbmdlZCBiZXR3ZWVuIG9sZE5vZGUgYW5kIG5ld05vZGUNCiAgICAgKi8NCiAgICBpbmRleGVkVmFsdWVDaGFuZ2VkKG9sZE5vZGUsIG5ld05vZGUpIHsNCiAgICAgICAgY29uc3Qgb2xkV3JhcHBlZCA9IG5ldyBOYW1lZE5vZGUoTUlOX05BTUUsIG9sZE5vZGUpOw0KICAgICAgICBjb25zdCBuZXdXcmFwcGVkID0gbmV3IE5hbWVkTm9kZShNSU5fTkFNRSwgbmV3Tm9kZSk7DQogICAgICAgIHJldHVybiB0aGlzLmNvbXBhcmUob2xkV3JhcHBlZCwgbmV3V3JhcHBlZCkgIT09IDA7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEByZXR1cm5zIGEgbm9kZSB3cmFwcGVyIHRoYXQgd2lsbCBzb3J0IGVxdWFsIHRvIG9yIGxlc3MgdGhhbg0KICAgICAqIGFueSBvdGhlciBub2RlIHdyYXBwZXIsIHVzaW5nIHRoaXMgaW5kZXgNCiAgICAgKi8NCiAgICBtaW5Qb3N0KCkgew0KICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgICAgICByZXR1cm4gTmFtZWROb2RlLk1JTjsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpsZXQgX19FTVBUWV9OT0RFOw0KY2xhc3MgS2V5SW5kZXggZXh0ZW5kcyBJbmRleCB7DQogICAgc3RhdGljIGdldCBfX0VNUFRZX05PREUoKSB7DQogICAgICAgIHJldHVybiBfX0VNUFRZX05PREU7DQogICAgfQ0KICAgIHN0YXRpYyBzZXQgX19FTVBUWV9OT0RFKHZhbCkgew0KICAgICAgICBfX0VNUFRZX05PREUgPSB2YWw7DQogICAgfQ0KICAgIGNvbXBhcmUoYSwgYikgew0KICAgICAgICByZXR1cm4gbmFtZUNvbXBhcmUoYS5uYW1lLCBiLm5hbWUpOw0KICAgIH0NCiAgICBpc0RlZmluZWRPbihub2RlKSB7DQogICAgICAgIC8vIFdlIGNvdWxkIHByb2JhYmx5IHJldHVybiB0cnVlIGhlcmUgKHNpbmNlIGV2ZXJ5IG5vZGUgaGFzIGEga2V5KSwgYnV0IGl0J3MgbmV2ZXIgY2FsbGVkDQogICAgICAgIC8vIHNvIGp1c3QgbGVhdmluZyB1bmltcGxlbWVudGVkIGZvciBub3cuDQogICAgICAgIHRocm93IGFzc2VydGlvbkVycm9yKCdLZXlJbmRleC5pc0RlZmluZWRPbiBub3QgZXhwZWN0ZWQgdG8gYmUgY2FsbGVkLicpOw0KICAgIH0NCiAgICBpbmRleGVkVmFsdWVDaGFuZ2VkKG9sZE5vZGUsIG5ld05vZGUpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBUaGUga2V5IGZvciBhIG5vZGUgbmV2ZXIgY2hhbmdlcy4NCiAgICB9DQogICAgbWluUG9zdCgpIHsNCiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgcmV0dXJuIE5hbWVkTm9kZS5NSU47DQogICAgfQ0KICAgIG1heFBvc3QoKSB7DQogICAgICAgIC8vIFRPRE86IFRoaXMgc2hvdWxkIHJlYWxseSBiZSBjcmVhdGVkIG9uY2UgYW5kIGNhY2hlZCBpbiBhIHN0YXRpYyBwcm9wZXJ0eSwgYnV0DQogICAgICAgIC8vIE5hbWVkTm9kZSBpc24ndCBkZWZpbmVkIHlldCwgc28gSSBjYW4ndCB1c2UgaXQgaW4gYSBzdGF0aWMuICBCbGVoLg0KICAgICAgICByZXR1cm4gbmV3IE5hbWVkTm9kZShNQVhfTkFNRSwgX19FTVBUWV9OT0RFKTsNCiAgICB9DQogICAgbWFrZVBvc3QoaW5kZXhWYWx1ZSwgbmFtZSkgew0KICAgICAgICBhc3NlcnQodHlwZW9mIGluZGV4VmFsdWUgPT09ICdzdHJpbmcnLCAnS2V5SW5kZXggaW5kZXhWYWx1ZSBtdXN0IGFsd2F5cyBiZSBhIHN0cmluZy4nKTsNCiAgICAgICAgLy8gV2UganVzdCB1c2UgZW1wdHkgbm9kZSwgYnV0IGl0J2xsIG5ldmVyIGJlIGNvbXBhcmVkLCBzaW5jZSBvdXIgY29tcGFyYXRvciBvbmx5IGxvb2tzIGF0IG5hbWUuDQogICAgICAgIHJldHVybiBuZXcgTmFtZWROb2RlKGluZGV4VmFsdWUsIF9fRU1QVFlfTk9ERSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEByZXR1cm5zIFN0cmluZyByZXByZXNlbnRhdGlvbiBmb3IgaW5jbHVzaW9uIGluIGEgcXVlcnkgc3BlYw0KICAgICAqLw0KICAgIHRvU3RyaW5nKCkgew0KICAgICAgICByZXR1cm4gJy5rZXknOw0KICAgIH0NCn0NCmNvbnN0IEtFWV9JTkRFWCA9IG5ldyBLZXlJbmRleCgpOwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBBbiBpdGVyYXRvciBvdmVyIGFuIExMUkJOb2RlLg0KICovDQpjbGFzcyBTb3J0ZWRNYXBJdGVyYXRvciB7DQogICAgLyoqDQogICAgICogQHBhcmFtIG5vZGUgLSBOb2RlIHRvIGl0ZXJhdGUuDQogICAgICogQHBhcmFtIGlzUmV2ZXJzZV8gLSBXaGV0aGVyIG9yIG5vdCB0byBpdGVyYXRlIGluIHJldmVyc2UNCiAgICAgKi8NCiAgICBjb25zdHJ1Y3Rvcihub2RlLCBzdGFydEtleSwgY29tcGFyYXRvciwgaXNSZXZlcnNlXywgcmVzdWx0R2VuZXJhdG9yXyA9IG51bGwpIHsNCiAgICAgICAgdGhpcy5pc1JldmVyc2VfID0gaXNSZXZlcnNlXzsNCiAgICAgICAgdGhpcy5yZXN1bHRHZW5lcmF0b3JfID0gcmVzdWx0R2VuZXJhdG9yXzsNCiAgICAgICAgdGhpcy5ub2RlU3RhY2tfID0gW107DQogICAgICAgIGxldCBjbXAgPSAxOw0KICAgICAgICB3aGlsZSAoIW5vZGUuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICBub2RlID0gbm9kZTsNCiAgICAgICAgICAgIGNtcCA9IHN0YXJ0S2V5ID8gY29tcGFyYXRvcihub2RlLmtleSwgc3RhcnRLZXkpIDogMTsNCiAgICAgICAgICAgIC8vIGZsaXAgdGhlIGNvbXBhcmlzb24gaWYgd2UncmUgZ29pbmcgaW4gcmV2ZXJzZQ0KICAgICAgICAgICAgaWYgKGlzUmV2ZXJzZV8pIHsNCiAgICAgICAgICAgICAgICBjbXAgKj0gLTE7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoY21wIDwgMCkgew0KICAgICAgICAgICAgICAgIC8vIFRoaXMgbm9kZSBpcyBsZXNzIHRoYW4gb3VyIHN0YXJ0IGtleS4gaWdub3JlIGl0DQogICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNSZXZlcnNlXykgew0KICAgICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5sZWZ0Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUucmlnaHQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoY21wID09PSAwKSB7DQogICAgICAgICAgICAgICAgLy8gVGhpcyBub2RlIGlzIGV4YWN0bHkgZXF1YWwgdG8gb3VyIHN0YXJ0IGtleS4gUHVzaCBpdCBvbiB0aGUgc3RhY2ssIGJ1dCBzdG9wIGl0ZXJhdGluZzsNCiAgICAgICAgICAgICAgICB0aGlzLm5vZGVTdGFja18ucHVzaChub2RlKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIFRoaXMgbm9kZSBpcyBncmVhdGVyIHRoYW4gb3VyIHN0YXJ0IGtleSwgYWRkIGl0IHRvIHRoZSBzdGFjayBhbmQgbW92ZSB0byB0aGUgbmV4dCBvbmUNCiAgICAgICAgICAgICAgICB0aGlzLm5vZGVTdGFja18ucHVzaChub2RlKTsNCiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1JldmVyc2VfKSB7DQogICAgICAgICAgICAgICAgICAgIG5vZGUgPSBub2RlLnJpZ2h0Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUubGVmdDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgZ2V0TmV4dCgpIHsNCiAgICAgICAgaWYgKHRoaXMubm9kZVN0YWNrXy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIGxldCBub2RlID0gdGhpcy5ub2RlU3RhY2tfLnBvcCgpOw0KICAgICAgICBsZXQgcmVzdWx0Ow0KICAgICAgICBpZiAodGhpcy5yZXN1bHRHZW5lcmF0b3JfKSB7DQogICAgICAgICAgICByZXN1bHQgPSB0aGlzLnJlc3VsdEdlbmVyYXRvcl8obm9kZS5rZXksIG5vZGUudmFsdWUpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmVzdWx0ID0geyBrZXk6IG5vZGUua2V5LCB2YWx1ZTogbm9kZS52YWx1ZSB9Ow0KICAgICAgICB9DQogICAgICAgIGlmICh0aGlzLmlzUmV2ZXJzZV8pIHsNCiAgICAgICAgICAgIG5vZGUgPSBub2RlLmxlZnQ7DQogICAgICAgICAgICB3aGlsZSAoIW5vZGUuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAgICAgdGhpcy5ub2RlU3RhY2tfLnB1c2gobm9kZSk7DQogICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUucmlnaHQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBub2RlID0gbm9kZS5yaWdodDsNCiAgICAgICAgICAgIHdoaWxlICghbm9kZS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgICAgICB0aGlzLm5vZGVTdGFja18ucHVzaChub2RlKTsNCiAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5sZWZ0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgfQ0KICAgIGhhc05leHQoKSB7DQogICAgICAgIHJldHVybiB0aGlzLm5vZGVTdGFja18ubGVuZ3RoID4gMDsNCiAgICB9DQogICAgcGVlaygpIHsNCiAgICAgICAgaWYgKHRoaXMubm9kZVN0YWNrXy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IG5vZGUgPSB0aGlzLm5vZGVTdGFja19bdGhpcy5ub2RlU3RhY2tfLmxlbmd0aCAtIDFdOw0KICAgICAgICBpZiAodGhpcy5yZXN1bHRHZW5lcmF0b3JfKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRHZW5lcmF0b3JfKG5vZGUua2V5LCBub2RlLnZhbHVlKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB7IGtleTogbm9kZS5rZXksIHZhbHVlOiBub2RlLnZhbHVlIH07DQogICAgICAgIH0NCiAgICB9DQp9DQovKioNCiAqIFJlcHJlc2VudHMgYSBub2RlIGluIGEgTGVmdC1sZWFuaW5nIFJlZC1CbGFjayB0cmVlLg0KICovDQpjbGFzcyBMTFJCTm9kZSB7DQogICAgLyoqDQogICAgICogQHBhcmFtIGtleSAtIEtleSBhc3NvY2lhdGVkIHdpdGggdGhpcyBub2RlLg0KICAgICAqIEBwYXJhbSB2YWx1ZSAtIFZhbHVlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIG5vZGUuDQogICAgICogQHBhcmFtIGNvbG9yIC0gV2hldGhlciB0aGlzIG5vZGUgaXMgcmVkLg0KICAgICAqIEBwYXJhbSBsZWZ0IC0gTGVmdCBjaGlsZC4NCiAgICAgKiBAcGFyYW0gcmlnaHQgLSBSaWdodCBjaGlsZC4NCiAgICAgKi8NCiAgICBjb25zdHJ1Y3RvcihrZXksIHZhbHVlLCBjb2xvciwgbGVmdCwgcmlnaHQpIHsNCiAgICAgICAgdGhpcy5rZXkgPSBrZXk7DQogICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsNCiAgICAgICAgdGhpcy5jb2xvciA9IGNvbG9yICE9IG51bGwgPyBjb2xvciA6IExMUkJOb2RlLlJFRDsNCiAgICAgICAgdGhpcy5sZWZ0ID0NCiAgICAgICAgICAgIGxlZnQgIT0gbnVsbCA/IGxlZnQgOiBTb3J0ZWRNYXAuRU1QVFlfTk9ERTsNCiAgICAgICAgdGhpcy5yaWdodCA9DQogICAgICAgICAgICByaWdodCAhPSBudWxsID8gcmlnaHQgOiBTb3J0ZWRNYXAuRU1QVFlfTk9ERTsNCiAgICB9DQogICAgLyoqDQogICAgICogUmV0dXJucyBhIGNvcHkgb2YgdGhlIGN1cnJlbnQgbm9kZSwgb3B0aW9uYWxseSByZXBsYWNpbmcgcGllY2VzIG9mIGl0Lg0KICAgICAqDQogICAgICogQHBhcmFtIGtleSAtIE5ldyBrZXkgZm9yIHRoZSBub2RlLCBvciBudWxsLg0KICAgICAqIEBwYXJhbSB2YWx1ZSAtIE5ldyB2YWx1ZSBmb3IgdGhlIG5vZGUsIG9yIG51bGwuDQogICAgICogQHBhcmFtIGNvbG9yIC0gTmV3IGNvbG9yIGZvciB0aGUgbm9kZSwgb3IgbnVsbC4NCiAgICAgKiBAcGFyYW0gbGVmdCAtIE5ldyBsZWZ0IGNoaWxkIGZvciB0aGUgbm9kZSwgb3IgbnVsbC4NCiAgICAgKiBAcGFyYW0gcmlnaHQgLSBOZXcgcmlnaHQgY2hpbGQgZm9yIHRoZSBub2RlLCBvciBudWxsLg0KICAgICAqIEByZXR1cm5zIFRoZSBub2RlIGNvcHkuDQogICAgICovDQogICAgY29weShrZXksIHZhbHVlLCBjb2xvciwgbGVmdCwgcmlnaHQpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBMTFJCTm9kZShrZXkgIT0gbnVsbCA/IGtleSA6IHRoaXMua2V5LCB2YWx1ZSAhPSBudWxsID8gdmFsdWUgOiB0aGlzLnZhbHVlLCBjb2xvciAhPSBudWxsID8gY29sb3IgOiB0aGlzLmNvbG9yLCBsZWZ0ICE9IG51bGwgPyBsZWZ0IDogdGhpcy5sZWZ0LCByaWdodCAhPSBudWxsID8gcmlnaHQgOiB0aGlzLnJpZ2h0KTsNCiAgICB9DQogICAgLyoqDQogICAgICogQHJldHVybnMgVGhlIHRvdGFsIG51bWJlciBvZiBub2RlcyBpbiB0aGUgdHJlZS4NCiAgICAgKi8NCiAgICBjb3VudCgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMubGVmdC5jb3VudCgpICsgMSArIHRoaXMucmlnaHQuY291bnQoKTsNCiAgICB9DQogICAgLyoqDQogICAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgdHJlZSBpcyBlbXB0eS4NCiAgICAgKi8NCiAgICBpc0VtcHR5KCkgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFRyYXZlcnNlcyB0aGUgdHJlZSBpbiBrZXkgb3JkZXIgYW5kIGNhbGxzIHRoZSBzcGVjaWZpZWQgYWN0aW9uIGZ1bmN0aW9uDQogICAgICogZm9yIGVhY2ggbm9kZS4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBhY3Rpb24gLSBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBjYWxsZWQgZm9yIGVhY2gNCiAgICAgKiAgIG5vZGUuICBJZiBpdCByZXR1cm5zIHRydWUsIHRyYXZlcnNhbCBpcyBhYm9ydGVkLg0KICAgICAqIEByZXR1cm5zIFRoZSBmaXJzdCB0cnV0aHkgdmFsdWUgcmV0dXJuZWQgYnkgYWN0aW9uLCBvciB0aGUgbGFzdCBmYWxzZXkNCiAgICAgKiAgIHZhbHVlIHJldHVybmVkIGJ5IGFjdGlvbg0KICAgICAqLw0KICAgIGlub3JkZXJUcmF2ZXJzYWwoYWN0aW9uKSB7DQogICAgICAgIHJldHVybiAodGhpcy5sZWZ0Lmlub3JkZXJUcmF2ZXJzYWwoYWN0aW9uKSB8fA0KICAgICAgICAgICAgISFhY3Rpb24odGhpcy5rZXksIHRoaXMudmFsdWUpIHx8DQogICAgICAgICAgICB0aGlzLnJpZ2h0Lmlub3JkZXJUcmF2ZXJzYWwoYWN0aW9uKSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFRyYXZlcnNlcyB0aGUgdHJlZSBpbiByZXZlcnNlIGtleSBvcmRlciBhbmQgY2FsbHMgdGhlIHNwZWNpZmllZCBhY3Rpb24gZnVuY3Rpb24NCiAgICAgKiBmb3IgZWFjaCBub2RlLg0KICAgICAqDQogICAgICogQHBhcmFtIGFjdGlvbiAtIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBmb3IgZWFjaA0KICAgICAqIG5vZGUuICBJZiBpdCByZXR1cm5zIHRydWUsIHRyYXZlcnNhbCBpcyBhYm9ydGVkLg0KICAgICAqIEByZXR1cm5zIFRydWUgaWYgdHJhdmVyc2FsIHdhcyBhYm9ydGVkLg0KICAgICAqLw0KICAgIHJldmVyc2VUcmF2ZXJzYWwoYWN0aW9uKSB7DQogICAgICAgIHJldHVybiAodGhpcy5yaWdodC5yZXZlcnNlVHJhdmVyc2FsKGFjdGlvbikgfHwNCiAgICAgICAgICAgIGFjdGlvbih0aGlzLmtleSwgdGhpcy52YWx1ZSkgfHwNCiAgICAgICAgICAgIHRoaXMubGVmdC5yZXZlcnNlVHJhdmVyc2FsKGFjdGlvbikpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBUaGUgbWluaW11bSBub2RlIGluIHRoZSB0cmVlLg0KICAgICAqLw0KICAgIG1pbl8oKSB7DQogICAgICAgIGlmICh0aGlzLmxlZnQuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmxlZnQubWluXygpOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEByZXR1cm5zIFRoZSBtYXhpbXVtIGtleSBpbiB0aGUgdHJlZS4NCiAgICAgKi8NCiAgICBtaW5LZXkoKSB7DQogICAgICAgIHJldHVybiB0aGlzLm1pbl8oKS5rZXk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEByZXR1cm5zIFRoZSBtYXhpbXVtIGtleSBpbiB0aGUgdHJlZS4NCiAgICAgKi8NCiAgICBtYXhLZXkoKSB7DQogICAgICAgIGlmICh0aGlzLnJpZ2h0LmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMua2V5Ow0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMucmlnaHQubWF4S2V5KCk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogQHBhcmFtIGtleSAtIEtleSB0byBpbnNlcnQuDQogICAgICogQHBhcmFtIHZhbHVlIC0gVmFsdWUgdG8gaW5zZXJ0Lg0KICAgICAqIEBwYXJhbSBjb21wYXJhdG9yIC0gQ29tcGFyYXRvci4NCiAgICAgKiBAcmV0dXJucyBOZXcgdHJlZSwgd2l0aCB0aGUga2V5L3ZhbHVlIGFkZGVkLg0KICAgICAqLw0KICAgIGluc2VydChrZXksIHZhbHVlLCBjb21wYXJhdG9yKSB7DQogICAgICAgIGxldCBuID0gdGhpczsNCiAgICAgICAgY29uc3QgY21wID0gY29tcGFyYXRvcihrZXksIG4ua2V5KTsNCiAgICAgICAgaWYgKGNtcCA8IDApIHsNCiAgICAgICAgICAgIG4gPSBuLmNvcHkobnVsbCwgbnVsbCwgbnVsbCwgbi5sZWZ0Lmluc2VydChrZXksIHZhbHVlLCBjb21wYXJhdG9yKSwgbnVsbCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoY21wID09PSAwKSB7DQogICAgICAgICAgICBuID0gbi5jb3B5KG51bGwsIHZhbHVlLCBudWxsLCBudWxsLCBudWxsKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIG4gPSBuLmNvcHkobnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbi5yaWdodC5pbnNlcnQoa2V5LCB2YWx1ZSwgY29tcGFyYXRvcikpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBuLmZpeFVwXygpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBOZXcgdHJlZSwgd2l0aCB0aGUgbWluaW11bSBrZXkgcmVtb3ZlZC4NCiAgICAgKi8NCiAgICByZW1vdmVNaW5fKCkgew0KICAgICAgICBpZiAodGhpcy5sZWZ0LmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgcmV0dXJuIFNvcnRlZE1hcC5FTVBUWV9OT0RFOw0KICAgICAgICB9DQogICAgICAgIGxldCBuID0gdGhpczsNCiAgICAgICAgaWYgKCFuLmxlZnQuaXNSZWRfKCkgJiYgIW4ubGVmdC5sZWZ0LmlzUmVkXygpKSB7DQogICAgICAgICAgICBuID0gbi5tb3ZlUmVkTGVmdF8oKTsNCiAgICAgICAgfQ0KICAgICAgICBuID0gbi5jb3B5KG51bGwsIG51bGwsIG51bGwsIG4ubGVmdC5yZW1vdmVNaW5fKCksIG51bGwpOw0KICAgICAgICByZXR1cm4gbi5maXhVcF8oKTsNCiAgICB9DQogICAgLyoqDQogICAgICogQHBhcmFtIGtleSAtIFRoZSBrZXkgb2YgdGhlIGl0ZW0gdG8gcmVtb3ZlLg0KICAgICAqIEBwYXJhbSBjb21wYXJhdG9yIC0gQ29tcGFyYXRvci4NCiAgICAgKiBAcmV0dXJucyBOZXcgdHJlZSwgd2l0aCB0aGUgc3BlY2lmaWVkIGl0ZW0gcmVtb3ZlZC4NCiAgICAgKi8NCiAgICByZW1vdmUoa2V5LCBjb21wYXJhdG9yKSB7DQogICAgICAgIGxldCBuLCBzbWFsbGVzdDsNCiAgICAgICAgbiA9IHRoaXM7DQogICAgICAgIGlmIChjb21wYXJhdG9yKGtleSwgbi5rZXkpIDwgMCkgew0KICAgICAgICAgICAgaWYgKCFuLmxlZnQuaXNFbXB0eSgpICYmICFuLmxlZnQuaXNSZWRfKCkgJiYgIW4ubGVmdC5sZWZ0LmlzUmVkXygpKSB7DQogICAgICAgICAgICAgICAgbiA9IG4ubW92ZVJlZExlZnRfKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBuID0gbi5jb3B5KG51bGwsIG51bGwsIG51bGwsIG4ubGVmdC5yZW1vdmUoa2V5LCBjb21wYXJhdG9yKSwgbnVsbCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBpZiAobi5sZWZ0LmlzUmVkXygpKSB7DQogICAgICAgICAgICAgICAgbiA9IG4ucm90YXRlUmlnaHRfKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIW4ucmlnaHQuaXNFbXB0eSgpICYmICFuLnJpZ2h0LmlzUmVkXygpICYmICFuLnJpZ2h0LmxlZnQuaXNSZWRfKCkpIHsNCiAgICAgICAgICAgICAgICBuID0gbi5tb3ZlUmVkUmlnaHRfKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoY29tcGFyYXRvcihrZXksIG4ua2V5KSA9PT0gMCkgew0KICAgICAgICAgICAgICAgIGlmIChuLnJpZ2h0LmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gU29ydGVkTWFwLkVNUFRZX05PREU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBzbWFsbGVzdCA9IG4ucmlnaHQubWluXygpOw0KICAgICAgICAgICAgICAgICAgICBuID0gbi5jb3B5KHNtYWxsZXN0LmtleSwgc21hbGxlc3QudmFsdWUsIG51bGwsIG51bGwsIG4ucmlnaHQucmVtb3ZlTWluXygpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBuID0gbi5jb3B5KG51bGwsIG51bGwsIG51bGwsIG51bGwsIG4ucmlnaHQucmVtb3ZlKGtleSwgY29tcGFyYXRvcikpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBuLmZpeFVwXygpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBXaGV0aGVyIHRoaXMgaXMgYSBSRUQgbm9kZS4NCiAgICAgKi8NCiAgICBpc1JlZF8oKSB7DQogICAgICAgIHJldHVybiB0aGlzLmNvbG9yOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBOZXcgdHJlZSBhZnRlciBwZXJmb3JtaW5nIGFueSBuZWVkZWQgcm90YXRpb25zLg0KICAgICAqLw0KICAgIGZpeFVwXygpIHsNCiAgICAgICAgbGV0IG4gPSB0aGlzOw0KICAgICAgICBpZiAobi5yaWdodC5pc1JlZF8oKSAmJiAhbi5sZWZ0LmlzUmVkXygpKSB7DQogICAgICAgICAgICBuID0gbi5yb3RhdGVMZWZ0XygpOw0KICAgICAgICB9DQogICAgICAgIGlmIChuLmxlZnQuaXNSZWRfKCkgJiYgbi5sZWZ0LmxlZnQuaXNSZWRfKCkpIHsNCiAgICAgICAgICAgIG4gPSBuLnJvdGF0ZVJpZ2h0XygpOw0KICAgICAgICB9DQogICAgICAgIGlmIChuLmxlZnQuaXNSZWRfKCkgJiYgbi5yaWdodC5pc1JlZF8oKSkgew0KICAgICAgICAgICAgbiA9IG4uY29sb3JGbGlwXygpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBuOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBOZXcgdHJlZSwgYWZ0ZXIgbW92ZVJlZExlZnQuDQogICAgICovDQogICAgbW92ZVJlZExlZnRfKCkgew0KICAgICAgICBsZXQgbiA9IHRoaXMuY29sb3JGbGlwXygpOw0KICAgICAgICBpZiAobi5yaWdodC5sZWZ0LmlzUmVkXygpKSB7DQogICAgICAgICAgICBuID0gbi5jb3B5KG51bGwsIG51bGwsIG51bGwsIG51bGwsIG4ucmlnaHQucm90YXRlUmlnaHRfKCkpOw0KICAgICAgICAgICAgbiA9IG4ucm90YXRlTGVmdF8oKTsNCiAgICAgICAgICAgIG4gPSBuLmNvbG9yRmxpcF8oKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbjsNCiAgICB9DQogICAgLyoqDQogICAgICogQHJldHVybnMgTmV3IHRyZWUsIGFmdGVyIG1vdmVSZWRSaWdodC4NCiAgICAgKi8NCiAgICBtb3ZlUmVkUmlnaHRfKCkgew0KICAgICAgICBsZXQgbiA9IHRoaXMuY29sb3JGbGlwXygpOw0KICAgICAgICBpZiAobi5sZWZ0LmxlZnQuaXNSZWRfKCkpIHsNCiAgICAgICAgICAgIG4gPSBuLnJvdGF0ZVJpZ2h0XygpOw0KICAgICAgICAgICAgbiA9IG4uY29sb3JGbGlwXygpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBuOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBOZXcgdHJlZSwgYWZ0ZXIgcm90YXRlTGVmdC4NCiAgICAgKi8NCiAgICByb3RhdGVMZWZ0XygpIHsNCiAgICAgICAgY29uc3QgbmwgPSB0aGlzLmNvcHkobnVsbCwgbnVsbCwgTExSQk5vZGUuUkVELCBudWxsLCB0aGlzLnJpZ2h0LmxlZnQpOw0KICAgICAgICByZXR1cm4gdGhpcy5yaWdodC5jb3B5KG51bGwsIG51bGwsIHRoaXMuY29sb3IsIG5sLCBudWxsKTsNCiAgICB9DQogICAgLyoqDQogICAgICogQHJldHVybnMgTmV3IHRyZWUsIGFmdGVyIHJvdGF0ZVJpZ2h0Lg0KICAgICAqLw0KICAgIHJvdGF0ZVJpZ2h0XygpIHsNCiAgICAgICAgY29uc3QgbnIgPSB0aGlzLmNvcHkobnVsbCwgbnVsbCwgTExSQk5vZGUuUkVELCB0aGlzLmxlZnQucmlnaHQsIG51bGwpOw0KICAgICAgICByZXR1cm4gdGhpcy5sZWZ0LmNvcHkobnVsbCwgbnVsbCwgdGhpcy5jb2xvciwgbnVsbCwgbnIpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBOZXd0IHJlZSwgYWZ0ZXIgY29sb3JGbGlwLg0KICAgICAqLw0KICAgIGNvbG9yRmxpcF8oKSB7DQogICAgICAgIGNvbnN0IGxlZnQgPSB0aGlzLmxlZnQuY29weShudWxsLCBudWxsLCAhdGhpcy5sZWZ0LmNvbG9yLCBudWxsLCBudWxsKTsNCiAgICAgICAgY29uc3QgcmlnaHQgPSB0aGlzLnJpZ2h0LmNvcHkobnVsbCwgbnVsbCwgIXRoaXMucmlnaHQuY29sb3IsIG51bGwsIG51bGwpOw0KICAgICAgICByZXR1cm4gdGhpcy5jb3B5KG51bGwsIG51bGwsICF0aGlzLmNvbG9yLCBsZWZ0LCByaWdodCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEZvciB0ZXN0aW5nLg0KICAgICAqDQogICAgICogQHJldHVybnMgVHJ1ZSBpZiBhbGwgaXMgd2VsbC4NCiAgICAgKi8NCiAgICBjaGVja01heERlcHRoXygpIHsNCiAgICAgICAgY29uc3QgYmxhY2tEZXB0aCA9IHRoaXMuY2hlY2tfKCk7DQogICAgICAgIHJldHVybiBNYXRoLnBvdygyLjAsIGJsYWNrRGVwdGgpIDw9IHRoaXMuY291bnQoKSArIDE7DQogICAgfQ0KICAgIGNoZWNrXygpIHsNCiAgICAgICAgaWYgKHRoaXMuaXNSZWRfKCkgJiYgdGhpcy5sZWZ0LmlzUmVkXygpKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlZCBub2RlIGhhcyByZWQgY2hpbGQoJyArIHRoaXMua2V5ICsgJywnICsgdGhpcy52YWx1ZSArICcpJyk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHRoaXMucmlnaHQuaXNSZWRfKCkpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmlnaHQgY2hpbGQgb2YgKCcgKyB0aGlzLmtleSArICcsJyArIHRoaXMudmFsdWUgKyAnKSBpcyByZWQnKTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBibGFja0RlcHRoID0gdGhpcy5sZWZ0LmNoZWNrXygpOw0KICAgICAgICBpZiAoYmxhY2tEZXB0aCAhPT0gdGhpcy5yaWdodC5jaGVja18oKSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdCbGFjayBkZXB0aHMgZGlmZmVyJyk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gYmxhY2tEZXB0aCArICh0aGlzLmlzUmVkXygpID8gMCA6IDEpOw0KICAgICAgICB9DQogICAgfQ0KfQ0KTExSQk5vZGUuUkVEID0gdHJ1ZTsNCkxMUkJOb2RlLkJMQUNLID0gZmFsc2U7DQovKioNCiAqIFJlcHJlc2VudHMgYW4gZW1wdHkgbm9kZSAoYSBsZWFmIG5vZGUgaW4gdGhlIFJlZC1CbGFjayBUcmVlKS4NCiAqLw0KY2xhc3MgTExSQkVtcHR5Tm9kZSB7DQogICAgLyoqDQogICAgICogUmV0dXJucyBhIGNvcHkgb2YgdGhlIGN1cnJlbnQgbm9kZS4NCiAgICAgKg0KICAgICAqIEByZXR1cm5zIFRoZSBub2RlIGNvcHkuDQogICAgICovDQogICAgY29weShrZXksIHZhbHVlLCBjb2xvciwgbGVmdCwgcmlnaHQpIHsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJldHVybnMgYSBjb3B5IG9mIHRoZSB0cmVlLCB3aXRoIHRoZSBzcGVjaWZpZWQga2V5L3ZhbHVlIGFkZGVkLg0KICAgICAqDQogICAgICogQHBhcmFtIGtleSAtIEtleSB0byBiZSBhZGRlZC4NCiAgICAgKiBAcGFyYW0gdmFsdWUgLSBWYWx1ZSB0byBiZSBhZGRlZC4NCiAgICAgKiBAcGFyYW0gY29tcGFyYXRvciAtIENvbXBhcmF0b3IuDQogICAgICogQHJldHVybnMgTmV3IHRyZWUsIHdpdGggaXRlbSBhZGRlZC4NCiAgICAgKi8NCiAgICBpbnNlcnQoa2V5LCB2YWx1ZSwgY29tcGFyYXRvcikgew0KICAgICAgICByZXR1cm4gbmV3IExMUkJOb2RlKGtleSwgdmFsdWUsIG51bGwpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBSZXR1cm5zIGEgY29weSBvZiB0aGUgdHJlZSwgd2l0aCB0aGUgc3BlY2lmaWVkIGtleSByZW1vdmVkLg0KICAgICAqDQogICAgICogQHBhcmFtIGtleSAtIFRoZSBrZXkgdG8gcmVtb3ZlLg0KICAgICAqIEBwYXJhbSBjb21wYXJhdG9yIC0gQ29tcGFyYXRvci4NCiAgICAgKiBAcmV0dXJucyBOZXcgdHJlZSwgd2l0aCBpdGVtIHJlbW92ZWQuDQogICAgICovDQogICAgcmVtb3ZlKGtleSwgY29tcGFyYXRvcikgew0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogICAgLyoqDQogICAgICogQHJldHVybnMgVGhlIHRvdGFsIG51bWJlciBvZiBub2RlcyBpbiB0aGUgdHJlZS4NCiAgICAgKi8NCiAgICBjb3VudCgpIHsNCiAgICAgICAgcmV0dXJuIDA7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIHRyZWUgaXMgZW1wdHkuDQogICAgICovDQogICAgaXNFbXB0eSgpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFRyYXZlcnNlcyB0aGUgdHJlZSBpbiBrZXkgb3JkZXIgYW5kIGNhbGxzIHRoZSBzcGVjaWZpZWQgYWN0aW9uIGZ1bmN0aW9uDQogICAgICogZm9yIGVhY2ggbm9kZS4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBhY3Rpb24gLSBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBjYWxsZWQgZm9yIGVhY2gNCiAgICAgKiBub2RlLiAgSWYgaXQgcmV0dXJucyB0cnVlLCB0cmF2ZXJzYWwgaXMgYWJvcnRlZC4NCiAgICAgKiBAcmV0dXJucyBUcnVlIGlmIHRyYXZlcnNhbCB3YXMgYWJvcnRlZC4NCiAgICAgKi8NCiAgICBpbm9yZGVyVHJhdmVyc2FsKGFjdGlvbikgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFRyYXZlcnNlcyB0aGUgdHJlZSBpbiByZXZlcnNlIGtleSBvcmRlciBhbmQgY2FsbHMgdGhlIHNwZWNpZmllZCBhY3Rpb24gZnVuY3Rpb24NCiAgICAgKiBmb3IgZWFjaCBub2RlLg0KICAgICAqDQogICAgICogQHBhcmFtIGFjdGlvbiAtIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBmb3IgZWFjaA0KICAgICAqIG5vZGUuICBJZiBpdCByZXR1cm5zIHRydWUsIHRyYXZlcnNhbCBpcyBhYm9ydGVkLg0KICAgICAqIEByZXR1cm5zIFRydWUgaWYgdHJhdmVyc2FsIHdhcyBhYm9ydGVkLg0KICAgICAqLw0KICAgIHJldmVyc2VUcmF2ZXJzYWwoYWN0aW9uKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgbWluS2V5KCkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgbWF4S2V5KCkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgY2hlY2tfKCkgew0KICAgICAgICByZXR1cm4gMDsNCiAgICB9DQogICAgLyoqDQogICAgICogQHJldHVybnMgV2hldGhlciB0aGlzIG5vZGUgaXMgcmVkLg0KICAgICAqLw0KICAgIGlzUmVkXygpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCn0NCi8qKg0KICogQW4gaW1tdXRhYmxlIHNvcnRlZCBtYXAgaW1wbGVtZW50YXRpb24sIGJhc2VkIG9uIGEgTGVmdC1sZWFuaW5nIFJlZC1CbGFjaw0KICogdHJlZS4NCiAqLw0KY2xhc3MgU29ydGVkTWFwIHsNCiAgICAvKioNCiAgICAgKiBAcGFyYW0gY29tcGFyYXRvcl8gLSBLZXkgY29tcGFyYXRvci4NCiAgICAgKiBAcGFyYW0gcm9vdF8gLSBPcHRpb25hbCByb290IG5vZGUgZm9yIHRoZSBtYXAuDQogICAgICovDQogICAgY29uc3RydWN0b3IoY29tcGFyYXRvcl8sIHJvb3RfID0gU29ydGVkTWFwLkVNUFRZX05PREUpIHsNCiAgICAgICAgdGhpcy5jb21wYXJhdG9yXyA9IGNvbXBhcmF0b3JfOw0KICAgICAgICB0aGlzLnJvb3RfID0gcm9vdF87DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJldHVybnMgYSBjb3B5IG9mIHRoZSBtYXAsIHdpdGggdGhlIHNwZWNpZmllZCBrZXkvdmFsdWUgYWRkZWQgb3IgcmVwbGFjZWQuDQogICAgICogKFRPRE86IFdlIHNob3VsZCBwZXJoYXBzIHJlbmFtZSB0aGlzIG1ldGhvZCB0byAncHV0JykNCiAgICAgKg0KICAgICAqIEBwYXJhbSBrZXkgLSBLZXkgdG8gYmUgYWRkZWQuDQogICAgICogQHBhcmFtIHZhbHVlIC0gVmFsdWUgdG8gYmUgYWRkZWQuDQogICAgICogQHJldHVybnMgTmV3IG1hcCwgd2l0aCBpdGVtIGFkZGVkLg0KICAgICAqLw0KICAgIGluc2VydChrZXksIHZhbHVlKSB7DQogICAgICAgIHJldHVybiBuZXcgU29ydGVkTWFwKHRoaXMuY29tcGFyYXRvcl8sIHRoaXMucm9vdF8NCiAgICAgICAgICAgIC5pbnNlcnQoa2V5LCB2YWx1ZSwgdGhpcy5jb21wYXJhdG9yXykNCiAgICAgICAgICAgIC5jb3B5KG51bGwsIG51bGwsIExMUkJOb2RlLkJMQUNLLCBudWxsLCBudWxsKSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJldHVybnMgYSBjb3B5IG9mIHRoZSBtYXAsIHdpdGggdGhlIHNwZWNpZmllZCBrZXkgcmVtb3ZlZC4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBrZXkgLSBUaGUga2V5IHRvIHJlbW92ZS4NCiAgICAgKiBAcmV0dXJucyBOZXcgbWFwLCB3aXRoIGl0ZW0gcmVtb3ZlZC4NCiAgICAgKi8NCiAgICByZW1vdmUoa2V5KSB7DQogICAgICAgIHJldHVybiBuZXcgU29ydGVkTWFwKHRoaXMuY29tcGFyYXRvcl8sIHRoaXMucm9vdF8NCiAgICAgICAgICAgIC5yZW1vdmUoa2V5LCB0aGlzLmNvbXBhcmF0b3JfKQ0KICAgICAgICAgICAgLmNvcHkobnVsbCwgbnVsbCwgTExSQk5vZGUuQkxBQ0ssIG51bGwsIG51bGwpKTsNCiAgICB9DQogICAgLyoqDQogICAgICogUmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIG5vZGUgd2l0aCB0aGUgZ2l2ZW4ga2V5LCBvciBudWxsLg0KICAgICAqDQogICAgICogQHBhcmFtIGtleSAtIFRoZSBrZXkgdG8gbG9vayB1cC4NCiAgICAgKiBAcmV0dXJucyBUaGUgdmFsdWUgb2YgdGhlIG5vZGUgd2l0aCB0aGUgZ2l2ZW4ga2V5LCBvciBudWxsIGlmIHRoZQ0KICAgICAqIGtleSBkb2Vzbid0IGV4aXN0Lg0KICAgICAqLw0KICAgIGdldChrZXkpIHsNCiAgICAgICAgbGV0IGNtcDsNCiAgICAgICAgbGV0IG5vZGUgPSB0aGlzLnJvb3RfOw0KICAgICAgICB3aGlsZSAoIW5vZGUuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICBjbXAgPSB0aGlzLmNvbXBhcmF0b3JfKGtleSwgbm9kZS5rZXkpOw0KICAgICAgICAgICAgaWYgKGNtcCA9PT0gMCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBub2RlLnZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoY21wIDwgMCkgew0KICAgICAgICAgICAgICAgIG5vZGUgPSBub2RlLmxlZnQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChjbXAgPiAwKSB7DQogICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUucmlnaHQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJldHVybnMgdGhlIGtleSBvZiB0aGUgaXRlbSAqYmVmb3JlKiB0aGUgc3BlY2lmaWVkIGtleSwgb3IgbnVsbCBpZiBrZXkgaXMgdGhlIGZpcnN0IGl0ZW0uDQogICAgICogQHBhcmFtIGtleSAtIFRoZSBrZXkgdG8gZmluZCB0aGUgcHJlZGVjZXNzb3Igb2YNCiAgICAgKiBAcmV0dXJucyBUaGUgcHJlZGVjZXNzb3Iga2V5Lg0KICAgICAqLw0KICAgIGdldFByZWRlY2Vzc29yS2V5KGtleSkgew0KICAgICAgICBsZXQgY21wLCBub2RlID0gdGhpcy5yb290XywgcmlnaHRQYXJlbnQgPSBudWxsOw0KICAgICAgICB3aGlsZSAoIW5vZGUuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICBjbXAgPSB0aGlzLmNvbXBhcmF0b3JfKGtleSwgbm9kZS5rZXkpOw0KICAgICAgICAgICAgaWYgKGNtcCA9PT0gMCkgew0KICAgICAgICAgICAgICAgIGlmICghbm9kZS5sZWZ0LmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5sZWZ0Ow0KICAgICAgICAgICAgICAgICAgICB3aGlsZSAoIW5vZGUucmlnaHQuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5yaWdodDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbm9kZS5rZXk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJpZ2h0UGFyZW50KSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiByaWdodFBhcmVudC5rZXk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsgLy8gZmlyc3QgaXRlbS4NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChjbXAgPCAwKSB7DQogICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUubGVmdDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKGNtcCA+IDApIHsNCiAgICAgICAgICAgICAgICByaWdodFBhcmVudCA9IG5vZGU7DQogICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUucmlnaHQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBdHRlbXB0ZWQgdG8gZmluZCBwcmVkZWNlc3NvciBrZXkgZm9yIGEgbm9uZXhpc3RlbnQga2V5LiAgV2hhdCBnaXZlcz8nKTsNCiAgICB9DQogICAgLyoqDQogICAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgbWFwIGlzIGVtcHR5Lg0KICAgICAqLw0KICAgIGlzRW1wdHkoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJvb3RfLmlzRW1wdHkoKTsNCiAgICB9DQogICAgLyoqDQogICAgICogQHJldHVybnMgVGhlIHRvdGFsIG51bWJlciBvZiBub2RlcyBpbiB0aGUgbWFwLg0KICAgICAqLw0KICAgIGNvdW50KCkgew0KICAgICAgICByZXR1cm4gdGhpcy5yb290Xy5jb3VudCgpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBUaGUgbWluaW11bSBrZXkgaW4gdGhlIG1hcC4NCiAgICAgKi8NCiAgICBtaW5LZXkoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJvb3RfLm1pbktleSgpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBUaGUgbWF4aW11bSBrZXkgaW4gdGhlIG1hcC4NCiAgICAgKi8NCiAgICBtYXhLZXkoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJvb3RfLm1heEtleSgpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBUcmF2ZXJzZXMgdGhlIG1hcCBpbiBrZXkgb3JkZXIgYW5kIGNhbGxzIHRoZSBzcGVjaWZpZWQgYWN0aW9uIGZ1bmN0aW9uDQogICAgICogZm9yIGVhY2gga2V5L3ZhbHVlIHBhaXIuDQogICAgICoNCiAgICAgKiBAcGFyYW0gYWN0aW9uIC0gQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgY2FsbGVkDQogICAgICogZm9yIGVhY2gga2V5L3ZhbHVlIHBhaXIuICBJZiBhY3Rpb24gcmV0dXJucyB0cnVlLCB0cmF2ZXJzYWwgaXMgYWJvcnRlZC4NCiAgICAgKiBAcmV0dXJucyBUaGUgZmlyc3QgdHJ1dGh5IHZhbHVlIHJldHVybmVkIGJ5IGFjdGlvbiwgb3IgdGhlIGxhc3QgZmFsc2V5DQogICAgICogICB2YWx1ZSByZXR1cm5lZCBieSBhY3Rpb24NCiAgICAgKi8NCiAgICBpbm9yZGVyVHJhdmVyc2FsKGFjdGlvbikgew0KICAgICAgICByZXR1cm4gdGhpcy5yb290Xy5pbm9yZGVyVHJhdmVyc2FsKGFjdGlvbik7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFRyYXZlcnNlcyB0aGUgbWFwIGluIHJldmVyc2Uga2V5IG9yZGVyIGFuZCBjYWxscyB0aGUgc3BlY2lmaWVkIGFjdGlvbiBmdW5jdGlvbg0KICAgICAqIGZvciBlYWNoIGtleS92YWx1ZSBwYWlyLg0KICAgICAqDQogICAgICogQHBhcmFtIGFjdGlvbiAtIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZA0KICAgICAqIGZvciBlYWNoIGtleS92YWx1ZSBwYWlyLiAgSWYgYWN0aW9uIHJldHVybnMgdHJ1ZSwgdHJhdmVyc2FsIGlzIGFib3J0ZWQuDQogICAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgdHJhdmVyc2FsIHdhcyBhYm9ydGVkLg0KICAgICAqLw0KICAgIHJldmVyc2VUcmF2ZXJzYWwoYWN0aW9uKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJvb3RfLnJldmVyc2VUcmF2ZXJzYWwoYWN0aW9uKTsNCiAgICB9DQogICAgLyoqDQogICAgICogUmV0dXJucyBhbiBpdGVyYXRvciBvdmVyIHRoZSBTb3J0ZWRNYXAuDQogICAgICogQHJldHVybnMgVGhlIGl0ZXJhdG9yLg0KICAgICAqLw0KICAgIGdldEl0ZXJhdG9yKHJlc3VsdEdlbmVyYXRvcikgew0KICAgICAgICByZXR1cm4gbmV3IFNvcnRlZE1hcEl0ZXJhdG9yKHRoaXMucm9vdF8sIG51bGwsIHRoaXMuY29tcGFyYXRvcl8sIGZhbHNlLCByZXN1bHRHZW5lcmF0b3IpOw0KICAgIH0NCiAgICBnZXRJdGVyYXRvckZyb20oa2V5LCByZXN1bHRHZW5lcmF0b3IpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBTb3J0ZWRNYXBJdGVyYXRvcih0aGlzLnJvb3RfLCBrZXksIHRoaXMuY29tcGFyYXRvcl8sIGZhbHNlLCByZXN1bHRHZW5lcmF0b3IpOw0KICAgIH0NCiAgICBnZXRSZXZlcnNlSXRlcmF0b3JGcm9tKGtleSwgcmVzdWx0R2VuZXJhdG9yKSB7DQogICAgICAgIHJldHVybiBuZXcgU29ydGVkTWFwSXRlcmF0b3IodGhpcy5yb290Xywga2V5LCB0aGlzLmNvbXBhcmF0b3JfLCB0cnVlLCByZXN1bHRHZW5lcmF0b3IpOw0KICAgIH0NCiAgICBnZXRSZXZlcnNlSXRlcmF0b3IocmVzdWx0R2VuZXJhdG9yKSB7DQogICAgICAgIHJldHVybiBuZXcgU29ydGVkTWFwSXRlcmF0b3IodGhpcy5yb290XywgbnVsbCwgdGhpcy5jb21wYXJhdG9yXywgdHJ1ZSwgcmVzdWx0R2VuZXJhdG9yKTsNCiAgICB9DQp9DQovKioNCiAqIEFsd2F5cyB1c2UgdGhlIHNhbWUgZW1wdHkgbm9kZSwgdG8gcmVkdWNlIG1lbW9yeS4NCiAqLw0KU29ydGVkTWFwLkVNUFRZX05PREUgPSBuZXcgTExSQkVtcHR5Tm9kZSgpOwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KZnVuY3Rpb24gTkFNRV9PTkxZX0NPTVBBUkFUT1IobGVmdCwgcmlnaHQpIHsNCiAgICByZXR1cm4gbmFtZUNvbXBhcmUobGVmdC5uYW1lLCByaWdodC5uYW1lKTsNCn0NCmZ1bmN0aW9uIE5BTUVfQ09NUEFSQVRPUihsZWZ0LCByaWdodCkgew0KICAgIHJldHVybiBuYW1lQ29tcGFyZShsZWZ0LCByaWdodCk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpsZXQgTUFYX05PREUkMjsNCmZ1bmN0aW9uIHNldE1heE5vZGUkMSh2YWwpIHsNCiAgICBNQVhfTk9ERSQyID0gdmFsOw0KfQ0KY29uc3QgcHJpb3JpdHlIYXNoVGV4dCA9IGZ1bmN0aW9uIChwcmlvcml0eSkgew0KICAgIGlmICh0eXBlb2YgcHJpb3JpdHkgPT09ICdudW1iZXInKSB7DQogICAgICAgIHJldHVybiAnbnVtYmVyOicgKyBkb3VibGVUb0lFRUU3NTRTdHJpbmcocHJpb3JpdHkpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgcmV0dXJuICdzdHJpbmc6JyArIHByaW9yaXR5Ow0KICAgIH0NCn07DQovKioNCiAqIFZhbGlkYXRlcyB0aGF0IGEgcHJpb3JpdHkgc25hcHNob3QgTm9kZSBpcyB2YWxpZC4NCiAqLw0KY29uc3QgdmFsaWRhdGVQcmlvcml0eU5vZGUgPSBmdW5jdGlvbiAocHJpb3JpdHlOb2RlKSB7DQogICAgaWYgKHByaW9yaXR5Tm9kZS5pc0xlYWZOb2RlKCkpIHsNCiAgICAgICAgY29uc3QgdmFsID0gcHJpb3JpdHlOb2RlLnZhbCgpOw0KICAgICAgICBhc3NlcnQodHlwZW9mIHZhbCA9PT0gJ3N0cmluZycgfHwNCiAgICAgICAgICAgIHR5cGVvZiB2YWwgPT09ICdudW1iZXInIHx8DQogICAgICAgICAgICAodHlwZW9mIHZhbCA9PT0gJ29iamVjdCcgJiYgY29udGFpbnModmFsLCAnLnN2JykpLCAnUHJpb3JpdHkgbXVzdCBiZSBhIHN0cmluZyBvciBudW1iZXIuJyk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBhc3NlcnQocHJpb3JpdHlOb2RlID09PSBNQVhfTk9ERSQyIHx8IHByaW9yaXR5Tm9kZS5pc0VtcHR5KCksICdwcmlvcml0eSBvZiB1bmV4cGVjdGVkIHR5cGUuJyk7DQogICAgfQ0KICAgIC8vIERvbid0IGNhbGwgZ2V0UHJpb3JpdHkoKSBvbiBNQVhfTk9ERSB0byBhdm9pZCBoaXR0aW5nIGFzc2VydGlvbi4NCiAgICBhc3NlcnQocHJpb3JpdHlOb2RlID09PSBNQVhfTk9ERSQyIHx8IHByaW9yaXR5Tm9kZS5nZXRQcmlvcml0eSgpLmlzRW1wdHkoKSwgIlByaW9yaXR5IG5vZGVzIGNhbid0IGhhdmUgYSBwcmlvcml0eSBvZiB0aGVpciBvd24uIik7DQp9OwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KbGV0IF9fY2hpbGRyZW5Ob2RlQ29uc3RydWN0b3I7DQovKioNCiAqIExlYWZOb2RlIGlzIGEgY2xhc3MgZm9yIHN0b3JpbmcgbGVhZiBub2RlcyBpbiBhIERhdGFTbmFwc2hvdC4gIEl0DQogKiBpbXBsZW1lbnRzIE5vZGUgYW5kIHN0b3JlcyB0aGUgdmFsdWUgb2YgdGhlIG5vZGUgKGEgc3RyaW5nLA0KICogbnVtYmVyLCBvciBib29sZWFuKSBhY2Nlc3NpYmxlIHZpYSBnZXRWYWx1ZSgpLg0KICovDQpjbGFzcyBMZWFmTm9kZSB7DQogICAgLyoqDQogICAgICogQHBhcmFtIHZhbHVlXyAtIFRoZSB2YWx1ZSB0byBzdG9yZSBpbiB0aGlzIGxlYWYgbm9kZS4gVGhlIG9iamVjdCB0eXBlIGlzDQogICAgICogcG9zc2libGUgaW4gdGhlIGV2ZW50IG9mIGEgZGVmZXJyZWQgdmFsdWUNCiAgICAgKiBAcGFyYW0gcHJpb3JpdHlOb2RlXyAtIFRoZSBwcmlvcml0eSBvZiB0aGlzIG5vZGUuDQogICAgICovDQogICAgY29uc3RydWN0b3IodmFsdWVfLCBwcmlvcml0eU5vZGVfID0gTGVhZk5vZGUuX19jaGlsZHJlbk5vZGVDb25zdHJ1Y3Rvci5FTVBUWV9OT0RFKSB7DQogICAgICAgIHRoaXMudmFsdWVfID0gdmFsdWVfOw0KICAgICAgICB0aGlzLnByaW9yaXR5Tm9kZV8gPSBwcmlvcml0eU5vZGVfOw0KICAgICAgICB0aGlzLmxhenlIYXNoXyA9IG51bGw7DQogICAgICAgIGFzc2VydCh0aGlzLnZhbHVlXyAhPT0gdW5kZWZpbmVkICYmIHRoaXMudmFsdWVfICE9PSBudWxsLCAiTGVhZk5vZGUgc2hvdWxkbid0IGJlIGNyZWF0ZWQgd2l0aCBudWxsL3VuZGVmaW5lZCB2YWx1ZS4iKTsNCiAgICAgICAgdmFsaWRhdGVQcmlvcml0eU5vZGUodGhpcy5wcmlvcml0eU5vZGVfKTsNCiAgICB9DQogICAgc3RhdGljIHNldCBfX2NoaWxkcmVuTm9kZUNvbnN0cnVjdG9yKHZhbCkgew0KICAgICAgICBfX2NoaWxkcmVuTm9kZUNvbnN0cnVjdG9yID0gdmFsOw0KICAgIH0NCiAgICBzdGF0aWMgZ2V0IF9fY2hpbGRyZW5Ob2RlQ29uc3RydWN0b3IoKSB7DQogICAgICAgIHJldHVybiBfX2NoaWxkcmVuTm9kZUNvbnN0cnVjdG9yOw0KICAgIH0NCiAgICAvKiogQGluaGVyaXREb2MgKi8NCiAgICBpc0xlYWZOb2RlKCkgew0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgZ2V0UHJpb3JpdHkoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnByaW9yaXR5Tm9kZV87DQogICAgfQ0KICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgIHVwZGF0ZVByaW9yaXR5KG5ld1ByaW9yaXR5Tm9kZSkgew0KICAgICAgICByZXR1cm4gbmV3IExlYWZOb2RlKHRoaXMudmFsdWVfLCBuZXdQcmlvcml0eU5vZGUpOw0KICAgIH0NCiAgICAvKiogQGluaGVyaXREb2MgKi8NCiAgICBnZXRJbW1lZGlhdGVDaGlsZChjaGlsZE5hbWUpIHsNCiAgICAgICAgLy8gSGFjayB0byB0cmVhdCBwcmlvcml0eSBhcyBhIHJlZ3VsYXIgY2hpbGQNCiAgICAgICAgaWYgKGNoaWxkTmFtZSA9PT0gJy5wcmlvcml0eScpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLnByaW9yaXR5Tm9kZV87DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gTGVhZk5vZGUuX19jaGlsZHJlbk5vZGVDb25zdHJ1Y3Rvci5FTVBUWV9OT0RFOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgIGdldENoaWxkKHBhdGgpIHsNCiAgICAgICAgaWYgKHBhdGhJc0VtcHR5KHBhdGgpKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChwYXRoR2V0RnJvbnQocGF0aCkgPT09ICcucHJpb3JpdHknKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5wcmlvcml0eU5vZGVfOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIExlYWZOb2RlLl9fY2hpbGRyZW5Ob2RlQ29uc3RydWN0b3IuRU1QVFlfTk9ERTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBoYXNDaGlsZCgpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICAvKiogQGluaGVyaXREb2MgKi8NCiAgICBnZXRQcmVkZWNlc3NvckNoaWxkTmFtZShjaGlsZE5hbWUsIGNoaWxkTm9kZSkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgdXBkYXRlSW1tZWRpYXRlQ2hpbGQoY2hpbGROYW1lLCBuZXdDaGlsZE5vZGUpIHsNCiAgICAgICAgaWYgKGNoaWxkTmFtZSA9PT0gJy5wcmlvcml0eScpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLnVwZGF0ZVByaW9yaXR5KG5ld0NoaWxkTm9kZSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAobmV3Q2hpbGROb2RlLmlzRW1wdHkoKSAmJiBjaGlsZE5hbWUgIT09ICcucHJpb3JpdHknKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBMZWFmTm9kZS5fX2NoaWxkcmVuTm9kZUNvbnN0cnVjdG9yLkVNUFRZX05PREUudXBkYXRlSW1tZWRpYXRlQ2hpbGQoY2hpbGROYW1lLCBuZXdDaGlsZE5vZGUpLnVwZGF0ZVByaW9yaXR5KHRoaXMucHJpb3JpdHlOb2RlXyk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgdXBkYXRlQ2hpbGQocGF0aCwgbmV3Q2hpbGROb2RlKSB7DQogICAgICAgIGNvbnN0IGZyb250ID0gcGF0aEdldEZyb250KHBhdGgpOw0KICAgICAgICBpZiAoZnJvbnQgPT09IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybiBuZXdDaGlsZE5vZGU7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAobmV3Q2hpbGROb2RlLmlzRW1wdHkoKSAmJiBmcm9udCAhPT0gJy5wcmlvcml0eScpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgYXNzZXJ0KGZyb250ICE9PSAnLnByaW9yaXR5JyB8fCBwYXRoR2V0TGVuZ3RoKHBhdGgpID09PSAxLCAnLnByaW9yaXR5IG11c3QgYmUgdGhlIGxhc3QgdG9rZW4gaW4gYSBwYXRoJyk7DQogICAgICAgICAgICByZXR1cm4gdGhpcy51cGRhdGVJbW1lZGlhdGVDaGlsZChmcm9udCwgTGVhZk5vZGUuX19jaGlsZHJlbk5vZGVDb25zdHJ1Y3Rvci5FTVBUWV9OT0RFLnVwZGF0ZUNoaWxkKHBhdGhQb3BGcm9udChwYXRoKSwgbmV3Q2hpbGROb2RlKSk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgaXNFbXB0eSgpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICAvKiogQGluaGVyaXREb2MgKi8NCiAgICBudW1DaGlsZHJlbigpIHsNCiAgICAgICAgcmV0dXJuIDA7DQogICAgfQ0KICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgIGZvckVhY2hDaGlsZChpbmRleCwgYWN0aW9uKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgdmFsKGV4cG9ydEZvcm1hdCkgew0KICAgICAgICBpZiAoZXhwb3J0Rm9ybWF0ICYmICF0aGlzLmdldFByaW9yaXR5KCkuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICcudmFsdWUnOiB0aGlzLmdldFZhbHVlKCksDQogICAgICAgICAgICAgICAgJy5wcmlvcml0eSc6IHRoaXMuZ2V0UHJpb3JpdHkoKS52YWwoKQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFZhbHVlKCk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgaGFzaCgpIHsNCiAgICAgICAgaWYgKHRoaXMubGF6eUhhc2hfID09PSBudWxsKSB7DQogICAgICAgICAgICBsZXQgdG9IYXNoID0gJyc7DQogICAgICAgICAgICBpZiAoIXRoaXMucHJpb3JpdHlOb2RlXy5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgICAgICB0b0hhc2ggKz0NCiAgICAgICAgICAgICAgICAgICAgJ3ByaW9yaXR5OicgKw0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHlIYXNoVGV4dCh0aGlzLnByaW9yaXR5Tm9kZV8udmFsKCkpICsNCiAgICAgICAgICAgICAgICAgICAgICAgICc6JzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSB0eXBlb2YgdGhpcy52YWx1ZV87DQogICAgICAgICAgICB0b0hhc2ggKz0gdHlwZSArICc6JzsNCiAgICAgICAgICAgIGlmICh0eXBlID09PSAnbnVtYmVyJykgew0KICAgICAgICAgICAgICAgIHRvSGFzaCArPSBkb3VibGVUb0lFRUU3NTRTdHJpbmcodGhpcy52YWx1ZV8pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgdG9IYXNoICs9IHRoaXMudmFsdWVfOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5sYXp5SGFzaF8gPSBzaGExKHRvSGFzaCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXMubGF6eUhhc2hfOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBSZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUgbGVhZiBub2RlLg0KICAgICAqIEByZXR1cm5zIFRoZSB2YWx1ZSBvZiB0aGUgbm9kZS4NCiAgICAgKi8NCiAgICBnZXRWYWx1ZSgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMudmFsdWVfOw0KICAgIH0NCiAgICBjb21wYXJlVG8ob3RoZXIpIHsNCiAgICAgICAgaWYgKG90aGVyID09PSBMZWFmTm9kZS5fX2NoaWxkcmVuTm9kZUNvbnN0cnVjdG9yLkVNUFRZX05PREUpIHsNCiAgICAgICAgICAgIHJldHVybiAxOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKG90aGVyIGluc3RhbmNlb2YgTGVhZk5vZGUuX19jaGlsZHJlbk5vZGVDb25zdHJ1Y3Rvcikgew0KICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgYXNzZXJ0KG90aGVyLmlzTGVhZk5vZGUoKSwgJ1Vua25vd24gbm9kZSB0eXBlJyk7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5jb21wYXJlVG9MZWFmTm9kZV8ob3RoZXIpOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIENvbXBhcmlzb24gc3BlY2lmaWNhbGx5IGZvciB0d28gbGVhZiBub2Rlcw0KICAgICAqLw0KICAgIGNvbXBhcmVUb0xlYWZOb2RlXyhvdGhlckxlYWYpIHsNCiAgICAgICAgY29uc3Qgb3RoZXJMZWFmVHlwZSA9IHR5cGVvZiBvdGhlckxlYWYudmFsdWVfOw0KICAgICAgICBjb25zdCB0aGlzTGVhZlR5cGUgPSB0eXBlb2YgdGhpcy52YWx1ZV87DQogICAgICAgIGNvbnN0IG90aGVySW5kZXggPSBMZWFmTm9kZS5WQUxVRV9UWVBFX09SREVSLmluZGV4T2Yob3RoZXJMZWFmVHlwZSk7DQogICAgICAgIGNvbnN0IHRoaXNJbmRleCA9IExlYWZOb2RlLlZBTFVFX1RZUEVfT1JERVIuaW5kZXhPZih0aGlzTGVhZlR5cGUpOw0KICAgICAgICBhc3NlcnQob3RoZXJJbmRleCA+PSAwLCAnVW5rbm93biBsZWFmIHR5cGU6ICcgKyBvdGhlckxlYWZUeXBlKTsNCiAgICAgICAgYXNzZXJ0KHRoaXNJbmRleCA+PSAwLCAnVW5rbm93biBsZWFmIHR5cGU6ICcgKyB0aGlzTGVhZlR5cGUpOw0KICAgICAgICBpZiAob3RoZXJJbmRleCA9PT0gdGhpc0luZGV4KSB7DQogICAgICAgICAgICAvLyBTYW1lIHR5cGUsIGNvbXBhcmUgdmFsdWVzDQogICAgICAgICAgICBpZiAodGhpc0xlYWZUeXBlID09PSAnb2JqZWN0Jykgew0KICAgICAgICAgICAgICAgIC8vIERlZmVycmVkIHZhbHVlIG5vZGVzIGFyZSBhbGwgZXF1YWwsIGJ1dCB3ZSBzaG91bGQgYWxzbyBuZXZlciBnZXQgdG8gdGhpcyBwb2ludC4uLg0KICAgICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHRoaXMgd29ya3MgYmVjYXVzZSB0cnVlID4gZmFsc2UsIGFsbCBvdGhlcnMgYXJlIG51bWJlciBvciBzdHJpbmcgY29tcGFyaXNvbnMNCiAgICAgICAgICAgICAgICBpZiAodGhpcy52YWx1ZV8gPCBvdGhlckxlYWYudmFsdWVfKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy52YWx1ZV8gPT09IG90aGVyTGVhZi52YWx1ZV8pIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gdGhpc0luZGV4IC0gb3RoZXJJbmRleDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICB3aXRoSW5kZXgoKSB7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgIH0NCiAgICBpc0luZGV4ZWQoKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICBlcXVhbHMob3RoZXIpIHsNCiAgICAgICAgaWYgKG90aGVyID09PSB0aGlzKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChvdGhlci5pc0xlYWZOb2RlKCkpIHsNCiAgICAgICAgICAgIGNvbnN0IG90aGVyTGVhZiA9IG90aGVyOw0KICAgICAgICAgICAgcmV0dXJuICh0aGlzLnZhbHVlXyA9PT0gb3RoZXJMZWFmLnZhbHVlXyAmJg0KICAgICAgICAgICAgICAgIHRoaXMucHJpb3JpdHlOb2RlXy5lcXVhbHMob3RoZXJMZWFmLnByaW9yaXR5Tm9kZV8pKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCi8qKg0KICogVGhlIHNvcnQgb3JkZXIgZm9yIGNvbXBhcmluZyBsZWFmIG5vZGVzIG9mIGRpZmZlcmVudCB0eXBlcy4gSWYgdHdvIGxlYWYgbm9kZXMgaGF2ZQ0KICogdGhlIHNhbWUgdHlwZSwgdGhlIGNvbXBhcmlzb24gZmFsbHMgYmFjayB0byB0aGVpciB2YWx1ZQ0KICovDQpMZWFmTm9kZS5WQUxVRV9UWVBFX09SREVSID0gWydvYmplY3QnLCAnYm9vbGVhbicsICdudW1iZXInLCAnc3RyaW5nJ107CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpsZXQgbm9kZUZyb21KU09OJDE7DQpsZXQgTUFYX05PREUkMTsNCmZ1bmN0aW9uIHNldE5vZGVGcm9tSlNPTih2YWwpIHsNCiAgICBub2RlRnJvbUpTT04kMSA9IHZhbDsNCn0NCmZ1bmN0aW9uIHNldE1heE5vZGUodmFsKSB7DQogICAgTUFYX05PREUkMSA9IHZhbDsNCn0NCmNsYXNzIFByaW9yaXR5SW5kZXggZXh0ZW5kcyBJbmRleCB7DQogICAgY29tcGFyZShhLCBiKSB7DQogICAgICAgIGNvbnN0IGFQcmlvcml0eSA9IGEubm9kZS5nZXRQcmlvcml0eSgpOw0KICAgICAgICBjb25zdCBiUHJpb3JpdHkgPSBiLm5vZGUuZ2V0UHJpb3JpdHkoKTsNCiAgICAgICAgY29uc3QgaW5kZXhDbXAgPSBhUHJpb3JpdHkuY29tcGFyZVRvKGJQcmlvcml0eSk7DQogICAgICAgIGlmIChpbmRleENtcCA9PT0gMCkgew0KICAgICAgICAgICAgcmV0dXJuIG5hbWVDb21wYXJlKGEubmFtZSwgYi5uYW1lKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBpbmRleENtcDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBpc0RlZmluZWRPbihub2RlKSB7DQogICAgICAgIHJldHVybiAhbm9kZS5nZXRQcmlvcml0eSgpLmlzRW1wdHkoKTsNCiAgICB9DQogICAgaW5kZXhlZFZhbHVlQ2hhbmdlZChvbGROb2RlLCBuZXdOb2RlKSB7DQogICAgICAgIHJldHVybiAhb2xkTm9kZS5nZXRQcmlvcml0eSgpLmVxdWFscyhuZXdOb2RlLmdldFByaW9yaXR5KCkpOw0KICAgIH0NCiAgICBtaW5Qb3N0KCkgew0KICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgICAgICByZXR1cm4gTmFtZWROb2RlLk1JTjsNCiAgICB9DQogICAgbWF4UG9zdCgpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBOYW1lZE5vZGUoTUFYX05BTUUsIG5ldyBMZWFmTm9kZSgnW1BSSU9SSVRZLVBPU1RdJywgTUFYX05PREUkMSkpOw0KICAgIH0NCiAgICBtYWtlUG9zdChpbmRleFZhbHVlLCBuYW1lKSB7DQogICAgICAgIGNvbnN0IHByaW9yaXR5Tm9kZSA9IG5vZGVGcm9tSlNPTiQxKGluZGV4VmFsdWUpOw0KICAgICAgICByZXR1cm4gbmV3IE5hbWVkTm9kZShuYW1lLCBuZXcgTGVhZk5vZGUoJ1tQUklPUklUWS1QT1NUXScsIHByaW9yaXR5Tm9kZSkpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBTdHJpbmcgcmVwcmVzZW50YXRpb24gZm9yIGluY2x1c2lvbiBpbiBhIHF1ZXJ5IHNwZWMNCiAgICAgKi8NCiAgICB0b1N0cmluZygpIHsNCiAgICAgICAgcmV0dXJuICcucHJpb3JpdHknOw0KICAgIH0NCn0NCmNvbnN0IFBSSU9SSVRZX0lOREVYID0gbmV3IFByaW9yaXR5SW5kZXgoKTsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNvbnN0IExPR18yID0gTWF0aC5sb2coMik7DQpjbGFzcyBCYXNlMTJOdW0gew0KICAgIGNvbnN0cnVjdG9yKGxlbmd0aCkgew0KICAgICAgICBjb25zdCBsb2dCYXNlMiA9IChudW0pID0+IA0KICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgICAgICBwYXJzZUludCgoTWF0aC5sb2cobnVtKSAvIExPR18yKSwgMTApOw0KICAgICAgICBjb25zdCBiaXRNYXNrID0gKGJpdHMpID0+IHBhcnNlSW50KEFycmF5KGJpdHMgKyAxKS5qb2luKCcxJyksIDIpOw0KICAgICAgICB0aGlzLmNvdW50ID0gbG9nQmFzZTIobGVuZ3RoICsgMSk7DQogICAgICAgIHRoaXMuY3VycmVudF8gPSB0aGlzLmNvdW50IC0gMTsNCiAgICAgICAgY29uc3QgbWFzayA9IGJpdE1hc2sodGhpcy5jb3VudCk7DQogICAgICAgIHRoaXMuYml0c18gPSAobGVuZ3RoICsgMSkgJiBtYXNrOw0KICAgIH0NCiAgICBuZXh0Qml0SXNPbmUoKSB7DQogICAgICAgIC8vbm9pbnNwZWN0aW9uIEpTQml0d2lzZU9wZXJhdG9yVXNhZ2UNCiAgICAgICAgY29uc3QgcmVzdWx0ID0gISh0aGlzLmJpdHNfICYgKDB4MSA8PCB0aGlzLmN1cnJlbnRfKSk7DQogICAgICAgIHRoaXMuY3VycmVudF8tLTsNCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQp9DQovKioNCiAqIFRha2VzIGEgbGlzdCBvZiBjaGlsZCBub2RlcyBhbmQgY29uc3RydWN0cyBhIFNvcnRlZFNldCB1c2luZyB0aGUgZ2l2ZW4gY29tcGFyaXNvbg0KICogZnVuY3Rpb24NCiAqDQogKiBVc2VzIHRoZSBhbGdvcml0aG0gZGVzY3JpYmVkIGluIHRoZSBwYXBlciBsaW5rZWQgaGVyZToNCiAqIGh0dHA6Ly9jaXRlc2VlcnguaXN0LnBzdS5lZHUvdmlld2RvYy9zdW1tYXJ5P2RvaT0xMC4xLjEuNDYuMTQ1OA0KICoNCiAqIEBwYXJhbSBjaGlsZExpc3QgLSBVbnNvcnRlZCBsaXN0IG9mIGNoaWxkcmVuDQogKiBAcGFyYW0gY21wIC0gVGhlIGNvbXBhcmlzb24gbWV0aG9kIHRvIGJlIHVzZWQNCiAqIEBwYXJhbSBrZXlGbiAtIEFuIG9wdGlvbmFsIGZ1bmN0aW9uIHRvIGV4dHJhY3QgSyBmcm9tIGEgbm9kZSB3cmFwcGVyLCBpZiBLJ3MNCiAqIHR5cGUgaXMgbm90IE5hbWVkTm9kZQ0KICogQHBhcmFtIG1hcFNvcnRGbiAtIEFuIG9wdGlvbmFsIG92ZXJyaWRlIGZvciBjb21wYXJhdG9yIHVzZWQgYnkgdGhlIGdlbmVyYXRlZCBzb3J0ZWQgbWFwDQogKi8NCmNvbnN0IGJ1aWxkQ2hpbGRTZXQgPSBmdW5jdGlvbiAoY2hpbGRMaXN0LCBjbXAsIGtleUZuLCBtYXBTb3J0Rm4pIHsNCiAgICBjaGlsZExpc3Quc29ydChjbXApOw0KICAgIGNvbnN0IGJ1aWxkQmFsYW5jZWRUcmVlID0gZnVuY3Rpb24gKGxvdywgaGlnaCkgew0KICAgICAgICBjb25zdCBsZW5ndGggPSBoaWdoIC0gbG93Ow0KICAgICAgICBsZXQgbmFtZWROb2RlOw0KICAgICAgICBsZXQga2V5Ow0KICAgICAgICBpZiAobGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChsZW5ndGggPT09IDEpIHsNCiAgICAgICAgICAgIG5hbWVkTm9kZSA9IGNoaWxkTGlzdFtsb3ddOw0KICAgICAgICAgICAga2V5ID0ga2V5Rm4gPyBrZXlGbihuYW1lZE5vZGUpIDogbmFtZWROb2RlOw0KICAgICAgICAgICAgcmV0dXJuIG5ldyBMTFJCTm9kZShrZXksIG5hbWVkTm9kZS5ub2RlLCBMTFJCTm9kZS5CTEFDSywgbnVsbCwgbnVsbCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgICAgICAgICAgY29uc3QgbWlkZGxlID0gcGFyc2VJbnQoKGxlbmd0aCAvIDIpLCAxMCkgKyBsb3c7DQogICAgICAgICAgICBjb25zdCBsZWZ0ID0gYnVpbGRCYWxhbmNlZFRyZWUobG93LCBtaWRkbGUpOw0KICAgICAgICAgICAgY29uc3QgcmlnaHQgPSBidWlsZEJhbGFuY2VkVHJlZShtaWRkbGUgKyAxLCBoaWdoKTsNCiAgICAgICAgICAgIG5hbWVkTm9kZSA9IGNoaWxkTGlzdFttaWRkbGVdOw0KICAgICAgICAgICAga2V5ID0ga2V5Rm4gPyBrZXlGbihuYW1lZE5vZGUpIDogbmFtZWROb2RlOw0KICAgICAgICAgICAgcmV0dXJuIG5ldyBMTFJCTm9kZShrZXksIG5hbWVkTm9kZS5ub2RlLCBMTFJCTm9kZS5CTEFDSywgbGVmdCwgcmlnaHQpOw0KICAgICAgICB9DQogICAgfTsNCiAgICBjb25zdCBidWlsZEZyb20xMkFycmF5ID0gZnVuY3Rpb24gKGJhc2UxMikgew0KICAgICAgICBsZXQgbm9kZSA9IG51bGw7DQogICAgICAgIGxldCByb290ID0gbnVsbDsNCiAgICAgICAgbGV0IGluZGV4ID0gY2hpbGRMaXN0Lmxlbmd0aDsNCiAgICAgICAgY29uc3QgYnVpbGRQZW5uYW50ID0gZnVuY3Rpb24gKGNodW5rU2l6ZSwgY29sb3IpIHsNCiAgICAgICAgICAgIGNvbnN0IGxvdyA9IGluZGV4IC0gY2h1bmtTaXplOw0KICAgICAgICAgICAgY29uc3QgaGlnaCA9IGluZGV4Ow0KICAgICAgICAgICAgaW5kZXggLT0gY2h1bmtTaXplOw0KICAgICAgICAgICAgY29uc3QgY2hpbGRUcmVlID0gYnVpbGRCYWxhbmNlZFRyZWUobG93ICsgMSwgaGlnaCk7DQogICAgICAgICAgICBjb25zdCBuYW1lZE5vZGUgPSBjaGlsZExpc3RbbG93XTsNCiAgICAgICAgICAgIGNvbnN0IGtleSA9IGtleUZuID8ga2V5Rm4obmFtZWROb2RlKSA6IG5hbWVkTm9kZTsNCiAgICAgICAgICAgIGF0dGFjaFBlbm5hbnQobmV3IExMUkJOb2RlKGtleSwgbmFtZWROb2RlLm5vZGUsIGNvbG9yLCBudWxsLCBjaGlsZFRyZWUpKTsNCiAgICAgICAgfTsNCiAgICAgICAgY29uc3QgYXR0YWNoUGVubmFudCA9IGZ1bmN0aW9uIChwZW5uYW50KSB7DQogICAgICAgICAgICBpZiAobm9kZSkgew0KICAgICAgICAgICAgICAgIG5vZGUubGVmdCA9IHBlbm5hbnQ7DQogICAgICAgICAgICAgICAgbm9kZSA9IHBlbm5hbnQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByb290ID0gcGVubmFudDsNCiAgICAgICAgICAgICAgICBub2RlID0gcGVubmFudDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiYXNlMTIuY291bnQ7ICsraSkgew0KICAgICAgICAgICAgY29uc3QgaXNPbmUgPSBiYXNlMTIubmV4dEJpdElzT25lKCk7DQogICAgICAgICAgICAvLyBUaGUgbnVtYmVyIG9mIG5vZGVzIHRha2VuIGluIGVhY2ggc2xpY2UgaXMgMl4oYXJyLmxlbmd0aCAtIChpICsgMSkpDQogICAgICAgICAgICBjb25zdCBjaHVua1NpemUgPSBNYXRoLnBvdygyLCBiYXNlMTIuY291bnQgLSAoaSArIDEpKTsNCiAgICAgICAgICAgIGlmIChpc09uZSkgew0KICAgICAgICAgICAgICAgIGJ1aWxkUGVubmFudChjaHVua1NpemUsIExMUkJOb2RlLkJMQUNLKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIGN1cnJlbnQgPT0gMg0KICAgICAgICAgICAgICAgIGJ1aWxkUGVubmFudChjaHVua1NpemUsIExMUkJOb2RlLkJMQUNLKTsNCiAgICAgICAgICAgICAgICBidWlsZFBlbm5hbnQoY2h1bmtTaXplLCBMTFJCTm9kZS5SRUQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiByb290Ow0KICAgIH07DQogICAgY29uc3QgYmFzZTEyID0gbmV3IEJhc2UxMk51bShjaGlsZExpc3QubGVuZ3RoKTsNCiAgICBjb25zdCByb290ID0gYnVpbGRGcm9tMTJBcnJheShiYXNlMTIpOw0KICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55DQogICAgcmV0dXJuIG5ldyBTb3J0ZWRNYXAobWFwU29ydEZuIHx8IGNtcCwgcm9vdCk7DQp9OwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KbGV0IF9kZWZhdWx0SW5kZXhNYXA7DQpjb25zdCBmYWxsYmFja09iamVjdCA9IHt9Ow0KY2xhc3MgSW5kZXhNYXAgew0KICAgIGNvbnN0cnVjdG9yKGluZGV4ZXNfLCBpbmRleFNldF8pIHsNCiAgICAgICAgdGhpcy5pbmRleGVzXyA9IGluZGV4ZXNfOw0KICAgICAgICB0aGlzLmluZGV4U2V0XyA9IGluZGV4U2V0XzsNCiAgICB9DQogICAgLyoqDQogICAgICogVGhlIGRlZmF1bHQgSW5kZXhNYXAgZm9yIG5vZGVzIHdpdGhvdXQgYSBwcmlvcml0eQ0KICAgICAqLw0KICAgIHN0YXRpYyBnZXQgRGVmYXVsdCgpIHsNCiAgICAgICAgYXNzZXJ0KGZhbGxiYWNrT2JqZWN0ICYmIFBSSU9SSVRZX0lOREVYLCAnQ2hpbGRyZW5Ob2RlLnRzIGhhcyBub3QgYmVlbiBsb2FkZWQnKTsNCiAgICAgICAgX2RlZmF1bHRJbmRleE1hcCA9DQogICAgICAgICAgICBfZGVmYXVsdEluZGV4TWFwIHx8DQogICAgICAgICAgICAgICAgbmV3IEluZGV4TWFwKHsgJy5wcmlvcml0eSc6IGZhbGxiYWNrT2JqZWN0IH0sIHsgJy5wcmlvcml0eSc6IFBSSU9SSVRZX0lOREVYIH0pOw0KICAgICAgICByZXR1cm4gX2RlZmF1bHRJbmRleE1hcDsNCiAgICB9DQogICAgZ2V0KGluZGV4S2V5KSB7DQogICAgICAgIGNvbnN0IHNvcnRlZE1hcCA9IHNhZmVHZXQodGhpcy5pbmRleGVzXywgaW5kZXhLZXkpOw0KICAgICAgICBpZiAoIXNvcnRlZE1hcCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBpbmRleCBkZWZpbmVkIGZvciAnICsgaW5kZXhLZXkpOw0KICAgICAgICB9DQogICAgICAgIGlmIChzb3J0ZWRNYXAgaW5zdGFuY2VvZiBTb3J0ZWRNYXApIHsNCiAgICAgICAgICAgIHJldHVybiBzb3J0ZWRNYXA7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAvLyBUaGUgaW5kZXggZXhpc3RzLCBidXQgaXQgZmFsbHMgYmFjayB0byBqdXN0IG5hbWUgY29tcGFyaXNvbi4gUmV0dXJuIG51bGwgc28gdGhhdCB0aGUgY2FsbGluZyBjb2RlIHVzZXMgdGhlDQogICAgICAgICAgICAvLyByZWd1bGFyIGNoaWxkIG1hcA0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICB9DQogICAgaGFzSW5kZXgoaW5kZXhEZWZpbml0aW9uKSB7DQogICAgICAgIHJldHVybiBjb250YWlucyh0aGlzLmluZGV4U2V0XywgaW5kZXhEZWZpbml0aW9uLnRvU3RyaW5nKCkpOw0KICAgIH0NCiAgICBhZGRJbmRleChpbmRleERlZmluaXRpb24sIGV4aXN0aW5nQ2hpbGRyZW4pIHsNCiAgICAgICAgYXNzZXJ0KGluZGV4RGVmaW5pdGlvbiAhPT0gS0VZX0lOREVYLCAiS2V5SW5kZXggYWx3YXlzIGV4aXN0cyBhbmQgaXNuJ3QgbWVhbnQgdG8gYmUgYWRkZWQgdG8gdGhlIEluZGV4TWFwLiIpOw0KICAgICAgICBjb25zdCBjaGlsZExpc3QgPSBbXTsNCiAgICAgICAgbGV0IHNhd0luZGV4ZWRWYWx1ZSA9IGZhbHNlOw0KICAgICAgICBjb25zdCBpdGVyID0gZXhpc3RpbmdDaGlsZHJlbi5nZXRJdGVyYXRvcihOYW1lZE5vZGUuV3JhcCk7DQogICAgICAgIGxldCBuZXh0ID0gaXRlci5nZXROZXh0KCk7DQogICAgICAgIHdoaWxlIChuZXh0KSB7DQogICAgICAgICAgICBzYXdJbmRleGVkVmFsdWUgPQ0KICAgICAgICAgICAgICAgIHNhd0luZGV4ZWRWYWx1ZSB8fCBpbmRleERlZmluaXRpb24uaXNEZWZpbmVkT24obmV4dC5ub2RlKTsNCiAgICAgICAgICAgIGNoaWxkTGlzdC5wdXNoKG5leHQpOw0KICAgICAgICAgICAgbmV4dCA9IGl0ZXIuZ2V0TmV4dCgpOw0KICAgICAgICB9DQogICAgICAgIGxldCBuZXdJbmRleDsNCiAgICAgICAgaWYgKHNhd0luZGV4ZWRWYWx1ZSkgew0KICAgICAgICAgICAgbmV3SW5kZXggPSBidWlsZENoaWxkU2V0KGNoaWxkTGlzdCwgaW5kZXhEZWZpbml0aW9uLmdldENvbXBhcmUoKSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBuZXdJbmRleCA9IGZhbGxiYWNrT2JqZWN0Ow0KICAgICAgICB9DQogICAgICAgIGNvbnN0IGluZGV4TmFtZSA9IGluZGV4RGVmaW5pdGlvbi50b1N0cmluZygpOw0KICAgICAgICBjb25zdCBuZXdJbmRleFNldCA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuaW5kZXhTZXRfKTsNCiAgICAgICAgbmV3SW5kZXhTZXRbaW5kZXhOYW1lXSA9IGluZGV4RGVmaW5pdGlvbjsNCiAgICAgICAgY29uc3QgbmV3SW5kZXhlcyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuaW5kZXhlc18pOw0KICAgICAgICBuZXdJbmRleGVzW2luZGV4TmFtZV0gPSBuZXdJbmRleDsNCiAgICAgICAgcmV0dXJuIG5ldyBJbmRleE1hcChuZXdJbmRleGVzLCBuZXdJbmRleFNldCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEVuc3VyZSB0aGF0IHRoaXMgbm9kZSBpcyBwcm9wZXJseSB0cmFja2VkIGluIGFueSBpbmRleGVzIHRoYXQgd2UncmUgbWFpbnRhaW5pbmcNCiAgICAgKi8NCiAgICBhZGRUb0luZGV4ZXMobmFtZWROb2RlLCBleGlzdGluZ0NoaWxkcmVuKSB7DQogICAgICAgIGNvbnN0IG5ld0luZGV4ZXMgPSBtYXAkMSh0aGlzLmluZGV4ZXNfLCAoaW5kZXhlZENoaWxkcmVuLCBpbmRleE5hbWUpID0+IHsNCiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gc2FmZUdldCh0aGlzLmluZGV4U2V0XywgaW5kZXhOYW1lKTsNCiAgICAgICAgICAgIGFzc2VydChpbmRleCwgJ01pc3NpbmcgaW5kZXggaW1wbGVtZW50YXRpb24gZm9yICcgKyBpbmRleE5hbWUpOw0KICAgICAgICAgICAgaWYgKGluZGV4ZWRDaGlsZHJlbiA9PT0gZmFsbGJhY2tPYmplY3QpIHsNCiAgICAgICAgICAgICAgICAvLyBDaGVjayB0byBzZWUgaWYgd2UgbmVlZCB0byBpbmRleCBldmVyeXRoaW5nDQogICAgICAgICAgICAgICAgaWYgKGluZGV4LmlzRGVmaW5lZE9uKG5hbWVkTm9kZS5ub2RlKSkgew0KICAgICAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIGJ1aWxkIHRoaXMgaW5kZXgNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGRMaXN0ID0gW107DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZXIgPSBleGlzdGluZ0NoaWxkcmVuLmdldEl0ZXJhdG9yKE5hbWVkTm9kZS5XcmFwKTsNCiAgICAgICAgICAgICAgICAgICAgbGV0IG5leHQgPSBpdGVyLmdldE5leHQoKTsNCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKG5leHQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXh0Lm5hbWUgIT09IG5hbWVkTm9kZS5uYW1lKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRMaXN0LnB1c2gobmV4dCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBuZXh0ID0gaXRlci5nZXROZXh0KCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY2hpbGRMaXN0LnB1c2gobmFtZWROb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkQ2hpbGRTZXQoY2hpbGRMaXN0LCBpbmRleC5nZXRDb21wYXJlKCkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gTm8gY2hhbmdlLCB0aGlzIHJlbWFpbnMgYSBmYWxsYmFjaw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsbGJhY2tPYmplY3Q7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdTbmFwID0gZXhpc3RpbmdDaGlsZHJlbi5nZXQobmFtZWROb2RlLm5hbWUpOw0KICAgICAgICAgICAgICAgIGxldCBuZXdDaGlsZHJlbiA9IGluZGV4ZWRDaGlsZHJlbjsNCiAgICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdTbmFwKSB7DQogICAgICAgICAgICAgICAgICAgIG5ld0NoaWxkcmVuID0gbmV3Q2hpbGRyZW4ucmVtb3ZlKG5ldyBOYW1lZE5vZGUobmFtZWROb2RlLm5hbWUsIGV4aXN0aW5nU25hcCkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3Q2hpbGRyZW4uaW5zZXJ0KG5hbWVkTm9kZSwgbmFtZWROb2RlLm5vZGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIG5ldyBJbmRleE1hcChuZXdJbmRleGVzLCB0aGlzLmluZGV4U2V0Xyk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIENyZWF0ZSBhIG5ldyBJbmRleE1hcCBpbnN0YW5jZSB3aXRoIHRoZSBnaXZlbiB2YWx1ZSByZW1vdmVkDQogICAgICovDQogICAgcmVtb3ZlRnJvbUluZGV4ZXMobmFtZWROb2RlLCBleGlzdGluZ0NoaWxkcmVuKSB7DQogICAgICAgIGNvbnN0IG5ld0luZGV4ZXMgPSBtYXAkMSh0aGlzLmluZGV4ZXNfLCAoaW5kZXhlZENoaWxkcmVuKSA9PiB7DQogICAgICAgICAgICBpZiAoaW5kZXhlZENoaWxkcmVuID09PSBmYWxsYmFja09iamVjdCkgew0KICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGZhbGxiYWNrLiBKdXN0IHJldHVybiBpdCwgbm90aGluZyB0byBkbyBpbiB0aGlzIGNhc2UNCiAgICAgICAgICAgICAgICByZXR1cm4gaW5kZXhlZENoaWxkcmVuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdTbmFwID0gZXhpc3RpbmdDaGlsZHJlbi5nZXQobmFtZWROb2RlLm5hbWUpOw0KICAgICAgICAgICAgICAgIGlmIChleGlzdGluZ1NuYXApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGluZGV4ZWRDaGlsZHJlbi5yZW1vdmUobmV3IE5hbWVkTm9kZShuYW1lZE5vZGUubmFtZSwgZXhpc3RpbmdTbmFwKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAvLyBObyByZWNvcmQgb2YgdGhpcyBjaGlsZA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5kZXhlZENoaWxkcmVuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiBuZXcgSW5kZXhNYXAobmV3SW5kZXhlcywgdGhpcy5pbmRleFNldF8pOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8vIFRPRE86IEZvciBtZW1vcnkgc2F2aW5ncywgZG9uJ3Qgc3RvcmUgcHJpb3JpdHlOb2RlXyBpZiBpdCdzIGVtcHR5Lg0KbGV0IEVNUFRZX05PREU7DQovKioNCiAqIENoaWxkcmVuTm9kZSBpcyBhIGNsYXNzIGZvciBzdG9yaW5nIGludGVybmFsIG5vZGVzIGluIGEgRGF0YVNuYXBzaG90DQogKiAoaS5lLiBub2RlcyB3aXRoIGNoaWxkcmVuKS4gIEl0IGltcGxlbWVudHMgTm9kZSBhbmQgc3RvcmVzIHRoZQ0KICogbGlzdCBvZiBjaGlsZHJlbiBpbiB0aGUgY2hpbGRyZW4gcHJvcGVydHksIHNvcnRlZCBieSBjaGlsZCBuYW1lLg0KICovDQpjbGFzcyBDaGlsZHJlbk5vZGUgew0KICAgIC8qKg0KICAgICAqIEBwYXJhbSBjaGlsZHJlbl8gLSBMaXN0IG9mIGNoaWxkcmVuIG9mIHRoaXMgbm9kZS4uDQogICAgICogQHBhcmFtIHByaW9yaXR5Tm9kZV8gLSBUaGUgcHJpb3JpdHkgb2YgdGhpcyBub2RlIChhcyBhIHNuYXBzaG90IG5vZGUpLg0KICAgICAqLw0KICAgIGNvbnN0cnVjdG9yKGNoaWxkcmVuXywgcHJpb3JpdHlOb2RlXywgaW5kZXhNYXBfKSB7DQogICAgICAgIHRoaXMuY2hpbGRyZW5fID0gY2hpbGRyZW5fOw0KICAgICAgICB0aGlzLnByaW9yaXR5Tm9kZV8gPSBwcmlvcml0eU5vZGVfOw0KICAgICAgICB0aGlzLmluZGV4TWFwXyA9IGluZGV4TWFwXzsNCiAgICAgICAgdGhpcy5sYXp5SGFzaF8gPSBudWxsOw0KICAgICAgICAvKioNCiAgICAgICAgICogTm90ZTogVGhlIG9ubHkgcmVhc29uIHdlIGFsbG93IG51bGwgcHJpb3JpdHkgaXMgZm9yIEVNUFRZX05PREUsIHNpbmNlIHdlIGNhbid0IHVzZQ0KICAgICAgICAgKiBFTVBUWV9OT0RFIGFzIHRoZSBwcmlvcml0eSBvZiBFTVBUWV9OT0RFLiAgV2UgbWlnaHQgd2FudCB0byBjb25zaWRlciBtYWtpbmcgRU1QVFlfTk9ERSBpdHMgb3duDQogICAgICAgICAqIGNsYXNzIGluc3RlYWQgb2YgYW4gZW1wdHkgQ2hpbGRyZW5Ob2RlLg0KICAgICAgICAgKi8NCiAgICAgICAgaWYgKHRoaXMucHJpb3JpdHlOb2RlXykgew0KICAgICAgICAgICAgdmFsaWRhdGVQcmlvcml0eU5vZGUodGhpcy5wcmlvcml0eU5vZGVfKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodGhpcy5jaGlsZHJlbl8uaXNFbXB0eSgpKSB7DQogICAgICAgICAgICBhc3NlcnQoIXRoaXMucHJpb3JpdHlOb2RlXyB8fCB0aGlzLnByaW9yaXR5Tm9kZV8uaXNFbXB0eSgpLCAnQW4gZW1wdHkgbm9kZSBjYW5ub3QgaGF2ZSBhIHByaW9yaXR5Jyk7DQogICAgICAgIH0NCiAgICB9DQogICAgc3RhdGljIGdldCBFTVBUWV9OT0RFKCkgew0KICAgICAgICByZXR1cm4gKEVNUFRZX05PREUgfHwNCiAgICAgICAgICAgIChFTVBUWV9OT0RFID0gbmV3IENoaWxkcmVuTm9kZShuZXcgU29ydGVkTWFwKE5BTUVfQ09NUEFSQVRPUiksIG51bGwsIEluZGV4TWFwLkRlZmF1bHQpKSk7DQogICAgfQ0KICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgIGlzTGVhZk5vZGUoKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgZ2V0UHJpb3JpdHkoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnByaW9yaXR5Tm9kZV8gfHwgRU1QVFlfTk9ERTsNCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgdXBkYXRlUHJpb3JpdHkobmV3UHJpb3JpdHlOb2RlKSB7DQogICAgICAgIGlmICh0aGlzLmNoaWxkcmVuXy5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgIC8vIERvbid0IGFsbG93IHByaW9yaXRpZXMgb24gZW1wdHkgbm9kZXMNCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBDaGlsZHJlbk5vZGUodGhpcy5jaGlsZHJlbl8sIG5ld1ByaW9yaXR5Tm9kZSwgdGhpcy5pbmRleE1hcF8pOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgIGdldEltbWVkaWF0ZUNoaWxkKGNoaWxkTmFtZSkgew0KICAgICAgICAvLyBIYWNrIHRvIHRyZWF0IHByaW9yaXR5IGFzIGEgcmVndWxhciBjaGlsZA0KICAgICAgICBpZiAoY2hpbGROYW1lID09PSAnLnByaW9yaXR5Jykgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UHJpb3JpdHkoKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IGNoaWxkID0gdGhpcy5jaGlsZHJlbl8uZ2V0KGNoaWxkTmFtZSk7DQogICAgICAgICAgICByZXR1cm4gY2hpbGQgPT09IG51bGwgPyBFTVBUWV9OT0RFIDogY2hpbGQ7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgZ2V0Q2hpbGQocGF0aCkgew0KICAgICAgICBjb25zdCBmcm9udCA9IHBhdGhHZXRGcm9udChwYXRoKTsNCiAgICAgICAgaWYgKGZyb250ID09PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpcy5nZXRJbW1lZGlhdGVDaGlsZChmcm9udCkuZ2V0Q2hpbGQocGF0aFBvcEZyb250KHBhdGgpKTsNCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgaGFzQ2hpbGQoY2hpbGROYW1lKSB7DQogICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuXy5nZXQoY2hpbGROYW1lKSAhPT0gbnVsbDsNCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgdXBkYXRlSW1tZWRpYXRlQ2hpbGQoY2hpbGROYW1lLCBuZXdDaGlsZE5vZGUpIHsNCiAgICAgICAgYXNzZXJ0KG5ld0NoaWxkTm9kZSwgJ1dlIHNob3VsZCBhbHdheXMgYmUgcGFzc2luZyBzbmFwc2hvdCBub2RlcycpOw0KICAgICAgICBpZiAoY2hpbGROYW1lID09PSAnLnByaW9yaXR5Jykgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMudXBkYXRlUHJpb3JpdHkobmV3Q2hpbGROb2RlKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IG5hbWVkTm9kZSA9IG5ldyBOYW1lZE5vZGUoY2hpbGROYW1lLCBuZXdDaGlsZE5vZGUpOw0KICAgICAgICAgICAgbGV0IG5ld0NoaWxkcmVuLCBuZXdJbmRleE1hcDsNCiAgICAgICAgICAgIGlmIChuZXdDaGlsZE5vZGUuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAgICAgbmV3Q2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuXy5yZW1vdmUoY2hpbGROYW1lKTsNCiAgICAgICAgICAgICAgICBuZXdJbmRleE1hcCA9IHRoaXMuaW5kZXhNYXBfLnJlbW92ZUZyb21JbmRleGVzKG5hbWVkTm9kZSwgdGhpcy5jaGlsZHJlbl8pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgbmV3Q2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuXy5pbnNlcnQoY2hpbGROYW1lLCBuZXdDaGlsZE5vZGUpOw0KICAgICAgICAgICAgICAgIG5ld0luZGV4TWFwID0gdGhpcy5pbmRleE1hcF8uYWRkVG9JbmRleGVzKG5hbWVkTm9kZSwgdGhpcy5jaGlsZHJlbl8pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgbmV3UHJpb3JpdHkgPSBuZXdDaGlsZHJlbi5pc0VtcHR5KCkNCiAgICAgICAgICAgICAgICA/IEVNUFRZX05PREUNCiAgICAgICAgICAgICAgICA6IHRoaXMucHJpb3JpdHlOb2RlXzsNCiAgICAgICAgICAgIHJldHVybiBuZXcgQ2hpbGRyZW5Ob2RlKG5ld0NoaWxkcmVuLCBuZXdQcmlvcml0eSwgbmV3SW5kZXhNYXApOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgIHVwZGF0ZUNoaWxkKHBhdGgsIG5ld0NoaWxkTm9kZSkgew0KICAgICAgICBjb25zdCBmcm9udCA9IHBhdGhHZXRGcm9udChwYXRoKTsNCiAgICAgICAgaWYgKGZyb250ID09PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gbmV3Q2hpbGROb2RlOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgYXNzZXJ0KHBhdGhHZXRGcm9udChwYXRoKSAhPT0gJy5wcmlvcml0eScgfHwgcGF0aEdldExlbmd0aChwYXRoKSA9PT0gMSwgJy5wcmlvcml0eSBtdXN0IGJlIHRoZSBsYXN0IHRva2VuIGluIGEgcGF0aCcpOw0KICAgICAgICAgICAgY29uc3QgbmV3SW1tZWRpYXRlQ2hpbGQgPSB0aGlzLmdldEltbWVkaWF0ZUNoaWxkKGZyb250KS51cGRhdGVDaGlsZChwYXRoUG9wRnJvbnQocGF0aCksIG5ld0NoaWxkTm9kZSk7DQogICAgICAgICAgICByZXR1cm4gdGhpcy51cGRhdGVJbW1lZGlhdGVDaGlsZChmcm9udCwgbmV3SW1tZWRpYXRlQ2hpbGQpOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgIGlzRW1wdHkoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuXy5pc0VtcHR5KCk7DQogICAgfQ0KICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgIG51bUNoaWxkcmVuKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5jaGlsZHJlbl8uY291bnQoKTsNCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgdmFsKGV4cG9ydEZvcm1hdCkgew0KICAgICAgICBpZiAodGhpcy5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IG9iaiA9IHt9Ow0KICAgICAgICBsZXQgbnVtS2V5cyA9IDAsIG1heEtleSA9IDAsIGFsbEludGVnZXJLZXlzID0gdHJ1ZTsNCiAgICAgICAgdGhpcy5mb3JFYWNoQ2hpbGQoUFJJT1JJVFlfSU5ERVgsIChrZXksIGNoaWxkTm9kZSkgPT4gew0KICAgICAgICAgICAgb2JqW2tleV0gPSBjaGlsZE5vZGUudmFsKGV4cG9ydEZvcm1hdCk7DQogICAgICAgICAgICBudW1LZXlzKys7DQogICAgICAgICAgICBpZiAoYWxsSW50ZWdlcktleXMgJiYgQ2hpbGRyZW5Ob2RlLklOVEVHRVJfUkVHRVhQXy50ZXN0KGtleSkpIHsNCiAgICAgICAgICAgICAgICBtYXhLZXkgPSBNYXRoLm1heChtYXhLZXksIE51bWJlcihrZXkpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGFsbEludGVnZXJLZXlzID0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICBpZiAoIWV4cG9ydEZvcm1hdCAmJiBhbGxJbnRlZ2VyS2V5cyAmJiBtYXhLZXkgPCAyICogbnVtS2V5cykgew0KICAgICAgICAgICAgLy8gY29udmVydCB0byBhcnJheS4NCiAgICAgICAgICAgIGNvbnN0IGFycmF5ID0gW107DQogICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZ3VhcmQtZm9yLWluDQogICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBvYmopIHsNCiAgICAgICAgICAgICAgICBhcnJheVtrZXldID0gb2JqW2tleV07DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gYXJyYXk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBpZiAoZXhwb3J0Rm9ybWF0ICYmICF0aGlzLmdldFByaW9yaXR5KCkuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAgICAgb2JqWycucHJpb3JpdHknXSA9IHRoaXMuZ2V0UHJpb3JpdHkoKS52YWwoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgaGFzaCgpIHsNCiAgICAgICAgaWYgKHRoaXMubGF6eUhhc2hfID09PSBudWxsKSB7DQogICAgICAgICAgICBsZXQgdG9IYXNoID0gJyc7DQogICAgICAgICAgICBpZiAoIXRoaXMuZ2V0UHJpb3JpdHkoKS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgICAgICB0b0hhc2ggKz0NCiAgICAgICAgICAgICAgICAgICAgJ3ByaW9yaXR5OicgKw0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHlIYXNoVGV4dCh0aGlzLmdldFByaW9yaXR5KCkudmFsKCkpICsNCiAgICAgICAgICAgICAgICAgICAgICAgICc6JzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoaXMuZm9yRWFjaENoaWxkKFBSSU9SSVRZX0lOREVYLCAoa2V5LCBjaGlsZE5vZGUpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBjaGlsZEhhc2ggPSBjaGlsZE5vZGUuaGFzaCgpOw0KICAgICAgICAgICAgICAgIGlmIChjaGlsZEhhc2ggIT09ICcnKSB7DQogICAgICAgICAgICAgICAgICAgIHRvSGFzaCArPSAnOicgKyBrZXkgKyAnOicgKyBjaGlsZEhhc2g7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB0aGlzLmxhenlIYXNoXyA9IHRvSGFzaCA9PT0gJycgPyAnJyA6IHNoYTEodG9IYXNoKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpcy5sYXp5SGFzaF87DQogICAgfQ0KICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgIGdldFByZWRlY2Vzc29yQ2hpbGROYW1lKGNoaWxkTmFtZSwgY2hpbGROb2RlLCBpbmRleCkgew0KICAgICAgICBjb25zdCBpZHggPSB0aGlzLnJlc29sdmVJbmRleF8oaW5kZXgpOw0KICAgICAgICBpZiAoaWR4KSB7DQogICAgICAgICAgICBjb25zdCBwcmVkZWNlc3NvciA9IGlkeC5nZXRQcmVkZWNlc3NvcktleShuZXcgTmFtZWROb2RlKGNoaWxkTmFtZSwgY2hpbGROb2RlKSk7DQogICAgICAgICAgICByZXR1cm4gcHJlZGVjZXNzb3IgPyBwcmVkZWNlc3Nvci5uYW1lIDogbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuXy5nZXRQcmVkZWNlc3NvcktleShjaGlsZE5hbWUpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGdldEZpcnN0Q2hpbGROYW1lKGluZGV4RGVmaW5pdGlvbikgew0KICAgICAgICBjb25zdCBpZHggPSB0aGlzLnJlc29sdmVJbmRleF8oaW5kZXhEZWZpbml0aW9uKTsNCiAgICAgICAgaWYgKGlkeCkgew0KICAgICAgICAgICAgY29uc3QgbWluS2V5ID0gaWR4Lm1pbktleSgpOw0KICAgICAgICAgICAgcmV0dXJuIG1pbktleSAmJiBtaW5LZXkubmFtZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuXy5taW5LZXkoKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBnZXRGaXJzdENoaWxkKGluZGV4RGVmaW5pdGlvbikgew0KICAgICAgICBjb25zdCBtaW5LZXkgPSB0aGlzLmdldEZpcnN0Q2hpbGROYW1lKGluZGV4RGVmaW5pdGlvbik7DQogICAgICAgIGlmIChtaW5LZXkpIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgTmFtZWROb2RlKG1pbktleSwgdGhpcy5jaGlsZHJlbl8uZ2V0KG1pbktleSkpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogR2l2ZW4gYW4gaW5kZXgsIHJldHVybiB0aGUga2V5IG5hbWUgb2YgdGhlIGxhcmdlc3QgdmFsdWUgd2UgaGF2ZSwgYWNjb3JkaW5nIHRvIHRoYXQgaW5kZXgNCiAgICAgKi8NCiAgICBnZXRMYXN0Q2hpbGROYW1lKGluZGV4RGVmaW5pdGlvbikgew0KICAgICAgICBjb25zdCBpZHggPSB0aGlzLnJlc29sdmVJbmRleF8oaW5kZXhEZWZpbml0aW9uKTsNCiAgICAgICAgaWYgKGlkeCkgew0KICAgICAgICAgICAgY29uc3QgbWF4S2V5ID0gaWR4Lm1heEtleSgpOw0KICAgICAgICAgICAgcmV0dXJuIG1heEtleSAmJiBtYXhLZXkubmFtZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuXy5tYXhLZXkoKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBnZXRMYXN0Q2hpbGQoaW5kZXhEZWZpbml0aW9uKSB7DQogICAgICAgIGNvbnN0IG1heEtleSA9IHRoaXMuZ2V0TGFzdENoaWxkTmFtZShpbmRleERlZmluaXRpb24pOw0KICAgICAgICBpZiAobWF4S2V5KSB7DQogICAgICAgICAgICByZXR1cm4gbmV3IE5hbWVkTm9kZShtYXhLZXksIHRoaXMuY2hpbGRyZW5fLmdldChtYXhLZXkpKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgfQ0KICAgIGZvckVhY2hDaGlsZChpbmRleCwgYWN0aW9uKSB7DQogICAgICAgIGNvbnN0IGlkeCA9IHRoaXMucmVzb2x2ZUluZGV4XyhpbmRleCk7DQogICAgICAgIGlmIChpZHgpIHsNCiAgICAgICAgICAgIHJldHVybiBpZHguaW5vcmRlclRyYXZlcnNhbCh3cmFwcGVkTm9kZSA9PiB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbih3cmFwcGVkTm9kZS5uYW1lLCB3cmFwcGVkTm9kZS5ub2RlKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hpbGRyZW5fLmlub3JkZXJUcmF2ZXJzYWwoYWN0aW9uKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBnZXRJdGVyYXRvcihpbmRleERlZmluaXRpb24pIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SXRlcmF0b3JGcm9tKGluZGV4RGVmaW5pdGlvbi5taW5Qb3N0KCksIGluZGV4RGVmaW5pdGlvbik7DQogICAgfQ0KICAgIGdldEl0ZXJhdG9yRnJvbShzdGFydFBvc3QsIGluZGV4RGVmaW5pdGlvbikgew0KICAgICAgICBjb25zdCBpZHggPSB0aGlzLnJlc29sdmVJbmRleF8oaW5kZXhEZWZpbml0aW9uKTsNCiAgICAgICAgaWYgKGlkeCkgew0KICAgICAgICAgICAgcmV0dXJuIGlkeC5nZXRJdGVyYXRvckZyb20oc3RhcnRQb3N0LCBrZXkgPT4ga2V5KTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IGl0ZXJhdG9yID0gdGhpcy5jaGlsZHJlbl8uZ2V0SXRlcmF0b3JGcm9tKHN0YXJ0UG9zdC5uYW1lLCBOYW1lZE5vZGUuV3JhcCk7DQogICAgICAgICAgICBsZXQgbmV4dCA9IGl0ZXJhdG9yLnBlZWsoKTsNCiAgICAgICAgICAgIHdoaWxlIChuZXh0ICE9IG51bGwgJiYgaW5kZXhEZWZpbml0aW9uLmNvbXBhcmUobmV4dCwgc3RhcnRQb3N0KSA8IDApIHsNCiAgICAgICAgICAgICAgICBpdGVyYXRvci5nZXROZXh0KCk7DQogICAgICAgICAgICAgICAgbmV4dCA9IGl0ZXJhdG9yLnBlZWsoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBpdGVyYXRvcjsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBnZXRSZXZlcnNlSXRlcmF0b3IoaW5kZXhEZWZpbml0aW9uKSB7DQogICAgICAgIHJldHVybiB0aGlzLmdldFJldmVyc2VJdGVyYXRvckZyb20oaW5kZXhEZWZpbml0aW9uLm1heFBvc3QoKSwgaW5kZXhEZWZpbml0aW9uKTsNCiAgICB9DQogICAgZ2V0UmV2ZXJzZUl0ZXJhdG9yRnJvbShlbmRQb3N0LCBpbmRleERlZmluaXRpb24pIHsNCiAgICAgICAgY29uc3QgaWR4ID0gdGhpcy5yZXNvbHZlSW5kZXhfKGluZGV4RGVmaW5pdGlvbik7DQogICAgICAgIGlmIChpZHgpIHsNCiAgICAgICAgICAgIHJldHVybiBpZHguZ2V0UmV2ZXJzZUl0ZXJhdG9yRnJvbShlbmRQb3N0LCBrZXkgPT4gew0KICAgICAgICAgICAgICAgIHJldHVybiBrZXk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IGl0ZXJhdG9yID0gdGhpcy5jaGlsZHJlbl8uZ2V0UmV2ZXJzZUl0ZXJhdG9yRnJvbShlbmRQb3N0Lm5hbWUsIE5hbWVkTm9kZS5XcmFwKTsNCiAgICAgICAgICAgIGxldCBuZXh0ID0gaXRlcmF0b3IucGVlaygpOw0KICAgICAgICAgICAgd2hpbGUgKG5leHQgIT0gbnVsbCAmJiBpbmRleERlZmluaXRpb24uY29tcGFyZShuZXh0LCBlbmRQb3N0KSA+IDApIHsNCiAgICAgICAgICAgICAgICBpdGVyYXRvci5nZXROZXh0KCk7DQogICAgICAgICAgICAgICAgbmV4dCA9IGl0ZXJhdG9yLnBlZWsoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBpdGVyYXRvcjsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBjb21wYXJlVG8ob3RoZXIpIHsNCiAgICAgICAgaWYgKHRoaXMuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICBpZiAob3RoZXIuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAob3RoZXIuaXNMZWFmTm9kZSgpIHx8IG90aGVyLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgcmV0dXJuIDE7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAob3RoZXIgPT09IE1BWF9OT0RFKSB7DQogICAgICAgICAgICByZXR1cm4gLTE7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAvLyBNdXN0IGJlIGFub3RoZXIgbm9kZSB3aXRoIGNoaWxkcmVuLg0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgIH0NCiAgICB9DQogICAgd2l0aEluZGV4KGluZGV4RGVmaW5pdGlvbikgew0KICAgICAgICBpZiAoaW5kZXhEZWZpbml0aW9uID09PSBLRVlfSU5ERVggfHwNCiAgICAgICAgICAgIHRoaXMuaW5kZXhNYXBfLmhhc0luZGV4KGluZGV4RGVmaW5pdGlvbikpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29uc3QgbmV3SW5kZXhNYXAgPSB0aGlzLmluZGV4TWFwXy5hZGRJbmRleChpbmRleERlZmluaXRpb24sIHRoaXMuY2hpbGRyZW5fKTsNCiAgICAgICAgICAgIHJldHVybiBuZXcgQ2hpbGRyZW5Ob2RlKHRoaXMuY2hpbGRyZW5fLCB0aGlzLnByaW9yaXR5Tm9kZV8sIG5ld0luZGV4TWFwKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBpc0luZGV4ZWQoaW5kZXgpIHsNCiAgICAgICAgcmV0dXJuIGluZGV4ID09PSBLRVlfSU5ERVggfHwgdGhpcy5pbmRleE1hcF8uaGFzSW5kZXgoaW5kZXgpOw0KICAgIH0NCiAgICBlcXVhbHMob3RoZXIpIHsNCiAgICAgICAgaWYgKG90aGVyID09PSB0aGlzKSB7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChvdGhlci5pc0xlYWZOb2RlKCkpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IG90aGVyQ2hpbGRyZW5Ob2RlID0gb3RoZXI7DQogICAgICAgICAgICBpZiAoIXRoaXMuZ2V0UHJpb3JpdHkoKS5lcXVhbHMob3RoZXJDaGlsZHJlbk5vZGUuZ2V0UHJpb3JpdHkoKSkpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmICh0aGlzLmNoaWxkcmVuXy5jb3VudCgpID09PSBvdGhlckNoaWxkcmVuTm9kZS5jaGlsZHJlbl8uY291bnQoKSkgew0KICAgICAgICAgICAgICAgIGNvbnN0IHRoaXNJdGVyID0gdGhpcy5nZXRJdGVyYXRvcihQUklPUklUWV9JTkRFWCk7DQogICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJJdGVyID0gb3RoZXJDaGlsZHJlbk5vZGUuZ2V0SXRlcmF0b3IoUFJJT1JJVFlfSU5ERVgpOw0KICAgICAgICAgICAgICAgIGxldCB0aGlzQ3VycmVudCA9IHRoaXNJdGVyLmdldE5leHQoKTsNCiAgICAgICAgICAgICAgICBsZXQgb3RoZXJDdXJyZW50ID0gb3RoZXJJdGVyLmdldE5leHQoKTsNCiAgICAgICAgICAgICAgICB3aGlsZSAodGhpc0N1cnJlbnQgJiYgb3RoZXJDdXJyZW50KSB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzQ3VycmVudC5uYW1lICE9PSBvdGhlckN1cnJlbnQubmFtZSB8fA0KICAgICAgICAgICAgICAgICAgICAgICAgIXRoaXNDdXJyZW50Lm5vZGUuZXF1YWxzKG90aGVyQ3VycmVudC5ub2RlKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHRoaXNDdXJyZW50ID0gdGhpc0l0ZXIuZ2V0TmV4dCgpOw0KICAgICAgICAgICAgICAgICAgICBvdGhlckN1cnJlbnQgPSBvdGhlckl0ZXIuZ2V0TmV4dCgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpc0N1cnJlbnQgPT09IG51bGwgJiYgb3RoZXJDdXJyZW50ID09PSBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJldHVybnMgYSBTb3J0ZWRNYXAgb3JkZXJlZCBieSBpbmRleCwgb3IgbnVsbCBpZiB0aGUgZGVmYXVsdCAoYnkta2V5KSBvcmRlcmluZyBjYW4gYmUgdXNlZA0KICAgICAqIGluc3RlYWQuDQogICAgICoNCiAgICAgKi8NCiAgICByZXNvbHZlSW5kZXhfKGluZGV4RGVmaW5pdGlvbikgew0KICAgICAgICBpZiAoaW5kZXhEZWZpbml0aW9uID09PSBLRVlfSU5ERVgpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXhNYXBfLmdldChpbmRleERlZmluaXRpb24udG9TdHJpbmcoKSk7DQogICAgICAgIH0NCiAgICB9DQp9DQpDaGlsZHJlbk5vZGUuSU5URUdFUl9SRUdFWFBfID0gL14oMHxbMS05XVxkKikkLzsNCmNsYXNzIE1heE5vZGUgZXh0ZW5kcyBDaGlsZHJlbk5vZGUgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICBzdXBlcihuZXcgU29ydGVkTWFwKE5BTUVfQ09NUEFSQVRPUiksIENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFLCBJbmRleE1hcC5EZWZhdWx0KTsNCiAgICB9DQogICAgY29tcGFyZVRvKG90aGVyKSB7DQogICAgICAgIGlmIChvdGhlciA9PT0gdGhpcykgew0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBlcXVhbHMob3RoZXIpIHsNCiAgICAgICAgLy8gTm90IHRoYXQgd2UgZXZlcnkgY29tcGFyZSBpdCwgYnV0IE1BWF9OT0RFIGlzIG9ubHkgZXZlciBlcXVhbCB0byBpdHNlbGYNCiAgICAgICAgcmV0dXJuIG90aGVyID09PSB0aGlzOw0KICAgIH0NCiAgICBnZXRQcmlvcml0eSgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KICAgIGdldEltbWVkaWF0ZUNoaWxkKGNoaWxkTmFtZSkgew0KICAgICAgICByZXR1cm4gQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREU7DQogICAgfQ0KICAgIGlzRW1wdHkoKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQp9DQovKioNCiAqIE1hcmtlciB0aGF0IHdpbGwgc29ydCBoaWdoZXIgdGhhbiBhbnkgb3RoZXIgc25hcHNob3QuDQogKi8NCmNvbnN0IE1BWF9OT0RFID0gbmV3IE1heE5vZGUoKTsNCk9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKE5hbWVkTm9kZSwgew0KICAgIE1JTjogew0KICAgICAgICB2YWx1ZTogbmV3IE5hbWVkTm9kZShNSU5fTkFNRSwgQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREUpDQogICAgfSwNCiAgICBNQVg6IHsNCiAgICAgICAgdmFsdWU6IG5ldyBOYW1lZE5vZGUoTUFYX05BTUUsIE1BWF9OT0RFKQ0KICAgIH0NCn0pOw0KLyoqDQogKiBSZWZlcmVuY2UgRXh0ZW5zaW9ucw0KICovDQpLZXlJbmRleC5fX0VNUFRZX05PREUgPSBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTsNCkxlYWZOb2RlLl9fY2hpbGRyZW5Ob2RlQ29uc3RydWN0b3IgPSBDaGlsZHJlbk5vZGU7DQpzZXRNYXhOb2RlJDEoTUFYX05PREUpOw0Kc2V0TWF4Tm9kZShNQVhfTk9ERSk7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjb25zdCBVU0VfSElOWkUgPSB0cnVlOw0KLyoqDQogKiBDb25zdHJ1Y3RzIGEgc25hcHNob3Qgbm9kZSByZXByZXNlbnRpbmcgdGhlIHBhc3NlZCBKU09OIGFuZCByZXR1cm5zIGl0Lg0KICogQHBhcmFtIGpzb24gLSBKU09OIHRvIGNyZWF0ZSBhIG5vZGUgZm9yLg0KICogQHBhcmFtIHByaW9yaXR5IC0gT3B0aW9uYWwgcHJpb3JpdHkgdG8gdXNlLiAgVGhpcyB3aWxsIGJlIGlnbm9yZWQgaWYgdGhlDQogKiBwYXNzZWQgSlNPTiBjb250YWlucyBhIC5wcmlvcml0eSBwcm9wZXJ0eS4NCiAqLw0KZnVuY3Rpb24gbm9kZUZyb21KU09OKGpzb24sIHByaW9yaXR5ID0gbnVsbCkgew0KICAgIGlmIChqc29uID09PSBudWxsKSB7DQogICAgICAgIHJldHVybiBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTsNCiAgICB9DQogICAgaWYgKHR5cGVvZiBqc29uID09PSAnb2JqZWN0JyAmJiAnLnByaW9yaXR5JyBpbiBqc29uKSB7DQogICAgICAgIHByaW9yaXR5ID0ganNvblsnLnByaW9yaXR5J107DQogICAgfQ0KICAgIGFzc2VydChwcmlvcml0eSA9PT0gbnVsbCB8fA0KICAgICAgICB0eXBlb2YgcHJpb3JpdHkgPT09ICdzdHJpbmcnIHx8DQogICAgICAgIHR5cGVvZiBwcmlvcml0eSA9PT0gJ251bWJlcicgfHwNCiAgICAgICAgKHR5cGVvZiBwcmlvcml0eSA9PT0gJ29iamVjdCcgJiYgJy5zdicgaW4gcHJpb3JpdHkpLCAnSW52YWxpZCBwcmlvcml0eSB0eXBlIGZvdW5kOiAnICsgdHlwZW9mIHByaW9yaXR5KTsNCiAgICBpZiAodHlwZW9mIGpzb24gPT09ICdvYmplY3QnICYmICcudmFsdWUnIGluIGpzb24gJiYganNvblsnLnZhbHVlJ10gIT09IG51bGwpIHsNCiAgICAgICAganNvbiA9IGpzb25bJy52YWx1ZSddOw0KICAgIH0NCiAgICAvLyBWYWxpZCBsZWFmIG5vZGVzIGluY2x1ZGUgbm9uLW9iamVjdHMgb3Igc2VydmVyLXZhbHVlIHdyYXBwZXIgb2JqZWN0cw0KICAgIGlmICh0eXBlb2YganNvbiAhPT0gJ29iamVjdCcgfHwgJy5zdicgaW4ganNvbikgew0KICAgICAgICBjb25zdCBqc29uTGVhZiA9IGpzb247DQogICAgICAgIHJldHVybiBuZXcgTGVhZk5vZGUoanNvbkxlYWYsIG5vZGVGcm9tSlNPTihwcmlvcml0eSkpOw0KICAgIH0NCiAgICBpZiAoIShqc29uIGluc3RhbmNlb2YgQXJyYXkpICYmIFVTRV9ISU5aRSkgew0KICAgICAgICBjb25zdCBjaGlsZHJlbiA9IFtdOw0KICAgICAgICBsZXQgY2hpbGRyZW5IYXZlUHJpb3JpdHkgPSBmYWxzZTsNCiAgICAgICAgY29uc3QgaGluemVKc29uT2JqID0ganNvbjsNCiAgICAgICAgZWFjaChoaW56ZUpzb25PYmosIChrZXksIGNoaWxkKSA9PiB7DQogICAgICAgICAgICBpZiAoa2V5LnN1YnN0cmluZygwLCAxKSAhPT0gJy4nKSB7DQogICAgICAgICAgICAgICAgLy8gSWdub3JlIG1ldGFkYXRhIG5vZGVzDQogICAgICAgICAgICAgICAgY29uc3QgY2hpbGROb2RlID0gbm9kZUZyb21KU09OKGNoaWxkKTsNCiAgICAgICAgICAgICAgICBpZiAoIWNoaWxkTm9kZS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW5IYXZlUHJpb3JpdHkgPQ0KICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW5IYXZlUHJpb3JpdHkgfHwgIWNoaWxkTm9kZS5nZXRQcmlvcml0eSgpLmlzRW1wdHkoKTsNCiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW4ucHVzaChuZXcgTmFtZWROb2RlKGtleSwgY2hpbGROb2RlKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgaWYgKGNoaWxkcmVuLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgcmV0dXJuIENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IGNoaWxkU2V0ID0gYnVpbGRDaGlsZFNldChjaGlsZHJlbiwgTkFNRV9PTkxZX0NPTVBBUkFUT1IsIG5hbWVkTm9kZSA9PiBuYW1lZE5vZGUubmFtZSwgTkFNRV9DT01QQVJBVE9SKTsNCiAgICAgICAgaWYgKGNoaWxkcmVuSGF2ZVByaW9yaXR5KSB7DQogICAgICAgICAgICBjb25zdCBzb3J0ZWRDaGlsZFNldCA9IGJ1aWxkQ2hpbGRTZXQoY2hpbGRyZW4sIFBSSU9SSVRZX0lOREVYLmdldENvbXBhcmUoKSk7DQogICAgICAgICAgICByZXR1cm4gbmV3IENoaWxkcmVuTm9kZShjaGlsZFNldCwgbm9kZUZyb21KU09OKHByaW9yaXR5KSwgbmV3IEluZGV4TWFwKHsgJy5wcmlvcml0eSc6IHNvcnRlZENoaWxkU2V0IH0sIHsgJy5wcmlvcml0eSc6IFBSSU9SSVRZX0lOREVYIH0pKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgQ2hpbGRyZW5Ob2RlKGNoaWxkU2V0LCBub2RlRnJvbUpTT04ocHJpb3JpdHkpLCBJbmRleE1hcC5EZWZhdWx0KTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgbGV0IG5vZGUgPSBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTsNCiAgICAgICAgZWFjaChqc29uLCAoa2V5LCBjaGlsZERhdGEpID0+IHsNCiAgICAgICAgICAgIGlmIChjb250YWlucyhqc29uLCBrZXkpKSB7DQogICAgICAgICAgICAgICAgaWYgKGtleS5zdWJzdHJpbmcoMCwgMSkgIT09ICcuJykgew0KICAgICAgICAgICAgICAgICAgICAvLyBpZ25vcmUgbWV0YWRhdGEgbm9kZXMuDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkTm9kZSA9IG5vZGVGcm9tSlNPTihjaGlsZERhdGEpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGROb2RlLmlzTGVhZk5vZGUoKSB8fCAhY2hpbGROb2RlLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUudXBkYXRlSW1tZWRpYXRlQ2hpbGQoa2V5LCBjaGlsZE5vZGUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIG5vZGUudXBkYXRlUHJpb3JpdHkobm9kZUZyb21KU09OKHByaW9yaXR5KSk7DQogICAgfQ0KfQ0Kc2V0Tm9kZUZyb21KU09OKG5vZGVGcm9tSlNPTik7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBQYXRoSW5kZXggZXh0ZW5kcyBJbmRleCB7DQogICAgY29uc3RydWN0b3IoaW5kZXhQYXRoXykgew0KICAgICAgICBzdXBlcigpOw0KICAgICAgICB0aGlzLmluZGV4UGF0aF8gPSBpbmRleFBhdGhfOw0KICAgICAgICBhc3NlcnQoIXBhdGhJc0VtcHR5KGluZGV4UGF0aF8pICYmIHBhdGhHZXRGcm9udChpbmRleFBhdGhfKSAhPT0gJy5wcmlvcml0eScsICJDYW4ndCBjcmVhdGUgUGF0aEluZGV4IHdpdGggZW1wdHkgcGF0aCBvciAucHJpb3JpdHkga2V5Iik7DQogICAgfQ0KICAgIGV4dHJhY3RDaGlsZChzbmFwKSB7DQogICAgICAgIHJldHVybiBzbmFwLmdldENoaWxkKHRoaXMuaW5kZXhQYXRoXyk7DQogICAgfQ0KICAgIGlzRGVmaW5lZE9uKG5vZGUpIHsNCiAgICAgICAgcmV0dXJuICFub2RlLmdldENoaWxkKHRoaXMuaW5kZXhQYXRoXykuaXNFbXB0eSgpOw0KICAgIH0NCiAgICBjb21wYXJlKGEsIGIpIHsNCiAgICAgICAgY29uc3QgYUNoaWxkID0gdGhpcy5leHRyYWN0Q2hpbGQoYS5ub2RlKTsNCiAgICAgICAgY29uc3QgYkNoaWxkID0gdGhpcy5leHRyYWN0Q2hpbGQoYi5ub2RlKTsNCiAgICAgICAgY29uc3QgaW5kZXhDbXAgPSBhQ2hpbGQuY29tcGFyZVRvKGJDaGlsZCk7DQogICAgICAgIGlmIChpbmRleENtcCA9PT0gMCkgew0KICAgICAgICAgICAgcmV0dXJuIG5hbWVDb21wYXJlKGEubmFtZSwgYi5uYW1lKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBpbmRleENtcDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBtYWtlUG9zdChpbmRleFZhbHVlLCBuYW1lKSB7DQogICAgICAgIGNvbnN0IHZhbHVlTm9kZSA9IG5vZGVGcm9tSlNPTihpbmRleFZhbHVlKTsNCiAgICAgICAgY29uc3Qgbm9kZSA9IENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFLnVwZGF0ZUNoaWxkKHRoaXMuaW5kZXhQYXRoXywgdmFsdWVOb2RlKTsNCiAgICAgICAgcmV0dXJuIG5ldyBOYW1lZE5vZGUobmFtZSwgbm9kZSk7DQogICAgfQ0KICAgIG1heFBvc3QoKSB7DQogICAgICAgIGNvbnN0IG5vZGUgPSBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERS51cGRhdGVDaGlsZCh0aGlzLmluZGV4UGF0aF8sIE1BWF9OT0RFKTsNCiAgICAgICAgcmV0dXJuIG5ldyBOYW1lZE5vZGUoTUFYX05BTUUsIG5vZGUpOw0KICAgIH0NCiAgICB0b1N0cmluZygpIHsNCiAgICAgICAgcmV0dXJuIHBhdGhTbGljZSh0aGlzLmluZGV4UGF0aF8sIDApLmpvaW4oJy8nKTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBWYWx1ZUluZGV4IGV4dGVuZHMgSW5kZXggew0KICAgIGNvbXBhcmUoYSwgYikgew0KICAgICAgICBjb25zdCBpbmRleENtcCA9IGEubm9kZS5jb21wYXJlVG8oYi5ub2RlKTsNCiAgICAgICAgaWYgKGluZGV4Q21wID09PSAwKSB7DQogICAgICAgICAgICByZXR1cm4gbmFtZUNvbXBhcmUoYS5uYW1lLCBiLm5hbWUpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIGluZGV4Q21wOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlzRGVmaW5lZE9uKG5vZGUpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIGluZGV4ZWRWYWx1ZUNoYW5nZWQob2xkTm9kZSwgbmV3Tm9kZSkgew0KICAgICAgICByZXR1cm4gIW9sZE5vZGUuZXF1YWxzKG5ld05vZGUpOw0KICAgIH0NCiAgICBtaW5Qb3N0KCkgew0KICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgICAgICByZXR1cm4gTmFtZWROb2RlLk1JTjsNCiAgICB9DQogICAgbWF4UG9zdCgpIHsNCiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgcmV0dXJuIE5hbWVkTm9kZS5NQVg7DQogICAgfQ0KICAgIG1ha2VQb3N0KGluZGV4VmFsdWUsIG5hbWUpIHsNCiAgICAgICAgY29uc3QgdmFsdWVOb2RlID0gbm9kZUZyb21KU09OKGluZGV4VmFsdWUpOw0KICAgICAgICByZXR1cm4gbmV3IE5hbWVkTm9kZShuYW1lLCB2YWx1ZU5vZGUpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBTdHJpbmcgcmVwcmVzZW50YXRpb24gZm9yIGluY2x1c2lvbiBpbiBhIHF1ZXJ5IHNwZWMNCiAgICAgKi8NCiAgICB0b1N0cmluZygpIHsNCiAgICAgICAgcmV0dXJuICcudmFsdWUnOw0KICAgIH0NCn0NCmNvbnN0IFZBTFVFX0lOREVYID0gbmV3IFZhbHVlSW5kZXgoKTsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmZ1bmN0aW9uIGNoYW5nZVZhbHVlKHNuYXBzaG90Tm9kZSkgew0KICAgIHJldHVybiB7IHR5cGU6ICJ2YWx1ZSIgLyogQ2hhbmdlVHlwZS5WQUxVRSAqLywgc25hcHNob3ROb2RlIH07DQp9DQpmdW5jdGlvbiBjaGFuZ2VDaGlsZEFkZGVkKGNoaWxkTmFtZSwgc25hcHNob3ROb2RlKSB7DQogICAgcmV0dXJuIHsgdHlwZTogImNoaWxkX2FkZGVkIiAvKiBDaGFuZ2VUeXBlLkNISUxEX0FEREVEICovLCBzbmFwc2hvdE5vZGUsIGNoaWxkTmFtZSB9Ow0KfQ0KZnVuY3Rpb24gY2hhbmdlQ2hpbGRSZW1vdmVkKGNoaWxkTmFtZSwgc25hcHNob3ROb2RlKSB7DQogICAgcmV0dXJuIHsgdHlwZTogImNoaWxkX3JlbW92ZWQiIC8qIENoYW5nZVR5cGUuQ0hJTERfUkVNT1ZFRCAqLywgc25hcHNob3ROb2RlLCBjaGlsZE5hbWUgfTsNCn0NCmZ1bmN0aW9uIGNoYW5nZUNoaWxkQ2hhbmdlZChjaGlsZE5hbWUsIHNuYXBzaG90Tm9kZSwgb2xkU25hcCkgew0KICAgIHJldHVybiB7DQogICAgICAgIHR5cGU6ICJjaGlsZF9jaGFuZ2VkIiAvKiBDaGFuZ2VUeXBlLkNISUxEX0NIQU5HRUQgKi8sDQogICAgICAgIHNuYXBzaG90Tm9kZSwNCiAgICAgICAgY2hpbGROYW1lLA0KICAgICAgICBvbGRTbmFwDQogICAgfTsNCn0NCmZ1bmN0aW9uIGNoYW5nZUNoaWxkTW92ZWQoY2hpbGROYW1lLCBzbmFwc2hvdE5vZGUpIHsNCiAgICByZXR1cm4geyB0eXBlOiAiY2hpbGRfbW92ZWQiIC8qIENoYW5nZVR5cGUuQ0hJTERfTU9WRUQgKi8sIHNuYXBzaG90Tm9kZSwgY2hpbGROYW1lIH07DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIERvZXNuJ3QgcmVhbGx5IGZpbHRlciBub2RlcyBidXQgYXBwbGllcyBhbiBpbmRleCB0byB0aGUgbm9kZSBhbmQga2VlcHMgdHJhY2sgb2YgYW55IGNoYW5nZXMNCiAqLw0KY2xhc3MgSW5kZXhlZEZpbHRlciB7DQogICAgY29uc3RydWN0b3IoaW5kZXhfKSB7DQogICAgICAgIHRoaXMuaW5kZXhfID0gaW5kZXhfOw0KICAgIH0NCiAgICB1cGRhdGVDaGlsZChzbmFwLCBrZXksIG5ld0NoaWxkLCBhZmZlY3RlZFBhdGgsIHNvdXJjZSwgb3B0Q2hhbmdlQWNjdW11bGF0b3IpIHsNCiAgICAgICAgYXNzZXJ0KHNuYXAuaXNJbmRleGVkKHRoaXMuaW5kZXhfKSwgJ0Egbm9kZSBtdXN0IGJlIGluZGV4ZWQgaWYgb25seSBhIGNoaWxkIGlzIHVwZGF0ZWQnKTsNCiAgICAgICAgY29uc3Qgb2xkQ2hpbGQgPSBzbmFwLmdldEltbWVkaWF0ZUNoaWxkKGtleSk7DQogICAgICAgIC8vIENoZWNrIGlmIGFueXRoaW5nIGFjdHVhbGx5IGNoYW5nZWQuDQogICAgICAgIGlmIChvbGRDaGlsZC5nZXRDaGlsZChhZmZlY3RlZFBhdGgpLmVxdWFscyhuZXdDaGlsZC5nZXRDaGlsZChhZmZlY3RlZFBhdGgpKSkgew0KICAgICAgICAgICAgLy8gVGhlcmUncyBhbiBlZGdlIGNhc2Ugd2hlcmUgYSBjaGlsZCBjYW4gZW50ZXIgb3IgbGVhdmUgdGhlIHZpZXcgYmVjYXVzZSBhZmZlY3RlZFBhdGggd2FzIHNldCB0byBudWxsLg0KICAgICAgICAgICAgLy8gSW4gdGhpcyBjYXNlLCBhZmZlY3RlZFBhdGggd2lsbCBhcHBlYXIgbnVsbCBpbiBib3RoIHRoZSBvbGQgYW5kIG5ldyBzbmFwc2hvdHMuICBTbyB3ZSBuZWVkDQogICAgICAgICAgICAvLyB0byBhdm9pZCB0cmVhdGluZyB0aGVzZSBjYXNlcyBhcyAibm90aGluZyBjaGFuZ2VkLiINCiAgICAgICAgICAgIGlmIChvbGRDaGlsZC5pc0VtcHR5KCkgPT09IG5ld0NoaWxkLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgICAgIC8vIE5vdGhpbmcgY2hhbmdlZC4NCiAgICAgICAgICAgICAgICAvLyBUaGlzIGFzc2VydCBzaG91bGQgYmUgdmFsaWQsIGJ1dCBpdCdzIGV4cGVuc2l2ZSAoY2FuIGRvbWluYXRlIHBlcmYgdGVzdGluZykgc28gZG9uJ3QgYWN0dWFsbHkgZG8gaXQuDQogICAgICAgICAgICAgICAgLy9hc3NlcnQob2xkQ2hpbGQuZXF1YWxzKG5ld0NoaWxkKSwgJ09sZCBhbmQgbmV3IHNuYXBzaG90cyBzaG91bGQgYmUgZXF1YWwuJyk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHNuYXA7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKG9wdENoYW5nZUFjY3VtdWxhdG9yICE9IG51bGwpIHsNCiAgICAgICAgICAgIGlmIChuZXdDaGlsZC5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgICAgICBpZiAoc25hcC5oYXNDaGlsZChrZXkpKSB7DQogICAgICAgICAgICAgICAgICAgIG9wdENoYW5nZUFjY3VtdWxhdG9yLnRyYWNrQ2hpbGRDaGFuZ2UoY2hhbmdlQ2hpbGRSZW1vdmVkKGtleSwgb2xkQ2hpbGQpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGFzc2VydChzbmFwLmlzTGVhZk5vZGUoKSwgJ0EgY2hpbGQgcmVtb3ZlIHdpdGhvdXQgYW4gb2xkIGNoaWxkIG9ubHkgbWFrZXMgc2Vuc2Ugb24gYSBsZWFmIG5vZGUnKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChvbGRDaGlsZC5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgICAgICBvcHRDaGFuZ2VBY2N1bXVsYXRvci50cmFja0NoaWxkQ2hhbmdlKGNoYW5nZUNoaWxkQWRkZWQoa2V5LCBuZXdDaGlsZCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgb3B0Q2hhbmdlQWNjdW11bGF0b3IudHJhY2tDaGlsZENoYW5nZShjaGFuZ2VDaGlsZENoYW5nZWQoa2V5LCBuZXdDaGlsZCwgb2xkQ2hpbGQpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoc25hcC5pc0xlYWZOb2RlKCkgJiYgbmV3Q2hpbGQuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICByZXR1cm4gc25hcDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGUgbm9kZSBpcyBpbmRleGVkDQogICAgICAgICAgICByZXR1cm4gc25hcC51cGRhdGVJbW1lZGlhdGVDaGlsZChrZXksIG5ld0NoaWxkKS53aXRoSW5kZXgodGhpcy5pbmRleF8pOw0KICAgICAgICB9DQogICAgfQ0KICAgIHVwZGF0ZUZ1bGxOb2RlKG9sZFNuYXAsIG5ld1NuYXAsIG9wdENoYW5nZUFjY3VtdWxhdG9yKSB7DQogICAgICAgIGlmIChvcHRDaGFuZ2VBY2N1bXVsYXRvciAhPSBudWxsKSB7DQogICAgICAgICAgICBpZiAoIW9sZFNuYXAuaXNMZWFmTm9kZSgpKSB7DQogICAgICAgICAgICAgICAgb2xkU25hcC5mb3JFYWNoQ2hpbGQoUFJJT1JJVFlfSU5ERVgsIChrZXksIGNoaWxkTm9kZSkgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZiAoIW5ld1NuYXAuaGFzQ2hpbGQoa2V5KSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgb3B0Q2hhbmdlQWNjdW11bGF0b3IudHJhY2tDaGlsZENoYW5nZShjaGFuZ2VDaGlsZFJlbW92ZWQoa2V5LCBjaGlsZE5vZGUpKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFuZXdTbmFwLmlzTGVhZk5vZGUoKSkgew0KICAgICAgICAgICAgICAgIG5ld1NuYXAuZm9yRWFjaENoaWxkKFBSSU9SSVRZX0lOREVYLCAoa2V5LCBjaGlsZE5vZGUpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKG9sZFNuYXAuaGFzQ2hpbGQoa2V5KSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2xkQ2hpbGQgPSBvbGRTbmFwLmdldEltbWVkaWF0ZUNoaWxkKGtleSk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW9sZENoaWxkLmVxdWFscyhjaGlsZE5vZGUpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0Q2hhbmdlQWNjdW11bGF0b3IudHJhY2tDaGlsZENoYW5nZShjaGFuZ2VDaGlsZENoYW5nZWQoa2V5LCBjaGlsZE5vZGUsIG9sZENoaWxkKSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBvcHRDaGFuZ2VBY2N1bXVsYXRvci50cmFja0NoaWxkQ2hhbmdlKGNoYW5nZUNoaWxkQWRkZWQoa2V5LCBjaGlsZE5vZGUpKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBuZXdTbmFwLndpdGhJbmRleCh0aGlzLmluZGV4Xyk7DQogICAgfQ0KICAgIHVwZGF0ZVByaW9yaXR5KG9sZFNuYXAsIG5ld1ByaW9yaXR5KSB7DQogICAgICAgIGlmIChvbGRTbmFwLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgcmV0dXJuIENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIG9sZFNuYXAudXBkYXRlUHJpb3JpdHkobmV3UHJpb3JpdHkpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGZpbHRlcnNOb2RlcygpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBnZXRJbmRleGVkRmlsdGVyKCkgew0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogICAgZ2V0SW5kZXgoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmluZGV4XzsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIEZpbHRlcnMgbm9kZXMgYnkgcmFuZ2UgYW5kIHVzZXMgYW4gSW5kZXhGaWx0ZXIgdG8gdHJhY2sgYW55IGNoYW5nZXMgYWZ0ZXIgZmlsdGVyaW5nIHRoZSBub2RlDQogKi8NCmNsYXNzIFJhbmdlZEZpbHRlciB7DQogICAgY29uc3RydWN0b3IocGFyYW1zKSB7DQogICAgICAgIHRoaXMuaW5kZXhlZEZpbHRlcl8gPSBuZXcgSW5kZXhlZEZpbHRlcihwYXJhbXMuZ2V0SW5kZXgoKSk7DQogICAgICAgIHRoaXMuaW5kZXhfID0gcGFyYW1zLmdldEluZGV4KCk7DQogICAgICAgIHRoaXMuc3RhcnRQb3N0XyA9IFJhbmdlZEZpbHRlci5nZXRTdGFydFBvc3RfKHBhcmFtcyk7DQogICAgICAgIHRoaXMuZW5kUG9zdF8gPSBSYW5nZWRGaWx0ZXIuZ2V0RW5kUG9zdF8ocGFyYW1zKTsNCiAgICAgICAgdGhpcy5zdGFydElzSW5jbHVzaXZlXyA9ICFwYXJhbXMuc3RhcnRBZnRlclNldF87DQogICAgICAgIHRoaXMuZW5kSXNJbmNsdXNpdmVfID0gIXBhcmFtcy5lbmRCZWZvcmVTZXRfOw0KICAgIH0NCiAgICBnZXRTdGFydFBvc3QoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnN0YXJ0UG9zdF87DQogICAgfQ0KICAgIGdldEVuZFBvc3QoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmVuZFBvc3RfOw0KICAgIH0NCiAgICBtYXRjaGVzKG5vZGUpIHsNCiAgICAgICAgY29uc3QgaXNXaXRoaW5TdGFydCA9IHRoaXMuc3RhcnRJc0luY2x1c2l2ZV8NCiAgICAgICAgICAgID8gdGhpcy5pbmRleF8uY29tcGFyZSh0aGlzLmdldFN0YXJ0UG9zdCgpLCBub2RlKSA8PSAwDQogICAgICAgICAgICA6IHRoaXMuaW5kZXhfLmNvbXBhcmUodGhpcy5nZXRTdGFydFBvc3QoKSwgbm9kZSkgPCAwOw0KICAgICAgICBjb25zdCBpc1dpdGhpbkVuZCA9IHRoaXMuZW5kSXNJbmNsdXNpdmVfDQogICAgICAgICAgICA/IHRoaXMuaW5kZXhfLmNvbXBhcmUobm9kZSwgdGhpcy5nZXRFbmRQb3N0KCkpIDw9IDANCiAgICAgICAgICAgIDogdGhpcy5pbmRleF8uY29tcGFyZShub2RlLCB0aGlzLmdldEVuZFBvc3QoKSkgPCAwOw0KICAgICAgICByZXR1cm4gaXNXaXRoaW5TdGFydCAmJiBpc1dpdGhpbkVuZDsNCiAgICB9DQogICAgdXBkYXRlQ2hpbGQoc25hcCwga2V5LCBuZXdDaGlsZCwgYWZmZWN0ZWRQYXRoLCBzb3VyY2UsIG9wdENoYW5nZUFjY3VtdWxhdG9yKSB7DQogICAgICAgIGlmICghdGhpcy5tYXRjaGVzKG5ldyBOYW1lZE5vZGUoa2V5LCBuZXdDaGlsZCkpKSB7DQogICAgICAgICAgICBuZXdDaGlsZCA9IENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzLmluZGV4ZWRGaWx0ZXJfLnVwZGF0ZUNoaWxkKHNuYXAsIGtleSwgbmV3Q2hpbGQsIGFmZmVjdGVkUGF0aCwgc291cmNlLCBvcHRDaGFuZ2VBY2N1bXVsYXRvcik7DQogICAgfQ0KICAgIHVwZGF0ZUZ1bGxOb2RlKG9sZFNuYXAsIG5ld1NuYXAsIG9wdENoYW5nZUFjY3VtdWxhdG9yKSB7DQogICAgICAgIGlmIChuZXdTbmFwLmlzTGVhZk5vZGUoKSkgew0KICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHdlIGhhdmUgYSBjaGlsZHJlbiBub2RlIHdpdGggdGhlIGNvcnJlY3QgaW5kZXgsIG5vdCBhIGxlYWYgbm9kZTsNCiAgICAgICAgICAgIG5ld1NuYXAgPSBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTsNCiAgICAgICAgfQ0KICAgICAgICBsZXQgZmlsdGVyZWQgPSBuZXdTbmFwLndpdGhJbmRleCh0aGlzLmluZGV4Xyk7DQogICAgICAgIC8vIERvbid0IHN1cHBvcnQgcHJpb3JpdGllcyBvbiBxdWVyaWVzDQogICAgICAgIGZpbHRlcmVkID0gZmlsdGVyZWQudXBkYXRlUHJpb3JpdHkoQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREUpOw0KICAgICAgICBjb25zdCBzZWxmID0gdGhpczsNCiAgICAgICAgbmV3U25hcC5mb3JFYWNoQ2hpbGQoUFJJT1JJVFlfSU5ERVgsIChrZXksIGNoaWxkTm9kZSkgPT4gew0KICAgICAgICAgICAgaWYgKCFzZWxmLm1hdGNoZXMobmV3IE5hbWVkTm9kZShrZXksIGNoaWxkTm9kZSkpKSB7DQogICAgICAgICAgICAgICAgZmlsdGVyZWQgPSBmaWx0ZXJlZC51cGRhdGVJbW1lZGlhdGVDaGlsZChrZXksIENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiB0aGlzLmluZGV4ZWRGaWx0ZXJfLnVwZGF0ZUZ1bGxOb2RlKG9sZFNuYXAsIGZpbHRlcmVkLCBvcHRDaGFuZ2VBY2N1bXVsYXRvcik7DQogICAgfQ0KICAgIHVwZGF0ZVByaW9yaXR5KG9sZFNuYXAsIG5ld1ByaW9yaXR5KSB7DQogICAgICAgIC8vIERvbid0IHN1cHBvcnQgcHJpb3JpdGllcyBvbiBxdWVyaWVzDQogICAgICAgIHJldHVybiBvbGRTbmFwOw0KICAgIH0NCiAgICBmaWx0ZXJzTm9kZXMoKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICBnZXRJbmRleGVkRmlsdGVyKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5pbmRleGVkRmlsdGVyXzsNCiAgICB9DQogICAgZ2V0SW5kZXgoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmluZGV4XzsNCiAgICB9DQogICAgc3RhdGljIGdldFN0YXJ0UG9zdF8ocGFyYW1zKSB7DQogICAgICAgIGlmIChwYXJhbXMuaGFzU3RhcnQoKSkgew0KICAgICAgICAgICAgY29uc3Qgc3RhcnROYW1lID0gcGFyYW1zLmdldEluZGV4U3RhcnROYW1lKCk7DQogICAgICAgICAgICByZXR1cm4gcGFyYW1zLmdldEluZGV4KCkubWFrZVBvc3QocGFyYW1zLmdldEluZGV4U3RhcnRWYWx1ZSgpLCBzdGFydE5hbWUpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIHBhcmFtcy5nZXRJbmRleCgpLm1pblBvc3QoKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBzdGF0aWMgZ2V0RW5kUG9zdF8ocGFyYW1zKSB7DQogICAgICAgIGlmIChwYXJhbXMuaGFzRW5kKCkpIHsNCiAgICAgICAgICAgIGNvbnN0IGVuZE5hbWUgPSBwYXJhbXMuZ2V0SW5kZXhFbmROYW1lKCk7DQogICAgICAgICAgICByZXR1cm4gcGFyYW1zLmdldEluZGV4KCkubWFrZVBvc3QocGFyYW1zLmdldEluZGV4RW5kVmFsdWUoKSwgZW5kTmFtZSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gcGFyYW1zLmdldEluZGV4KCkubWF4UG9zdCgpOw0KICAgICAgICB9DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBBcHBsaWVzIGEgbGltaXQgYW5kIGEgcmFuZ2UgdG8gYSBub2RlIGFuZCB1c2VzIFJhbmdlZEZpbHRlciB0byBkbyB0aGUgaGVhdnkgbGlmdGluZyB3aGVyZSBwb3NzaWJsZQ0KICovDQpjbGFzcyBMaW1pdGVkRmlsdGVyIHsNCiAgICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsNCiAgICAgICAgdGhpcy53aXRoaW5EaXJlY3Rpb25hbFN0YXJ0ID0gKG5vZGUpID0+IHRoaXMucmV2ZXJzZV8gPyB0aGlzLndpdGhpbkVuZFBvc3Qobm9kZSkgOiB0aGlzLndpdGhpblN0YXJ0UG9zdChub2RlKTsNCiAgICAgICAgdGhpcy53aXRoaW5EaXJlY3Rpb25hbEVuZCA9IChub2RlKSA9PiB0aGlzLnJldmVyc2VfID8gdGhpcy53aXRoaW5TdGFydFBvc3Qobm9kZSkgOiB0aGlzLndpdGhpbkVuZFBvc3Qobm9kZSk7DQogICAgICAgIHRoaXMud2l0aGluU3RhcnRQb3N0ID0gKG5vZGUpID0+IHsNCiAgICAgICAgICAgIGNvbnN0IGNvbXBhcmVSZXMgPSB0aGlzLmluZGV4Xy5jb21wYXJlKHRoaXMucmFuZ2VkRmlsdGVyXy5nZXRTdGFydFBvc3QoKSwgbm9kZSk7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5zdGFydElzSW5jbHVzaXZlXyA/IGNvbXBhcmVSZXMgPD0gMCA6IGNvbXBhcmVSZXMgPCAwOw0KICAgICAgICB9Ow0KICAgICAgICB0aGlzLndpdGhpbkVuZFBvc3QgPSAobm9kZSkgPT4gew0KICAgICAgICAgICAgY29uc3QgY29tcGFyZVJlcyA9IHRoaXMuaW5kZXhfLmNvbXBhcmUobm9kZSwgdGhpcy5yYW5nZWRGaWx0ZXJfLmdldEVuZFBvc3QoKSk7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5lbmRJc0luY2x1c2l2ZV8gPyBjb21wYXJlUmVzIDw9IDAgOiBjb21wYXJlUmVzIDwgMDsNCiAgICAgICAgfTsNCiAgICAgICAgdGhpcy5yYW5nZWRGaWx0ZXJfID0gbmV3IFJhbmdlZEZpbHRlcihwYXJhbXMpOw0KICAgICAgICB0aGlzLmluZGV4XyA9IHBhcmFtcy5nZXRJbmRleCgpOw0KICAgICAgICB0aGlzLmxpbWl0XyA9IHBhcmFtcy5nZXRMaW1pdCgpOw0KICAgICAgICB0aGlzLnJldmVyc2VfID0gIXBhcmFtcy5pc1ZpZXdGcm9tTGVmdCgpOw0KICAgICAgICB0aGlzLnN0YXJ0SXNJbmNsdXNpdmVfID0gIXBhcmFtcy5zdGFydEFmdGVyU2V0XzsNCiAgICAgICAgdGhpcy5lbmRJc0luY2x1c2l2ZV8gPSAhcGFyYW1zLmVuZEJlZm9yZVNldF87DQogICAgfQ0KICAgIHVwZGF0ZUNoaWxkKHNuYXAsIGtleSwgbmV3Q2hpbGQsIGFmZmVjdGVkUGF0aCwgc291cmNlLCBvcHRDaGFuZ2VBY2N1bXVsYXRvcikgew0KICAgICAgICBpZiAoIXRoaXMucmFuZ2VkRmlsdGVyXy5tYXRjaGVzKG5ldyBOYW1lZE5vZGUoa2V5LCBuZXdDaGlsZCkpKSB7DQogICAgICAgICAgICBuZXdDaGlsZCA9IENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFOw0KICAgICAgICB9DQogICAgICAgIGlmIChzbmFwLmdldEltbWVkaWF0ZUNoaWxkKGtleSkuZXF1YWxzKG5ld0NoaWxkKSkgew0KICAgICAgICAgICAgLy8gTm8gY2hhbmdlDQogICAgICAgICAgICByZXR1cm4gc25hcDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChzbmFwLm51bUNoaWxkcmVuKCkgPCB0aGlzLmxpbWl0Xykgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMucmFuZ2VkRmlsdGVyXw0KICAgICAgICAgICAgICAgIC5nZXRJbmRleGVkRmlsdGVyKCkNCiAgICAgICAgICAgICAgICAudXBkYXRlQ2hpbGQoc25hcCwga2V5LCBuZXdDaGlsZCwgYWZmZWN0ZWRQYXRoLCBzb3VyY2UsIG9wdENoYW5nZUFjY3VtdWxhdG9yKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmZ1bGxMaW1pdFVwZGF0ZUNoaWxkXyhzbmFwLCBrZXksIG5ld0NoaWxkLCBzb3VyY2UsIG9wdENoYW5nZUFjY3VtdWxhdG9yKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICB1cGRhdGVGdWxsTm9kZShvbGRTbmFwLCBuZXdTbmFwLCBvcHRDaGFuZ2VBY2N1bXVsYXRvcikgew0KICAgICAgICBsZXQgZmlsdGVyZWQ7DQogICAgICAgIGlmIChuZXdTbmFwLmlzTGVhZk5vZGUoKSB8fCBuZXdTbmFwLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHdlIGhhdmUgYSBjaGlsZHJlbiBub2RlIHdpdGggdGhlIGNvcnJlY3QgaW5kZXgsIG5vdCBhIGxlYWYgbm9kZTsNCiAgICAgICAgICAgIGZpbHRlcmVkID0gQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREUud2l0aEluZGV4KHRoaXMuaW5kZXhfKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGlmICh0aGlzLmxpbWl0XyAqIDIgPCBuZXdTbmFwLm51bUNoaWxkcmVuKCkgJiYNCiAgICAgICAgICAgICAgICBuZXdTbmFwLmlzSW5kZXhlZCh0aGlzLmluZGV4XykpIHsNCiAgICAgICAgICAgICAgICAvLyBFYXNpZXIgdG8gYnVpbGQgdXAgYSBzbmFwc2hvdCwgc2luY2Ugd2hhdCB3ZSdyZSBnaXZlbiBoYXMgbW9yZSB0aGFuIHR3aWNlIHRoZSBlbGVtZW50cyB3ZSB3YW50DQogICAgICAgICAgICAgICAgZmlsdGVyZWQgPSBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERS53aXRoSW5kZXgodGhpcy5pbmRleF8pOw0KICAgICAgICAgICAgICAgIC8vIGFuY2hvciB0byB0aGUgc3RhcnRQb3N0LCBlbmRQb3N0LCBvciBsYXN0IGVsZW1lbnQgYXMgYXBwcm9wcmlhdGUNCiAgICAgICAgICAgICAgICBsZXQgaXRlcmF0b3I7DQogICAgICAgICAgICAgICAgaWYgKHRoaXMucmV2ZXJzZV8pIHsNCiAgICAgICAgICAgICAgICAgICAgaXRlcmF0b3IgPSBuZXdTbmFwLmdldFJldmVyc2VJdGVyYXRvckZyb20odGhpcy5yYW5nZWRGaWx0ZXJfLmdldEVuZFBvc3QoKSwgdGhpcy5pbmRleF8pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgaXRlcmF0b3IgPSBuZXdTbmFwLmdldEl0ZXJhdG9yRnJvbSh0aGlzLnJhbmdlZEZpbHRlcl8uZ2V0U3RhcnRQb3N0KCksIHRoaXMuaW5kZXhfKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgbGV0IGNvdW50ID0gMDsNCiAgICAgICAgICAgICAgICB3aGlsZSAoaXRlcmF0b3IuaGFzTmV4dCgpICYmIGNvdW50IDwgdGhpcy5saW1pdF8pIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV4dCA9IGl0ZXJhdG9yLmdldE5leHQoKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLndpdGhpbkRpcmVjdGlvbmFsU3RhcnQobmV4dCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIHdlIGhhdmUgbm90IHJlYWNoZWQgdGhlIHN0YXJ0LCBza2lwIHRvIHRoZSBuZXh0IGVsZW1lbnQNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCF0aGlzLndpdGhpbkRpcmVjdGlvbmFsRW5kKG5leHQpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiB3ZSBoYXZlIHJlYWNoZWQgdGhlIGVuZCwgc3RvcCBhZGRpbmcgZWxlbWVudHMNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWQgPSBmaWx0ZXJlZC51cGRhdGVJbW1lZGlhdGVDaGlsZChuZXh0Lm5hbWUsIG5leHQubm9kZSk7DQogICAgICAgICAgICAgICAgICAgICAgICBjb3VudCsrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gVGhlIHNuYXAgY29udGFpbnMgbGVzcyB0aGFuIHR3aWNlIHRoZSBsaW1pdC4gRmFzdGVyIHRvIGRlbGV0ZSBmcm9tIHRoZSBzbmFwIHRoYW4gYnVpbGQgdXAgYSBuZXcgb25lDQogICAgICAgICAgICAgICAgZmlsdGVyZWQgPSBuZXdTbmFwLndpdGhJbmRleCh0aGlzLmluZGV4Xyk7DQogICAgICAgICAgICAgICAgLy8gRG9uJ3Qgc3VwcG9ydCBwcmlvcml0aWVzIG9uIHF1ZXJpZXMNCiAgICAgICAgICAgICAgICBmaWx0ZXJlZCA9IGZpbHRlcmVkLnVwZGF0ZVByaW9yaXR5KENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFKTsNCiAgICAgICAgICAgICAgICBsZXQgaXRlcmF0b3I7DQogICAgICAgICAgICAgICAgaWYgKHRoaXMucmV2ZXJzZV8pIHsNCiAgICAgICAgICAgICAgICAgICAgaXRlcmF0b3IgPSBmaWx0ZXJlZC5nZXRSZXZlcnNlSXRlcmF0b3IodGhpcy5pbmRleF8pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgaXRlcmF0b3IgPSBmaWx0ZXJlZC5nZXRJdGVyYXRvcih0aGlzLmluZGV4Xyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGxldCBjb3VudCA9IDA7DQogICAgICAgICAgICAgICAgd2hpbGUgKGl0ZXJhdG9yLmhhc05leHQoKSkgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXh0ID0gaXRlcmF0b3IuZ2V0TmV4dCgpOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBpblJhbmdlID0gY291bnQgPCB0aGlzLmxpbWl0XyAmJg0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy53aXRoaW5EaXJlY3Rpb25hbFN0YXJ0KG5leHQpICYmDQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLndpdGhpbkRpcmVjdGlvbmFsRW5kKG5leHQpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoaW5SYW5nZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY291bnQrKzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkID0gZmlsdGVyZWQudXBkYXRlSW1tZWRpYXRlQ2hpbGQobmV4dC5uYW1lLCBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXMucmFuZ2VkRmlsdGVyXw0KICAgICAgICAgICAgLmdldEluZGV4ZWRGaWx0ZXIoKQ0KICAgICAgICAgICAgLnVwZGF0ZUZ1bGxOb2RlKG9sZFNuYXAsIGZpbHRlcmVkLCBvcHRDaGFuZ2VBY2N1bXVsYXRvcik7DQogICAgfQ0KICAgIHVwZGF0ZVByaW9yaXR5KG9sZFNuYXAsIG5ld1ByaW9yaXR5KSB7DQogICAgICAgIC8vIERvbid0IHN1cHBvcnQgcHJpb3JpdGllcyBvbiBxdWVyaWVzDQogICAgICAgIHJldHVybiBvbGRTbmFwOw0KICAgIH0NCiAgICBmaWx0ZXJzTm9kZXMoKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICBnZXRJbmRleGVkRmlsdGVyKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5yYW5nZWRGaWx0ZXJfLmdldEluZGV4ZWRGaWx0ZXIoKTsNCiAgICB9DQogICAgZ2V0SW5kZXgoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmluZGV4XzsNCiAgICB9DQogICAgZnVsbExpbWl0VXBkYXRlQ2hpbGRfKHNuYXAsIGNoaWxkS2V5LCBjaGlsZFNuYXAsIHNvdXJjZSwgY2hhbmdlQWNjdW11bGF0b3IpIHsNCiAgICAgICAgLy8gVE9ETzogcmVuYW1lIGFsbCBjYWNoZSBzdHVmZiBldGMgdG8gZ2VuZXJhbCBzbmFwIHRlcm1pbm9sb2d5DQogICAgICAgIGxldCBjbXA7DQogICAgICAgIGlmICh0aGlzLnJldmVyc2VfKSB7DQogICAgICAgICAgICBjb25zdCBpbmRleENtcCA9IHRoaXMuaW5kZXhfLmdldENvbXBhcmUoKTsNCiAgICAgICAgICAgIGNtcCA9IChhLCBiKSA9PiBpbmRleENtcChiLCBhKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNtcCA9IHRoaXMuaW5kZXhfLmdldENvbXBhcmUoKTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBvbGRFdmVudENhY2hlID0gc25hcDsNCiAgICAgICAgYXNzZXJ0KG9sZEV2ZW50Q2FjaGUubnVtQ2hpbGRyZW4oKSA9PT0gdGhpcy5saW1pdF8sICcnKTsNCiAgICAgICAgY29uc3QgbmV3Q2hpbGROYW1lZE5vZGUgPSBuZXcgTmFtZWROb2RlKGNoaWxkS2V5LCBjaGlsZFNuYXApOw0KICAgICAgICBjb25zdCB3aW5kb3dCb3VuZGFyeSA9IHRoaXMucmV2ZXJzZV8NCiAgICAgICAgICAgID8gb2xkRXZlbnRDYWNoZS5nZXRGaXJzdENoaWxkKHRoaXMuaW5kZXhfKQ0KICAgICAgICAgICAgOiBvbGRFdmVudENhY2hlLmdldExhc3RDaGlsZCh0aGlzLmluZGV4Xyk7DQogICAgICAgIGNvbnN0IGluUmFuZ2UgPSB0aGlzLnJhbmdlZEZpbHRlcl8ubWF0Y2hlcyhuZXdDaGlsZE5hbWVkTm9kZSk7DQogICAgICAgIGlmIChvbGRFdmVudENhY2hlLmhhc0NoaWxkKGNoaWxkS2V5KSkgew0KICAgICAgICAgICAgY29uc3Qgb2xkQ2hpbGRTbmFwID0gb2xkRXZlbnRDYWNoZS5nZXRJbW1lZGlhdGVDaGlsZChjaGlsZEtleSk7DQogICAgICAgICAgICBsZXQgbmV4dENoaWxkID0gc291cmNlLmdldENoaWxkQWZ0ZXJDaGlsZCh0aGlzLmluZGV4Xywgd2luZG93Qm91bmRhcnksIHRoaXMucmV2ZXJzZV8pOw0KICAgICAgICAgICAgd2hpbGUgKG5leHRDaGlsZCAhPSBudWxsICYmDQogICAgICAgICAgICAgICAgKG5leHRDaGlsZC5uYW1lID09PSBjaGlsZEtleSB8fCBvbGRFdmVudENhY2hlLmhhc0NoaWxkKG5leHRDaGlsZC5uYW1lKSkpIHsNCiAgICAgICAgICAgICAgICAvLyBUaGVyZSBpcyBhIHdlaXJkIGVkZ2UgY2FzZSB3aGVyZSBhIG5vZGUgaXMgdXBkYXRlZCBhcyBwYXJ0IG9mIGEgbWVyZ2UgaW4gdGhlIHdyaXRlIHRyZWUsIGJ1dCBoYXNuJ3QNCiAgICAgICAgICAgICAgICAvLyBiZWVuIGFwcGxpZWQgdG8gdGhlIGxpbWl0ZWQgZmlsdGVyIHlldC4gSWdub3JlIHRoaXMgbmV4dCBjaGlsZCB3aGljaCB3aWxsIGJlIHVwZGF0ZWQgbGF0ZXIgaW4NCiAgICAgICAgICAgICAgICAvLyB0aGUgbGltaXRlZCBmaWx0ZXIuLi4NCiAgICAgICAgICAgICAgICBuZXh0Q2hpbGQgPSBzb3VyY2UuZ2V0Q2hpbGRBZnRlckNoaWxkKHRoaXMuaW5kZXhfLCBuZXh0Q2hpbGQsIHRoaXMucmV2ZXJzZV8pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgY29tcGFyZU5leHQgPSBuZXh0Q2hpbGQgPT0gbnVsbCA/IDEgOiBjbXAobmV4dENoaWxkLCBuZXdDaGlsZE5hbWVkTm9kZSk7DQogICAgICAgICAgICBjb25zdCByZW1haW5zSW5XaW5kb3cgPSBpblJhbmdlICYmICFjaGlsZFNuYXAuaXNFbXB0eSgpICYmIGNvbXBhcmVOZXh0ID49IDA7DQogICAgICAgICAgICBpZiAocmVtYWluc0luV2luZG93KSB7DQogICAgICAgICAgICAgICAgaWYgKGNoYW5nZUFjY3VtdWxhdG9yICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgY2hhbmdlQWNjdW11bGF0b3IudHJhY2tDaGlsZENoYW5nZShjaGFuZ2VDaGlsZENoYW5nZWQoY2hpbGRLZXksIGNoaWxkU25hcCwgb2xkQ2hpbGRTbmFwKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBvbGRFdmVudENhY2hlLnVwZGF0ZUltbWVkaWF0ZUNoaWxkKGNoaWxkS2V5LCBjaGlsZFNuYXApOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgaWYgKGNoYW5nZUFjY3VtdWxhdG9yICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgY2hhbmdlQWNjdW11bGF0b3IudHJhY2tDaGlsZENoYW5nZShjaGFuZ2VDaGlsZFJlbW92ZWQoY2hpbGRLZXksIG9sZENoaWxkU25hcCkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjb25zdCBuZXdFdmVudENhY2hlID0gb2xkRXZlbnRDYWNoZS51cGRhdGVJbW1lZGlhdGVDaGlsZChjaGlsZEtleSwgQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREUpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG5leHRDaGlsZEluUmFuZ2UgPSBuZXh0Q2hpbGQgIT0gbnVsbCAmJiB0aGlzLnJhbmdlZEZpbHRlcl8ubWF0Y2hlcyhuZXh0Q2hpbGQpOw0KICAgICAgICAgICAgICAgIGlmIChuZXh0Q2hpbGRJblJhbmdlKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChjaGFuZ2VBY2N1bXVsYXRvciAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VBY2N1bXVsYXRvci50cmFja0NoaWxkQ2hhbmdlKGNoYW5nZUNoaWxkQWRkZWQobmV4dENoaWxkLm5hbWUsIG5leHRDaGlsZC5ub2RlKSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ld0V2ZW50Q2FjaGUudXBkYXRlSW1tZWRpYXRlQ2hpbGQobmV4dENoaWxkLm5hbWUsIG5leHRDaGlsZC5ub2RlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXdFdmVudENhY2hlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChjaGlsZFNuYXAuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAvLyB3ZSdyZSBkZWxldGluZyBhIG5vZGUsIGJ1dCBpdCB3YXMgbm90IGluIHRoZSB3aW5kb3csIHNvIGlnbm9yZSBpdA0KICAgICAgICAgICAgcmV0dXJuIHNuYXA7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoaW5SYW5nZSkgew0KICAgICAgICAgICAgaWYgKGNtcCh3aW5kb3dCb3VuZGFyeSwgbmV3Q2hpbGROYW1lZE5vZGUpID49IDApIHsNCiAgICAgICAgICAgICAgICBpZiAoY2hhbmdlQWNjdW11bGF0b3IgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICBjaGFuZ2VBY2N1bXVsYXRvci50cmFja0NoaWxkQ2hhbmdlKGNoYW5nZUNoaWxkUmVtb3ZlZCh3aW5kb3dCb3VuZGFyeS5uYW1lLCB3aW5kb3dCb3VuZGFyeS5ub2RlKSk7DQogICAgICAgICAgICAgICAgICAgIGNoYW5nZUFjY3VtdWxhdG9yLnRyYWNrQ2hpbGRDaGFuZ2UoY2hhbmdlQ2hpbGRBZGRlZChjaGlsZEtleSwgY2hpbGRTbmFwKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBvbGRFdmVudENhY2hlDQogICAgICAgICAgICAgICAgICAgIC51cGRhdGVJbW1lZGlhdGVDaGlsZChjaGlsZEtleSwgY2hpbGRTbmFwKQ0KICAgICAgICAgICAgICAgICAgICAudXBkYXRlSW1tZWRpYXRlQ2hpbGQod2luZG93Qm91bmRhcnkubmFtZSwgQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHNuYXA7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gc25hcDsNCiAgICAgICAgfQ0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogVGhpcyBjbGFzcyBpcyBhbiBpbW11dGFibGUtZnJvbS10aGUtcHVibGljLWFwaSBzdHJ1Y3QgY29udGFpbmluZyBhIHNldCBvZiBxdWVyeSBwYXJhbWV0ZXJzIGRlZmluaW5nIGENCiAqIHJhbmdlIHRvIGJlIHJldHVybmVkIGZvciBhIHBhcnRpY3VsYXIgbG9jYXRpb24uIEl0IGlzIGFzc3VtZWQgdGhhdCB2YWxpZGF0aW9uIG9mIHBhcmFtZXRlcnMgaXMgZG9uZSBhdCB0aGUNCiAqIHVzZXItZmFjaW5nIEFQSSBsZXZlbCwgc28gaXQgaXMgbm90IGRvbmUgaGVyZS4NCiAqDQogKiBAaW50ZXJuYWwNCiAqLw0KY2xhc3MgUXVlcnlQYXJhbXMgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICB0aGlzLmxpbWl0U2V0XyA9IGZhbHNlOw0KICAgICAgICB0aGlzLnN0YXJ0U2V0XyA9IGZhbHNlOw0KICAgICAgICB0aGlzLnN0YXJ0TmFtZVNldF8gPSBmYWxzZTsNCiAgICAgICAgdGhpcy5zdGFydEFmdGVyU2V0XyA9IGZhbHNlOyAvLyBjYW4gb25seSBiZSB0cnVlIGlmIHN0YXJ0U2V0XyBpcyB0cnVlDQogICAgICAgIHRoaXMuZW5kU2V0XyA9IGZhbHNlOw0KICAgICAgICB0aGlzLmVuZE5hbWVTZXRfID0gZmFsc2U7DQogICAgICAgIHRoaXMuZW5kQmVmb3JlU2V0XyA9IGZhbHNlOyAvLyBjYW4gb25seSBiZSB0cnVlIGlmIGVuZFNldF8gaXMgdHJ1ZQ0KICAgICAgICB0aGlzLmxpbWl0XyA9IDA7DQogICAgICAgIHRoaXMudmlld0Zyb21fID0gJyc7DQogICAgICAgIHRoaXMuaW5kZXhTdGFydFZhbHVlXyA9IG51bGw7DQogICAgICAgIHRoaXMuaW5kZXhTdGFydE5hbWVfID0gJyc7DQogICAgICAgIHRoaXMuaW5kZXhFbmRWYWx1ZV8gPSBudWxsOw0KICAgICAgICB0aGlzLmluZGV4RW5kTmFtZV8gPSAnJzsNCiAgICAgICAgdGhpcy5pbmRleF8gPSBQUklPUklUWV9JTkRFWDsNCiAgICB9DQogICAgaGFzU3RhcnQoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnN0YXJ0U2V0XzsNCiAgICB9DQogICAgLyoqDQogICAgICogQHJldHVybnMgVHJ1ZSBpZiBpdCB3b3VsZCByZXR1cm4gZnJvbSBsZWZ0Lg0KICAgICAqLw0KICAgIGlzVmlld0Zyb21MZWZ0KCkgew0KICAgICAgICBpZiAodGhpcy52aWV3RnJvbV8gPT09ICcnKSB7DQogICAgICAgICAgICAvLyBsaW1pdCgpLCByYXRoZXIgdGhhbiBsaW1pdFRvRmlyc3Qgb3IgbGltaXRUb0xhc3Qgd2FzIGNhbGxlZC4NCiAgICAgICAgICAgIC8vIFRoaXMgbWVhbnMgdGhhdCBvbmx5IG9uZSBvZiBzdGFydFNldF8gYW5kIGVuZFNldF8gaXMgdHJ1ZS4gVXNlIHRoZW0NCiAgICAgICAgICAgIC8vIHRvIGNhbGN1bGF0ZSB3aGljaCBzaWRlIG9mIHRoZSB2aWV3IHRvIGFuY2hvciB0by4gSWYgbmVpdGhlciBpcyBzZXQsDQogICAgICAgICAgICAvLyBhbmNob3IgdG8gdGhlIGVuZC4NCiAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXJ0U2V0XzsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLnZpZXdGcm9tXyA9PT0gImwiIC8qIFdJUkVfUFJPVE9DT0xfQ09OU1RBTlRTLlZJRVdfRlJPTV9MRUZUICovOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIE9ubHkgdmFsaWQgdG8gY2FsbCBpZiBoYXNTdGFydCgpIHJldHVybnMgdHJ1ZQ0KICAgICAqLw0KICAgIGdldEluZGV4U3RhcnRWYWx1ZSgpIHsNCiAgICAgICAgYXNzZXJ0KHRoaXMuc3RhcnRTZXRfLCAnT25seSB2YWxpZCBpZiBzdGFydCBoYXMgYmVlbiBzZXQnKTsNCiAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXhTdGFydFZhbHVlXzsNCiAgICB9DQogICAgLyoqDQogICAgICogT25seSB2YWxpZCB0byBjYWxsIGlmIGhhc1N0YXJ0KCkgcmV0dXJucyB0cnVlLg0KICAgICAqIFJldHVybnMgdGhlIHN0YXJ0aW5nIGtleSBuYW1lIGZvciB0aGUgcmFuZ2UgZGVmaW5lZCBieSB0aGVzZSBxdWVyeSBwYXJhbWV0ZXJzDQogICAgICovDQogICAgZ2V0SW5kZXhTdGFydE5hbWUoKSB7DQogICAgICAgIGFzc2VydCh0aGlzLnN0YXJ0U2V0XywgJ09ubHkgdmFsaWQgaWYgc3RhcnQgaGFzIGJlZW4gc2V0Jyk7DQogICAgICAgIGlmICh0aGlzLnN0YXJ0TmFtZVNldF8pIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmluZGV4U3RhcnROYW1lXzsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBNSU5fTkFNRTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBoYXNFbmQoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmVuZFNldF87DQogICAgfQ0KICAgIC8qKg0KICAgICAqIE9ubHkgdmFsaWQgdG8gY2FsbCBpZiBoYXNFbmQoKSByZXR1cm5zIHRydWUuDQogICAgICovDQogICAgZ2V0SW5kZXhFbmRWYWx1ZSgpIHsNCiAgICAgICAgYXNzZXJ0KHRoaXMuZW5kU2V0XywgJ09ubHkgdmFsaWQgaWYgZW5kIGhhcyBiZWVuIHNldCcpOw0KICAgICAgICByZXR1cm4gdGhpcy5pbmRleEVuZFZhbHVlXzsNCiAgICB9DQogICAgLyoqDQogICAgICogT25seSB2YWxpZCB0byBjYWxsIGlmIGhhc0VuZCgpIHJldHVybnMgdHJ1ZS4NCiAgICAgKiBSZXR1cm5zIHRoZSBlbmQga2V5IG5hbWUgZm9yIHRoZSByYW5nZSBkZWZpbmVkIGJ5IHRoZXNlIHF1ZXJ5IHBhcmFtZXRlcnMNCiAgICAgKi8NCiAgICBnZXRJbmRleEVuZE5hbWUoKSB7DQogICAgICAgIGFzc2VydCh0aGlzLmVuZFNldF8sICdPbmx5IHZhbGlkIGlmIGVuZCBoYXMgYmVlbiBzZXQnKTsNCiAgICAgICAgaWYgKHRoaXMuZW5kTmFtZVNldF8pIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmluZGV4RW5kTmFtZV87DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gTUFYX05BTUU7DQogICAgICAgIH0NCiAgICB9DQogICAgaGFzTGltaXQoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmxpbWl0U2V0XzsNCiAgICB9DQogICAgLyoqDQogICAgICogQHJldHVybnMgVHJ1ZSBpZiBhIGxpbWl0IGhhcyBiZWVuIHNldCBhbmQgaXQgaGFzIGJlZW4gZXhwbGljaXRseSBhbmNob3JlZA0KICAgICAqLw0KICAgIGhhc0FuY2hvcmVkTGltaXQoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmxpbWl0U2V0XyAmJiB0aGlzLnZpZXdGcm9tXyAhPT0gJyc7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIE9ubHkgdmFsaWQgdG8gY2FsbCBpZiBoYXNMaW1pdCgpIHJldHVybnMgdHJ1ZQ0KICAgICAqLw0KICAgIGdldExpbWl0KCkgew0KICAgICAgICBhc3NlcnQodGhpcy5saW1pdFNldF8sICdPbmx5IHZhbGlkIGlmIGxpbWl0IGhhcyBiZWVuIHNldCcpOw0KICAgICAgICByZXR1cm4gdGhpcy5saW1pdF87DQogICAgfQ0KICAgIGdldEluZGV4KCkgew0KICAgICAgICByZXR1cm4gdGhpcy5pbmRleF87DQogICAgfQ0KICAgIGxvYWRzQWxsRGF0YSgpIHsNCiAgICAgICAgcmV0dXJuICEodGhpcy5zdGFydFNldF8gfHwgdGhpcy5lbmRTZXRfIHx8IHRoaXMubGltaXRTZXRfKTsNCiAgICB9DQogICAgaXNEZWZhdWx0KCkgew0KICAgICAgICByZXR1cm4gdGhpcy5sb2Fkc0FsbERhdGEoKSAmJiB0aGlzLmluZGV4XyA9PT0gUFJJT1JJVFlfSU5ERVg7DQogICAgfQ0KICAgIGNvcHkoKSB7DQogICAgICAgIGNvbnN0IGNvcHkgPSBuZXcgUXVlcnlQYXJhbXMoKTsNCiAgICAgICAgY29weS5saW1pdFNldF8gPSB0aGlzLmxpbWl0U2V0XzsNCiAgICAgICAgY29weS5saW1pdF8gPSB0aGlzLmxpbWl0XzsNCiAgICAgICAgY29weS5zdGFydFNldF8gPSB0aGlzLnN0YXJ0U2V0XzsNCiAgICAgICAgY29weS5zdGFydEFmdGVyU2V0XyA9IHRoaXMuc3RhcnRBZnRlclNldF87DQogICAgICAgIGNvcHkuaW5kZXhTdGFydFZhbHVlXyA9IHRoaXMuaW5kZXhTdGFydFZhbHVlXzsNCiAgICAgICAgY29weS5zdGFydE5hbWVTZXRfID0gdGhpcy5zdGFydE5hbWVTZXRfOw0KICAgICAgICBjb3B5LmluZGV4U3RhcnROYW1lXyA9IHRoaXMuaW5kZXhTdGFydE5hbWVfOw0KICAgICAgICBjb3B5LmVuZFNldF8gPSB0aGlzLmVuZFNldF87DQogICAgICAgIGNvcHkuZW5kQmVmb3JlU2V0XyA9IHRoaXMuZW5kQmVmb3JlU2V0XzsNCiAgICAgICAgY29weS5pbmRleEVuZFZhbHVlXyA9IHRoaXMuaW5kZXhFbmRWYWx1ZV87DQogICAgICAgIGNvcHkuZW5kTmFtZVNldF8gPSB0aGlzLmVuZE5hbWVTZXRfOw0KICAgICAgICBjb3B5LmluZGV4RW5kTmFtZV8gPSB0aGlzLmluZGV4RW5kTmFtZV87DQogICAgICAgIGNvcHkuaW5kZXhfID0gdGhpcy5pbmRleF87DQogICAgICAgIGNvcHkudmlld0Zyb21fID0gdGhpcy52aWV3RnJvbV87DQogICAgICAgIHJldHVybiBjb3B5Ow0KICAgIH0NCn0NCmZ1bmN0aW9uIHF1ZXJ5UGFyYW1zR2V0Tm9kZUZpbHRlcihxdWVyeVBhcmFtcykgew0KICAgIGlmIChxdWVyeVBhcmFtcy5sb2Fkc0FsbERhdGEoKSkgew0KICAgICAgICByZXR1cm4gbmV3IEluZGV4ZWRGaWx0ZXIocXVlcnlQYXJhbXMuZ2V0SW5kZXgoKSk7DQogICAgfQ0KICAgIGVsc2UgaWYgKHF1ZXJ5UGFyYW1zLmhhc0xpbWl0KCkpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBMaW1pdGVkRmlsdGVyKHF1ZXJ5UGFyYW1zKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIHJldHVybiBuZXcgUmFuZ2VkRmlsdGVyKHF1ZXJ5UGFyYW1zKTsNCiAgICB9DQp9DQovKioNCiAqIFJldHVybnMgYSBzZXQgb2YgUkVTVCBxdWVyeSBzdHJpbmcgcGFyYW1ldGVycyByZXByZXNlbnRpbmcgdGhpcyBxdWVyeS4NCiAqDQogKiBAcmV0dXJucyBxdWVyeSBzdHJpbmcgcGFyYW1ldGVycw0KICovDQpmdW5jdGlvbiBxdWVyeVBhcmFtc1RvUmVzdFF1ZXJ5U3RyaW5nUGFyYW1ldGVycyhxdWVyeVBhcmFtcykgew0KICAgIGNvbnN0IHFzID0ge307DQogICAgaWYgKHF1ZXJ5UGFyYW1zLmlzRGVmYXVsdCgpKSB7DQogICAgICAgIHJldHVybiBxczsNCiAgICB9DQogICAgbGV0IG9yZGVyQnk7DQogICAgaWYgKHF1ZXJ5UGFyYW1zLmluZGV4XyA9PT0gUFJJT1JJVFlfSU5ERVgpIHsNCiAgICAgICAgb3JkZXJCeSA9ICIkcHJpb3JpdHkiIC8qIFJFU1RfUVVFUllfQ09OU1RBTlRTLlBSSU9SSVRZX0lOREVYICovOw0KICAgIH0NCiAgICBlbHNlIGlmIChxdWVyeVBhcmFtcy5pbmRleF8gPT09IFZBTFVFX0lOREVYKSB7DQogICAgICAgIG9yZGVyQnkgPSAiJHZhbHVlIiAvKiBSRVNUX1FVRVJZX0NPTlNUQU5UUy5WQUxVRV9JTkRFWCAqLzsNCiAgICB9DQogICAgZWxzZSBpZiAocXVlcnlQYXJhbXMuaW5kZXhfID09PSBLRVlfSU5ERVgpIHsNCiAgICAgICAgb3JkZXJCeSA9ICIka2V5IiAvKiBSRVNUX1FVRVJZX0NPTlNUQU5UUy5LRVlfSU5ERVggKi87DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBhc3NlcnQocXVlcnlQYXJhbXMuaW5kZXhfIGluc3RhbmNlb2YgUGF0aEluZGV4LCAnVW5yZWNvZ25pemVkIGluZGV4IHR5cGUhJyk7DQogICAgICAgIG9yZGVyQnkgPSBxdWVyeVBhcmFtcy5pbmRleF8udG9TdHJpbmcoKTsNCiAgICB9DQogICAgcXNbIm9yZGVyQnkiIC8qIFJFU1RfUVVFUllfQ09OU1RBTlRTLk9SREVSX0JZICovXSA9IHN0cmluZ2lmeShvcmRlckJ5KTsNCiAgICBpZiAocXVlcnlQYXJhbXMuc3RhcnRTZXRfKSB7DQogICAgICAgIGNvbnN0IHN0YXJ0UGFyYW0gPSBxdWVyeVBhcmFtcy5zdGFydEFmdGVyU2V0Xw0KICAgICAgICAgICAgPyAic3RhcnRBZnRlciIgLyogUkVTVF9RVUVSWV9DT05TVEFOVFMuU1RBUlRfQUZURVIgKi8NCiAgICAgICAgICAgIDogInN0YXJ0QXQiIC8qIFJFU1RfUVVFUllfQ09OU1RBTlRTLlNUQVJUX0FUICovOw0KICAgICAgICBxc1tzdGFydFBhcmFtXSA9IHN0cmluZ2lmeShxdWVyeVBhcmFtcy5pbmRleFN0YXJ0VmFsdWVfKTsNCiAgICAgICAgaWYgKHF1ZXJ5UGFyYW1zLnN0YXJ0TmFtZVNldF8pIHsNCiAgICAgICAgICAgIHFzW3N0YXJ0UGFyYW1dICs9ICcsJyArIHN0cmluZ2lmeShxdWVyeVBhcmFtcy5pbmRleFN0YXJ0TmFtZV8pOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChxdWVyeVBhcmFtcy5lbmRTZXRfKSB7DQogICAgICAgIGNvbnN0IGVuZFBhcmFtID0gcXVlcnlQYXJhbXMuZW5kQmVmb3JlU2V0Xw0KICAgICAgICAgICAgPyAiZW5kQmVmb3JlIiAvKiBSRVNUX1FVRVJZX0NPTlNUQU5UUy5FTkRfQkVGT1JFICovDQogICAgICAgICAgICA6ICJlbmRBdCIgLyogUkVTVF9RVUVSWV9DT05TVEFOVFMuRU5EX0FUICovOw0KICAgICAgICBxc1tlbmRQYXJhbV0gPSBzdHJpbmdpZnkocXVlcnlQYXJhbXMuaW5kZXhFbmRWYWx1ZV8pOw0KICAgICAgICBpZiAocXVlcnlQYXJhbXMuZW5kTmFtZVNldF8pIHsNCiAgICAgICAgICAgIHFzW2VuZFBhcmFtXSArPSAnLCcgKyBzdHJpbmdpZnkocXVlcnlQYXJhbXMuaW5kZXhFbmROYW1lXyk7DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKHF1ZXJ5UGFyYW1zLmxpbWl0U2V0Xykgew0KICAgICAgICBpZiAocXVlcnlQYXJhbXMuaXNWaWV3RnJvbUxlZnQoKSkgew0KICAgICAgICAgICAgcXNbImxpbWl0VG9GaXJzdCIgLyogUkVTVF9RVUVSWV9DT05TVEFOVFMuTElNSVRfVE9fRklSU1QgKi9dID0gcXVlcnlQYXJhbXMubGltaXRfOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcXNbImxpbWl0VG9MYXN0IiAvKiBSRVNUX1FVRVJZX0NPTlNUQU5UUy5MSU1JVF9UT19MQVNUICovXSA9IHF1ZXJ5UGFyYW1zLmxpbWl0XzsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcXM7DQp9DQpmdW5jdGlvbiBxdWVyeVBhcmFtc0dldFF1ZXJ5T2JqZWN0KHF1ZXJ5UGFyYW1zKSB7DQogICAgY29uc3Qgb2JqID0ge307DQogICAgaWYgKHF1ZXJ5UGFyYW1zLnN0YXJ0U2V0Xykgew0KICAgICAgICBvYmpbInNwIiAvKiBXSVJFX1BST1RPQ09MX0NPTlNUQU5UUy5JTkRFWF9TVEFSVF9WQUxVRSAqL10gPQ0KICAgICAgICAgICAgcXVlcnlQYXJhbXMuaW5kZXhTdGFydFZhbHVlXzsNCiAgICAgICAgaWYgKHF1ZXJ5UGFyYW1zLnN0YXJ0TmFtZVNldF8pIHsNCiAgICAgICAgICAgIG9ialsic24iIC8qIFdJUkVfUFJPVE9DT0xfQ09OU1RBTlRTLklOREVYX1NUQVJUX05BTUUgKi9dID0NCiAgICAgICAgICAgICAgICBxdWVyeVBhcmFtcy5pbmRleFN0YXJ0TmFtZV87DQogICAgICAgIH0NCiAgICAgICAgb2JqWyJzaW4iIC8qIFdJUkVfUFJPVE9DT0xfQ09OU1RBTlRTLklOREVYX1NUQVJUX0lTX0lOQ0xVU0lWRSAqL10gPQ0KICAgICAgICAgICAgIXF1ZXJ5UGFyYW1zLnN0YXJ0QWZ0ZXJTZXRfOw0KICAgIH0NCiAgICBpZiAocXVlcnlQYXJhbXMuZW5kU2V0Xykgew0KICAgICAgICBvYmpbImVwIiAvKiBXSVJFX1BST1RPQ09MX0NPTlNUQU5UUy5JTkRFWF9FTkRfVkFMVUUgKi9dID0gcXVlcnlQYXJhbXMuaW5kZXhFbmRWYWx1ZV87DQogICAgICAgIGlmIChxdWVyeVBhcmFtcy5lbmROYW1lU2V0Xykgew0KICAgICAgICAgICAgb2JqWyJlbiIgLyogV0lSRV9QUk9UT0NPTF9DT05TVEFOVFMuSU5ERVhfRU5EX05BTUUgKi9dID0gcXVlcnlQYXJhbXMuaW5kZXhFbmROYW1lXzsNCiAgICAgICAgfQ0KICAgICAgICBvYmpbImVpbiIgLyogV0lSRV9QUk9UT0NPTF9DT05TVEFOVFMuSU5ERVhfRU5EX0lTX0lOQ0xVU0lWRSAqL10gPQ0KICAgICAgICAgICAgIXF1ZXJ5UGFyYW1zLmVuZEJlZm9yZVNldF87DQogICAgfQ0KICAgIGlmIChxdWVyeVBhcmFtcy5saW1pdFNldF8pIHsNCiAgICAgICAgb2JqWyJsIiAvKiBXSVJFX1BST1RPQ09MX0NPTlNUQU5UUy5MSU1JVCAqL10gPSBxdWVyeVBhcmFtcy5saW1pdF87DQogICAgICAgIGxldCB2aWV3RnJvbSA9IHF1ZXJ5UGFyYW1zLnZpZXdGcm9tXzsNCiAgICAgICAgaWYgKHZpZXdGcm9tID09PSAnJykgew0KICAgICAgICAgICAgaWYgKHF1ZXJ5UGFyYW1zLmlzVmlld0Zyb21MZWZ0KCkpIHsNCiAgICAgICAgICAgICAgICB2aWV3RnJvbSA9ICJsIiAvKiBXSVJFX1BST1RPQ09MX0NPTlNUQU5UUy5WSUVXX0ZST01fTEVGVCAqLzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIHZpZXdGcm9tID0gInIiIC8qIFdJUkVfUFJPVE9DT0xfQ09OU1RBTlRTLlZJRVdfRlJPTV9SSUdIVCAqLzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBvYmpbInZmIiAvKiBXSVJFX1BST1RPQ09MX0NPTlNUQU5UUy5WSUVXX0ZST00gKi9dID0gdmlld0Zyb207DQogICAgfQ0KICAgIC8vIEZvciBub3csIHByaW9yaXR5IGluZGV4IGlzIHRoZSBkZWZhdWx0LCBzbyB3ZSBvbmx5IHNwZWNpZnkgaWYgaXQncyBzb21lIG90aGVyIGluZGV4DQogICAgaWYgKHF1ZXJ5UGFyYW1zLmluZGV4XyAhPT0gUFJJT1JJVFlfSU5ERVgpIHsNCiAgICAgICAgb2JqWyJpIiAvKiBXSVJFX1BST1RPQ09MX0NPTlNUQU5UUy5JTkRFWCAqL10gPSBxdWVyeVBhcmFtcy5pbmRleF8udG9TdHJpbmcoKTsNCiAgICB9DQogICAgcmV0dXJuIG9iajsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogQW4gaW1wbGVtZW50YXRpb24gb2YgU2VydmVyQWN0aW9ucyB0aGF0IGNvbW11bmljYXRlcyB3aXRoIHRoZSBzZXJ2ZXIgdmlhIFJFU1QgcmVxdWVzdHMuDQogKiBUaGlzIGlzIG1vc3RseSB1c2VmdWwgZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBjcmF3bGVycywgd2hlcmUgd2UgZG9uJ3Qgd2FudCB0byBzcGluIHVwIGEgZnVsbA0KICogcGVyc2lzdGVudCBjb25uZWN0aW9uICh1c2luZyBXZWJTb2NrZXRzIG9yIGxvbmctcG9sbGluZykNCiAqLw0KY2xhc3MgUmVhZG9ubHlSZXN0Q2xpZW50IGV4dGVuZHMgU2VydmVyQWN0aW9ucyB7DQogICAgLyoqDQogICAgICogQHBhcmFtIHJlcG9JbmZvXyAtIERhdGEgYWJvdXQgdGhlIG5hbWVzcGFjZSB3ZSBhcmUgY29ubmVjdGluZyB0bw0KICAgICAqIEBwYXJhbSBvbkRhdGFVcGRhdGVfIC0gQSBjYWxsYmFjayBmb3IgbmV3IGRhdGEgZnJvbSB0aGUgc2VydmVyDQogICAgICovDQogICAgY29uc3RydWN0b3IocmVwb0luZm9fLCBvbkRhdGFVcGRhdGVfLCBhdXRoVG9rZW5Qcm92aWRlcl8sIGFwcENoZWNrVG9rZW5Qcm92aWRlcl8pIHsNCiAgICAgICAgc3VwZXIoKTsNCiAgICAgICAgdGhpcy5yZXBvSW5mb18gPSByZXBvSW5mb187DQogICAgICAgIHRoaXMub25EYXRhVXBkYXRlXyA9IG9uRGF0YVVwZGF0ZV87DQogICAgICAgIHRoaXMuYXV0aFRva2VuUHJvdmlkZXJfID0gYXV0aFRva2VuUHJvdmlkZXJfOw0KICAgICAgICB0aGlzLmFwcENoZWNrVG9rZW5Qcm92aWRlcl8gPSBhcHBDaGVja1Rva2VuUHJvdmlkZXJfOw0KICAgICAgICAvKiogQHByaXZhdGUge2Z1bmN0aW9uKC4uLlsqXSl9ICovDQogICAgICAgIHRoaXMubG9nXyA9IGxvZ1dyYXBwZXIoJ3A6cmVzdDonKTsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFdlIGRvbid0IGFjdHVhbGx5IG5lZWQgdG8gdHJhY2sgbGlzdGVucywgZXhjZXB0IHRvIHByZXZlbnQgdXMgY2FsbGluZyBhbiBvbkNvbXBsZXRlIGZvciBhIGxpc3Rlbg0KICAgICAgICAgKiB0aGF0J3MgYmVlbiByZW1vdmVkLiA6LS8NCiAgICAgICAgICovDQogICAgICAgIHRoaXMubGlzdGVuc18gPSB7fTsNCiAgICB9DQogICAgcmVwb3J0U3RhdHMoc3RhdHMpIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNZXRob2Qgbm90IGltcGxlbWVudGVkLicpOw0KICAgIH0NCiAgICBzdGF0aWMgZ2V0TGlzdGVuSWRfKHF1ZXJ5LCB0YWcpIHsNCiAgICAgICAgaWYgKHRhZyAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICByZXR1cm4gJ3RhZyQnICsgdGFnOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgYXNzZXJ0KHF1ZXJ5Ll9xdWVyeVBhcmFtcy5pc0RlZmF1bHQoKSwgInNob3VsZCBoYXZlIGEgdGFnIGlmIGl0J3Mgbm90IGEgZGVmYXVsdCBxdWVyeS4iKTsNCiAgICAgICAgICAgIHJldHVybiBxdWVyeS5fcGF0aC50b1N0cmluZygpOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgIGxpc3RlbihxdWVyeSwgY3VycmVudEhhc2hGbiwgdGFnLCBvbkNvbXBsZXRlKSB7DQogICAgICAgIGNvbnN0IHBhdGhTdHJpbmcgPSBxdWVyeS5fcGF0aC50b1N0cmluZygpOw0KICAgICAgICB0aGlzLmxvZ18oJ0xpc3RlbiBjYWxsZWQgZm9yICcgKyBwYXRoU3RyaW5nICsgJyAnICsgcXVlcnkuX3F1ZXJ5SWRlbnRpZmllcik7DQogICAgICAgIC8vIE1hcmsgdGhpcyBsaXN0ZW5lciBzbyB3ZSBjYW4gdGVsbCBpZiBpdCdzIHJlbW92ZWQuDQogICAgICAgIGNvbnN0IGxpc3RlbklkID0gUmVhZG9ubHlSZXN0Q2xpZW50LmdldExpc3RlbklkXyhxdWVyeSwgdGFnKTsNCiAgICAgICAgY29uc3QgdGhpc0xpc3RlbiA9IHt9Ow0KICAgICAgICB0aGlzLmxpc3RlbnNfW2xpc3RlbklkXSA9IHRoaXNMaXN0ZW47DQogICAgICAgIGNvbnN0IHF1ZXJ5U3RyaW5nUGFyYW1ldGVycyA9IHF1ZXJ5UGFyYW1zVG9SZXN0UXVlcnlTdHJpbmdQYXJhbWV0ZXJzKHF1ZXJ5Ll9xdWVyeVBhcmFtcyk7DQogICAgICAgIHRoaXMucmVzdFJlcXVlc3RfKHBhdGhTdHJpbmcgKyAnLmpzb24nLCBxdWVyeVN0cmluZ1BhcmFtZXRlcnMsIChlcnJvciwgcmVzdWx0KSA9PiB7DQogICAgICAgICAgICBsZXQgZGF0YSA9IHJlc3VsdDsNCiAgICAgICAgICAgIGlmIChlcnJvciA9PT0gNDA0KSB7DQogICAgICAgICAgICAgICAgZGF0YSA9IG51bGw7DQogICAgICAgICAgICAgICAgZXJyb3IgPSBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGVycm9yID09PSBudWxsKSB7DQogICAgICAgICAgICAgICAgdGhpcy5vbkRhdGFVcGRhdGVfKHBhdGhTdHJpbmcsIGRhdGEsIC8qaXNNZXJnZT0qLyBmYWxzZSwgdGFnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChzYWZlR2V0KHRoaXMubGlzdGVuc18sIGxpc3RlbklkKSA9PT0gdGhpc0xpc3Rlbikgew0KICAgICAgICAgICAgICAgIGxldCBzdGF0dXM7DQogICAgICAgICAgICAgICAgaWYgKCFlcnJvcikgew0KICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSAnb2snOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChlcnJvciA9PT0gNDAxKSB7DQogICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9ICdwZXJtaXNzaW9uX2RlbmllZCc7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSAncmVzdF9lcnJvcjonICsgZXJyb3I7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIG9uQ29tcGxldGUoc3RhdHVzLCBudWxsKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgIHVubGlzdGVuKHF1ZXJ5LCB0YWcpIHsNCiAgICAgICAgY29uc3QgbGlzdGVuSWQgPSBSZWFkb25seVJlc3RDbGllbnQuZ2V0TGlzdGVuSWRfKHF1ZXJ5LCB0YWcpOw0KICAgICAgICBkZWxldGUgdGhpcy5saXN0ZW5zX1tsaXN0ZW5JZF07DQogICAgfQ0KICAgIGdldChxdWVyeSkgew0KICAgICAgICBjb25zdCBxdWVyeVN0cmluZ1BhcmFtZXRlcnMgPSBxdWVyeVBhcmFtc1RvUmVzdFF1ZXJ5U3RyaW5nUGFyYW1ldGVycyhxdWVyeS5fcXVlcnlQYXJhbXMpOw0KICAgICAgICBjb25zdCBwYXRoU3RyaW5nID0gcXVlcnkuX3BhdGgudG9TdHJpbmcoKTsNCiAgICAgICAgY29uc3QgZGVmZXJyZWQgPSBuZXcgRGVmZXJyZWQoKTsNCiAgICAgICAgdGhpcy5yZXN0UmVxdWVzdF8ocGF0aFN0cmluZyArICcuanNvbicsIHF1ZXJ5U3RyaW5nUGFyYW1ldGVycywgKGVycm9yLCByZXN1bHQpID0+IHsNCiAgICAgICAgICAgIGxldCBkYXRhID0gcmVzdWx0Ow0KICAgICAgICAgICAgaWYgKGVycm9yID09PSA0MDQpIHsNCiAgICAgICAgICAgICAgICBkYXRhID0gbnVsbDsNCiAgICAgICAgICAgICAgICBlcnJvciA9IG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZXJyb3IgPT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICB0aGlzLm9uRGF0YVVwZGF0ZV8ocGF0aFN0cmluZywgZGF0YSwgDQogICAgICAgICAgICAgICAgLyppc01lcmdlPSovIGZhbHNlLCANCiAgICAgICAgICAgICAgICAvKnRhZz0qLyBudWxsKTsNCiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KG5ldyBFcnJvcihkYXRhKSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTsNCiAgICB9DQogICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgcmVmcmVzaEF1dGhUb2tlbih0b2tlbikgew0KICAgICAgICAvLyBuby1vcCBzaW5jZSB3ZSBqdXN0IGFsd2F5cyBjYWxsIGdldFRva2VuLg0KICAgIH0NCiAgICAvKioNCiAgICAgKiBQZXJmb3JtcyBhIFJFU1QgcmVxdWVzdCB0byB0aGUgZ2l2ZW4gcGF0aCwgd2l0aCB0aGUgcHJvdmlkZWQgcXVlcnkgc3RyaW5nIHBhcmFtZXRlcnMsDQogICAgICogYW5kIGFueSBhdXRoIGNyZWRlbnRpYWxzIHdlIGhhdmUuDQogICAgICovDQogICAgcmVzdFJlcXVlc3RfKHBhdGhTdHJpbmcsIHF1ZXJ5U3RyaW5nUGFyYW1ldGVycyA9IHt9LCBjYWxsYmFjaykgew0KICAgICAgICBxdWVyeVN0cmluZ1BhcmFtZXRlcnNbJ2Zvcm1hdCddID0gJ2V4cG9ydCc7DQogICAgICAgIHJldHVybiBQcm9taXNlLmFsbChbDQogICAgICAgICAgICB0aGlzLmF1dGhUb2tlblByb3ZpZGVyXy5nZXRUb2tlbigvKmZvcmNlUmVmcmVzaD0qLyBmYWxzZSksDQogICAgICAgICAgICB0aGlzLmFwcENoZWNrVG9rZW5Qcm92aWRlcl8uZ2V0VG9rZW4oLypmb3JjZVJlZnJlc2g9Ki8gZmFsc2UpDQogICAgICAgIF0pLnRoZW4oKFthdXRoVG9rZW4sIGFwcENoZWNrVG9rZW5dKSA9PiB7DQogICAgICAgICAgICBpZiAoYXV0aFRva2VuICYmIGF1dGhUb2tlbi5hY2Nlc3NUb2tlbikgew0KICAgICAgICAgICAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1ldGVyc1snYXV0aCddID0gYXV0aFRva2VuLmFjY2Vzc1Rva2VuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGFwcENoZWNrVG9rZW4gJiYgYXBwQ2hlY2tUb2tlbi50b2tlbikgew0KICAgICAgICAgICAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1ldGVyc1snYWMnXSA9IGFwcENoZWNrVG9rZW4udG9rZW47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCB1cmwgPSAodGhpcy5yZXBvSW5mb18uc2VjdXJlID8gJ2h0dHBzOi8vJyA6ICdodHRwOi8vJykgKw0KICAgICAgICAgICAgICAgIHRoaXMucmVwb0luZm9fLmhvc3QgKw0KICAgICAgICAgICAgICAgIHBhdGhTdHJpbmcgKw0KICAgICAgICAgICAgICAgICc/JyArDQogICAgICAgICAgICAgICAgJ25zPScgKw0KICAgICAgICAgICAgICAgIHRoaXMucmVwb0luZm9fLm5hbWVzcGFjZSArDQogICAgICAgICAgICAgICAgcXVlcnlzdHJpbmckMShxdWVyeVN0cmluZ1BhcmFtZXRlcnMpOw0KICAgICAgICAgICAgdGhpcy5sb2dfKCdTZW5kaW5nIFJFU1QgcmVxdWVzdCBmb3IgJyArIHVybCk7DQogICAgICAgICAgICBjb25zdCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsNCiAgICAgICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICYmIHhoci5yZWFkeVN0YXRlID09PSA0KSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMubG9nXygnUkVTVCBSZXNwb25zZSBmb3IgJyArIHVybCArICcgcmVjZWl2ZWQuIHN0YXR1czonLCB4aHIuc3RhdHVzLCAncmVzcG9uc2U6JywgeGhyLnJlc3BvbnNlVGV4dCk7DQogICAgICAgICAgICAgICAgICAgIGxldCByZXMgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICBpZiAoeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8IDMwMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXMgPSBqc29uRXZhbCh4aHIucmVzcG9uc2VUZXh0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FybignRmFpbGVkIHRvIHBhcnNlIEpTT04gcmVzcG9uc2UgZm9yICcgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnOiAnICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeGhyLnJlc3BvbnNlVGV4dCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXMpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gNDAxIGFuZCA0MDQgYXJlIGV4cGVjdGVkLg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHhoci5zdGF0dXMgIT09IDQwMSAmJiB4aHIuc3RhdHVzICE9PSA0MDQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YXJuKCdHb3QgdW5zdWNjZXNzZnVsIFJFU1QgcmVzcG9uc2UgZm9yICcgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwgKw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIFN0YXR1czogJyArDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhoci5zdGF0dXMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soeGhyLnN0YXR1cyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBudWxsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgICAgICB4aHIub3BlbignR0VUJywgdXJsLCAvKmFzeW5jaHJvbm91cz0qLyB0cnVlKTsNCiAgICAgICAgICAgIHhoci5zZW5kKCk7DQogICAgICAgIH0pOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogTXV0YWJsZSBvYmplY3Qgd2hpY2ggYmFzaWNhbGx5IGp1c3Qgc3RvcmVzIGEgcmVmZXJlbmNlIHRvIHRoZSAibGF0ZXN0IiBpbW11dGFibGUgc25hcHNob3QuDQogKi8NCmNsYXNzIFNuYXBzaG90SG9sZGVyIHsNCiAgICBjb25zdHJ1Y3RvcigpIHsNCiAgICAgICAgdGhpcy5yb290Tm9kZV8gPSBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTsNCiAgICB9DQogICAgZ2V0Tm9kZShwYXRoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJvb3ROb2RlXy5nZXRDaGlsZChwYXRoKTsNCiAgICB9DQogICAgdXBkYXRlU25hcHNob3QocGF0aCwgbmV3U25hcHNob3ROb2RlKSB7DQogICAgICAgIHRoaXMucm9vdE5vZGVfID0gdGhpcy5yb290Tm9kZV8udXBkYXRlQ2hpbGQocGF0aCwgbmV3U25hcHNob3ROb2RlKTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpmdW5jdGlvbiBuZXdTcGFyc2VTbmFwc2hvdFRyZWUoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgICAgdmFsdWU6IG51bGwsDQogICAgICAgIGNoaWxkcmVuOiBuZXcgTWFwKCkNCiAgICB9Ow0KfQ0KLyoqDQogKiBTdG9yZXMgdGhlIGdpdmVuIG5vZGUgYXQgdGhlIHNwZWNpZmllZCBwYXRoLiBJZiB0aGVyZSBpcyBhbHJlYWR5IGEgbm9kZQ0KICogYXQgYSBzaGFsbG93ZXIgcGF0aCwgaXQgbWVyZ2VzIHRoZSBuZXcgZGF0YSBpbnRvIHRoYXQgc25hcHNob3Qgbm9kZS4NCiAqDQogKiBAcGFyYW0gcGF0aCAtIFBhdGggdG8gbG9vayB1cCBzbmFwc2hvdCBmb3IuDQogKiBAcGFyYW0gZGF0YSAtIFRoZSBuZXcgZGF0YSwgb3IgbnVsbC4NCiAqLw0KZnVuY3Rpb24gc3BhcnNlU25hcHNob3RUcmVlUmVtZW1iZXIoc3BhcnNlU25hcHNob3RUcmVlLCBwYXRoLCBkYXRhKSB7DQogICAgaWYgKHBhdGhJc0VtcHR5KHBhdGgpKSB7DQogICAgICAgIHNwYXJzZVNuYXBzaG90VHJlZS52YWx1ZSA9IGRhdGE7DQogICAgICAgIHNwYXJzZVNuYXBzaG90VHJlZS5jaGlsZHJlbi5jbGVhcigpOw0KICAgIH0NCiAgICBlbHNlIGlmIChzcGFyc2VTbmFwc2hvdFRyZWUudmFsdWUgIT09IG51bGwpIHsNCiAgICAgICAgc3BhcnNlU25hcHNob3RUcmVlLnZhbHVlID0gc3BhcnNlU25hcHNob3RUcmVlLnZhbHVlLnVwZGF0ZUNoaWxkKHBhdGgsIGRhdGEpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3QgY2hpbGRLZXkgPSBwYXRoR2V0RnJvbnQocGF0aCk7DQogICAgICAgIGlmICghc3BhcnNlU25hcHNob3RUcmVlLmNoaWxkcmVuLmhhcyhjaGlsZEtleSkpIHsNCiAgICAgICAgICAgIHNwYXJzZVNuYXBzaG90VHJlZS5jaGlsZHJlbi5zZXQoY2hpbGRLZXksIG5ld1NwYXJzZVNuYXBzaG90VHJlZSgpKTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBjaGlsZCA9IHNwYXJzZVNuYXBzaG90VHJlZS5jaGlsZHJlbi5nZXQoY2hpbGRLZXkpOw0KICAgICAgICBwYXRoID0gcGF0aFBvcEZyb250KHBhdGgpOw0KICAgICAgICBzcGFyc2VTbmFwc2hvdFRyZWVSZW1lbWJlcihjaGlsZCwgcGF0aCwgZGF0YSk7DQogICAgfQ0KfQ0KLyoqDQogKiBSZWN1cnNpdmVseSBpdGVyYXRlcyB0aHJvdWdoIGFsbCBvZiB0aGUgc3RvcmVkIHRyZWUgYW5kIGNhbGxzIHRoZQ0KICogY2FsbGJhY2sgb24gZWFjaCBvbmUuDQogKg0KICogQHBhcmFtIHByZWZpeFBhdGggLSBQYXRoIHRvIGxvb2sgdXAgbm9kZSBmb3IuDQogKiBAcGFyYW0gZnVuYyAtIFRoZSBmdW5jdGlvbiB0byBpbnZva2UgZm9yIGVhY2ggdHJlZS4NCiAqLw0KZnVuY3Rpb24gc3BhcnNlU25hcHNob3RUcmVlRm9yRWFjaFRyZWUoc3BhcnNlU25hcHNob3RUcmVlLCBwcmVmaXhQYXRoLCBmdW5jKSB7DQogICAgaWYgKHNwYXJzZVNuYXBzaG90VHJlZS52YWx1ZSAhPT0gbnVsbCkgew0KICAgICAgICBmdW5jKHByZWZpeFBhdGgsIHNwYXJzZVNuYXBzaG90VHJlZS52YWx1ZSk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBzcGFyc2VTbmFwc2hvdFRyZWVGb3JFYWNoQ2hpbGQoc3BhcnNlU25hcHNob3RUcmVlLCAoa2V5LCB0cmVlKSA9PiB7DQogICAgICAgICAgICBjb25zdCBwYXRoID0gbmV3IFBhdGgocHJlZml4UGF0aC50b1N0cmluZygpICsgJy8nICsga2V5KTsNCiAgICAgICAgICAgIHNwYXJzZVNuYXBzaG90VHJlZUZvckVhY2hUcmVlKHRyZWUsIHBhdGgsIGZ1bmMpOw0KICAgICAgICB9KTsNCiAgICB9DQp9DQovKioNCiAqIEl0ZXJhdGVzIHRocm91Z2ggZWFjaCBpbW1lZGlhdGUgY2hpbGQgYW5kIHRyaWdnZXJzIHRoZSBjYWxsYmFjay4NCiAqIE9ubHkgc2VlbXMgdG8gYmUgdXNlZCBpbiB0ZXN0cy4NCiAqDQogKiBAcGFyYW0gZnVuYyAtIFRoZSBmdW5jdGlvbiB0byBpbnZva2UgZm9yIGVhY2ggY2hpbGQuDQogKi8NCmZ1bmN0aW9uIHNwYXJzZVNuYXBzaG90VHJlZUZvckVhY2hDaGlsZChzcGFyc2VTbmFwc2hvdFRyZWUsIGZ1bmMpIHsNCiAgICBzcGFyc2VTbmFwc2hvdFRyZWUuY2hpbGRyZW4uZm9yRWFjaCgodHJlZSwga2V5KSA9PiB7DQogICAgICAgIGZ1bmMoa2V5LCB0cmVlKTsNCiAgICB9KTsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogUmV0dXJucyB0aGUgZGVsdGEgZnJvbSB0aGUgcHJldmlvdXMgY2FsbCB0byBnZXQgc3RhdHMuDQogKg0KICogQHBhcmFtIGNvbGxlY3Rpb25fIC0gVGhlIGNvbGxlY3Rpb24gdG8gImxpc3RlbiIgdG8uDQogKi8NCmNsYXNzIFN0YXRzTGlzdGVuZXIgew0KICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb25fKSB7DQogICAgICAgIHRoaXMuY29sbGVjdGlvbl8gPSBjb2xsZWN0aW9uXzsNCiAgICAgICAgdGhpcy5sYXN0XyA9IG51bGw7DQogICAgfQ0KICAgIGdldCgpIHsNCiAgICAgICAgY29uc3QgbmV3U3RhdHMgPSB0aGlzLmNvbGxlY3Rpb25fLmdldCgpOw0KICAgICAgICBjb25zdCBkZWx0YSA9IE9iamVjdC5hc3NpZ24oe30sIG5ld1N0YXRzKTsNCiAgICAgICAgaWYgKHRoaXMubGFzdF8pIHsNCiAgICAgICAgICAgIGVhY2godGhpcy5sYXN0XywgKHN0YXQsIHZhbHVlKSA9PiB7DQogICAgICAgICAgICAgICAgZGVsdGFbc3RhdF0gPSBkZWx0YVtzdGF0XSAtIHZhbHVlOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5sYXN0XyA9IG5ld1N0YXRzOw0KICAgICAgICByZXR1cm4gZGVsdGE7DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLy8gQXNzdW1pbmcgc29tZSBhcHBzIG1heSBoYXZlIGEgc2hvcnQgYW1vdW50IG9mIHRpbWUgb24gcGFnZSwgYW5kIGEgYnVsayBvZiBmaXJlYmFzZSBvcGVyYXRpb25zIHByb2JhYmx5DQovLyBoYXBwZW4gb24gcGFnZSBsb2FkLCB3ZSB0cnkgdG8gcmVwb3J0IG91ciBmaXJzdCBzZXQgb2Ygc3RhdHMgcHJldHR5IHF1aWNrbHksIGJ1dCB3ZSB3YWl0IGF0IGxlYXN0IDEwDQovLyBzZWNvbmRzIHRvIHRyeSB0byBlbnN1cmUgdGhlIEZpcmViYXNlIGNvbm5lY3Rpb24gaXMgZXN0YWJsaXNoZWQgLyBzZXR0bGVkLg0KY29uc3QgRklSU1RfU1RBVFNfTUlOX1RJTUUgPSAxMCAqIDEwMDA7DQpjb25zdCBGSVJTVF9TVEFUU19NQVhfVElNRSA9IDMwICogMTAwMDsNCi8vIFdlJ2xsIGNvbnRpbnVlIHRvIHJlcG9ydCBzdGF0cyBvbiBhdmVyYWdlIGV2ZXJ5IDUgbWludXRlcy4NCmNvbnN0IFJFUE9SVF9TVEFUU19JTlRFUlZBTCA9IDUgKiA2MCAqIDEwMDA7DQpjbGFzcyBTdGF0c1JlcG9ydGVyIHsNCiAgICBjb25zdHJ1Y3Rvcihjb2xsZWN0aW9uLCBzZXJ2ZXJfKSB7DQogICAgICAgIHRoaXMuc2VydmVyXyA9IHNlcnZlcl87DQogICAgICAgIHRoaXMuc3RhdHNUb1JlcG9ydF8gPSB7fTsNCiAgICAgICAgdGhpcy5zdGF0c0xpc3RlbmVyXyA9IG5ldyBTdGF0c0xpc3RlbmVyKGNvbGxlY3Rpb24pOw0KICAgICAgICBjb25zdCB0aW1lb3V0ID0gRklSU1RfU1RBVFNfTUlOX1RJTUUgKw0KICAgICAgICAgICAgKEZJUlNUX1NUQVRTX01BWF9USU1FIC0gRklSU1RfU1RBVFNfTUlOX1RJTUUpICogTWF0aC5yYW5kb20oKTsNCiAgICAgICAgc2V0VGltZW91dE5vbkJsb2NraW5nKHRoaXMucmVwb3J0U3RhdHNfLmJpbmQodGhpcyksIE1hdGguZmxvb3IodGltZW91dCkpOw0KICAgIH0NCiAgICByZXBvcnRTdGF0c18oKSB7DQogICAgICAgIGNvbnN0IHN0YXRzID0gdGhpcy5zdGF0c0xpc3RlbmVyXy5nZXQoKTsNCiAgICAgICAgY29uc3QgcmVwb3J0ZWRTdGF0cyA9IHt9Ow0KICAgICAgICBsZXQgaGF2ZVN0YXRzVG9SZXBvcnQgPSBmYWxzZTsNCiAgICAgICAgZWFjaChzdGF0cywgKHN0YXQsIHZhbHVlKSA9PiB7DQogICAgICAgICAgICBpZiAodmFsdWUgPiAwICYmIGNvbnRhaW5zKHRoaXMuc3RhdHNUb1JlcG9ydF8sIHN0YXQpKSB7DQogICAgICAgICAgICAgICAgcmVwb3J0ZWRTdGF0c1tzdGF0XSA9IHZhbHVlOw0KICAgICAgICAgICAgICAgIGhhdmVTdGF0c1RvUmVwb3J0ID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIGlmIChoYXZlU3RhdHNUb1JlcG9ydCkgew0KICAgICAgICAgICAgdGhpcy5zZXJ2ZXJfLnJlcG9ydFN0YXRzKHJlcG9ydGVkU3RhdHMpOw0KICAgICAgICB9DQogICAgICAgIC8vIHF1ZXVlIG91ciBuZXh0IHJ1bi4NCiAgICAgICAgc2V0VGltZW91dE5vbkJsb2NraW5nKHRoaXMucmVwb3J0U3RhdHNfLmJpbmQodGhpcyksIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIgKiBSRVBPUlRfU1RBVFNfSU5URVJWQUwpKTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqDQogKiBAZW51bQ0KICovDQp2YXIgT3BlcmF0aW9uVHlwZTsNCihmdW5jdGlvbiAoT3BlcmF0aW9uVHlwZSkgew0KICAgIE9wZXJhdGlvblR5cGVbT3BlcmF0aW9uVHlwZVsiT1ZFUldSSVRFIl0gPSAwXSA9ICJPVkVSV1JJVEUiOw0KICAgIE9wZXJhdGlvblR5cGVbT3BlcmF0aW9uVHlwZVsiTUVSR0UiXSA9IDFdID0gIk1FUkdFIjsNCiAgICBPcGVyYXRpb25UeXBlW09wZXJhdGlvblR5cGVbIkFDS19VU0VSX1dSSVRFIl0gPSAyXSA9ICJBQ0tfVVNFUl9XUklURSI7DQogICAgT3BlcmF0aW9uVHlwZVtPcGVyYXRpb25UeXBlWyJMSVNURU5fQ09NUExFVEUiXSA9IDNdID0gIkxJU1RFTl9DT01QTEVURSI7DQp9KShPcGVyYXRpb25UeXBlIHx8IChPcGVyYXRpb25UeXBlID0ge30pKTsNCmZ1bmN0aW9uIG5ld09wZXJhdGlvblNvdXJjZVVzZXIoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgICAgZnJvbVVzZXI6IHRydWUsDQogICAgICAgIGZyb21TZXJ2ZXI6IGZhbHNlLA0KICAgICAgICBxdWVyeUlkOiBudWxsLA0KICAgICAgICB0YWdnZWQ6IGZhbHNlDQogICAgfTsNCn0NCmZ1bmN0aW9uIG5ld09wZXJhdGlvblNvdXJjZVNlcnZlcigpIHsNCiAgICByZXR1cm4gew0KICAgICAgICBmcm9tVXNlcjogZmFsc2UsDQogICAgICAgIGZyb21TZXJ2ZXI6IHRydWUsDQogICAgICAgIHF1ZXJ5SWQ6IG51bGwsDQogICAgICAgIHRhZ2dlZDogZmFsc2UNCiAgICB9Ow0KfQ0KZnVuY3Rpb24gbmV3T3BlcmF0aW9uU291cmNlU2VydmVyVGFnZ2VkUXVlcnkocXVlcnlJZCkgew0KICAgIHJldHVybiB7DQogICAgICAgIGZyb21Vc2VyOiBmYWxzZSwNCiAgICAgICAgZnJvbVNlcnZlcjogdHJ1ZSwNCiAgICAgICAgcXVlcnlJZCwNCiAgICAgICAgdGFnZ2VkOiB0cnVlDQogICAgfTsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNsYXNzIEFja1VzZXJXcml0ZSB7DQogICAgLyoqDQogICAgICogQHBhcmFtIGFmZmVjdGVkVHJlZSAtIEEgdHJlZSBjb250YWluaW5nIHRydWUgZm9yIGVhY2ggYWZmZWN0ZWQgcGF0aC4gQWZmZWN0ZWQgcGF0aHMgY2FuJ3Qgb3ZlcmxhcC4NCiAgICAgKi8NCiAgICBjb25zdHJ1Y3RvcigNCiAgICAvKiogQGluaGVyaXREb2MgKi8gcGF0aCwgDQogICAgLyoqIEBpbmhlcml0RG9jICovIGFmZmVjdGVkVHJlZSwgDQogICAgLyoqIEBpbmhlcml0RG9jICovIHJldmVydCkgew0KICAgICAgICB0aGlzLnBhdGggPSBwYXRoOw0KICAgICAgICB0aGlzLmFmZmVjdGVkVHJlZSA9IGFmZmVjdGVkVHJlZTsNCiAgICAgICAgdGhpcy5yZXZlcnQgPSByZXZlcnQ7DQogICAgICAgIC8qKiBAaW5oZXJpdERvYyAqLw0KICAgICAgICB0aGlzLnR5cGUgPSBPcGVyYXRpb25UeXBlLkFDS19VU0VSX1dSSVRFOw0KICAgICAgICAvKiogQGluaGVyaXREb2MgKi8NCiAgICAgICAgdGhpcy5zb3VyY2UgPSBuZXdPcGVyYXRpb25Tb3VyY2VVc2VyKCk7DQogICAgfQ0KICAgIG9wZXJhdGlvbkZvckNoaWxkKGNoaWxkTmFtZSkgew0KICAgICAgICBpZiAoIXBhdGhJc0VtcHR5KHRoaXMucGF0aCkpIHsNCiAgICAgICAgICAgIGFzc2VydChwYXRoR2V0RnJvbnQodGhpcy5wYXRoKSA9PT0gY2hpbGROYW1lLCAnb3BlcmF0aW9uRm9yQ2hpbGQgY2FsbGVkIGZvciB1bnJlbGF0ZWQgY2hpbGQuJyk7DQogICAgICAgICAgICByZXR1cm4gbmV3IEFja1VzZXJXcml0ZShwYXRoUG9wRnJvbnQodGhpcy5wYXRoKSwgdGhpcy5hZmZlY3RlZFRyZWUsIHRoaXMucmV2ZXJ0KTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmICh0aGlzLmFmZmVjdGVkVHJlZS52YWx1ZSAhPSBudWxsKSB7DQogICAgICAgICAgICBhc3NlcnQodGhpcy5hZmZlY3RlZFRyZWUuY2hpbGRyZW4uaXNFbXB0eSgpLCAnYWZmZWN0ZWRUcmVlIHNob3VsZCBub3QgaGF2ZSBvdmVybGFwcGluZyBhZmZlY3RlZCBwYXRocy4nKTsNCiAgICAgICAgICAgIC8vIEFsbCBjaGlsZCBsb2NhdGlvbnMgYXJlIGFmZmVjdGVkIGFzIHdlbGw7IGp1c3QgcmV0dXJuIHNhbWUgb3BlcmF0aW9uLg0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBjb25zdCBjaGlsZFRyZWUgPSB0aGlzLmFmZmVjdGVkVHJlZS5zdWJ0cmVlKG5ldyBQYXRoKGNoaWxkTmFtZSkpOw0KICAgICAgICAgICAgcmV0dXJuIG5ldyBBY2tVc2VyV3JpdGUobmV3RW1wdHlQYXRoKCksIGNoaWxkVHJlZSwgdGhpcy5yZXZlcnQpOw0KICAgICAgICB9DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY2xhc3MgTGlzdGVuQ29tcGxldGUgew0KICAgIGNvbnN0cnVjdG9yKHNvdXJjZSwgcGF0aCkgew0KICAgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTsNCiAgICAgICAgdGhpcy5wYXRoID0gcGF0aDsNCiAgICAgICAgLyoqIEBpbmhlcml0RG9jICovDQogICAgICAgIHRoaXMudHlwZSA9IE9wZXJhdGlvblR5cGUuTElTVEVOX0NPTVBMRVRFOw0KICAgIH0NCiAgICBvcGVyYXRpb25Gb3JDaGlsZChjaGlsZE5hbWUpIHsNCiAgICAgICAgaWYgKHBhdGhJc0VtcHR5KHRoaXMucGF0aCkpIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgTGlzdGVuQ29tcGxldGUodGhpcy5zb3VyY2UsIG5ld0VtcHR5UGF0aCgpKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgTGlzdGVuQ29tcGxldGUodGhpcy5zb3VyY2UsIHBhdGhQb3BGcm9udCh0aGlzLnBhdGgpKTsNCiAgICAgICAgfQ0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNsYXNzIE92ZXJ3cml0ZSB7DQogICAgY29uc3RydWN0b3Ioc291cmNlLCBwYXRoLCBzbmFwKSB7DQogICAgICAgIHRoaXMuc291cmNlID0gc291cmNlOw0KICAgICAgICB0aGlzLnBhdGggPSBwYXRoOw0KICAgICAgICB0aGlzLnNuYXAgPSBzbmFwOw0KICAgICAgICAvKiogQGluaGVyaXREb2MgKi8NCiAgICAgICAgdGhpcy50eXBlID0gT3BlcmF0aW9uVHlwZS5PVkVSV1JJVEU7DQogICAgfQ0KICAgIG9wZXJhdGlvbkZvckNoaWxkKGNoaWxkTmFtZSkgew0KICAgICAgICBpZiAocGF0aElzRW1wdHkodGhpcy5wYXRoKSkgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBPdmVyd3JpdGUodGhpcy5zb3VyY2UsIG5ld0VtcHR5UGF0aCgpLCB0aGlzLnNuYXAuZ2V0SW1tZWRpYXRlQ2hpbGQoY2hpbGROYW1lKSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gbmV3IE92ZXJ3cml0ZSh0aGlzLnNvdXJjZSwgcGF0aFBvcEZyb250KHRoaXMucGF0aCksIHRoaXMuc25hcCk7DQogICAgICAgIH0NCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBNZXJnZSB7DQogICAgY29uc3RydWN0b3IoDQogICAgLyoqIEBpbmhlcml0RG9jICovIHNvdXJjZSwgDQogICAgLyoqIEBpbmhlcml0RG9jICovIHBhdGgsIA0KICAgIC8qKiBAaW5oZXJpdERvYyAqLyBjaGlsZHJlbikgew0KICAgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTsNCiAgICAgICAgdGhpcy5wYXRoID0gcGF0aDsNCiAgICAgICAgdGhpcy5jaGlsZHJlbiA9IGNoaWxkcmVuOw0KICAgICAgICAvKiogQGluaGVyaXREb2MgKi8NCiAgICAgICAgdGhpcy50eXBlID0gT3BlcmF0aW9uVHlwZS5NRVJHRTsNCiAgICB9DQogICAgb3BlcmF0aW9uRm9yQ2hpbGQoY2hpbGROYW1lKSB7DQogICAgICAgIGlmIChwYXRoSXNFbXB0eSh0aGlzLnBhdGgpKSB7DQogICAgICAgICAgICBjb25zdCBjaGlsZFRyZWUgPSB0aGlzLmNoaWxkcmVuLnN1YnRyZWUobmV3IFBhdGgoY2hpbGROYW1lKSk7DQogICAgICAgICAgICBpZiAoY2hpbGRUcmVlLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgICAgIC8vIFRoaXMgY2hpbGQgaXMgdW5hZmZlY3RlZA0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoY2hpbGRUcmVlLnZhbHVlKSB7DQogICAgICAgICAgICAgICAgLy8gV2UgaGF2ZSBhIHNuYXBzaG90IGZvciB0aGUgY2hpbGQgaW4gcXVlc3Rpb24uICBUaGlzIGJlY29tZXMgYW4gb3ZlcndyaXRlIG9mIHRoZSBjaGlsZC4NCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE92ZXJ3cml0ZSh0aGlzLnNvdXJjZSwgbmV3RW1wdHlQYXRoKCksIGNoaWxkVHJlZS52YWx1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGEgbWVyZ2UgYXQgYSBkZWVwZXIgbGV2ZWwNCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE1lcmdlKHRoaXMuc291cmNlLCBuZXdFbXB0eVBhdGgoKSwgY2hpbGRUcmVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGFzc2VydChwYXRoR2V0RnJvbnQodGhpcy5wYXRoKSA9PT0gY2hpbGROYW1lLCAiQ2FuJ3QgZ2V0IGEgbWVyZ2UgZm9yIGEgY2hpbGQgbm90IG9uIHRoZSBwYXRoIG9mIHRoZSBvcGVyYXRpb24iKTsNCiAgICAgICAgICAgIHJldHVybiBuZXcgTWVyZ2UodGhpcy5zb3VyY2UsIHBhdGhQb3BGcm9udCh0aGlzLnBhdGgpLCB0aGlzLmNoaWxkcmVuKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICB0b1N0cmluZygpIHsNCiAgICAgICAgcmV0dXJuICgnT3BlcmF0aW9uKCcgKw0KICAgICAgICAgICAgdGhpcy5wYXRoICsNCiAgICAgICAgICAgICc6ICcgKw0KICAgICAgICAgICAgdGhpcy5zb3VyY2UudG9TdHJpbmcoKSArDQogICAgICAgICAgICAnIG1lcmdlOiAnICsNCiAgICAgICAgICAgIHRoaXMuY2hpbGRyZW4udG9TdHJpbmcoKSArDQogICAgICAgICAgICAnKScpOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogQSBjYWNoZSBub2RlIG9ubHkgc3RvcmVzIGNvbXBsZXRlIGNoaWxkcmVuLiBBZGRpdGlvbmFsbHkgaXQgaG9sZHMgYSBmbGFnIHdoZXRoZXIgdGhlIG5vZGUgY2FuIGJlIGNvbnNpZGVyZWQgZnVsbHkNCiAqIGluaXRpYWxpemVkIGluIHRoZSBzZW5zZSB0aGF0IHdlIGtub3cgYXQgb25lIHBvaW50IGluIHRpbWUgdGhpcyByZXByZXNlbnRlZCBhIHZhbGlkIHN0YXRlIG9mIHRoZSB3b3JsZCwgZS5nLg0KICogaW5pdGlhbGl6ZWQgd2l0aCBkYXRhIGZyb20gdGhlIHNlcnZlciwgb3IgYSBjb21wbGV0ZSBvdmVyd3JpdGUgYnkgdGhlIGNsaWVudC4gVGhlIGZpbHRlcmVkIGZsYWcgYWxzbyB0cmFja3MNCiAqIHdoZXRoZXIgYSBub2RlIHBvdGVudGlhbGx5IGhhZCBjaGlsZHJlbiByZW1vdmVkIGR1ZSB0byBhIGZpbHRlci4NCiAqLw0KY2xhc3MgQ2FjaGVOb2RlIHsNCiAgICBjb25zdHJ1Y3Rvcihub2RlXywgZnVsbHlJbml0aWFsaXplZF8sIGZpbHRlcmVkXykgew0KICAgICAgICB0aGlzLm5vZGVfID0gbm9kZV87DQogICAgICAgIHRoaXMuZnVsbHlJbml0aWFsaXplZF8gPSBmdWxseUluaXRpYWxpemVkXzsNCiAgICAgICAgdGhpcy5maWx0ZXJlZF8gPSBmaWx0ZXJlZF87DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJldHVybnMgd2hldGhlciB0aGlzIG5vZGUgd2FzIGZ1bGx5IGluaXRpYWxpemVkIHdpdGggZWl0aGVyIHNlcnZlciBkYXRhIG9yIGEgY29tcGxldGUgb3ZlcndyaXRlIGJ5IHRoZSBjbGllbnQNCiAgICAgKi8NCiAgICBpc0Z1bGx5SW5pdGlhbGl6ZWQoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmZ1bGx5SW5pdGlhbGl6ZWRfOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhpcyBub2RlIGlzIHBvdGVudGlhbGx5IG1pc3NpbmcgY2hpbGRyZW4gZHVlIHRvIGEgZmlsdGVyIGFwcGxpZWQgdG8gdGhlIG5vZGUNCiAgICAgKi8NCiAgICBpc0ZpbHRlcmVkKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXJlZF87DQogICAgfQ0KICAgIGlzQ29tcGxldGVGb3JQYXRoKHBhdGgpIHsNCiAgICAgICAgaWYgKHBhdGhJc0VtcHR5KHBhdGgpKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSAmJiAhdGhpcy5maWx0ZXJlZF87DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgY2hpbGRLZXkgPSBwYXRoR2V0RnJvbnQocGF0aCk7DQogICAgICAgIHJldHVybiB0aGlzLmlzQ29tcGxldGVGb3JDaGlsZChjaGlsZEtleSk7DQogICAgfQ0KICAgIGlzQ29tcGxldGVGb3JDaGlsZChrZXkpIHsNCiAgICAgICAgcmV0dXJuICgodGhpcy5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSAmJiAhdGhpcy5maWx0ZXJlZF8pIHx8IHRoaXMubm9kZV8uaGFzQ2hpbGQoa2V5KSk7DQogICAgfQ0KICAgIGdldE5vZGUoKSB7DQogICAgICAgIHJldHVybiB0aGlzLm5vZGVfOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogQW4gRXZlbnRHZW5lcmF0b3IgaXMgdXNlZCB0byBjb252ZXJ0ICJyYXciIGNoYW5nZXMgKENoYW5nZSkgYXMgY29tcHV0ZWQgYnkgdGhlDQogKiBDYWNoZURpZmZlciBpbnRvIGFjdHVhbCBldmVudHMgKEV2ZW50KSB0aGF0IGNhbiBiZSByYWlzZWQuICBTZWUgZ2VuZXJhdGVFdmVudHNGb3JDaGFuZ2VzKCkNCiAqIGZvciBkZXRhaWxzLg0KICoNCiAqLw0KY2xhc3MgRXZlbnRHZW5lcmF0b3Igew0KICAgIGNvbnN0cnVjdG9yKHF1ZXJ5Xykgew0KICAgICAgICB0aGlzLnF1ZXJ5XyA9IHF1ZXJ5XzsNCiAgICAgICAgdGhpcy5pbmRleF8gPSB0aGlzLnF1ZXJ5Xy5fcXVlcnlQYXJhbXMuZ2V0SW5kZXgoKTsNCiAgICB9DQp9DQovKioNCiAqIEdpdmVuIGEgc2V0IG9mIHJhdyBjaGFuZ2VzIChubyBtb3ZlZCBldmVudHMgYW5kIHByZXZOYW1lIG5vdCBzcGVjaWZpZWQgeWV0KSwgYW5kIGEgc2V0IG9mDQogKiBFdmVudFJlZ2lzdHJhdGlvbnMgdGhhdCBzaG91bGQgYmUgbm90aWZpZWQgb2YgdGhlc2UgY2hhbmdlcywgZ2VuZXJhdGUgdGhlIGFjdHVhbCBldmVudHMgdG8gYmUgcmFpc2VkLg0KICoNCiAqIE5vdGVzOg0KICogIC0gY2hpbGRfbW92ZWQgZXZlbnRzIHdpbGwgYmUgc3ludGhlc2l6ZWQgYXQgdGhpcyB0aW1lIGZvciBhbnkgY2hpbGRfY2hhbmdlZCBldmVudHMgdGhhdCBhZmZlY3QNCiAqICAgIG91ciBpbmRleC4NCiAqICAtIHByZXZOYW1lIHdpbGwgYmUgY2FsY3VsYXRlZCBiYXNlZCBvbiB0aGUgaW5kZXggb3JkZXJpbmcuDQogKi8NCmZ1bmN0aW9uIGV2ZW50R2VuZXJhdG9yR2VuZXJhdGVFdmVudHNGb3JDaGFuZ2VzKGV2ZW50R2VuZXJhdG9yLCBjaGFuZ2VzLCBldmVudENhY2hlLCBldmVudFJlZ2lzdHJhdGlvbnMpIHsNCiAgICBjb25zdCBldmVudHMgPSBbXTsNCiAgICBjb25zdCBtb3ZlcyA9IFtdOw0KICAgIGNoYW5nZXMuZm9yRWFjaChjaGFuZ2UgPT4gew0KICAgICAgICBpZiAoY2hhbmdlLnR5cGUgPT09ICJjaGlsZF9jaGFuZ2VkIiAvKiBDaGFuZ2VUeXBlLkNISUxEX0NIQU5HRUQgKi8gJiYNCiAgICAgICAgICAgIGV2ZW50R2VuZXJhdG9yLmluZGV4Xy5pbmRleGVkVmFsdWVDaGFuZ2VkKGNoYW5nZS5vbGRTbmFwLCBjaGFuZ2Uuc25hcHNob3ROb2RlKSkgew0KICAgICAgICAgICAgbW92ZXMucHVzaChjaGFuZ2VDaGlsZE1vdmVkKGNoYW5nZS5jaGlsZE5hbWUsIGNoYW5nZS5zbmFwc2hvdE5vZGUpKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIGV2ZW50R2VuZXJhdG9yR2VuZXJhdGVFdmVudHNGb3JUeXBlKGV2ZW50R2VuZXJhdG9yLCBldmVudHMsICJjaGlsZF9yZW1vdmVkIiAvKiBDaGFuZ2VUeXBlLkNISUxEX1JFTU9WRUQgKi8sIGNoYW5nZXMsIGV2ZW50UmVnaXN0cmF0aW9ucywgZXZlbnRDYWNoZSk7DQogICAgZXZlbnRHZW5lcmF0b3JHZW5lcmF0ZUV2ZW50c0ZvclR5cGUoZXZlbnRHZW5lcmF0b3IsIGV2ZW50cywgImNoaWxkX2FkZGVkIiAvKiBDaGFuZ2VUeXBlLkNISUxEX0FEREVEICovLCBjaGFuZ2VzLCBldmVudFJlZ2lzdHJhdGlvbnMsIGV2ZW50Q2FjaGUpOw0KICAgIGV2ZW50R2VuZXJhdG9yR2VuZXJhdGVFdmVudHNGb3JUeXBlKGV2ZW50R2VuZXJhdG9yLCBldmVudHMsICJjaGlsZF9tb3ZlZCIgLyogQ2hhbmdlVHlwZS5DSElMRF9NT1ZFRCAqLywgbW92ZXMsIGV2ZW50UmVnaXN0cmF0aW9ucywgZXZlbnRDYWNoZSk7DQogICAgZXZlbnRHZW5lcmF0b3JHZW5lcmF0ZUV2ZW50c0ZvclR5cGUoZXZlbnRHZW5lcmF0b3IsIGV2ZW50cywgImNoaWxkX2NoYW5nZWQiIC8qIENoYW5nZVR5cGUuQ0hJTERfQ0hBTkdFRCAqLywgY2hhbmdlcywgZXZlbnRSZWdpc3RyYXRpb25zLCBldmVudENhY2hlKTsNCiAgICBldmVudEdlbmVyYXRvckdlbmVyYXRlRXZlbnRzRm9yVHlwZShldmVudEdlbmVyYXRvciwgZXZlbnRzLCAidmFsdWUiIC8qIENoYW5nZVR5cGUuVkFMVUUgKi8sIGNoYW5nZXMsIGV2ZW50UmVnaXN0cmF0aW9ucywgZXZlbnRDYWNoZSk7DQogICAgcmV0dXJuIGV2ZW50czsNCn0NCi8qKg0KICogR2l2ZW4gY2hhbmdlcyBvZiBhIHNpbmdsZSBjaGFuZ2UgdHlwZSwgZ2VuZXJhdGUgdGhlIGNvcnJlc3BvbmRpbmcgZXZlbnRzLg0KICovDQpmdW5jdGlvbiBldmVudEdlbmVyYXRvckdlbmVyYXRlRXZlbnRzRm9yVHlwZShldmVudEdlbmVyYXRvciwgZXZlbnRzLCBldmVudFR5cGUsIGNoYW5nZXMsIHJlZ2lzdHJhdGlvbnMsIGV2ZW50Q2FjaGUpIHsNCiAgICBjb25zdCBmaWx0ZXJlZENoYW5nZXMgPSBjaGFuZ2VzLmZpbHRlcihjaGFuZ2UgPT4gY2hhbmdlLnR5cGUgPT09IGV2ZW50VHlwZSk7DQogICAgZmlsdGVyZWRDaGFuZ2VzLnNvcnQoKGEsIGIpID0+IGV2ZW50R2VuZXJhdG9yQ29tcGFyZUNoYW5nZXMoZXZlbnRHZW5lcmF0b3IsIGEsIGIpKTsNCiAgICBmaWx0ZXJlZENoYW5nZXMuZm9yRWFjaChjaGFuZ2UgPT4gew0KICAgICAgICBjb25zdCBtYXRlcmlhbGl6ZWRDaGFuZ2UgPSBldmVudEdlbmVyYXRvck1hdGVyaWFsaXplU2luZ2xlQ2hhbmdlKGV2ZW50R2VuZXJhdG9yLCBjaGFuZ2UsIGV2ZW50Q2FjaGUpOw0KICAgICAgICByZWdpc3RyYXRpb25zLmZvckVhY2gocmVnaXN0cmF0aW9uID0+IHsNCiAgICAgICAgICAgIGlmIChyZWdpc3RyYXRpb24ucmVzcG9uZHNUbyhjaGFuZ2UudHlwZSkpIHsNCiAgICAgICAgICAgICAgICBldmVudHMucHVzaChyZWdpc3RyYXRpb24uY3JlYXRlRXZlbnQobWF0ZXJpYWxpemVkQ2hhbmdlLCBldmVudEdlbmVyYXRvci5xdWVyeV8pKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfSk7DQp9DQpmdW5jdGlvbiBldmVudEdlbmVyYXRvck1hdGVyaWFsaXplU2luZ2xlQ2hhbmdlKGV2ZW50R2VuZXJhdG9yLCBjaGFuZ2UsIGV2ZW50Q2FjaGUpIHsNCiAgICBpZiAoY2hhbmdlLnR5cGUgPT09ICd2YWx1ZScgfHwgY2hhbmdlLnR5cGUgPT09ICdjaGlsZF9yZW1vdmVkJykgew0KICAgICAgICByZXR1cm4gY2hhbmdlOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgY2hhbmdlLnByZXZOYW1lID0gZXZlbnRDYWNoZS5nZXRQcmVkZWNlc3NvckNoaWxkTmFtZShjaGFuZ2UuY2hpbGROYW1lLCBjaGFuZ2Uuc25hcHNob3ROb2RlLCBldmVudEdlbmVyYXRvci5pbmRleF8pOw0KICAgICAgICByZXR1cm4gY2hhbmdlOw0KICAgIH0NCn0NCmZ1bmN0aW9uIGV2ZW50R2VuZXJhdG9yQ29tcGFyZUNoYW5nZXMoZXZlbnRHZW5lcmF0b3IsIGEsIGIpIHsNCiAgICBpZiAoYS5jaGlsZE5hbWUgPT0gbnVsbCB8fCBiLmNoaWxkTmFtZSA9PSBudWxsKSB7DQogICAgICAgIHRocm93IGFzc2VydGlvbkVycm9yKCdTaG91bGQgb25seSBjb21wYXJlIGNoaWxkXyBldmVudHMuJyk7DQogICAgfQ0KICAgIGNvbnN0IGFXcmFwcGVkID0gbmV3IE5hbWVkTm9kZShhLmNoaWxkTmFtZSwgYS5zbmFwc2hvdE5vZGUpOw0KICAgIGNvbnN0IGJXcmFwcGVkID0gbmV3IE5hbWVkTm9kZShiLmNoaWxkTmFtZSwgYi5zbmFwc2hvdE5vZGUpOw0KICAgIHJldHVybiBldmVudEdlbmVyYXRvci5pbmRleF8uY29tcGFyZShhV3JhcHBlZCwgYldyYXBwZWQpOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KZnVuY3Rpb24gbmV3Vmlld0NhY2hlKGV2ZW50Q2FjaGUsIHNlcnZlckNhY2hlKSB7DQogICAgcmV0dXJuIHsgZXZlbnRDYWNoZSwgc2VydmVyQ2FjaGUgfTsNCn0NCmZ1bmN0aW9uIHZpZXdDYWNoZVVwZGF0ZUV2ZW50U25hcCh2aWV3Q2FjaGUsIGV2ZW50U25hcCwgY29tcGxldGUsIGZpbHRlcmVkKSB7DQogICAgcmV0dXJuIG5ld1ZpZXdDYWNoZShuZXcgQ2FjaGVOb2RlKGV2ZW50U25hcCwgY29tcGxldGUsIGZpbHRlcmVkKSwgdmlld0NhY2hlLnNlcnZlckNhY2hlKTsNCn0NCmZ1bmN0aW9uIHZpZXdDYWNoZVVwZGF0ZVNlcnZlclNuYXAodmlld0NhY2hlLCBzZXJ2ZXJTbmFwLCBjb21wbGV0ZSwgZmlsdGVyZWQpIHsNCiAgICByZXR1cm4gbmV3Vmlld0NhY2hlKHZpZXdDYWNoZS5ldmVudENhY2hlLCBuZXcgQ2FjaGVOb2RlKHNlcnZlclNuYXAsIGNvbXBsZXRlLCBmaWx0ZXJlZCkpOw0KfQ0KZnVuY3Rpb24gdmlld0NhY2hlR2V0Q29tcGxldGVFdmVudFNuYXAodmlld0NhY2hlKSB7DQogICAgcmV0dXJuIHZpZXdDYWNoZS5ldmVudENhY2hlLmlzRnVsbHlJbml0aWFsaXplZCgpDQogICAgICAgID8gdmlld0NhY2hlLmV2ZW50Q2FjaGUuZ2V0Tm9kZSgpDQogICAgICAgIDogbnVsbDsNCn0NCmZ1bmN0aW9uIHZpZXdDYWNoZUdldENvbXBsZXRlU2VydmVyU25hcCh2aWV3Q2FjaGUpIHsNCiAgICByZXR1cm4gdmlld0NhY2hlLnNlcnZlckNhY2hlLmlzRnVsbHlJbml0aWFsaXplZCgpDQogICAgICAgID8gdmlld0NhY2hlLnNlcnZlckNhY2hlLmdldE5vZGUoKQ0KICAgICAgICA6IG51bGw7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpsZXQgZW1wdHlDaGlsZHJlblNpbmdsZXRvbjsNCi8qKg0KICogU2luZ2xldG9uIGVtcHR5IGNoaWxkcmVuIGNvbGxlY3Rpb24uDQogKg0KICovDQpjb25zdCBFbXB0eUNoaWxkcmVuID0gKCkgPT4gew0KICAgIGlmICghZW1wdHlDaGlsZHJlblNpbmdsZXRvbikgew0KICAgICAgICBlbXB0eUNoaWxkcmVuU2luZ2xldG9uID0gbmV3IFNvcnRlZE1hcChzdHJpbmdDb21wYXJlKTsNCiAgICB9DQogICAgcmV0dXJuIGVtcHR5Q2hpbGRyZW5TaW5nbGV0b247DQp9Ow0KLyoqDQogKiBBIHRyZWUgd2l0aCBpbW11dGFibGUgZWxlbWVudHMuDQogKi8NCmNsYXNzIEltbXV0YWJsZVRyZWUgew0KICAgIGNvbnN0cnVjdG9yKHZhbHVlLCBjaGlsZHJlbiA9IEVtcHR5Q2hpbGRyZW4oKSkgew0KICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7DQogICAgICAgIHRoaXMuY2hpbGRyZW4gPSBjaGlsZHJlbjsNCiAgICB9DQogICAgc3RhdGljIGZyb21PYmplY3Qob2JqKSB7DQogICAgICAgIGxldCB0cmVlID0gbmV3IEltbXV0YWJsZVRyZWUobnVsbCk7DQogICAgICAgIGVhY2gob2JqLCAoY2hpbGRQYXRoLCBjaGlsZFNuYXApID0+IHsNCiAgICAgICAgICAgIHRyZWUgPSB0cmVlLnNldChuZXcgUGF0aChjaGlsZFBhdGgpLCBjaGlsZFNuYXApOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIHRyZWU7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFRydWUgaWYgdGhlIHZhbHVlIGlzIGVtcHR5IGFuZCB0aGVyZSBhcmUgbm8gY2hpbGRyZW4NCiAgICAgKi8NCiAgICBpc0VtcHR5KCkgew0KICAgICAgICByZXR1cm4gdGhpcy52YWx1ZSA9PT0gbnVsbCAmJiB0aGlzLmNoaWxkcmVuLmlzRW1wdHkoKTsNCiAgICB9DQogICAgLyoqDQogICAgICogR2l2ZW4gYSBwYXRoIGFuZCBwcmVkaWNhdGUsIHJldHVybiB0aGUgZmlyc3Qgbm9kZSBhbmQgdGhlIHBhdGggdG8gdGhhdCBub2RlDQogICAgICogd2hlcmUgdGhlIHByZWRpY2F0ZSByZXR1cm5zIHRydWUuDQogICAgICoNCiAgICAgKiBUT0RPIERvIGEgcGVyZiB0ZXN0IC0tIElmIHdlJ3JlIGNyZWF0aW5nIGEgYnVuY2ggb2YgYHtwYXRoOiB2YWx1ZTp9YA0KICAgICAqIG9iamVjdHMgb24gdGhlIHdheSBiYWNrIG91dCwgaXQgbWF5IGJlIGJldHRlciB0byBwYXNzIGRvd24gYSBwYXRoU29GYXIgb2JqLg0KICAgICAqDQogICAgICogQHBhcmFtIHJlbGF0aXZlUGF0aCAtIFRoZSByZW1haW5kZXIgb2YgdGhlIHBhdGgNCiAgICAgKiBAcGFyYW0gcHJlZGljYXRlIC0gVGhlIHByZWRpY2F0ZSB0byBzYXRpc2Z5IHRvIHJldHVybiBhIG5vZGUNCiAgICAgKi8NCiAgICBmaW5kUm9vdE1vc3RNYXRjaGluZ1BhdGhBbmRWYWx1ZShyZWxhdGl2ZVBhdGgsIHByZWRpY2F0ZSkgew0KICAgICAgICBpZiAodGhpcy52YWx1ZSAhPSBudWxsICYmIHByZWRpY2F0ZSh0aGlzLnZhbHVlKSkgew0KICAgICAgICAgICAgcmV0dXJuIHsgcGF0aDogbmV3RW1wdHlQYXRoKCksIHZhbHVlOiB0aGlzLnZhbHVlIH07DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBpZiAocGF0aElzRW1wdHkocmVsYXRpdmVQYXRoKSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc3QgZnJvbnQgPSBwYXRoR2V0RnJvbnQocmVsYXRpdmVQYXRoKTsNCiAgICAgICAgICAgICAgICBjb25zdCBjaGlsZCA9IHRoaXMuY2hpbGRyZW4uZ2V0KGZyb250KTsNCiAgICAgICAgICAgICAgICBpZiAoY2hpbGQgIT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGRFeGlzdGluZ1BhdGhBbmRWYWx1ZSA9IGNoaWxkLmZpbmRSb290TW9zdE1hdGNoaW5nUGF0aEFuZFZhbHVlKHBhdGhQb3BGcm9udChyZWxhdGl2ZVBhdGgpLCBwcmVkaWNhdGUpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGRFeGlzdGluZ1BhdGhBbmRWYWx1ZSAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmdWxsUGF0aCA9IHBhdGhDaGlsZChuZXcgUGF0aChmcm9udCksIGNoaWxkRXhpc3RpbmdQYXRoQW5kVmFsdWUucGF0aCk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBwYXRoOiBmdWxsUGF0aCwgdmFsdWU6IGNoaWxkRXhpc3RpbmdQYXRoQW5kVmFsdWUudmFsdWUgfTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogRmluZCwgaWYgaXQgZXhpc3RzLCB0aGUgc2hvcnRlc3Qgc3VicGF0aCBvZiB0aGUgZ2l2ZW4gcGF0aCB0aGF0IHBvaW50cyBhIGRlZmluZWQNCiAgICAgKiB2YWx1ZSBpbiB0aGUgdHJlZQ0KICAgICAqLw0KICAgIGZpbmRSb290TW9zdFZhbHVlQW5kUGF0aChyZWxhdGl2ZVBhdGgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZmluZFJvb3RNb3N0TWF0Y2hpbmdQYXRoQW5kVmFsdWUocmVsYXRpdmVQYXRoLCAoKSA9PiB0cnVlKTsNCiAgICB9DQogICAgLyoqDQogICAgICogQHJldHVybnMgVGhlIHN1YnRyZWUgYXQgdGhlIGdpdmVuIHBhdGgNCiAgICAgKi8NCiAgICBzdWJ0cmVlKHJlbGF0aXZlUGF0aCkgew0KICAgICAgICBpZiAocGF0aElzRW1wdHkocmVsYXRpdmVQYXRoKSkgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBjb25zdCBmcm9udCA9IHBhdGhHZXRGcm9udChyZWxhdGl2ZVBhdGgpOw0KICAgICAgICAgICAgY29uc3QgY2hpbGRUcmVlID0gdGhpcy5jaGlsZHJlbi5nZXQoZnJvbnQpOw0KICAgICAgICAgICAgaWYgKGNoaWxkVHJlZSAhPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBjaGlsZFRyZWUuc3VidHJlZShwYXRoUG9wRnJvbnQocmVsYXRpdmVQYXRoKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEltbXV0YWJsZVRyZWUobnVsbCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogU2V0cyBhIHZhbHVlIGF0IHRoZSBzcGVjaWZpZWQgcGF0aC4NCiAgICAgKg0KICAgICAqIEBwYXJhbSByZWxhdGl2ZVBhdGggLSBQYXRoIHRvIHNldCB2YWx1ZSBhdC4NCiAgICAgKiBAcGFyYW0gdG9TZXQgLSBWYWx1ZSB0byBzZXQuDQogICAgICogQHJldHVybnMgUmVzdWx0aW5nIHRyZWUuDQogICAgICovDQogICAgc2V0KHJlbGF0aXZlUGF0aCwgdG9TZXQpIHsNCiAgICAgICAgaWYgKHBhdGhJc0VtcHR5KHJlbGF0aXZlUGF0aCkpIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgSW1tdXRhYmxlVHJlZSh0b1NldCwgdGhpcy5jaGlsZHJlbik7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBjb25zdCBmcm9udCA9IHBhdGhHZXRGcm9udChyZWxhdGl2ZVBhdGgpOw0KICAgICAgICAgICAgY29uc3QgY2hpbGQgPSB0aGlzLmNoaWxkcmVuLmdldChmcm9udCkgfHwgbmV3IEltbXV0YWJsZVRyZWUobnVsbCk7DQogICAgICAgICAgICBjb25zdCBuZXdDaGlsZCA9IGNoaWxkLnNldChwYXRoUG9wRnJvbnQocmVsYXRpdmVQYXRoKSwgdG9TZXQpOw0KICAgICAgICAgICAgY29uc3QgbmV3Q2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuLmluc2VydChmcm9udCwgbmV3Q2hpbGQpOw0KICAgICAgICAgICAgcmV0dXJuIG5ldyBJbW11dGFibGVUcmVlKHRoaXMudmFsdWUsIG5ld0NoaWxkcmVuKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBSZW1vdmVzIHRoZSB2YWx1ZSBhdCB0aGUgc3BlY2lmaWVkIHBhdGguDQogICAgICoNCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQYXRoIC0gUGF0aCB0byB2YWx1ZSB0byByZW1vdmUuDQogICAgICogQHJldHVybnMgUmVzdWx0aW5nIHRyZWUuDQogICAgICovDQogICAgcmVtb3ZlKHJlbGF0aXZlUGF0aCkgew0KICAgICAgICBpZiAocGF0aElzRW1wdHkocmVsYXRpdmVQYXRoKSkgew0KICAgICAgICAgICAgaWYgKHRoaXMuY2hpbGRyZW4uaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBJbW11dGFibGVUcmVlKG51bGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBJbW11dGFibGVUcmVlKG51bGwsIHRoaXMuY2hpbGRyZW4pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29uc3QgZnJvbnQgPSBwYXRoR2V0RnJvbnQocmVsYXRpdmVQYXRoKTsNCiAgICAgICAgICAgIGNvbnN0IGNoaWxkID0gdGhpcy5jaGlsZHJlbi5nZXQoZnJvbnQpOw0KICAgICAgICAgICAgaWYgKGNoaWxkKSB7DQogICAgICAgICAgICAgICAgY29uc3QgbmV3Q2hpbGQgPSBjaGlsZC5yZW1vdmUocGF0aFBvcEZyb250KHJlbGF0aXZlUGF0aCkpOw0KICAgICAgICAgICAgICAgIGxldCBuZXdDaGlsZHJlbjsNCiAgICAgICAgICAgICAgICBpZiAobmV3Q2hpbGQuaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAgICAgICAgIG5ld0NoaWxkcmVuID0gdGhpcy5jaGlsZHJlbi5yZW1vdmUoZnJvbnQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgbmV3Q2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuLmluc2VydChmcm9udCwgbmV3Q2hpbGQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAodGhpcy52YWx1ZSA9PT0gbnVsbCAmJiBuZXdDaGlsZHJlbi5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBJbW11dGFibGVUcmVlKG51bGwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBJbW11dGFibGVUcmVlKHRoaXMudmFsdWUsIG5ld0NoaWxkcmVuKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKioNCiAgICAgKiBHZXRzIGEgdmFsdWUgZnJvbSB0aGUgdHJlZS4NCiAgICAgKg0KICAgICAqIEBwYXJhbSByZWxhdGl2ZVBhdGggLSBQYXRoIHRvIGdldCB2YWx1ZSBmb3IuDQogICAgICogQHJldHVybnMgVmFsdWUgYXQgcGF0aCwgb3IgbnVsbC4NCiAgICAgKi8NCiAgICBnZXQocmVsYXRpdmVQYXRoKSB7DQogICAgICAgIGlmIChwYXRoSXNFbXB0eShyZWxhdGl2ZVBhdGgpKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IGZyb250ID0gcGF0aEdldEZyb250KHJlbGF0aXZlUGF0aCk7DQogICAgICAgICAgICBjb25zdCBjaGlsZCA9IHRoaXMuY2hpbGRyZW4uZ2V0KGZyb250KTsNCiAgICAgICAgICAgIGlmIChjaGlsZCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBjaGlsZC5nZXQocGF0aFBvcEZyb250KHJlbGF0aXZlUGF0aCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogUmVwbGFjZSB0aGUgc3VidHJlZSBhdCB0aGUgc3BlY2lmaWVkIHBhdGggd2l0aCB0aGUgZ2l2ZW4gbmV3IHRyZWUuDQogICAgICoNCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQYXRoIC0gUGF0aCB0byByZXBsYWNlIHN1YnRyZWUgZm9yLg0KICAgICAqIEBwYXJhbSBuZXdUcmVlIC0gTmV3IHRyZWUuDQogICAgICogQHJldHVybnMgUmVzdWx0aW5nIHRyZWUuDQogICAgICovDQogICAgc2V0VHJlZShyZWxhdGl2ZVBhdGgsIG5ld1RyZWUpIHsNCiAgICAgICAgaWYgKHBhdGhJc0VtcHR5KHJlbGF0aXZlUGF0aCkpIHsNCiAgICAgICAgICAgIHJldHVybiBuZXdUcmVlOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29uc3QgZnJvbnQgPSBwYXRoR2V0RnJvbnQocmVsYXRpdmVQYXRoKTsNCiAgICAgICAgICAgIGNvbnN0IGNoaWxkID0gdGhpcy5jaGlsZHJlbi5nZXQoZnJvbnQpIHx8IG5ldyBJbW11dGFibGVUcmVlKG51bGwpOw0KICAgICAgICAgICAgY29uc3QgbmV3Q2hpbGQgPSBjaGlsZC5zZXRUcmVlKHBhdGhQb3BGcm9udChyZWxhdGl2ZVBhdGgpLCBuZXdUcmVlKTsNCiAgICAgICAgICAgIGxldCBuZXdDaGlsZHJlbjsNCiAgICAgICAgICAgIGlmIChuZXdDaGlsZC5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgICAgICBuZXdDaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW4ucmVtb3ZlKGZyb250KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIG5ld0NoaWxkcmVuID0gdGhpcy5jaGlsZHJlbi5pbnNlcnQoZnJvbnQsIG5ld0NoaWxkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBuZXcgSW1tdXRhYmxlVHJlZSh0aGlzLnZhbHVlLCBuZXdDaGlsZHJlbik7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogUGVyZm9ybXMgYSBkZXB0aCBmaXJzdCBmb2xkIG9uIHRoaXMgdHJlZS4gVHJhbnNmb3JtcyBhIHRyZWUgaW50byBhIHNpbmdsZQ0KICAgICAqIHZhbHVlLCBnaXZlbiBhIGZ1bmN0aW9uIHRoYXQgb3BlcmF0ZXMgb24gdGhlIHBhdGggdG8gYSBub2RlLCBhbiBvcHRpb25hbA0KICAgICAqIGN1cnJlbnQgdmFsdWUsIGFuZCBhIG1hcCBvZiBjaGlsZCBuYW1lcyB0byBmb2xkZWQgc3VidHJlZXMNCiAgICAgKi8NCiAgICBmb2xkKGZuKSB7DQogICAgICAgIHJldHVybiB0aGlzLmZvbGRfKG5ld0VtcHR5UGF0aCgpLCBmbik7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJlY3Vyc2l2ZSBoZWxwZXIgZm9yIHB1YmxpYy1mYWNpbmcgZm9sZCgpIG1ldGhvZA0KICAgICAqLw0KICAgIGZvbGRfKHBhdGhTb0ZhciwgZm4pIHsNCiAgICAgICAgY29uc3QgYWNjdW0gPSB7fTsNCiAgICAgICAgdGhpcy5jaGlsZHJlbi5pbm9yZGVyVHJhdmVyc2FsKChjaGlsZEtleSwgY2hpbGRUcmVlKSA9PiB7DQogICAgICAgICAgICBhY2N1bVtjaGlsZEtleV0gPSBjaGlsZFRyZWUuZm9sZF8ocGF0aENoaWxkKHBhdGhTb0ZhciwgY2hpbGRLZXkpLCBmbik7DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gZm4ocGF0aFNvRmFyLCB0aGlzLnZhbHVlLCBhY2N1bSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEZpbmQgdGhlIGZpcnN0IG1hdGNoaW5nIHZhbHVlIG9uIHRoZSBnaXZlbiBwYXRoLiBSZXR1cm4gdGhlIHJlc3VsdCBvZiBhcHBseWluZyBmIHRvIGl0Lg0KICAgICAqLw0KICAgIGZpbmRPblBhdGgocGF0aCwgZikgew0KICAgICAgICByZXR1cm4gdGhpcy5maW5kT25QYXRoXyhwYXRoLCBuZXdFbXB0eVBhdGgoKSwgZik7DQogICAgfQ0KICAgIGZpbmRPblBhdGhfKHBhdGhUb0ZvbGxvdywgcGF0aFNvRmFyLCBmKSB7DQogICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMudmFsdWUgPyBmKHBhdGhTb0ZhciwgdGhpcy52YWx1ZSkgOiBmYWxzZTsNCiAgICAgICAgaWYgKHJlc3VsdCkgew0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGlmIChwYXRoSXNFbXB0eShwYXRoVG9Gb2xsb3cpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBjb25zdCBmcm9udCA9IHBhdGhHZXRGcm9udChwYXRoVG9Gb2xsb3cpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG5leHRDaGlsZCA9IHRoaXMuY2hpbGRyZW4uZ2V0KGZyb250KTsNCiAgICAgICAgICAgICAgICBpZiAobmV4dENoaWxkKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXh0Q2hpbGQuZmluZE9uUGF0aF8ocGF0aFBvcEZyb250KHBhdGhUb0ZvbGxvdyksIHBhdGhDaGlsZChwYXRoU29GYXIsIGZyb250KSwgZik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgZm9yZWFjaE9uUGF0aChwYXRoLCBmKSB7DQogICAgICAgIHJldHVybiB0aGlzLmZvcmVhY2hPblBhdGhfKHBhdGgsIG5ld0VtcHR5UGF0aCgpLCBmKTsNCiAgICB9DQogICAgZm9yZWFjaE9uUGF0aF8ocGF0aFRvRm9sbG93LCBjdXJyZW50UmVsYXRpdmVQYXRoLCBmKSB7DQogICAgICAgIGlmIChwYXRoSXNFbXB0eShwYXRoVG9Gb2xsb3cpKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlKSB7DQogICAgICAgICAgICAgICAgZihjdXJyZW50UmVsYXRpdmVQYXRoLCB0aGlzLnZhbHVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IGZyb250ID0gcGF0aEdldEZyb250KHBhdGhUb0ZvbGxvdyk7DQogICAgICAgICAgICBjb25zdCBuZXh0Q2hpbGQgPSB0aGlzLmNoaWxkcmVuLmdldChmcm9udCk7DQogICAgICAgICAgICBpZiAobmV4dENoaWxkKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG5leHRDaGlsZC5mb3JlYWNoT25QYXRoXyhwYXRoUG9wRnJvbnQocGF0aFRvRm9sbG93KSwgcGF0aENoaWxkKGN1cnJlbnRSZWxhdGl2ZVBhdGgsIGZyb250KSwgZik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEltbXV0YWJsZVRyZWUobnVsbCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogQ2FsbHMgdGhlIGdpdmVuIGZ1bmN0aW9uIGZvciBlYWNoIG5vZGUgaW4gdGhlIHRyZWUgdGhhdCBoYXMgYSB2YWx1ZS4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBmIC0gQSBmdW5jdGlvbiB0byBiZSBjYWxsZWQgd2l0aCB0aGUgcGF0aCBmcm9tIHRoZSByb290IG9mIHRoZSB0cmVlIHRvDQogICAgICogYSBub2RlLCBhbmQgdGhlIHZhbHVlIGF0IHRoYXQgbm9kZS4gQ2FsbGVkIGluIGRlcHRoLWZpcnN0IG9yZGVyLg0KICAgICAqLw0KICAgIGZvcmVhY2goZikgew0KICAgICAgICB0aGlzLmZvcmVhY2hfKG5ld0VtcHR5UGF0aCgpLCBmKTsNCiAgICB9DQogICAgZm9yZWFjaF8oY3VycmVudFJlbGF0aXZlUGF0aCwgZikgew0KICAgICAgICB0aGlzLmNoaWxkcmVuLmlub3JkZXJUcmF2ZXJzYWwoKGNoaWxkTmFtZSwgY2hpbGRUcmVlKSA9PiB7DQogICAgICAgICAgICBjaGlsZFRyZWUuZm9yZWFjaF8ocGF0aENoaWxkKGN1cnJlbnRSZWxhdGl2ZVBhdGgsIGNoaWxkTmFtZSksIGYpOw0KICAgICAgICB9KTsNCiAgICAgICAgaWYgKHRoaXMudmFsdWUpIHsNCiAgICAgICAgICAgIGYoY3VycmVudFJlbGF0aXZlUGF0aCwgdGhpcy52YWx1ZSk7DQogICAgICAgIH0NCiAgICB9DQogICAgZm9yZWFjaENoaWxkKGYpIHsNCiAgICAgICAgdGhpcy5jaGlsZHJlbi5pbm9yZGVyVHJhdmVyc2FsKChjaGlsZE5hbWUsIGNoaWxkVHJlZSkgPT4gew0KICAgICAgICAgICAgaWYgKGNoaWxkVHJlZS52YWx1ZSkgew0KICAgICAgICAgICAgICAgIGYoY2hpbGROYW1lLCBjaGlsZFRyZWUudmFsdWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIFRoaXMgY2xhc3MgaG9sZHMgYSBjb2xsZWN0aW9uIG9mIHdyaXRlcyB0aGF0IGNhbiBiZSBhcHBsaWVkIHRvIG5vZGVzIGluIHVuaXNvbi4gSXQgYWJzdHJhY3RzIGF3YXkgdGhlIGxvZ2ljIHdpdGgNCiAqIGRlYWxpbmcgd2l0aCBwcmlvcml0eSB3cml0ZXMgYW5kIG11bHRpcGxlIG5lc3RlZCB3cml0ZXMuIEF0IGFueSBnaXZlbiBwYXRoIHRoZXJlIGlzIG9ubHkgYWxsb3dlZCB0byBiZSBvbmUgd3JpdGUNCiAqIG1vZGlmeWluZyB0aGF0IHBhdGguIEFueSB3cml0ZSB0byBhbiBleGlzdGluZyBwYXRoIG9yIHNoYWRvd2luZyBhbiBleGlzdGluZyBwYXRoIHdpbGwgbW9kaWZ5IHRoYXQgZXhpc3Rpbmcgd3JpdGUNCiAqIHRvIHJlZmxlY3QgdGhlIHdyaXRlIGFkZGVkLg0KICovDQpjbGFzcyBDb21wb3VuZFdyaXRlIHsNCiAgICBjb25zdHJ1Y3Rvcih3cml0ZVRyZWVfKSB7DQogICAgICAgIHRoaXMud3JpdGVUcmVlXyA9IHdyaXRlVHJlZV87DQogICAgfQ0KICAgIHN0YXRpYyBlbXB0eSgpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBDb21wb3VuZFdyaXRlKG5ldyBJbW11dGFibGVUcmVlKG51bGwpKTsNCiAgICB9DQp9DQpmdW5jdGlvbiBjb21wb3VuZFdyaXRlQWRkV3JpdGUoY29tcG91bmRXcml0ZSwgcGF0aCwgbm9kZSkgew0KICAgIGlmIChwYXRoSXNFbXB0eShwYXRoKSkgew0KICAgICAgICByZXR1cm4gbmV3IENvbXBvdW5kV3JpdGUobmV3IEltbXV0YWJsZVRyZWUobm9kZSkpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3Qgcm9vdG1vc3QgPSBjb21wb3VuZFdyaXRlLndyaXRlVHJlZV8uZmluZFJvb3RNb3N0VmFsdWVBbmRQYXRoKHBhdGgpOw0KICAgICAgICBpZiAocm9vdG1vc3QgIT0gbnVsbCkgew0KICAgICAgICAgICAgY29uc3Qgcm9vdE1vc3RQYXRoID0gcm9vdG1vc3QucGF0aDsNCiAgICAgICAgICAgIGxldCB2YWx1ZSA9IHJvb3Rtb3N0LnZhbHVlOw0KICAgICAgICAgICAgY29uc3QgcmVsYXRpdmVQYXRoID0gbmV3UmVsYXRpdmVQYXRoKHJvb3RNb3N0UGF0aCwgcGF0aCk7DQogICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnVwZGF0ZUNoaWxkKHJlbGF0aXZlUGF0aCwgbm9kZSk7DQogICAgICAgICAgICByZXR1cm4gbmV3IENvbXBvdW5kV3JpdGUoY29tcG91bmRXcml0ZS53cml0ZVRyZWVfLnNldChyb290TW9zdFBhdGgsIHZhbHVlKSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBjb25zdCBzdWJ0cmVlID0gbmV3IEltbXV0YWJsZVRyZWUobm9kZSk7DQogICAgICAgICAgICBjb25zdCBuZXdXcml0ZVRyZWUgPSBjb21wb3VuZFdyaXRlLndyaXRlVHJlZV8uc2V0VHJlZShwYXRoLCBzdWJ0cmVlKTsNCiAgICAgICAgICAgIHJldHVybiBuZXcgQ29tcG91bmRXcml0ZShuZXdXcml0ZVRyZWUpOw0KICAgICAgICB9DQogICAgfQ0KfQ0KZnVuY3Rpb24gY29tcG91bmRXcml0ZUFkZFdyaXRlcyhjb21wb3VuZFdyaXRlLCBwYXRoLCB1cGRhdGVzKSB7DQogICAgbGV0IG5ld1dyaXRlID0gY29tcG91bmRXcml0ZTsNCiAgICBlYWNoKHVwZGF0ZXMsIChjaGlsZEtleSwgbm9kZSkgPT4gew0KICAgICAgICBuZXdXcml0ZSA9IGNvbXBvdW5kV3JpdGVBZGRXcml0ZShuZXdXcml0ZSwgcGF0aENoaWxkKHBhdGgsIGNoaWxkS2V5KSwgbm9kZSk7DQogICAgfSk7DQogICAgcmV0dXJuIG5ld1dyaXRlOw0KfQ0KLyoqDQogKiBXaWxsIHJlbW92ZSBhIHdyaXRlIGF0IHRoZSBnaXZlbiBwYXRoIGFuZCBkZWVwZXIgcGF0aHMuIFRoaXMgd2lsbCA8ZW0+bm90PC9lbT4gbW9kaWZ5IGEgd3JpdGUgYXQgYSBoaWdoZXINCiAqIGxvY2F0aW9uLCB3aGljaCBtdXN0IGJlIHJlbW92ZWQgYnkgY2FsbGluZyB0aGlzIG1ldGhvZCB3aXRoIHRoYXQgcGF0aC4NCiAqDQogKiBAcGFyYW0gY29tcG91bmRXcml0ZSAtIFRoZSBDb21wb3VuZFdyaXRlIHRvIHJlbW92ZS4NCiAqIEBwYXJhbSBwYXRoIC0gVGhlIHBhdGggYXQgd2hpY2ggYSB3cml0ZSBhbmQgYWxsIGRlZXBlciB3cml0ZXMgc2hvdWxkIGJlIHJlbW92ZWQNCiAqIEByZXR1cm5zIFRoZSBuZXcgQ29tcG91bmRXcml0ZSB3aXRoIHRoZSByZW1vdmVkIHBhdGgNCiAqLw0KZnVuY3Rpb24gY29tcG91bmRXcml0ZVJlbW92ZVdyaXRlKGNvbXBvdW5kV3JpdGUsIHBhdGgpIHsNCiAgICBpZiAocGF0aElzRW1wdHkocGF0aCkpIHsNCiAgICAgICAgcmV0dXJuIENvbXBvdW5kV3JpdGUuZW1wdHkoKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGNvbnN0IG5ld1dyaXRlVHJlZSA9IGNvbXBvdW5kV3JpdGUud3JpdGVUcmVlXy5zZXRUcmVlKHBhdGgsIG5ldyBJbW11dGFibGVUcmVlKG51bGwpKTsNCiAgICAgICAgcmV0dXJuIG5ldyBDb21wb3VuZFdyaXRlKG5ld1dyaXRlVHJlZSk7DQogICAgfQ0KfQ0KLyoqDQogKiBSZXR1cm5zIHdoZXRoZXIgdGhpcyBDb21wb3VuZFdyaXRlIHdpbGwgZnVsbHkgb3ZlcndyaXRlIGEgbm9kZSBhdCBhIGdpdmVuIGxvY2F0aW9uIGFuZCBjYW4gdGhlcmVmb3JlIGJlDQogKiBjb25zaWRlcmVkICJjb21wbGV0ZSIuDQogKg0KICogQHBhcmFtIGNvbXBvdW5kV3JpdGUgLSBUaGUgQ29tcG91bmRXcml0ZSB0byBjaGVjay4NCiAqIEBwYXJhbSBwYXRoIC0gVGhlIHBhdGggdG8gY2hlY2sgZm9yDQogKiBAcmV0dXJucyBXaGV0aGVyIHRoZXJlIGlzIGEgY29tcGxldGUgd3JpdGUgYXQgdGhhdCBwYXRoDQogKi8NCmZ1bmN0aW9uIGNvbXBvdW5kV3JpdGVIYXNDb21wbGV0ZVdyaXRlKGNvbXBvdW5kV3JpdGUsIHBhdGgpIHsNCiAgICByZXR1cm4gY29tcG91bmRXcml0ZUdldENvbXBsZXRlTm9kZShjb21wb3VuZFdyaXRlLCBwYXRoKSAhPSBudWxsOw0KfQ0KLyoqDQogKiBSZXR1cm5zIGEgbm9kZSBmb3IgYSBwYXRoIGlmIGFuZCBvbmx5IGlmIHRoZSBub2RlIGlzIGEgImNvbXBsZXRlIiBvdmVyd3JpdGUgYXQgdGhhdCBwYXRoLiBUaGlzIHdpbGwgbm90IGFnZ3JlZ2F0ZQ0KICogd3JpdGVzIGZyb20gZGVlcGVyIHBhdGhzLCBidXQgd2lsbCByZXR1cm4gY2hpbGQgbm9kZXMgZnJvbSBhIG1vcmUgc2hhbGxvdyBwYXRoLg0KICoNCiAqIEBwYXJhbSBjb21wb3VuZFdyaXRlIC0gVGhlIENvbXBvdW5kV3JpdGUgdG8gZ2V0IHRoZSBub2RlIGZyb20uDQogKiBAcGFyYW0gcGF0aCAtIFRoZSBwYXRoIHRvIGdldCBhIGNvbXBsZXRlIHdyaXRlDQogKiBAcmV0dXJucyBUaGUgbm9kZSBpZiBjb21wbGV0ZSBhdCB0aGF0IHBhdGgsIG9yIG51bGwgb3RoZXJ3aXNlLg0KICovDQpmdW5jdGlvbiBjb21wb3VuZFdyaXRlR2V0Q29tcGxldGVOb2RlKGNvbXBvdW5kV3JpdGUsIHBhdGgpIHsNCiAgICBjb25zdCByb290bW9zdCA9IGNvbXBvdW5kV3JpdGUud3JpdGVUcmVlXy5maW5kUm9vdE1vc3RWYWx1ZUFuZFBhdGgocGF0aCk7DQogICAgaWYgKHJvb3Rtb3N0ICE9IG51bGwpIHsNCiAgICAgICAgcmV0dXJuIGNvbXBvdW5kV3JpdGUud3JpdGVUcmVlXw0KICAgICAgICAgICAgLmdldChyb290bW9zdC5wYXRoKQ0KICAgICAgICAgICAgLmdldENoaWxkKG5ld1JlbGF0aXZlUGF0aChyb290bW9zdC5wYXRoLCBwYXRoKSk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQp9DQovKioNCiAqIFJldHVybnMgYWxsIGNoaWxkcmVuIHRoYXQgYXJlIGd1YXJhbnRlZWQgdG8gYmUgYSBjb21wbGV0ZSBvdmVyd3JpdGUuDQogKg0KICogQHBhcmFtIGNvbXBvdW5kV3JpdGUgLSBUaGUgQ29tcG91bmRXcml0ZSB0byBnZXQgY2hpbGRyZW4gZnJvbS4NCiAqIEByZXR1cm5zIEEgbGlzdCBvZiBhbGwgY29tcGxldGUgY2hpbGRyZW4uDQogKi8NCmZ1bmN0aW9uIGNvbXBvdW5kV3JpdGVHZXRDb21wbGV0ZUNoaWxkcmVuKGNvbXBvdW5kV3JpdGUpIHsNCiAgICBjb25zdCBjaGlsZHJlbiA9IFtdOw0KICAgIGNvbnN0IG5vZGUgPSBjb21wb3VuZFdyaXRlLndyaXRlVHJlZV8udmFsdWU7DQogICAgaWYgKG5vZGUgIT0gbnVsbCkgew0KICAgICAgICAvLyBJZiBpdCdzIGEgbGVhZiBub2RlLCBpdCBoYXMgbm8gY2hpbGRyZW47IHNvIG5vdGhpbmcgdG8gZG8uDQogICAgICAgIGlmICghbm9kZS5pc0xlYWZOb2RlKCkpIHsNCiAgICAgICAgICAgIG5vZGUuZm9yRWFjaENoaWxkKFBSSU9SSVRZX0lOREVYLCAoY2hpbGROYW1lLCBjaGlsZE5vZGUpID0+IHsNCiAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKG5ldyBOYW1lZE5vZGUoY2hpbGROYW1lLCBjaGlsZE5vZGUpKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBjb21wb3VuZFdyaXRlLndyaXRlVHJlZV8uY2hpbGRyZW4uaW5vcmRlclRyYXZlcnNhbCgoY2hpbGROYW1lLCBjaGlsZFRyZWUpID0+IHsNCiAgICAgICAgICAgIGlmIChjaGlsZFRyZWUudmFsdWUgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIGNoaWxkcmVuLnB1c2gobmV3IE5hbWVkTm9kZShjaGlsZE5hbWUsIGNoaWxkVHJlZS52YWx1ZSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgcmV0dXJuIGNoaWxkcmVuOw0KfQ0KZnVuY3Rpb24gY29tcG91bmRXcml0ZUNoaWxkQ29tcG91bmRXcml0ZShjb21wb3VuZFdyaXRlLCBwYXRoKSB7DQogICAgaWYgKHBhdGhJc0VtcHR5KHBhdGgpKSB7DQogICAgICAgIHJldHVybiBjb21wb3VuZFdyaXRlOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3Qgc2hhZG93aW5nTm9kZSA9IGNvbXBvdW5kV3JpdGVHZXRDb21wbGV0ZU5vZGUoY29tcG91bmRXcml0ZSwgcGF0aCk7DQogICAgICAgIGlmIChzaGFkb3dpbmdOb2RlICE9IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgQ29tcG91bmRXcml0ZShuZXcgSW1tdXRhYmxlVHJlZShzaGFkb3dpbmdOb2RlKSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gbmV3IENvbXBvdW5kV3JpdGUoY29tcG91bmRXcml0ZS53cml0ZVRyZWVfLnN1YnRyZWUocGF0aCkpOw0KICAgICAgICB9DQogICAgfQ0KfQ0KLyoqDQogKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBDb21wb3VuZFdyaXRlIGlzIGVtcHR5IGFuZCB0aGVyZWZvcmUgZG9lcyBub3QgbW9kaWZ5IGFueSBub2Rlcy4NCiAqIEByZXR1cm5zIFdoZXRoZXIgdGhpcyBDb21wb3VuZFdyaXRlIGlzIGVtcHR5DQogKi8NCmZ1bmN0aW9uIGNvbXBvdW5kV3JpdGVJc0VtcHR5KGNvbXBvdW5kV3JpdGUpIHsNCiAgICByZXR1cm4gY29tcG91bmRXcml0ZS53cml0ZVRyZWVfLmlzRW1wdHkoKTsNCn0NCi8qKg0KICogQXBwbGllcyB0aGlzIENvbXBvdW5kV3JpdGUgdG8gYSBub2RlLiBUaGUgbm9kZSBpcyByZXR1cm5lZCB3aXRoIGFsbCB3cml0ZXMgZnJvbSB0aGlzIENvbXBvdW5kV3JpdGUgYXBwbGllZCB0byB0aGUNCiAqIG5vZGUNCiAqIEBwYXJhbSBub2RlIC0gVGhlIG5vZGUgdG8gYXBwbHkgdGhpcyBDb21wb3VuZFdyaXRlIHRvDQogKiBAcmV0dXJucyBUaGUgbm9kZSB3aXRoIGFsbCB3cml0ZXMgYXBwbGllZA0KICovDQpmdW5jdGlvbiBjb21wb3VuZFdyaXRlQXBwbHkoY29tcG91bmRXcml0ZSwgbm9kZSkgew0KICAgIHJldHVybiBhcHBseVN1YnRyZWVXcml0ZShuZXdFbXB0eVBhdGgoKSwgY29tcG91bmRXcml0ZS53cml0ZVRyZWVfLCBub2RlKTsNCn0NCmZ1bmN0aW9uIGFwcGx5U3VidHJlZVdyaXRlKHJlbGF0aXZlUGF0aCwgd3JpdGVUcmVlLCBub2RlKSB7DQogICAgaWYgKHdyaXRlVHJlZS52YWx1ZSAhPSBudWxsKSB7DQogICAgICAgIC8vIFNpbmNlIHRoZXJlIGEgd3JpdGUgaXMgYWx3YXlzIGEgbGVhZiwgd2UncmUgZG9uZSBoZXJlDQogICAgICAgIHJldHVybiBub2RlLnVwZGF0ZUNoaWxkKHJlbGF0aXZlUGF0aCwgd3JpdGVUcmVlLnZhbHVlKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGxldCBwcmlvcml0eVdyaXRlID0gbnVsbDsNCiAgICAgICAgd3JpdGVUcmVlLmNoaWxkcmVuLmlub3JkZXJUcmF2ZXJzYWwoKGNoaWxkS2V5LCBjaGlsZFRyZWUpID0+IHsNCiAgICAgICAgICAgIGlmIChjaGlsZEtleSA9PT0gJy5wcmlvcml0eScpIHsNCiAgICAgICAgICAgICAgICAvLyBBcHBseSBwcmlvcml0aWVzIGF0IHRoZSBlbmQgc28gd2UgZG9uJ3QgdXBkYXRlIHByaW9yaXRpZXMgZm9yIGVpdGhlciBlbXB0eSBub2RlcyBvciBmb3JnZXQNCiAgICAgICAgICAgICAgICAvLyB0byBhcHBseSBwcmlvcml0aWVzIHRvIGVtcHR5IG5vZGVzIHRoYXQgYXJlIGxhdGVyIGZpbGxlZA0KICAgICAgICAgICAgICAgIGFzc2VydChjaGlsZFRyZWUudmFsdWUgIT09IG51bGwsICdQcmlvcml0eSB3cml0ZXMgbXVzdCBhbHdheXMgYmUgbGVhZiBub2RlcycpOw0KICAgICAgICAgICAgICAgIHByaW9yaXR5V3JpdGUgPSBjaGlsZFRyZWUudmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBub2RlID0gYXBwbHlTdWJ0cmVlV3JpdGUocGF0aENoaWxkKHJlbGF0aXZlUGF0aCwgY2hpbGRLZXkpLCBjaGlsZFRyZWUsIG5vZGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgLy8gSWYgdGhlcmUgd2FzIGEgcHJpb3JpdHkgd3JpdGUsIHdlIG9ubHkgYXBwbHkgaXQgaWYgdGhlIG5vZGUgaXMgbm90IGVtcHR5DQogICAgICAgIGlmICghbm9kZS5nZXRDaGlsZChyZWxhdGl2ZVBhdGgpLmlzRW1wdHkoKSAmJiBwcmlvcml0eVdyaXRlICE9PSBudWxsKSB7DQogICAgICAgICAgICBub2RlID0gbm9kZS51cGRhdGVDaGlsZChwYXRoQ2hpbGQocmVsYXRpdmVQYXRoLCAnLnByaW9yaXR5JyksIHByaW9yaXR5V3JpdGUpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBub2RlOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogQ3JlYXRlIGEgbmV3IFdyaXRlVHJlZVJlZiBmb3IgdGhlIGdpdmVuIHBhdGguIEZvciB1c2Ugd2l0aCBhIG5ldyBzeW5jIHBvaW50IGF0IHRoZSBnaXZlbiBwYXRoLg0KICoNCiAqLw0KZnVuY3Rpb24gd3JpdGVUcmVlQ2hpbGRXcml0ZXMod3JpdGVUcmVlLCBwYXRoKSB7DQogICAgcmV0dXJuIG5ld1dyaXRlVHJlZVJlZihwYXRoLCB3cml0ZVRyZWUpOw0KfQ0KLyoqDQogKiBSZWNvcmQgYSBuZXcgb3ZlcndyaXRlIGZyb20gdXNlciBjb2RlLg0KICoNCiAqIEBwYXJhbSB2aXNpYmxlIC0gVGhpcyBpcyBzZXQgdG8gZmFsc2UgYnkgc29tZSB0cmFuc2FjdGlvbnMuIEl0IHNob3VsZCBiZSBleGNsdWRlZCBmcm9tIGV2ZW50IGNhY2hlcw0KICovDQpmdW5jdGlvbiB3cml0ZVRyZWVBZGRPdmVyd3JpdGUod3JpdGVUcmVlLCBwYXRoLCBzbmFwLCB3cml0ZUlkLCB2aXNpYmxlKSB7DQogICAgYXNzZXJ0KHdyaXRlSWQgPiB3cml0ZVRyZWUubGFzdFdyaXRlSWQsICdTdGFja2luZyBhbiBvbGRlciB3cml0ZSBvbiB0b3Agb2YgbmV3ZXIgb25lcycpOw0KICAgIGlmICh2aXNpYmxlID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgdmlzaWJsZSA9IHRydWU7DQogICAgfQ0KICAgIHdyaXRlVHJlZS5hbGxXcml0ZXMucHVzaCh7DQogICAgICAgIHBhdGgsDQogICAgICAgIHNuYXAsDQogICAgICAgIHdyaXRlSWQsDQogICAgICAgIHZpc2libGUNCiAgICB9KTsNCiAgICBpZiAodmlzaWJsZSkgew0KICAgICAgICB3cml0ZVRyZWUudmlzaWJsZVdyaXRlcyA9IGNvbXBvdW5kV3JpdGVBZGRXcml0ZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgcGF0aCwgc25hcCk7DQogICAgfQ0KICAgIHdyaXRlVHJlZS5sYXN0V3JpdGVJZCA9IHdyaXRlSWQ7DQp9DQpmdW5jdGlvbiB3cml0ZVRyZWVHZXRXcml0ZSh3cml0ZVRyZWUsIHdyaXRlSWQpIHsNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdyaXRlVHJlZS5hbGxXcml0ZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgY29uc3QgcmVjb3JkID0gd3JpdGVUcmVlLmFsbFdyaXRlc1tpXTsNCiAgICAgICAgaWYgKHJlY29yZC53cml0ZUlkID09PSB3cml0ZUlkKSB7DQogICAgICAgICAgICByZXR1cm4gcmVjb3JkOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBudWxsOw0KfQ0KLyoqDQogKiBSZW1vdmUgYSB3cml0ZSAoZWl0aGVyIGFuIG92ZXJ3cml0ZSBvciBtZXJnZSkgdGhhdCBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgYWNrbm93bGVkZ2UgYnkgdGhlIHNlcnZlci4gUmVjYWxjdWxhdGVzDQogKiB0aGUgdHJlZSBpZiBuZWNlc3NhcnkuICBXZSByZXR1cm4gdHJ1ZSBpZiBpdCBtYXkgaGF2ZSBiZWVuIHZpc2libGUsIG1lYW5pbmcgdmlld3MgbmVlZCB0byByZWV2YWx1YXRlLg0KICoNCiAqIEByZXR1cm5zIHRydWUgaWYgdGhlIHdyaXRlIG1heSBoYXZlIGJlZW4gdmlzaWJsZSAobWVhbmluZyB3ZSdsbCBuZWVkIHRvIHJlZXZhbHVhdGUgLyByYWlzZQ0KICogZXZlbnRzIGFzIGEgcmVzdWx0KS4NCiAqLw0KZnVuY3Rpb24gd3JpdGVUcmVlUmVtb3ZlV3JpdGUod3JpdGVUcmVlLCB3cml0ZUlkKSB7DQogICAgLy8gTm90ZTogZGlzYWJsaW5nIHRoaXMgY2hlY2suIEl0IGNvdWxkIGJlIGEgdHJhbnNhY3Rpb24gdGhhdCBwcmVlbXB0ZWQgYW5vdGhlciB0cmFuc2FjdGlvbiwgYW5kIHRodXMgd2FzIGFwcGxpZWQNCiAgICAvLyBvdXQgb2Ygb3JkZXIuDQogICAgLy9jb25zdCB2YWxpZENsZWFyID0gcmV2ZXJ0IHx8IHRoaXMuYWxsV3JpdGVzXy5sZW5ndGggPT09IDAgfHwgd3JpdGVJZCA8PSB0aGlzLmFsbFdyaXRlc19bMF0ud3JpdGVJZDsNCiAgICAvL2Fzc2VydCh2YWxpZENsZWFyLCAiRWl0aGVyIHdlIGRvbid0IGhhdmUgdGhpcyB3cml0ZSwgb3IgaXQncyB0aGUgZmlyc3Qgb25lIGluIHRoZSBxdWV1ZSIpOw0KICAgIGNvbnN0IGlkeCA9IHdyaXRlVHJlZS5hbGxXcml0ZXMuZmluZEluZGV4KHMgPT4gew0KICAgICAgICByZXR1cm4gcy53cml0ZUlkID09PSB3cml0ZUlkOw0KICAgIH0pOw0KICAgIGFzc2VydChpZHggPj0gMCwgJ3JlbW92ZVdyaXRlIGNhbGxlZCB3aXRoIG5vbmV4aXN0ZW50IHdyaXRlSWQuJyk7DQogICAgY29uc3Qgd3JpdGVUb1JlbW92ZSA9IHdyaXRlVHJlZS5hbGxXcml0ZXNbaWR4XTsNCiAgICB3cml0ZVRyZWUuYWxsV3JpdGVzLnNwbGljZShpZHgsIDEpOw0KICAgIGxldCByZW1vdmVkV3JpdGVXYXNWaXNpYmxlID0gd3JpdGVUb1JlbW92ZS52aXNpYmxlOw0KICAgIGxldCByZW1vdmVkV3JpdGVPdmVybGFwc1dpdGhPdGhlcldyaXRlcyA9IGZhbHNlOw0KICAgIGxldCBpID0gd3JpdGVUcmVlLmFsbFdyaXRlcy5sZW5ndGggLSAxOw0KICAgIHdoaWxlIChyZW1vdmVkV3JpdGVXYXNWaXNpYmxlICYmIGkgPj0gMCkgew0KICAgICAgICBjb25zdCBjdXJyZW50V3JpdGUgPSB3cml0ZVRyZWUuYWxsV3JpdGVzW2ldOw0KICAgICAgICBpZiAoY3VycmVudFdyaXRlLnZpc2libGUpIHsNCiAgICAgICAgICAgIGlmIChpID49IGlkeCAmJg0KICAgICAgICAgICAgICAgIHdyaXRlVHJlZVJlY29yZENvbnRhaW5zUGF0aF8oY3VycmVudFdyaXRlLCB3cml0ZVRvUmVtb3ZlLnBhdGgpKSB7DQogICAgICAgICAgICAgICAgLy8gVGhlIHJlbW92ZWQgd3JpdGUgd2FzIGNvbXBsZXRlbHkgc2hhZG93ZWQgYnkgYSBzdWJzZXF1ZW50IHdyaXRlLg0KICAgICAgICAgICAgICAgIHJlbW92ZWRXcml0ZVdhc1Zpc2libGUgPSBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHBhdGhDb250YWlucyh3cml0ZVRvUmVtb3ZlLnBhdGgsIGN1cnJlbnRXcml0ZS5wYXRoKSkgew0KICAgICAgICAgICAgICAgIC8vIEVpdGhlciB3ZSdyZSBjb3ZlcmluZyBzb21lIHdyaXRlcyBvciB0aGV5J3JlIGNvdmVyaW5nIHBhcnQgb2YgdXMgKGRlcGVuZGluZyBvbiB3aGljaCBjYW1lIGZpcnN0KS4NCiAgICAgICAgICAgICAgICByZW1vdmVkV3JpdGVPdmVybGFwc1dpdGhPdGhlcldyaXRlcyA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaS0tOw0KICAgIH0NCiAgICBpZiAoIXJlbW92ZWRXcml0ZVdhc1Zpc2libGUpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBlbHNlIGlmIChyZW1vdmVkV3JpdGVPdmVybGFwc1dpdGhPdGhlcldyaXRlcykgew0KICAgICAgICAvLyBUaGVyZSdzIHNvbWUgc2hhZG93aW5nIGdvaW5nIG9uLiBKdXN0IHJlYnVpbGQgdGhlIHZpc2libGUgd3JpdGVzIGZyb20gc2NyYXRjaC4NCiAgICAgICAgd3JpdGVUcmVlUmVzZXRUcmVlXyh3cml0ZVRyZWUpOw0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIC8vIFRoZXJlJ3Mgbm8gc2hhZG93aW5nLiAgV2UgY2FuIHNhZmVseSBqdXN0IHJlbW92ZSB0aGUgd3JpdGUocykgZnJvbSB2aXNpYmxlV3JpdGVzLg0KICAgICAgICBpZiAod3JpdGVUb1JlbW92ZS5zbmFwKSB7DQogICAgICAgICAgICB3cml0ZVRyZWUudmlzaWJsZVdyaXRlcyA9IGNvbXBvdW5kV3JpdGVSZW1vdmVXcml0ZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgd3JpdGVUb1JlbW92ZS5wYXRoKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IGNoaWxkcmVuID0gd3JpdGVUb1JlbW92ZS5jaGlsZHJlbjsNCiAgICAgICAgICAgIGVhY2goY2hpbGRyZW4sIChjaGlsZE5hbWUpID0+IHsNCiAgICAgICAgICAgICAgICB3cml0ZVRyZWUudmlzaWJsZVdyaXRlcyA9IGNvbXBvdW5kV3JpdGVSZW1vdmVXcml0ZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgcGF0aENoaWxkKHdyaXRlVG9SZW1vdmUucGF0aCwgY2hpbGROYW1lKSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQp9DQpmdW5jdGlvbiB3cml0ZVRyZWVSZWNvcmRDb250YWluc1BhdGhfKHdyaXRlUmVjb3JkLCBwYXRoKSB7DQogICAgaWYgKHdyaXRlUmVjb3JkLnNuYXApIHsNCiAgICAgICAgcmV0dXJuIHBhdGhDb250YWlucyh3cml0ZVJlY29yZC5wYXRoLCBwYXRoKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGZvciAoY29uc3QgY2hpbGROYW1lIGluIHdyaXRlUmVjb3JkLmNoaWxkcmVuKSB7DQogICAgICAgICAgICBpZiAod3JpdGVSZWNvcmQuY2hpbGRyZW4uaGFzT3duUHJvcGVydHkoY2hpbGROYW1lKSAmJg0KICAgICAgICAgICAgICAgIHBhdGhDb250YWlucyhwYXRoQ2hpbGQod3JpdGVSZWNvcmQucGF0aCwgY2hpbGROYW1lKSwgcGF0aCkpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KfQ0KLyoqDQogKiBSZS1sYXllciB0aGUgd3JpdGVzIGFuZCBtZXJnZXMgaW50byBhIHRyZWUgc28gd2UgY2FuIGVmZmljaWVudGx5IGNhbGN1bGF0ZSBldmVudCBzbmFwc2hvdHMNCiAqLw0KZnVuY3Rpb24gd3JpdGVUcmVlUmVzZXRUcmVlXyh3cml0ZVRyZWUpIHsNCiAgICB3cml0ZVRyZWUudmlzaWJsZVdyaXRlcyA9IHdyaXRlVHJlZUxheWVyVHJlZV8od3JpdGVUcmVlLmFsbFdyaXRlcywgd3JpdGVUcmVlRGVmYXVsdEZpbHRlcl8sIG5ld0VtcHR5UGF0aCgpKTsNCiAgICBpZiAod3JpdGVUcmVlLmFsbFdyaXRlcy5sZW5ndGggPiAwKSB7DQogICAgICAgIHdyaXRlVHJlZS5sYXN0V3JpdGVJZCA9DQogICAgICAgICAgICB3cml0ZVRyZWUuYWxsV3JpdGVzW3dyaXRlVHJlZS5hbGxXcml0ZXMubGVuZ3RoIC0gMV0ud3JpdGVJZDsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIHdyaXRlVHJlZS5sYXN0V3JpdGVJZCA9IC0xOw0KICAgIH0NCn0NCi8qKg0KICogVGhlIGRlZmF1bHQgZmlsdGVyIHVzZWQgd2hlbiBjb25zdHJ1Y3RpbmcgdGhlIHRyZWUuIEtlZXAgZXZlcnl0aGluZyB0aGF0J3MgdmlzaWJsZS4NCiAqLw0KZnVuY3Rpb24gd3JpdGVUcmVlRGVmYXVsdEZpbHRlcl8od3JpdGUpIHsNCiAgICByZXR1cm4gd3JpdGUudmlzaWJsZTsNCn0NCi8qKg0KICogU3RhdGljIG1ldGhvZC4gR2l2ZW4gYW4gYXJyYXkgb2YgV3JpdGVSZWNvcmRzLCBhIGZpbHRlciBmb3Igd2hpY2ggb25lcyB0byBpbmNsdWRlLCBhbmQgYSBwYXRoLCBjb25zdHJ1Y3QgdGhlIHRyZWUgb2YNCiAqIGV2ZW50IGRhdGEgYXQgdGhhdCBwYXRoLg0KICovDQpmdW5jdGlvbiB3cml0ZVRyZWVMYXllclRyZWVfKHdyaXRlcywgZmlsdGVyLCB0cmVlUm9vdCkgew0KICAgIGxldCBjb21wb3VuZFdyaXRlID0gQ29tcG91bmRXcml0ZS5lbXB0eSgpOw0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd3JpdGVzLmxlbmd0aDsgKytpKSB7DQogICAgICAgIGNvbnN0IHdyaXRlID0gd3JpdGVzW2ldOw0KICAgICAgICAvLyBUaGVvcnksIGEgbGF0ZXIgc2V0IHdpbGwgZWl0aGVyOg0KICAgICAgICAvLyBhKSBhYm9ydCBhIHJlbGV2YW50IHRyYW5zYWN0aW9uLCBzbyBubyBuZWVkIHRvIHdvcnJ5IGFib3V0IGV4Y2x1ZGluZyBpdCBmcm9tIGNhbGN1bGF0aW5nIHRoYXQgdHJhbnNhY3Rpb24NCiAgICAgICAgLy8gYikgbm90IGJlIHJlbGV2YW50IHRvIGEgdHJhbnNhY3Rpb24gKHNlcGFyYXRlIGJyYW5jaCksIHNvIGFnYWluIHdpbGwgbm90IGFmZmVjdCB0aGUgZGF0YSBmb3IgdGhhdCB0cmFuc2FjdGlvbg0KICAgICAgICBpZiAoZmlsdGVyKHdyaXRlKSkgew0KICAgICAgICAgICAgY29uc3Qgd3JpdGVQYXRoID0gd3JpdGUucGF0aDsNCiAgICAgICAgICAgIGxldCByZWxhdGl2ZVBhdGg7DQogICAgICAgICAgICBpZiAod3JpdGUuc25hcCkgew0KICAgICAgICAgICAgICAgIGlmIChwYXRoQ29udGFpbnModHJlZVJvb3QsIHdyaXRlUGF0aCkpIHsNCiAgICAgICAgICAgICAgICAgICAgcmVsYXRpdmVQYXRoID0gbmV3UmVsYXRpdmVQYXRoKHRyZWVSb290LCB3cml0ZVBhdGgpOw0KICAgICAgICAgICAgICAgICAgICBjb21wb3VuZFdyaXRlID0gY29tcG91bmRXcml0ZUFkZFdyaXRlKGNvbXBvdW5kV3JpdGUsIHJlbGF0aXZlUGF0aCwgd3JpdGUuc25hcCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhdGhDb250YWlucyh3cml0ZVBhdGgsIHRyZWVSb290KSkgew0KICAgICAgICAgICAgICAgICAgICByZWxhdGl2ZVBhdGggPSBuZXdSZWxhdGl2ZVBhdGgod3JpdGVQYXRoLCB0cmVlUm9vdCk7DQogICAgICAgICAgICAgICAgICAgIGNvbXBvdW5kV3JpdGUgPSBjb21wb3VuZFdyaXRlQWRkV3JpdGUoY29tcG91bmRXcml0ZSwgbmV3RW1wdHlQYXRoKCksIHdyaXRlLnNuYXAuZ2V0Q2hpbGQocmVsYXRpdmVQYXRoKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAod3JpdGUuY2hpbGRyZW4pIHsNCiAgICAgICAgICAgICAgICBpZiAocGF0aENvbnRhaW5zKHRyZWVSb290LCB3cml0ZVBhdGgpKSB7DQogICAgICAgICAgICAgICAgICAgIHJlbGF0aXZlUGF0aCA9IG5ld1JlbGF0aXZlUGF0aCh0cmVlUm9vdCwgd3JpdGVQYXRoKTsNCiAgICAgICAgICAgICAgICAgICAgY29tcG91bmRXcml0ZSA9IGNvbXBvdW5kV3JpdGVBZGRXcml0ZXMoY29tcG91bmRXcml0ZSwgcmVsYXRpdmVQYXRoLCB3cml0ZS5jaGlsZHJlbik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhdGhDb250YWlucyh3cml0ZVBhdGgsIHRyZWVSb290KSkgew0KICAgICAgICAgICAgICAgICAgICByZWxhdGl2ZVBhdGggPSBuZXdSZWxhdGl2ZVBhdGgod3JpdGVQYXRoLCB0cmVlUm9vdCk7DQogICAgICAgICAgICAgICAgICAgIGlmIChwYXRoSXNFbXB0eShyZWxhdGl2ZVBhdGgpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb21wb3VuZFdyaXRlID0gY29tcG91bmRXcml0ZUFkZFdyaXRlcyhjb21wb3VuZFdyaXRlLCBuZXdFbXB0eVBhdGgoKSwgd3JpdGUuY2hpbGRyZW4pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGQgPSBzYWZlR2V0KHdyaXRlLmNoaWxkcmVuLCBwYXRoR2V0RnJvbnQocmVsYXRpdmVQYXRoKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGVyZSBleGlzdHMgYSBjaGlsZCBpbiB0aGlzIG5vZGUgdGhhdCBtYXRjaGVzIHRoZSByb290IHBhdGgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkZWVwTm9kZSA9IGNoaWxkLmdldENoaWxkKHBhdGhQb3BGcm9udChyZWxhdGl2ZVBhdGgpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wb3VuZFdyaXRlID0gY29tcG91bmRXcml0ZUFkZFdyaXRlKGNvbXBvdW5kV3JpdGUsIG5ld0VtcHR5UGF0aCgpLCBkZWVwTm9kZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBhc3NlcnRpb25FcnJvcignV3JpdGVSZWNvcmQgc2hvdWxkIGhhdmUgLnNuYXAgb3IgLmNoaWxkcmVuJyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGNvbXBvdW5kV3JpdGU7DQp9DQovKioNCiAqIEdpdmVuIG9wdGlvbmFsLCB1bmRlcmx5aW5nIHNlcnZlciBkYXRhLCBhbmQgYW4gb3B0aW9uYWwgc2V0IG9mIGNvbnN0cmFpbnRzIChleGNsdWRlIHNvbWUgc2V0cywgaW5jbHVkZSBoaWRkZW4NCiAqIHdyaXRlcyksIGF0dGVtcHQgdG8gY2FsY3VsYXRlIGEgY29tcGxldGUgc25hcHNob3QgZm9yIHRoZSBnaXZlbiBwYXRoDQogKg0KICogQHBhcmFtIHdyaXRlSWRzVG9FeGNsdWRlIC0gQW4gb3B0aW9uYWwgc2V0IHRvIGJlIGV4Y2x1ZGVkDQogKiBAcGFyYW0gaW5jbHVkZUhpZGRlbldyaXRlcyAtIERlZmF1bHRzIHRvIGZhbHNlLCB3aGV0aGVyIG9yIG5vdCB0byBsYXllciBvbiB3cml0ZXMgd2l0aCB2aXNpYmxlIHNldCB0byBmYWxzZQ0KICovDQpmdW5jdGlvbiB3cml0ZVRyZWVDYWxjQ29tcGxldGVFdmVudENhY2hlKHdyaXRlVHJlZSwgdHJlZVBhdGgsIGNvbXBsZXRlU2VydmVyQ2FjaGUsIHdyaXRlSWRzVG9FeGNsdWRlLCBpbmNsdWRlSGlkZGVuV3JpdGVzKSB7DQogICAgaWYgKCF3cml0ZUlkc1RvRXhjbHVkZSAmJiAhaW5jbHVkZUhpZGRlbldyaXRlcykgew0KICAgICAgICBjb25zdCBzaGFkb3dpbmdOb2RlID0gY29tcG91bmRXcml0ZUdldENvbXBsZXRlTm9kZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgdHJlZVBhdGgpOw0KICAgICAgICBpZiAoc2hhZG93aW5nTm9kZSAhPSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gc2hhZG93aW5nTm9kZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IHN1Yk1lcmdlID0gY29tcG91bmRXcml0ZUNoaWxkQ29tcG91bmRXcml0ZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgdHJlZVBhdGgpOw0KICAgICAgICAgICAgaWYgKGNvbXBvdW5kV3JpdGVJc0VtcHR5KHN1Yk1lcmdlKSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBjb21wbGV0ZVNlcnZlckNhY2hlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoY29tcGxldGVTZXJ2ZXJDYWNoZSA9PSBudWxsICYmDQogICAgICAgICAgICAgICAgIWNvbXBvdW5kV3JpdGVIYXNDb21wbGV0ZVdyaXRlKHN1Yk1lcmdlLCBuZXdFbXB0eVBhdGgoKSkpIHsNCiAgICAgICAgICAgICAgICAvLyBXZSB3b3VsZG4ndCBoYXZlIGEgY29tcGxldGUgc25hcHNob3QsIHNpbmNlIHRoZXJlJ3Mgbm8gdW5kZXJseWluZyBkYXRhIGFuZCBubyBjb21wbGV0ZSBzaGFkb3cNCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyZWRDYWNoZSA9IGNvbXBsZXRlU2VydmVyQ2FjaGUgfHwgQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREU7DQogICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBvdW5kV3JpdGVBcHBseShzdWJNZXJnZSwgbGF5ZXJlZENhY2hlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3QgbWVyZ2UgPSBjb21wb3VuZFdyaXRlQ2hpbGRDb21wb3VuZFdyaXRlKHdyaXRlVHJlZS52aXNpYmxlV3JpdGVzLCB0cmVlUGF0aCk7DQogICAgICAgIGlmICghaW5jbHVkZUhpZGRlbldyaXRlcyAmJiBjb21wb3VuZFdyaXRlSXNFbXB0eShtZXJnZSkpIHsNCiAgICAgICAgICAgIHJldHVybiBjb21wbGV0ZVNlcnZlckNhY2hlOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgLy8gSWYgdGhlIHNlcnZlciBjYWNoZSBpcyBudWxsLCBhbmQgd2UgZG9uJ3QgaGF2ZSBhIGNvbXBsZXRlIGNhY2hlLCB3ZSBuZWVkIHRvIHJldHVybiBudWxsDQogICAgICAgICAgICBpZiAoIWluY2x1ZGVIaWRkZW5Xcml0ZXMgJiYNCiAgICAgICAgICAgICAgICBjb21wbGV0ZVNlcnZlckNhY2hlID09IG51bGwgJiYNCiAgICAgICAgICAgICAgICAhY29tcG91bmRXcml0ZUhhc0NvbXBsZXRlV3JpdGUobWVyZ2UsIG5ld0VtcHR5UGF0aCgpKSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc3QgZmlsdGVyID0gZnVuY3Rpb24gKHdyaXRlKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAoKHdyaXRlLnZpc2libGUgfHwgaW5jbHVkZUhpZGRlbldyaXRlcykgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgICghd3JpdGVJZHNUb0V4Y2x1ZGUgfHwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAhfndyaXRlSWRzVG9FeGNsdWRlLmluZGV4T2Yod3JpdGUud3JpdGVJZCkpICYmDQogICAgICAgICAgICAgICAgICAgICAgICAocGF0aENvbnRhaW5zKHdyaXRlLnBhdGgsIHRyZWVQYXRoKSB8fA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhDb250YWlucyh0cmVlUGF0aCwgd3JpdGUucGF0aCkpKTsNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIGNvbnN0IG1lcmdlQXRQYXRoID0gd3JpdGVUcmVlTGF5ZXJUcmVlXyh3cml0ZVRyZWUuYWxsV3JpdGVzLCBmaWx0ZXIsIHRyZWVQYXRoKTsNCiAgICAgICAgICAgICAgICBjb25zdCBsYXllcmVkQ2FjaGUgPSBjb21wbGV0ZVNlcnZlckNhY2hlIHx8IENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFOw0KICAgICAgICAgICAgICAgIHJldHVybiBjb21wb3VuZFdyaXRlQXBwbHkobWVyZ2VBdFBhdGgsIGxheWVyZWRDYWNoZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQp9DQovKioNCiAqIFdpdGggb3B0aW9uYWwsIHVuZGVybHlpbmcgc2VydmVyIGRhdGEsIGF0dGVtcHQgdG8gcmV0dXJuIGEgY2hpbGRyZW4gbm9kZSBvZiBjaGlsZHJlbiB0aGF0IHdlIGhhdmUgY29tcGxldGUgZGF0YSBmb3IuDQogKiBVc2VkIHdoZW4gY3JlYXRpbmcgbmV3IHZpZXdzLCB0byBwcmUtZmlsbCB0aGVpciBjb21wbGV0ZSBldmVudCBjaGlsZHJlbiBzbmFwc2hvdC4NCiAqLw0KZnVuY3Rpb24gd3JpdGVUcmVlQ2FsY0NvbXBsZXRlRXZlbnRDaGlsZHJlbih3cml0ZVRyZWUsIHRyZWVQYXRoLCBjb21wbGV0ZVNlcnZlckNoaWxkcmVuKSB7DQogICAgbGV0IGNvbXBsZXRlQ2hpbGRyZW4gPSBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTsNCiAgICBjb25zdCB0b3BMZXZlbFNldCA9IGNvbXBvdW5kV3JpdGVHZXRDb21wbGV0ZU5vZGUod3JpdGVUcmVlLnZpc2libGVXcml0ZXMsIHRyZWVQYXRoKTsNCiAgICBpZiAodG9wTGV2ZWxTZXQpIHsNCiAgICAgICAgaWYgKCF0b3BMZXZlbFNldC5pc0xlYWZOb2RlKCkpIHsNCiAgICAgICAgICAgIC8vIHdlJ3JlIHNoYWRvd2luZyBldmVyeXRoaW5nLiBSZXR1cm4gdGhlIGNoaWxkcmVuLg0KICAgICAgICAgICAgdG9wTGV2ZWxTZXQuZm9yRWFjaENoaWxkKFBSSU9SSVRZX0lOREVYLCAoY2hpbGROYW1lLCBjaGlsZFNuYXApID0+IHsNCiAgICAgICAgICAgICAgICBjb21wbGV0ZUNoaWxkcmVuID0gY29tcGxldGVDaGlsZHJlbi51cGRhdGVJbW1lZGlhdGVDaGlsZChjaGlsZE5hbWUsIGNoaWxkU25hcCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gY29tcGxldGVDaGlsZHJlbjsNCiAgICB9DQogICAgZWxzZSBpZiAoY29tcGxldGVTZXJ2ZXJDaGlsZHJlbikgew0KICAgICAgICAvLyBMYXllciBhbnkgY2hpbGRyZW4gd2UgaGF2ZSBvbiB0b3Agb2YgdGhpcw0KICAgICAgICAvLyBXZSBrbm93IHdlIGRvbid0IGhhdmUgYSB0b3AtbGV2ZWwgc2V0LCBzbyBqdXN0IGVudW1lcmF0ZSBleGlzdGluZyBjaGlsZHJlbg0KICAgICAgICBjb25zdCBtZXJnZSA9IGNvbXBvdW5kV3JpdGVDaGlsZENvbXBvdW5kV3JpdGUod3JpdGVUcmVlLnZpc2libGVXcml0ZXMsIHRyZWVQYXRoKTsNCiAgICAgICAgY29tcGxldGVTZXJ2ZXJDaGlsZHJlbi5mb3JFYWNoQ2hpbGQoUFJJT1JJVFlfSU5ERVgsIChjaGlsZE5hbWUsIGNoaWxkTm9kZSkgPT4gew0KICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGNvbXBvdW5kV3JpdGVBcHBseShjb21wb3VuZFdyaXRlQ2hpbGRDb21wb3VuZFdyaXRlKG1lcmdlLCBuZXcgUGF0aChjaGlsZE5hbWUpKSwgY2hpbGROb2RlKTsNCiAgICAgICAgICAgIGNvbXBsZXRlQ2hpbGRyZW4gPSBjb21wbGV0ZUNoaWxkcmVuLnVwZGF0ZUltbWVkaWF0ZUNoaWxkKGNoaWxkTmFtZSwgbm9kZSk7DQogICAgICAgIH0pOw0KICAgICAgICAvLyBBZGQgYW55IGNvbXBsZXRlIGNoaWxkcmVuIHdlIGhhdmUgZnJvbSB0aGUgc2V0DQogICAgICAgIGNvbXBvdW5kV3JpdGVHZXRDb21wbGV0ZUNoaWxkcmVuKG1lcmdlKS5mb3JFYWNoKG5hbWVkTm9kZSA9PiB7DQogICAgICAgICAgICBjb21wbGV0ZUNoaWxkcmVuID0gY29tcGxldGVDaGlsZHJlbi51cGRhdGVJbW1lZGlhdGVDaGlsZChuYW1lZE5vZGUubmFtZSwgbmFtZWROb2RlLm5vZGUpOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIGNvbXBsZXRlQ2hpbGRyZW47DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICAvLyBXZSBkb24ndCBoYXZlIGFueXRoaW5nIHRvIGxheWVyIG9uIHRvcCBvZi4gTGF5ZXIgb24gYW55IGNoaWxkcmVuIHdlIGhhdmUNCiAgICAgICAgLy8gTm90ZSB0aGF0IHdlIGNhbiByZXR1cm4gYW4gZW1wdHkgc25hcCBpZiB3ZSBoYXZlIGEgZGVmaW5lZCBkZWxldGUNCiAgICAgICAgY29uc3QgbWVyZ2UgPSBjb21wb3VuZFdyaXRlQ2hpbGRDb21wb3VuZFdyaXRlKHdyaXRlVHJlZS52aXNpYmxlV3JpdGVzLCB0cmVlUGF0aCk7DQogICAgICAgIGNvbXBvdW5kV3JpdGVHZXRDb21wbGV0ZUNoaWxkcmVuKG1lcmdlKS5mb3JFYWNoKG5hbWVkTm9kZSA9PiB7DQogICAgICAgICAgICBjb21wbGV0ZUNoaWxkcmVuID0gY29tcGxldGVDaGlsZHJlbi51cGRhdGVJbW1lZGlhdGVDaGlsZChuYW1lZE5vZGUubmFtZSwgbmFtZWROb2RlLm5vZGUpOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIGNvbXBsZXRlQ2hpbGRyZW47DQogICAgfQ0KfQ0KLyoqDQogKiBHaXZlbiB0aGF0IHRoZSB1bmRlcmx5aW5nIHNlcnZlciBkYXRhIGhhcyB1cGRhdGVkLCBkZXRlcm1pbmUgd2hhdCwgaWYgYW55dGhpbmcsIG5lZWRzIHRvIGJlDQogKiBhcHBsaWVkIHRvIHRoZSBldmVudCBjYWNoZS4NCiAqDQogKiBQb3NzaWJpbGl0aWVzOg0KICoNCiAqIDEuIE5vIHdyaXRlcyBhcmUgc2hhZG93aW5nLiBFdmVudHMgc2hvdWxkIGJlIHJhaXNlZCwgdGhlIHNuYXAgdG8gYmUgYXBwbGllZCBjb21lcyBmcm9tIHRoZSBzZXJ2ZXIgZGF0YQ0KICoNCiAqIDIuIFNvbWUgd3JpdGUgaXMgY29tcGxldGVseSBzaGFkb3dpbmcuIE5vIGV2ZW50cyB0byBiZSByYWlzZWQNCiAqDQogKiAzLiBJcyBwYXJ0aWFsbHkgc2hhZG93ZWQuIEV2ZW50cw0KICoNCiAqIEVpdGhlciBleGlzdGluZ0V2ZW50U25hcCBvciBleGlzdGluZ1NlcnZlclNuYXAgbXVzdCBleGlzdA0KICovDQpmdW5jdGlvbiB3cml0ZVRyZWVDYWxjRXZlbnRDYWNoZUFmdGVyU2VydmVyT3ZlcndyaXRlKHdyaXRlVHJlZSwgdHJlZVBhdGgsIGNoaWxkUGF0aCwgZXhpc3RpbmdFdmVudFNuYXAsIGV4aXN0aW5nU2VydmVyU25hcCkgew0KICAgIGFzc2VydChleGlzdGluZ0V2ZW50U25hcCB8fCBleGlzdGluZ1NlcnZlclNuYXAsICdFaXRoZXIgZXhpc3RpbmdFdmVudFNuYXAgb3IgZXhpc3RpbmdTZXJ2ZXJTbmFwIG11c3QgZXhpc3QnKTsNCiAgICBjb25zdCBwYXRoID0gcGF0aENoaWxkKHRyZWVQYXRoLCBjaGlsZFBhdGgpOw0KICAgIGlmIChjb21wb3VuZFdyaXRlSGFzQ29tcGxldGVXcml0ZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgcGF0aCkpIHsNCiAgICAgICAgLy8gQXQgdGhpcyBwb2ludCB3ZSBjYW4gcHJvYmFibHkgZ3VhcmFudGVlIHRoYXQgd2UncmUgaW4gY2FzZSAyLCBtZWFuaW5nIG5vIGV2ZW50cw0KICAgICAgICAvLyBNYXkgbmVlZCB0byBjaGVjayB2aXNpYmlsaXR5IHdoaWxlIGRvaW5nIHRoZSBmaW5kUm9vdE1vc3RWYWx1ZUFuZFBhdGggY2FsbA0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIC8vIE5vIGNvbXBsZXRlIHNoYWRvd2luZy4gV2UncmUgZWl0aGVyIHBhcnRpYWxseSBzaGFkb3dpbmcgb3Igbm90IHNoYWRvd2luZyBhdCBhbGwuDQogICAgICAgIGNvbnN0IGNoaWxkTWVyZ2UgPSBjb21wb3VuZFdyaXRlQ2hpbGRDb21wb3VuZFdyaXRlKHdyaXRlVHJlZS52aXNpYmxlV3JpdGVzLCBwYXRoKTsNCiAgICAgICAgaWYgKGNvbXBvdW5kV3JpdGVJc0VtcHR5KGNoaWxkTWVyZ2UpKSB7DQogICAgICAgICAgICAvLyBXZSdyZSBub3Qgc2hhZG93aW5nIGF0IGFsbC4gQ2FzZSAxDQogICAgICAgICAgICByZXR1cm4gZXhpc3RpbmdTZXJ2ZXJTbmFwLmdldENoaWxkKGNoaWxkUGF0aCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAvLyBUaGlzIGNvdWxkIGJlIG1vcmUgZWZmaWNpZW50IGlmIHRoZSBzZXJ2ZXJOb2RlICsgdXBkYXRlcyBkb2Vzbid0IGNoYW5nZSB0aGUgZXZlbnRTbmFwDQogICAgICAgICAgICAvLyBIb3dldmVyIHRoaXMgaXMgdHJpY2t5IHRvIGZpbmQgb3V0LCBzaW5jZSB1c2VyIHVwZGF0ZXMgZG9uJ3QgbmVjZXNzYXJ5IGNoYW5nZSB0aGUgc2VydmVyDQogICAgICAgICAgICAvLyBzbmFwLCBlLmcuIHByaW9yaXR5IHVwZGF0ZXMgb24gZW1wdHkgbm9kZXMsIG9yIGRlZXAgZGVsZXRlcy4gQW5vdGhlciBzcGVjaWFsIGNhc2UgaXMgaWYgdGhlIHNlcnZlcg0KICAgICAgICAgICAgLy8gYWRkcyBub2RlcywgYnV0IGRvZXNuJ3QgY2hhbmdlIGFueSBleGlzdGluZyB3cml0ZXMuIEl0IGlzIHRoZXJlZm9yZSBub3QgZW5vdWdoIHRvDQogICAgICAgICAgICAvLyBvbmx5IGNoZWNrIGlmIHRoZSB1cGRhdGVzIGNoYW5nZSB0aGUgc2VydmVyTm9kZS4NCiAgICAgICAgICAgIC8vIE1heWJlIGNoZWNrIGlmIHRoZSBtZXJnZSB0cmVlIGNvbnRhaW5zIHRoZXNlIHNwZWNpYWwgY2FzZXMgYW5kIG9ubHkgZG8gYSBmdWxsIG92ZXJ3cml0ZSBpbiB0aGF0IGNhc2U/DQogICAgICAgICAgICByZXR1cm4gY29tcG91bmRXcml0ZUFwcGx5KGNoaWxkTWVyZ2UsIGV4aXN0aW5nU2VydmVyU25hcC5nZXRDaGlsZChjaGlsZFBhdGgpKTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCi8qKg0KICogUmV0dXJucyBhIGNvbXBsZXRlIGNoaWxkIGZvciBhIGdpdmVuIHNlcnZlciBzbmFwIGFmdGVyIGFwcGx5aW5nIGFsbCB1c2VyIHdyaXRlcyBvciBudWxsIGlmIHRoZXJlIGlzIG5vDQogKiBjb21wbGV0ZSBjaGlsZCBmb3IgdGhpcyBDaGlsZEtleS4NCiAqLw0KZnVuY3Rpb24gd3JpdGVUcmVlQ2FsY0NvbXBsZXRlQ2hpbGQod3JpdGVUcmVlLCB0cmVlUGF0aCwgY2hpbGRLZXksIGV4aXN0aW5nU2VydmVyU25hcCkgew0KICAgIGNvbnN0IHBhdGggPSBwYXRoQ2hpbGQodHJlZVBhdGgsIGNoaWxkS2V5KTsNCiAgICBjb25zdCBzaGFkb3dpbmdOb2RlID0gY29tcG91bmRXcml0ZUdldENvbXBsZXRlTm9kZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgcGF0aCk7DQogICAgaWYgKHNoYWRvd2luZ05vZGUgIT0gbnVsbCkgew0KICAgICAgICByZXR1cm4gc2hhZG93aW5nTm9kZTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGlmIChleGlzdGluZ1NlcnZlclNuYXAuaXNDb21wbGV0ZUZvckNoaWxkKGNoaWxkS2V5KSkgew0KICAgICAgICAgICAgY29uc3QgY2hpbGRNZXJnZSA9IGNvbXBvdW5kV3JpdGVDaGlsZENvbXBvdW5kV3JpdGUod3JpdGVUcmVlLnZpc2libGVXcml0ZXMsIHBhdGgpOw0KICAgICAgICAgICAgcmV0dXJuIGNvbXBvdW5kV3JpdGVBcHBseShjaGlsZE1lcmdlLCBleGlzdGluZ1NlcnZlclNuYXAuZ2V0Tm9kZSgpLmdldEltbWVkaWF0ZUNoaWxkKGNoaWxkS2V5KSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgIH0NCn0NCi8qKg0KICogUmV0dXJucyBhIG5vZGUgaWYgdGhlcmUgaXMgYSBjb21wbGV0ZSBvdmVyd3JpdGUgZm9yIHRoaXMgcGF0aC4gTW9yZSBzcGVjaWZpY2FsbHksIGlmIHRoZXJlIGlzIGEgd3JpdGUgYXQNCiAqIGEgaGlnaGVyIHBhdGgsIHRoaXMgd2lsbCByZXR1cm4gdGhlIGNoaWxkIG9mIHRoYXQgd3JpdGUgcmVsYXRpdmUgdG8gdGhlIHdyaXRlIGFuZCB0aGlzIHBhdGguDQogKiBSZXR1cm5zIG51bGwgaWYgdGhlcmUgaXMgbm8gd3JpdGUgYXQgdGhpcyBwYXRoLg0KICovDQpmdW5jdGlvbiB3cml0ZVRyZWVTaGFkb3dpbmdXcml0ZSh3cml0ZVRyZWUsIHBhdGgpIHsNCiAgICByZXR1cm4gY29tcG91bmRXcml0ZUdldENvbXBsZXRlTm9kZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgcGF0aCk7DQp9DQovKioNCiAqIFRoaXMgbWV0aG9kIGlzIHVzZWQgd2hlbiBwcm9jZXNzaW5nIGNoaWxkIHJlbW92ZSBldmVudHMgb24gYSBxdWVyeS4gSWYgd2UgY2FuLCB3ZSBwdWxsIGluIGNoaWxkcmVuIHRoYXQgd2VyZSBvdXRzaWRlDQogKiB0aGUgd2luZG93LCBidXQgbWF5IG5vdyBiZSBpbiB0aGUgd2luZG93Lg0KICovDQpmdW5jdGlvbiB3cml0ZVRyZWVDYWxjSW5kZXhlZFNsaWNlKHdyaXRlVHJlZSwgdHJlZVBhdGgsIGNvbXBsZXRlU2VydmVyRGF0YSwgc3RhcnRQb3N0LCBjb3VudCwgcmV2ZXJzZSwgaW5kZXgpIHsNCiAgICBsZXQgdG9JdGVyYXRlOw0KICAgIGNvbnN0IG1lcmdlID0gY29tcG91bmRXcml0ZUNoaWxkQ29tcG91bmRXcml0ZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgdHJlZVBhdGgpOw0KICAgIGNvbnN0IHNoYWRvd2luZ05vZGUgPSBjb21wb3VuZFdyaXRlR2V0Q29tcGxldGVOb2RlKG1lcmdlLCBuZXdFbXB0eVBhdGgoKSk7DQogICAgaWYgKHNoYWRvd2luZ05vZGUgIT0gbnVsbCkgew0KICAgICAgICB0b0l0ZXJhdGUgPSBzaGFkb3dpbmdOb2RlOw0KICAgIH0NCiAgICBlbHNlIGlmIChjb21wbGV0ZVNlcnZlckRhdGEgIT0gbnVsbCkgew0KICAgICAgICB0b0l0ZXJhdGUgPSBjb21wb3VuZFdyaXRlQXBwbHkobWVyZ2UsIGNvbXBsZXRlU2VydmVyRGF0YSk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICAvLyBubyBjaGlsZHJlbiB0byBpdGVyYXRlIG9uDQogICAgICAgIHJldHVybiBbXTsNCiAgICB9DQogICAgdG9JdGVyYXRlID0gdG9JdGVyYXRlLndpdGhJbmRleChpbmRleCk7DQogICAgaWYgKCF0b0l0ZXJhdGUuaXNFbXB0eSgpICYmICF0b0l0ZXJhdGUuaXNMZWFmTm9kZSgpKSB7DQogICAgICAgIGNvbnN0IG5vZGVzID0gW107DQogICAgICAgIGNvbnN0IGNtcCA9IGluZGV4LmdldENvbXBhcmUoKTsNCiAgICAgICAgY29uc3QgaXRlciA9IHJldmVyc2UNCiAgICAgICAgICAgID8gdG9JdGVyYXRlLmdldFJldmVyc2VJdGVyYXRvckZyb20oc3RhcnRQb3N0LCBpbmRleCkNCiAgICAgICAgICAgIDogdG9JdGVyYXRlLmdldEl0ZXJhdG9yRnJvbShzdGFydFBvc3QsIGluZGV4KTsNCiAgICAgICAgbGV0IG5leHQgPSBpdGVyLmdldE5leHQoKTsNCiAgICAgICAgd2hpbGUgKG5leHQgJiYgbm9kZXMubGVuZ3RoIDwgY291bnQpIHsNCiAgICAgICAgICAgIGlmIChjbXAobmV4dCwgc3RhcnRQb3N0KSAhPT0gMCkgew0KICAgICAgICAgICAgICAgIG5vZGVzLnB1c2gobmV4dCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBuZXh0ID0gaXRlci5nZXROZXh0KCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG5vZGVzOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgcmV0dXJuIFtdOw0KICAgIH0NCn0NCmZ1bmN0aW9uIG5ld1dyaXRlVHJlZSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgICB2aXNpYmxlV3JpdGVzOiBDb21wb3VuZFdyaXRlLmVtcHR5KCksDQogICAgICAgIGFsbFdyaXRlczogW10sDQogICAgICAgIGxhc3RXcml0ZUlkOiAtMQ0KICAgIH07DQp9DQovKioNCiAqIElmIHBvc3NpYmxlLCByZXR1cm5zIGEgY29tcGxldGUgZXZlbnQgY2FjaGUsIHVzaW5nIHRoZSB1bmRlcmx5aW5nIHNlcnZlciBkYXRhIGlmIHBvc3NpYmxlLiBJbiBhZGRpdGlvbiwgY2FuIGJlIHVzZWQNCiAqIHRvIGdldCBhIGNhY2hlIHRoYXQgaW5jbHVkZXMgaGlkZGVuIHdyaXRlcywgYW5kIGV4Y2x1ZGVzIGFyYml0cmFyeSB3cml0ZXMuIE5vdGUgdGhhdCBjdXN0b21pemluZyB0aGUgcmV0dXJuZWQgbm9kZQ0KICogY2FuIGxlYWQgdG8gYSBtb3JlIGV4cGVuc2l2ZSBjYWxjdWxhdGlvbi4NCiAqDQogKiBAcGFyYW0gd3JpdGVJZHNUb0V4Y2x1ZGUgLSBPcHRpb25hbCB3cml0ZXMgdG8gZXhjbHVkZS4NCiAqIEBwYXJhbSBpbmNsdWRlSGlkZGVuV3JpdGVzIC0gRGVmYXVsdHMgdG8gZmFsc2UsIHdoZXRoZXIgb3Igbm90IHRvIGxheWVyIG9uIHdyaXRlcyB3aXRoIHZpc2libGUgc2V0IHRvIGZhbHNlDQogKi8NCmZ1bmN0aW9uIHdyaXRlVHJlZVJlZkNhbGNDb21wbGV0ZUV2ZW50Q2FjaGUod3JpdGVUcmVlUmVmLCBjb21wbGV0ZVNlcnZlckNhY2hlLCB3cml0ZUlkc1RvRXhjbHVkZSwgaW5jbHVkZUhpZGRlbldyaXRlcykgew0KICAgIHJldHVybiB3cml0ZVRyZWVDYWxjQ29tcGxldGVFdmVudENhY2hlKHdyaXRlVHJlZVJlZi53cml0ZVRyZWUsIHdyaXRlVHJlZVJlZi50cmVlUGF0aCwgY29tcGxldGVTZXJ2ZXJDYWNoZSwgd3JpdGVJZHNUb0V4Y2x1ZGUsIGluY2x1ZGVIaWRkZW5Xcml0ZXMpOw0KfQ0KLyoqDQogKiBJZiBwb3NzaWJsZSwgcmV0dXJucyBhIGNoaWxkcmVuIG5vZGUgY29udGFpbmluZyBhbGwgb2YgdGhlIGNvbXBsZXRlIGNoaWxkcmVuIHdlIGhhdmUgZGF0YSBmb3IuIFRoZSByZXR1cm5lZCBkYXRhIGlzIGENCiAqIG1peCBvZiB0aGUgZ2l2ZW4gc2VydmVyIGRhdGEgYW5kIHdyaXRlIGRhdGEuDQogKg0KICovDQpmdW5jdGlvbiB3cml0ZVRyZWVSZWZDYWxjQ29tcGxldGVFdmVudENoaWxkcmVuKHdyaXRlVHJlZVJlZiwgY29tcGxldGVTZXJ2ZXJDaGlsZHJlbikgew0KICAgIHJldHVybiB3cml0ZVRyZWVDYWxjQ29tcGxldGVFdmVudENoaWxkcmVuKHdyaXRlVHJlZVJlZi53cml0ZVRyZWUsIHdyaXRlVHJlZVJlZi50cmVlUGF0aCwgY29tcGxldGVTZXJ2ZXJDaGlsZHJlbik7DQp9DQovKioNCiAqIEdpdmVuIHRoYXQgZWl0aGVyIHRoZSB1bmRlcmx5aW5nIHNlcnZlciBkYXRhIGhhcyB1cGRhdGVkIG9yIHRoZSBvdXRzdGFuZGluZyB3cml0ZXMgaGF2ZSB1cGRhdGVkLCBkZXRlcm1pbmUgd2hhdCwNCiAqIGlmIGFueXRoaW5nLCBuZWVkcyB0byBiZSBhcHBsaWVkIHRvIHRoZSBldmVudCBjYWNoZS4NCiAqDQogKiBQb3NzaWJpbGl0aWVzOg0KICoNCiAqIDEuIE5vIHdyaXRlcyBhcmUgc2hhZG93aW5nLiBFdmVudHMgc2hvdWxkIGJlIHJhaXNlZCwgdGhlIHNuYXAgdG8gYmUgYXBwbGllZCBjb21lcyBmcm9tIHRoZSBzZXJ2ZXIgZGF0YQ0KICoNCiAqIDIuIFNvbWUgd3JpdGUgaXMgY29tcGxldGVseSBzaGFkb3dpbmcuIE5vIGV2ZW50cyB0byBiZSByYWlzZWQNCiAqDQogKiAzLiBJcyBwYXJ0aWFsbHkgc2hhZG93ZWQuIEV2ZW50cyBzaG91bGQgYmUgcmFpc2VkDQogKg0KICogRWl0aGVyIGV4aXN0aW5nRXZlbnRTbmFwIG9yIGV4aXN0aW5nU2VydmVyU25hcCBtdXN0IGV4aXN0LCB0aGlzIGlzIHZhbGlkYXRlZCB2aWEgYW4gYXNzZXJ0DQogKg0KICoNCiAqLw0KZnVuY3Rpb24gd3JpdGVUcmVlUmVmQ2FsY0V2ZW50Q2FjaGVBZnRlclNlcnZlck92ZXJ3cml0ZSh3cml0ZVRyZWVSZWYsIHBhdGgsIGV4aXN0aW5nRXZlbnRTbmFwLCBleGlzdGluZ1NlcnZlclNuYXApIHsNCiAgICByZXR1cm4gd3JpdGVUcmVlQ2FsY0V2ZW50Q2FjaGVBZnRlclNlcnZlck92ZXJ3cml0ZSh3cml0ZVRyZWVSZWYud3JpdGVUcmVlLCB3cml0ZVRyZWVSZWYudHJlZVBhdGgsIHBhdGgsIGV4aXN0aW5nRXZlbnRTbmFwLCBleGlzdGluZ1NlcnZlclNuYXApOw0KfQ0KLyoqDQogKiBSZXR1cm5zIGEgbm9kZSBpZiB0aGVyZSBpcyBhIGNvbXBsZXRlIG92ZXJ3cml0ZSBmb3IgdGhpcyBwYXRoLiBNb3JlIHNwZWNpZmljYWxseSwgaWYgdGhlcmUgaXMgYSB3cml0ZSBhdA0KICogYSBoaWdoZXIgcGF0aCwgdGhpcyB3aWxsIHJldHVybiB0aGUgY2hpbGQgb2YgdGhhdCB3cml0ZSByZWxhdGl2ZSB0byB0aGUgd3JpdGUgYW5kIHRoaXMgcGF0aC4NCiAqIFJldHVybnMgbnVsbCBpZiB0aGVyZSBpcyBubyB3cml0ZSBhdCB0aGlzIHBhdGguDQogKg0KICovDQpmdW5jdGlvbiB3cml0ZVRyZWVSZWZTaGFkb3dpbmdXcml0ZSh3cml0ZVRyZWVSZWYsIHBhdGgpIHsNCiAgICByZXR1cm4gd3JpdGVUcmVlU2hhZG93aW5nV3JpdGUod3JpdGVUcmVlUmVmLndyaXRlVHJlZSwgcGF0aENoaWxkKHdyaXRlVHJlZVJlZi50cmVlUGF0aCwgcGF0aCkpOw0KfQ0KLyoqDQogKiBUaGlzIG1ldGhvZCBpcyB1c2VkIHdoZW4gcHJvY2Vzc2luZyBjaGlsZCByZW1vdmUgZXZlbnRzIG9uIGEgcXVlcnkuIElmIHdlIGNhbiwgd2UgcHVsbCBpbiBjaGlsZHJlbiB0aGF0IHdlcmUgb3V0c2lkZQ0KICogdGhlIHdpbmRvdywgYnV0IG1heSBub3cgYmUgaW4gdGhlIHdpbmRvdw0KICovDQpmdW5jdGlvbiB3cml0ZVRyZWVSZWZDYWxjSW5kZXhlZFNsaWNlKHdyaXRlVHJlZVJlZiwgY29tcGxldGVTZXJ2ZXJEYXRhLCBzdGFydFBvc3QsIGNvdW50LCByZXZlcnNlLCBpbmRleCkgew0KICAgIHJldHVybiB3cml0ZVRyZWVDYWxjSW5kZXhlZFNsaWNlKHdyaXRlVHJlZVJlZi53cml0ZVRyZWUsIHdyaXRlVHJlZVJlZi50cmVlUGF0aCwgY29tcGxldGVTZXJ2ZXJEYXRhLCBzdGFydFBvc3QsIGNvdW50LCByZXZlcnNlLCBpbmRleCk7DQp9DQovKioNCiAqIFJldHVybnMgYSBjb21wbGV0ZSBjaGlsZCBmb3IgYSBnaXZlbiBzZXJ2ZXIgc25hcCBhZnRlciBhcHBseWluZyBhbGwgdXNlciB3cml0ZXMgb3IgbnVsbCBpZiB0aGVyZSBpcyBubw0KICogY29tcGxldGUgY2hpbGQgZm9yIHRoaXMgQ2hpbGRLZXkuDQogKi8NCmZ1bmN0aW9uIHdyaXRlVHJlZVJlZkNhbGNDb21wbGV0ZUNoaWxkKHdyaXRlVHJlZVJlZiwgY2hpbGRLZXksIGV4aXN0aW5nU2VydmVyQ2FjaGUpIHsNCiAgICByZXR1cm4gd3JpdGVUcmVlQ2FsY0NvbXBsZXRlQ2hpbGQod3JpdGVUcmVlUmVmLndyaXRlVHJlZSwgd3JpdGVUcmVlUmVmLnRyZWVQYXRoLCBjaGlsZEtleSwgZXhpc3RpbmdTZXJ2ZXJDYWNoZSk7DQp9DQovKioNCiAqIFJldHVybiBhIFdyaXRlVHJlZVJlZiBmb3IgYSBjaGlsZC4NCiAqLw0KZnVuY3Rpb24gd3JpdGVUcmVlUmVmQ2hpbGQod3JpdGVUcmVlUmVmLCBjaGlsZE5hbWUpIHsNCiAgICByZXR1cm4gbmV3V3JpdGVUcmVlUmVmKHBhdGhDaGlsZCh3cml0ZVRyZWVSZWYudHJlZVBhdGgsIGNoaWxkTmFtZSksIHdyaXRlVHJlZVJlZi53cml0ZVRyZWUpOw0KfQ0KZnVuY3Rpb24gbmV3V3JpdGVUcmVlUmVmKHBhdGgsIHdyaXRlVHJlZSkgew0KICAgIHJldHVybiB7DQogICAgICAgIHRyZWVQYXRoOiBwYXRoLA0KICAgICAgICB3cml0ZVRyZWUNCiAgICB9Ow0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY2xhc3MgQ2hpbGRDaGFuZ2VBY2N1bXVsYXRvciB7DQogICAgY29uc3RydWN0b3IoKSB7DQogICAgICAgIHRoaXMuY2hhbmdlTWFwID0gbmV3IE1hcCgpOw0KICAgIH0NCiAgICB0cmFja0NoaWxkQ2hhbmdlKGNoYW5nZSkgew0KICAgICAgICBjb25zdCB0eXBlID0gY2hhbmdlLnR5cGU7DQogICAgICAgIGNvbnN0IGNoaWxkS2V5ID0gY2hhbmdlLmNoaWxkTmFtZTsNCiAgICAgICAgYXNzZXJ0KHR5cGUgPT09ICJjaGlsZF9hZGRlZCIgLyogQ2hhbmdlVHlwZS5DSElMRF9BRERFRCAqLyB8fA0KICAgICAgICAgICAgdHlwZSA9PT0gImNoaWxkX2NoYW5nZWQiIC8qIENoYW5nZVR5cGUuQ0hJTERfQ0hBTkdFRCAqLyB8fA0KICAgICAgICAgICAgdHlwZSA9PT0gImNoaWxkX3JlbW92ZWQiIC8qIENoYW5nZVR5cGUuQ0hJTERfUkVNT1ZFRCAqLywgJ09ubHkgY2hpbGQgY2hhbmdlcyBzdXBwb3J0ZWQgZm9yIHRyYWNraW5nJyk7DQogICAgICAgIGFzc2VydChjaGlsZEtleSAhPT0gJy5wcmlvcml0eScsICdPbmx5IG5vbi1wcmlvcml0eSBjaGlsZCBjaGFuZ2VzIGNhbiBiZSB0cmFja2VkLicpOw0KICAgICAgICBjb25zdCBvbGRDaGFuZ2UgPSB0aGlzLmNoYW5nZU1hcC5nZXQoY2hpbGRLZXkpOw0KICAgICAgICBpZiAob2xkQ2hhbmdlKSB7DQogICAgICAgICAgICBjb25zdCBvbGRUeXBlID0gb2xkQ2hhbmdlLnR5cGU7DQogICAgICAgICAgICBpZiAodHlwZSA9PT0gImNoaWxkX2FkZGVkIiAvKiBDaGFuZ2VUeXBlLkNISUxEX0FEREVEICovICYmDQogICAgICAgICAgICAgICAgb2xkVHlwZSA9PT0gImNoaWxkX3JlbW92ZWQiIC8qIENoYW5nZVR5cGUuQ0hJTERfUkVNT1ZFRCAqLykgew0KICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlTWFwLnNldChjaGlsZEtleSwgY2hhbmdlQ2hpbGRDaGFuZ2VkKGNoaWxkS2V5LCBjaGFuZ2Uuc25hcHNob3ROb2RlLCBvbGRDaGFuZ2Uuc25hcHNob3ROb2RlKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAiY2hpbGRfcmVtb3ZlZCIgLyogQ2hhbmdlVHlwZS5DSElMRF9SRU1PVkVEICovICYmDQogICAgICAgICAgICAgICAgb2xkVHlwZSA9PT0gImNoaWxkX2FkZGVkIiAvKiBDaGFuZ2VUeXBlLkNISUxEX0FEREVEICovKSB7DQogICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VNYXAuZGVsZXRlKGNoaWxkS2V5KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICJjaGlsZF9yZW1vdmVkIiAvKiBDaGFuZ2VUeXBlLkNISUxEX1JFTU9WRUQgKi8gJiYNCiAgICAgICAgICAgICAgICBvbGRUeXBlID09PSAiY2hpbGRfY2hhbmdlZCIgLyogQ2hhbmdlVHlwZS5DSElMRF9DSEFOR0VEICovKSB7DQogICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VNYXAuc2V0KGNoaWxkS2V5LCBjaGFuZ2VDaGlsZFJlbW92ZWQoY2hpbGRLZXksIG9sZENoYW5nZS5vbGRTbmFwKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAiY2hpbGRfY2hhbmdlZCIgLyogQ2hhbmdlVHlwZS5DSElMRF9DSEFOR0VEICovICYmDQogICAgICAgICAgICAgICAgb2xkVHlwZSA9PT0gImNoaWxkX2FkZGVkIiAvKiBDaGFuZ2VUeXBlLkNISUxEX0FEREVEICovKSB7DQogICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VNYXAuc2V0KGNoaWxkS2V5LCBjaGFuZ2VDaGlsZEFkZGVkKGNoaWxkS2V5LCBjaGFuZ2Uuc25hcHNob3ROb2RlKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAiY2hpbGRfY2hhbmdlZCIgLyogQ2hhbmdlVHlwZS5DSElMRF9DSEFOR0VEICovICYmDQogICAgICAgICAgICAgICAgb2xkVHlwZSA9PT0gImNoaWxkX2NoYW5nZWQiIC8qIENoYW5nZVR5cGUuQ0hJTERfQ0hBTkdFRCAqLykgew0KICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlTWFwLnNldChjaGlsZEtleSwgY2hhbmdlQ2hpbGRDaGFuZ2VkKGNoaWxkS2V5LCBjaGFuZ2Uuc25hcHNob3ROb2RlLCBvbGRDaGFuZ2Uub2xkU25hcCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgdGhyb3cgYXNzZXJ0aW9uRXJyb3IoJ0lsbGVnYWwgY29tYmluYXRpb24gb2YgY2hhbmdlczogJyArDQogICAgICAgICAgICAgICAgICAgIGNoYW5nZSArDQogICAgICAgICAgICAgICAgICAgICcgb2NjdXJyZWQgYWZ0ZXIgJyArDQogICAgICAgICAgICAgICAgICAgIG9sZENoYW5nZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICB0aGlzLmNoYW5nZU1hcC5zZXQoY2hpbGRLZXksIGNoYW5nZSk7DQogICAgICAgIH0NCiAgICB9DQogICAgZ2V0Q2hhbmdlcygpIHsNCiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5jaGFuZ2VNYXAudmFsdWVzKCkpOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogQW4gaW1wbGVtZW50YXRpb24gb2YgQ29tcGxldGVDaGlsZFNvdXJjZSB0aGF0IG5ldmVyIHJldHVybnMgYW55IGFkZGl0aW9uYWwgY2hpbGRyZW4NCiAqLw0KLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uYW1pbmctY29udmVudGlvbg0KY2xhc3MgTm9Db21wbGV0ZUNoaWxkU291cmNlXyB7DQogICAgZ2V0Q29tcGxldGVDaGlsZChjaGlsZEtleSkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgZ2V0Q2hpbGRBZnRlckNoaWxkKGluZGV4LCBjaGlsZCwgcmV2ZXJzZSkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQp9DQovKioNCiAqIFNpbmdsZXRvbiBpbnN0YW5jZS4NCiAqLw0KY29uc3QgTk9fQ09NUExFVEVfQ0hJTERfU09VUkNFID0gbmV3IE5vQ29tcGxldGVDaGlsZFNvdXJjZV8oKTsNCi8qKg0KICogQW4gaW1wbGVtZW50YXRpb24gb2YgQ29tcGxldGVDaGlsZFNvdXJjZSB0aGF0IHVzZXMgYSBXcml0ZVRyZWUgaW4gYWRkaXRpb24gdG8gYW55IG90aGVyIHNlcnZlciBkYXRhIG9yDQogKiBvbGQgZXZlbnQgY2FjaGVzIGF2YWlsYWJsZSB0byBjYWxjdWxhdGUgY29tcGxldGUgY2hpbGRyZW4uDQogKi8NCmNsYXNzIFdyaXRlVHJlZUNvbXBsZXRlQ2hpbGRTb3VyY2Ugew0KICAgIGNvbnN0cnVjdG9yKHdyaXRlc18sIHZpZXdDYWNoZV8sIG9wdENvbXBsZXRlU2VydmVyQ2FjaGVfID0gbnVsbCkgew0KICAgICAgICB0aGlzLndyaXRlc18gPSB3cml0ZXNfOw0KICAgICAgICB0aGlzLnZpZXdDYWNoZV8gPSB2aWV3Q2FjaGVfOw0KICAgICAgICB0aGlzLm9wdENvbXBsZXRlU2VydmVyQ2FjaGVfID0gb3B0Q29tcGxldGVTZXJ2ZXJDYWNoZV87DQogICAgfQ0KICAgIGdldENvbXBsZXRlQ2hpbGQoY2hpbGRLZXkpIHsNCiAgICAgICAgY29uc3Qgbm9kZSA9IHRoaXMudmlld0NhY2hlXy5ldmVudENhY2hlOw0KICAgICAgICBpZiAobm9kZS5pc0NvbXBsZXRlRm9yQ2hpbGQoY2hpbGRLZXkpKSB7DQogICAgICAgICAgICByZXR1cm4gbm9kZS5nZXROb2RlKCkuZ2V0SW1tZWRpYXRlQ2hpbGQoY2hpbGRLZXkpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29uc3Qgc2VydmVyTm9kZSA9IHRoaXMub3B0Q29tcGxldGVTZXJ2ZXJDYWNoZV8gIT0gbnVsbA0KICAgICAgICAgICAgICAgID8gbmV3IENhY2hlTm9kZSh0aGlzLm9wdENvbXBsZXRlU2VydmVyQ2FjaGVfLCB0cnVlLCBmYWxzZSkNCiAgICAgICAgICAgICAgICA6IHRoaXMudmlld0NhY2hlXy5zZXJ2ZXJDYWNoZTsNCiAgICAgICAgICAgIHJldHVybiB3cml0ZVRyZWVSZWZDYWxjQ29tcGxldGVDaGlsZCh0aGlzLndyaXRlc18sIGNoaWxkS2V5LCBzZXJ2ZXJOb2RlKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBnZXRDaGlsZEFmdGVyQ2hpbGQoaW5kZXgsIGNoaWxkLCByZXZlcnNlKSB7DQogICAgICAgIGNvbnN0IGNvbXBsZXRlU2VydmVyRGF0YSA9IHRoaXMub3B0Q29tcGxldGVTZXJ2ZXJDYWNoZV8gIT0gbnVsbA0KICAgICAgICAgICAgPyB0aGlzLm9wdENvbXBsZXRlU2VydmVyQ2FjaGVfDQogICAgICAgICAgICA6IHZpZXdDYWNoZUdldENvbXBsZXRlU2VydmVyU25hcCh0aGlzLnZpZXdDYWNoZV8pOw0KICAgICAgICBjb25zdCBub2RlcyA9IHdyaXRlVHJlZVJlZkNhbGNJbmRleGVkU2xpY2UodGhpcy53cml0ZXNfLCBjb21wbGV0ZVNlcnZlckRhdGEsIGNoaWxkLCAxLCByZXZlcnNlLCBpbmRleCk7DQogICAgICAgIGlmIChub2Rlcy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIG5vZGVzWzBdOw0KICAgICAgICB9DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KZnVuY3Rpb24gbmV3Vmlld1Byb2Nlc3NvcihmaWx0ZXIpIHsNCiAgICByZXR1cm4geyBmaWx0ZXIgfTsNCn0NCmZ1bmN0aW9uIHZpZXdQcm9jZXNzb3JBc3NlcnRJbmRleGVkKHZpZXdQcm9jZXNzb3IsIHZpZXdDYWNoZSkgew0KICAgIGFzc2VydCh2aWV3Q2FjaGUuZXZlbnRDYWNoZS5nZXROb2RlKCkuaXNJbmRleGVkKHZpZXdQcm9jZXNzb3IuZmlsdGVyLmdldEluZGV4KCkpLCAnRXZlbnQgc25hcCBub3QgaW5kZXhlZCcpOw0KICAgIGFzc2VydCh2aWV3Q2FjaGUuc2VydmVyQ2FjaGUuZ2V0Tm9kZSgpLmlzSW5kZXhlZCh2aWV3UHJvY2Vzc29yLmZpbHRlci5nZXRJbmRleCgpKSwgJ1NlcnZlciBzbmFwIG5vdCBpbmRleGVkJyk7DQp9DQpmdW5jdGlvbiB2aWV3UHJvY2Vzc29yQXBwbHlPcGVyYXRpb24odmlld1Byb2Nlc3Nvciwgb2xkVmlld0NhY2hlLCBvcGVyYXRpb24sIHdyaXRlc0NhY2hlLCBjb21wbGV0ZUNhY2hlKSB7DQogICAgY29uc3QgYWNjdW11bGF0b3IgPSBuZXcgQ2hpbGRDaGFuZ2VBY2N1bXVsYXRvcigpOw0KICAgIGxldCBuZXdWaWV3Q2FjaGUsIGZpbHRlclNlcnZlck5vZGU7DQogICAgaWYgKG9wZXJhdGlvbi50eXBlID09PSBPcGVyYXRpb25UeXBlLk9WRVJXUklURSkgew0KICAgICAgICBjb25zdCBvdmVyd3JpdGUgPSBvcGVyYXRpb247DQogICAgICAgIGlmIChvdmVyd3JpdGUuc291cmNlLmZyb21Vc2VyKSB7DQogICAgICAgICAgICBuZXdWaWV3Q2FjaGUgPSB2aWV3UHJvY2Vzc29yQXBwbHlVc2VyT3ZlcndyaXRlKHZpZXdQcm9jZXNzb3IsIG9sZFZpZXdDYWNoZSwgb3ZlcndyaXRlLnBhdGgsIG92ZXJ3cml0ZS5zbmFwLCB3cml0ZXNDYWNoZSwgY29tcGxldGVDYWNoZSwgYWNjdW11bGF0b3IpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgYXNzZXJ0KG92ZXJ3cml0ZS5zb3VyY2UuZnJvbVNlcnZlciwgJ1Vua25vd24gc291cmNlLicpOw0KICAgICAgICAgICAgLy8gV2UgZmlsdGVyIHRoZSBub2RlIGlmIGl0J3MgYSB0YWdnZWQgdXBkYXRlIG9yIHRoZSBub2RlIGhhcyBiZWVuIHByZXZpb3VzbHkgZmlsdGVyZWQgIGFuZCB0aGUNCiAgICAgICAgICAgIC8vIHVwZGF0ZSBpcyBub3QgYXQgdGhlIHJvb3QgaW4gd2hpY2ggY2FzZSBpdCBpcyBvayAoYW5kIG5lY2Vzc2FyeSkgdG8gbWFyayB0aGUgbm9kZSB1bmZpbHRlcmVkDQogICAgICAgICAgICAvLyBhZ2Fpbg0KICAgICAgICAgICAgZmlsdGVyU2VydmVyTm9kZSA9DQogICAgICAgICAgICAgICAgb3ZlcndyaXRlLnNvdXJjZS50YWdnZWQgfHwNCiAgICAgICAgICAgICAgICAgICAgKG9sZFZpZXdDYWNoZS5zZXJ2ZXJDYWNoZS5pc0ZpbHRlcmVkKCkgJiYgIXBhdGhJc0VtcHR5KG92ZXJ3cml0ZS5wYXRoKSk7DQogICAgICAgICAgICBuZXdWaWV3Q2FjaGUgPSB2aWV3UHJvY2Vzc29yQXBwbHlTZXJ2ZXJPdmVyd3JpdGUodmlld1Byb2Nlc3Nvciwgb2xkVmlld0NhY2hlLCBvdmVyd3JpdGUucGF0aCwgb3ZlcndyaXRlLnNuYXAsIHdyaXRlc0NhY2hlLCBjb21wbGV0ZUNhY2hlLCBmaWx0ZXJTZXJ2ZXJOb2RlLCBhY2N1bXVsYXRvcik7DQogICAgICAgIH0NCiAgICB9DQogICAgZWxzZSBpZiAob3BlcmF0aW9uLnR5cGUgPT09IE9wZXJhdGlvblR5cGUuTUVSR0UpIHsNCiAgICAgICAgY29uc3QgbWVyZ2UgPSBvcGVyYXRpb247DQogICAgICAgIGlmIChtZXJnZS5zb3VyY2UuZnJvbVVzZXIpIHsNCiAgICAgICAgICAgIG5ld1ZpZXdDYWNoZSA9IHZpZXdQcm9jZXNzb3JBcHBseVVzZXJNZXJnZSh2aWV3UHJvY2Vzc29yLCBvbGRWaWV3Q2FjaGUsIG1lcmdlLnBhdGgsIG1lcmdlLmNoaWxkcmVuLCB3cml0ZXNDYWNoZSwgY29tcGxldGVDYWNoZSwgYWNjdW11bGF0b3IpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgYXNzZXJ0KG1lcmdlLnNvdXJjZS5mcm9tU2VydmVyLCAnVW5rbm93biBzb3VyY2UuJyk7DQogICAgICAgICAgICAvLyBXZSBmaWx0ZXIgdGhlIG5vZGUgaWYgaXQncyBhIHRhZ2dlZCB1cGRhdGUgb3IgdGhlIG5vZGUgaGFzIGJlZW4gcHJldmlvdXNseSBmaWx0ZXJlZA0KICAgICAgICAgICAgZmlsdGVyU2VydmVyTm9kZSA9DQogICAgICAgICAgICAgICAgbWVyZ2Uuc291cmNlLnRhZ2dlZCB8fCBvbGRWaWV3Q2FjaGUuc2VydmVyQ2FjaGUuaXNGaWx0ZXJlZCgpOw0KICAgICAgICAgICAgbmV3Vmlld0NhY2hlID0gdmlld1Byb2Nlc3NvckFwcGx5U2VydmVyTWVyZ2Uodmlld1Byb2Nlc3Nvciwgb2xkVmlld0NhY2hlLCBtZXJnZS5wYXRoLCBtZXJnZS5jaGlsZHJlbiwgd3JpdGVzQ2FjaGUsIGNvbXBsZXRlQ2FjaGUsIGZpbHRlclNlcnZlck5vZGUsIGFjY3VtdWxhdG9yKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBlbHNlIGlmIChvcGVyYXRpb24udHlwZSA9PT0gT3BlcmF0aW9uVHlwZS5BQ0tfVVNFUl9XUklURSkgew0KICAgICAgICBjb25zdCBhY2tVc2VyV3JpdGUgPSBvcGVyYXRpb247DQogICAgICAgIGlmICghYWNrVXNlcldyaXRlLnJldmVydCkgew0KICAgICAgICAgICAgbmV3Vmlld0NhY2hlID0gdmlld1Byb2Nlc3NvckFja1VzZXJXcml0ZSh2aWV3UHJvY2Vzc29yLCBvbGRWaWV3Q2FjaGUsIGFja1VzZXJXcml0ZS5wYXRoLCBhY2tVc2VyV3JpdGUuYWZmZWN0ZWRUcmVlLCB3cml0ZXNDYWNoZSwgY29tcGxldGVDYWNoZSwgYWNjdW11bGF0b3IpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgbmV3Vmlld0NhY2hlID0gdmlld1Byb2Nlc3NvclJldmVydFVzZXJXcml0ZSh2aWV3UHJvY2Vzc29yLCBvbGRWaWV3Q2FjaGUsIGFja1VzZXJXcml0ZS5wYXRoLCB3cml0ZXNDYWNoZSwgY29tcGxldGVDYWNoZSwgYWNjdW11bGF0b3IpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGVsc2UgaWYgKG9wZXJhdGlvbi50eXBlID09PSBPcGVyYXRpb25UeXBlLkxJU1RFTl9DT01QTEVURSkgew0KICAgICAgICBuZXdWaWV3Q2FjaGUgPSB2aWV3UHJvY2Vzc29yTGlzdGVuQ29tcGxldGUodmlld1Byb2Nlc3Nvciwgb2xkVmlld0NhY2hlLCBvcGVyYXRpb24ucGF0aCwgd3JpdGVzQ2FjaGUsIGFjY3VtdWxhdG9yKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIHRocm93IGFzc2VydGlvbkVycm9yKCdVbmtub3duIG9wZXJhdGlvbiB0eXBlOiAnICsgb3BlcmF0aW9uLnR5cGUpOw0KICAgIH0NCiAgICBjb25zdCBjaGFuZ2VzID0gYWNjdW11bGF0b3IuZ2V0Q2hhbmdlcygpOw0KICAgIHZpZXdQcm9jZXNzb3JNYXliZUFkZFZhbHVlRXZlbnQob2xkVmlld0NhY2hlLCBuZXdWaWV3Q2FjaGUsIGNoYW5nZXMpOw0KICAgIHJldHVybiB7IHZpZXdDYWNoZTogbmV3Vmlld0NhY2hlLCBjaGFuZ2VzIH07DQp9DQpmdW5jdGlvbiB2aWV3UHJvY2Vzc29yTWF5YmVBZGRWYWx1ZUV2ZW50KG9sZFZpZXdDYWNoZSwgbmV3Vmlld0NhY2hlLCBhY2N1bXVsYXRvcikgew0KICAgIGNvbnN0IGV2ZW50U25hcCA9IG5ld1ZpZXdDYWNoZS5ldmVudENhY2hlOw0KICAgIGlmIChldmVudFNuYXAuaXNGdWxseUluaXRpYWxpemVkKCkpIHsNCiAgICAgICAgY29uc3QgaXNMZWFmT3JFbXB0eSA9IGV2ZW50U25hcC5nZXROb2RlKCkuaXNMZWFmTm9kZSgpIHx8IGV2ZW50U25hcC5nZXROb2RlKCkuaXNFbXB0eSgpOw0KICAgICAgICBjb25zdCBvbGRDb21wbGV0ZVNuYXAgPSB2aWV3Q2FjaGVHZXRDb21wbGV0ZUV2ZW50U25hcChvbGRWaWV3Q2FjaGUpOw0KICAgICAgICBpZiAoYWNjdW11bGF0b3IubGVuZ3RoID4gMCB8fA0KICAgICAgICAgICAgIW9sZFZpZXdDYWNoZS5ldmVudENhY2hlLmlzRnVsbHlJbml0aWFsaXplZCgpIHx8DQogICAgICAgICAgICAoaXNMZWFmT3JFbXB0eSAmJiAhZXZlbnRTbmFwLmdldE5vZGUoKS5lcXVhbHMob2xkQ29tcGxldGVTbmFwKSkgfHwNCiAgICAgICAgICAgICFldmVudFNuYXAuZ2V0Tm9kZSgpLmdldFByaW9yaXR5KCkuZXF1YWxzKG9sZENvbXBsZXRlU25hcC5nZXRQcmlvcml0eSgpKSkgew0KICAgICAgICAgICAgYWNjdW11bGF0b3IucHVzaChjaGFuZ2VWYWx1ZSh2aWV3Q2FjaGVHZXRDb21wbGV0ZUV2ZW50U25hcChuZXdWaWV3Q2FjaGUpKSk7DQogICAgICAgIH0NCiAgICB9DQp9DQpmdW5jdGlvbiB2aWV3UHJvY2Vzc29yR2VuZXJhdGVFdmVudENhY2hlQWZ0ZXJTZXJ2ZXJFdmVudCh2aWV3UHJvY2Vzc29yLCB2aWV3Q2FjaGUsIGNoYW5nZVBhdGgsIHdyaXRlc0NhY2hlLCBzb3VyY2UsIGFjY3VtdWxhdG9yKSB7DQogICAgY29uc3Qgb2xkRXZlbnRTbmFwID0gdmlld0NhY2hlLmV2ZW50Q2FjaGU7DQogICAgaWYgKHdyaXRlVHJlZVJlZlNoYWRvd2luZ1dyaXRlKHdyaXRlc0NhY2hlLCBjaGFuZ2VQYXRoKSAhPSBudWxsKSB7DQogICAgICAgIC8vIHdlIGhhdmUgYSBzaGFkb3dpbmcgd3JpdGUsIGlnbm9yZSBjaGFuZ2VzDQogICAgICAgIHJldHVybiB2aWV3Q2FjaGU7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBsZXQgbmV3RXZlbnRDYWNoZSwgc2VydmVyTm9kZTsNCiAgICAgICAgaWYgKHBhdGhJc0VtcHR5KGNoYW5nZVBhdGgpKSB7DQogICAgICAgICAgICAvLyBUT0RPOiBmaWd1cmUgb3V0IGhvdyB0aGlzIHBsYXlzIHdpdGggInNsaWRpbmcgYWNrIHdpbmRvd3MiDQogICAgICAgICAgICBhc3NlcnQodmlld0NhY2hlLnNlcnZlckNhY2hlLmlzRnVsbHlJbml0aWFsaXplZCgpLCAnSWYgY2hhbmdlIHBhdGggaXMgZW1wdHksIHdlIG11c3QgaGF2ZSBjb21wbGV0ZSBzZXJ2ZXIgZGF0YScpOw0KICAgICAgICAgICAgaWYgKHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZS5pc0ZpbHRlcmVkKCkpIHsNCiAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIHNwZWNpYWwgY2FzZSB0aGlzLCBiZWNhdXNlIHdlIG5lZWQgdG8gb25seSBhcHBseSB3cml0ZXMgdG8gY29tcGxldGUgY2hpbGRyZW4sIG9yDQogICAgICAgICAgICAgICAgLy8gd2UgbWlnaHQgZW5kIHVwIHJhaXNpbmcgZXZlbnRzIGZvciBpbmNvbXBsZXRlIGNoaWxkcmVuLiBJZiB0aGUgc2VydmVyIGRhdGEgaXMgZmlsdGVyZWQgZGVlcA0KICAgICAgICAgICAgICAgIC8vIHdyaXRlcyBjYW5ub3QgYmUgZ3VhcmFudGVlZCB0byBiZSBjb21wbGV0ZQ0KICAgICAgICAgICAgICAgIGNvbnN0IHNlcnZlckNhY2hlID0gdmlld0NhY2hlR2V0Q29tcGxldGVTZXJ2ZXJTbmFwKHZpZXdDYWNoZSk7DQogICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGVDaGlsZHJlbiA9IHNlcnZlckNhY2hlIGluc3RhbmNlb2YgQ2hpbGRyZW5Ob2RlDQogICAgICAgICAgICAgICAgICAgID8gc2VydmVyQ2FjaGUNCiAgICAgICAgICAgICAgICAgICAgOiBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTsNCiAgICAgICAgICAgICAgICBjb25zdCBjb21wbGV0ZUV2ZW50Q2hpbGRyZW4gPSB3cml0ZVRyZWVSZWZDYWxjQ29tcGxldGVFdmVudENoaWxkcmVuKHdyaXRlc0NhY2hlLCBjb21wbGV0ZUNoaWxkcmVuKTsNCiAgICAgICAgICAgICAgICBuZXdFdmVudENhY2hlID0gdmlld1Byb2Nlc3Nvci5maWx0ZXIudXBkYXRlRnVsbE5vZGUodmlld0NhY2hlLmV2ZW50Q2FjaGUuZ2V0Tm9kZSgpLCBjb21wbGV0ZUV2ZW50Q2hpbGRyZW4sIGFjY3VtdWxhdG9yKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRlTm9kZSA9IHdyaXRlVHJlZVJlZkNhbGNDb21wbGV0ZUV2ZW50Q2FjaGUod3JpdGVzQ2FjaGUsIHZpZXdDYWNoZUdldENvbXBsZXRlU2VydmVyU25hcCh2aWV3Q2FjaGUpKTsNCiAgICAgICAgICAgICAgICBuZXdFdmVudENhY2hlID0gdmlld1Byb2Nlc3Nvci5maWx0ZXIudXBkYXRlRnVsbE5vZGUodmlld0NhY2hlLmV2ZW50Q2FjaGUuZ2V0Tm9kZSgpLCBjb21wbGV0ZU5vZGUsIGFjY3VtdWxhdG9yKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN0IGNoaWxkS2V5ID0gcGF0aEdldEZyb250KGNoYW5nZVBhdGgpOw0KICAgICAgICAgICAgaWYgKGNoaWxkS2V5ID09PSAnLnByaW9yaXR5Jykgew0KICAgICAgICAgICAgICAgIGFzc2VydChwYXRoR2V0TGVuZ3RoKGNoYW5nZVBhdGgpID09PSAxLCAiQ2FuJ3QgaGF2ZSBhIHByaW9yaXR5IHdpdGggYWRkaXRpb25hbCBwYXRoIGNvbXBvbmVudHMiKTsNCiAgICAgICAgICAgICAgICBjb25zdCBvbGRFdmVudE5vZGUgPSBvbGRFdmVudFNuYXAuZ2V0Tm9kZSgpOw0KICAgICAgICAgICAgICAgIHNlcnZlck5vZGUgPSB2aWV3Q2FjaGUuc2VydmVyQ2FjaGUuZ2V0Tm9kZSgpOw0KICAgICAgICAgICAgICAgIC8vIHdlIG1pZ2h0IGhhdmUgb3ZlcndyaXRlcyBmb3IgdGhpcyBwcmlvcml0eQ0KICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRQcmlvcml0eSA9IHdyaXRlVHJlZVJlZkNhbGNFdmVudENhY2hlQWZ0ZXJTZXJ2ZXJPdmVyd3JpdGUod3JpdGVzQ2FjaGUsIGNoYW5nZVBhdGgsIG9sZEV2ZW50Tm9kZSwgc2VydmVyTm9kZSk7DQogICAgICAgICAgICAgICAgaWYgKHVwZGF0ZWRQcmlvcml0eSAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIG5ld0V2ZW50Q2FjaGUgPSB2aWV3UHJvY2Vzc29yLmZpbHRlci51cGRhdGVQcmlvcml0eShvbGRFdmVudE5vZGUsIHVwZGF0ZWRQcmlvcml0eSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAvLyBwcmlvcml0eSBkaWRuJ3QgY2hhbmdlLCBrZWVwIG9sZCBub2RlDQogICAgICAgICAgICAgICAgICAgIG5ld0V2ZW50Q2FjaGUgPSBvbGRFdmVudFNuYXAuZ2V0Tm9kZSgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkQ2hhbmdlUGF0aCA9IHBhdGhQb3BGcm9udChjaGFuZ2VQYXRoKTsNCiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgY2hpbGQNCiAgICAgICAgICAgICAgICBsZXQgbmV3RXZlbnRDaGlsZDsNCiAgICAgICAgICAgICAgICBpZiAob2xkRXZlbnRTbmFwLmlzQ29tcGxldGVGb3JDaGlsZChjaGlsZEtleSkpIHsNCiAgICAgICAgICAgICAgICAgICAgc2VydmVyTm9kZSA9IHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZS5nZXROb2RlKCk7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50Q2hpbGRVcGRhdGUgPSB3cml0ZVRyZWVSZWZDYWxjRXZlbnRDYWNoZUFmdGVyU2VydmVyT3ZlcndyaXRlKHdyaXRlc0NhY2hlLCBjaGFuZ2VQYXRoLCBvbGRFdmVudFNuYXAuZ2V0Tm9kZSgpLCBzZXJ2ZXJOb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50Q2hpbGRVcGRhdGUgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbmV3RXZlbnRDaGlsZCA9IG9sZEV2ZW50U25hcA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXROb2RlKCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0SW1tZWRpYXRlQ2hpbGQoY2hpbGRLZXkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnVwZGF0ZUNoaWxkKGNoaWxkQ2hhbmdlUGF0aCwgZXZlbnRDaGlsZFVwZGF0ZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBOb3RoaW5nIGNoYW5nZWQsIGp1c3Qga2VlcCB0aGUgb2xkIGNoaWxkDQogICAgICAgICAgICAgICAgICAgICAgICBuZXdFdmVudENoaWxkID0gb2xkRXZlbnRTbmFwLmdldE5vZGUoKS5nZXRJbW1lZGlhdGVDaGlsZChjaGlsZEtleSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIG5ld0V2ZW50Q2hpbGQgPSB3cml0ZVRyZWVSZWZDYWxjQ29tcGxldGVDaGlsZCh3cml0ZXNDYWNoZSwgY2hpbGRLZXksIHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChuZXdFdmVudENoaWxkICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgbmV3RXZlbnRDYWNoZSA9IHZpZXdQcm9jZXNzb3IuZmlsdGVyLnVwZGF0ZUNoaWxkKG9sZEV2ZW50U25hcC5nZXROb2RlKCksIGNoaWxkS2V5LCBuZXdFdmVudENoaWxkLCBjaGlsZENoYW5nZVBhdGgsIHNvdXJjZSwgYWNjdW11bGF0b3IpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gbm8gY29tcGxldGUgY2hpbGQgYXZhaWxhYmxlIG9yIG5vIGNoYW5nZQ0KICAgICAgICAgICAgICAgICAgICBuZXdFdmVudENhY2hlID0gb2xkRXZlbnRTbmFwLmdldE5vZGUoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHZpZXdDYWNoZVVwZGF0ZUV2ZW50U25hcCh2aWV3Q2FjaGUsIG5ld0V2ZW50Q2FjaGUsIG9sZEV2ZW50U25hcC5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSB8fCBwYXRoSXNFbXB0eShjaGFuZ2VQYXRoKSwgdmlld1Byb2Nlc3Nvci5maWx0ZXIuZmlsdGVyc05vZGVzKCkpOw0KICAgIH0NCn0NCmZ1bmN0aW9uIHZpZXdQcm9jZXNzb3JBcHBseVNlcnZlck92ZXJ3cml0ZSh2aWV3UHJvY2Vzc29yLCBvbGRWaWV3Q2FjaGUsIGNoYW5nZVBhdGgsIGNoYW5nZWRTbmFwLCB3cml0ZXNDYWNoZSwgY29tcGxldGVDYWNoZSwgZmlsdGVyU2VydmVyTm9kZSwgYWNjdW11bGF0b3IpIHsNCiAgICBjb25zdCBvbGRTZXJ2ZXJTbmFwID0gb2xkVmlld0NhY2hlLnNlcnZlckNhY2hlOw0KICAgIGxldCBuZXdTZXJ2ZXJDYWNoZTsNCiAgICBjb25zdCBzZXJ2ZXJGaWx0ZXIgPSBmaWx0ZXJTZXJ2ZXJOb2RlDQogICAgICAgID8gdmlld1Byb2Nlc3Nvci5maWx0ZXINCiAgICAgICAgOiB2aWV3UHJvY2Vzc29yLmZpbHRlci5nZXRJbmRleGVkRmlsdGVyKCk7DQogICAgaWYgKHBhdGhJc0VtcHR5KGNoYW5nZVBhdGgpKSB7DQogICAgICAgIG5ld1NlcnZlckNhY2hlID0gc2VydmVyRmlsdGVyLnVwZGF0ZUZ1bGxOb2RlKG9sZFNlcnZlclNuYXAuZ2V0Tm9kZSgpLCBjaGFuZ2VkU25hcCwgbnVsbCk7DQogICAgfQ0KICAgIGVsc2UgaWYgKHNlcnZlckZpbHRlci5maWx0ZXJzTm9kZXMoKSAmJiAhb2xkU2VydmVyU25hcC5pc0ZpbHRlcmVkKCkpIHsNCiAgICAgICAgLy8gd2Ugd2FudCB0byBmaWx0ZXIgdGhlIHNlcnZlciBub2RlLCBidXQgd2UgZGlkbid0IGZpbHRlciB0aGUgc2VydmVyIG5vZGUgeWV0LCBzbyBzaW11bGF0ZSBhIGZ1bGwgdXBkYXRlDQogICAgICAgIGNvbnN0IG5ld1NlcnZlck5vZGUgPSBvbGRTZXJ2ZXJTbmFwDQogICAgICAgICAgICAuZ2V0Tm9kZSgpDQogICAgICAgICAgICAudXBkYXRlQ2hpbGQoY2hhbmdlUGF0aCwgY2hhbmdlZFNuYXApOw0KICAgICAgICBuZXdTZXJ2ZXJDYWNoZSA9IHNlcnZlckZpbHRlci51cGRhdGVGdWxsTm9kZShvbGRTZXJ2ZXJTbmFwLmdldE5vZGUoKSwgbmV3U2VydmVyTm9kZSwgbnVsbCk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBjb25zdCBjaGlsZEtleSA9IHBhdGhHZXRGcm9udChjaGFuZ2VQYXRoKTsNCiAgICAgICAgaWYgKCFvbGRTZXJ2ZXJTbmFwLmlzQ29tcGxldGVGb3JQYXRoKGNoYW5nZVBhdGgpICYmDQogICAgICAgICAgICBwYXRoR2V0TGVuZ3RoKGNoYW5nZVBhdGgpID4gMSkgew0KICAgICAgICAgICAgLy8gV2UgZG9uJ3QgdXBkYXRlIGluY29tcGxldGUgbm9kZXMgd2l0aCB1cGRhdGVzIGludGVuZGVkIGZvciBvdGhlciBsaXN0ZW5lcnMNCiAgICAgICAgICAgIHJldHVybiBvbGRWaWV3Q2FjaGU7DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgY2hpbGRDaGFuZ2VQYXRoID0gcGF0aFBvcEZyb250KGNoYW5nZVBhdGgpOw0KICAgICAgICBjb25zdCBjaGlsZE5vZGUgPSBvbGRTZXJ2ZXJTbmFwLmdldE5vZGUoKS5nZXRJbW1lZGlhdGVDaGlsZChjaGlsZEtleSk7DQogICAgICAgIGNvbnN0IG5ld0NoaWxkTm9kZSA9IGNoaWxkTm9kZS51cGRhdGVDaGlsZChjaGlsZENoYW5nZVBhdGgsIGNoYW5nZWRTbmFwKTsNCiAgICAgICAgaWYgKGNoaWxkS2V5ID09PSAnLnByaW9yaXR5Jykgew0KICAgICAgICAgICAgbmV3U2VydmVyQ2FjaGUgPSBzZXJ2ZXJGaWx0ZXIudXBkYXRlUHJpb3JpdHkob2xkU2VydmVyU25hcC5nZXROb2RlKCksIG5ld0NoaWxkTm9kZSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBuZXdTZXJ2ZXJDYWNoZSA9IHNlcnZlckZpbHRlci51cGRhdGVDaGlsZChvbGRTZXJ2ZXJTbmFwLmdldE5vZGUoKSwgY2hpbGRLZXksIG5ld0NoaWxkTm9kZSwgY2hpbGRDaGFuZ2VQYXRoLCBOT19DT01QTEVURV9DSElMRF9TT1VSQ0UsIG51bGwpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGNvbnN0IG5ld1ZpZXdDYWNoZSA9IHZpZXdDYWNoZVVwZGF0ZVNlcnZlclNuYXAob2xkVmlld0NhY2hlLCBuZXdTZXJ2ZXJDYWNoZSwgb2xkU2VydmVyU25hcC5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSB8fCBwYXRoSXNFbXB0eShjaGFuZ2VQYXRoKSwgc2VydmVyRmlsdGVyLmZpbHRlcnNOb2RlcygpKTsNCiAgICBjb25zdCBzb3VyY2UgPSBuZXcgV3JpdGVUcmVlQ29tcGxldGVDaGlsZFNvdXJjZSh3cml0ZXNDYWNoZSwgbmV3Vmlld0NhY2hlLCBjb21wbGV0ZUNhY2hlKTsNCiAgICByZXR1cm4gdmlld1Byb2Nlc3NvckdlbmVyYXRlRXZlbnRDYWNoZUFmdGVyU2VydmVyRXZlbnQodmlld1Byb2Nlc3NvciwgbmV3Vmlld0NhY2hlLCBjaGFuZ2VQYXRoLCB3cml0ZXNDYWNoZSwgc291cmNlLCBhY2N1bXVsYXRvcik7DQp9DQpmdW5jdGlvbiB2aWV3UHJvY2Vzc29yQXBwbHlVc2VyT3ZlcndyaXRlKHZpZXdQcm9jZXNzb3IsIG9sZFZpZXdDYWNoZSwgY2hhbmdlUGF0aCwgY2hhbmdlZFNuYXAsIHdyaXRlc0NhY2hlLCBjb21wbGV0ZUNhY2hlLCBhY2N1bXVsYXRvcikgew0KICAgIGNvbnN0IG9sZEV2ZW50U25hcCA9IG9sZFZpZXdDYWNoZS5ldmVudENhY2hlOw0KICAgIGxldCBuZXdWaWV3Q2FjaGUsIG5ld0V2ZW50Q2FjaGU7DQogICAgY29uc3Qgc291cmNlID0gbmV3IFdyaXRlVHJlZUNvbXBsZXRlQ2hpbGRTb3VyY2Uod3JpdGVzQ2FjaGUsIG9sZFZpZXdDYWNoZSwgY29tcGxldGVDYWNoZSk7DQogICAgaWYgKHBhdGhJc0VtcHR5KGNoYW5nZVBhdGgpKSB7DQogICAgICAgIG5ld0V2ZW50Q2FjaGUgPSB2aWV3UHJvY2Vzc29yLmZpbHRlci51cGRhdGVGdWxsTm9kZShvbGRWaWV3Q2FjaGUuZXZlbnRDYWNoZS5nZXROb2RlKCksIGNoYW5nZWRTbmFwLCBhY2N1bXVsYXRvcik7DQogICAgICAgIG5ld1ZpZXdDYWNoZSA9IHZpZXdDYWNoZVVwZGF0ZUV2ZW50U25hcChvbGRWaWV3Q2FjaGUsIG5ld0V2ZW50Q2FjaGUsIHRydWUsIHZpZXdQcm9jZXNzb3IuZmlsdGVyLmZpbHRlcnNOb2RlcygpKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGNvbnN0IGNoaWxkS2V5ID0gcGF0aEdldEZyb250KGNoYW5nZVBhdGgpOw0KICAgICAgICBpZiAoY2hpbGRLZXkgPT09ICcucHJpb3JpdHknKSB7DQogICAgICAgICAgICBuZXdFdmVudENhY2hlID0gdmlld1Byb2Nlc3Nvci5maWx0ZXIudXBkYXRlUHJpb3JpdHkob2xkVmlld0NhY2hlLmV2ZW50Q2FjaGUuZ2V0Tm9kZSgpLCBjaGFuZ2VkU25hcCk7DQogICAgICAgICAgICBuZXdWaWV3Q2FjaGUgPSB2aWV3Q2FjaGVVcGRhdGVFdmVudFNuYXAob2xkVmlld0NhY2hlLCBuZXdFdmVudENhY2hlLCBvbGRFdmVudFNuYXAuaXNGdWxseUluaXRpYWxpemVkKCksIG9sZEV2ZW50U25hcC5pc0ZpbHRlcmVkKCkpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29uc3QgY2hpbGRDaGFuZ2VQYXRoID0gcGF0aFBvcEZyb250KGNoYW5nZVBhdGgpOw0KICAgICAgICAgICAgY29uc3Qgb2xkQ2hpbGQgPSBvbGRFdmVudFNuYXAuZ2V0Tm9kZSgpLmdldEltbWVkaWF0ZUNoaWxkKGNoaWxkS2V5KTsNCiAgICAgICAgICAgIGxldCBuZXdDaGlsZDsNCiAgICAgICAgICAgIGlmIChwYXRoSXNFbXB0eShjaGlsZENoYW5nZVBhdGgpKSB7DQogICAgICAgICAgICAgICAgLy8gQ2hpbGQgb3ZlcndyaXRlLCB3ZSBjYW4gcmVwbGFjZSB0aGUgY2hpbGQNCiAgICAgICAgICAgICAgICBuZXdDaGlsZCA9IGNoYW5nZWRTbmFwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc3QgY2hpbGROb2RlID0gc291cmNlLmdldENvbXBsZXRlQ2hpbGQoY2hpbGRLZXkpOw0KICAgICAgICAgICAgICAgIGlmIChjaGlsZE5vZGUgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAocGF0aEdldEJhY2soY2hpbGRDaGFuZ2VQYXRoKSA9PT0gJy5wcmlvcml0eScgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkTm9kZS5nZXRDaGlsZChwYXRoUGFyZW50KGNoaWxkQ2hhbmdlUGF0aCkpLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIHByaW9yaXR5IHVwZGF0ZSBvbiBhbiBlbXB0eSBub2RlLiBJZiB0aGlzIG5vZGUgZXhpc3RzIG9uIHRoZSBzZXJ2ZXIsIHRoZQ0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2VydmVyIHdpbGwgc2VuZCBkb3duIHRoZSBwcmlvcml0eSBpbiB0aGUgdXBkYXRlLCBzbyBpZ25vcmUgZm9yIG5vdw0KICAgICAgICAgICAgICAgICAgICAgICAgbmV3Q2hpbGQgPSBjaGlsZE5vZGU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBuZXdDaGlsZCA9IGNoaWxkTm9kZS51cGRhdGVDaGlsZChjaGlsZENoYW5nZVBhdGgsIGNoYW5nZWRTbmFwKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gVGhlcmUgaXMgbm8gY29tcGxldGUgY2hpbGQgbm9kZSBhdmFpbGFibGUNCiAgICAgICAgICAgICAgICAgICAgbmV3Q2hpbGQgPSBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIW9sZENoaWxkLmVxdWFscyhuZXdDaGlsZCkpIHsNCiAgICAgICAgICAgICAgICBjb25zdCBuZXdFdmVudFNuYXAgPSB2aWV3UHJvY2Vzc29yLmZpbHRlci51cGRhdGVDaGlsZChvbGRFdmVudFNuYXAuZ2V0Tm9kZSgpLCBjaGlsZEtleSwgbmV3Q2hpbGQsIGNoaWxkQ2hhbmdlUGF0aCwgc291cmNlLCBhY2N1bXVsYXRvcik7DQogICAgICAgICAgICAgICAgbmV3Vmlld0NhY2hlID0gdmlld0NhY2hlVXBkYXRlRXZlbnRTbmFwKG9sZFZpZXdDYWNoZSwgbmV3RXZlbnRTbmFwLCBvbGRFdmVudFNuYXAuaXNGdWxseUluaXRpYWxpemVkKCksIHZpZXdQcm9jZXNzb3IuZmlsdGVyLmZpbHRlcnNOb2RlcygpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIG5ld1ZpZXdDYWNoZSA9IG9sZFZpZXdDYWNoZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gbmV3Vmlld0NhY2hlOw0KfQ0KZnVuY3Rpb24gdmlld1Byb2Nlc3NvckNhY2hlSGFzQ2hpbGQodmlld0NhY2hlLCBjaGlsZEtleSkgew0KICAgIHJldHVybiB2aWV3Q2FjaGUuZXZlbnRDYWNoZS5pc0NvbXBsZXRlRm9yQ2hpbGQoY2hpbGRLZXkpOw0KfQ0KZnVuY3Rpb24gdmlld1Byb2Nlc3NvckFwcGx5VXNlck1lcmdlKHZpZXdQcm9jZXNzb3IsIHZpZXdDYWNoZSwgcGF0aCwgY2hhbmdlZENoaWxkcmVuLCB3cml0ZXNDYWNoZSwgc2VydmVyQ2FjaGUsIGFjY3VtdWxhdG9yKSB7DQogICAgLy8gSEFDSzogSW4gdGhlIGNhc2Ugb2YgYSBsaW1pdCBxdWVyeSwgdGhlcmUgbWF5IGJlIHNvbWUgY2hhbmdlcyB0aGF0IGJ1bXAgdGhpbmdzIG91dCBvZiB0aGUNCiAgICAvLyB3aW5kb3cgbGVhdmluZyByb29tIGZvciBuZXcgaXRlbXMuICBJdCdzIGltcG9ydGFudCB3ZSBwcm9jZXNzIHRoZXNlIGNoYW5nZXMgZmlyc3QsIHNvIHdlDQogICAgLy8gaXRlcmF0ZSB0aGUgY2hhbmdlcyB0d2ljZSwgZmlyc3QgcHJvY2Vzc2luZyBhbnkgdGhhdCBhZmZlY3QgaXRlbXMgY3VycmVudGx5IGluIHZpZXcuDQogICAgLy8gVE9ETzogSSBjb25zaWRlciBhbiBpdGVtICJpbiB2aWV3IiBpZiBjYWNoZUhhc0NoaWxkIGlzIHRydWUsIHdoaWNoIGNoZWNrcyBib3RoIHRoZSBzZXJ2ZXINCiAgICAvLyBhbmQgZXZlbnQgc25hcC4gIEknbSBub3Qgc3VyZSBpZiB0aGlzIHdpbGwgcmVzdWx0IGluIGVkZ2UgY2FzZXMgd2hlbiBhIGNoaWxkIGlzIGluIG9uZSBidXQNCiAgICAvLyBub3QgdGhlIG90aGVyLg0KICAgIGxldCBjdXJWaWV3Q2FjaGUgPSB2aWV3Q2FjaGU7DQogICAgY2hhbmdlZENoaWxkcmVuLmZvcmVhY2goKHJlbGF0aXZlUGF0aCwgY2hpbGROb2RlKSA9PiB7DQogICAgICAgIGNvbnN0IHdyaXRlUGF0aCA9IHBhdGhDaGlsZChwYXRoLCByZWxhdGl2ZVBhdGgpOw0KICAgICAgICBpZiAodmlld1Byb2Nlc3NvckNhY2hlSGFzQ2hpbGQodmlld0NhY2hlLCBwYXRoR2V0RnJvbnQod3JpdGVQYXRoKSkpIHsNCiAgICAgICAgICAgIGN1clZpZXdDYWNoZSA9IHZpZXdQcm9jZXNzb3JBcHBseVVzZXJPdmVyd3JpdGUodmlld1Byb2Nlc3NvciwgY3VyVmlld0NhY2hlLCB3cml0ZVBhdGgsIGNoaWxkTm9kZSwgd3JpdGVzQ2FjaGUsIHNlcnZlckNhY2hlLCBhY2N1bXVsYXRvcik7DQogICAgICAgIH0NCiAgICB9KTsNCiAgICBjaGFuZ2VkQ2hpbGRyZW4uZm9yZWFjaCgocmVsYXRpdmVQYXRoLCBjaGlsZE5vZGUpID0+IHsNCiAgICAgICAgY29uc3Qgd3JpdGVQYXRoID0gcGF0aENoaWxkKHBhdGgsIHJlbGF0aXZlUGF0aCk7DQogICAgICAgIGlmICghdmlld1Byb2Nlc3NvckNhY2hlSGFzQ2hpbGQodmlld0NhY2hlLCBwYXRoR2V0RnJvbnQod3JpdGVQYXRoKSkpIHsNCiAgICAgICAgICAgIGN1clZpZXdDYWNoZSA9IHZpZXdQcm9jZXNzb3JBcHBseVVzZXJPdmVyd3JpdGUodmlld1Byb2Nlc3NvciwgY3VyVmlld0NhY2hlLCB3cml0ZVBhdGgsIGNoaWxkTm9kZSwgd3JpdGVzQ2FjaGUsIHNlcnZlckNhY2hlLCBhY2N1bXVsYXRvcik7DQogICAgICAgIH0NCiAgICB9KTsNCiAgICByZXR1cm4gY3VyVmlld0NhY2hlOw0KfQ0KZnVuY3Rpb24gdmlld1Byb2Nlc3NvckFwcGx5TWVyZ2Uodmlld1Byb2Nlc3Nvciwgbm9kZSwgbWVyZ2UpIHsNCiAgICBtZXJnZS5mb3JlYWNoKChyZWxhdGl2ZVBhdGgsIGNoaWxkTm9kZSkgPT4gew0KICAgICAgICBub2RlID0gbm9kZS51cGRhdGVDaGlsZChyZWxhdGl2ZVBhdGgsIGNoaWxkTm9kZSk7DQogICAgfSk7DQogICAgcmV0dXJuIG5vZGU7DQp9DQpmdW5jdGlvbiB2aWV3UHJvY2Vzc29yQXBwbHlTZXJ2ZXJNZXJnZSh2aWV3UHJvY2Vzc29yLCB2aWV3Q2FjaGUsIHBhdGgsIGNoYW5nZWRDaGlsZHJlbiwgd3JpdGVzQ2FjaGUsIHNlcnZlckNhY2hlLCBmaWx0ZXJTZXJ2ZXJOb2RlLCBhY2N1bXVsYXRvcikgew0KICAgIC8vIElmIHdlIGRvbid0IGhhdmUgYSBjYWNoZSB5ZXQsIHRoaXMgbWVyZ2Ugd2FzIGludGVuZGVkIGZvciBhIHByZXZpb3VzbHkgbGlzdGVuIGluIHRoZSBzYW1lIGxvY2F0aW9uLiBJZ25vcmUgaXQgYW5kDQogICAgLy8gd2FpdCBmb3IgdGhlIGNvbXBsZXRlIGRhdGEgdXBkYXRlIGNvbWluZyBzb29uLg0KICAgIGlmICh2aWV3Q2FjaGUuc2VydmVyQ2FjaGUuZ2V0Tm9kZSgpLmlzRW1wdHkoKSAmJg0KICAgICAgICAhdmlld0NhY2hlLnNlcnZlckNhY2hlLmlzRnVsbHlJbml0aWFsaXplZCgpKSB7DQogICAgICAgIHJldHVybiB2aWV3Q2FjaGU7DQogICAgfQ0KICAgIC8vIEhBQ0s6IEluIHRoZSBjYXNlIG9mIGEgbGltaXQgcXVlcnksIHRoZXJlIG1heSBiZSBzb21lIGNoYW5nZXMgdGhhdCBidW1wIHRoaW5ncyBvdXQgb2YgdGhlDQogICAgLy8gd2luZG93IGxlYXZpbmcgcm9vbSBmb3IgbmV3IGl0ZW1zLiAgSXQncyBpbXBvcnRhbnQgd2UgcHJvY2VzcyB0aGVzZSBjaGFuZ2VzIGZpcnN0LCBzbyB3ZQ0KICAgIC8vIGl0ZXJhdGUgdGhlIGNoYW5nZXMgdHdpY2UsIGZpcnN0IHByb2Nlc3NpbmcgYW55IHRoYXQgYWZmZWN0IGl0ZW1zIGN1cnJlbnRseSBpbiB2aWV3Lg0KICAgIC8vIFRPRE86IEkgY29uc2lkZXIgYW4gaXRlbSAiaW4gdmlldyIgaWYgY2FjaGVIYXNDaGlsZCBpcyB0cnVlLCB3aGljaCBjaGVja3MgYm90aCB0aGUgc2VydmVyDQogICAgLy8gYW5kIGV2ZW50IHNuYXAuICBJJ20gbm90IHN1cmUgaWYgdGhpcyB3aWxsIHJlc3VsdCBpbiBlZGdlIGNhc2VzIHdoZW4gYSBjaGlsZCBpcyBpbiBvbmUgYnV0DQogICAgLy8gbm90IHRoZSBvdGhlci4NCiAgICBsZXQgY3VyVmlld0NhY2hlID0gdmlld0NhY2hlOw0KICAgIGxldCB2aWV3TWVyZ2VUcmVlOw0KICAgIGlmIChwYXRoSXNFbXB0eShwYXRoKSkgew0KICAgICAgICB2aWV3TWVyZ2VUcmVlID0gY2hhbmdlZENoaWxkcmVuOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgdmlld01lcmdlVHJlZSA9IG5ldyBJbW11dGFibGVUcmVlKG51bGwpLnNldFRyZWUocGF0aCwgY2hhbmdlZENoaWxkcmVuKTsNCiAgICB9DQogICAgY29uc3Qgc2VydmVyTm9kZSA9IHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZS5nZXROb2RlKCk7DQogICAgdmlld01lcmdlVHJlZS5jaGlsZHJlbi5pbm9yZGVyVHJhdmVyc2FsKChjaGlsZEtleSwgY2hpbGRUcmVlKSA9PiB7DQogICAgICAgIGlmIChzZXJ2ZXJOb2RlLmhhc0NoaWxkKGNoaWxkS2V5KSkgew0KICAgICAgICAgICAgY29uc3Qgc2VydmVyQ2hpbGQgPSB2aWV3Q2FjaGUuc2VydmVyQ2FjaGUNCiAgICAgICAgICAgICAgICAuZ2V0Tm9kZSgpDQogICAgICAgICAgICAgICAgLmdldEltbWVkaWF0ZUNoaWxkKGNoaWxkS2V5KTsNCiAgICAgICAgICAgIGNvbnN0IG5ld0NoaWxkID0gdmlld1Byb2Nlc3NvckFwcGx5TWVyZ2Uodmlld1Byb2Nlc3Nvciwgc2VydmVyQ2hpbGQsIGNoaWxkVHJlZSk7DQogICAgICAgICAgICBjdXJWaWV3Q2FjaGUgPSB2aWV3UHJvY2Vzc29yQXBwbHlTZXJ2ZXJPdmVyd3JpdGUodmlld1Byb2Nlc3NvciwgY3VyVmlld0NhY2hlLCBuZXcgUGF0aChjaGlsZEtleSksIG5ld0NoaWxkLCB3cml0ZXNDYWNoZSwgc2VydmVyQ2FjaGUsIGZpbHRlclNlcnZlck5vZGUsIGFjY3VtdWxhdG9yKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHZpZXdNZXJnZVRyZWUuY2hpbGRyZW4uaW5vcmRlclRyYXZlcnNhbCgoY2hpbGRLZXksIGNoaWxkTWVyZ2VUcmVlKSA9PiB7DQogICAgICAgIGNvbnN0IGlzVW5rbm93bkRlZXBNZXJnZSA9ICF2aWV3Q2FjaGUuc2VydmVyQ2FjaGUuaXNDb21wbGV0ZUZvckNoaWxkKGNoaWxkS2V5KSAmJg0KICAgICAgICAgICAgY2hpbGRNZXJnZVRyZWUudmFsdWUgPT09IG51bGw7DQogICAgICAgIGlmICghc2VydmVyTm9kZS5oYXNDaGlsZChjaGlsZEtleSkgJiYgIWlzVW5rbm93bkRlZXBNZXJnZSkgew0KICAgICAgICAgICAgY29uc3Qgc2VydmVyQ2hpbGQgPSB2aWV3Q2FjaGUuc2VydmVyQ2FjaGUNCiAgICAgICAgICAgICAgICAuZ2V0Tm9kZSgpDQogICAgICAgICAgICAgICAgLmdldEltbWVkaWF0ZUNoaWxkKGNoaWxkS2V5KTsNCiAgICAgICAgICAgIGNvbnN0IG5ld0NoaWxkID0gdmlld1Byb2Nlc3NvckFwcGx5TWVyZ2Uodmlld1Byb2Nlc3Nvciwgc2VydmVyQ2hpbGQsIGNoaWxkTWVyZ2VUcmVlKTsNCiAgICAgICAgICAgIGN1clZpZXdDYWNoZSA9IHZpZXdQcm9jZXNzb3JBcHBseVNlcnZlck92ZXJ3cml0ZSh2aWV3UHJvY2Vzc29yLCBjdXJWaWV3Q2FjaGUsIG5ldyBQYXRoKGNoaWxkS2V5KSwgbmV3Q2hpbGQsIHdyaXRlc0NhY2hlLCBzZXJ2ZXJDYWNoZSwgZmlsdGVyU2VydmVyTm9kZSwgYWNjdW11bGF0b3IpOw0KICAgICAgICB9DQogICAgfSk7DQogICAgcmV0dXJuIGN1clZpZXdDYWNoZTsNCn0NCmZ1bmN0aW9uIHZpZXdQcm9jZXNzb3JBY2tVc2VyV3JpdGUodmlld1Byb2Nlc3Nvciwgdmlld0NhY2hlLCBhY2tQYXRoLCBhZmZlY3RlZFRyZWUsIHdyaXRlc0NhY2hlLCBjb21wbGV0ZUNhY2hlLCBhY2N1bXVsYXRvcikgew0KICAgIGlmICh3cml0ZVRyZWVSZWZTaGFkb3dpbmdXcml0ZSh3cml0ZXNDYWNoZSwgYWNrUGF0aCkgIT0gbnVsbCkgew0KICAgICAgICByZXR1cm4gdmlld0NhY2hlOw0KICAgIH0NCiAgICAvLyBPbmx5IGZpbHRlciBzZXJ2ZXIgbm9kZSBpZiBpdCBpcyBjdXJyZW50bHkgZmlsdGVyZWQNCiAgICBjb25zdCBmaWx0ZXJTZXJ2ZXJOb2RlID0gdmlld0NhY2hlLnNlcnZlckNhY2hlLmlzRmlsdGVyZWQoKTsNCiAgICAvLyBFc3NlbnRpYWxseSB3ZSdsbCBqdXN0IGdldCBvdXIgZXhpc3Rpbmcgc2VydmVyIGNhY2hlIGZvciB0aGUgYWZmZWN0ZWQgcGF0aHMgYW5kIHJlLWFwcGx5IGl0IGFzIGEgc2VydmVyIHVwZGF0ZQ0KICAgIC8vIG5vdyB0aGF0IGl0IHdvbid0IGJlIHNoYWRvd2VkLg0KICAgIGNvbnN0IHNlcnZlckNhY2hlID0gdmlld0NhY2hlLnNlcnZlckNhY2hlOw0KICAgIGlmIChhZmZlY3RlZFRyZWUudmFsdWUgIT0gbnVsbCkgew0KICAgICAgICAvLyBUaGlzIGlzIGFuIG92ZXJ3cml0ZS4NCiAgICAgICAgaWYgKChwYXRoSXNFbXB0eShhY2tQYXRoKSAmJiBzZXJ2ZXJDYWNoZS5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSkgfHwNCiAgICAgICAgICAgIHNlcnZlckNhY2hlLmlzQ29tcGxldGVGb3JQYXRoKGFja1BhdGgpKSB7DQogICAgICAgICAgICByZXR1cm4gdmlld1Byb2Nlc3NvckFwcGx5U2VydmVyT3ZlcndyaXRlKHZpZXdQcm9jZXNzb3IsIHZpZXdDYWNoZSwgYWNrUGF0aCwgc2VydmVyQ2FjaGUuZ2V0Tm9kZSgpLmdldENoaWxkKGFja1BhdGgpLCB3cml0ZXNDYWNoZSwgY29tcGxldGVDYWNoZSwgZmlsdGVyU2VydmVyTm9kZSwgYWNjdW11bGF0b3IpOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKHBhdGhJc0VtcHR5KGFja1BhdGgpKSB7DQogICAgICAgICAgICAvLyBUaGlzIGlzIGEgZ29vZnkgZWRnZSBjYXNlIHdoZXJlIHdlIGFyZSBhY2tpbmcgZGF0YSBhdCB0aGlzIGxvY2F0aW9uIGJ1dCBkb24ndCBoYXZlIGZ1bGwgZGF0YS4gIFdlDQogICAgICAgICAgICAvLyBzaG91bGQganVzdCByZS1hcHBseSB3aGF0ZXZlciB3ZSBoYXZlIGluIG91ciBjYWNoZSBhcyBhIG1lcmdlLg0KICAgICAgICAgICAgbGV0IGNoYW5nZWRDaGlsZHJlbiA9IG5ldyBJbW11dGFibGVUcmVlKG51bGwpOw0KICAgICAgICAgICAgc2VydmVyQ2FjaGUuZ2V0Tm9kZSgpLmZvckVhY2hDaGlsZChLRVlfSU5ERVgsIChuYW1lLCBub2RlKSA9PiB7DQogICAgICAgICAgICAgICAgY2hhbmdlZENoaWxkcmVuID0gY2hhbmdlZENoaWxkcmVuLnNldChuZXcgUGF0aChuYW1lKSwgbm9kZSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIHJldHVybiB2aWV3UHJvY2Vzc29yQXBwbHlTZXJ2ZXJNZXJnZSh2aWV3UHJvY2Vzc29yLCB2aWV3Q2FjaGUsIGFja1BhdGgsIGNoYW5nZWRDaGlsZHJlbiwgd3JpdGVzQ2FjaGUsIGNvbXBsZXRlQ2FjaGUsIGZpbHRlclNlcnZlck5vZGUsIGFjY3VtdWxhdG9yKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB2aWV3Q2FjaGU7DQogICAgICAgIH0NCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIC8vIFRoaXMgaXMgYSBtZXJnZS4NCiAgICAgICAgbGV0IGNoYW5nZWRDaGlsZHJlbiA9IG5ldyBJbW11dGFibGVUcmVlKG51bGwpOw0KICAgICAgICBhZmZlY3RlZFRyZWUuZm9yZWFjaCgobWVyZ2VQYXRoLCB2YWx1ZSkgPT4gew0KICAgICAgICAgICAgY29uc3Qgc2VydmVyQ2FjaGVQYXRoID0gcGF0aENoaWxkKGFja1BhdGgsIG1lcmdlUGF0aCk7DQogICAgICAgICAgICBpZiAoc2VydmVyQ2FjaGUuaXNDb21wbGV0ZUZvclBhdGgoc2VydmVyQ2FjaGVQYXRoKSkgew0KICAgICAgICAgICAgICAgIGNoYW5nZWRDaGlsZHJlbiA9IGNoYW5nZWRDaGlsZHJlbi5zZXQobWVyZ2VQYXRoLCBzZXJ2ZXJDYWNoZS5nZXROb2RlKCkuZ2V0Q2hpbGQoc2VydmVyQ2FjaGVQYXRoKSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gdmlld1Byb2Nlc3NvckFwcGx5U2VydmVyTWVyZ2Uodmlld1Byb2Nlc3Nvciwgdmlld0NhY2hlLCBhY2tQYXRoLCBjaGFuZ2VkQ2hpbGRyZW4sIHdyaXRlc0NhY2hlLCBjb21wbGV0ZUNhY2hlLCBmaWx0ZXJTZXJ2ZXJOb2RlLCBhY2N1bXVsYXRvcik7DQogICAgfQ0KfQ0KZnVuY3Rpb24gdmlld1Byb2Nlc3Nvckxpc3RlbkNvbXBsZXRlKHZpZXdQcm9jZXNzb3IsIHZpZXdDYWNoZSwgcGF0aCwgd3JpdGVzQ2FjaGUsIGFjY3VtdWxhdG9yKSB7DQogICAgY29uc3Qgb2xkU2VydmVyTm9kZSA9IHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZTsNCiAgICBjb25zdCBuZXdWaWV3Q2FjaGUgPSB2aWV3Q2FjaGVVcGRhdGVTZXJ2ZXJTbmFwKHZpZXdDYWNoZSwgb2xkU2VydmVyTm9kZS5nZXROb2RlKCksIG9sZFNlcnZlck5vZGUuaXNGdWxseUluaXRpYWxpemVkKCkgfHwgcGF0aElzRW1wdHkocGF0aCksIG9sZFNlcnZlck5vZGUuaXNGaWx0ZXJlZCgpKTsNCiAgICByZXR1cm4gdmlld1Byb2Nlc3NvckdlbmVyYXRlRXZlbnRDYWNoZUFmdGVyU2VydmVyRXZlbnQodmlld1Byb2Nlc3NvciwgbmV3Vmlld0NhY2hlLCBwYXRoLCB3cml0ZXNDYWNoZSwgTk9fQ09NUExFVEVfQ0hJTERfU09VUkNFLCBhY2N1bXVsYXRvcik7DQp9DQpmdW5jdGlvbiB2aWV3UHJvY2Vzc29yUmV2ZXJ0VXNlcldyaXRlKHZpZXdQcm9jZXNzb3IsIHZpZXdDYWNoZSwgcGF0aCwgd3JpdGVzQ2FjaGUsIGNvbXBsZXRlU2VydmVyQ2FjaGUsIGFjY3VtdWxhdG9yKSB7DQogICAgbGV0IGNvbXBsZXRlOw0KICAgIGlmICh3cml0ZVRyZWVSZWZTaGFkb3dpbmdXcml0ZSh3cml0ZXNDYWNoZSwgcGF0aCkgIT0gbnVsbCkgew0KICAgICAgICByZXR1cm4gdmlld0NhY2hlOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3Qgc291cmNlID0gbmV3IFdyaXRlVHJlZUNvbXBsZXRlQ2hpbGRTb3VyY2Uod3JpdGVzQ2FjaGUsIHZpZXdDYWNoZSwgY29tcGxldGVTZXJ2ZXJDYWNoZSk7DQogICAgICAgIGNvbnN0IG9sZEV2ZW50Q2FjaGUgPSB2aWV3Q2FjaGUuZXZlbnRDYWNoZS5nZXROb2RlKCk7DQogICAgICAgIGxldCBuZXdFdmVudENhY2hlOw0KICAgICAgICBpZiAocGF0aElzRW1wdHkocGF0aCkgfHwgcGF0aEdldEZyb250KHBhdGgpID09PSAnLnByaW9yaXR5Jykgew0KICAgICAgICAgICAgbGV0IG5ld05vZGU7DQogICAgICAgICAgICBpZiAodmlld0NhY2hlLnNlcnZlckNhY2hlLmlzRnVsbHlJbml0aWFsaXplZCgpKSB7DQogICAgICAgICAgICAgICAgbmV3Tm9kZSA9IHdyaXRlVHJlZVJlZkNhbGNDb21wbGV0ZUV2ZW50Q2FjaGUod3JpdGVzQ2FjaGUsIHZpZXdDYWNoZUdldENvbXBsZXRlU2VydmVyU25hcCh2aWV3Q2FjaGUpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnN0IHNlcnZlckNoaWxkcmVuID0gdmlld0NhY2hlLnNlcnZlckNhY2hlLmdldE5vZGUoKTsNCiAgICAgICAgICAgICAgICBhc3NlcnQoc2VydmVyQ2hpbGRyZW4gaW5zdGFuY2VvZiBDaGlsZHJlbk5vZGUsICdzZXJ2ZXJDaGlsZHJlbiB3b3VsZCBiZSBjb21wbGV0ZSBpZiBsZWFmIG5vZGUnKTsNCiAgICAgICAgICAgICAgICBuZXdOb2RlID0gd3JpdGVUcmVlUmVmQ2FsY0NvbXBsZXRlRXZlbnRDaGlsZHJlbih3cml0ZXNDYWNoZSwgc2VydmVyQ2hpbGRyZW4pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbmV3Tm9kZSA9IG5ld05vZGU7DQogICAgICAgICAgICBuZXdFdmVudENhY2hlID0gdmlld1Byb2Nlc3Nvci5maWx0ZXIudXBkYXRlRnVsbE5vZGUob2xkRXZlbnRDYWNoZSwgbmV3Tm9kZSwgYWNjdW11bGF0b3IpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29uc3QgY2hpbGRLZXkgPSBwYXRoR2V0RnJvbnQocGF0aCk7DQogICAgICAgICAgICBsZXQgbmV3Q2hpbGQgPSB3cml0ZVRyZWVSZWZDYWxjQ29tcGxldGVDaGlsZCh3cml0ZXNDYWNoZSwgY2hpbGRLZXksIHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZSk7DQogICAgICAgICAgICBpZiAobmV3Q2hpbGQgPT0gbnVsbCAmJg0KICAgICAgICAgICAgICAgIHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZS5pc0NvbXBsZXRlRm9yQ2hpbGQoY2hpbGRLZXkpKSB7DQogICAgICAgICAgICAgICAgbmV3Q2hpbGQgPSBvbGRFdmVudENhY2hlLmdldEltbWVkaWF0ZUNoaWxkKGNoaWxkS2V5KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChuZXdDaGlsZCAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgbmV3RXZlbnRDYWNoZSA9IHZpZXdQcm9jZXNzb3IuZmlsdGVyLnVwZGF0ZUNoaWxkKG9sZEV2ZW50Q2FjaGUsIGNoaWxkS2V5LCBuZXdDaGlsZCwgcGF0aFBvcEZyb250KHBhdGgpLCBzb3VyY2UsIGFjY3VtdWxhdG9yKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHZpZXdDYWNoZS5ldmVudENhY2hlLmdldE5vZGUoKS5oYXNDaGlsZChjaGlsZEtleSkpIHsNCiAgICAgICAgICAgICAgICAvLyBObyBjb21wbGV0ZSBjaGlsZCBhdmFpbGFibGUsIGRlbGV0ZSB0aGUgZXhpc3Rpbmcgb25lLCBpZiBhbnkNCiAgICAgICAgICAgICAgICBuZXdFdmVudENhY2hlID0gdmlld1Byb2Nlc3Nvci5maWx0ZXIudXBkYXRlQ2hpbGQob2xkRXZlbnRDYWNoZSwgY2hpbGRLZXksIENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFLCBwYXRoUG9wRnJvbnQocGF0aCksIHNvdXJjZSwgYWNjdW11bGF0b3IpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgbmV3RXZlbnRDYWNoZSA9IG9sZEV2ZW50Q2FjaGU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAobmV3RXZlbnRDYWNoZS5pc0VtcHR5KCkgJiYNCiAgICAgICAgICAgICAgICB2aWV3Q2FjaGUuc2VydmVyQ2FjaGUuaXNGdWxseUluaXRpYWxpemVkKCkpIHsNCiAgICAgICAgICAgICAgICAvLyBXZSBtaWdodCBoYXZlIHJldmVydGVkIGFsbCBjaGlsZCB3cml0ZXMuIE1heWJlIHRoZSBvbGQgZXZlbnQgd2FzIGEgbGVhZiBub2RlDQogICAgICAgICAgICAgICAgY29tcGxldGUgPSB3cml0ZVRyZWVSZWZDYWxjQ29tcGxldGVFdmVudENhY2hlKHdyaXRlc0NhY2hlLCB2aWV3Q2FjaGVHZXRDb21wbGV0ZVNlcnZlclNuYXAodmlld0NhY2hlKSk7DQogICAgICAgICAgICAgICAgaWYgKGNvbXBsZXRlLmlzTGVhZk5vZGUoKSkgew0KICAgICAgICAgICAgICAgICAgICBuZXdFdmVudENhY2hlID0gdmlld1Byb2Nlc3Nvci5maWx0ZXIudXBkYXRlRnVsbE5vZGUobmV3RXZlbnRDYWNoZSwgY29tcGxldGUsIGFjY3VtdWxhdG9yKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY29tcGxldGUgPQ0KICAgICAgICAgICAgdmlld0NhY2hlLnNlcnZlckNhY2hlLmlzRnVsbHlJbml0aWFsaXplZCgpIHx8DQogICAgICAgICAgICAgICAgd3JpdGVUcmVlUmVmU2hhZG93aW5nV3JpdGUod3JpdGVzQ2FjaGUsIG5ld0VtcHR5UGF0aCgpKSAhPSBudWxsOw0KICAgICAgICByZXR1cm4gdmlld0NhY2hlVXBkYXRlRXZlbnRTbmFwKHZpZXdDYWNoZSwgbmV3RXZlbnRDYWNoZSwgY29tcGxldGUsIHZpZXdQcm9jZXNzb3IuZmlsdGVyLmZpbHRlcnNOb2RlcygpKTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIEEgdmlldyByZXByZXNlbnRzIGEgc3BlY2lmaWMgbG9jYXRpb24gYW5kIHF1ZXJ5IHRoYXQgaGFzIDEgb3IgbW9yZSBldmVudCByZWdpc3RyYXRpb25zLg0KICoNCiAqIEl0IGRvZXMgc2V2ZXJhbCB0aGluZ3M6DQogKiAgLSBNYWludGFpbnMgdGhlIGxpc3Qgb2YgZXZlbnQgcmVnaXN0cmF0aW9ucyBmb3IgdGhpcyBsb2NhdGlvbi9xdWVyeS4NCiAqICAtIE1haW50YWlucyBhIGNhY2hlIG9mIHRoZSBkYXRhIHZpc2libGUgZm9yIHRoaXMgbG9jYXRpb24vcXVlcnkuDQogKiAgLSBBcHBsaWVzIG5ldyBvcGVyYXRpb25zICh2aWEgYXBwbHlPcGVyYXRpb24pLCB1cGRhdGVzIHRoZSBjYWNoZSwgYW5kIGJhc2VkIG9uIHRoZSBldmVudA0KICogICAgcmVnaXN0cmF0aW9ucyByZXR1cm5zIHRoZSBzZXQgb2YgZXZlbnRzIHRvIGJlIHJhaXNlZC4NCiAqLw0KY2xhc3MgVmlldyB7DQogICAgY29uc3RydWN0b3IocXVlcnlfLCBpbml0aWFsVmlld0NhY2hlKSB7DQogICAgICAgIHRoaXMucXVlcnlfID0gcXVlcnlfOw0KICAgICAgICB0aGlzLmV2ZW50UmVnaXN0cmF0aW9uc18gPSBbXTsNCiAgICAgICAgY29uc3QgcGFyYW1zID0gdGhpcy5xdWVyeV8uX3F1ZXJ5UGFyYW1zOw0KICAgICAgICBjb25zdCBpbmRleEZpbHRlciA9IG5ldyBJbmRleGVkRmlsdGVyKHBhcmFtcy5nZXRJbmRleCgpKTsNCiAgICAgICAgY29uc3QgZmlsdGVyID0gcXVlcnlQYXJhbXNHZXROb2RlRmlsdGVyKHBhcmFtcyk7DQogICAgICAgIHRoaXMucHJvY2Vzc29yXyA9IG5ld1ZpZXdQcm9jZXNzb3IoZmlsdGVyKTsNCiAgICAgICAgY29uc3QgaW5pdGlhbFNlcnZlckNhY2hlID0gaW5pdGlhbFZpZXdDYWNoZS5zZXJ2ZXJDYWNoZTsNCiAgICAgICAgY29uc3QgaW5pdGlhbEV2ZW50Q2FjaGUgPSBpbml0aWFsVmlld0NhY2hlLmV2ZW50Q2FjaGU7DQogICAgICAgIC8vIERvbid0IGZpbHRlciBzZXJ2ZXIgbm9kZSB3aXRoIG90aGVyIGZpbHRlciB0aGFuIGluZGV4LCB3YWl0IGZvciB0YWdnZWQgbGlzdGVuDQogICAgICAgIGNvbnN0IHNlcnZlclNuYXAgPSBpbmRleEZpbHRlci51cGRhdGVGdWxsTm9kZShDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERSwgaW5pdGlhbFNlcnZlckNhY2hlLmdldE5vZGUoKSwgbnVsbCk7DQogICAgICAgIGNvbnN0IGV2ZW50U25hcCA9IGZpbHRlci51cGRhdGVGdWxsTm9kZShDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERSwgaW5pdGlhbEV2ZW50Q2FjaGUuZ2V0Tm9kZSgpLCBudWxsKTsNCiAgICAgICAgY29uc3QgbmV3U2VydmVyQ2FjaGUgPSBuZXcgQ2FjaGVOb2RlKHNlcnZlclNuYXAsIGluaXRpYWxTZXJ2ZXJDYWNoZS5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSwgaW5kZXhGaWx0ZXIuZmlsdGVyc05vZGVzKCkpOw0KICAgICAgICBjb25zdCBuZXdFdmVudENhY2hlID0gbmV3IENhY2hlTm9kZShldmVudFNuYXAsIGluaXRpYWxFdmVudENhY2hlLmlzRnVsbHlJbml0aWFsaXplZCgpLCBmaWx0ZXIuZmlsdGVyc05vZGVzKCkpOw0KICAgICAgICB0aGlzLnZpZXdDYWNoZV8gPSBuZXdWaWV3Q2FjaGUobmV3RXZlbnRDYWNoZSwgbmV3U2VydmVyQ2FjaGUpOw0KICAgICAgICB0aGlzLmV2ZW50R2VuZXJhdG9yXyA9IG5ldyBFdmVudEdlbmVyYXRvcih0aGlzLnF1ZXJ5Xyk7DQogICAgfQ0KICAgIGdldCBxdWVyeSgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucXVlcnlfOw0KICAgIH0NCn0NCmZ1bmN0aW9uIHZpZXdHZXRTZXJ2ZXJDYWNoZSh2aWV3KSB7DQogICAgcmV0dXJuIHZpZXcudmlld0NhY2hlXy5zZXJ2ZXJDYWNoZS5nZXROb2RlKCk7DQp9DQpmdW5jdGlvbiB2aWV3R2V0Q29tcGxldGVTZXJ2ZXJDYWNoZSh2aWV3LCBwYXRoKSB7DQogICAgY29uc3QgY2FjaGUgPSB2aWV3Q2FjaGVHZXRDb21wbGV0ZVNlcnZlclNuYXAodmlldy52aWV3Q2FjaGVfKTsNCiAgICBpZiAoY2FjaGUpIHsNCiAgICAgICAgLy8gSWYgdGhpcyBpc24ndCBhICJsb2Fkc0FsbERhdGEiIHZpZXcsIHRoZW4gY2FjaGUgaXNuJ3QgYWN0dWFsbHkgYSBjb21wbGV0ZSBjYWNoZSBhbmQNCiAgICAgICAgLy8gd2UgbmVlZCB0byBzZWUgaWYgaXQgY29udGFpbnMgdGhlIGNoaWxkIHdlJ3JlIGludGVyZXN0ZWQgaW4uDQogICAgICAgIGlmICh2aWV3LnF1ZXJ5Ll9xdWVyeVBhcmFtcy5sb2Fkc0FsbERhdGEoKSB8fA0KICAgICAgICAgICAgKCFwYXRoSXNFbXB0eShwYXRoKSAmJg0KICAgICAgICAgICAgICAgICFjYWNoZS5nZXRJbW1lZGlhdGVDaGlsZChwYXRoR2V0RnJvbnQocGF0aCkpLmlzRW1wdHkoKSkpIHsNCiAgICAgICAgICAgIHJldHVybiBjYWNoZS5nZXRDaGlsZChwYXRoKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gbnVsbDsNCn0NCmZ1bmN0aW9uIHZpZXdJc0VtcHR5KHZpZXcpIHsNCiAgICByZXR1cm4gdmlldy5ldmVudFJlZ2lzdHJhdGlvbnNfLmxlbmd0aCA9PT0gMDsNCn0NCmZ1bmN0aW9uIHZpZXdBZGRFdmVudFJlZ2lzdHJhdGlvbih2aWV3LCBldmVudFJlZ2lzdHJhdGlvbikgew0KICAgIHZpZXcuZXZlbnRSZWdpc3RyYXRpb25zXy5wdXNoKGV2ZW50UmVnaXN0cmF0aW9uKTsNCn0NCi8qKg0KICogQHBhcmFtIGV2ZW50UmVnaXN0cmF0aW9uIC0gSWYgbnVsbCwgcmVtb3ZlIGFsbCBjYWxsYmFja3MuDQogKiBAcGFyYW0gY2FuY2VsRXJyb3IgLSBJZiBhIGNhbmNlbEVycm9yIGlzIHByb3ZpZGVkLCBhcHByb3ByaWF0ZSBjYW5jZWwgZXZlbnRzIHdpbGwgYmUgcmV0dXJuZWQuDQogKiBAcmV0dXJucyBDYW5jZWwgZXZlbnRzLCBpZiBjYW5jZWxFcnJvciB3YXMgcHJvdmlkZWQuDQogKi8NCmZ1bmN0aW9uIHZpZXdSZW1vdmVFdmVudFJlZ2lzdHJhdGlvbih2aWV3LCBldmVudFJlZ2lzdHJhdGlvbiwgY2FuY2VsRXJyb3IpIHsNCiAgICBjb25zdCBjYW5jZWxFdmVudHMgPSBbXTsNCiAgICBpZiAoY2FuY2VsRXJyb3IpIHsNCiAgICAgICAgYXNzZXJ0KGV2ZW50UmVnaXN0cmF0aW9uID09IG51bGwsICdBIGNhbmNlbCBzaG91bGQgY2FuY2VsIGFsbCBldmVudCByZWdpc3RyYXRpb25zLicpOw0KICAgICAgICBjb25zdCBwYXRoID0gdmlldy5xdWVyeS5fcGF0aDsNCiAgICAgICAgdmlldy5ldmVudFJlZ2lzdHJhdGlvbnNfLmZvckVhY2gocmVnaXN0cmF0aW9uID0+IHsNCiAgICAgICAgICAgIGNvbnN0IG1heWJlRXZlbnQgPSByZWdpc3RyYXRpb24uY3JlYXRlQ2FuY2VsRXZlbnQoY2FuY2VsRXJyb3IsIHBhdGgpOw0KICAgICAgICAgICAgaWYgKG1heWJlRXZlbnQpIHsNCiAgICAgICAgICAgICAgICBjYW5jZWxFdmVudHMucHVzaChtYXliZUV2ZW50KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGlmIChldmVudFJlZ2lzdHJhdGlvbikgew0KICAgICAgICBsZXQgcmVtYWluaW5nID0gW107DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmlldy5ldmVudFJlZ2lzdHJhdGlvbnNfLmxlbmd0aDsgKytpKSB7DQogICAgICAgICAgICBjb25zdCBleGlzdGluZyA9IHZpZXcuZXZlbnRSZWdpc3RyYXRpb25zX1tpXTsNCiAgICAgICAgICAgIGlmICghZXhpc3RpbmcubWF0Y2hlcyhldmVudFJlZ2lzdHJhdGlvbikpIHsNCiAgICAgICAgICAgICAgICByZW1haW5pbmcucHVzaChleGlzdGluZyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChldmVudFJlZ2lzdHJhdGlvbi5oYXNBbnlDYWxsYmFjaygpKSB7DQogICAgICAgICAgICAgICAgLy8gV2UncmUgcmVtb3ZpbmcganVzdCB0aGlzIG9uZQ0KICAgICAgICAgICAgICAgIHJlbWFpbmluZyA9IHJlbWFpbmluZy5jb25jYXQodmlldy5ldmVudFJlZ2lzdHJhdGlvbnNfLnNsaWNlKGkgKyAxKSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgdmlldy5ldmVudFJlZ2lzdHJhdGlvbnNfID0gcmVtYWluaW5nOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgdmlldy5ldmVudFJlZ2lzdHJhdGlvbnNfID0gW107DQogICAgfQ0KICAgIHJldHVybiBjYW5jZWxFdmVudHM7DQp9DQovKioNCiAqIEFwcGxpZXMgdGhlIGdpdmVuIE9wZXJhdGlvbiwgdXBkYXRlcyBvdXIgY2FjaGUsIGFuZCByZXR1cm5zIHRoZSBhcHByb3ByaWF0ZSBldmVudHMuDQogKi8NCmZ1bmN0aW9uIHZpZXdBcHBseU9wZXJhdGlvbih2aWV3LCBvcGVyYXRpb24sIHdyaXRlc0NhY2hlLCBjb21wbGV0ZVNlcnZlckNhY2hlKSB7DQogICAgaWYgKG9wZXJhdGlvbi50eXBlID09PSBPcGVyYXRpb25UeXBlLk1FUkdFICYmDQogICAgICAgIG9wZXJhdGlvbi5zb3VyY2UucXVlcnlJZCAhPT0gbnVsbCkgew0KICAgICAgICBhc3NlcnQodmlld0NhY2hlR2V0Q29tcGxldGVTZXJ2ZXJTbmFwKHZpZXcudmlld0NhY2hlXyksICdXZSBzaG91bGQgYWx3YXlzIGhhdmUgYSBmdWxsIGNhY2hlIGJlZm9yZSBoYW5kbGluZyBtZXJnZXMnKTsNCiAgICAgICAgYXNzZXJ0KHZpZXdDYWNoZUdldENvbXBsZXRlRXZlbnRTbmFwKHZpZXcudmlld0NhY2hlXyksICdNaXNzaW5nIGV2ZW50IGNhY2hlLCBldmVuIHRob3VnaCB3ZSBoYXZlIGEgc2VydmVyIGNhY2hlJyk7DQogICAgfQ0KICAgIGNvbnN0IG9sZFZpZXdDYWNoZSA9IHZpZXcudmlld0NhY2hlXzsNCiAgICBjb25zdCByZXN1bHQgPSB2aWV3UHJvY2Vzc29yQXBwbHlPcGVyYXRpb24odmlldy5wcm9jZXNzb3JfLCBvbGRWaWV3Q2FjaGUsIG9wZXJhdGlvbiwgd3JpdGVzQ2FjaGUsIGNvbXBsZXRlU2VydmVyQ2FjaGUpOw0KICAgIHZpZXdQcm9jZXNzb3JBc3NlcnRJbmRleGVkKHZpZXcucHJvY2Vzc29yXywgcmVzdWx0LnZpZXdDYWNoZSk7DQogICAgYXNzZXJ0KHJlc3VsdC52aWV3Q2FjaGUuc2VydmVyQ2FjaGUuaXNGdWxseUluaXRpYWxpemVkKCkgfHwNCiAgICAgICAgIW9sZFZpZXdDYWNoZS5zZXJ2ZXJDYWNoZS5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSwgJ09uY2UgYSBzZXJ2ZXIgc25hcCBpcyBjb21wbGV0ZSwgaXQgc2hvdWxkIG5ldmVyIGdvIGJhY2snKTsNCiAgICB2aWV3LnZpZXdDYWNoZV8gPSByZXN1bHQudmlld0NhY2hlOw0KICAgIHJldHVybiB2aWV3R2VuZXJhdGVFdmVudHNGb3JDaGFuZ2VzXyh2aWV3LCByZXN1bHQuY2hhbmdlcywgcmVzdWx0LnZpZXdDYWNoZS5ldmVudENhY2hlLmdldE5vZGUoKSwgbnVsbCk7DQp9DQpmdW5jdGlvbiB2aWV3R2V0SW5pdGlhbEV2ZW50cyh2aWV3LCByZWdpc3RyYXRpb24pIHsNCiAgICBjb25zdCBldmVudFNuYXAgPSB2aWV3LnZpZXdDYWNoZV8uZXZlbnRDYWNoZTsNCiAgICBjb25zdCBpbml0aWFsQ2hhbmdlcyA9IFtdOw0KICAgIGlmICghZXZlbnRTbmFwLmdldE5vZGUoKS5pc0xlYWZOb2RlKCkpIHsNCiAgICAgICAgY29uc3QgZXZlbnROb2RlID0gZXZlbnRTbmFwLmdldE5vZGUoKTsNCiAgICAgICAgZXZlbnROb2RlLmZvckVhY2hDaGlsZChQUklPUklUWV9JTkRFWCwgKGtleSwgY2hpbGROb2RlKSA9PiB7DQogICAgICAgICAgICBpbml0aWFsQ2hhbmdlcy5wdXNoKGNoYW5nZUNoaWxkQWRkZWQoa2V5LCBjaGlsZE5vZGUpKTsNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGlmIChldmVudFNuYXAuaXNGdWxseUluaXRpYWxpemVkKCkpIHsNCiAgICAgICAgaW5pdGlhbENoYW5nZXMucHVzaChjaGFuZ2VWYWx1ZShldmVudFNuYXAuZ2V0Tm9kZSgpKSk7DQogICAgfQ0KICAgIHJldHVybiB2aWV3R2VuZXJhdGVFdmVudHNGb3JDaGFuZ2VzXyh2aWV3LCBpbml0aWFsQ2hhbmdlcywgZXZlbnRTbmFwLmdldE5vZGUoKSwgcmVnaXN0cmF0aW9uKTsNCn0NCmZ1bmN0aW9uIHZpZXdHZW5lcmF0ZUV2ZW50c0ZvckNoYW5nZXNfKHZpZXcsIGNoYW5nZXMsIGV2ZW50Q2FjaGUsIGV2ZW50UmVnaXN0cmF0aW9uKSB7DQogICAgY29uc3QgcmVnaXN0cmF0aW9ucyA9IGV2ZW50UmVnaXN0cmF0aW9uDQogICAgICAgID8gW2V2ZW50UmVnaXN0cmF0aW9uXQ0KICAgICAgICA6IHZpZXcuZXZlbnRSZWdpc3RyYXRpb25zXzsNCiAgICByZXR1cm4gZXZlbnRHZW5lcmF0b3JHZW5lcmF0ZUV2ZW50c0ZvckNoYW5nZXModmlldy5ldmVudEdlbmVyYXRvcl8sIGNoYW5nZXMsIGV2ZW50Q2FjaGUsIHJlZ2lzdHJhdGlvbnMpOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KbGV0IHJlZmVyZW5jZUNvbnN0cnVjdG9yJDE7DQovKioNCiAqIFN5bmNQb2ludCByZXByZXNlbnRzIGEgc2luZ2xlIGxvY2F0aW9uIGluIGEgU3luY1RyZWUgd2l0aCAxIG9yIG1vcmUgZXZlbnQgcmVnaXN0cmF0aW9ucywgbWVhbmluZyB3ZSBuZWVkIHRvDQogKiBtYWludGFpbiAxIG9yIG1vcmUgVmlld3MgYXQgdGhpcyBsb2NhdGlvbiB0byBjYWNoZSBzZXJ2ZXIgZGF0YSBhbmQgcmFpc2UgYXBwcm9wcmlhdGUgZXZlbnRzIGZvciBzZXJ2ZXIgY2hhbmdlcw0KICogYW5kIHVzZXIgd3JpdGVzIChzZXQsIHRyYW5zYWN0aW9uLCB1cGRhdGUpLg0KICoNCiAqIEl0J3MgcmVzcG9uc2libGUgZm9yOg0KICogIC0gTWFpbnRhaW5pbmcgdGhlIHNldCBvZiAxIG9yIG1vcmUgdmlld3MgbmVjZXNzYXJ5IGF0IHRoaXMgbG9jYXRpb24gKGEgU3luY1BvaW50IHdpdGggMCB2aWV3cyBzaG91bGQgYmUgcmVtb3ZlZCkuDQogKiAgLSBQcm94eWluZyB1c2VyIC8gc2VydmVyIG9wZXJhdGlvbnMgdG8gdGhlIHZpZXdzIGFzIGFwcHJvcHJpYXRlIChpLmUuIGFwcGx5U2VydmVyT3ZlcndyaXRlLA0KICogICAgYXBwbHlVc2VyT3ZlcndyaXRlLCBldGMuKQ0KICovDQpjbGFzcyBTeW5jUG9pbnQgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICAvKioNCiAgICAgICAgICogVGhlIFZpZXdzIGJlaW5nIHRyYWNrZWQgYXQgdGhpcyBsb2NhdGlvbiBpbiB0aGUgdHJlZSwgc3RvcmVkIGFzIGEgbWFwIHdoZXJlIHRoZSBrZXkgaXMgYQ0KICAgICAgICAgKiBxdWVyeUlkIGFuZCB0aGUgdmFsdWUgaXMgdGhlIFZpZXcgZm9yIHRoYXQgcXVlcnkuDQogICAgICAgICAqDQogICAgICAgICAqIE5PVEU6IFRoaXMgbGlzdCB3aWxsIGJlIHF1aXRlIHNtYWxsICh1c3VhbGx5IDEsIGJ1dCBwZXJoYXBzIDIgb3IgMzsgYW55IG1vcmUgaXMgYW4gb2RkIHVzZSBjYXNlKS4NCiAgICAgICAgICovDQogICAgICAgIHRoaXMudmlld3MgPSBuZXcgTWFwKCk7DQogICAgfQ0KfQ0KZnVuY3Rpb24gc3luY1BvaW50U2V0UmVmZXJlbmNlQ29uc3RydWN0b3IodmFsKSB7DQogICAgYXNzZXJ0KCFyZWZlcmVuY2VDb25zdHJ1Y3RvciQxLCAnX19yZWZlcmVuY2VDb25zdHJ1Y3RvciBoYXMgYWxyZWFkeSBiZWVuIGRlZmluZWQnKTsNCiAgICByZWZlcmVuY2VDb25zdHJ1Y3RvciQxID0gdmFsOw0KfQ0KZnVuY3Rpb24gc3luY1BvaW50R2V0UmVmZXJlbmNlQ29uc3RydWN0b3IoKSB7DQogICAgYXNzZXJ0KHJlZmVyZW5jZUNvbnN0cnVjdG9yJDEsICdSZWZlcmVuY2UudHMgaGFzIG5vdCBiZWVuIGxvYWRlZCcpOw0KICAgIHJldHVybiByZWZlcmVuY2VDb25zdHJ1Y3RvciQxOw0KfQ0KZnVuY3Rpb24gc3luY1BvaW50SXNFbXB0eShzeW5jUG9pbnQpIHsNCiAgICByZXR1cm4gc3luY1BvaW50LnZpZXdzLnNpemUgPT09IDA7DQp9DQpmdW5jdGlvbiBzeW5jUG9pbnRBcHBseU9wZXJhdGlvbihzeW5jUG9pbnQsIG9wZXJhdGlvbiwgd3JpdGVzQ2FjaGUsIG9wdENvbXBsZXRlU2VydmVyQ2FjaGUpIHsNCiAgICBjb25zdCBxdWVyeUlkID0gb3BlcmF0aW9uLnNvdXJjZS5xdWVyeUlkOw0KICAgIGlmIChxdWVyeUlkICE9PSBudWxsKSB7DQogICAgICAgIGNvbnN0IHZpZXcgPSBzeW5jUG9pbnQudmlld3MuZ2V0KHF1ZXJ5SWQpOw0KICAgICAgICBhc3NlcnQodmlldyAhPSBudWxsLCAnU3luY1RyZWUgZ2F2ZSB1cyBhbiBvcCBmb3IgYW4gaW52YWxpZCBxdWVyeS4nKTsNCiAgICAgICAgcmV0dXJuIHZpZXdBcHBseU9wZXJhdGlvbih2aWV3LCBvcGVyYXRpb24sIHdyaXRlc0NhY2hlLCBvcHRDb21wbGV0ZVNlcnZlckNhY2hlKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGxldCBldmVudHMgPSBbXTsNCiAgICAgICAgZm9yIChjb25zdCB2aWV3IG9mIHN5bmNQb2ludC52aWV3cy52YWx1ZXMoKSkgew0KICAgICAgICAgICAgZXZlbnRzID0gZXZlbnRzLmNvbmNhdCh2aWV3QXBwbHlPcGVyYXRpb24odmlldywgb3BlcmF0aW9uLCB3cml0ZXNDYWNoZSwgb3B0Q29tcGxldGVTZXJ2ZXJDYWNoZSkpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBldmVudHM7DQogICAgfQ0KfQ0KLyoqDQogKiBHZXQgYSB2aWV3IGZvciB0aGUgc3BlY2lmaWVkIHF1ZXJ5Lg0KICoNCiAqIEBwYXJhbSBxdWVyeSAtIFRoZSBxdWVyeSB0byByZXR1cm4gYSB2aWV3IGZvcg0KICogQHBhcmFtIHdyaXRlc0NhY2hlDQogKiBAcGFyYW0gc2VydmVyQ2FjaGUNCiAqIEBwYXJhbSBzZXJ2ZXJDYWNoZUNvbXBsZXRlDQogKiBAcmV0dXJucyBFdmVudHMgdG8gcmFpc2UuDQogKi8NCmZ1bmN0aW9uIHN5bmNQb2ludEdldFZpZXcoc3luY1BvaW50LCBxdWVyeSwgd3JpdGVzQ2FjaGUsIHNlcnZlckNhY2hlLCBzZXJ2ZXJDYWNoZUNvbXBsZXRlKSB7DQogICAgY29uc3QgcXVlcnlJZCA9IHF1ZXJ5Ll9xdWVyeUlkZW50aWZpZXI7DQogICAgY29uc3QgdmlldyA9IHN5bmNQb2ludC52aWV3cy5nZXQocXVlcnlJZCk7DQogICAgaWYgKCF2aWV3KSB7DQogICAgICAgIC8vIFRPRE86IG1ha2Ugd3JpdGVzQ2FjaGUgdGFrZSBmbGFnIGZvciBjb21wbGV0ZSBzZXJ2ZXIgbm9kZQ0KICAgICAgICBsZXQgZXZlbnRDYWNoZSA9IHdyaXRlVHJlZVJlZkNhbGNDb21wbGV0ZUV2ZW50Q2FjaGUod3JpdGVzQ2FjaGUsIHNlcnZlckNhY2hlQ29tcGxldGUgPyBzZXJ2ZXJDYWNoZSA6IG51bGwpOw0KICAgICAgICBsZXQgZXZlbnRDYWNoZUNvbXBsZXRlID0gZmFsc2U7DQogICAgICAgIGlmIChldmVudENhY2hlKSB7DQogICAgICAgICAgICBldmVudENhY2hlQ29tcGxldGUgPSB0cnVlOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKHNlcnZlckNhY2hlIGluc3RhbmNlb2YgQ2hpbGRyZW5Ob2RlKSB7DQogICAgICAgICAgICBldmVudENhY2hlID0gd3JpdGVUcmVlUmVmQ2FsY0NvbXBsZXRlRXZlbnRDaGlsZHJlbih3cml0ZXNDYWNoZSwgc2VydmVyQ2FjaGUpOw0KICAgICAgICAgICAgZXZlbnRDYWNoZUNvbXBsZXRlID0gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBldmVudENhY2hlID0gQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREU7DQogICAgICAgICAgICBldmVudENhY2hlQ29tcGxldGUgPSBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCB2aWV3Q2FjaGUgPSBuZXdWaWV3Q2FjaGUobmV3IENhY2hlTm9kZShldmVudENhY2hlLCBldmVudENhY2hlQ29tcGxldGUsIGZhbHNlKSwgbmV3IENhY2hlTm9kZShzZXJ2ZXJDYWNoZSwgc2VydmVyQ2FjaGVDb21wbGV0ZSwgZmFsc2UpKTsNCiAgICAgICAgcmV0dXJuIG5ldyBWaWV3KHF1ZXJ5LCB2aWV3Q2FjaGUpOw0KICAgIH0NCiAgICByZXR1cm4gdmlldzsNCn0NCi8qKg0KICogQWRkIGFuIGV2ZW50IGNhbGxiYWNrIGZvciB0aGUgc3BlY2lmaWVkIHF1ZXJ5Lg0KICoNCiAqIEBwYXJhbSBxdWVyeQ0KICogQHBhcmFtIGV2ZW50UmVnaXN0cmF0aW9uDQogKiBAcGFyYW0gd3JpdGVzQ2FjaGUNCiAqIEBwYXJhbSBzZXJ2ZXJDYWNoZSAtIENvbXBsZXRlIHNlcnZlciBjYWNoZSwgaWYgd2UgaGF2ZSBpdC4NCiAqIEBwYXJhbSBzZXJ2ZXJDYWNoZUNvbXBsZXRlDQogKiBAcmV0dXJucyBFdmVudHMgdG8gcmFpc2UuDQogKi8NCmZ1bmN0aW9uIHN5bmNQb2ludEFkZEV2ZW50UmVnaXN0cmF0aW9uKHN5bmNQb2ludCwgcXVlcnksIGV2ZW50UmVnaXN0cmF0aW9uLCB3cml0ZXNDYWNoZSwgc2VydmVyQ2FjaGUsIHNlcnZlckNhY2hlQ29tcGxldGUpIHsNCiAgICBjb25zdCB2aWV3ID0gc3luY1BvaW50R2V0VmlldyhzeW5jUG9pbnQsIHF1ZXJ5LCB3cml0ZXNDYWNoZSwgc2VydmVyQ2FjaGUsIHNlcnZlckNhY2hlQ29tcGxldGUpOw0KICAgIGlmICghc3luY1BvaW50LnZpZXdzLmhhcyhxdWVyeS5fcXVlcnlJZGVudGlmaWVyKSkgew0KICAgICAgICBzeW5jUG9pbnQudmlld3Muc2V0KHF1ZXJ5Ll9xdWVyeUlkZW50aWZpZXIsIHZpZXcpOw0KICAgIH0NCiAgICAvLyBUaGlzIGlzIGd1YXJhbnRlZWQgdG8gZXhpc3Qgbm93LCB3ZSBqdXN0IGNyZWF0ZWQgYW55dGhpbmcgdGhhdCB3YXMgbWlzc2luZw0KICAgIHZpZXdBZGRFdmVudFJlZ2lzdHJhdGlvbih2aWV3LCBldmVudFJlZ2lzdHJhdGlvbik7DQogICAgcmV0dXJuIHZpZXdHZXRJbml0aWFsRXZlbnRzKHZpZXcsIGV2ZW50UmVnaXN0cmF0aW9uKTsNCn0NCi8qKg0KICogUmVtb3ZlIGV2ZW50IGNhbGxiYWNrKHMpLiAgUmV0dXJuIGNhbmNlbEV2ZW50cyBpZiBhIGNhbmNlbEVycm9yIGlzIHNwZWNpZmllZC4NCiAqDQogKiBJZiBxdWVyeSBpcyB0aGUgZGVmYXVsdCBxdWVyeSwgd2UnbGwgY2hlY2sgYWxsIHZpZXdzIGZvciB0aGUgc3BlY2lmaWVkIGV2ZW50UmVnaXN0cmF0aW9uLg0KICogSWYgZXZlbnRSZWdpc3RyYXRpb24gaXMgbnVsbCwgd2UnbGwgcmVtb3ZlIGFsbCBjYWxsYmFja3MgZm9yIHRoZSBzcGVjaWZpZWQgdmlldyhzKS4NCiAqDQogKiBAcGFyYW0gZXZlbnRSZWdpc3RyYXRpb24gLSBJZiBudWxsLCByZW1vdmUgYWxsIGNhbGxiYWNrcy4NCiAqIEBwYXJhbSBjYW5jZWxFcnJvciAtIElmIGEgY2FuY2VsRXJyb3IgaXMgcHJvdmlkZWQsIGFwcHJvcHJpYXRlIGNhbmNlbCBldmVudHMgd2lsbCBiZSByZXR1cm5lZC4NCiAqIEByZXR1cm5zIHJlbW92ZWQgcXVlcmllcyBhbmQgYW55IGNhbmNlbCBldmVudHMNCiAqLw0KZnVuY3Rpb24gc3luY1BvaW50UmVtb3ZlRXZlbnRSZWdpc3RyYXRpb24oc3luY1BvaW50LCBxdWVyeSwgZXZlbnRSZWdpc3RyYXRpb24sIGNhbmNlbEVycm9yKSB7DQogICAgY29uc3QgcXVlcnlJZCA9IHF1ZXJ5Ll9xdWVyeUlkZW50aWZpZXI7DQogICAgY29uc3QgcmVtb3ZlZCA9IFtdOw0KICAgIGxldCBjYW5jZWxFdmVudHMgPSBbXTsNCiAgICBjb25zdCBoYWRDb21wbGV0ZVZpZXcgPSBzeW5jUG9pbnRIYXNDb21wbGV0ZVZpZXcoc3luY1BvaW50KTsNCiAgICBpZiAocXVlcnlJZCA9PT0gJ2RlZmF1bHQnKSB7DQogICAgICAgIC8vIFdoZW4geW91IGRvIHJlZi5vZmYoLi4uKSwgd2Ugc2VhcmNoIGFsbCB2aWV3cyBmb3IgdGhlIHJlZ2lzdHJhdGlvbiB0byByZW1vdmUuDQogICAgICAgIGZvciAoY29uc3QgW3ZpZXdRdWVyeUlkLCB2aWV3XSBvZiBzeW5jUG9pbnQudmlld3MuZW50cmllcygpKSB7DQogICAgICAgICAgICBjYW5jZWxFdmVudHMgPSBjYW5jZWxFdmVudHMuY29uY2F0KHZpZXdSZW1vdmVFdmVudFJlZ2lzdHJhdGlvbih2aWV3LCBldmVudFJlZ2lzdHJhdGlvbiwgY2FuY2VsRXJyb3IpKTsNCiAgICAgICAgICAgIGlmICh2aWV3SXNFbXB0eSh2aWV3KSkgew0KICAgICAgICAgICAgICAgIHN5bmNQb2ludC52aWV3cy5kZWxldGUodmlld1F1ZXJ5SWQpOw0KICAgICAgICAgICAgICAgIC8vIFdlJ2xsIGRlYWwgd2l0aCBjb21wbGV0ZSB2aWV3cyBsYXRlci4NCiAgICAgICAgICAgICAgICBpZiAoIXZpZXcucXVlcnkuX3F1ZXJ5UGFyYW1zLmxvYWRzQWxsRGF0YSgpKSB7DQogICAgICAgICAgICAgICAgICAgIHJlbW92ZWQucHVzaCh2aWV3LnF1ZXJ5KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIC8vIHJlbW92ZSB0aGUgY2FsbGJhY2sgZnJvbSB0aGUgc3BlY2lmaWMgdmlldy4NCiAgICAgICAgY29uc3QgdmlldyA9IHN5bmNQb2ludC52aWV3cy5nZXQocXVlcnlJZCk7DQogICAgICAgIGlmICh2aWV3KSB7DQogICAgICAgICAgICBjYW5jZWxFdmVudHMgPSBjYW5jZWxFdmVudHMuY29uY2F0KHZpZXdSZW1vdmVFdmVudFJlZ2lzdHJhdGlvbih2aWV3LCBldmVudFJlZ2lzdHJhdGlvbiwgY2FuY2VsRXJyb3IpKTsNCiAgICAgICAgICAgIGlmICh2aWV3SXNFbXB0eSh2aWV3KSkgew0KICAgICAgICAgICAgICAgIHN5bmNQb2ludC52aWV3cy5kZWxldGUocXVlcnlJZCk7DQogICAgICAgICAgICAgICAgLy8gV2UnbGwgZGVhbCB3aXRoIGNvbXBsZXRlIHZpZXdzIGxhdGVyLg0KICAgICAgICAgICAgICAgIGlmICghdmlldy5xdWVyeS5fcXVlcnlQYXJhbXMubG9hZHNBbGxEYXRhKCkpIHsNCiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlZC5wdXNoKHZpZXcucXVlcnkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBpZiAoaGFkQ29tcGxldGVWaWV3ICYmICFzeW5jUG9pbnRIYXNDb21wbGV0ZVZpZXcoc3luY1BvaW50KSkgew0KICAgICAgICAvLyBXZSByZW1vdmVkIG91ciBsYXN0IGNvbXBsZXRlIHZpZXcuDQogICAgICAgIHJlbW92ZWQucHVzaChuZXcgKHN5bmNQb2ludEdldFJlZmVyZW5jZUNvbnN0cnVjdG9yKCkpKHF1ZXJ5Ll9yZXBvLCBxdWVyeS5fcGF0aCkpOw0KICAgIH0NCiAgICByZXR1cm4geyByZW1vdmVkLCBldmVudHM6IGNhbmNlbEV2ZW50cyB9Ow0KfQ0KZnVuY3Rpb24gc3luY1BvaW50R2V0UXVlcnlWaWV3cyhzeW5jUG9pbnQpIHsNCiAgICBjb25zdCByZXN1bHQgPSBbXTsNCiAgICBmb3IgKGNvbnN0IHZpZXcgb2Ygc3luY1BvaW50LnZpZXdzLnZhbHVlcygpKSB7DQogICAgICAgIGlmICghdmlldy5xdWVyeS5fcXVlcnlQYXJhbXMubG9hZHNBbGxEYXRhKCkpIHsNCiAgICAgICAgICAgIHJlc3VsdC5wdXNoKHZpZXcpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiByZXN1bHQ7DQp9DQovKioNCiAqIEBwYXJhbSBwYXRoIC0gVGhlIHBhdGggdG8gdGhlIGRlc2lyZWQgY29tcGxldGUgc25hcHNob3QNCiAqIEByZXR1cm5zIEEgY29tcGxldGUgY2FjaGUsIGlmIGl0IGV4aXN0cw0KICovDQpmdW5jdGlvbiBzeW5jUG9pbnRHZXRDb21wbGV0ZVNlcnZlckNhY2hlKHN5bmNQb2ludCwgcGF0aCkgew0KICAgIGxldCBzZXJ2ZXJDYWNoZSA9IG51bGw7DQogICAgZm9yIChjb25zdCB2aWV3IG9mIHN5bmNQb2ludC52aWV3cy52YWx1ZXMoKSkgew0KICAgICAgICBzZXJ2ZXJDYWNoZSA9IHNlcnZlckNhY2hlIHx8IHZpZXdHZXRDb21wbGV0ZVNlcnZlckNhY2hlKHZpZXcsIHBhdGgpOw0KICAgIH0NCiAgICByZXR1cm4gc2VydmVyQ2FjaGU7DQp9DQpmdW5jdGlvbiBzeW5jUG9pbnRWaWV3Rm9yUXVlcnkoc3luY1BvaW50LCBxdWVyeSkgew0KICAgIGNvbnN0IHBhcmFtcyA9IHF1ZXJ5Ll9xdWVyeVBhcmFtczsNCiAgICBpZiAocGFyYW1zLmxvYWRzQWxsRGF0YSgpKSB7DQogICAgICAgIHJldHVybiBzeW5jUG9pbnRHZXRDb21wbGV0ZVZpZXcoc3luY1BvaW50KTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGNvbnN0IHF1ZXJ5SWQgPSBxdWVyeS5fcXVlcnlJZGVudGlmaWVyOw0KICAgICAgICByZXR1cm4gc3luY1BvaW50LnZpZXdzLmdldChxdWVyeUlkKTsNCiAgICB9DQp9DQpmdW5jdGlvbiBzeW5jUG9pbnRWaWV3RXhpc3RzRm9yUXVlcnkoc3luY1BvaW50LCBxdWVyeSkgew0KICAgIHJldHVybiBzeW5jUG9pbnRWaWV3Rm9yUXVlcnkoc3luY1BvaW50LCBxdWVyeSkgIT0gbnVsbDsNCn0NCmZ1bmN0aW9uIHN5bmNQb2ludEhhc0NvbXBsZXRlVmlldyhzeW5jUG9pbnQpIHsNCiAgICByZXR1cm4gc3luY1BvaW50R2V0Q29tcGxldGVWaWV3KHN5bmNQb2ludCkgIT0gbnVsbDsNCn0NCmZ1bmN0aW9uIHN5bmNQb2ludEdldENvbXBsZXRlVmlldyhzeW5jUG9pbnQpIHsNCiAgICBmb3IgKGNvbnN0IHZpZXcgb2Ygc3luY1BvaW50LnZpZXdzLnZhbHVlcygpKSB7DQogICAgICAgIGlmICh2aWV3LnF1ZXJ5Ll9xdWVyeVBhcmFtcy5sb2Fkc0FsbERhdGEoKSkgew0KICAgICAgICAgICAgcmV0dXJuIHZpZXc7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIG51bGw7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpsZXQgcmVmZXJlbmNlQ29uc3RydWN0b3I7DQpmdW5jdGlvbiBzeW5jVHJlZVNldFJlZmVyZW5jZUNvbnN0cnVjdG9yKHZhbCkgew0KICAgIGFzc2VydCghcmVmZXJlbmNlQ29uc3RydWN0b3IsICdfX3JlZmVyZW5jZUNvbnN0cnVjdG9yIGhhcyBhbHJlYWR5IGJlZW4gZGVmaW5lZCcpOw0KICAgIHJlZmVyZW5jZUNvbnN0cnVjdG9yID0gdmFsOw0KfQ0KZnVuY3Rpb24gc3luY1RyZWVHZXRSZWZlcmVuY2VDb25zdHJ1Y3RvcigpIHsNCiAgICBhc3NlcnQocmVmZXJlbmNlQ29uc3RydWN0b3IsICdSZWZlcmVuY2UudHMgaGFzIG5vdCBiZWVuIGxvYWRlZCcpOw0KICAgIHJldHVybiByZWZlcmVuY2VDb25zdHJ1Y3RvcjsNCn0NCi8qKg0KICogU3RhdGljIHRyYWNrZXIgZm9yIG5leHQgcXVlcnkgdGFnLg0KICovDQpsZXQgc3luY1RyZWVOZXh0UXVlcnlUYWdfID0gMTsNCi8qKg0KICogU3luY1RyZWUgaXMgdGhlIGNlbnRyYWwgY2xhc3MgZm9yIG1hbmFnaW5nIGV2ZW50IGNhbGxiYWNrIHJlZ2lzdHJhdGlvbiwgZGF0YSBjYWNoaW5nLCB2aWV3cw0KICogKHF1ZXJ5IHByb2Nlc3NpbmcpLCBhbmQgZXZlbnQgZ2VuZXJhdGlvbi4gIFRoZXJlIGFyZSB0eXBpY2FsbHkgdHdvIFN5bmNUcmVlIGluc3RhbmNlcyBmb3INCiAqIGVhY2ggUmVwbywgb25lIGZvciB0aGUgbm9ybWFsIEZpcmViYXNlIGRhdGEsIGFuZCBvbmUgZm9yIHRoZSAuaW5mbyBkYXRhLg0KICoNCiAqIEl0IGhhcyBhIG51bWJlciBvZiByZXNwb25zaWJpbGl0aWVzLCBpbmNsdWRpbmc6DQogKiAgLSBUcmFja2luZyBhbGwgdXNlciBldmVudCBjYWxsYmFja3MgKHJlZ2lzdGVyZWQgdmlhIGFkZEV2ZW50UmVnaXN0cmF0aW9uKCkgYW5kIHJlbW92ZUV2ZW50UmVnaXN0cmF0aW9uKCkpLg0KICogIC0gQXBwbHlpbmcgYW5kIGNhY2hpbmcgZGF0YSBjaGFuZ2VzIGZvciB1c2VyIHNldCgpLCB0cmFuc2FjdGlvbigpLCBhbmQgdXBkYXRlKCkgY2FsbHMNCiAqICAgIChhcHBseVVzZXJPdmVyd3JpdGUoKSwgYXBwbHlVc2VyTWVyZ2UoKSkuDQogKiAgLSBBcHBseWluZyBhbmQgY2FjaGluZyBkYXRhIGNoYW5nZXMgZm9yIHNlcnZlciBkYXRhIGNoYW5nZXMgKGFwcGx5U2VydmVyT3ZlcndyaXRlKCksDQogKiAgICBhcHBseVNlcnZlck1lcmdlKCkpLg0KICogIC0gR2VuZXJhdGluZyB1c2VyLWZhY2luZyBldmVudHMgZm9yIHNlcnZlciBhbmQgdXNlciBjaGFuZ2VzIChhbGwgb2YgdGhlIGFwcGx5KiBtZXRob2RzDQogKiAgICByZXR1cm4gdGhlIHNldCBvZiBldmVudHMgdGhhdCBuZWVkIHRvIGJlIHJhaXNlZCBhcyBhIHJlc3VsdCkuDQogKiAgLSBNYWludGFpbmluZyB0aGUgYXBwcm9wcmlhdGUgc2V0IG9mIHNlcnZlciBsaXN0ZW5zIHRvIGVuc3VyZSB3ZSBhcmUgYWx3YXlzIHN1YnNjcmliZWQNCiAqICAgIHRvIHRoZSBjb3JyZWN0IHNldCBvZiBwYXRocyBhbmQgcXVlcmllcyB0byBzYXRpc2Z5IHRoZSBjdXJyZW50IHNldCBvZiB1c2VyIGV2ZW50DQogKiAgICBjYWxsYmFja3MgKGxpc3RlbnMgYXJlIHN0YXJ0ZWQvc3RvcHBlZCB1c2luZyB0aGUgcHJvdmlkZWQgbGlzdGVuUHJvdmlkZXIpLg0KICoNCiAqIE5PVEU6IEFsdGhvdWdoIFN5bmNUcmVlIHRyYWNrcyBldmVudCBjYWxsYmFja3MgYW5kIGNhbGN1bGF0ZXMgZXZlbnRzIHRvIHJhaXNlLCB0aGUgYWN0dWFsDQogKiBldmVudHMgYXJlIHJldHVybmVkIHRvIHRoZSBjYWxsZXIgcmF0aGVyIHRoYW4gcmFpc2VkIHN5bmNocm9ub3VzbHkuDQogKg0KICovDQpjbGFzcyBTeW5jVHJlZSB7DQogICAgLyoqDQogICAgICogQHBhcmFtIGxpc3RlblByb3ZpZGVyXyAtIFVzZWQgYnkgU3luY1RyZWUgdG8gc3RhcnQgLyBzdG9wIGxpc3RlbmluZw0KICAgICAqICAgdG8gc2VydmVyIGRhdGEuDQogICAgICovDQogICAgY29uc3RydWN0b3IobGlzdGVuUHJvdmlkZXJfKSB7DQogICAgICAgIHRoaXMubGlzdGVuUHJvdmlkZXJfID0gbGlzdGVuUHJvdmlkZXJfOw0KICAgICAgICAvKioNCiAgICAgICAgICogVHJlZSBvZiBTeW5jUG9pbnRzLiAgVGhlcmUncyBhIFN5bmNQb2ludCBhdCBhbnkgbG9jYXRpb24gdGhhdCBoYXMgMSBvciBtb3JlIHZpZXdzLg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5zeW5jUG9pbnRUcmVlXyA9IG5ldyBJbW11dGFibGVUcmVlKG51bGwpOw0KICAgICAgICAvKioNCiAgICAgICAgICogQSB0cmVlIG9mIGFsbCBwZW5kaW5nIHVzZXIgd3JpdGVzICh1c2VyLWluaXRpYXRlZCBzZXQoKSdzLCB0cmFuc2FjdGlvbigpJ3MsIHVwZGF0ZSgpJ3MsIGV0Yy4pLg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5wZW5kaW5nV3JpdGVUcmVlXyA9IG5ld1dyaXRlVHJlZSgpOw0KICAgICAgICB0aGlzLnRhZ1RvUXVlcnlNYXAgPSBuZXcgTWFwKCk7DQogICAgICAgIHRoaXMucXVlcnlUb1RhZ01hcCA9IG5ldyBNYXAoKTsNCiAgICB9DQp9DQovKioNCiAqIEFwcGx5IHRoZSBkYXRhIGNoYW5nZXMgZm9yIGEgdXNlci1nZW5lcmF0ZWQgc2V0KCkgb3IgdHJhbnNhY3Rpb24oKSBjYWxsLg0KICoNCiAqIEByZXR1cm5zIEV2ZW50cyB0byByYWlzZS4NCiAqLw0KZnVuY3Rpb24gc3luY1RyZWVBcHBseVVzZXJPdmVyd3JpdGUoc3luY1RyZWUsIHBhdGgsIG5ld0RhdGEsIHdyaXRlSWQsIHZpc2libGUpIHsNCiAgICAvLyBSZWNvcmQgcGVuZGluZyB3cml0ZS4NCiAgICB3cml0ZVRyZWVBZGRPdmVyd3JpdGUoc3luY1RyZWUucGVuZGluZ1dyaXRlVHJlZV8sIHBhdGgsIG5ld0RhdGEsIHdyaXRlSWQsIHZpc2libGUpOw0KICAgIGlmICghdmlzaWJsZSkgew0KICAgICAgICByZXR1cm4gW107DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICByZXR1cm4gc3luY1RyZWVBcHBseU9wZXJhdGlvblRvU3luY1BvaW50c18oc3luY1RyZWUsIG5ldyBPdmVyd3JpdGUobmV3T3BlcmF0aW9uU291cmNlVXNlcigpLCBwYXRoLCBuZXdEYXRhKSk7DQogICAgfQ0KfQ0KLyoqDQogKiBBY2tub3dsZWRnZSBhIHBlbmRpbmcgdXNlciB3cml0ZSB0aGF0IHdhcyBwcmV2aW91c2x5IHJlZ2lzdGVyZWQgd2l0aCBhcHBseVVzZXJPdmVyd3JpdGUoKSBvciBhcHBseVVzZXJNZXJnZSgpLg0KICoNCiAqIEBwYXJhbSByZXZlcnQgLSBUcnVlIGlmIHRoZSBnaXZlbiB3cml0ZSBmYWlsZWQgYW5kIG5lZWRzIHRvIGJlIHJldmVydGVkDQogKiBAcmV0dXJucyBFdmVudHMgdG8gcmFpc2UuDQogKi8NCmZ1bmN0aW9uIHN5bmNUcmVlQWNrVXNlcldyaXRlKHN5bmNUcmVlLCB3cml0ZUlkLCByZXZlcnQgPSBmYWxzZSkgew0KICAgIGNvbnN0IHdyaXRlID0gd3JpdGVUcmVlR2V0V3JpdGUoc3luY1RyZWUucGVuZGluZ1dyaXRlVHJlZV8sIHdyaXRlSWQpOw0KICAgIGNvbnN0IG5lZWRUb1JlZXZhbHVhdGUgPSB3cml0ZVRyZWVSZW1vdmVXcml0ZShzeW5jVHJlZS5wZW5kaW5nV3JpdGVUcmVlXywgd3JpdGVJZCk7DQogICAgaWYgKCFuZWVkVG9SZWV2YWx1YXRlKSB7DQogICAgICAgIHJldHVybiBbXTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGxldCBhZmZlY3RlZFRyZWUgPSBuZXcgSW1tdXRhYmxlVHJlZShudWxsKTsNCiAgICAgICAgaWYgKHdyaXRlLnNuYXAgIT0gbnVsbCkgew0KICAgICAgICAgICAgLy8gb3ZlcndyaXRlDQogICAgICAgICAgICBhZmZlY3RlZFRyZWUgPSBhZmZlY3RlZFRyZWUuc2V0KG5ld0VtcHR5UGF0aCgpLCB0cnVlKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGVhY2god3JpdGUuY2hpbGRyZW4sIChwYXRoU3RyaW5nKSA9PiB7DQogICAgICAgICAgICAgICAgYWZmZWN0ZWRUcmVlID0gYWZmZWN0ZWRUcmVlLnNldChuZXcgUGF0aChwYXRoU3RyaW5nKSwgdHJ1ZSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gc3luY1RyZWVBcHBseU9wZXJhdGlvblRvU3luY1BvaW50c18oc3luY1RyZWUsIG5ldyBBY2tVc2VyV3JpdGUod3JpdGUucGF0aCwgYWZmZWN0ZWRUcmVlLCByZXZlcnQpKTsNCiAgICB9DQp9DQovKioNCiAqIEFwcGx5IG5ldyBzZXJ2ZXIgZGF0YSBmb3IgdGhlIHNwZWNpZmllZCBwYXRoLi4NCiAqDQogKiBAcmV0dXJucyBFdmVudHMgdG8gcmFpc2UuDQogKi8NCmZ1bmN0aW9uIHN5bmNUcmVlQXBwbHlTZXJ2ZXJPdmVyd3JpdGUoc3luY1RyZWUsIHBhdGgsIG5ld0RhdGEpIHsNCiAgICByZXR1cm4gc3luY1RyZWVBcHBseU9wZXJhdGlvblRvU3luY1BvaW50c18oc3luY1RyZWUsIG5ldyBPdmVyd3JpdGUobmV3T3BlcmF0aW9uU291cmNlU2VydmVyKCksIHBhdGgsIG5ld0RhdGEpKTsNCn0NCi8qKg0KICogQXBwbHkgbmV3IHNlcnZlciBkYXRhIHRvIGJlIG1lcmdlZCBpbiBhdCB0aGUgc3BlY2lmaWVkIHBhdGguDQogKg0KICogQHJldHVybnMgRXZlbnRzIHRvIHJhaXNlLg0KICovDQpmdW5jdGlvbiBzeW5jVHJlZUFwcGx5U2VydmVyTWVyZ2Uoc3luY1RyZWUsIHBhdGgsIGNoYW5nZWRDaGlsZHJlbikgew0KICAgIGNvbnN0IGNoYW5nZVRyZWUgPSBJbW11dGFibGVUcmVlLmZyb21PYmplY3QoY2hhbmdlZENoaWxkcmVuKTsNCiAgICByZXR1cm4gc3luY1RyZWVBcHBseU9wZXJhdGlvblRvU3luY1BvaW50c18oc3luY1RyZWUsIG5ldyBNZXJnZShuZXdPcGVyYXRpb25Tb3VyY2VTZXJ2ZXIoKSwgcGF0aCwgY2hhbmdlVHJlZSkpOw0KfQ0KLyoqDQogKiBBcHBseSBhIGxpc3RlbiBjb21wbGV0ZSBmb3IgYSBxdWVyeQ0KICoNCiAqIEByZXR1cm5zIEV2ZW50cyB0byByYWlzZS4NCiAqLw0KZnVuY3Rpb24gc3luY1RyZWVBcHBseUxpc3RlbkNvbXBsZXRlKHN5bmNUcmVlLCBwYXRoKSB7DQogICAgcmV0dXJuIHN5bmNUcmVlQXBwbHlPcGVyYXRpb25Ub1N5bmNQb2ludHNfKHN5bmNUcmVlLCBuZXcgTGlzdGVuQ29tcGxldGUobmV3T3BlcmF0aW9uU291cmNlU2VydmVyKCksIHBhdGgpKTsNCn0NCi8qKg0KICogQXBwbHkgYSBsaXN0ZW4gY29tcGxldGUgZm9yIGEgdGFnZ2VkIHF1ZXJ5DQogKg0KICogQHJldHVybnMgRXZlbnRzIHRvIHJhaXNlLg0KICovDQpmdW5jdGlvbiBzeW5jVHJlZUFwcGx5VGFnZ2VkTGlzdGVuQ29tcGxldGUoc3luY1RyZWUsIHBhdGgsIHRhZykgew0KICAgIGNvbnN0IHF1ZXJ5S2V5ID0gc3luY1RyZWVRdWVyeUtleUZvclRhZ18oc3luY1RyZWUsIHRhZyk7DQogICAgaWYgKHF1ZXJ5S2V5KSB7DQogICAgICAgIGNvbnN0IHIgPSBzeW5jVHJlZVBhcnNlUXVlcnlLZXlfKHF1ZXJ5S2V5KTsNCiAgICAgICAgY29uc3QgcXVlcnlQYXRoID0gci5wYXRoLCBxdWVyeUlkID0gci5xdWVyeUlkOw0KICAgICAgICBjb25zdCByZWxhdGl2ZVBhdGggPSBuZXdSZWxhdGl2ZVBhdGgocXVlcnlQYXRoLCBwYXRoKTsNCiAgICAgICAgY29uc3Qgb3AgPSBuZXcgTGlzdGVuQ29tcGxldGUobmV3T3BlcmF0aW9uU291cmNlU2VydmVyVGFnZ2VkUXVlcnkocXVlcnlJZCksIHJlbGF0aXZlUGF0aCk7DQogICAgICAgIHJldHVybiBzeW5jVHJlZUFwcGx5VGFnZ2VkT3BlcmF0aW9uXyhzeW5jVHJlZSwgcXVlcnlQYXRoLCBvcCk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICAvLyBXZSd2ZSBhbHJlYWR5IHJlbW92ZWQgdGhlIHF1ZXJ5LiBObyBiaWcgZGVhbCwgaWdub3JlIHRoZSB1cGRhdGUNCiAgICAgICAgcmV0dXJuIFtdOw0KICAgIH0NCn0NCi8qKg0KICogUmVtb3ZlIGV2ZW50IGNhbGxiYWNrKHMpLg0KICoNCiAqIElmIHF1ZXJ5IGlzIHRoZSBkZWZhdWx0IHF1ZXJ5LCB3ZSdsbCBjaGVjayBhbGwgcXVlcmllcyBmb3IgdGhlIHNwZWNpZmllZCBldmVudFJlZ2lzdHJhdGlvbi4NCiAqIElmIGV2ZW50UmVnaXN0cmF0aW9uIGlzIG51bGwsIHdlJ2xsIHJlbW92ZSBhbGwgY2FsbGJhY2tzIGZvciB0aGUgc3BlY2lmaWVkIHF1ZXJ5L3F1ZXJpZXMuDQogKg0KICogQHBhcmFtIGV2ZW50UmVnaXN0cmF0aW9uIC0gSWYgbnVsbCwgYWxsIGNhbGxiYWNrcyBhcmUgcmVtb3ZlZC4NCiAqIEBwYXJhbSBjYW5jZWxFcnJvciAtIElmIGEgY2FuY2VsRXJyb3IgaXMgcHJvdmlkZWQsIGFwcHJvcHJpYXRlIGNhbmNlbCBldmVudHMgd2lsbCBiZSByZXR1cm5lZC4NCiAqIEBwYXJhbSBza2lwTGlzdGVuZXJEZWR1cCAtIFdoZW4gcGVyZm9ybWluZyBhIGBnZXQoKWAsIHdlIGRvbid0IGFkZCBhbnkgbmV3IGxpc3RlbmVycywgc28gbm8NCiAqICBkZWR1cGluZyBuZWVkcyB0byB0YWtlIHBsYWNlLiBUaGlzIGZsYWcgYWxsb3dzIHRvZ2dsaW5nIG9mIHRoYXQgYmVoYXZpb3INCiAqIEByZXR1cm5zIENhbmNlbCBldmVudHMsIGlmIGNhbmNlbEVycm9yIHdhcyBwcm92aWRlZC4NCiAqLw0KZnVuY3Rpb24gc3luY1RyZWVSZW1vdmVFdmVudFJlZ2lzdHJhdGlvbihzeW5jVHJlZSwgcXVlcnksIGV2ZW50UmVnaXN0cmF0aW9uLCBjYW5jZWxFcnJvciwgc2tpcExpc3RlbmVyRGVkdXAgPSBmYWxzZSkgew0KICAgIC8vIEZpbmQgdGhlIHN5bmNQb2ludCBmaXJzdC4gVGhlbiBkZWFsIHdpdGggd2hldGhlciBvciBub3QgaXQgaGFzIG1hdGNoaW5nIGxpc3RlbmVycw0KICAgIGNvbnN0IHBhdGggPSBxdWVyeS5fcGF0aDsNCiAgICBjb25zdCBtYXliZVN5bmNQb2ludCA9IHN5bmNUcmVlLnN5bmNQb2ludFRyZWVfLmdldChwYXRoKTsNCiAgICBsZXQgY2FuY2VsRXZlbnRzID0gW107DQogICAgLy8gQSByZW1vdmFsIG9uIGEgZGVmYXVsdCBxdWVyeSBhZmZlY3RzIGFsbCBxdWVyaWVzIGF0IHRoYXQgbG9jYXRpb24uIEEgcmVtb3ZhbCBvbiBhbiBpbmRleGVkIHF1ZXJ5LCBldmVuIG9uZSB3aXRob3V0DQogICAgLy8gb3RoZXIgcXVlcnkgY29uc3RyYWludHMsIGRvZXMgKm5vdCogYWZmZWN0IGFsbCBxdWVyaWVzIGF0IHRoYXQgbG9jYXRpb24uIFNvIHRoaXMgY2hlY2sgbXVzdCBiZSBmb3IgJ2RlZmF1bHQnLCBhbmQNCiAgICAvLyBub3QgbG9hZHNBbGxEYXRhKCkuDQogICAgaWYgKG1heWJlU3luY1BvaW50ICYmDQogICAgICAgIChxdWVyeS5fcXVlcnlJZGVudGlmaWVyID09PSAnZGVmYXVsdCcgfHwNCiAgICAgICAgICAgIHN5bmNQb2ludFZpZXdFeGlzdHNGb3JRdWVyeShtYXliZVN5bmNQb2ludCwgcXVlcnkpKSkgew0KICAgICAgICBjb25zdCByZW1vdmVkQW5kRXZlbnRzID0gc3luY1BvaW50UmVtb3ZlRXZlbnRSZWdpc3RyYXRpb24obWF5YmVTeW5jUG9pbnQsIHF1ZXJ5LCBldmVudFJlZ2lzdHJhdGlvbiwgY2FuY2VsRXJyb3IpOw0KICAgICAgICBpZiAoc3luY1BvaW50SXNFbXB0eShtYXliZVN5bmNQb2ludCkpIHsNCiAgICAgICAgICAgIHN5bmNUcmVlLnN5bmNQb2ludFRyZWVfID0gc3luY1RyZWUuc3luY1BvaW50VHJlZV8ucmVtb3ZlKHBhdGgpOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IHJlbW92ZWQgPSByZW1vdmVkQW5kRXZlbnRzLnJlbW92ZWQ7DQogICAgICAgIGNhbmNlbEV2ZW50cyA9IHJlbW92ZWRBbmRFdmVudHMuZXZlbnRzOw0KICAgICAgICBpZiAoIXNraXBMaXN0ZW5lckRlZHVwKSB7DQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIFdlIG1heSBoYXZlIGp1c3QgcmVtb3ZlZCBvbmUgb2YgbWFueSBsaXN0ZW5lcnMgYW5kIGNhbiBzaG9ydC1jaXJjdWl0IHRoaXMgd2hvbGUgcHJvY2Vzcw0KICAgICAgICAgICAgICogV2UgbWF5IGFsc28gbm90IGhhdmUgcmVtb3ZlZCBhIGRlZmF1bHQgbGlzdGVuZXIsIGluIHdoaWNoIGNhc2UgYWxsIG9mIHRoZSBkZXNjZW5kYW50IGxpc3RlbmVycyBzaG91bGQgYWxyZWFkeSBiZQ0KICAgICAgICAgICAgICogcHJvcGVybHkgc2V0IHVwLg0KICAgICAgICAgICAgICovDQogICAgICAgICAgICAvLyBTaW5jZSBpbmRleGVkIHF1ZXJpZXMgY2FuIHNoYWRvdyBpZiB0aGV5IGRvbid0IGhhdmUgb3RoZXIgcXVlcnkgY29uc3RyYWludHMsIGNoZWNrIGZvciBsb2Fkc0FsbERhdGEoKSwgaW5zdGVhZCBvZg0KICAgICAgICAgICAgLy8gcXVlcnlJZCA9PT0gJ2RlZmF1bHQnDQogICAgICAgICAgICBjb25zdCByZW1vdmluZ0RlZmF1bHQgPSAtMSAhPT0NCiAgICAgICAgICAgICAgICByZW1vdmVkLmZpbmRJbmRleChxdWVyeSA9PiB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBxdWVyeS5fcXVlcnlQYXJhbXMubG9hZHNBbGxEYXRhKCk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBjb25zdCBjb3ZlcmVkID0gc3luY1RyZWUuc3luY1BvaW50VHJlZV8uZmluZE9uUGF0aChwYXRoLCAocmVsYXRpdmVQYXRoLCBwYXJlbnRTeW5jUG9pbnQpID0+IHN5bmNQb2ludEhhc0NvbXBsZXRlVmlldyhwYXJlbnRTeW5jUG9pbnQpKTsNCiAgICAgICAgICAgIGlmIChyZW1vdmluZ0RlZmF1bHQgJiYgIWNvdmVyZWQpIHsNCiAgICAgICAgICAgICAgICBjb25zdCBzdWJ0cmVlID0gc3luY1RyZWUuc3luY1BvaW50VHJlZV8uc3VidHJlZShwYXRoKTsNCiAgICAgICAgICAgICAgICAvLyBUaGVyZSBhcmUgcG90ZW50aWFsbHkgY2hpbGQgbGlzdGVuZXJzLiBEZXRlcm1pbmUgd2hhdCBpZiBhbnkgbGlzdGVucyB3ZSBuZWVkIHRvIHNlbmQgYmVmb3JlIGV4ZWN1dGluZyB0aGUNCiAgICAgICAgICAgICAgICAvLyByZW1vdmFsDQogICAgICAgICAgICAgICAgaWYgKCFzdWJ0cmVlLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIGZvbGQgb3ZlciBvdXIgc3VidHJlZSBhbmQgY29sbGVjdCB0aGUgbGlzdGVuZXJzIHRvIHNlbmQNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3Vmlld3MgPSBzeW5jVHJlZUNvbGxlY3REaXN0aW5jdFZpZXdzRm9yU3ViVHJlZV8oc3VidHJlZSk7DQogICAgICAgICAgICAgICAgICAgIC8vIE9rLCB3ZSd2ZSBjb2xsZWN0ZWQgYWxsIHRoZSBsaXN0ZW5zIHdlIG5lZWQuIFNldCB0aGVtIHVwLg0KICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5ld1ZpZXdzLmxlbmd0aDsgKytpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2aWV3ID0gbmV3Vmlld3NbaV0sIG5ld1F1ZXJ5ID0gdmlldy5xdWVyeTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpc3RlbmVyID0gc3luY1RyZWVDcmVhdGVMaXN0ZW5lckZvclZpZXdfKHN5bmNUcmVlLCB2aWV3KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN5bmNUcmVlLmxpc3RlblByb3ZpZGVyXy5zdGFydExpc3RlbmluZyhzeW5jVHJlZVF1ZXJ5Rm9yTGlzdGVuaW5nXyhuZXdRdWVyeSksIHN5bmNUcmVlVGFnRm9yUXVlcnkoc3luY1RyZWUsIG5ld1F1ZXJ5KSwgbGlzdGVuZXIuaGFzaEZuLCBsaXN0ZW5lci5vbkNvbXBsZXRlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UgdGhlcmUncyBub3RoaW5nIGJlbG93IHVzLCBzbyBub3RoaW5nIHdlIG5lZWQgdG8gc3RhcnQgbGlzdGVuaW5nIG9uDQogICAgICAgICAgICB9DQogICAgICAgICAgICAvLyBJZiB3ZSByZW1vdmVkIGFueXRoaW5nIGFuZCB3ZSdyZSBub3QgY292ZXJlZCBieSBhIGhpZ2hlciB1cCBsaXN0ZW4sIHdlIG5lZWQgdG8gc3RvcCBsaXN0ZW5pbmcgb24gdGhpcyBxdWVyeQ0KICAgICAgICAgICAgLy8gVGhlIGFib3ZlIGJsb2NrIGhhcyB1cyBjb3ZlcmVkIGluIHRlcm1zIG9mIG1ha2luZyBzdXJlIHdlJ3JlIHNldCB1cCBvbiBsaXN0ZW5zIGxvd2VyIGluIHRoZSB0cmVlLg0KICAgICAgICAgICAgLy8gQWxzbywgbm90ZSB0aGF0IGlmIHdlIGhhdmUgYSBjYW5jZWxFcnJvciwgaXQncyBhbHJlYWR5IGJlZW4gcmVtb3ZlZCBhdCB0aGUgcHJvdmlkZXIgbGV2ZWwuDQogICAgICAgICAgICBpZiAoIWNvdmVyZWQgJiYgcmVtb3ZlZC5sZW5ndGggPiAwICYmICFjYW5jZWxFcnJvcikgew0KICAgICAgICAgICAgICAgIC8vIElmIHdlIHJlbW92ZWQgYSBkZWZhdWx0LCB0aGVuIHdlIHdlcmVuJ3QgbGlzdGVuaW5nIG9uIGFueSBvZiB0aGUgb3RoZXIgcXVlcmllcyBoZXJlLiBKdXN0IGNhbmNlbCB0aGUgb25lDQogICAgICAgICAgICAgICAgLy8gZGVmYXVsdC4gT3RoZXJ3aXNlLCB3ZSBuZWVkIHRvIGl0ZXJhdGUgdGhyb3VnaCBhbmQgY2FuY2VsIGVhY2ggaW5kaXZpZHVhbCBxdWVyeQ0KICAgICAgICAgICAgICAgIGlmIChyZW1vdmluZ0RlZmF1bHQpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gV2UgZG9uJ3QgdGFnIGRlZmF1bHQgbGlzdGVuZXJzDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRUYWcgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICBzeW5jVHJlZS5saXN0ZW5Qcm92aWRlcl8uc3RvcExpc3RlbmluZyhzeW5jVHJlZVF1ZXJ5Rm9yTGlzdGVuaW5nXyhxdWVyeSksIGRlZmF1bHRUYWcpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlZC5mb3JFYWNoKChxdWVyeVRvUmVtb3ZlKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YWdUb1JlbW92ZSA9IHN5bmNUcmVlLnF1ZXJ5VG9UYWdNYXAuZ2V0KHN5bmNUcmVlTWFrZVF1ZXJ5S2V5XyhxdWVyeVRvUmVtb3ZlKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBzeW5jVHJlZS5saXN0ZW5Qcm92aWRlcl8uc3RvcExpc3RlbmluZyhzeW5jVHJlZVF1ZXJ5Rm9yTGlzdGVuaW5nXyhxdWVyeVRvUmVtb3ZlKSwgdGFnVG9SZW1vdmUpOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgLy8gTm93LCBjbGVhciBhbGwgb2YgdGhlIHRhZ3Mgd2UncmUgdHJhY2tpbmcgZm9yIHRoZSByZW1vdmVkIGxpc3RlbnMNCiAgICAgICAgc3luY1RyZWVSZW1vdmVUYWdzXyhzeW5jVHJlZSwgcmVtb3ZlZCk7DQogICAgfQ0KICAgIHJldHVybiBjYW5jZWxFdmVudHM7DQp9DQovKioNCiAqIEFwcGx5IG5ldyBzZXJ2ZXIgZGF0YSBmb3IgdGhlIHNwZWNpZmllZCB0YWdnZWQgcXVlcnkuDQogKg0KICogQHJldHVybnMgRXZlbnRzIHRvIHJhaXNlLg0KICovDQpmdW5jdGlvbiBzeW5jVHJlZUFwcGx5VGFnZ2VkUXVlcnlPdmVyd3JpdGUoc3luY1RyZWUsIHBhdGgsIHNuYXAsIHRhZykgew0KICAgIGNvbnN0IHF1ZXJ5S2V5ID0gc3luY1RyZWVRdWVyeUtleUZvclRhZ18oc3luY1RyZWUsIHRhZyk7DQogICAgaWYgKHF1ZXJ5S2V5ICE9IG51bGwpIHsNCiAgICAgICAgY29uc3QgciA9IHN5bmNUcmVlUGFyc2VRdWVyeUtleV8ocXVlcnlLZXkpOw0KICAgICAgICBjb25zdCBxdWVyeVBhdGggPSByLnBhdGgsIHF1ZXJ5SWQgPSByLnF1ZXJ5SWQ7DQogICAgICAgIGNvbnN0IHJlbGF0aXZlUGF0aCA9IG5ld1JlbGF0aXZlUGF0aChxdWVyeVBhdGgsIHBhdGgpOw0KICAgICAgICBjb25zdCBvcCA9IG5ldyBPdmVyd3JpdGUobmV3T3BlcmF0aW9uU291cmNlU2VydmVyVGFnZ2VkUXVlcnkocXVlcnlJZCksIHJlbGF0aXZlUGF0aCwgc25hcCk7DQogICAgICAgIHJldHVybiBzeW5jVHJlZUFwcGx5VGFnZ2VkT3BlcmF0aW9uXyhzeW5jVHJlZSwgcXVlcnlQYXRoLCBvcCk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICAvLyBRdWVyeSBtdXN0IGhhdmUgYmVlbiByZW1vdmVkIGFscmVhZHkNCiAgICAgICAgcmV0dXJuIFtdOw0KICAgIH0NCn0NCi8qKg0KICogQXBwbHkgc2VydmVyIGRhdGEgdG8gYmUgbWVyZ2VkIGluIGZvciB0aGUgc3BlY2lmaWVkIHRhZ2dlZCBxdWVyeS4NCiAqDQogKiBAcmV0dXJucyBFdmVudHMgdG8gcmFpc2UuDQogKi8NCmZ1bmN0aW9uIHN5bmNUcmVlQXBwbHlUYWdnZWRRdWVyeU1lcmdlKHN5bmNUcmVlLCBwYXRoLCBjaGFuZ2VkQ2hpbGRyZW4sIHRhZykgew0KICAgIGNvbnN0IHF1ZXJ5S2V5ID0gc3luY1RyZWVRdWVyeUtleUZvclRhZ18oc3luY1RyZWUsIHRhZyk7DQogICAgaWYgKHF1ZXJ5S2V5KSB7DQogICAgICAgIGNvbnN0IHIgPSBzeW5jVHJlZVBhcnNlUXVlcnlLZXlfKHF1ZXJ5S2V5KTsNCiAgICAgICAgY29uc3QgcXVlcnlQYXRoID0gci5wYXRoLCBxdWVyeUlkID0gci5xdWVyeUlkOw0KICAgICAgICBjb25zdCByZWxhdGl2ZVBhdGggPSBuZXdSZWxhdGl2ZVBhdGgocXVlcnlQYXRoLCBwYXRoKTsNCiAgICAgICAgY29uc3QgY2hhbmdlVHJlZSA9IEltbXV0YWJsZVRyZWUuZnJvbU9iamVjdChjaGFuZ2VkQ2hpbGRyZW4pOw0KICAgICAgICBjb25zdCBvcCA9IG5ldyBNZXJnZShuZXdPcGVyYXRpb25Tb3VyY2VTZXJ2ZXJUYWdnZWRRdWVyeShxdWVyeUlkKSwgcmVsYXRpdmVQYXRoLCBjaGFuZ2VUcmVlKTsNCiAgICAgICAgcmV0dXJuIHN5bmNUcmVlQXBwbHlUYWdnZWRPcGVyYXRpb25fKHN5bmNUcmVlLCBxdWVyeVBhdGgsIG9wKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIC8vIFdlJ3ZlIGFscmVhZHkgcmVtb3ZlZCB0aGUgcXVlcnkuIE5vIGJpZyBkZWFsLCBpZ25vcmUgdGhlIHVwZGF0ZQ0KICAgICAgICByZXR1cm4gW107DQogICAgfQ0KfQ0KLyoqDQogKiBBZGQgYW4gZXZlbnQgY2FsbGJhY2sgZm9yIHRoZSBzcGVjaWZpZWQgcXVlcnkuDQogKg0KICogQHJldHVybnMgRXZlbnRzIHRvIHJhaXNlLg0KICovDQpmdW5jdGlvbiBzeW5jVHJlZUFkZEV2ZW50UmVnaXN0cmF0aW9uKHN5bmNUcmVlLCBxdWVyeSwgZXZlbnRSZWdpc3RyYXRpb24sIHNraXBTZXR1cExpc3RlbmVyID0gZmFsc2UpIHsNCiAgICBjb25zdCBwYXRoID0gcXVlcnkuX3BhdGg7DQogICAgbGV0IHNlcnZlckNhY2hlID0gbnVsbDsNCiAgICBsZXQgZm91bmRBbmNlc3RvckRlZmF1bHRWaWV3ID0gZmFsc2U7DQogICAgLy8gQW55IGNvdmVyaW5nIHdyaXRlcyB3aWxsIG5lY2Vzc2FyaWx5IGJlIGF0IHRoZSByb290LCBzbyByZWFsbHkgYWxsIHdlIG5lZWQgdG8gZmluZCBpcyB0aGUgc2VydmVyIGNhY2hlLg0KICAgIC8vIENvbnNpZGVyIG9wdGltaXppbmcgdGhpcyBvbmNlIHRoZXJlJ3MgYSBiZXR0ZXIgdW5kZXJzdGFuZGluZyBvZiB3aGF0IGFjdHVhbCBiZWhhdmlvciB3aWxsIGJlLg0KICAgIHN5bmNUcmVlLnN5bmNQb2ludFRyZWVfLmZvcmVhY2hPblBhdGgocGF0aCwgKHBhdGhUb1N5bmNQb2ludCwgc3ApID0+IHsNCiAgICAgICAgY29uc3QgcmVsYXRpdmVQYXRoID0gbmV3UmVsYXRpdmVQYXRoKHBhdGhUb1N5bmNQb2ludCwgcGF0aCk7DQogICAgICAgIHNlcnZlckNhY2hlID0NCiAgICAgICAgICAgIHNlcnZlckNhY2hlIHx8IHN5bmNQb2ludEdldENvbXBsZXRlU2VydmVyQ2FjaGUoc3AsIHJlbGF0aXZlUGF0aCk7DQogICAgICAgIGZvdW5kQW5jZXN0b3JEZWZhdWx0VmlldyA9DQogICAgICAgICAgICBmb3VuZEFuY2VzdG9yRGVmYXVsdFZpZXcgfHwgc3luY1BvaW50SGFzQ29tcGxldGVWaWV3KHNwKTsNCiAgICB9KTsNCiAgICBsZXQgc3luY1BvaW50ID0gc3luY1RyZWUuc3luY1BvaW50VHJlZV8uZ2V0KHBhdGgpOw0KICAgIGlmICghc3luY1BvaW50KSB7DQogICAgICAgIHN5bmNQb2ludCA9IG5ldyBTeW5jUG9pbnQoKTsNCiAgICAgICAgc3luY1RyZWUuc3luY1BvaW50VHJlZV8gPSBzeW5jVHJlZS5zeW5jUG9pbnRUcmVlXy5zZXQocGF0aCwgc3luY1BvaW50KTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGZvdW5kQW5jZXN0b3JEZWZhdWx0VmlldyA9DQogICAgICAgICAgICBmb3VuZEFuY2VzdG9yRGVmYXVsdFZpZXcgfHwgc3luY1BvaW50SGFzQ29tcGxldGVWaWV3KHN5bmNQb2ludCk7DQogICAgICAgIHNlcnZlckNhY2hlID0NCiAgICAgICAgICAgIHNlcnZlckNhY2hlIHx8IHN5bmNQb2ludEdldENvbXBsZXRlU2VydmVyQ2FjaGUoc3luY1BvaW50LCBuZXdFbXB0eVBhdGgoKSk7DQogICAgfQ0KICAgIGxldCBzZXJ2ZXJDYWNoZUNvbXBsZXRlOw0KICAgIGlmIChzZXJ2ZXJDYWNoZSAhPSBudWxsKSB7DQogICAgICAgIHNlcnZlckNhY2hlQ29tcGxldGUgPSB0cnVlOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgc2VydmVyQ2FjaGVDb21wbGV0ZSA9IGZhbHNlOw0KICAgICAgICBzZXJ2ZXJDYWNoZSA9IENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFOw0KICAgICAgICBjb25zdCBzdWJ0cmVlID0gc3luY1RyZWUuc3luY1BvaW50VHJlZV8uc3VidHJlZShwYXRoKTsNCiAgICAgICAgc3VidHJlZS5mb3JlYWNoQ2hpbGQoKGNoaWxkTmFtZSwgY2hpbGRTeW5jUG9pbnQpID0+IHsNCiAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRlQ2FjaGUgPSBzeW5jUG9pbnRHZXRDb21wbGV0ZVNlcnZlckNhY2hlKGNoaWxkU3luY1BvaW50LCBuZXdFbXB0eVBhdGgoKSk7DQogICAgICAgICAgICBpZiAoY29tcGxldGVDYWNoZSkgew0KICAgICAgICAgICAgICAgIHNlcnZlckNhY2hlID0gc2VydmVyQ2FjaGUudXBkYXRlSW1tZWRpYXRlQ2hpbGQoY2hpbGROYW1lLCBjb21wbGV0ZUNhY2hlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGNvbnN0IHZpZXdBbHJlYWR5RXhpc3RzID0gc3luY1BvaW50Vmlld0V4aXN0c0ZvclF1ZXJ5KHN5bmNQb2ludCwgcXVlcnkpOw0KICAgIGlmICghdmlld0FscmVhZHlFeGlzdHMgJiYgIXF1ZXJ5Ll9xdWVyeVBhcmFtcy5sb2Fkc0FsbERhdGEoKSkgew0KICAgICAgICAvLyBXZSBuZWVkIHRvIHRyYWNrIGEgdGFnIGZvciB0aGlzIHF1ZXJ5DQogICAgICAgIGNvbnN0IHF1ZXJ5S2V5ID0gc3luY1RyZWVNYWtlUXVlcnlLZXlfKHF1ZXJ5KTsNCiAgICAgICAgYXNzZXJ0KCFzeW5jVHJlZS5xdWVyeVRvVGFnTWFwLmhhcyhxdWVyeUtleSksICdWaWV3IGRvZXMgbm90IGV4aXN0LCBidXQgd2UgaGF2ZSBhIHRhZycpOw0KICAgICAgICBjb25zdCB0YWcgPSBzeW5jVHJlZUdldE5leHRRdWVyeVRhZ18oKTsNCiAgICAgICAgc3luY1RyZWUucXVlcnlUb1RhZ01hcC5zZXQocXVlcnlLZXksIHRhZyk7DQogICAgICAgIHN5bmNUcmVlLnRhZ1RvUXVlcnlNYXAuc2V0KHRhZywgcXVlcnlLZXkpOw0KICAgIH0NCiAgICBjb25zdCB3cml0ZXNDYWNoZSA9IHdyaXRlVHJlZUNoaWxkV3JpdGVzKHN5bmNUcmVlLnBlbmRpbmdXcml0ZVRyZWVfLCBwYXRoKTsNCiAgICBsZXQgZXZlbnRzID0gc3luY1BvaW50QWRkRXZlbnRSZWdpc3RyYXRpb24oc3luY1BvaW50LCBxdWVyeSwgZXZlbnRSZWdpc3RyYXRpb24sIHdyaXRlc0NhY2hlLCBzZXJ2ZXJDYWNoZSwgc2VydmVyQ2FjaGVDb21wbGV0ZSk7DQogICAgaWYgKCF2aWV3QWxyZWFkeUV4aXN0cyAmJiAhZm91bmRBbmNlc3RvckRlZmF1bHRWaWV3ICYmICFza2lwU2V0dXBMaXN0ZW5lcikgew0KICAgICAgICBjb25zdCB2aWV3ID0gc3luY1BvaW50Vmlld0ZvclF1ZXJ5KHN5bmNQb2ludCwgcXVlcnkpOw0KICAgICAgICBldmVudHMgPSBldmVudHMuY29uY2F0KHN5bmNUcmVlU2V0dXBMaXN0ZW5lcl8oc3luY1RyZWUsIHF1ZXJ5LCB2aWV3KSk7DQogICAgfQ0KICAgIHJldHVybiBldmVudHM7DQp9DQovKioNCiAqIFJldHVybnMgYSBjb21wbGV0ZSBjYWNoZSwgaWYgd2UgaGF2ZSBvbmUsIG9mIHRoZSBkYXRhIGF0IGEgcGFydGljdWxhciBwYXRoLiBJZiB0aGUgbG9jYXRpb24gZG9lcyBub3QgaGF2ZSBhDQogKiBsaXN0ZW5lciBhYm92ZSBpdCwgd2Ugd2lsbCBnZXQgYSBmYWxzZSAibnVsbCIuIFRoaXMgc2hvdWxkbid0IGJlIGEgcHJvYmxlbSBiZWNhdXNlIHRyYW5zYWN0aW9ucyB3aWxsIGFsd2F5cw0KICogaGF2ZSBhIGxpc3RlbmVyIGFib3ZlLCBhbmQgYXRvbWljIG9wZXJhdGlvbnMgd291bGQgY29ycmVjdGx5IHNob3cgYSBqaXR0ZXIgb2YgPGluY3JlbWVudCB2YWx1ZT4gLT4NCiAqICAgICA8aW5jcmVtZW50ZWQgdG90YWw+IGFzIHRoZSB3cml0ZSBpcyBhcHBsaWVkIGxvY2FsbHkgYW5kIHRoZW4gYWNrbm93bGVkZ2VkIGF0IHRoZSBzZXJ2ZXIuDQogKg0KICogTm90ZTogdGhpcyBtZXRob2Qgd2lsbCAqaW5jbHVkZSogaGlkZGVuIHdyaXRlcyBmcm9tIHRyYW5zYWN0aW9uIHdpdGggYXBwbHlMb2NhbGx5IHNldCB0byBmYWxzZS4NCiAqDQogKiBAcGFyYW0gcGF0aCAtIFRoZSBwYXRoIHRvIHRoZSBkYXRhIHdlIHdhbnQNCiAqIEBwYXJhbSB3cml0ZUlkc1RvRXhjbHVkZSAtIEEgc3BlY2lmaWMgc2V0IHRvIGJlIGV4Y2x1ZGVkDQogKi8NCmZ1bmN0aW9uIHN5bmNUcmVlQ2FsY0NvbXBsZXRlRXZlbnRDYWNoZShzeW5jVHJlZSwgcGF0aCwgd3JpdGVJZHNUb0V4Y2x1ZGUpIHsNCiAgICBjb25zdCBpbmNsdWRlSGlkZGVuU2V0cyA9IHRydWU7DQogICAgY29uc3Qgd3JpdGVUcmVlID0gc3luY1RyZWUucGVuZGluZ1dyaXRlVHJlZV87DQogICAgY29uc3Qgc2VydmVyQ2FjaGUgPSBzeW5jVHJlZS5zeW5jUG9pbnRUcmVlXy5maW5kT25QYXRoKHBhdGgsIChwYXRoU29GYXIsIHN5bmNQb2ludCkgPT4gew0KICAgICAgICBjb25zdCByZWxhdGl2ZVBhdGggPSBuZXdSZWxhdGl2ZVBhdGgocGF0aFNvRmFyLCBwYXRoKTsNCiAgICAgICAgY29uc3Qgc2VydmVyQ2FjaGUgPSBzeW5jUG9pbnRHZXRDb21wbGV0ZVNlcnZlckNhY2hlKHN5bmNQb2ludCwgcmVsYXRpdmVQYXRoKTsNCiAgICAgICAgaWYgKHNlcnZlckNhY2hlKSB7DQogICAgICAgICAgICByZXR1cm4gc2VydmVyQ2FjaGU7DQogICAgICAgIH0NCiAgICB9KTsNCiAgICByZXR1cm4gd3JpdGVUcmVlQ2FsY0NvbXBsZXRlRXZlbnRDYWNoZSh3cml0ZVRyZWUsIHBhdGgsIHNlcnZlckNhY2hlLCB3cml0ZUlkc1RvRXhjbHVkZSwgaW5jbHVkZUhpZGRlblNldHMpOw0KfQ0KLyoqDQogKiBBIGhlbHBlciBtZXRob2QgdGhhdCB2aXNpdHMgYWxsIGRlc2NlbmRhbnQgYW5kIGFuY2VzdG9yIFN5bmNQb2ludHMsIGFwcGx5aW5nIHRoZSBvcGVyYXRpb24uDQogKg0KICogTk9URVM6DQogKiAtIERlc2NlbmRhbnQgU3luY1BvaW50cyB3aWxsIGJlIHZpc2l0ZWQgZmlyc3QgKHNpbmNlIHdlIHJhaXNlIGV2ZW50cyBkZXB0aC1maXJzdCkuDQogKg0KICogLSBXZSBjYWxsIGFwcGx5T3BlcmF0aW9uKCkgb24gZWFjaCBTeW5jUG9pbnQgcGFzc2luZyB0aHJlZSB0aGluZ3M6DQogKiAgIDEuIEEgdmVyc2lvbiBvZiB0aGUgT3BlcmF0aW9uIHRoYXQgaGFzIGJlZW4gbWFkZSByZWxhdGl2ZSB0byB0aGUgU3luY1BvaW50IGxvY2F0aW9uLg0KICogICAyLiBBIFdyaXRlVHJlZVJlZiBvZiBhbnkgd3JpdGVzIHdlIGhhdmUgY2FjaGVkIGF0IHRoZSBTeW5jUG9pbnQgbG9jYXRpb24uDQogKiAgIDMuIEEgc25hcHNob3QgTm9kZSB3aXRoIGNhY2hlZCBzZXJ2ZXIgZGF0YSwgaWYgd2UgaGF2ZSBpdC4NCiAqDQogKiAtIFdlIGNvbmNhdGVuYXRlIGFsbCBvZiB0aGUgZXZlbnRzIHJldHVybmVkIGJ5IGVhY2ggU3luY1BvaW50IGFuZCByZXR1cm4gdGhlIHJlc3VsdC4NCiAqLw0KZnVuY3Rpb24gc3luY1RyZWVBcHBseU9wZXJhdGlvblRvU3luY1BvaW50c18oc3luY1RyZWUsIG9wZXJhdGlvbikgew0KICAgIHJldHVybiBzeW5jVHJlZUFwcGx5T3BlcmF0aW9uSGVscGVyXyhvcGVyYXRpb24sIHN5bmNUcmVlLnN5bmNQb2ludFRyZWVfLCANCiAgICAvKnNlcnZlckNhY2hlPSovIG51bGwsIHdyaXRlVHJlZUNoaWxkV3JpdGVzKHN5bmNUcmVlLnBlbmRpbmdXcml0ZVRyZWVfLCBuZXdFbXB0eVBhdGgoKSkpOw0KfQ0KLyoqDQogKiBSZWN1cnNpdmUgaGVscGVyIGZvciBhcHBseU9wZXJhdGlvblRvU3luY1BvaW50c18NCiAqLw0KZnVuY3Rpb24gc3luY1RyZWVBcHBseU9wZXJhdGlvbkhlbHBlcl8ob3BlcmF0aW9uLCBzeW5jUG9pbnRUcmVlLCBzZXJ2ZXJDYWNoZSwgd3JpdGVzQ2FjaGUpIHsNCiAgICBpZiAocGF0aElzRW1wdHkob3BlcmF0aW9uLnBhdGgpKSB7DQogICAgICAgIHJldHVybiBzeW5jVHJlZUFwcGx5T3BlcmF0aW9uRGVzY2VuZGFudHNIZWxwZXJfKG9wZXJhdGlvbiwgc3luY1BvaW50VHJlZSwgc2VydmVyQ2FjaGUsIHdyaXRlc0NhY2hlKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGNvbnN0IHN5bmNQb2ludCA9IHN5bmNQb2ludFRyZWUuZ2V0KG5ld0VtcHR5UGF0aCgpKTsNCiAgICAgICAgLy8gSWYgd2UgZG9uJ3QgaGF2ZSBjYWNoZWQgc2VydmVyIGRhdGEsIHNlZSBpZiB3ZSBjYW4gZ2V0IGl0IGZyb20gdGhpcyBTeW5jUG9pbnQuDQogICAgICAgIGlmIChzZXJ2ZXJDYWNoZSA9PSBudWxsICYmIHN5bmNQb2ludCAhPSBudWxsKSB7DQogICAgICAgICAgICBzZXJ2ZXJDYWNoZSA9IHN5bmNQb2ludEdldENvbXBsZXRlU2VydmVyQ2FjaGUoc3luY1BvaW50LCBuZXdFbXB0eVBhdGgoKSk7DQogICAgICAgIH0NCiAgICAgICAgbGV0IGV2ZW50cyA9IFtdOw0KICAgICAgICBjb25zdCBjaGlsZE5hbWUgPSBwYXRoR2V0RnJvbnQob3BlcmF0aW9uLnBhdGgpOw0KICAgICAgICBjb25zdCBjaGlsZE9wZXJhdGlvbiA9IG9wZXJhdGlvbi5vcGVyYXRpb25Gb3JDaGlsZChjaGlsZE5hbWUpOw0KICAgICAgICBjb25zdCBjaGlsZFRyZWUgPSBzeW5jUG9pbnRUcmVlLmNoaWxkcmVuLmdldChjaGlsZE5hbWUpOw0KICAgICAgICBpZiAoY2hpbGRUcmVlICYmIGNoaWxkT3BlcmF0aW9uKSB7DQogICAgICAgICAgICBjb25zdCBjaGlsZFNlcnZlckNhY2hlID0gc2VydmVyQ2FjaGUNCiAgICAgICAgICAgICAgICA/IHNlcnZlckNhY2hlLmdldEltbWVkaWF0ZUNoaWxkKGNoaWxkTmFtZSkNCiAgICAgICAgICAgICAgICA6IG51bGw7DQogICAgICAgICAgICBjb25zdCBjaGlsZFdyaXRlc0NhY2hlID0gd3JpdGVUcmVlUmVmQ2hpbGQod3JpdGVzQ2FjaGUsIGNoaWxkTmFtZSk7DQogICAgICAgICAgICBldmVudHMgPSBldmVudHMuY29uY2F0KHN5bmNUcmVlQXBwbHlPcGVyYXRpb25IZWxwZXJfKGNoaWxkT3BlcmF0aW9uLCBjaGlsZFRyZWUsIGNoaWxkU2VydmVyQ2FjaGUsIGNoaWxkV3JpdGVzQ2FjaGUpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoc3luY1BvaW50KSB7DQogICAgICAgICAgICBldmVudHMgPSBldmVudHMuY29uY2F0KHN5bmNQb2ludEFwcGx5T3BlcmF0aW9uKHN5bmNQb2ludCwgb3BlcmF0aW9uLCB3cml0ZXNDYWNoZSwgc2VydmVyQ2FjaGUpKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZXZlbnRzOw0KICAgIH0NCn0NCi8qKg0KICogUmVjdXJzaXZlIGhlbHBlciBmb3IgYXBwbHlPcGVyYXRpb25Ub1N5bmNQb2ludHNfDQogKi8NCmZ1bmN0aW9uIHN5bmNUcmVlQXBwbHlPcGVyYXRpb25EZXNjZW5kYW50c0hlbHBlcl8ob3BlcmF0aW9uLCBzeW5jUG9pbnRUcmVlLCBzZXJ2ZXJDYWNoZSwgd3JpdGVzQ2FjaGUpIHsNCiAgICBjb25zdCBzeW5jUG9pbnQgPSBzeW5jUG9pbnRUcmVlLmdldChuZXdFbXB0eVBhdGgoKSk7DQogICAgLy8gSWYgd2UgZG9uJ3QgaGF2ZSBjYWNoZWQgc2VydmVyIGRhdGEsIHNlZSBpZiB3ZSBjYW4gZ2V0IGl0IGZyb20gdGhpcyBTeW5jUG9pbnQuDQogICAgaWYgKHNlcnZlckNhY2hlID09IG51bGwgJiYgc3luY1BvaW50ICE9IG51bGwpIHsNCiAgICAgICAgc2VydmVyQ2FjaGUgPSBzeW5jUG9pbnRHZXRDb21wbGV0ZVNlcnZlckNhY2hlKHN5bmNQb2ludCwgbmV3RW1wdHlQYXRoKCkpOw0KICAgIH0NCiAgICBsZXQgZXZlbnRzID0gW107DQogICAgc3luY1BvaW50VHJlZS5jaGlsZHJlbi5pbm9yZGVyVHJhdmVyc2FsKChjaGlsZE5hbWUsIGNoaWxkVHJlZSkgPT4gew0KICAgICAgICBjb25zdCBjaGlsZFNlcnZlckNhY2hlID0gc2VydmVyQ2FjaGUNCiAgICAgICAgICAgID8gc2VydmVyQ2FjaGUuZ2V0SW1tZWRpYXRlQ2hpbGQoY2hpbGROYW1lKQ0KICAgICAgICAgICAgOiBudWxsOw0KICAgICAgICBjb25zdCBjaGlsZFdyaXRlc0NhY2hlID0gd3JpdGVUcmVlUmVmQ2hpbGQod3JpdGVzQ2FjaGUsIGNoaWxkTmFtZSk7DQogICAgICAgIGNvbnN0IGNoaWxkT3BlcmF0aW9uID0gb3BlcmF0aW9uLm9wZXJhdGlvbkZvckNoaWxkKGNoaWxkTmFtZSk7DQogICAgICAgIGlmIChjaGlsZE9wZXJhdGlvbikgew0KICAgICAgICAgICAgZXZlbnRzID0gZXZlbnRzLmNvbmNhdChzeW5jVHJlZUFwcGx5T3BlcmF0aW9uRGVzY2VuZGFudHNIZWxwZXJfKGNoaWxkT3BlcmF0aW9uLCBjaGlsZFRyZWUsIGNoaWxkU2VydmVyQ2FjaGUsIGNoaWxkV3JpdGVzQ2FjaGUpKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIGlmIChzeW5jUG9pbnQpIHsNCiAgICAgICAgZXZlbnRzID0gZXZlbnRzLmNvbmNhdChzeW5jUG9pbnRBcHBseU9wZXJhdGlvbihzeW5jUG9pbnQsIG9wZXJhdGlvbiwgd3JpdGVzQ2FjaGUsIHNlcnZlckNhY2hlKSk7DQogICAgfQ0KICAgIHJldHVybiBldmVudHM7DQp9DQpmdW5jdGlvbiBzeW5jVHJlZUNyZWF0ZUxpc3RlbmVyRm9yVmlld18oc3luY1RyZWUsIHZpZXcpIHsNCiAgICBjb25zdCBxdWVyeSA9IHZpZXcucXVlcnk7DQogICAgY29uc3QgdGFnID0gc3luY1RyZWVUYWdGb3JRdWVyeShzeW5jVHJlZSwgcXVlcnkpOw0KICAgIHJldHVybiB7DQogICAgICAgIGhhc2hGbjogKCkgPT4gew0KICAgICAgICAgICAgY29uc3QgY2FjaGUgPSB2aWV3R2V0U2VydmVyQ2FjaGUodmlldykgfHwgQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREU7DQogICAgICAgICAgICByZXR1cm4gY2FjaGUuaGFzaCgpOw0KICAgICAgICB9LA0KICAgICAgICBvbkNvbXBsZXRlOiAoc3RhdHVzKSA9PiB7DQogICAgICAgICAgICBpZiAoc3RhdHVzID09PSAnb2snKSB7DQogICAgICAgICAgICAgICAgaWYgKHRhZykgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3luY1RyZWVBcHBseVRhZ2dlZExpc3RlbkNvbXBsZXRlKHN5bmNUcmVlLCBxdWVyeS5fcGF0aCwgdGFnKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzeW5jVHJlZUFwcGx5TGlzdGVuQ29tcGxldGUoc3luY1RyZWUsIHF1ZXJ5Ll9wYXRoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAvLyBJZiBhIGxpc3RlbiBmYWlsZWQsIGtpbGwgYWxsIG9mIHRoZSBsaXN0ZW5lcnMgaGVyZSwgbm90IGp1c3QgdGhlIG9uZSB0aGF0IHRyaWdnZXJlZCB0aGUgZXJyb3IuDQogICAgICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHRoaXMgbWF5IG5lZWQgdG8gYmUgc2NvcGVkIHRvIGp1c3QgdGhpcyBsaXN0ZW5lciBpZiB3ZSBjaGFuZ2UgcGVybWlzc2lvbnMgb24gZmlsdGVyZWQgY2hpbGRyZW4NCiAgICAgICAgICAgICAgICBjb25zdCBlcnJvciA9IGVycm9yRm9yU2VydmVyQ29kZShzdGF0dXMsIHF1ZXJ5KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gc3luY1RyZWVSZW1vdmVFdmVudFJlZ2lzdHJhdGlvbihzeW5jVHJlZSwgcXVlcnksIA0KICAgICAgICAgICAgICAgIC8qZXZlbnRSZWdpc3RyYXRpb24qLyBudWxsLCBlcnJvcik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9Ow0KfQ0KLyoqDQogKiBSZXR1cm4gdGhlIHRhZyBhc3NvY2lhdGVkIHdpdGggdGhlIGdpdmVuIHF1ZXJ5Lg0KICovDQpmdW5jdGlvbiBzeW5jVHJlZVRhZ0ZvclF1ZXJ5KHN5bmNUcmVlLCBxdWVyeSkgew0KICAgIGNvbnN0IHF1ZXJ5S2V5ID0gc3luY1RyZWVNYWtlUXVlcnlLZXlfKHF1ZXJ5KTsNCiAgICByZXR1cm4gc3luY1RyZWUucXVlcnlUb1RhZ01hcC5nZXQocXVlcnlLZXkpOw0KfQ0KLyoqDQogKiBHaXZlbiBhIHF1ZXJ5LCBjb21wdXRlcyBhICJxdWVyeUtleSIgc3VpdGFibGUgZm9yIHVzZSBpbiBvdXIgcXVlcnlUb1RhZ01hcF8uDQogKi8NCmZ1bmN0aW9uIHN5bmNUcmVlTWFrZVF1ZXJ5S2V5XyhxdWVyeSkgew0KICAgIHJldHVybiBxdWVyeS5fcGF0aC50b1N0cmluZygpICsgJyQnICsgcXVlcnkuX3F1ZXJ5SWRlbnRpZmllcjsNCn0NCi8qKg0KICogUmV0dXJuIHRoZSBxdWVyeSBhc3NvY2lhdGVkIHdpdGggdGhlIGdpdmVuIHRhZywgaWYgd2UgaGF2ZSBvbmUNCiAqLw0KZnVuY3Rpb24gc3luY1RyZWVRdWVyeUtleUZvclRhZ18oc3luY1RyZWUsIHRhZykgew0KICAgIHJldHVybiBzeW5jVHJlZS50YWdUb1F1ZXJ5TWFwLmdldCh0YWcpOw0KfQ0KLyoqDQogKiBHaXZlbiBhIHF1ZXJ5S2V5IChjcmVhdGVkIGJ5IG1ha2VRdWVyeUtleSksIHBhcnNlIGl0IGJhY2sgaW50byBhIHBhdGggYW5kIHF1ZXJ5SWQuDQogKi8NCmZ1bmN0aW9uIHN5bmNUcmVlUGFyc2VRdWVyeUtleV8ocXVlcnlLZXkpIHsNCiAgICBjb25zdCBzcGxpdEluZGV4ID0gcXVlcnlLZXkuaW5kZXhPZignJCcpOw0KICAgIGFzc2VydChzcGxpdEluZGV4ICE9PSAtMSAmJiBzcGxpdEluZGV4IDwgcXVlcnlLZXkubGVuZ3RoIC0gMSwgJ0JhZCBxdWVyeUtleS4nKTsNCiAgICByZXR1cm4gew0KICAgICAgICBxdWVyeUlkOiBxdWVyeUtleS5zdWJzdHIoc3BsaXRJbmRleCArIDEpLA0KICAgICAgICBwYXRoOiBuZXcgUGF0aChxdWVyeUtleS5zdWJzdHIoMCwgc3BsaXRJbmRleCkpDQogICAgfTsNCn0NCi8qKg0KICogQSBoZWxwZXIgbWV0aG9kIHRvIGFwcGx5IHRhZ2dlZCBvcGVyYXRpb25zDQogKi8NCmZ1bmN0aW9uIHN5bmNUcmVlQXBwbHlUYWdnZWRPcGVyYXRpb25fKHN5bmNUcmVlLCBxdWVyeVBhdGgsIG9wZXJhdGlvbikgew0KICAgIGNvbnN0IHN5bmNQb2ludCA9IHN5bmNUcmVlLnN5bmNQb2ludFRyZWVfLmdldChxdWVyeVBhdGgpOw0KICAgIGFzc2VydChzeW5jUG9pbnQsICJNaXNzaW5nIHN5bmMgcG9pbnQgZm9yIHF1ZXJ5IHRhZyB0aGF0IHdlJ3JlIHRyYWNraW5nIik7DQogICAgY29uc3Qgd3JpdGVzQ2FjaGUgPSB3cml0ZVRyZWVDaGlsZFdyaXRlcyhzeW5jVHJlZS5wZW5kaW5nV3JpdGVUcmVlXywgcXVlcnlQYXRoKTsNCiAgICByZXR1cm4gc3luY1BvaW50QXBwbHlPcGVyYXRpb24oc3luY1BvaW50LCBvcGVyYXRpb24sIHdyaXRlc0NhY2hlLCBudWxsKTsNCn0NCi8qKg0KICogVGhpcyBjb2xsYXBzZXMgbXVsdGlwbGUgdW5maWx0ZXJlZCB2aWV3cyBpbnRvIGEgc2luZ2xlIHZpZXcsIHNpbmNlIHdlIG9ubHkgbmVlZCBhIHNpbmdsZQ0KICogbGlzdGVuZXIgZm9yIHRoZW0uDQogKi8NCmZ1bmN0aW9uIHN5bmNUcmVlQ29sbGVjdERpc3RpbmN0Vmlld3NGb3JTdWJUcmVlXyhzdWJ0cmVlKSB7DQogICAgcmV0dXJuIHN1YnRyZWUuZm9sZCgocmVsYXRpdmVQYXRoLCBtYXliZUNoaWxkU3luY1BvaW50LCBjaGlsZE1hcCkgPT4gew0KICAgICAgICBpZiAobWF5YmVDaGlsZFN5bmNQb2ludCAmJiBzeW5jUG9pbnRIYXNDb21wbGV0ZVZpZXcobWF5YmVDaGlsZFN5bmNQb2ludCkpIHsNCiAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRlVmlldyA9IHN5bmNQb2ludEdldENvbXBsZXRlVmlldyhtYXliZUNoaWxkU3luY1BvaW50KTsNCiAgICAgICAgICAgIHJldHVybiBbY29tcGxldGVWaWV3XTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIC8vIE5vIGNvbXBsZXRlIHZpZXcgaGVyZSwgZmxhdHRlbiBhbnkgZGVlcGVyIGxpc3RlbnMgaW50byBhbiBhcnJheQ0KICAgICAgICAgICAgbGV0IHZpZXdzID0gW107DQogICAgICAgICAgICBpZiAobWF5YmVDaGlsZFN5bmNQb2ludCkgew0KICAgICAgICAgICAgICAgIHZpZXdzID0gc3luY1BvaW50R2V0UXVlcnlWaWV3cyhtYXliZUNoaWxkU3luY1BvaW50KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVhY2goY2hpbGRNYXAsIChfa2V5LCBjaGlsZFZpZXdzKSA9PiB7DQogICAgICAgICAgICAgICAgdmlld3MgPSB2aWV3cy5jb25jYXQoY2hpbGRWaWV3cyk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIHJldHVybiB2aWV3czsNCiAgICAgICAgfQ0KICAgIH0pOw0KfQ0KLyoqDQogKiBOb3JtYWxpemVzIGEgcXVlcnkgdG8gYSBxdWVyeSB3ZSBzZW5kIHRoZSBzZXJ2ZXIgZm9yIGxpc3RlbmluZw0KICoNCiAqIEByZXR1cm5zIFRoZSBub3JtYWxpemVkIHF1ZXJ5DQogKi8NCmZ1bmN0aW9uIHN5bmNUcmVlUXVlcnlGb3JMaXN0ZW5pbmdfKHF1ZXJ5KSB7DQogICAgaWYgKHF1ZXJ5Ll9xdWVyeVBhcmFtcy5sb2Fkc0FsbERhdGEoKSAmJiAhcXVlcnkuX3F1ZXJ5UGFyYW1zLmlzRGVmYXVsdCgpKSB7DQogICAgICAgIC8vIFdlIHRyZWF0IHF1ZXJpZXMgdGhhdCBsb2FkIGFsbCBkYXRhIGFzIGRlZmF1bHQgcXVlcmllcw0KICAgICAgICAvLyBDYXN0IGlzIG5lY2Vzc2FyeSBiZWNhdXNlIHJlZigpIHRlY2huaWNhbGx5IHJldHVybnMgRmlyZWJhc2Ugd2hpY2ggaXMgYWN0dWFsbHkgZmIuYXBpLkZpcmViYXNlIHdoaWNoIGluaGVyaXRzDQogICAgICAgIC8vIGZyb20gUXVlcnkNCiAgICAgICAgcmV0dXJuIG5ldyAoc3luY1RyZWVHZXRSZWZlcmVuY2VDb25zdHJ1Y3RvcigpKShxdWVyeS5fcmVwbywgcXVlcnkuX3BhdGgpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgcmV0dXJuIHF1ZXJ5Ow0KICAgIH0NCn0NCmZ1bmN0aW9uIHN5bmNUcmVlUmVtb3ZlVGFnc18oc3luY1RyZWUsIHF1ZXJpZXMpIHsNCiAgICBmb3IgKGxldCBqID0gMDsgaiA8IHF1ZXJpZXMubGVuZ3RoOyArK2opIHsNCiAgICAgICAgY29uc3QgcmVtb3ZlZFF1ZXJ5ID0gcXVlcmllc1tqXTsNCiAgICAgICAgaWYgKCFyZW1vdmVkUXVlcnkuX3F1ZXJ5UGFyYW1zLmxvYWRzQWxsRGF0YSgpKSB7DQogICAgICAgICAgICAvLyBXZSBzaG91bGQgaGF2ZSBhIHRhZyBmb3IgdGhpcw0KICAgICAgICAgICAgY29uc3QgcmVtb3ZlZFF1ZXJ5S2V5ID0gc3luY1RyZWVNYWtlUXVlcnlLZXlfKHJlbW92ZWRRdWVyeSk7DQogICAgICAgICAgICBjb25zdCByZW1vdmVkUXVlcnlUYWcgPSBzeW5jVHJlZS5xdWVyeVRvVGFnTWFwLmdldChyZW1vdmVkUXVlcnlLZXkpOw0KICAgICAgICAgICAgc3luY1RyZWUucXVlcnlUb1RhZ01hcC5kZWxldGUocmVtb3ZlZFF1ZXJ5S2V5KTsNCiAgICAgICAgICAgIHN5bmNUcmVlLnRhZ1RvUXVlcnlNYXAuZGVsZXRlKHJlbW92ZWRRdWVyeVRhZyk7DQogICAgICAgIH0NCiAgICB9DQp9DQovKioNCiAqIFN0YXRpYyBhY2Nlc3NvciBmb3IgcXVlcnkgdGFncy4NCiAqLw0KZnVuY3Rpb24gc3luY1RyZWVHZXROZXh0UXVlcnlUYWdfKCkgew0KICAgIHJldHVybiBzeW5jVHJlZU5leHRRdWVyeVRhZ18rKzsNCn0NCi8qKg0KICogRm9yIGEgZ2l2ZW4gbmV3IGxpc3RlbiwgbWFuYWdlIHRoZSBkZS1kdXBsaWNhdGlvbiBvZiBvdXRzdGFuZGluZyBzdWJzY3JpcHRpb25zLg0KICoNCiAqIEByZXR1cm5zIFRoaXMgbWV0aG9kIGNhbiByZXR1cm4gZXZlbnRzIHRvIHN1cHBvcnQgc3luY2hyb25vdXMgZGF0YSBzb3VyY2VzDQogKi8NCmZ1bmN0aW9uIHN5bmNUcmVlU2V0dXBMaXN0ZW5lcl8oc3luY1RyZWUsIHF1ZXJ5LCB2aWV3KSB7DQogICAgY29uc3QgcGF0aCA9IHF1ZXJ5Ll9wYXRoOw0KICAgIGNvbnN0IHRhZyA9IHN5bmNUcmVlVGFnRm9yUXVlcnkoc3luY1RyZWUsIHF1ZXJ5KTsNCiAgICBjb25zdCBsaXN0ZW5lciA9IHN5bmNUcmVlQ3JlYXRlTGlzdGVuZXJGb3JWaWV3XyhzeW5jVHJlZSwgdmlldyk7DQogICAgY29uc3QgZXZlbnRzID0gc3luY1RyZWUubGlzdGVuUHJvdmlkZXJfLnN0YXJ0TGlzdGVuaW5nKHN5bmNUcmVlUXVlcnlGb3JMaXN0ZW5pbmdfKHF1ZXJ5KSwgdGFnLCBsaXN0ZW5lci5oYXNoRm4sIGxpc3RlbmVyLm9uQ29tcGxldGUpOw0KICAgIGNvbnN0IHN1YnRyZWUgPSBzeW5jVHJlZS5zeW5jUG9pbnRUcmVlXy5zdWJ0cmVlKHBhdGgpOw0KICAgIC8vIFRoZSByb290IG9mIHRoaXMgc3VidHJlZSBoYXMgb3VyIHF1ZXJ5LiBXZSdyZSBoZXJlIGJlY2F1c2Ugd2UgZGVmaW5pdGVseSBuZWVkIHRvIHNlbmQgYSBsaXN0ZW4gZm9yIHRoYXQsIGJ1dCB3ZQ0KICAgIC8vIG1heSBuZWVkIHRvIHNoYWRvdyBvdGhlciBsaXN0ZW5zIGFzIHdlbGwuDQogICAgaWYgKHRhZykgew0KICAgICAgICBhc3NlcnQoIXN5bmNQb2ludEhhc0NvbXBsZXRlVmlldyhzdWJ0cmVlLnZhbHVlKSwgIklmIHdlJ3JlIGFkZGluZyBhIHF1ZXJ5LCBpdCBzaG91bGRuJ3QgYmUgc2hhZG93ZWQiKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIC8vIFNoYWRvdyBldmVyeXRoaW5nIGF0IG9yIGJlbG93IHRoaXMgbG9jYXRpb24sIHRoaXMgaXMgYSBkZWZhdWx0IGxpc3RlbmVyLg0KICAgICAgICBjb25zdCBxdWVyaWVzVG9TdG9wID0gc3VidHJlZS5mb2xkKChyZWxhdGl2ZVBhdGgsIG1heWJlQ2hpbGRTeW5jUG9pbnQsIGNoaWxkTWFwKSA9PiB7DQogICAgICAgICAgICBpZiAoIXBhdGhJc0VtcHR5KHJlbGF0aXZlUGF0aCkgJiYNCiAgICAgICAgICAgICAgICBtYXliZUNoaWxkU3luY1BvaW50ICYmDQogICAgICAgICAgICAgICAgc3luY1BvaW50SGFzQ29tcGxldGVWaWV3KG1heWJlQ2hpbGRTeW5jUG9pbnQpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFtzeW5jUG9pbnRHZXRDb21wbGV0ZVZpZXcobWF5YmVDaGlsZFN5bmNQb2ludCkucXVlcnldOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gTm8gZGVmYXVsdCBsaXN0ZW5lciBoZXJlLCBmbGF0dGVuIGFueSBkZWVwZXIgcXVlcmllcyBpbnRvIGFuIGFycmF5DQogICAgICAgICAgICAgICAgbGV0IHF1ZXJpZXMgPSBbXTsNCiAgICAgICAgICAgICAgICBpZiAobWF5YmVDaGlsZFN5bmNQb2ludCkgew0KICAgICAgICAgICAgICAgICAgICBxdWVyaWVzID0gcXVlcmllcy5jb25jYXQoc3luY1BvaW50R2V0UXVlcnlWaWV3cyhtYXliZUNoaWxkU3luY1BvaW50KS5tYXAodmlldyA9PiB2aWV3LnF1ZXJ5KSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVhY2goY2hpbGRNYXAsIChfa2V5LCBjaGlsZFF1ZXJpZXMpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgcXVlcmllcyA9IHF1ZXJpZXMuY29uY2F0KGNoaWxkUXVlcmllcyk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHF1ZXJpZXM7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHF1ZXJpZXNUb1N0b3AubGVuZ3RoOyArK2kpIHsNCiAgICAgICAgICAgIGNvbnN0IHF1ZXJ5VG9TdG9wID0gcXVlcmllc1RvU3RvcFtpXTsNCiAgICAgICAgICAgIHN5bmNUcmVlLmxpc3RlblByb3ZpZGVyXy5zdG9wTGlzdGVuaW5nKHN5bmNUcmVlUXVlcnlGb3JMaXN0ZW5pbmdfKHF1ZXJ5VG9TdG9wKSwgc3luY1RyZWVUYWdGb3JRdWVyeShzeW5jVHJlZSwgcXVlcnlUb1N0b3ApKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gZXZlbnRzOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY2xhc3MgRXhpc3RpbmdWYWx1ZVByb3ZpZGVyIHsNCiAgICBjb25zdHJ1Y3Rvcihub2RlXykgew0KICAgICAgICB0aGlzLm5vZGVfID0gbm9kZV87DQogICAgfQ0KICAgIGdldEltbWVkaWF0ZUNoaWxkKGNoaWxkTmFtZSkgew0KICAgICAgICBjb25zdCBjaGlsZCA9IHRoaXMubm9kZV8uZ2V0SW1tZWRpYXRlQ2hpbGQoY2hpbGROYW1lKTsNCiAgICAgICAgcmV0dXJuIG5ldyBFeGlzdGluZ1ZhbHVlUHJvdmlkZXIoY2hpbGQpOw0KICAgIH0NCiAgICBub2RlKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5ub2RlXzsNCiAgICB9DQp9DQpjbGFzcyBEZWZlcnJlZFZhbHVlUHJvdmlkZXIgew0KICAgIGNvbnN0cnVjdG9yKHN5bmNUcmVlLCBwYXRoKSB7DQogICAgICAgIHRoaXMuc3luY1RyZWVfID0gc3luY1RyZWU7DQogICAgICAgIHRoaXMucGF0aF8gPSBwYXRoOw0KICAgIH0NCiAgICBnZXRJbW1lZGlhdGVDaGlsZChjaGlsZE5hbWUpIHsNCiAgICAgICAgY29uc3QgY2hpbGRQYXRoID0gcGF0aENoaWxkKHRoaXMucGF0aF8sIGNoaWxkTmFtZSk7DQogICAgICAgIHJldHVybiBuZXcgRGVmZXJyZWRWYWx1ZVByb3ZpZGVyKHRoaXMuc3luY1RyZWVfLCBjaGlsZFBhdGgpOw0KICAgIH0NCiAgICBub2RlKCkgew0KICAgICAgICByZXR1cm4gc3luY1RyZWVDYWxjQ29tcGxldGVFdmVudENhY2hlKHRoaXMuc3luY1RyZWVfLCB0aGlzLnBhdGhfKTsNCiAgICB9DQp9DQovKioNCiAqIEdlbmVyYXRlIHBsYWNlaG9sZGVycyBmb3IgZGVmZXJyZWQgdmFsdWVzLg0KICovDQpjb25zdCBnZW5lcmF0ZVdpdGhWYWx1ZXMgPSBmdW5jdGlvbiAodmFsdWVzKSB7DQogICAgdmFsdWVzID0gdmFsdWVzIHx8IHt9Ow0KICAgIHZhbHVlc1sndGltZXN0YW1wJ10gPSB2YWx1ZXNbJ3RpbWVzdGFtcCddIHx8IG5ldyBEYXRlKCkuZ2V0VGltZSgpOw0KICAgIHJldHVybiB2YWx1ZXM7DQp9Ow0KLyoqDQogKiBWYWx1ZSB0byB1c2Ugd2hlbiBmaXJpbmcgbG9jYWwgZXZlbnRzLiBXaGVuIHdyaXRpbmcgc2VydmVyIHZhbHVlcywgZmlyZQ0KICogbG9jYWwgZXZlbnRzIHdpdGggYW4gYXBwcm94aW1hdGUgdmFsdWUsIG90aGVyd2lzZSByZXR1cm4gdmFsdWUgYXMtaXMuDQogKi8NCmNvbnN0IHJlc29sdmVEZWZlcnJlZExlYWZWYWx1ZSA9IGZ1bmN0aW9uICh2YWx1ZSwgZXhpc3RpbmdWYWwsIHNlcnZlclZhbHVlcykgew0KICAgIGlmICghdmFsdWUgfHwgdHlwZW9mIHZhbHVlICE9PSAnb2JqZWN0Jykgew0KICAgICAgICByZXR1cm4gdmFsdWU7DQogICAgfQ0KICAgIGFzc2VydCgnLnN2JyBpbiB2YWx1ZSwgJ1VuZXhwZWN0ZWQgbGVhZiBub2RlIG9yIHByaW9yaXR5IGNvbnRlbnRzJyk7DQogICAgaWYgKHR5cGVvZiB2YWx1ZVsnLnN2J10gPT09ICdzdHJpbmcnKSB7DQogICAgICAgIHJldHVybiByZXNvbHZlU2NhbGFyRGVmZXJyZWRWYWx1ZSh2YWx1ZVsnLnN2J10sIGV4aXN0aW5nVmFsLCBzZXJ2ZXJWYWx1ZXMpOw0KICAgIH0NCiAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWVbJy5zdiddID09PSAnb2JqZWN0Jykgew0KICAgICAgICByZXR1cm4gcmVzb2x2ZUNvbXBsZXhEZWZlcnJlZFZhbHVlKHZhbHVlWycuc3YnXSwgZXhpc3RpbmdWYWwpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgYXNzZXJ0KGZhbHNlLCAnVW5leHBlY3RlZCBzZXJ2ZXIgdmFsdWU6ICcgKyBKU09OLnN0cmluZ2lmeSh2YWx1ZSwgbnVsbCwgMikpOw0KICAgIH0NCn07DQpjb25zdCByZXNvbHZlU2NhbGFyRGVmZXJyZWRWYWx1ZSA9IGZ1bmN0aW9uIChvcCwgZXhpc3RpbmcsIHNlcnZlclZhbHVlcykgew0KICAgIHN3aXRjaCAob3ApIHsNCiAgICAgICAgY2FzZSAndGltZXN0YW1wJzoNCiAgICAgICAgICAgIHJldHVybiBzZXJ2ZXJWYWx1ZXNbJ3RpbWVzdGFtcCddOw0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgYXNzZXJ0KGZhbHNlLCAnVW5leHBlY3RlZCBzZXJ2ZXIgdmFsdWU6ICcgKyBvcCk7DQogICAgfQ0KfTsNCmNvbnN0IHJlc29sdmVDb21wbGV4RGVmZXJyZWRWYWx1ZSA9IGZ1bmN0aW9uIChvcCwgZXhpc3RpbmcsIHVudXNlZCkgew0KICAgIGlmICghb3AuaGFzT3duUHJvcGVydHkoJ2luY3JlbWVudCcpKSB7DQogICAgICAgIGFzc2VydChmYWxzZSwgJ1VuZXhwZWN0ZWQgc2VydmVyIHZhbHVlOiAnICsgSlNPTi5zdHJpbmdpZnkob3AsIG51bGwsIDIpKTsNCiAgICB9DQogICAgY29uc3QgZGVsdGEgPSBvcFsnaW5jcmVtZW50J107DQogICAgaWYgKHR5cGVvZiBkZWx0YSAhPT0gJ251bWJlcicpIHsNCiAgICAgICAgYXNzZXJ0KGZhbHNlLCAnVW5leHBlY3RlZCBpbmNyZW1lbnQgdmFsdWU6ICcgKyBkZWx0YSk7DQogICAgfQ0KICAgIGNvbnN0IGV4aXN0aW5nTm9kZSA9IGV4aXN0aW5nLm5vZGUoKTsNCiAgICBhc3NlcnQoZXhpc3RpbmdOb2RlICE9PSBudWxsICYmIHR5cGVvZiBleGlzdGluZ05vZGUgIT09ICd1bmRlZmluZWQnLCAnRXhwZWN0ZWQgQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREUgZm9yIG51bGxzJyk7DQogICAgLy8gSW5jcmVtZW50aW5nIGEgbm9uLW51bWJlciBzZXRzIHRoZSB2YWx1ZSB0byB0aGUgaW5jcmVtZW50ZWQgYW1vdW50DQogICAgaWYgKCFleGlzdGluZ05vZGUuaXNMZWFmTm9kZSgpKSB7DQogICAgICAgIHJldHVybiBkZWx0YTsNCiAgICB9DQogICAgY29uc3QgbGVhZiA9IGV4aXN0aW5nTm9kZTsNCiAgICBjb25zdCBleGlzdGluZ1ZhbCA9IGxlYWYuZ2V0VmFsdWUoKTsNCiAgICBpZiAodHlwZW9mIGV4aXN0aW5nVmFsICE9PSAnbnVtYmVyJykgew0KICAgICAgICByZXR1cm4gZGVsdGE7DQogICAgfQ0KICAgIC8vIE5vIG5lZWQgdG8gZG8gb3Zlci91bmRlcmZsb3cgYXJpdGhtZXRpYyBoZXJlIGJlY2F1c2UgSlMgb25seSBoYW5kbGVzIGZsb2F0cyB1bmRlciB0aGUgY292ZXJzDQogICAgcmV0dXJuIGV4aXN0aW5nVmFsICsgZGVsdGE7DQp9Ow0KLyoqDQogKiBSZWN1cnNpdmVseSByZXBsYWNlIGFsbCBkZWZlcnJlZCB2YWx1ZXMgYW5kIHByaW9yaXRpZXMgaW4gdGhlIHRyZWUgd2l0aCB0aGUNCiAqIHNwZWNpZmllZCBnZW5lcmF0ZWQgcmVwbGFjZW1lbnQgdmFsdWVzLg0KICogQHBhcmFtIHBhdGggLSBwYXRoIHRvIHdoaWNoIHdyaXRlIGlzIHJlbGF0aXZlDQogKiBAcGFyYW0gbm9kZSAtIG5ldyBkYXRhIHdyaXR0ZW4gYXQgcGF0aA0KICogQHBhcmFtIHN5bmNUcmVlIC0gY3VycmVudCBkYXRhDQogKi8NCmNvbnN0IHJlc29sdmVEZWZlcnJlZFZhbHVlVHJlZSA9IGZ1bmN0aW9uIChwYXRoLCBub2RlLCBzeW5jVHJlZSwgc2VydmVyVmFsdWVzKSB7DQogICAgcmV0dXJuIHJlc29sdmVEZWZlcnJlZFZhbHVlKG5vZGUsIG5ldyBEZWZlcnJlZFZhbHVlUHJvdmlkZXIoc3luY1RyZWUsIHBhdGgpLCBzZXJ2ZXJWYWx1ZXMpOw0KfTsNCi8qKg0KICogUmVjdXJzaXZlbHkgcmVwbGFjZSBhbGwgZGVmZXJyZWQgdmFsdWVzIGFuZCBwcmlvcml0aWVzIGluIHRoZSBub2RlIHdpdGggdGhlDQogKiBzcGVjaWZpZWQgZ2VuZXJhdGVkIHJlcGxhY2VtZW50IHZhbHVlcy4gIElmIHRoZXJlIGFyZSBubyBzZXJ2ZXIgdmFsdWVzIGluIHRoZSBub2RlLA0KICogaXQnbGwgYmUgcmV0dXJuZWQgYXMtaXMuDQogKi8NCmNvbnN0IHJlc29sdmVEZWZlcnJlZFZhbHVlU25hcHNob3QgPSBmdW5jdGlvbiAobm9kZSwgZXhpc3RpbmcsIHNlcnZlclZhbHVlcykgew0KICAgIHJldHVybiByZXNvbHZlRGVmZXJyZWRWYWx1ZShub2RlLCBuZXcgRXhpc3RpbmdWYWx1ZVByb3ZpZGVyKGV4aXN0aW5nKSwgc2VydmVyVmFsdWVzKTsNCn07DQpmdW5jdGlvbiByZXNvbHZlRGVmZXJyZWRWYWx1ZShub2RlLCBleGlzdGluZ1ZhbCwgc2VydmVyVmFsdWVzKSB7DQogICAgY29uc3QgcmF3UHJpID0gbm9kZS5nZXRQcmlvcml0eSgpLnZhbCgpOw0KICAgIGNvbnN0IHByaW9yaXR5ID0gcmVzb2x2ZURlZmVycmVkTGVhZlZhbHVlKHJhd1ByaSwgZXhpc3RpbmdWYWwuZ2V0SW1tZWRpYXRlQ2hpbGQoJy5wcmlvcml0eScpLCBzZXJ2ZXJWYWx1ZXMpOw0KICAgIGxldCBuZXdOb2RlOw0KICAgIGlmIChub2RlLmlzTGVhZk5vZGUoKSkgew0KICAgICAgICBjb25zdCBsZWFmTm9kZSA9IG5vZGU7DQogICAgICAgIGNvbnN0IHZhbHVlID0gcmVzb2x2ZURlZmVycmVkTGVhZlZhbHVlKGxlYWZOb2RlLmdldFZhbHVlKCksIGV4aXN0aW5nVmFsLCBzZXJ2ZXJWYWx1ZXMpOw0KICAgICAgICBpZiAodmFsdWUgIT09IGxlYWZOb2RlLmdldFZhbHVlKCkgfHwNCiAgICAgICAgICAgIHByaW9yaXR5ICE9PSBsZWFmTm9kZS5nZXRQcmlvcml0eSgpLnZhbCgpKSB7DQogICAgICAgICAgICByZXR1cm4gbmV3IExlYWZOb2RlKHZhbHVlLCBub2RlRnJvbUpTT04ocHJpb3JpdHkpKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBub2RlOw0KICAgICAgICB9DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBjb25zdCBjaGlsZHJlbk5vZGUgPSBub2RlOw0KICAgICAgICBuZXdOb2RlID0gY2hpbGRyZW5Ob2RlOw0KICAgICAgICBpZiAocHJpb3JpdHkgIT09IGNoaWxkcmVuTm9kZS5nZXRQcmlvcml0eSgpLnZhbCgpKSB7DQogICAgICAgICAgICBuZXdOb2RlID0gbmV3Tm9kZS51cGRhdGVQcmlvcml0eShuZXcgTGVhZk5vZGUocHJpb3JpdHkpKTsNCiAgICAgICAgfQ0KICAgICAgICBjaGlsZHJlbk5vZGUuZm9yRWFjaENoaWxkKFBSSU9SSVRZX0lOREVYLCAoY2hpbGROYW1lLCBjaGlsZE5vZGUpID0+IHsNCiAgICAgICAgICAgIGNvbnN0IG5ld0NoaWxkTm9kZSA9IHJlc29sdmVEZWZlcnJlZFZhbHVlKGNoaWxkTm9kZSwgZXhpc3RpbmdWYWwuZ2V0SW1tZWRpYXRlQ2hpbGQoY2hpbGROYW1lKSwgc2VydmVyVmFsdWVzKTsNCiAgICAgICAgICAgIGlmIChuZXdDaGlsZE5vZGUgIT09IGNoaWxkTm9kZSkgew0KICAgICAgICAgICAgICAgIG5ld05vZGUgPSBuZXdOb2RlLnVwZGF0ZUltbWVkaWF0ZUNoaWxkKGNoaWxkTmFtZSwgbmV3Q2hpbGROb2RlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiBuZXdOb2RlOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogQSBsaWdodC13ZWlnaHQgdHJlZSwgdHJhdmVyc2FibGUgYnkgcGF0aC4gIE5vZGVzIGNhbiBoYXZlIGJvdGggdmFsdWVzIGFuZCBjaGlsZHJlbi4NCiAqIE5vZGVzIGFyZSBub3QgZW51bWVyYXRlZCAoYnkgZm9yRWFjaENoaWxkKSB1bmxlc3MgdGhleSBoYXZlIGEgdmFsdWUgb3Igbm9uLWVtcHR5DQogKiBjaGlsZHJlbi4NCiAqLw0KY2xhc3MgVHJlZSB7DQogICAgLyoqDQogICAgICogQHBhcmFtIG5hbWUgLSBPcHRpb25hbCBuYW1lIG9mIHRoZSBub2RlLg0KICAgICAqIEBwYXJhbSBwYXJlbnQgLSBPcHRpb25hbCBwYXJlbnQgbm9kZS4NCiAgICAgKiBAcGFyYW0gbm9kZSAtIE9wdGlvbmFsIG5vZGUgdG8gd3JhcC4NCiAgICAgKi8NCiAgICBjb25zdHJ1Y3RvcihuYW1lID0gJycsIHBhcmVudCA9IG51bGwsIG5vZGUgPSB7IGNoaWxkcmVuOiB7fSwgY2hpbGRDb3VudDogMCB9KSB7DQogICAgICAgIHRoaXMubmFtZSA9IG5hbWU7DQogICAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50Ow0KICAgICAgICB0aGlzLm5vZGUgPSBub2RlOw0KICAgIH0NCn0NCi8qKg0KICogUmV0dXJucyBhIHN1Yi1UcmVlIGZvciB0aGUgZ2l2ZW4gcGF0aC4NCiAqDQogKiBAcGFyYW0gcGF0aE9iaiAtIFBhdGggdG8gbG9vayB1cC4NCiAqIEByZXR1cm5zIFRyZWUgZm9yIHBhdGguDQogKi8NCmZ1bmN0aW9uIHRyZWVTdWJUcmVlKHRyZWUsIHBhdGhPYmopIHsNCiAgICAvLyBUT0RPOiBSZXF1aXJlIHBhdGhPYmogdG8gYmUgUGF0aD8NCiAgICBsZXQgcGF0aCA9IHBhdGhPYmogaW5zdGFuY2VvZiBQYXRoID8gcGF0aE9iaiA6IG5ldyBQYXRoKHBhdGhPYmopOw0KICAgIGxldCBjaGlsZCA9IHRyZWUsIG5leHQgPSBwYXRoR2V0RnJvbnQocGF0aCk7DQogICAgd2hpbGUgKG5leHQgIT09IG51bGwpIHsNCiAgICAgICAgY29uc3QgY2hpbGROb2RlID0gc2FmZUdldChjaGlsZC5ub2RlLmNoaWxkcmVuLCBuZXh0KSB8fCB7DQogICAgICAgICAgICBjaGlsZHJlbjoge30sDQogICAgICAgICAgICBjaGlsZENvdW50OiAwDQogICAgICAgIH07DQogICAgICAgIGNoaWxkID0gbmV3IFRyZWUobmV4dCwgY2hpbGQsIGNoaWxkTm9kZSk7DQogICAgICAgIHBhdGggPSBwYXRoUG9wRnJvbnQocGF0aCk7DQogICAgICAgIG5leHQgPSBwYXRoR2V0RnJvbnQocGF0aCk7DQogICAgfQ0KICAgIHJldHVybiBjaGlsZDsNCn0NCi8qKg0KICogUmV0dXJucyB0aGUgZGF0YSBhc3NvY2lhdGVkIHdpdGggdGhpcyB0cmVlIG5vZGUuDQogKg0KICogQHJldHVybnMgVGhlIGRhdGEgb3IgbnVsbCBpZiBubyBkYXRhIGV4aXN0cy4NCiAqLw0KZnVuY3Rpb24gdHJlZUdldFZhbHVlKHRyZWUpIHsNCiAgICByZXR1cm4gdHJlZS5ub2RlLnZhbHVlOw0KfQ0KLyoqDQogKiBTZXRzIGRhdGEgdG8gdGhpcyB0cmVlIG5vZGUuDQogKg0KICogQHBhcmFtIHZhbHVlIC0gVmFsdWUgdG8gc2V0Lg0KICovDQpmdW5jdGlvbiB0cmVlU2V0VmFsdWUodHJlZSwgdmFsdWUpIHsNCiAgICB0cmVlLm5vZGUudmFsdWUgPSB2YWx1ZTsNCiAgICB0cmVlVXBkYXRlUGFyZW50cyh0cmVlKTsNCn0NCi8qKg0KICogQHJldHVybnMgV2hldGhlciB0aGUgdHJlZSBoYXMgYW55IGNoaWxkcmVuLg0KICovDQpmdW5jdGlvbiB0cmVlSGFzQ2hpbGRyZW4odHJlZSkgew0KICAgIHJldHVybiB0cmVlLm5vZGUuY2hpbGRDb3VudCA+IDA7DQp9DQovKioNCiAqIEByZXR1cm5zIFdoZXRoZSBydGhlIHRyZWUgaXMgZW1wdHkgKG5vIHZhbHVlIG9yIGNoaWxkcmVuKS4NCiAqLw0KZnVuY3Rpb24gdHJlZUlzRW1wdHkodHJlZSkgew0KICAgIHJldHVybiB0cmVlR2V0VmFsdWUodHJlZSkgPT09IHVuZGVmaW5lZCAmJiAhdHJlZUhhc0NoaWxkcmVuKHRyZWUpOw0KfQ0KLyoqDQogKiBDYWxscyBhY3Rpb24gZm9yIGVhY2ggY2hpbGQgb2YgdGhpcyB0cmVlIG5vZGUuDQogKg0KICogQHBhcmFtIGFjdGlvbiAtIEFjdGlvbiB0byBiZSBjYWxsZWQgZm9yIGVhY2ggY2hpbGQuDQogKi8NCmZ1bmN0aW9uIHRyZWVGb3JFYWNoQ2hpbGQodHJlZSwgYWN0aW9uKSB7DQogICAgZWFjaCh0cmVlLm5vZGUuY2hpbGRyZW4sIChjaGlsZCwgY2hpbGRUcmVlKSA9PiB7DQogICAgICAgIGFjdGlvbihuZXcgVHJlZShjaGlsZCwgdHJlZSwgY2hpbGRUcmVlKSk7DQogICAgfSk7DQp9DQovKioNCiAqIERvZXMgYSBkZXB0aC1maXJzdCB0cmF2ZXJzYWwgb2YgdGhpcyBub2RlJ3MgZGVzY2VuZGFudHMsIGNhbGxpbmcgYWN0aW9uIGZvciBlYWNoIG9uZS4NCiAqDQogKiBAcGFyYW0gYWN0aW9uIC0gQWN0aW9uIHRvIGJlIGNhbGxlZCBmb3IgZWFjaCBjaGlsZC4NCiAqIEBwYXJhbSBpbmNsdWRlU2VsZiAtIFdoZXRoZXIgdG8gY2FsbCBhY3Rpb24gb24gdGhpcyBub2RlIGFzIHdlbGwuIERlZmF1bHRzIHRvDQogKiAgIGZhbHNlLg0KICogQHBhcmFtIGNoaWxkcmVuRmlyc3QgLSBXaGV0aGVyIHRvIGNhbGwgYWN0aW9uIG9uIGNoaWxkcmVuIGJlZm9yZSBjYWxsaW5nIGl0IG9uDQogKiAgIHBhcmVudC4NCiAqLw0KZnVuY3Rpb24gdHJlZUZvckVhY2hEZXNjZW5kYW50KHRyZWUsIGFjdGlvbiwgaW5jbHVkZVNlbGYsIGNoaWxkcmVuRmlyc3QpIHsNCiAgICBpZiAoaW5jbHVkZVNlbGYgJiYgIWNoaWxkcmVuRmlyc3QpIHsNCiAgICAgICAgYWN0aW9uKHRyZWUpOw0KICAgIH0NCiAgICB0cmVlRm9yRWFjaENoaWxkKHRyZWUsIGNoaWxkID0+IHsNCiAgICAgICAgdHJlZUZvckVhY2hEZXNjZW5kYW50KGNoaWxkLCBhY3Rpb24sIHRydWUsIGNoaWxkcmVuRmlyc3QpOw0KICAgIH0pOw0KICAgIGlmIChpbmNsdWRlU2VsZiAmJiBjaGlsZHJlbkZpcnN0KSB7DQogICAgICAgIGFjdGlvbih0cmVlKTsNCiAgICB9DQp9DQovKioNCiAqIENhbGxzIGFjdGlvbiBvbiBlYWNoIGFuY2VzdG9yIG5vZGUuDQogKg0KICogQHBhcmFtIGFjdGlvbiAtIEFjdGlvbiB0byBiZSBjYWxsZWQgb24gZWFjaCBwYXJlbnQ7IHJldHVybg0KICogICB0cnVlIHRvIGFib3J0Lg0KICogQHBhcmFtIGluY2x1ZGVTZWxmIC0gV2hldGhlciB0byBjYWxsIGFjdGlvbiBvbiB0aGlzIG5vZGUgYXMgd2VsbC4NCiAqIEByZXR1cm5zIHRydWUgaWYgdGhlIGFjdGlvbiBjYWxsYmFjayByZXR1cm5lZCB0cnVlLg0KICovDQpmdW5jdGlvbiB0cmVlRm9yRWFjaEFuY2VzdG9yKHRyZWUsIGFjdGlvbiwgaW5jbHVkZVNlbGYpIHsNCiAgICBsZXQgbm9kZSA9IGluY2x1ZGVTZWxmID8gdHJlZSA6IHRyZWUucGFyZW50Ow0KICAgIHdoaWxlIChub2RlICE9PSBudWxsKSB7DQogICAgICAgIGlmIChhY3Rpb24obm9kZSkpIHsNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQogICAgICAgIG5vZGUgPSBub2RlLnBhcmVudDsNCiAgICB9DQogICAgcmV0dXJuIGZhbHNlOw0KfQ0KLyoqDQogKiBAcmV0dXJucyBUaGUgcGF0aCBvZiB0aGlzIHRyZWUgbm9kZSwgYXMgYSBQYXRoLg0KICovDQpmdW5jdGlvbiB0cmVlR2V0UGF0aCh0cmVlKSB7DQogICAgcmV0dXJuIG5ldyBQYXRoKHRyZWUucGFyZW50ID09PSBudWxsDQogICAgICAgID8gdHJlZS5uYW1lDQogICAgICAgIDogdHJlZUdldFBhdGgodHJlZS5wYXJlbnQpICsgJy8nICsgdHJlZS5uYW1lKTsNCn0NCi8qKg0KICogQWRkcyBvciByZW1vdmVzIHRoaXMgY2hpbGQgZnJvbSBpdHMgcGFyZW50IGJhc2VkIG9uIHdoZXRoZXIgaXQncyBlbXB0eSBvciBub3QuDQogKi8NCmZ1bmN0aW9uIHRyZWVVcGRhdGVQYXJlbnRzKHRyZWUpIHsNCiAgICBpZiAodHJlZS5wYXJlbnQgIT09IG51bGwpIHsNCiAgICAgICAgdHJlZVVwZGF0ZUNoaWxkKHRyZWUucGFyZW50LCB0cmVlLm5hbWUsIHRyZWUpOw0KICAgIH0NCn0NCi8qKg0KICogQWRkcyBvciByZW1vdmVzIHRoZSBwYXNzZWQgY2hpbGQgdG8gdGhpcyB0cmVlIG5vZGUsIGRlcGVuZGluZyBvbiB3aGV0aGVyIGl0J3MgZW1wdHkuDQogKg0KICogQHBhcmFtIGNoaWxkTmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBjaGlsZCB0byB1cGRhdGUuDQogKiBAcGFyYW0gY2hpbGQgLSBUaGUgY2hpbGQgdG8gdXBkYXRlLg0KICovDQpmdW5jdGlvbiB0cmVlVXBkYXRlQ2hpbGQodHJlZSwgY2hpbGROYW1lLCBjaGlsZCkgew0KICAgIGNvbnN0IGNoaWxkRW1wdHkgPSB0cmVlSXNFbXB0eShjaGlsZCk7DQogICAgY29uc3QgY2hpbGRFeGlzdHMgPSBjb250YWlucyh0cmVlLm5vZGUuY2hpbGRyZW4sIGNoaWxkTmFtZSk7DQogICAgaWYgKGNoaWxkRW1wdHkgJiYgY2hpbGRFeGlzdHMpIHsNCiAgICAgICAgZGVsZXRlIHRyZWUubm9kZS5jaGlsZHJlbltjaGlsZE5hbWVdOw0KICAgICAgICB0cmVlLm5vZGUuY2hpbGRDb3VudC0tOw0KICAgICAgICB0cmVlVXBkYXRlUGFyZW50cyh0cmVlKTsNCiAgICB9DQogICAgZWxzZSBpZiAoIWNoaWxkRW1wdHkgJiYgIWNoaWxkRXhpc3RzKSB7DQogICAgICAgIHRyZWUubm9kZS5jaGlsZHJlbltjaGlsZE5hbWVdID0gY2hpbGQubm9kZTsNCiAgICAgICAgdHJlZS5ub2RlLmNoaWxkQ291bnQrKzsNCiAgICAgICAgdHJlZVVwZGF0ZVBhcmVudHModHJlZSk7DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBUcnVlIGZvciBpbnZhbGlkIEZpcmViYXNlIGtleXMNCiAqLw0KY29uc3QgSU5WQUxJRF9LRVlfUkVHRVhfID0gL1tcW1xdLiMkXC9cdTAwMDAtXHUwMDFGXHUwMDdGXS87DQovKioNCiAqIFRydWUgZm9yIGludmFsaWQgRmlyZWJhc2UgcGF0aHMuDQogKiBBbGxvd3MgJy8nIGluIHBhdGhzLg0KICovDQpjb25zdCBJTlZBTElEX1BBVEhfUkVHRVhfID0gL1tcW1xdLiMkXHUwMDAwLVx1MDAxRlx1MDA3Rl0vOw0KLyoqDQogKiBNYXhpbXVtIG51bWJlciBvZiBjaGFyYWN0ZXJzIHRvIGFsbG93IGluIGxlYWYgdmFsdWUNCiAqLw0KY29uc3QgTUFYX0xFQUZfU0laRV8gPSAxMCAqIDEwMjQgKiAxMDI0Ow0KY29uc3QgaXNWYWxpZEtleSA9IGZ1bmN0aW9uIChrZXkpIHsNCiAgICByZXR1cm4gKHR5cGVvZiBrZXkgPT09ICdzdHJpbmcnICYmIGtleS5sZW5ndGggIT09IDAgJiYgIUlOVkFMSURfS0VZX1JFR0VYXy50ZXN0KGtleSkpOw0KfTsNCmNvbnN0IGlzVmFsaWRQYXRoU3RyaW5nID0gZnVuY3Rpb24gKHBhdGhTdHJpbmcpIHsNCiAgICByZXR1cm4gKHR5cGVvZiBwYXRoU3RyaW5nID09PSAnc3RyaW5nJyAmJg0KICAgICAgICBwYXRoU3RyaW5nLmxlbmd0aCAhPT0gMCAmJg0KICAgICAgICAhSU5WQUxJRF9QQVRIX1JFR0VYXy50ZXN0KHBhdGhTdHJpbmcpKTsNCn07DQpjb25zdCBpc1ZhbGlkUm9vdFBhdGhTdHJpbmcgPSBmdW5jdGlvbiAocGF0aFN0cmluZykgew0KICAgIGlmIChwYXRoU3RyaW5nKSB7DQogICAgICAgIC8vIEFsbG93ICcvLmluZm8vJyBhdCB0aGUgYmVnaW5uaW5nLg0KICAgICAgICBwYXRoU3RyaW5nID0gcGF0aFN0cmluZy5yZXBsYWNlKC9eXC8qXC5pbmZvKFwvfCQpLywgJy8nKTsNCiAgICB9DQogICAgcmV0dXJuIGlzVmFsaWRQYXRoU3RyaW5nKHBhdGhTdHJpbmcpOw0KfTsNCi8qKg0KICogUHJlLXZhbGlkYXRlIGEgZGF0dW0gcGFzc2VkIGFzIGFuIGFyZ3VtZW50IHRvIEZpcmViYXNlIGZ1bmN0aW9uLg0KICovDQpjb25zdCB2YWxpZGF0ZUZpcmViYXNlRGF0YUFyZyA9IGZ1bmN0aW9uIChmbk5hbWUsIHZhbHVlLCBwYXRoLCBvcHRpb25hbCkgew0KICAgIGlmIChvcHRpb25hbCAmJiB2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgdmFsaWRhdGVGaXJlYmFzZURhdGEoZXJyb3JQcmVmaXgoZm5OYW1lLCAndmFsdWUnKSwgdmFsdWUsIHBhdGgpOw0KfTsNCi8qKg0KICogVmFsaWRhdGUgYSBkYXRhIG9iamVjdCBjbGllbnQtc2lkZSBiZWZvcmUgc2VuZGluZyB0byBzZXJ2ZXIuDQogKi8NCmNvbnN0IHZhbGlkYXRlRmlyZWJhc2VEYXRhID0gZnVuY3Rpb24gKGVycm9yUHJlZml4LCBkYXRhLCBwYXRoXykgew0KICAgIGNvbnN0IHBhdGggPSBwYXRoXyBpbnN0YW5jZW9mIFBhdGggPyBuZXcgVmFsaWRhdGlvblBhdGgocGF0aF8sIGVycm9yUHJlZml4KSA6IHBhdGhfOw0KICAgIGlmIChkYXRhID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yUHJlZml4ICsgJ2NvbnRhaW5zIHVuZGVmaW5lZCAnICsgdmFsaWRhdGlvblBhdGhUb0Vycm9yU3RyaW5nKHBhdGgpKTsNCiAgICB9DQogICAgaWYgKHR5cGVvZiBkYXRhID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvclByZWZpeCArDQogICAgICAgICAgICAnY29udGFpbnMgYSBmdW5jdGlvbiAnICsNCiAgICAgICAgICAgIHZhbGlkYXRpb25QYXRoVG9FcnJvclN0cmluZyhwYXRoKSArDQogICAgICAgICAgICAnIHdpdGggY29udGVudHMgPSAnICsNCiAgICAgICAgICAgIGRhdGEudG9TdHJpbmcoKSk7DQogICAgfQ0KICAgIGlmIChpc0ludmFsaWRKU09OTnVtYmVyKGRhdGEpKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvclByZWZpeCArDQogICAgICAgICAgICAnY29udGFpbnMgJyArDQogICAgICAgICAgICBkYXRhLnRvU3RyaW5nKCkgKw0KICAgICAgICAgICAgJyAnICsNCiAgICAgICAgICAgIHZhbGlkYXRpb25QYXRoVG9FcnJvclN0cmluZyhwYXRoKSk7DQogICAgfQ0KICAgIC8vIENoZWNrIG1heCBsZWFmIHNpemUsIGJ1dCB0cnkgdG8gYXZvaWQgdGhlIHV0ZjggY29udmVyc2lvbiBpZiB3ZSBjYW4uDQogICAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJyAmJg0KICAgICAgICBkYXRhLmxlbmd0aCA+IE1BWF9MRUFGX1NJWkVfIC8gMyAmJg0KICAgICAgICBzdHJpbmdMZW5ndGgoZGF0YSkgPiBNQVhfTEVBRl9TSVpFXykgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JQcmVmaXggKw0KICAgICAgICAgICAgJ2NvbnRhaW5zIGEgc3RyaW5nIGdyZWF0ZXIgdGhhbiAnICsNCiAgICAgICAgICAgIE1BWF9MRUFGX1NJWkVfICsNCiAgICAgICAgICAgICcgdXRmOCBieXRlcyAnICsNCiAgICAgICAgICAgIHZhbGlkYXRpb25QYXRoVG9FcnJvclN0cmluZyhwYXRoKSArDQogICAgICAgICAgICAiICgnIiArDQogICAgICAgICAgICBkYXRhLnN1YnN0cmluZygwLCA1MCkgKw0KICAgICAgICAgICAgIi4uLicpIik7DQogICAgfQ0KICAgIC8vIFRPRE8gPSBQZXJmID0gQ29uc2lkZXIgY29tYmluaW5nIHRoZSByZWN1cnNpdmUgdmFsaWRhdGlvbiBvZiBrZXlzIGludG8gTm9kZUZyb21KU09ODQogICAgLy8gdG8gc2F2ZSBleHRyYSB3YWxraW5nIG9mIGxhcmdlIG9iamVjdHMuDQogICAgaWYgKGRhdGEgJiYgdHlwZW9mIGRhdGEgPT09ICdvYmplY3QnKSB7DQogICAgICAgIGxldCBoYXNEb3RWYWx1ZSA9IGZhbHNlOw0KICAgICAgICBsZXQgaGFzQWN0dWFsQ2hpbGQgPSBmYWxzZTsNCiAgICAgICAgZWFjaChkYXRhLCAoa2V5LCB2YWx1ZSkgPT4gew0KICAgICAgICAgICAgaWYgKGtleSA9PT0gJy52YWx1ZScpIHsNCiAgICAgICAgICAgICAgICBoYXNEb3RWYWx1ZSA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChrZXkgIT09ICcucHJpb3JpdHknICYmIGtleSAhPT0gJy5zdicpIHsNCiAgICAgICAgICAgICAgICBoYXNBY3R1YWxDaGlsZCA9IHRydWU7DQogICAgICAgICAgICAgICAgaWYgKCFpc1ZhbGlkS2V5KGtleSkpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yUHJlZml4ICsNCiAgICAgICAgICAgICAgICAgICAgICAgICcgY29udGFpbnMgYW4gaW52YWxpZCBrZXkgKCcgKw0KICAgICAgICAgICAgICAgICAgICAgICAga2V5ICsNCiAgICAgICAgICAgICAgICAgICAgICAgICcpICcgKw0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGlvblBhdGhUb0Vycm9yU3RyaW5nKHBhdGgpICsNCiAgICAgICAgICAgICAgICAgICAgICAgICcuICBLZXlzIG11c3QgYmUgbm9uLWVtcHR5IHN0cmluZ3MgJyArDQogICAgICAgICAgICAgICAgICAgICAgICAnYW5kIGNhblwndCBjb250YWluICIuIiwgIiMiLCAiJCIsICIvIiwgIlsiLCBvciAiXSInKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICB2YWxpZGF0aW9uUGF0aFB1c2gocGF0aCwga2V5KTsNCiAgICAgICAgICAgIHZhbGlkYXRlRmlyZWJhc2VEYXRhKGVycm9yUHJlZml4LCB2YWx1ZSwgcGF0aCk7DQogICAgICAgICAgICB2YWxpZGF0aW9uUGF0aFBvcChwYXRoKTsNCiAgICAgICAgfSk7DQogICAgICAgIGlmIChoYXNEb3RWYWx1ZSAmJiBoYXNBY3R1YWxDaGlsZCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yUHJlZml4ICsNCiAgICAgICAgICAgICAgICAnIGNvbnRhaW5zICIudmFsdWUiIGNoaWxkICcgKw0KICAgICAgICAgICAgICAgIHZhbGlkYXRpb25QYXRoVG9FcnJvclN0cmluZyhwYXRoKSArDQogICAgICAgICAgICAgICAgJyBpbiBhZGRpdGlvbiB0byBhY3R1YWwgY2hpbGRyZW4uJyk7DQogICAgICAgIH0NCiAgICB9DQp9Ow0KLyoqDQogKiBAaW50ZXJuYWwNCiAqLw0KY29uc3QgdmFsaWRhdGVQYXRoU3RyaW5nID0gZnVuY3Rpb24gKGZuTmFtZSwgYXJndW1lbnROYW1lLCBwYXRoU3RyaW5nLCBvcHRpb25hbCkgew0KICAgIGlmIChvcHRpb25hbCAmJiBwYXRoU3RyaW5nID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCiAgICBpZiAoIWlzVmFsaWRQYXRoU3RyaW5nKHBhdGhTdHJpbmcpKSB7DQogICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvclByZWZpeChmbk5hbWUsIGFyZ3VtZW50TmFtZSkgKw0KICAgICAgICAgICAgJ3dhcyBhbiBpbnZhbGlkIHBhdGggPSAiJyArDQogICAgICAgICAgICBwYXRoU3RyaW5nICsNCiAgICAgICAgICAgICciLiBQYXRocyBtdXN0IGJlIG5vbi1lbXB0eSBzdHJpbmdzIGFuZCAnICsNCiAgICAgICAgICAgICdjYW5cJ3QgY29udGFpbiAiLiIsICIjIiwgIiQiLCAiWyIsIG9yICJdIicpOw0KICAgIH0NCn07DQpjb25zdCB2YWxpZGF0ZVJvb3RQYXRoU3RyaW5nID0gZnVuY3Rpb24gKGZuTmFtZSwgYXJndW1lbnROYW1lLCBwYXRoU3RyaW5nLCBvcHRpb25hbCkgew0KICAgIGlmIChwYXRoU3RyaW5nKSB7DQogICAgICAgIC8vIEFsbG93ICcvLmluZm8vJyBhdCB0aGUgYmVnaW5uaW5nLg0KICAgICAgICBwYXRoU3RyaW5nID0gcGF0aFN0cmluZy5yZXBsYWNlKC9eXC8qXC5pbmZvKFwvfCQpLywgJy8nKTsNCiAgICB9DQogICAgdmFsaWRhdGVQYXRoU3RyaW5nKGZuTmFtZSwgYXJndW1lbnROYW1lLCBwYXRoU3RyaW5nLCBvcHRpb25hbCk7DQp9Ow0KLyoqDQogKiBAaW50ZXJuYWwNCiAqLw0KY29uc3QgdmFsaWRhdGVXcml0YWJsZVBhdGggPSBmdW5jdGlvbiAoZm5OYW1lLCBwYXRoKSB7DQogICAgaWYgKHBhdGhHZXRGcm9udChwYXRoKSA9PT0gJy5pbmZvJykgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZm5OYW1lICsgIiBmYWlsZWQgPSBDYW4ndCBtb2RpZnkgZGF0YSB1bmRlciAvLmluZm8vIik7DQogICAgfQ0KfTsNCmNvbnN0IHZhbGlkYXRlVXJsID0gZnVuY3Rpb24gKGZuTmFtZSwgcGFyc2VkVXJsKSB7DQogICAgLy8gVE9ETyA9IFZhbGlkYXRlIHNlcnZlciBiZXR0ZXIuDQogICAgY29uc3QgcGF0aFN0cmluZyA9IHBhcnNlZFVybC5wYXRoLnRvU3RyaW5nKCk7DQogICAgaWYgKCEodHlwZW9mIHBhcnNlZFVybC5yZXBvSW5mby5ob3N0ID09PSAnc3RyaW5nJykgfHwNCiAgICAgICAgcGFyc2VkVXJsLnJlcG9JbmZvLmhvc3QubGVuZ3RoID09PSAwIHx8DQogICAgICAgICghaXNWYWxpZEtleShwYXJzZWRVcmwucmVwb0luZm8ubmFtZXNwYWNlKSAmJg0KICAgICAgICAgICAgcGFyc2VkVXJsLnJlcG9JbmZvLmhvc3Quc3BsaXQoJzonKVswXSAhPT0gJ2xvY2FsaG9zdCcpIHx8DQogICAgICAgIChwYXRoU3RyaW5nLmxlbmd0aCAhPT0gMCAmJiAhaXNWYWxpZFJvb3RQYXRoU3RyaW5nKHBhdGhTdHJpbmcpKSkgew0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JQcmVmaXgoZm5OYW1lLCAndXJsJykgKw0KICAgICAgICAgICAgJ211c3QgYmUgYSB2YWxpZCBmaXJlYmFzZSBVUkwgYW5kICcgKw0KICAgICAgICAgICAgJ3RoZSBwYXRoIGNhblwndCBjb250YWluICIuIiwgIiMiLCAiJCIsICJbIiwgb3IgIl0iLicpOw0KICAgIH0NCn07CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIFRoZSBldmVudCBxdWV1ZSBzZXJ2ZXMgYSBmZXcgcHVycG9zZXM6DQogKiAxLiBJdCBlbnN1cmVzIHdlIG1haW50YWluIGV2ZW50IG9yZGVyIGluIHRoZSBmYWNlIG9mIGV2ZW50IGNhbGxiYWNrcyBkb2luZyBvcGVyYXRpb25zIHRoYXQgcmVzdWx0IGluIG1vcmUNCiAqICAgIGV2ZW50cyBiZWluZyBxdWV1ZWQuDQogKiAyLiByYWlzZVF1ZXVlZEV2ZW50cygpIGhhbmRsZXMgYmVpbmcgY2FsbGVkIHJlZW50cmFudGx5IG5pY2VseS4gIFRoYXQgaXMsIGlmIGluIHRoZSBjb3Vyc2Ugb2YgcmFpc2luZyBldmVudHMsDQogKiAgICByYWlzZVF1ZXVlZEV2ZW50cygpIGlzIGNhbGxlZCBhZ2FpbiwgdGhlICJpbm5lciIgY2FsbCB3aWxsIHBpY2sgdXAgcmFpc2luZyBldmVudHMgd2hlcmUgdGhlICJvdXRlciIgY2FsbA0KICogICAgbGVmdCBvZmYsIGVuc3VyaW5nIHRoYXQgdGhlIGV2ZW50cyBhcmUgc3RpbGwgcmFpc2VkIHN5bmNocm9ub3VzbHkgYW5kIGluIG9yZGVyLg0KICogMy4gWW91IGNhbiB1c2UgcmFpc2VFdmVudHNBdFBhdGggYW5kIHJhaXNlRXZlbnRzRm9yQ2hhbmdlZFBhdGggdG8gZW5zdXJlIG9ubHkgcmVsZXZhbnQgcHJldmlvdXNseS1xdWV1ZWQNCiAqICAgIGV2ZW50cyBhcmUgcmFpc2VkIHN5bmNocm9ub3VzbHkuDQogKg0KICogTk9URTogVGhpcyBjYW4gYWxsIGdvIGF3YXkgaWYvd2hlbiB3ZSBtb3ZlIHRvIGFzeW5jIGV2ZW50cy4NCiAqDQogKi8NCmNsYXNzIEV2ZW50UXVldWUgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICB0aGlzLmV2ZW50TGlzdHNfID0gW107DQogICAgICAgIC8qKg0KICAgICAgICAgKiBUcmFja3MgcmVjdXJzaW9uIGRlcHRoIG9mIHJhaXNlUXVldWVkRXZlbnRzXywgZm9yIGRlYnVnZ2luZyBwdXJwb3Nlcy4NCiAgICAgICAgICovDQogICAgICAgIHRoaXMucmVjdXJzaW9uRGVwdGhfID0gMDsNCiAgICB9DQp9DQovKioNCiAqIEBwYXJhbSBldmVudERhdGFMaXN0IC0gVGhlIG5ldyBldmVudHMgdG8gcXVldWUuDQogKi8NCmZ1bmN0aW9uIGV2ZW50UXVldWVRdWV1ZUV2ZW50cyhldmVudFF1ZXVlLCBldmVudERhdGFMaXN0KSB7DQogICAgLy8gV2UgZ3JvdXAgZXZlbnRzIGJ5IHBhdGgsIHN0b3JpbmcgdGhlbSBpbiBhIHNpbmdsZSBFdmVudExpc3QsIHRvIG1ha2UgaXQgZWFzaWVyIHRvIHNraXAgb3ZlciB0aGVtIHF1aWNrbHkuDQogICAgbGV0IGN1cnJMaXN0ID0gbnVsbDsNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGV2ZW50RGF0YUxpc3QubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgY29uc3QgZGF0YSA9IGV2ZW50RGF0YUxpc3RbaV07DQogICAgICAgIGNvbnN0IHBhdGggPSBkYXRhLmdldFBhdGgoKTsNCiAgICAgICAgaWYgKGN1cnJMaXN0ICE9PSBudWxsICYmICFwYXRoRXF1YWxzKHBhdGgsIGN1cnJMaXN0LnBhdGgpKSB7DQogICAgICAgICAgICBldmVudFF1ZXVlLmV2ZW50TGlzdHNfLnB1c2goY3Vyckxpc3QpOw0KICAgICAgICAgICAgY3Vyckxpc3QgPSBudWxsOw0KICAgICAgICB9DQogICAgICAgIGlmIChjdXJyTGlzdCA9PT0gbnVsbCkgew0KICAgICAgICAgICAgY3Vyckxpc3QgPSB7IGV2ZW50czogW10sIHBhdGggfTsNCiAgICAgICAgfQ0KICAgICAgICBjdXJyTGlzdC5ldmVudHMucHVzaChkYXRhKTsNCiAgICB9DQogICAgaWYgKGN1cnJMaXN0KSB7DQogICAgICAgIGV2ZW50UXVldWUuZXZlbnRMaXN0c18ucHVzaChjdXJyTGlzdCk7DQogICAgfQ0KfQ0KLyoqDQogKiBRdWV1ZXMgdGhlIHNwZWNpZmllZCBldmVudHMgYW5kIHN5bmNocm9ub3VzbHkgcmFpc2VzIGFsbCBldmVudHMgKGluY2x1ZGluZyBwcmV2aW91c2x5IHF1ZXVlZCBvbmVzKQ0KICogZm9yIHRoZSBzcGVjaWZpZWQgcGF0aC4NCiAqDQogKiBJdCBpcyBhc3N1bWVkIHRoYXQgdGhlIG5ldyBldmVudHMgYXJlIGFsbCBmb3IgdGhlIHNwZWNpZmllZCBwYXRoLg0KICoNCiAqIEBwYXJhbSBwYXRoIC0gVGhlIHBhdGggdG8gcmFpc2UgZXZlbnRzIGZvci4NCiAqIEBwYXJhbSBldmVudERhdGFMaXN0IC0gVGhlIG5ldyBldmVudHMgdG8gcmFpc2UuDQogKi8NCmZ1bmN0aW9uIGV2ZW50UXVldWVSYWlzZUV2ZW50c0F0UGF0aChldmVudFF1ZXVlLCBwYXRoLCBldmVudERhdGFMaXN0KSB7DQogICAgZXZlbnRRdWV1ZVF1ZXVlRXZlbnRzKGV2ZW50UXVldWUsIGV2ZW50RGF0YUxpc3QpOw0KICAgIGV2ZW50UXVldWVSYWlzZVF1ZXVlZEV2ZW50c01hdGNoaW5nUHJlZGljYXRlKGV2ZW50UXVldWUsIGV2ZW50UGF0aCA9PiBwYXRoRXF1YWxzKGV2ZW50UGF0aCwgcGF0aCkpOw0KfQ0KLyoqDQogKiBRdWV1ZXMgdGhlIHNwZWNpZmllZCBldmVudHMgYW5kIHN5bmNocm9ub3VzbHkgcmFpc2VzIGFsbCBldmVudHMgKGluY2x1ZGluZyBwcmV2aW91c2x5IHF1ZXVlZCBvbmVzKSBmb3INCiAqIGxvY2F0aW9ucyByZWxhdGVkIHRvIHRoZSBzcGVjaWZpZWQgY2hhbmdlIHBhdGggKGkuZS4gYWxsIGFuY2VzdG9ycyBhbmQgZGVzY2VuZGFudHMpLg0KICoNCiAqIEl0IGlzIGFzc3VtZWQgdGhhdCB0aGUgbmV3IGV2ZW50cyBhcmUgYWxsIHJlbGF0ZWQgKGFuY2VzdG9yIG9yIGRlc2NlbmRhbnQpIHRvIHRoZSBzcGVjaWZpZWQgcGF0aC4NCiAqDQogKiBAcGFyYW0gY2hhbmdlZFBhdGggLSBUaGUgcGF0aCB0byByYWlzZSBldmVudHMgZm9yLg0KICogQHBhcmFtIGV2ZW50RGF0YUxpc3QgLSBUaGUgZXZlbnRzIHRvIHJhaXNlDQogKi8NCmZ1bmN0aW9uIGV2ZW50UXVldWVSYWlzZUV2ZW50c0ZvckNoYW5nZWRQYXRoKGV2ZW50UXVldWUsIGNoYW5nZWRQYXRoLCBldmVudERhdGFMaXN0KSB7DQogICAgZXZlbnRRdWV1ZVF1ZXVlRXZlbnRzKGV2ZW50UXVldWUsIGV2ZW50RGF0YUxpc3QpOw0KICAgIGV2ZW50UXVldWVSYWlzZVF1ZXVlZEV2ZW50c01hdGNoaW5nUHJlZGljYXRlKGV2ZW50UXVldWUsIGV2ZW50UGF0aCA9PiBwYXRoQ29udGFpbnMoZXZlbnRQYXRoLCBjaGFuZ2VkUGF0aCkgfHwNCiAgICAgICAgcGF0aENvbnRhaW5zKGNoYW5nZWRQYXRoLCBldmVudFBhdGgpKTsNCn0NCmZ1bmN0aW9uIGV2ZW50UXVldWVSYWlzZVF1ZXVlZEV2ZW50c01hdGNoaW5nUHJlZGljYXRlKGV2ZW50UXVldWUsIHByZWRpY2F0ZSkgew0KICAgIGV2ZW50UXVldWUucmVjdXJzaW9uRGVwdGhfKys7DQogICAgbGV0IHNlbnRBbGwgPSB0cnVlOw0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZXZlbnRRdWV1ZS5ldmVudExpc3RzXy5sZW5ndGg7IGkrKykgew0KICAgICAgICBjb25zdCBldmVudExpc3QgPSBldmVudFF1ZXVlLmV2ZW50TGlzdHNfW2ldOw0KICAgICAgICBpZiAoZXZlbnRMaXN0KSB7DQogICAgICAgICAgICBjb25zdCBldmVudFBhdGggPSBldmVudExpc3QucGF0aDsNCiAgICAgICAgICAgIGlmIChwcmVkaWNhdGUoZXZlbnRQYXRoKSkgew0KICAgICAgICAgICAgICAgIGV2ZW50TGlzdFJhaXNlKGV2ZW50UXVldWUuZXZlbnRMaXN0c19baV0pOw0KICAgICAgICAgICAgICAgIGV2ZW50UXVldWUuZXZlbnRMaXN0c19baV0gPSBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgc2VudEFsbCA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChzZW50QWxsKSB7DQogICAgICAgIGV2ZW50UXVldWUuZXZlbnRMaXN0c18gPSBbXTsNCiAgICB9DQogICAgZXZlbnRRdWV1ZS5yZWN1cnNpb25EZXB0aF8tLTsNCn0NCi8qKg0KICogSXRlcmF0ZXMgdGhyb3VnaCB0aGUgbGlzdCBhbmQgcmFpc2VzIGVhY2ggZXZlbnQNCiAqLw0KZnVuY3Rpb24gZXZlbnRMaXN0UmFpc2UoZXZlbnRMaXN0KSB7DQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBldmVudExpc3QuZXZlbnRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGNvbnN0IGV2ZW50RGF0YSA9IGV2ZW50TGlzdC5ldmVudHNbaV07DQogICAgICAgIGlmIChldmVudERhdGEgIT09IG51bGwpIHsNCiAgICAgICAgICAgIGV2ZW50TGlzdC5ldmVudHNbaV0gPSBudWxsOw0KICAgICAgICAgICAgY29uc3QgZXZlbnRGbiA9IGV2ZW50RGF0YS5nZXRFdmVudFJ1bm5lcigpOw0KICAgICAgICAgICAgaWYgKGxvZ2dlcikgew0KICAgICAgICAgICAgICAgIGxvZygnZXZlbnQ6ICcgKyBldmVudERhdGEudG9TdHJpbmcoKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBleGNlcHRpb25HdWFyZChldmVudEZuKTsNCiAgICAgICAgfQ0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNvbnN0IElOVEVSUlVQVF9SRUFTT04gPSAncmVwb19pbnRlcnJ1cHQnOw0KLyoqDQogKiBJZiBhIHRyYW5zYWN0aW9uIGRvZXMgbm90IHN1Y2NlZWQgYWZ0ZXIgMjUgcmV0cmllcywgd2UgYWJvcnQgaXQuIEFtb25nIG90aGVyDQogKiB0aGluZ3MgdGhpcyBlbnN1cmUgdGhhdCBpZiB0aGVyZSdzIGV2ZXIgYSBidWcgY2F1c2luZyBhIG1pc21hdGNoIGJldHdlZW4NCiAqIGNsaWVudCAvIHNlcnZlciBoYXNoZXMgZm9yIHNvbWUgZGF0YSwgd2Ugd29uJ3QgcmV0cnkgaW5kZWZpbml0ZWx5Lg0KICovDQpjb25zdCBNQVhfVFJBTlNBQ1RJT05fUkVUUklFUyA9IDI1Ow0KLyoqDQogKiBBIGNvbm5lY3Rpb24gdG8gYSBzaW5nbGUgZGF0YSByZXBvc2l0b3J5Lg0KICovDQpjbGFzcyBSZXBvIHsNCiAgICBjb25zdHJ1Y3RvcihyZXBvSW5mb18sIGZvcmNlUmVzdENsaWVudF8sIGF1dGhUb2tlblByb3ZpZGVyXywgYXBwQ2hlY2tQcm92aWRlcl8pIHsNCiAgICAgICAgdGhpcy5yZXBvSW5mb18gPSByZXBvSW5mb187DQogICAgICAgIHRoaXMuZm9yY2VSZXN0Q2xpZW50XyA9IGZvcmNlUmVzdENsaWVudF87DQogICAgICAgIHRoaXMuYXV0aFRva2VuUHJvdmlkZXJfID0gYXV0aFRva2VuUHJvdmlkZXJfOw0KICAgICAgICB0aGlzLmFwcENoZWNrUHJvdmlkZXJfID0gYXBwQ2hlY2tQcm92aWRlcl87DQogICAgICAgIHRoaXMuZGF0YVVwZGF0ZUNvdW50ID0gMDsNCiAgICAgICAgdGhpcy5zdGF0c0xpc3RlbmVyXyA9IG51bGw7DQogICAgICAgIHRoaXMuZXZlbnRRdWV1ZV8gPSBuZXcgRXZlbnRRdWV1ZSgpOw0KICAgICAgICB0aGlzLm5leHRXcml0ZUlkXyA9IDE7DQogICAgICAgIHRoaXMuaW50ZXJjZXB0U2VydmVyRGF0YUNhbGxiYWNrXyA9IG51bGw7DQogICAgICAgIC8qKiBBIGxpc3Qgb2YgZGF0YSBwaWVjZXMgYW5kIHBhdGhzIHRvIGJlIHNldCB3aGVuIHRoaXMgY2xpZW50IGRpc2Nvbm5lY3RzLiAqLw0KICAgICAgICB0aGlzLm9uRGlzY29ubmVjdF8gPSBuZXdTcGFyc2VTbmFwc2hvdFRyZWUoKTsNCiAgICAgICAgLyoqIFN0b3JlcyBxdWV1ZXMgb2Ygb3V0c3RhbmRpbmcgdHJhbnNhY3Rpb25zIGZvciBGaXJlYmFzZSBsb2NhdGlvbnMuICovDQogICAgICAgIHRoaXMudHJhbnNhY3Rpb25RdWV1ZVRyZWVfID0gbmV3IFRyZWUoKTsNCiAgICAgICAgLy8gVE9ETzogVGhpcyBzaG91bGQgYmUgQHByaXZhdGUgYnV0IGl0J3MgdXNlZCBieSB0ZXN0X2FjY2Vzcy5qcyBhbmQgaW50ZXJuYWwuanMNCiAgICAgICAgdGhpcy5wZXJzaXN0ZW50Q29ubmVjdGlvbl8gPSBudWxsOw0KICAgICAgICAvLyBUaGlzIGtleSBpcyBpbnRlbnRpb25hbGx5IG5vdCB1cGRhdGVkIGlmIFJlcG9JbmZvIGlzIGxhdGVyIGNoYW5nZWQgb3IgcmVwbGFjZWQNCiAgICAgICAgdGhpcy5rZXkgPSB0aGlzLnJlcG9JbmZvXy50b1VSTFN0cmluZygpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBAcmV0dXJucyBUaGUgVVJMIGNvcnJlc3BvbmRpbmcgdG8gdGhlIHJvb3Qgb2YgdGhpcyBGaXJlYmFzZS4NCiAgICAgKi8NCiAgICB0b1N0cmluZygpIHsNCiAgICAgICAgcmV0dXJuICgodGhpcy5yZXBvSW5mb18uc2VjdXJlID8gJ2h0dHBzOi8vJyA6ICdodHRwOi8vJykgKyB0aGlzLnJlcG9JbmZvXy5ob3N0KTsNCiAgICB9DQp9DQpmdW5jdGlvbiByZXBvU3RhcnQocmVwbywgYXBwSWQsIGF1dGhPdmVycmlkZSkgew0KICAgIHJlcG8uc3RhdHNfID0gc3RhdHNNYW5hZ2VyR2V0Q29sbGVjdGlvbihyZXBvLnJlcG9JbmZvXyk7DQogICAgaWYgKHJlcG8uZm9yY2VSZXN0Q2xpZW50XyB8fCBiZWluZ0NyYXdsZWQoKSkgew0KICAgICAgICByZXBvLnNlcnZlcl8gPSBuZXcgUmVhZG9ubHlSZXN0Q2xpZW50KHJlcG8ucmVwb0luZm9fLCAocGF0aFN0cmluZywgZGF0YSwgaXNNZXJnZSwgdGFnKSA9PiB7DQogICAgICAgICAgICByZXBvT25EYXRhVXBkYXRlKHJlcG8sIHBhdGhTdHJpbmcsIGRhdGEsIGlzTWVyZ2UsIHRhZyk7DQogICAgICAgIH0sIHJlcG8uYXV0aFRva2VuUHJvdmlkZXJfLCByZXBvLmFwcENoZWNrUHJvdmlkZXJfKTsNCiAgICAgICAgLy8gTWlub3IgaGFjazogRmlyZSBvbkNvbm5lY3QgaW1tZWRpYXRlbHksIHNpbmNlIHRoZXJlJ3Mgbm8gYWN0dWFsIGNvbm5lY3Rpb24uDQogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gcmVwb09uQ29ubmVjdFN0YXR1cyhyZXBvLCAvKiBjb25uZWN0U3RhdHVzPSAqLyB0cnVlKSwgMCk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICAvLyBWYWxpZGF0ZSBhdXRoT3ZlcnJpZGUNCiAgICAgICAgaWYgKHR5cGVvZiBhdXRoT3ZlcnJpZGUgIT09ICd1bmRlZmluZWQnICYmIGF1dGhPdmVycmlkZSAhPT0gbnVsbCkgew0KICAgICAgICAgICAgaWYgKHR5cGVvZiBhdXRoT3ZlcnJpZGUgIT09ICdvYmplY3QnKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdPbmx5IG9iamVjdHMgYXJlIHN1cHBvcnRlZCBmb3Igb3B0aW9uIGRhdGFiYXNlQXV0aFZhcmlhYmxlT3ZlcnJpZGUnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgc3RyaW5naWZ5KGF1dGhPdmVycmlkZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBhdXRoT3ZlcnJpZGUgcHJvdmlkZWQ6ICcgKyBlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXBvLnBlcnNpc3RlbnRDb25uZWN0aW9uXyA9IG5ldyBQZXJzaXN0ZW50Q29ubmVjdGlvbihyZXBvLnJlcG9JbmZvXywgYXBwSWQsIChwYXRoU3RyaW5nLCBkYXRhLCBpc01lcmdlLCB0YWcpID0+IHsNCiAgICAgICAgICAgIHJlcG9PbkRhdGFVcGRhdGUocmVwbywgcGF0aFN0cmluZywgZGF0YSwgaXNNZXJnZSwgdGFnKTsNCiAgICAgICAgfSwgKGNvbm5lY3RTdGF0dXMpID0+IHsNCiAgICAgICAgICAgIHJlcG9PbkNvbm5lY3RTdGF0dXMocmVwbywgY29ubmVjdFN0YXR1cyk7DQogICAgICAgIH0sICh1cGRhdGVzKSA9PiB7DQogICAgICAgICAgICByZXBvT25TZXJ2ZXJJbmZvVXBkYXRlKHJlcG8sIHVwZGF0ZXMpOw0KICAgICAgICB9LCByZXBvLmF1dGhUb2tlblByb3ZpZGVyXywgcmVwby5hcHBDaGVja1Byb3ZpZGVyXywgYXV0aE92ZXJyaWRlKTsNCiAgICAgICAgcmVwby5zZXJ2ZXJfID0gcmVwby5wZXJzaXN0ZW50Q29ubmVjdGlvbl87DQogICAgfQ0KICAgIHJlcG8uYXV0aFRva2VuUHJvdmlkZXJfLmFkZFRva2VuQ2hhbmdlTGlzdGVuZXIodG9rZW4gPT4gew0KICAgICAgICByZXBvLnNlcnZlcl8ucmVmcmVzaEF1dGhUb2tlbih0b2tlbik7DQogICAgfSk7DQogICAgcmVwby5hcHBDaGVja1Byb3ZpZGVyXy5hZGRUb2tlbkNoYW5nZUxpc3RlbmVyKHJlc3VsdCA9PiB7DQogICAgICAgIHJlcG8uc2VydmVyXy5yZWZyZXNoQXBwQ2hlY2tUb2tlbihyZXN1bHQudG9rZW4pOw0KICAgIH0pOw0KICAgIC8vIEluIHRoZSBjYXNlIG9mIG11bHRpcGxlIFJlcG9zIGZvciB0aGUgc2FtZSByZXBvSW5mbyAoaS5lLiB0aGVyZSBhcmUgbXVsdGlwbGUgRmlyZWJhc2UuQ29udGV4dHMgYmVpbmcgdXNlZCksDQogICAgLy8gd2Ugb25seSB3YW50IHRvIGNyZWF0ZSBvbmUgU3RhdHNSZXBvcnRlci4gIEFzIHN1Y2gsIHdlJ2xsIHJlcG9ydCBzdGF0cyBvdmVyIHRoZSBmaXJzdCBSZXBvIGNyZWF0ZWQuDQogICAgcmVwby5zdGF0c1JlcG9ydGVyXyA9IHN0YXRzTWFuYWdlckdldE9yQ3JlYXRlUmVwb3J0ZXIocmVwby5yZXBvSW5mb18sICgpID0+IG5ldyBTdGF0c1JlcG9ydGVyKHJlcG8uc3RhdHNfLCByZXBvLnNlcnZlcl8pKTsNCiAgICAvLyBVc2VkIGZvciAuaW5mby4NCiAgICByZXBvLmluZm9EYXRhXyA9IG5ldyBTbmFwc2hvdEhvbGRlcigpOw0KICAgIHJlcG8uaW5mb1N5bmNUcmVlXyA9IG5ldyBTeW5jVHJlZSh7DQogICAgICAgIHN0YXJ0TGlzdGVuaW5nOiAocXVlcnksIHRhZywgY3VycmVudEhhc2hGbiwgb25Db21wbGV0ZSkgPT4gew0KICAgICAgICAgICAgbGV0IGluZm9FdmVudHMgPSBbXTsNCiAgICAgICAgICAgIGNvbnN0IG5vZGUgPSByZXBvLmluZm9EYXRhXy5nZXROb2RlKHF1ZXJ5Ll9wYXRoKTsNCiAgICAgICAgICAgIC8vIFRoaXMgaXMgcG9zc2libHkgYSBoYWNrLCBidXQgd2UgaGF2ZSBkaWZmZXJlbnQgc2VtYW50aWNzIGZvciAuaW5mbyBlbmRwb2ludHMuIFdlIGRvbid0IHJhaXNlIG51bGwgZXZlbnRzDQogICAgICAgICAgICAvLyBvbiBpbml0aWFsIGRhdGEuLi4NCiAgICAgICAgICAgIGlmICghbm9kZS5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgICAgICBpbmZvRXZlbnRzID0gc3luY1RyZWVBcHBseVNlcnZlck92ZXJ3cml0ZShyZXBvLmluZm9TeW5jVHJlZV8sIHF1ZXJ5Ll9wYXRoLCBub2RlKTsNCiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgb25Db21wbGV0ZSgnb2snKTsNCiAgICAgICAgICAgICAgICB9LCAwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBpbmZvRXZlbnRzOw0KICAgICAgICB9LA0KICAgICAgICBzdG9wTGlzdGVuaW5nOiAoKSA9PiB7IH0NCiAgICB9KTsNCiAgICByZXBvVXBkYXRlSW5mbyhyZXBvLCAnY29ubmVjdGVkJywgZmFsc2UpOw0KICAgIHJlcG8uc2VydmVyU3luY1RyZWVfID0gbmV3IFN5bmNUcmVlKHsNCiAgICAgICAgc3RhcnRMaXN0ZW5pbmc6IChxdWVyeSwgdGFnLCBjdXJyZW50SGFzaEZuLCBvbkNvbXBsZXRlKSA9PiB7DQogICAgICAgICAgICByZXBvLnNlcnZlcl8ubGlzdGVuKHF1ZXJ5LCBjdXJyZW50SGFzaEZuLCB0YWcsIChzdGF0dXMsIGRhdGEpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBldmVudHMgPSBvbkNvbXBsZXRlKHN0YXR1cywgZGF0YSk7DQogICAgICAgICAgICAgICAgZXZlbnRRdWV1ZVJhaXNlRXZlbnRzRm9yQ2hhbmdlZFBhdGgocmVwby5ldmVudFF1ZXVlXywgcXVlcnkuX3BhdGgsIGV2ZW50cyk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIC8vIE5vIHN5bmNocm9ub3VzIGV2ZW50cyBmb3IgbmV0d29yay1iYWNrZWQgc3luYyB0cmVlcw0KICAgICAgICAgICAgcmV0dXJuIFtdOw0KICAgICAgICB9LA0KICAgICAgICBzdG9wTGlzdGVuaW5nOiAocXVlcnksIHRhZykgPT4gew0KICAgICAgICAgICAgcmVwby5zZXJ2ZXJfLnVubGlzdGVuKHF1ZXJ5LCB0YWcpOw0KICAgICAgICB9DQogICAgfSk7DQp9DQovKioNCiAqIEByZXR1cm5zIFRoZSB0aW1lIGluIG1pbGxpc2Vjb25kcywgdGFraW5nIHRoZSBzZXJ2ZXIgb2Zmc2V0IGludG8gYWNjb3VudCBpZiB3ZSBoYXZlIG9uZS4NCiAqLw0KZnVuY3Rpb24gcmVwb1NlcnZlclRpbWUocmVwbykgew0KICAgIGNvbnN0IG9mZnNldE5vZGUgPSByZXBvLmluZm9EYXRhXy5nZXROb2RlKG5ldyBQYXRoKCcuaW5mby9zZXJ2ZXJUaW1lT2Zmc2V0JykpOw0KICAgIGNvbnN0IG9mZnNldCA9IG9mZnNldE5vZGUudmFsKCkgfHwgMDsNCiAgICByZXR1cm4gbmV3IERhdGUoKS5nZXRUaW1lKCkgKyBvZmZzZXQ7DQp9DQovKioNCiAqIEdlbmVyYXRlIFNlcnZlclZhbHVlcyB1c2luZyBzb21lIHZhcmlhYmxlcyBmcm9tIHRoZSByZXBvIG9iamVjdC4NCiAqLw0KZnVuY3Rpb24gcmVwb0dlbmVyYXRlU2VydmVyVmFsdWVzKHJlcG8pIHsNCiAgICByZXR1cm4gZ2VuZXJhdGVXaXRoVmFsdWVzKHsNCiAgICAgICAgdGltZXN0YW1wOiByZXBvU2VydmVyVGltZShyZXBvKQ0KICAgIH0pOw0KfQ0KLyoqDQogKiBDYWxsZWQgYnkgcmVhbHRpbWUgd2hlbiB3ZSBnZXQgbmV3IG1lc3NhZ2VzIGZyb20gdGhlIHNlcnZlci4NCiAqLw0KZnVuY3Rpb24gcmVwb09uRGF0YVVwZGF0ZShyZXBvLCBwYXRoU3RyaW5nLCBkYXRhLCBpc01lcmdlLCB0YWcpIHsNCiAgICAvLyBGb3IgdGVzdGluZy4NCiAgICByZXBvLmRhdGFVcGRhdGVDb3VudCsrOw0KICAgIGNvbnN0IHBhdGggPSBuZXcgUGF0aChwYXRoU3RyaW5nKTsNCiAgICBkYXRhID0gcmVwby5pbnRlcmNlcHRTZXJ2ZXJEYXRhQ2FsbGJhY2tfDQogICAgICAgID8gcmVwby5pbnRlcmNlcHRTZXJ2ZXJEYXRhQ2FsbGJhY2tfKHBhdGhTdHJpbmcsIGRhdGEpDQogICAgICAgIDogZGF0YTsNCiAgICBsZXQgZXZlbnRzID0gW107DQogICAgaWYgKHRhZykgew0KICAgICAgICBpZiAoaXNNZXJnZSkgew0KICAgICAgICAgICAgY29uc3QgdGFnZ2VkQ2hpbGRyZW4gPSBtYXAkMShkYXRhLCAocmF3KSA9PiBub2RlRnJvbUpTT04ocmF3KSk7DQogICAgICAgICAgICBldmVudHMgPSBzeW5jVHJlZUFwcGx5VGFnZ2VkUXVlcnlNZXJnZShyZXBvLnNlcnZlclN5bmNUcmVlXywgcGF0aCwgdGFnZ2VkQ2hpbGRyZW4sIHRhZyk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBjb25zdCB0YWdnZWRTbmFwID0gbm9kZUZyb21KU09OKGRhdGEpOw0KICAgICAgICAgICAgZXZlbnRzID0gc3luY1RyZWVBcHBseVRhZ2dlZFF1ZXJ5T3ZlcndyaXRlKHJlcG8uc2VydmVyU3luY1RyZWVfLCBwYXRoLCB0YWdnZWRTbmFwLCB0YWcpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGVsc2UgaWYgKGlzTWVyZ2UpIHsNCiAgICAgICAgY29uc3QgY2hhbmdlZENoaWxkcmVuID0gbWFwJDEoZGF0YSwgKHJhdykgPT4gbm9kZUZyb21KU09OKHJhdykpOw0KICAgICAgICBldmVudHMgPSBzeW5jVHJlZUFwcGx5U2VydmVyTWVyZ2UocmVwby5zZXJ2ZXJTeW5jVHJlZV8sIHBhdGgsIGNoYW5nZWRDaGlsZHJlbik7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBjb25zdCBzbmFwID0gbm9kZUZyb21KU09OKGRhdGEpOw0KICAgICAgICBldmVudHMgPSBzeW5jVHJlZUFwcGx5U2VydmVyT3ZlcndyaXRlKHJlcG8uc2VydmVyU3luY1RyZWVfLCBwYXRoLCBzbmFwKTsNCiAgICB9DQogICAgbGV0IGFmZmVjdGVkUGF0aCA9IHBhdGg7DQogICAgaWYgKGV2ZW50cy5sZW5ndGggPiAwKSB7DQogICAgICAgIC8vIFNpbmNlIHdlIGhhdmUgYSBsaXN0ZW5lciBvdXRzdGFuZGluZyBmb3IgZWFjaCB0cmFuc2FjdGlvbiwgcmVjZWl2aW5nIGFueSBldmVudHMNCiAgICAgICAgLy8gaXMgYSBwcm94eSBmb3Igc29tZSBjaGFuZ2UgaGF2aW5nIG9jY3VycmVkLg0KICAgICAgICBhZmZlY3RlZFBhdGggPSByZXBvUmVydW5UcmFuc2FjdGlvbnMocmVwbywgcGF0aCk7DQogICAgfQ0KICAgIGV2ZW50UXVldWVSYWlzZUV2ZW50c0ZvckNoYW5nZWRQYXRoKHJlcG8uZXZlbnRRdWV1ZV8sIGFmZmVjdGVkUGF0aCwgZXZlbnRzKTsNCn0NCmZ1bmN0aW9uIHJlcG9PbkNvbm5lY3RTdGF0dXMocmVwbywgY29ubmVjdFN0YXR1cykgew0KICAgIHJlcG9VcGRhdGVJbmZvKHJlcG8sICdjb25uZWN0ZWQnLCBjb25uZWN0U3RhdHVzKTsNCiAgICBpZiAoY29ubmVjdFN0YXR1cyA9PT0gZmFsc2UpIHsNCiAgICAgICAgcmVwb1J1bk9uRGlzY29ubmVjdEV2ZW50cyhyZXBvKTsNCiAgICB9DQp9DQpmdW5jdGlvbiByZXBvT25TZXJ2ZXJJbmZvVXBkYXRlKHJlcG8sIHVwZGF0ZXMpIHsNCiAgICBlYWNoKHVwZGF0ZXMsIChrZXksIHZhbHVlKSA9PiB7DQogICAgICAgIHJlcG9VcGRhdGVJbmZvKHJlcG8sIGtleSwgdmFsdWUpOw0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcmVwb1VwZGF0ZUluZm8ocmVwbywgcGF0aFN0cmluZywgdmFsdWUpIHsNCiAgICBjb25zdCBwYXRoID0gbmV3IFBhdGgoJy8uaW5mby8nICsgcGF0aFN0cmluZyk7DQogICAgY29uc3QgbmV3Tm9kZSA9IG5vZGVGcm9tSlNPTih2YWx1ZSk7DQogICAgcmVwby5pbmZvRGF0YV8udXBkYXRlU25hcHNob3QocGF0aCwgbmV3Tm9kZSk7DQogICAgY29uc3QgZXZlbnRzID0gc3luY1RyZWVBcHBseVNlcnZlck92ZXJ3cml0ZShyZXBvLmluZm9TeW5jVHJlZV8sIHBhdGgsIG5ld05vZGUpOw0KICAgIGV2ZW50UXVldWVSYWlzZUV2ZW50c0ZvckNoYW5nZWRQYXRoKHJlcG8uZXZlbnRRdWV1ZV8sIHBhdGgsIGV2ZW50cyk7DQp9DQpmdW5jdGlvbiByZXBvR2V0TmV4dFdyaXRlSWQocmVwbykgew0KICAgIHJldHVybiByZXBvLm5leHRXcml0ZUlkXysrOw0KfQ0KZnVuY3Rpb24gcmVwb1NldFdpdGhQcmlvcml0eShyZXBvLCBwYXRoLCBuZXdWYWwsIG5ld1ByaW9yaXR5LCBvbkNvbXBsZXRlKSB7DQogICAgcmVwb0xvZyhyZXBvLCAnc2V0Jywgew0KICAgICAgICBwYXRoOiBwYXRoLnRvU3RyaW5nKCksDQogICAgICAgIHZhbHVlOiBuZXdWYWwsDQogICAgICAgIHByaW9yaXR5OiBuZXdQcmlvcml0eQ0KICAgIH0pOw0KICAgIC8vIFRPRE86IE9wdGltaXplIHRoaXMgYmVoYXZpb3IgdG8gZWl0aGVyIChhKSBzdG9yZSBmbGFnIHRvIHNraXAgcmVzb2x2aW5nIHdoZXJlIHBvc3NpYmxlIGFuZCAvIG9yDQogICAgLy8gKGIpIHN0b3JlIHVucmVzb2x2ZWQgcGF0aHMgb24gSlNPTiBwYXJzZQ0KICAgIGNvbnN0IHNlcnZlclZhbHVlcyA9IHJlcG9HZW5lcmF0ZVNlcnZlclZhbHVlcyhyZXBvKTsNCiAgICBjb25zdCBuZXdOb2RlVW5yZXNvbHZlZCA9IG5vZGVGcm9tSlNPTihuZXdWYWwsIG5ld1ByaW9yaXR5KTsNCiAgICBjb25zdCBleGlzdGluZyA9IHN5bmNUcmVlQ2FsY0NvbXBsZXRlRXZlbnRDYWNoZShyZXBvLnNlcnZlclN5bmNUcmVlXywgcGF0aCk7DQogICAgY29uc3QgbmV3Tm9kZSA9IHJlc29sdmVEZWZlcnJlZFZhbHVlU25hcHNob3QobmV3Tm9kZVVucmVzb2x2ZWQsIGV4aXN0aW5nLCBzZXJ2ZXJWYWx1ZXMpOw0KICAgIGNvbnN0IHdyaXRlSWQgPSByZXBvR2V0TmV4dFdyaXRlSWQocmVwbyk7DQogICAgY29uc3QgZXZlbnRzID0gc3luY1RyZWVBcHBseVVzZXJPdmVyd3JpdGUocmVwby5zZXJ2ZXJTeW5jVHJlZV8sIHBhdGgsIG5ld05vZGUsIHdyaXRlSWQsIHRydWUpOw0KICAgIGV2ZW50UXVldWVRdWV1ZUV2ZW50cyhyZXBvLmV2ZW50UXVldWVfLCBldmVudHMpOw0KICAgIHJlcG8uc2VydmVyXy5wdXQocGF0aC50b1N0cmluZygpLCBuZXdOb2RlVW5yZXNvbHZlZC52YWwoLypleHBvcnQ9Ki8gdHJ1ZSksIChzdGF0dXMsIGVycm9yUmVhc29uKSA9PiB7DQogICAgICAgIGNvbnN0IHN1Y2Nlc3MgPSBzdGF0dXMgPT09ICdvayc7DQogICAgICAgIGlmICghc3VjY2Vzcykgew0KICAgICAgICAgICAgd2Fybignc2V0IGF0ICcgKyBwYXRoICsgJyBmYWlsZWQ6ICcgKyBzdGF0dXMpOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IGNsZWFyRXZlbnRzID0gc3luY1RyZWVBY2tVc2VyV3JpdGUocmVwby5zZXJ2ZXJTeW5jVHJlZV8sIHdyaXRlSWQsICFzdWNjZXNzKTsNCiAgICAgICAgZXZlbnRRdWV1ZVJhaXNlRXZlbnRzRm9yQ2hhbmdlZFBhdGgocmVwby5ldmVudFF1ZXVlXywgcGF0aCwgY2xlYXJFdmVudHMpOw0KICAgICAgICByZXBvQ2FsbE9uQ29tcGxldGVDYWxsYmFjayhyZXBvLCBvbkNvbXBsZXRlLCBzdGF0dXMsIGVycm9yUmVhc29uKTsNCiAgICB9KTsNCiAgICBjb25zdCBhZmZlY3RlZFBhdGggPSByZXBvQWJvcnRUcmFuc2FjdGlvbnMocmVwbywgcGF0aCk7DQogICAgcmVwb1JlcnVuVHJhbnNhY3Rpb25zKHJlcG8sIGFmZmVjdGVkUGF0aCk7DQogICAgLy8gV2UgcXVldWVkIHRoZSBldmVudHMgYWJvdmUsIHNvIGp1c3QgZmx1c2ggdGhlIHF1ZXVlIGhlcmUNCiAgICBldmVudFF1ZXVlUmFpc2VFdmVudHNGb3JDaGFuZ2VkUGF0aChyZXBvLmV2ZW50UXVldWVfLCBhZmZlY3RlZFBhdGgsIFtdKTsNCn0NCi8qKg0KICogQXBwbGllcyBhbGwgb2YgdGhlIGNoYW5nZXMgc3RvcmVkIHVwIGluIHRoZSBvbkRpc2Nvbm5lY3RfIHRyZWUuDQogKi8NCmZ1bmN0aW9uIHJlcG9SdW5PbkRpc2Nvbm5lY3RFdmVudHMocmVwbykgew0KICAgIHJlcG9Mb2cocmVwbywgJ29uRGlzY29ubmVjdEV2ZW50cycpOw0KICAgIGNvbnN0IHNlcnZlclZhbHVlcyA9IHJlcG9HZW5lcmF0ZVNlcnZlclZhbHVlcyhyZXBvKTsNCiAgICBjb25zdCByZXNvbHZlZE9uRGlzY29ubmVjdFRyZWUgPSBuZXdTcGFyc2VTbmFwc2hvdFRyZWUoKTsNCiAgICBzcGFyc2VTbmFwc2hvdFRyZWVGb3JFYWNoVHJlZShyZXBvLm9uRGlzY29ubmVjdF8sIG5ld0VtcHR5UGF0aCgpLCAocGF0aCwgbm9kZSkgPT4gew0KICAgICAgICBjb25zdCByZXNvbHZlZCA9IHJlc29sdmVEZWZlcnJlZFZhbHVlVHJlZShwYXRoLCBub2RlLCByZXBvLnNlcnZlclN5bmNUcmVlXywgc2VydmVyVmFsdWVzKTsNCiAgICAgICAgc3BhcnNlU25hcHNob3RUcmVlUmVtZW1iZXIocmVzb2x2ZWRPbkRpc2Nvbm5lY3RUcmVlLCBwYXRoLCByZXNvbHZlZCk7DQogICAgfSk7DQogICAgbGV0IGV2ZW50cyA9IFtdOw0KICAgIHNwYXJzZVNuYXBzaG90VHJlZUZvckVhY2hUcmVlKHJlc29sdmVkT25EaXNjb25uZWN0VHJlZSwgbmV3RW1wdHlQYXRoKCksIChwYXRoLCBzbmFwKSA9PiB7DQogICAgICAgIGV2ZW50cyA9IGV2ZW50cy5jb25jYXQoc3luY1RyZWVBcHBseVNlcnZlck92ZXJ3cml0ZShyZXBvLnNlcnZlclN5bmNUcmVlXywgcGF0aCwgc25hcCkpOw0KICAgICAgICBjb25zdCBhZmZlY3RlZFBhdGggPSByZXBvQWJvcnRUcmFuc2FjdGlvbnMocmVwbywgcGF0aCk7DQogICAgICAgIHJlcG9SZXJ1blRyYW5zYWN0aW9ucyhyZXBvLCBhZmZlY3RlZFBhdGgpOw0KICAgIH0pOw0KICAgIHJlcG8ub25EaXNjb25uZWN0XyA9IG5ld1NwYXJzZVNuYXBzaG90VHJlZSgpOw0KICAgIGV2ZW50UXVldWVSYWlzZUV2ZW50c0ZvckNoYW5nZWRQYXRoKHJlcG8uZXZlbnRRdWV1ZV8sIG5ld0VtcHR5UGF0aCgpLCBldmVudHMpOw0KfQ0KZnVuY3Rpb24gcmVwb0FkZEV2ZW50Q2FsbGJhY2tGb3JRdWVyeShyZXBvLCBxdWVyeSwgZXZlbnRSZWdpc3RyYXRpb24pIHsNCiAgICBsZXQgZXZlbnRzOw0KICAgIGlmIChwYXRoR2V0RnJvbnQocXVlcnkuX3BhdGgpID09PSAnLmluZm8nKSB7DQogICAgICAgIGV2ZW50cyA9IHN5bmNUcmVlQWRkRXZlbnRSZWdpc3RyYXRpb24ocmVwby5pbmZvU3luY1RyZWVfLCBxdWVyeSwgZXZlbnRSZWdpc3RyYXRpb24pOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgZXZlbnRzID0gc3luY1RyZWVBZGRFdmVudFJlZ2lzdHJhdGlvbihyZXBvLnNlcnZlclN5bmNUcmVlXywgcXVlcnksIGV2ZW50UmVnaXN0cmF0aW9uKTsNCiAgICB9DQogICAgZXZlbnRRdWV1ZVJhaXNlRXZlbnRzQXRQYXRoKHJlcG8uZXZlbnRRdWV1ZV8sIHF1ZXJ5Ll9wYXRoLCBldmVudHMpOw0KfQ0KZnVuY3Rpb24gcmVwb1JlbW92ZUV2ZW50Q2FsbGJhY2tGb3JRdWVyeShyZXBvLCBxdWVyeSwgZXZlbnRSZWdpc3RyYXRpb24pIHsNCiAgICAvLyBUaGVzZSBhcmUgZ3VhcmFudGVlZCBub3QgdG8gcmFpc2UgZXZlbnRzLCBzaW5jZSB3ZSdyZSBub3QgcGFzc2luZyBpbiBhIGNhbmNlbEVycm9yLiBIb3dldmVyLCB3ZSBjYW4gZnV0dXJlLXByb29mDQogICAgLy8gYSBsaXR0bGUgYml0IGJ5IGhhbmRsaW5nIHRoZSByZXR1cm4gdmFsdWVzIGFueXdheXMuDQogICAgbGV0IGV2ZW50czsNCiAgICBpZiAocGF0aEdldEZyb250KHF1ZXJ5Ll9wYXRoKSA9PT0gJy5pbmZvJykgew0KICAgICAgICBldmVudHMgPSBzeW5jVHJlZVJlbW92ZUV2ZW50UmVnaXN0cmF0aW9uKHJlcG8uaW5mb1N5bmNUcmVlXywgcXVlcnksIGV2ZW50UmVnaXN0cmF0aW9uKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGV2ZW50cyA9IHN5bmNUcmVlUmVtb3ZlRXZlbnRSZWdpc3RyYXRpb24ocmVwby5zZXJ2ZXJTeW5jVHJlZV8sIHF1ZXJ5LCBldmVudFJlZ2lzdHJhdGlvbik7DQogICAgfQ0KICAgIGV2ZW50UXVldWVSYWlzZUV2ZW50c0F0UGF0aChyZXBvLmV2ZW50UXVldWVfLCBxdWVyeS5fcGF0aCwgZXZlbnRzKTsNCn0NCmZ1bmN0aW9uIHJlcG9JbnRlcnJ1cHQocmVwbykgew0KICAgIGlmIChyZXBvLnBlcnNpc3RlbnRDb25uZWN0aW9uXykgew0KICAgICAgICByZXBvLnBlcnNpc3RlbnRDb25uZWN0aW9uXy5pbnRlcnJ1cHQoSU5URVJSVVBUX1JFQVNPTik7DQogICAgfQ0KfQ0KZnVuY3Rpb24gcmVwb0xvZyhyZXBvLCAuLi52YXJBcmdzKSB7DQogICAgbGV0IHByZWZpeCA9ICcnOw0KICAgIGlmIChyZXBvLnBlcnNpc3RlbnRDb25uZWN0aW9uXykgew0KICAgICAgICBwcmVmaXggPSByZXBvLnBlcnNpc3RlbnRDb25uZWN0aW9uXy5pZCArICc6JzsNCiAgICB9DQogICAgbG9nKHByZWZpeCwgLi4udmFyQXJncyk7DQp9DQpmdW5jdGlvbiByZXBvQ2FsbE9uQ29tcGxldGVDYWxsYmFjayhyZXBvLCBjYWxsYmFjaywgc3RhdHVzLCBlcnJvclJlYXNvbikgew0KICAgIGlmIChjYWxsYmFjaykgew0KICAgICAgICBleGNlcHRpb25HdWFyZCgoKSA9PiB7DQogICAgICAgICAgICBpZiAoc3RhdHVzID09PSAnb2snKSB7DQogICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBjb25zdCBjb2RlID0gKHN0YXR1cyB8fCAnZXJyb3InKS50b1VwcGVyQ2FzZSgpOw0KICAgICAgICAgICAgICAgIGxldCBtZXNzYWdlID0gY29kZTsNCiAgICAgICAgICAgICAgICBpZiAoZXJyb3JSZWFzb24pIHsNCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSArPSAnOiAnICsgZXJyb3JSZWFzb247DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKG1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55DQogICAgICAgICAgICAgICAgZXJyb3IuY29kZSA9IGNvZGU7DQogICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQp9DQovKioNCiAqIEBwYXJhbSBleGNsdWRlU2V0cyAtIEEgc3BlY2lmaWMgc2V0IHRvIGV4Y2x1ZGUNCiAqLw0KZnVuY3Rpb24gcmVwb0dldExhdGVzdFN0YXRlKHJlcG8sIHBhdGgsIGV4Y2x1ZGVTZXRzKSB7DQogICAgcmV0dXJuIChzeW5jVHJlZUNhbGNDb21wbGV0ZUV2ZW50Q2FjaGUocmVwby5zZXJ2ZXJTeW5jVHJlZV8sIHBhdGgsIGV4Y2x1ZGVTZXRzKSB8fA0KICAgICAgICBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERSk7DQp9DQovKioNCiAqIFNlbmRzIGFueSBhbHJlYWR5LXJ1biB0cmFuc2FjdGlvbnMgdGhhdCBhcmVuJ3Qgd2FpdGluZyBmb3Igb3V0c3RhbmRpbmcNCiAqIHRyYW5zYWN0aW9ucyB0byBjb21wbGV0ZS4NCiAqDQogKiBFeHRlcm5hbGx5IGl0J3MgY2FsbGVkIHdpdGggbm8gYXJndW1lbnRzLCBidXQgaXQgY2FsbHMgaXRzZWxmIHJlY3Vyc2l2ZWx5DQogKiB3aXRoIGEgcGFydGljdWxhciB0cmFuc2FjdGlvblF1ZXVlVHJlZSBub2RlIHRvIHJlY3Vyc2UgdGhyb3VnaCB0aGUgdHJlZS4NCiAqDQogKiBAcGFyYW0gbm9kZSAtIHRyYW5zYWN0aW9uUXVldWVUcmVlIG5vZGUgdG8gc3RhcnQgYXQuDQogKi8NCmZ1bmN0aW9uIHJlcG9TZW5kUmVhZHlUcmFuc2FjdGlvbnMocmVwbywgbm9kZSA9IHJlcG8udHJhbnNhY3Rpb25RdWV1ZVRyZWVfKSB7DQogICAgLy8gQmVmb3JlIHJlY3Vyc2luZywgbWFrZSBzdXJlIGFueSBjb21wbGV0ZWQgdHJhbnNhY3Rpb25zIGFyZSByZW1vdmVkLg0KICAgIGlmICghbm9kZSkgew0KICAgICAgICByZXBvUHJ1bmVDb21wbGV0ZWRUcmFuc2FjdGlvbnNCZWxvd05vZGUocmVwbywgbm9kZSk7DQogICAgfQ0KICAgIGlmICh0cmVlR2V0VmFsdWUobm9kZSkpIHsNCiAgICAgICAgY29uc3QgcXVldWUgPSByZXBvQnVpbGRUcmFuc2FjdGlvblF1ZXVlKHJlcG8sIG5vZGUpOw0KICAgICAgICBhc3NlcnQocXVldWUubGVuZ3RoID4gMCwgJ1NlbmRpbmcgemVybyBsZW5ndGggdHJhbnNhY3Rpb24gcXVldWUnKTsNCiAgICAgICAgY29uc3QgYWxsUnVuID0gcXVldWUuZXZlcnkoKHRyYW5zYWN0aW9uKSA9PiB0cmFuc2FjdGlvbi5zdGF0dXMgPT09IDAgLyogVHJhbnNhY3Rpb25TdGF0dXMuUlVOICovKTsNCiAgICAgICAgLy8gSWYgdGhleSdyZSBhbGwgcnVuIChhbmQgbm90IHNlbnQpLCB3ZSBjYW4gc2VuZCB0aGVtLiAgRWxzZSwgd2UgbXVzdCB3YWl0Lg0KICAgICAgICBpZiAoYWxsUnVuKSB7DQogICAgICAgICAgICByZXBvU2VuZFRyYW5zYWN0aW9uUXVldWUocmVwbywgdHJlZUdldFBhdGgobm9kZSksIHF1ZXVlKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBlbHNlIGlmICh0cmVlSGFzQ2hpbGRyZW4obm9kZSkpIHsNCiAgICAgICAgdHJlZUZvckVhY2hDaGlsZChub2RlLCBjaGlsZE5vZGUgPT4gew0KICAgICAgICAgICAgcmVwb1NlbmRSZWFkeVRyYW5zYWN0aW9ucyhyZXBvLCBjaGlsZE5vZGUpOw0KICAgICAgICB9KTsNCiAgICB9DQp9DQovKioNCiAqIEdpdmVuIGEgbGlzdCBvZiBydW4gdHJhbnNhY3Rpb25zLCBzZW5kIHRoZW0gdG8gdGhlIHNlcnZlciBhbmQgdGhlbiBoYW5kbGUNCiAqIHRoZSByZXN1bHQgKHN1Y2Nlc3Mgb3IgZmFpbHVyZSkuDQogKg0KICogQHBhcmFtIHBhdGggLSBUaGUgbG9jYXRpb24gb2YgdGhlIHF1ZXVlLg0KICogQHBhcmFtIHF1ZXVlIC0gUXVldWUgb2YgdHJhbnNhY3Rpb25zIHVuZGVyIHRoZSBzcGVjaWZpZWQgbG9jYXRpb24uDQogKi8NCmZ1bmN0aW9uIHJlcG9TZW5kVHJhbnNhY3Rpb25RdWV1ZShyZXBvLCBwYXRoLCBxdWV1ZSkgew0KICAgIC8vIE1hcmsgdHJhbnNhY3Rpb25zIGFzIHNlbnQgYW5kIGluY3JlbWVudCByZXRyeSBjb3VudCENCiAgICBjb25zdCBzZXRzVG9JZ25vcmUgPSBxdWV1ZS5tYXAodHhuID0+IHsNCiAgICAgICAgcmV0dXJuIHR4bi5jdXJyZW50V3JpdGVJZDsNCiAgICB9KTsNCiAgICBjb25zdCBsYXRlc3RTdGF0ZSA9IHJlcG9HZXRMYXRlc3RTdGF0ZShyZXBvLCBwYXRoLCBzZXRzVG9JZ25vcmUpOw0KICAgIGxldCBzbmFwVG9TZW5kID0gbGF0ZXN0U3RhdGU7DQogICAgY29uc3QgbGF0ZXN0SGFzaCA9IGxhdGVzdFN0YXRlLmhhc2goKTsNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHF1ZXVlLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGNvbnN0IHR4biA9IHF1ZXVlW2ldOw0KICAgICAgICBhc3NlcnQodHhuLnN0YXR1cyA9PT0gMCAvKiBUcmFuc2FjdGlvblN0YXR1cy5SVU4gKi8sICd0cnlUb1NlbmRUcmFuc2FjdGlvblF1ZXVlXzogaXRlbXMgaW4gcXVldWUgc2hvdWxkIGFsbCBiZSBydW4uJyk7DQogICAgICAgIHR4bi5zdGF0dXMgPSAxIC8qIFRyYW5zYWN0aW9uU3RhdHVzLlNFTlQgKi87DQogICAgICAgIHR4bi5yZXRyeUNvdW50Kys7DQogICAgICAgIGNvbnN0IHJlbGF0aXZlUGF0aCA9IG5ld1JlbGF0aXZlUGF0aChwYXRoLCB0eG4ucGF0aCk7DQogICAgICAgIC8vIElmIHdlJ3ZlIGdvdHRlbiB0byB0aGlzIHBvaW50LCB0aGUgb3V0cHV0IHNuYXBzaG90IG11c3QgYmUgZGVmaW5lZC4NCiAgICAgICAgc25hcFRvU2VuZCA9IHNuYXBUb1NlbmQudXBkYXRlQ2hpbGQocmVsYXRpdmVQYXRoIC8qKiBAdHlwZSB7IU5vZGV9ICovLCB0eG4uY3VycmVudE91dHB1dFNuYXBzaG90UmF3KTsNCiAgICB9DQogICAgY29uc3QgZGF0YVRvU2VuZCA9IHNuYXBUb1NlbmQudmFsKHRydWUpOw0KICAgIGNvbnN0IHBhdGhUb1NlbmQgPSBwYXRoOw0KICAgIC8vIFNlbmQgdGhlIHB1dC4NCiAgICByZXBvLnNlcnZlcl8ucHV0KHBhdGhUb1NlbmQudG9TdHJpbmcoKSwgZGF0YVRvU2VuZCwgKHN0YXR1cykgPT4gew0KICAgICAgICByZXBvTG9nKHJlcG8sICd0cmFuc2FjdGlvbiBwdXQgcmVzcG9uc2UnLCB7DQogICAgICAgICAgICBwYXRoOiBwYXRoVG9TZW5kLnRvU3RyaW5nKCksDQogICAgICAgICAgICBzdGF0dXMNCiAgICAgICAgfSk7DQogICAgICAgIGxldCBldmVudHMgPSBbXTsNCiAgICAgICAgaWYgKHN0YXR1cyA9PT0gJ29rJykgew0KICAgICAgICAgICAgLy8gUXVldWUgdXAgdGhlIGNhbGxiYWNrcyBhbmQgZmlyZSB0aGVtIGFmdGVyIGNsZWFuaW5nIHVwIGFsbCBvZiBvdXINCiAgICAgICAgICAgIC8vIHRyYW5zYWN0aW9uIHN0YXRlLCBzaW5jZSB0aGUgY2FsbGJhY2sgY291bGQgdHJpZ2dlciBtb3JlDQogICAgICAgICAgICAvLyB0cmFuc2FjdGlvbnMgb3Igc2V0cy4NCiAgICAgICAgICAgIGNvbnN0IGNhbGxiYWNrcyA9IFtdOw0KICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBxdWV1ZS5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIHF1ZXVlW2ldLnN0YXR1cyA9IDIgLyogVHJhbnNhY3Rpb25TdGF0dXMuQ09NUExFVEVEICovOw0KICAgICAgICAgICAgICAgIGV2ZW50cyA9IGV2ZW50cy5jb25jYXQoc3luY1RyZWVBY2tVc2VyV3JpdGUocmVwby5zZXJ2ZXJTeW5jVHJlZV8sIHF1ZXVlW2ldLmN1cnJlbnRXcml0ZUlkKSk7DQogICAgICAgICAgICAgICAgaWYgKHF1ZXVlW2ldLm9uQ29tcGxldGUpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gV2UgbmV2ZXIgdW5zZXQgdGhlIG91dHB1dCBzbmFwc2hvdCwgYW5kIGdpdmVuIHRoYXQgdGhpcw0KICAgICAgICAgICAgICAgICAgICAvLyB0cmFuc2FjdGlvbiBpcyBjb21wbGV0ZSwgaXQgc2hvdWxkIGJlIHNldA0KICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3MucHVzaCgoKSA9PiBxdWV1ZVtpXS5vbkNvbXBsZXRlKG51bGwsIHRydWUsIHF1ZXVlW2ldLmN1cnJlbnRPdXRwdXRTbmFwc2hvdFJlc29sdmVkKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHF1ZXVlW2ldLnVud2F0Y2hlcigpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLy8gTm93IHJlbW92ZSB0aGUgY29tcGxldGVkIHRyYW5zYWN0aW9ucy4NCiAgICAgICAgICAgIHJlcG9QcnVuZUNvbXBsZXRlZFRyYW5zYWN0aW9uc0JlbG93Tm9kZShyZXBvLCB0cmVlU3ViVHJlZShyZXBvLnRyYW5zYWN0aW9uUXVldWVUcmVlXywgcGF0aCkpOw0KICAgICAgICAgICAgLy8gVGhlcmUgbWF5IGJlIHBlbmRpbmcgdHJhbnNhY3Rpb25zIHRoYXQgd2UgY2FuIG5vdyBzZW5kLg0KICAgICAgICAgICAgcmVwb1NlbmRSZWFkeVRyYW5zYWN0aW9ucyhyZXBvLCByZXBvLnRyYW5zYWN0aW9uUXVldWVUcmVlXyk7DQogICAgICAgICAgICBldmVudFF1ZXVlUmFpc2VFdmVudHNGb3JDaGFuZ2VkUGF0aChyZXBvLmV2ZW50UXVldWVfLCBwYXRoLCBldmVudHMpOw0KICAgICAgICAgICAgLy8gRmluYWxseSwgdHJpZ2dlciBvbkNvbXBsZXRlIGNhbGxiYWNrcy4NCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2FsbGJhY2tzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgZXhjZXB0aW9uR3VhcmQoY2FsbGJhY2tzW2ldKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIC8vIHRyYW5zYWN0aW9ucyBhcmUgbm8gbG9uZ2VyIHNlbnQuICBVcGRhdGUgdGhlaXIgc3RhdHVzIGFwcHJvcHJpYXRlbHkuDQogICAgICAgICAgICBpZiAoc3RhdHVzID09PSAnZGF0YXN0YWxlJykgew0KICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcXVldWUubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHF1ZXVlW2ldLnN0YXR1cyA9PT0gMyAvKiBUcmFuc2FjdGlvblN0YXR1cy5TRU5UX05FRURTX0FCT1JUICovKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBxdWV1ZVtpXS5zdGF0dXMgPSA0IC8qIFRyYW5zYWN0aW9uU3RhdHVzLk5FRURTX0FCT1JUICovOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgcXVldWVbaV0uc3RhdHVzID0gMCAvKiBUcmFuc2FjdGlvblN0YXR1cy5SVU4gKi87DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICB3YXJuKCd0cmFuc2FjdGlvbiBhdCAnICsgcGF0aFRvU2VuZC50b1N0cmluZygpICsgJyBmYWlsZWQ6ICcgKyBzdGF0dXMpOw0KICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcXVldWUubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgcXVldWVbaV0uc3RhdHVzID0gNCAvKiBUcmFuc2FjdGlvblN0YXR1cy5ORUVEU19BQk9SVCAqLzsNCiAgICAgICAgICAgICAgICAgICAgcXVldWVbaV0uYWJvcnRSZWFzb24gPSBzdGF0dXM7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmVwb1JlcnVuVHJhbnNhY3Rpb25zKHJlcG8sIHBhdGgpOw0KICAgICAgICB9DQogICAgfSwgbGF0ZXN0SGFzaCk7DQp9DQovKioNCiAqIEZpbmRzIGFsbCB0cmFuc2FjdGlvbnMgZGVwZW5kZW50IG9uIHRoZSBkYXRhIGF0IGNoYW5nZWRQYXRoIGFuZCByZXJ1bnMgdGhlbS4NCiAqDQogKiBTaG91bGQgYmUgY2FsbGVkIGFueSB0aW1lIGNhY2hlZCBkYXRhIGNoYW5nZXMuDQogKg0KICogUmV0dXJuIHRoZSBoaWdoZXN0IHBhdGggdGhhdCB3YXMgYWZmZWN0ZWQgYnkgcmVydW5uaW5nIHRyYW5zYWN0aW9ucy4gVGhpcw0KICogaXMgdGhlIHBhdGggYXQgd2hpY2ggZXZlbnRzIG5lZWQgdG8gYmUgcmFpc2VkIGZvci4NCiAqDQogKiBAcGFyYW0gY2hhbmdlZFBhdGggLSBUaGUgcGF0aCBpbiBtZXJnZWREYXRhIHRoYXQgY2hhbmdlZC4NCiAqIEByZXR1cm5zIFRoZSByb290bW9zdCBwYXRoIHRoYXQgd2FzIGFmZmVjdGVkIGJ5IHJlcnVubmluZyB0cmFuc2FjdGlvbnMuDQogKi8NCmZ1bmN0aW9uIHJlcG9SZXJ1blRyYW5zYWN0aW9ucyhyZXBvLCBjaGFuZ2VkUGF0aCkgew0KICAgIGNvbnN0IHJvb3RNb3N0VHJhbnNhY3Rpb25Ob2RlID0gcmVwb0dldEFuY2VzdG9yVHJhbnNhY3Rpb25Ob2RlKHJlcG8sIGNoYW5nZWRQYXRoKTsNCiAgICBjb25zdCBwYXRoID0gdHJlZUdldFBhdGgocm9vdE1vc3RUcmFuc2FjdGlvbk5vZGUpOw0KICAgIGNvbnN0IHF1ZXVlID0gcmVwb0J1aWxkVHJhbnNhY3Rpb25RdWV1ZShyZXBvLCByb290TW9zdFRyYW5zYWN0aW9uTm9kZSk7DQogICAgcmVwb1JlcnVuVHJhbnNhY3Rpb25RdWV1ZShyZXBvLCBxdWV1ZSwgcGF0aCk7DQogICAgcmV0dXJuIHBhdGg7DQp9DQovKioNCiAqIERvZXMgYWxsIHRoZSB3b3JrIG9mIHJlcnVubmluZyB0cmFuc2FjdGlvbnMgKGFzIHdlbGwgYXMgY2xlYW5zIHVwIGFib3J0ZWQNCiAqIHRyYW5zYWN0aW9ucyBhbmQgd2hhdG5vdCkuDQogKg0KICogQHBhcmFtIHF1ZXVlIC0gVGhlIHF1ZXVlIG9mIHRyYW5zYWN0aW9ucyB0byBydW4uDQogKiBAcGFyYW0gcGF0aCAtIFRoZSBwYXRoIHRoZSBxdWV1ZSBpcyBmb3IuDQogKi8NCmZ1bmN0aW9uIHJlcG9SZXJ1blRyYW5zYWN0aW9uUXVldWUocmVwbywgcXVldWUsIHBhdGgpIHsNCiAgICBpZiAocXVldWUubGVuZ3RoID09PSAwKSB7DQogICAgICAgIHJldHVybjsgLy8gTm90aGluZyB0byBkbyENCiAgICB9DQogICAgLy8gUXVldWUgdXAgdGhlIGNhbGxiYWNrcyBhbmQgZmlyZSB0aGVtIGFmdGVyIGNsZWFuaW5nIHVwIGFsbCBvZiBvdXINCiAgICAvLyB0cmFuc2FjdGlvbiBzdGF0ZSwgc2luY2UgdGhlIGNhbGxiYWNrIGNvdWxkIHRyaWdnZXIgbW9yZSB0cmFuc2FjdGlvbnMgb3INCiAgICAvLyBzZXRzLg0KICAgIGNvbnN0IGNhbGxiYWNrcyA9IFtdOw0KICAgIGxldCBldmVudHMgPSBbXTsNCiAgICAvLyBJZ25vcmUgYWxsIG9mIHRoZSBzZXRzIHdlJ3JlIGdvaW5nIHRvIHJlLXJ1bi4NCiAgICBjb25zdCB0eG5zVG9SZXJ1biA9IHF1ZXVlLmZpbHRlcihxID0+IHsNCiAgICAgICAgcmV0dXJuIHEuc3RhdHVzID09PSAwIC8qIFRyYW5zYWN0aW9uU3RhdHVzLlJVTiAqLzsNCiAgICB9KTsNCiAgICBjb25zdCBzZXRzVG9JZ25vcmUgPSB0eG5zVG9SZXJ1bi5tYXAocSA9PiB7DQogICAgICAgIHJldHVybiBxLmN1cnJlbnRXcml0ZUlkOw0KICAgIH0pOw0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcXVldWUubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBxdWV1ZVtpXTsNCiAgICAgICAgY29uc3QgcmVsYXRpdmVQYXRoID0gbmV3UmVsYXRpdmVQYXRoKHBhdGgsIHRyYW5zYWN0aW9uLnBhdGgpOw0KICAgICAgICBsZXQgYWJvcnRUcmFuc2FjdGlvbiA9IGZhbHNlLCBhYm9ydFJlYXNvbjsNCiAgICAgICAgYXNzZXJ0KHJlbGF0aXZlUGF0aCAhPT0gbnVsbCwgJ3JlcnVuVHJhbnNhY3Rpb25zVW5kZXJOb2RlXzogcmVsYXRpdmVQYXRoIHNob3VsZCBub3QgYmUgbnVsbC4nKTsNCiAgICAgICAgaWYgKHRyYW5zYWN0aW9uLnN0YXR1cyA9PT0gNCAvKiBUcmFuc2FjdGlvblN0YXR1cy5ORUVEU19BQk9SVCAqLykgew0KICAgICAgICAgICAgYWJvcnRUcmFuc2FjdGlvbiA9IHRydWU7DQogICAgICAgICAgICBhYm9ydFJlYXNvbiA9IHRyYW5zYWN0aW9uLmFib3J0UmVhc29uOw0KICAgICAgICAgICAgZXZlbnRzID0gZXZlbnRzLmNvbmNhdChzeW5jVHJlZUFja1VzZXJXcml0ZShyZXBvLnNlcnZlclN5bmNUcmVlXywgdHJhbnNhY3Rpb24uY3VycmVudFdyaXRlSWQsIHRydWUpKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmICh0cmFuc2FjdGlvbi5zdGF0dXMgPT09IDAgLyogVHJhbnNhY3Rpb25TdGF0dXMuUlVOICovKSB7DQogICAgICAgICAgICBpZiAodHJhbnNhY3Rpb24ucmV0cnlDb3VudCA+PSBNQVhfVFJBTlNBQ1RJT05fUkVUUklFUykgew0KICAgICAgICAgICAgICAgIGFib3J0VHJhbnNhY3Rpb24gPSB0cnVlOw0KICAgICAgICAgICAgICAgIGFib3J0UmVhc29uID0gJ21heHJldHJ5JzsNCiAgICAgICAgICAgICAgICBldmVudHMgPSBldmVudHMuY29uY2F0KHN5bmNUcmVlQWNrVXNlcldyaXRlKHJlcG8uc2VydmVyU3luY1RyZWVfLCB0cmFuc2FjdGlvbi5jdXJyZW50V3JpdGVJZCwgdHJ1ZSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gVGhpcyBjb2RlIHJlcnVucyBhIHRyYW5zYWN0aW9uDQogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudE5vZGUgPSByZXBvR2V0TGF0ZXN0U3RhdGUocmVwbywgdHJhbnNhY3Rpb24ucGF0aCwgc2V0c1RvSWdub3JlKTsNCiAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbi5jdXJyZW50SW5wdXRTbmFwc2hvdCA9IGN1cnJlbnROb2RlOw0KICAgICAgICAgICAgICAgIGNvbnN0IG5ld0RhdGEgPSBxdWV1ZVtpXS51cGRhdGUoY3VycmVudE5vZGUudmFsKCkpOw0KICAgICAgICAgICAgICAgIGlmIChuZXdEYXRhICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGVGaXJlYmFzZURhdGEoJ3RyYW5zYWN0aW9uIGZhaWxlZDogRGF0YSByZXR1cm5lZCAnLCBuZXdEYXRhLCB0cmFuc2FjdGlvbi5wYXRoKTsNCiAgICAgICAgICAgICAgICAgICAgbGV0IG5ld0RhdGFOb2RlID0gbm9kZUZyb21KU09OKG5ld0RhdGEpOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBoYXNFeHBsaWNpdFByaW9yaXR5ID0gdHlwZW9mIG5ld0RhdGEgPT09ICdvYmplY3QnICYmDQogICAgICAgICAgICAgICAgICAgICAgICBuZXdEYXRhICE9IG51bGwgJiYNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5zKG5ld0RhdGEsICcucHJpb3JpdHknKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCFoYXNFeHBsaWNpdFByaW9yaXR5KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBLZWVwIHRoZSBvbGQgcHJpb3JpdHkgaWYgdGhlcmUgd2Fzbid0IGEgcHJpb3JpdHkgZXhwbGljaXRseSBzcGVjaWZpZWQuDQogICAgICAgICAgICAgICAgICAgICAgICBuZXdEYXRhTm9kZSA9IG5ld0RhdGFOb2RlLnVwZGF0ZVByaW9yaXR5KGN1cnJlbnROb2RlLmdldFByaW9yaXR5KCkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9sZFdyaXRlSWQgPSB0cmFuc2FjdGlvbi5jdXJyZW50V3JpdGVJZDsNCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VydmVyVmFsdWVzID0gcmVwb0dlbmVyYXRlU2VydmVyVmFsdWVzKHJlcG8pOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdOb2RlUmVzb2x2ZWQgPSByZXNvbHZlRGVmZXJyZWRWYWx1ZVNuYXBzaG90KG5ld0RhdGFOb2RlLCBjdXJyZW50Tm9kZSwgc2VydmVyVmFsdWVzKTsNCiAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24uY3VycmVudE91dHB1dFNuYXBzaG90UmF3ID0gbmV3RGF0YU5vZGU7DQogICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uLmN1cnJlbnRPdXRwdXRTbmFwc2hvdFJlc29sdmVkID0gbmV3Tm9kZVJlc29sdmVkOw0KICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbi5jdXJyZW50V3JpdGVJZCA9IHJlcG9HZXROZXh0V3JpdGVJZChyZXBvKTsNCiAgICAgICAgICAgICAgICAgICAgLy8gTXV0YXRlcyBzZXRzVG9JZ25vcmUgaW4gcGxhY2UNCiAgICAgICAgICAgICAgICAgICAgc2V0c1RvSWdub3JlLnNwbGljZShzZXRzVG9JZ25vcmUuaW5kZXhPZihvbGRXcml0ZUlkKSwgMSk7DQogICAgICAgICAgICAgICAgICAgIGV2ZW50cyA9IGV2ZW50cy5jb25jYXQoc3luY1RyZWVBcHBseVVzZXJPdmVyd3JpdGUocmVwby5zZXJ2ZXJTeW5jVHJlZV8sIHRyYW5zYWN0aW9uLnBhdGgsIG5ld05vZGVSZXNvbHZlZCwgdHJhbnNhY3Rpb24uY3VycmVudFdyaXRlSWQsIHRyYW5zYWN0aW9uLmFwcGx5TG9jYWxseSkpOw0KICAgICAgICAgICAgICAgICAgICBldmVudHMgPSBldmVudHMuY29uY2F0KHN5bmNUcmVlQWNrVXNlcldyaXRlKHJlcG8uc2VydmVyU3luY1RyZWVfLCBvbGRXcml0ZUlkLCB0cnVlKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBhYm9ydFRyYW5zYWN0aW9uID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgYWJvcnRSZWFzb24gPSAnbm9kYXRhJzsNCiAgICAgICAgICAgICAgICAgICAgZXZlbnRzID0gZXZlbnRzLmNvbmNhdChzeW5jVHJlZUFja1VzZXJXcml0ZShyZXBvLnNlcnZlclN5bmNUcmVlXywgdHJhbnNhY3Rpb24uY3VycmVudFdyaXRlSWQsIHRydWUpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZXZlbnRRdWV1ZVJhaXNlRXZlbnRzRm9yQ2hhbmdlZFBhdGgocmVwby5ldmVudFF1ZXVlXywgcGF0aCwgZXZlbnRzKTsNCiAgICAgICAgZXZlbnRzID0gW107DQogICAgICAgIGlmIChhYm9ydFRyYW5zYWN0aW9uKSB7DQogICAgICAgICAgICAvLyBBYm9ydC4NCiAgICAgICAgICAgIHF1ZXVlW2ldLnN0YXR1cyA9IDIgLyogVHJhbnNhY3Rpb25TdGF0dXMuQ09NUExFVEVEICovOw0KICAgICAgICAgICAgLy8gUmVtb3ZpbmcgYSBsaXN0ZW5lciBjYW4gdHJpZ2dlciBwcnVuaW5nIHdoaWNoIGNhbiBtdWNrIHdpdGgNCiAgICAgICAgICAgIC8vIG1lcmdlZERhdGEvdmlzaWJsZURhdGEgKGFzIGl0IHBydW5lcyBkYXRhKS4gU28gZGVmZXIgdGhlIHVud2F0Y2hlcg0KICAgICAgICAgICAgLy8gdW50aWwgd2UncmUgZG9uZS4NCiAgICAgICAgICAgIChmdW5jdGlvbiAodW53YXRjaGVyKSB7DQogICAgICAgICAgICAgICAgc2V0VGltZW91dCh1bndhdGNoZXIsIE1hdGguZmxvb3IoMCkpOw0KICAgICAgICAgICAgfSkocXVldWVbaV0udW53YXRjaGVyKTsNCiAgICAgICAgICAgIGlmIChxdWV1ZVtpXS5vbkNvbXBsZXRlKSB7DQogICAgICAgICAgICAgICAgaWYgKGFib3J0UmVhc29uID09PSAnbm9kYXRhJykgew0KICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3MucHVzaCgoKSA9PiBxdWV1ZVtpXS5vbkNvbXBsZXRlKG51bGwsIGZhbHNlLCBxdWV1ZVtpXS5jdXJyZW50SW5wdXRTbmFwc2hvdCkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzLnB1c2goKCkgPT4gcXVldWVbaV0ub25Db21wbGV0ZShuZXcgRXJyb3IoYWJvcnRSZWFzb24pLCBmYWxzZSwgbnVsbCkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICAvLyBDbGVhbiB1cCBjb21wbGV0ZWQgdHJhbnNhY3Rpb25zLg0KICAgIHJlcG9QcnVuZUNvbXBsZXRlZFRyYW5zYWN0aW9uc0JlbG93Tm9kZShyZXBvLCByZXBvLnRyYW5zYWN0aW9uUXVldWVUcmVlXyk7DQogICAgLy8gTm93IGZpcmUgY2FsbGJhY2tzLCBub3cgdGhhdCB3ZSdyZSBpbiBhIGdvb2QsIGtub3duIHN0YXRlLg0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2FsbGJhY2tzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGV4Y2VwdGlvbkd1YXJkKGNhbGxiYWNrc1tpXSk7DQogICAgfQ0KICAgIC8vIFRyeSB0byBzZW5kIHRoZSB0cmFuc2FjdGlvbiByZXN1bHQgdG8gdGhlIHNlcnZlci4NCiAgICByZXBvU2VuZFJlYWR5VHJhbnNhY3Rpb25zKHJlcG8sIHJlcG8udHJhbnNhY3Rpb25RdWV1ZVRyZWVfKTsNCn0NCi8qKg0KICogUmV0dXJucyB0aGUgcm9vdG1vc3QgYW5jZXN0b3Igbm9kZSBvZiB0aGUgc3BlY2lmaWVkIHBhdGggdGhhdCBoYXMgYSBwZW5kaW5nDQogKiB0cmFuc2FjdGlvbiBvbiBpdCwgb3IganVzdCByZXR1cm5zIHRoZSBub2RlIGZvciB0aGUgZ2l2ZW4gcGF0aCBpZiB0aGVyZSBhcmUNCiAqIG5vIHBlbmRpbmcgdHJhbnNhY3Rpb25zIG9uIGFueSBhbmNlc3Rvci4NCiAqDQogKiBAcGFyYW0gcGF0aCAtIFRoZSBsb2NhdGlvbiB0byBzdGFydCBhdC4NCiAqIEByZXR1cm5zIFRoZSByb290bW9zdCBub2RlIHdpdGggYSB0cmFuc2FjdGlvbi4NCiAqLw0KZnVuY3Rpb24gcmVwb0dldEFuY2VzdG9yVHJhbnNhY3Rpb25Ob2RlKHJlcG8sIHBhdGgpIHsNCiAgICBsZXQgZnJvbnQ7DQogICAgLy8gU3RhcnQgYXQgdGhlIHJvb3QgYW5kIHdhbGsgZGVlcGVyIGludG8gdGhlIHRyZWUgdG93YXJkcyBwYXRoIHVudGlsIHdlDQogICAgLy8gZmluZCBhIG5vZGUgd2l0aCBwZW5kaW5nIHRyYW5zYWN0aW9ucy4NCiAgICBsZXQgdHJhbnNhY3Rpb25Ob2RlID0gcmVwby50cmFuc2FjdGlvblF1ZXVlVHJlZV87DQogICAgZnJvbnQgPSBwYXRoR2V0RnJvbnQocGF0aCk7DQogICAgd2hpbGUgKGZyb250ICE9PSBudWxsICYmIHRyZWVHZXRWYWx1ZSh0cmFuc2FjdGlvbk5vZGUpID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgdHJhbnNhY3Rpb25Ob2RlID0gdHJlZVN1YlRyZWUodHJhbnNhY3Rpb25Ob2RlLCBmcm9udCk7DQogICAgICAgIHBhdGggPSBwYXRoUG9wRnJvbnQocGF0aCk7DQogICAgICAgIGZyb250ID0gcGF0aEdldEZyb250KHBhdGgpOw0KICAgIH0NCiAgICByZXR1cm4gdHJhbnNhY3Rpb25Ob2RlOw0KfQ0KLyoqDQogKiBCdWlsZHMgdGhlIHF1ZXVlIG9mIGFsbCB0cmFuc2FjdGlvbnMgYXQgb3IgYmVsb3cgdGhlIHNwZWNpZmllZA0KICogdHJhbnNhY3Rpb25Ob2RlLg0KICoNCiAqIEBwYXJhbSB0cmFuc2FjdGlvbk5vZGUNCiAqIEByZXR1cm5zIFRoZSBnZW5lcmF0ZWQgcXVldWUuDQogKi8NCmZ1bmN0aW9uIHJlcG9CdWlsZFRyYW5zYWN0aW9uUXVldWUocmVwbywgdHJhbnNhY3Rpb25Ob2RlKSB7DQogICAgLy8gV2FsayBhbnkgY2hpbGQgdHJhbnNhY3Rpb24gcXVldWVzIGFuZCBhZ2dyZWdhdGUgdGhlbSBpbnRvIGEgc2luZ2xlIHF1ZXVlLg0KICAgIGNvbnN0IHRyYW5zYWN0aW9uUXVldWUgPSBbXTsNCiAgICByZXBvQWdncmVnYXRlVHJhbnNhY3Rpb25RdWV1ZXNGb3JOb2RlKHJlcG8sIHRyYW5zYWN0aW9uTm9kZSwgdHJhbnNhY3Rpb25RdWV1ZSk7DQogICAgLy8gU29ydCB0aGVtIGJ5IHRoZSBvcmRlciB0aGUgdHJhbnNhY3Rpb25zIHdlcmUgY3JlYXRlZC4NCiAgICB0cmFuc2FjdGlvblF1ZXVlLnNvcnQoKGEsIGIpID0+IGEub3JkZXIgLSBiLm9yZGVyKTsNCiAgICByZXR1cm4gdHJhbnNhY3Rpb25RdWV1ZTsNCn0NCmZ1bmN0aW9uIHJlcG9BZ2dyZWdhdGVUcmFuc2FjdGlvblF1ZXVlc0Zvck5vZGUocmVwbywgbm9kZSwgcXVldWUpIHsNCiAgICBjb25zdCBub2RlUXVldWUgPSB0cmVlR2V0VmFsdWUobm9kZSk7DQogICAgaWYgKG5vZGVRdWV1ZSkgew0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5vZGVRdWV1ZS5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgcXVldWUucHVzaChub2RlUXVldWVbaV0pOw0KICAgICAgICB9DQogICAgfQ0KICAgIHRyZWVGb3JFYWNoQ2hpbGQobm9kZSwgY2hpbGQgPT4gew0KICAgICAgICByZXBvQWdncmVnYXRlVHJhbnNhY3Rpb25RdWV1ZXNGb3JOb2RlKHJlcG8sIGNoaWxkLCBxdWV1ZSk7DQogICAgfSk7DQp9DQovKioNCiAqIFJlbW92ZSBDT01QTEVURUQgdHJhbnNhY3Rpb25zIGF0IG9yIGJlbG93IHRoaXMgbm9kZSBpbiB0aGUgdHJhbnNhY3Rpb25RdWV1ZVRyZWVfLg0KICovDQpmdW5jdGlvbiByZXBvUHJ1bmVDb21wbGV0ZWRUcmFuc2FjdGlvbnNCZWxvd05vZGUocmVwbywgbm9kZSkgew0KICAgIGNvbnN0IHF1ZXVlID0gdHJlZUdldFZhbHVlKG5vZGUpOw0KICAgIGlmIChxdWV1ZSkgew0KICAgICAgICBsZXQgdG8gPSAwOw0KICAgICAgICBmb3IgKGxldCBmcm9tID0gMDsgZnJvbSA8IHF1ZXVlLmxlbmd0aDsgZnJvbSsrKSB7DQogICAgICAgICAgICBpZiAocXVldWVbZnJvbV0uc3RhdHVzICE9PSAyIC8qIFRyYW5zYWN0aW9uU3RhdHVzLkNPTVBMRVRFRCAqLykgew0KICAgICAgICAgICAgICAgIHF1ZXVlW3RvXSA9IHF1ZXVlW2Zyb21dOw0KICAgICAgICAgICAgICAgIHRvKys7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcXVldWUubGVuZ3RoID0gdG87DQogICAgICAgIHRyZWVTZXRWYWx1ZShub2RlLCBxdWV1ZS5sZW5ndGggPiAwID8gcXVldWUgOiB1bmRlZmluZWQpOw0KICAgIH0NCiAgICB0cmVlRm9yRWFjaENoaWxkKG5vZGUsIGNoaWxkTm9kZSA9PiB7DQogICAgICAgIHJlcG9QcnVuZUNvbXBsZXRlZFRyYW5zYWN0aW9uc0JlbG93Tm9kZShyZXBvLCBjaGlsZE5vZGUpOw0KICAgIH0pOw0KfQ0KLyoqDQogKiBBYm9ydHMgYWxsIHRyYW5zYWN0aW9ucyBvbiBhbmNlc3RvcnMgb3IgZGVzY2VuZGFudHMgb2YgdGhlIHNwZWNpZmllZCBwYXRoLg0KICogQ2FsbGVkIHdoZW4gZG9pbmcgYSBzZXQoKSBvciB1cGRhdGUoKSBzaW5jZSB3ZSBjb25zaWRlciB0aGVtIGluY29tcGF0aWJsZQ0KICogd2l0aCB0cmFuc2FjdGlvbnMuDQogKg0KICogQHBhcmFtIHBhdGggLSBQYXRoIGZvciB3aGljaCB3ZSB3YW50IHRvIGFib3J0IHJlbGF0ZWQgdHJhbnNhY3Rpb25zLg0KICovDQpmdW5jdGlvbiByZXBvQWJvcnRUcmFuc2FjdGlvbnMocmVwbywgcGF0aCkgew0KICAgIGNvbnN0IGFmZmVjdGVkUGF0aCA9IHRyZWVHZXRQYXRoKHJlcG9HZXRBbmNlc3RvclRyYW5zYWN0aW9uTm9kZShyZXBvLCBwYXRoKSk7DQogICAgY29uc3QgdHJhbnNhY3Rpb25Ob2RlID0gdHJlZVN1YlRyZWUocmVwby50cmFuc2FjdGlvblF1ZXVlVHJlZV8sIHBhdGgpOw0KICAgIHRyZWVGb3JFYWNoQW5jZXN0b3IodHJhbnNhY3Rpb25Ob2RlLCAobm9kZSkgPT4gew0KICAgICAgICByZXBvQWJvcnRUcmFuc2FjdGlvbnNPbk5vZGUocmVwbywgbm9kZSk7DQogICAgfSk7DQogICAgcmVwb0Fib3J0VHJhbnNhY3Rpb25zT25Ob2RlKHJlcG8sIHRyYW5zYWN0aW9uTm9kZSk7DQogICAgdHJlZUZvckVhY2hEZXNjZW5kYW50KHRyYW5zYWN0aW9uTm9kZSwgKG5vZGUpID0+IHsNCiAgICAgICAgcmVwb0Fib3J0VHJhbnNhY3Rpb25zT25Ob2RlKHJlcG8sIG5vZGUpOw0KICAgIH0pOw0KICAgIHJldHVybiBhZmZlY3RlZFBhdGg7DQp9DQovKioNCiAqIEFib3J0IHRyYW5zYWN0aW9ucyBzdG9yZWQgaW4gdGhpcyB0cmFuc2FjdGlvbiBxdWV1ZSBub2RlLg0KICoNCiAqIEBwYXJhbSBub2RlIC0gTm9kZSB0byBhYm9ydCB0cmFuc2FjdGlvbnMgZm9yLg0KICovDQpmdW5jdGlvbiByZXBvQWJvcnRUcmFuc2FjdGlvbnNPbk5vZGUocmVwbywgbm9kZSkgew0KICAgIGNvbnN0IHF1ZXVlID0gdHJlZUdldFZhbHVlKG5vZGUpOw0KICAgIGlmIChxdWV1ZSkgew0KICAgICAgICAvLyBRdWV1ZSB1cCB0aGUgY2FsbGJhY2tzIGFuZCBmaXJlIHRoZW0gYWZ0ZXIgY2xlYW5pbmcgdXAgYWxsIG9mIG91cg0KICAgICAgICAvLyB0cmFuc2FjdGlvbiBzdGF0ZSwgc2luY2UgdGhlIGNhbGxiYWNrIGNvdWxkIHRyaWdnZXIgbW9yZSB0cmFuc2FjdGlvbnMNCiAgICAgICAgLy8gb3Igc2V0cy4NCiAgICAgICAgY29uc3QgY2FsbGJhY2tzID0gW107DQogICAgICAgIC8vIEdvIHRocm91Z2ggcXVldWUuICBBbnkgYWxyZWFkeS1zZW50IHRyYW5zYWN0aW9ucyBtdXN0IGJlIG1hcmtlZCBmb3INCiAgICAgICAgLy8gYWJvcnQsIHdoaWxlIHRoZSB1bnNlbnQgb25lcyBjYW4gYmUgaW1tZWRpYXRlbHkgYWJvcnRlZCBhbmQgcmVtb3ZlZC4NCiAgICAgICAgbGV0IGV2ZW50cyA9IFtdOw0KICAgICAgICBsZXQgbGFzdFNlbnQgPSAtMTsNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBxdWV1ZS5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKHF1ZXVlW2ldLnN0YXR1cyA9PT0gMyAvKiBUcmFuc2FjdGlvblN0YXR1cy5TRU5UX05FRURTX0FCT1JUICovKSA7DQogICAgICAgICAgICBlbHNlIGlmIChxdWV1ZVtpXS5zdGF0dXMgPT09IDEgLyogVHJhbnNhY3Rpb25TdGF0dXMuU0VOVCAqLykgew0KICAgICAgICAgICAgICAgIGFzc2VydChsYXN0U2VudCA9PT0gaSAtIDEsICdBbGwgU0VOVCBpdGVtcyBzaG91bGQgYmUgYXQgYmVnaW5uaW5nIG9mIHF1ZXVlLicpOw0KICAgICAgICAgICAgICAgIGxhc3RTZW50ID0gaTsNCiAgICAgICAgICAgICAgICAvLyBNYXJrIHRyYW5zYWN0aW9uIGZvciBhYm9ydCB3aGVuIGl0IGNvbWVzIGJhY2suDQogICAgICAgICAgICAgICAgcXVldWVbaV0uc3RhdHVzID0gMyAvKiBUcmFuc2FjdGlvblN0YXR1cy5TRU5UX05FRURTX0FCT1JUICovOw0KICAgICAgICAgICAgICAgIHF1ZXVlW2ldLmFib3J0UmVhc29uID0gJ3NldCc7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBhc3NlcnQocXVldWVbaV0uc3RhdHVzID09PSAwIC8qIFRyYW5zYWN0aW9uU3RhdHVzLlJVTiAqLywgJ1VuZXhwZWN0ZWQgdHJhbnNhY3Rpb24gc3RhdHVzIGluIGFib3J0Jyk7DQogICAgICAgICAgICAgICAgLy8gV2UgY2FuIGFib3J0IGl0IGltbWVkaWF0ZWx5Lg0KICAgICAgICAgICAgICAgIHF1ZXVlW2ldLnVud2F0Y2hlcigpOw0KICAgICAgICAgICAgICAgIGV2ZW50cyA9IGV2ZW50cy5jb25jYXQoc3luY1RyZWVBY2tVc2VyV3JpdGUocmVwby5zZXJ2ZXJTeW5jVHJlZV8sIHF1ZXVlW2ldLmN1cnJlbnRXcml0ZUlkLCB0cnVlKSk7DQogICAgICAgICAgICAgICAgaWYgKHF1ZXVlW2ldLm9uQ29tcGxldGUpIHsNCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzLnB1c2gocXVldWVbaV0ub25Db21wbGV0ZS5iaW5kKG51bGwsIG5ldyBFcnJvcignc2V0JyksIGZhbHNlLCBudWxsKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmIChsYXN0U2VudCA9PT0gLTEpIHsNCiAgICAgICAgICAgIC8vIFdlJ3JlIG5vdCB3YWl0aW5nIGZvciBhbnkgc2VudCB0cmFuc2FjdGlvbnMuICBXZSBjYW4gY2xlYXIgdGhlIHF1ZXVlLg0KICAgICAgICAgICAgdHJlZVNldFZhbHVlKG5vZGUsIHVuZGVmaW5lZCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAvLyBSZW1vdmUgdGhlIHRyYW5zYWN0aW9ucyB3ZSBhYm9ydGVkLg0KICAgICAgICAgICAgcXVldWUubGVuZ3RoID0gbGFzdFNlbnQgKyAxOw0KICAgICAgICB9DQogICAgICAgIC8vIE5vdyBmaXJlIHRoZSBjYWxsYmFja3MuDQogICAgICAgIGV2ZW50UXVldWVSYWlzZUV2ZW50c0ZvckNoYW5nZWRQYXRoKHJlcG8uZXZlbnRRdWV1ZV8sIHRyZWVHZXRQYXRoKG5vZGUpLCBldmVudHMpOw0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNhbGxiYWNrcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgZXhjZXB0aW9uR3VhcmQoY2FsbGJhY2tzW2ldKTsNCiAgICAgICAgfQ0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmZ1bmN0aW9uIGRlY29kZVBhdGgocGF0aFN0cmluZykgew0KICAgIGxldCBwYXRoU3RyaW5nRGVjb2RlZCA9ICcnOw0KICAgIGNvbnN0IHBpZWNlcyA9IHBhdGhTdHJpbmcuc3BsaXQoJy8nKTsNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBpZWNlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICBpZiAocGllY2VzW2ldLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIGxldCBwaWVjZSA9IHBpZWNlc1tpXTsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgcGllY2UgPSBkZWNvZGVVUklDb21wb25lbnQocGllY2UucmVwbGFjZSgvXCsvZywgJyAnKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoZSkgeyB9DQogICAgICAgICAgICBwYXRoU3RyaW5nRGVjb2RlZCArPSAnLycgKyBwaWVjZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcGF0aFN0cmluZ0RlY29kZWQ7DQp9DQovKioNCiAqIEByZXR1cm5zIGtleSB2YWx1ZSBoYXNoDQogKi8NCmZ1bmN0aW9uIGRlY29kZVF1ZXJ5KHF1ZXJ5U3RyaW5nKSB7DQogICAgY29uc3QgcmVzdWx0cyA9IHt9Ow0KICAgIGlmIChxdWVyeVN0cmluZy5jaGFyQXQoMCkgPT09ICc/Jykgew0KICAgICAgICBxdWVyeVN0cmluZyA9IHF1ZXJ5U3RyaW5nLnN1YnN0cmluZygxKTsNCiAgICB9DQogICAgZm9yIChjb25zdCBzZWdtZW50IG9mIHF1ZXJ5U3RyaW5nLnNwbGl0KCcmJykpIHsNCiAgICAgICAgaWYgKHNlZ21lbnQubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBrdiA9IHNlZ21lbnQuc3BsaXQoJz0nKTsNCiAgICAgICAgaWYgKGt2Lmxlbmd0aCA9PT0gMikgew0KICAgICAgICAgICAgcmVzdWx0c1tkZWNvZGVVUklDb21wb25lbnQoa3ZbMF0pXSA9IGRlY29kZVVSSUNvbXBvbmVudChrdlsxXSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICB3YXJuKGBJbnZhbGlkIHF1ZXJ5IHNlZ21lbnQgJyR7c2VnbWVudH0nIGluIHF1ZXJ5ICcke3F1ZXJ5U3RyaW5nfSdgKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0czsNCn0NCmNvbnN0IHBhcnNlUmVwb0luZm8gPSBmdW5jdGlvbiAoZGF0YVVSTCwgbm9kZUFkbWluKSB7DQogICAgY29uc3QgcGFyc2VkVXJsID0gcGFyc2VEYXRhYmFzZVVSTChkYXRhVVJMKSwgbmFtZXNwYWNlID0gcGFyc2VkVXJsLm5hbWVzcGFjZTsNCiAgICBpZiAocGFyc2VkVXJsLmRvbWFpbiA9PT0gJ2ZpcmViYXNlLmNvbScpIHsNCiAgICAgICAgZmF0YWwocGFyc2VkVXJsLmhvc3QgKw0KICAgICAgICAgICAgJyBpcyBubyBsb25nZXIgc3VwcG9ydGVkLiAnICsNCiAgICAgICAgICAgICdQbGVhc2UgdXNlIDxZT1VSIEZJUkVCQVNFPi5maXJlYmFzZWlvLmNvbSBpbnN0ZWFkJyk7DQogICAgfQ0KICAgIC8vIENhdGNoIGNvbW1vbiBlcnJvciBvZiB1bmluaXRpYWxpemVkIG5hbWVzcGFjZSB2YWx1ZS4NCiAgICBpZiAoKCFuYW1lc3BhY2UgfHwgbmFtZXNwYWNlID09PSAndW5kZWZpbmVkJykgJiYNCiAgICAgICAgcGFyc2VkVXJsLmRvbWFpbiAhPT0gJ2xvY2FsaG9zdCcpIHsNCiAgICAgICAgZmF0YWwoJ0Nhbm5vdCBwYXJzZSBGaXJlYmFzZSB1cmwuIFBsZWFzZSB1c2UgaHR0cHM6Ly88WU9VUiBGSVJFQkFTRT4uZmlyZWJhc2Vpby5jb20nKTsNCiAgICB9DQogICAgaWYgKCFwYXJzZWRVcmwuc2VjdXJlKSB7DQogICAgICAgIHdhcm5JZlBhZ2VJc1NlY3VyZSgpOw0KICAgIH0NCiAgICBjb25zdCB3ZWJTb2NrZXRPbmx5ID0gcGFyc2VkVXJsLnNjaGVtZSA9PT0gJ3dzJyB8fCBwYXJzZWRVcmwuc2NoZW1lID09PSAnd3NzJzsNCiAgICByZXR1cm4gew0KICAgICAgICByZXBvSW5mbzogbmV3IFJlcG9JbmZvKHBhcnNlZFVybC5ob3N0LCBwYXJzZWRVcmwuc2VjdXJlLCBuYW1lc3BhY2UsIHdlYlNvY2tldE9ubHksIG5vZGVBZG1pbiwgDQogICAgICAgIC8qcGVyc2lzdGVuY2VLZXk9Ki8gJycsIA0KICAgICAgICAvKmluY2x1ZGVOYW1lc3BhY2VJblF1ZXJ5UGFyYW1zPSovIG5hbWVzcGFjZSAhPT0gcGFyc2VkVXJsLnN1YmRvbWFpbiksDQogICAgICAgIHBhdGg6IG5ldyBQYXRoKHBhcnNlZFVybC5wYXRoU3RyaW5nKQ0KICAgIH07DQp9Ow0KY29uc3QgcGFyc2VEYXRhYmFzZVVSTCA9IGZ1bmN0aW9uIChkYXRhVVJMKSB7DQogICAgLy8gRGVmYXVsdCB0byBlbXB0eSBzdHJpbmdzIGluIHRoZSBldmVudCBvZiBhIG1hbGZvcm1lZCBzdHJpbmcuDQogICAgbGV0IGhvc3QgPSAnJywgZG9tYWluID0gJycsIHN1YmRvbWFpbiA9ICcnLCBwYXRoU3RyaW5nID0gJycsIG5hbWVzcGFjZSA9ICcnOw0KICAgIC8vIEFsd2F5cyBkZWZhdWx0IHRvIFNTTCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuDQogICAgbGV0IHNlY3VyZSA9IHRydWUsIHNjaGVtZSA9ICdodHRwcycsIHBvcnQgPSA0NDM7DQogICAgLy8gRG9uJ3QgZG8gYW55IHZhbGlkYXRpb24gaGVyZS4gVGhlIGNhbGxlciBpcyByZXNwb25zaWJsZSBmb3IgdmFsaWRhdGluZyB0aGUgcmVzdWx0IG9mIHBhcnNpbmcuDQogICAgaWYgKHR5cGVvZiBkYXRhVVJMID09PSAnc3RyaW5nJykgew0KICAgICAgICAvLyBQYXJzZSBzY2hlbWUuDQogICAgICAgIGxldCBjb2xvbkluZCA9IGRhdGFVUkwuaW5kZXhPZignLy8nKTsNCiAgICAgICAgaWYgKGNvbG9uSW5kID49IDApIHsNCiAgICAgICAgICAgIHNjaGVtZSA9IGRhdGFVUkwuc3Vic3RyaW5nKDAsIGNvbG9uSW5kIC0gMSk7DQogICAgICAgICAgICBkYXRhVVJMID0gZGF0YVVSTC5zdWJzdHJpbmcoY29sb25JbmQgKyAyKTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBQYXJzZSBob3N0LCBwYXRoLCBhbmQgcXVlcnkgc3RyaW5nLg0KICAgICAgICBsZXQgc2xhc2hJbmQgPSBkYXRhVVJMLmluZGV4T2YoJy8nKTsNCiAgICAgICAgaWYgKHNsYXNoSW5kID09PSAtMSkgew0KICAgICAgICAgICAgc2xhc2hJbmQgPSBkYXRhVVJMLmxlbmd0aDsNCiAgICAgICAgfQ0KICAgICAgICBsZXQgcXVlc3Rpb25NYXJrSW5kID0gZGF0YVVSTC5pbmRleE9mKCc/Jyk7DQogICAgICAgIGlmIChxdWVzdGlvbk1hcmtJbmQgPT09IC0xKSB7DQogICAgICAgICAgICBxdWVzdGlvbk1hcmtJbmQgPSBkYXRhVVJMLmxlbmd0aDsNCiAgICAgICAgfQ0KICAgICAgICBob3N0ID0gZGF0YVVSTC5zdWJzdHJpbmcoMCwgTWF0aC5taW4oc2xhc2hJbmQsIHF1ZXN0aW9uTWFya0luZCkpOw0KICAgICAgICBpZiAoc2xhc2hJbmQgPCBxdWVzdGlvbk1hcmtJbmQpIHsNCiAgICAgICAgICAgIC8vIEZvciBwYXRoU3RyaW5nLCBxdWVzdGlvbk1hcmtJbmQgd2lsbCBhbHdheXMgY29tZSBhZnRlciBzbGFzaEluZA0KICAgICAgICAgICAgcGF0aFN0cmluZyA9IGRlY29kZVBhdGgoZGF0YVVSTC5zdWJzdHJpbmcoc2xhc2hJbmQsIHF1ZXN0aW9uTWFya0luZCkpOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IHF1ZXJ5UGFyYW1zID0gZGVjb2RlUXVlcnkoZGF0YVVSTC5zdWJzdHJpbmcoTWF0aC5taW4oZGF0YVVSTC5sZW5ndGgsIHF1ZXN0aW9uTWFya0luZCkpKTsNCiAgICAgICAgLy8gSWYgd2UgaGF2ZSBhIHBvcnQsIHVzZSBzY2hlbWUgZm9yIGRldGVybWluaW5nIGlmIGl0J3Mgc2VjdXJlLg0KICAgICAgICBjb2xvbkluZCA9IGhvc3QuaW5kZXhPZignOicpOw0KICAgICAgICBpZiAoY29sb25JbmQgPj0gMCkgew0KICAgICAgICAgICAgc2VjdXJlID0gc2NoZW1lID09PSAnaHR0cHMnIHx8IHNjaGVtZSA9PT0gJ3dzcyc7DQogICAgICAgICAgICBwb3J0ID0gcGFyc2VJbnQoaG9zdC5zdWJzdHJpbmcoY29sb25JbmQgKyAxKSwgMTApOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29sb25JbmQgPSBob3N0Lmxlbmd0aDsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBob3N0V2l0aG91dFBvcnQgPSBob3N0LnNsaWNlKDAsIGNvbG9uSW5kKTsNCiAgICAgICAgaWYgKGhvc3RXaXRob3V0UG9ydC50b0xvd2VyQ2FzZSgpID09PSAnbG9jYWxob3N0Jykgew0KICAgICAgICAgICAgZG9tYWluID0gJ2xvY2FsaG9zdCc7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoaG9zdFdpdGhvdXRQb3J0LnNwbGl0KCcuJykubGVuZ3RoIDw9IDIpIHsNCiAgICAgICAgICAgIGRvbWFpbiA9IGhvc3RXaXRob3V0UG9ydDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIC8vIEludGVycHJldCB0aGUgc3ViZG9tYWluIG9mIGEgMyBvciBtb3JlIGNvbXBvbmVudCBVUkwgYXMgdGhlIG5hbWVzcGFjZSBuYW1lLg0KICAgICAgICAgICAgY29uc3QgZG90SW5kID0gaG9zdC5pbmRleE9mKCcuJyk7DQogICAgICAgICAgICBzdWJkb21haW4gPSBob3N0LnN1YnN0cmluZygwLCBkb3RJbmQpLnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICBkb21haW4gPSBob3N0LnN1YnN0cmluZyhkb3RJbmQgKyAxKTsNCiAgICAgICAgICAgIC8vIE5vcm1hbGl6ZSBuYW1lc3BhY2VzIHRvIGxvd2VyY2FzZSB0byBzaGFyZSBzdG9yYWdlIC8gY29ubmVjdGlvbi4NCiAgICAgICAgICAgIG5hbWVzcGFjZSA9IHN1YmRvbWFpbjsNCiAgICAgICAgfQ0KICAgICAgICAvLyBBbHdheXMgdHJlYXQgdGhlIHZhbHVlIG9mIHRoZSBgbnNgIGFzIHRoZSBuYW1lc3BhY2UgbmFtZSBpZiBpdCBpcyBwcmVzZW50Lg0KICAgICAgICBpZiAoJ25zJyBpbiBxdWVyeVBhcmFtcykgew0KICAgICAgICAgICAgbmFtZXNwYWNlID0gcXVlcnlQYXJhbXNbJ25zJ107DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHsNCiAgICAgICAgaG9zdCwNCiAgICAgICAgcG9ydCwNCiAgICAgICAgZG9tYWluLA0KICAgICAgICBzdWJkb21haW4sDQogICAgICAgIHNlY3VyZSwNCiAgICAgICAgc2NoZW1lLA0KICAgICAgICBwYXRoU3RyaW5nLA0KICAgICAgICBuYW1lc3BhY2UNCiAgICB9Ow0KfTsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogRW5jYXBzdWxhdGVzIHRoZSBkYXRhIG5lZWRlZCB0byByYWlzZSBhbiBldmVudA0KICovDQpjbGFzcyBEYXRhRXZlbnQgew0KICAgIC8qKg0KICAgICAqIEBwYXJhbSBldmVudFR5cGUgLSBPbmUgb2Y6IHZhbHVlLCBjaGlsZF9hZGRlZCwgY2hpbGRfY2hhbmdlZCwgY2hpbGRfbW92ZWQsIGNoaWxkX3JlbW92ZWQNCiAgICAgKiBAcGFyYW0gZXZlbnRSZWdpc3RyYXRpb24gLSBUaGUgZnVuY3Rpb24gdG8gY2FsbCB0byB3aXRoIHRoZSBldmVudCBkYXRhLiBVc2VyIHByb3ZpZGVkDQogICAgICogQHBhcmFtIHNuYXBzaG90IC0gVGhlIGRhdGEgYmFja2luZyB0aGUgZXZlbnQNCiAgICAgKiBAcGFyYW0gcHJldk5hbWUgLSBPcHRpb25hbCwgdGhlIG5hbWUgb2YgdGhlIHByZXZpb3VzIGNoaWxkIGZvciBjaGlsZF8qIGV2ZW50cy4NCiAgICAgKi8NCiAgICBjb25zdHJ1Y3RvcihldmVudFR5cGUsIGV2ZW50UmVnaXN0cmF0aW9uLCBzbmFwc2hvdCwgcHJldk5hbWUpIHsNCiAgICAgICAgdGhpcy5ldmVudFR5cGUgPSBldmVudFR5cGU7DQogICAgICAgIHRoaXMuZXZlbnRSZWdpc3RyYXRpb24gPSBldmVudFJlZ2lzdHJhdGlvbjsNCiAgICAgICAgdGhpcy5zbmFwc2hvdCA9IHNuYXBzaG90Ow0KICAgICAgICB0aGlzLnByZXZOYW1lID0gcHJldk5hbWU7DQogICAgfQ0KICAgIGdldFBhdGgoKSB7DQogICAgICAgIGNvbnN0IHJlZiA9IHRoaXMuc25hcHNob3QucmVmOw0KICAgICAgICBpZiAodGhpcy5ldmVudFR5cGUgPT09ICd2YWx1ZScpIHsNCiAgICAgICAgICAgIHJldHVybiByZWYuX3BhdGg7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gcmVmLnBhcmVudC5fcGF0aDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBnZXRFdmVudFR5cGUoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmV2ZW50VHlwZTsNCiAgICB9DQogICAgZ2V0RXZlbnRSdW5uZXIoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmV2ZW50UmVnaXN0cmF0aW9uLmdldEV2ZW50UnVubmVyKHRoaXMpOw0KICAgIH0NCiAgICB0b1N0cmluZygpIHsNCiAgICAgICAgcmV0dXJuICh0aGlzLmdldFBhdGgoKS50b1N0cmluZygpICsNCiAgICAgICAgICAgICc6JyArDQogICAgICAgICAgICB0aGlzLmV2ZW50VHlwZSArDQogICAgICAgICAgICAnOicgKw0KICAgICAgICAgICAgc3RyaW5naWZ5KHRoaXMuc25hcHNob3QuZXhwb3J0VmFsKCkpKTsNCiAgICB9DQp9DQpjbGFzcyBDYW5jZWxFdmVudCB7DQogICAgY29uc3RydWN0b3IoZXZlbnRSZWdpc3RyYXRpb24sIGVycm9yLCBwYXRoKSB7DQogICAgICAgIHRoaXMuZXZlbnRSZWdpc3RyYXRpb24gPSBldmVudFJlZ2lzdHJhdGlvbjsNCiAgICAgICAgdGhpcy5lcnJvciA9IGVycm9yOw0KICAgICAgICB0aGlzLnBhdGggPSBwYXRoOw0KICAgIH0NCiAgICBnZXRQYXRoKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5wYXRoOw0KICAgIH0NCiAgICBnZXRFdmVudFR5cGUoKSB7DQogICAgICAgIHJldHVybiAnY2FuY2VsJzsNCiAgICB9DQogICAgZ2V0RXZlbnRSdW5uZXIoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmV2ZW50UmVnaXN0cmF0aW9uLmdldEV2ZW50UnVubmVyKHRoaXMpOw0KICAgIH0NCiAgICB0b1N0cmluZygpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucGF0aC50b1N0cmluZygpICsgJzpjYW5jZWwnOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogQSB3cmFwcGVyIGNsYXNzIHRoYXQgY29udmVydHMgZXZlbnRzIGZyb20gdGhlIGRhdGFiYXNlQGV4cCBTREsgdG8gdGhlIGxlZ2FjeQ0KICogRGF0YWJhc2UgU0RLLiBFdmVudHMgYXJlIG5vdCBjb252ZXJ0ZWQgZGlyZWN0bHkgYXMgZXZlbnQgcmVnaXN0cmF0aW9uIHJlbGllcw0KICogb24gcmVmZXJlbmNlIGNvbXBhcmlzb24gb2YgdGhlIG9yaWdpbmFsIHVzZXIgY2FsbGJhY2sgKHNlZSBgbWF0Y2hlcygpYCkgYW5kDQogKiByZWxpZXMgb24gZXF1YWxpdHkgb2YgdGhlIGxlZ2FjeSBTREsncyBgY29udGV4dGAgb2JqZWN0Lg0KICovDQpjbGFzcyBDYWxsYmFja0NvbnRleHQgew0KICAgIGNvbnN0cnVjdG9yKHNuYXBzaG90Q2FsbGJhY2ssIGNhbmNlbENhbGxiYWNrKSB7DQogICAgICAgIHRoaXMuc25hcHNob3RDYWxsYmFjayA9IHNuYXBzaG90Q2FsbGJhY2s7DQogICAgICAgIHRoaXMuY2FuY2VsQ2FsbGJhY2sgPSBjYW5jZWxDYWxsYmFjazsNCiAgICB9DQogICAgb25WYWx1ZShleHBEYXRhU25hcHNob3QsIHByZXZpb3VzQ2hpbGROYW1lKSB7DQogICAgICAgIHRoaXMuc25hcHNob3RDYWxsYmFjay5jYWxsKG51bGwsIGV4cERhdGFTbmFwc2hvdCwgcHJldmlvdXNDaGlsZE5hbWUpOw0KICAgIH0NCiAgICBvbkNhbmNlbChlcnJvcikgew0KICAgICAgICBhc3NlcnQodGhpcy5oYXNDYW5jZWxDYWxsYmFjaywgJ1JhaXNpbmcgYSBjYW5jZWwgZXZlbnQgb24gYSBsaXN0ZW5lciB3aXRoIG5vIGNhbmNlbCBjYWxsYmFjaycpOw0KICAgICAgICByZXR1cm4gdGhpcy5jYW5jZWxDYWxsYmFjay5jYWxsKG51bGwsIGVycm9yKTsNCiAgICB9DQogICAgZ2V0IGhhc0NhbmNlbENhbGxiYWNrKCkgew0KICAgICAgICByZXR1cm4gISF0aGlzLmNhbmNlbENhbGxiYWNrOw0KICAgIH0NCiAgICBtYXRjaGVzKG90aGVyKSB7DQogICAgICAgIHJldHVybiAodGhpcy5zbmFwc2hvdENhbGxiYWNrID09PSBvdGhlci5zbmFwc2hvdENhbGxiYWNrIHx8DQogICAgICAgICAgICAodGhpcy5zbmFwc2hvdENhbGxiYWNrLnVzZXJDYWxsYmFjayAhPT0gdW5kZWZpbmVkICYmDQogICAgICAgICAgICAgICAgdGhpcy5zbmFwc2hvdENhbGxiYWNrLnVzZXJDYWxsYmFjayA9PT0NCiAgICAgICAgICAgICAgICAgICAgb3RoZXIuc25hcHNob3RDYWxsYmFjay51c2VyQ2FsbGJhY2sgJiYNCiAgICAgICAgICAgICAgICB0aGlzLnNuYXBzaG90Q2FsbGJhY2suY29udGV4dCA9PT0gb3RoZXIuc25hcHNob3RDYWxsYmFjay5jb250ZXh0KSk7DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBAaW50ZXJuYWwNCiAqLw0KY2xhc3MgUXVlcnlJbXBsIHsNCiAgICAvKioNCiAgICAgKiBAaGlkZWNvbnN0cnVjdG9yDQogICAgICovDQogICAgY29uc3RydWN0b3IoX3JlcG8sIF9wYXRoLCBfcXVlcnlQYXJhbXMsIF9vcmRlckJ5Q2FsbGVkKSB7DQogICAgICAgIHRoaXMuX3JlcG8gPSBfcmVwbzsNCiAgICAgICAgdGhpcy5fcGF0aCA9IF9wYXRoOw0KICAgICAgICB0aGlzLl9xdWVyeVBhcmFtcyA9IF9xdWVyeVBhcmFtczsNCiAgICAgICAgdGhpcy5fb3JkZXJCeUNhbGxlZCA9IF9vcmRlckJ5Q2FsbGVkOw0KICAgIH0NCiAgICBnZXQga2V5KCkgew0KICAgICAgICBpZiAocGF0aElzRW1wdHkodGhpcy5fcGF0aCkpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIHBhdGhHZXRCYWNrKHRoaXMuX3BhdGgpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGdldCByZWYoKSB7DQogICAgICAgIHJldHVybiBuZXcgUmVmZXJlbmNlSW1wbCh0aGlzLl9yZXBvLCB0aGlzLl9wYXRoKTsNCiAgICB9DQogICAgZ2V0IF9xdWVyeUlkZW50aWZpZXIoKSB7DQogICAgICAgIGNvbnN0IG9iaiA9IHF1ZXJ5UGFyYW1zR2V0UXVlcnlPYmplY3QodGhpcy5fcXVlcnlQYXJhbXMpOw0KICAgICAgICBjb25zdCBpZCA9IE9iamVjdFRvVW5pcXVlS2V5KG9iaik7DQogICAgICAgIHJldHVybiBpZCA9PT0gJ3t9JyA/ICdkZWZhdWx0JyA6IGlkOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBBbiBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgdGhlIHF1ZXJ5IHBhcmFtZXRlcnMgdXNlZCBieSB0aGlzIFF1ZXJ5Lg0KICAgICAqLw0KICAgIGdldCBfcXVlcnlPYmplY3QoKSB7DQogICAgICAgIHJldHVybiBxdWVyeVBhcmFtc0dldFF1ZXJ5T2JqZWN0KHRoaXMuX3F1ZXJ5UGFyYW1zKTsNCiAgICB9DQogICAgaXNFcXVhbChvdGhlcikgew0KICAgICAgICBvdGhlciA9IGdldE1vZHVsYXJJbnN0YW5jZShvdGhlcik7DQogICAgICAgIGlmICghKG90aGVyIGluc3RhbmNlb2YgUXVlcnlJbXBsKSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IHNhbWVSZXBvID0gdGhpcy5fcmVwbyA9PT0gb3RoZXIuX3JlcG87DQogICAgICAgIGNvbnN0IHNhbWVQYXRoID0gcGF0aEVxdWFscyh0aGlzLl9wYXRoLCBvdGhlci5fcGF0aCk7DQogICAgICAgIGNvbnN0IHNhbWVRdWVyeUlkZW50aWZpZXIgPSB0aGlzLl9xdWVyeUlkZW50aWZpZXIgPT09IG90aGVyLl9xdWVyeUlkZW50aWZpZXI7DQogICAgICAgIHJldHVybiBzYW1lUmVwbyAmJiBzYW1lUGF0aCAmJiBzYW1lUXVlcnlJZGVudGlmaWVyOw0KICAgIH0NCiAgICB0b0pTT04oKSB7DQogICAgICAgIHJldHVybiB0aGlzLnRvU3RyaW5nKCk7DQogICAgfQ0KICAgIHRvU3RyaW5nKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5fcmVwby50b1N0cmluZygpICsgcGF0aFRvVXJsRW5jb2RlZFN0cmluZyh0aGlzLl9wYXRoKTsNCiAgICB9DQp9DQovKioNCiAqIEBpbnRlcm5hbA0KICovDQpjbGFzcyBSZWZlcmVuY2VJbXBsIGV4dGVuZHMgUXVlcnlJbXBsIHsNCiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqLw0KICAgIGNvbnN0cnVjdG9yKHJlcG8sIHBhdGgpIHsNCiAgICAgICAgc3VwZXIocmVwbywgcGF0aCwgbmV3IFF1ZXJ5UGFyYW1zKCksIGZhbHNlKTsNCiAgICB9DQogICAgZ2V0IHBhcmVudCgpIHsNCiAgICAgICAgY29uc3QgcGFyZW50UGF0aCA9IHBhdGhQYXJlbnQodGhpcy5fcGF0aCk7DQogICAgICAgIHJldHVybiBwYXJlbnRQYXRoID09PSBudWxsDQogICAgICAgICAgICA/IG51bGwNCiAgICAgICAgICAgIDogbmV3IFJlZmVyZW5jZUltcGwodGhpcy5fcmVwbywgcGFyZW50UGF0aCk7DQogICAgfQ0KICAgIGdldCByb290KCkgew0KICAgICAgICBsZXQgcmVmID0gdGhpczsNCiAgICAgICAgd2hpbGUgKHJlZi5wYXJlbnQgIT09IG51bGwpIHsNCiAgICAgICAgICAgIHJlZiA9IHJlZi5wYXJlbnQ7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHJlZjsNCiAgICB9DQp9DQovKioNCiAqIEEgYERhdGFTbmFwc2hvdGAgY29udGFpbnMgZGF0YSBmcm9tIGEgRGF0YWJhc2UgbG9jYXRpb24uDQogKg0KICogQW55IHRpbWUgeW91IHJlYWQgZGF0YSBmcm9tIHRoZSBEYXRhYmFzZSwgeW91IHJlY2VpdmUgdGhlIGRhdGEgYXMgYQ0KICogYERhdGFTbmFwc2hvdGAuIEEgYERhdGFTbmFwc2hvdGAgaXMgcGFzc2VkIHRvIHRoZSBldmVudCBjYWxsYmFja3MgeW91IGF0dGFjaA0KICogd2l0aCBgb24oKWAgb3IgYG9uY2UoKWAuIFlvdSBjYW4gZXh0cmFjdCB0aGUgY29udGVudHMgb2YgdGhlIHNuYXBzaG90IGFzIGENCiAqIEphdmFTY3JpcHQgb2JqZWN0IGJ5IGNhbGxpbmcgdGhlIGB2YWwoKWAgbWV0aG9kLiBBbHRlcm5hdGl2ZWx5LCB5b3UgY2FuDQogKiB0cmF2ZXJzZSBpbnRvIHRoZSBzbmFwc2hvdCBieSBjYWxsaW5nIGBjaGlsZCgpYCB0byByZXR1cm4gY2hpbGQgc25hcHNob3RzDQogKiAod2hpY2ggeW91IGNvdWxkIHRoZW4gY2FsbCBgdmFsKClgIG9uKS4NCiAqDQogKiBBIGBEYXRhU25hcHNob3RgIGlzIGFuIGVmZmljaWVudGx5IGdlbmVyYXRlZCwgaW1tdXRhYmxlIGNvcHkgb2YgdGhlIGRhdGEgYXQNCiAqIGEgRGF0YWJhc2UgbG9jYXRpb24uIEl0IGNhbm5vdCBiZSBtb2RpZmllZCBhbmQgd2lsbCBuZXZlciBjaGFuZ2UgKHRvIG1vZGlmeQ0KICogZGF0YSwgeW91IGFsd2F5cyBjYWxsIHRoZSBgc2V0KClgIG1ldGhvZCBvbiBhIGBSZWZlcmVuY2VgIGRpcmVjdGx5KS4NCiAqLw0KY2xhc3MgRGF0YVNuYXBzaG90IHsNCiAgICAvKioNCiAgICAgKiBAcGFyYW0gX25vZGUgLSBBIFNuYXBzaG90Tm9kZSB0byB3cmFwLg0KICAgICAqIEBwYXJhbSByZWYgLSBUaGUgbG9jYXRpb24gdGhpcyBzbmFwc2hvdCBjYW1lIGZyb20uDQogICAgICogQHBhcmFtIF9pbmRleCAtIFRoZSBpdGVyYXRpb24gb3JkZXIgZm9yIHRoaXMgc25hcHNob3QNCiAgICAgKiBAaGlkZWNvbnN0cnVjdG9yDQogICAgICovDQogICAgY29uc3RydWN0b3IoX25vZGUsIA0KICAgIC8qKg0KICAgICAqIFRoZSBsb2NhdGlvbiBvZiB0aGlzIERhdGFTbmFwc2hvdC4NCiAgICAgKi8NCiAgICByZWYsIF9pbmRleCkgew0KICAgICAgICB0aGlzLl9ub2RlID0gX25vZGU7DQogICAgICAgIHRoaXMucmVmID0gcmVmOw0KICAgICAgICB0aGlzLl9pbmRleCA9IF9pbmRleDsNCiAgICB9DQogICAgLyoqDQogICAgICogR2V0cyB0aGUgcHJpb3JpdHkgdmFsdWUgb2YgdGhlIGRhdGEgaW4gdGhpcyBgRGF0YVNuYXBzaG90YC4NCiAgICAgKg0KICAgICAqIEFwcGxpY2F0aW9ucyBuZWVkIG5vdCB1c2UgcHJpb3JpdHkgYnV0IGNhbiBvcmRlciBjb2xsZWN0aW9ucyBieQ0KICAgICAqIG9yZGluYXJ5IHByb3BlcnRpZXMgKHNlZQ0KICAgICAqIHtAbGluayBodHRwczovL2ZpcmViYXNlLmdvb2dsZS5jb20vZG9jcy9kYXRhYmFzZS93ZWIvbGlzdHMtb2YtZGF0YSNzb3J0aW5nX2FuZF9maWx0ZXJpbmdfZGF0YSB8U29ydGluZyBhbmQgZmlsdGVyaW5nIGRhdGF9DQogICAgICogKS4NCiAgICAgKi8NCiAgICBnZXQgcHJpb3JpdHkoKSB7DQogICAgICAgIC8vIHR5cGVjYXN0IGhlcmUgYmVjYXVzZSB3ZSBuZXZlciByZXR1cm4gZGVmZXJyZWQgdmFsdWVzIG9yIGludGVybmFsIHByaW9yaXRpZXMgKE1BWF9QUklPUklUWSkNCiAgICAgICAgcmV0dXJuIHRoaXMuX25vZGUuZ2V0UHJpb3JpdHkoKS52YWwoKTsNCiAgICB9DQogICAgLyoqDQogICAgICogVGhlIGtleSAobGFzdCBwYXJ0IG9mIHRoZSBwYXRoKSBvZiB0aGUgbG9jYXRpb24gb2YgdGhpcyBgRGF0YVNuYXBzaG90YC4NCiAgICAgKg0KICAgICAqIFRoZSBsYXN0IHRva2VuIGluIGEgRGF0YWJhc2UgbG9jYXRpb24gaXMgY29uc2lkZXJlZCBpdHMga2V5LiBGb3IgZXhhbXBsZSwNCiAgICAgKiAiYWRhIiBpcyB0aGUga2V5IGZvciB0aGUgL3VzZXJzL2FkYS8gbm9kZS4gQWNjZXNzaW5nIHRoZSBrZXkgb24gYW55DQogICAgICogYERhdGFTbmFwc2hvdGAgd2lsbCByZXR1cm4gdGhlIGtleSBmb3IgdGhlIGxvY2F0aW9uIHRoYXQgZ2VuZXJhdGVkIGl0Lg0KICAgICAqIEhvd2V2ZXIsIGFjY2Vzc2luZyB0aGUga2V5IG9uIHRoZSByb290IFVSTCBvZiBhIERhdGFiYXNlIHdpbGwgcmV0dXJuDQogICAgICogYG51bGxgLg0KICAgICAqLw0KICAgIGdldCBrZXkoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJlZi5rZXk7DQogICAgfQ0KICAgIC8qKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgY2hpbGQgcHJvcGVydGllcyBvZiB0aGlzIGBEYXRhU25hcHNob3RgLiAqLw0KICAgIGdldCBzaXplKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5fbm9kZS5udW1DaGlsZHJlbigpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBHZXRzIGFub3RoZXIgYERhdGFTbmFwc2hvdGAgZm9yIHRoZSBsb2NhdGlvbiBhdCB0aGUgc3BlY2lmaWVkIHJlbGF0aXZlIHBhdGguDQogICAgICoNCiAgICAgKiBQYXNzaW5nIGEgcmVsYXRpdmUgcGF0aCB0byB0aGUgYGNoaWxkKClgIG1ldGhvZCBvZiBhIERhdGFTbmFwc2hvdCByZXR1cm5zDQogICAgICogYW5vdGhlciBgRGF0YVNuYXBzaG90YCBmb3IgdGhlIGxvY2F0aW9uIGF0IHRoZSBzcGVjaWZpZWQgcmVsYXRpdmUgcGF0aC4gVGhlDQogICAgICogcmVsYXRpdmUgcGF0aCBjYW4gZWl0aGVyIGJlIGEgc2ltcGxlIGNoaWxkIG5hbWUgKGZvciBleGFtcGxlLCAiYWRhIikgb3IgYQ0KICAgICAqIGRlZXBlciwgc2xhc2gtc2VwYXJhdGVkIHBhdGggKGZvciBleGFtcGxlLCAiYWRhL25hbWUvZmlyc3QiKS4gSWYgdGhlIGNoaWxkDQogICAgICogbG9jYXRpb24gaGFzIG5vIGRhdGEsIGFuIGVtcHR5IGBEYXRhU25hcHNob3RgICh0aGF0IGlzLCBhIGBEYXRhU25hcHNob3RgDQogICAgICogd2hvc2UgdmFsdWUgaXMgYG51bGxgKSBpcyByZXR1cm5lZC4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBwYXRoIC0gQSByZWxhdGl2ZSBwYXRoIHRvIHRoZSBsb2NhdGlvbiBvZiBjaGlsZCBkYXRhLg0KICAgICAqLw0KICAgIGNoaWxkKHBhdGgpIHsNCiAgICAgICAgY29uc3QgY2hpbGRQYXRoID0gbmV3IFBhdGgocGF0aCk7DQogICAgICAgIGNvbnN0IGNoaWxkUmVmID0gY2hpbGQodGhpcy5yZWYsIHBhdGgpOw0KICAgICAgICByZXR1cm4gbmV3IERhdGFTbmFwc2hvdCh0aGlzLl9ub2RlLmdldENoaWxkKGNoaWxkUGF0aCksIGNoaWxkUmVmLCBQUklPUklUWV9JTkRFWCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGBEYXRhU25hcHNob3RgIGNvbnRhaW5zIGFueSBkYXRhLiBJdCBpcyBzbGlnaHRseSBtb3JlDQogICAgICogZWZmaWNpZW50IHRoYW4gdXNpbmcgYHNuYXBzaG90LnZhbCgpICE9PSBudWxsYC4NCiAgICAgKi8NCiAgICBleGlzdHMoKSB7DQogICAgICAgIHJldHVybiAhdGhpcy5fbm9kZS5pc0VtcHR5KCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEV4cG9ydHMgdGhlIGVudGlyZSBjb250ZW50cyBvZiB0aGUgRGF0YVNuYXBzaG90IGFzIGEgSmF2YVNjcmlwdCBvYmplY3QuDQogICAgICoNCiAgICAgKiBUaGUgYGV4cG9ydFZhbCgpYCBtZXRob2QgaXMgc2ltaWxhciB0byBgdmFsKClgLCBleGNlcHQgcHJpb3JpdHkgaW5mb3JtYXRpb24NCiAgICAgKiBpcyBpbmNsdWRlZCAoaWYgYXZhaWxhYmxlKSwgbWFraW5nIGl0IHN1aXRhYmxlIGZvciBiYWNraW5nIHVwIHlvdXIgZGF0YS4NCiAgICAgKg0KICAgICAqIEByZXR1cm5zIFRoZSBEYXRhU25hcHNob3QncyBjb250ZW50cyBhcyBhIEphdmFTY3JpcHQgdmFsdWUgKE9iamVjdCwNCiAgICAgKiAgIEFycmF5LCBzdHJpbmcsIG51bWJlciwgYm9vbGVhbiwgb3IgYG51bGxgKS4NCiAgICAgKi8NCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgIGV4cG9ydFZhbCgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuX25vZGUudmFsKHRydWUpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBFbnVtZXJhdGVzIHRoZSB0b3AtbGV2ZWwgY2hpbGRyZW4gaW4gdGhlIGBJdGVyYXRlZERhdGFTbmFwc2hvdGAuDQogICAgICoNCiAgICAgKiBCZWNhdXNlIG9mIHRoZSB3YXkgSmF2YVNjcmlwdCBvYmplY3RzIHdvcmssIHRoZSBvcmRlcmluZyBvZiBkYXRhIGluIHRoZQ0KICAgICAqIEphdmFTY3JpcHQgb2JqZWN0IHJldHVybmVkIGJ5IGB2YWwoKWAgaXMgbm90IGd1YXJhbnRlZWQgdG8gbWF0Y2ggdGhlDQogICAgICogb3JkZXJpbmcgb24gdGhlIHNlcnZlciBub3IgdGhlIG9yZGVyaW5nIG9mIGBvbkNoaWxkQWRkZWQoKWAgZXZlbnRzLiBUaGF0IGlzDQogICAgICogd2hlcmUgYGZvckVhY2goKWAgY29tZXMgaW4gaGFuZHkuIEl0IGd1YXJhbnRlZXMgdGhlIGNoaWxkcmVuIG9mIGENCiAgICAgKiBgRGF0YVNuYXBzaG90YCB3aWxsIGJlIGl0ZXJhdGVkIGluIHRoZWlyIHF1ZXJ5IG9yZGVyLg0KICAgICAqDQogICAgICogSWYgbm8gZXhwbGljaXQgYG9yZGVyQnkqKClgIG1ldGhvZCBpcyB1c2VkLCByZXN1bHRzIGFyZSByZXR1cm5lZA0KICAgICAqIG9yZGVyZWQgYnkga2V5ICh1bmxlc3MgcHJpb3JpdGllcyBhcmUgdXNlZCwgaW4gd2hpY2ggY2FzZSwgcmVzdWx0cyBhcmUNCiAgICAgKiByZXR1cm5lZCBieSBwcmlvcml0eSkuDQogICAgICoNCiAgICAgKiBAcGFyYW0gYWN0aW9uIC0gQSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgY2FsbGVkIGZvciBlYWNoIGNoaWxkIERhdGFTbmFwc2hvdC4NCiAgICAgKiBUaGUgY2FsbGJhY2sgY2FuIHJldHVybiB0cnVlIHRvIGNhbmNlbCBmdXJ0aGVyIGVudW1lcmF0aW9uLg0KICAgICAqIEByZXR1cm5zIHRydWUgaWYgZW51bWVyYXRpb24gd2FzIGNhbmNlbGVkIGR1ZSB0byB5b3VyIGNhbGxiYWNrIHJldHVybmluZw0KICAgICAqIHRydWUuDQogICAgICovDQogICAgZm9yRWFjaChhY3Rpb24pIHsNCiAgICAgICAgaWYgKHRoaXMuX25vZGUuaXNMZWFmTm9kZSgpKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgY2hpbGRyZW5Ob2RlID0gdGhpcy5fbm9kZTsNCiAgICAgICAgLy8gU2FuaXRpemUgdGhlIHJldHVybiB2YWx1ZSB0byBhIGJvb2xlYW4uIENoaWxkcmVuTm9kZS5mb3JFYWNoQ2hpbGQgaGFzIGEgd2VpcmQgcmV0dXJuIHR5cGUuLi4NCiAgICAgICAgcmV0dXJuICEhY2hpbGRyZW5Ob2RlLmZvckVhY2hDaGlsZCh0aGlzLl9pbmRleCwgKGtleSwgbm9kZSkgPT4gew0KICAgICAgICAgICAgcmV0dXJuIGFjdGlvbihuZXcgRGF0YVNuYXBzaG90KG5vZGUsIGNoaWxkKHRoaXMucmVmLCBrZXkpLCBQUklPUklUWV9JTkRFWCkpOw0KICAgICAgICB9KTsNCiAgICB9DQogICAgLyoqDQogICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBzcGVjaWZpZWQgY2hpbGQgcGF0aCBoYXMgKG5vbi1udWxsKSBkYXRhLg0KICAgICAqDQogICAgICogQHBhcmFtIHBhdGggLSBBIHJlbGF0aXZlIHBhdGggdG8gdGhlIGxvY2F0aW9uIG9mIGEgcG90ZW50aWFsIGNoaWxkLg0KICAgICAqIEByZXR1cm5zIGB0cnVlYCBpZiBkYXRhIGV4aXN0cyBhdCB0aGUgc3BlY2lmaWVkIGNoaWxkIHBhdGg7IGVsc2UNCiAgICAgKiAgYGZhbHNlYC4NCiAgICAgKi8NCiAgICBoYXNDaGlsZChwYXRoKSB7DQogICAgICAgIGNvbnN0IGNoaWxkUGF0aCA9IG5ldyBQYXRoKHBhdGgpOw0KICAgICAgICByZXR1cm4gIXRoaXMuX25vZGUuZ2V0Q2hpbGQoY2hpbGRQYXRoKS5pc0VtcHR5KCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJldHVybnMgd2hldGhlciBvciBub3QgdGhlIGBEYXRhU25hcHNob3RgIGhhcyBhbnkgbm9uLWBudWxsYCBjaGlsZA0KICAgICAqIHByb3BlcnRpZXMuDQogICAgICoNCiAgICAgKiBZb3UgY2FuIHVzZSBgaGFzQ2hpbGRyZW4oKWAgdG8gZGV0ZXJtaW5lIGlmIGEgYERhdGFTbmFwc2hvdGAgaGFzIGFueQ0KICAgICAqIGNoaWxkcmVuLiBJZiBpdCBkb2VzLCB5b3UgY2FuIGVudW1lcmF0ZSB0aGVtIHVzaW5nIGBmb3JFYWNoKClgLiBJZiBpdA0KICAgICAqIGRvZXNuJ3QsIHRoZW4gZWl0aGVyIHRoaXMgc25hcHNob3QgY29udGFpbnMgYSBwcmltaXRpdmUgdmFsdWUgKHdoaWNoIGNhbiBiZQ0KICAgICAqIHJldHJpZXZlZCB3aXRoIGB2YWwoKWApIG9yIGl0IGlzIGVtcHR5IChpbiB3aGljaCBjYXNlLCBgdmFsKClgIHdpbGwgcmV0dXJuDQogICAgICogYG51bGxgKS4NCiAgICAgKg0KICAgICAqIEByZXR1cm5zIHRydWUgaWYgdGhpcyBzbmFwc2hvdCBoYXMgYW55IGNoaWxkcmVuOyBlbHNlIGZhbHNlLg0KICAgICAqLw0KICAgIGhhc0NoaWxkcmVuKCkgew0KICAgICAgICBpZiAodGhpcy5fbm9kZS5pc0xlYWZOb2RlKCkpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiAhdGhpcy5fbm9kZS5pc0VtcHR5KCk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogUmV0dXJucyBhIEpTT04tc2VyaWFsaXphYmxlIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgb2JqZWN0Lg0KICAgICAqLw0KICAgIHRvSlNPTigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZXhwb3J0VmFsKCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEV4dHJhY3RzIGEgSmF2YVNjcmlwdCB2YWx1ZSBmcm9tIGEgYERhdGFTbmFwc2hvdGAuDQogICAgICoNCiAgICAgKiBEZXBlbmRpbmcgb24gdGhlIGRhdGEgaW4gYSBgRGF0YVNuYXBzaG90YCwgdGhlIGB2YWwoKWAgbWV0aG9kIG1heSByZXR1cm4gYQ0KICAgICAqIHNjYWxhciB0eXBlIChzdHJpbmcsIG51bWJlciwgb3IgYm9vbGVhbiksIGFuIGFycmF5LCBvciBhbiBvYmplY3QuIEl0IG1heQ0KICAgICAqIGFsc28gcmV0dXJuIG51bGwsIGluZGljYXRpbmcgdGhhdCB0aGUgYERhdGFTbmFwc2hvdGAgaXMgZW1wdHkgKGNvbnRhaW5zIG5vDQogICAgICogZGF0YSkuDQogICAgICoNCiAgICAgKiBAcmV0dXJucyBUaGUgRGF0YVNuYXBzaG90J3MgY29udGVudHMgYXMgYSBKYXZhU2NyaXB0IHZhbHVlIChPYmplY3QsDQogICAgICogICBBcnJheSwgc3RyaW5nLCBudW1iZXIsIGJvb2xlYW4sIG9yIGBudWxsYCkuDQogICAgICovDQogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICB2YWwoKSB7DQogICAgICAgIHJldHVybiB0aGlzLl9ub2RlLnZhbCgpOw0KICAgIH0NCn0NCi8qKg0KICoNCiAqIFJldHVybnMgYSBgUmVmZXJlbmNlYCByZXByZXNlbnRpbmcgdGhlIGxvY2F0aW9uIGluIHRoZSBEYXRhYmFzZQ0KICogY29ycmVzcG9uZGluZyB0byB0aGUgcHJvdmlkZWQgcGF0aC4gSWYgbm8gcGF0aCBpcyBwcm92aWRlZCwgdGhlIGBSZWZlcmVuY2VgDQogKiB3aWxsIHBvaW50IHRvIHRoZSByb290IG9mIHRoZSBEYXRhYmFzZS4NCiAqDQogKiBAcGFyYW0gZGIgLSBUaGUgZGF0YWJhc2UgaW5zdGFuY2UgdG8gb2J0YWluIGEgcmVmZXJlbmNlIGZvci4NCiAqIEBwYXJhbSBwYXRoIC0gT3B0aW9uYWwgcGF0aCByZXByZXNlbnRpbmcgdGhlIGxvY2F0aW9uIHRoZSByZXR1cm5lZA0KICogICBgUmVmZXJlbmNlYCB3aWxsIHBvaW50LiBJZiBub3QgcHJvdmlkZWQsIHRoZSByZXR1cm5lZCBgUmVmZXJlbmNlYCB3aWxsDQogKiAgIHBvaW50IHRvIHRoZSByb290IG9mIHRoZSBEYXRhYmFzZS4NCiAqIEByZXR1cm5zIElmIGEgcGF0aCBpcyBwcm92aWRlZCwgYSBgUmVmZXJlbmNlYA0KICogICBwb2ludGluZyB0byB0aGUgcHJvdmlkZWQgcGF0aC4gT3RoZXJ3aXNlLCBhIGBSZWZlcmVuY2VgIHBvaW50aW5nIHRvIHRoZQ0KICogICByb290IG9mIHRoZSBEYXRhYmFzZS4NCiAqLw0KZnVuY3Rpb24gcmVmKGRiLCBwYXRoKSB7DQogICAgZGIgPSBnZXRNb2R1bGFySW5zdGFuY2UoZGIpOw0KICAgIGRiLl9jaGVja05vdERlbGV0ZWQoJ3JlZicpOw0KICAgIHJldHVybiBwYXRoICE9PSB1bmRlZmluZWQgPyBjaGlsZChkYi5fcm9vdCwgcGF0aCkgOiBkYi5fcm9vdDsNCn0NCi8qKg0KICogR2V0cyBhIGBSZWZlcmVuY2VgIGZvciB0aGUgbG9jYXRpb24gYXQgdGhlIHNwZWNpZmllZCByZWxhdGl2ZSBwYXRoLg0KICoNCiAqIFRoZSByZWxhdGl2ZSBwYXRoIGNhbiBlaXRoZXIgYmUgYSBzaW1wbGUgY2hpbGQgbmFtZSAoZm9yIGV4YW1wbGUsICJhZGEiKSBvcg0KICogYSBkZWVwZXIgc2xhc2gtc2VwYXJhdGVkIHBhdGggKGZvciBleGFtcGxlLCAiYWRhL25hbWUvZmlyc3QiKS4NCiAqDQogKiBAcGFyYW0gcGFyZW50IC0gVGhlIHBhcmVudCBsb2NhdGlvbi4NCiAqIEBwYXJhbSBwYXRoIC0gQSByZWxhdGl2ZSBwYXRoIGZyb20gdGhpcyBsb2NhdGlvbiB0byB0aGUgZGVzaXJlZCBjaGlsZA0KICogICBsb2NhdGlvbi4NCiAqIEByZXR1cm5zIFRoZSBzcGVjaWZpZWQgY2hpbGQgbG9jYXRpb24uDQogKi8NCmZ1bmN0aW9uIGNoaWxkKHBhcmVudCwgcGF0aCkgew0KICAgIHBhcmVudCA9IGdldE1vZHVsYXJJbnN0YW5jZShwYXJlbnQpOw0KICAgIGlmIChwYXRoR2V0RnJvbnQocGFyZW50Ll9wYXRoKSA9PT0gbnVsbCkgew0KICAgICAgICB2YWxpZGF0ZVJvb3RQYXRoU3RyaW5nKCdjaGlsZCcsICdwYXRoJywgcGF0aCwgZmFsc2UpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgdmFsaWRhdGVQYXRoU3RyaW5nKCdjaGlsZCcsICdwYXRoJywgcGF0aCwgZmFsc2UpOw0KICAgIH0NCiAgICByZXR1cm4gbmV3IFJlZmVyZW5jZUltcGwocGFyZW50Ll9yZXBvLCBwYXRoQ2hpbGQocGFyZW50Ll9wYXRoLCBwYXRoKSk7DQp9DQovKioNCiAqIFJlbW92ZXMgdGhlIGRhdGEgYXQgdGhpcyBEYXRhYmFzZSBsb2NhdGlvbi4NCiAqDQogKiBBbnkgZGF0YSBhdCBjaGlsZCBsb2NhdGlvbnMgd2lsbCBhbHNvIGJlIGRlbGV0ZWQuDQogKg0KICogVGhlIGVmZmVjdCBvZiB0aGUgcmVtb3ZlIHdpbGwgYmUgdmlzaWJsZSBpbW1lZGlhdGVseSBhbmQgdGhlIGNvcnJlc3BvbmRpbmcNCiAqIGV2ZW50ICd2YWx1ZScgd2lsbCBiZSB0cmlnZ2VyZWQuIFN5bmNocm9uaXphdGlvbiBvZiB0aGUgcmVtb3ZlIHRvIHRoZQ0KICogRmlyZWJhc2Ugc2VydmVycyB3aWxsIGFsc28gYmUgc3RhcnRlZCwgYW5kIHRoZSByZXR1cm5lZCBQcm9taXNlIHdpbGwgcmVzb2x2ZQ0KICogd2hlbiBjb21wbGV0ZS4gSWYgcHJvdmlkZWQsIHRoZSBvbkNvbXBsZXRlIGNhbGxiYWNrIHdpbGwgYmUgY2FsbGVkDQogKiBhc3luY2hyb25vdXNseSBhZnRlciBzeW5jaHJvbml6YXRpb24gaGFzIGZpbmlzaGVkLg0KICoNCiAqIEBwYXJhbSByZWYgLSBUaGUgbG9jYXRpb24gdG8gcmVtb3ZlLg0KICogQHJldHVybnMgUmVzb2x2ZXMgd2hlbiByZW1vdmUgb24gc2VydmVyIGlzIGNvbXBsZXRlLg0KICovDQpmdW5jdGlvbiByZW1vdmUocmVmKSB7DQogICAgdmFsaWRhdGVXcml0YWJsZVBhdGgoJ3JlbW92ZScsIHJlZi5fcGF0aCk7DQogICAgcmV0dXJuIHNldCQxKHJlZiwgbnVsbCk7DQp9DQovKioNCiAqIFdyaXRlcyBkYXRhIHRvIHRoaXMgRGF0YWJhc2UgbG9jYXRpb24uDQogKg0KICogVGhpcyB3aWxsIG92ZXJ3cml0ZSBhbnkgZGF0YSBhdCB0aGlzIGxvY2F0aW9uIGFuZCBhbGwgY2hpbGQgbG9jYXRpb25zLg0KICoNCiAqIFRoZSBlZmZlY3Qgb2YgdGhlIHdyaXRlIHdpbGwgYmUgdmlzaWJsZSBpbW1lZGlhdGVseSwgYW5kIHRoZSBjb3JyZXNwb25kaW5nDQogKiBldmVudHMgKCJ2YWx1ZSIsICJjaGlsZF9hZGRlZCIsIGV0Yy4pIHdpbGwgYmUgdHJpZ2dlcmVkLiBTeW5jaHJvbml6YXRpb24gb2YNCiAqIHRoZSBkYXRhIHRvIHRoZSBGaXJlYmFzZSBzZXJ2ZXJzIHdpbGwgYWxzbyBiZSBzdGFydGVkLCBhbmQgdGhlIHJldHVybmVkDQogKiBQcm9taXNlIHdpbGwgcmVzb2x2ZSB3aGVuIGNvbXBsZXRlLiBJZiBwcm92aWRlZCwgdGhlIGBvbkNvbXBsZXRlYCBjYWxsYmFjaw0KICogd2lsbCBiZSBjYWxsZWQgYXN5bmNocm9ub3VzbHkgYWZ0ZXIgc3luY2hyb25pemF0aW9uIGhhcyBmaW5pc2hlZC4NCiAqDQogKiBQYXNzaW5nIGBudWxsYCBmb3IgdGhlIG5ldyB2YWx1ZSBpcyBlcXVpdmFsZW50IHRvIGNhbGxpbmcgYHJlbW92ZSgpYDsgbmFtZWx5LA0KICogYWxsIGRhdGEgYXQgdGhpcyBsb2NhdGlvbiBhbmQgYWxsIGNoaWxkIGxvY2F0aW9ucyB3aWxsIGJlIGRlbGV0ZWQuDQogKg0KICogYHNldCgpYCB3aWxsIHJlbW92ZSBhbnkgcHJpb3JpdHkgc3RvcmVkIGF0IHRoaXMgbG9jYXRpb24sIHNvIGlmIHByaW9yaXR5IGlzDQogKiBtZWFudCB0byBiZSBwcmVzZXJ2ZWQsIHlvdSBuZWVkIHRvIHVzZSBgc2V0V2l0aFByaW9yaXR5KClgIGluc3RlYWQuDQogKg0KICogTm90ZSB0aGF0IG1vZGlmeWluZyBkYXRhIHdpdGggYHNldCgpYCB3aWxsIGNhbmNlbCBhbnkgcGVuZGluZyB0cmFuc2FjdGlvbnMNCiAqIGF0IHRoYXQgbG9jYXRpb24sIHNvIGV4dHJlbWUgY2FyZSBzaG91bGQgYmUgdGFrZW4gaWYgbWl4aW5nIGBzZXQoKWAgYW5kDQogKiBgdHJhbnNhY3Rpb24oKWAgdG8gbW9kaWZ5IHRoZSBzYW1lIGRhdGEuDQogKg0KICogQSBzaW5nbGUgYHNldCgpYCB3aWxsIGdlbmVyYXRlIGEgc2luZ2xlICJ2YWx1ZSIgZXZlbnQgYXQgdGhlIGxvY2F0aW9uIHdoZXJlDQogKiB0aGUgYHNldCgpYCB3YXMgcGVyZm9ybWVkLg0KICoNCiAqIEBwYXJhbSByZWYgLSBUaGUgbG9jYXRpb24gdG8gd3JpdGUgdG8uDQogKiBAcGFyYW0gdmFsdWUgLSBUaGUgdmFsdWUgdG8gYmUgd3JpdHRlbiAoc3RyaW5nLCBudW1iZXIsIGJvb2xlYW4sIG9iamVjdCwNCiAqICAgYXJyYXksIG9yIG51bGwpLg0KICogQHJldHVybnMgUmVzb2x2ZXMgd2hlbiB3cml0ZSB0byBzZXJ2ZXIgaXMgY29tcGxldGUuDQogKi8NCmZ1bmN0aW9uIHNldCQxKHJlZiwgdmFsdWUpIHsNCiAgICByZWYgPSBnZXRNb2R1bGFySW5zdGFuY2UocmVmKTsNCiAgICB2YWxpZGF0ZVdyaXRhYmxlUGF0aCgnc2V0JywgcmVmLl9wYXRoKTsNCiAgICB2YWxpZGF0ZUZpcmViYXNlRGF0YUFyZygnc2V0JywgdmFsdWUsIHJlZi5fcGF0aCwgZmFsc2UpOw0KICAgIGNvbnN0IGRlZmVycmVkID0gbmV3IERlZmVycmVkKCk7DQogICAgcmVwb1NldFdpdGhQcmlvcml0eShyZWYuX3JlcG8sIHJlZi5fcGF0aCwgdmFsdWUsIA0KICAgIC8qcHJpb3JpdHk9Ki8gbnVsbCwgZGVmZXJyZWQud3JhcENhbGxiYWNrKCgpID0+IHsgfSkpOw0KICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlOw0KfQ0KLyoqDQogKiBSZXByZXNlbnRzIHJlZ2lzdHJhdGlvbiBmb3IgJ3ZhbHVlJyBldmVudHMuDQogKi8NCmNsYXNzIFZhbHVlRXZlbnRSZWdpc3RyYXRpb24gew0KICAgIGNvbnN0cnVjdG9yKGNhbGxiYWNrQ29udGV4dCkgew0KICAgICAgICB0aGlzLmNhbGxiYWNrQ29udGV4dCA9IGNhbGxiYWNrQ29udGV4dDsNCiAgICB9DQogICAgcmVzcG9uZHNUbyhldmVudFR5cGUpIHsNCiAgICAgICAgcmV0dXJuIGV2ZW50VHlwZSA9PT0gJ3ZhbHVlJzsNCiAgICB9DQogICAgY3JlYXRlRXZlbnQoY2hhbmdlLCBxdWVyeSkgew0KICAgICAgICBjb25zdCBpbmRleCA9IHF1ZXJ5Ll9xdWVyeVBhcmFtcy5nZXRJbmRleCgpOw0KICAgICAgICByZXR1cm4gbmV3IERhdGFFdmVudCgndmFsdWUnLCB0aGlzLCBuZXcgRGF0YVNuYXBzaG90KGNoYW5nZS5zbmFwc2hvdE5vZGUsIG5ldyBSZWZlcmVuY2VJbXBsKHF1ZXJ5Ll9yZXBvLCBxdWVyeS5fcGF0aCksIGluZGV4KSk7DQogICAgfQ0KICAgIGdldEV2ZW50UnVubmVyKGV2ZW50RGF0YSkgew0KICAgICAgICBpZiAoZXZlbnREYXRhLmdldEV2ZW50VHlwZSgpID09PSAnY2FuY2VsJykgew0KICAgICAgICAgICAgcmV0dXJuICgpID0+IHRoaXMuY2FsbGJhY2tDb250ZXh0Lm9uQ2FuY2VsKGV2ZW50RGF0YS5lcnJvcik7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gKCkgPT4gdGhpcy5jYWxsYmFja0NvbnRleHQub25WYWx1ZShldmVudERhdGEuc25hcHNob3QsIG51bGwpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGNyZWF0ZUNhbmNlbEV2ZW50KGVycm9yLCBwYXRoKSB7DQogICAgICAgIGlmICh0aGlzLmNhbGxiYWNrQ29udGV4dC5oYXNDYW5jZWxDYWxsYmFjaykgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBDYW5jZWxFdmVudCh0aGlzLCBlcnJvciwgcGF0aCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBtYXRjaGVzKG90aGVyKSB7DQogICAgICAgIGlmICghKG90aGVyIGluc3RhbmNlb2YgVmFsdWVFdmVudFJlZ2lzdHJhdGlvbikpIHsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmICghb3RoZXIuY2FsbGJhY2tDb250ZXh0IHx8ICF0aGlzLmNhbGxiYWNrQ29udGV4dCkgew0KICAgICAgICAgICAgLy8gSWYgbm8gY2FsbGJhY2sgc3BlY2lmaWVkLCB3ZSBjb25zaWRlciBpdCB0byBtYXRjaCBhbnkgY2FsbGJhY2suDQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBvdGhlci5jYWxsYmFja0NvbnRleHQubWF0Y2hlcyh0aGlzLmNhbGxiYWNrQ29udGV4dCk7DQogICAgICAgIH0NCiAgICB9DQogICAgaGFzQW55Q2FsbGJhY2soKSB7DQogICAgICAgIHJldHVybiB0aGlzLmNhbGxiYWNrQ29udGV4dCAhPT0gbnVsbDsNCiAgICB9DQp9DQovKioNCiAqIFJlcHJlc2VudHMgdGhlIHJlZ2lzdHJhdGlvbiBvZiBhIGNoaWxkX3ggZXZlbnQuDQogKi8NCmNsYXNzIENoaWxkRXZlbnRSZWdpc3RyYXRpb24gew0KICAgIGNvbnN0cnVjdG9yKGV2ZW50VHlwZSwgY2FsbGJhY2tDb250ZXh0KSB7DQogICAgICAgIHRoaXMuZXZlbnRUeXBlID0gZXZlbnRUeXBlOw0KICAgICAgICB0aGlzLmNhbGxiYWNrQ29udGV4dCA9IGNhbGxiYWNrQ29udGV4dDsNCiAgICB9DQogICAgcmVzcG9uZHNUbyhldmVudFR5cGUpIHsNCiAgICAgICAgbGV0IGV2ZW50VG9DaGVjayA9IGV2ZW50VHlwZSA9PT0gJ2NoaWxkcmVuX2FkZGVkJyA/ICdjaGlsZF9hZGRlZCcgOiBldmVudFR5cGU7DQogICAgICAgIGV2ZW50VG9DaGVjayA9DQogICAgICAgICAgICBldmVudFRvQ2hlY2sgPT09ICdjaGlsZHJlbl9yZW1vdmVkJyA/ICdjaGlsZF9yZW1vdmVkJyA6IGV2ZW50VG9DaGVjazsNCiAgICAgICAgcmV0dXJuIHRoaXMuZXZlbnRUeXBlID09PSBldmVudFRvQ2hlY2s7DQogICAgfQ0KICAgIGNyZWF0ZUNhbmNlbEV2ZW50KGVycm9yLCBwYXRoKSB7DQogICAgICAgIGlmICh0aGlzLmNhbGxiYWNrQ29udGV4dC5oYXNDYW5jZWxDYWxsYmFjaykgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBDYW5jZWxFdmVudCh0aGlzLCBlcnJvciwgcGF0aCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBjcmVhdGVFdmVudChjaGFuZ2UsIHF1ZXJ5KSB7DQogICAgICAgIGFzc2VydChjaGFuZ2UuY2hpbGROYW1lICE9IG51bGwsICdDaGlsZCBldmVudHMgc2hvdWxkIGhhdmUgYSBjaGlsZE5hbWUuJyk7DQogICAgICAgIGNvbnN0IGNoaWxkUmVmID0gY2hpbGQobmV3IFJlZmVyZW5jZUltcGwocXVlcnkuX3JlcG8sIHF1ZXJ5Ll9wYXRoKSwgY2hhbmdlLmNoaWxkTmFtZSk7DQogICAgICAgIGNvbnN0IGluZGV4ID0gcXVlcnkuX3F1ZXJ5UGFyYW1zLmdldEluZGV4KCk7DQogICAgICAgIHJldHVybiBuZXcgRGF0YUV2ZW50KGNoYW5nZS50eXBlLCB0aGlzLCBuZXcgRGF0YVNuYXBzaG90KGNoYW5nZS5zbmFwc2hvdE5vZGUsIGNoaWxkUmVmLCBpbmRleCksIGNoYW5nZS5wcmV2TmFtZSk7DQogICAgfQ0KICAgIGdldEV2ZW50UnVubmVyKGV2ZW50RGF0YSkgew0KICAgICAgICBpZiAoZXZlbnREYXRhLmdldEV2ZW50VHlwZSgpID09PSAnY2FuY2VsJykgew0KICAgICAgICAgICAgcmV0dXJuICgpID0+IHRoaXMuY2FsbGJhY2tDb250ZXh0Lm9uQ2FuY2VsKGV2ZW50RGF0YS5lcnJvcik7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gKCkgPT4gdGhpcy5jYWxsYmFja0NvbnRleHQub25WYWx1ZShldmVudERhdGEuc25hcHNob3QsIGV2ZW50RGF0YS5wcmV2TmFtZSk7DQogICAgICAgIH0NCiAgICB9DQogICAgbWF0Y2hlcyhvdGhlcikgew0KICAgICAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBDaGlsZEV2ZW50UmVnaXN0cmF0aW9uKSB7DQogICAgICAgICAgICByZXR1cm4gKHRoaXMuZXZlbnRUeXBlID09PSBvdGhlci5ldmVudFR5cGUgJiYNCiAgICAgICAgICAgICAgICAoIXRoaXMuY2FsbGJhY2tDb250ZXh0IHx8DQogICAgICAgICAgICAgICAgICAgICFvdGhlci5jYWxsYmFja0NvbnRleHQgfHwNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYWxsYmFja0NvbnRleHQubWF0Y2hlcyhvdGhlci5jYWxsYmFja0NvbnRleHQpKSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBoYXNBbnlDYWxsYmFjaygpIHsNCiAgICAgICAgcmV0dXJuICEhdGhpcy5jYWxsYmFja0NvbnRleHQ7DQogICAgfQ0KfQ0KZnVuY3Rpb24gYWRkRXZlbnRMaXN0ZW5lciQxKHF1ZXJ5LCBldmVudFR5cGUsIGNhbGxiYWNrLCBjYW5jZWxDYWxsYmFja09yTGlzdGVuT3B0aW9ucywgb3B0aW9ucykgew0KICAgIGxldCBjYW5jZWxDYWxsYmFjazsNCiAgICBpZiAodHlwZW9mIGNhbmNlbENhbGxiYWNrT3JMaXN0ZW5PcHRpb25zID09PSAnb2JqZWN0Jykgew0KICAgICAgICBjYW5jZWxDYWxsYmFjayA9IHVuZGVmaW5lZDsNCiAgICAgICAgb3B0aW9ucyA9IGNhbmNlbENhbGxiYWNrT3JMaXN0ZW5PcHRpb25zOw0KICAgIH0NCiAgICBpZiAodHlwZW9mIGNhbmNlbENhbGxiYWNrT3JMaXN0ZW5PcHRpb25zID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgIGNhbmNlbENhbGxiYWNrID0gY2FuY2VsQ2FsbGJhY2tPckxpc3Rlbk9wdGlvbnM7DQogICAgfQ0KICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMub25seU9uY2UpIHsNCiAgICAgICAgY29uc3QgdXNlckNhbGxiYWNrID0gY2FsbGJhY2s7DQogICAgICAgIGNvbnN0IG9uY2VDYWxsYmFjayA9IChkYXRhU25hcHNob3QsIHByZXZpb3VzQ2hpbGROYW1lKSA9PiB7DQogICAgICAgICAgICByZXBvUmVtb3ZlRXZlbnRDYWxsYmFja0ZvclF1ZXJ5KHF1ZXJ5Ll9yZXBvLCBxdWVyeSwgY29udGFpbmVyKTsNCiAgICAgICAgICAgIHVzZXJDYWxsYmFjayhkYXRhU25hcHNob3QsIHByZXZpb3VzQ2hpbGROYW1lKTsNCiAgICAgICAgfTsNCiAgICAgICAgb25jZUNhbGxiYWNrLnVzZXJDYWxsYmFjayA9IGNhbGxiYWNrLnVzZXJDYWxsYmFjazsNCiAgICAgICAgb25jZUNhbGxiYWNrLmNvbnRleHQgPSBjYWxsYmFjay5jb250ZXh0Ow0KICAgICAgICBjYWxsYmFjayA9IG9uY2VDYWxsYmFjazsNCiAgICB9DQogICAgY29uc3QgY2FsbGJhY2tDb250ZXh0ID0gbmV3IENhbGxiYWNrQ29udGV4dChjYWxsYmFjaywgY2FuY2VsQ2FsbGJhY2sgfHwgdW5kZWZpbmVkKTsNCiAgICBjb25zdCBjb250YWluZXIgPSBldmVudFR5cGUgPT09ICd2YWx1ZScNCiAgICAgICAgPyBuZXcgVmFsdWVFdmVudFJlZ2lzdHJhdGlvbihjYWxsYmFja0NvbnRleHQpDQogICAgICAgIDogbmV3IENoaWxkRXZlbnRSZWdpc3RyYXRpb24oZXZlbnRUeXBlLCBjYWxsYmFja0NvbnRleHQpOw0KICAgIHJlcG9BZGRFdmVudENhbGxiYWNrRm9yUXVlcnkocXVlcnkuX3JlcG8sIHF1ZXJ5LCBjb250YWluZXIpOw0KICAgIHJldHVybiAoKSA9PiByZXBvUmVtb3ZlRXZlbnRDYWxsYmFja0ZvclF1ZXJ5KHF1ZXJ5Ll9yZXBvLCBxdWVyeSwgY29udGFpbmVyKTsNCn0NCmZ1bmN0aW9uIG9uVmFsdWUocXVlcnksIGNhbGxiYWNrLCBjYW5jZWxDYWxsYmFja09yTGlzdGVuT3B0aW9ucywgb3B0aW9ucykgew0KICAgIHJldHVybiBhZGRFdmVudExpc3RlbmVyJDEocXVlcnksICd2YWx1ZScsIGNhbGxiYWNrLCBjYW5jZWxDYWxsYmFja09yTGlzdGVuT3B0aW9ucywgb3B0aW9ucyk7DQp9DQovKioNCiAqIERlZmluZSByZWZlcmVuY2UgY29uc3RydWN0b3IgaW4gdmFyaW91cyBtb2R1bGVzDQogKg0KICogV2UgYXJlIGRvaW5nIHRoaXMgaGVyZSB0byBhdm9pZCBzZXZlcmFsIGNpcmN1bGFyDQogKiBkZXBlbmRlbmN5IGlzc3Vlcw0KICovDQpzeW5jUG9pbnRTZXRSZWZlcmVuY2VDb25zdHJ1Y3RvcihSZWZlcmVuY2VJbXBsKTsNCnN5bmNUcmVlU2V0UmVmZXJlbmNlQ29uc3RydWN0b3IoUmVmZXJlbmNlSW1wbCk7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIFRoaXMgdmFyaWFibGUgaXMgYWxzbyBkZWZpbmVkIGluIHRoZSBmaXJlYmFzZSBOb2RlLmpzIEFkbWluIFNESy4gQmVmb3JlDQogKiBtb2RpZnlpbmcgdGhpcyBkZWZpbml0aW9uLCBjb25zdWx0IHRoZSBkZWZpbml0aW9uIGluOg0KICoNCiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9maXJlYmFzZS9maXJlYmFzZS1hZG1pbi1ub2RlDQogKg0KICogYW5kIG1ha2Ugc3VyZSB0aGUgdHdvIGFyZSBjb25zaXN0ZW50Lg0KICovDQpjb25zdCBGSVJFQkFTRV9EQVRBQkFTRV9FTVVMQVRPUl9IT1NUX1ZBUiA9ICdGSVJFQkFTRV9EQVRBQkFTRV9FTVVMQVRPUl9IT1NUJzsNCi8qKg0KICogQ3JlYXRlcyBhbmQgY2FjaGVzIGBSZXBvYCBpbnN0YW5jZXMuDQogKi8NCmNvbnN0IHJlcG9zID0ge307DQovKioNCiAqIElmIHRydWUsIGFueSBuZXcgYFJlcG9gIHdpbGwgYmUgY3JlYXRlZCB0byB1c2UgYFJlYWRvbmx5UmVzdENsaWVudGAgKGZvciB0ZXN0aW5nIHB1cnBvc2VzKS4NCiAqLw0KbGV0IHVzZVJlc3RDbGllbnQgPSBmYWxzZTsNCi8qKg0KICogVXBkYXRlIGFuIGV4aXN0aW5nIGBSZXBvYCBpbiBwbGFjZSB0byBwb2ludCB0byBhIG5ldyBob3N0L3BvcnQuDQogKi8NCmZ1bmN0aW9uIHJlcG9NYW5hZ2VyQXBwbHlFbXVsYXRvclNldHRpbmdzKHJlcG8sIGhvc3QsIHBvcnQsIHRva2VuUHJvdmlkZXIpIHsNCiAgICByZXBvLnJlcG9JbmZvXyA9IG5ldyBSZXBvSW5mbyhgJHtob3N0fToke3BvcnR9YCwgDQogICAgLyogc2VjdXJlPSAqLyBmYWxzZSwgcmVwby5yZXBvSW5mb18ubmFtZXNwYWNlLCByZXBvLnJlcG9JbmZvXy53ZWJTb2NrZXRPbmx5LCByZXBvLnJlcG9JbmZvXy5ub2RlQWRtaW4sIHJlcG8ucmVwb0luZm9fLnBlcnNpc3RlbmNlS2V5LCByZXBvLnJlcG9JbmZvXy5pbmNsdWRlTmFtZXNwYWNlSW5RdWVyeVBhcmFtcywgDQogICAgLyppc1VzaW5nRW11bGF0b3I9Ki8gdHJ1ZSk7DQogICAgaWYgKHRva2VuUHJvdmlkZXIpIHsNCiAgICAgICAgcmVwby5hdXRoVG9rZW5Qcm92aWRlcl8gPSB0b2tlblByb3ZpZGVyOw0KICAgIH0NCn0NCi8qKg0KICogVGhpcyBmdW5jdGlvbiBzaG91bGQgb25seSBldmVyIGJlIGNhbGxlZCB0byBDUkVBVEUgYSBuZXcgZGF0YWJhc2UgaW5zdGFuY2UuDQogKiBAaW50ZXJuYWwNCiAqLw0KZnVuY3Rpb24gcmVwb01hbmFnZXJEYXRhYmFzZUZyb21BcHAoYXBwLCBhdXRoUHJvdmlkZXIsIGFwcENoZWNrUHJvdmlkZXIsIHVybCwgbm9kZUFkbWluKSB7DQogICAgbGV0IGRiVXJsID0gdXJsIHx8IGFwcC5vcHRpb25zLmRhdGFiYXNlVVJMOw0KICAgIGlmIChkYlVybCA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgIGlmICghYXBwLm9wdGlvbnMucHJvamVjdElkKSB7DQogICAgICAgICAgICBmYXRhbCgiQ2FuJ3QgZGV0ZXJtaW5lIEZpcmViYXNlIERhdGFiYXNlIFVSTC4gQmUgc3VyZSB0byBpbmNsdWRlICIgKw0KICAgICAgICAgICAgICAgICcgYSBQcm9qZWN0IElEIHdoZW4gY2FsbGluZyBmaXJlYmFzZS5pbml0aWFsaXplQXBwKCkuJyk7DQogICAgICAgIH0NCiAgICAgICAgbG9nKCdVc2luZyBkZWZhdWx0IGhvc3QgZm9yIHByb2plY3QgJywgYXBwLm9wdGlvbnMucHJvamVjdElkKTsNCiAgICAgICAgZGJVcmwgPSBgJHthcHAub3B0aW9ucy5wcm9qZWN0SWR9LWRlZmF1bHQtcnRkYi5maXJlYmFzZWlvLmNvbWA7DQogICAgfQ0KICAgIGxldCBwYXJzZWRVcmwgPSBwYXJzZVJlcG9JbmZvKGRiVXJsLCBub2RlQWRtaW4pOw0KICAgIGxldCByZXBvSW5mbyA9IHBhcnNlZFVybC5yZXBvSW5mbzsNCiAgICBsZXQgaXNFbXVsYXRvcjsNCiAgICBsZXQgZGJFbXVsYXRvckhvc3QgPSB1bmRlZmluZWQ7DQogICAgaWYgKHR5cGVvZiBwcm9jZXNzICE9PSAndW5kZWZpbmVkJyAmJiBwcm9jZXNzLmVudikgew0KICAgICAgICBkYkVtdWxhdG9ySG9zdCA9IHByb2Nlc3MuZW52W0ZJUkVCQVNFX0RBVEFCQVNFX0VNVUxBVE9SX0hPU1RfVkFSXTsNCiAgICB9DQogICAgaWYgKGRiRW11bGF0b3JIb3N0KSB7DQogICAgICAgIGlzRW11bGF0b3IgPSB0cnVlOw0KICAgICAgICBkYlVybCA9IGBodHRwOi8vJHtkYkVtdWxhdG9ySG9zdH0/bnM9JHtyZXBvSW5mby5uYW1lc3BhY2V9YDsNCiAgICAgICAgcGFyc2VkVXJsID0gcGFyc2VSZXBvSW5mbyhkYlVybCwgbm9kZUFkbWluKTsNCiAgICAgICAgcmVwb0luZm8gPSBwYXJzZWRVcmwucmVwb0luZm87DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBpc0VtdWxhdG9yID0gIXBhcnNlZFVybC5yZXBvSW5mby5zZWN1cmU7DQogICAgfQ0KICAgIGNvbnN0IGF1dGhUb2tlblByb3ZpZGVyID0gbm9kZUFkbWluICYmIGlzRW11bGF0b3INCiAgICAgICAgPyBuZXcgRW11bGF0b3JUb2tlblByb3ZpZGVyKEVtdWxhdG9yVG9rZW5Qcm92aWRlci5PV05FUikNCiAgICAgICAgOiBuZXcgRmlyZWJhc2VBdXRoVG9rZW5Qcm92aWRlcihhcHAubmFtZSwgYXBwLm9wdGlvbnMsIGF1dGhQcm92aWRlcik7DQogICAgdmFsaWRhdGVVcmwoJ0ludmFsaWQgRmlyZWJhc2UgRGF0YWJhc2UgVVJMJywgcGFyc2VkVXJsKTsNCiAgICBpZiAoIXBhdGhJc0VtcHR5KHBhcnNlZFVybC5wYXRoKSkgew0KICAgICAgICBmYXRhbCgnRGF0YWJhc2UgVVJMIG11c3QgcG9pbnQgdG8gdGhlIHJvb3Qgb2YgYSBGaXJlYmFzZSBEYXRhYmFzZSAnICsNCiAgICAgICAgICAgICcobm90IGluY2x1ZGluZyBhIGNoaWxkIHBhdGgpLicpOw0KICAgIH0NCiAgICBjb25zdCByZXBvID0gcmVwb01hbmFnZXJDcmVhdGVSZXBvKHJlcG9JbmZvLCBhcHAsIGF1dGhUb2tlblByb3ZpZGVyLCBuZXcgQXBwQ2hlY2tUb2tlblByb3ZpZGVyKGFwcC5uYW1lLCBhcHBDaGVja1Byb3ZpZGVyKSk7DQogICAgcmV0dXJuIG5ldyBEYXRhYmFzZShyZXBvLCBhcHApOw0KfQ0KLyoqDQogKiBSZW1vdmUgdGhlIHJlcG8gYW5kIG1ha2Ugc3VyZSBpdCBpcyBkaXNjb25uZWN0ZWQuDQogKg0KICovDQpmdW5jdGlvbiByZXBvTWFuYWdlckRlbGV0ZVJlcG8ocmVwbywgYXBwTmFtZSkgew0KICAgIGNvbnN0IGFwcFJlcG9zID0gcmVwb3NbYXBwTmFtZV07DQogICAgLy8gVGhpcyBzaG91bGQgbmV2ZXIgaGFwcGVuLi4uDQogICAgaWYgKCFhcHBSZXBvcyB8fCBhcHBSZXBvc1tyZXBvLmtleV0gIT09IHJlcG8pIHsNCiAgICAgICAgZmF0YWwoYERhdGFiYXNlICR7YXBwTmFtZX0oJHtyZXBvLnJlcG9JbmZvX30pIGhhcyBhbHJlYWR5IGJlZW4gZGVsZXRlZC5gKTsNCiAgICB9DQogICAgcmVwb0ludGVycnVwdChyZXBvKTsNCiAgICBkZWxldGUgYXBwUmVwb3NbcmVwby5rZXldOw0KfQ0KLyoqDQogKiBFbnN1cmVzIGEgcmVwbyBkb2Vzbid0IGFscmVhZHkgZXhpc3QgYW5kIHRoZW4gY3JlYXRlcyBvbmUgdXNpbmcgdGhlDQogKiBwcm92aWRlZCBhcHAuDQogKg0KICogQHBhcmFtIHJlcG9JbmZvIC0gVGhlIG1ldGFkYXRhIGFib3V0IHRoZSBSZXBvDQogKiBAcmV0dXJucyBUaGUgUmVwbyBvYmplY3QgZm9yIHRoZSBzcGVjaWZpZWQgc2VydmVyIC8gcmVwb05hbWUuDQogKi8NCmZ1bmN0aW9uIHJlcG9NYW5hZ2VyQ3JlYXRlUmVwbyhyZXBvSW5mbywgYXBwLCBhdXRoVG9rZW5Qcm92aWRlciwgYXBwQ2hlY2tQcm92aWRlcikgew0KICAgIGxldCBhcHBSZXBvcyA9IHJlcG9zW2FwcC5uYW1lXTsNCiAgICBpZiAoIWFwcFJlcG9zKSB7DQogICAgICAgIGFwcFJlcG9zID0ge307DQogICAgICAgIHJlcG9zW2FwcC5uYW1lXSA9IGFwcFJlcG9zOw0KICAgIH0NCiAgICBsZXQgcmVwbyA9IGFwcFJlcG9zW3JlcG9JbmZvLnRvVVJMU3RyaW5nKCldOw0KICAgIGlmIChyZXBvKSB7DQogICAgICAgIGZhdGFsKCdEYXRhYmFzZSBpbml0aWFsaXplZCBtdWx0aXBsZSB0aW1lcy4gUGxlYXNlIG1ha2Ugc3VyZSB0aGUgZm9ybWF0IG9mIHRoZSBkYXRhYmFzZSBVUkwgbWF0Y2hlcyB3aXRoIGVhY2ggZGF0YWJhc2UoKSBjYWxsLicpOw0KICAgIH0NCiAgICByZXBvID0gbmV3IFJlcG8ocmVwb0luZm8sIHVzZVJlc3RDbGllbnQsIGF1dGhUb2tlblByb3ZpZGVyLCBhcHBDaGVja1Byb3ZpZGVyKTsNCiAgICBhcHBSZXBvc1tyZXBvSW5mby50b1VSTFN0cmluZygpXSA9IHJlcG87DQogICAgcmV0dXJuIHJlcG87DQp9DQovKioNCiAqIENsYXNzIHJlcHJlc2VudGluZyBhIEZpcmViYXNlIFJlYWx0aW1lIERhdGFiYXNlLg0KICovDQpjbGFzcyBEYXRhYmFzZSB7DQogICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi8NCiAgICBjb25zdHJ1Y3RvcihfcmVwb0ludGVybmFsLCANCiAgICAvKiogVGhlIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlQXBwfSBhc3NvY2lhdGVkIHdpdGggdGhpcyBSZWFsdGltZSBEYXRhYmFzZSBpbnN0YW5jZS4gKi8NCiAgICBhcHApIHsNCiAgICAgICAgdGhpcy5fcmVwb0ludGVybmFsID0gX3JlcG9JbnRlcm5hbDsNCiAgICAgICAgdGhpcy5hcHAgPSBhcHA7DQogICAgICAgIC8qKiBSZXByZXNlbnRzIGEgYERhdGFiYXNlYCBpbnN0YW5jZS4gKi8NCiAgICAgICAgdGhpc1sndHlwZSddID0gJ2RhdGFiYXNlJzsNCiAgICAgICAgLyoqIFRyYWNrIGlmIHRoZSBpbnN0YW5jZSBoYXMgYmVlbiB1c2VkIChyb290IG9yIHJlcG8gYWNjZXNzZWQpICovDQogICAgICAgIHRoaXMuX2luc3RhbmNlU3RhcnRlZCA9IGZhbHNlOw0KICAgIH0NCiAgICBnZXQgX3JlcG8oKSB7DQogICAgICAgIGlmICghdGhpcy5faW5zdGFuY2VTdGFydGVkKSB7DQogICAgICAgICAgICByZXBvU3RhcnQodGhpcy5fcmVwb0ludGVybmFsLCB0aGlzLmFwcC5vcHRpb25zLmFwcElkLCB0aGlzLmFwcC5vcHRpb25zWydkYXRhYmFzZUF1dGhWYXJpYWJsZU92ZXJyaWRlJ10pOw0KICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VTdGFydGVkID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpcy5fcmVwb0ludGVybmFsOw0KICAgIH0NCiAgICBnZXQgX3Jvb3QoKSB7DQogICAgICAgIGlmICghdGhpcy5fcm9vdEludGVybmFsKSB7DQogICAgICAgICAgICB0aGlzLl9yb290SW50ZXJuYWwgPSBuZXcgUmVmZXJlbmNlSW1wbCh0aGlzLl9yZXBvLCBuZXdFbXB0eVBhdGgoKSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXMuX3Jvb3RJbnRlcm5hbDsNCiAgICB9DQogICAgX2RlbGV0ZSgpIHsNCiAgICAgICAgaWYgKHRoaXMuX3Jvb3RJbnRlcm5hbCAhPT0gbnVsbCkgew0KICAgICAgICAgICAgcmVwb01hbmFnZXJEZWxldGVSZXBvKHRoaXMuX3JlcG8sIHRoaXMuYXBwLm5hbWUpOw0KICAgICAgICAgICAgdGhpcy5fcmVwb0ludGVybmFsID0gbnVsbDsNCiAgICAgICAgICAgIHRoaXMuX3Jvb3RJbnRlcm5hbCA9IG51bGw7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOw0KICAgIH0NCiAgICBfY2hlY2tOb3REZWxldGVkKGFwaU5hbWUpIHsNCiAgICAgICAgaWYgKHRoaXMuX3Jvb3RJbnRlcm5hbCA9PT0gbnVsbCkgew0KICAgICAgICAgICAgZmF0YWwoJ0Nhbm5vdCBjYWxsICcgKyBhcGlOYW1lICsgJyBvbiBhIGRlbGV0ZWQgZGF0YWJhc2UuJyk7DQogICAgICAgIH0NCiAgICB9DQp9DQovKioNCiAqIFJldHVybnMgdGhlIGluc3RhbmNlIG9mIHRoZSBSZWFsdGltZSBEYXRhYmFzZSBTREsgdGhhdCBpcyBhc3NvY2lhdGVkDQogKiB3aXRoIHRoZSBwcm92aWRlZCB7QGxpbmsgQGZpcmViYXNlL2FwcCNGaXJlYmFzZUFwcH0uIEluaXRpYWxpemVzIGEgbmV3IGluc3RhbmNlIHdpdGgNCiAqIHdpdGggZGVmYXVsdCBzZXR0aW5ncyBpZiBubyBpbnN0YW5jZSBleGlzdHMgb3IgaWYgdGhlIGV4aXN0aW5nIGluc3RhbmNlIHVzZXMNCiAqIGEgY3VzdG9tIGRhdGFiYXNlIFVSTC4NCiAqDQogKiBAcGFyYW0gYXBwIC0gVGhlIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlQXBwfSBpbnN0YW5jZSB0aGF0IHRoZSByZXR1cm5lZCBSZWFsdGltZQ0KICogRGF0YWJhc2UgaW5zdGFuY2UgaXMgYXNzb2NpYXRlZCB3aXRoLg0KICogQHBhcmFtIHVybCAtIFRoZSBVUkwgb2YgdGhlIFJlYWx0aW1lIERhdGFiYXNlIGluc3RhbmNlIHRvIGNvbm5lY3QgdG8uIElmIG5vdA0KICogcHJvdmlkZWQsIHRoZSBTREsgY29ubmVjdHMgdG8gdGhlIGRlZmF1bHQgaW5zdGFuY2Ugb2YgdGhlIEZpcmViYXNlIEFwcC4NCiAqIEByZXR1cm5zIFRoZSBgRGF0YWJhc2VgIGluc3RhbmNlIG9mIHRoZSBwcm92aWRlZCBhcHAuDQogKi8NCmZ1bmN0aW9uIGdldERhdGFiYXNlKGFwcCA9IGdldEFwcCgpLCB1cmwpIHsNCiAgICBjb25zdCBkYiA9IF9nZXRQcm92aWRlcihhcHAsICdkYXRhYmFzZScpLmdldEltbWVkaWF0ZSh7DQogICAgICAgIGlkZW50aWZpZXI6IHVybA0KICAgIH0pOw0KICAgIGlmICghZGIuX2luc3RhbmNlU3RhcnRlZCkgew0KICAgICAgICBjb25zdCBlbXVsYXRvciA9IGdldERlZmF1bHRFbXVsYXRvckhvc3RuYW1lQW5kUG9ydCgnZGF0YWJhc2UnKTsNCiAgICAgICAgaWYgKGVtdWxhdG9yKSB7DQogICAgICAgICAgICBjb25uZWN0RGF0YWJhc2VFbXVsYXRvcihkYiwgLi4uZW11bGF0b3IpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBkYjsNCn0NCi8qKg0KICogTW9kaWZ5IHRoZSBwcm92aWRlZCBpbnN0YW5jZSB0byBjb21tdW5pY2F0ZSB3aXRoIHRoZSBSZWFsdGltZSBEYXRhYmFzZQ0KICogZW11bGF0b3IuDQogKg0KICogPHA+Tm90ZTogVGhpcyBtZXRob2QgbXVzdCBiZSBjYWxsZWQgYmVmb3JlIHBlcmZvcm1pbmcgYW55IG90aGVyIG9wZXJhdGlvbi4NCiAqDQogKiBAcGFyYW0gZGIgLSBUaGUgaW5zdGFuY2UgdG8gbW9kaWZ5Lg0KICogQHBhcmFtIGhvc3QgLSBUaGUgZW11bGF0b3IgaG9zdCAoZXg6IGxvY2FsaG9zdCkNCiAqIEBwYXJhbSBwb3J0IC0gVGhlIGVtdWxhdG9yIHBvcnQgKGV4OiA4MDgwKQ0KICogQHBhcmFtIG9wdGlvbnMubW9ja1VzZXJUb2tlbiAtIHRoZSBtb2NrIGF1dGggdG9rZW4gdG8gdXNlIGZvciB1bml0IHRlc3RpbmcgU2VjdXJpdHkgUnVsZXMNCiAqLw0KZnVuY3Rpb24gY29ubmVjdERhdGFiYXNlRW11bGF0b3IoZGIsIGhvc3QsIHBvcnQsIG9wdGlvbnMgPSB7fSkgew0KICAgIGRiID0gZ2V0TW9kdWxhckluc3RhbmNlKGRiKTsNCiAgICBkYi5fY2hlY2tOb3REZWxldGVkKCd1c2VFbXVsYXRvcicpOw0KICAgIGlmIChkYi5faW5zdGFuY2VTdGFydGVkKSB7DQogICAgICAgIGZhdGFsKCdDYW5ub3QgY2FsbCB1c2VFbXVsYXRvcigpIGFmdGVyIGluc3RhbmNlIGhhcyBhbHJlYWR5IGJlZW4gaW5pdGlhbGl6ZWQuJyk7DQogICAgfQ0KICAgIGNvbnN0IHJlcG8gPSBkYi5fcmVwb0ludGVybmFsOw0KICAgIGxldCB0b2tlblByb3ZpZGVyID0gdW5kZWZpbmVkOw0KICAgIGlmIChyZXBvLnJlcG9JbmZvXy5ub2RlQWRtaW4pIHsNCiAgICAgICAgaWYgKG9wdGlvbnMubW9ja1VzZXJUb2tlbikgew0KICAgICAgICAgICAgZmF0YWwoJ21vY2tVc2VyVG9rZW4gaXMgbm90IHN1cHBvcnRlZCBieSB0aGUgQWRtaW4gU0RLLiBGb3IgY2xpZW50IGFjY2VzcyB3aXRoIG1vY2sgdXNlcnMsIHBsZWFzZSB1c2UgdGhlICJmaXJlYmFzZSIgcGFja2FnZSBpbnN0ZWFkIG9mICJmaXJlYmFzZS1hZG1pbiIuJyk7DQogICAgICAgIH0NCiAgICAgICAgdG9rZW5Qcm92aWRlciA9IG5ldyBFbXVsYXRvclRva2VuUHJvdmlkZXIoRW11bGF0b3JUb2tlblByb3ZpZGVyLk9XTkVSKTsNCiAgICB9DQogICAgZWxzZSBpZiAob3B0aW9ucy5tb2NrVXNlclRva2VuKSB7DQogICAgICAgIGNvbnN0IHRva2VuID0gdHlwZW9mIG9wdGlvbnMubW9ja1VzZXJUb2tlbiA9PT0gJ3N0cmluZycNCiAgICAgICAgICAgID8gb3B0aW9ucy5tb2NrVXNlclRva2VuDQogICAgICAgICAgICA6IGNyZWF0ZU1vY2tVc2VyVG9rZW4ob3B0aW9ucy5tb2NrVXNlclRva2VuLCBkYi5hcHAub3B0aW9ucy5wcm9qZWN0SWQpOw0KICAgICAgICB0b2tlblByb3ZpZGVyID0gbmV3IEVtdWxhdG9yVG9rZW5Qcm92aWRlcih0b2tlbik7DQogICAgfQ0KICAgIC8vIE1vZGlmeSB0aGUgcmVwbyB0byBhcHBseSBlbXVsYXRvciBzZXR0aW5ncw0KICAgIHJlcG9NYW5hZ2VyQXBwbHlFbXVsYXRvclNldHRpbmdzKHJlcG8sIGhvc3QsIHBvcnQsIHRva2VuUHJvdmlkZXIpOw0KfQ0KLyoqDQogKiBEaXNjb25uZWN0cyBmcm9tIHRoZSBzZXJ2ZXIgKGFsbCBEYXRhYmFzZSBvcGVyYXRpb25zIHdpbGwgYmUgY29tcGxldGVkDQogKiBvZmZsaW5lKS4NCiAqDQogKiBUaGUgY2xpZW50IGF1dG9tYXRpY2FsbHkgbWFpbnRhaW5zIGEgcGVyc2lzdGVudCBjb25uZWN0aW9uIHRvIHRoZSBEYXRhYmFzZQ0KICogc2VydmVyLCB3aGljaCB3aWxsIHJlbWFpbiBhY3RpdmUgaW5kZWZpbml0ZWx5IGFuZCByZWNvbm5lY3Qgd2hlbg0KICogZGlzY29ubmVjdGVkLiBIb3dldmVyLCB0aGUgYGdvT2ZmbGluZSgpYCBhbmQgYGdvT25saW5lKClgIG1ldGhvZHMgbWF5IGJlIHVzZWQNCiAqIHRvIGNvbnRyb2wgdGhlIGNsaWVudCBjb25uZWN0aW9uIGluIGNhc2VzIHdoZXJlIGEgcGVyc2lzdGVudCBjb25uZWN0aW9uIGlzDQogKiB1bmRlc2lyYWJsZS4NCiAqDQogKiBXaGlsZSBvZmZsaW5lLCB0aGUgY2xpZW50IHdpbGwgbm8gbG9uZ2VyIHJlY2VpdmUgZGF0YSB1cGRhdGVzIGZyb20gdGhlDQogKiBEYXRhYmFzZS4gSG93ZXZlciwgYWxsIERhdGFiYXNlIG9wZXJhdGlvbnMgcGVyZm9ybWVkIGxvY2FsbHkgd2lsbCBjb250aW51ZSB0bw0KICogaW1tZWRpYXRlbHkgZmlyZSBldmVudHMsIGFsbG93aW5nIHlvdXIgYXBwbGljYXRpb24gdG8gY29udGludWUgYmVoYXZpbmcNCiAqIG5vcm1hbGx5LiBBZGRpdGlvbmFsbHksIGVhY2ggb3BlcmF0aW9uIHBlcmZvcm1lZCBsb2NhbGx5IHdpbGwgYXV0b21hdGljYWxseQ0KICogYmUgcXVldWVkIGFuZCByZXRyaWVkIHVwb24gcmVjb25uZWN0aW9uIHRvIHRoZSBEYXRhYmFzZSBzZXJ2ZXIuDQogKg0KICogVG8gcmVjb25uZWN0IHRvIHRoZSBEYXRhYmFzZSBhbmQgYmVnaW4gcmVjZWl2aW5nIHJlbW90ZSBldmVudHMsIHNlZQ0KICogYGdvT25saW5lKClgLg0KICoNCiAqIEBwYXJhbSBkYiAtIFRoZSBpbnN0YW5jZSB0byBkaXNjb25uZWN0Lg0KICovDQpmdW5jdGlvbiBnb09mZmxpbmUoZGIpIHsNCiAgICBkYiA9IGdldE1vZHVsYXJJbnN0YW5jZShkYik7DQogICAgZGIuX2NoZWNrTm90RGVsZXRlZCgnZ29PZmZsaW5lJyk7DQogICAgcmVwb0ludGVycnVwdChkYi5fcmVwbyk7DQp9DQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KZnVuY3Rpb24gcmVnaXN0ZXJEYXRhYmFzZSh2YXJpYW50KSB7DQogICAgc2V0U0RLVmVyc2lvbihTREtfVkVSU0lPTiQxKTsNCiAgICBfcmVnaXN0ZXJDb21wb25lbnQobmV3IENvbXBvbmVudCgnZGF0YWJhc2UnLCAoY29udGFpbmVyLCB7IGluc3RhbmNlSWRlbnRpZmllcjogdXJsIH0pID0+IHsNCiAgICAgICAgY29uc3QgYXBwID0gY29udGFpbmVyLmdldFByb3ZpZGVyKCdhcHAnKS5nZXRJbW1lZGlhdGUoKTsNCiAgICAgICAgY29uc3QgYXV0aFByb3ZpZGVyID0gY29udGFpbmVyLmdldFByb3ZpZGVyKCdhdXRoLWludGVybmFsJyk7DQogICAgICAgIGNvbnN0IGFwcENoZWNrUHJvdmlkZXIgPSBjb250YWluZXIuZ2V0UHJvdmlkZXIoJ2FwcC1jaGVjay1pbnRlcm5hbCcpOw0KICAgICAgICByZXR1cm4gcmVwb01hbmFnZXJEYXRhYmFzZUZyb21BcHAoYXBwLCBhdXRoUHJvdmlkZXIsIGFwcENoZWNrUHJvdmlkZXIsIHVybCk7DQogICAgfSwgIlBVQkxJQyIgLyogQ29tcG9uZW50VHlwZS5QVUJMSUMgKi8pLnNldE11bHRpcGxlSW5zdGFuY2VzKHRydWUpKTsNCiAgICByZWdpc3RlclZlcnNpb24obmFtZSRJLCB2ZXJzaW9uJDQsIHZhcmlhbnQpOw0KICAgIC8vIEJVSUxEX1RBUkdFVCB3aWxsIGJlIHJlcGxhY2VkIGJ5IHZhbHVlcyBsaWtlIGVzbTUsIGVzbTIwMTcsIGNqczUsIGV0YyBkdXJpbmcgdGhlIGNvbXBpbGF0aW9uDQogICAgcmVnaXN0ZXJWZXJzaW9uKG5hbWUkSSwgdmVyc2lvbiQ0LCAnZXNtMjAxNycpOw0KfQovLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KUGVyc2lzdGVudENvbm5lY3Rpb24ucHJvdG90eXBlLnNpbXBsZUxpc3RlbiA9IGZ1bmN0aW9uIChwYXRoU3RyaW5nLCBvbkNvbXBsZXRlKSB7DQogICAgdGhpcy5zZW5kUmVxdWVzdCgncScsIHsgcDogcGF0aFN0cmluZyB9LCBvbkNvbXBsZXRlKTsNCn07DQovLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KUGVyc2lzdGVudENvbm5lY3Rpb24ucHJvdG90eXBlLmVjaG8gPSBmdW5jdGlvbiAoZGF0YSwgb25FY2hvKSB7DQogICAgdGhpcy5zZW5kUmVxdWVzdCgnZWNobycsIHsgZDogZGF0YSB9LCBvbkVjaG8pOw0KfTsNCgovKioNCiAqIEZpcmViYXNlIFJlYWx0aW1lIERhdGFiYXNlDQogKg0KICogQHBhY2thZ2VEb2N1bWVudGF0aW9uDQogKi8NCnJlZ2lzdGVyRGF0YWJhc2UoKTsKCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uCgpQZXJtaXNzaW9uIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBhbmQvb3IgZGlzdHJpYnV0ZSB0aGlzIHNvZnR3YXJlIGZvciBhbnkKcHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLgoKVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEgKUkVHQVJEIFRPIFRISVMgU09GVFdBUkUgSU5DTFVESU5HIEFMTCBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZCkFORCBGSVRORVNTLiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SIEJFIExJQUJMRSBGT1IgQU5ZIFNQRUNJQUwsIERJUkVDVCwKSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NCkxPU1MgT0YgVVNFLCBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBORUdMSUdFTkNFIE9SCk9USEVSIFRPUlRJT1VTIEFDVElPTiwgQVJJU0lORyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBVU0UgT1IKUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS4KKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi8KLyogZ2xvYmFsIFJlZmxlY3QsIFByb21pc2UsIFN1cHByZXNzZWRFcnJvciwgU3ltYm9sICovCgp2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uKGQsIGIpIHsKICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CiAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsIHApKSBkW3BdID0gYltwXTsgfTsKICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKfTsKCmZ1bmN0aW9uIF9fZXh0ZW5kcyhkLCBiKSB7CiAgaWYgKHR5cGVvZiBiICE9PSAiZnVuY3Rpb24iICYmIGIgIT09IG51bGwpCiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNsYXNzIGV4dGVuZHMgdmFsdWUgIiArIFN0cmluZyhiKSArICIgaXMgbm90IGEgY29uc3RydWN0b3Igb3IgbnVsbCIpOwogIGV4dGVuZFN0YXRpY3MoZCwgYik7CiAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CiAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwp9Cgp2YXIgX19hc3NpZ24gPSBmdW5jdGlvbigpIHsKICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gX19hc3NpZ24odCkgewogICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07CiAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpIHRbcF0gPSBzW3BdOwogICAgICB9CiAgICAgIHJldHVybiB0OwogIH07CiAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn07CgpmdW5jdGlvbiBfX3Jlc3QocywgZSkgewogIHZhciB0ID0ge307CiAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApICYmIGUuaW5kZXhPZihwKSA8IDApCiAgICAgIHRbcF0gPSBzW3BdOwogIGlmIChzICE9IG51bGwgJiYgdHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPT09ICJmdW5jdGlvbiIpCiAgICAgIGZvciAodmFyIGkgPSAwLCBwID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzKTsgaSA8IHAubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmIChlLmluZGV4T2YocFtpXSkgPCAwICYmIE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChzLCBwW2ldKSkKICAgICAgICAgICAgICB0W3BbaV1dID0gc1twW2ldXTsKICAgICAgfQogIHJldHVybiB0Owp9CgpmdW5jdGlvbiBfX2RlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7CiAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDsKICBpZiAodHlwZW9mIFJlZmxlY3QgPT09ICJvYmplY3QiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSAiZnVuY3Rpb24iKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7CiAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjsKICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByOwp9CgpmdW5jdGlvbiBfX3BhcmFtKHBhcmFtSW5kZXgsIGRlY29yYXRvcikgewogIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBrZXkpIHsgZGVjb3JhdG9yKHRhcmdldCwga2V5LCBwYXJhbUluZGV4KTsgfQp9CgpmdW5jdGlvbiBfX2VzRGVjb3JhdGUoY3RvciwgZGVzY3JpcHRvckluLCBkZWNvcmF0b3JzLCBjb250ZXh0SW4sIGluaXRpYWxpemVycywgZXh0cmFJbml0aWFsaXplcnMpIHsKICBmdW5jdGlvbiBhY2NlcHQoZikgeyBpZiAoZiAhPT0gdm9pZCAwICYmIHR5cGVvZiBmICE9PSAiZnVuY3Rpb24iKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJGdW5jdGlvbiBleHBlY3RlZCIpOyByZXR1cm4gZjsgfQogIHZhciBraW5kID0gY29udGV4dEluLmtpbmQsIGtleSA9IGtpbmQgPT09ICJnZXR0ZXIiID8gImdldCIgOiBraW5kID09PSAic2V0dGVyIiA/ICJzZXQiIDogInZhbHVlIjsKICB2YXIgdGFyZ2V0ID0gIWRlc2NyaXB0b3JJbiAmJiBjdG9yID8gY29udGV4dEluWyJzdGF0aWMiXSA/IGN0b3IgOiBjdG9yLnByb3RvdHlwZSA6IG51bGw7CiAgdmFyIGRlc2NyaXB0b3IgPSBkZXNjcmlwdG9ySW4gfHwgKHRhcmdldCA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBjb250ZXh0SW4ubmFtZSkgOiB7fSk7CiAgdmFyIF8sIGRvbmUgPSBmYWxzZTsKICBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICB2YXIgY29udGV4dCA9IHt9OwogICAgICBmb3IgKHZhciBwIGluIGNvbnRleHRJbikgY29udGV4dFtwXSA9IHAgPT09ICJhY2Nlc3MiID8ge30gOiBjb250ZXh0SW5bcF07CiAgICAgIGZvciAodmFyIHAgaW4gY29udGV4dEluLmFjY2VzcykgY29udGV4dC5hY2Nlc3NbcF0gPSBjb250ZXh0SW4uYWNjZXNzW3BdOwogICAgICBjb250ZXh0LmFkZEluaXRpYWxpemVyID0gZnVuY3Rpb24gKGYpIHsgaWYgKGRvbmUpIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBhZGQgaW5pdGlhbGl6ZXJzIGFmdGVyIGRlY29yYXRpb24gaGFzIGNvbXBsZXRlZCIpOyBleHRyYUluaXRpYWxpemVycy5wdXNoKGFjY2VwdChmIHx8IG51bGwpKTsgfTsKICAgICAgdmFyIHJlc3VsdCA9ICgwLCBkZWNvcmF0b3JzW2ldKShraW5kID09PSAiYWNjZXNzb3IiID8geyBnZXQ6IGRlc2NyaXB0b3IuZ2V0LCBzZXQ6IGRlc2NyaXB0b3Iuc2V0IH0gOiBkZXNjcmlwdG9yW2tleV0sIGNvbnRleHQpOwogICAgICBpZiAoa2luZCA9PT0gImFjY2Vzc29yIikgewogICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSBjb250aW51ZTsKICAgICAgICAgIGlmIChyZXN1bHQgPT09IG51bGwgfHwgdHlwZW9mIHJlc3VsdCAhPT0gIm9iamVjdCIpIHRocm93IG5ldyBUeXBlRXJyb3IoIk9iamVjdCBleHBlY3RlZCIpOwogICAgICAgICAgaWYgKF8gPSBhY2NlcHQocmVzdWx0LmdldCkpIGRlc2NyaXB0b3IuZ2V0ID0gXzsKICAgICAgICAgIGlmIChfID0gYWNjZXB0KHJlc3VsdC5zZXQpKSBkZXNjcmlwdG9yLnNldCA9IF87CiAgICAgICAgICBpZiAoXyA9IGFjY2VwdChyZXN1bHQuaW5pdCkpIGluaXRpYWxpemVycy51bnNoaWZ0KF8pOwogICAgICB9CiAgICAgIGVsc2UgaWYgKF8gPSBhY2NlcHQocmVzdWx0KSkgewogICAgICAgICAgaWYgKGtpbmQgPT09ICJmaWVsZCIpIGluaXRpYWxpemVycy51bnNoaWZ0KF8pOwogICAgICAgICAgZWxzZSBkZXNjcmlwdG9yW2tleV0gPSBfOwogICAgICB9CiAgfQogIGlmICh0YXJnZXQpIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGNvbnRleHRJbi5uYW1lLCBkZXNjcmlwdG9yKTsKICBkb25lID0gdHJ1ZTsKfQpmdW5jdGlvbiBfX3J1bkluaXRpYWxpemVycyh0aGlzQXJnLCBpbml0aWFsaXplcnMsIHZhbHVlKSB7CiAgdmFyIHVzZVZhbHVlID0gYXJndW1lbnRzLmxlbmd0aCA+IDI7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbml0aWFsaXplcnMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFsdWUgPSB1c2VWYWx1ZSA/IGluaXRpYWxpemVyc1tpXS5jYWxsKHRoaXNBcmcsIHZhbHVlKSA6IGluaXRpYWxpemVyc1tpXS5jYWxsKHRoaXNBcmcpOwogIH0KICByZXR1cm4gdXNlVmFsdWUgPyB2YWx1ZSA6IHZvaWQgMDsKfQpmdW5jdGlvbiBfX3Byb3BLZXkoeCkgewogIHJldHVybiB0eXBlb2YgeCA9PT0gInN5bWJvbCIgPyB4IDogIiIuY29uY2F0KHgpOwp9CmZ1bmN0aW9uIF9fc2V0RnVuY3Rpb25OYW1lKGYsIG5hbWUsIHByZWZpeCkgewogIGlmICh0eXBlb2YgbmFtZSA9PT0gInN5bWJvbCIpIG5hbWUgPSBuYW1lLmRlc2NyaXB0aW9uID8gIlsiLmNvbmNhdChuYW1lLmRlc2NyaXB0aW9uLCAiXSIpIDogIiI7CiAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShmLCAibmFtZSIsIHsgY29uZmlndXJhYmxlOiB0cnVlLCB2YWx1ZTogcHJlZml4ID8gIiIuY29uY2F0KHByZWZpeCwgIiAiLCBuYW1lKSA6IG5hbWUgfSk7Cn0KZnVuY3Rpb24gX19tZXRhZGF0YShtZXRhZGF0YUtleSwgbWV0YWRhdGFWYWx1ZSkgewogIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gIm9iamVjdCIgJiYgdHlwZW9mIFJlZmxlY3QubWV0YWRhdGEgPT09ICJmdW5jdGlvbiIpIHJldHVybiBSZWZsZWN0Lm1ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlKTsKfQoKZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikgewogIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfQogIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9CiAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yWyJ0aHJvdyJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH0KICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH0KICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpOwogIH0pOwp9CgpmdW5jdGlvbiBfX2dlbmVyYXRvcih0aGlzQXJnLCBib2R5KSB7CiAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOyByZXR1cm4gdFsxXTsgfSwgdHJ5czogW10sIG9wczogW10gfSwgZiwgeSwgdCwgZzsKICByZXR1cm4gZyA9IHsgbmV4dDogdmVyYigwKSwgInRocm93IjogdmVyYigxKSwgInJldHVybiI6IHZlcmIoMikgfSwgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9KSwgZzsKICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH0KICBmdW5jdGlvbiBzdGVwKG9wKSB7CiAgICAgIGlmIChmKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuIik7CiAgICAgIHdoaWxlIChnICYmIChnID0gMCwgb3BbMF0gJiYgKF8gPSAwKSksIF8pIHRyeSB7CiAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5WyJyZXR1cm4iXSA6IG9wWzBdID8geVsidGhyb3ciXSB8fCAoKHQgPSB5WyJyZXR1cm4iXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSkgcmV0dXJuIHQ7CiAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07CiAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7CiAgICAgICAgICAgICAgY2FzZSAwOiBjYXNlIDE6IHQgPSBvcDsgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTsKICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7CiAgICAgICAgICAgICAgY2FzZSA3OiBvcCA9IF8ub3BzLnBvcCgpOyBfLnRyeXMucG9wKCk7IGNvbnRpbnVlOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfQogICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDMgJiYgKCF0IHx8IChvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkpIHsgXy5sYWJlbCA9IG9wWzFdOyBicmVhazsgfQogICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH0KICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfQogICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7CiAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTsKICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfQogICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTsKICB9Cn0KCnZhciBfX2NyZWF0ZUJpbmRpbmcgPSBPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7CiAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gazsKICB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IobSwgayk7CiAgaWYgKCFkZXNjIHx8ICgiZ2V0IiBpbiBkZXNjID8gIW0uX19lc01vZHVsZSA6IGRlc2Mud3JpdGFibGUgfHwgZGVzYy5jb25maWd1cmFibGUpKSB7CiAgICAgIGRlc2MgPSB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH07CiAgfQogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgZGVzYyk7Cn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7CiAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gazsKICBvW2syXSA9IG1ba107Cn0pOwoKZnVuY3Rpb24gX19leHBvcnRTdGFyKG0sIG8pIHsKICBmb3IgKHZhciBwIGluIG0pIGlmIChwICE9PSAiZGVmYXVsdCIgJiYgIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvLCBwKSkgX19jcmVhdGVCaW5kaW5nKG8sIG0sIHApOwp9CgpmdW5jdGlvbiBfX3ZhbHVlcyhvKSB7CiAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CiAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CiAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKICAgICAgfQogIH07CiAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cn0KCmZ1bmN0aW9uIF9fcmVhZChvLCBuKSB7CiAgdmFyIG0gPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9bU3ltYm9sLml0ZXJhdG9yXTsKICBpZiAoIW0pIHJldHVybiBvOwogIHZhciBpID0gbS5jYWxsKG8pLCByLCBhciA9IFtdLCBlOwogIHRyeSB7CiAgICAgIHdoaWxlICgobiA9PT0gdm9pZCAwIHx8IG4tLSA+IDApICYmICEociA9IGkubmV4dCgpKS5kb25lKSBhci5wdXNoKHIudmFsdWUpOwogIH0KICBjYXRjaCAoZXJyb3IpIHsgZSA9IHsgZXJyb3I6IGVycm9yIH07IH0KICBmaW5hbGx5IHsKICAgICAgdHJ5IHsKICAgICAgICAgIGlmIChyICYmICFyLmRvbmUgJiYgKG0gPSBpWyJyZXR1cm4iXSkpIG0uY2FsbChpKTsKICAgICAgfQogICAgICBmaW5hbGx5IHsgaWYgKGUpIHRocm93IGUuZXJyb3I7IH0KICB9CiAgcmV0dXJuIGFyOwp9CgovKiogQGRlcHJlY2F0ZWQgKi8KZnVuY3Rpb24gX19zcHJlYWQoKSB7CiAgZm9yICh2YXIgYXIgPSBbXSwgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspCiAgICAgIGFyID0gYXIuY29uY2F0KF9fcmVhZChhcmd1bWVudHNbaV0pKTsKICByZXR1cm4gYXI7Cn0KCi8qKiBAZGVwcmVjYXRlZCAqLwpmdW5jdGlvbiBfX3NwcmVhZEFycmF5cygpIHsKICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDsKICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspCiAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKQogICAgICAgICAgcltrXSA9IGFbal07CiAgcmV0dXJuIHI7Cn0KCmZ1bmN0aW9uIF9fc3ByZWFkQXJyYXkodG8sIGZyb20sIHBhY2spIHsKICBpZiAocGFjayB8fCBhcmd1bWVudHMubGVuZ3RoID09PSAyKSBmb3IgKHZhciBpID0gMCwgbCA9IGZyb20ubGVuZ3RoLCBhcjsgaSA8IGw7IGkrKykgewogICAgICBpZiAoYXIgfHwgIShpIGluIGZyb20pKSB7CiAgICAgICAgICBpZiAoIWFyKSBhciA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20sIDAsIGkpOwogICAgICAgICAgYXJbaV0gPSBmcm9tW2ldOwogICAgICB9CiAgfQogIHJldHVybiB0by5jb25jYXQoYXIgfHwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSkpOwp9CgpmdW5jdGlvbiBfX2F3YWl0KHYpIHsKICByZXR1cm4gdGhpcyBpbnN0YW5jZW9mIF9fYXdhaXQgPyAodGhpcy52ID0gdiwgdGhpcykgOiBuZXcgX19hd2FpdCh2KTsKfQoKZnVuY3Rpb24gX19hc3luY0dlbmVyYXRvcih0aGlzQXJnLCBfYXJndW1lbnRzLCBnZW5lcmF0b3IpIHsKICBpZiAoIVN5bWJvbC5hc3luY0l0ZXJhdG9yKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKICB2YXIgZyA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSwgaSwgcSA9IFtdOwogIHJldHVybiBpID0ge30sIHZlcmIoIm5leHQiKSwgdmVyYigidGhyb3ciKSwgdmVyYigicmV0dXJuIiksIGlbU3ltYm9sLmFzeW5jSXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSwgaTsKICBmdW5jdGlvbiB2ZXJiKG4pIHsgaWYgKGdbbl0pIGlbbl0gPSBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKGEsIGIpIHsgcS5wdXNoKFtuLCB2LCBhLCBiXSkgPiAxIHx8IHJlc3VtZShuLCB2KTsgfSk7IH07IH0KICBmdW5jdGlvbiByZXN1bWUobiwgdikgeyB0cnkgeyBzdGVwKGdbbl0odikpOyB9IGNhdGNoIChlKSB7IHNldHRsZShxWzBdWzNdLCBlKTsgfSB9CiAgZnVuY3Rpb24gc3RlcChyKSB7IHIudmFsdWUgaW5zdGFuY2VvZiBfX2F3YWl0ID8gUHJvbWlzZS5yZXNvbHZlKHIudmFsdWUudikudGhlbihmdWxmaWxsLCByZWplY3QpIDogc2V0dGxlKHFbMF1bMl0sIHIpOyB9CiAgZnVuY3Rpb24gZnVsZmlsbCh2YWx1ZSkgeyByZXN1bWUoIm5leHQiLCB2YWx1ZSk7IH0KICBmdW5jdGlvbiByZWplY3QodmFsdWUpIHsgcmVzdW1lKCJ0aHJvdyIsIHZhbHVlKTsgfQogIGZ1bmN0aW9uIHNldHRsZShmLCB2KSB7IGlmIChmKHYpLCBxLnNoaWZ0KCksIHEubGVuZ3RoKSByZXN1bWUocVswXVswXSwgcVswXVsxXSk7IH0KfQoKZnVuY3Rpb24gX19hc3luY0RlbGVnYXRvcihvKSB7CiAgdmFyIGksIHA7CiAgcmV0dXJuIGkgPSB7fSwgdmVyYigibmV4dCIpLCB2ZXJiKCJ0aHJvdyIsIGZ1bmN0aW9uIChlKSB7IHRocm93IGU7IH0pLCB2ZXJiKCJyZXR1cm4iKSwgaVtTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSwgaTsKICBmdW5jdGlvbiB2ZXJiKG4sIGYpIHsgaVtuXSA9IG9bbl0gPyBmdW5jdGlvbiAodikgeyByZXR1cm4gKHAgPSAhcCkgPyB7IHZhbHVlOiBfX2F3YWl0KG9bbl0odikpLCBkb25lOiBmYWxzZSB9IDogZiA/IGYodikgOiB2OyB9IDogZjsgfQp9CgpmdW5jdGlvbiBfX2FzeW5jVmFsdWVzKG8pIHsKICBpZiAoIVN5bWJvbC5hc3luY0l0ZXJhdG9yKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKICB2YXIgbSA9IG9bU3ltYm9sLmFzeW5jSXRlcmF0b3JdLCBpOwogIHJldHVybiBtID8gbS5jYWxsKG8pIDogKG8gPSB0eXBlb2YgX192YWx1ZXMgPT09ICJmdW5jdGlvbiIgPyBfX3ZhbHVlcyhvKSA6IG9bU3ltYm9sLml0ZXJhdG9yXSgpLCBpID0ge30sIHZlcmIoIm5leHQiKSwgdmVyYigidGhyb3ciKSwgdmVyYigicmV0dXJuIiksIGlbU3ltYm9sLmFzeW5jSXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSwgaSk7CiAgZnVuY3Rpb24gdmVyYihuKSB7IGlbbl0gPSBvW25dICYmIGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHYgPSBvW25dKHYpLCBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCB2LmRvbmUsIHYudmFsdWUpOyB9KTsgfTsgfQogIGZ1bmN0aW9uIHNldHRsZShyZXNvbHZlLCByZWplY3QsIGQsIHYpIHsgUHJvbWlzZS5yZXNvbHZlKHYpLnRoZW4oZnVuY3Rpb24odikgeyByZXNvbHZlKHsgdmFsdWU6IHYsIGRvbmU6IGQgfSk7IH0sIHJlamVjdCk7IH0KfQoKZnVuY3Rpb24gX19tYWtlVGVtcGxhdGVPYmplY3QoY29va2VkLCByYXcpIHsKICBpZiAoT2JqZWN0LmRlZmluZVByb3BlcnR5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjb29rZWQsICJyYXciLCB7IHZhbHVlOiByYXcgfSk7IH0gZWxzZSB7IGNvb2tlZC5yYXcgPSByYXc7IH0KICByZXR1cm4gY29va2VkOwp9CnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSBPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgImRlZmF1bHQiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pOwp9KSA6IGZ1bmN0aW9uKG8sIHYpIHsKICBvWyJkZWZhdWx0Il0gPSB2Owp9OwoKZnVuY3Rpb24gX19pbXBvcnRTdGFyKG1vZCkgewogIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7CiAgdmFyIHJlc3VsdCA9IHt9OwogIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSAiZGVmYXVsdCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7CiAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTsKICByZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiBfX2ltcG9ydERlZmF1bHQobW9kKSB7CiAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBkZWZhdWx0OiBtb2QgfTsKfQoKZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZEdldChyZWNlaXZlciwgc3RhdGUsIGtpbmQsIGYpIHsKICBpZiAoa2luZCA9PT0gImEiICYmICFmKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJQcml2YXRlIGFjY2Vzc29yIHdhcyBkZWZpbmVkIHdpdGhvdXQgYSBnZXR0ZXIiKTsKICBpZiAodHlwZW9mIHN0YXRlID09PSAiZnVuY3Rpb24iID8gcmVjZWl2ZXIgIT09IHN0YXRlIHx8ICFmIDogIXN0YXRlLmhhcyhyZWNlaXZlcikpIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCByZWFkIHByaXZhdGUgbWVtYmVyIGZyb20gYW4gb2JqZWN0IHdob3NlIGNsYXNzIGRpZCBub3QgZGVjbGFyZSBpdCIpOwogIHJldHVybiBraW5kID09PSAibSIgPyBmIDoga2luZCA9PT0gImEiID8gZi5jYWxsKHJlY2VpdmVyKSA6IGYgPyBmLnZhbHVlIDogc3RhdGUuZ2V0KHJlY2VpdmVyKTsKfQoKZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZFNldChyZWNlaXZlciwgc3RhdGUsIHZhbHVlLCBraW5kLCBmKSB7CiAgaWYgKGtpbmQgPT09ICJtIikgdGhyb3cgbmV3IFR5cGVFcnJvcigiUHJpdmF0ZSBtZXRob2QgaXMgbm90IHdyaXRhYmxlIik7CiAgaWYgKGtpbmQgPT09ICJhIiAmJiAhZikgdGhyb3cgbmV3IFR5cGVFcnJvcigiUHJpdmF0ZSBhY2Nlc3NvciB3YXMgZGVmaW5lZCB3aXRob3V0IGEgc2V0dGVyIik7CiAgaWYgKHR5cGVvZiBzdGF0ZSA9PT0gImZ1bmN0aW9uIiA/IHJlY2VpdmVyICE9PSBzdGF0ZSB8fCAhZiA6ICFzdGF0ZS5oYXMocmVjZWl2ZXIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3Qgd3JpdGUgcHJpdmF0ZSBtZW1iZXIgdG8gYW4gb2JqZWN0IHdob3NlIGNsYXNzIGRpZCBub3QgZGVjbGFyZSBpdCIpOwogIHJldHVybiAoa2luZCA9PT0gImEiID8gZi5jYWxsKHJlY2VpdmVyLCB2YWx1ZSkgOiBmID8gZi52YWx1ZSA9IHZhbHVlIDogc3RhdGUuc2V0KHJlY2VpdmVyLCB2YWx1ZSkpLCB2YWx1ZTsKfQoKZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZEluKHN0YXRlLCByZWNlaXZlcikgewogIGlmIChyZWNlaXZlciA9PT0gbnVsbCB8fCAodHlwZW9mIHJlY2VpdmVyICE9PSAib2JqZWN0IiAmJiB0eXBlb2YgcmVjZWl2ZXIgIT09ICJmdW5jdGlvbiIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgdXNlICdpbicgb3BlcmF0b3Igb24gbm9uLW9iamVjdCIpOwogIHJldHVybiB0eXBlb2Ygc3RhdGUgPT09ICJmdW5jdGlvbiIgPyByZWNlaXZlciA9PT0gc3RhdGUgOiBzdGF0ZS5oYXMocmVjZWl2ZXIpOwp9CgpmdW5jdGlvbiBfX2FkZERpc3Bvc2FibGVSZXNvdXJjZShlbnYsIHZhbHVlLCBhc3luYykgewogIGlmICh2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdm9pZCAwKSB7CiAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAib2JqZWN0IiAmJiB0eXBlb2YgdmFsdWUgIT09ICJmdW5jdGlvbiIpIHRocm93IG5ldyBUeXBlRXJyb3IoIk9iamVjdCBleHBlY3RlZC4iKTsKICAgIHZhciBkaXNwb3NlOwogICAgaWYgKGFzeW5jKSB7CiAgICAgICAgaWYgKCFTeW1ib2wuYXN5bmNEaXNwb3NlKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJTeW1ib2wuYXN5bmNEaXNwb3NlIGlzIG5vdCBkZWZpbmVkLiIpOwogICAgICAgIGRpc3Bvc2UgPSB2YWx1ZVtTeW1ib2wuYXN5bmNEaXNwb3NlXTsKICAgIH0KICAgIGlmIChkaXNwb3NlID09PSB2b2lkIDApIHsKICAgICAgICBpZiAoIVN5bWJvbC5kaXNwb3NlKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJTeW1ib2wuZGlzcG9zZSBpcyBub3QgZGVmaW5lZC4iKTsKICAgICAgICBkaXNwb3NlID0gdmFsdWVbU3ltYm9sLmRpc3Bvc2VdOwogICAgfQogICAgaWYgKHR5cGVvZiBkaXNwb3NlICE9PSAiZnVuY3Rpb24iKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJPYmplY3Qgbm90IGRpc3Bvc2FibGUuIik7CiAgICBlbnYuc3RhY2sucHVzaCh7IHZhbHVlOiB2YWx1ZSwgZGlzcG9zZTogZGlzcG9zZSwgYXN5bmM6IGFzeW5jIH0pOwogIH0KICBlbHNlIGlmIChhc3luYykgewogICAgZW52LnN0YWNrLnB1c2goeyBhc3luYzogdHJ1ZSB9KTsKICB9CiAgcmV0dXJuIHZhbHVlOwp9Cgp2YXIgX1N1cHByZXNzZWRFcnJvciA9IHR5cGVvZiBTdXBwcmVzc2VkRXJyb3IgPT09ICJmdW5jdGlvbiIgPyBTdXBwcmVzc2VkRXJyb3IgOiBmdW5jdGlvbiAoZXJyb3IsIHN1cHByZXNzZWQsIG1lc3NhZ2UpIHsKICB2YXIgZSA9IG5ldyBFcnJvcihtZXNzYWdlKTsKICByZXR1cm4gZS5uYW1lID0gIlN1cHByZXNzZWRFcnJvciIsIGUuZXJyb3IgPSBlcnJvciwgZS5zdXBwcmVzc2VkID0gc3VwcHJlc3NlZCwgZTsKfTsKCmZ1bmN0aW9uIF9fZGlzcG9zZVJlc291cmNlcyhlbnYpIHsKICBmdW5jdGlvbiBmYWlsKGUpIHsKICAgIGVudi5lcnJvciA9IGVudi5oYXNFcnJvciA/IG5ldyBfU3VwcHJlc3NlZEVycm9yKGUsIGVudi5lcnJvciwgIkFuIGVycm9yIHdhcyBzdXBwcmVzc2VkIGR1cmluZyBkaXNwb3NhbC4iKSA6IGU7CiAgICBlbnYuaGFzRXJyb3IgPSB0cnVlOwogIH0KICBmdW5jdGlvbiBuZXh0KCkgewogICAgd2hpbGUgKGVudi5zdGFjay5sZW5ndGgpIHsKICAgICAgdmFyIHJlYyA9IGVudi5zdGFjay5wb3AoKTsKICAgICAgdHJ5IHsKICAgICAgICB2YXIgcmVzdWx0ID0gcmVjLmRpc3Bvc2UgJiYgcmVjLmRpc3Bvc2UuY2FsbChyZWMudmFsdWUpOwogICAgICAgIGlmIChyZWMuYXN5bmMpIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzdWx0KS50aGVuKG5leHQsIGZ1bmN0aW9uKGUpIHsgZmFpbChlKTsgcmV0dXJuIG5leHQoKTsgfSk7CiAgICAgIH0KICAgICAgY2F0Y2ggKGUpIHsKICAgICAgICAgIGZhaWwoZSk7CiAgICAgIH0KICAgIH0KICAgIGlmIChlbnYuaGFzRXJyb3IpIHRocm93IGVudi5lcnJvcjsKICB9CiAgcmV0dXJuIG5leHQoKTsKfQoKY29uc3QgdHNsaWJfZXM2ID0gewogIF9fZXh0ZW5kcywKICBfX2Fzc2lnbiwKICBfX3Jlc3QsCiAgX19kZWNvcmF0ZSwKICBfX3BhcmFtLAogIF9fbWV0YWRhdGEsCiAgX19hd2FpdGVyLAogIF9fZ2VuZXJhdG9yLAogIF9fY3JlYXRlQmluZGluZywKICBfX2V4cG9ydFN0YXIsCiAgX192YWx1ZXMsCiAgX19yZWFkLAogIF9fc3ByZWFkLAogIF9fc3ByZWFkQXJyYXlzLAogIF9fc3ByZWFkQXJyYXksCiAgX19hd2FpdCwKICBfX2FzeW5jR2VuZXJhdG9yLAogIF9fYXN5bmNEZWxlZ2F0b3IsCiAgX19hc3luY1ZhbHVlcywKICBfX21ha2VUZW1wbGF0ZU9iamVjdCwKICBfX2ltcG9ydFN0YXIsCiAgX19pbXBvcnREZWZhdWx0LAogIF9fY2xhc3NQcml2YXRlRmllbGRHZXQsCiAgX19jbGFzc1ByaXZhdGVGaWVsZFNldCwKICBfX2NsYXNzUHJpdmF0ZUZpZWxkSW4sCiAgX19hZGREaXNwb3NhYmxlUmVzb3VyY2UsCiAgX19kaXNwb3NlUmVzb3VyY2VzLAp9OwoKY29uc3QgdHNsaWJfZXM2JDEgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIF9fYWRkRGlzcG9zYWJsZVJlc291cmNlLAogICAgZ2V0IF9fYXNzaWduICgpIHsgcmV0dXJuIF9fYXNzaWduOyB9LAogICAgX19hc3luY0RlbGVnYXRvciwKICAgIF9fYXN5bmNHZW5lcmF0b3IsCiAgICBfX2FzeW5jVmFsdWVzLAogICAgX19hd2FpdCwKICAgIF9fYXdhaXRlciwKICAgIF9fY2xhc3NQcml2YXRlRmllbGRHZXQsCiAgICBfX2NsYXNzUHJpdmF0ZUZpZWxkSW4sCiAgICBfX2NsYXNzUHJpdmF0ZUZpZWxkU2V0LAogICAgX19jcmVhdGVCaW5kaW5nLAogICAgX19kZWNvcmF0ZSwKICAgIF9fZGlzcG9zZVJlc291cmNlcywKICAgIF9fZXNEZWNvcmF0ZSwKICAgIF9fZXhwb3J0U3RhciwKICAgIF9fZXh0ZW5kcywKICAgIF9fZ2VuZXJhdG9yLAogICAgX19pbXBvcnREZWZhdWx0LAogICAgX19pbXBvcnRTdGFyLAogICAgX19tYWtlVGVtcGxhdGVPYmplY3QsCiAgICBfX21ldGFkYXRhLAogICAgX19wYXJhbSwKICAgIF9fcHJvcEtleSwKICAgIF9fcmVhZCwKICAgIF9fcmVzdCwKICAgIF9fcnVuSW5pdGlhbGl6ZXJzLAogICAgX19zZXRGdW5jdGlvbk5hbWUsCiAgICBfX3NwcmVhZCwKICAgIF9fc3ByZWFkQXJyYXksCiAgICBfX3NwcmVhZEFycmF5cywKICAgIF9fdmFsdWVzLAogICAgZGVmYXVsdDogdHNsaWJfZXM2Cn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKZnVuY3Rpb24gX3Byb2RFcnJvck1hcCgpIHsNCiAgICAvLyBXZSB3aWxsIGluY2x1ZGUgdGhpcyBvbmUgbWVzc2FnZSBpbiB0aGUgcHJvZCBlcnJvciBtYXAgc2luY2UgYnkgdGhlIHZlcnkNCiAgICAvLyBuYXR1cmUgb2YgdGhpcyBlcnJvciwgZGV2ZWxvcGVycyB3aWxsIG5ldmVyIGJlIGFibGUgdG8gc2VlIHRoZSBtZXNzYWdlDQogICAgLy8gdXNpbmcgdGhlIGRlYnVnRXJyb3JNYXAgKHdoaWNoIGlzIGluc3RhbGxlZCBkdXJpbmcgYXV0aCBpbml0aWFsaXphdGlvbikuDQogICAgcmV0dXJuIHsNCiAgICAgICAgWyJkZXBlbmRlbnQtc2RrLWluaXRpYWxpemVkLWJlZm9yZS1hdXRoIiAvKiBBdXRoRXJyb3JDb2RlLkRFUEVOREVOVF9TREtfSU5JVF9CRUZPUkVfQVVUSCAqL106ICdBbm90aGVyIEZpcmViYXNlIFNESyB3YXMgaW5pdGlhbGl6ZWQgYW5kIGlzIHRyeWluZyB0byB1c2UgQXV0aCBiZWZvcmUgQXV0aCBpcyAnICsNCiAgICAgICAgICAgICdpbml0aWFsaXplZC4gUGxlYXNlIGJlIHN1cmUgdG8gY2FsbCBgaW5pdGlhbGl6ZUF1dGhgIG9yIGBnZXRBdXRoYCBiZWZvcmUgJyArDQogICAgICAgICAgICAnc3RhcnRpbmcgYW55IG90aGVyIEZpcmViYXNlIFNESy4nDQogICAgfTsNCn0NCi8qKg0KICogQSBtaW5pbWFsIGVycm9yIG1hcCB3aXRoIGFsbCB2ZXJib3NlIGVycm9yIG1lc3NhZ2VzIHN0cmlwcGVkLg0KICoNCiAqIFNlZSBkaXNjdXNzaW9uIGF0IHtAbGluayBBdXRoRXJyb3JNYXB9DQogKg0KICogQHB1YmxpYw0KICovDQpjb25zdCBwcm9kRXJyb3JNYXAgPSBfcHJvZEVycm9yTWFwOw0KY29uc3QgX0RFRkFVTFRfQVVUSF9FUlJPUl9GQUNUT1JZID0gbmV3IEVycm9yRmFjdG9yeSgnYXV0aCcsICdGaXJlYmFzZScsIF9wcm9kRXJyb3JNYXAoKSk7DQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY29uc3QgbG9nQ2xpZW50ID0gbmV3IExvZ2dlcignQGZpcmViYXNlL2F1dGgnKTsNCmZ1bmN0aW9uIF9sb2dXYXJuKG1zZywgLi4uYXJncykgew0KICAgIGlmIChsb2dDbGllbnQubG9nTGV2ZWwgPD0gTG9nTGV2ZWwuV0FSTikgew0KICAgICAgICBsb2dDbGllbnQud2FybihgQXV0aCAoJHtTREtfVkVSU0lPTiQxfSk6ICR7bXNnfWAsIC4uLmFyZ3MpOw0KICAgIH0NCn0NCmZ1bmN0aW9uIF9sb2dFcnJvcihtc2csIC4uLmFyZ3MpIHsNCiAgICBpZiAobG9nQ2xpZW50LmxvZ0xldmVsIDw9IExvZ0xldmVsLkVSUk9SKSB7DQogICAgICAgIGxvZ0NsaWVudC5lcnJvcihgQXV0aCAoJHtTREtfVkVSU0lPTiQxfSk6ICR7bXNnfWAsIC4uLmFyZ3MpOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmZ1bmN0aW9uIF9mYWlsKGF1dGhPckNvZGUsIC4uLnJlc3QpIHsNCiAgICB0aHJvdyBjcmVhdGVFcnJvckludGVybmFsKGF1dGhPckNvZGUsIC4uLnJlc3QpOw0KfQ0KZnVuY3Rpb24gX2NyZWF0ZUVycm9yKGF1dGhPckNvZGUsIC4uLnJlc3QpIHsNCiAgICByZXR1cm4gY3JlYXRlRXJyb3JJbnRlcm5hbChhdXRoT3JDb2RlLCAuLi5yZXN0KTsNCn0NCmZ1bmN0aW9uIF9lcnJvcldpdGhDdXN0b21NZXNzYWdlKGF1dGgsIGNvZGUsIG1lc3NhZ2UpIHsNCiAgICBjb25zdCBlcnJvck1hcCA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgcHJvZEVycm9yTWFwKCkpLCB7IFtjb2RlXTogbWVzc2FnZSB9KTsNCiAgICBjb25zdCBmYWN0b3J5ID0gbmV3IEVycm9yRmFjdG9yeSgnYXV0aCcsICdGaXJlYmFzZScsIGVycm9yTWFwKTsNCiAgICByZXR1cm4gZmFjdG9yeS5jcmVhdGUoY29kZSwgew0KICAgICAgICBhcHBOYW1lOiBhdXRoLm5hbWUNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIGNyZWF0ZUVycm9ySW50ZXJuYWwoYXV0aE9yQ29kZSwgLi4ucmVzdCkgew0KICAgIGlmICh0eXBlb2YgYXV0aE9yQ29kZSAhPT0gJ3N0cmluZycpIHsNCiAgICAgICAgY29uc3QgY29kZSA9IHJlc3RbMF07DQogICAgICAgIGNvbnN0IGZ1bGxQYXJhbXMgPSBbLi4ucmVzdC5zbGljZSgxKV07DQogICAgICAgIGlmIChmdWxsUGFyYW1zWzBdKSB7DQogICAgICAgICAgICBmdWxsUGFyYW1zWzBdLmFwcE5hbWUgPSBhdXRoT3JDb2RlLm5hbWU7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGF1dGhPckNvZGUuX2Vycm9yRmFjdG9yeS5jcmVhdGUoY29kZSwgLi4uZnVsbFBhcmFtcyk7DQogICAgfQ0KICAgIHJldHVybiBfREVGQVVMVF9BVVRIX0VSUk9SX0ZBQ1RPUlkuY3JlYXRlKGF1dGhPckNvZGUsIC4uLnJlc3QpOw0KfQ0KZnVuY3Rpb24gX2Fzc2VydChhc3NlcnRpb24sIGF1dGhPckNvZGUsIC4uLnJlc3QpIHsNCiAgICBpZiAoIWFzc2VydGlvbikgew0KICAgICAgICB0aHJvdyBjcmVhdGVFcnJvckludGVybmFsKGF1dGhPckNvZGUsIC4uLnJlc3QpOw0KICAgIH0NCn0NCi8qKg0KICogVW5jb25kaXRpb25hbGx5IGZhaWxzLCB0aHJvd2luZyBhbiBpbnRlcm5hbCBlcnJvciB3aXRoIHRoZSBnaXZlbiBtZXNzYWdlLg0KICoNCiAqIEBwYXJhbSBmYWlsdXJlIHR5cGUgb2YgZmFpbHVyZSBlbmNvdW50ZXJlZA0KICogQHRocm93cyBFcnJvcg0KICovDQpmdW5jdGlvbiBkZWJ1Z0ZhaWwoZmFpbHVyZSkgew0KICAgIC8vIExvZyB0aGUgZmFpbHVyZSBpbiBhZGRpdGlvbiB0byB0aHJvdyBhbiBleGNlcHRpb24sIGp1c3QgaW4gY2FzZSB0aGUNCiAgICAvLyBleGNlcHRpb24gaXMgc3dhbGxvd2VkLg0KICAgIGNvbnN0IG1lc3NhZ2UgPSBgSU5URVJOQUwgQVNTRVJUSU9OIEZBSUxFRDogYCArIGZhaWx1cmU7DQogICAgX2xvZ0Vycm9yKG1lc3NhZ2UpOw0KICAgIC8vIE5PVEU6IFdlIGRvbid0IHVzZSBGaXJlYmFzZUVycm9yIGhlcmUgYmVjYXVzZSB0aGVzZSBhcmUgaW50ZXJuYWwgZmFpbHVyZXMNCiAgICAvLyB0aGF0IGNhbm5vdCBiZSBoYW5kbGVkIGJ5IHRoZSB1c2VyLiAoQWxzbyBpdCB3b3VsZCBjcmVhdGUgYSBjaXJjdWxhcg0KICAgIC8vIGRlcGVuZGVuY3kgYmV0d2VlbiB0aGUgZXJyb3IgYW5kIGFzc2VydCBtb2R1bGVzIHdoaWNoIGRvZXNuJ3Qgd29yay4pDQogICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpOw0KfQ0KLyoqDQogKiBGYWlscyBpZiB0aGUgZ2l2ZW4gYXNzZXJ0aW9uIGNvbmRpdGlvbiBpcyBmYWxzZSwgdGhyb3dpbmcgYW4gRXJyb3Igd2l0aCB0aGUNCiAqIGdpdmVuIG1lc3NhZ2UgaWYgaXQgZGlkLg0KICoNCiAqIEBwYXJhbSBhc3NlcnRpb24NCiAqIEBwYXJhbSBtZXNzYWdlDQogKi8NCmZ1bmN0aW9uIGRlYnVnQXNzZXJ0KGFzc2VydGlvbiwgbWVzc2FnZSkgew0KICAgIGlmICghYXNzZXJ0aW9uKSB7DQogICAgICAgIGRlYnVnRmFpbChtZXNzYWdlKTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpmdW5jdGlvbiBfZ2V0Q3VycmVudFVybCgpIHsNCiAgICB2YXIgX2E7DQogICAgcmV0dXJuICh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgJiYgKChfYSA9IHNlbGYubG9jYXRpb24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5ocmVmKSkgfHwgJyc7DQp9DQpmdW5jdGlvbiBfaXNIdHRwT3JIdHRwcygpIHsNCiAgICByZXR1cm4gX2dldEN1cnJlbnRTY2hlbWUoKSA9PT0gJ2h0dHA6JyB8fCBfZ2V0Q3VycmVudFNjaGVtZSgpID09PSAnaHR0cHM6JzsNCn0NCmZ1bmN0aW9uIF9nZXRDdXJyZW50U2NoZW1lKCkgew0KICAgIHZhciBfYTsNCiAgICByZXR1cm4gKHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyAmJiAoKF9hID0gc2VsZi5sb2NhdGlvbikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnByb3RvY29sKSkgfHwgbnVsbDsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogRGV0ZXJtaW5lIHdoZXRoZXIgdGhlIGJyb3dzZXIgaXMgd29ya2luZyBvbmxpbmUNCiAqLw0KZnVuY3Rpb24gX2lzT25saW5lKCkgew0KICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yICE9PSAndW5kZWZpbmVkJyAmJg0KICAgICAgICBuYXZpZ2F0b3IgJiYNCiAgICAgICAgJ29uTGluZScgaW4gbmF2aWdhdG9yICYmDQogICAgICAgIHR5cGVvZiBuYXZpZ2F0b3Iub25MaW5lID09PSAnYm9vbGVhbicgJiYNCiAgICAgICAgLy8gQXBwbHkgb25seSBmb3IgdHJhZGl0aW9uYWwgd2ViIGFwcHMgYW5kIENocm9tZSBleHRlbnNpb25zLg0KICAgICAgICAvLyBUaGlzIGlzIGVzcGVjaWFsbHkgdHJ1ZSBmb3IgQ29yZG92YSBhcHBzIHdoaWNoIGhhdmUgdW5yZWxpYWJsZQ0KICAgICAgICAvLyBuYXZpZ2F0b3Iub25MaW5lIGJlaGF2aW9yIHVubGVzcyBjb3Jkb3ZhLXBsdWdpbi1uZXR3b3JrLWluZm9ybWF0aW9uIGlzDQogICAgICAgIC8vIGluc3RhbGxlZCB3aGljaCBvdmVyd3JpdGVzIHRoZSBuYXRpdmUgbmF2aWdhdG9yLm9uTGluZSB2YWx1ZSBhbmQNCiAgICAgICAgLy8gZGVmaW5lcyBuYXZpZ2F0b3IuY29ubmVjdGlvbi4NCiAgICAgICAgKF9pc0h0dHBPckh0dHBzKCkgfHwgaXNCcm93c2VyRXh0ZW5zaW9uKCkgfHwgJ2Nvbm5lY3Rpb24nIGluIG5hdmlnYXRvcikpIHsNCiAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5vbkxpbmU7DQogICAgfQ0KICAgIC8vIElmIHdlIGNhbid0IGRldGVybWluZSB0aGUgc3RhdGUsIGFzc3VtZSBpdCBpcyBvbmxpbmUuDQogICAgcmV0dXJuIHRydWU7DQp9DQpmdW5jdGlvbiBfZ2V0VXNlckxhbmd1YWdlKCkgew0KICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yID09PSAndW5kZWZpbmVkJykgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgY29uc3QgbmF2aWdhdG9yTGFuZ3VhZ2UgPSBuYXZpZ2F0b3I7DQogICAgcmV0dXJuICgNCiAgICAvLyBNb3N0IHJlbGlhYmxlLCBidXQgb25seSBzdXBwb3J0ZWQgaW4gQ2hyb21lL0ZpcmVmb3guDQogICAgKG5hdmlnYXRvckxhbmd1YWdlLmxhbmd1YWdlcyAmJiBuYXZpZ2F0b3JMYW5ndWFnZS5sYW5ndWFnZXNbMF0pIHx8DQogICAgICAgIC8vIFN1cHBvcnRlZCBpbiBtb3N0IGJyb3dzZXJzLCBidXQgcmV0dXJucyB0aGUgbGFuZ3VhZ2Ugb2YgdGhlIGJyb3dzZXINCiAgICAgICAgLy8gVUksIG5vdCB0aGUgbGFuZ3VhZ2Ugc2V0IGluIGJyb3dzZXIgc2V0dGluZ3MuDQogICAgICAgIG5hdmlnYXRvckxhbmd1YWdlLmxhbmd1YWdlIHx8DQogICAgICAgIC8vIENvdWxkbid0IGRldGVybWluZSBsYW5ndWFnZS4NCiAgICAgICAgbnVsbCk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIEEgc3RydWN0dXJlIHRvIGhlbHAgcGljayBiZXR3ZWVuIGEgcmFuZ2Ugb2YgbG9uZyBhbmQgc2hvcnQgZGVsYXkgZHVyYXRpb25zDQogKiBkZXBlbmRpbmcgb24gdGhlIGN1cnJlbnQgZW52aXJvbm1lbnQuIEluIGdlbmVyYWwsIHRoZSBsb25nIGRlbGF5IGlzIHVzZWQgZm9yDQogKiBtb2JpbGUgZW52aXJvbm1lbnRzIHdoZXJlYXMgc2hvcnQgZGVsYXlzIGFyZSB1c2VkIGZvciBkZXNrdG9wIGVudmlyb25tZW50cy4NCiAqLw0KY2xhc3MgRGVsYXkgew0KICAgIGNvbnN0cnVjdG9yKHNob3J0RGVsYXksIGxvbmdEZWxheSkgew0KICAgICAgICB0aGlzLnNob3J0RGVsYXkgPSBzaG9ydERlbGF5Ow0KICAgICAgICB0aGlzLmxvbmdEZWxheSA9IGxvbmdEZWxheTsNCiAgICAgICAgLy8gSW50ZXJuYWwgZXJyb3Igd2hlbiBpbXByb3Blcmx5IGluaXRpYWxpemVkLg0KICAgICAgICBkZWJ1Z0Fzc2VydChsb25nRGVsYXkgPiBzaG9ydERlbGF5LCAnU2hvcnQgZGVsYXkgc2hvdWxkIGJlIGxlc3MgdGhhbiBsb25nIGRlbGF5IScpOw0KICAgICAgICB0aGlzLmlzTW9iaWxlID0gaXNNb2JpbGVDb3Jkb3ZhKCkgfHwgaXNSZWFjdE5hdGl2ZSgpOw0KICAgIH0NCiAgICBnZXQoKSB7DQogICAgICAgIGlmICghX2lzT25saW5lKCkpIHsNCiAgICAgICAgICAgIC8vIFBpY2sgdGhlIHNob3J0ZXIgdGltZW91dC4NCiAgICAgICAgICAgIHJldHVybiBNYXRoLm1pbig1MDAwIC8qIERlbGF5TWluLk9GRkxJTkUgKi8sIHRoaXMuc2hvcnREZWxheSk7DQogICAgICAgIH0NCiAgICAgICAgLy8gSWYgcnVubmluZyBpbiBhIG1vYmlsZSBlbnZpcm9ubWVudCwgcmV0dXJuIHRoZSBsb25nIGRlbGF5LCBvdGhlcndpc2UNCiAgICAgICAgLy8gcmV0dXJuIHRoZSBzaG9ydCBkZWxheS4NCiAgICAgICAgLy8gVGhpcyBjb3VsZCBiZSBpbXByb3ZlZCBpbiB0aGUgZnV0dXJlIHRvIGR5bmFtaWNhbGx5IGNoYW5nZSBiYXNlZCBvbiBvdGhlcg0KICAgICAgICAvLyB2YXJpYWJsZXMgaW5zdGVhZCBvZiBqdXN0IHJlYWRpbmcgdGhlIGN1cnJlbnQgZW52aXJvbm1lbnQuDQogICAgICAgIHJldHVybiB0aGlzLmlzTW9iaWxlID8gdGhpcy5sb25nRGVsYXkgOiB0aGlzLnNob3J0RGVsYXk7DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KZnVuY3Rpb24gX2VtdWxhdG9yVXJsKGNvbmZpZywgcGF0aCkgew0KICAgIGRlYnVnQXNzZXJ0KGNvbmZpZy5lbXVsYXRvciwgJ0VtdWxhdG9yIHNob3VsZCBhbHdheXMgYmUgc2V0IGhlcmUnKTsNCiAgICBjb25zdCB7IHVybCB9ID0gY29uZmlnLmVtdWxhdG9yOw0KICAgIGlmICghcGF0aCkgew0KICAgICAgICByZXR1cm4gdXJsOw0KICAgIH0NCiAgICByZXR1cm4gYCR7dXJsfSR7cGF0aC5zdGFydHNXaXRoKCcvJykgPyBwYXRoLnNsaWNlKDEpIDogcGF0aH1gOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY2xhc3MgRmV0Y2hQcm92aWRlciB7DQogICAgc3RhdGljIGluaXRpYWxpemUoZmV0Y2hJbXBsLCBoZWFkZXJzSW1wbCwgcmVzcG9uc2VJbXBsKSB7DQogICAgICAgIHRoaXMuZmV0Y2hJbXBsID0gZmV0Y2hJbXBsOw0KICAgICAgICBpZiAoaGVhZGVyc0ltcGwpIHsNCiAgICAgICAgICAgIHRoaXMuaGVhZGVyc0ltcGwgPSBoZWFkZXJzSW1wbDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAocmVzcG9uc2VJbXBsKSB7DQogICAgICAgICAgICB0aGlzLnJlc3BvbnNlSW1wbCA9IHJlc3BvbnNlSW1wbDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBzdGF0aWMgZmV0Y2goKSB7DQogICAgICAgIGlmICh0aGlzLmZldGNoSW1wbCkgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmV0Y2hJbXBsOw0KICAgICAgICB9DQogICAgICAgIGlmICh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgJiYgJ2ZldGNoJyBpbiBzZWxmKSB7DQogICAgICAgICAgICByZXR1cm4gc2VsZi5mZXRjaDsNCiAgICAgICAgfQ0KICAgICAgICBkZWJ1Z0ZhaWwoJ0NvdWxkIG5vdCBmaW5kIGZldGNoIGltcGxlbWVudGF0aW9uLCBtYWtlIHN1cmUgeW91IGNhbGwgRmV0Y2hQcm92aWRlci5pbml0aWFsaXplKCkgd2l0aCBhbiBhcHByb3ByaWF0ZSBwb2x5ZmlsbCcpOw0KICAgIH0NCiAgICBzdGF0aWMgaGVhZGVycygpIHsNCiAgICAgICAgaWYgKHRoaXMuaGVhZGVyc0ltcGwpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmhlYWRlcnNJbXBsOw0KICAgICAgICB9DQogICAgICAgIGlmICh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgJiYgJ0hlYWRlcnMnIGluIHNlbGYpIHsNCiAgICAgICAgICAgIHJldHVybiBzZWxmLkhlYWRlcnM7DQogICAgICAgIH0NCiAgICAgICAgZGVidWdGYWlsKCdDb3VsZCBub3QgZmluZCBIZWFkZXJzIGltcGxlbWVudGF0aW9uLCBtYWtlIHN1cmUgeW91IGNhbGwgRmV0Y2hQcm92aWRlci5pbml0aWFsaXplKCkgd2l0aCBhbiBhcHByb3ByaWF0ZSBwb2x5ZmlsbCcpOw0KICAgIH0NCiAgICBzdGF0aWMgcmVzcG9uc2UoKSB7DQogICAgICAgIGlmICh0aGlzLnJlc3BvbnNlSW1wbCkgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVzcG9uc2VJbXBsOw0KICAgICAgICB9DQogICAgICAgIGlmICh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgJiYgJ1Jlc3BvbnNlJyBpbiBzZWxmKSB7DQogICAgICAgICAgICByZXR1cm4gc2VsZi5SZXNwb25zZTsNCiAgICAgICAgfQ0KICAgICAgICBkZWJ1Z0ZhaWwoJ0NvdWxkIG5vdCBmaW5kIFJlc3BvbnNlIGltcGxlbWVudGF0aW9uLCBtYWtlIHN1cmUgeW91IGNhbGwgRmV0Y2hQcm92aWRlci5pbml0aWFsaXplKCkgd2l0aCBhbiBhcHByb3ByaWF0ZSBwb2x5ZmlsbCcpOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogTWFwIGZyb20gZXJyb3JzIHJldHVybmVkIGJ5IHRoZSBzZXJ2ZXIgdG8gZXJyb3JzIHRvIGRldmVsb3BlciB2aXNpYmxlIGVycm9ycw0KICovDQpjb25zdCBTRVJWRVJfRVJST1JfTUFQID0gew0KICAgIC8vIEN1c3RvbSB0b2tlbiBlcnJvcnMuDQogICAgWyJDUkVERU5USUFMX01JU01BVENIIiAvKiBTZXJ2ZXJFcnJvci5DUkVERU5USUFMX01JU01BVENIICovXTogImN1c3RvbS10b2tlbi1taXNtYXRjaCIgLyogQXV0aEVycm9yQ29kZS5DUkVERU5USUFMX01JU01BVENIICovLA0KICAgIC8vIFRoaXMgY2FuIG9ubHkgaGFwcGVuIGlmIHRoZSBTREsgc2VuZHMgYSBiYWQgcmVxdWVzdC4NCiAgICBbIk1JU1NJTkdfQ1VTVE9NX1RPS0VOIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX0NVU1RPTV9UT0tFTiAqL106ICJpbnRlcm5hbC1lcnJvciIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLywNCiAgICAvLyBDcmVhdGUgQXV0aCBVUkkgZXJyb3JzLg0KICAgIFsiSU5WQUxJRF9JREVOVElGSUVSIiAvKiBTZXJ2ZXJFcnJvci5JTlZBTElEX0lERU5USUZJRVIgKi9dOiAiaW52YWxpZC1lbWFpbCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0VNQUlMICovLA0KICAgIC8vIFRoaXMgY2FuIG9ubHkgaGFwcGVuIGlmIHRoZSBTREsgc2VuZHMgYSBiYWQgcmVxdWVzdC4NCiAgICBbIk1JU1NJTkdfQ09OVElOVUVfVVJJIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX0NPTlRJTlVFX1VSSSAqL106ICJpbnRlcm5hbC1lcnJvciIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLywNCiAgICAvLyBTaWduIGluIHdpdGggZW1haWwgYW5kIHBhc3N3b3JkIGVycm9ycyAoc29tZSBhcHBseSB0byBzaWduIHVwIHRvbykuDQogICAgWyJJTlZBTElEX1BBU1NXT1JEIiAvKiBTZXJ2ZXJFcnJvci5JTlZBTElEX1BBU1NXT1JEICovXTogIndyb25nLXBhc3N3b3JkIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfUEFTU1dPUkQgKi8sDQogICAgLy8gVGhpcyBjYW4gb25seSBoYXBwZW4gaWYgdGhlIFNESyBzZW5kcyBhIGJhZCByZXF1ZXN0Lg0KICAgIFsiTUlTU0lOR19QQVNTV09SRCIgLyogU2VydmVyRXJyb3IuTUlTU0lOR19QQVNTV09SRCAqL106ICJtaXNzaW5nLXBhc3N3b3JkIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfUEFTU1dPUkQgKi8sDQogICAgLy8gU2lnbiB1cCB3aXRoIGVtYWlsIGFuZCBwYXNzd29yZCBlcnJvcnMuDQogICAgWyJFTUFJTF9FWElTVFMiIC8qIFNlcnZlckVycm9yLkVNQUlMX0VYSVNUUyAqL106ICJlbWFpbC1hbHJlYWR5LWluLXVzZSIgLyogQXV0aEVycm9yQ29kZS5FTUFJTF9FWElTVFMgKi8sDQogICAgWyJQQVNTV09SRF9MT0dJTl9ESVNBQkxFRCIgLyogU2VydmVyRXJyb3IuUEFTU1dPUkRfTE9HSU5fRElTQUJMRUQgKi9dOiAib3BlcmF0aW9uLW5vdC1hbGxvd2VkIiAvKiBBdXRoRXJyb3JDb2RlLk9QRVJBVElPTl9OT1RfQUxMT1dFRCAqLywNCiAgICAvLyBWZXJpZnkgYXNzZXJ0aW9uIGZvciBzaWduIGluIHdpdGggY3JlZGVudGlhbCBlcnJvcnM6DQogICAgWyJJTlZBTElEX0lEUF9SRVNQT05TRSIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9JRFBfUkVTUE9OU0UgKi9dOiAiaW52YWxpZC1jcmVkZW50aWFsIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfSURQX1JFU1BPTlNFICovLA0KICAgIFsiSU5WQUxJRF9QRU5ESU5HX1RPS0VOIiAvKiBTZXJ2ZXJFcnJvci5JTlZBTElEX1BFTkRJTkdfVE9LRU4gKi9dOiAiaW52YWxpZC1jcmVkZW50aWFsIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfSURQX1JFU1BPTlNFICovLA0KICAgIFsiRkVERVJBVEVEX1VTRVJfSURfQUxSRUFEWV9MSU5LRUQiIC8qIFNlcnZlckVycm9yLkZFREVSQVRFRF9VU0VSX0lEX0FMUkVBRFlfTElOS0VEICovXTogImNyZWRlbnRpYWwtYWxyZWFkeS1pbi11c2UiIC8qIEF1dGhFcnJvckNvZGUuQ1JFREVOVElBTF9BTFJFQURZX0lOX1VTRSAqLywNCiAgICAvLyBUaGlzIGNhbiBvbmx5IGhhcHBlbiBpZiB0aGUgU0RLIHNlbmRzIGEgYmFkIHJlcXVlc3QuDQogICAgWyJNSVNTSU5HX1JFUV9UWVBFIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX1JFUV9UWVBFICovXTogImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovLA0KICAgIC8vIFNlbmQgUGFzc3dvcmQgcmVzZXQgZW1haWwgZXJyb3JzOg0KICAgIFsiRU1BSUxfTk9UX0ZPVU5EIiAvKiBTZXJ2ZXJFcnJvci5FTUFJTF9OT1RfRk9VTkQgKi9dOiAidXNlci1ub3QtZm91bmQiIC8qIEF1dGhFcnJvckNvZGUuVVNFUl9ERUxFVEVEICovLA0KICAgIFsiUkVTRVRfUEFTU1dPUkRfRVhDRUVEX0xJTUlUIiAvKiBTZXJ2ZXJFcnJvci5SRVNFVF9QQVNTV09SRF9FWENFRURfTElNSVQgKi9dOiAidG9vLW1hbnktcmVxdWVzdHMiIC8qIEF1dGhFcnJvckNvZGUuVE9PX01BTllfQVRURU1QVFNfVFJZX0xBVEVSICovLA0KICAgIFsiRVhQSVJFRF9PT0JfQ09ERSIgLyogU2VydmVyRXJyb3IuRVhQSVJFRF9PT0JfQ09ERSAqL106ICJleHBpcmVkLWFjdGlvbi1jb2RlIiAvKiBBdXRoRXJyb3JDb2RlLkVYUElSRURfT09CX0NPREUgKi8sDQogICAgWyJJTlZBTElEX09PQl9DT0RFIiAvKiBTZXJ2ZXJFcnJvci5JTlZBTElEX09PQl9DT0RFICovXTogImludmFsaWQtYWN0aW9uLWNvZGUiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9PT0JfQ09ERSAqLywNCiAgICAvLyBUaGlzIGNhbiBvbmx5IGhhcHBlbiBpZiB0aGUgU0RLIHNlbmRzIGEgYmFkIHJlcXVlc3QuDQogICAgWyJNSVNTSU5HX09PQl9DT0RFIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX09PQl9DT0RFICovXTogImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovLA0KICAgIC8vIE9wZXJhdGlvbnMgdGhhdCByZXF1aXJlIElEIHRva2VuIGluIHJlcXVlc3Q6DQogICAgWyJDUkVERU5USUFMX1RPT19PTERfTE9HSU5fQUdBSU4iIC8qIFNlcnZlckVycm9yLkNSRURFTlRJQUxfVE9PX09MRF9MT0dJTl9BR0FJTiAqL106ICJyZXF1aXJlcy1yZWNlbnQtbG9naW4iIC8qIEF1dGhFcnJvckNvZGUuQ1JFREVOVElBTF9UT09fT0xEX0xPR0lOX0FHQUlOICovLA0KICAgIFsiSU5WQUxJRF9JRF9UT0tFTiIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9JRF9UT0tFTiAqL106ICJpbnZhbGlkLXVzZXItdG9rZW4iIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9BVVRIICovLA0KICAgIFsiVE9LRU5fRVhQSVJFRCIgLyogU2VydmVyRXJyb3IuVE9LRU5fRVhQSVJFRCAqL106ICJ1c2VyLXRva2VuLWV4cGlyZWQiIC8qIEF1dGhFcnJvckNvZGUuVE9LRU5fRVhQSVJFRCAqLywNCiAgICBbIlVTRVJfTk9UX0ZPVU5EIiAvKiBTZXJ2ZXJFcnJvci5VU0VSX05PVF9GT1VORCAqL106ICJ1c2VyLXRva2VuLWV4cGlyZWQiIC8qIEF1dGhFcnJvckNvZGUuVE9LRU5fRVhQSVJFRCAqLywNCiAgICAvLyBPdGhlciBlcnJvcnMuDQogICAgWyJUT09fTUFOWV9BVFRFTVBUU19UUllfTEFURVIiIC8qIFNlcnZlckVycm9yLlRPT19NQU5ZX0FUVEVNUFRTX1RSWV9MQVRFUiAqL106ICJ0b28tbWFueS1yZXF1ZXN0cyIgLyogQXV0aEVycm9yQ29kZS5UT09fTUFOWV9BVFRFTVBUU19UUllfTEFURVIgKi8sDQogICAgLy8gUGhvbmUgQXV0aCByZWxhdGVkIGVycm9ycy4NCiAgICBbIklOVkFMSURfQ09ERSIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9DT0RFICovXTogImludmFsaWQtdmVyaWZpY2F0aW9uLWNvZGUiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9DT0RFICovLA0KICAgIFsiSU5WQUxJRF9TRVNTSU9OX0lORk8iIC8qIFNlcnZlckVycm9yLklOVkFMSURfU0VTU0lPTl9JTkZPICovXTogImludmFsaWQtdmVyaWZpY2F0aW9uLWlkIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfU0VTU0lPTl9JTkZPICovLA0KICAgIFsiSU5WQUxJRF9URU1QT1JBUllfUFJPT0YiIC8qIFNlcnZlckVycm9yLklOVkFMSURfVEVNUE9SQVJZX1BST09GICovXTogImludmFsaWQtY3JlZGVudGlhbCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0lEUF9SRVNQT05TRSAqLywNCiAgICBbIk1JU1NJTkdfU0VTU0lPTl9JTkZPIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX1NFU1NJT05fSU5GTyAqL106ICJtaXNzaW5nLXZlcmlmaWNhdGlvbi1pZCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX1NFU1NJT05fSU5GTyAqLywNCiAgICBbIlNFU1NJT05fRVhQSVJFRCIgLyogU2VydmVyRXJyb3IuU0VTU0lPTl9FWFBJUkVEICovXTogImNvZGUtZXhwaXJlZCIgLyogQXV0aEVycm9yQ29kZS5DT0RFX0VYUElSRUQgKi8sDQogICAgLy8gT3RoZXIgYWN0aW9uIGNvZGUgZXJyb3JzIHdoZW4gYWRkaXRpb25hbCBzZXR0aW5ncyBwYXNzZWQuDQogICAgLy8gTUlTU0lOR19DT05USU5VRV9VUkkgaXMgZ2V0dGluZyBtYXBwZWQgdG8gSU5URVJOQUxfRVJST1IgYWJvdmUuDQogICAgLy8gVGhpcyBpcyBPSyBhcyB0aGlzIGVycm9yIHdpbGwgYmUgY2F1Z2h0IGJ5IGNsaWVudCBzaWRlIHZhbGlkYXRpb24uDQogICAgWyJNSVNTSU5HX0FORFJPSURfUEFDS0FHRV9OQU1FIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX0FORFJPSURfUEFDS0FHRV9OQU1FICovXTogIm1pc3NpbmctYW5kcm9pZC1wa2ctbmFtZSIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX0FORFJPSURfUEFDS0FHRV9OQU1FICovLA0KICAgIFsiVU5BVVRIT1JJWkVEX0RPTUFJTiIgLyogU2VydmVyRXJyb3IuVU5BVVRIT1JJWkVEX0RPTUFJTiAqL106ICJ1bmF1dGhvcml6ZWQtY29udGludWUtdXJpIiAvKiBBdXRoRXJyb3JDb2RlLlVOQVVUSE9SSVpFRF9ET01BSU4gKi8sDQogICAgLy8gZ2V0UHJvamVjdENvbmZpZyBlcnJvcnMgd2hlbiBjbGllbnRJZCBpcyBwYXNzZWQuDQogICAgWyJJTlZBTElEX09BVVRIX0NMSUVOVF9JRCIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9PQVVUSF9DTElFTlRfSUQgKi9dOiAiaW52YWxpZC1vYXV0aC1jbGllbnQtaWQiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9PQVVUSF9DTElFTlRfSUQgKi8sDQogICAgLy8gVXNlciBhY3Rpb25zIChzaWduLXVwIG9yIGRlbGV0aW9uKSBkaXNhYmxlZCBlcnJvcnMuDQogICAgWyJBRE1JTl9PTkxZX09QRVJBVElPTiIgLyogU2VydmVyRXJyb3IuQURNSU5fT05MWV9PUEVSQVRJT04gKi9dOiAiYWRtaW4tcmVzdHJpY3RlZC1vcGVyYXRpb24iIC8qIEF1dGhFcnJvckNvZGUuQURNSU5fT05MWV9PUEVSQVRJT04gKi8sDQogICAgLy8gTXVsdGkgZmFjdG9yIHJlbGF0ZWQgZXJyb3JzLg0KICAgIFsiSU5WQUxJRF9NRkFfUEVORElOR19DUkVERU5USUFMIiAvKiBTZXJ2ZXJFcnJvci5JTlZBTElEX01GQV9QRU5ESU5HX0NSRURFTlRJQUwgKi9dOiAiaW52YWxpZC1tdWx0aS1mYWN0b3Itc2Vzc2lvbiIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX01GQV9TRVNTSU9OICovLA0KICAgIFsiTUZBX0VOUk9MTE1FTlRfTk9UX0ZPVU5EIiAvKiBTZXJ2ZXJFcnJvci5NRkFfRU5ST0xMTUVOVF9OT1RfRk9VTkQgKi9dOiAibXVsdGktZmFjdG9yLWluZm8tbm90LWZvdW5kIiAvKiBBdXRoRXJyb3JDb2RlLk1GQV9JTkZPX05PVF9GT1VORCAqLywNCiAgICBbIk1JU1NJTkdfTUZBX0VOUk9MTE1FTlRfSUQiIC8qIFNlcnZlckVycm9yLk1JU1NJTkdfTUZBX0VOUk9MTE1FTlRfSUQgKi9dOiAibWlzc2luZy1tdWx0aS1mYWN0b3ItaW5mbyIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX01GQV9JTkZPICovLA0KICAgIFsiTUlTU0lOR19NRkFfUEVORElOR19DUkVERU5USUFMIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX01GQV9QRU5ESU5HX0NSRURFTlRJQUwgKi9dOiAibWlzc2luZy1tdWx0aS1mYWN0b3Itc2Vzc2lvbiIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX01GQV9TRVNTSU9OICovLA0KICAgIFsiU0VDT05EX0ZBQ1RPUl9FWElTVFMiIC8qIFNlcnZlckVycm9yLlNFQ09ORF9GQUNUT1JfRVhJU1RTICovXTogInNlY29uZC1mYWN0b3ItYWxyZWFkeS1pbi11c2UiIC8qIEF1dGhFcnJvckNvZGUuU0VDT05EX0ZBQ1RPUl9BTFJFQURZX0VOUk9MTEVEICovLA0KICAgIFsiU0VDT05EX0ZBQ1RPUl9MSU1JVF9FWENFRURFRCIgLyogU2VydmVyRXJyb3IuU0VDT05EX0ZBQ1RPUl9MSU1JVF9FWENFRURFRCAqL106ICJtYXhpbXVtLXNlY29uZC1mYWN0b3ItY291bnQtZXhjZWVkZWQiIC8qIEF1dGhFcnJvckNvZGUuU0VDT05EX0ZBQ1RPUl9MSU1JVF9FWENFRURFRCAqLywNCiAgICAvLyBCbG9ja2luZyBmdW5jdGlvbnMgcmVsYXRlZCBlcnJvcnMuDQogICAgWyJCTE9DS0lOR19GVU5DVElPTl9FUlJPUl9SRVNQT05TRSIgLyogU2VydmVyRXJyb3IuQkxPQ0tJTkdfRlVOQ1RJT05fRVJST1JfUkVTUE9OU0UgKi9dOiAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8sDQogICAgLy8gUmVjYXB0Y2hhIHJlbGF0ZWQgZXJyb3JzLg0KICAgIFsiUkVDQVBUQ0hBX05PVF9FTkFCTEVEIiAvKiBTZXJ2ZXJFcnJvci5SRUNBUFRDSEFfTk9UX0VOQUJMRUQgKi9dOiAicmVjYXB0Y2hhLW5vdC1lbmFibGVkIiAvKiBBdXRoRXJyb3JDb2RlLlJFQ0FQVENIQV9OT1RfRU5BQkxFRCAqLywNCiAgICBbIk1JU1NJTkdfUkVDQVBUQ0hBX1RPS0VOIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX1JFQ0FQVENIQV9UT0tFTiAqL106ICJtaXNzaW5nLXJlY2FwdGNoYS10b2tlbiIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX1JFQ0FQVENIQV9UT0tFTiAqLywNCiAgICBbIklOVkFMSURfUkVDQVBUQ0hBX1RPS0VOIiAvKiBTZXJ2ZXJFcnJvci5JTlZBTElEX1JFQ0FQVENIQV9UT0tFTiAqL106ICJpbnZhbGlkLXJlY2FwdGNoYS10b2tlbiIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX1JFQ0FQVENIQV9UT0tFTiAqLywNCiAgICBbIklOVkFMSURfUkVDQVBUQ0hBX0FDVElPTiIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9SRUNBUFRDSEFfQUNUSU9OICovXTogImludmFsaWQtcmVjYXB0Y2hhLWFjdGlvbiIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX1JFQ0FQVENIQV9BQ1RJT04gKi8sDQogICAgWyJNSVNTSU5HX0NMSUVOVF9UWVBFIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX0NMSUVOVF9UWVBFICovXTogIm1pc3NpbmctY2xpZW50LXR5cGUiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19DTElFTlRfVFlQRSAqLywNCiAgICBbIk1JU1NJTkdfUkVDQVBUQ0hBX1ZFUlNJT04iIC8qIFNlcnZlckVycm9yLk1JU1NJTkdfUkVDQVBUQ0hBX1ZFUlNJT04gKi9dOiAibWlzc2luZy1yZWNhcHRjaGEtdmVyc2lvbiIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX1JFQ0FQVENIQV9WRVJTSU9OICovLA0KICAgIFsiSU5WQUxJRF9SRUNBUFRDSEFfVkVSU0lPTiIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9SRUNBUFRDSEFfVkVSU0lPTiAqL106ICJpbnZhbGlkLXJlY2FwdGNoYS12ZXJzaW9uIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfUkVDQVBUQ0hBX1ZFUlNJT04gKi8sDQogICAgWyJJTlZBTElEX1JFUV9UWVBFIiAvKiBTZXJ2ZXJFcnJvci5JTlZBTElEX1JFUV9UWVBFICovXTogImludmFsaWQtcmVxLXR5cGUiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9SRVFfVFlQRSAqLw0KfTsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNvbnN0IERFRkFVTFRfQVBJX1RJTUVPVVRfTVMgPSBuZXcgRGVsYXkoMzAwMDAsIDYwMDAwKTsNCmZ1bmN0aW9uIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSB7DQogICAgaWYgKGF1dGgudGVuYW50SWQgJiYgIXJlcXVlc3QudGVuYW50SWQpIHsNCiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgcmVxdWVzdCksIHsgdGVuYW50SWQ6IGF1dGgudGVuYW50SWQgfSk7DQogICAgfQ0KICAgIHJldHVybiByZXF1ZXN0Ow0KfQ0KYXN5bmMgZnVuY3Rpb24gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsIG1ldGhvZCwgcGF0aCwgcmVxdWVzdCwgY3VzdG9tRXJyb3JNYXAgPSB7fSkgew0KICAgIHJldHVybiBfcGVyZm9ybUZldGNoV2l0aEVycm9ySGFuZGxpbmcoYXV0aCwgY3VzdG9tRXJyb3JNYXAsIGFzeW5jICgpID0+IHsNCiAgICAgICAgbGV0IGJvZHkgPSB7fTsNCiAgICAgICAgbGV0IHBhcmFtcyA9IHt9Ow0KICAgICAgICBpZiAocmVxdWVzdCkgew0KICAgICAgICAgICAgaWYgKG1ldGhvZCA9PT0gIkdFVCIgLyogSHR0cE1ldGhvZC5HRVQgKi8pIHsNCiAgICAgICAgICAgICAgICBwYXJhbXMgPSByZXF1ZXN0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgYm9keSA9IHsNCiAgICAgICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmVxdWVzdCkNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGNvbnN0IHF1ZXJ5ID0gcXVlcnlzdHJpbmckMShPYmplY3QuYXNzaWduKHsga2V5OiBhdXRoLmNvbmZpZy5hcGlLZXkgfSwgcGFyYW1zKSkuc2xpY2UoMSk7DQogICAgICAgIGNvbnN0IGhlYWRlcnMgPSBhd2FpdCBhdXRoLl9nZXRBZGRpdGlvbmFsSGVhZGVycygpOw0KICAgICAgICBoZWFkZXJzWyJDb250ZW50LVR5cGUiIC8qIEh0dHBIZWFkZXIuQ09OVEVOVF9UWVBFICovXSA9ICdhcHBsaWNhdGlvbi9qc29uJzsNCiAgICAgICAgaWYgKGF1dGgubGFuZ3VhZ2VDb2RlKSB7DQogICAgICAgICAgICBoZWFkZXJzWyJYLUZpcmViYXNlLUxvY2FsZSIgLyogSHR0cEhlYWRlci5YX0ZJUkVCQVNFX0xPQ0FMRSAqL10gPSBhdXRoLmxhbmd1YWdlQ29kZTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gRmV0Y2hQcm92aWRlci5mZXRjaCgpKF9nZXRGaW5hbFRhcmdldChhdXRoLCBhdXRoLmNvbmZpZy5hcGlIb3N0LCBwYXRoLCBxdWVyeSksIE9iamVjdC5hc3NpZ24oeyBtZXRob2QsDQogICAgICAgICAgICBoZWFkZXJzLCByZWZlcnJlclBvbGljeTogJ25vLXJlZmVycmVyJyB9LCBib2R5KSk7DQogICAgfSk7DQp9DQphc3luYyBmdW5jdGlvbiBfcGVyZm9ybUZldGNoV2l0aEVycm9ySGFuZGxpbmcoYXV0aCwgY3VzdG9tRXJyb3JNYXAsIGZldGNoRm4pIHsNCiAgICBhdXRoLl9jYW5Jbml0RW11bGF0b3IgPSBmYWxzZTsNCiAgICBjb25zdCBlcnJvck1hcCA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgU0VSVkVSX0VSUk9SX01BUCksIGN1c3RvbUVycm9yTWFwKTsNCiAgICB0cnkgew0KICAgICAgICBjb25zdCBuZXR3b3JrVGltZW91dCA9IG5ldyBOZXR3b3JrVGltZW91dChhdXRoKTsNCiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBQcm9taXNlLnJhY2UoWw0KICAgICAgICAgICAgZmV0Y2hGbigpLA0KICAgICAgICAgICAgbmV0d29ya1RpbWVvdXQucHJvbWlzZQ0KICAgICAgICBdKTsNCiAgICAgICAgLy8gSWYgd2UndmUgcmVhY2hlZCB0aGlzIHBvaW50LCB0aGUgZmV0Y2ggc3VjY2VlZGVkIGFuZCB0aGUgbmV0d29ya1RpbWVvdXQNCiAgICAgICAgLy8gZGlkbid0IHRocm93OyBjbGVhciB0aGUgbmV0d29yayB0aW1lb3V0IGRlbGF5IHNvIHRoYXQgTm9kZSB3b24ndCBoYW5nDQogICAgICAgIG5ldHdvcmtUaW1lb3V0LmNsZWFyTmV0d29ya1RpbWVvdXQoKTsNCiAgICAgICAgY29uc3QganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsNCiAgICAgICAgaWYgKCduZWVkQ29uZmlybWF0aW9uJyBpbiBqc29uKSB7DQogICAgICAgICAgICB0aHJvdyBfbWFrZVRhZ2dlZEVycm9yKGF1dGgsICJhY2NvdW50LWV4aXN0cy13aXRoLWRpZmZlcmVudC1jcmVkZW50aWFsIiAvKiBBdXRoRXJyb3JDb2RlLk5FRURfQ09ORklSTUFUSU9OICovLCBqc29uKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAocmVzcG9uc2Uub2sgJiYgISgnZXJyb3JNZXNzYWdlJyBpbiBqc29uKSkgew0KICAgICAgICAgICAgcmV0dXJuIGpzb247DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSByZXNwb25zZS5vayA/IGpzb24uZXJyb3JNZXNzYWdlIDoganNvbi5lcnJvci5tZXNzYWdlOw0KICAgICAgICAgICAgY29uc3QgW3NlcnZlckVycm9yQ29kZSwgc2VydmVyRXJyb3JNZXNzYWdlXSA9IGVycm9yTWVzc2FnZS5zcGxpdCgnIDogJyk7DQogICAgICAgICAgICBpZiAoc2VydmVyRXJyb3JDb2RlID09PSAiRkVERVJBVEVEX1VTRVJfSURfQUxSRUFEWV9MSU5LRUQiIC8qIFNlcnZlckVycm9yLkZFREVSQVRFRF9VU0VSX0lEX0FMUkVBRFlfTElOS0VEICovKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgX21ha2VUYWdnZWRFcnJvcihhdXRoLCAiY3JlZGVudGlhbC1hbHJlYWR5LWluLXVzZSIgLyogQXV0aEVycm9yQ29kZS5DUkVERU5USUFMX0FMUkVBRFlfSU5fVVNFICovLCBqc29uKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHNlcnZlckVycm9yQ29kZSA9PT0gIkVNQUlMX0VYSVNUUyIgLyogU2VydmVyRXJyb3IuRU1BSUxfRVhJU1RTICovKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgX21ha2VUYWdnZWRFcnJvcihhdXRoLCAiZW1haWwtYWxyZWFkeS1pbi11c2UiIC8qIEF1dGhFcnJvckNvZGUuRU1BSUxfRVhJU1RTICovLCBqc29uKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHNlcnZlckVycm9yQ29kZSA9PT0gIlVTRVJfRElTQUJMRUQiIC8qIFNlcnZlckVycm9yLlVTRVJfRElTQUJMRUQgKi8pIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBfbWFrZVRhZ2dlZEVycm9yKGF1dGgsICJ1c2VyLWRpc2FibGVkIiAvKiBBdXRoRXJyb3JDb2RlLlVTRVJfRElTQUJMRUQgKi8sIGpzb24pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgYXV0aEVycm9yID0gZXJyb3JNYXBbc2VydmVyRXJyb3JDb2RlXSB8fA0KICAgICAgICAgICAgICAgIHNlcnZlckVycm9yQ29kZQ0KICAgICAgICAgICAgICAgICAgICAudG9Mb3dlckNhc2UoKQ0KICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvW19cc10rL2csICctJyk7DQogICAgICAgICAgICBpZiAoc2VydmVyRXJyb3JNZXNzYWdlKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgX2Vycm9yV2l0aEN1c3RvbU1lc3NhZ2UoYXV0aCwgYXV0aEVycm9yLCBzZXJ2ZXJFcnJvck1lc3NhZ2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgX2ZhaWwoYXV0aCwgYXV0aEVycm9yKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBjYXRjaCAoZSkgew0KICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEZpcmViYXNlRXJyb3IpIHsNCiAgICAgICAgICAgIHRocm93IGU7DQogICAgICAgIH0NCiAgICAgICAgLy8gQ2hhbmdpbmcgdGhpcyB0byBhIGRpZmZlcmVudCBlcnJvciBjb2RlIHdpbGwgbG9nIHVzZXIgb3V0IHdoZW4gdGhlcmUgaXMgYSBuZXR3b3JrIGVycm9yDQogICAgICAgIC8vIGJlY2F1c2Ugd2UgdHJlYXQgYW55IGVycm9yIG90aGVyIHRoYW4gTkVUV09SS19SRVFVRVNUX0ZBSUxFRCBhcyB0b2tlbiBpcyBpbnZhbGlkLg0KICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZmlyZWJhc2UvZmlyZWJhc2UtanMtc2RrL2Jsb2IvNGZiYzczNjEwZDcwYmU0ZTA4NTJlN2RlNjNhMzljYjc4OTdlODU0Ni9wYWNrYWdlcy9hdXRoL3NyYy9jb3JlL2F1dGgvYXV0aF9pbXBsLnRzI0wzMDktTDMxNg0KICAgICAgICBfZmFpbChhdXRoLCAibmV0d29yay1yZXF1ZXN0LWZhaWxlZCIgLyogQXV0aEVycm9yQ29kZS5ORVRXT1JLX1JFUVVFU1RfRkFJTEVEICovLCB7ICdtZXNzYWdlJzogU3RyaW5nKGUpIH0pOw0KICAgIH0NCn0NCmFzeW5jIGZ1bmN0aW9uIF9wZXJmb3JtU2lnbkluUmVxdWVzdChhdXRoLCBtZXRob2QsIHBhdGgsIHJlcXVlc3QsIGN1c3RvbUVycm9yTWFwID0ge30pIHsNCiAgICBjb25zdCBzZXJ2ZXJSZXNwb25zZSA9IChhd2FpdCBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgbWV0aG9kLCBwYXRoLCByZXF1ZXN0LCBjdXN0b21FcnJvck1hcCkpOw0KICAgIGlmICgnbWZhUGVuZGluZ0NyZWRlbnRpYWwnIGluIHNlcnZlclJlc3BvbnNlKSB7DQogICAgICAgIF9mYWlsKGF1dGgsICJtdWx0aS1mYWN0b3ItYXV0aC1yZXF1aXJlZCIgLyogQXV0aEVycm9yQ29kZS5NRkFfUkVRVUlSRUQgKi8sIHsNCiAgICAgICAgICAgIF9zZXJ2ZXJSZXNwb25zZTogc2VydmVyUmVzcG9uc2UNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIHJldHVybiBzZXJ2ZXJSZXNwb25zZTsNCn0NCmZ1bmN0aW9uIF9nZXRGaW5hbFRhcmdldChhdXRoLCBob3N0LCBwYXRoLCBxdWVyeSkgew0KICAgIGNvbnN0IGJhc2UgPSBgJHtob3N0fSR7cGF0aH0/JHtxdWVyeX1gOw0KICAgIGlmICghYXV0aC5jb25maWcuZW11bGF0b3IpIHsNCiAgICAgICAgcmV0dXJuIGAke2F1dGguY29uZmlnLmFwaVNjaGVtZX06Ly8ke2Jhc2V9YDsNCiAgICB9DQogICAgcmV0dXJuIF9lbXVsYXRvclVybChhdXRoLmNvbmZpZywgYmFzZSk7DQp9DQpjbGFzcyBOZXR3b3JrVGltZW91dCB7DQogICAgY29uc3RydWN0b3IoYXV0aCkgew0KICAgICAgICB0aGlzLmF1dGggPSBhdXRoOw0KICAgICAgICAvLyBOb2RlIHRpbWVycyBhbmQgYnJvd3NlciB0aW1lcnMgYXJlIGZ1bmRhbWVudGFsbHkgaW5jb21wYXRpYmxlLCBidXQgd2UNCiAgICAgICAgLy8gZG9uJ3QgY2FyZSBhYm91dCB0aGUgdmFsdWUgaGVyZQ0KICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQ0KICAgICAgICB0aGlzLnRpbWVyID0gbnVsbDsNCiAgICAgICAgdGhpcy5wcm9taXNlID0gbmV3IFByb21pc2UoKF8sIHJlamVjdCkgPT4gew0KICAgICAgICAgICAgdGhpcy50aW1lciA9IHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgICAgIHJldHVybiByZWplY3QoX2NyZWF0ZUVycm9yKHRoaXMuYXV0aCwgIm5ldHdvcmstcmVxdWVzdC1mYWlsZWQiIC8qIEF1dGhFcnJvckNvZGUuTkVUV09SS19SRVFVRVNUX0ZBSUxFRCAqLykpOw0KICAgICAgICAgICAgfSwgREVGQVVMVF9BUElfVElNRU9VVF9NUy5nZXQoKSk7DQogICAgICAgIH0pOw0KICAgIH0NCiAgICBjbGVhck5ldHdvcmtUaW1lb3V0KCkgew0KICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lcik7DQogICAgfQ0KfQ0KZnVuY3Rpb24gX21ha2VUYWdnZWRFcnJvcihhdXRoLCBjb2RlLCByZXNwb25zZSkgew0KICAgIGNvbnN0IGVycm9yUGFyYW1zID0gew0KICAgICAgICBhcHBOYW1lOiBhdXRoLm5hbWUNCiAgICB9Ow0KICAgIGlmIChyZXNwb25zZS5lbWFpbCkgew0KICAgICAgICBlcnJvclBhcmFtcy5lbWFpbCA9IHJlc3BvbnNlLmVtYWlsOw0KICAgIH0NCiAgICBpZiAocmVzcG9uc2UucGhvbmVOdW1iZXIpIHsNCiAgICAgICAgZXJyb3JQYXJhbXMucGhvbmVOdW1iZXIgPSByZXNwb25zZS5waG9uZU51bWJlcjsNCiAgICB9DQogICAgY29uc3QgZXJyb3IgPSBfY3JlYXRlRXJyb3IoYXV0aCwgY29kZSwgZXJyb3JQYXJhbXMpOw0KICAgIC8vIFdlIGtub3cgY3VzdG9tRGF0YSBpcyBkZWZpbmVkIG9uIGVycm9yIGJlY2F1c2UgZXJyb3JQYXJhbXMgaXMgZGVmaW5lZA0KICAgIGVycm9yLmN1c3RvbURhdGEuX3Rva2VuUmVzcG9uc2UgPSByZXNwb25zZTsNCiAgICByZXR1cm4gZXJyb3I7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQphc3luYyBmdW5jdGlvbiBkZWxldGVBY2NvdW50KGF1dGgsIHJlcXVlc3QpIHsNCiAgICByZXR1cm4gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsICJQT1NUIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sICIvdjEvYWNjb3VudHM6ZGVsZXRlIiAvKiBFbmRwb2ludC5ERUxFVEVfQUNDT1VOVCAqLywgcmVxdWVzdCk7DQp9DQphc3luYyBmdW5jdGlvbiBnZXRBY2NvdW50SW5mbyhhdXRoLCByZXF1ZXN0KSB7DQogICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCAiUE9TVCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCAiL3YxL2FjY291bnRzOmxvb2t1cCIgLyogRW5kcG9pbnQuR0VUX0FDQ09VTlRfSU5GTyAqLywgcmVxdWVzdCk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpmdW5jdGlvbiB1dGNUaW1lc3RhbXBUb0RhdGVTdHJpbmcodXRjVGltZXN0YW1wKSB7DQogICAgaWYgKCF1dGNUaW1lc3RhbXApIHsNCiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsNCiAgICB9DQogICAgdHJ5IHsNCiAgICAgICAgLy8gQ29udmVydCB0byBkYXRlIG9iamVjdC4NCiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKE51bWJlcih1dGNUaW1lc3RhbXApKTsNCiAgICAgICAgLy8gVGVzdCBkYXRlIGlzIHZhbGlkLg0KICAgICAgICBpZiAoIWlzTmFOKGRhdGUuZ2V0VGltZSgpKSkgew0KICAgICAgICAgICAgLy8gQ29udmVydCB0byBVVEMgZGF0ZSBzdHJpbmcuDQogICAgICAgICAgICByZXR1cm4gZGF0ZS50b1VUQ1N0cmluZygpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGNhdGNoIChlKSB7DQogICAgICAgIC8vIERvIG5vdGhpbmcuIHVuZGVmaW5lZCB3aWxsIGJlIHJldHVybmVkLg0KICAgIH0NCiAgICByZXR1cm4gdW5kZWZpbmVkOw0KfQovKioNCiAqIFJldHVybnMgYSBkZXNlcmlhbGl6ZWQgSlNPTiBXZWIgVG9rZW4gKEpXVCkgdXNlZCB0byBpZGVudGlmeSB0aGUgdXNlciB0byBhIEZpcmViYXNlIHNlcnZpY2UuDQogKg0KICogQHJlbWFya3MNCiAqIFJldHVybnMgdGhlIGN1cnJlbnQgdG9rZW4gaWYgaXQgaGFzIG5vdCBleHBpcmVkIG9yIGlmIGl0IHdpbGwgbm90IGV4cGlyZSBpbiB0aGUgbmV4dCBmaXZlDQogKiBtaW51dGVzLiBPdGhlcndpc2UsIHRoaXMgd2lsbCByZWZyZXNoIHRoZSB0b2tlbiBhbmQgcmV0dXJuIGEgbmV3IG9uZS4NCiAqDQogKiBAcGFyYW0gdXNlciAtIFRoZSB1c2VyLg0KICogQHBhcmFtIGZvcmNlUmVmcmVzaCAtIEZvcmNlIHJlZnJlc2ggcmVnYXJkbGVzcyBvZiB0b2tlbiBleHBpcmF0aW9uLg0KICoNCiAqIEBwdWJsaWMNCiAqLw0KYXN5bmMgZnVuY3Rpb24gZ2V0SWRUb2tlblJlc3VsdCh1c2VyLCBmb3JjZVJlZnJlc2ggPSBmYWxzZSkgew0KICAgIGNvbnN0IHVzZXJJbnRlcm5hbCA9IGdldE1vZHVsYXJJbnN0YW5jZSh1c2VyKTsNCiAgICBjb25zdCB0b2tlbiA9IGF3YWl0IHVzZXJJbnRlcm5hbC5nZXRJZFRva2VuKGZvcmNlUmVmcmVzaCk7DQogICAgY29uc3QgY2xhaW1zID0gX3BhcnNlVG9rZW4odG9rZW4pOw0KICAgIF9hc3NlcnQoY2xhaW1zICYmIGNsYWltcy5leHAgJiYgY2xhaW1zLmF1dGhfdGltZSAmJiBjbGFpbXMuaWF0LCB1c2VySW50ZXJuYWwuYXV0aCwgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICBjb25zdCBmaXJlYmFzZSA9IHR5cGVvZiBjbGFpbXMuZmlyZWJhc2UgPT09ICdvYmplY3QnID8gY2xhaW1zLmZpcmViYXNlIDogdW5kZWZpbmVkOw0KICAgIGNvbnN0IHNpZ25JblByb3ZpZGVyID0gZmlyZWJhc2UgPT09IG51bGwgfHwgZmlyZWJhc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZpcmViYXNlWydzaWduX2luX3Byb3ZpZGVyJ107DQogICAgcmV0dXJuIHsNCiAgICAgICAgY2xhaW1zLA0KICAgICAgICB0b2tlbiwNCiAgICAgICAgYXV0aFRpbWU6IHV0Y1RpbWVzdGFtcFRvRGF0ZVN0cmluZyhzZWNvbmRzU3RyaW5nVG9NaWxsaXNlY29uZHMoY2xhaW1zLmF1dGhfdGltZSkpLA0KICAgICAgICBpc3N1ZWRBdFRpbWU6IHV0Y1RpbWVzdGFtcFRvRGF0ZVN0cmluZyhzZWNvbmRzU3RyaW5nVG9NaWxsaXNlY29uZHMoY2xhaW1zLmlhdCkpLA0KICAgICAgICBleHBpcmF0aW9uVGltZTogdXRjVGltZXN0YW1wVG9EYXRlU3RyaW5nKHNlY29uZHNTdHJpbmdUb01pbGxpc2Vjb25kcyhjbGFpbXMuZXhwKSksDQogICAgICAgIHNpZ25JblByb3ZpZGVyOiBzaWduSW5Qcm92aWRlciB8fCBudWxsLA0KICAgICAgICBzaWduSW5TZWNvbmRGYWN0b3I6IChmaXJlYmFzZSA9PT0gbnVsbCB8fCBmaXJlYmFzZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmlyZWJhc2VbJ3NpZ25faW5fc2Vjb25kX2ZhY3RvciddKSB8fCBudWxsDQogICAgfTsNCn0NCmZ1bmN0aW9uIHNlY29uZHNTdHJpbmdUb01pbGxpc2Vjb25kcyhzZWNvbmRzKSB7DQogICAgcmV0dXJuIE51bWJlcihzZWNvbmRzKSAqIDEwMDA7DQp9DQpmdW5jdGlvbiBfcGFyc2VUb2tlbih0b2tlbikgew0KICAgIGNvbnN0IFthbGdvcml0aG0sIHBheWxvYWQsIHNpZ25hdHVyZV0gPSB0b2tlbi5zcGxpdCgnLicpOw0KICAgIGlmIChhbGdvcml0aG0gPT09IHVuZGVmaW5lZCB8fA0KICAgICAgICBwYXlsb2FkID09PSB1bmRlZmluZWQgfHwNCiAgICAgICAgc2lnbmF0dXJlID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgX2xvZ0Vycm9yKCdKV1QgbWFsZm9ybWVkLCBjb250YWluZWQgZmV3ZXIgdGhhbiAzIHNlY3Rpb25zJyk7DQogICAgICAgIHJldHVybiBudWxsOw0KICAgIH0NCiAgICB0cnkgew0KICAgICAgICBjb25zdCBkZWNvZGVkID0gYmFzZTY0RGVjb2RlKHBheWxvYWQpOw0KICAgICAgICBpZiAoIWRlY29kZWQpIHsNCiAgICAgICAgICAgIF9sb2dFcnJvcignRmFpbGVkIHRvIGRlY29kZSBiYXNlNjQgSldUIHBheWxvYWQnKTsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBKU09OLnBhcnNlKGRlY29kZWQpOw0KICAgIH0NCiAgICBjYXRjaCAoZSkgew0KICAgICAgICBfbG9nRXJyb3IoJ0NhdWdodCBlcnJvciBwYXJzaW5nIEpXVCBwYXlsb2FkIGFzIEpTT04nLCBlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUudG9TdHJpbmcoKSk7DQogICAgICAgIHJldHVybiBudWxsOw0KICAgIH0NCn0NCi8qKg0KICogRXh0cmFjdCBleHBpcmVzSW4gVFRMIGZyb20gYSB0b2tlbiBieSBzdWJ0cmFjdGluZyB0aGUgZXhwaXJhdGlvbiBmcm9tIHRoZSBpc3N1YW5jZS4NCiAqLw0KZnVuY3Rpb24gX3Rva2VuRXhwaXJlc0luKHRva2VuKSB7DQogICAgY29uc3QgcGFyc2VkVG9rZW4gPSBfcGFyc2VUb2tlbih0b2tlbik7DQogICAgX2Fzc2VydChwYXJzZWRUb2tlbiwgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICBfYXNzZXJ0KHR5cGVvZiBwYXJzZWRUb2tlbi5leHAgIT09ICd1bmRlZmluZWQnLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pOw0KICAgIF9hc3NlcnQodHlwZW9mIHBhcnNlZFRva2VuLmlhdCAhPT0gJ3VuZGVmaW5lZCcsICJpbnRlcm5hbC1lcnJvciIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7DQogICAgcmV0dXJuIE51bWJlcihwYXJzZWRUb2tlbi5leHApIC0gTnVtYmVyKHBhcnNlZFRva2VuLmlhdCk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQphc3luYyBmdW5jdGlvbiBfbG9nb3V0SWZJbnZhbGlkYXRlZCh1c2VyLCBwcm9taXNlLCBieXBhc3NBdXRoU3RhdGUgPSBmYWxzZSkgew0KICAgIGlmIChieXBhc3NBdXRoU3RhdGUpIHsNCiAgICAgICAgcmV0dXJuIHByb21pc2U7DQogICAgfQ0KICAgIHRyeSB7DQogICAgICAgIHJldHVybiBhd2FpdCBwcm9taXNlOw0KICAgIH0NCiAgICBjYXRjaCAoZSkgew0KICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEZpcmViYXNlRXJyb3IgJiYgaXNVc2VySW52YWxpZGF0ZWQoZSkpIHsNCiAgICAgICAgICAgIGlmICh1c2VyLmF1dGguY3VycmVudFVzZXIgPT09IHVzZXIpIHsNCiAgICAgICAgICAgICAgICBhd2FpdCB1c2VyLmF1dGguc2lnbk91dCgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHRocm93IGU7DQogICAgfQ0KfQ0KZnVuY3Rpb24gaXNVc2VySW52YWxpZGF0ZWQoeyBjb2RlIH0pIHsNCiAgICByZXR1cm4gKGNvZGUgPT09IGBhdXRoLyR7InVzZXItZGlzYWJsZWQiIC8qIEF1dGhFcnJvckNvZGUuVVNFUl9ESVNBQkxFRCAqL31gIHx8DQogICAgICAgIGNvZGUgPT09IGBhdXRoLyR7InVzZXItdG9rZW4tZXhwaXJlZCIgLyogQXV0aEVycm9yQ29kZS5UT0tFTl9FWFBJUkVEICovfWApOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY2xhc3MgUHJvYWN0aXZlUmVmcmVzaCB7DQogICAgY29uc3RydWN0b3IodXNlcikgew0KICAgICAgICB0aGlzLnVzZXIgPSB1c2VyOw0KICAgICAgICB0aGlzLmlzUnVubmluZyA9IGZhbHNlOw0KICAgICAgICAvLyBOb2RlIHRpbWVycyBhbmQgYnJvd3NlciB0aW1lcnMgcmV0dXJuIGZ1bmRhbWVudGFsbHkgZGlmZmVyZW50IHR5cGVzLg0KICAgICAgICAvLyBXZSBkb24ndCBhY3R1YWxseSBjYXJlIHdoYXQgdGhlIHZhbHVlIGlzIGJ1dCBUUyB3b24ndCBhY2NlcHQgdW5rbm93biBhbmQNCiAgICAgICAgLy8gd2UgY2FuJ3QgY2FzdCBwcm9wZXJseSBpbiBib3RoIGVudmlyb25tZW50cy4NCiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgdGhpcy50aW1lcklkID0gbnVsbDsNCiAgICAgICAgdGhpcy5lcnJvckJhY2tvZmYgPSAzMDAwMCAvKiBEdXJhdGlvbi5SRVRSWV9CQUNLT0ZGX01JTiAqLzsNCiAgICB9DQogICAgX3N0YXJ0KCkgew0KICAgICAgICBpZiAodGhpcy5pc1J1bm5pbmcpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmlzUnVubmluZyA9IHRydWU7DQogICAgICAgIHRoaXMuc2NoZWR1bGUoKTsNCiAgICB9DQogICAgX3N0b3AoKSB7DQogICAgICAgIGlmICghdGhpcy5pc1J1bm5pbmcpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmlzUnVubmluZyA9IGZhbHNlOw0KICAgICAgICBpZiAodGhpcy50aW1lcklkICE9PSBudWxsKSB7DQogICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lcklkKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBnZXRJbnRlcnZhbCh3YXNFcnJvcikgew0KICAgICAgICB2YXIgX2E7DQogICAgICAgIGlmICh3YXNFcnJvcikgew0KICAgICAgICAgICAgY29uc3QgaW50ZXJ2YWwgPSB0aGlzLmVycm9yQmFja29mZjsNCiAgICAgICAgICAgIHRoaXMuZXJyb3JCYWNrb2ZmID0gTWF0aC5taW4odGhpcy5lcnJvckJhY2tvZmYgKiAyLCA5NjAwMDAgLyogRHVyYXRpb24uUkVUUllfQkFDS09GRl9NQVggKi8pOw0KICAgICAgICAgICAgcmV0dXJuIGludGVydmFsOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgLy8gUmVzZXQgdGhlIGVycm9yIGJhY2tvZmYNCiAgICAgICAgICAgIHRoaXMuZXJyb3JCYWNrb2ZmID0gMzAwMDAgLyogRHVyYXRpb24uUkVUUllfQkFDS09GRl9NSU4gKi87DQogICAgICAgICAgICBjb25zdCBleHBUaW1lID0gKF9hID0gdGhpcy51c2VyLnN0c1Rva2VuTWFuYWdlci5leHBpcmF0aW9uVGltZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogMDsNCiAgICAgICAgICAgIGNvbnN0IGludGVydmFsID0gZXhwVGltZSAtIERhdGUubm93KCkgLSAzMDAwMDAgLyogRHVyYXRpb24uT0ZGU0VUICovOw0KICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4KDAsIGludGVydmFsKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBzY2hlZHVsZSh3YXNFcnJvciA9IGZhbHNlKSB7DQogICAgICAgIGlmICghdGhpcy5pc1J1bm5pbmcpIHsNCiAgICAgICAgICAgIC8vIEp1c3QgaW4gY2FzZS4uLg0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IGludGVydmFsID0gdGhpcy5nZXRJbnRlcnZhbCh3YXNFcnJvcik7DQogICAgICAgIHRoaXMudGltZXJJZCA9IHNldFRpbWVvdXQoYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgYXdhaXQgdGhpcy5pdGVyYXRpb24oKTsNCiAgICAgICAgfSwgaW50ZXJ2YWwpOw0KICAgIH0NCiAgICBhc3luYyBpdGVyYXRpb24oKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBhd2FpdCB0aGlzLnVzZXIuZ2V0SWRUb2tlbih0cnVlKTsNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgLy8gT25seSByZXRyeSBvbiBuZXR3b3JrIGVycm9ycw0KICAgICAgICAgICAgaWYgKChlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUuY29kZSkgPT09DQogICAgICAgICAgICAgICAgYGF1dGgvJHsibmV0d29yay1yZXF1ZXN0LWZhaWxlZCIgLyogQXV0aEVycm9yQ29kZS5ORVRXT1JLX1JFUVVFU1RfRkFJTEVEICovfWApIHsNCiAgICAgICAgICAgICAgICB0aGlzLnNjaGVkdWxlKC8qIHdhc0Vycm9yICovIHRydWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuc2NoZWR1bGUoKTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBVc2VyTWV0YWRhdGEgew0KICAgIGNvbnN0cnVjdG9yKGNyZWF0ZWRBdCwgbGFzdExvZ2luQXQpIHsNCiAgICAgICAgdGhpcy5jcmVhdGVkQXQgPSBjcmVhdGVkQXQ7DQogICAgICAgIHRoaXMubGFzdExvZ2luQXQgPSBsYXN0TG9naW5BdDsNCiAgICAgICAgdGhpcy5faW5pdGlhbGl6ZVRpbWUoKTsNCiAgICB9DQogICAgX2luaXRpYWxpemVUaW1lKCkgew0KICAgICAgICB0aGlzLmxhc3RTaWduSW5UaW1lID0gdXRjVGltZXN0YW1wVG9EYXRlU3RyaW5nKHRoaXMubGFzdExvZ2luQXQpOw0KICAgICAgICB0aGlzLmNyZWF0aW9uVGltZSA9IHV0Y1RpbWVzdGFtcFRvRGF0ZVN0cmluZyh0aGlzLmNyZWF0ZWRBdCk7DQogICAgfQ0KICAgIF9jb3B5KG1ldGFkYXRhKSB7DQogICAgICAgIHRoaXMuY3JlYXRlZEF0ID0gbWV0YWRhdGEuY3JlYXRlZEF0Ow0KICAgICAgICB0aGlzLmxhc3RMb2dpbkF0ID0gbWV0YWRhdGEubGFzdExvZ2luQXQ7DQogICAgICAgIHRoaXMuX2luaXRpYWxpemVUaW1lKCk7DQogICAgfQ0KICAgIHRvSlNPTigpIHsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIGNyZWF0ZWRBdDogdGhpcy5jcmVhdGVkQXQsDQogICAgICAgICAgICBsYXN0TG9naW5BdDogdGhpcy5sYXN0TG9naW5BdA0KICAgICAgICB9Ow0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmFzeW5jIGZ1bmN0aW9uIF9yZWxvYWRXaXRob3V0U2F2aW5nKHVzZXIpIHsNCiAgICB2YXIgX2E7DQogICAgY29uc3QgYXV0aCA9IHVzZXIuYXV0aDsNCiAgICBjb25zdCBpZFRva2VuID0gYXdhaXQgdXNlci5nZXRJZFRva2VuKCk7DQogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBfbG9nb3V0SWZJbnZhbGlkYXRlZCh1c2VyLCBnZXRBY2NvdW50SW5mbyhhdXRoLCB7IGlkVG9rZW4gfSkpOw0KICAgIF9hc3NlcnQocmVzcG9uc2UgPT09IG51bGwgfHwgcmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3BvbnNlLnVzZXJzLmxlbmd0aCwgYXV0aCwgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICBjb25zdCBjb3JlQWNjb3VudCA9IHJlc3BvbnNlLnVzZXJzWzBdOw0KICAgIHVzZXIuX25vdGlmeVJlbG9hZExpc3RlbmVyKGNvcmVBY2NvdW50KTsNCiAgICBjb25zdCBuZXdQcm92aWRlckRhdGEgPSAoKF9hID0gY29yZUFjY291bnQucHJvdmlkZXJVc2VySW5mbykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aCkNCiAgICAgICAgPyBleHRyYWN0UHJvdmlkZXJEYXRhKGNvcmVBY2NvdW50LnByb3ZpZGVyVXNlckluZm8pDQogICAgICAgIDogW107DQogICAgY29uc3QgcHJvdmlkZXJEYXRhID0gbWVyZ2VQcm92aWRlckRhdGEodXNlci5wcm92aWRlckRhdGEsIG5ld1Byb3ZpZGVyRGF0YSk7DQogICAgLy8gUHJlc2VydmVzIHRoZSBub24tbm9ueW1vdXMgc3RhdHVzIG9mIHRoZSBzdG9yZWQgdXNlciwgZXZlbiBpZiBubyBtb3JlDQogICAgLy8gY3JlZGVudGlhbHMgKGZlZGVyYXRlZCBvciBlbWFpbC9wYXNzd29yZCkgYXJlIGxpbmtlZCB0byB0aGUgdXNlci4gSWYNCiAgICAvLyB0aGUgdXNlciB3YXMgcHJldmlvdXNseSBhbm9ueW1vdXMsIHRoZW4gdXNlIHByb3ZpZGVyIGRhdGEgdG8gdXBkYXRlLg0KICAgIC8vIE9uIHRoZSBvdGhlciBoYW5kLCBpZiBpdCB3YXMgbm90IGFub255bW91cyBiZWZvcmUsIGl0IHNob3VsZCBuZXZlciBiZQ0KICAgIC8vIGNvbnNpZGVyZWQgYW5vbnltb3VzIG5vdy4NCiAgICBjb25zdCBvbGRJc0Fub255bW91cyA9IHVzZXIuaXNBbm9ueW1vdXM7DQogICAgY29uc3QgbmV3SXNBbm9ueW1vdXMgPSAhKHVzZXIuZW1haWwgJiYgY29yZUFjY291bnQucGFzc3dvcmRIYXNoKSAmJiAhKHByb3ZpZGVyRGF0YSA9PT0gbnVsbCB8fCBwcm92aWRlckRhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHByb3ZpZGVyRGF0YS5sZW5ndGgpOw0KICAgIGNvbnN0IGlzQW5vbnltb3VzID0gIW9sZElzQW5vbnltb3VzID8gZmFsc2UgOiBuZXdJc0Fub255bW91czsNCiAgICBjb25zdCB1cGRhdGVzID0gew0KICAgICAgICB1aWQ6IGNvcmVBY2NvdW50LmxvY2FsSWQsDQogICAgICAgIGRpc3BsYXlOYW1lOiBjb3JlQWNjb3VudC5kaXNwbGF5TmFtZSB8fCBudWxsLA0KICAgICAgICBwaG90b1VSTDogY29yZUFjY291bnQucGhvdG9VcmwgfHwgbnVsbCwNCiAgICAgICAgZW1haWw6IGNvcmVBY2NvdW50LmVtYWlsIHx8IG51bGwsDQogICAgICAgIGVtYWlsVmVyaWZpZWQ6IGNvcmVBY2NvdW50LmVtYWlsVmVyaWZpZWQgfHwgZmFsc2UsDQogICAgICAgIHBob25lTnVtYmVyOiBjb3JlQWNjb3VudC5waG9uZU51bWJlciB8fCBudWxsLA0KICAgICAgICB0ZW5hbnRJZDogY29yZUFjY291bnQudGVuYW50SWQgfHwgbnVsbCwNCiAgICAgICAgcHJvdmlkZXJEYXRhLA0KICAgICAgICBtZXRhZGF0YTogbmV3IFVzZXJNZXRhZGF0YShjb3JlQWNjb3VudC5jcmVhdGVkQXQsIGNvcmVBY2NvdW50Lmxhc3RMb2dpbkF0KSwNCiAgICAgICAgaXNBbm9ueW1vdXMNCiAgICB9Ow0KICAgIE9iamVjdC5hc3NpZ24odXNlciwgdXBkYXRlcyk7DQp9DQovKioNCiAqIFJlbG9hZHMgdXNlciBhY2NvdW50IGRhdGEsIGlmIHNpZ25lZCBpbi4NCiAqDQogKiBAcGFyYW0gdXNlciAtIFRoZSB1c2VyLg0KICoNCiAqIEBwdWJsaWMNCiAqLw0KYXN5bmMgZnVuY3Rpb24gcmVsb2FkKHVzZXIpIHsNCiAgICBjb25zdCB1c2VySW50ZXJuYWwgPSBnZXRNb2R1bGFySW5zdGFuY2UodXNlcik7DQogICAgYXdhaXQgX3JlbG9hZFdpdGhvdXRTYXZpbmcodXNlckludGVybmFsKTsNCiAgICAvLyBFdmVuIHRob3VnaCB0aGUgY3VycmVudCB1c2VyIGhhc24ndCBjaGFuZ2VkLCB1cGRhdGUNCiAgICAvLyBjdXJyZW50IHVzZXIgd2lsbCB0cmlnZ2VyIGEgcGVyc2lzdGVuY2UgdXBkYXRlIHcvIHRoZQ0KICAgIC8vIG5ldyBpbmZvLg0KICAgIGF3YWl0IHVzZXJJbnRlcm5hbC5hdXRoLl9wZXJzaXN0VXNlcklmQ3VycmVudCh1c2VySW50ZXJuYWwpOw0KICAgIHVzZXJJbnRlcm5hbC5hdXRoLl9ub3RpZnlMaXN0ZW5lcnNJZkN1cnJlbnQodXNlckludGVybmFsKTsNCn0NCmZ1bmN0aW9uIG1lcmdlUHJvdmlkZXJEYXRhKG9yaWdpbmFsLCBuZXdEYXRhKSB7DQogICAgY29uc3QgZGVkdXBlZCA9IG9yaWdpbmFsLmZpbHRlcihvID0+ICFuZXdEYXRhLnNvbWUobiA9PiBuLnByb3ZpZGVySWQgPT09IG8ucHJvdmlkZXJJZCkpOw0KICAgIHJldHVybiBbLi4uZGVkdXBlZCwgLi4ubmV3RGF0YV07DQp9DQpmdW5jdGlvbiBleHRyYWN0UHJvdmlkZXJEYXRhKHByb3ZpZGVycykgew0KICAgIHJldHVybiBwcm92aWRlcnMubWFwKChfYSkgPT4gew0KICAgICAgICB2YXIgeyBwcm92aWRlcklkIH0gPSBfYSwgcHJvdmlkZXIgPSBfX3Jlc3QoX2EsIFsicHJvdmlkZXJJZCJdKTsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIHByb3ZpZGVySWQsDQogICAgICAgICAgICB1aWQ6IHByb3ZpZGVyLnJhd0lkIHx8ICcnLA0KICAgICAgICAgICAgZGlzcGxheU5hbWU6IHByb3ZpZGVyLmRpc3BsYXlOYW1lIHx8IG51bGwsDQogICAgICAgICAgICBlbWFpbDogcHJvdmlkZXIuZW1haWwgfHwgbnVsbCwNCiAgICAgICAgICAgIHBob25lTnVtYmVyOiBwcm92aWRlci5waG9uZU51bWJlciB8fCBudWxsLA0KICAgICAgICAgICAgcGhvdG9VUkw6IHByb3ZpZGVyLnBob3RvVXJsIHx8IG51bGwNCiAgICAgICAgfTsNCiAgICB9KTsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmFzeW5jIGZ1bmN0aW9uIHJlcXVlc3RTdHNUb2tlbihhdXRoLCByZWZyZXNoVG9rZW4pIHsNCiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IF9wZXJmb3JtRmV0Y2hXaXRoRXJyb3JIYW5kbGluZyhhdXRoLCB7fSwgYXN5bmMgKCkgPT4gew0KICAgICAgICBjb25zdCBib2R5ID0gcXVlcnlzdHJpbmckMSh7DQogICAgICAgICAgICAnZ3JhbnRfdHlwZSc6ICdyZWZyZXNoX3Rva2VuJywNCiAgICAgICAgICAgICdyZWZyZXNoX3Rva2VuJzogcmVmcmVzaFRva2VuDQogICAgICAgIH0pLnNsaWNlKDEpOw0KICAgICAgICBjb25zdCB7IHRva2VuQXBpSG9zdCwgYXBpS2V5IH0gPSBhdXRoLmNvbmZpZzsNCiAgICAgICAgY29uc3QgdXJsID0gX2dldEZpbmFsVGFyZ2V0KGF1dGgsIHRva2VuQXBpSG9zdCwgIi92MS90b2tlbiIgLyogRW5kcG9pbnQuVE9LRU4gKi8sIGBrZXk9JHthcGlLZXl9YCk7DQogICAgICAgIGNvbnN0IGhlYWRlcnMgPSBhd2FpdCBhdXRoLl9nZXRBZGRpdGlvbmFsSGVhZGVycygpOw0KICAgICAgICBoZWFkZXJzWyJDb250ZW50LVR5cGUiIC8qIEh0dHBIZWFkZXIuQ09OVEVOVF9UWVBFICovXSA9ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnOw0KICAgICAgICByZXR1cm4gRmV0Y2hQcm92aWRlci5mZXRjaCgpKHVybCwgew0KICAgICAgICAgICAgbWV0aG9kOiAiUE9TVCIgLyogSHR0cE1ldGhvZC5QT1NUICovLA0KICAgICAgICAgICAgaGVhZGVycywNCiAgICAgICAgICAgIGJvZHkNCiAgICAgICAgfSk7DQogICAgfSk7DQogICAgLy8gVGhlIHJlc3BvbnNlIGNvbWVzIGJhY2sgaW4gc25ha2VfY2FzZS4gQ29udmVydCB0byBjYW1lbDoNCiAgICByZXR1cm4gew0KICAgICAgICBhY2Nlc3NUb2tlbjogcmVzcG9uc2UuYWNjZXNzX3Rva2VuLA0KICAgICAgICBleHBpcmVzSW46IHJlc3BvbnNlLmV4cGlyZXNfaW4sDQogICAgICAgIHJlZnJlc2hUb2tlbjogcmVzcG9uc2UucmVmcmVzaF90b2tlbg0KICAgIH07DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIFdlIG5lZWQgdG8gbWFyayB0aGlzIGNsYXNzIGFzIGludGVybmFsIGV4cGxpY2l0bHkgdG8gZXhjbHVkZSBpdCBpbiB0aGUgcHVibGljIHR5cGluZ3MsIGJlY2F1c2UNCiAqIGl0IHJlZmVyZW5jZXMgQXV0aEludGVybmFsIHdoaWNoIGhhcyBhIGNpcmN1bGFyIGRlcGVuZGVuY3kgd2l0aCBVc2VySW50ZXJuYWwuDQogKg0KICogQGludGVybmFsDQogKi8NCmNsYXNzIFN0c1Rva2VuTWFuYWdlciB7DQogICAgY29uc3RydWN0b3IoKSB7DQogICAgICAgIHRoaXMucmVmcmVzaFRva2VuID0gbnVsbDsNCiAgICAgICAgdGhpcy5hY2Nlc3NUb2tlbiA9IG51bGw7DQogICAgICAgIHRoaXMuZXhwaXJhdGlvblRpbWUgPSBudWxsOw0KICAgIH0NCiAgICBnZXQgaXNFeHBpcmVkKCkgew0KICAgICAgICByZXR1cm4gKCF0aGlzLmV4cGlyYXRpb25UaW1lIHx8DQogICAgICAgICAgICBEYXRlLm5vdygpID4gdGhpcy5leHBpcmF0aW9uVGltZSAtIDMwMDAwIC8qIEJ1ZmZlci5UT0tFTl9SRUZSRVNIICovKTsNCiAgICB9DQogICAgdXBkYXRlRnJvbVNlcnZlclJlc3BvbnNlKHJlc3BvbnNlKSB7DQogICAgICAgIF9hc3NlcnQocmVzcG9uc2UuaWRUb2tlbiwgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICAgICAgX2Fzc2VydCh0eXBlb2YgcmVzcG9uc2UuaWRUb2tlbiAhPT0gJ3VuZGVmaW5lZCcsICJpbnRlcm5hbC1lcnJvciIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7DQogICAgICAgIF9hc3NlcnQodHlwZW9mIHJlc3BvbnNlLnJlZnJlc2hUb2tlbiAhPT0gJ3VuZGVmaW5lZCcsICJpbnRlcm5hbC1lcnJvciIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7DQogICAgICAgIGNvbnN0IGV4cGlyZXNJbiA9ICdleHBpcmVzSW4nIGluIHJlc3BvbnNlICYmIHR5cGVvZiByZXNwb25zZS5leHBpcmVzSW4gIT09ICd1bmRlZmluZWQnDQogICAgICAgICAgICA/IE51bWJlcihyZXNwb25zZS5leHBpcmVzSW4pDQogICAgICAgICAgICA6IF90b2tlbkV4cGlyZXNJbihyZXNwb25zZS5pZFRva2VuKTsNCiAgICAgICAgdGhpcy51cGRhdGVUb2tlbnNBbmRFeHBpcmF0aW9uKHJlc3BvbnNlLmlkVG9rZW4sIHJlc3BvbnNlLnJlZnJlc2hUb2tlbiwgZXhwaXJlc0luKTsNCiAgICB9DQogICAgYXN5bmMgZ2V0VG9rZW4oYXV0aCwgZm9yY2VSZWZyZXNoID0gZmFsc2UpIHsNCiAgICAgICAgX2Fzc2VydCghdGhpcy5hY2Nlc3NUb2tlbiB8fCB0aGlzLnJlZnJlc2hUb2tlbiwgYXV0aCwgInVzZXItdG9rZW4tZXhwaXJlZCIgLyogQXV0aEVycm9yQ29kZS5UT0tFTl9FWFBJUkVEICovKTsNCiAgICAgICAgaWYgKCFmb3JjZVJlZnJlc2ggJiYgdGhpcy5hY2Nlc3NUb2tlbiAmJiAhdGhpcy5pc0V4cGlyZWQpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmFjY2Vzc1Rva2VuOw0KICAgICAgICB9DQogICAgICAgIGlmICh0aGlzLnJlZnJlc2hUb2tlbikgew0KICAgICAgICAgICAgYXdhaXQgdGhpcy5yZWZyZXNoKGF1dGgsIHRoaXMucmVmcmVzaFRva2VuKTsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmFjY2Vzc1Rva2VuOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBudWxsOw0KICAgIH0NCiAgICBjbGVhclJlZnJlc2hUb2tlbigpIHsNCiAgICAgICAgdGhpcy5yZWZyZXNoVG9rZW4gPSBudWxsOw0KICAgIH0NCiAgICBhc3luYyByZWZyZXNoKGF1dGgsIG9sZFRva2VuKSB7DQogICAgICAgIGNvbnN0IHsgYWNjZXNzVG9rZW4sIHJlZnJlc2hUb2tlbiwgZXhwaXJlc0luIH0gPSBhd2FpdCByZXF1ZXN0U3RzVG9rZW4oYXV0aCwgb2xkVG9rZW4pOw0KICAgICAgICB0aGlzLnVwZGF0ZVRva2Vuc0FuZEV4cGlyYXRpb24oYWNjZXNzVG9rZW4sIHJlZnJlc2hUb2tlbiwgTnVtYmVyKGV4cGlyZXNJbikpOw0KICAgIH0NCiAgICB1cGRhdGVUb2tlbnNBbmRFeHBpcmF0aW9uKGFjY2Vzc1Rva2VuLCByZWZyZXNoVG9rZW4sIGV4cGlyZXNJblNlYykgew0KICAgICAgICB0aGlzLnJlZnJlc2hUb2tlbiA9IHJlZnJlc2hUb2tlbiB8fCBudWxsOw0KICAgICAgICB0aGlzLmFjY2Vzc1Rva2VuID0gYWNjZXNzVG9rZW4gfHwgbnVsbDsNCiAgICAgICAgdGhpcy5leHBpcmF0aW9uVGltZSA9IERhdGUubm93KCkgKyBleHBpcmVzSW5TZWMgKiAxMDAwOw0KICAgIH0NCiAgICBzdGF0aWMgZnJvbUpTT04oYXBwTmFtZSwgb2JqZWN0KSB7DQogICAgICAgIGNvbnN0IHsgcmVmcmVzaFRva2VuLCBhY2Nlc3NUb2tlbiwgZXhwaXJhdGlvblRpbWUgfSA9IG9iamVjdDsNCiAgICAgICAgY29uc3QgbWFuYWdlciA9IG5ldyBTdHNUb2tlbk1hbmFnZXIoKTsNCiAgICAgICAgaWYgKHJlZnJlc2hUb2tlbikgew0KICAgICAgICAgICAgX2Fzc2VydCh0eXBlb2YgcmVmcmVzaFRva2VuID09PSAnc3RyaW5nJywgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovLCB7DQogICAgICAgICAgICAgICAgYXBwTmFtZQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBtYW5hZ2VyLnJlZnJlc2hUb2tlbiA9IHJlZnJlc2hUb2tlbjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoYWNjZXNzVG9rZW4pIHsNCiAgICAgICAgICAgIF9hc3NlcnQodHlwZW9mIGFjY2Vzc1Rva2VuID09PSAnc3RyaW5nJywgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovLCB7DQogICAgICAgICAgICAgICAgYXBwTmFtZQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBtYW5hZ2VyLmFjY2Vzc1Rva2VuID0gYWNjZXNzVG9rZW47DQogICAgICAgIH0NCiAgICAgICAgaWYgKGV4cGlyYXRpb25UaW1lKSB7DQogICAgICAgICAgICBfYXNzZXJ0KHR5cGVvZiBleHBpcmF0aW9uVGltZSA9PT0gJ251bWJlcicsICJpbnRlcm5hbC1lcnJvciIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLywgew0KICAgICAgICAgICAgICAgIGFwcE5hbWUNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgbWFuYWdlci5leHBpcmF0aW9uVGltZSA9IGV4cGlyYXRpb25UaW1lOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBtYW5hZ2VyOw0KICAgIH0NCiAgICB0b0pTT04oKSB7DQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgICByZWZyZXNoVG9rZW46IHRoaXMucmVmcmVzaFRva2VuLA0KICAgICAgICAgICAgYWNjZXNzVG9rZW46IHRoaXMuYWNjZXNzVG9rZW4sDQogICAgICAgICAgICBleHBpcmF0aW9uVGltZTogdGhpcy5leHBpcmF0aW9uVGltZQ0KICAgICAgICB9Ow0KICAgIH0NCiAgICBfYXNzaWduKHN0c1Rva2VuTWFuYWdlcikgew0KICAgICAgICB0aGlzLmFjY2Vzc1Rva2VuID0gc3RzVG9rZW5NYW5hZ2VyLmFjY2Vzc1Rva2VuOw0KICAgICAgICB0aGlzLnJlZnJlc2hUb2tlbiA9IHN0c1Rva2VuTWFuYWdlci5yZWZyZXNoVG9rZW47DQogICAgICAgIHRoaXMuZXhwaXJhdGlvblRpbWUgPSBzdHNUb2tlbk1hbmFnZXIuZXhwaXJhdGlvblRpbWU7DQogICAgfQ0KICAgIF9jbG9uZSgpIHsNCiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24obmV3IFN0c1Rva2VuTWFuYWdlcigpLCB0aGlzLnRvSlNPTigpKTsNCiAgICB9DQogICAgX3BlcmZvcm1SZWZyZXNoKCkgew0KICAgICAgICByZXR1cm4gZGVidWdGYWlsKCdub3QgaW1wbGVtZW50ZWQnKTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpmdW5jdGlvbiBhc3NlcnRTdHJpbmdPclVuZGVmaW5lZChhc3NlcnRpb24sIGFwcE5hbWUpIHsNCiAgICBfYXNzZXJ0KHR5cGVvZiBhc3NlcnRpb24gPT09ICdzdHJpbmcnIHx8IHR5cGVvZiBhc3NlcnRpb24gPT09ICd1bmRlZmluZWQnLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8sIHsgYXBwTmFtZSB9KTsNCn0NCmNsYXNzIFVzZXJJbXBsIHsNCiAgICBjb25zdHJ1Y3RvcihfYSkgew0KICAgICAgICB2YXIgeyB1aWQsIGF1dGgsIHN0c1Rva2VuTWFuYWdlciB9ID0gX2EsIG9wdCA9IF9fcmVzdChfYSwgWyJ1aWQiLCAiYXV0aCIsICJzdHNUb2tlbk1hbmFnZXIiXSk7DQogICAgICAgIC8vIEZvciB0aGUgdXNlciBvYmplY3QsIHByb3ZpZGVyIGlzIGFsd2F5cyBGaXJlYmFzZS4NCiAgICAgICAgdGhpcy5wcm92aWRlcklkID0gImZpcmViYXNlIiAvKiBQcm92aWRlcklkLkZJUkVCQVNFICovOw0KICAgICAgICB0aGlzLnByb2FjdGl2ZVJlZnJlc2ggPSBuZXcgUHJvYWN0aXZlUmVmcmVzaCh0aGlzKTsNCiAgICAgICAgdGhpcy5yZWxvYWRVc2VySW5mbyA9IG51bGw7DQogICAgICAgIHRoaXMucmVsb2FkTGlzdGVuZXIgPSBudWxsOw0KICAgICAgICB0aGlzLnVpZCA9IHVpZDsNCiAgICAgICAgdGhpcy5hdXRoID0gYXV0aDsNCiAgICAgICAgdGhpcy5zdHNUb2tlbk1hbmFnZXIgPSBzdHNUb2tlbk1hbmFnZXI7DQogICAgICAgIHRoaXMuYWNjZXNzVG9rZW4gPSBzdHNUb2tlbk1hbmFnZXIuYWNjZXNzVG9rZW47DQogICAgICAgIHRoaXMuZGlzcGxheU5hbWUgPSBvcHQuZGlzcGxheU5hbWUgfHwgbnVsbDsNCiAgICAgICAgdGhpcy5lbWFpbCA9IG9wdC5lbWFpbCB8fCBudWxsOw0KICAgICAgICB0aGlzLmVtYWlsVmVyaWZpZWQgPSBvcHQuZW1haWxWZXJpZmllZCB8fCBmYWxzZTsNCiAgICAgICAgdGhpcy5waG9uZU51bWJlciA9IG9wdC5waG9uZU51bWJlciB8fCBudWxsOw0KICAgICAgICB0aGlzLnBob3RvVVJMID0gb3B0LnBob3RvVVJMIHx8IG51bGw7DQogICAgICAgIHRoaXMuaXNBbm9ueW1vdXMgPSBvcHQuaXNBbm9ueW1vdXMgfHwgZmFsc2U7DQogICAgICAgIHRoaXMudGVuYW50SWQgPSBvcHQudGVuYW50SWQgfHwgbnVsbDsNCiAgICAgICAgdGhpcy5wcm92aWRlckRhdGEgPSBvcHQucHJvdmlkZXJEYXRhID8gWy4uLm9wdC5wcm92aWRlckRhdGFdIDogW107DQogICAgICAgIHRoaXMubWV0YWRhdGEgPSBuZXcgVXNlck1ldGFkYXRhKG9wdC5jcmVhdGVkQXQgfHwgdW5kZWZpbmVkLCBvcHQubGFzdExvZ2luQXQgfHwgdW5kZWZpbmVkKTsNCiAgICB9DQogICAgYXN5bmMgZ2V0SWRUb2tlbihmb3JjZVJlZnJlc2gpIHsNCiAgICAgICAgY29uc3QgYWNjZXNzVG9rZW4gPSBhd2FpdCBfbG9nb3V0SWZJbnZhbGlkYXRlZCh0aGlzLCB0aGlzLnN0c1Rva2VuTWFuYWdlci5nZXRUb2tlbih0aGlzLmF1dGgsIGZvcmNlUmVmcmVzaCkpOw0KICAgICAgICBfYXNzZXJ0KGFjY2Vzc1Rva2VuLCB0aGlzLmF1dGgsICJpbnRlcm5hbC1lcnJvciIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7DQogICAgICAgIGlmICh0aGlzLmFjY2Vzc1Rva2VuICE9PSBhY2Nlc3NUb2tlbikgew0KICAgICAgICAgICAgdGhpcy5hY2Nlc3NUb2tlbiA9IGFjY2Vzc1Rva2VuOw0KICAgICAgICAgICAgYXdhaXQgdGhpcy5hdXRoLl9wZXJzaXN0VXNlcklmQ3VycmVudCh0aGlzKTsNCiAgICAgICAgICAgIHRoaXMuYXV0aC5fbm90aWZ5TGlzdGVuZXJzSWZDdXJyZW50KHRoaXMpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBhY2Nlc3NUb2tlbjsNCiAgICB9DQogICAgZ2V0SWRUb2tlblJlc3VsdChmb3JjZVJlZnJlc2gpIHsNCiAgICAgICAgcmV0dXJuIGdldElkVG9rZW5SZXN1bHQodGhpcywgZm9yY2VSZWZyZXNoKTsNCiAgICB9DQogICAgcmVsb2FkKCkgew0KICAgICAgICByZXR1cm4gcmVsb2FkKHRoaXMpOw0KICAgIH0NCiAgICBfYXNzaWduKHVzZXIpIHsNCiAgICAgICAgaWYgKHRoaXMgPT09IHVzZXIpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBfYXNzZXJ0KHRoaXMudWlkID09PSB1c2VyLnVpZCwgdGhpcy5hdXRoLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pOw0KICAgICAgICB0aGlzLmRpc3BsYXlOYW1lID0gdXNlci5kaXNwbGF5TmFtZTsNCiAgICAgICAgdGhpcy5waG90b1VSTCA9IHVzZXIucGhvdG9VUkw7DQogICAgICAgIHRoaXMuZW1haWwgPSB1c2VyLmVtYWlsOw0KICAgICAgICB0aGlzLmVtYWlsVmVyaWZpZWQgPSB1c2VyLmVtYWlsVmVyaWZpZWQ7DQogICAgICAgIHRoaXMucGhvbmVOdW1iZXIgPSB1c2VyLnBob25lTnVtYmVyOw0KICAgICAgICB0aGlzLmlzQW5vbnltb3VzID0gdXNlci5pc0Fub255bW91czsNCiAgICAgICAgdGhpcy50ZW5hbnRJZCA9IHVzZXIudGVuYW50SWQ7DQogICAgICAgIHRoaXMucHJvdmlkZXJEYXRhID0gdXNlci5wcm92aWRlckRhdGEubWFwKHVzZXJJbmZvID0+IChPYmplY3QuYXNzaWduKHt9LCB1c2VySW5mbykpKTsNCiAgICAgICAgdGhpcy5tZXRhZGF0YS5fY29weSh1c2VyLm1ldGFkYXRhKTsNCiAgICAgICAgdGhpcy5zdHNUb2tlbk1hbmFnZXIuX2Fzc2lnbih1c2VyLnN0c1Rva2VuTWFuYWdlcik7DQogICAgfQ0KICAgIF9jbG9uZShhdXRoKSB7DQogICAgICAgIGNvbnN0IG5ld1VzZXIgPSBuZXcgVXNlckltcGwoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCB0aGlzKSwgeyBhdXRoLCBzdHNUb2tlbk1hbmFnZXI6IHRoaXMuc3RzVG9rZW5NYW5hZ2VyLl9jbG9uZSgpIH0pKTsNCiAgICAgICAgbmV3VXNlci5tZXRhZGF0YS5fY29weSh0aGlzLm1ldGFkYXRhKTsNCiAgICAgICAgcmV0dXJuIG5ld1VzZXI7DQogICAgfQ0KICAgIF9vblJlbG9hZChjYWxsYmFjaykgew0KICAgICAgICAvLyBUaGVyZSBzaG91bGQgb25seSBldmVyIGJlIG9uZSBsaXN0ZW5lciwgYW5kIHRoYXQgaXMgYSBzaW5nbGUgaW5zdGFuY2Ugb2YgTXVsdGlGYWN0b3JVc2VyDQogICAgICAgIF9hc3NlcnQoIXRoaXMucmVsb2FkTGlzdGVuZXIsIHRoaXMuYXV0aCwgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICAgICAgdGhpcy5yZWxvYWRMaXN0ZW5lciA9IGNhbGxiYWNrOw0KICAgICAgICBpZiAodGhpcy5yZWxvYWRVc2VySW5mbykgew0KICAgICAgICAgICAgdGhpcy5fbm90aWZ5UmVsb2FkTGlzdGVuZXIodGhpcy5yZWxvYWRVc2VySW5mbyk7DQogICAgICAgICAgICB0aGlzLnJlbG9hZFVzZXJJbmZvID0gbnVsbDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBfbm90aWZ5UmVsb2FkTGlzdGVuZXIodXNlckluZm8pIHsNCiAgICAgICAgaWYgKHRoaXMucmVsb2FkTGlzdGVuZXIpIHsNCiAgICAgICAgICAgIHRoaXMucmVsb2FkTGlzdGVuZXIodXNlckluZm8pOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgLy8gSWYgbm8gbGlzdGVuZXIgaXMgc3Vic2NyaWJlZCB5ZXQsIHNhdmUgdGhlIHJlc3VsdCBzbyBpdCdzIGF2YWlsYWJsZSB3aGVuIHRoZXkgZG8gc3Vic2NyaWJlDQogICAgICAgICAgICB0aGlzLnJlbG9hZFVzZXJJbmZvID0gdXNlckluZm87DQogICAgICAgIH0NCiAgICB9DQogICAgX3N0YXJ0UHJvYWN0aXZlUmVmcmVzaCgpIHsNCiAgICAgICAgdGhpcy5wcm9hY3RpdmVSZWZyZXNoLl9zdGFydCgpOw0KICAgIH0NCiAgICBfc3RvcFByb2FjdGl2ZVJlZnJlc2goKSB7DQogICAgICAgIHRoaXMucHJvYWN0aXZlUmVmcmVzaC5fc3RvcCgpOw0KICAgIH0NCiAgICBhc3luYyBfdXBkYXRlVG9rZW5zSWZOZWNlc3NhcnkocmVzcG9uc2UsIHJlbG9hZCA9IGZhbHNlKSB7DQogICAgICAgIGxldCB0b2tlbnNSZWZyZXNoZWQgPSBmYWxzZTsNCiAgICAgICAgaWYgKHJlc3BvbnNlLmlkVG9rZW4gJiYNCiAgICAgICAgICAgIHJlc3BvbnNlLmlkVG9rZW4gIT09IHRoaXMuc3RzVG9rZW5NYW5hZ2VyLmFjY2Vzc1Rva2VuKSB7DQogICAgICAgICAgICB0aGlzLnN0c1Rva2VuTWFuYWdlci51cGRhdGVGcm9tU2VydmVyUmVzcG9uc2UocmVzcG9uc2UpOw0KICAgICAgICAgICAgdG9rZW5zUmVmcmVzaGVkID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAocmVsb2FkKSB7DQogICAgICAgICAgICBhd2FpdCBfcmVsb2FkV2l0aG91dFNhdmluZyh0aGlzKTsNCiAgICAgICAgfQ0KICAgICAgICBhd2FpdCB0aGlzLmF1dGguX3BlcnNpc3RVc2VySWZDdXJyZW50KHRoaXMpOw0KICAgICAgICBpZiAodG9rZW5zUmVmcmVzaGVkKSB7DQogICAgICAgICAgICB0aGlzLmF1dGguX25vdGlmeUxpc3RlbmVyc0lmQ3VycmVudCh0aGlzKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBhc3luYyBkZWxldGUoKSB7DQogICAgICAgIGNvbnN0IGlkVG9rZW4gPSBhd2FpdCB0aGlzLmdldElkVG9rZW4oKTsNCiAgICAgICAgYXdhaXQgX2xvZ291dElmSW52YWxpZGF0ZWQodGhpcywgZGVsZXRlQWNjb3VudCh0aGlzLmF1dGgsIHsgaWRUb2tlbiB9KSk7DQogICAgICAgIHRoaXMuc3RzVG9rZW5NYW5hZ2VyLmNsZWFyUmVmcmVzaFRva2VuKCk7DQogICAgICAgIC8vIFRPRE86IERldGVybWluZSBpZiBjYW5jZWxsYWJsZS1wcm9taXNlcyBhcmUgbmVjZXNzYXJ5IHRvIHVzZSBpbiB0aGlzIGNsYXNzIHNvIHRoYXQgZGVsZXRlKCkNCiAgICAgICAgLy8gICAgICAgY2FuY2VscyBwZW5kaW5nIGFjdGlvbnMuLi4NCiAgICAgICAgcmV0dXJuIHRoaXMuYXV0aC5zaWduT3V0KCk7DQogICAgfQ0KICAgIHRvSlNPTigpIHsNCiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7IHVpZDogdGhpcy51aWQsIGVtYWlsOiB0aGlzLmVtYWlsIHx8IHVuZGVmaW5lZCwgZW1haWxWZXJpZmllZDogdGhpcy5lbWFpbFZlcmlmaWVkLCBkaXNwbGF5TmFtZTogdGhpcy5kaXNwbGF5TmFtZSB8fCB1bmRlZmluZWQsIGlzQW5vbnltb3VzOiB0aGlzLmlzQW5vbnltb3VzLCBwaG90b1VSTDogdGhpcy5waG90b1VSTCB8fCB1bmRlZmluZWQsIHBob25lTnVtYmVyOiB0aGlzLnBob25lTnVtYmVyIHx8IHVuZGVmaW5lZCwgdGVuYW50SWQ6IHRoaXMudGVuYW50SWQgfHwgdW5kZWZpbmVkLCBwcm92aWRlckRhdGE6IHRoaXMucHJvdmlkZXJEYXRhLm1hcCh1c2VySW5mbyA9PiAoT2JqZWN0LmFzc2lnbih7fSwgdXNlckluZm8pKSksIHN0c1Rva2VuTWFuYWdlcjogdGhpcy5zdHNUb2tlbk1hbmFnZXIudG9KU09OKCksIA0KICAgICAgICAgICAgLy8gUmVkaXJlY3QgZXZlbnQgSUQgbXVzdCBiZSBtYWludGFpbmVkIGluIGNhc2UgdGhlcmUgaXMgYSBwZW5kaW5nDQogICAgICAgICAgICAvLyByZWRpcmVjdCBldmVudC4NCiAgICAgICAgICAgIF9yZWRpcmVjdEV2ZW50SWQ6IHRoaXMuX3JlZGlyZWN0RXZlbnRJZCB9LCB0aGlzLm1ldGFkYXRhLnRvSlNPTigpKSwgeyANCiAgICAgICAgICAgIC8vIFJlcXVpcmVkIGZvciBjb21wYXRpYmlsaXR5IHdpdGggdGhlIGxlZ2FjeSBTREsgKGdvL2ZpcmViYXNlLWF1dGgtc2RrLXBlcnNpc3RlbmNlLXBhcnNpbmcpOg0KICAgICAgICAgICAgYXBpS2V5OiB0aGlzLmF1dGguY29uZmlnLmFwaUtleSwgYXBwTmFtZTogdGhpcy5hdXRoLm5hbWUgfSk7DQogICAgfQ0KICAgIGdldCByZWZyZXNoVG9rZW4oKSB7DQogICAgICAgIHJldHVybiB0aGlzLnN0c1Rva2VuTWFuYWdlci5yZWZyZXNoVG9rZW4gfHwgJyc7DQogICAgfQ0KICAgIHN0YXRpYyBfZnJvbUpTT04oYXV0aCwgb2JqZWN0KSB7DQogICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mLCBfZywgX2g7DQogICAgICAgIGNvbnN0IGRpc3BsYXlOYW1lID0gKF9hID0gb2JqZWN0LmRpc3BsYXlOYW1lKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiB1bmRlZmluZWQ7DQogICAgICAgIGNvbnN0IGVtYWlsID0gKF9iID0gb2JqZWN0LmVtYWlsKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiB1bmRlZmluZWQ7DQogICAgICAgIGNvbnN0IHBob25lTnVtYmVyID0gKF9jID0gb2JqZWN0LnBob25lTnVtYmVyKSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiB1bmRlZmluZWQ7DQogICAgICAgIGNvbnN0IHBob3RvVVJMID0gKF9kID0gb2JqZWN0LnBob3RvVVJMKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiB1bmRlZmluZWQ7DQogICAgICAgIGNvbnN0IHRlbmFudElkID0gKF9lID0gb2JqZWN0LnRlbmFudElkKSAhPT0gbnVsbCAmJiBfZSAhPT0gdm9pZCAwID8gX2UgOiB1bmRlZmluZWQ7DQogICAgICAgIGNvbnN0IF9yZWRpcmVjdEV2ZW50SWQgPSAoX2YgPSBvYmplY3QuX3JlZGlyZWN0RXZlbnRJZCkgIT09IG51bGwgJiYgX2YgIT09IHZvaWQgMCA/IF9mIDogdW5kZWZpbmVkOw0KICAgICAgICBjb25zdCBjcmVhdGVkQXQgPSAoX2cgPSBvYmplY3QuY3JlYXRlZEF0KSAhPT0gbnVsbCAmJiBfZyAhPT0gdm9pZCAwID8gX2cgOiB1bmRlZmluZWQ7DQogICAgICAgIGNvbnN0IGxhc3RMb2dpbkF0ID0gKF9oID0gb2JqZWN0Lmxhc3RMb2dpbkF0KSAhPT0gbnVsbCAmJiBfaCAhPT0gdm9pZCAwID8gX2ggOiB1bmRlZmluZWQ7DQogICAgICAgIGNvbnN0IHsgdWlkLCBlbWFpbFZlcmlmaWVkLCBpc0Fub255bW91cywgcHJvdmlkZXJEYXRhLCBzdHNUb2tlbk1hbmFnZXI6IHBsYWluT2JqZWN0VG9rZW5NYW5hZ2VyIH0gPSBvYmplY3Q7DQogICAgICAgIF9hc3NlcnQodWlkICYmIHBsYWluT2JqZWN0VG9rZW5NYW5hZ2VyLCBhdXRoLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pOw0KICAgICAgICBjb25zdCBzdHNUb2tlbk1hbmFnZXIgPSBTdHNUb2tlbk1hbmFnZXIuZnJvbUpTT04odGhpcy5uYW1lLCBwbGFpbk9iamVjdFRva2VuTWFuYWdlcik7DQogICAgICAgIF9hc3NlcnQodHlwZW9mIHVpZCA9PT0gJ3N0cmluZycsIGF1dGgsICJpbnRlcm5hbC1lcnJvciIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7DQogICAgICAgIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKGRpc3BsYXlOYW1lLCBhdXRoLm5hbWUpOw0KICAgICAgICBhc3NlcnRTdHJpbmdPclVuZGVmaW5lZChlbWFpbCwgYXV0aC5uYW1lKTsNCiAgICAgICAgX2Fzc2VydCh0eXBlb2YgZW1haWxWZXJpZmllZCA9PT0gJ2Jvb2xlYW4nLCBhdXRoLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pOw0KICAgICAgICBfYXNzZXJ0KHR5cGVvZiBpc0Fub255bW91cyA9PT0gJ2Jvb2xlYW4nLCBhdXRoLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pOw0KICAgICAgICBhc3NlcnRTdHJpbmdPclVuZGVmaW5lZChwaG9uZU51bWJlciwgYXV0aC5uYW1lKTsNCiAgICAgICAgYXNzZXJ0U3RyaW5nT3JVbmRlZmluZWQocGhvdG9VUkwsIGF1dGgubmFtZSk7DQogICAgICAgIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKHRlbmFudElkLCBhdXRoLm5hbWUpOw0KICAgICAgICBhc3NlcnRTdHJpbmdPclVuZGVmaW5lZChfcmVkaXJlY3RFdmVudElkLCBhdXRoLm5hbWUpOw0KICAgICAgICBhc3NlcnRTdHJpbmdPclVuZGVmaW5lZChjcmVhdGVkQXQsIGF1dGgubmFtZSk7DQogICAgICAgIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKGxhc3RMb2dpbkF0LCBhdXRoLm5hbWUpOw0KICAgICAgICBjb25zdCB1c2VyID0gbmV3IFVzZXJJbXBsKHsNCiAgICAgICAgICAgIHVpZCwNCiAgICAgICAgICAgIGF1dGgsDQogICAgICAgICAgICBlbWFpbCwNCiAgICAgICAgICAgIGVtYWlsVmVyaWZpZWQsDQogICAgICAgICAgICBkaXNwbGF5TmFtZSwNCiAgICAgICAgICAgIGlzQW5vbnltb3VzLA0KICAgICAgICAgICAgcGhvdG9VUkwsDQogICAgICAgICAgICBwaG9uZU51bWJlciwNCiAgICAgICAgICAgIHRlbmFudElkLA0KICAgICAgICAgICAgc3RzVG9rZW5NYW5hZ2VyLA0KICAgICAgICAgICAgY3JlYXRlZEF0LA0KICAgICAgICAgICAgbGFzdExvZ2luQXQNCiAgICAgICAgfSk7DQogICAgICAgIGlmIChwcm92aWRlckRhdGEgJiYgQXJyYXkuaXNBcnJheShwcm92aWRlckRhdGEpKSB7DQogICAgICAgICAgICB1c2VyLnByb3ZpZGVyRGF0YSA9IHByb3ZpZGVyRGF0YS5tYXAodXNlckluZm8gPT4gKE9iamVjdC5hc3NpZ24oe30sIHVzZXJJbmZvKSkpOw0KICAgICAgICB9DQogICAgICAgIGlmIChfcmVkaXJlY3RFdmVudElkKSB7DQogICAgICAgICAgICB1c2VyLl9yZWRpcmVjdEV2ZW50SWQgPSBfcmVkaXJlY3RFdmVudElkOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB1c2VyOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBJbml0aWFsaXplIGEgVXNlciBmcm9tIGFuIGlkVG9rZW4gc2VydmVyIHJlc3BvbnNlDQogICAgICogQHBhcmFtIGF1dGgNCiAgICAgKiBAcGFyYW0gaWRUb2tlblJlc3BvbnNlDQogICAgICovDQogICAgc3RhdGljIGFzeW5jIF9mcm9tSWRUb2tlblJlc3BvbnNlKGF1dGgsIGlkVG9rZW5SZXNwb25zZSwgaXNBbm9ueW1vdXMgPSBmYWxzZSkgew0KICAgICAgICBjb25zdCBzdHNUb2tlbk1hbmFnZXIgPSBuZXcgU3RzVG9rZW5NYW5hZ2VyKCk7DQogICAgICAgIHN0c1Rva2VuTWFuYWdlci51cGRhdGVGcm9tU2VydmVyUmVzcG9uc2UoaWRUb2tlblJlc3BvbnNlKTsNCiAgICAgICAgLy8gSW5pdGlhbGl6ZSB0aGUgRmlyZWJhc2UgQXV0aCB1c2VyLg0KICAgICAgICBjb25zdCB1c2VyID0gbmV3IFVzZXJJbXBsKHsNCiAgICAgICAgICAgIHVpZDogaWRUb2tlblJlc3BvbnNlLmxvY2FsSWQsDQogICAgICAgICAgICBhdXRoLA0KICAgICAgICAgICAgc3RzVG9rZW5NYW5hZ2VyLA0KICAgICAgICAgICAgaXNBbm9ueW1vdXMNCiAgICAgICAgfSk7DQogICAgICAgIC8vIFVwZGF0ZXMgdGhlIHVzZXIgaW5mbyBhbmQgZGF0YSBhbmQgcmVzb2x2ZXMgd2l0aCBhIHVzZXIgaW5zdGFuY2UuDQogICAgICAgIGF3YWl0IF9yZWxvYWRXaXRob3V0U2F2aW5nKHVzZXIpOw0KICAgICAgICByZXR1cm4gdXNlcjsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjb25zdCBpbnN0YW5jZUNhY2hlID0gbmV3IE1hcCgpOw0KZnVuY3Rpb24gX2dldEluc3RhbmNlKGNscykgew0KICAgIGRlYnVnQXNzZXJ0KGNscyBpbnN0YW5jZW9mIEZ1bmN0aW9uLCAnRXhwZWN0ZWQgYSBjbGFzcyBkZWZpbml0aW9uJyk7DQogICAgbGV0IGluc3RhbmNlID0gaW5zdGFuY2VDYWNoZS5nZXQoY2xzKTsNCiAgICBpZiAoaW5zdGFuY2UpIHsNCiAgICAgICAgZGVidWdBc3NlcnQoaW5zdGFuY2UgaW5zdGFuY2VvZiBjbHMsICdJbnN0YW5jZSBzdG9yZWQgaW4gY2FjaGUgbWlzbWF0Y2hlZCB3aXRoIGNsYXNzJyk7DQogICAgICAgIHJldHVybiBpbnN0YW5jZTsNCiAgICB9DQogICAgaW5zdGFuY2UgPSBuZXcgY2xzKCk7DQogICAgaW5zdGFuY2VDYWNoZS5zZXQoY2xzLCBpbnN0YW5jZSk7DQogICAgcmV0dXJuIGluc3RhbmNlOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY2xhc3MgSW5NZW1vcnlQZXJzaXN0ZW5jZSB7DQogICAgY29uc3RydWN0b3IoKSB7DQogICAgICAgIHRoaXMudHlwZSA9ICJOT05FIiAvKiBQZXJzaXN0ZW5jZVR5cGUuTk9ORSAqLzsNCiAgICAgICAgdGhpcy5zdG9yYWdlID0ge307DQogICAgfQ0KICAgIGFzeW5jIF9pc0F2YWlsYWJsZSgpIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIGFzeW5jIF9zZXQoa2V5LCB2YWx1ZSkgew0KICAgICAgICB0aGlzLnN0b3JhZ2Vba2V5XSA9IHZhbHVlOw0KICAgIH0NCiAgICBhc3luYyBfZ2V0KGtleSkgew0KICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuc3RvcmFnZVtrZXldOw0KICAgICAgICByZXR1cm4gdmFsdWUgPT09IHVuZGVmaW5lZCA/IG51bGwgOiB2YWx1ZTsNCiAgICB9DQogICAgYXN5bmMgX3JlbW92ZShrZXkpIHsNCiAgICAgICAgZGVsZXRlIHRoaXMuc3RvcmFnZVtrZXldOw0KICAgIH0NCiAgICBfYWRkTGlzdGVuZXIoX2tleSwgX2xpc3RlbmVyKSB7DQogICAgICAgIC8vIExpc3RlbmVycyBhcmUgbm90IHN1cHBvcnRlZCBmb3IgaW4tbWVtb3J5IHN0b3JhZ2Ugc2luY2UgaXQgY2Fubm90IGJlIHNoYXJlZCBhY3Jvc3Mgd2luZG93cy93b3JrZXJzDQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgX3JlbW92ZUxpc3RlbmVyKF9rZXksIF9saXN0ZW5lcikgew0KICAgICAgICAvLyBMaXN0ZW5lcnMgYXJlIG5vdCBzdXBwb3J0ZWQgZm9yIGluLW1lbW9yeSBzdG9yYWdlIHNpbmNlIGl0IGNhbm5vdCBiZSBzaGFyZWQgYWNyb3NzIHdpbmRvd3Mvd29ya2Vycw0KICAgICAgICByZXR1cm47DQogICAgfQ0KfQ0KSW5NZW1vcnlQZXJzaXN0ZW5jZS50eXBlID0gJ05PTkUnOw0KLyoqDQogKiBBbiBpbXBsZW1lbnRhdGlvbiBvZiB7QGxpbmsgUGVyc2lzdGVuY2V9IG9mIHR5cGUgJ05PTkUnLg0KICoNCiAqIEBwdWJsaWMNCiAqLw0KY29uc3QgaW5NZW1vcnlQZXJzaXN0ZW5jZSA9IEluTWVtb3J5UGVyc2lzdGVuY2U7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpmdW5jdGlvbiBfcGVyc2lzdGVuY2VLZXlOYW1lKGtleSwgYXBpS2V5LCBhcHBOYW1lKSB7DQogICAgcmV0dXJuIGAkeyJmaXJlYmFzZSIgLyogTmFtZXNwYWNlLlBFUlNJU1RFTkNFICovfToke2tleX06JHthcGlLZXl9OiR7YXBwTmFtZX1gOw0KfQ0KY2xhc3MgUGVyc2lzdGVuY2VVc2VyTWFuYWdlciB7DQogICAgY29uc3RydWN0b3IocGVyc2lzdGVuY2UsIGF1dGgsIHVzZXJLZXkpIHsNCiAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZSA9IHBlcnNpc3RlbmNlOw0KICAgICAgICB0aGlzLmF1dGggPSBhdXRoOw0KICAgICAgICB0aGlzLnVzZXJLZXkgPSB1c2VyS2V5Ow0KICAgICAgICBjb25zdCB7IGNvbmZpZywgbmFtZSB9ID0gdGhpcy5hdXRoOw0KICAgICAgICB0aGlzLmZ1bGxVc2VyS2V5ID0gX3BlcnNpc3RlbmNlS2V5TmFtZSh0aGlzLnVzZXJLZXksIGNvbmZpZy5hcGlLZXksIG5hbWUpOw0KICAgICAgICB0aGlzLmZ1bGxQZXJzaXN0ZW5jZUtleSA9IF9wZXJzaXN0ZW5jZUtleU5hbWUoInBlcnNpc3RlbmNlIiAvKiBLZXlOYW1lLlBFUlNJU1RFTkNFX1VTRVIgKi8sIGNvbmZpZy5hcGlLZXksIG5hbWUpOw0KICAgICAgICB0aGlzLmJvdW5kRXZlbnRIYW5kbGVyID0gYXV0aC5fb25TdG9yYWdlRXZlbnQuYmluZChhdXRoKTsNCiAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZS5fYWRkTGlzdGVuZXIodGhpcy5mdWxsVXNlcktleSwgdGhpcy5ib3VuZEV2ZW50SGFuZGxlcik7DQogICAgfQ0KICAgIHNldEN1cnJlbnRVc2VyKHVzZXIpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucGVyc2lzdGVuY2UuX3NldCh0aGlzLmZ1bGxVc2VyS2V5LCB1c2VyLnRvSlNPTigpKTsNCiAgICB9DQogICAgYXN5bmMgZ2V0Q3VycmVudFVzZXIoKSB7DQogICAgICAgIGNvbnN0IGJsb2IgPSBhd2FpdCB0aGlzLnBlcnNpc3RlbmNlLl9nZXQodGhpcy5mdWxsVXNlcktleSk7DQogICAgICAgIHJldHVybiBibG9iID8gVXNlckltcGwuX2Zyb21KU09OKHRoaXMuYXV0aCwgYmxvYikgOiBudWxsOw0KICAgIH0NCiAgICByZW1vdmVDdXJyZW50VXNlcigpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucGVyc2lzdGVuY2UuX3JlbW92ZSh0aGlzLmZ1bGxVc2VyS2V5KTsNCiAgICB9DQogICAgc2F2ZVBlcnNpc3RlbmNlRm9yUmVkaXJlY3QoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnBlcnNpc3RlbmNlLl9zZXQodGhpcy5mdWxsUGVyc2lzdGVuY2VLZXksIHRoaXMucGVyc2lzdGVuY2UudHlwZSk7DQogICAgfQ0KICAgIGFzeW5jIHNldFBlcnNpc3RlbmNlKG5ld1BlcnNpc3RlbmNlKSB7DQogICAgICAgIGlmICh0aGlzLnBlcnNpc3RlbmNlID09PSBuZXdQZXJzaXN0ZW5jZSkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50VXNlcigpOw0KICAgICAgICBhd2FpdCB0aGlzLnJlbW92ZUN1cnJlbnRVc2VyKCk7DQogICAgICAgIHRoaXMucGVyc2lzdGVuY2UgPSBuZXdQZXJzaXN0ZW5jZTsNCiAgICAgICAgaWYgKGN1cnJlbnRVc2VyKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5zZXRDdXJyZW50VXNlcihjdXJyZW50VXNlcik7DQogICAgICAgIH0NCiAgICB9DQogICAgZGVsZXRlKCkgew0KICAgICAgICB0aGlzLnBlcnNpc3RlbmNlLl9yZW1vdmVMaXN0ZW5lcih0aGlzLmZ1bGxVc2VyS2V5LCB0aGlzLmJvdW5kRXZlbnRIYW5kbGVyKTsNCiAgICB9DQogICAgc3RhdGljIGFzeW5jIGNyZWF0ZShhdXRoLCBwZXJzaXN0ZW5jZUhpZXJhcmNoeSwgdXNlcktleSA9ICJhdXRoVXNlciIgLyogS2V5TmFtZS5BVVRIX1VTRVIgKi8pIHsNCiAgICAgICAgaWYgKCFwZXJzaXN0ZW5jZUhpZXJhcmNoeS5sZW5ndGgpIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgUGVyc2lzdGVuY2VVc2VyTWFuYWdlcihfZ2V0SW5zdGFuY2UoaW5NZW1vcnlQZXJzaXN0ZW5jZSksIGF1dGgsIHVzZXJLZXkpOw0KICAgICAgICB9DQogICAgICAgIC8vIEVsaW1pbmF0ZSBhbnkgcGVyc2lzdGVuY2VzIHRoYXQgYXJlIG5vdCBhdmFpbGFibGUNCiAgICAgICAgY29uc3QgYXZhaWxhYmxlUGVyc2lzdGVuY2VzID0gKGF3YWl0IFByb21pc2UuYWxsKHBlcnNpc3RlbmNlSGllcmFyY2h5Lm1hcChhc3luYyAocGVyc2lzdGVuY2UpID0+IHsNCiAgICAgICAgICAgIGlmIChhd2FpdCBwZXJzaXN0ZW5jZS5faXNBdmFpbGFibGUoKSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBwZXJzaXN0ZW5jZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7DQogICAgICAgIH0pKSkuZmlsdGVyKHBlcnNpc3RlbmNlID0+IHBlcnNpc3RlbmNlKTsNCiAgICAgICAgLy8gRmFsbCBiYWNrIHRvIHRoZSBmaXJzdCBwZXJzaXN0ZW5jZSBsaXN0ZWQsIG9yIGluIG1lbW9yeSBpZiBub25lIGF2YWlsYWJsZQ0KICAgICAgICBsZXQgc2VsZWN0ZWRQZXJzaXN0ZW5jZSA9IGF2YWlsYWJsZVBlcnNpc3RlbmNlc1swXSB8fA0KICAgICAgICAgICAgX2dldEluc3RhbmNlKGluTWVtb3J5UGVyc2lzdGVuY2UpOw0KICAgICAgICBjb25zdCBrZXkgPSBfcGVyc2lzdGVuY2VLZXlOYW1lKHVzZXJLZXksIGF1dGguY29uZmlnLmFwaUtleSwgYXV0aC5uYW1lKTsNCiAgICAgICAgLy8gUHVsbCBvdXQgdGhlIGV4aXN0aW5nIHVzZXIsIHNldHRpbmcgdGhlIGNob3NlbiBwZXJzaXN0ZW5jZSB0byB0aGF0DQogICAgICAgIC8vIHBlcnNpc3RlbmNlIGlmIHRoZSB1c2VyIGV4aXN0cy4NCiAgICAgICAgbGV0IHVzZXJUb01pZ3JhdGUgPSBudWxsOw0KICAgICAgICAvLyBOb3RlLCBoZXJlIHdlIGNoZWNrIGZvciBhIHVzZXIgaW4gX2FsbF8gcGVyc2lzdGVuY2VzLCBub3QganVzdCB0aGUNCiAgICAgICAgLy8gb25lcyBkZWVtZWQgYXZhaWxhYmxlLiBJZiB3ZSBjYW4gbWlncmF0ZSBhIHVzZXIgb3V0IG9mIGEgYnJva2VuDQogICAgICAgIC8vIHBlcnNpc3RlbmNlLCB3ZSB3aWxsIChidXQgb25seSBpZiB0aGF0IHBlcnNpc3RlbmNlIHN1cHBvcnRzIG1pZ3JhdGlvbikuDQogICAgICAgIGZvciAoY29uc3QgcGVyc2lzdGVuY2Ugb2YgcGVyc2lzdGVuY2VIaWVyYXJjaHkpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgY29uc3QgYmxvYiA9IGF3YWl0IHBlcnNpc3RlbmNlLl9nZXQoa2V5KTsNCiAgICAgICAgICAgICAgICBpZiAoYmxvYikgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCB1c2VyID0gVXNlckltcGwuX2Zyb21KU09OKGF1dGgsIGJsb2IpOyAvLyB0aHJvd3MgZm9yIHVucGFyc2FibGUgYmxvYiAod3JvbmcgZm9ybWF0KQ0KICAgICAgICAgICAgICAgICAgICBpZiAocGVyc2lzdGVuY2UgIT09IHNlbGVjdGVkUGVyc2lzdGVuY2UpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJUb01pZ3JhdGUgPSB1c2VyOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkUGVyc2lzdGVuY2UgPSBwZXJzaXN0ZW5jZTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKF9hKSB7IH0NCiAgICAgICAgfQ0KICAgICAgICAvLyBJZiB3ZSBmaW5kIHRoZSB1c2VyIGluIGEgcGVyc2lzdGVuY2UgdGhhdCBkb2VzIHN1cHBvcnQgbWlncmF0aW9uLCB1c2UNCiAgICAgICAgLy8gdGhhdCBtaWdyYXRpb24gcGF0aCAob2Ygb25seSBwZXJzaXN0ZW5jZXMgdGhhdCBzdXBwb3J0IG1pZ3JhdGlvbikNCiAgICAgICAgY29uc3QgbWlncmF0aW9uSGllcmFyY2h5ID0gYXZhaWxhYmxlUGVyc2lzdGVuY2VzLmZpbHRlcihwID0+IHAuX3Nob3VsZEFsbG93TWlncmF0aW9uKTsNCiAgICAgICAgLy8gSWYgdGhlIHBlcnNpc3RlbmNlIGRvZXMgX25vdF8gYWxsb3cgbWlncmF0aW9uLCBqdXN0IGZpbmlzaCBvZmYgaGVyZQ0KICAgICAgICBpZiAoIXNlbGVjdGVkUGVyc2lzdGVuY2UuX3Nob3VsZEFsbG93TWlncmF0aW9uIHx8DQogICAgICAgICAgICAhbWlncmF0aW9uSGllcmFyY2h5Lmxlbmd0aCkgew0KICAgICAgICAgICAgcmV0dXJuIG5ldyBQZXJzaXN0ZW5jZVVzZXJNYW5hZ2VyKHNlbGVjdGVkUGVyc2lzdGVuY2UsIGF1dGgsIHVzZXJLZXkpOw0KICAgICAgICB9DQogICAgICAgIHNlbGVjdGVkUGVyc2lzdGVuY2UgPSBtaWdyYXRpb25IaWVyYXJjaHlbMF07DQogICAgICAgIGlmICh1c2VyVG9NaWdyYXRlKSB7DQogICAgICAgICAgICAvLyBUaGlzIG5vcm1hbGx5IHNob3VsZG4ndCB0aHJvdyBzaW5jZSBjaG9zZW5QZXJzaXN0ZW5jZS5pc0F2YWlsYWJsZSgpIGlzIHRydWUsIGJ1dCBpZiBpdCBkb2VzDQogICAgICAgICAgICAvLyB3ZSdsbCBqdXN0IGxldCBpdCBidWJibGUgdG8gc3VyZmFjZSB0aGUgZXJyb3IuDQogICAgICAgICAgICBhd2FpdCBzZWxlY3RlZFBlcnNpc3RlbmNlLl9zZXQoa2V5LCB1c2VyVG9NaWdyYXRlLnRvSlNPTigpKTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBBdHRlbXB0IHRvIGNsZWFyIHRoZSBrZXkgaW4gb3RoZXIgcGVyc2lzdGVuY2VzIGJ1dCBpZ25vcmUgZXJyb3JzLiBUaGlzIGhlbHBzIHByZXZlbnQgaXNzdWVzDQogICAgICAgIC8vIHN1Y2ggYXMgdXNlcnMgZ2V0dGluZyBzdHVjayB3aXRoIGEgcHJldmlvdXMgYWNjb3VudCBhZnRlciBzaWduaW5nIG91dCBhbmQgcmVmcmVzaGluZyB0aGUgdGFiLg0KICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChwZXJzaXN0ZW5jZUhpZXJhcmNoeS5tYXAoYXN5bmMgKHBlcnNpc3RlbmNlKSA9PiB7DQogICAgICAgICAgICBpZiAocGVyc2lzdGVuY2UgIT09IHNlbGVjdGVkUGVyc2lzdGVuY2UpIHsNCiAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBwZXJzaXN0ZW5jZS5fcmVtb3ZlKGtleSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChfYSkgeyB9DQogICAgICAgICAgICB9DQogICAgICAgIH0pKTsNCiAgICAgICAgcmV0dXJuIG5ldyBQZXJzaXN0ZW5jZVVzZXJNYW5hZ2VyKHNlbGVjdGVkUGVyc2lzdGVuY2UsIGF1dGgsIHVzZXJLZXkpOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogRGV0ZXJtaW5lIHRoZSBicm93c2VyIGZvciB0aGUgcHVycG9zZXMgb2YgcmVwb3J0aW5nIHVzYWdlIHRvIHRoZSBBUEkNCiAqLw0KZnVuY3Rpb24gX2dldEJyb3dzZXJOYW1lKHVzZXJBZ2VudCkgew0KICAgIGNvbnN0IHVhID0gdXNlckFnZW50LnRvTG93ZXJDYXNlKCk7DQogICAgaWYgKHVhLmluY2x1ZGVzKCdvcGVyYS8nKSB8fCB1YS5pbmNsdWRlcygnb3ByLycpIHx8IHVhLmluY2x1ZGVzKCdvcGlvcy8nKSkgew0KICAgICAgICByZXR1cm4gIk9wZXJhIiAvKiBCcm93c2VyTmFtZS5PUEVSQSAqLzsNCiAgICB9DQogICAgZWxzZSBpZiAoX2lzSUVNb2JpbGUodWEpKSB7DQogICAgICAgIC8vIFdpbmRvd3MgcGhvbmUgSUVNb2JpbGUgYnJvd3Nlci4NCiAgICAgICAgcmV0dXJuICJJRU1vYmlsZSIgLyogQnJvd3Nlck5hbWUuSUVNT0JJTEUgKi87DQogICAgfQ0KICAgIGVsc2UgaWYgKHVhLmluY2x1ZGVzKCdtc2llJykgfHwgdWEuaW5jbHVkZXMoJ3RyaWRlbnQvJykpIHsNCiAgICAgICAgcmV0dXJuICJJRSIgLyogQnJvd3Nlck5hbWUuSUUgKi87DQogICAgfQ0KICAgIGVsc2UgaWYgKHVhLmluY2x1ZGVzKCdlZGdlLycpKSB7DQogICAgICAgIHJldHVybiAiRWRnZSIgLyogQnJvd3Nlck5hbWUuRURHRSAqLzsNCiAgICB9DQogICAgZWxzZSBpZiAoX2lzRmlyZWZveCh1YSkpIHsNCiAgICAgICAgcmV0dXJuICJGaXJlZm94IiAvKiBCcm93c2VyTmFtZS5GSVJFRk9YICovOw0KICAgIH0NCiAgICBlbHNlIGlmICh1YS5pbmNsdWRlcygnc2lsay8nKSkgew0KICAgICAgICByZXR1cm4gIlNpbGsiIC8qIEJyb3dzZXJOYW1lLlNJTEsgKi87DQogICAgfQ0KICAgIGVsc2UgaWYgKF9pc0JsYWNrQmVycnkodWEpKSB7DQogICAgICAgIC8vIEJsYWNrYmVycnkgYnJvd3Nlci4NCiAgICAgICAgcmV0dXJuICJCbGFja2JlcnJ5IiAvKiBCcm93c2VyTmFtZS5CTEFDS0JFUlJZICovOw0KICAgIH0NCiAgICBlbHNlIGlmIChfaXNXZWJPUyh1YSkpIHsNCiAgICAgICAgLy8gV2ViT1MgZGVmYXVsdCBicm93c2VyLg0KICAgICAgICByZXR1cm4gIldlYm9zIiAvKiBCcm93c2VyTmFtZS5XRUJPUyAqLzsNCiAgICB9DQogICAgZWxzZSBpZiAoX2lzU2FmYXJpKHVhKSkgew0KICAgICAgICByZXR1cm4gIlNhZmFyaSIgLyogQnJvd3Nlck5hbWUuU0FGQVJJICovOw0KICAgIH0NCiAgICBlbHNlIGlmICgodWEuaW5jbHVkZXMoJ2Nocm9tZS8nKSB8fCBfaXNDaHJvbWVJT1ModWEpKSAmJg0KICAgICAgICAhdWEuaW5jbHVkZXMoJ2VkZ2UvJykpIHsNCiAgICAgICAgcmV0dXJuICJDaHJvbWUiIC8qIEJyb3dzZXJOYW1lLkNIUk9NRSAqLzsNCiAgICB9DQogICAgZWxzZSBpZiAoX2lzQW5kcm9pZCh1YSkpIHsNCiAgICAgICAgLy8gQW5kcm9pZCBzdG9jayBicm93c2VyLg0KICAgICAgICByZXR1cm4gIkFuZHJvaWQiIC8qIEJyb3dzZXJOYW1lLkFORFJPSUQgKi87DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICAvLyBNb3N0IG1vZGVybiBicm93c2VycyBoYXZlIG5hbWUvdmVyc2lvbiBhdCBlbmQgb2YgdXNlciBhZ2VudCBzdHJpbmcuDQogICAgICAgIGNvbnN0IHJlID0gLyhbYS16QS1aXGRcLl0rKVwvW2EtekEtWlxkXC5dKiQvOw0KICAgICAgICBjb25zdCBtYXRjaGVzID0gdXNlckFnZW50Lm1hdGNoKHJlKTsNCiAgICAgICAgaWYgKChtYXRjaGVzID09PSBudWxsIHx8IG1hdGNoZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG1hdGNoZXMubGVuZ3RoKSA9PT0gMikgew0KICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXNbMV07DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuICJPdGhlciIgLyogQnJvd3Nlck5hbWUuT1RIRVIgKi87DQp9DQpmdW5jdGlvbiBfaXNGaXJlZm94KHVhID0gZ2V0VUEoKSkgew0KICAgIHJldHVybiAvZmlyZWZveFwvL2kudGVzdCh1YSk7DQp9DQpmdW5jdGlvbiBfaXNTYWZhcmkodXNlckFnZW50ID0gZ2V0VUEoKSkgew0KICAgIGNvbnN0IHVhID0gdXNlckFnZW50LnRvTG93ZXJDYXNlKCk7DQogICAgcmV0dXJuICh1YS5pbmNsdWRlcygnc2FmYXJpLycpICYmDQogICAgICAgICF1YS5pbmNsdWRlcygnY2hyb21lLycpICYmDQogICAgICAgICF1YS5pbmNsdWRlcygnY3Jpb3MvJykgJiYNCiAgICAgICAgIXVhLmluY2x1ZGVzKCdhbmRyb2lkJykpOw0KfQ0KZnVuY3Rpb24gX2lzQ2hyb21lSU9TKHVhID0gZ2V0VUEoKSkgew0KICAgIHJldHVybiAvY3Jpb3NcLy9pLnRlc3QodWEpOw0KfQ0KZnVuY3Rpb24gX2lzSUVNb2JpbGUodWEgPSBnZXRVQSgpKSB7DQogICAgcmV0dXJuIC9pZW1vYmlsZS9pLnRlc3QodWEpOw0KfQ0KZnVuY3Rpb24gX2lzQW5kcm9pZCh1YSA9IGdldFVBKCkpIHsNCiAgICByZXR1cm4gL2FuZHJvaWQvaS50ZXN0KHVhKTsNCn0NCmZ1bmN0aW9uIF9pc0JsYWNrQmVycnkodWEgPSBnZXRVQSgpKSB7DQogICAgcmV0dXJuIC9ibGFja2JlcnJ5L2kudGVzdCh1YSk7DQp9DQpmdW5jdGlvbiBfaXNXZWJPUyh1YSA9IGdldFVBKCkpIHsNCiAgICByZXR1cm4gL3dlYm9zL2kudGVzdCh1YSk7DQp9DQpmdW5jdGlvbiBfaXNJT1ModWEgPSBnZXRVQSgpKSB7DQogICAgcmV0dXJuICgvaXBob25lfGlwYWR8aXBvZC9pLnRlc3QodWEpIHx8DQogICAgICAgICgvbWFjaW50b3NoL2kudGVzdCh1YSkgJiYgL21vYmlsZS9pLnRlc3QodWEpKSk7DQp9DQpmdW5jdGlvbiBfaXNJT1NTdGFuZGFsb25lKHVhID0gZ2V0VUEoKSkgew0KICAgIHZhciBfYTsNCiAgICByZXR1cm4gX2lzSU9TKHVhKSAmJiAhISgoX2EgPSB3aW5kb3cubmF2aWdhdG9yKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3RhbmRhbG9uZSk7DQp9DQpmdW5jdGlvbiBfaXNJRTEwKCkgew0KICAgIHJldHVybiBpc0lFKCkgJiYgZG9jdW1lbnQuZG9jdW1lbnRNb2RlID09PSAxMDsNCn0NCmZ1bmN0aW9uIF9pc01vYmlsZUJyb3dzZXIodWEgPSBnZXRVQSgpKSB7DQogICAgLy8gVE9ETzogaW1wbGVtZW50IGdldEJyb3dzZXJOYW1lIGVxdWl2YWxlbnQgZm9yIE9TLg0KICAgIHJldHVybiAoX2lzSU9TKHVhKSB8fA0KICAgICAgICBfaXNBbmRyb2lkKHVhKSB8fA0KICAgICAgICBfaXNXZWJPUyh1YSkgfHwNCiAgICAgICAgX2lzQmxhY2tCZXJyeSh1YSkgfHwNCiAgICAgICAgL3dpbmRvd3MgcGhvbmUvaS50ZXN0KHVhKSB8fA0KICAgICAgICBfaXNJRU1vYmlsZSh1YSkpOw0KfQ0KZnVuY3Rpb24gX2lzSWZyYW1lKCkgew0KICAgIHRyeSB7DQogICAgICAgIC8vIENoZWNrIHRoYXQgdGhlIGN1cnJlbnQgd2luZG93IGlzIG5vdCB0aGUgdG9wIHdpbmRvdy4NCiAgICAgICAgLy8gSWYgc28sIHJldHVybiB0cnVlLg0KICAgICAgICByZXR1cm4gISEod2luZG93ICYmIHdpbmRvdyAhPT0gd2luZG93LnRvcCk7DQogICAgfQ0KICAgIGNhdGNoIChlKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKg0KICogRGV0ZXJtaW5lIHRoZSBTREsgdmVyc2lvbiBzdHJpbmcNCiAqLw0KZnVuY3Rpb24gX2dldENsaWVudFZlcnNpb24oY2xpZW50UGxhdGZvcm0sIGZyYW1ld29ya3MgPSBbXSkgew0KICAgIGxldCByZXBvcnRlZFBsYXRmb3JtOw0KICAgIHN3aXRjaCAoY2xpZW50UGxhdGZvcm0pIHsNCiAgICAgICAgY2FzZSAiQnJvd3NlciIgLyogQ2xpZW50UGxhdGZvcm0uQlJPV1NFUiAqLzoNCiAgICAgICAgICAgIC8vIEluIGEgYnJvd3NlciBlbnZpcm9ubWVudCwgcmVwb3J0IHRoZSBicm93c2VyIG5hbWUuDQogICAgICAgICAgICByZXBvcnRlZFBsYXRmb3JtID0gX2dldEJyb3dzZXJOYW1lKGdldFVBKCkpOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgIldvcmtlciIgLyogQ2xpZW50UGxhdGZvcm0uV09SS0VSICovOg0KICAgICAgICAgICAgLy8gVGVjaG5pY2FsbHkgYSB3b3JrZXIgcnVucyBmcm9tIGEgYnJvd3NlciBidXQgd2UgbmVlZCB0byBkaWZmZXJlbnRpYXRlIGENCiAgICAgICAgICAgIC8vIHdvcmtlciBmcm9tIGEgYnJvd3Nlci4NCiAgICAgICAgICAgIC8vIEZvciBleGFtcGxlOiBDaHJvbWUtV29ya2VyL0pzQ29yZS80LjkuMS9GaXJlYmFzZUNvcmUtd2ViLg0KICAgICAgICAgICAgcmVwb3J0ZWRQbGF0Zm9ybSA9IGAke19nZXRCcm93c2VyTmFtZShnZXRVQSgpKX0tJHtjbGllbnRQbGF0Zm9ybX1gOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICByZXBvcnRlZFBsYXRmb3JtID0gY2xpZW50UGxhdGZvcm07DQogICAgfQ0KICAgIGNvbnN0IHJlcG9ydGVkRnJhbWV3b3JrcyA9IGZyYW1ld29ya3MubGVuZ3RoDQogICAgICAgID8gZnJhbWV3b3Jrcy5qb2luKCcsJykNCiAgICAgICAgOiAnRmlyZWJhc2VDb3JlLXdlYic7IC8qIGRlZmF1bHQgdmFsdWUgaWYgbm8gb3RoZXIgZnJhbWV3b3JrIGlzIHVzZWQgKi8NCiAgICByZXR1cm4gYCR7cmVwb3J0ZWRQbGF0Zm9ybX0vJHsiSnNDb3JlIiAvKiBDbGllbnRJbXBsZW1lbnRhdGlvbi5DT1JFICovfS8ke1NES19WRVJTSU9OJDF9LyR7cmVwb3J0ZWRGcmFtZXdvcmtzfWA7DQp9CmFzeW5jIGZ1bmN0aW9uIGdldFJlY2FwdGNoYUNvbmZpZyhhdXRoLCByZXF1ZXN0KSB7DQogICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCAiR0VUIiAvKiBIdHRwTWV0aG9kLkdFVCAqLywgIi92Mi9yZWNhcHRjaGFDb25maWciIC8qIEVuZHBvaW50LkdFVF9SRUNBUFRDSEFfQ09ORklHICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpOw0KfQpmdW5jdGlvbiBpc0VudGVycHJpc2UoZ3JlY2FwdGNoYSkgew0KICAgIHJldHVybiAoZ3JlY2FwdGNoYSAhPT0gdW5kZWZpbmVkICYmDQogICAgICAgIGdyZWNhcHRjaGEuZW50ZXJwcmlzZSAhPT0gdW5kZWZpbmVkKTsNCn0NCmNsYXNzIFJlY2FwdGNoYUNvbmZpZyB7DQogICAgY29uc3RydWN0b3IocmVzcG9uc2UpIHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFRoZSByZUNBUFRDSEEgc2l0ZSBrZXkuDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnNpdGVLZXkgPSAnJzsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFRoZSByZUNBUFRDSEEgZW5hYmxlbWVudCBzdGF0dXMgb2YgdGhlIHtAbGluayBFbWFpbEF1dGhQcm92aWRlcn0gZm9yIHRoZSBjdXJyZW50IHRlbmFudC4NCiAgICAgICAgICovDQogICAgICAgIHRoaXMuZW1haWxQYXNzd29yZEVuYWJsZWQgPSBmYWxzZTsNCiAgICAgICAgaWYgKHJlc3BvbnNlLnJlY2FwdGNoYUtleSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3JlY2FwdGNoYUtleSB1bmRlZmluZWQnKTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBFeGFtcGxlIHJlc3BvbnNlLnJlY2FwdGNoYUtleTogInByb2plY3RzL3Byb2oxMjMva2V5cy9zaXRla2V5MTIzIg0KICAgICAgICB0aGlzLnNpdGVLZXkgPSByZXNwb25zZS5yZWNhcHRjaGFLZXkuc3BsaXQoJy8nKVszXTsNCiAgICAgICAgdGhpcy5lbWFpbFBhc3N3b3JkRW5hYmxlZCA9IHJlc3BvbnNlLnJlY2FwdGNoYUVuZm9yY2VtZW50U3RhdGUuc29tZShlbmZvcmNlbWVudFN0YXRlID0+IGVuZm9yY2VtZW50U3RhdGUucHJvdmlkZXIgPT09ICdFTUFJTF9QQVNTV09SRF9QUk9WSURFUicgJiYNCiAgICAgICAgICAgIGVuZm9yY2VtZW50U3RhdGUuZW5mb3JjZW1lbnRTdGF0ZSAhPT0gJ09GRicpOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmZ1bmN0aW9uIGdldFNjcmlwdFBhcmVudEVsZW1lbnQoKSB7DQogICAgdmFyIF9hLCBfYjsNCiAgICByZXR1cm4gKF9iID0gKF9hID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hWzBdKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBkb2N1bWVudDsNCn0NCmZ1bmN0aW9uIF9sb2FkSlModXJsKSB7DQogICAgLy8gVE9ETzogY29uc2lkZXIgYWRkaW5nIHRpbWVvdXQgc3VwcG9ydCAmIGNhbmNlbGxhdGlvbg0KICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7DQogICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnc3JjJywgdXJsKTsNCiAgICAgICAgZWwub25sb2FkID0gcmVzb2x2ZTsNCiAgICAgICAgZWwub25lcnJvciA9IGUgPT4gew0KICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBfY3JlYXRlRXJyb3IoImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICAgICAgICAgIGVycm9yLmN1c3RvbURhdGEgPSBlOw0KICAgICAgICAgICAgcmVqZWN0KGVycm9yKTsNCiAgICAgICAgfTsNCiAgICAgICAgZWwudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOw0KICAgICAgICBlbC5jaGFyc2V0ID0gJ1VURi04JzsNCiAgICAgICAgZ2V0U2NyaXB0UGFyZW50RWxlbWVudCgpLmFwcGVuZENoaWxkKGVsKTsNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIF9nZW5lcmF0ZUNhbGxiYWNrTmFtZShwcmVmaXgpIHsNCiAgICByZXR1cm4gYF9fJHtwcmVmaXh9JHtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMDAwKX1gOw0KfQoKLyogZXNsaW50LWRpc2FibGUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXJlcXVpcmUtaW1wb3J0cyAqLw0KY29uc3QgUkVDQVBUQ0hBX0VOVEVSUFJJU0VfVVJMID0gJ2h0dHBzOi8vd3d3Lmdvb2dsZS5jb20vcmVjYXB0Y2hhL2VudGVycHJpc2UuanM/cmVuZGVyPSc7DQpjb25zdCBSRUNBUFRDSEFfRU5URVJQUklTRV9WRVJJRklFUl9UWVBFID0gJ3JlY2FwdGNoYS1lbnRlcnByaXNlJzsNCmNvbnN0IEZBS0VfVE9LRU4gPSAnTk9fUkVDQVBUQ0hBJzsNCmNsYXNzIFJlY2FwdGNoYUVudGVycHJpc2VWZXJpZmllciB7DQogICAgLyoqDQogICAgICoNCiAgICAgKiBAcGFyYW0gYXV0aEV4dGVybiAtIFRoZSBjb3JyZXNwb25kaW5nIEZpcmViYXNlIHtAbGluayBBdXRofSBpbnN0YW5jZS4NCiAgICAgKg0KICAgICAqLw0KICAgIGNvbnN0cnVjdG9yKGF1dGhFeHRlcm4pIHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIElkZW50aWZpZXMgdGhlIHR5cGUgb2YgYXBwbGljYXRpb24gdmVyaWZpZXIgKGUuZy4gInJlY2FwdGNoYS1lbnRlcnByaXNlIikuDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnR5cGUgPSBSRUNBUFRDSEFfRU5URVJQUklTRV9WRVJJRklFUl9UWVBFOw0KICAgICAgICB0aGlzLmF1dGggPSBfY2FzdEF1dGgoYXV0aEV4dGVybik7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEV4ZWN1dGVzIHRoZSB2ZXJpZmljYXRpb24gcHJvY2Vzcy4NCiAgICAgKg0KICAgICAqIEByZXR1cm5zIEEgUHJvbWlzZSBmb3IgYSB0b2tlbiB0aGF0IGNhbiBiZSB1c2VkIHRvIGFzc2VydCB0aGUgdmFsaWRpdHkgb2YgYSByZXF1ZXN0Lg0KICAgICAqLw0KICAgIGFzeW5jIHZlcmlmeShhY3Rpb24gPSAndmVyaWZ5JywgZm9yY2VSZWZyZXNoID0gZmFsc2UpIHsNCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gcmV0cmlldmVTaXRlS2V5KGF1dGgpIHsNCiAgICAgICAgICAgIGlmICghZm9yY2VSZWZyZXNoKSB7DQogICAgICAgICAgICAgICAgaWYgKGF1dGgudGVuYW50SWQgPT0gbnVsbCAmJiBhdXRoLl9hZ2VudFJlY2FwdGNoYUNvbmZpZyAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBhdXRoLl9hZ2VudFJlY2FwdGNoYUNvbmZpZy5zaXRlS2V5Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoYXV0aC50ZW5hbnRJZCAhPSBudWxsICYmDQogICAgICAgICAgICAgICAgICAgIGF1dGguX3RlbmFudFJlY2FwdGNoYUNvbmZpZ3NbYXV0aC50ZW5hbnRJZF0gIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXV0aC5fdGVuYW50UmVjYXB0Y2hhQ29uZmlnc1thdXRoLnRlbmFudElkXS5zaXRlS2V5Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgICAgICAgICAgZ2V0UmVjYXB0Y2hhQ29uZmlnKGF1dGgsIHsNCiAgICAgICAgICAgICAgICAgICAgY2xpZW50VHlwZTogIkNMSUVOVF9UWVBFX1dFQiIgLyogUmVjYXB0Y2hhQ2xpZW50VHlwZS5XRUIgKi8sDQogICAgICAgICAgICAgICAgICAgIHZlcnNpb246ICJSRUNBUFRDSEFfRU5URVJQUklTRSIgLyogUmVjYXB0Y2hhVmVyc2lvbi5FTlRFUlBSSVNFICovDQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UucmVjYXB0Y2hhS2V5ID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ3JlY2FwdGNoYSBFbnRlcnByaXNlIHNpdGUga2V5IHVuZGVmaW5lZCcpKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZpZyA9IG5ldyBSZWNhcHRjaGFDb25maWcocmVzcG9uc2UpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF1dGgudGVuYW50SWQgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dGguX2FnZW50UmVjYXB0Y2hhQ29uZmlnID0gY29uZmlnOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0aC5fdGVuYW50UmVjYXB0Y2hhQ29uZmlnc1thdXRoLnRlbmFudElkXSA9IGNvbmZpZzsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNvbHZlKGNvbmZpZy5zaXRlS2V5KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBmdW5jdGlvbiByZXRyaWV2ZVJlY2FwdGNoYVRva2VuKHNpdGVLZXksIHJlc29sdmUsIHJlamVjdCkgew0KICAgICAgICAgICAgY29uc3QgZ3JlY2FwdGNoYSA9IHdpbmRvdy5ncmVjYXB0Y2hhOw0KICAgICAgICAgICAgaWYgKGlzRW50ZXJwcmlzZShncmVjYXB0Y2hhKSkgew0KICAgICAgICAgICAgICAgIGdyZWNhcHRjaGEuZW50ZXJwcmlzZS5yZWFkeSgoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGdyZWNhcHRjaGEuZW50ZXJwcmlzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgLmV4ZWN1dGUoc2l0ZUtleSwgeyBhY3Rpb24gfSkNCiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKHRva2VuID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodG9rZW4pOw0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKCgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoRkFLRV9UT0tFTik7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmVqZWN0KEVycm9yKCdObyByZUNBUFRDSEEgZW50ZXJwcmlzZSBzY3JpcHQgbG9hZGVkLicpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICAgICAgcmV0cmlldmVTaXRlS2V5KHRoaXMuYXV0aCkNCiAgICAgICAgICAgICAgICAudGhlbihzaXRlS2V5ID0+IHsNCiAgICAgICAgICAgICAgICBpZiAoIWZvcmNlUmVmcmVzaCAmJiBpc0VudGVycHJpc2Uod2luZG93LmdyZWNhcHRjaGEpKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHJpZXZlUmVjYXB0Y2hhVG9rZW4oc2l0ZUtleSwgcmVzb2x2ZSwgcmVqZWN0KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignUmVjYXB0Y2hhVmVyaWZpZXIgaXMgb25seSBzdXBwb3J0ZWQgaW4gYnJvd3NlcicpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBfbG9hZEpTKFJFQ0FQVENIQV9FTlRFUlBSSVNFX1VSTCArIHNpdGVLZXkpDQogICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXRyaWV2ZVJlY2FwdGNoYVRva2VuKHNpdGVLZXksIHJlc29sdmUsIHJlamVjdCk7DQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTsNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQogICAgfQ0KfQ0KYXN5bmMgZnVuY3Rpb24gaW5qZWN0UmVjYXB0Y2hhRmllbGRzKGF1dGgsIHJlcXVlc3QsIGFjdGlvbiwgY2FwdGNoYVJlc3AgPSBmYWxzZSkgew0KICAgIGNvbnN0IHZlcmlmaWVyID0gbmV3IFJlY2FwdGNoYUVudGVycHJpc2VWZXJpZmllcihhdXRoKTsNCiAgICBsZXQgY2FwdGNoYVJlc3BvbnNlOw0KICAgIHRyeSB7DQogICAgICAgIGNhcHRjaGFSZXNwb25zZSA9IGF3YWl0IHZlcmlmaWVyLnZlcmlmeShhY3Rpb24pOw0KICAgIH0NCiAgICBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY2FwdGNoYVJlc3BvbnNlID0gYXdhaXQgdmVyaWZpZXIudmVyaWZ5KGFjdGlvbiwgdHJ1ZSk7DQogICAgfQ0KICAgIGNvbnN0IG5ld1JlcXVlc3QgPSBPYmplY3QuYXNzaWduKHt9LCByZXF1ZXN0KTsNCiAgICBpZiAoIWNhcHRjaGFSZXNwKSB7DQogICAgICAgIE9iamVjdC5hc3NpZ24obmV3UmVxdWVzdCwgeyBjYXB0Y2hhUmVzcG9uc2UgfSk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBPYmplY3QuYXNzaWduKG5ld1JlcXVlc3QsIHsgJ2NhcHRjaGFSZXNwJzogY2FwdGNoYVJlc3BvbnNlIH0pOw0KICAgIH0NCiAgICBPYmplY3QuYXNzaWduKG5ld1JlcXVlc3QsIHsgJ2NsaWVudFR5cGUnOiAiQ0xJRU5UX1RZUEVfV0VCIiAvKiBSZWNhcHRjaGFDbGllbnRUeXBlLldFQiAqLyB9KTsNCiAgICBPYmplY3QuYXNzaWduKG5ld1JlcXVlc3QsIHsNCiAgICAgICAgJ3JlY2FwdGNoYVZlcnNpb24nOiAiUkVDQVBUQ0hBX0VOVEVSUFJJU0UiIC8qIFJlY2FwdGNoYVZlcnNpb24uRU5URVJQUklTRSAqLw0KICAgIH0pOw0KICAgIHJldHVybiBuZXdSZXF1ZXN0Ow0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY2xhc3MgQXV0aE1pZGRsZXdhcmVRdWV1ZSB7DQogICAgY29uc3RydWN0b3IoYXV0aCkgew0KICAgICAgICB0aGlzLmF1dGggPSBhdXRoOw0KICAgICAgICB0aGlzLnF1ZXVlID0gW107DQogICAgfQ0KICAgIHB1c2hDYWxsYmFjayhjYWxsYmFjaywgb25BYm9ydCkgew0KICAgICAgICAvLyBUaGUgY2FsbGJhY2sgY291bGQgYmUgc3luYyBvciBhc3luYy4gV3JhcCBpdCBpbnRvIGENCiAgICAgICAgLy8gZnVuY3Rpb24gdGhhdCBpcyBhbHdheXMgYXN5bmMuDQogICAgICAgIGNvbnN0IHdyYXBwZWRDYWxsYmFjayA9ICh1c2VyKSA9PiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGNhbGxiYWNrKHVzZXIpOw0KICAgICAgICAgICAgICAgIC8vIEVpdGhlciByZXNvbHZlIHdpdGggZXhpc3RpbmcgcHJvbWlzZSBvciB3cmFwIGEgbm9uLXByb21pc2UNCiAgICAgICAgICAgICAgICAvLyByZXR1cm4gdmFsdWUgaW50byBhIHByb21pc2UuDQogICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICAvLyBTeW5jIGNhbGxiYWNrIHRocm93cy4NCiAgICAgICAgICAgICAgICByZWplY3QoZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICAvLyBBdHRhY2ggdGhlIG9uQWJvcnQgaWYgcHJlc2VudA0KICAgICAgICB3cmFwcGVkQ2FsbGJhY2sub25BYm9ydCA9IG9uQWJvcnQ7DQogICAgICAgIHRoaXMucXVldWUucHVzaCh3cmFwcGVkQ2FsbGJhY2spOw0KICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMucXVldWUubGVuZ3RoIC0gMTsNCiAgICAgICAgcmV0dXJuICgpID0+IHsNCiAgICAgICAgICAgIC8vIFVuc3Vic2NyaWJlLiBSZXBsYWNlIHdpdGggbm8tb3AuIERvIG5vdCByZW1vdmUgZnJvbSBhcnJheSwgb3IgaXQgd2lsbCBkaXN0dXJiDQogICAgICAgICAgICAvLyBpbmRleGluZyBvZiBvdGhlciBlbGVtZW50cy4NCiAgICAgICAgICAgIHRoaXMucXVldWVbaW5kZXhdID0gKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCk7DQogICAgICAgIH07DQogICAgfQ0KICAgIGFzeW5jIHJ1bk1pZGRsZXdhcmUobmV4dFVzZXIpIHsNCiAgICAgICAgaWYgKHRoaXMuYXV0aC5jdXJyZW50VXNlciA9PT0gbmV4dFVzZXIpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICAvLyBXaGlsZSBydW5uaW5nIHRoZSBtaWRkbGV3YXJlLCBidWlsZCBhIHRlbXBvcmFyeSBzdGFjayBvZiBvbkFib3J0DQogICAgICAgIC8vIGNhbGxiYWNrcyB0byBjYWxsIGlmIG9uZSBtaWRkbGV3YXJlIGNhbGxiYWNrIHJlamVjdHMuDQogICAgICAgIGNvbnN0IG9uQWJvcnRTdGFjayA9IFtdOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgZm9yIChjb25zdCBiZWZvcmVTdGF0ZUNhbGxiYWNrIG9mIHRoaXMucXVldWUpIHsNCiAgICAgICAgICAgICAgICBhd2FpdCBiZWZvcmVTdGF0ZUNhbGxiYWNrKG5leHRVc2VyKTsNCiAgICAgICAgICAgICAgICAvLyBPbmx5IHB1c2ggdGhlIG9uQWJvcnQgaWYgdGhlIGNhbGxiYWNrIHN1Y2NlZWRzDQogICAgICAgICAgICAgICAgaWYgKGJlZm9yZVN0YXRlQ2FsbGJhY2sub25BYm9ydCkgew0KICAgICAgICAgICAgICAgICAgICBvbkFib3J0U3RhY2sucHVzaChiZWZvcmVTdGF0ZUNhbGxiYWNrLm9uQWJvcnQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgLy8gUnVuIGFsbCBvbkFib3J0LCB3aXRoIHNlcGFyYXRlIHRyeS9jYXRjaCB0byBpZ25vcmUgYW55IGVycm9ycyBhbmQNCiAgICAgICAgICAgIC8vIGNvbnRpbnVlDQogICAgICAgICAgICBvbkFib3J0U3RhY2sucmV2ZXJzZSgpOw0KICAgICAgICAgICAgZm9yIChjb25zdCBvbkFib3J0IG9mIG9uQWJvcnRTdGFjaykgew0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgIG9uQWJvcnQoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKF8pIHsNCiAgICAgICAgICAgICAgICAgICAgLyogc3dhbGxvdyBlcnJvciAqLw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRocm93IHRoaXMuYXV0aC5fZXJyb3JGYWN0b3J5LmNyZWF0ZSgibG9naW4tYmxvY2tlZCIgLyogQXV0aEVycm9yQ29kZS5MT0dJTl9CTE9DS0VEICovLCB7DQogICAgICAgICAgICAgICAgb3JpZ2luYWxNZXNzYWdlOiBlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUubWVzc2FnZQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBBdXRoSW1wbCB7DQogICAgY29uc3RydWN0b3IoYXBwLCBoZWFydGJlYXRTZXJ2aWNlUHJvdmlkZXIsIGFwcENoZWNrU2VydmljZVByb3ZpZGVyLCBjb25maWcpIHsNCiAgICAgICAgdGhpcy5hcHAgPSBhcHA7DQogICAgICAgIHRoaXMuaGVhcnRiZWF0U2VydmljZVByb3ZpZGVyID0gaGVhcnRiZWF0U2VydmljZVByb3ZpZGVyOw0KICAgICAgICB0aGlzLmFwcENoZWNrU2VydmljZVByb3ZpZGVyID0gYXBwQ2hlY2tTZXJ2aWNlUHJvdmlkZXI7DQogICAgICAgIHRoaXMuY29uZmlnID0gY29uZmlnOw0KICAgICAgICB0aGlzLmN1cnJlbnRVc2VyID0gbnVsbDsNCiAgICAgICAgdGhpcy5lbXVsYXRvckNvbmZpZyA9IG51bGw7DQogICAgICAgIHRoaXMub3BlcmF0aW9ucyA9IFByb21pc2UucmVzb2x2ZSgpOw0KICAgICAgICB0aGlzLmF1dGhTdGF0ZVN1YnNjcmlwdGlvbiA9IG5ldyBTdWJzY3JpcHRpb24odGhpcyk7DQogICAgICAgIHRoaXMuaWRUb2tlblN1YnNjcmlwdGlvbiA9IG5ldyBTdWJzY3JpcHRpb24odGhpcyk7DQogICAgICAgIHRoaXMuYmVmb3JlU3RhdGVRdWV1ZSA9IG5ldyBBdXRoTWlkZGxld2FyZVF1ZXVlKHRoaXMpOw0KICAgICAgICB0aGlzLnJlZGlyZWN0VXNlciA9IG51bGw7DQogICAgICAgIHRoaXMuaXNQcm9hY3RpdmVSZWZyZXNoRW5hYmxlZCA9IGZhbHNlOw0KICAgICAgICAvLyBBbnkgbmV0d29yayBjYWxscyB3aWxsIHNldCB0aGlzIHRvIHRydWUgYW5kIHByZXZlbnQgc3Vic2VxdWVudCBlbXVsYXRvcg0KICAgICAgICAvLyBpbml0aWFsaXphdGlvbg0KICAgICAgICB0aGlzLl9jYW5Jbml0RW11bGF0b3IgPSB0cnVlOw0KICAgICAgICB0aGlzLl9pc0luaXRpYWxpemVkID0gZmFsc2U7DQogICAgICAgIHRoaXMuX2RlbGV0ZWQgPSBmYWxzZTsNCiAgICAgICAgdGhpcy5faW5pdGlhbGl6YXRpb25Qcm9taXNlID0gbnVsbDsNCiAgICAgICAgdGhpcy5fcG9wdXBSZWRpcmVjdFJlc29sdmVyID0gbnVsbDsNCiAgICAgICAgdGhpcy5fZXJyb3JGYWN0b3J5ID0gX0RFRkFVTFRfQVVUSF9FUlJPUl9GQUNUT1JZOw0KICAgICAgICB0aGlzLl9hZ2VudFJlY2FwdGNoYUNvbmZpZyA9IG51bGw7DQogICAgICAgIHRoaXMuX3RlbmFudFJlY2FwdGNoYUNvbmZpZ3MgPSB7fTsNCiAgICAgICAgLy8gVHJhY2tzIHRoZSBsYXN0IG5vdGlmaWVkIFVJRCBmb3Igc3RhdGUgY2hhbmdlIGxpc3RlbmVycyB0byBwcmV2ZW50DQogICAgICAgIC8vIHJlcGVhdGVkIGNhbGxzIHRvIHRoZSBjYWxsYmFja3MuIFVuZGVmaW5lZCBtZWFucyBpdCdzIG5ldmVyIGJlZW4NCiAgICAgICAgLy8gY2FsbGVkLCB3aGVyZWFzIG51bGwgbWVhbnMgaXQncyBiZWVuIGNhbGxlZCB3aXRoIGEgc2lnbmVkIG91dCB1c2VyDQogICAgICAgIHRoaXMubGFzdE5vdGlmaWVkVWlkID0gdW5kZWZpbmVkOw0KICAgICAgICB0aGlzLmxhbmd1YWdlQ29kZSA9IG51bGw7DQogICAgICAgIHRoaXMudGVuYW50SWQgPSBudWxsOw0KICAgICAgICB0aGlzLnNldHRpbmdzID0geyBhcHBWZXJpZmljYXRpb25EaXNhYmxlZEZvclRlc3Rpbmc6IGZhbHNlIH07DQogICAgICAgIHRoaXMuZnJhbWV3b3JrcyA9IFtdOw0KICAgICAgICB0aGlzLm5hbWUgPSBhcHAubmFtZTsNCiAgICAgICAgdGhpcy5jbGllbnRWZXJzaW9uID0gY29uZmlnLnNka0NsaWVudFZlcnNpb247DQogICAgfQ0KICAgIF9pbml0aWFsaXplV2l0aFBlcnNpc3RlbmNlKHBlcnNpc3RlbmNlSGllcmFyY2h5LCBwb3B1cFJlZGlyZWN0UmVzb2x2ZXIpIHsNCiAgICAgICAgaWYgKHBvcHVwUmVkaXJlY3RSZXNvbHZlcikgew0KICAgICAgICAgICAgdGhpcy5fcG9wdXBSZWRpcmVjdFJlc29sdmVyID0gX2dldEluc3RhbmNlKHBvcHVwUmVkaXJlY3RSZXNvbHZlcik7DQogICAgICAgIH0NCiAgICAgICAgLy8gSGF2ZSB0byBjaGVjayBmb3IgYXBwIGRlbGV0aW9uIHRocm91Z2hvdXQgaW5pdGlhbGl6YXRpb24gKGFmdGVyIGVhY2gNCiAgICAgICAgLy8gcHJvbWlzZSByZXNvbHV0aW9uKQ0KICAgICAgICB0aGlzLl9pbml0aWFsaXphdGlvblByb21pc2UgPSB0aGlzLnF1ZXVlKGFzeW5jICgpID0+IHsNCiAgICAgICAgICAgIHZhciBfYSwgX2I7DQogICAgICAgICAgICBpZiAodGhpcy5fZGVsZXRlZCkgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoaXMucGVyc2lzdGVuY2VNYW5hZ2VyID0gYXdhaXQgUGVyc2lzdGVuY2VVc2VyTWFuYWdlci5jcmVhdGUodGhpcywgcGVyc2lzdGVuY2VIaWVyYXJjaHkpOw0KICAgICAgICAgICAgaWYgKHRoaXMuX2RlbGV0ZWQpIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvLyBJbml0aWFsaXplIHRoZSByZXNvbHZlciBlYXJseSBpZiBuZWNlc3NhcnkgKG9ubHkgYXBwbGljYWJsZSB0byB3ZWI6DQogICAgICAgICAgICAvLyB0aGlzIHdpbGwgY2F1c2UgdGhlIGlmcmFtZSB0byBsb2FkIGltbWVkaWF0ZWx5IGluIGNlcnRhaW4gY2FzZXMpDQogICAgICAgICAgICBpZiAoKF9hID0gdGhpcy5fcG9wdXBSZWRpcmVjdFJlc29sdmVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuX3Nob3VsZEluaXRQcm9hY3RpdmVseSkgew0KICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgZmFpbHMsIGRvbid0IGhhbHQgYXV0aCBsb2FkaW5nDQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5fcG9wdXBSZWRpcmVjdFJlc29sdmVyLl9pbml0aWFsaXplKHRoaXMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgICAgICAvKiBJZ25vcmUgdGhlIGVycm9yICovDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYXdhaXQgdGhpcy5pbml0aWFsaXplQ3VycmVudFVzZXIocG9wdXBSZWRpcmVjdFJlc29sdmVyKTsNCiAgICAgICAgICAgIHRoaXMubGFzdE5vdGlmaWVkVWlkID0gKChfYiA9IHRoaXMuY3VycmVudFVzZXIpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi51aWQpIHx8IG51bGw7DQogICAgICAgICAgICBpZiAodGhpcy5fZGVsZXRlZCkgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoaXMuX2lzSW5pdGlhbGl6ZWQgPSB0cnVlOw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIHRoaXMuX2luaXRpYWxpemF0aW9uUHJvbWlzZTsNCiAgICB9DQogICAgLyoqDQogICAgICogSWYgdGhlIHBlcnNpc3RlbmNlIGlzIGNoYW5nZWQgaW4gYW5vdGhlciB3aW5kb3csIHRoZSB1c2VyIG1hbmFnZXIgd2lsbCBsZXQgdXMga25vdw0KICAgICAqLw0KICAgIGFzeW5jIF9vblN0b3JhZ2VFdmVudCgpIHsNCiAgICAgICAgaWYgKHRoaXMuX2RlbGV0ZWQpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy5hc3NlcnRlZFBlcnNpc3RlbmNlLmdldEN1cnJlbnRVc2VyKCk7DQogICAgICAgIGlmICghdGhpcy5jdXJyZW50VXNlciAmJiAhdXNlcikgew0KICAgICAgICAgICAgLy8gTm8gY2hhbmdlLCBkbyBub3RoaW5nICh3YXMgc2lnbmVkIG91dCBhbmQgcmVtYWluZWQgc2lnbmVkIG91dCkuDQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgLy8gSWYgdGhlIHNhbWUgdXNlciBpcyB0byBiZSBzeW5jaHJvbml6ZWQuDQogICAgICAgIGlmICh0aGlzLmN1cnJlbnRVc2VyICYmIHVzZXIgJiYgdGhpcy5jdXJyZW50VXNlci51aWQgPT09IHVzZXIudWlkKSB7DQogICAgICAgICAgICAvLyBEYXRhIHVwZGF0ZSwgc2ltcGx5IGNvcHkgZGF0YSBjaGFuZ2VzLg0KICAgICAgICAgICAgdGhpcy5fY3VycmVudFVzZXIuX2Fzc2lnbih1c2VyKTsNCiAgICAgICAgICAgIC8vIElmIHRva2VucyBjaGFuZ2VkIGZyb20gcHJldmlvdXMgdXNlciB0b2tlbnMsIHRoaXMgd2lsbCB0cmlnZ2VyDQogICAgICAgICAgICAvLyBub3RpZnlBdXRoTGlzdGVuZXJzXy4NCiAgICAgICAgICAgIGF3YWl0IHRoaXMuY3VycmVudFVzZXIuZ2V0SWRUb2tlbigpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIC8vIFVwZGF0ZSBjdXJyZW50IEF1dGggc3RhdGUuIEVpdGhlciBhIG5ldyBsb2dpbiBvciBsb2dvdXQuDQogICAgICAgIC8vIFNraXAgYmxvY2tpbmcgY2FsbGJhY2tzLCB0aGV5IHNob3VsZCBub3QgYXBwbHkgdG8gYSBjaGFuZ2UgaW4gYW5vdGhlciB0YWIuDQogICAgICAgIGF3YWl0IHRoaXMuX3VwZGF0ZUN1cnJlbnRVc2VyKHVzZXIsIC8qIHNraXBCZWZvcmVTdGF0ZUNhbGxiYWNrcyAqLyB0cnVlKTsNCiAgICB9DQogICAgYXN5bmMgaW5pdGlhbGl6ZUN1cnJlbnRVc2VyKHBvcHVwUmVkaXJlY3RSZXNvbHZlcikgew0KICAgICAgICB2YXIgX2E7DQogICAgICAgIC8vIEZpcnN0IGNoZWNrIHRvIHNlZSBpZiB3ZSBoYXZlIGEgcGVuZGluZyByZWRpcmVjdCBldmVudC4NCiAgICAgICAgY29uc3QgcHJldmlvdXNseVN0b3JlZFVzZXIgPSAoYXdhaXQgdGhpcy5hc3NlcnRlZFBlcnNpc3RlbmNlLmdldEN1cnJlbnRVc2VyKCkpOw0KICAgICAgICBsZXQgZnV0dXJlQ3VycmVudFVzZXIgPSBwcmV2aW91c2x5U3RvcmVkVXNlcjsNCiAgICAgICAgbGV0IG5lZWRzVG9jaGVja01pZGRsZXdhcmUgPSBmYWxzZTsNCiAgICAgICAgaWYgKHBvcHVwUmVkaXJlY3RSZXNvbHZlciAmJiB0aGlzLmNvbmZpZy5hdXRoRG9tYWluKSB7DQogICAgICAgICAgICBhd2FpdCB0aGlzLmdldE9ySW5pdFJlZGlyZWN0UGVyc2lzdGVuY2VNYW5hZ2VyKCk7DQogICAgICAgICAgICBjb25zdCByZWRpcmVjdFVzZXJFdmVudElkID0gKF9hID0gdGhpcy5yZWRpcmVjdFVzZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5fcmVkaXJlY3RFdmVudElkOw0KICAgICAgICAgICAgY29uc3Qgc3RvcmVkVXNlckV2ZW50SWQgPSBmdXR1cmVDdXJyZW50VXNlciA9PT0gbnVsbCB8fCBmdXR1cmVDdXJyZW50VXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZnV0dXJlQ3VycmVudFVzZXIuX3JlZGlyZWN0RXZlbnRJZDsNCiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMudHJ5UmVkaXJlY3RTaWduSW4ocG9wdXBSZWRpcmVjdFJlc29sdmVyKTsNCiAgICAgICAgICAgIC8vIElmIHRoZSBzdG9yZWQgdXNlciAoaS5lLiB0aGUgb2xkICJjdXJyZW50VXNlciIpIGhhcyBhIHJlZGlyZWN0SWQgdGhhdA0KICAgICAgICAgICAgLy8gbWF0Y2hlcyB0aGUgcmVkaXJlY3QgdXNlciwgdGhlbiB3ZSB3YW50IHRvIGluaXRpYWxseSBzaWduIGluIHdpdGggdGhlDQogICAgICAgICAgICAvLyBuZXcgdXNlciBvYmplY3QgZnJvbSByZXN1bHQuDQogICAgICAgICAgICAvLyBUT0RPKHNhbWdobyk6IE1vcmUgdGhvcm91Z2hseSB0ZXN0IGFsbCBvZiB0aGlzDQogICAgICAgICAgICBpZiAoKCFyZWRpcmVjdFVzZXJFdmVudElkIHx8IHJlZGlyZWN0VXNlckV2ZW50SWQgPT09IHN0b3JlZFVzZXJFdmVudElkKSAmJg0KICAgICAgICAgICAgICAgIChyZXN1bHQgPT09IG51bGwgfHwgcmVzdWx0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXN1bHQudXNlcikpIHsNCiAgICAgICAgICAgICAgICBmdXR1cmVDdXJyZW50VXNlciA9IHJlc3VsdC51c2VyOw0KICAgICAgICAgICAgICAgIG5lZWRzVG9jaGVja01pZGRsZXdhcmUgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIC8vIElmIG5vIHVzZXIgaW4gcGVyc2lzdGVuY2UsIHRoZXJlIGlzIG5vIGN1cnJlbnQgdXNlci4gU2V0IHRvIG51bGwuDQogICAgICAgIGlmICghZnV0dXJlQ3VycmVudFVzZXIpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmRpcmVjdGx5U2V0Q3VycmVudFVzZXIobnVsbCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFmdXR1cmVDdXJyZW50VXNlci5fcmVkaXJlY3RFdmVudElkKSB7DQogICAgICAgICAgICAvLyBUaGlzIGlzbid0IGEgcmVkaXJlY3QgbGluayBvcGVyYXRpb24sIHdlIGNhbiByZWxvYWQgYW5kIGJhaWwuDQogICAgICAgICAgICAvLyBGaXJzdCB0aG91Z2gsIGVuc3VyZSB0aGF0IHdlIGNoZWNrIHRoZSBtaWRkbGV3YXJlIGlzIGhhcHB5Lg0KICAgICAgICAgICAgaWYgKG5lZWRzVG9jaGVja01pZGRsZXdhcmUpIHsNCiAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmJlZm9yZVN0YXRlUXVldWUucnVuTWlkZGxld2FyZShmdXR1cmVDdXJyZW50VXNlcik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgICAgIGZ1dHVyZUN1cnJlbnRVc2VyID0gcHJldmlvdXNseVN0b3JlZFVzZXI7DQogICAgICAgICAgICAgICAgICAgIC8vIFdlIGtub3cgdGhpcyBpcyBhdmFpbGFibGUgc2luY2UgdGhlIGJpdCBpcyBvbmx5IHNldCB3aGVuIHRoZQ0KICAgICAgICAgICAgICAgICAgICAvLyByZXNvbHZlciBpcyBhdmFpbGFibGUNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcG9wdXBSZWRpcmVjdFJlc29sdmVyLl9vdmVycmlkZVJlZGlyZWN0UmVzdWx0KHRoaXMsICgpID0+IFByb21pc2UucmVqZWN0KGUpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZnV0dXJlQ3VycmVudFVzZXIpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yZWxvYWRBbmRTZXRDdXJyZW50VXNlck9yQ2xlYXIoZnV0dXJlQ3VycmVudFVzZXIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlyZWN0bHlTZXRDdXJyZW50VXNlcihudWxsKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBfYXNzZXJ0KHRoaXMuX3BvcHVwUmVkaXJlY3RSZXNvbHZlciwgdGhpcywgImFyZ3VtZW50LWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTsNCiAgICAgICAgYXdhaXQgdGhpcy5nZXRPckluaXRSZWRpcmVjdFBlcnNpc3RlbmNlTWFuYWdlcigpOw0KICAgICAgICAvLyBJZiB0aGUgcmVkaXJlY3QgdXNlcidzIGV2ZW50IElEIG1hdGNoZXMgdGhlIGN1cnJlbnQgdXNlcidzIGV2ZW50IElELA0KICAgICAgICAvLyBETyBOT1QgcmVsb2FkIHRoZSBjdXJyZW50IHVzZXIsIG90aGVyd2lzZSB0aGV5J2xsIGJlIGNsZWFyZWQgZnJvbSBzdG9yYWdlLg0KICAgICAgICAvLyBUaGlzIGlzIGltcG9ydGFudCBmb3IgdGhlIHJlYXV0aGVudGljYXRlV2l0aFJlZGlyZWN0KCkgZmxvdy4NCiAgICAgICAgaWYgKHRoaXMucmVkaXJlY3RVc2VyICYmDQogICAgICAgICAgICB0aGlzLnJlZGlyZWN0VXNlci5fcmVkaXJlY3RFdmVudElkID09PSBmdXR1cmVDdXJyZW50VXNlci5fcmVkaXJlY3RFdmVudElkKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5kaXJlY3RseVNldEN1cnJlbnRVc2VyKGZ1dHVyZUN1cnJlbnRVc2VyKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpcy5yZWxvYWRBbmRTZXRDdXJyZW50VXNlck9yQ2xlYXIoZnV0dXJlQ3VycmVudFVzZXIpOw0KICAgIH0NCiAgICBhc3luYyB0cnlSZWRpcmVjdFNpZ25JbihyZWRpcmVjdFJlc29sdmVyKSB7DQogICAgICAgIC8vIFRoZSByZWRpcmVjdCB1c2VyIG5lZWRzIHRvIGJlIGNoZWNrZWQgKGFuZCBzaWduZWQgaW4gaWYgYXZhaWxhYmxlKQ0KICAgICAgICAvLyBkdXJpbmcgYXV0aCBpbml0aWFsaXphdGlvbi4gQWxsIG9mIHRoZSBub3JtYWwgc2lnbiBpbiBhbmQgbGluay9yZWF1dGgNCiAgICAgICAgLy8gZmxvd3MgY2FsbCBiYWNrIGludG8gYXV0aCBhbmQgcHVzaCB0aGluZ3Mgb250byB0aGUgcHJvbWlzZSBxdWV1ZS4gV2UNCiAgICAgICAgLy8gbmVlZCB0byBhd2FpdCB0aGUgcmVzdWx0IG9mIHRoZSByZWRpcmVjdCBzaWduIGluICppbnNpZGUgdGhlIHByb21pc2UNCiAgICAgICAgLy8gcXVldWUqLiBUaGlzIHByZXNlbnRzIGEgcHJvYmxlbTogd2UgcnVuIGludG8gZGVhZGxvY2suIFNlZToNCiAgICAgICAgLy8gICAg4pSMPiBbSW5pdGlhbGl6YXRpb25dIOKUgOKUgOKUgOKUgOKUgOKUkA0KICAgICAgICAvLyAgICDilIw+IFs8b3RoZXIgcXVldWUgdGFza3M+XSDilIINCiAgICAgICAgLy8gICAg4pSU4pSAIFtnZXRSZWRpcmVjdFJlc3VsdF0gPOKUgOKUmA0KICAgICAgICAvLyAgICB3aGVyZSBbXSBhcmUgdGFza3Mgb24gdGhlIHF1ZXVlIGFuZCBhcnJvd3MgZGVub3RlIGF3YWl0cw0KICAgICAgICAvLyBJbml0aWFsaXphdGlvbiB3aWxsIG5ldmVyIGNvbXBsZXRlIGJlY2F1c2UgaXQncyB3YWl0aW5nIG9uIHNvbWV0aGluZw0KICAgICAgICAvLyB0aGF0J3Mgd2FpdGluZyBmb3IgaW5pdGlhbGl6YXRpb24gdG8gY29tcGxldGUhDQogICAgICAgIC8vDQogICAgICAgIC8vIEluc3RlYWQsIHRoaXMgbWV0aG9kIGNhbGxzIGdldFJlZGlyZWN0UmVzdWx0KCkgKHN0b3JlZCBpbg0KICAgICAgICAvLyBfY29tcGxldGVSZWRpcmVjdEZuKSB3aXRoIGFuIG9wdGlvbmFsIHBhcmFtZXRlciB0aGF0IGluc3RydWN0cyBhbGwgb2YNCiAgICAgICAgLy8gdGhlIHVuZGVybHlpbmcgYXV0aCBvcGVyYXRpb25zIHRvIHNraXAgYW55dGhpbmcgdGhhdCBtdXRhdGVzIGF1dGggc3RhdGUuDQogICAgICAgIGxldCByZXN1bHQgPSBudWxsOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgLy8gV2Uga25vdyB0aGlzLl9wb3B1cFJlZGlyZWN0UmVzb2x2ZXIgaXMgc2V0IHNpbmNlIHJlZGlyZWN0UmVzb2x2ZXINCiAgICAgICAgICAgIC8vIGlzIHBhc3NlZCBpbi4gVGhlIF9jb21wbGV0ZVJlZGlyZWN0Rm4gZXhwZWN0cyB0aGUgdW53cmFwcGVkIGV4dGVybi4NCiAgICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IHRoaXMuX3BvcHVwUmVkaXJlY3RSZXNvbHZlci5fY29tcGxldGVSZWRpcmVjdEZuKHRoaXMsIHJlZGlyZWN0UmVzb2x2ZXIsIHRydWUpOw0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICAvLyBTd2FsbG93IGFueSBlcnJvcnMgaGVyZTsgdGhlIGNvZGUgY2FuIHJldHJpZXZlIHRoZW0gaW4NCiAgICAgICAgICAgIC8vIGdldFJlZGlyZWN0UmVzdWx0KCkuDQogICAgICAgICAgICBhd2FpdCB0aGlzLl9zZXRSZWRpcmVjdFVzZXIobnVsbCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQogICAgYXN5bmMgcmVsb2FkQW5kU2V0Q3VycmVudFVzZXJPckNsZWFyKHVzZXIpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGF3YWl0IF9yZWxvYWRXaXRob3V0U2F2aW5nKHVzZXIpOw0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICBpZiAoKGUgPT09IG51bGwgfHwgZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZS5jb2RlKSAhPT0NCiAgICAgICAgICAgICAgICBgYXV0aC8keyJuZXR3b3JrLXJlcXVlc3QtZmFpbGVkIiAvKiBBdXRoRXJyb3JDb2RlLk5FVFdPUktfUkVRVUVTVF9GQUlMRUQgKi99YCkgew0KICAgICAgICAgICAgICAgIC8vIFNvbWV0aGluZydzIHdyb25nIHdpdGggdGhlIHVzZXIncyB0b2tlbi4gTG9nIHRoZW0gb3V0IGFuZCByZW1vdmUNCiAgICAgICAgICAgICAgICAvLyB0aGVtIGZyb20gc3RvcmFnZQ0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRpcmVjdGx5U2V0Q3VycmVudFVzZXIobnVsbCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXMuZGlyZWN0bHlTZXRDdXJyZW50VXNlcih1c2VyKTsNCiAgICB9DQogICAgdXNlRGV2aWNlTGFuZ3VhZ2UoKSB7DQogICAgICAgIHRoaXMubGFuZ3VhZ2VDb2RlID0gX2dldFVzZXJMYW5ndWFnZSgpOw0KICAgIH0NCiAgICBhc3luYyBfZGVsZXRlKCkgew0KICAgICAgICB0aGlzLl9kZWxldGVkID0gdHJ1ZTsNCiAgICB9DQogICAgYXN5bmMgdXBkYXRlQ3VycmVudFVzZXIodXNlckV4dGVybikgew0KICAgICAgICAvLyBUaGUgcHVibGljIHVwZGF0ZUN1cnJlbnRVc2VyIG1ldGhvZCBuZWVkcyB0byBtYWtlIGEgY29weSBvZiB0aGUgdXNlciwNCiAgICAgICAgLy8gYW5kIGFsc28gY2hlY2sgdGhhdCB0aGUgcHJvamVjdCBtYXRjaGVzDQogICAgICAgIGNvbnN0IHVzZXIgPSB1c2VyRXh0ZXJuDQogICAgICAgICAgICA/IGdldE1vZHVsYXJJbnN0YW5jZSh1c2VyRXh0ZXJuKQ0KICAgICAgICAgICAgOiBudWxsOw0KICAgICAgICBpZiAodXNlcikgew0KICAgICAgICAgICAgX2Fzc2VydCh1c2VyLmF1dGguY29uZmlnLmFwaUtleSA9PT0gdGhpcy5jb25maWcuYXBpS2V5LCB0aGlzLCAiaW52YWxpZC11c2VyLXRva2VuIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQVVUSCAqLyk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXMuX3VwZGF0ZUN1cnJlbnRVc2VyKHVzZXIgJiYgdXNlci5fY2xvbmUodGhpcykpOw0KICAgIH0NCiAgICBhc3luYyBfdXBkYXRlQ3VycmVudFVzZXIodXNlciwgc2tpcEJlZm9yZVN0YXRlQ2FsbGJhY2tzID0gZmFsc2UpIHsNCiAgICAgICAgaWYgKHRoaXMuX2RlbGV0ZWQpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodXNlcikgew0KICAgICAgICAgICAgX2Fzc2VydCh0aGlzLnRlbmFudElkID09PSB1c2VyLnRlbmFudElkLCB0aGlzLCAidGVuYW50LWlkLW1pc21hdGNoIiAvKiBBdXRoRXJyb3JDb2RlLlRFTkFOVF9JRF9NSVNNQVRDSCAqLyk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFza2lwQmVmb3JlU3RhdGVDYWxsYmFja3MpIHsNCiAgICAgICAgICAgIGF3YWl0IHRoaXMuYmVmb3JlU3RhdGVRdWV1ZS5ydW5NaWRkbGV3YXJlKHVzZXIpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzLnF1ZXVlKGFzeW5jICgpID0+IHsNCiAgICAgICAgICAgIGF3YWl0IHRoaXMuZGlyZWN0bHlTZXRDdXJyZW50VXNlcih1c2VyKTsNCiAgICAgICAgICAgIHRoaXMubm90aWZ5QXV0aExpc3RlbmVycygpOw0KICAgICAgICB9KTsNCiAgICB9DQogICAgYXN5bmMgc2lnbk91dCgpIHsNCiAgICAgICAgLy8gUnVuIGZpcnN0LCB0byBibG9jayBfc2V0UmVkaXJlY3RVc2VyKCkgaWYgYW55IGNhbGxiYWNrcyBmYWlsLg0KICAgICAgICBhd2FpdCB0aGlzLmJlZm9yZVN0YXRlUXVldWUucnVuTWlkZGxld2FyZShudWxsKTsNCiAgICAgICAgLy8gQ2xlYXIgdGhlIHJlZGlyZWN0IHVzZXIgd2hlbiBzaWduT3V0IGlzIGNhbGxlZA0KICAgICAgICBpZiAodGhpcy5yZWRpcmVjdFBlcnNpc3RlbmNlTWFuYWdlciB8fCB0aGlzLl9wb3B1cFJlZGlyZWN0UmVzb2x2ZXIpIHsNCiAgICAgICAgICAgIGF3YWl0IHRoaXMuX3NldFJlZGlyZWN0VXNlcihudWxsKTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBQcmV2ZW50IGNhbGxiYWNrcyBmcm9tIGJlaW5nIGNhbGxlZCBhZ2FpbiBpbiBfdXBkYXRlQ3VycmVudFVzZXIsIGFzDQogICAgICAgIC8vIHRoZXkgd2VyZSBhbHJlYWR5IGNhbGxlZCBpbiB0aGUgZmlyc3QgbGluZS4NCiAgICAgICAgcmV0dXJuIHRoaXMuX3VwZGF0ZUN1cnJlbnRVc2VyKG51bGwsIC8qIHNraXBCZWZvcmVTdGF0ZUNhbGxiYWNrcyAqLyB0cnVlKTsNCiAgICB9DQogICAgc2V0UGVyc2lzdGVuY2UocGVyc2lzdGVuY2UpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucXVldWUoYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgYXdhaXQgdGhpcy5hc3NlcnRlZFBlcnNpc3RlbmNlLnNldFBlcnNpc3RlbmNlKF9nZXRJbnN0YW5jZShwZXJzaXN0ZW5jZSkpOw0KICAgICAgICB9KTsNCiAgICB9DQogICAgYXN5bmMgaW5pdGlhbGl6ZVJlY2FwdGNoYUNvbmZpZygpIHsNCiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBnZXRSZWNhcHRjaGFDb25maWcodGhpcywgew0KICAgICAgICAgICAgY2xpZW50VHlwZTogIkNMSUVOVF9UWVBFX1dFQiIgLyogUmVjYXB0Y2hhQ2xpZW50VHlwZS5XRUIgKi8sDQogICAgICAgICAgICB2ZXJzaW9uOiAiUkVDQVBUQ0hBX0VOVEVSUFJJU0UiIC8qIFJlY2FwdGNoYVZlcnNpb24uRU5URVJQUklTRSAqLw0KICAgICAgICB9KTsNCiAgICAgICAgY29uc3QgY29uZmlnID0gbmV3IFJlY2FwdGNoYUNvbmZpZyhyZXNwb25zZSk7DQogICAgICAgIGlmICh0aGlzLnRlbmFudElkID09IG51bGwpIHsNCiAgICAgICAgICAgIHRoaXMuX2FnZW50UmVjYXB0Y2hhQ29uZmlnID0gY29uZmlnOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgdGhpcy5fdGVuYW50UmVjYXB0Y2hhQ29uZmlnc1t0aGlzLnRlbmFudElkXSA9IGNvbmZpZzsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoY29uZmlnLmVtYWlsUGFzc3dvcmRFbmFibGVkKSB7DQogICAgICAgICAgICBjb25zdCB2ZXJpZmllciA9IG5ldyBSZWNhcHRjaGFFbnRlcnByaXNlVmVyaWZpZXIodGhpcyk7DQogICAgICAgICAgICB2b2lkIHZlcmlmaWVyLnZlcmlmeSgpOw0KICAgICAgICB9DQogICAgfQ0KICAgIF9nZXRSZWNhcHRjaGFDb25maWcoKSB7DQogICAgICAgIGlmICh0aGlzLnRlbmFudElkID09IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hZ2VudFJlY2FwdGNoYUNvbmZpZzsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLl90ZW5hbnRSZWNhcHRjaGFDb25maWdzW3RoaXMudGVuYW50SWRdOw0KICAgICAgICB9DQogICAgfQ0KICAgIF9nZXRQZXJzaXN0ZW5jZSgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuYXNzZXJ0ZWRQZXJzaXN0ZW5jZS5wZXJzaXN0ZW5jZS50eXBlOw0KICAgIH0NCiAgICBfdXBkYXRlRXJyb3JNYXAoZXJyb3JNYXApIHsNCiAgICAgICAgdGhpcy5fZXJyb3JGYWN0b3J5ID0gbmV3IEVycm9yRmFjdG9yeSgnYXV0aCcsICdGaXJlYmFzZScsIGVycm9yTWFwKCkpOw0KICAgIH0NCiAgICBvbkF1dGhTdGF0ZUNoYW5nZWQobmV4dE9yT2JzZXJ2ZXIsIGVycm9yLCBjb21wbGV0ZWQpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMucmVnaXN0ZXJTdGF0ZUxpc3RlbmVyKHRoaXMuYXV0aFN0YXRlU3Vic2NyaXB0aW9uLCBuZXh0T3JPYnNlcnZlciwgZXJyb3IsIGNvbXBsZXRlZCk7DQogICAgfQ0KICAgIGJlZm9yZUF1dGhTdGF0ZUNoYW5nZWQoY2FsbGJhY2ssIG9uQWJvcnQpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuYmVmb3JlU3RhdGVRdWV1ZS5wdXNoQ2FsbGJhY2soY2FsbGJhY2ssIG9uQWJvcnQpOw0KICAgIH0NCiAgICBvbklkVG9rZW5DaGFuZ2VkKG5leHRPck9ic2VydmVyLCBlcnJvciwgY29tcGxldGVkKSB7DQogICAgICAgIHJldHVybiB0aGlzLnJlZ2lzdGVyU3RhdGVMaXN0ZW5lcih0aGlzLmlkVG9rZW5TdWJzY3JpcHRpb24sIG5leHRPck9ic2VydmVyLCBlcnJvciwgY29tcGxldGVkKTsNCiAgICB9DQogICAgYXV0aFN0YXRlUmVhZHkoKSB7DQogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50VXNlcikgew0KICAgICAgICAgICAgICAgIHJlc29sdmUoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnN0IHVuc3Vic2NyaWJlID0gdGhpcy5vbkF1dGhTdGF0ZUNoYW5nZWQoKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICB1bnN1YnNjcmliZSgpOw0KICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7DQogICAgICAgICAgICAgICAgfSwgcmVqZWN0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KICAgIHRvSlNPTigpIHsNCiAgICAgICAgdmFyIF9hOw0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgYXBpS2V5OiB0aGlzLmNvbmZpZy5hcGlLZXksDQogICAgICAgICAgICBhdXRoRG9tYWluOiB0aGlzLmNvbmZpZy5hdXRoRG9tYWluLA0KICAgICAgICAgICAgYXBwTmFtZTogdGhpcy5uYW1lLA0KICAgICAgICAgICAgY3VycmVudFVzZXI6IChfYSA9IHRoaXMuX2N1cnJlbnRVc2VyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudG9KU09OKCkNCiAgICAgICAgfTsNCiAgICB9DQogICAgYXN5bmMgX3NldFJlZGlyZWN0VXNlcih1c2VyLCBwb3B1cFJlZGlyZWN0UmVzb2x2ZXIpIHsNCiAgICAgICAgY29uc3QgcmVkaXJlY3RNYW5hZ2VyID0gYXdhaXQgdGhpcy5nZXRPckluaXRSZWRpcmVjdFBlcnNpc3RlbmNlTWFuYWdlcihwb3B1cFJlZGlyZWN0UmVzb2x2ZXIpOw0KICAgICAgICByZXR1cm4gdXNlciA9PT0gbnVsbA0KICAgICAgICAgICAgPyByZWRpcmVjdE1hbmFnZXIucmVtb3ZlQ3VycmVudFVzZXIoKQ0KICAgICAgICAgICAgOiByZWRpcmVjdE1hbmFnZXIuc2V0Q3VycmVudFVzZXIodXNlcik7DQogICAgfQ0KICAgIGFzeW5jIGdldE9ySW5pdFJlZGlyZWN0UGVyc2lzdGVuY2VNYW5hZ2VyKHBvcHVwUmVkaXJlY3RSZXNvbHZlcikgew0KICAgICAgICBpZiAoIXRoaXMucmVkaXJlY3RQZXJzaXN0ZW5jZU1hbmFnZXIpIHsNCiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVyID0gKHBvcHVwUmVkaXJlY3RSZXNvbHZlciAmJiBfZ2V0SW5zdGFuY2UocG9wdXBSZWRpcmVjdFJlc29sdmVyKSkgfHwNCiAgICAgICAgICAgICAgICB0aGlzLl9wb3B1cFJlZGlyZWN0UmVzb2x2ZXI7DQogICAgICAgICAgICBfYXNzZXJ0KHJlc29sdmVyLCB0aGlzLCAiYXJndW1lbnQtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pOw0KICAgICAgICAgICAgdGhpcy5yZWRpcmVjdFBlcnNpc3RlbmNlTWFuYWdlciA9IGF3YWl0IFBlcnNpc3RlbmNlVXNlck1hbmFnZXIuY3JlYXRlKHRoaXMsIFtfZ2V0SW5zdGFuY2UocmVzb2x2ZXIuX3JlZGlyZWN0UGVyc2lzdGVuY2UpXSwgInJlZGlyZWN0VXNlciIgLyogS2V5TmFtZS5SRURJUkVDVF9VU0VSICovKTsNCiAgICAgICAgICAgIHRoaXMucmVkaXJlY3RVc2VyID0NCiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnJlZGlyZWN0UGVyc2lzdGVuY2VNYW5hZ2VyLmdldEN1cnJlbnRVc2VyKCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXMucmVkaXJlY3RQZXJzaXN0ZW5jZU1hbmFnZXI7DQogICAgfQ0KICAgIGFzeW5jIF9yZWRpcmVjdFVzZXJGb3JJZChpZCkgew0KICAgICAgICB2YXIgX2EsIF9iOw0KICAgICAgICAvLyBNYWtlIHN1cmUgd2UndmUgY2xlYXJlZCBhbnkgcGVuZGluZyBwZXJzaXN0ZW5jZSBhY3Rpb25zIGlmIHdlJ3JlIG5vdCBpbg0KICAgICAgICAvLyB0aGUgaW5pdGlhbGl6ZXINCiAgICAgICAgaWYgKHRoaXMuX2lzSW5pdGlhbGl6ZWQpIHsNCiAgICAgICAgICAgIGF3YWl0IHRoaXMucXVldWUoYXN5bmMgKCkgPT4geyB9KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoKChfYSA9IHRoaXMuX2N1cnJlbnRVc2VyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuX3JlZGlyZWN0RXZlbnRJZCkgPT09IGlkKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudFVzZXI7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCgoX2IgPSB0aGlzLnJlZGlyZWN0VXNlcikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLl9yZWRpcmVjdEV2ZW50SWQpID09PSBpZCkgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVkaXJlY3RVc2VyOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBudWxsOw0KICAgIH0NCiAgICBhc3luYyBfcGVyc2lzdFVzZXJJZkN1cnJlbnQodXNlcikgew0KICAgICAgICBpZiAodXNlciA9PT0gdGhpcy5jdXJyZW50VXNlcikgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMucXVldWUoYXN5bmMgKCkgPT4gdGhpcy5kaXJlY3RseVNldEN1cnJlbnRVc2VyKHVzZXIpKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKiogTm90aWZpZXMgbGlzdGVuZXJzIG9ubHkgaWYgdGhlIHVzZXIgaXMgY3VycmVudCAqLw0KICAgIF9ub3RpZnlMaXN0ZW5lcnNJZkN1cnJlbnQodXNlcikgew0KICAgICAgICBpZiAodXNlciA9PT0gdGhpcy5jdXJyZW50VXNlcikgew0KICAgICAgICAgICAgdGhpcy5ub3RpZnlBdXRoTGlzdGVuZXJzKCk7DQogICAgICAgIH0NCiAgICB9DQogICAgX2tleSgpIHsNCiAgICAgICAgcmV0dXJuIGAke3RoaXMuY29uZmlnLmF1dGhEb21haW59OiR7dGhpcy5jb25maWcuYXBpS2V5fToke3RoaXMubmFtZX1gOw0KICAgIH0NCiAgICBfc3RhcnRQcm9hY3RpdmVSZWZyZXNoKCkgew0KICAgICAgICB0aGlzLmlzUHJvYWN0aXZlUmVmcmVzaEVuYWJsZWQgPSB0cnVlOw0KICAgICAgICBpZiAodGhpcy5jdXJyZW50VXNlcikgew0KICAgICAgICAgICAgdGhpcy5fY3VycmVudFVzZXIuX3N0YXJ0UHJvYWN0aXZlUmVmcmVzaCgpOw0KICAgICAgICB9DQogICAgfQ0KICAgIF9zdG9wUHJvYWN0aXZlUmVmcmVzaCgpIHsNCiAgICAgICAgdGhpcy5pc1Byb2FjdGl2ZVJlZnJlc2hFbmFibGVkID0gZmFsc2U7DQogICAgICAgIGlmICh0aGlzLmN1cnJlbnRVc2VyKSB7DQogICAgICAgICAgICB0aGlzLl9jdXJyZW50VXNlci5fc3RvcFByb2FjdGl2ZVJlZnJlc2goKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKiogUmV0dXJucyB0aGUgY3VycmVudCB1c2VyIGNhc3QgYXMgdGhlIGludGVybmFsIHR5cGUgKi8NCiAgICBnZXQgX2N1cnJlbnRVc2VyKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50VXNlcjsNCiAgICB9DQogICAgbm90aWZ5QXV0aExpc3RlbmVycygpIHsNCiAgICAgICAgdmFyIF9hLCBfYjsNCiAgICAgICAgaWYgKCF0aGlzLl9pc0luaXRpYWxpemVkKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5pZFRva2VuU3Vic2NyaXB0aW9uLm5leHQodGhpcy5jdXJyZW50VXNlcik7DQogICAgICAgIGNvbnN0IGN1cnJlbnRVaWQgPSAoX2IgPSAoX2EgPSB0aGlzLmN1cnJlbnRVc2VyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudWlkKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBudWxsOw0KICAgICAgICBpZiAodGhpcy5sYXN0Tm90aWZpZWRVaWQgIT09IGN1cnJlbnRVaWQpIHsNCiAgICAgICAgICAgIHRoaXMubGFzdE5vdGlmaWVkVWlkID0gY3VycmVudFVpZDsNCiAgICAgICAgICAgIHRoaXMuYXV0aFN0YXRlU3Vic2NyaXB0aW9uLm5leHQodGhpcy5jdXJyZW50VXNlcik7DQogICAgICAgIH0NCiAgICB9DQogICAgcmVnaXN0ZXJTdGF0ZUxpc3RlbmVyKHN1YnNjcmlwdGlvbiwgbmV4dE9yT2JzZXJ2ZXIsIGVycm9yLCBjb21wbGV0ZWQpIHsNCiAgICAgICAgaWYgKHRoaXMuX2RlbGV0ZWQpIHsNCiAgICAgICAgICAgIHJldHVybiAoKSA9PiB7IH07DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgY2IgPSB0eXBlb2YgbmV4dE9yT2JzZXJ2ZXIgPT09ICdmdW5jdGlvbicNCiAgICAgICAgICAgID8gbmV4dE9yT2JzZXJ2ZXINCiAgICAgICAgICAgIDogbmV4dE9yT2JzZXJ2ZXIubmV4dC5iaW5kKG5leHRPck9ic2VydmVyKTsNCiAgICAgICAgY29uc3QgcHJvbWlzZSA9IHRoaXMuX2lzSW5pdGlhbGl6ZWQNCiAgICAgICAgICAgID8gUHJvbWlzZS5yZXNvbHZlKCkNCiAgICAgICAgICAgIDogdGhpcy5faW5pdGlhbGl6YXRpb25Qcm9taXNlOw0KICAgICAgICBfYXNzZXJ0KHByb21pc2UsIHRoaXMsICJpbnRlcm5hbC1lcnJvciIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7DQogICAgICAgIC8vIFRoZSBjYWxsYmFjayBuZWVkcyB0byBiZSBjYWxsZWQgYXN5bmNocm9ub3VzbHkgcGVyIHRoZSBzcGVjLg0KICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzDQogICAgICAgIHByb21pc2UudGhlbigoKSA9PiBjYih0aGlzLmN1cnJlbnRVc2VyKSk7DQogICAgICAgIGlmICh0eXBlb2YgbmV4dE9yT2JzZXJ2ZXIgPT09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgICAgIHJldHVybiBzdWJzY3JpcHRpb24uYWRkT2JzZXJ2ZXIobmV4dE9yT2JzZXJ2ZXIsIGVycm9yLCBjb21wbGV0ZWQpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIHN1YnNjcmlwdGlvbi5hZGRPYnNlcnZlcihuZXh0T3JPYnNlcnZlcik7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogVW5wcm90ZWN0ZWQgKGZyb20gcmFjZSBjb25kaXRpb25zKSBtZXRob2QgdG8gc2V0IHRoZSBjdXJyZW50IHVzZXIuIFRoaXMNCiAgICAgKiBzaG91bGQgb25seSBiZSBjYWxsZWQgZnJvbSB3aXRoaW4gYSBxdWV1ZWQgY2FsbGJhY2suIFRoaXMgaXMgbmVjZXNzYXJ5DQogICAgICogYmVjYXVzZSB0aGUgcXVldWUgc2hvdWxkbid0IHJlbHkgb24gYW5vdGhlciBxdWV1ZWQgY2FsbGJhY2suDQogICAgICovDQogICAgYXN5bmMgZGlyZWN0bHlTZXRDdXJyZW50VXNlcih1c2VyKSB7DQogICAgICAgIGlmICh0aGlzLmN1cnJlbnRVc2VyICYmIHRoaXMuY3VycmVudFVzZXIgIT09IHVzZXIpIHsNCiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRVc2VyLl9zdG9wUHJvYWN0aXZlUmVmcmVzaCgpOw0KICAgICAgICB9DQogICAgICAgIGlmICh1c2VyICYmIHRoaXMuaXNQcm9hY3RpdmVSZWZyZXNoRW5hYmxlZCkgew0KICAgICAgICAgICAgdXNlci5fc3RhcnRQcm9hY3RpdmVSZWZyZXNoKCk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5jdXJyZW50VXNlciA9IHVzZXI7DQogICAgICAgIGlmICh1c2VyKSB7DQogICAgICAgICAgICBhd2FpdCB0aGlzLmFzc2VydGVkUGVyc2lzdGVuY2Uuc2V0Q3VycmVudFVzZXIodXNlcik7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBhd2FpdCB0aGlzLmFzc2VydGVkUGVyc2lzdGVuY2UucmVtb3ZlQ3VycmVudFVzZXIoKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBxdWV1ZShhY3Rpb24pIHsNCiAgICAgICAgLy8gSW4gY2FzZSBzb21ldGhpbmcgZXJyb3JzLCB0aGUgY2FsbGJhY2sgc3RpbGwgc2hvdWxkIGJlIGNhbGxlZCBpbiBvcmRlcg0KICAgICAgICAvLyB0byBrZWVwIHRoZSBwcm9taXNlIGNoYWluIGFsaXZlDQogICAgICAgIHRoaXMub3BlcmF0aW9ucyA9IHRoaXMub3BlcmF0aW9ucy50aGVuKGFjdGlvbiwgYWN0aW9uKTsNCiAgICAgICAgcmV0dXJuIHRoaXMub3BlcmF0aW9uczsNCiAgICB9DQogICAgZ2V0IGFzc2VydGVkUGVyc2lzdGVuY2UoKSB7DQogICAgICAgIF9hc3NlcnQodGhpcy5wZXJzaXN0ZW5jZU1hbmFnZXIsIHRoaXMsICJpbnRlcm5hbC1lcnJvciIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7DQogICAgICAgIHJldHVybiB0aGlzLnBlcnNpc3RlbmNlTWFuYWdlcjsNCiAgICB9DQogICAgX2xvZ0ZyYW1ld29yayhmcmFtZXdvcmspIHsNCiAgICAgICAgaWYgKCFmcmFtZXdvcmsgfHwgdGhpcy5mcmFtZXdvcmtzLmluY2x1ZGVzKGZyYW1ld29yaykpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmZyYW1ld29ya3MucHVzaChmcmFtZXdvcmspOw0KICAgICAgICAvLyBTb3J0IGFscGhhYmV0aWNhbGx5IHNvIHRoYXQgIkZpcmViYXNlQ29yZS13ZWIsRmlyZWJhc2VVSS13ZWIiIGFuZA0KICAgICAgICAvLyAiRmlyZWJhc2VVSS13ZWIsRmlyZWJhc2VDb3JlLXdlYiIgYXJlbid0IHZpZXdlZCBhcyBkaWZmZXJlbnQuDQogICAgICAgIHRoaXMuZnJhbWV3b3Jrcy5zb3J0KCk7DQogICAgICAgIHRoaXMuY2xpZW50VmVyc2lvbiA9IF9nZXRDbGllbnRWZXJzaW9uKHRoaXMuY29uZmlnLmNsaWVudFBsYXRmb3JtLCB0aGlzLl9nZXRGcmFtZXdvcmtzKCkpOw0KICAgIH0NCiAgICBfZ2V0RnJhbWV3b3JrcygpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZnJhbWV3b3JrczsNCiAgICB9DQogICAgYXN5bmMgX2dldEFkZGl0aW9uYWxIZWFkZXJzKCkgew0KICAgICAgICB2YXIgX2E7DQogICAgICAgIC8vIEFkZGl0aW9uYWwgaGVhZGVycyBvbiBldmVyeSByZXF1ZXN0DQogICAgICAgIGNvbnN0IGhlYWRlcnMgPSB7DQogICAgICAgICAgICBbIlgtQ2xpZW50LVZlcnNpb24iIC8qIEh0dHBIZWFkZXIuWF9DTElFTlRfVkVSU0lPTiAqL106IHRoaXMuY2xpZW50VmVyc2lvbg0KICAgICAgICB9Ow0KICAgICAgICBpZiAodGhpcy5hcHAub3B0aW9ucy5hcHBJZCkgew0KICAgICAgICAgICAgaGVhZGVyc1siWC1GaXJlYmFzZS1nbXBpZCIgLyogSHR0cEhlYWRlci5YX0ZJUkVCQVNFX0dNUElEICovXSA9IHRoaXMuYXBwLm9wdGlvbnMuYXBwSWQ7DQogICAgICAgIH0NCiAgICAgICAgLy8gSWYgdGhlIGhlYXJ0YmVhdCBzZXJ2aWNlIGV4aXN0cywgYWRkIHRoZSBoZWFydGJlYXQgc3RyaW5nDQogICAgICAgIGNvbnN0IGhlYXJ0YmVhdHNIZWFkZXIgPSBhd2FpdCAoKF9hID0gdGhpcy5oZWFydGJlYXRTZXJ2aWNlUHJvdmlkZXINCiAgICAgICAgICAgIC5nZXRJbW1lZGlhdGUoew0KICAgICAgICAgICAgb3B0aW9uYWw6IHRydWUNCiAgICAgICAgfSkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5nZXRIZWFydGJlYXRzSGVhZGVyKCkpOw0KICAgICAgICBpZiAoaGVhcnRiZWF0c0hlYWRlcikgew0KICAgICAgICAgICAgaGVhZGVyc1siWC1GaXJlYmFzZS1DbGllbnQiIC8qIEh0dHBIZWFkZXIuWF9GSVJFQkFTRV9DTElFTlQgKi9dID0gaGVhcnRiZWF0c0hlYWRlcjsNCiAgICAgICAgfQ0KICAgICAgICAvLyBJZiB0aGUgQXBwIENoZWNrIHNlcnZpY2UgZXhpc3RzLCBhZGQgdGhlIEFwcCBDaGVjayB0b2tlbiBpbiB0aGUgaGVhZGVycw0KICAgICAgICBjb25zdCBhcHBDaGVja1Rva2VuID0gYXdhaXQgdGhpcy5fZ2V0QXBwQ2hlY2tUb2tlbigpOw0KICAgICAgICBpZiAoYXBwQ2hlY2tUb2tlbikgew0KICAgICAgICAgICAgaGVhZGVyc1siWC1GaXJlYmFzZS1BcHBDaGVjayIgLyogSHR0cEhlYWRlci5YX0ZJUkVCQVNFX0FQUF9DSEVDSyAqL10gPSBhcHBDaGVja1Rva2VuOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBoZWFkZXJzOw0KICAgIH0NCiAgICBhc3luYyBfZ2V0QXBwQ2hlY2tUb2tlbigpIHsNCiAgICAgICAgdmFyIF9hOw0KICAgICAgICBjb25zdCBhcHBDaGVja1Rva2VuUmVzdWx0ID0gYXdhaXQgKChfYSA9IHRoaXMuYXBwQ2hlY2tTZXJ2aWNlUHJvdmlkZXINCiAgICAgICAgICAgIC5nZXRJbW1lZGlhdGUoeyBvcHRpb25hbDogdHJ1ZSB9KSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmdldFRva2VuKCkpOw0KICAgICAgICBpZiAoYXBwQ2hlY2tUb2tlblJlc3VsdCA9PT0gbnVsbCB8fCBhcHBDaGVja1Rva2VuUmVzdWx0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhcHBDaGVja1Rva2VuUmVzdWx0LmVycm9yKSB7DQogICAgICAgICAgICAvLyBDb250ZXh0OiBhcHBDaGVjay5nZXRUb2tlbigpIHdpbGwgbmV2ZXIgdGhyb3cgZXZlbiBpZiBhbiBlcnJvciBoYXBwZW5lZC4NCiAgICAgICAgICAgIC8vIEluIHRoZSBlcnJvciBjYXNlLCBhIGR1bW15IHRva2VuIHdpbGwgYmUgcmV0dXJuZWQgYWxvbmcgd2l0aCBhbiBlcnJvciBmaWVsZCBkZXNjcmliaW5nDQogICAgICAgICAgICAvLyB0aGUgZXJyb3IuIEluIGdlbmVyYWwsIHdlIHNob3VsZG4ndCBjYXJlIGFib3V0IHRoZSBlcnJvciBjb25kaXRpb24gYW5kIGp1c3QgdXNlDQogICAgICAgICAgICAvLyB0aGUgdG9rZW4gKGFjdHVhbCBvciBkdW1teSkgdG8gc2VuZCByZXF1ZXN0cy4NCiAgICAgICAgICAgIF9sb2dXYXJuKGBFcnJvciB3aGlsZSByZXRyaWV2aW5nIEFwcCBDaGVjayB0b2tlbjogJHthcHBDaGVja1Rva2VuUmVzdWx0LmVycm9yfWApOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBhcHBDaGVja1Rva2VuUmVzdWx0ID09PSBudWxsIHx8IGFwcENoZWNrVG9rZW5SZXN1bHQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFwcENoZWNrVG9rZW5SZXN1bHQudG9rZW47DQogICAgfQ0KfQ0KLyoqDQogKiBNZXRob2QgdG8gYmUgdXNlZCB0byBjYXN0IGRvd24gdG8gb3VyIHByaXZhdGUgaW1wbG1lbnRhdGlvbiBvZiBBdXRoLg0KICogSXQgd2lsbCBhbHNvIGhhbmRsZSB1bndyYXBwaW5nIGZyb20gdGhlIGNvbXBhdCB0eXBlIGlmIG5lY2Vzc2FyeQ0KICoNCiAqIEBwYXJhbSBhdXRoIEF1dGggb2JqZWN0IHBhc3NlZCBpbiBmcm9tIGRldmVsb3Blcg0KICovDQpmdW5jdGlvbiBfY2FzdEF1dGgoYXV0aCkgew0KICAgIHJldHVybiBnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCk7DQp9DQovKiogSGVscGVyIGNsYXNzIHRvIHdyYXAgc3Vic2NyaWJlciBsb2dpYyAqLw0KY2xhc3MgU3Vic2NyaXB0aW9uIHsNCiAgICBjb25zdHJ1Y3RvcihhdXRoKSB7DQogICAgICAgIHRoaXMuYXV0aCA9IGF1dGg7DQogICAgICAgIHRoaXMub2JzZXJ2ZXIgPSBudWxsOw0KICAgICAgICB0aGlzLmFkZE9ic2VydmVyID0gY3JlYXRlU3Vic2NyaWJlKG9ic2VydmVyID0+ICh0aGlzLm9ic2VydmVyID0gb2JzZXJ2ZXIpKTsNCiAgICB9DQogICAgZ2V0IG5leHQoKSB7DQogICAgICAgIF9hc3NlcnQodGhpcy5vYnNlcnZlciwgdGhpcy5hdXRoLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pOw0KICAgICAgICByZXR1cm4gdGhpcy5vYnNlcnZlci5uZXh0LmJpbmQodGhpcy5vYnNlcnZlcik7DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBJbml0aWFsaXplcyBhbiB7QGxpbmsgQXV0aH0gaW5zdGFuY2Ugd2l0aCBmaW5lLWdyYWluZWQgY29udHJvbCBvdmVyDQogKiB7QGxpbmsgRGVwZW5kZW5jaWVzfS4NCiAqDQogKiBAcmVtYXJrcw0KICoNCiAqIFRoaXMgZnVuY3Rpb24gYWxsb3dzIG1vcmUgY29udHJvbCBvdmVyIHRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UgdGhhbg0KICoge0BsaW5rIGdldEF1dGh9LiBgZ2V0QXV0aGAgdXNlcyBwbGF0Zm9ybS1zcGVjaWZpYyBkZWZhdWx0cyB0byBzdXBwbHkNCiAqIHRoZSB7QGxpbmsgRGVwZW5kZW5jaWVzfS4gSW4gZ2VuZXJhbCwgYGdldEF1dGhgIGlzIHRoZSBlYXNpZXN0IHdheSB0bw0KICogaW5pdGlhbGl6ZSBBdXRoIGFuZCB3b3JrcyBmb3IgbW9zdCB1c2UgY2FzZXMuIFVzZSBgaW5pdGlhbGl6ZUF1dGhgIGlmIHlvdQ0KICogbmVlZCBjb250cm9sIG92ZXIgd2hpY2ggcGVyc2lzdGVuY2UgbGF5ZXIgaXMgdXNlZCwgb3IgdG8gbWluaW1pemUgYnVuZGxlDQogKiBzaXplIGlmIHlvdSdyZSBub3QgdXNpbmcgZWl0aGVyIGBzaWduSW5XaXRoUG9wdXBgIG9yIGBzaWduSW5XaXRoUmVkaXJlY3RgLg0KICoNCiAqIEZvciBleGFtcGxlLCBpZiB5b3VyIGFwcCBvbmx5IHVzZXMgYW5vbnltb3VzIGFjY291bnRzIGFuZCB5b3Ugb25seSB3YW50DQogKiBhY2NvdW50cyBzYXZlZCBmb3IgdGhlIGN1cnJlbnQgc2Vzc2lvbiwgaW5pdGlhbGl6ZSBgQXV0aGAgd2l0aDoNCiAqDQogKiBgYGBqcw0KICogY29uc3QgYXV0aCA9IGluaXRpYWxpemVBdXRoKGFwcCwgew0KICogICBwZXJzaXN0ZW5jZTogYnJvd3NlclNlc3Npb25QZXJzaXN0ZW5jZSwNCiAqICAgcG9wdXBSZWRpcmVjdFJlc29sdmVyOiB1bmRlZmluZWQsDQogKiB9KTsNCiAqIGBgYA0KICoNCiAqIEBwdWJsaWMNCiAqLw0KZnVuY3Rpb24gaW5pdGlhbGl6ZUF1dGgoYXBwLCBkZXBzKSB7DQogICAgY29uc3QgcHJvdmlkZXIgPSBfZ2V0UHJvdmlkZXIoYXBwLCAnYXV0aCcpOw0KICAgIGlmIChwcm92aWRlci5pc0luaXRpYWxpemVkKCkpIHsNCiAgICAgICAgY29uc3QgYXV0aCA9IHByb3ZpZGVyLmdldEltbWVkaWF0ZSgpOw0KICAgICAgICBjb25zdCBpbml0aWFsT3B0aW9ucyA9IHByb3ZpZGVyLmdldE9wdGlvbnMoKTsNCiAgICAgICAgaWYgKGRlZXBFcXVhbChpbml0aWFsT3B0aW9ucywgZGVwcyAhPT0gbnVsbCAmJiBkZXBzICE9PSB2b2lkIDAgPyBkZXBzIDoge30pKSB7DQogICAgICAgICAgICByZXR1cm4gYXV0aDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIF9mYWlsKGF1dGgsICJhbHJlYWR5LWluaXRpYWxpemVkIiAvKiBBdXRoRXJyb3JDb2RlLkFMUkVBRFlfSU5JVElBTElaRUQgKi8pOw0KICAgICAgICB9DQogICAgfQ0KICAgIGNvbnN0IGF1dGggPSBwcm92aWRlci5pbml0aWFsaXplKHsgb3B0aW9uczogZGVwcyB9KTsNCiAgICByZXR1cm4gYXV0aDsNCn0NCmZ1bmN0aW9uIF9pbml0aWFsaXplQXV0aEluc3RhbmNlKGF1dGgsIGRlcHMpIHsNCiAgICBjb25zdCBwZXJzaXN0ZW5jZSA9IChkZXBzID09PSBudWxsIHx8IGRlcHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRlcHMucGVyc2lzdGVuY2UpIHx8IFtdOw0KICAgIGNvbnN0IGhpZXJhcmNoeSA9IChBcnJheS5pc0FycmF5KHBlcnNpc3RlbmNlKSA/IHBlcnNpc3RlbmNlIDogW3BlcnNpc3RlbmNlXSkubWFwKF9nZXRJbnN0YW5jZSk7DQogICAgaWYgKGRlcHMgPT09IG51bGwgfHwgZGVwcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGVwcy5lcnJvck1hcCkgew0KICAgICAgICBhdXRoLl91cGRhdGVFcnJvck1hcChkZXBzLmVycm9yTWFwKTsNCiAgICB9DQogICAgLy8gVGhpcyBwcm9taXNlIGlzIGludGVuZGVkIHRvIGZsb2F0OyBhdXRoIGluaXRpYWxpemF0aW9uIGhhcHBlbnMgaW4gdGhlDQogICAgLy8gYmFja2dyb3VuZCwgbWVhbndoaWxlIHRoZSBhdXRoIG9iamVjdCBtYXkgYmUgdXNlZCBieSB0aGUgYXBwLg0KICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZmxvYXRpbmctcHJvbWlzZXMNCiAgICBhdXRoLl9pbml0aWFsaXplV2l0aFBlcnNpc3RlbmNlKGhpZXJhcmNoeSwgZGVwcyA9PT0gbnVsbCB8fCBkZXBzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkZXBzLnBvcHVwUmVkaXJlY3RSZXNvbHZlcik7DQp9CgovKioNCiAqIENoYW5nZXMgdGhlIHtAbGluayBBdXRofSBpbnN0YW5jZSB0byBjb21tdW5pY2F0ZSB3aXRoIHRoZSBGaXJlYmFzZSBBdXRoIEVtdWxhdG9yLCBpbnN0ZWFkIG9mIHByb2R1Y3Rpb24NCiAqIEZpcmViYXNlIEF1dGggc2VydmljZXMuDQogKg0KICogQHJlbWFya3MNCiAqIFRoaXMgbXVzdCBiZSBjYWxsZWQgc3luY2hyb25vdXNseSBpbW1lZGlhdGVseSBmb2xsb3dpbmcgdGhlIGZpcnN0IGNhbGwgdG8NCiAqIHtAbGluayBpbml0aWFsaXplQXV0aH0uICBEbyBub3QgdXNlIHdpdGggcHJvZHVjdGlvbiBjcmVkZW50aWFscyBhcyBlbXVsYXRvcg0KICogdHJhZmZpYyBpcyBub3QgZW5jcnlwdGVkLg0KICoNCiAqDQogKiBAZXhhbXBsZQ0KICogYGBgamF2YXNjcmlwdA0KICogY29ubmVjdEF1dGhFbXVsYXRvcihhdXRoLCAnaHR0cDovLzEyNy4wLjAuMTo5MDk5JywgeyBkaXNhYmxlV2FybmluZ3M6IHRydWUgfSk7DQogKiBgYGANCiAqDQogKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuDQogKiBAcGFyYW0gdXJsIC0gVGhlIFVSTCBhdCB3aGljaCB0aGUgZW11bGF0b3IgaXMgcnVubmluZyAoZWcsICdodHRwOi8vbG9jYWxob3N0OjkwOTknKS4NCiAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwuIGBvcHRpb25zLmRpc2FibGVXYXJuaW5nc2AgZGVmYXVsdHMgdG8gYGZhbHNlYC4gU2V0IGl0IHRvDQogKiBgdHJ1ZWAgdG8gZGlzYWJsZSB0aGUgd2FybmluZyBiYW5uZXIgYXR0YWNoZWQgdG8gdGhlIERPTS4NCiAqDQogKiBAcHVibGljDQogKi8NCmZ1bmN0aW9uIGNvbm5lY3RBdXRoRW11bGF0b3IoYXV0aCwgdXJsLCBvcHRpb25zKSB7DQogICAgY29uc3QgYXV0aEludGVybmFsID0gX2Nhc3RBdXRoKGF1dGgpOw0KICAgIF9hc3NlcnQoYXV0aEludGVybmFsLl9jYW5Jbml0RW11bGF0b3IsIGF1dGhJbnRlcm5hbCwgImVtdWxhdG9yLWNvbmZpZy1mYWlsZWQiIC8qIEF1dGhFcnJvckNvZGUuRU1VTEFUT1JfQ09ORklHX0ZBSUxFRCAqLyk7DQogICAgX2Fzc2VydCgvXmh0dHBzPzpcL1wvLy50ZXN0KHVybCksIGF1dGhJbnRlcm5hbCwgImludmFsaWQtZW11bGF0b3Itc2NoZW1lIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfRU1VTEFUT1JfU0NIRU1FICovKTsNCiAgICBjb25zdCBkaXNhYmxlV2FybmluZ3MgPSAhIShvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMuZGlzYWJsZVdhcm5pbmdzKTsNCiAgICBjb25zdCBwcm90b2NvbCA9IGV4dHJhY3RQcm90b2NvbCQxKHVybCk7DQogICAgY29uc3QgeyBob3N0LCBwb3J0IH0gPSBleHRyYWN0SG9zdEFuZFBvcnQodXJsKTsNCiAgICBjb25zdCBwb3J0U3RyID0gcG9ydCA9PT0gbnVsbCA/ICcnIDogYDoke3BvcnR9YDsNCiAgICAvLyBBbHdheXMgcmVwbGFjZSBwYXRoIHdpdGggIi8iIChldmVuIGlmIGlucHV0IHVybCBoYWQgbm8gcGF0aCBhdCBhbGwsIG9yIGhhZCBhIGRpZmZlcmVudCBvbmUpLg0KICAgIGF1dGhJbnRlcm5hbC5jb25maWcuZW11bGF0b3IgPSB7IHVybDogYCR7cHJvdG9jb2x9Ly8ke2hvc3R9JHtwb3J0U3RyfS9gIH07DQogICAgYXV0aEludGVybmFsLnNldHRpbmdzLmFwcFZlcmlmaWNhdGlvbkRpc2FibGVkRm9yVGVzdGluZyA9IHRydWU7DQogICAgYXV0aEludGVybmFsLmVtdWxhdG9yQ29uZmlnID0gT2JqZWN0LmZyZWV6ZSh7DQogICAgICAgIGhvc3QsDQogICAgICAgIHBvcnQsDQogICAgICAgIHByb3RvY29sOiBwcm90b2NvbC5yZXBsYWNlKCc6JywgJycpLA0KICAgICAgICBvcHRpb25zOiBPYmplY3QuZnJlZXplKHsgZGlzYWJsZVdhcm5pbmdzIH0pDQogICAgfSk7DQogICAgaWYgKCFkaXNhYmxlV2FybmluZ3MpIHsNCiAgICAgICAgZW1pdEVtdWxhdG9yV2FybmluZygpOw0KICAgIH0NCn0NCmZ1bmN0aW9uIGV4dHJhY3RQcm90b2NvbCQxKHVybCkgew0KICAgIGNvbnN0IHByb3RvY29sRW5kID0gdXJsLmluZGV4T2YoJzonKTsNCiAgICByZXR1cm4gcHJvdG9jb2xFbmQgPCAwID8gJycgOiB1cmwuc3Vic3RyKDAsIHByb3RvY29sRW5kICsgMSk7DQp9DQpmdW5jdGlvbiBleHRyYWN0SG9zdEFuZFBvcnQodXJsKSB7DQogICAgY29uc3QgcHJvdG9jb2wgPSBleHRyYWN0UHJvdG9jb2wkMSh1cmwpOw0KICAgIGNvbnN0IGF1dGhvcml0eSA9IC8oXC9cLyk/KFtePyMvXSspLy5leGVjKHVybC5zdWJzdHIocHJvdG9jb2wubGVuZ3RoKSk7IC8vIEJldHdlZW4gLy8gYW5kIC8sID8gb3IgIy4NCiAgICBpZiAoIWF1dGhvcml0eSkgew0KICAgICAgICByZXR1cm4geyBob3N0OiAnJywgcG9ydDogbnVsbCB9Ow0KICAgIH0NCiAgICBjb25zdCBob3N0QW5kUG9ydCA9IGF1dGhvcml0eVsyXS5zcGxpdCgnQCcpLnBvcCgpIHx8ICcnOyAvLyBTdHJpcCBvdXQgInVzZXJuYW1lOnBhc3N3b3JkQCIuDQogICAgY29uc3QgYnJhY2tldGVkSVB2NiA9IC9eKFxbW15cXV0rXF0pKDp8JCkvLmV4ZWMoaG9zdEFuZFBvcnQpOw0KICAgIGlmIChicmFja2V0ZWRJUHY2KSB7DQogICAgICAgIGNvbnN0IGhvc3QgPSBicmFja2V0ZWRJUHY2WzFdOw0KICAgICAgICByZXR1cm4geyBob3N0LCBwb3J0OiBwYXJzZVBvcnQoaG9zdEFuZFBvcnQuc3Vic3RyKGhvc3QubGVuZ3RoICsgMSkpIH07DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBjb25zdCBbaG9zdCwgcG9ydF0gPSBob3N0QW5kUG9ydC5zcGxpdCgnOicpOw0KICAgICAgICByZXR1cm4geyBob3N0LCBwb3J0OiBwYXJzZVBvcnQocG9ydCkgfTsNCiAgICB9DQp9DQpmdW5jdGlvbiBwYXJzZVBvcnQocG9ydFN0cikgew0KICAgIGlmICghcG9ydFN0cikgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgY29uc3QgcG9ydCA9IE51bWJlcihwb3J0U3RyKTsNCiAgICBpZiAoaXNOYU4ocG9ydCkpIHsNCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KICAgIHJldHVybiBwb3J0Ow0KfQ0KZnVuY3Rpb24gZW1pdEVtdWxhdG9yV2FybmluZygpIHsNCiAgICBmdW5jdGlvbiBhdHRhY2hCYW5uZXIoKSB7DQogICAgICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpOw0KICAgICAgICBjb25zdCBzdHkgPSBlbC5zdHlsZTsNCiAgICAgICAgZWwuaW5uZXJUZXh0ID0NCiAgICAgICAgICAgICdSdW5uaW5nIGluIGVtdWxhdG9yIG1vZGUuIERvIG5vdCB1c2Ugd2l0aCBwcm9kdWN0aW9uIGNyZWRlbnRpYWxzLic7DQogICAgICAgIHN0eS5wb3NpdGlvbiA9ICdmaXhlZCc7DQogICAgICAgIHN0eS53aWR0aCA9ICcxMDAlJzsNCiAgICAgICAgc3R5LmJhY2tncm91bmRDb2xvciA9ICcjZmZmZmZmJzsNCiAgICAgICAgc3R5LmJvcmRlciA9ICcuMWVtIHNvbGlkICMwMDAwMDAnOw0KICAgICAgICBzdHkuY29sb3IgPSAnI2I1MDAwMCc7DQogICAgICAgIHN0eS5ib3R0b20gPSAnMHB4JzsNCiAgICAgICAgc3R5LmxlZnQgPSAnMHB4JzsNCiAgICAgICAgc3R5Lm1hcmdpbiA9ICcwcHgnOw0KICAgICAgICBzdHkuekluZGV4ID0gJzEwMDAwJzsNCiAgICAgICAgc3R5LnRleHRBbGlnbiA9ICdjZW50ZXInOw0KICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKCdmaXJlYmFzZS1lbXVsYXRvci13YXJuaW5nJyk7DQogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWwpOw0KICAgIH0NCiAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBjb25zb2xlLmluZm8gPT09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgY29uc29sZS5pbmZvKCdXQVJOSU5HOiBZb3UgYXJlIHVzaW5nIHRoZSBBdXRoIEVtdWxhdG9yLCcgKw0KICAgICAgICAgICAgJyB3aGljaCBpcyBpbnRlbmRlZCBmb3IgbG9jYWwgdGVzdGluZyBvbmx5LiAgRG8gbm90IHVzZSB3aXRoJyArDQogICAgICAgICAgICAnIHByb2R1Y3Rpb24gY3JlZGVudGlhbHMuJyk7DQogICAgfQ0KICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnKSB7DQogICAgICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnbG9hZGluZycpIHsNCiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgYXR0YWNoQmFubmVyKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGF0dGFjaEJhbm5lcigpOw0KICAgICAgICB9DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBJbnRlcmZhY2UgdGhhdCByZXByZXNlbnRzIHRoZSBjcmVkZW50aWFscyByZXR1cm5lZCBieSBhbiB7QGxpbmsgQXV0aFByb3ZpZGVyfS4NCiAqDQogKiBAcmVtYXJrcw0KICogSW1wbGVtZW50YXRpb25zIHNwZWNpZnkgdGhlIGRldGFpbHMgYWJvdXQgZWFjaCBhdXRoIHByb3ZpZGVyJ3MgY3JlZGVudGlhbCByZXF1aXJlbWVudHMuDQogKg0KICogQHB1YmxpYw0KICovDQpjbGFzcyBBdXRoQ3JlZGVudGlhbCB7DQogICAgLyoqIEBpbnRlcm5hbCAqLw0KICAgIGNvbnN0cnVjdG9yKA0KICAgIC8qKg0KICAgICAqIFRoZSBhdXRoZW50aWNhdGlvbiBwcm92aWRlciBJRCBmb3IgdGhlIGNyZWRlbnRpYWwuDQogICAgICoNCiAgICAgKiBAcmVtYXJrcw0KICAgICAqIEZvciBleGFtcGxlLCAnZmFjZWJvb2suY29tJywgb3IgJ2dvb2dsZS5jb20nLg0KICAgICAqLw0KICAgIHByb3ZpZGVySWQsIA0KICAgIC8qKg0KICAgICAqIFRoZSBhdXRoZW50aWNhdGlvbiBzaWduIGluIG1ldGhvZCBmb3IgdGhlIGNyZWRlbnRpYWwuDQogICAgICoNCiAgICAgKiBAcmVtYXJrcw0KICAgICAqIEZvciBleGFtcGxlLCB7QGxpbmsgU2lnbkluTWV0aG9kfS5FTUFJTF9QQVNTV09SRCwgb3INCiAgICAgKiB7QGxpbmsgU2lnbkluTWV0aG9kfS5FTUFJTF9MSU5LLiBUaGlzIGNvcnJlc3BvbmRzIHRvIHRoZSBzaWduLWluIG1ldGhvZA0KICAgICAqIGlkZW50aWZpZXIgYXMgcmV0dXJuZWQgaW4ge0BsaW5rIGZldGNoU2lnbkluTWV0aG9kc0ZvckVtYWlsfS4NCiAgICAgKi8NCiAgICBzaWduSW5NZXRob2QpIHsNCiAgICAgICAgdGhpcy5wcm92aWRlcklkID0gcHJvdmlkZXJJZDsNCiAgICAgICAgdGhpcy5zaWduSW5NZXRob2QgPSBzaWduSW5NZXRob2Q7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFJldHVybnMgYSBKU09OLXNlcmlhbGl6YWJsZSByZXByZXNlbnRhdGlvbiBvZiB0aGlzIG9iamVjdC4NCiAgICAgKg0KICAgICAqIEByZXR1cm5zIGEgSlNPTi1zZXJpYWxpemFibGUgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBvYmplY3QuDQogICAgICovDQogICAgdG9KU09OKCkgew0KICAgICAgICByZXR1cm4gZGVidWdGYWlsKCdub3QgaW1wbGVtZW50ZWQnKTsNCiAgICB9DQogICAgLyoqIEBpbnRlcm5hbCAqLw0KICAgIF9nZXRJZFRva2VuUmVzcG9uc2UoX2F1dGgpIHsNCiAgICAgICAgcmV0dXJuIGRlYnVnRmFpbCgnbm90IGltcGxlbWVudGVkJyk7DQogICAgfQ0KICAgIC8qKiBAaW50ZXJuYWwgKi8NCiAgICBfbGlua1RvSWRUb2tlbihfYXV0aCwgX2lkVG9rZW4pIHsNCiAgICAgICAgcmV0dXJuIGRlYnVnRmFpbCgnbm90IGltcGxlbWVudGVkJyk7DQogICAgfQ0KICAgIC8qKiBAaW50ZXJuYWwgKi8NCiAgICBfZ2V0UmVhdXRoZW50aWNhdGlvblJlc29sdmVyKF9hdXRoKSB7DQogICAgICAgIHJldHVybiBkZWJ1Z0ZhaWwoJ25vdCBpbXBsZW1lbnRlZCcpOw0KICAgIH0NCn0KYXN5bmMgZnVuY3Rpb24gdXBkYXRlRW1haWxQYXNzd29yZChhdXRoLCByZXF1ZXN0KSB7DQogICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCAiUE9TVCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCAiL3YxL2FjY291bnRzOnVwZGF0ZSIgLyogRW5kcG9pbnQuU0VUX0FDQ09VTlRfSU5GTyAqLywgcmVxdWVzdCk7DQp9DQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KYXN5bmMgZnVuY3Rpb24gc2lnbkluV2l0aFBhc3N3b3JkKGF1dGgsIHJlcXVlc3QpIHsNCiAgICByZXR1cm4gX3BlcmZvcm1TaWduSW5SZXF1ZXN0KGF1dGgsICJQT1NUIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sICIvdjEvYWNjb3VudHM6c2lnbkluV2l0aFBhc3N3b3JkIiAvKiBFbmRwb2ludC5TSUdOX0lOX1dJVEhfUEFTU1dPUkQgKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7DQp9DQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KYXN5bmMgZnVuY3Rpb24gc2lnbkluV2l0aEVtYWlsTGluayQxKGF1dGgsIHJlcXVlc3QpIHsNCiAgICByZXR1cm4gX3BlcmZvcm1TaWduSW5SZXF1ZXN0KGF1dGgsICJQT1NUIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sICIvdjEvYWNjb3VudHM6c2lnbkluV2l0aEVtYWlsTGluayIgLyogRW5kcG9pbnQuU0lHTl9JTl9XSVRIX0VNQUlMX0xJTksgKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7DQp9DQphc3luYyBmdW5jdGlvbiBzaWduSW5XaXRoRW1haWxMaW5rRm9yTGlua2luZyhhdXRoLCByZXF1ZXN0KSB7DQogICAgcmV0dXJuIF9wZXJmb3JtU2lnbkluUmVxdWVzdChhdXRoLCAiUE9TVCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCAiL3YxL2FjY291bnRzOnNpZ25JbldpdGhFbWFpbExpbmsiIC8qIEVuZHBvaW50LlNJR05fSU5fV0lUSF9FTUFJTF9MSU5LICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBJbnRlcmZhY2UgdGhhdCByZXByZXNlbnRzIHRoZSBjcmVkZW50aWFscyByZXR1cm5lZCBieSB7QGxpbmsgRW1haWxBdXRoUHJvdmlkZXJ9IGZvcg0KICoge0BsaW5rIFByb3ZpZGVySWR9LlBBU1NXT1JEDQogKg0KICogQHJlbWFya3MNCiAqIENvdmVycyBib3RoIHtAbGluayBTaWduSW5NZXRob2R9LkVNQUlMX1BBU1NXT1JEIGFuZA0KICoge0BsaW5rIFNpZ25Jbk1ldGhvZH0uRU1BSUxfTElOSy4NCiAqDQogKiBAcHVibGljDQogKi8NCmNsYXNzIEVtYWlsQXV0aENyZWRlbnRpYWwgZXh0ZW5kcyBBdXRoQ3JlZGVudGlhbCB7DQogICAgLyoqIEBpbnRlcm5hbCAqLw0KICAgIGNvbnN0cnVjdG9yKA0KICAgIC8qKiBAaW50ZXJuYWwgKi8NCiAgICBfZW1haWwsIA0KICAgIC8qKiBAaW50ZXJuYWwgKi8NCiAgICBfcGFzc3dvcmQsIHNpZ25Jbk1ldGhvZCwgDQogICAgLyoqIEBpbnRlcm5hbCAqLw0KICAgIF90ZW5hbnRJZCA9IG51bGwpIHsNCiAgICAgICAgc3VwZXIoInBhc3N3b3JkIiAvKiBQcm92aWRlcklkLlBBU1NXT1JEICovLCBzaWduSW5NZXRob2QpOw0KICAgICAgICB0aGlzLl9lbWFpbCA9IF9lbWFpbDsNCiAgICAgICAgdGhpcy5fcGFzc3dvcmQgPSBfcGFzc3dvcmQ7DQogICAgICAgIHRoaXMuX3RlbmFudElkID0gX3RlbmFudElkOw0KICAgIH0NCiAgICAvKiogQGludGVybmFsICovDQogICAgc3RhdGljIF9mcm9tRW1haWxBbmRQYXNzd29yZChlbWFpbCwgcGFzc3dvcmQpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBFbWFpbEF1dGhDcmVkZW50aWFsKGVtYWlsLCBwYXNzd29yZCwgInBhc3N3b3JkIiAvKiBTaWduSW5NZXRob2QuRU1BSUxfUEFTU1dPUkQgKi8pOw0KICAgIH0NCiAgICAvKiogQGludGVybmFsICovDQogICAgc3RhdGljIF9mcm9tRW1haWxBbmRDb2RlKGVtYWlsLCBvb2JDb2RlLCB0ZW5hbnRJZCA9IG51bGwpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBFbWFpbEF1dGhDcmVkZW50aWFsKGVtYWlsLCBvb2JDb2RlLCAiZW1haWxMaW5rIiAvKiBTaWduSW5NZXRob2QuRU1BSUxfTElOSyAqLywgdGVuYW50SWQpOw0KICAgIH0NCiAgICAvKioge0Bpbmhlcml0ZG9jIEF1dGhDcmVkZW50aWFsLnRvSlNPTn0gKi8NCiAgICB0b0pTT04oKSB7DQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgICBlbWFpbDogdGhpcy5fZW1haWwsDQogICAgICAgICAgICBwYXNzd29yZDogdGhpcy5fcGFzc3dvcmQsDQogICAgICAgICAgICBzaWduSW5NZXRob2Q6IHRoaXMuc2lnbkluTWV0aG9kLA0KICAgICAgICAgICAgdGVuYW50SWQ6IHRoaXMuX3RlbmFudElkDQogICAgICAgIH07DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFN0YXRpYyBtZXRob2QgdG8gZGVzZXJpYWxpemUgYSBKU09OIHJlcHJlc2VudGF0aW9uIG9mIGFuIG9iamVjdCBpbnRvIGFuIHtAbGluayAgQXV0aENyZWRlbnRpYWx9Lg0KICAgICAqDQogICAgICogQHBhcmFtIGpzb24gLSBFaXRoZXIgYG9iamVjdGAgb3IgdGhlIHN0cmluZ2lmaWVkIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBvYmplY3QuIFdoZW4gc3RyaW5nIGlzDQogICAgICogcHJvdmlkZWQsIGBKU09OLnBhcnNlYCB3b3VsZCBiZSBjYWxsZWQgZmlyc3QuDQogICAgICoNCiAgICAgKiBAcmV0dXJucyBJZiB0aGUgSlNPTiBpbnB1dCBkb2VzIG5vdCByZXByZXNlbnQgYW4ge0BsaW5rIEF1dGhDcmVkZW50aWFsfSwgbnVsbCBpcyByZXR1cm5lZC4NCiAgICAgKi8NCiAgICBzdGF0aWMgZnJvbUpTT04oanNvbikgew0KICAgICAgICBjb25zdCBvYmogPSB0eXBlb2YganNvbiA9PT0gJ3N0cmluZycgPyBKU09OLnBhcnNlKGpzb24pIDoganNvbjsNCiAgICAgICAgaWYgKChvYmogPT09IG51bGwgfHwgb2JqID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvYmouZW1haWwpICYmIChvYmogPT09IG51bGwgfHwgb2JqID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvYmoucGFzc3dvcmQpKSB7DQogICAgICAgICAgICBpZiAob2JqLnNpZ25Jbk1ldGhvZCA9PT0gInBhc3N3b3JkIiAvKiBTaWduSW5NZXRob2QuRU1BSUxfUEFTU1dPUkQgKi8pIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJvbUVtYWlsQW5kUGFzc3dvcmQob2JqLmVtYWlsLCBvYmoucGFzc3dvcmQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAob2JqLnNpZ25Jbk1ldGhvZCA9PT0gImVtYWlsTGluayIgLyogU2lnbkluTWV0aG9kLkVNQUlMX0xJTksgKi8pIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJvbUVtYWlsQW5kQ29kZShvYmouZW1haWwsIG9iai5wYXNzd29yZCwgb2JqLnRlbmFudElkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgLyoqIEBpbnRlcm5hbCAqLw0KICAgIGFzeW5jIF9nZXRJZFRva2VuUmVzcG9uc2UoYXV0aCkgew0KICAgICAgICB2YXIgX2E7DQogICAgICAgIHN3aXRjaCAodGhpcy5zaWduSW5NZXRob2QpIHsNCiAgICAgICAgICAgIGNhc2UgInBhc3N3b3JkIiAvKiBTaWduSW5NZXRob2QuRU1BSUxfUEFTU1dPUkQgKi86DQogICAgICAgICAgICAgICAgY29uc3QgcmVxdWVzdCA9IHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuU2VjdXJlVG9rZW46IHRydWUsDQogICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLl9lbWFpbCwNCiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHRoaXMuX3Bhc3N3b3JkLA0KICAgICAgICAgICAgICAgICAgICBjbGllbnRUeXBlOiAiQ0xJRU5UX1RZUEVfV0VCIiAvKiBSZWNhcHRjaGFDbGllbnRUeXBlLldFQiAqLw0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgaWYgKChfYSA9IGF1dGguX2dldFJlY2FwdGNoYUNvbmZpZygpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZW1haWxQYXNzd29yZEVuYWJsZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVxdWVzdFdpdGhSZWNhcHRjaGEgPSBhd2FpdCBpbmplY3RSZWNhcHRjaGFGaWVsZHMoYXV0aCwgcmVxdWVzdCwgInNpZ25JbldpdGhQYXNzd29yZCIgLyogUmVjYXB0Y2hhQWN0aW9uTmFtZS5TSUdOX0lOX1dJVEhfUEFTU1dPUkQgKi8pOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2lnbkluV2l0aFBhc3N3b3JkKGF1dGgsIHJlcXVlc3RXaXRoUmVjYXB0Y2hhKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzaWduSW5XaXRoUGFzc3dvcmQoYXV0aCwgcmVxdWVzdCkuY2F0Y2goYXN5bmMgKGVycm9yKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IuY29kZSA9PT0gYGF1dGgvJHsibWlzc2luZy1yZWNhcHRjaGEtdG9rZW4iIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19SRUNBUFRDSEFfVE9LRU4gKi99YCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTaWduLWluIHdpdGggZW1haWwgYWRkcmVzcyBhbmQgcGFzc3dvcmQgaXMgcHJvdGVjdGVkIGJ5IHJlQ0FQVENIQSBmb3IgdGhpcyBwcm9qZWN0LiBBdXRvbWF0aWNhbGx5IHRyaWdnZXJpbmcgdGhlIHJlQ0FQVENIQSBmbG93IGFuZCByZXN0YXJ0aW5nIHRoZSBzaWduLWluIGZsb3cuJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVxdWVzdFdpdGhSZWNhcHRjaGEgPSBhd2FpdCBpbmplY3RSZWNhcHRjaGFGaWVsZHMoYXV0aCwgcmVxdWVzdCwgInNpZ25JbldpdGhQYXNzd29yZCIgLyogUmVjYXB0Y2hhQWN0aW9uTmFtZS5TSUdOX0lOX1dJVEhfUEFTU1dPUkQgKi8pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzaWduSW5XaXRoUGFzc3dvcmQoYXV0aCwgcmVxdWVzdFdpdGhSZWNhcHRjaGEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSAiZW1haWxMaW5rIiAvKiBTaWduSW5NZXRob2QuRU1BSUxfTElOSyAqLzoNCiAgICAgICAgICAgICAgICByZXR1cm4gc2lnbkluV2l0aEVtYWlsTGluayQxKGF1dGgsIHsNCiAgICAgICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuX2VtYWlsLA0KICAgICAgICAgICAgICAgICAgICBvb2JDb2RlOiB0aGlzLl9wYXNzd29yZA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICBfZmFpbChhdXRoLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKiBAaW50ZXJuYWwgKi8NCiAgICBhc3luYyBfbGlua1RvSWRUb2tlbihhdXRoLCBpZFRva2VuKSB7DQogICAgICAgIHN3aXRjaCAodGhpcy5zaWduSW5NZXRob2QpIHsNCiAgICAgICAgICAgIGNhc2UgInBhc3N3b3JkIiAvKiBTaWduSW5NZXRob2QuRU1BSUxfUEFTU1dPUkQgKi86DQogICAgICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZUVtYWlsUGFzc3dvcmQoYXV0aCwgew0KICAgICAgICAgICAgICAgICAgICBpZFRva2VuLA0KICAgICAgICAgICAgICAgICAgICByZXR1cm5TZWN1cmVUb2tlbjogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuX2VtYWlsLA0KICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogdGhpcy5fcGFzc3dvcmQNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGNhc2UgImVtYWlsTGluayIgLyogU2lnbkluTWV0aG9kLkVNQUlMX0xJTksgKi86DQogICAgICAgICAgICAgICAgcmV0dXJuIHNpZ25JbldpdGhFbWFpbExpbmtGb3JMaW5raW5nKGF1dGgsIHsNCiAgICAgICAgICAgICAgICAgICAgaWRUb2tlbiwNCiAgICAgICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuX2VtYWlsLA0KICAgICAgICAgICAgICAgICAgICBvb2JDb2RlOiB0aGlzLl9wYXNzd29yZA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICBfZmFpbChhdXRoLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKiBAaW50ZXJuYWwgKi8NCiAgICBfZ2V0UmVhdXRoZW50aWNhdGlvblJlc29sdmVyKGF1dGgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuX2dldElkVG9rZW5SZXNwb25zZShhdXRoKTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQphc3luYyBmdW5jdGlvbiBzaWduSW5XaXRoSWRwKGF1dGgsIHJlcXVlc3QpIHsNCiAgICByZXR1cm4gX3BlcmZvcm1TaWduSW5SZXF1ZXN0KGF1dGgsICJQT1NUIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sICIvdjEvYWNjb3VudHM6c2lnbkluV2l0aElkcCIgLyogRW5kcG9pbnQuU0lHTl9JTl9XSVRIX0lEUCAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpKTsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNvbnN0IElEUF9SRVFVRVNUX1VSSSQxID0gJ2h0dHA6Ly9sb2NhbGhvc3QnOw0KLyoqDQogKiBSZXByZXNlbnRzIHRoZSBPQXV0aCBjcmVkZW50aWFscyByZXR1cm5lZCBieSBhbiB7QGxpbmsgT0F1dGhQcm92aWRlcn0uDQogKg0KICogQHJlbWFya3MNCiAqIEltcGxlbWVudGF0aW9ucyBzcGVjaWZ5IHRoZSBkZXRhaWxzIGFib3V0IGVhY2ggYXV0aCBwcm92aWRlcidzIGNyZWRlbnRpYWwgcmVxdWlyZW1lbnRzLg0KICoNCiAqIEBwdWJsaWMNCiAqLw0KY2xhc3MgT0F1dGhDcmVkZW50aWFsIGV4dGVuZHMgQXV0aENyZWRlbnRpYWwgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICBzdXBlciguLi5hcmd1bWVudHMpOw0KICAgICAgICB0aGlzLnBlbmRpbmdUb2tlbiA9IG51bGw7DQogICAgfQ0KICAgIC8qKiBAaW50ZXJuYWwgKi8NCiAgICBzdGF0aWMgX2Zyb21QYXJhbXMocGFyYW1zKSB7DQogICAgICAgIGNvbnN0IGNyZWQgPSBuZXcgT0F1dGhDcmVkZW50aWFsKHBhcmFtcy5wcm92aWRlcklkLCBwYXJhbXMuc2lnbkluTWV0aG9kKTsNCiAgICAgICAgaWYgKHBhcmFtcy5pZFRva2VuIHx8IHBhcmFtcy5hY2Nlc3NUb2tlbikgew0KICAgICAgICAgICAgLy8gT0F1dGggMiBhbmQgZWl0aGVyIElEIHRva2VuIG9yIGFjY2VzcyB0b2tlbi4NCiAgICAgICAgICAgIGlmIChwYXJhbXMuaWRUb2tlbikgew0KICAgICAgICAgICAgICAgIGNyZWQuaWRUb2tlbiA9IHBhcmFtcy5pZFRva2VuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHBhcmFtcy5hY2Nlc3NUb2tlbikgew0KICAgICAgICAgICAgICAgIGNyZWQuYWNjZXNzVG9rZW4gPSBwYXJhbXMuYWNjZXNzVG9rZW47DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvLyBBZGQgbm9uY2UgaWYgYXZhaWxhYmxlIGFuZCBubyBwZW5kaW5nVG9rZW4gaXMgcHJlc2VudC4NCiAgICAgICAgICAgIGlmIChwYXJhbXMubm9uY2UgJiYgIXBhcmFtcy5wZW5kaW5nVG9rZW4pIHsNCiAgICAgICAgICAgICAgICBjcmVkLm5vbmNlID0gcGFyYW1zLm5vbmNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHBhcmFtcy5wZW5kaW5nVG9rZW4pIHsNCiAgICAgICAgICAgICAgICBjcmVkLnBlbmRpbmdUb2tlbiA9IHBhcmFtcy5wZW5kaW5nVG9rZW47DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAocGFyYW1zLm9hdXRoVG9rZW4gJiYgcGFyYW1zLm9hdXRoVG9rZW5TZWNyZXQpIHsNCiAgICAgICAgICAgIC8vIE9BdXRoIDEgYW5kIE9BdXRoIHRva2VuIHdpdGggdG9rZW4gc2VjcmV0DQogICAgICAgICAgICBjcmVkLmFjY2Vzc1Rva2VuID0gcGFyYW1zLm9hdXRoVG9rZW47DQogICAgICAgICAgICBjcmVkLnNlY3JldCA9IHBhcmFtcy5vYXV0aFRva2VuU2VjcmV0Ow0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgX2ZhaWwoImFyZ3VtZW50LWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gY3JlZDsNCiAgICB9DQogICAgLyoqIHtAaW5oZXJpdGRvYyBBdXRoQ3JlZGVudGlhbC50b0pTT059ICAqLw0KICAgIHRvSlNPTigpIHsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIGlkVG9rZW46IHRoaXMuaWRUb2tlbiwNCiAgICAgICAgICAgIGFjY2Vzc1Rva2VuOiB0aGlzLmFjY2Vzc1Rva2VuLA0KICAgICAgICAgICAgc2VjcmV0OiB0aGlzLnNlY3JldCwNCiAgICAgICAgICAgIG5vbmNlOiB0aGlzLm5vbmNlLA0KICAgICAgICAgICAgcGVuZGluZ1Rva2VuOiB0aGlzLnBlbmRpbmdUb2tlbiwNCiAgICAgICAgICAgIHByb3ZpZGVySWQ6IHRoaXMucHJvdmlkZXJJZCwNCiAgICAgICAgICAgIHNpZ25Jbk1ldGhvZDogdGhpcy5zaWduSW5NZXRob2QNCiAgICAgICAgfTsNCiAgICB9DQogICAgLyoqDQogICAgICogU3RhdGljIG1ldGhvZCB0byBkZXNlcmlhbGl6ZSBhIEpTT04gcmVwcmVzZW50YXRpb24gb2YgYW4gb2JqZWN0IGludG8gYW4NCiAgICAgKiB7QGxpbmsgIEF1dGhDcmVkZW50aWFsfS4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBqc29uIC0gSW5wdXQgY2FuIGJlIGVpdGhlciBPYmplY3Qgb3IgdGhlIHN0cmluZ2lmaWVkIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBvYmplY3QuDQogICAgICogV2hlbiBzdHJpbmcgaXMgcHJvdmlkZWQsIEpTT04ucGFyc2Ugd291bGQgYmUgY2FsbGVkIGZpcnN0Lg0KICAgICAqDQogICAgICogQHJldHVybnMgSWYgdGhlIEpTT04gaW5wdXQgZG9lcyBub3QgcmVwcmVzZW50IGFuIHtAbGluayAgQXV0aENyZWRlbnRpYWx9LCBudWxsIGlzIHJldHVybmVkLg0KICAgICAqLw0KICAgIHN0YXRpYyBmcm9tSlNPTihqc29uKSB7DQogICAgICAgIGNvbnN0IG9iaiA9IHR5cGVvZiBqc29uID09PSAnc3RyaW5nJyA/IEpTT04ucGFyc2UoanNvbikgOiBqc29uOw0KICAgICAgICBjb25zdCB7IHByb3ZpZGVySWQsIHNpZ25Jbk1ldGhvZCB9ID0gb2JqLCByZXN0ID0gX19yZXN0KG9iaiwgWyJwcm92aWRlcklkIiwgInNpZ25Jbk1ldGhvZCJdKTsNCiAgICAgICAgaWYgKCFwcm92aWRlcklkIHx8ICFzaWduSW5NZXRob2QpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IGNyZWQgPSBuZXcgT0F1dGhDcmVkZW50aWFsKHByb3ZpZGVySWQsIHNpZ25Jbk1ldGhvZCk7DQogICAgICAgIGNyZWQuaWRUb2tlbiA9IHJlc3QuaWRUb2tlbiB8fCB1bmRlZmluZWQ7DQogICAgICAgIGNyZWQuYWNjZXNzVG9rZW4gPSByZXN0LmFjY2Vzc1Rva2VuIHx8IHVuZGVmaW5lZDsNCiAgICAgICAgY3JlZC5zZWNyZXQgPSByZXN0LnNlY3JldDsNCiAgICAgICAgY3JlZC5ub25jZSA9IHJlc3Qubm9uY2U7DQogICAgICAgIGNyZWQucGVuZGluZ1Rva2VuID0gcmVzdC5wZW5kaW5nVG9rZW4gfHwgbnVsbDsNCiAgICAgICAgcmV0dXJuIGNyZWQ7DQogICAgfQ0KICAgIC8qKiBAaW50ZXJuYWwgKi8NCiAgICBfZ2V0SWRUb2tlblJlc3BvbnNlKGF1dGgpIHsNCiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHRoaXMuYnVpbGRSZXF1ZXN0KCk7DQogICAgICAgIHJldHVybiBzaWduSW5XaXRoSWRwKGF1dGgsIHJlcXVlc3QpOw0KICAgIH0NCiAgICAvKiogQGludGVybmFsICovDQogICAgX2xpbmtUb0lkVG9rZW4oYXV0aCwgaWRUb2tlbikgew0KICAgICAgICBjb25zdCByZXF1ZXN0ID0gdGhpcy5idWlsZFJlcXVlc3QoKTsNCiAgICAgICAgcmVxdWVzdC5pZFRva2VuID0gaWRUb2tlbjsNCiAgICAgICAgcmV0dXJuIHNpZ25JbldpdGhJZHAoYXV0aCwgcmVxdWVzdCk7DQogICAgfQ0KICAgIC8qKiBAaW50ZXJuYWwgKi8NCiAgICBfZ2V0UmVhdXRoZW50aWNhdGlvblJlc29sdmVyKGF1dGgpIHsNCiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHRoaXMuYnVpbGRSZXF1ZXN0KCk7DQogICAgICAgIHJlcXVlc3QuYXV0b0NyZWF0ZSA9IGZhbHNlOw0KICAgICAgICByZXR1cm4gc2lnbkluV2l0aElkcChhdXRoLCByZXF1ZXN0KTsNCiAgICB9DQogICAgYnVpbGRSZXF1ZXN0KCkgew0KICAgICAgICBjb25zdCByZXF1ZXN0ID0gew0KICAgICAgICAgICAgcmVxdWVzdFVyaTogSURQX1JFUVVFU1RfVVJJJDEsDQogICAgICAgICAgICByZXR1cm5TZWN1cmVUb2tlbjogdHJ1ZQ0KICAgICAgICB9Ow0KICAgICAgICBpZiAodGhpcy5wZW5kaW5nVG9rZW4pIHsNCiAgICAgICAgICAgIHJlcXVlc3QucGVuZGluZ1Rva2VuID0gdGhpcy5wZW5kaW5nVG9rZW47DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBjb25zdCBwb3N0Qm9keSA9IHt9Ow0KICAgICAgICAgICAgaWYgKHRoaXMuaWRUb2tlbikgew0KICAgICAgICAgICAgICAgIHBvc3RCb2R5WydpZF90b2tlbiddID0gdGhpcy5pZFRva2VuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHRoaXMuYWNjZXNzVG9rZW4pIHsNCiAgICAgICAgICAgICAgICBwb3N0Qm9keVsnYWNjZXNzX3Rva2VuJ10gPSB0aGlzLmFjY2Vzc1Rva2VuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHRoaXMuc2VjcmV0KSB7DQogICAgICAgICAgICAgICAgcG9zdEJvZHlbJ29hdXRoX3Rva2VuX3NlY3JldCddID0gdGhpcy5zZWNyZXQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBwb3N0Qm9keVsncHJvdmlkZXJJZCddID0gdGhpcy5wcm92aWRlcklkOw0KICAgICAgICAgICAgaWYgKHRoaXMubm9uY2UgJiYgIXRoaXMucGVuZGluZ1Rva2VuKSB7DQogICAgICAgICAgICAgICAgcG9zdEJvZHlbJ25vbmNlJ10gPSB0aGlzLm5vbmNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmVxdWVzdC5wb3N0Qm9keSA9IHF1ZXJ5c3RyaW5nJDEocG9zdEJvZHkpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiByZXF1ZXN0Ow0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogTWFwcyB0aGUgbW9kZSBzdHJpbmcgaW4gYWN0aW9uIGNvZGUgVVJMIHRvIEFjdGlvbiBDb2RlIEluZm8gb3BlcmF0aW9uLg0KICoNCiAqIEBwYXJhbSBtb2RlDQogKi8NCmZ1bmN0aW9uIHBhcnNlTW9kZShtb2RlKSB7DQogICAgc3dpdGNoIChtb2RlKSB7DQogICAgICAgIGNhc2UgJ3JlY292ZXJFbWFpbCc6DQogICAgICAgICAgICByZXR1cm4gIlJFQ09WRVJfRU1BSUwiIC8qIEFjdGlvbkNvZGVPcGVyYXRpb24uUkVDT1ZFUl9FTUFJTCAqLzsNCiAgICAgICAgY2FzZSAncmVzZXRQYXNzd29yZCc6DQogICAgICAgICAgICByZXR1cm4gIlBBU1NXT1JEX1JFU0VUIiAvKiBBY3Rpb25Db2RlT3BlcmF0aW9uLlBBU1NXT1JEX1JFU0VUICovOw0KICAgICAgICBjYXNlICdzaWduSW4nOg0KICAgICAgICAgICAgcmV0dXJuICJFTUFJTF9TSUdOSU4iIC8qIEFjdGlvbkNvZGVPcGVyYXRpb24uRU1BSUxfU0lHTklOICovOw0KICAgICAgICBjYXNlICd2ZXJpZnlFbWFpbCc6DQogICAgICAgICAgICByZXR1cm4gIlZFUklGWV9FTUFJTCIgLyogQWN0aW9uQ29kZU9wZXJhdGlvbi5WRVJJRllfRU1BSUwgKi87DQogICAgICAgIGNhc2UgJ3ZlcmlmeUFuZENoYW5nZUVtYWlsJzoNCiAgICAgICAgICAgIHJldHVybiAiVkVSSUZZX0FORF9DSEFOR0VfRU1BSUwiIC8qIEFjdGlvbkNvZGVPcGVyYXRpb24uVkVSSUZZX0FORF9DSEFOR0VfRU1BSUwgKi87DQogICAgICAgIGNhc2UgJ3JldmVydFNlY29uZEZhY3RvckFkZGl0aW9uJzoNCiAgICAgICAgICAgIHJldHVybiAiUkVWRVJUX1NFQ09ORF9GQUNUT1JfQURESVRJT04iIC8qIEFjdGlvbkNvZGVPcGVyYXRpb24uUkVWRVJUX1NFQ09ORF9GQUNUT1JfQURESVRJT04gKi87DQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQp9DQovKioNCiAqIEhlbHBlciB0byBwYXJzZSBGREwgbGlua3MNCiAqDQogKiBAcGFyYW0gdXJsDQogKi8NCmZ1bmN0aW9uIHBhcnNlRGVlcExpbmsodXJsKSB7DQogICAgY29uc3QgbGluayA9IHF1ZXJ5c3RyaW5nRGVjb2RlKGV4dHJhY3RRdWVyeXN0cmluZyh1cmwpKVsnbGluayddOw0KICAgIC8vIERvdWJsZSBsaW5rIGNhc2UgKGF1dG9tYXRpYyByZWRpcmVjdCkuDQogICAgY29uc3QgZG91YmxlRGVlcExpbmsgPSBsaW5rDQogICAgICAgID8gcXVlcnlzdHJpbmdEZWNvZGUoZXh0cmFjdFF1ZXJ5c3RyaW5nKGxpbmspKVsnZGVlcF9saW5rX2lkJ10NCiAgICAgICAgOiBudWxsOw0KICAgIC8vIGlPUyBjdXN0b20gc2NoZW1lIGxpbmtzLg0KICAgIGNvbnN0IGlPU0RlZXBMaW5rID0gcXVlcnlzdHJpbmdEZWNvZGUoZXh0cmFjdFF1ZXJ5c3RyaW5nKHVybCkpWydkZWVwX2xpbmtfaWQnXTsNCiAgICBjb25zdCBpT1NEb3VibGVEZWVwTGluayA9IGlPU0RlZXBMaW5rDQogICAgICAgID8gcXVlcnlzdHJpbmdEZWNvZGUoZXh0cmFjdFF1ZXJ5c3RyaW5nKGlPU0RlZXBMaW5rKSlbJ2xpbmsnXQ0KICAgICAgICA6IG51bGw7DQogICAgcmV0dXJuIGlPU0RvdWJsZURlZXBMaW5rIHx8IGlPU0RlZXBMaW5rIHx8IGRvdWJsZURlZXBMaW5rIHx8IGxpbmsgfHwgdXJsOw0KfQ0KLyoqDQogKiBBIHV0aWxpdHkgY2xhc3MgdG8gcGFyc2UgZW1haWwgYWN0aW9uIFVSTHMgc3VjaCBhcyBwYXNzd29yZCByZXNldCwgZW1haWwgdmVyaWZpY2F0aW9uLA0KICogZW1haWwgbGluayBzaWduIGluLCBldGMuDQogKg0KICogQHB1YmxpYw0KICovDQpjbGFzcyBBY3Rpb25Db2RlVVJMIHsNCiAgICAvKioNCiAgICAgKiBAcGFyYW0gYWN0aW9uTGluayAtIFRoZSBsaW5rIGZyb20gd2hpY2ggdG8gZXh0cmFjdCB0aGUgVVJMLg0KICAgICAqIEByZXR1cm5zIFRoZSB7QGxpbmsgQWN0aW9uQ29kZVVSTH0gb2JqZWN0LCBvciBudWxsIGlmIHRoZSBsaW5rIGlzIGludmFsaWQuDQogICAgICoNCiAgICAgKiBAaW50ZXJuYWwNCiAgICAgKi8NCiAgICBjb25zdHJ1Y3RvcihhY3Rpb25MaW5rKSB7DQogICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mOw0KICAgICAgICBjb25zdCBzZWFyY2hQYXJhbXMgPSBxdWVyeXN0cmluZ0RlY29kZShleHRyYWN0UXVlcnlzdHJpbmcoYWN0aW9uTGluaykpOw0KICAgICAgICBjb25zdCBhcGlLZXkgPSAoX2EgPSBzZWFyY2hQYXJhbXNbImFwaUtleSIgLyogUXVlcnlGaWVsZC5BUElfS0VZICovXSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogbnVsbDsNCiAgICAgICAgY29uc3QgY29kZSA9IChfYiA9IHNlYXJjaFBhcmFtc1sib29iQ29kZSIgLyogUXVlcnlGaWVsZC5DT0RFICovXSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogbnVsbDsNCiAgICAgICAgY29uc3Qgb3BlcmF0aW9uID0gcGFyc2VNb2RlKChfYyA9IHNlYXJjaFBhcmFtc1sibW9kZSIgLyogUXVlcnlGaWVsZC5NT0RFICovXSkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogbnVsbCk7DQogICAgICAgIC8vIFZhbGlkYXRlIEFQSSBrZXksIGNvZGUgYW5kIG1vZGUuDQogICAgICAgIF9hc3NlcnQoYXBpS2V5ICYmIGNvZGUgJiYgb3BlcmF0aW9uLCAiYXJndW1lbnQtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pOw0KICAgICAgICB0aGlzLmFwaUtleSA9IGFwaUtleTsNCiAgICAgICAgdGhpcy5vcGVyYXRpb24gPSBvcGVyYXRpb247DQogICAgICAgIHRoaXMuY29kZSA9IGNvZGU7DQogICAgICAgIHRoaXMuY29udGludWVVcmwgPSAoX2QgPSBzZWFyY2hQYXJhbXNbImNvbnRpbnVlVXJsIiAvKiBRdWVyeUZpZWxkLkNPTlRJTlVFX1VSTCAqL10pICE9PSBudWxsICYmIF9kICE9PSB2b2lkIDAgPyBfZCA6IG51bGw7DQogICAgICAgIHRoaXMubGFuZ3VhZ2VDb2RlID0gKF9lID0gc2VhcmNoUGFyYW1zWyJsYW5ndWFnZUNvZGUiIC8qIFF1ZXJ5RmllbGQuTEFOR1VBR0VfQ09ERSAqL10pICE9PSBudWxsICYmIF9lICE9PSB2b2lkIDAgPyBfZSA6IG51bGw7DQogICAgICAgIHRoaXMudGVuYW50SWQgPSAoX2YgPSBzZWFyY2hQYXJhbXNbInRlbmFudElkIiAvKiBRdWVyeUZpZWxkLlRFTkFOVF9JRCAqL10pICE9PSBudWxsICYmIF9mICE9PSB2b2lkIDAgPyBfZiA6IG51bGw7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFBhcnNlcyB0aGUgZW1haWwgYWN0aW9uIGxpbmsgc3RyaW5nIGFuZCByZXR1cm5zIGFuIHtAbGluayBBY3Rpb25Db2RlVVJMfSBpZiB0aGUgbGluayBpcyB2YWxpZCwNCiAgICAgKiBvdGhlcndpc2UgcmV0dXJucyBudWxsLg0KICAgICAqDQogICAgICogQHBhcmFtIGxpbmsgIC0gVGhlIGVtYWlsIGFjdGlvbiBsaW5rIHN0cmluZy4NCiAgICAgKiBAcmV0dXJucyBUaGUge0BsaW5rIEFjdGlvbkNvZGVVUkx9IG9iamVjdCwgb3IgbnVsbCBpZiB0aGUgbGluayBpcyBpbnZhbGlkLg0KICAgICAqDQogICAgICogQHB1YmxpYw0KICAgICAqLw0KICAgIHN0YXRpYyBwYXJzZUxpbmsobGluaykgew0KICAgICAgICBjb25zdCBhY3Rpb25MaW5rID0gcGFyc2VEZWVwTGluayhsaW5rKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgQWN0aW9uQ29kZVVSTChhY3Rpb25MaW5rKTsNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAoX2EpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgfQ0KfQ0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogUHJvdmlkZXIgZm9yIGdlbmVyYXRpbmcge0BsaW5rIEVtYWlsQXV0aENyZWRlbnRpYWx9Lg0KICoNCiAqIEBwdWJsaWMNCiAqLw0KY2xhc3MgRW1haWxBdXRoUHJvdmlkZXIgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICAvKioNCiAgICAgICAgICogQWx3YXlzIHNldCB0byB7QGxpbmsgUHJvdmlkZXJJZH0uUEFTU1dPUkQsIGV2ZW4gZm9yIGVtYWlsIGxpbmsuDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnByb3ZpZGVySWQgPSBFbWFpbEF1dGhQcm92aWRlci5QUk9WSURFUl9JRDsNCiAgICB9DQogICAgLyoqDQogICAgICogSW5pdGlhbGl6ZSBhbiB7QGxpbmsgQXV0aENyZWRlbnRpYWx9IHVzaW5nIGFuIGVtYWlsIGFuZCBwYXNzd29yZC4NCiAgICAgKg0KICAgICAqIEBleGFtcGxlDQogICAgICogYGBgamF2YXNjcmlwdA0KICAgICAqIGNvbnN0IGF1dGhDcmVkZW50aWFsID0gRW1haWxBdXRoUHJvdmlkZXIuY3JlZGVudGlhbChlbWFpbCwgcGFzc3dvcmQpOw0KICAgICAqIGNvbnN0IHVzZXJDcmVkZW50aWFsID0gYXdhaXQgc2lnbkluV2l0aENyZWRlbnRpYWwoYXV0aCwgYXV0aENyZWRlbnRpYWwpOw0KICAgICAqIGBgYA0KICAgICAqDQogICAgICogQGV4YW1wbGUNCiAgICAgKiBgYGBqYXZhc2NyaXB0DQogICAgICogY29uc3QgdXNlckNyZWRlbnRpYWwgPSBhd2FpdCBzaWduSW5XaXRoRW1haWxBbmRQYXNzd29yZChhdXRoLCBlbWFpbCwgcGFzc3dvcmQpOw0KICAgICAqIGBgYA0KICAgICAqDQogICAgICogQHBhcmFtIGVtYWlsIC0gRW1haWwgYWRkcmVzcy4NCiAgICAgKiBAcGFyYW0gcGFzc3dvcmQgLSBVc2VyIGFjY291bnQgcGFzc3dvcmQuDQogICAgICogQHJldHVybnMgVGhlIGF1dGggcHJvdmlkZXIgY3JlZGVudGlhbC4NCiAgICAgKi8NCiAgICBzdGF0aWMgY3JlZGVudGlhbChlbWFpbCwgcGFzc3dvcmQpIHsNCiAgICAgICAgcmV0dXJuIEVtYWlsQXV0aENyZWRlbnRpYWwuX2Zyb21FbWFpbEFuZFBhc3N3b3JkKGVtYWlsLCBwYXNzd29yZCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemUgYW4ge0BsaW5rIEF1dGhDcmVkZW50aWFsfSB1c2luZyBhbiBlbWFpbCBhbmQgYW4gZW1haWwgbGluayBhZnRlciBhIHNpZ24gaW4gd2l0aA0KICAgICAqIGVtYWlsIGxpbmsgb3BlcmF0aW9uLg0KICAgICAqDQogICAgICogQGV4YW1wbGUNCiAgICAgKiBgYGBqYXZhc2NyaXB0DQogICAgICogY29uc3QgYXV0aENyZWRlbnRpYWwgPSBFbWFpbEF1dGhQcm92aWRlci5jcmVkZW50aWFsV2l0aExpbmsoYXV0aCwgZW1haWwsIGVtYWlsTGluayk7DQogICAgICogY29uc3QgdXNlckNyZWRlbnRpYWwgPSBhd2FpdCBzaWduSW5XaXRoQ3JlZGVudGlhbChhdXRoLCBhdXRoQ3JlZGVudGlhbCk7DQogICAgICogYGBgDQogICAgICoNCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqIGBgYGphdmFzY3JpcHQNCiAgICAgKiBhd2FpdCBzZW5kU2lnbkluTGlua1RvRW1haWwoYXV0aCwgZW1haWwpOw0KICAgICAqIC8vIE9idGFpbiBlbWFpbExpbmsgZnJvbSB1c2VyLg0KICAgICAqIGNvbnN0IHVzZXJDcmVkZW50aWFsID0gYXdhaXQgc2lnbkluV2l0aEVtYWlsTGluayhhdXRoLCBlbWFpbCwgZW1haWxMaW5rKTsNCiAgICAgKiBgYGANCiAgICAgKg0KICAgICAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZSB1c2VkIHRvIHZlcmlmeSB0aGUgbGluay4NCiAgICAgKiBAcGFyYW0gZW1haWwgLSBFbWFpbCBhZGRyZXNzLg0KICAgICAqIEBwYXJhbSBlbWFpbExpbmsgLSBTaWduLWluIGVtYWlsIGxpbmsuDQogICAgICogQHJldHVybnMgLSBUaGUgYXV0aCBwcm92aWRlciBjcmVkZW50aWFsLg0KICAgICAqLw0KICAgIHN0YXRpYyBjcmVkZW50aWFsV2l0aExpbmsoZW1haWwsIGVtYWlsTGluaykgew0KICAgICAgICBjb25zdCBhY3Rpb25Db2RlVXJsID0gQWN0aW9uQ29kZVVSTC5wYXJzZUxpbmsoZW1haWxMaW5rKTsNCiAgICAgICAgX2Fzc2VydChhY3Rpb25Db2RlVXJsLCAiYXJndW1lbnQtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pOw0KICAgICAgICByZXR1cm4gRW1haWxBdXRoQ3JlZGVudGlhbC5fZnJvbUVtYWlsQW5kQ29kZShlbWFpbCwgYWN0aW9uQ29kZVVybC5jb2RlLCBhY3Rpb25Db2RlVXJsLnRlbmFudElkKTsNCiAgICB9DQp9DQovKioNCiAqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFByb3ZpZGVySWR9LlBBU1NXT1JELCBldmVuIGZvciBlbWFpbCBsaW5rLg0KICovDQpFbWFpbEF1dGhQcm92aWRlci5QUk9WSURFUl9JRCA9ICJwYXNzd29yZCIgLyogUHJvdmlkZXJJZC5QQVNTV09SRCAqLzsNCi8qKg0KICogQWx3YXlzIHNldCB0byB7QGxpbmsgU2lnbkluTWV0aG9kfS5FTUFJTF9QQVNTV09SRC4NCiAqLw0KRW1haWxBdXRoUHJvdmlkZXIuRU1BSUxfUEFTU1dPUkRfU0lHTl9JTl9NRVRIT0QgPSAicGFzc3dvcmQiIC8qIFNpZ25Jbk1ldGhvZC5FTUFJTF9QQVNTV09SRCAqLzsNCi8qKg0KICogQWx3YXlzIHNldCB0byB7QGxpbmsgU2lnbkluTWV0aG9kfS5FTUFJTF9MSU5LLg0KICovDQpFbWFpbEF1dGhQcm92aWRlci5FTUFJTF9MSU5LX1NJR05fSU5fTUVUSE9EID0gImVtYWlsTGluayIgLyogU2lnbkluTWV0aG9kLkVNQUlMX0xJTksgKi87CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIFRoZSBiYXNlIGNsYXNzIGZvciBhbGwgRmVkZXJhdGVkIHByb3ZpZGVycyAoT0F1dGggKGluY2x1ZGluZyBPSURDKSwgU0FNTCkuDQogKg0KICogVGhpcyBjbGFzcyBpcyBub3QgbWVhbnQgdG8gYmUgaW5zdGFudGlhdGVkIGRpcmVjdGx5Lg0KICoNCiAqIEBwdWJsaWMNCiAqLw0KY2xhc3MgRmVkZXJhdGVkQXV0aFByb3ZpZGVyIHsNCiAgICAvKioNCiAgICAgKiBDb25zdHJ1Y3RvciBmb3IgZ2VuZXJpYyBPQXV0aCBwcm92aWRlcnMuDQogICAgICoNCiAgICAgKiBAcGFyYW0gcHJvdmlkZXJJZCAtIFByb3ZpZGVyIGZvciB3aGljaCBjcmVkZW50aWFscyBzaG91bGQgYmUgZ2VuZXJhdGVkLg0KICAgICAqLw0KICAgIGNvbnN0cnVjdG9yKHByb3ZpZGVySWQpIHsNCiAgICAgICAgdGhpcy5wcm92aWRlcklkID0gcHJvdmlkZXJJZDsNCiAgICAgICAgLyoqIEBpbnRlcm5hbCAqLw0KICAgICAgICB0aGlzLmRlZmF1bHRMYW5ndWFnZUNvZGUgPSBudWxsOw0KICAgICAgICAvKiogQGludGVybmFsICovDQogICAgICAgIHRoaXMuY3VzdG9tUGFyYW1ldGVycyA9IHt9Ow0KICAgIH0NCiAgICAvKioNCiAgICAgKiBTZXQgdGhlIGxhbmd1YWdlIGdvZGUuDQogICAgICoNCiAgICAgKiBAcGFyYW0gbGFuZ3VhZ2VDb2RlIC0gbGFuZ3VhZ2UgY29kZQ0KICAgICAqLw0KICAgIHNldERlZmF1bHRMYW5ndWFnZShsYW5ndWFnZUNvZGUpIHsNCiAgICAgICAgdGhpcy5kZWZhdWx0TGFuZ3VhZ2VDb2RlID0gbGFuZ3VhZ2VDb2RlOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBTZXRzIHRoZSBPQXV0aCBjdXN0b20gcGFyYW1ldGVycyB0byBwYXNzIGluIGFuIE9BdXRoIHJlcXVlc3QgZm9yIHBvcHVwIGFuZCByZWRpcmVjdCBzaWduLWluDQogICAgICogb3BlcmF0aW9ucy4NCiAgICAgKg0KICAgICAqIEByZW1hcmtzDQogICAgICogRm9yIGEgZGV0YWlsZWQgbGlzdCwgY2hlY2sgdGhlIHJlc2VydmVkIHJlcXVpcmVkIE9BdXRoIDIuMCBwYXJhbWV0ZXJzIHN1Y2ggYXMgYGNsaWVudF9pZGAsDQogICAgICogYHJlZGlyZWN0X3VyaWAsIGBzY29wZWAsIGByZXNwb25zZV90eXBlYCwgYW5kIGBzdGF0ZWAgYXJlIG5vdCBhbGxvd2VkIGFuZCB3aWxsIGJlIGlnbm9yZWQuDQogICAgICoNCiAgICAgKiBAcGFyYW0gY3VzdG9tT0F1dGhQYXJhbWV0ZXJzIC0gVGhlIGN1c3RvbSBPQXV0aCBwYXJhbWV0ZXJzIHRvIHBhc3MgaW4gdGhlIE9BdXRoIHJlcXVlc3QuDQogICAgICovDQogICAgc2V0Q3VzdG9tUGFyYW1ldGVycyhjdXN0b21PQXV0aFBhcmFtZXRlcnMpIHsNCiAgICAgICAgdGhpcy5jdXN0b21QYXJhbWV0ZXJzID0gY3VzdG9tT0F1dGhQYXJhbWV0ZXJzOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogICAgLyoqDQogICAgICogUmV0cmlldmUgdGhlIGN1cnJlbnQgbGlzdCBvZiB7QGxpbmsgQ3VzdG9tUGFyYW1ldGVyc30uDQogICAgICovDQogICAgZ2V0Q3VzdG9tUGFyYW1ldGVycygpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuY3VzdG9tUGFyYW1ldGVyczsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIENvbW1vbiBjb2RlIHRvIGFsbCBPQXV0aCBwcm92aWRlcnMuIFRoaXMgaXMgc2VwYXJhdGUgZnJvbSB0aGUNCiAqIHtAbGluayBPQXV0aFByb3ZpZGVyfSBzbyB0aGF0IGNoaWxkIHByb3ZpZGVycyAobGlrZQ0KICoge0BsaW5rIEdvb2dsZUF1dGhQcm92aWRlcn0pIGRvbid0IGluaGVyaXQgdGhlIGBjcmVkZW50aWFsYCBpbnN0YW5jZSBtZXRob2QuDQogKiBJbnN0ZWFkLCB0aGV5IHJlbHkgb24gYSBzdGF0aWMgYGNyZWRlbnRpYWxgIG1ldGhvZC4NCiAqLw0KY2xhc3MgQmFzZU9BdXRoUHJvdmlkZXIgZXh0ZW5kcyBGZWRlcmF0ZWRBdXRoUHJvdmlkZXIgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICBzdXBlciguLi5hcmd1bWVudHMpOw0KICAgICAgICAvKiogQGludGVybmFsICovDQogICAgICAgIHRoaXMuc2NvcGVzID0gW107DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEFkZCBhbiBPQXV0aCBzY29wZSB0byB0aGUgY3JlZGVudGlhbC4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBzY29wZSAtIFByb3ZpZGVyIE9BdXRoIHNjb3BlIHRvIGFkZC4NCiAgICAgKi8NCiAgICBhZGRTY29wZShzY29wZSkgew0KICAgICAgICAvLyBJZiBub3QgYWxyZWFkeSBhZGRlZCwgYWRkIHNjb3BlIHRvIGxpc3QuDQogICAgICAgIGlmICghdGhpcy5zY29wZXMuaW5jbHVkZXMoc2NvcGUpKSB7DQogICAgICAgICAgICB0aGlzLnNjb3Blcy5wdXNoKHNjb3BlKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQogICAgLyoqDQogICAgICogUmV0cmlldmUgdGhlIGN1cnJlbnQgbGlzdCBvZiBPQXV0aCBzY29wZXMuDQogICAgICovDQogICAgZ2V0U2NvcGVzKCkgew0KICAgICAgICByZXR1cm4gWy4uLnRoaXMuc2NvcGVzXTsNCiAgICB9DQp9DQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBQcm92aWRlciBmb3IgZ2VuZXJhdGluZyBhbiB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmb3Ige0BsaW5rIFByb3ZpZGVySWR9LkZBQ0VCT09LLg0KICoNCiAqIEBleGFtcGxlDQogKiBgYGBqYXZhc2NyaXB0DQogKiAvLyBTaWduIGluIHVzaW5nIGEgcmVkaXJlY3QuDQogKiBjb25zdCBwcm92aWRlciA9IG5ldyBGYWNlYm9va0F1dGhQcm92aWRlcigpOw0KICogLy8gU3RhcnQgYSBzaWduIGluIHByb2Nlc3MgZm9yIGFuIHVuYXV0aGVudGljYXRlZCB1c2VyLg0KICogcHJvdmlkZXIuYWRkU2NvcGUoJ3VzZXJfYmlydGhkYXknKTsNCiAqIGF3YWl0IHNpZ25JbldpdGhSZWRpcmVjdChhdXRoLCBwcm92aWRlcik7DQogKiAvLyBUaGlzIHdpbGwgdHJpZ2dlciBhIGZ1bGwgcGFnZSByZWRpcmVjdCBhd2F5IGZyb20geW91ciBhcHANCiAqDQogKiAvLyBBZnRlciByZXR1cm5pbmcgZnJvbSB0aGUgcmVkaXJlY3Qgd2hlbiB5b3VyIGFwcCBpbml0aWFsaXplcyB5b3UgY2FuIG9idGFpbiB0aGUgcmVzdWx0DQogKiBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRSZWRpcmVjdFJlc3VsdChhdXRoKTsNCiAqIGlmIChyZXN1bHQpIHsNCiAqICAgLy8gVGhpcyBpcyB0aGUgc2lnbmVkLWluIHVzZXINCiAqICAgY29uc3QgdXNlciA9IHJlc3VsdC51c2VyOw0KICogICAvLyBUaGlzIGdpdmVzIHlvdSBhIEZhY2Vib29rIEFjY2VzcyBUb2tlbi4NCiAqICAgY29uc3QgY3JlZGVudGlhbCA9IEZhY2Vib29rQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tUmVzdWx0KHJlc3VsdCk7DQogKiAgIGNvbnN0IHRva2VuID0gY3JlZGVudGlhbC5hY2Nlc3NUb2tlbjsNCiAqIH0NCiAqIGBgYA0KICoNCiAqIEBleGFtcGxlDQogKiBgYGBqYXZhc2NyaXB0DQogKiAvLyBTaWduIGluIHVzaW5nIGEgcG9wdXAuDQogKiBjb25zdCBwcm92aWRlciA9IG5ldyBGYWNlYm9va0F1dGhQcm92aWRlcigpOw0KICogcHJvdmlkZXIuYWRkU2NvcGUoJ3VzZXJfYmlydGhkYXknKTsNCiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpZ25JbldpdGhQb3B1cChhdXRoLCBwcm92aWRlcik7DQogKg0KICogLy8gVGhlIHNpZ25lZC1pbiB1c2VyIGluZm8uDQogKiBjb25zdCB1c2VyID0gcmVzdWx0LnVzZXI7DQogKiAvLyBUaGlzIGdpdmVzIHlvdSBhIEZhY2Vib29rIEFjY2VzcyBUb2tlbi4NCiAqIGNvbnN0IGNyZWRlbnRpYWwgPSBGYWNlYm9va0F1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVJlc3VsdChyZXN1bHQpOw0KICogY29uc3QgdG9rZW4gPSBjcmVkZW50aWFsLmFjY2Vzc1Rva2VuOw0KICogYGBgDQogKg0KICogQHB1YmxpYw0KICovDQpjbGFzcyBGYWNlYm9va0F1dGhQcm92aWRlciBleHRlbmRzIEJhc2VPQXV0aFByb3ZpZGVyIHsNCiAgICBjb25zdHJ1Y3RvcigpIHsNCiAgICAgICAgc3VwZXIoImZhY2Vib29rLmNvbSIgLyogUHJvdmlkZXJJZC5GQUNFQk9PSyAqLyk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBjcmVkZW50aWFsIGZvciBGYWNlYm9vay4NCiAgICAgKg0KICAgICAqIEBleGFtcGxlDQogICAgICogYGBgamF2YXNjcmlwdA0KICAgICAqIC8vIGBldmVudGAgZnJvbSB0aGUgRmFjZWJvb2sgYXV0aC5hdXRoUmVzcG9uc2VDaGFuZ2UgY2FsbGJhY2suDQogICAgICogY29uc3QgY3JlZGVudGlhbCA9IEZhY2Vib29rQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwoZXZlbnQuYXV0aFJlc3BvbnNlLmFjY2Vzc1Rva2VuKTsNCiAgICAgKiBjb25zdCByZXN1bHQgPSBhd2FpdCBzaWduSW5XaXRoQ3JlZGVudGlhbChjcmVkZW50aWFsKTsNCiAgICAgKiBgYGANCiAgICAgKg0KICAgICAqIEBwYXJhbSBhY2Nlc3NUb2tlbiAtIEZhY2Vib29rIGFjY2VzcyB0b2tlbi4NCiAgICAgKi8NCiAgICBzdGF0aWMgY3JlZGVudGlhbChhY2Nlc3NUb2tlbikgew0KICAgICAgICByZXR1cm4gT0F1dGhDcmVkZW50aWFsLl9mcm9tUGFyYW1zKHsNCiAgICAgICAgICAgIHByb3ZpZGVySWQ6IEZhY2Vib29rQXV0aFByb3ZpZGVyLlBST1ZJREVSX0lELA0KICAgICAgICAgICAgc2lnbkluTWV0aG9kOiBGYWNlYm9va0F1dGhQcm92aWRlci5GQUNFQk9PS19TSUdOX0lOX01FVEhPRCwNCiAgICAgICAgICAgIGFjY2Vzc1Rva2VuDQogICAgICAgIH0pOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBVc2VkIHRvIGV4dHJhY3QgdGhlIHVuZGVybHlpbmcge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZnJvbSBhIHtAbGluayBVc2VyQ3JlZGVudGlhbH0uDQogICAgICoNCiAgICAgKiBAcGFyYW0gdXNlckNyZWRlbnRpYWwgLSBUaGUgdXNlciBjcmVkZW50aWFsLg0KICAgICAqLw0KICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbVJlc3VsdCh1c2VyQ3JlZGVudGlhbCkgew0KICAgICAgICByZXR1cm4gRmFjZWJvb2tBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QodXNlckNyZWRlbnRpYWwpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBVc2VkIHRvIGV4dHJhY3QgdGhlIHVuZGVybHlpbmcge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZnJvbSBhIHtAbGluayBBdXRoRXJyb3J9IHdoaWNoIHdhcw0KICAgICAqIHRocm93biBkdXJpbmcgYSBzaWduLWluLCBsaW5rLCBvciByZWF1dGhlbnRpY2F0ZSBvcGVyYXRpb24uDQogICAgICoNCiAgICAgKiBAcGFyYW0gdXNlckNyZWRlbnRpYWwgLSBUaGUgdXNlciBjcmVkZW50aWFsLg0KICAgICAqLw0KICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbUVycm9yKGVycm9yKSB7DQogICAgICAgIHJldHVybiBGYWNlYm9va0F1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCgoZXJyb3IuY3VzdG9tRGF0YSB8fCB7fSkpOw0KICAgIH0NCiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QoeyBfdG9rZW5SZXNwb25zZTogdG9rZW5SZXNwb25zZSB9KSB7DQogICAgICAgIGlmICghdG9rZW5SZXNwb25zZSB8fCAhKCdvYXV0aEFjY2Vzc1Rva2VuJyBpbiB0b2tlblJlc3BvbnNlKSkgew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCF0b2tlblJlc3BvbnNlLm9hdXRoQWNjZXNzVG9rZW4pIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICByZXR1cm4gRmFjZWJvb2tBdXRoUHJvdmlkZXIuY3JlZGVudGlhbCh0b2tlblJlc3BvbnNlLm9hdXRoQWNjZXNzVG9rZW4pOw0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChfYSkgew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICB9DQp9DQovKiogQWx3YXlzIHNldCB0byB7QGxpbmsgU2lnbkluTWV0aG9kfS5GQUNFQk9PSy4gKi8NCkZhY2Vib29rQXV0aFByb3ZpZGVyLkZBQ0VCT09LX1NJR05fSU5fTUVUSE9EID0gImZhY2Vib29rLmNvbSIgLyogU2lnbkluTWV0aG9kLkZBQ0VCT09LICovOw0KLyoqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFByb3ZpZGVySWR9LkZBQ0VCT09LLiAqLw0KRmFjZWJvb2tBdXRoUHJvdmlkZXIuUFJPVklERVJfSUQgPSAiZmFjZWJvb2suY29tIiAvKiBQcm92aWRlcklkLkZBQ0VCT09LICovOwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBQcm92aWRlciBmb3IgZ2VuZXJhdGluZyBhbiBhbiB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmb3Ige0BsaW5rIFByb3ZpZGVySWR9LkdPT0dMRS4NCiAqDQogKiBAZXhhbXBsZQ0KICogYGBgamF2YXNjcmlwdA0KICogLy8gU2lnbiBpbiB1c2luZyBhIHJlZGlyZWN0Lg0KICogY29uc3QgcHJvdmlkZXIgPSBuZXcgR29vZ2xlQXV0aFByb3ZpZGVyKCk7DQogKiAvLyBTdGFydCBhIHNpZ24gaW4gcHJvY2VzcyBmb3IgYW4gdW5hdXRoZW50aWNhdGVkIHVzZXIuDQogKiBwcm92aWRlci5hZGRTY29wZSgncHJvZmlsZScpOw0KICogcHJvdmlkZXIuYWRkU2NvcGUoJ2VtYWlsJyk7DQogKiBhd2FpdCBzaWduSW5XaXRoUmVkaXJlY3QoYXV0aCwgcHJvdmlkZXIpOw0KICogLy8gVGhpcyB3aWxsIHRyaWdnZXIgYSBmdWxsIHBhZ2UgcmVkaXJlY3QgYXdheSBmcm9tIHlvdXIgYXBwDQogKg0KICogLy8gQWZ0ZXIgcmV0dXJuaW5nIGZyb20gdGhlIHJlZGlyZWN0IHdoZW4geW91ciBhcHAgaW5pdGlhbGl6ZXMgeW91IGNhbiBvYnRhaW4gdGhlIHJlc3VsdA0KICogY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0UmVkaXJlY3RSZXN1bHQoYXV0aCk7DQogKiBpZiAocmVzdWx0KSB7DQogKiAgIC8vIFRoaXMgaXMgdGhlIHNpZ25lZC1pbiB1c2VyDQogKiAgIGNvbnN0IHVzZXIgPSByZXN1bHQudXNlcjsNCiAqICAgLy8gVGhpcyBnaXZlcyB5b3UgYSBHb29nbGUgQWNjZXNzIFRva2VuLg0KICogICBjb25zdCBjcmVkZW50aWFsID0gR29vZ2xlQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tUmVzdWx0KHJlc3VsdCk7DQogKiAgIGNvbnN0IHRva2VuID0gY3JlZGVudGlhbC5hY2Nlc3NUb2tlbjsNCiAqIH0NCiAqIGBgYA0KICoNCiAqIEBleGFtcGxlDQogKiBgYGBqYXZhc2NyaXB0DQogKiAvLyBTaWduIGluIHVzaW5nIGEgcG9wdXAuDQogKiBjb25zdCBwcm92aWRlciA9IG5ldyBHb29nbGVBdXRoUHJvdmlkZXIoKTsNCiAqIHByb3ZpZGVyLmFkZFNjb3BlKCdwcm9maWxlJyk7DQogKiBwcm92aWRlci5hZGRTY29wZSgnZW1haWwnKTsNCiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpZ25JbldpdGhQb3B1cChhdXRoLCBwcm92aWRlcik7DQogKg0KICogLy8gVGhlIHNpZ25lZC1pbiB1c2VyIGluZm8uDQogKiBjb25zdCB1c2VyID0gcmVzdWx0LnVzZXI7DQogKiAvLyBUaGlzIGdpdmVzIHlvdSBhIEdvb2dsZSBBY2Nlc3MgVG9rZW4uDQogKiBjb25zdCBjcmVkZW50aWFsID0gR29vZ2xlQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tUmVzdWx0KHJlc3VsdCk7DQogKiBjb25zdCB0b2tlbiA9IGNyZWRlbnRpYWwuYWNjZXNzVG9rZW47DQogKiBgYGANCiAqDQogKiBAcHVibGljDQogKi8NCmNsYXNzIEdvb2dsZUF1dGhQcm92aWRlciBleHRlbmRzIEJhc2VPQXV0aFByb3ZpZGVyIHsNCiAgICBjb25zdHJ1Y3RvcigpIHsNCiAgICAgICAgc3VwZXIoImdvb2dsZS5jb20iIC8qIFByb3ZpZGVySWQuR09PR0xFICovKTsNCiAgICAgICAgdGhpcy5hZGRTY29wZSgncHJvZmlsZScpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIGEgY3JlZGVudGlhbCBmb3IgR29vZ2xlLiBBdCBsZWFzdCBvbmUgb2YgSUQgdG9rZW4gYW5kIGFjY2VzcyB0b2tlbiBpcyByZXF1aXJlZC4NCiAgICAgKg0KICAgICAqIEBleGFtcGxlDQogICAgICogYGBgamF2YXNjcmlwdA0KICAgICAqIC8vIFxgZ29vZ2xlVXNlclxgIGZyb20gdGhlIG9uc3VjY2VzcyBHb29nbGUgU2lnbiBJbiBjYWxsYmFjay4NCiAgICAgKiBjb25zdCBjcmVkZW50aWFsID0gR29vZ2xlQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwoZ29vZ2xlVXNlci5nZXRBdXRoUmVzcG9uc2UoKS5pZF90b2tlbik7DQogICAgICogY29uc3QgcmVzdWx0ID0gYXdhaXQgc2lnbkluV2l0aENyZWRlbnRpYWwoY3JlZGVudGlhbCk7DQogICAgICogYGBgDQogICAgICoNCiAgICAgKiBAcGFyYW0gaWRUb2tlbiAtIEdvb2dsZSBJRCB0b2tlbi4NCiAgICAgKiBAcGFyYW0gYWNjZXNzVG9rZW4gLSBHb29nbGUgYWNjZXNzIHRva2VuLg0KICAgICAqLw0KICAgIHN0YXRpYyBjcmVkZW50aWFsKGlkVG9rZW4sIGFjY2Vzc1Rva2VuKSB7DQogICAgICAgIHJldHVybiBPQXV0aENyZWRlbnRpYWwuX2Zyb21QYXJhbXMoew0KICAgICAgICAgICAgcHJvdmlkZXJJZDogR29vZ2xlQXV0aFByb3ZpZGVyLlBST1ZJREVSX0lELA0KICAgICAgICAgICAgc2lnbkluTWV0aG9kOiBHb29nbGVBdXRoUHJvdmlkZXIuR09PR0xFX1NJR05fSU5fTUVUSE9ELA0KICAgICAgICAgICAgaWRUb2tlbiwNCiAgICAgICAgICAgIGFjY2Vzc1Rva2VuDQogICAgICAgIH0pOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBVc2VkIHRvIGV4dHJhY3QgdGhlIHVuZGVybHlpbmcge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZnJvbSBhIHtAbGluayBVc2VyQ3JlZGVudGlhbH0uDQogICAgICoNCiAgICAgKiBAcGFyYW0gdXNlckNyZWRlbnRpYWwgLSBUaGUgdXNlciBjcmVkZW50aWFsLg0KICAgICAqLw0KICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbVJlc3VsdCh1c2VyQ3JlZGVudGlhbCkgew0KICAgICAgICByZXR1cm4gR29vZ2xlQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KHVzZXJDcmVkZW50aWFsKTsNCiAgICB9DQogICAgLyoqDQogICAgICogVXNlZCB0byBleHRyYWN0IHRoZSB1bmRlcmx5aW5nIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSB7QGxpbmsgQXV0aEVycm9yfSB3aGljaCB3YXMNCiAgICAgKiB0aHJvd24gZHVyaW5nIGEgc2lnbi1pbiwgbGluaywgb3IgcmVhdXRoZW50aWNhdGUgb3BlcmF0aW9uLg0KICAgICAqDQogICAgICogQHBhcmFtIHVzZXJDcmVkZW50aWFsIC0gVGhlIHVzZXIgY3JlZGVudGlhbC4NCiAgICAgKi8NCiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21FcnJvcihlcnJvcikgew0KICAgICAgICByZXR1cm4gR29vZ2xlQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KChlcnJvci5jdXN0b21EYXRhIHx8IHt9KSk7DQogICAgfQ0KICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCh7IF90b2tlblJlc3BvbnNlOiB0b2tlblJlc3BvbnNlIH0pIHsNCiAgICAgICAgaWYgKCF0b2tlblJlc3BvbnNlKSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCB7IG9hdXRoSWRUb2tlbiwgb2F1dGhBY2Nlc3NUb2tlbiB9ID0gdG9rZW5SZXNwb25zZTsNCiAgICAgICAgaWYgKCFvYXV0aElkVG9rZW4gJiYgIW9hdXRoQWNjZXNzVG9rZW4pIHsNCiAgICAgICAgICAgIC8vIFRoaXMgY291bGQgYmUgYW4gb2F1dGggMSBjcmVkZW50aWFsIG9yIGEgcGhvbmUgY3JlZGVudGlhbA0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHJldHVybiBHb29nbGVBdXRoUHJvdmlkZXIuY3JlZGVudGlhbChvYXV0aElkVG9rZW4sIG9hdXRoQWNjZXNzVG9rZW4pOw0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChfYSkgew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICB9DQp9DQovKiogQWx3YXlzIHNldCB0byB7QGxpbmsgU2lnbkluTWV0aG9kfS5HT09HTEUuICovDQpHb29nbGVBdXRoUHJvdmlkZXIuR09PR0xFX1NJR05fSU5fTUVUSE9EID0gImdvb2dsZS5jb20iIC8qIFNpZ25Jbk1ldGhvZC5HT09HTEUgKi87DQovKiogQWx3YXlzIHNldCB0byB7QGxpbmsgUHJvdmlkZXJJZH0uR09PR0xFLiAqLw0KR29vZ2xlQXV0aFByb3ZpZGVyLlBST1ZJREVSX0lEID0gImdvb2dsZS5jb20iIC8qIFByb3ZpZGVySWQuR09PR0xFICovOwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBQcm92aWRlciBmb3IgZ2VuZXJhdGluZyBhbiB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmb3Ige0BsaW5rIFByb3ZpZGVySWR9LkdJVEhVQi4NCiAqDQogKiBAcmVtYXJrcw0KICogR2l0SHViIHJlcXVpcmVzIGFuIE9BdXRoIDIuMCByZWRpcmVjdCwgc28geW91IGNhbiBlaXRoZXIgaGFuZGxlIHRoZSByZWRpcmVjdCBkaXJlY3RseSwgb3IgdXNlDQogKiB0aGUge0BsaW5rIHNpZ25JbldpdGhQb3B1cH0gaGFuZGxlcjoNCiAqDQogKiBAZXhhbXBsZQ0KICogYGBgamF2YXNjcmlwdA0KICogLy8gU2lnbiBpbiB1c2luZyBhIHJlZGlyZWN0Lg0KICogY29uc3QgcHJvdmlkZXIgPSBuZXcgR2l0aHViQXV0aFByb3ZpZGVyKCk7DQogKiAvLyBTdGFydCBhIHNpZ24gaW4gcHJvY2VzcyBmb3IgYW4gdW5hdXRoZW50aWNhdGVkIHVzZXIuDQogKiBwcm92aWRlci5hZGRTY29wZSgncmVwbycpOw0KICogYXdhaXQgc2lnbkluV2l0aFJlZGlyZWN0KGF1dGgsIHByb3ZpZGVyKTsNCiAqIC8vIFRoaXMgd2lsbCB0cmlnZ2VyIGEgZnVsbCBwYWdlIHJlZGlyZWN0IGF3YXkgZnJvbSB5b3VyIGFwcA0KICoNCiAqIC8vIEFmdGVyIHJldHVybmluZyBmcm9tIHRoZSByZWRpcmVjdCB3aGVuIHlvdXIgYXBwIGluaXRpYWxpemVzIHlvdSBjYW4gb2J0YWluIHRoZSByZXN1bHQNCiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldFJlZGlyZWN0UmVzdWx0KGF1dGgpOw0KICogaWYgKHJlc3VsdCkgew0KICogICAvLyBUaGlzIGlzIHRoZSBzaWduZWQtaW4gdXNlcg0KICogICBjb25zdCB1c2VyID0gcmVzdWx0LnVzZXI7DQogKiAgIC8vIFRoaXMgZ2l2ZXMgeW91IGEgR2l0aHViIEFjY2VzcyBUb2tlbi4NCiAqICAgY29uc3QgY3JlZGVudGlhbCA9IEdpdGh1YkF1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVJlc3VsdChyZXN1bHQpOw0KICogICBjb25zdCB0b2tlbiA9IGNyZWRlbnRpYWwuYWNjZXNzVG9rZW47DQogKiB9DQogKiBgYGANCiAqDQogKiBAZXhhbXBsZQ0KICogYGBgamF2YXNjcmlwdA0KICogLy8gU2lnbiBpbiB1c2luZyBhIHBvcHVwLg0KICogY29uc3QgcHJvdmlkZXIgPSBuZXcgR2l0aHViQXV0aFByb3ZpZGVyKCk7DQogKiBwcm92aWRlci5hZGRTY29wZSgncmVwbycpOw0KICogY29uc3QgcmVzdWx0ID0gYXdhaXQgc2lnbkluV2l0aFBvcHVwKGF1dGgsIHByb3ZpZGVyKTsNCiAqDQogKiAvLyBUaGUgc2lnbmVkLWluIHVzZXIgaW5mby4NCiAqIGNvbnN0IHVzZXIgPSByZXN1bHQudXNlcjsNCiAqIC8vIFRoaXMgZ2l2ZXMgeW91IGEgR2l0aHViIEFjY2VzcyBUb2tlbi4NCiAqIGNvbnN0IGNyZWRlbnRpYWwgPSBHaXRodWJBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21SZXN1bHQocmVzdWx0KTsNCiAqIGNvbnN0IHRva2VuID0gY3JlZGVudGlhbC5hY2Nlc3NUb2tlbjsNCiAqIGBgYA0KICogQHB1YmxpYw0KICovDQpjbGFzcyBHaXRodWJBdXRoUHJvdmlkZXIgZXh0ZW5kcyBCYXNlT0F1dGhQcm92aWRlciB7DQogICAgY29uc3RydWN0b3IoKSB7DQogICAgICAgIHN1cGVyKCJnaXRodWIuY29tIiAvKiBQcm92aWRlcklkLkdJVEhVQiAqLyk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBjcmVkZW50aWFsIGZvciBHaXRodWIuDQogICAgICoNCiAgICAgKiBAcGFyYW0gYWNjZXNzVG9rZW4gLSBHaXRodWIgYWNjZXNzIHRva2VuLg0KICAgICAqLw0KICAgIHN0YXRpYyBjcmVkZW50aWFsKGFjY2Vzc1Rva2VuKSB7DQogICAgICAgIHJldHVybiBPQXV0aENyZWRlbnRpYWwuX2Zyb21QYXJhbXMoew0KICAgICAgICAgICAgcHJvdmlkZXJJZDogR2l0aHViQXV0aFByb3ZpZGVyLlBST1ZJREVSX0lELA0KICAgICAgICAgICAgc2lnbkluTWV0aG9kOiBHaXRodWJBdXRoUHJvdmlkZXIuR0lUSFVCX1NJR05fSU5fTUVUSE9ELA0KICAgICAgICAgICAgYWNjZXNzVG9rZW4NCiAgICAgICAgfSk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFVzZWQgdG8gZXh0cmFjdCB0aGUgdW5kZXJseWluZyB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmcm9tIGEge0BsaW5rIFVzZXJDcmVkZW50aWFsfS4NCiAgICAgKg0KICAgICAqIEBwYXJhbSB1c2VyQ3JlZGVudGlhbCAtIFRoZSB1c2VyIGNyZWRlbnRpYWwuDQogICAgICovDQogICAgc3RhdGljIGNyZWRlbnRpYWxGcm9tUmVzdWx0KHVzZXJDcmVkZW50aWFsKSB7DQogICAgICAgIHJldHVybiBHaXRodWJBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QodXNlckNyZWRlbnRpYWwpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBVc2VkIHRvIGV4dHJhY3QgdGhlIHVuZGVybHlpbmcge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZnJvbSBhIHtAbGluayBBdXRoRXJyb3J9IHdoaWNoIHdhcw0KICAgICAqIHRocm93biBkdXJpbmcgYSBzaWduLWluLCBsaW5rLCBvciByZWF1dGhlbnRpY2F0ZSBvcGVyYXRpb24uDQogICAgICoNCiAgICAgKiBAcGFyYW0gdXNlckNyZWRlbnRpYWwgLSBUaGUgdXNlciBjcmVkZW50aWFsLg0KICAgICAqLw0KICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbUVycm9yKGVycm9yKSB7DQogICAgICAgIHJldHVybiBHaXRodWJBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QoKGVycm9yLmN1c3RvbURhdGEgfHwge30pKTsNCiAgICB9DQogICAgc3RhdGljIGNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KHsgX3Rva2VuUmVzcG9uc2U6IHRva2VuUmVzcG9uc2UgfSkgew0KICAgICAgICBpZiAoIXRva2VuUmVzcG9uc2UgfHwgISgnb2F1dGhBY2Nlc3NUb2tlbicgaW4gdG9rZW5SZXNwb25zZSkpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIGlmICghdG9rZW5SZXNwb25zZS5vYXV0aEFjY2Vzc1Rva2VuKSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgcmV0dXJuIEdpdGh1YkF1dGhQcm92aWRlci5jcmVkZW50aWFsKHRva2VuUmVzcG9uc2Uub2F1dGhBY2Nlc3NUb2tlbik7DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKF9hKSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgIH0NCn0NCi8qKiBBbHdheXMgc2V0IHRvIHtAbGluayBTaWduSW5NZXRob2R9LkdJVEhVQi4gKi8NCkdpdGh1YkF1dGhQcm92aWRlci5HSVRIVUJfU0lHTl9JTl9NRVRIT0QgPSAiZ2l0aHViLmNvbSIgLyogU2lnbkluTWV0aG9kLkdJVEhVQiAqLzsNCi8qKiBBbHdheXMgc2V0IHRvIHtAbGluayBQcm92aWRlcklkfS5HSVRIVUIuICovDQpHaXRodWJBdXRoUHJvdmlkZXIuUFJPVklERVJfSUQgPSAiZ2l0aHViLmNvbSIgLyogUHJvdmlkZXJJZC5HSVRIVUIgKi87CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIFByb3ZpZGVyIGZvciBnZW5lcmF0aW5nIGFuIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZvciB7QGxpbmsgUHJvdmlkZXJJZH0uVFdJVFRFUi4NCiAqDQogKiBAZXhhbXBsZQ0KICogYGBgamF2YXNjcmlwdA0KICogLy8gU2lnbiBpbiB1c2luZyBhIHJlZGlyZWN0Lg0KICogY29uc3QgcHJvdmlkZXIgPSBuZXcgVHdpdHRlckF1dGhQcm92aWRlcigpOw0KICogLy8gU3RhcnQgYSBzaWduIGluIHByb2Nlc3MgZm9yIGFuIHVuYXV0aGVudGljYXRlZCB1c2VyLg0KICogYXdhaXQgc2lnbkluV2l0aFJlZGlyZWN0KGF1dGgsIHByb3ZpZGVyKTsNCiAqIC8vIFRoaXMgd2lsbCB0cmlnZ2VyIGEgZnVsbCBwYWdlIHJlZGlyZWN0IGF3YXkgZnJvbSB5b3VyIGFwcA0KICoNCiAqIC8vIEFmdGVyIHJldHVybmluZyBmcm9tIHRoZSByZWRpcmVjdCB3aGVuIHlvdXIgYXBwIGluaXRpYWxpemVzIHlvdSBjYW4gb2J0YWluIHRoZSByZXN1bHQNCiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldFJlZGlyZWN0UmVzdWx0KGF1dGgpOw0KICogaWYgKHJlc3VsdCkgew0KICogICAvLyBUaGlzIGlzIHRoZSBzaWduZWQtaW4gdXNlcg0KICogICBjb25zdCB1c2VyID0gcmVzdWx0LnVzZXI7DQogKiAgIC8vIFRoaXMgZ2l2ZXMgeW91IGEgVHdpdHRlciBBY2Nlc3MgVG9rZW4gYW5kIFNlY3JldC4NCiAqICAgY29uc3QgY3JlZGVudGlhbCA9IFR3aXR0ZXJBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21SZXN1bHQocmVzdWx0KTsNCiAqICAgY29uc3QgdG9rZW4gPSBjcmVkZW50aWFsLmFjY2Vzc1Rva2VuOw0KICogICBjb25zdCBzZWNyZXQgPSBjcmVkZW50aWFsLnNlY3JldDsNCiAqIH0NCiAqIGBgYA0KICoNCiAqIEBleGFtcGxlDQogKiBgYGBqYXZhc2NyaXB0DQogKiAvLyBTaWduIGluIHVzaW5nIGEgcG9wdXAuDQogKiBjb25zdCBwcm92aWRlciA9IG5ldyBUd2l0dGVyQXV0aFByb3ZpZGVyKCk7DQogKiBjb25zdCByZXN1bHQgPSBhd2FpdCBzaWduSW5XaXRoUG9wdXAoYXV0aCwgcHJvdmlkZXIpOw0KICoNCiAqIC8vIFRoZSBzaWduZWQtaW4gdXNlciBpbmZvLg0KICogY29uc3QgdXNlciA9IHJlc3VsdC51c2VyOw0KICogLy8gVGhpcyBnaXZlcyB5b3UgYSBUd2l0dGVyIEFjY2VzcyBUb2tlbiBhbmQgU2VjcmV0Lg0KICogY29uc3QgY3JlZGVudGlhbCA9IFR3aXR0ZXJBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21SZXN1bHQocmVzdWx0KTsNCiAqIGNvbnN0IHRva2VuID0gY3JlZGVudGlhbC5hY2Nlc3NUb2tlbjsNCiAqIGNvbnN0IHNlY3JldCA9IGNyZWRlbnRpYWwuc2VjcmV0Ow0KICogYGBgDQogKg0KICogQHB1YmxpYw0KICovDQpjbGFzcyBUd2l0dGVyQXV0aFByb3ZpZGVyIGV4dGVuZHMgQmFzZU9BdXRoUHJvdmlkZXIgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICBzdXBlcigidHdpdHRlci5jb20iIC8qIFByb3ZpZGVySWQuVFdJVFRFUiAqLyk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgYSBjcmVkZW50aWFsIGZvciBUd2l0dGVyLg0KICAgICAqDQogICAgICogQHBhcmFtIHRva2VuIC0gVHdpdHRlciBhY2Nlc3MgdG9rZW4uDQogICAgICogQHBhcmFtIHNlY3JldCAtIFR3aXR0ZXIgc2VjcmV0Lg0KICAgICAqLw0KICAgIHN0YXRpYyBjcmVkZW50aWFsKHRva2VuLCBzZWNyZXQpIHsNCiAgICAgICAgcmV0dXJuIE9BdXRoQ3JlZGVudGlhbC5fZnJvbVBhcmFtcyh7DQogICAgICAgICAgICBwcm92aWRlcklkOiBUd2l0dGVyQXV0aFByb3ZpZGVyLlBST1ZJREVSX0lELA0KICAgICAgICAgICAgc2lnbkluTWV0aG9kOiBUd2l0dGVyQXV0aFByb3ZpZGVyLlRXSVRURVJfU0lHTl9JTl9NRVRIT0QsDQogICAgICAgICAgICBvYXV0aFRva2VuOiB0b2tlbiwNCiAgICAgICAgICAgIG9hdXRoVG9rZW5TZWNyZXQ6IHNlY3JldA0KICAgICAgICB9KTsNCiAgICB9DQogICAgLyoqDQogICAgICogVXNlZCB0byBleHRyYWN0IHRoZSB1bmRlcmx5aW5nIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSB7QGxpbmsgVXNlckNyZWRlbnRpYWx9Lg0KICAgICAqDQogICAgICogQHBhcmFtIHVzZXJDcmVkZW50aWFsIC0gVGhlIHVzZXIgY3JlZGVudGlhbC4NCiAgICAgKi8NCiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21SZXN1bHQodXNlckNyZWRlbnRpYWwpIHsNCiAgICAgICAgcmV0dXJuIFR3aXR0ZXJBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QodXNlckNyZWRlbnRpYWwpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBVc2VkIHRvIGV4dHJhY3QgdGhlIHVuZGVybHlpbmcge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZnJvbSBhIHtAbGluayBBdXRoRXJyb3J9IHdoaWNoIHdhcw0KICAgICAqIHRocm93biBkdXJpbmcgYSBzaWduLWluLCBsaW5rLCBvciByZWF1dGhlbnRpY2F0ZSBvcGVyYXRpb24uDQogICAgICoNCiAgICAgKiBAcGFyYW0gdXNlckNyZWRlbnRpYWwgLSBUaGUgdXNlciBjcmVkZW50aWFsLg0KICAgICAqLw0KICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbUVycm9yKGVycm9yKSB7DQogICAgICAgIHJldHVybiBUd2l0dGVyQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KChlcnJvci5jdXN0b21EYXRhIHx8IHt9KSk7DQogICAgfQ0KICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCh7IF90b2tlblJlc3BvbnNlOiB0b2tlblJlc3BvbnNlIH0pIHsNCiAgICAgICAgaWYgKCF0b2tlblJlc3BvbnNlKSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCB7IG9hdXRoQWNjZXNzVG9rZW4sIG9hdXRoVG9rZW5TZWNyZXQgfSA9IHRva2VuUmVzcG9uc2U7DQogICAgICAgIGlmICghb2F1dGhBY2Nlc3NUb2tlbiB8fCAhb2F1dGhUb2tlblNlY3JldCkgew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHJldHVybiBUd2l0dGVyQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwob2F1dGhBY2Nlc3NUb2tlbiwgb2F1dGhUb2tlblNlY3JldCk7DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKF9hKSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgIH0NCn0NCi8qKiBBbHdheXMgc2V0IHRvIHtAbGluayBTaWduSW5NZXRob2R9LlRXSVRURVIuICovDQpUd2l0dGVyQXV0aFByb3ZpZGVyLlRXSVRURVJfU0lHTl9JTl9NRVRIT0QgPSAidHdpdHRlci5jb20iIC8qIFNpZ25Jbk1ldGhvZC5UV0lUVEVSICovOw0KLyoqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFByb3ZpZGVySWR9LlRXSVRURVIuICovDQpUd2l0dGVyQXV0aFByb3ZpZGVyLlBST1ZJREVSX0lEID0gInR3aXR0ZXIuY29tIiAvKiBQcm92aWRlcklkLlRXSVRURVIgKi87CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQphc3luYyBmdW5jdGlvbiBzaWduVXAoYXV0aCwgcmVxdWVzdCkgew0KICAgIHJldHVybiBfcGVyZm9ybVNpZ25JblJlcXVlc3QoYXV0aCwgIlBPU1QiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgIi92MS9hY2NvdW50czpzaWduVXAiIC8qIEVuZHBvaW50LlNJR05fVVAgKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBVc2VyQ3JlZGVudGlhbEltcGwgew0KICAgIGNvbnN0cnVjdG9yKHBhcmFtcykgew0KICAgICAgICB0aGlzLnVzZXIgPSBwYXJhbXMudXNlcjsNCiAgICAgICAgdGhpcy5wcm92aWRlcklkID0gcGFyYW1zLnByb3ZpZGVySWQ7DQogICAgICAgIHRoaXMuX3Rva2VuUmVzcG9uc2UgPSBwYXJhbXMuX3Rva2VuUmVzcG9uc2U7DQogICAgICAgIHRoaXMub3BlcmF0aW9uVHlwZSA9IHBhcmFtcy5vcGVyYXRpb25UeXBlOw0KICAgIH0NCiAgICBzdGF0aWMgYXN5bmMgX2Zyb21JZFRva2VuUmVzcG9uc2UoYXV0aCwgb3BlcmF0aW9uVHlwZSwgaWRUb2tlblJlc3BvbnNlLCBpc0Fub255bW91cyA9IGZhbHNlKSB7DQogICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VySW1wbC5fZnJvbUlkVG9rZW5SZXNwb25zZShhdXRoLCBpZFRva2VuUmVzcG9uc2UsIGlzQW5vbnltb3VzKTsNCiAgICAgICAgY29uc3QgcHJvdmlkZXJJZCA9IHByb3ZpZGVySWRGb3JSZXNwb25zZShpZFRva2VuUmVzcG9uc2UpOw0KICAgICAgICBjb25zdCB1c2VyQ3JlZCA9IG5ldyBVc2VyQ3JlZGVudGlhbEltcGwoew0KICAgICAgICAgICAgdXNlciwNCiAgICAgICAgICAgIHByb3ZpZGVySWQsDQogICAgICAgICAgICBfdG9rZW5SZXNwb25zZTogaWRUb2tlblJlc3BvbnNlLA0KICAgICAgICAgICAgb3BlcmF0aW9uVHlwZQ0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuIHVzZXJDcmVkOw0KICAgIH0NCiAgICBzdGF0aWMgYXN5bmMgX2Zvck9wZXJhdGlvbih1c2VyLCBvcGVyYXRpb25UeXBlLCByZXNwb25zZSkgew0KICAgICAgICBhd2FpdCB1c2VyLl91cGRhdGVUb2tlbnNJZk5lY2Vzc2FyeShyZXNwb25zZSwgLyogcmVsb2FkICovIHRydWUpOw0KICAgICAgICBjb25zdCBwcm92aWRlcklkID0gcHJvdmlkZXJJZEZvclJlc3BvbnNlKHJlc3BvbnNlKTsNCiAgICAgICAgcmV0dXJuIG5ldyBVc2VyQ3JlZGVudGlhbEltcGwoew0KICAgICAgICAgICAgdXNlciwNCiAgICAgICAgICAgIHByb3ZpZGVySWQsDQogICAgICAgICAgICBfdG9rZW5SZXNwb25zZTogcmVzcG9uc2UsDQogICAgICAgICAgICBvcGVyYXRpb25UeXBlDQogICAgICAgIH0pOw0KICAgIH0NCn0NCmZ1bmN0aW9uIHByb3ZpZGVySWRGb3JSZXNwb25zZShyZXNwb25zZSkgew0KICAgIGlmIChyZXNwb25zZS5wcm92aWRlcklkKSB7DQogICAgICAgIHJldHVybiByZXNwb25zZS5wcm92aWRlcklkOw0KICAgIH0NCiAgICBpZiAoJ3Bob25lTnVtYmVyJyBpbiByZXNwb25zZSkgew0KICAgICAgICByZXR1cm4gInBob25lIiAvKiBQcm92aWRlcklkLlBIT05FICovOw0KICAgIH0NCiAgICByZXR1cm4gbnVsbDsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNsYXNzIE11bHRpRmFjdG9yRXJyb3IgZXh0ZW5kcyBGaXJlYmFzZUVycm9yIHsNCiAgICBjb25zdHJ1Y3RvcihhdXRoLCBlcnJvciwgb3BlcmF0aW9uVHlwZSwgdXNlcikgew0KICAgICAgICB2YXIgX2E7DQogICAgICAgIHN1cGVyKGVycm9yLmNvZGUsIGVycm9yLm1lc3NhZ2UpOw0KICAgICAgICB0aGlzLm9wZXJhdGlvblR5cGUgPSBvcGVyYXRpb25UeXBlOw0KICAgICAgICB0aGlzLnVzZXIgPSB1c2VyOw0KICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vTWljcm9zb2Z0L1R5cGVTY3JpcHQtd2lraS9ibG9iL21hc3Rlci9CcmVha2luZy1DaGFuZ2VzLm1kI2V4dGVuZGluZy1idWlsdC1pbnMtbGlrZS1lcnJvci1hcnJheS1hbmQtbWFwLW1heS1uby1sb25nZXItd29yaw0KICAgICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcywgTXVsdGlGYWN0b3JFcnJvci5wcm90b3R5cGUpOw0KICAgICAgICB0aGlzLmN1c3RvbURhdGEgPSB7DQogICAgICAgICAgICBhcHBOYW1lOiBhdXRoLm5hbWUsDQogICAgICAgICAgICB0ZW5hbnRJZDogKF9hID0gYXV0aC50ZW5hbnRJZCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogdW5kZWZpbmVkLA0KICAgICAgICAgICAgX3NlcnZlclJlc3BvbnNlOiBlcnJvci5jdXN0b21EYXRhLl9zZXJ2ZXJSZXNwb25zZSwNCiAgICAgICAgICAgIG9wZXJhdGlvblR5cGUNCiAgICAgICAgfTsNCiAgICB9DQogICAgc3RhdGljIF9mcm9tRXJyb3JBbmRPcGVyYXRpb24oYXV0aCwgZXJyb3IsIG9wZXJhdGlvblR5cGUsIHVzZXIpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBNdWx0aUZhY3RvckVycm9yKGF1dGgsIGVycm9yLCBvcGVyYXRpb25UeXBlLCB1c2VyKTsNCiAgICB9DQp9DQpmdW5jdGlvbiBfcHJvY2Vzc0NyZWRlbnRpYWxTYXZpbmdNZmFDb250ZXh0SWZOZWNlc3NhcnkoYXV0aCwgb3BlcmF0aW9uVHlwZSwgY3JlZGVudGlhbCwgdXNlcikgew0KICAgIGNvbnN0IGlkVG9rZW5Qcm92aWRlciA9IG9wZXJhdGlvblR5cGUgPT09ICJyZWF1dGhlbnRpY2F0ZSIgLyogT3BlcmF0aW9uVHlwZS5SRUFVVEhFTlRJQ0FURSAqLw0KICAgICAgICA/IGNyZWRlbnRpYWwuX2dldFJlYXV0aGVudGljYXRpb25SZXNvbHZlcihhdXRoKQ0KICAgICAgICA6IGNyZWRlbnRpYWwuX2dldElkVG9rZW5SZXNwb25zZShhdXRoKTsNCiAgICByZXR1cm4gaWRUb2tlblByb3ZpZGVyLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgaWYgKGVycm9yLmNvZGUgPT09IGBhdXRoLyR7Im11bHRpLWZhY3Rvci1hdXRoLXJlcXVpcmVkIiAvKiBBdXRoRXJyb3JDb2RlLk1GQV9SRVFVSVJFRCAqL31gKSB7DQogICAgICAgICAgICB0aHJvdyBNdWx0aUZhY3RvckVycm9yLl9mcm9tRXJyb3JBbmRPcGVyYXRpb24oYXV0aCwgZXJyb3IsIG9wZXJhdGlvblR5cGUsIHVzZXIpOw0KICAgICAgICB9DQogICAgICAgIHRocm93IGVycm9yOw0KICAgIH0pOw0KfQphc3luYyBmdW5jdGlvbiBfbGluayQxKHVzZXIsIGNyZWRlbnRpYWwsIGJ5cGFzc0F1dGhTdGF0ZSA9IGZhbHNlKSB7DQogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBfbG9nb3V0SWZJbnZhbGlkYXRlZCh1c2VyLCBjcmVkZW50aWFsLl9saW5rVG9JZFRva2VuKHVzZXIuYXV0aCwgYXdhaXQgdXNlci5nZXRJZFRva2VuKCkpLCBieXBhc3NBdXRoU3RhdGUpOw0KICAgIHJldHVybiBVc2VyQ3JlZGVudGlhbEltcGwuX2Zvck9wZXJhdGlvbih1c2VyLCAibGluayIgLyogT3BlcmF0aW9uVHlwZS5MSU5LICovLCByZXNwb25zZSk7DQp9DQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KYXN5bmMgZnVuY3Rpb24gX3JlYXV0aGVudGljYXRlKHVzZXIsIGNyZWRlbnRpYWwsIGJ5cGFzc0F1dGhTdGF0ZSA9IGZhbHNlKSB7DQogICAgY29uc3QgeyBhdXRoIH0gPSB1c2VyOw0KICAgIGNvbnN0IG9wZXJhdGlvblR5cGUgPSAicmVhdXRoZW50aWNhdGUiIC8qIE9wZXJhdGlvblR5cGUuUkVBVVRIRU5USUNBVEUgKi87DQogICAgdHJ5IHsNCiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBfbG9nb3V0SWZJbnZhbGlkYXRlZCh1c2VyLCBfcHJvY2Vzc0NyZWRlbnRpYWxTYXZpbmdNZmFDb250ZXh0SWZOZWNlc3NhcnkoYXV0aCwgb3BlcmF0aW9uVHlwZSwgY3JlZGVudGlhbCwgdXNlciksIGJ5cGFzc0F1dGhTdGF0ZSk7DQogICAgICAgIF9hc3NlcnQocmVzcG9uc2UuaWRUb2tlbiwgYXV0aCwgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICAgICAgY29uc3QgcGFyc2VkID0gX3BhcnNlVG9rZW4ocmVzcG9uc2UuaWRUb2tlbik7DQogICAgICAgIF9hc3NlcnQocGFyc2VkLCBhdXRoLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pOw0KICAgICAgICBjb25zdCB7IHN1YjogbG9jYWxJZCB9ID0gcGFyc2VkOw0KICAgICAgICBfYXNzZXJ0KHVzZXIudWlkID09PSBsb2NhbElkLCBhdXRoLCAidXNlci1taXNtYXRjaCIgLyogQXV0aEVycm9yQ29kZS5VU0VSX01JU01BVENIICovKTsNCiAgICAgICAgcmV0dXJuIFVzZXJDcmVkZW50aWFsSW1wbC5fZm9yT3BlcmF0aW9uKHVzZXIsIG9wZXJhdGlvblR5cGUsIHJlc3BvbnNlKTsNCiAgICB9DQogICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgLy8gQ29udmVydCB1c2VyIGRlbGV0ZWQgZXJyb3IgaW50byB1c2VyIG1pc21hdGNoDQogICAgICAgIGlmICgoZSA9PT0gbnVsbCB8fCBlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlLmNvZGUpID09PSBgYXV0aC8keyJ1c2VyLW5vdC1mb3VuZCIgLyogQXV0aEVycm9yQ29kZS5VU0VSX0RFTEVURUQgKi99YCkgew0KICAgICAgICAgICAgX2ZhaWwoYXV0aCwgInVzZXItbWlzbWF0Y2giIC8qIEF1dGhFcnJvckNvZGUuVVNFUl9NSVNNQVRDSCAqLyk7DQogICAgICAgIH0NCiAgICAgICAgdGhyb3cgZTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQphc3luYyBmdW5jdGlvbiBfc2lnbkluV2l0aENyZWRlbnRpYWwoYXV0aCwgY3JlZGVudGlhbCwgYnlwYXNzQXV0aFN0YXRlID0gZmFsc2UpIHsNCiAgICBjb25zdCBvcGVyYXRpb25UeXBlID0gInNpZ25JbiIgLyogT3BlcmF0aW9uVHlwZS5TSUdOX0lOICovOw0KICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgX3Byb2Nlc3NDcmVkZW50aWFsU2F2aW5nTWZhQ29udGV4dElmTmVjZXNzYXJ5KGF1dGgsIG9wZXJhdGlvblR5cGUsIGNyZWRlbnRpYWwpOw0KICAgIGNvbnN0IHVzZXJDcmVkZW50aWFsID0gYXdhaXQgVXNlckNyZWRlbnRpYWxJbXBsLl9mcm9tSWRUb2tlblJlc3BvbnNlKGF1dGgsIG9wZXJhdGlvblR5cGUsIHJlc3BvbnNlKTsNCiAgICBpZiAoIWJ5cGFzc0F1dGhTdGF0ZSkgew0KICAgICAgICBhd2FpdCBhdXRoLl91cGRhdGVDdXJyZW50VXNlcih1c2VyQ3JlZGVudGlhbC51c2VyKTsNCiAgICB9DQogICAgcmV0dXJuIHVzZXJDcmVkZW50aWFsOw0KfQ0KLyoqDQogKiBBc3luY2hyb25vdXNseSBzaWducyBpbiB3aXRoIHRoZSBnaXZlbiBjcmVkZW50aWFscy4NCiAqDQogKiBAcmVtYXJrcw0KICogQW4ge0BsaW5rIEF1dGhQcm92aWRlcn0gY2FuIGJlIHVzZWQgdG8gZ2VuZXJhdGUgdGhlIGNyZWRlbnRpYWwuDQogKg0KICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLg0KICogQHBhcmFtIGNyZWRlbnRpYWwgLSBUaGUgYXV0aCBjcmVkZW50aWFsLg0KICoNCiAqIEBwdWJsaWMNCiAqLw0KYXN5bmMgZnVuY3Rpb24gc2lnbkluV2l0aENyZWRlbnRpYWwoYXV0aCwgY3JlZGVudGlhbCkgew0KICAgIHJldHVybiBfc2lnbkluV2l0aENyZWRlbnRpYWwoX2Nhc3RBdXRoKGF1dGgpLCBjcmVkZW50aWFsKTsNCn0NCi8qKg0KICogQ3JlYXRlcyBhIG5ldyB1c2VyIGFjY291bnQgYXNzb2NpYXRlZCB3aXRoIHRoZSBzcGVjaWZpZWQgZW1haWwgYWRkcmVzcyBhbmQgcGFzc3dvcmQuDQogKg0KICogQHJlbWFya3MNCiAqIE9uIHN1Y2Nlc3NmdWwgY3JlYXRpb24gb2YgdGhlIHVzZXIgYWNjb3VudCwgdGhpcyB1c2VyIHdpbGwgYWxzbyBiZSBzaWduZWQgaW4gdG8geW91ciBhcHBsaWNhdGlvbi4NCiAqDQogKiBVc2VyIGFjY291bnQgY3JlYXRpb24gY2FuIGZhaWwgaWYgdGhlIGFjY291bnQgYWxyZWFkeSBleGlzdHMgb3IgdGhlIHBhc3N3b3JkIGlzIGludmFsaWQuDQogKg0KICogTm90ZTogVGhlIGVtYWlsIGFkZHJlc3MgYWN0cyBhcyBhIHVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgdXNlciBhbmQgZW5hYmxlcyBhbiBlbWFpbC1iYXNlZA0KICogcGFzc3dvcmQgcmVzZXQuIFRoaXMgZnVuY3Rpb24gd2lsbCBjcmVhdGUgYSBuZXcgdXNlciBhY2NvdW50IGFuZCBzZXQgdGhlIGluaXRpYWwgdXNlciBwYXNzd29yZC4NCiAqDQogKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuDQogKiBAcGFyYW0gZW1haWwgLSBUaGUgdXNlcidzIGVtYWlsIGFkZHJlc3MuDQogKiBAcGFyYW0gcGFzc3dvcmQgLSBUaGUgdXNlcidzIGNob3NlbiBwYXNzd29yZC4NCiAqDQogKiBAcHVibGljDQogKi8NCmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVVzZXJXaXRoRW1haWxBbmRQYXNzd29yZChhdXRoLCBlbWFpbCwgcGFzc3dvcmQpIHsNCiAgICB2YXIgX2E7DQogICAgY29uc3QgYXV0aEludGVybmFsID0gX2Nhc3RBdXRoKGF1dGgpOw0KICAgIGNvbnN0IHJlcXVlc3QgPSB7DQogICAgICAgIHJldHVyblNlY3VyZVRva2VuOiB0cnVlLA0KICAgICAgICBlbWFpbCwNCiAgICAgICAgcGFzc3dvcmQsDQogICAgICAgIGNsaWVudFR5cGU6ICJDTElFTlRfVFlQRV9XRUIiIC8qIFJlY2FwdGNoYUNsaWVudFR5cGUuV0VCICovDQogICAgfTsNCiAgICBsZXQgc2lnblVwUmVzcG9uc2U7DQogICAgaWYgKChfYSA9IGF1dGhJbnRlcm5hbC5fZ2V0UmVjYXB0Y2hhQ29uZmlnKCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5lbWFpbFBhc3N3b3JkRW5hYmxlZCkgew0KICAgICAgICBjb25zdCByZXF1ZXN0V2l0aFJlY2FwdGNoYSA9IGF3YWl0IGluamVjdFJlY2FwdGNoYUZpZWxkcyhhdXRoSW50ZXJuYWwsIHJlcXVlc3QsICJzaWduVXBQYXNzd29yZCIgLyogUmVjYXB0Y2hhQWN0aW9uTmFtZS5TSUdOX1VQX1BBU1NXT1JEICovKTsNCiAgICAgICAgc2lnblVwUmVzcG9uc2UgPSBzaWduVXAoYXV0aEludGVybmFsLCByZXF1ZXN0V2l0aFJlY2FwdGNoYSk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBzaWduVXBSZXNwb25zZSA9IHNpZ25VcChhdXRoSW50ZXJuYWwsIHJlcXVlc3QpLmNhdGNoKGFzeW5jIChlcnJvcikgPT4gew0KICAgICAgICAgICAgaWYgKGVycm9yLmNvZGUgPT09IGBhdXRoLyR7Im1pc3NpbmctcmVjYXB0Y2hhLXRva2VuIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfUkVDQVBUQ0hBX1RPS0VOICovfWApIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU2lnbi11cCBpcyBwcm90ZWN0ZWQgYnkgcmVDQVBUQ0hBIGZvciB0aGlzIHByb2plY3QuIEF1dG9tYXRpY2FsbHkgdHJpZ2dlcmluZyB0aGUgcmVDQVBUQ0hBIGZsb3cgYW5kIHJlc3RhcnRpbmcgdGhlIHNpZ24tdXAgZmxvdy4nKTsNCiAgICAgICAgICAgICAgICBjb25zdCByZXF1ZXN0V2l0aFJlY2FwdGNoYSA9IGF3YWl0IGluamVjdFJlY2FwdGNoYUZpZWxkcyhhdXRoSW50ZXJuYWwsIHJlcXVlc3QsICJzaWduVXBQYXNzd29yZCIgLyogUmVjYXB0Y2hhQWN0aW9uTmFtZS5TSUdOX1VQX1BBU1NXT1JEICovKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gc2lnblVwKGF1dGhJbnRlcm5hbCwgcmVxdWVzdFdpdGhSZWNhcHRjaGEpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgc2lnblVwUmVzcG9uc2UuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpOw0KICAgIH0pOw0KICAgIGNvbnN0IHVzZXJDcmVkZW50aWFsID0gYXdhaXQgVXNlckNyZWRlbnRpYWxJbXBsLl9mcm9tSWRUb2tlblJlc3BvbnNlKGF1dGhJbnRlcm5hbCwgInNpZ25JbiIgLyogT3BlcmF0aW9uVHlwZS5TSUdOX0lOICovLCByZXNwb25zZSk7DQogICAgYXdhaXQgYXV0aEludGVybmFsLl91cGRhdGVDdXJyZW50VXNlcih1c2VyQ3JlZGVudGlhbC51c2VyKTsNCiAgICByZXR1cm4gdXNlckNyZWRlbnRpYWw7DQp9DQovKioNCiAqIEFzeW5jaHJvbm91c2x5IHNpZ25zIGluIHVzaW5nIGFuIGVtYWlsIGFuZCBwYXNzd29yZC4NCiAqDQogKiBAcmVtYXJrcw0KICogRmFpbHMgd2l0aCBhbiBlcnJvciBpZiB0aGUgZW1haWwgYWRkcmVzcyBhbmQgcGFzc3dvcmQgZG8gbm90IG1hdGNoLg0KICoNCiAqIE5vdGU6IFRoZSB1c2VyJ3MgcGFzc3dvcmQgaXMgTk9UIHRoZSBwYXNzd29yZCB1c2VkIHRvIGFjY2VzcyB0aGUgdXNlcidzIGVtYWlsIGFjY291bnQuIFRoZQ0KICogZW1haWwgYWRkcmVzcyBzZXJ2ZXMgYXMgYSB1bmlxdWUgaWRlbnRpZmllciBmb3IgdGhlIHVzZXIsIGFuZCB0aGUgcGFzc3dvcmQgaXMgdXNlZCB0byBhY2Nlc3MNCiAqIHRoZSB1c2VyJ3MgYWNjb3VudCBpbiB5b3VyIEZpcmViYXNlIHByb2plY3QuIFNlZSBhbHNvOiB7QGxpbmsgY3JlYXRlVXNlcldpdGhFbWFpbEFuZFBhc3N3b3JkfS4NCiAqDQogKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuDQogKiBAcGFyYW0gZW1haWwgLSBUaGUgdXNlcnMgZW1haWwgYWRkcmVzcy4NCiAqIEBwYXJhbSBwYXNzd29yZCAtIFRoZSB1c2VycyBwYXNzd29yZC4NCiAqDQogKiBAcHVibGljDQogKi8NCmZ1bmN0aW9uIHNpZ25JbldpdGhFbWFpbEFuZFBhc3N3b3JkKGF1dGgsIGVtYWlsLCBwYXNzd29yZCkgew0KICAgIHJldHVybiBzaWduSW5XaXRoQ3JlZGVudGlhbChnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCksIEVtYWlsQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwoZW1haWwsIHBhc3N3b3JkKSk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovLyBOb24tb3B0aW9uYWwgYXV0aCBtZXRob2RzLg0KLyoqDQogKiBDaGFuZ2VzIHRoZSB0eXBlIG9mIHBlcnNpc3RlbmNlIG9uIHRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UgZm9yIHRoZSBjdXJyZW50bHkgc2F2ZWQNCiAqIGBBdXRoYCBzZXNzaW9uIGFuZCBhcHBsaWVzIHRoaXMgdHlwZSBvZiBwZXJzaXN0ZW5jZSBmb3IgZnV0dXJlIHNpZ24taW4gcmVxdWVzdHMsIGluY2x1ZGluZw0KICogc2lnbi1pbiB3aXRoIHJlZGlyZWN0IHJlcXVlc3RzLg0KICoNCiAqIEByZW1hcmtzDQogKiBUaGlzIG1ha2VzIGl0IGVhc3kgZm9yIGEgdXNlciBzaWduaW5nIGluIHRvIHNwZWNpZnkgd2hldGhlciB0aGVpciBzZXNzaW9uIHNob3VsZCBiZQ0KICogcmVtZW1iZXJlZCBvciBub3QuIEl0IGFsc28gbWFrZXMgaXQgZWFzaWVyIHRvIG5ldmVyIHBlcnNpc3QgdGhlIGBBdXRoYCBzdGF0ZSBmb3IgYXBwbGljYXRpb25zDQogKiB0aGF0IGFyZSBzaGFyZWQgYnkgb3RoZXIgdXNlcnMgb3IgaGF2ZSBzZW5zaXRpdmUgZGF0YS4NCiAqDQogKiBUaGlzIG1ldGhvZCBkb2VzIG5vdCB3b3JrIGluIGEgTm9kZS5qcyBlbnZpcm9ubWVudC4NCiAqDQogKiBAZXhhbXBsZQ0KICogYGBgamF2YXNjcmlwdA0KICogc2V0UGVyc2lzdGVuY2UoYXV0aCwgYnJvd3NlclNlc3Npb25QZXJzaXN0ZW5jZSk7DQogKiBgYGANCiAqDQogKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuDQogKiBAcGFyYW0gcGVyc2lzdGVuY2UgLSBUaGUge0BsaW5rIFBlcnNpc3RlbmNlfSB0byB1c2UuDQogKiBAcmV0dXJucyBBIGBQcm9taXNlYCB0aGF0IHJlc29sdmVzIG9uY2UgdGhlIHBlcnNpc3RlbmNlIGNoYW5nZSBoYXMgY29tcGxldGVkDQogKg0KICogQHB1YmxpYw0KICovDQpmdW5jdGlvbiBzZXRQZXJzaXN0ZW5jZShhdXRoLCBwZXJzaXN0ZW5jZSkgew0KICAgIHJldHVybiBnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCkuc2V0UGVyc2lzdGVuY2UocGVyc2lzdGVuY2UpOw0KfQ0KLyoqDQogKiBBZGRzIGFuIG9ic2VydmVyIGZvciBjaGFuZ2VzIHRvIHRoZSBzaWduZWQtaW4gdXNlcidzIElEIHRva2VuLg0KICoNCiAqIEByZW1hcmtzDQogKiBUaGlzIGluY2x1ZGVzIHNpZ24taW4sIHNpZ24tb3V0LCBhbmQgdG9rZW4gcmVmcmVzaCBldmVudHMuDQogKiBUaGlzIHdpbGwgbm90IGJlIHRyaWdnZXJlZCBhdXRvbWF0aWNhbGx5IHVwb24gSUQgdG9rZW4gZXhwaXJhdGlvbi4gVXNlIHtAbGluayBVc2VyLmdldElkVG9rZW59IHRvIHJlZnJlc2ggdGhlIElEIHRva2VuLg0KICoNCiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS4NCiAqIEBwYXJhbSBuZXh0T3JPYnNlcnZlciAtIGNhbGxiYWNrIHRyaWdnZXJlZCBvbiBjaGFuZ2UuDQogKiBAcGFyYW0gZXJyb3IgLSBEZXByZWNhdGVkLiBUaGlzIGNhbGxiYWNrIGlzIG5ldmVyIHRyaWdnZXJlZC4gRXJyb3JzDQogKiBvbiBzaWduaW5nIGluL291dCBjYW4gYmUgY2F1Z2h0IGluIHByb21pc2VzIHJldHVybmVkIGZyb20NCiAqIHNpZ24taW4vc2lnbi1vdXQgZnVuY3Rpb25zLg0KICogQHBhcmFtIGNvbXBsZXRlZCAtIERlcHJlY2F0ZWQuIFRoaXMgY2FsbGJhY2sgaXMgbmV2ZXIgdHJpZ2dlcmVkLg0KICoNCiAqIEBwdWJsaWMNCiAqLw0KZnVuY3Rpb24gb25JZFRva2VuQ2hhbmdlZChhdXRoLCBuZXh0T3JPYnNlcnZlciwgZXJyb3IsIGNvbXBsZXRlZCkgew0KICAgIHJldHVybiBnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCkub25JZFRva2VuQ2hhbmdlZChuZXh0T3JPYnNlcnZlciwgZXJyb3IsIGNvbXBsZXRlZCk7DQp9DQovKioNCiAqIEFkZHMgYSBibG9ja2luZyBjYWxsYmFjayB0aGF0IHJ1bnMgYmVmb3JlIGFuIGF1dGggc3RhdGUgY2hhbmdlDQogKiBzZXRzIGEgbmV3IHVzZXIuDQogKg0KICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLg0KICogQHBhcmFtIGNhbGxiYWNrIC0gY2FsbGJhY2sgdHJpZ2dlcmVkIGJlZm9yZSBuZXcgdXNlciB2YWx1ZSBpcyBzZXQuDQogKiAgIElmIHRoaXMgdGhyb3dzLCBpdCBibG9ja3MgdGhlIHVzZXIgZnJvbSBiZWluZyBzZXQuDQogKiBAcGFyYW0gb25BYm9ydCAtIGNhbGxiYWNrIHRyaWdnZXJlZCBpZiBhIGxhdGVyIGBiZWZvcmVBdXRoU3RhdGVDaGFuZ2VkKClgDQogKiAgIGNhbGxiYWNrIHRocm93cywgYWxsb3dpbmcgeW91IHRvIHVuZG8gYW55IHNpZGUgZWZmZWN0cy4NCiAqLw0KZnVuY3Rpb24gYmVmb3JlQXV0aFN0YXRlQ2hhbmdlZChhdXRoLCBjYWxsYmFjaywgb25BYm9ydCkgew0KICAgIHJldHVybiBnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCkuYmVmb3JlQXV0aFN0YXRlQ2hhbmdlZChjYWxsYmFjaywgb25BYm9ydCk7DQp9DQoKY29uc3QgU1RPUkFHRV9BVkFJTEFCTEVfS0VZID0gJ19fc2FrJzsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8vIFRoZXJlIGFyZSB0d28gZGlmZmVyZW50IGJyb3dzZXIgcGVyc2lzdGVuY2UgdHlwZXM6IGxvY2FsIGFuZCBzZXNzaW9uLg0KLy8gQm90aCBoYXZlIHRoZSBzYW1lIGltcGxlbWVudGF0aW9uIGJ1dCB1c2UgYSBkaWZmZXJlbnQgdW5kZXJseWluZyBzdG9yYWdlDQovLyBvYmplY3QuDQpjbGFzcyBCcm93c2VyUGVyc2lzdGVuY2VDbGFzcyB7DQogICAgY29uc3RydWN0b3Ioc3RvcmFnZVJldHJpZXZlciwgdHlwZSkgew0KICAgICAgICB0aGlzLnN0b3JhZ2VSZXRyaWV2ZXIgPSBzdG9yYWdlUmV0cmlldmVyOw0KICAgICAgICB0aGlzLnR5cGUgPSB0eXBlOw0KICAgIH0NCiAgICBfaXNBdmFpbGFibGUoKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAoIXRoaXMuc3RvcmFnZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5zdG9yYWdlLnNldEl0ZW0oU1RPUkFHRV9BVkFJTEFCTEVfS0VZLCAnMScpOw0KICAgICAgICAgICAgdGhpcy5zdG9yYWdlLnJlbW92ZUl0ZW0oU1RPUkFHRV9BVkFJTEFCTEVfS0VZKTsNCiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodHJ1ZSk7DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKF9hKSB7DQogICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGZhbHNlKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBfc2V0KGtleSwgdmFsdWUpIHsNCiAgICAgICAgdGhpcy5zdG9yYWdlLnNldEl0ZW0oa2V5LCBKU09OLnN0cmluZ2lmeSh2YWx1ZSkpOw0KICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7DQogICAgfQ0KICAgIF9nZXQoa2V5KSB7DQogICAgICAgIGNvbnN0IGpzb24gPSB0aGlzLnN0b3JhZ2UuZ2V0SXRlbShrZXkpOw0KICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGpzb24gPyBKU09OLnBhcnNlKGpzb24pIDogbnVsbCk7DQogICAgfQ0KICAgIF9yZW1vdmUoa2V5KSB7DQogICAgICAgIHRoaXMuc3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7DQogICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTsNCiAgICB9DQogICAgZ2V0IHN0b3JhZ2UoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnN0b3JhZ2VSZXRyaWV2ZXIoKTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpmdW5jdGlvbiBfaWZyYW1lQ2Fubm90U3luY1dlYlN0b3JhZ2UoKSB7DQogICAgY29uc3QgdWEgPSBnZXRVQSgpOw0KICAgIHJldHVybiBfaXNTYWZhcmkodWEpIHx8IF9pc0lPUyh1YSk7DQp9DQovLyBUaGUgcG9sbGluZyBwZXJpb2QgaW4gY2FzZSBldmVudHMgYXJlIG5vdCBzdXBwb3J0ZWQNCmNvbnN0IF9QT0xMSU5HX0lOVEVSVkFMX01TJDEgPSAxMDAwOw0KLy8gVGhlIElFIDEwIGxvY2FsU3RvcmFnZSBjcm9zcyB0YWIgc3luY2hyb25pemF0aW9uIGRlbGF5IGluIG1pbGxpc2Vjb25kcw0KY29uc3QgSUUxMF9MT0NBTF9TVE9SQUdFX1NZTkNfREVMQVkgPSAxMDsNCmNsYXNzIEJyb3dzZXJMb2NhbFBlcnNpc3RlbmNlIGV4dGVuZHMgQnJvd3NlclBlcnNpc3RlbmNlQ2xhc3Mgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICBzdXBlcigoKSA9PiB3aW5kb3cubG9jYWxTdG9yYWdlLCAiTE9DQUwiIC8qIFBlcnNpc3RlbmNlVHlwZS5MT0NBTCAqLyk7DQogICAgICAgIHRoaXMuYm91bmRFdmVudEhhbmRsZXIgPSAoZXZlbnQsIHBvbGwpID0+IHRoaXMub25TdG9yYWdlRXZlbnQoZXZlbnQsIHBvbGwpOw0KICAgICAgICB0aGlzLmxpc3RlbmVycyA9IHt9Ow0KICAgICAgICB0aGlzLmxvY2FsQ2FjaGUgPSB7fTsNCiAgICAgICAgLy8gc2V0VGltZW91dCByZXR1cm4gdmFsdWUgaXMgcGxhdGZvcm0gc3BlY2lmaWMNCiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkNCiAgICAgICAgdGhpcy5wb2xsVGltZXIgPSBudWxsOw0KICAgICAgICAvLyBTYWZhcmkgb3IgaU9TIGJyb3dzZXIgYW5kIGVtYmVkZGVkIGluIGFuIGlmcmFtZS4NCiAgICAgICAgdGhpcy5zYWZhcmlMb2NhbFN0b3JhZ2VOb3RTeW5jZWQgPSBfaWZyYW1lQ2Fubm90U3luY1dlYlN0b3JhZ2UoKSAmJiBfaXNJZnJhbWUoKTsNCiAgICAgICAgLy8gV2hldGhlciB0byB1c2UgcG9sbGluZyBpbnN0ZWFkIG9mIGRlcGVuZGluZyBvbiB3aW5kb3cgZXZlbnRzDQogICAgICAgIHRoaXMuZmFsbGJhY2tUb1BvbGxpbmcgPSBfaXNNb2JpbGVCcm93c2VyKCk7DQogICAgICAgIHRoaXMuX3Nob3VsZEFsbG93TWlncmF0aW9uID0gdHJ1ZTsNCiAgICB9DQogICAgZm9yQWxsQ2hhbmdlZEtleXMoY2IpIHsNCiAgICAgICAgLy8gQ2hlY2sgYWxsIGtleXMgd2l0aCBsaXN0ZW5lcnMgb24gdGhlbS4NCiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXModGhpcy5saXN0ZW5lcnMpKSB7DQogICAgICAgICAgICAvLyBHZXQgdmFsdWUgZnJvbSBsb2NhbFN0b3JhZ2UuDQogICAgICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IHRoaXMuc3RvcmFnZS5nZXRJdGVtKGtleSk7DQogICAgICAgICAgICBjb25zdCBvbGRWYWx1ZSA9IHRoaXMubG9jYWxDYWNoZVtrZXldOw0KICAgICAgICAgICAgLy8gSWYgbG9jYWwgbWFwIHZhbHVlIGRvZXMgbm90IG1hdGNoLCB0cmlnZ2VyIGxpc3RlbmVyIHdpdGggc3RvcmFnZSBldmVudC4NCiAgICAgICAgICAgIC8vIERpZmZlcmVudGlhdGUgdGhpcyBzaW11bGF0ZWQgZXZlbnQgZnJvbSB0aGUgcmVhbCBzdG9yYWdlIGV2ZW50Lg0KICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSkgew0KICAgICAgICAgICAgICAgIGNiKGtleSwgb2xkVmFsdWUsIG5ld1ZhbHVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBvblN0b3JhZ2VFdmVudChldmVudCwgcG9sbCA9IGZhbHNlKSB7DQogICAgICAgIC8vIEtleSB3b3VsZCBiZSBudWxsIGluIHNvbWUgc2l0dWF0aW9ucywgbGlrZSB3aGVuIGxvY2FsU3RvcmFnZSBpcyBjbGVhcmVkDQogICAgICAgIGlmICghZXZlbnQua2V5KSB7DQogICAgICAgICAgICB0aGlzLmZvckFsbENoYW5nZWRLZXlzKChrZXksIF9vbGRWYWx1ZSwgbmV3VmFsdWUpID0+IHsNCiAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeUxpc3RlbmVycyhrZXksIG5ld1ZhbHVlKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IGtleSA9IGV2ZW50LmtleTsNCiAgICAgICAgLy8gQ2hlY2sgdGhlIG1lY2hhbmlzbSBob3cgdGhpcyBldmVudCB3YXMgZGV0ZWN0ZWQuDQogICAgICAgIC8vIFRoZSBmaXJzdCBldmVudCB3aWxsIGRpY3RhdGUgdGhlIG1lY2hhbmlzbSB0byBiZSB1c2VkLg0KICAgICAgICBpZiAocG9sbCkgew0KICAgICAgICAgICAgLy8gRW52aXJvbm1lbnQgZGV0ZWN0cyBzdG9yYWdlIGNoYW5nZXMgdmlhIHBvbGxpbmcuDQogICAgICAgICAgICAvLyBSZW1vdmUgc3RvcmFnZSBldmVudCBsaXN0ZW5lciB0byBwcmV2ZW50IHBvc3NpYmxlIGV2ZW50IGR1cGxpY2F0aW9uLg0KICAgICAgICAgICAgdGhpcy5kZXRhY2hMaXN0ZW5lcigpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgLy8gRW52aXJvbm1lbnQgZGV0ZWN0cyBzdG9yYWdlIGNoYW5nZXMgdmlhIHN0b3JhZ2UgZXZlbnQgbGlzdGVuZXIuDQogICAgICAgICAgICAvLyBSZW1vdmUgcG9sbGluZyBsaXN0ZW5lciB0byBwcmV2ZW50IHBvc3NpYmxlIGV2ZW50IGR1cGxpY2F0aW9uLg0KICAgICAgICAgICAgdGhpcy5zdG9wUG9sbGluZygpOw0KICAgICAgICB9DQogICAgICAgIC8vIFNhZmFyaSBlbWJlZGRlZCBpZnJhbWUuIFN0b3JhZ2UgZXZlbnQgd2lsbCB0cmlnZ2VyIHdpdGggdGhlIGRlbHRhDQogICAgICAgIC8vIGNoYW5nZXMgYnV0IG5vIGNoYW5nZXMgd2lsbCBiZSBhcHBsaWVkIHRvIHRoZSBpZnJhbWUgbG9jYWxTdG9yYWdlLg0KICAgICAgICBpZiAodGhpcy5zYWZhcmlMb2NhbFN0b3JhZ2VOb3RTeW5jZWQpIHsNCiAgICAgICAgICAgIC8vIEdldCBjdXJyZW50IGlmcmFtZSBwYWdlIHZhbHVlLg0KICAgICAgICAgICAgY29uc3Qgc3RvcmVkVmFsdWUgPSB0aGlzLnN0b3JhZ2UuZ2V0SXRlbShrZXkpOw0KICAgICAgICAgICAgLy8gVmFsdWUgbm90IHN5bmNocm9uaXplZCwgc3luY2hyb25pemUgbWFudWFsbHkuDQogICAgICAgICAgICBpZiAoZXZlbnQubmV3VmFsdWUgIT09IHN0b3JlZFZhbHVlKSB7DQogICAgICAgICAgICAgICAgaWYgKGV2ZW50Lm5ld1ZhbHVlICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIFZhbHVlIGNoYW5nZWQgZnJvbSBjdXJyZW50IHZhbHVlLg0KICAgICAgICAgICAgICAgICAgICB0aGlzLnN0b3JhZ2Uuc2V0SXRlbShrZXksIGV2ZW50Lm5ld1ZhbHVlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIC8vIEN1cnJlbnQgdmFsdWUgZGVsZXRlZC4NCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmICh0aGlzLmxvY2FsQ2FjaGVba2V5XSA9PT0gZXZlbnQubmV3VmFsdWUgJiYgIXBvbGwpIHsNCiAgICAgICAgICAgICAgICAvLyBBbHJlYWR5IGRldGVjdGVkIGFuZCBwcm9jZXNzZWQsIGRvIG5vdCB0cmlnZ2VyIGxpc3RlbmVycyBhZ2Fpbi4NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgdHJpZ2dlckxpc3RlbmVycyA9ICgpID0+IHsNCiAgICAgICAgICAgIC8vIEtlZXAgbG9jYWwgbWFwIHVwIHRvIGRhdGUgaW4gY2FzZSBzdG9yYWdlIGV2ZW50IGlzIHRyaWdnZXJlZCBiZWZvcmUNCiAgICAgICAgICAgIC8vIHBvbGwuDQogICAgICAgICAgICBjb25zdCBzdG9yZWRWYWx1ZSA9IHRoaXMuc3RvcmFnZS5nZXRJdGVtKGtleSk7DQogICAgICAgICAgICBpZiAoIXBvbGwgJiYgdGhpcy5sb2NhbENhY2hlW2tleV0gPT09IHN0b3JlZFZhbHVlKSB7DQogICAgICAgICAgICAgICAgLy8gUmVhbCBzdG9yYWdlIGV2ZW50IHdoaWNoIGhhcyBhbHJlYWR5IGJlZW4gZGV0ZWN0ZWQsIGRvIG5vdGhpbmcuDQogICAgICAgICAgICAgICAgLy8gVGhpcyBzZWVtcyB0byB0cmlnZ2VyIGluIHNvbWUgSUUgYnJvd3NlcnMgZm9yIHNvbWUgcmVhc29uLg0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoaXMubm90aWZ5TGlzdGVuZXJzKGtleSwgc3RvcmVkVmFsdWUpOw0KICAgICAgICB9Ow0KICAgICAgICBjb25zdCBzdG9yZWRWYWx1ZSA9IHRoaXMuc3RvcmFnZS5nZXRJdGVtKGtleSk7DQogICAgICAgIGlmIChfaXNJRTEwKCkgJiYNCiAgICAgICAgICAgIHN0b3JlZFZhbHVlICE9PSBldmVudC5uZXdWYWx1ZSAmJg0KICAgICAgICAgICAgZXZlbnQubmV3VmFsdWUgIT09IGV2ZW50Lm9sZFZhbHVlKSB7DQogICAgICAgICAgICAvLyBJRSAxMCBoYXMgdGhpcyB3ZWlyZCBidWcgd2hlcmUgYSBzdG9yYWdlIGV2ZW50IHdvdWxkIHRyaWdnZXIgd2l0aCB0aGUNCiAgICAgICAgICAgIC8vIGNvcnJlY3Qga2V5LCBvbGRWYWx1ZSBhbmQgbmV3VmFsdWUgYnV0IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSkgZG9lcw0KICAgICAgICAgICAgLy8gbm90IHlpZWxkIHRoZSB1cGRhdGVkIHZhbHVlIHVudGlsIGEgZmV3IG1pbGxpc2Vjb25kcy4gVGhpcyBlbnN1cmVzDQogICAgICAgICAgICAvLyB0aGlzIHJlY292ZXJzIGZyb20gdGhhdCBzaXR1YXRpb24uDQogICAgICAgICAgICBzZXRUaW1lb3V0KHRyaWdnZXJMaXN0ZW5lcnMsIElFMTBfTE9DQUxfU1RPUkFHRV9TWU5DX0RFTEFZKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHRyaWdnZXJMaXN0ZW5lcnMoKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBub3RpZnlMaXN0ZW5lcnMoa2V5LCB2YWx1ZSkgew0KICAgICAgICB0aGlzLmxvY2FsQ2FjaGVba2V5XSA9IHZhbHVlOw0KICAgICAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLmxpc3RlbmVyc1trZXldOw0KICAgICAgICBpZiAobGlzdGVuZXJzKSB7DQogICAgICAgICAgICBmb3IgKGNvbnN0IGxpc3RlbmVyIG9mIEFycmF5LmZyb20obGlzdGVuZXJzKSkgew0KICAgICAgICAgICAgICAgIGxpc3RlbmVyKHZhbHVlID8gSlNPTi5wYXJzZSh2YWx1ZSkgOiB2YWx1ZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgc3RhcnRQb2xsaW5nKCkgew0KICAgICAgICB0aGlzLnN0b3BQb2xsaW5nKCk7DQogICAgICAgIHRoaXMucG9sbFRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4gew0KICAgICAgICAgICAgdGhpcy5mb3JBbGxDaGFuZ2VkS2V5cygoa2V5LCBvbGRWYWx1ZSwgbmV3VmFsdWUpID0+IHsNCiAgICAgICAgICAgICAgICB0aGlzLm9uU3RvcmFnZUV2ZW50KG5ldyBTdG9yYWdlRXZlbnQoJ3N0b3JhZ2UnLCB7DQogICAgICAgICAgICAgICAgICAgIGtleSwNCiAgICAgICAgICAgICAgICAgICAgb2xkVmFsdWUsDQogICAgICAgICAgICAgICAgICAgIG5ld1ZhbHVlDQogICAgICAgICAgICAgICAgfSksIA0KICAgICAgICAgICAgICAgIC8qIHBvbGwgKi8gdHJ1ZSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSwgX1BPTExJTkdfSU5URVJWQUxfTVMkMSk7DQogICAgfQ0KICAgIHN0b3BQb2xsaW5nKCkgew0KICAgICAgICBpZiAodGhpcy5wb2xsVGltZXIpIHsNCiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5wb2xsVGltZXIpOw0KICAgICAgICAgICAgdGhpcy5wb2xsVGltZXIgPSBudWxsOw0KICAgICAgICB9DQogICAgfQ0KICAgIGF0dGFjaExpc3RlbmVyKCkgew0KICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignc3RvcmFnZScsIHRoaXMuYm91bmRFdmVudEhhbmRsZXIpOw0KICAgIH0NCiAgICBkZXRhY2hMaXN0ZW5lcigpIHsNCiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3N0b3JhZ2UnLCB0aGlzLmJvdW5kRXZlbnRIYW5kbGVyKTsNCiAgICB9DQogICAgX2FkZExpc3RlbmVyKGtleSwgbGlzdGVuZXIpIHsNCiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMubGlzdGVuZXJzKS5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgIC8vIFdoZXRoZXIgYnJvd3NlciBjYW4gZGV0ZWN0IHN0b3JhZ2UgZXZlbnQgd2hlbiBpdCBoYWQgYWxyZWFkeSBiZWVuIHB1c2hlZCB0byB0aGUgYmFja2dyb3VuZC4NCiAgICAgICAgICAgIC8vIFRoaXMgbWF5IGhhcHBlbiBpbiBzb21lIG1vYmlsZSBicm93c2Vycy4gQSBsb2NhbFN0b3JhZ2UgY2hhbmdlIGluIHRoZSBmb3JlZ3JvdW5kIHdpbmRvdw0KICAgICAgICAgICAgLy8gd2lsbCBub3QgYmUgZGV0ZWN0ZWQgaW4gdGhlIGJhY2tncm91bmQgd2luZG93IHZpYSB0aGUgc3RvcmFnZSBldmVudC4NCiAgICAgICAgICAgIC8vIFRoaXMgd2FzIGRldGVjdGVkIGluIGlPUyA3LnggbW9iaWxlIGJyb3dzZXJzDQogICAgICAgICAgICBpZiAodGhpcy5mYWxsYmFja1RvUG9sbGluZykgew0KICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRQb2xsaW5nKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICB0aGlzLmF0dGFjaExpc3RlbmVyKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKCF0aGlzLmxpc3RlbmVyc1trZXldKSB7DQogICAgICAgICAgICB0aGlzLmxpc3RlbmVyc1trZXldID0gbmV3IFNldCgpOw0KICAgICAgICAgICAgLy8gUG9wdWxhdGUgdGhlIGNhY2hlIHRvIGF2b2lkIHNwdXJpb3VzbHkgdHJpZ2dlcmluZyBvbiBmaXJzdCBwb2xsLg0KICAgICAgICAgICAgdGhpcy5sb2NhbENhY2hlW2tleV0gPSB0aGlzLnN0b3JhZ2UuZ2V0SXRlbShrZXkpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMubGlzdGVuZXJzW2tleV0uYWRkKGxpc3RlbmVyKTsNCiAgICB9DQogICAgX3JlbW92ZUxpc3RlbmVyKGtleSwgbGlzdGVuZXIpIHsNCiAgICAgICAgaWYgKHRoaXMubGlzdGVuZXJzW2tleV0pIHsNCiAgICAgICAgICAgIHRoaXMubGlzdGVuZXJzW2tleV0uZGVsZXRlKGxpc3RlbmVyKTsNCiAgICAgICAgICAgIGlmICh0aGlzLmxpc3RlbmVyc1trZXldLnNpemUgPT09IDApIHsNCiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5saXN0ZW5lcnNba2V5XTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5saXN0ZW5lcnMpLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgdGhpcy5kZXRhY2hMaXN0ZW5lcigpOw0KICAgICAgICAgICAgdGhpcy5zdG9wUG9sbGluZygpOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8vIFVwZGF0ZSBsb2NhbCBjYWNoZSBvbiBiYXNlIG9wZXJhdGlvbnM6DQogICAgYXN5bmMgX3NldChrZXksIHZhbHVlKSB7DQogICAgICAgIGF3YWl0IHN1cGVyLl9zZXQoa2V5LCB2YWx1ZSk7DQogICAgICAgIHRoaXMubG9jYWxDYWNoZVtrZXldID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpOw0KICAgIH0NCiAgICBhc3luYyBfZ2V0KGtleSkgew0KICAgICAgICBjb25zdCB2YWx1ZSA9IGF3YWl0IHN1cGVyLl9nZXQoa2V5KTsNCiAgICAgICAgdGhpcy5sb2NhbENhY2hlW2tleV0gPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7DQogICAgICAgIHJldHVybiB2YWx1ZTsNCiAgICB9DQogICAgYXN5bmMgX3JlbW92ZShrZXkpIHsNCiAgICAgICAgYXdhaXQgc3VwZXIuX3JlbW92ZShrZXkpOw0KICAgICAgICBkZWxldGUgdGhpcy5sb2NhbENhY2hlW2tleV07DQogICAgfQ0KfQ0KQnJvd3NlckxvY2FsUGVyc2lzdGVuY2UudHlwZSA9ICdMT0NBTCc7DQovKioNCiAqIEFuIGltcGxlbWVudGF0aW9uIG9mIHtAbGluayBQZXJzaXN0ZW5jZX0gb2YgdHlwZSBgTE9DQUxgIHVzaW5nIGBsb2NhbFN0b3JhZ2VgDQogKiBmb3IgdGhlIHVuZGVybHlpbmcgc3RvcmFnZS4NCiAqDQogKiBAcHVibGljDQogKi8NCmNvbnN0IGJyb3dzZXJMb2NhbFBlcnNpc3RlbmNlID0gQnJvd3NlckxvY2FsUGVyc2lzdGVuY2U7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBCcm93c2VyU2Vzc2lvblBlcnNpc3RlbmNlIGV4dGVuZHMgQnJvd3NlclBlcnNpc3RlbmNlQ2xhc3Mgew0KICAgIGNvbnN0cnVjdG9yKCkgew0KICAgICAgICBzdXBlcigoKSA9PiB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UsICJTRVNTSU9OIiAvKiBQZXJzaXN0ZW5jZVR5cGUuU0VTU0lPTiAqLyk7DQogICAgfQ0KICAgIF9hZGRMaXN0ZW5lcihfa2V5LCBfbGlzdGVuZXIpIHsNCiAgICAgICAgLy8gTGlzdGVuZXJzIGFyZSBub3Qgc3VwcG9ydGVkIGZvciBzZXNzaW9uIHN0b3JhZ2Ugc2luY2UgaXQgY2Fubm90IGJlIHNoYXJlZCBhY3Jvc3Mgd2luZG93cw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIF9yZW1vdmVMaXN0ZW5lcihfa2V5LCBfbGlzdGVuZXIpIHsNCiAgICAgICAgLy8gTGlzdGVuZXJzIGFyZSBub3Qgc3VwcG9ydGVkIGZvciBzZXNzaW9uIHN0b3JhZ2Ugc2luY2UgaXQgY2Fubm90IGJlIHNoYXJlZCBhY3Jvc3Mgd2luZG93cw0KICAgICAgICByZXR1cm47DQogICAgfQ0KfQ0KQnJvd3NlclNlc3Npb25QZXJzaXN0ZW5jZS50eXBlID0gJ1NFU1NJT04nOw0KLyoqDQogKiBBbiBpbXBsZW1lbnRhdGlvbiBvZiB7QGxpbmsgUGVyc2lzdGVuY2V9IG9mIGBTRVNTSU9OYCB1c2luZyBgc2Vzc2lvblN0b3JhZ2VgDQogKiBmb3IgdGhlIHVuZGVybHlpbmcgc3RvcmFnZS4NCiAqDQogKiBAcHVibGljDQogKi8NCmNvbnN0IGJyb3dzZXJTZXNzaW9uUGVyc2lzdGVuY2UgPSBCcm93c2VyU2Vzc2lvblBlcnNpc3RlbmNlOwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBTaGltIGZvciBQcm9taXNlLmFsbFNldHRsZWQsIG5vdGUgdGhlIHNsaWdodGx5IGRpZmZlcmVudCBmb3JtYXQgb2YgYGZ1bGZpbGxlZGAgdnMgYHN0YXR1c2AuDQogKg0KICogQHBhcmFtIHByb21pc2VzIC0gQXJyYXkgb2YgcHJvbWlzZXMgdG8gd2FpdCBvbi4NCiAqLw0KZnVuY3Rpb24gX2FsbFNldHRsZWQocHJvbWlzZXMpIHsNCiAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMubWFwKGFzeW5jIChwcm9taXNlKSA9PiB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGF3YWl0IHByb21pc2U7DQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgIGZ1bGZpbGxlZDogdHJ1ZSwNCiAgICAgICAgICAgICAgICB2YWx1ZQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAocmVhc29uKSB7DQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgIGZ1bGZpbGxlZDogZmFsc2UsDQogICAgICAgICAgICAgICAgcmVhc29uDQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQogICAgfSkpOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBJbnRlcmZhY2UgY2xhc3MgZm9yIHJlY2VpdmluZyBtZXNzYWdlcy4NCiAqDQogKi8NCmNsYXNzIFJlY2VpdmVyIHsNCiAgICBjb25zdHJ1Y3RvcihldmVudFRhcmdldCkgew0KICAgICAgICB0aGlzLmV2ZW50VGFyZ2V0ID0gZXZlbnRUYXJnZXQ7DQogICAgICAgIHRoaXMuaGFuZGxlcnNNYXAgPSB7fTsNCiAgICAgICAgdGhpcy5ib3VuZEV2ZW50SGFuZGxlciA9IHRoaXMuaGFuZGxlRXZlbnQuYmluZCh0aGlzKTsNCiAgICB9DQogICAgLyoqDQogICAgICogT2J0YWluIGFuIGluc3RhbmNlIG9mIGEgUmVjZWl2ZXIgZm9yIGEgZ2l2ZW4gZXZlbnQgdGFyZ2V0LCBpZiBub25lIGV4aXN0cyBpdCB3aWxsIGJlIGNyZWF0ZWQuDQogICAgICoNCiAgICAgKiBAcGFyYW0gZXZlbnRUYXJnZXQgLSBBbiBldmVudCB0YXJnZXQgKHN1Y2ggYXMgd2luZG93IG9yIHNlbGYpIHRocm91Z2ggd2hpY2ggdGhlIHVuZGVybHlpbmcNCiAgICAgKiBtZXNzYWdlcyB3aWxsIGJlIHJlY2VpdmVkLg0KICAgICAqLw0KICAgIHN0YXRpYyBfZ2V0SW5zdGFuY2UoZXZlbnRUYXJnZXQpIHsNCiAgICAgICAgLy8gVGhlIHJlc3VsdHMgYXJlIHN0b3JlZCBpbiBhbiBhcnJheSBzaW5jZSBvYmplY3RzIGNhbid0IGJlIGtleXMgZm9yIG90aGVyDQogICAgICAgIC8vIG9iamVjdHMuIEluIGFkZGl0aW9uLCBzZXR0aW5nIGEgdW5pcXVlIHByb3BlcnR5IG9uIGFuIGV2ZW50IHRhcmdldCBhcyBhDQogICAgICAgIC8vIGhhc2ggbWFwIGtleSBtYXkgbm90IGJlIGFsbG93ZWQgZHVlIHRvIENPUlMgcmVzdHJpY3Rpb25zLg0KICAgICAgICBjb25zdCBleGlzdGluZ0luc3RhbmNlID0gdGhpcy5yZWNlaXZlcnMuZmluZChyZWNlaXZlciA9PiByZWNlaXZlci5pc0xpc3RlbmluZ3RvKGV2ZW50VGFyZ2V0KSk7DQogICAgICAgIGlmIChleGlzdGluZ0luc3RhbmNlKSB7DQogICAgICAgICAgICByZXR1cm4gZXhpc3RpbmdJbnN0YW5jZTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBuZXdJbnN0YW5jZSA9IG5ldyBSZWNlaXZlcihldmVudFRhcmdldCk7DQogICAgICAgIHRoaXMucmVjZWl2ZXJzLnB1c2gobmV3SW5zdGFuY2UpOw0KICAgICAgICByZXR1cm4gbmV3SW5zdGFuY2U7DQogICAgfQ0KICAgIGlzTGlzdGVuaW5ndG8oZXZlbnRUYXJnZXQpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZXZlbnRUYXJnZXQgPT09IGV2ZW50VGFyZ2V0Ow0KICAgIH0NCiAgICAvKioNCiAgICAgKiBGYW5zIG91dCBhIE1lc3NhZ2VFdmVudCB0byB0aGUgYXBwcm9wcmlhdGUgbGlzdGVuZXJzLg0KICAgICAqDQogICAgICogQHJlbWFya3MNCiAgICAgKiBTZW5kcyBhbiB7QGxpbmsgU3RhdHVzLkFDS30gdXBvbiByZWNlaXB0IGFuZCBhIHtAbGluayBTdGF0dXMuRE9ORX0gb25jZSBhbGwgaGFuZGxlcnMgaGF2ZQ0KICAgICAqIGZpbmlzaGVkIHByb2Nlc3NpbmcuDQogICAgICoNCiAgICAgKiBAcGFyYW0gZXZlbnQgLSBUaGUgTWVzc2FnZUV2ZW50Lg0KICAgICAqDQogICAgICovDQogICAgYXN5bmMgaGFuZGxlRXZlbnQoZXZlbnQpIHsNCiAgICAgICAgY29uc3QgbWVzc2FnZUV2ZW50ID0gZXZlbnQ7DQogICAgICAgIGNvbnN0IHsgZXZlbnRJZCwgZXZlbnRUeXBlLCBkYXRhIH0gPSBtZXNzYWdlRXZlbnQuZGF0YTsNCiAgICAgICAgY29uc3QgaGFuZGxlcnMgPSB0aGlzLmhhbmRsZXJzTWFwW2V2ZW50VHlwZV07DQogICAgICAgIGlmICghKGhhbmRsZXJzID09PSBudWxsIHx8IGhhbmRsZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBoYW5kbGVycy5zaXplKSkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIG1lc3NhZ2VFdmVudC5wb3J0c1swXS5wb3N0TWVzc2FnZSh7DQogICAgICAgICAgICBzdGF0dXM6ICJhY2siIC8qIF9TdGF0dXMuQUNLICovLA0KICAgICAgICAgICAgZXZlbnRJZCwNCiAgICAgICAgICAgIGV2ZW50VHlwZQ0KICAgICAgICB9KTsNCiAgICAgICAgY29uc3QgcHJvbWlzZXMgPSBBcnJheS5mcm9tKGhhbmRsZXJzKS5tYXAoYXN5bmMgKGhhbmRsZXIpID0+IGhhbmRsZXIobWVzc2FnZUV2ZW50Lm9yaWdpbiwgZGF0YSkpOw0KICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IF9hbGxTZXR0bGVkKHByb21pc2VzKTsNCiAgICAgICAgbWVzc2FnZUV2ZW50LnBvcnRzWzBdLnBvc3RNZXNzYWdlKHsNCiAgICAgICAgICAgIHN0YXR1czogImRvbmUiIC8qIF9TdGF0dXMuRE9ORSAqLywNCiAgICAgICAgICAgIGV2ZW50SWQsDQogICAgICAgICAgICBldmVudFR5cGUsDQogICAgICAgICAgICByZXNwb25zZQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgLyoqDQogICAgICogU3Vic2NyaWJlIGFuIGV2ZW50IGhhbmRsZXIgZm9yIGEgcGFydGljdWxhciBldmVudC4NCiAgICAgKg0KICAgICAqIEBwYXJhbSBldmVudFR5cGUgLSBFdmVudCBuYW1lIHRvIHN1YnNjcmliZSB0by4NCiAgICAgKiBAcGFyYW0gZXZlbnRIYW5kbGVyIC0gVGhlIGV2ZW50IGhhbmRsZXIgd2hpY2ggc2hvdWxkIHJlY2VpdmUgdGhlIGV2ZW50cy4NCiAgICAgKg0KICAgICAqLw0KICAgIF9zdWJzY3JpYmUoZXZlbnRUeXBlLCBldmVudEhhbmRsZXIpIHsNCiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuaGFuZGxlcnNNYXApLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgdGhpcy5ldmVudFRhcmdldC5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgdGhpcy5ib3VuZEV2ZW50SGFuZGxlcik7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCF0aGlzLmhhbmRsZXJzTWFwW2V2ZW50VHlwZV0pIHsNCiAgICAgICAgICAgIHRoaXMuaGFuZGxlcnNNYXBbZXZlbnRUeXBlXSA9IG5ldyBTZXQoKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmhhbmRsZXJzTWFwW2V2ZW50VHlwZV0uYWRkKGV2ZW50SGFuZGxlcik7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFVuc3Vic2NyaWJlIGFuIGV2ZW50IGhhbmRsZXIgZnJvbSBhIHBhcnRpY3VsYXIgZXZlbnQuDQogICAgICoNCiAgICAgKiBAcGFyYW0gZXZlbnRUeXBlIC0gRXZlbnQgbmFtZSB0byB1bnN1YnNjcmliZSBmcm9tLg0KICAgICAqIEBwYXJhbSBldmVudEhhbmRsZXIgLSBPcHRpbm9hbCBldmVudCBoYW5kbGVyLCBpZiBub25lIHByb3ZpZGVkLCB1bnN1YnNjcmliZSBhbGwgaGFuZGxlcnMgb24gdGhpcyBldmVudC4NCiAgICAgKg0KICAgICAqLw0KICAgIF91bnN1YnNjcmliZShldmVudFR5cGUsIGV2ZW50SGFuZGxlcikgew0KICAgICAgICBpZiAodGhpcy5oYW5kbGVyc01hcFtldmVudFR5cGVdICYmIGV2ZW50SGFuZGxlcikgew0KICAgICAgICAgICAgdGhpcy5oYW5kbGVyc01hcFtldmVudFR5cGVdLmRlbGV0ZShldmVudEhhbmRsZXIpOw0KICAgICAgICB9DQogICAgICAgIGlmICghZXZlbnRIYW5kbGVyIHx8IHRoaXMuaGFuZGxlcnNNYXBbZXZlbnRUeXBlXS5zaXplID09PSAwKSB7DQogICAgICAgICAgICBkZWxldGUgdGhpcy5oYW5kbGVyc01hcFtldmVudFR5cGVdOw0KICAgICAgICB9DQogICAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLmhhbmRsZXJzTWFwKS5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgIHRoaXMuZXZlbnRUYXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIHRoaXMuYm91bmRFdmVudEhhbmRsZXIpOw0KICAgICAgICB9DQogICAgfQ0KfQ0KUmVjZWl2ZXIucmVjZWl2ZXJzID0gW107CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpmdW5jdGlvbiBfZ2VuZXJhdGVFdmVudElkKHByZWZpeCA9ICcnLCBkaWdpdHMgPSAxMCkgew0KICAgIGxldCByYW5kb20gPSAnJzsNCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRpZ2l0czsgaSsrKSB7DQogICAgICAgIHJhbmRvbSArPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7DQogICAgfQ0KICAgIHJldHVybiBwcmVmaXggKyByYW5kb207DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIEludGVyZmFjZSBmb3Igc2VuZGluZyBtZXNzYWdlcyBhbmQgd2FpdGluZyBmb3IgYSBjb21wbGV0aW9uIHJlc3BvbnNlLg0KICoNCiAqLw0KY2xhc3MgU2VuZGVyIHsNCiAgICBjb25zdHJ1Y3Rvcih0YXJnZXQpIHsNCiAgICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7DQogICAgICAgIHRoaXMuaGFuZGxlcnMgPSBuZXcgU2V0KCk7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFVuc3Vic2NyaWJlIHRoZSBoYW5kbGVyIGFuZCByZW1vdmUgaXQgZnJvbSBvdXIgdHJhY2tpbmcgU2V0Lg0KICAgICAqDQogICAgICogQHBhcmFtIGhhbmRsZXIgLSBUaGUgaGFuZGxlciB0byB1bnN1YnNjcmliZS4NCiAgICAgKi8NCiAgICByZW1vdmVNZXNzYWdlSGFuZGxlcihoYW5kbGVyKSB7DQogICAgICAgIGlmIChoYW5kbGVyLm1lc3NhZ2VDaGFubmVsKSB7DQogICAgICAgICAgICBoYW5kbGVyLm1lc3NhZ2VDaGFubmVsLnBvcnQxLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBoYW5kbGVyLm9uTWVzc2FnZSk7DQogICAgICAgICAgICBoYW5kbGVyLm1lc3NhZ2VDaGFubmVsLnBvcnQxLmNsb3NlKCk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5oYW5kbGVycy5kZWxldGUoaGFuZGxlcik7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIFNlbmQgYSBtZXNzYWdlIHRvIHRoZSBSZWNlaXZlciBsb2NhdGVkIGF0IHtAbGluayB0YXJnZXR9Lg0KICAgICAqDQogICAgICogQHJlbWFya3MNCiAgICAgKiBXZSdsbCBmaXJzdCB3YWl0IGEgYml0IGZvciBhbiBBQ0sgLCBpZiB3ZSBnZXQgb25lIHdlIHdpbGwgd2FpdCBzaWduaWZpY2FudGx5IGxvbmdlciB1bnRpbCB0aGUNCiAgICAgKiByZWNlaXZlciBoYXMgaGFkIGEgY2hhbmNlIHRvIGZ1bGx5IHByb2Nlc3MgdGhlIGV2ZW50Lg0KICAgICAqDQogICAgICogQHBhcmFtIGV2ZW50VHlwZSAtIFR5cGUgb2YgZXZlbnQgdG8gc2VuZC4NCiAgICAgKiBAcGFyYW0gZGF0YSAtIFRoZSBwYXlsb2FkIG9mIHRoZSBldmVudC4NCiAgICAgKiBAcGFyYW0gdGltZW91dCAtIFRpbWVvdXQgZm9yIHdhaXRpbmcgb24gYW4gQUNLIGZyb20gdGhlIHJlY2VpdmVyLg0KICAgICAqDQogICAgICogQHJldHVybnMgQW4gYXJyYXkgb2Ygc2V0dGxlZCBwcm9taXNlcyBmcm9tIGFsbCB0aGUgaGFuZGxlcnMgdGhhdCB3ZXJlIGxpc3RlbmluZyBvbiB0aGUgcmVjZWl2ZXIuDQogICAgICovDQogICAgYXN5bmMgX3NlbmQoZXZlbnRUeXBlLCBkYXRhLCB0aW1lb3V0ID0gNTAgLyogX1RpbWVvdXREdXJhdGlvbi5BQ0sgKi8pIHsNCiAgICAgICAgY29uc3QgbWVzc2FnZUNoYW5uZWwgPSB0eXBlb2YgTWVzc2FnZUNoYW5uZWwgIT09ICd1bmRlZmluZWQnID8gbmV3IE1lc3NhZ2VDaGFubmVsKCkgOiBudWxsOw0KICAgICAgICBpZiAoIW1lc3NhZ2VDaGFubmVsKSB7DQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImNvbm5lY3Rpb25fdW5hdmFpbGFibGUiIC8qIF9NZXNzYWdlRXJyb3IuQ09OTkVDVElPTl9VTkFWQUlMQUJMRSAqLyk7DQogICAgICAgIH0NCiAgICAgICAgLy8gTm9kZSB0aW1lcnMgYW5kIGJyb3dzZXIgdGltZXJzIHJldHVybiBmdW5kYW1lbnRhbGx5IGRpZmZlcmVudCB0eXBlcy4NCiAgICAgICAgLy8gV2UgZG9uJ3QgYWN0dWFsbHkgY2FyZSB3aGF0IHRoZSB2YWx1ZSBpcyBidXQgVFMgd29uJ3QgYWNjZXB0IHVua25vd24gYW5kDQogICAgICAgIC8vIHdlIGNhbid0IGNhc3QgcHJvcGVybHkgaW4gYm90aCBlbnZpcm9ubWVudHMuDQogICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55DQogICAgICAgIGxldCBjb21wbGV0aW9uVGltZXI7DQogICAgICAgIGxldCBoYW5kbGVyOw0KICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICAgICAgY29uc3QgZXZlbnRJZCA9IF9nZW5lcmF0ZUV2ZW50SWQoJycsIDIwKTsNCiAgICAgICAgICAgIG1lc3NhZ2VDaGFubmVsLnBvcnQxLnN0YXJ0KCk7DQogICAgICAgICAgICBjb25zdCBhY2tUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoInVuc3VwcG9ydGVkX2V2ZW50IiAvKiBfTWVzc2FnZUVycm9yLlVOU1VQUE9SVEVEX0VWRU5UICovKSk7DQogICAgICAgICAgICB9LCB0aW1lb3V0KTsNCiAgICAgICAgICAgIGhhbmRsZXIgPSB7DQogICAgICAgICAgICAgICAgbWVzc2FnZUNoYW5uZWwsDQogICAgICAgICAgICAgICAgb25NZXNzYWdlKGV2ZW50KSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2VFdmVudCA9IGV2ZW50Ow0KICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZUV2ZW50LmRhdGEuZXZlbnRJZCAhPT0gZXZlbnRJZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAobWVzc2FnZUV2ZW50LmRhdGEuc3RhdHVzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJhY2siIC8qIF9TdGF0dXMuQUNLICovOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSByZWNlaXZlciBzaG91bGQgQUNLIGZpcnN0Lg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChhY2tUaW1lcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGlvblRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoInRpbWVvdXQiIC8qIF9NZXNzYWdlRXJyb3IuVElNRU9VVCAqLykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDMwMDAgLyogX1RpbWVvdXREdXJhdGlvbi5DT01QTEVUSU9OICovKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImRvbmUiIC8qIF9TdGF0dXMuRE9ORSAqLzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBPbmNlIHRoZSByZWNlaXZlcidzIGhhbmRsZXJzIGFyZSBmaW5pc2hlZCB3ZSB3aWxsIGdldCB0aGUgcmVzdWx0cy4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoY29tcGxldGlvblRpbWVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG1lc3NhZ2VFdmVudC5kYXRhLnJlc3BvbnNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGFja1RpbWVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoY29tcGxldGlvblRpbWVyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCJpbnZhbGlkX3Jlc3BvbnNlIiAvKiBfTWVzc2FnZUVycm9yLklOVkFMSURfUkVTUE9OU0UgKi8pKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgICAgICB0aGlzLmhhbmRsZXJzLmFkZChoYW5kbGVyKTsNCiAgICAgICAgICAgIG1lc3NhZ2VDaGFubmVsLnBvcnQxLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBoYW5kbGVyLm9uTWVzc2FnZSk7DQogICAgICAgICAgICB0aGlzLnRhcmdldC5wb3N0TWVzc2FnZSh7DQogICAgICAgICAgICAgICAgZXZlbnRUeXBlLA0KICAgICAgICAgICAgICAgIGV2ZW50SWQsDQogICAgICAgICAgICAgICAgZGF0YQ0KICAgICAgICAgICAgfSwgW21lc3NhZ2VDaGFubmVsLnBvcnQyXSk7DQogICAgICAgIH0pLmZpbmFsbHkoKCkgPT4gew0KICAgICAgICAgICAgaWYgKGhhbmRsZXIpIHsNCiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZU1lc3NhZ2VIYW5kbGVyKGhhbmRsZXIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQovKioNCiAqIExhenkgYWNjZXNzb3IgZm9yIHdpbmRvdywgc2luY2UgdGhlIGNvbXBhdCBsYXllciB3b24ndCB0cmVlIHNoYWtlIHRoaXMgb3V0LA0KICogd2UgbmVlZCB0byBtYWtlIHN1cmUgbm90IHRvIG1lc3Mgd2l0aCB3aW5kb3cgdW5sZXNzIHdlIGhhdmUgdG8NCiAqLw0KZnVuY3Rpb24gX3dpbmRvdyQxKCkgew0KICAgIHJldHVybiB3aW5kb3c7DQp9DQpmdW5jdGlvbiBfc2V0V2luZG93TG9jYXRpb24odXJsKSB7DQogICAgX3dpbmRvdyQxKCkubG9jYXRpb24uaHJlZiA9IHVybDsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMuDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpmdW5jdGlvbiBfaXNXb3JrZXIoKSB7DQogICAgcmV0dXJuICh0eXBlb2YgX3dpbmRvdyQxKClbJ1dvcmtlckdsb2JhbFNjb3BlJ10gIT09ICd1bmRlZmluZWQnICYmDQogICAgICAgIHR5cGVvZiBfd2luZG93JDEoKVsnaW1wb3J0U2NyaXB0cyddID09PSAnZnVuY3Rpb24nKTsNCn0NCmFzeW5jIGZ1bmN0aW9uIF9nZXRBY3RpdmVTZXJ2aWNlV29ya2VyKCkgew0KICAgIGlmICghKG5hdmlnYXRvciA9PT0gbnVsbCB8fCBuYXZpZ2F0b3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgdHJ5IHsNCiAgICAgICAgY29uc3QgcmVnaXN0cmF0aW9uID0gYXdhaXQgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVhZHk7DQogICAgICAgIHJldHVybiByZWdpc3RyYXRpb24uYWN0aXZlOw0KICAgIH0NCiAgICBjYXRjaCAoX2EpIHsNCiAgICAgICAgcmV0dXJuIG51bGw7DQogICAgfQ0KfQ0KZnVuY3Rpb24gX2dldFNlcnZpY2VXb3JrZXJDb250cm9sbGVyKCkgew0KICAgIHZhciBfYTsNCiAgICByZXR1cm4gKChfYSA9IG5hdmlnYXRvciA9PT0gbnVsbCB8fCBuYXZpZ2F0b3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY29udHJvbGxlcikgfHwgbnVsbDsNCn0NCmZ1bmN0aW9uIF9nZXRXb3JrZXJHbG9iYWxTY29wZSgpIHsNCiAgICByZXR1cm4gX2lzV29ya2VyKCkgPyBzZWxmIDogbnVsbDsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNvbnN0IERCX05BTUUgPSAnZmlyZWJhc2VMb2NhbFN0b3JhZ2VEYic7DQpjb25zdCBEQl9WRVJTSU9OID0gMTsNCmNvbnN0IERCX09CSkVDVFNUT1JFX05BTUUgPSAnZmlyZWJhc2VMb2NhbFN0b3JhZ2UnOw0KY29uc3QgREJfREFUQV9LRVlQQVRIID0gJ2ZiYXNlX2tleSc7DQovKioNCiAqIFByb21pc2Ugd3JhcHBlciBmb3IgSURCUmVxdWVzdA0KICoNCiAqIFVuZm9ydHVuYXRlbHkgd2UgY2FuJ3QgY2xlYW5seSBleHRlbmQgUHJvbWlzZTxUPiBzaW5jZSBwcm9taXNlcyBhcmUgbm90IGNhbGxhYmxlIGluIEVTNg0KICoNCiAqLw0KY2xhc3MgREJQcm9taXNlIHsNCiAgICBjb25zdHJ1Y3RvcihyZXF1ZXN0KSB7DQogICAgICAgIHRoaXMucmVxdWVzdCA9IHJlcXVlc3Q7DQogICAgfQ0KICAgIHRvUHJvbWlzZSgpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsNCiAgICAgICAgICAgIHRoaXMucmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdzdWNjZXNzJywgKCkgPT4gew0KICAgICAgICAgICAgICAgIHJlc29sdmUodGhpcy5yZXF1ZXN0LnJlc3VsdCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIHRoaXMucmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsICgpID0+IHsNCiAgICAgICAgICAgICAgICByZWplY3QodGhpcy5yZXF1ZXN0LmVycm9yKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCiAgICB9DQp9DQpmdW5jdGlvbiBnZXRPYmplY3RTdG9yZShkYiwgaXNSZWFkV3JpdGUpIHsNCiAgICByZXR1cm4gZGINCiAgICAgICAgLnRyYW5zYWN0aW9uKFtEQl9PQkpFQ1RTVE9SRV9OQU1FXSwgaXNSZWFkV3JpdGUgPyAncmVhZHdyaXRlJyA6ICdyZWFkb25seScpDQogICAgICAgIC5vYmplY3RTdG9yZShEQl9PQkpFQ1RTVE9SRV9OQU1FKTsNCn0NCmZ1bmN0aW9uIF9kZWxldGVEYXRhYmFzZSgpIHsNCiAgICBjb25zdCByZXF1ZXN0ID0gaW5kZXhlZERCLmRlbGV0ZURhdGFiYXNlKERCX05BTUUpOw0KICAgIHJldHVybiBuZXcgREJQcm9taXNlKHJlcXVlc3QpLnRvUHJvbWlzZSgpOw0KfQ0KZnVuY3Rpb24gX29wZW5EYXRhYmFzZSgpIHsNCiAgICBjb25zdCByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oREJfTkFNRSwgREJfVkVSU0lPTik7DQogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsNCiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsICgpID0+IHsNCiAgICAgICAgICAgIHJlamVjdChyZXF1ZXN0LmVycm9yKTsNCiAgICAgICAgfSk7DQogICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcigndXBncmFkZW5lZWRlZCcsICgpID0+IHsNCiAgICAgICAgICAgIGNvbnN0IGRiID0gcmVxdWVzdC5yZXN1bHQ7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGRiLmNyZWF0ZU9iamVjdFN0b3JlKERCX09CSkVDVFNUT1JFX05BTUUsIHsga2V5UGF0aDogREJfREFUQV9LRVlQQVRIIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICByZWplY3QoZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3N1Y2Nlc3MnLCBhc3luYyAoKSA9PiB7DQogICAgICAgICAgICBjb25zdCBkYiA9IHJlcXVlc3QucmVzdWx0Ow0KICAgICAgICAgICAgLy8gU3RyYW5nZSBidWcgdGhhdCBvY2N1cnMgaW4gRmlyZWZveCB3aGVuIG11bHRpcGxlIHRhYnMgYXJlIG9wZW5lZCBhdCB0aGUNCiAgICAgICAgICAgIC8vIHNhbWUgdGltZS4gVGhlIG9ubHkgd2F5IHRvIHJlY292ZXIgc2VlbXMgdG8gYmUgZGVsZXRpbmcgdGhlIGRhdGFiYXNlDQogICAgICAgICAgICAvLyBhbmQgcmUtaW5pdGlhbGl6aW5nIGl0Lg0KICAgICAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2ZpcmViYXNlL2ZpcmViYXNlLWpzLXNkay9pc3N1ZXMvNjM0DQogICAgICAgICAgICBpZiAoIWRiLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoREJfT0JKRUNUU1RPUkVfTkFNRSkpIHsNCiAgICAgICAgICAgICAgICAvLyBOZWVkIHRvIGNsb3NlIHRoZSBkYXRhYmFzZSBvciBlbHNlIHlvdSBnZXQgYSBgYmxvY2tlZGAgZXZlbnQNCiAgICAgICAgICAgICAgICBkYi5jbG9zZSgpOw0KICAgICAgICAgICAgICAgIGF3YWl0IF9kZWxldGVEYXRhYmFzZSgpOw0KICAgICAgICAgICAgICAgIHJlc29sdmUoYXdhaXQgX29wZW5EYXRhYmFzZSgpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIHJlc29sdmUoZGIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9KTsNCn0NCmFzeW5jIGZ1bmN0aW9uIF9wdXRPYmplY3QoZGIsIGtleSwgdmFsdWUpIHsNCiAgICBjb25zdCByZXF1ZXN0ID0gZ2V0T2JqZWN0U3RvcmUoZGIsIHRydWUpLnB1dCh7DQogICAgICAgIFtEQl9EQVRBX0tFWVBBVEhdOiBrZXksDQogICAgICAgIHZhbHVlDQogICAgfSk7DQogICAgcmV0dXJuIG5ldyBEQlByb21pc2UocmVxdWVzdCkudG9Qcm9taXNlKCk7DQp9DQphc3luYyBmdW5jdGlvbiBnZXRPYmplY3QoZGIsIGtleSkgew0KICAgIGNvbnN0IHJlcXVlc3QgPSBnZXRPYmplY3RTdG9yZShkYiwgZmFsc2UpLmdldChrZXkpOw0KICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBuZXcgREJQcm9taXNlKHJlcXVlc3QpLnRvUHJvbWlzZSgpOw0KICAgIHJldHVybiBkYXRhID09PSB1bmRlZmluZWQgPyBudWxsIDogZGF0YS52YWx1ZTsNCn0NCmZ1bmN0aW9uIF9kZWxldGVPYmplY3QoZGIsIGtleSkgew0KICAgIGNvbnN0IHJlcXVlc3QgPSBnZXRPYmplY3RTdG9yZShkYiwgdHJ1ZSkuZGVsZXRlKGtleSk7DQogICAgcmV0dXJuIG5ldyBEQlByb21pc2UocmVxdWVzdCkudG9Qcm9taXNlKCk7DQp9DQpjb25zdCBfUE9MTElOR19JTlRFUlZBTF9NUyA9IDgwMDsNCmNvbnN0IF9UUkFOU0FDVElPTl9SRVRSWV9DT1VOVCA9IDM7DQpjbGFzcyBJbmRleGVkREJMb2NhbFBlcnNpc3RlbmNlIHsNCiAgICBjb25zdHJ1Y3RvcigpIHsNCiAgICAgICAgdGhpcy50eXBlID0gIkxPQ0FMIiAvKiBQZXJzaXN0ZW5jZVR5cGUuTE9DQUwgKi87DQogICAgICAgIHRoaXMuX3Nob3VsZEFsbG93TWlncmF0aW9uID0gdHJ1ZTsNCiAgICAgICAgdGhpcy5saXN0ZW5lcnMgPSB7fTsNCiAgICAgICAgdGhpcy5sb2NhbENhY2hlID0ge307DQogICAgICAgIC8vIHNldFRpbWVvdXQgcmV0dXJuIHZhbHVlIGlzIHBsYXRmb3JtIHNwZWNpZmljDQogICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55DQogICAgICAgIHRoaXMucG9sbFRpbWVyID0gbnVsbDsNCiAgICAgICAgdGhpcy5wZW5kaW5nV3JpdGVzID0gMDsNCiAgICAgICAgdGhpcy5yZWNlaXZlciA9IG51bGw7DQogICAgICAgIHRoaXMuc2VuZGVyID0gbnVsbDsNCiAgICAgICAgdGhpcy5zZXJ2aWNlV29ya2VyUmVjZWl2ZXJBdmFpbGFibGUgPSBmYWxzZTsNCiAgICAgICAgdGhpcy5hY3RpdmVTZXJ2aWNlV29ya2VyID0gbnVsbDsNCiAgICAgICAgLy8gRmlyZSAmIGZvcmdldCB0aGUgc2VydmljZSB3b3JrZXIgcmVnaXN0cmF0aW9uIGFzIGl0IG1heSBuZXZlciByZXNvbHZlDQogICAgICAgIHRoaXMuX3dvcmtlckluaXRpYWxpemF0aW9uUHJvbWlzZSA9DQogICAgICAgICAgICB0aGlzLmluaXRpYWxpemVTZXJ2aWNlV29ya2VyTWVzc2FnaW5nKCkudGhlbigoKSA9PiB7IH0sICgpID0+IHsgfSk7DQogICAgfQ0KICAgIGFzeW5jIF9vcGVuRGIoKSB7DQogICAgICAgIGlmICh0aGlzLmRiKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5kYjsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmRiID0gYXdhaXQgX29wZW5EYXRhYmFzZSgpOw0KICAgICAgICByZXR1cm4gdGhpcy5kYjsNCiAgICB9DQogICAgYXN5bmMgX3dpdGhSZXRyaWVzKG9wKSB7DQogICAgICAgIGxldCBudW1BdHRlbXB0cyA9IDA7DQogICAgICAgIHdoaWxlICh0cnVlKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGNvbnN0IGRiID0gYXdhaXQgdGhpcy5fb3BlbkRiKCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IG9wKGRiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgaWYgKG51bUF0dGVtcHRzKysgPiBfVFJBTlNBQ1RJT05fUkVUUllfQ09VTlQpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHRoaXMuZGIpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYi5jbG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLmRiID0gdW5kZWZpbmVkOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAvLyBUT0RPOiBjb25zaWRlciBhZGRpbmcgZXhwb25lbnRpYWwgYmFja29mZg0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIC8qKg0KICAgICAqIEluZGV4ZWREQiBldmVudHMgZG8gbm90IHByb3BhZ2F0ZSBmcm9tIHRoZSBtYWluIHdpbmRvdyB0byB0aGUgd29ya2VyIGNvbnRleHQuICBXZSByZWx5IG9uIGENCiAgICAgKiBwb3N0TWVzc2FnZSBpbnRlcmZhY2UgdG8gc2VuZCB0aGVzZSBldmVudHMgdG8gdGhlIHdvcmtlciBvdXJzZWx2ZXMuDQogICAgICovDQogICAgYXN5bmMgaW5pdGlhbGl6ZVNlcnZpY2VXb3JrZXJNZXNzYWdpbmcoKSB7DQogICAgICAgIHJldHVybiBfaXNXb3JrZXIoKSA/IHRoaXMuaW5pdGlhbGl6ZVJlY2VpdmVyKCkgOiB0aGlzLmluaXRpYWxpemVTZW5kZXIoKTsNCiAgICB9DQogICAgLyoqDQogICAgICogQXMgdGhlIHdvcmtlciB3ZSBzaG91bGQgbGlzdGVuIHRvIGV2ZW50cyBmcm9tIHRoZSBtYWluIHdpbmRvdy4NCiAgICAgKi8NCiAgICBhc3luYyBpbml0aWFsaXplUmVjZWl2ZXIoKSB7DQogICAgICAgIHRoaXMucmVjZWl2ZXIgPSBSZWNlaXZlci5fZ2V0SW5zdGFuY2UoX2dldFdvcmtlckdsb2JhbFNjb3BlKCkpOw0KICAgICAgICAvLyBSZWZyZXNoIGZyb20gcGVyc2lzdGVuY2UgaWYgd2UgcmVjZWl2ZSBhIEtleUNoYW5nZWQgbWVzc2FnZS4NCiAgICAgICAgdGhpcy5yZWNlaXZlci5fc3Vic2NyaWJlKCJrZXlDaGFuZ2VkIiAvKiBfRXZlbnRUeXBlLktFWV9DSEFOR0VEICovLCBhc3luYyAoX29yaWdpbiwgZGF0YSkgPT4gew0KICAgICAgICAgICAgY29uc3Qga2V5cyA9IGF3YWl0IHRoaXMuX3BvbGwoKTsNCiAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAga2V5UHJvY2Vzc2VkOiBrZXlzLmluY2x1ZGVzKGRhdGEua2V5KQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfSk7DQogICAgICAgIC8vIExldCB0aGUgc2VuZGVyIGtub3cgdGhhdCB3ZSBhcmUgbGlzdGVuaW5nIHNvIHRoZXkgZ2l2ZSB1cyBtb3JlIHRpbWVvdXQuDQogICAgICAgIHRoaXMucmVjZWl2ZXIuX3N1YnNjcmliZSgicGluZyIgLyogX0V2ZW50VHlwZS5QSU5HICovLCBhc3luYyAoX29yaWdpbiwgX2RhdGEpID0+IHsNCiAgICAgICAgICAgIHJldHVybiBbImtleUNoYW5nZWQiIC8qIF9FdmVudFR5cGUuS0VZX0NIQU5HRUQgKi9dOw0KICAgICAgICB9KTsNCiAgICB9DQogICAgLyoqDQogICAgICogQXMgdGhlIG1haW4gd2luZG93LCB3ZSBzaG91bGQgbGV0IHRoZSB3b3JrZXIga25vdyB3aGVuIGtleXMgY2hhbmdlIChzZXQgYW5kIHJlbW92ZSkuDQogICAgICoNCiAgICAgKiBAcmVtYXJrcw0KICAgICAqIHtAbGluayBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvU2VydmljZVdvcmtlckNvbnRhaW5lci9yZWFkeSB8IFNlcnZpY2VXb3JrZXJDb250YWluZXIucmVhZHl9DQogICAgICogbWF5IG5vdCByZXNvbHZlLg0KICAgICAqLw0KICAgIGFzeW5jIGluaXRpYWxpemVTZW5kZXIoKSB7DQogICAgICAgIHZhciBfYSwgX2I7DQogICAgICAgIC8vIENoZWNrIHRvIHNlZSBpZiB0aGVyZSdzIGFuIGFjdGl2ZSBzZXJ2aWNlIHdvcmtlci4NCiAgICAgICAgdGhpcy5hY3RpdmVTZXJ2aWNlV29ya2VyID0gYXdhaXQgX2dldEFjdGl2ZVNlcnZpY2VXb3JrZXIoKTsNCiAgICAgICAgaWYgKCF0aGlzLmFjdGl2ZVNlcnZpY2VXb3JrZXIpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnNlbmRlciA9IG5ldyBTZW5kZXIodGhpcy5hY3RpdmVTZXJ2aWNlV29ya2VyKTsNCiAgICAgICAgLy8gUGluZyB0aGUgc2VydmljZSB3b3JrZXIgdG8gY2hlY2sgd2hhdCBldmVudHMgdGhleSBjYW4gaGFuZGxlLg0KICAgICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgdGhpcy5zZW5kZXIuX3NlbmQoInBpbmciIC8qIF9FdmVudFR5cGUuUElORyAqLywge30sIDgwMCAvKiBfVGltZW91dER1cmF0aW9uLkxPTkdfQUNLICovKTsNCiAgICAgICAgaWYgKCFyZXN1bHRzKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgaWYgKCgoX2EgPSByZXN1bHRzWzBdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZnVsZmlsbGVkKSAmJg0KICAgICAgICAgICAgKChfYiA9IHJlc3VsdHNbMF0pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi52YWx1ZS5pbmNsdWRlcygia2V5Q2hhbmdlZCIgLyogX0V2ZW50VHlwZS5LRVlfQ0hBTkdFRCAqLykpKSB7DQogICAgICAgICAgICB0aGlzLnNlcnZpY2VXb3JrZXJSZWNlaXZlckF2YWlsYWJsZSA9IHRydWU7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoqDQogICAgICogTGV0IHRoZSB3b3JrZXIga25vdyBhYm91dCBhIGNoYW5nZWQga2V5LCB0aGUgZXhhY3Qga2V5IGRvZXNuJ3QgdGVjaG5pY2FsbHkgbWF0dGVyIHNpbmNlIHRoZQ0KICAgICAqIHdvcmtlciB3aWxsIGp1c3QgdHJpZ2dlciBhIGZ1bGwgc3luYyBhbnl3YXkuDQogICAgICoNCiAgICAgKiBAcmVtYXJrcw0KICAgICAqIEZvciBub3csIHdlIG9ubHkgc3VwcG9ydCBvbmUgc2VydmljZSB3b3JrZXIgcGVyIHBhZ2UuDQogICAgICoNCiAgICAgKiBAcGFyYW0ga2V5IC0gU3RvcmFnZSBrZXkgd2hpY2ggY2hhbmdlZC4NCiAgICAgKi8NCiAgICBhc3luYyBub3RpZnlTZXJ2aWNlV29ya2VyKGtleSkgew0KICAgICAgICBpZiAoIXRoaXMuc2VuZGVyIHx8DQogICAgICAgICAgICAhdGhpcy5hY3RpdmVTZXJ2aWNlV29ya2VyIHx8DQogICAgICAgICAgICBfZ2V0U2VydmljZVdvcmtlckNvbnRyb2xsZXIoKSAhPT0gdGhpcy5hY3RpdmVTZXJ2aWNlV29ya2VyKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGF3YWl0IHRoaXMuc2VuZGVyLl9zZW5kKCJrZXlDaGFuZ2VkIiAvKiBfRXZlbnRUeXBlLktFWV9DSEFOR0VEICovLCB7IGtleSB9LCANCiAgICAgICAgICAgIC8vIFVzZSBsb25nIHRpbWVvdXQgaWYgcmVjZWl2ZXIgaGFzIHByZXZpb3VzbHkgcmVzcG9uZGVkIHRvIGEgcGluZyBmcm9tIHVzLg0KICAgICAgICAgICAgdGhpcy5zZXJ2aWNlV29ya2VyUmVjZWl2ZXJBdmFpbGFibGUNCiAgICAgICAgICAgICAgICA/IDgwMCAvKiBfVGltZW91dER1cmF0aW9uLkxPTkdfQUNLICovDQogICAgICAgICAgICAgICAgOiA1MCAvKiBfVGltZW91dER1cmF0aW9uLkFDSyAqLyk7DQogICAgICAgIH0NCiAgICAgICAgY2F0Y2ggKF9hKSB7DQogICAgICAgICAgICAvLyBUaGlzIGlzIGEgYmVzdCBlZmZvcnQgYXBwcm9hY2guIElnbm9yZSBlcnJvcnMuDQogICAgICAgIH0NCiAgICB9DQogICAgYXN5bmMgX2lzQXZhaWxhYmxlKCkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgaWYgKCFpbmRleGVkREIpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBkYiA9IGF3YWl0IF9vcGVuRGF0YWJhc2UoKTsNCiAgICAgICAgICAgIGF3YWl0IF9wdXRPYmplY3QoZGIsIFNUT1JBR0VfQVZBSUxBQkxFX0tFWSwgJzEnKTsNCiAgICAgICAgICAgIGF3YWl0IF9kZWxldGVPYmplY3QoZGIsIFNUT1JBR0VfQVZBSUxBQkxFX0tFWSk7DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAoX2EpIHsgfQ0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICAgIGFzeW5jIF93aXRoUGVuZGluZ1dyaXRlKHdyaXRlKSB7DQogICAgICAgIHRoaXMucGVuZGluZ1dyaXRlcysrOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgYXdhaXQgd3JpdGUoKTsNCiAgICAgICAgfQ0KICAgICAgICBmaW5hbGx5IHsNCiAgICAgICAgICAgIHRoaXMucGVuZGluZ1dyaXRlcy0tOw0KICAgICAgICB9DQogICAgfQ0KICAgIGFzeW5jIF9zZXQoa2V5LCB2YWx1ZSkgew0KICAgICAgICByZXR1cm4gdGhpcy5fd2l0aFBlbmRpbmdXcml0ZShhc3luYyAoKSA9PiB7DQogICAgICAgICAgICBhd2FpdCB0aGlzLl93aXRoUmV0cmllcygoZGIpID0+IF9wdXRPYmplY3QoZGIsIGtleSwgdmFsdWUpKTsNCiAgICAgICAgICAgIHRoaXMubG9jYWxDYWNoZVtrZXldID0gdmFsdWU7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5ub3RpZnlTZXJ2aWNlV29ya2VyKGtleSk7DQogICAgICAgIH0pOw0KICAgIH0NCiAgICBhc3luYyBfZ2V0KGtleSkgew0KICAgICAgICBjb25zdCBvYmogPSAoYXdhaXQgdGhpcy5fd2l0aFJldHJpZXMoKGRiKSA9PiBnZXRPYmplY3QoZGIsIGtleSkpKTsNCiAgICAgICAgdGhpcy5sb2NhbENhY2hlW2tleV0gPSBvYmo7DQogICAgICAgIHJldHVybiBvYmo7DQogICAgfQ0KICAgIGFzeW5jIF9yZW1vdmUoa2V5KSB7DQogICAgICAgIHJldHVybiB0aGlzLl93aXRoUGVuZGluZ1dyaXRlKGFzeW5jICgpID0+IHsNCiAgICAgICAgICAgIGF3YWl0IHRoaXMuX3dpdGhSZXRyaWVzKChkYikgPT4gX2RlbGV0ZU9iamVjdChkYiwga2V5KSk7DQogICAgICAgICAgICBkZWxldGUgdGhpcy5sb2NhbENhY2hlW2tleV07DQogICAgICAgICAgICByZXR1cm4gdGhpcy5ub3RpZnlTZXJ2aWNlV29ya2VyKGtleSk7DQogICAgICAgIH0pOw0KICAgIH0NCiAgICBhc3luYyBfcG9sbCgpIHsNCiAgICAgICAgLy8gVE9ETzogY2hlY2sgaWYgd2UgbmVlZCB0byBmYWxsYmFjayBpZiBnZXRBbGwgaXMgbm90IHN1cHBvcnRlZA0KICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLl93aXRoUmV0cmllcygoZGIpID0+IHsNCiAgICAgICAgICAgIGNvbnN0IGdldEFsbFJlcXVlc3QgPSBnZXRPYmplY3RTdG9yZShkYiwgZmFsc2UpLmdldEFsbCgpOw0KICAgICAgICAgICAgcmV0dXJuIG5ldyBEQlByb21pc2UoZ2V0QWxsUmVxdWVzdCkudG9Qcm9taXNlKCk7DQogICAgICAgIH0pOw0KICAgICAgICBpZiAoIXJlc3VsdCkgew0KICAgICAgICAgICAgcmV0dXJuIFtdOw0KICAgICAgICB9DQogICAgICAgIC8vIElmIHdlIGhhdmUgcGVuZGluZyB3cml0ZXMgaW4gcHJvZ3Jlc3MgYWJvcnQsIHdlJ2xsIGdldCBwaWNrZWQgdXAgb24gdGhlIG5leHQgcG9sbA0KICAgICAgICBpZiAodGhpcy5wZW5kaW5nV3JpdGVzICE9PSAwKSB7DQogICAgICAgICAgICByZXR1cm4gW107DQogICAgICAgIH0NCiAgICAgICAgY29uc3Qga2V5cyA9IFtdOw0KICAgICAgICBjb25zdCBrZXlzSW5SZXN1bHQgPSBuZXcgU2V0KCk7DQogICAgICAgIGZvciAoY29uc3QgeyBmYmFzZV9rZXk6IGtleSwgdmFsdWUgfSBvZiByZXN1bHQpIHsNCiAgICAgICAgICAgIGtleXNJblJlc3VsdC5hZGQoa2V5KTsNCiAgICAgICAgICAgIGlmIChKU09OLnN0cmluZ2lmeSh0aGlzLmxvY2FsQ2FjaGVba2V5XSkgIT09IEpTT04uc3RyaW5naWZ5KHZhbHVlKSkgew0KICAgICAgICAgICAgICAgIHRoaXMubm90aWZ5TGlzdGVuZXJzKGtleSwgdmFsdWUpOw0KICAgICAgICAgICAgICAgIGtleXMucHVzaChrZXkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGZvciAoY29uc3QgbG9jYWxLZXkgb2YgT2JqZWN0LmtleXModGhpcy5sb2NhbENhY2hlKSkgew0KICAgICAgICAgICAgaWYgKHRoaXMubG9jYWxDYWNoZVtsb2NhbEtleV0gJiYgIWtleXNJblJlc3VsdC5oYXMobG9jYWxLZXkpKSB7DQogICAgICAgICAgICAgICAgLy8gRGVsZXRlZA0KICAgICAgICAgICAgICAgIHRoaXMubm90aWZ5TGlzdGVuZXJzKGxvY2FsS2V5LCBudWxsKTsNCiAgICAgICAgICAgICAgICBrZXlzLnB1c2gobG9jYWxLZXkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBrZXlzOw0KICAgIH0NCiAgICBub3RpZnlMaXN0ZW5lcnMoa2V5LCBuZXdWYWx1ZSkgew0KICAgICAgICB0aGlzLmxvY2FsQ2FjaGVba2V5XSA9IG5ld1ZhbHVlOw0KICAgICAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLmxpc3RlbmVyc1trZXldOw0KICAgICAgICBpZiAobGlzdGVuZXJzKSB7DQogICAgICAgICAgICBmb3IgKGNvbnN0IGxpc3RlbmVyIG9mIEFycmF5LmZyb20obGlzdGVuZXJzKSkgew0KICAgICAgICAgICAgICAgIGxpc3RlbmVyKG5ld1ZhbHVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBzdGFydFBvbGxpbmcoKSB7DQogICAgICAgIHRoaXMuc3RvcFBvbGxpbmcoKTsNCiAgICAgICAgdGhpcy5wb2xsVGltZXIgPSBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB0aGlzLl9wb2xsKCksIF9QT0xMSU5HX0lOVEVSVkFMX01TKTsNCiAgICB9DQogICAgc3RvcFBvbGxpbmcoKSB7DQogICAgICAgIGlmICh0aGlzLnBvbGxUaW1lcikgew0KICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnBvbGxUaW1lcik7DQogICAgICAgICAgICB0aGlzLnBvbGxUaW1lciA9IG51bGw7DQogICAgICAgIH0NCiAgICB9DQogICAgX2FkZExpc3RlbmVyKGtleSwgbGlzdGVuZXIpIHsNCiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMubGlzdGVuZXJzKS5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgIHRoaXMuc3RhcnRQb2xsaW5nKCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKCF0aGlzLmxpc3RlbmVyc1trZXldKSB7DQogICAgICAgICAgICB0aGlzLmxpc3RlbmVyc1trZXldID0gbmV3IFNldCgpOw0KICAgICAgICAgICAgLy8gUG9wdWxhdGUgdGhlIGNhY2hlIHRvIGF2b2lkIHNwdXJpb3VzbHkgdHJpZ2dlcmluZyBvbiBmaXJzdCBwb2xsLg0KICAgICAgICAgICAgdm9pZCB0aGlzLl9nZXQoa2V5KTsgLy8gVGhpcyBjYW4gaGFwcGVuIGluIHRoZSBiYWNrZ3JvdW5kIGFzeW5jIGFuZCB3ZSBjYW4gcmV0dXJuIGltbWVkaWF0ZWx5Lg0KICAgICAgICB9DQogICAgICAgIHRoaXMubGlzdGVuZXJzW2tleV0uYWRkKGxpc3RlbmVyKTsNCiAgICB9DQogICAgX3JlbW92ZUxpc3RlbmVyKGtleSwgbGlzdGVuZXIpIHsNCiAgICAgICAgaWYgKHRoaXMubGlzdGVuZXJzW2tleV0pIHsNCiAgICAgICAgICAgIHRoaXMubGlzdGVuZXJzW2tleV0uZGVsZXRlKGxpc3RlbmVyKTsNCiAgICAgICAgICAgIGlmICh0aGlzLmxpc3RlbmVyc1trZXldLnNpemUgPT09IDApIHsNCiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5saXN0ZW5lcnNba2V5XTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5saXN0ZW5lcnMpLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgdGhpcy5zdG9wUG9sbGluZygpOw0KICAgICAgICB9DQogICAgfQ0KfQ0KSW5kZXhlZERCTG9jYWxQZXJzaXN0ZW5jZS50eXBlID0gJ0xPQ0FMJzsNCi8qKg0KICogQW4gaW1wbGVtZW50YXRpb24gb2Yge0BsaW5rIFBlcnNpc3RlbmNlfSBvZiB0eXBlIGBMT0NBTGAgdXNpbmcgYGluZGV4ZWREQmANCiAqIGZvciB0aGUgdW5kZXJseWluZyBzdG9yYWdlLg0KICoNCiAqIEBwdWJsaWMNCiAqLw0KY29uc3QgaW5kZXhlZERCTG9jYWxQZXJzaXN0ZW5jZSA9IEluZGV4ZWREQkxvY2FsUGVyc2lzdGVuY2U7Cm5ldyBEZWxheSgzMDAwMCwgNjAwMDApOw0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogQ2hvb3NlcyBhIHBvcHVwL3JlZGlyZWN0IHJlc29sdmVyIHRvIHVzZS4gVGhpcyBwcmVmZXJzIHRoZSBvdmVycmlkZSAod2hpY2gNCiAqIGlzIGRpcmVjdGx5IHBhc3NlZCBpbiksIGFuZCBmYWxscyBiYWNrIHRvIHRoZSBwcm9wZXJ0eSBzZXQgb24gdGhlIGF1dGgNCiAqIG9iamVjdC4gSWYgbmVpdGhlciBhcmUgYXZhaWxhYmxlLCB0aGlzIGZ1bmN0aW9uIGVycm9ycyB3LyBhbiBhcmd1bWVudCBlcnJvci4NCiAqLw0KZnVuY3Rpb24gX3dpdGhEZWZhdWx0UmVzb2x2ZXIoYXV0aCwgcmVzb2x2ZXJPdmVycmlkZSkgew0KICAgIGlmIChyZXNvbHZlck92ZXJyaWRlKSB7DQogICAgICAgIHJldHVybiBfZ2V0SW5zdGFuY2UocmVzb2x2ZXJPdmVycmlkZSk7DQogICAgfQ0KICAgIF9hc3NlcnQoYXV0aC5fcG9wdXBSZWRpcmVjdFJlc29sdmVyLCBhdXRoLCAiYXJndW1lbnQtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pOw0KICAgIHJldHVybiBhdXRoLl9wb3B1cFJlZGlyZWN0UmVzb2x2ZXI7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjbGFzcyBJZHBDcmVkZW50aWFsIGV4dGVuZHMgQXV0aENyZWRlbnRpYWwgew0KICAgIGNvbnN0cnVjdG9yKHBhcmFtcykgew0KICAgICAgICBzdXBlcigiY3VzdG9tIiAvKiBQcm92aWRlcklkLkNVU1RPTSAqLywgImN1c3RvbSIgLyogUHJvdmlkZXJJZC5DVVNUT00gKi8pOw0KICAgICAgICB0aGlzLnBhcmFtcyA9IHBhcmFtczsNCiAgICB9DQogICAgX2dldElkVG9rZW5SZXNwb25zZShhdXRoKSB7DQogICAgICAgIHJldHVybiBzaWduSW5XaXRoSWRwKGF1dGgsIHRoaXMuX2J1aWxkSWRwUmVxdWVzdCgpKTsNCiAgICB9DQogICAgX2xpbmtUb0lkVG9rZW4oYXV0aCwgaWRUb2tlbikgew0KICAgICAgICByZXR1cm4gc2lnbkluV2l0aElkcChhdXRoLCB0aGlzLl9idWlsZElkcFJlcXVlc3QoaWRUb2tlbikpOw0KICAgIH0NCiAgICBfZ2V0UmVhdXRoZW50aWNhdGlvblJlc29sdmVyKGF1dGgpIHsNCiAgICAgICAgcmV0dXJuIHNpZ25JbldpdGhJZHAoYXV0aCwgdGhpcy5fYnVpbGRJZHBSZXF1ZXN0KCkpOw0KICAgIH0NCiAgICBfYnVpbGRJZHBSZXF1ZXN0KGlkVG9rZW4pIHsNCiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHsNCiAgICAgICAgICAgIHJlcXVlc3RVcmk6IHRoaXMucGFyYW1zLnJlcXVlc3RVcmksDQogICAgICAgICAgICBzZXNzaW9uSWQ6IHRoaXMucGFyYW1zLnNlc3Npb25JZCwNCiAgICAgICAgICAgIHBvc3RCb2R5OiB0aGlzLnBhcmFtcy5wb3N0Qm9keSwNCiAgICAgICAgICAgIHRlbmFudElkOiB0aGlzLnBhcmFtcy50ZW5hbnRJZCwNCiAgICAgICAgICAgIHBlbmRpbmdUb2tlbjogdGhpcy5wYXJhbXMucGVuZGluZ1Rva2VuLA0KICAgICAgICAgICAgcmV0dXJuU2VjdXJlVG9rZW46IHRydWUsDQogICAgICAgICAgICByZXR1cm5JZHBDcmVkZW50aWFsOiB0cnVlDQogICAgICAgIH07DQogICAgICAgIGlmIChpZFRva2VuKSB7DQogICAgICAgICAgICByZXF1ZXN0LmlkVG9rZW4gPSBpZFRva2VuOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiByZXF1ZXN0Ow0KICAgIH0NCn0NCmZ1bmN0aW9uIF9zaWduSW4ocGFyYW1zKSB7DQogICAgcmV0dXJuIF9zaWduSW5XaXRoQ3JlZGVudGlhbChwYXJhbXMuYXV0aCwgbmV3IElkcENyZWRlbnRpYWwocGFyYW1zKSwgcGFyYW1zLmJ5cGFzc0F1dGhTdGF0ZSk7DQp9DQpmdW5jdGlvbiBfcmVhdXRoKHBhcmFtcykgew0KICAgIGNvbnN0IHsgYXV0aCwgdXNlciB9ID0gcGFyYW1zOw0KICAgIF9hc3NlcnQodXNlciwgYXV0aCwgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICByZXR1cm4gX3JlYXV0aGVudGljYXRlKHVzZXIsIG5ldyBJZHBDcmVkZW50aWFsKHBhcmFtcyksIHBhcmFtcy5ieXBhc3NBdXRoU3RhdGUpOw0KfQ0KYXN5bmMgZnVuY3Rpb24gX2xpbmsocGFyYW1zKSB7DQogICAgY29uc3QgeyBhdXRoLCB1c2VyIH0gPSBwYXJhbXM7DQogICAgX2Fzc2VydCh1c2VyLCBhdXRoLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pOw0KICAgIHJldHVybiBfbGluayQxKHVzZXIsIG5ldyBJZHBDcmVkZW50aWFsKHBhcmFtcyksIHBhcmFtcy5ieXBhc3NBdXRoU3RhdGUpOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBQb3B1cCBldmVudCBtYW5hZ2VyLiBIYW5kbGVzIHRoZSBwb3B1cCdzIGVudGlyZSBsaWZlY3ljbGU7IGxpc3RlbnMgdG8gYXV0aA0KICogZXZlbnRzDQogKi8NCmNsYXNzIEFic3RyYWN0UG9wdXBSZWRpcmVjdE9wZXJhdGlvbiB7DQogICAgY29uc3RydWN0b3IoYXV0aCwgZmlsdGVyLCByZXNvbHZlciwgdXNlciwgYnlwYXNzQXV0aFN0YXRlID0gZmFsc2UpIHsNCiAgICAgICAgdGhpcy5hdXRoID0gYXV0aDsNCiAgICAgICAgdGhpcy5yZXNvbHZlciA9IHJlc29sdmVyOw0KICAgICAgICB0aGlzLnVzZXIgPSB1c2VyOw0KICAgICAgICB0aGlzLmJ5cGFzc0F1dGhTdGF0ZSA9IGJ5cGFzc0F1dGhTdGF0ZTsNCiAgICAgICAgdGhpcy5wZW5kaW5nUHJvbWlzZSA9IG51bGw7DQogICAgICAgIHRoaXMuZXZlbnRNYW5hZ2VyID0gbnVsbDsNCiAgICAgICAgdGhpcy5maWx0ZXIgPSBBcnJheS5pc0FycmF5KGZpbHRlcikgPyBmaWx0ZXIgOiBbZmlsdGVyXTsNCiAgICB9DQogICAgZXhlY3V0ZSgpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGFzeW5jIChyZXNvbHZlLCByZWplY3QpID0+IHsNCiAgICAgICAgICAgIHRoaXMucGVuZGluZ1Byb21pc2UgPSB7IHJlc29sdmUsIHJlamVjdCB9Ow0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICB0aGlzLmV2ZW50TWFuYWdlciA9IGF3YWl0IHRoaXMucmVzb2x2ZXIuX2luaXRpYWxpemUodGhpcy5hdXRoKTsNCiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLm9uRXhlY3V0aW9uKCk7DQogICAgICAgICAgICAgICAgdGhpcy5ldmVudE1hbmFnZXIucmVnaXN0ZXJDb25zdW1lcih0aGlzKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgdGhpcy5yZWplY3QoZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH0NCiAgICBhc3luYyBvbkF1dGhFdmVudChldmVudCkgew0KICAgICAgICBjb25zdCB7IHVybFJlc3BvbnNlLCBzZXNzaW9uSWQsIHBvc3RCb2R5LCB0ZW5hbnRJZCwgZXJyb3IsIHR5cGUgfSA9IGV2ZW50Ow0KICAgICAgICBpZiAoZXJyb3IpIHsNCiAgICAgICAgICAgIHRoaXMucmVqZWN0KGVycm9yKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBwYXJhbXMgPSB7DQogICAgICAgICAgICBhdXRoOiB0aGlzLmF1dGgsDQogICAgICAgICAgICByZXF1ZXN0VXJpOiB1cmxSZXNwb25zZSwNCiAgICAgICAgICAgIHNlc3Npb25JZDogc2Vzc2lvbklkLA0KICAgICAgICAgICAgdGVuYW50SWQ6IHRlbmFudElkIHx8IHVuZGVmaW5lZCwNCiAgICAgICAgICAgIHBvc3RCb2R5OiBwb3N0Qm9keSB8fCB1bmRlZmluZWQsDQogICAgICAgICAgICB1c2VyOiB0aGlzLnVzZXIsDQogICAgICAgICAgICBieXBhc3NBdXRoU3RhdGU6IHRoaXMuYnlwYXNzQXV0aFN0YXRlDQogICAgICAgIH07DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICB0aGlzLnJlc29sdmUoYXdhaXQgdGhpcy5nZXRJZHBUYXNrKHR5cGUpKHBhcmFtcykpOw0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICB0aGlzLnJlamVjdChlKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBvbkVycm9yKGVycm9yKSB7DQogICAgICAgIHRoaXMucmVqZWN0KGVycm9yKTsNCiAgICB9DQogICAgZ2V0SWRwVGFzayh0eXBlKSB7DQogICAgICAgIHN3aXRjaCAodHlwZSkgew0KICAgICAgICAgICAgY2FzZSAic2lnbkluVmlhUG9wdXAiIC8qIEF1dGhFdmVudFR5cGUuU0lHTl9JTl9WSUFfUE9QVVAgKi86DQogICAgICAgICAgICBjYXNlICJzaWduSW5WaWFSZWRpcmVjdCIgLyogQXV0aEV2ZW50VHlwZS5TSUdOX0lOX1ZJQV9SRURJUkVDVCAqLzoNCiAgICAgICAgICAgICAgICByZXR1cm4gX3NpZ25JbjsNCiAgICAgICAgICAgIGNhc2UgImxpbmtWaWFQb3B1cCIgLyogQXV0aEV2ZW50VHlwZS5MSU5LX1ZJQV9QT1BVUCAqLzoNCiAgICAgICAgICAgIGNhc2UgImxpbmtWaWFSZWRpcmVjdCIgLyogQXV0aEV2ZW50VHlwZS5MSU5LX1ZJQV9SRURJUkVDVCAqLzoNCiAgICAgICAgICAgICAgICByZXR1cm4gX2xpbms7DQogICAgICAgICAgICBjYXNlICJyZWF1dGhWaWFQb3B1cCIgLyogQXV0aEV2ZW50VHlwZS5SRUFVVEhfVklBX1BPUFVQICovOg0KICAgICAgICAgICAgY2FzZSAicmVhdXRoVmlhUmVkaXJlY3QiIC8qIEF1dGhFdmVudFR5cGUuUkVBVVRIX1ZJQV9SRURJUkVDVCAqLzoNCiAgICAgICAgICAgICAgICByZXR1cm4gX3JlYXV0aDsNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgX2ZhaWwodGhpcy5hdXRoLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJlc29sdmUoY3JlZCkgew0KICAgICAgICBkZWJ1Z0Fzc2VydCh0aGlzLnBlbmRpbmdQcm9taXNlLCAnUGVuZGluZyBwcm9taXNlIHdhcyBuZXZlciBzZXQnKTsNCiAgICAgICAgdGhpcy5wZW5kaW5nUHJvbWlzZS5yZXNvbHZlKGNyZWQpOw0KICAgICAgICB0aGlzLnVucmVnaXN0ZXJBbmRDbGVhblVwKCk7DQogICAgfQ0KICAgIHJlamVjdChlcnJvcikgew0KICAgICAgICBkZWJ1Z0Fzc2VydCh0aGlzLnBlbmRpbmdQcm9taXNlLCAnUGVuZGluZyBwcm9taXNlIHdhcyBuZXZlciBzZXQnKTsNCiAgICAgICAgdGhpcy5wZW5kaW5nUHJvbWlzZS5yZWplY3QoZXJyb3IpOw0KICAgICAgICB0aGlzLnVucmVnaXN0ZXJBbmRDbGVhblVwKCk7DQogICAgfQ0KICAgIHVucmVnaXN0ZXJBbmRDbGVhblVwKCkgew0KICAgICAgICBpZiAodGhpcy5ldmVudE1hbmFnZXIpIHsNCiAgICAgICAgICAgIHRoaXMuZXZlbnRNYW5hZ2VyLnVucmVnaXN0ZXJDb25zdW1lcih0aGlzKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnBlbmRpbmdQcm9taXNlID0gbnVsbDsNCiAgICAgICAgdGhpcy5jbGVhblVwKCk7DQogICAgfQ0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY29uc3QgX1BPTExfV0lORE9XX0NMT1NFX1RJTUVPVVQgPSBuZXcgRGVsYXkoMjAwMCwgMTAwMDApOw0KLyoqDQogKiBQb3B1cCBldmVudCBtYW5hZ2VyLiBIYW5kbGVzIHRoZSBwb3B1cCdzIGVudGlyZSBsaWZlY3ljbGU7IGxpc3RlbnMgdG8gYXV0aA0KICogZXZlbnRzDQogKg0KICovDQpjbGFzcyBQb3B1cE9wZXJhdGlvbiBleHRlbmRzIEFic3RyYWN0UG9wdXBSZWRpcmVjdE9wZXJhdGlvbiB7DQogICAgY29uc3RydWN0b3IoYXV0aCwgZmlsdGVyLCBwcm92aWRlciwgcmVzb2x2ZXIsIHVzZXIpIHsNCiAgICAgICAgc3VwZXIoYXV0aCwgZmlsdGVyLCByZXNvbHZlciwgdXNlcik7DQogICAgICAgIHRoaXMucHJvdmlkZXIgPSBwcm92aWRlcjsNCiAgICAgICAgdGhpcy5hdXRoV2luZG93ID0gbnVsbDsNCiAgICAgICAgdGhpcy5wb2xsSWQgPSBudWxsOw0KICAgICAgICBpZiAoUG9wdXBPcGVyYXRpb24uY3VycmVudFBvcHVwQWN0aW9uKSB7DQogICAgICAgICAgICBQb3B1cE9wZXJhdGlvbi5jdXJyZW50UG9wdXBBY3Rpb24uY2FuY2VsKCk7DQogICAgICAgIH0NCiAgICAgICAgUG9wdXBPcGVyYXRpb24uY3VycmVudFBvcHVwQWN0aW9uID0gdGhpczsNCiAgICB9DQogICAgYXN5bmMgZXhlY3V0ZU5vdE51bGwoKSB7DQogICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZXhlY3V0ZSgpOw0KICAgICAgICBfYXNzZXJ0KHJlc3VsdCwgdGhpcy5hdXRoLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCiAgICBhc3luYyBvbkV4ZWN1dGlvbigpIHsNCiAgICAgICAgZGVidWdBc3NlcnQodGhpcy5maWx0ZXIubGVuZ3RoID09PSAxLCAnUG9wdXAgb3BlcmF0aW9ucyBvbmx5IGhhbmRsZSBvbmUgZXZlbnQnKTsNCiAgICAgICAgY29uc3QgZXZlbnRJZCA9IF9nZW5lcmF0ZUV2ZW50SWQoKTsNCiAgICAgICAgdGhpcy5hdXRoV2luZG93ID0gYXdhaXQgdGhpcy5yZXNvbHZlci5fb3BlblBvcHVwKHRoaXMuYXV0aCwgdGhpcy5wcm92aWRlciwgdGhpcy5maWx0ZXJbMF0sIC8vIFRoZXJlJ3MgYWx3YXlzIG9uZSwgc2VlIGNvbnN0cnVjdG9yDQogICAgICAgIGV2ZW50SWQpOw0KICAgICAgICB0aGlzLmF1dGhXaW5kb3cuYXNzb2NpYXRlZEV2ZW50ID0gZXZlbnRJZDsNCiAgICAgICAgLy8gQ2hlY2sgZm9yIHdlYiBzdG9yYWdlIHN1cHBvcnQgYW5kIG9yaWdpbiB2YWxpZGF0aW9uIF9hZnRlcl8gdGhlIHBvcHVwIGlzDQogICAgICAgIC8vIGxvYWRlZC4gVGhlc2Ugb3BlcmF0aW9ucyBhcmUgc2xvdyAofjEgc2Vjb25kIG9yIHNvKSBSYXRoZXIgdGhhbg0KICAgICAgICAvLyB3YWl0aW5nIG9uIHRoZW0gYmVmb3JlIG9wZW5pbmcgdGhlIHdpbmRvdywgb3B0aW1pc3RpY2FsbHkgb3BlbiB0aGUgcG9wdXANCiAgICAgICAgLy8gYW5kIGNoZWNrIGZvciBzdG9yYWdlIHN1cHBvcnQgYXQgdGhlIHNhbWUgdGltZS4gSWYgc3RvcmFnZSBzdXBwb3J0IGlzDQogICAgICAgIC8vIG5vdCBhdmFpbGFibGUsIHRoaXMgd2lsbCBjYXVzZSB0aGUgd2hvbGUgdGhpbmcgdG8gcmVqZWN0IHByb3Blcmx5LiBJdA0KICAgICAgICAvLyB3aWxsIGFsc28gY2xvc2UgdGhlIHBvcHVwLCBidXQgc2luY2UgdGhlIHByb21pc2UgaGFzIGFscmVhZHkgcmVqZWN0ZWQsDQogICAgICAgIC8vIHRoZSBwb3B1cCBjbG9zZWQgYnkgdXNlciBwb2xsIHdpbGwgcmVqZWN0IGludG8gdGhlIHZvaWQuDQogICAgICAgIHRoaXMucmVzb2x2ZXIuX29yaWdpblZhbGlkYXRpb24odGhpcy5hdXRoKS5jYXRjaChlID0+IHsNCiAgICAgICAgICAgIHRoaXMucmVqZWN0KGUpOw0KICAgICAgICB9KTsNCiAgICAgICAgdGhpcy5yZXNvbHZlci5faXNJZnJhbWVXZWJTdG9yYWdlU3VwcG9ydGVkKHRoaXMuYXV0aCwgaXNTdXBwb3J0ZWQgPT4gew0KICAgICAgICAgICAgaWYgKCFpc1N1cHBvcnRlZCkgew0KICAgICAgICAgICAgICAgIHRoaXMucmVqZWN0KF9jcmVhdGVFcnJvcih0aGlzLmF1dGgsICJ3ZWItc3RvcmFnZS11bnN1cHBvcnRlZCIgLyogQXV0aEVycm9yQ29kZS5XRUJfU1RPUkFHRV9VTlNVUFBPUlRFRCAqLykpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICAgICAgLy8gSGFuZGxlIHVzZXIgY2xvc3VyZS4gTm90aWNlIHRoaXMgZG9lcyAqbm90KiB1c2UgYXdhaXQNCiAgICAgICAgdGhpcy5wb2xsVXNlckNhbmNlbGxhdGlvbigpOw0KICAgIH0NCiAgICBnZXQgZXZlbnRJZCgpIHsNCiAgICAgICAgdmFyIF9hOw0KICAgICAgICByZXR1cm4gKChfYSA9IHRoaXMuYXV0aFdpbmRvdykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmFzc29jaWF0ZWRFdmVudCkgfHwgbnVsbDsNCiAgICB9DQogICAgY2FuY2VsKCkgew0KICAgICAgICB0aGlzLnJlamVjdChfY3JlYXRlRXJyb3IodGhpcy5hdXRoLCAiY2FuY2VsbGVkLXBvcHVwLXJlcXVlc3QiIC8qIEF1dGhFcnJvckNvZGUuRVhQSVJFRF9QT1BVUF9SRVFVRVNUICovKSk7DQogICAgfQ0KICAgIGNsZWFuVXAoKSB7DQogICAgICAgIGlmICh0aGlzLmF1dGhXaW5kb3cpIHsNCiAgICAgICAgICAgIHRoaXMuYXV0aFdpbmRvdy5jbG9zZSgpOw0KICAgICAgICB9DQogICAgICAgIGlmICh0aGlzLnBvbGxJZCkgew0KICAgICAgICAgICAgd2luZG93LmNsZWFyVGltZW91dCh0aGlzLnBvbGxJZCk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5hdXRoV2luZG93ID0gbnVsbDsNCiAgICAgICAgdGhpcy5wb2xsSWQgPSBudWxsOw0KICAgICAgICBQb3B1cE9wZXJhdGlvbi5jdXJyZW50UG9wdXBBY3Rpb24gPSBudWxsOw0KICAgIH0NCiAgICBwb2xsVXNlckNhbmNlbGxhdGlvbigpIHsNCiAgICAgICAgY29uc3QgcG9sbCA9ICgpID0+IHsNCiAgICAgICAgICAgIHZhciBfYSwgX2I7DQogICAgICAgICAgICBpZiAoKF9iID0gKF9hID0gdGhpcy5hdXRoV2luZG93KSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Eud2luZG93KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuY2xvc2VkKSB7DQogICAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgdGhlcmUgaXMgc3VmZmljaWVudCB0aW1lIGZvciB3aGF0ZXZlciBhY3Rpb24gdG8NCiAgICAgICAgICAgICAgICAvLyBjb21wbGV0ZS4gVGhlIHdpbmRvdyBjb3VsZCBoYXZlIGNsb3NlZCBidXQgdGhlIHNpZ24gaW4gbmV0d29yaw0KICAgICAgICAgICAgICAgIC8vIGNhbGwgY291bGQgc3RpbGwgYmUgaW4gZmxpZ2h0LiBUaGlzIGlzIHNwZWNpZmljYWxseSB0cnVlIGZvcg0KICAgICAgICAgICAgICAgIC8vIEZpcmVmb3ggb3IgaWYgdGhlIG9wZW5lciBpcyBpbiBhbiBpZnJhbWUsIGluIHdoaWNoIGNhc2UgdGhlIG9hdXRoDQogICAgICAgICAgICAgICAgLy8gaGVscGVyIGNsb3NlcyB0aGUgcG9wdXAuDQogICAgICAgICAgICAgICAgdGhpcy5wb2xsSWQgPSB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMucG9sbElkID0gbnVsbDsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWplY3QoX2NyZWF0ZUVycm9yKHRoaXMuYXV0aCwgInBvcHVwLWNsb3NlZC1ieS11c2VyIiAvKiBBdXRoRXJyb3JDb2RlLlBPUFVQX0NMT1NFRF9CWV9VU0VSICovKSk7DQogICAgICAgICAgICAgICAgfSwgODAwMCAvKiBfVGltZW91dC5BVVRIX0VWRU5UICovKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLnBvbGxJZCA9IHdpbmRvdy5zZXRUaW1lb3V0KHBvbGwsIF9QT0xMX1dJTkRPV19DTE9TRV9USU1FT1VULmdldCgpKTsNCiAgICAgICAgfTsNCiAgICAgICAgcG9sbCgpOw0KICAgIH0NCn0NCi8vIE9ubHkgb25lIHBvcHVwIGlzIGV2ZXIgc2hvd24gYXQgb25jZS4gVGhlIGxpZmVjeWNsZSBvZiB0aGUgY3VycmVudCBwb3B1cA0KLy8gY2FuIGJlIG1hbmFnZWQgLyBjYW5jZWxsZWQgYnkgdGhlIGNvbnN0cnVjdG9yLg0KUG9wdXBPcGVyYXRpb24uY3VycmVudFBvcHVwQWN0aW9uID0gbnVsbDsKCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmNvbnN0IFBFTkRJTkdfUkVESVJFQ1RfS0VZID0gJ3BlbmRpbmdSZWRpcmVjdCc7DQovLyBXZSBvbmx5IGdldCBvbmUgcmVkaXJlY3Qgb3V0Y29tZSBmb3IgYW55IG9uZSBhdXRoLCBzbyBqdXN0IHN0b3JlIGl0DQovLyBpbiBoZXJlLg0KY29uc3QgcmVkaXJlY3RPdXRjb21lTWFwID0gbmV3IE1hcCgpOw0KY2xhc3MgUmVkaXJlY3RBY3Rpb24gZXh0ZW5kcyBBYnN0cmFjdFBvcHVwUmVkaXJlY3RPcGVyYXRpb24gew0KICAgIGNvbnN0cnVjdG9yKGF1dGgsIHJlc29sdmVyLCBieXBhc3NBdXRoU3RhdGUgPSBmYWxzZSkgew0KICAgICAgICBzdXBlcihhdXRoLCBbDQogICAgICAgICAgICAic2lnbkluVmlhUmVkaXJlY3QiIC8qIEF1dGhFdmVudFR5cGUuU0lHTl9JTl9WSUFfUkVESVJFQ1QgKi8sDQogICAgICAgICAgICAibGlua1ZpYVJlZGlyZWN0IiAvKiBBdXRoRXZlbnRUeXBlLkxJTktfVklBX1JFRElSRUNUICovLA0KICAgICAgICAgICAgInJlYXV0aFZpYVJlZGlyZWN0IiAvKiBBdXRoRXZlbnRUeXBlLlJFQVVUSF9WSUFfUkVESVJFQ1QgKi8sDQogICAgICAgICAgICAidW5rbm93biIgLyogQXV0aEV2ZW50VHlwZS5VTktOT1dOICovDQogICAgICAgIF0sIHJlc29sdmVyLCB1bmRlZmluZWQsIGJ5cGFzc0F1dGhTdGF0ZSk7DQogICAgICAgIHRoaXMuZXZlbnRJZCA9IG51bGw7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIE92ZXJyaWRlIHRoZSBleGVjdXRlIGZ1bmN0aW9uOyBpZiB3ZSBhbHJlYWR5IGhhdmUgYSByZWRpcmVjdCByZXN1bHQsIHRoZW4NCiAgICAgKiBqdXN0IHJldHVybiBpdC4NCiAgICAgKi8NCiAgICBhc3luYyBleGVjdXRlKCkgew0KICAgICAgICBsZXQgcmVhZHlPdXRjb21lID0gcmVkaXJlY3RPdXRjb21lTWFwLmdldCh0aGlzLmF1dGguX2tleSgpKTsNCiAgICAgICAgaWYgKCFyZWFkeU91dGNvbWUpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgY29uc3QgaGFzUGVuZGluZ1JlZGlyZWN0ID0gYXdhaXQgX2dldEFuZENsZWFyUGVuZGluZ1JlZGlyZWN0U3RhdHVzKHRoaXMucmVzb2x2ZXIsIHRoaXMuYXV0aCk7DQogICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gaGFzUGVuZGluZ1JlZGlyZWN0ID8gYXdhaXQgc3VwZXIuZXhlY3V0ZSgpIDogbnVsbDsNCiAgICAgICAgICAgICAgICByZWFkeU91dGNvbWUgPSAoKSA9PiBQcm9taXNlLnJlc29sdmUocmVzdWx0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgcmVhZHlPdXRjb21lID0gKCkgPT4gUHJvbWlzZS5yZWplY3QoZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZWRpcmVjdE91dGNvbWVNYXAuc2V0KHRoaXMuYXV0aC5fa2V5KCksIHJlYWR5T3V0Y29tZSk7DQogICAgICAgIH0NCiAgICAgICAgLy8gSWYgd2UncmUgbm90IGJ5cGFzc2luZyBhdXRoIHN0YXRlLCB0aGUgcmVhZHkgb3V0Y29tZSBzaG91bGQgYmUgc2V0IHRvDQogICAgICAgIC8vIG51bGwuDQogICAgICAgIGlmICghdGhpcy5ieXBhc3NBdXRoU3RhdGUpIHsNCiAgICAgICAgICAgIHJlZGlyZWN0T3V0Y29tZU1hcC5zZXQodGhpcy5hdXRoLl9rZXkoKSwgKCkgPT4gUHJvbWlzZS5yZXNvbHZlKG51bGwpKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVhZHlPdXRjb21lKCk7DQogICAgfQ0KICAgIGFzeW5jIG9uQXV0aEV2ZW50KGV2ZW50KSB7DQogICAgICAgIGlmIChldmVudC50eXBlID09PSAic2lnbkluVmlhUmVkaXJlY3QiIC8qIEF1dGhFdmVudFR5cGUuU0lHTl9JTl9WSUFfUkVESVJFQ1QgKi8pIHsNCiAgICAgICAgICAgIHJldHVybiBzdXBlci5vbkF1dGhFdmVudChldmVudCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gInVua25vd24iIC8qIEF1dGhFdmVudFR5cGUuVU5LTk9XTiAqLykgew0KICAgICAgICAgICAgLy8gVGhpcyBpcyBhIHNlbnRpbmVsIHZhbHVlIGluZGljYXRpbmcgdGhlcmUncyBubyBwZW5kaW5nIHJlZGlyZWN0DQogICAgICAgICAgICB0aGlzLnJlc29sdmUobnVsbCk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgaWYgKGV2ZW50LmV2ZW50SWQpIHsNCiAgICAgICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLmF1dGguX3JlZGlyZWN0VXNlckZvcklkKGV2ZW50LmV2ZW50SWQpOw0KICAgICAgICAgICAgaWYgKHVzZXIpIHsNCiAgICAgICAgICAgICAgICB0aGlzLnVzZXIgPSB1c2VyOw0KICAgICAgICAgICAgICAgIHJldHVybiBzdXBlci5vbkF1dGhFdmVudChldmVudCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICB0aGlzLnJlc29sdmUobnVsbCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQogICAgYXN5bmMgb25FeGVjdXRpb24oKSB7IH0NCiAgICBjbGVhblVwKCkgeyB9DQp9DQphc3luYyBmdW5jdGlvbiBfZ2V0QW5kQ2xlYXJQZW5kaW5nUmVkaXJlY3RTdGF0dXMocmVzb2x2ZXIsIGF1dGgpIHsNCiAgICBjb25zdCBrZXkgPSBwZW5kaW5nUmVkaXJlY3RLZXkoYXV0aCk7DQogICAgY29uc3QgcGVyc2lzdGVuY2UgPSByZXNvbHZlclBlcnNpc3RlbmNlKHJlc29sdmVyKTsNCiAgICBpZiAoIShhd2FpdCBwZXJzaXN0ZW5jZS5faXNBdmFpbGFibGUoKSkpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBjb25zdCBoYXNQZW5kaW5nUmVkaXJlY3QgPSAoYXdhaXQgcGVyc2lzdGVuY2UuX2dldChrZXkpKSA9PT0gJ3RydWUnOw0KICAgIGF3YWl0IHBlcnNpc3RlbmNlLl9yZW1vdmUoa2V5KTsNCiAgICByZXR1cm4gaGFzUGVuZGluZ1JlZGlyZWN0Ow0KfQ0KZnVuY3Rpb24gX292ZXJyaWRlUmVkaXJlY3RSZXN1bHQoYXV0aCwgcmVzdWx0KSB7DQogICAgcmVkaXJlY3RPdXRjb21lTWFwLnNldChhdXRoLl9rZXkoKSwgcmVzdWx0KTsNCn0NCmZ1bmN0aW9uIHJlc29sdmVyUGVyc2lzdGVuY2UocmVzb2x2ZXIpIHsNCiAgICByZXR1cm4gX2dldEluc3RhbmNlKHJlc29sdmVyLl9yZWRpcmVjdFBlcnNpc3RlbmNlKTsNCn0NCmZ1bmN0aW9uIHBlbmRpbmdSZWRpcmVjdEtleShhdXRoKSB7DQogICAgcmV0dXJuIF9wZXJzaXN0ZW5jZUtleU5hbWUoUEVORElOR19SRURJUkVDVF9LRVksIGF1dGguY29uZmlnLmFwaUtleSwgYXV0aC5uYW1lKTsNCn0KYXN5bmMgZnVuY3Rpb24gX2dldFJlZGlyZWN0UmVzdWx0KGF1dGgsIHJlc29sdmVyRXh0ZXJuLCBieXBhc3NBdXRoU3RhdGUgPSBmYWxzZSkgew0KICAgIGNvbnN0IGF1dGhJbnRlcm5hbCA9IF9jYXN0QXV0aChhdXRoKTsNCiAgICBjb25zdCByZXNvbHZlciA9IF93aXRoRGVmYXVsdFJlc29sdmVyKGF1dGhJbnRlcm5hbCwgcmVzb2x2ZXJFeHRlcm4pOw0KICAgIGNvbnN0IGFjdGlvbiA9IG5ldyBSZWRpcmVjdEFjdGlvbihhdXRoSW50ZXJuYWwsIHJlc29sdmVyLCBieXBhc3NBdXRoU3RhdGUpOw0KICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFjdGlvbi5leGVjdXRlKCk7DQogICAgaWYgKHJlc3VsdCAmJiAhYnlwYXNzQXV0aFN0YXRlKSB7DQogICAgICAgIGRlbGV0ZSByZXN1bHQudXNlci5fcmVkaXJlY3RFdmVudElkOw0KICAgICAgICBhd2FpdCBhdXRoSW50ZXJuYWwuX3BlcnNpc3RVc2VySWZDdXJyZW50KHJlc3VsdC51c2VyKTsNCiAgICAgICAgYXdhaXQgYXV0aEludGVybmFsLl9zZXRSZWRpcmVjdFVzZXIobnVsbCwgcmVzb2x2ZXJFeHRlcm4pOw0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KfQ0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8vIFRoZSBhbW91bnQgb2YgdGltZSB0byBzdG9yZSB0aGUgVUlEcyBvZiBzZWVuIGV2ZW50czsgdGhpcyBpcw0KLy8gc2V0IHRvIDEwIG1pbiBieSBkZWZhdWx0DQpjb25zdCBFVkVOVF9EVVBMSUNBVElPTl9DQUNIRV9EVVJBVElPTl9NUyA9IDEwICogNjAgKiAxMDAwOw0KY2xhc3MgQXV0aEV2ZW50TWFuYWdlciB7DQogICAgY29uc3RydWN0b3IoYXV0aCkgew0KICAgICAgICB0aGlzLmF1dGggPSBhdXRoOw0KICAgICAgICB0aGlzLmNhY2hlZEV2ZW50VWlkcyA9IG5ldyBTZXQoKTsNCiAgICAgICAgdGhpcy5jb25zdW1lcnMgPSBuZXcgU2V0KCk7DQogICAgICAgIHRoaXMucXVldWVkUmVkaXJlY3RFdmVudCA9IG51bGw7DQogICAgICAgIHRoaXMuaGFzSGFuZGxlZFBvdGVudGlhbFJlZGlyZWN0ID0gZmFsc2U7DQogICAgICAgIHRoaXMubGFzdFByb2Nlc3NlZEV2ZW50VGltZSA9IERhdGUubm93KCk7DQogICAgfQ0KICAgIHJlZ2lzdGVyQ29uc3VtZXIoYXV0aEV2ZW50Q29uc3VtZXIpIHsNCiAgICAgICAgdGhpcy5jb25zdW1lcnMuYWRkKGF1dGhFdmVudENvbnN1bWVyKTsNCiAgICAgICAgaWYgKHRoaXMucXVldWVkUmVkaXJlY3RFdmVudCAmJg0KICAgICAgICAgICAgdGhpcy5pc0V2ZW50Rm9yQ29uc3VtZXIodGhpcy5xdWV1ZWRSZWRpcmVjdEV2ZW50LCBhdXRoRXZlbnRDb25zdW1lcikpIHsNCiAgICAgICAgICAgIHRoaXMuc2VuZFRvQ29uc3VtZXIodGhpcy5xdWV1ZWRSZWRpcmVjdEV2ZW50LCBhdXRoRXZlbnRDb25zdW1lcik7DQogICAgICAgICAgICB0aGlzLnNhdmVFdmVudFRvQ2FjaGUodGhpcy5xdWV1ZWRSZWRpcmVjdEV2ZW50KTsNCiAgICAgICAgICAgIHRoaXMucXVldWVkUmVkaXJlY3RFdmVudCA9IG51bGw7DQogICAgICAgIH0NCiAgICB9DQogICAgdW5yZWdpc3RlckNvbnN1bWVyKGF1dGhFdmVudENvbnN1bWVyKSB7DQogICAgICAgIHRoaXMuY29uc3VtZXJzLmRlbGV0ZShhdXRoRXZlbnRDb25zdW1lcik7DQogICAgfQ0KICAgIG9uRXZlbnQoZXZlbnQpIHsNCiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGV2ZW50IGhhcyBhbHJlYWR5IGJlZW4gaGFuZGxlZA0KICAgICAgICBpZiAodGhpcy5oYXNFdmVudEJlZW5IYW5kbGVkKGV2ZW50KSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGxldCBoYW5kbGVkID0gZmFsc2U7DQogICAgICAgIHRoaXMuY29uc3VtZXJzLmZvckVhY2goY29uc3VtZXIgPT4gew0KICAgICAgICAgICAgaWYgKHRoaXMuaXNFdmVudEZvckNvbnN1bWVyKGV2ZW50LCBjb25zdW1lcikpIHsNCiAgICAgICAgICAgICAgICBoYW5kbGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB0aGlzLnNlbmRUb0NvbnN1bWVyKGV2ZW50LCBjb25zdW1lcik7DQogICAgICAgICAgICAgICAgdGhpcy5zYXZlRXZlbnRUb0NhY2hlKGV2ZW50KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIGlmICh0aGlzLmhhc0hhbmRsZWRQb3RlbnRpYWxSZWRpcmVjdCB8fCAhaXNSZWRpcmVjdEV2ZW50KGV2ZW50KSkgew0KICAgICAgICAgICAgLy8gSWYgd2UndmUgYWxyZWFkeSBzZWVuIGEgcmVkaXJlY3QgYmVmb3JlLCBvciB0aGlzIGlzIGEgcG9wdXAgZXZlbnQsDQogICAgICAgICAgICAvLyBiYWlsIG5vdw0KICAgICAgICAgICAgcmV0dXJuIGhhbmRsZWQ7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5oYXNIYW5kbGVkUG90ZW50aWFsUmVkaXJlY3QgPSB0cnVlOw0KICAgICAgICAvLyBJZiB0aGUgcmVkaXJlY3Qgd2Fzbid0IGhhbmRsZWQsIGhhbmcgb24gdG8gaXQNCiAgICAgICAgaWYgKCFoYW5kbGVkKSB7DQogICAgICAgICAgICB0aGlzLnF1ZXVlZFJlZGlyZWN0RXZlbnQgPSBldmVudDsNCiAgICAgICAgICAgIGhhbmRsZWQgPSB0cnVlOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBoYW5kbGVkOw0KICAgIH0NCiAgICBzZW5kVG9Db25zdW1lcihldmVudCwgY29uc3VtZXIpIHsNCiAgICAgICAgdmFyIF9hOw0KICAgICAgICBpZiAoZXZlbnQuZXJyb3IgJiYgIWlzTnVsbFJlZGlyZWN0RXZlbnQoZXZlbnQpKSB7DQogICAgICAgICAgICBjb25zdCBjb2RlID0gKChfYSA9IGV2ZW50LmVycm9yLmNvZGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zcGxpdCgnYXV0aC8nKVsxXSkgfHwNCiAgICAgICAgICAgICAgICAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi87DQogICAgICAgICAgICBjb25zdW1lci5vbkVycm9yKF9jcmVhdGVFcnJvcih0aGlzLmF1dGgsIGNvZGUpKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGNvbnN1bWVyLm9uQXV0aEV2ZW50KGV2ZW50KTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBpc0V2ZW50Rm9yQ29uc3VtZXIoZXZlbnQsIGNvbnN1bWVyKSB7DQogICAgICAgIGNvbnN0IGV2ZW50SWRNYXRjaGVzID0gY29uc3VtZXIuZXZlbnRJZCA9PT0gbnVsbCB8fA0KICAgICAgICAgICAgKCEhZXZlbnQuZXZlbnRJZCAmJiBldmVudC5ldmVudElkID09PSBjb25zdW1lci5ldmVudElkKTsNCiAgICAgICAgcmV0dXJuIGNvbnN1bWVyLmZpbHRlci5pbmNsdWRlcyhldmVudC50eXBlKSAmJiBldmVudElkTWF0Y2hlczsNCiAgICB9DQogICAgaGFzRXZlbnRCZWVuSGFuZGxlZChldmVudCkgew0KICAgICAgICBpZiAoRGF0ZS5ub3coKSAtIHRoaXMubGFzdFByb2Nlc3NlZEV2ZW50VGltZSA+PQ0KICAgICAgICAgICAgRVZFTlRfRFVQTElDQVRJT05fQ0FDSEVfRFVSQVRJT05fTVMpIHsNCiAgICAgICAgICAgIHRoaXMuY2FjaGVkRXZlbnRVaWRzLmNsZWFyKCk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGVkRXZlbnRVaWRzLmhhcyhldmVudFVpZChldmVudCkpOw0KICAgIH0NCiAgICBzYXZlRXZlbnRUb0NhY2hlKGV2ZW50KSB7DQogICAgICAgIHRoaXMuY2FjaGVkRXZlbnRVaWRzLmFkZChldmVudFVpZChldmVudCkpOw0KICAgICAgICB0aGlzLmxhc3RQcm9jZXNzZWRFdmVudFRpbWUgPSBEYXRlLm5vdygpOw0KICAgIH0NCn0NCmZ1bmN0aW9uIGV2ZW50VWlkKGUpIHsNCiAgICByZXR1cm4gW2UudHlwZSwgZS5ldmVudElkLCBlLnNlc3Npb25JZCwgZS50ZW5hbnRJZF0uZmlsdGVyKHYgPT4gdikuam9pbignLScpOw0KfQ0KZnVuY3Rpb24gaXNOdWxsUmVkaXJlY3RFdmVudCh7IHR5cGUsIGVycm9yIH0pIHsNCiAgICByZXR1cm4gKHR5cGUgPT09ICJ1bmtub3duIiAvKiBBdXRoRXZlbnRUeXBlLlVOS05PV04gKi8gJiYNCiAgICAgICAgKGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5jb2RlKSA9PT0gYGF1dGgvJHsibm8tYXV0aC1ldmVudCIgLyogQXV0aEVycm9yQ29kZS5OT19BVVRIX0VWRU5UICovfWApOw0KfQ0KZnVuY3Rpb24gaXNSZWRpcmVjdEV2ZW50KGV2ZW50KSB7DQogICAgc3dpdGNoIChldmVudC50eXBlKSB7DQogICAgICAgIGNhc2UgInNpZ25JblZpYVJlZGlyZWN0IiAvKiBBdXRoRXZlbnRUeXBlLlNJR05fSU5fVklBX1JFRElSRUNUICovOg0KICAgICAgICBjYXNlICJsaW5rVmlhUmVkaXJlY3QiIC8qIEF1dGhFdmVudFR5cGUuTElOS19WSUFfUkVESVJFQ1QgKi86DQogICAgICAgIGNhc2UgInJlYXV0aFZpYVJlZGlyZWN0IiAvKiBBdXRoRXZlbnRUeXBlLlJFQVVUSF9WSUFfUkVESVJFQ1QgKi86DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgY2FzZSAidW5rbm93biIgLyogQXV0aEV2ZW50VHlwZS5VTktOT1dOICovOg0KICAgICAgICAgICAgcmV0dXJuIGlzTnVsbFJlZGlyZWN0RXZlbnQoZXZlbnQpOw0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCmFzeW5jIGZ1bmN0aW9uIF9nZXRQcm9qZWN0Q29uZmlnKGF1dGgsIHJlcXVlc3QgPSB7fSkgew0KICAgIHJldHVybiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgIkdFVCIgLyogSHR0cE1ldGhvZC5HRVQgKi8sICIvdjEvcHJvamVjdHMiIC8qIEVuZHBvaW50LkdFVF9QUk9KRUNUX0NPTkZJRyAqLywgcmVxdWVzdCk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjb25zdCBJUF9BRERSRVNTX1JFR0VYID0gL15cZHsxLDN9XC5cZHsxLDN9XC5cZHsxLDN9XC5cZHsxLDN9JC87DQpjb25zdCBIVFRQX1JFR0VYID0gL15odHRwcz8vOw0KYXN5bmMgZnVuY3Rpb24gX3ZhbGlkYXRlT3JpZ2luKGF1dGgpIHsNCiAgICAvLyBTa2lwIG9yaWdpbiB2YWxpZGF0aW9uIGlmIHdlIGFyZSBpbiBhbiBlbXVsYXRlZCBlbnZpcm9ubWVudA0KICAgIGlmIChhdXRoLmNvbmZpZy5lbXVsYXRvcikgew0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIGNvbnN0IHsgYXV0aG9yaXplZERvbWFpbnMgfSA9IGF3YWl0IF9nZXRQcm9qZWN0Q29uZmlnKGF1dGgpOw0KICAgIGZvciAoY29uc3QgZG9tYWluIG9mIGF1dGhvcml6ZWREb21haW5zKSB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBpZiAobWF0Y2hEb21haW4oZG9tYWluKSkgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBjYXRjaCAoX2EpIHsNCiAgICAgICAgICAgIC8vIERvIG5vdGhpbmcgaWYgdGhlcmUncyBhIFVSTCBlcnJvcjsganVzdCBjb250aW51ZSBzZWFyY2hpbmcNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvLyBJbiB0aGUgb2xkIFNESywgdGhpcyBlcnJvciBhbHNvIHByb3ZpZGVzIGhlbHBmdWwgbWVzc2FnZXMuDQogICAgX2ZhaWwoYXV0aCwgInVuYXV0aG9yaXplZC1kb21haW4iIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9PUklHSU4gKi8pOw0KfQ0KZnVuY3Rpb24gbWF0Y2hEb21haW4oZXhwZWN0ZWQpIHsNCiAgICBjb25zdCBjdXJyZW50VXJsID0gX2dldEN1cnJlbnRVcmwoKTsNCiAgICBjb25zdCB7IHByb3RvY29sLCBob3N0bmFtZSB9ID0gbmV3IFVSTChjdXJyZW50VXJsKTsNCiAgICBpZiAoZXhwZWN0ZWQuc3RhcnRzV2l0aCgnY2hyb21lLWV4dGVuc2lvbjovLycpKSB7DQogICAgICAgIGNvbnN0IGNlVXJsID0gbmV3IFVSTChleHBlY3RlZCk7DQogICAgICAgIGlmIChjZVVybC5ob3N0bmFtZSA9PT0gJycgJiYgaG9zdG5hbWUgPT09ICcnKSB7DQogICAgICAgICAgICAvLyBGb3Igc29tZSByZWFzb24gd2UncmUgbm90IHBhcnNpbmcgY2hyb21lIFVSTHMgcHJvcGVybHkNCiAgICAgICAgICAgIHJldHVybiAocHJvdG9jb2wgPT09ICdjaHJvbWUtZXh0ZW5zaW9uOicgJiYNCiAgICAgICAgICAgICAgICBleHBlY3RlZC5yZXBsYWNlKCdjaHJvbWUtZXh0ZW5zaW9uOi8vJywgJycpID09PQ0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50VXJsLnJlcGxhY2UoJ2Nocm9tZS1leHRlbnNpb246Ly8nLCAnJykpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBwcm90b2NvbCA9PT0gJ2Nocm9tZS1leHRlbnNpb246JyAmJiBjZVVybC5ob3N0bmFtZSA9PT0gaG9zdG5hbWU7DQogICAgfQ0KICAgIGlmICghSFRUUF9SRUdFWC50ZXN0KHByb3RvY29sKSkgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICAgIGlmIChJUF9BRERSRVNTX1JFR0VYLnRlc3QoZXhwZWN0ZWQpKSB7DQogICAgICAgIC8vIFRoZSBkb21haW4gaGFzIHRvIGJlIGV4YWN0bHkgZXF1YWwgdG8gdGhlIHBhdHRlcm4sIGFzIGFuIElQIGRvbWFpbiB3aWxsDQogICAgICAgIC8vIG9ubHkgY29udGFpbiB0aGUgSVAsIG5vIGV4dHJhIGNoYXJhY3Rlci4NCiAgICAgICAgcmV0dXJuIGhvc3RuYW1lID09PSBleHBlY3RlZDsNCiAgICB9DQogICAgLy8gRG90cyBpbiBwYXR0ZXJuIHNob3VsZCBiZSBlc2NhcGVkLg0KICAgIGNvbnN0IGVzY2FwZWREb21haW5QYXR0ZXJuID0gZXhwZWN0ZWQucmVwbGFjZSgvXC4vZywgJ1xcLicpOw0KICAgIC8vIE5vbiBpcCBhZGRyZXNzIGRvbWFpbnMuDQogICAgLy8gZG9tYWluLmNvbSA9ICouZG9tYWluLmNvbSBPUiBkb21haW4uY29tDQogICAgY29uc3QgcmUgPSBuZXcgUmVnRXhwKCdeKC4rXFwuJyArIGVzY2FwZWREb21haW5QYXR0ZXJuICsgJ3wnICsgZXNjYXBlZERvbWFpblBhdHRlcm4gKyAnKSQnLCAnaScpOw0KICAgIHJldHVybiByZS50ZXN0KGhvc3RuYW1lKTsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMuDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpjb25zdCBORVRXT1JLX1RJTUVPVVQgPSBuZXcgRGVsYXkoMzAwMDAsIDYwMDAwKTsNCi8qKg0KICogUmVzZXQgdW5sYW9kZWQgR0FwaSBtb2R1bGVzLiBJZiBnYXBpLmxvYWQgZmFpbHMgZHVlIHRvIGEgbmV0d29yayBlcnJvciwNCiAqIGl0IHdpbGwgc3RvcCB3b3JraW5nIGFmdGVyIGEgcmV0cmlhbC4gVGhpcyBpcyBhIGhhY2sgdG8gZml4IHRoaXMgaXNzdWUuDQogKi8NCmZ1bmN0aW9uIHJlc2V0VW5sb2FkZWRHYXBpTW9kdWxlcygpIHsNCiAgICAvLyBDbGVhciBsYXN0IGZhaWxlZCBnYXBpLmxvYWQgc3RhdGUgdG8gZm9yY2UgbmV4dCBnYXBpLmxvYWQgdG8gZmlyc3QNCiAgICAvLyBsb2FkIHRoZSBmYWlsZWQgZ2FwaS5pZnJhbWVzIG1vZHVsZS4NCiAgICAvLyBHZXQgZ2FwaXguYmVhY29uIGNvbnRleHQuDQogICAgY29uc3QgYmVhY29uID0gX3dpbmRvdyQxKCkuX19fanNsOw0KICAgIC8vIEdldCBjdXJyZW50IGhpbnQuDQogICAgaWYgKGJlYWNvbiA9PT0gbnVsbCB8fCBiZWFjb24gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGJlYWNvbi5IKSB7DQogICAgICAgIC8vIEdldCBnYXBpIGhpbnQuDQogICAgICAgIGZvciAoY29uc3QgaGludCBvZiBPYmplY3Qua2V5cyhiZWFjb24uSCkpIHsNCiAgICAgICAgICAgIC8vIFJlcXVlc3RlZCBtb2R1bGVzLg0KICAgICAgICAgICAgYmVhY29uLkhbaGludF0uciA9IGJlYWNvbi5IW2hpbnRdLnIgfHwgW107DQogICAgICAgICAgICAvLyBMb2FkZWQgbW9kdWxlcy4NCiAgICAgICAgICAgIGJlYWNvbi5IW2hpbnRdLkwgPSBiZWFjb24uSFtoaW50XS5MIHx8IFtdOw0KICAgICAgICAgICAgLy8gU2V0IHJlcXVlc3RlZCBtb2R1bGVzIHRvIGEgY29weSBvZiB0aGUgbG9hZGVkIG1vZHVsZXMuDQogICAgICAgICAgICBiZWFjb24uSFtoaW50XS5yID0gWy4uLmJlYWNvbi5IW2hpbnRdLkxdOw0KICAgICAgICAgICAgLy8gQ2xlYXIgcGVuZGluZyBjYWxsYmFja3MuDQogICAgICAgICAgICBpZiAoYmVhY29uLkNQKSB7DQogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiZWFjb24uQ1AubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGFsbCBmYWlsZWQgcGVuZGluZyBjYWxsYmFja3MuDQogICAgICAgICAgICAgICAgICAgIGJlYWNvbi5DUFtpXSA9IG51bGw7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KfQ0KZnVuY3Rpb24gbG9hZEdhcGkoYXV0aCkgew0KICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgIHZhciBfYSwgX2IsIF9jOw0KICAgICAgICAvLyBGdW5jdGlvbiB0byBydW4gd2hlbiBnYXBpLmxvYWQgaXMgcmVhZHkuDQogICAgICAgIGZ1bmN0aW9uIGxvYWRHYXBpSWZyYW1lKCkgew0KICAgICAgICAgICAgLy8gVGhlIGRldmVsb3BlciBtYXkgaGF2ZSB0cmllZCB0byBwcmV2aW91c2x5IHJ1biBnYXBpLmxvYWQgYW5kIGZhaWxlZC4NCiAgICAgICAgICAgIC8vIFJ1biB0aGlzIHRvIGZpeCB0aGF0Lg0KICAgICAgICAgICAgcmVzZXRVbmxvYWRlZEdhcGlNb2R1bGVzKCk7DQogICAgICAgICAgICBnYXBpLmxvYWQoJ2dhcGkuaWZyYW1lcycsIHsNCiAgICAgICAgICAgICAgICBjYWxsYmFjazogKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGdhcGkuaWZyYW1lcy5nZXRDb250ZXh0KCkpOw0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgb250aW1lb3V0OiAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIC8vIFRoZSBhYm92ZSByZXNldCBtYXkgYmUgc3VmZmljaWVudCwgYnV0IGhhdmluZyB0aGlzIHJlc2V0IGFmdGVyDQogICAgICAgICAgICAgICAgICAgIC8vIGZhaWx1cmUgZW5zdXJlcyB0aGF0IGlmIHRoZSBkZXZlbG9wZXIgY2FsbHMgZ2FwaS5sb2FkIGFmdGVyIHRoZQ0KICAgICAgICAgICAgICAgICAgICAvLyBjb25uZWN0aW9uIGlzIHJlLWVzdGFibGlzaGVkIGFuZCBiZWZvcmUgYW5vdGhlciBhdHRlbXB0IHRvIGVtYmVkDQogICAgICAgICAgICAgICAgICAgIC8vIHRoZSBpZnJhbWUsIGl0IHdvdWxkIHdvcmsgYW5kIHdvdWxkIG5vdCBiZSBicm9rZW4gYmVjYXVzZSBvZiBvdXINCiAgICAgICAgICAgICAgICAgICAgLy8gZmFpbGVkIGF0dGVtcHQuDQogICAgICAgICAgICAgICAgICAgIC8vIFRpbWVvdXQgd2hlbiBnYXBpLmlmcmFtZXMuSWZyYW1lIG5vdCBsb2FkZWQuDQogICAgICAgICAgICAgICAgICAgIHJlc2V0VW5sb2FkZWRHYXBpTW9kdWxlcygpOw0KICAgICAgICAgICAgICAgICAgICByZWplY3QoX2NyZWF0ZUVycm9yKGF1dGgsICJuZXR3b3JrLXJlcXVlc3QtZmFpbGVkIiAvKiBBdXRoRXJyb3JDb2RlLk5FVFdPUktfUkVRVUVTVF9GQUlMRUQgKi8pKTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHRpbWVvdXQ6IE5FVFdPUktfVElNRU9VVC5nZXQoKQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKChfYiA9IChfYSA9IF93aW5kb3ckMSgpLmdhcGkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pZnJhbWVzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuSWZyYW1lKSB7DQogICAgICAgICAgICAvLyBJZiBnYXBpLmlmcmFtZXMuSWZyYW1lIGF2YWlsYWJsZSwgcmVzb2x2ZS4NCiAgICAgICAgICAgIHJlc29sdmUoZ2FwaS5pZnJhbWVzLmdldENvbnRleHQoKSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoISEoKF9jID0gX3dpbmRvdyQxKCkuZ2FwaSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmxvYWQpKSB7DQogICAgICAgICAgICAvLyBHYXBpIGxvYWRlciByZWFkeSwgbG9hZCBnYXBpLmlmcmFtZXMuDQogICAgICAgICAgICBsb2FkR2FwaUlmcmFtZSgpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IGlmcmFtZSBjYWxsYmFjayB3aGVuIHRoaXMgaXMgY2FsbGVkIHNvIGFzIG5vdCB0byBvdmVyd3JpdGUNCiAgICAgICAgICAgIC8vIGFueSBwcmV2aW91cyBkZWZpbmVkIGNhbGxiYWNrLiBUaGlzIGhhcHBlbnMgaWYgdGhpcyBtZXRob2QgaXMgY2FsbGVkDQogICAgICAgICAgICAvLyBtdWx0aXBsZSB0aW1lcyBpbiBwYXJhbGxlbCBhbmQgY291bGQgcmVzdWx0IGluIHRoZSBsYXRlciBjYWxsYmFjaw0KICAgICAgICAgICAgLy8gb3ZlcndyaXRpbmcgdGhlIHByZXZpb3VzIG9uZS4gVGhpcyB3b3VsZCBlbmQgdXAgd2l0aCBhIGlmcmFtZQ0KICAgICAgICAgICAgLy8gdGltZW91dC4NCiAgICAgICAgICAgIGNvbnN0IGNiTmFtZSA9IF9nZW5lcmF0ZUNhbGxiYWNrTmFtZSgnaWZyYW1lZmNiJyk7DQogICAgICAgICAgICAvLyBHQXBpIGxvYWRlciBub3QgYXZhaWxhYmxlLCBkeW5hbWljYWxseSBsb2FkIHBsYXRmb3JtLmpzLg0KICAgICAgICAgICAgX3dpbmRvdyQxKClbY2JOYW1lXSA9ICgpID0+IHsNCiAgICAgICAgICAgICAgICAvLyBHQXBpIGxvYWRlciBzaG91bGQgYmUgcmVhZHkuDQogICAgICAgICAgICAgICAgaWYgKCEhZ2FwaS5sb2FkKSB7DQogICAgICAgICAgICAgICAgICAgIGxvYWRHYXBpSWZyYW1lKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAvLyBHYXBpIGxvYWRlciBmYWlsZWQsIHRocm93IGVycm9yLg0KICAgICAgICAgICAgICAgICAgICByZWplY3QoX2NyZWF0ZUVycm9yKGF1dGgsICJuZXR3b3JrLXJlcXVlc3QtZmFpbGVkIiAvKiBBdXRoRXJyb3JDb2RlLk5FVFdPUktfUkVRVUVTVF9GQUlMRUQgKi8pKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgLy8gTG9hZCBHQXBpIGxvYWRlci4NCiAgICAgICAgICAgIHJldHVybiBfbG9hZEpTKGBodHRwczovL2FwaXMuZ29vZ2xlLmNvbS9qcy9hcGkuanM/b25sb2FkPSR7Y2JOYW1lfWApDQogICAgICAgICAgICAgICAgLmNhdGNoKGUgPT4gcmVqZWN0KGUpKTsNCiAgICAgICAgfQ0KICAgIH0pLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgLy8gUmVzZXQgY2FjaGVkIHByb21pc2UgdG8gYWxsb3cgZm9yIHJldHJpYWwuDQogICAgICAgIGNhY2hlZEdBcGlMb2FkZXIgPSBudWxsOw0KICAgICAgICB0aHJvdyBlcnJvcjsNCiAgICB9KTsNCn0NCmxldCBjYWNoZWRHQXBpTG9hZGVyID0gbnVsbDsNCmZ1bmN0aW9uIF9sb2FkR2FwaShhdXRoKSB7DQogICAgY2FjaGVkR0FwaUxvYWRlciA9IGNhY2hlZEdBcGlMb2FkZXIgfHwgbG9hZEdhcGkoYXV0aCk7DQogICAgcmV0dXJuIGNhY2hlZEdBcGlMb2FkZXI7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDLg0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY29uc3QgUElOR19USU1FT1VUID0gbmV3IERlbGF5KDUwMDAsIDE1MDAwKTsNCmNvbnN0IElGUkFNRV9QQVRIID0gJ19fL2F1dGgvaWZyYW1lJzsNCmNvbnN0IEVNVUxBVEVEX0lGUkFNRV9QQVRIID0gJ2VtdWxhdG9yL2F1dGgvaWZyYW1lJzsNCmNvbnN0IElGUkFNRV9BVFRSSUJVVEVTID0gew0KICAgIHN0eWxlOiB7DQogICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLA0KICAgICAgICB0b3A6ICctMTAwcHgnLA0KICAgICAgICB3aWR0aDogJzFweCcsDQogICAgICAgIGhlaWdodDogJzFweCcNCiAgICB9LA0KICAgICdhcmlhLWhpZGRlbic6ICd0cnVlJywNCiAgICB0YWJpbmRleDogJy0xJw0KfTsNCi8vIE1hcCBmcm9tIGFwaUhvc3QgdG8gZW5kcG9pbnQgSUQgZm9yIHBhc3NpbmcgaW50byBpZnJhbWUuIEluIGN1cnJlbnQgU0RLLCBhcGlIb3N0IGNhbiBiZSBzZXQgdG8NCi8vIGFueXRoaW5nIChub3QgZnJvbSBhIGxpc3Qgb2YgZW5kcG9pbnRzIHdpdGggSURzIGFzIGluIGxlZ2FjeSksIHNvIHRoaXMgaXMgdGhlIGNsb3Nlc3Qgd2UgY2FuIGdldC4NCmNvbnN0IEVJRF9GUk9NX0FQSUhPU1QgPSBuZXcgTWFwKFsNCiAgICBbImlkZW50aXR5dG9vbGtpdC5nb29nbGVhcGlzLmNvbSIgLyogRGVmYXVsdENvbmZpZy5BUElfSE9TVCAqLywgJ3AnXSwNCiAgICBbJ3N0YWdpbmctaWRlbnRpdHl0b29sa2l0LnNhbmRib3guZ29vZ2xlYXBpcy5jb20nLCAncyddLA0KICAgIFsndGVzdC1pZGVudGl0eXRvb2xraXQuc2FuZGJveC5nb29nbGVhcGlzLmNvbScsICd0J10gLy8gdGVzdA0KXSk7DQpmdW5jdGlvbiBnZXRJZnJhbWVVcmwoYXV0aCkgew0KICAgIGNvbnN0IGNvbmZpZyA9IGF1dGguY29uZmlnOw0KICAgIF9hc3NlcnQoY29uZmlnLmF1dGhEb21haW4sIGF1dGgsICJhdXRoLWRvbWFpbi1jb25maWctcmVxdWlyZWQiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19BVVRIX0RPTUFJTiAqLyk7DQogICAgY29uc3QgdXJsID0gY29uZmlnLmVtdWxhdG9yDQogICAgICAgID8gX2VtdWxhdG9yVXJsKGNvbmZpZywgRU1VTEFURURfSUZSQU1FX1BBVEgpDQogICAgICAgIDogYGh0dHBzOi8vJHthdXRoLmNvbmZpZy5hdXRoRG9tYWlufS8ke0lGUkFNRV9QQVRIfWA7DQogICAgY29uc3QgcGFyYW1zID0gew0KICAgICAgICBhcGlLZXk6IGNvbmZpZy5hcGlLZXksDQogICAgICAgIGFwcE5hbWU6IGF1dGgubmFtZSwNCiAgICAgICAgdjogU0RLX1ZFUlNJT04kMQ0KICAgIH07DQogICAgY29uc3QgZWlkID0gRUlEX0ZST01fQVBJSE9TVC5nZXQoYXV0aC5jb25maWcuYXBpSG9zdCk7DQogICAgaWYgKGVpZCkgew0KICAgICAgICBwYXJhbXMuZWlkID0gZWlkOw0KICAgIH0NCiAgICBjb25zdCBmcmFtZXdvcmtzID0gYXV0aC5fZ2V0RnJhbWV3b3JrcygpOw0KICAgIGlmIChmcmFtZXdvcmtzLmxlbmd0aCkgew0KICAgICAgICBwYXJhbXMuZncgPSBmcmFtZXdvcmtzLmpvaW4oJywnKTsNCiAgICB9DQogICAgcmV0dXJuIGAke3VybH0/JHtxdWVyeXN0cmluZyQxKHBhcmFtcykuc2xpY2UoMSl9YDsNCn0NCmFzeW5jIGZ1bmN0aW9uIF9vcGVuSWZyYW1lKGF1dGgpIHsNCiAgICBjb25zdCBjb250ZXh0ID0gYXdhaXQgX2xvYWRHYXBpKGF1dGgpOw0KICAgIGNvbnN0IGdhcGkgPSBfd2luZG93JDEoKS5nYXBpOw0KICAgIF9hc3NlcnQoZ2FwaSwgYXV0aCwgImludGVybmFsLWVycm9yIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTsNCiAgICByZXR1cm4gY29udGV4dC5vcGVuKHsNCiAgICAgICAgd2hlcmU6IGRvY3VtZW50LmJvZHksDQogICAgICAgIHVybDogZ2V0SWZyYW1lVXJsKGF1dGgpLA0KICAgICAgICBtZXNzYWdlSGFuZGxlcnNGaWx0ZXI6IGdhcGkuaWZyYW1lcy5DUk9TU19PUklHSU5fSUZSQU1FU19GSUxURVIsDQogICAgICAgIGF0dHJpYnV0ZXM6IElGUkFNRV9BVFRSSUJVVEVTLA0KICAgICAgICBkb250Y2xlYXI6IHRydWUNCiAgICB9LCAoaWZyYW1lKSA9PiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgIGF3YWl0IGlmcmFtZS5yZXN0eWxlKHsNCiAgICAgICAgICAgIC8vIFByZXZlbnQgaWZyYW1lIGZyb20gY2xvc2luZyBvbiBtb3VzZSBvdXQuDQogICAgICAgICAgICBzZXRIaWRlT25MZWF2ZTogZmFsc2UNCiAgICAgICAgfSk7DQogICAgICAgIGNvbnN0IG5ldHdvcmtFcnJvciA9IF9jcmVhdGVFcnJvcihhdXRoLCAibmV0d29yay1yZXF1ZXN0LWZhaWxlZCIgLyogQXV0aEVycm9yQ29kZS5ORVRXT1JLX1JFUVVFU1RfRkFJTEVEICovKTsNCiAgICAgICAgLy8gQ29uZmlybSBpZnJhbWUgaXMgY29ycmVjdGx5IGxvYWRlZC4NCiAgICAgICAgLy8gVG8gZmFsbGJhY2sgb24gZmFpbHVyZSwgc2V0IGEgdGltZW91dC4NCiAgICAgICAgY29uc3QgbmV0d29ya0Vycm9yVGltZXIgPSBfd2luZG93JDEoKS5zZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgIHJlamVjdChuZXR3b3JrRXJyb3IpOw0KICAgICAgICB9LCBQSU5HX1RJTUVPVVQuZ2V0KCkpOw0KICAgICAgICAvLyBDbGVhciB0aW1lciBhbmQgcmVzb2x2ZSBwZW5kaW5nIGlmcmFtZSByZWFkeSBwcm9taXNlLg0KICAgICAgICBmdW5jdGlvbiBjbGVhclRpbWVyQW5kUmVzb2x2ZSgpIHsNCiAgICAgICAgICAgIF93aW5kb3ckMSgpLmNsZWFyVGltZW91dChuZXR3b3JrRXJyb3JUaW1lcik7DQogICAgICAgICAgICByZXNvbHZlKGlmcmFtZSk7DQogICAgICAgIH0NCiAgICAgICAgLy8gVGhpcyByZXR1cm5zIGFuIElUaGVuYWJsZS4gSG93ZXZlciB0aGUgcmVqZWN0IHBhcnQgZG9lcyBub3QgY2FsbA0KICAgICAgICAvLyB3aGVuIHRoZSBpZnJhbWUgaXMgbm90IGxvYWRlZC4NCiAgICAgICAgaWZyYW1lLnBpbmcoY2xlYXJUaW1lckFuZFJlc29sdmUpLnRoZW4oY2xlYXJUaW1lckFuZFJlc29sdmUsICgpID0+IHsNCiAgICAgICAgICAgIHJlamVjdChuZXR3b3JrRXJyb3IpOw0KICAgICAgICB9KTsNCiAgICB9KSk7DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDLg0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY29uc3QgQkFTRV9QT1BVUF9PUFRJT05TID0gew0KICAgIGxvY2F0aW9uOiAneWVzJywNCiAgICByZXNpemFibGU6ICd5ZXMnLA0KICAgIHN0YXR1c2JhcjogJ3llcycsDQogICAgdG9vbGJhcjogJ25vJw0KfTsNCmNvbnN0IERFRkFVTFRfV0lEVEggPSA1MDA7DQpjb25zdCBERUZBVUxUX0hFSUdIVCA9IDYwMDsNCmNvbnN0IFRBUkdFVF9CTEFOSyA9ICdfYmxhbmsnOw0KY29uc3QgRklSRUZPWF9FTVBUWV9VUkwgPSAnaHR0cDovL2xvY2FsaG9zdCc7DQpjbGFzcyBBdXRoUG9wdXAgew0KICAgIGNvbnN0cnVjdG9yKHdpbmRvdykgew0KICAgICAgICB0aGlzLndpbmRvdyA9IHdpbmRvdzsNCiAgICAgICAgdGhpcy5hc3NvY2lhdGVkRXZlbnQgPSBudWxsOw0KICAgIH0NCiAgICBjbG9zZSgpIHsNCiAgICAgICAgaWYgKHRoaXMud2luZG93KSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIHRoaXMud2luZG93LmNsb3NlKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCAoZSkgeyB9DQogICAgICAgIH0NCiAgICB9DQp9DQpmdW5jdGlvbiBfb3BlbihhdXRoLCB1cmwsIG5hbWUsIHdpZHRoID0gREVGQVVMVF9XSURUSCwgaGVpZ2h0ID0gREVGQVVMVF9IRUlHSFQpIHsNCiAgICBjb25zdCB0b3AgPSBNYXRoLm1heCgod2luZG93LnNjcmVlbi5hdmFpbEhlaWdodCAtIGhlaWdodCkgLyAyLCAwKS50b1N0cmluZygpOw0KICAgIGNvbnN0IGxlZnQgPSBNYXRoLm1heCgod2luZG93LnNjcmVlbi5hdmFpbFdpZHRoIC0gd2lkdGgpIC8gMiwgMCkudG9TdHJpbmcoKTsNCiAgICBsZXQgdGFyZ2V0ID0gJyc7DQogICAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgQkFTRV9QT1BVUF9PUFRJT05TKSwgeyB3aWR0aDogd2lkdGgudG9TdHJpbmcoKSwgaGVpZ2h0OiBoZWlnaHQudG9TdHJpbmcoKSwgdG9wLA0KICAgICAgICBsZWZ0IH0pOw0KICAgIC8vIENocm9tZSBpT1MgNyBhbmQgOCBpcyByZXR1cm5pbmcgYW4gdW5kZWZpbmVkIHBvcHVwIHdpbiB3aGVuIHRhcmdldCBpcw0KICAgIC8vIHNwZWNpZmllZCwgZXZlbiB0aG91Z2ggdGhlIHBvcHVwIGlzIG5vdCBuZWNlc3NhcmlseSBibG9ja2VkLg0KICAgIGNvbnN0IHVhID0gZ2V0VUEoKS50b0xvd2VyQ2FzZSgpOw0KICAgIGlmIChuYW1lKSB7DQogICAgICAgIHRhcmdldCA9IF9pc0Nocm9tZUlPUyh1YSkgPyBUQVJHRVRfQkxBTksgOiBuYW1lOw0KICAgIH0NCiAgICBpZiAoX2lzRmlyZWZveCh1YSkpIHsNCiAgICAgICAgLy8gRmlyZWZveCBjb21wbGFpbnMgd2hlbiBpbnZhbGlkIFVSTHMgYXJlIHBvcHBlZCBvdXQuIEhhY2t5IHdheSB0byBieXBhc3MuDQogICAgICAgIHVybCA9IHVybCB8fCBGSVJFRk9YX0VNUFRZX1VSTDsNCiAgICAgICAgLy8gRmlyZWZveCBkaXNhYmxlcyBieSBkZWZhdWx0IHNjcm9sbGluZyBvbiBwb3B1cCB3aW5kb3dzLCB3aGljaCBjYW4gY3JlYXRlDQogICAgICAgIC8vIGlzc3VlcyB3aGVuIHRoZSB1c2VyIGhhcyBtYW55IEdvb2dsZSBhY2NvdW50cywgZm9yIGluc3RhbmNlLg0KICAgICAgICBvcHRpb25zLnNjcm9sbGJhcnMgPSAneWVzJzsNCiAgICB9DQogICAgY29uc3Qgb3B0aW9uc1N0cmluZyA9IE9iamVjdC5lbnRyaWVzKG9wdGlvbnMpLnJlZHVjZSgoYWNjdW0sIFtrZXksIHZhbHVlXSkgPT4gYCR7YWNjdW19JHtrZXl9PSR7dmFsdWV9LGAsICcnKTsNCiAgICBpZiAoX2lzSU9TU3RhbmRhbG9uZSh1YSkgJiYgdGFyZ2V0ICE9PSAnX3NlbGYnKSB7DQogICAgICAgIG9wZW5Bc05ld1dpbmRvd0lPUyh1cmwgfHwgJycsIHRhcmdldCk7DQogICAgICAgIHJldHVybiBuZXcgQXV0aFBvcHVwKG51bGwpOw0KICAgIH0NCiAgICAvLyBhYm91dDpibGFuayBnZXR0aW5nIHNhbml0aXplZCBjYXVzaW5nIGJyb3dzZXJzIGxpa2UgSUUvRWRnZSB0byBkaXNwbGF5DQogICAgLy8gYnJpZWYgZXJyb3IgbWVzc2FnZSBiZWZvcmUgcmVkaXJlY3RpbmcgdG8gaGFuZGxlci4NCiAgICBjb25zdCBuZXdXaW4gPSB3aW5kb3cub3Blbih1cmwgfHwgJycsIHRhcmdldCwgb3B0aW9uc1N0cmluZyk7DQogICAgX2Fzc2VydChuZXdXaW4sIGF1dGgsICJwb3B1cC1ibG9ja2VkIiAvKiBBdXRoRXJyb3JDb2RlLlBPUFVQX0JMT0NLRUQgKi8pOw0KICAgIC8vIEZsYWt5IG9uIElFIGVkZ2UsIGVuY2Fwc3VsYXRlIHdpdGggYSB0cnkgYW5kIGNhdGNoLg0KICAgIHRyeSB7DQogICAgICAgIG5ld1dpbi5mb2N1cygpOw0KICAgIH0NCiAgICBjYXRjaCAoZSkgeyB9DQogICAgcmV0dXJuIG5ldyBBdXRoUG9wdXAobmV3V2luKTsNCn0NCmZ1bmN0aW9uIG9wZW5Bc05ld1dpbmRvd0lPUyh1cmwsIHRhcmdldCkgew0KICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOw0KICAgIGVsLmhyZWYgPSB1cmw7DQogICAgZWwudGFyZ2V0ID0gdGFyZ2V0Ow0KICAgIGNvbnN0IGNsaWNrID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ01vdXNlRXZlbnQnKTsNCiAgICBjbGljay5pbml0TW91c2VFdmVudCgnY2xpY2snLCB0cnVlLCB0cnVlLCB3aW5kb3csIDEsIDAsIDAsIDAsIDAsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCAxLCBudWxsKTsNCiAgICBlbC5kaXNwYXRjaEV2ZW50KGNsaWNrKTsNCn0KCi8qKg0KICogQGxpY2Vuc2UNCiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTEMNCiAqDQogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsNCiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4NCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KICoNCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQogKg0KICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQ0KICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywNCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLg0KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZA0KICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCi8qKg0KICogVVJMIGZvciBBdXRoZW50aWNhdGlvbiB3aWRnZXQgd2hpY2ggd2lsbCBpbml0aWF0ZSB0aGUgT0F1dGggaGFuZHNoYWtlDQogKg0KICogQGludGVybmFsDQogKi8NCmNvbnN0IFdJREdFVF9QQVRIID0gJ19fL2F1dGgvaGFuZGxlcic7DQovKioNCiAqIFVSTCBmb3IgZW11bGF0ZWQgZW52aXJvbm1lbnQNCiAqDQogKiBAaW50ZXJuYWwNCiAqLw0KY29uc3QgRU1VTEFUT1JfV0lER0VUX1BBVEggPSAnZW11bGF0b3IvYXV0aC9oYW5kbGVyJzsNCi8qKg0KICogRnJhZ21lbnQgbmFtZSBmb3IgdGhlIEFwcCBDaGVjayB0b2tlbiB0aGF0IGdldHMgcGFzc2VkIHRvIHRoZSB3aWRnZXQNCiAqDQogKiBAaW50ZXJuYWwNCiAqLw0KY29uc3QgRklSRUJBU0VfQVBQX0NIRUNLX0ZSQUdNRU5UX0lEID0gZW5jb2RlVVJJQ29tcG9uZW50KCdmYWMnKTsNCmFzeW5jIGZ1bmN0aW9uIF9nZXRSZWRpcmVjdFVybChhdXRoLCBwcm92aWRlciwgYXV0aFR5cGUsIHJlZGlyZWN0VXJsLCBldmVudElkLCBhZGRpdGlvbmFsUGFyYW1zKSB7DQogICAgX2Fzc2VydChhdXRoLmNvbmZpZy5hdXRoRG9tYWluLCBhdXRoLCAiYXV0aC1kb21haW4tY29uZmlnLXJlcXVpcmVkIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfQVVUSF9ET01BSU4gKi8pOw0KICAgIF9hc3NlcnQoYXV0aC5jb25maWcuYXBpS2V5LCBhdXRoLCAiaW52YWxpZC1hcGkta2V5IiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQVBJX0tFWSAqLyk7DQogICAgY29uc3QgcGFyYW1zID0gew0KICAgICAgICBhcGlLZXk6IGF1dGguY29uZmlnLmFwaUtleSwNCiAgICAgICAgYXBwTmFtZTogYXV0aC5uYW1lLA0KICAgICAgICBhdXRoVHlwZSwNCiAgICAgICAgcmVkaXJlY3RVcmwsDQogICAgICAgIHY6IFNES19WRVJTSU9OJDEsDQogICAgICAgIGV2ZW50SWQNCiAgICB9Ow0KICAgIGlmIChwcm92aWRlciBpbnN0YW5jZW9mIEZlZGVyYXRlZEF1dGhQcm92aWRlcikgew0KICAgICAgICBwcm92aWRlci5zZXREZWZhdWx0TGFuZ3VhZ2UoYXV0aC5sYW5ndWFnZUNvZGUpOw0KICAgICAgICBwYXJhbXMucHJvdmlkZXJJZCA9IHByb3ZpZGVyLnByb3ZpZGVySWQgfHwgJyc7DQogICAgICAgIGlmICghaXNFbXB0eShwcm92aWRlci5nZXRDdXN0b21QYXJhbWV0ZXJzKCkpKSB7DQogICAgICAgICAgICBwYXJhbXMuY3VzdG9tUGFyYW1ldGVycyA9IEpTT04uc3RyaW5naWZ5KHByb3ZpZGVyLmdldEN1c3RvbVBhcmFtZXRlcnMoKSk7DQogICAgICAgIH0NCiAgICAgICAgLy8gVE9ETyBzZXQgYWRkaXRpb25hbFBhcmFtcyBmcm9tIHRoZSBwcm92aWRlciBhcyB3ZWxsPw0KICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhhZGRpdGlvbmFsUGFyYW1zIHx8IHt9KSkgew0KICAgICAgICAgICAgcGFyYW1zW2tleV0gPSB2YWx1ZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBpZiAocHJvdmlkZXIgaW5zdGFuY2VvZiBCYXNlT0F1dGhQcm92aWRlcikgew0KICAgICAgICBjb25zdCBzY29wZXMgPSBwcm92aWRlci5nZXRTY29wZXMoKS5maWx0ZXIoc2NvcGUgPT4gc2NvcGUgIT09ICcnKTsNCiAgICAgICAgaWYgKHNjb3Blcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICBwYXJhbXMuc2NvcGVzID0gc2NvcGVzLmpvaW4oJywnKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBpZiAoYXV0aC50ZW5hbnRJZCkgew0KICAgICAgICBwYXJhbXMudGlkID0gYXV0aC50ZW5hbnRJZDsNCiAgICB9DQogICAgLy8gVE9ETzogbWF5YmUgc2V0IGVpZCBhcyBlbmRpcG9pbnRJZA0KICAgIC8vIFRPRE86IG1heWJlIHNldCBmdyBhcyBGcmFtZXdvcmtzLmpvaW4oIiwiKQ0KICAgIGNvbnN0IHBhcmFtc0RpY3QgPSBwYXJhbXM7DQogICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMocGFyYW1zRGljdCkpIHsNCiAgICAgICAgaWYgKHBhcmFtc0RpY3Rba2V5XSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICBkZWxldGUgcGFyYW1zRGljdFtrZXldOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8vIFNldHMgdGhlIEFwcCBDaGVjayB0b2tlbiB0byBwYXNzIHRvIHRoZSB3aWRnZXQNCiAgICBjb25zdCBhcHBDaGVja1Rva2VuID0gYXdhaXQgYXV0aC5fZ2V0QXBwQ2hlY2tUb2tlbigpOw0KICAgIGNvbnN0IGFwcENoZWNrVG9rZW5GcmFnbWVudCA9IGFwcENoZWNrVG9rZW4NCiAgICAgICAgPyBgIyR7RklSRUJBU0VfQVBQX0NIRUNLX0ZSQUdNRU5UX0lEfT0ke2VuY29kZVVSSUNvbXBvbmVudChhcHBDaGVja1Rva2VuKX1gDQogICAgICAgIDogJyc7DQogICAgLy8gU3RhcnQgYXQgaW5kZXggMSB0byBza2lwIHRoZSBsZWFkaW5nICcmJyBpbiB0aGUgcXVlcnkgc3RyaW5nDQogICAgcmV0dXJuIGAke2dldEhhbmRsZXJCYXNlKGF1dGgpfT8ke3F1ZXJ5c3RyaW5nJDEocGFyYW1zRGljdCkuc2xpY2UoMSl9JHthcHBDaGVja1Rva2VuRnJhZ21lbnR9YDsNCn0NCmZ1bmN0aW9uIGdldEhhbmRsZXJCYXNlKHsgY29uZmlnIH0pIHsNCiAgICBpZiAoIWNvbmZpZy5lbXVsYXRvcikgew0KICAgICAgICByZXR1cm4gYGh0dHBzOi8vJHtjb25maWcuYXV0aERvbWFpbn0vJHtXSURHRVRfUEFUSH1gOw0KICAgIH0NCiAgICByZXR1cm4gX2VtdWxhdG9yVXJsKGNvbmZpZywgRU1VTEFUT1JfV0lER0VUX1BBVEgpOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KLyoqDQogKiBUaGUgc3BlY2lhbCB3ZWIgc3RvcmFnZSBldmVudA0KICoNCiAqLw0KY29uc3QgV0VCX1NUT1JBR0VfU1VQUE9SVF9LRVkgPSAnd2ViU3RvcmFnZVN1cHBvcnQnOw0KY2xhc3MgQnJvd3NlclBvcHVwUmVkaXJlY3RSZXNvbHZlciB7DQogICAgY29uc3RydWN0b3IoKSB7DQogICAgICAgIHRoaXMuZXZlbnRNYW5hZ2VycyA9IHt9Ow0KICAgICAgICB0aGlzLmlmcmFtZXMgPSB7fTsNCiAgICAgICAgdGhpcy5vcmlnaW5WYWxpZGF0aW9uUHJvbWlzZXMgPSB7fTsNCiAgICAgICAgdGhpcy5fcmVkaXJlY3RQZXJzaXN0ZW5jZSA9IGJyb3dzZXJTZXNzaW9uUGVyc2lzdGVuY2U7DQogICAgICAgIHRoaXMuX2NvbXBsZXRlUmVkaXJlY3RGbiA9IF9nZXRSZWRpcmVjdFJlc3VsdDsNCiAgICAgICAgdGhpcy5fb3ZlcnJpZGVSZWRpcmVjdFJlc3VsdCA9IF9vdmVycmlkZVJlZGlyZWN0UmVzdWx0Ow0KICAgIH0NCiAgICAvLyBXcmFwcGluZyBpbiBhc3luYyBldmVuIHRob3VnaCB3ZSBkb24ndCBhd2FpdCBhbnl3aGVyZSBpbiBvcmRlcg0KICAgIC8vIHRvIG1ha2Ugc3VyZSBlcnJvcnMgYXJlIHJhaXNlZCBhcyBwcm9taXNlIHJlamVjdGlvbnMNCiAgICBhc3luYyBfb3BlblBvcHVwKGF1dGgsIHByb3ZpZGVyLCBhdXRoVHlwZSwgZXZlbnRJZCkgew0KICAgICAgICB2YXIgX2E7DQogICAgICAgIGRlYnVnQXNzZXJ0KChfYSA9IHRoaXMuZXZlbnRNYW5hZ2Vyc1thdXRoLl9rZXkoKV0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5tYW5hZ2VyLCAnX2luaXRpYWxpemUoKSBub3QgY2FsbGVkIGJlZm9yZSBfb3BlblBvcHVwKCknKTsNCiAgICAgICAgY29uc3QgdXJsID0gYXdhaXQgX2dldFJlZGlyZWN0VXJsKGF1dGgsIHByb3ZpZGVyLCBhdXRoVHlwZSwgX2dldEN1cnJlbnRVcmwoKSwgZXZlbnRJZCk7DQogICAgICAgIHJldHVybiBfb3BlbihhdXRoLCB1cmwsIF9nZW5lcmF0ZUV2ZW50SWQoKSk7DQogICAgfQ0KICAgIGFzeW5jIF9vcGVuUmVkaXJlY3QoYXV0aCwgcHJvdmlkZXIsIGF1dGhUeXBlLCBldmVudElkKSB7DQogICAgICAgIGF3YWl0IHRoaXMuX29yaWdpblZhbGlkYXRpb24oYXV0aCk7DQogICAgICAgIGNvbnN0IHVybCA9IGF3YWl0IF9nZXRSZWRpcmVjdFVybChhdXRoLCBwcm92aWRlciwgYXV0aFR5cGUsIF9nZXRDdXJyZW50VXJsKCksIGV2ZW50SWQpOw0KICAgICAgICBfc2V0V2luZG93TG9jYXRpb24odXJsKTsNCiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKCgpID0+IHsgfSk7DQogICAgfQ0KICAgIF9pbml0aWFsaXplKGF1dGgpIHsNCiAgICAgICAgY29uc3Qga2V5ID0gYXV0aC5fa2V5KCk7DQogICAgICAgIGlmICh0aGlzLmV2ZW50TWFuYWdlcnNba2V5XSkgew0KICAgICAgICAgICAgY29uc3QgeyBtYW5hZ2VyLCBwcm9taXNlIH0gPSB0aGlzLmV2ZW50TWFuYWdlcnNba2V5XTsNCiAgICAgICAgICAgIGlmIChtYW5hZ2VyKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShtYW5hZ2VyKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGRlYnVnQXNzZXJ0KHByb21pc2UsICdJZiBtYW5hZ2VyIGlzIG5vdCBzZXQsIHByb21pc2Ugc2hvdWxkIGJlJyk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgcHJvbWlzZSA9IHRoaXMuaW5pdEFuZEdldE1hbmFnZXIoYXV0aCk7DQogICAgICAgIHRoaXMuZXZlbnRNYW5hZ2Vyc1trZXldID0geyBwcm9taXNlIH07DQogICAgICAgIC8vIElmIHRoZSBwcm9taXNlIGlzIHJlamVjdGVkLCB0aGUga2V5IHNob3VsZCBiZSByZW1vdmVkIHNvIHRoYXQgdGhlDQogICAgICAgIC8vIG9wZXJhdGlvbiBjYW4gYmUgcmV0cmllZCBsYXRlci4NCiAgICAgICAgcHJvbWlzZS5jYXRjaCgoKSA9PiB7DQogICAgICAgICAgICBkZWxldGUgdGhpcy5ldmVudE1hbmFnZXJzW2tleV07DQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gcHJvbWlzZTsNCiAgICB9DQogICAgYXN5bmMgaW5pdEFuZEdldE1hbmFnZXIoYXV0aCkgew0KICAgICAgICBjb25zdCBpZnJhbWUgPSBhd2FpdCBfb3BlbklmcmFtZShhdXRoKTsNCiAgICAgICAgY29uc3QgbWFuYWdlciA9IG5ldyBBdXRoRXZlbnRNYW5hZ2VyKGF1dGgpOw0KICAgICAgICBpZnJhbWUucmVnaXN0ZXIoJ2F1dGhFdmVudCcsIChpZnJhbWVFdmVudCkgPT4gew0KICAgICAgICAgICAgX2Fzc2VydChpZnJhbWVFdmVudCA9PT0gbnVsbCB8fCBpZnJhbWVFdmVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogaWZyYW1lRXZlbnQuYXV0aEV2ZW50LCBhdXRoLCAiaW52YWxpZC1hdXRoLWV2ZW50IiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQVVUSF9FVkVOVCAqLyk7DQogICAgICAgICAgICAvLyBUT0RPOiBDb25zaWRlciBzcGxpdHRpbmcgcmVkaXJlY3QgYW5kIHBvcHVwIGV2ZW50cyBlYXJsaWVyIG9uDQogICAgICAgICAgICBjb25zdCBoYW5kbGVkID0gbWFuYWdlci5vbkV2ZW50KGlmcmFtZUV2ZW50LmF1dGhFdmVudCk7DQogICAgICAgICAgICByZXR1cm4geyBzdGF0dXM6IGhhbmRsZWQgPyAiQUNLIiAvKiBHYXBpT3V0Y29tZS5BQ0sgKi8gOiAiRVJST1IiIC8qIEdhcGlPdXRjb21lLkVSUk9SICovIH07DQogICAgICAgIH0sIGdhcGkuaWZyYW1lcy5DUk9TU19PUklHSU5fSUZSQU1FU19GSUxURVIpOw0KICAgICAgICB0aGlzLmV2ZW50TWFuYWdlcnNbYXV0aC5fa2V5KCldID0geyBtYW5hZ2VyIH07DQogICAgICAgIHRoaXMuaWZyYW1lc1thdXRoLl9rZXkoKV0gPSBpZnJhbWU7DQogICAgICAgIHJldHVybiBtYW5hZ2VyOw0KICAgIH0NCiAgICBfaXNJZnJhbWVXZWJTdG9yYWdlU3VwcG9ydGVkKGF1dGgsIGNiKSB7DQogICAgICAgIGNvbnN0IGlmcmFtZSA9IHRoaXMuaWZyYW1lc1thdXRoLl9rZXkoKV07DQogICAgICAgIGlmcmFtZS5zZW5kKFdFQl9TVE9SQUdFX1NVUFBPUlRfS0VZLCB7IHR5cGU6IFdFQl9TVE9SQUdFX1NVUFBPUlRfS0VZIH0sIHJlc3VsdCA9PiB7DQogICAgICAgICAgICB2YXIgX2E7DQogICAgICAgICAgICBjb25zdCBpc1N1cHBvcnRlZCA9IChfYSA9IHJlc3VsdCA9PT0gbnVsbCB8fCByZXN1bHQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3VsdFswXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hW1dFQl9TVE9SQUdFX1NVUFBPUlRfS0VZXTsNCiAgICAgICAgICAgIGlmIChpc1N1cHBvcnRlZCAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgY2IoISFpc1N1cHBvcnRlZCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBfZmFpbChhdXRoLCAiaW50ZXJuYWwtZXJyb3IiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pOw0KICAgICAgICB9LCBnYXBpLmlmcmFtZXMuQ1JPU1NfT1JJR0lOX0lGUkFNRVNfRklMVEVSKTsNCiAgICB9DQogICAgX29yaWdpblZhbGlkYXRpb24oYXV0aCkgew0KICAgICAgICBjb25zdCBrZXkgPSBhdXRoLl9rZXkoKTsNCiAgICAgICAgaWYgKCF0aGlzLm9yaWdpblZhbGlkYXRpb25Qcm9taXNlc1trZXldKSB7DQogICAgICAgICAgICB0aGlzLm9yaWdpblZhbGlkYXRpb25Qcm9taXNlc1trZXldID0gX3ZhbGlkYXRlT3JpZ2luKGF1dGgpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzLm9yaWdpblZhbGlkYXRpb25Qcm9taXNlc1trZXldOw0KICAgIH0NCiAgICBnZXQgX3Nob3VsZEluaXRQcm9hY3RpdmVseSgpIHsNCiAgICAgICAgLy8gTW9iaWxlIGJyb3dzZXJzIGFuZCBTYWZhcmkgbmVlZCB0byBvcHRpbWlzdGljYWxseSBpbml0aWFsaXplDQogICAgICAgIHJldHVybiBfaXNNb2JpbGVCcm93c2VyKCkgfHwgX2lzU2FmYXJpKCkgfHwgX2lzSU9TKCk7DQogICAgfQ0KfQ0KLyoqDQogKiBBbiBpbXBsZW1lbnRhdGlvbiBvZiB7QGxpbmsgUG9wdXBSZWRpcmVjdFJlc29sdmVyfSBzdWl0YWJsZSBmb3IgYnJvd3Nlcg0KICogYmFzZWQgYXBwbGljYXRpb25zLg0KICoNCiAqIEByZW1hcmtzDQogKiBUaGlzIG1ldGhvZCBkb2VzIG5vdCB3b3JrIGluIGEgTm9kZS5qcyBlbnZpcm9ubWVudC4NCiAqDQogKiBAcHVibGljDQogKi8NCmNvbnN0IGJyb3dzZXJQb3B1cFJlZGlyZWN0UmVzb2x2ZXIgPSBCcm93c2VyUG9wdXBSZWRpcmVjdFJlc29sdmVyOwoKdmFyIG5hbWUkSCA9ICJAZmlyZWJhc2UvYXV0aCI7CnZhciB2ZXJzaW9uJDMgPSAiMS4xLjAiOwoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY2xhc3MgQXV0aEludGVyb3Agew0KICAgIGNvbnN0cnVjdG9yKGF1dGgpIHsNCiAgICAgICAgdGhpcy5hdXRoID0gYXV0aDsNCiAgICAgICAgdGhpcy5pbnRlcm5hbExpc3RlbmVycyA9IG5ldyBNYXAoKTsNCiAgICB9DQogICAgZ2V0VWlkKCkgew0KICAgICAgICB2YXIgX2E7DQogICAgICAgIHRoaXMuYXNzZXJ0QXV0aENvbmZpZ3VyZWQoKTsNCiAgICAgICAgcmV0dXJuICgoX2EgPSB0aGlzLmF1dGguY3VycmVudFVzZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS51aWQpIHx8IG51bGw7DQogICAgfQ0KICAgIGFzeW5jIGdldFRva2VuKGZvcmNlUmVmcmVzaCkgew0KICAgICAgICB0aGlzLmFzc2VydEF1dGhDb25maWd1cmVkKCk7DQogICAgICAgIGF3YWl0IHRoaXMuYXV0aC5faW5pdGlhbGl6YXRpb25Qcm9taXNlOw0KICAgICAgICBpZiAoIXRoaXMuYXV0aC5jdXJyZW50VXNlcikgew0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgIH0NCiAgICAgICAgY29uc3QgYWNjZXNzVG9rZW4gPSBhd2FpdCB0aGlzLmF1dGguY3VycmVudFVzZXIuZ2V0SWRUb2tlbihmb3JjZVJlZnJlc2gpOw0KICAgICAgICByZXR1cm4geyBhY2Nlc3NUb2tlbiB9Ow0KICAgIH0NCiAgICBhZGRBdXRoVG9rZW5MaXN0ZW5lcihsaXN0ZW5lcikgew0KICAgICAgICB0aGlzLmFzc2VydEF1dGhDb25maWd1cmVkKCk7DQogICAgICAgIGlmICh0aGlzLmludGVybmFsTGlzdGVuZXJzLmhhcyhsaXN0ZW5lcikpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCB1bnN1YnNjcmliZSA9IHRoaXMuYXV0aC5vbklkVG9rZW5DaGFuZ2VkKHVzZXIgPT4gew0KICAgICAgICAgICAgbGlzdGVuZXIoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5zdHNUb2tlbk1hbmFnZXIuYWNjZXNzVG9rZW4pIHx8IG51bGwpOw0KICAgICAgICB9KTsNCiAgICAgICAgdGhpcy5pbnRlcm5hbExpc3RlbmVycy5zZXQobGlzdGVuZXIsIHVuc3Vic2NyaWJlKTsNCiAgICAgICAgdGhpcy51cGRhdGVQcm9hY3RpdmVSZWZyZXNoKCk7DQogICAgfQ0KICAgIHJlbW92ZUF1dGhUb2tlbkxpc3RlbmVyKGxpc3RlbmVyKSB7DQogICAgICAgIHRoaXMuYXNzZXJ0QXV0aENvbmZpZ3VyZWQoKTsNCiAgICAgICAgY29uc3QgdW5zdWJzY3JpYmUgPSB0aGlzLmludGVybmFsTGlzdGVuZXJzLmdldChsaXN0ZW5lcik7DQogICAgICAgIGlmICghdW5zdWJzY3JpYmUpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmludGVybmFsTGlzdGVuZXJzLmRlbGV0ZShsaXN0ZW5lcik7DQogICAgICAgIHVuc3Vic2NyaWJlKCk7DQogICAgICAgIHRoaXMudXBkYXRlUHJvYWN0aXZlUmVmcmVzaCgpOw0KICAgIH0NCiAgICBhc3NlcnRBdXRoQ29uZmlndXJlZCgpIHsNCiAgICAgICAgX2Fzc2VydCh0aGlzLmF1dGguX2luaXRpYWxpemF0aW9uUHJvbWlzZSwgImRlcGVuZGVudC1zZGstaW5pdGlhbGl6ZWQtYmVmb3JlLWF1dGgiIC8qIEF1dGhFcnJvckNvZGUuREVQRU5ERU5UX1NES19JTklUX0JFRk9SRV9BVVRIICovKTsNCiAgICB9DQogICAgdXBkYXRlUHJvYWN0aXZlUmVmcmVzaCgpIHsNCiAgICAgICAgaWYgKHRoaXMuaW50ZXJuYWxMaXN0ZW5lcnMuc2l6ZSA+IDApIHsNCiAgICAgICAgICAgIHRoaXMuYXV0aC5fc3RhcnRQcm9hY3RpdmVSZWZyZXNoKCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICB0aGlzLmF1dGguX3N0b3BQcm9hY3RpdmVSZWZyZXNoKCk7DQogICAgICAgIH0NCiAgICB9DQp9CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpmdW5jdGlvbiBnZXRWZXJzaW9uRm9yUGxhdGZvcm0oY2xpZW50UGxhdGZvcm0pIHsNCiAgICBzd2l0Y2ggKGNsaWVudFBsYXRmb3JtKSB7DQogICAgICAgIGNhc2UgIk5vZGUiIC8qIENsaWVudFBsYXRmb3JtLk5PREUgKi86DQogICAgICAgICAgICByZXR1cm4gJ25vZGUnOw0KICAgICAgICBjYXNlICJSZWFjdE5hdGl2ZSIgLyogQ2xpZW50UGxhdGZvcm0uUkVBQ1RfTkFUSVZFICovOg0KICAgICAgICAgICAgcmV0dXJuICdybic7DQogICAgICAgIGNhc2UgIldvcmtlciIgLyogQ2xpZW50UGxhdGZvcm0uV09SS0VSICovOg0KICAgICAgICAgICAgcmV0dXJuICd3ZWJ3b3JrZXInOw0KICAgICAgICBjYXNlICJDb3Jkb3ZhIiAvKiBDbGllbnRQbGF0Zm9ybS5DT1JET1ZBICovOg0KICAgICAgICAgICAgcmV0dXJuICdjb3Jkb3ZhJzsNCiAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7DQogICAgfQ0KfQ0KLyoqIEBpbnRlcm5hbCAqLw0KZnVuY3Rpb24gcmVnaXN0ZXJBdXRoKGNsaWVudFBsYXRmb3JtKSB7DQogICAgX3JlZ2lzdGVyQ29tcG9uZW50KG5ldyBDb21wb25lbnQoImF1dGgiIC8qIF9Db21wb25lbnROYW1lLkFVVEggKi8sIChjb250YWluZXIsIHsgb3B0aW9uczogZGVwcyB9KSA9PiB7DQogICAgICAgIGNvbnN0IGFwcCA9IGNvbnRhaW5lci5nZXRQcm92aWRlcignYXBwJykuZ2V0SW1tZWRpYXRlKCk7DQogICAgICAgIGNvbnN0IGhlYXJ0YmVhdFNlcnZpY2VQcm92aWRlciA9IGNvbnRhaW5lci5nZXRQcm92aWRlcignaGVhcnRiZWF0Jyk7DQogICAgICAgIGNvbnN0IGFwcENoZWNrU2VydmljZVByb3ZpZGVyID0gY29udGFpbmVyLmdldFByb3ZpZGVyKCdhcHAtY2hlY2staW50ZXJuYWwnKTsNCiAgICAgICAgY29uc3QgeyBhcGlLZXksIGF1dGhEb21haW4gfSA9IGFwcC5vcHRpb25zOw0KICAgICAgICBfYXNzZXJ0KGFwaUtleSAmJiAhYXBpS2V5LmluY2x1ZGVzKCc6JyksICJpbnZhbGlkLWFwaS1rZXkiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9BUElfS0VZICovLCB7IGFwcE5hbWU6IGFwcC5uYW1lIH0pOw0KICAgICAgICBjb25zdCBjb25maWcgPSB7DQogICAgICAgICAgICBhcGlLZXksDQogICAgICAgICAgICBhdXRoRG9tYWluLA0KICAgICAgICAgICAgY2xpZW50UGxhdGZvcm0sDQogICAgICAgICAgICBhcGlIb3N0OiAiaWRlbnRpdHl0b29sa2l0Lmdvb2dsZWFwaXMuY29tIiAvKiBEZWZhdWx0Q29uZmlnLkFQSV9IT1NUICovLA0KICAgICAgICAgICAgdG9rZW5BcGlIb3N0OiAic2VjdXJldG9rZW4uZ29vZ2xlYXBpcy5jb20iIC8qIERlZmF1bHRDb25maWcuVE9LRU5fQVBJX0hPU1QgKi8sDQogICAgICAgICAgICBhcGlTY2hlbWU6ICJodHRwcyIgLyogRGVmYXVsdENvbmZpZy5BUElfU0NIRU1FICovLA0KICAgICAgICAgICAgc2RrQ2xpZW50VmVyc2lvbjogX2dldENsaWVudFZlcnNpb24oY2xpZW50UGxhdGZvcm0pDQogICAgICAgIH07DQogICAgICAgIGNvbnN0IGF1dGhJbnN0YW5jZSA9IG5ldyBBdXRoSW1wbChhcHAsIGhlYXJ0YmVhdFNlcnZpY2VQcm92aWRlciwgYXBwQ2hlY2tTZXJ2aWNlUHJvdmlkZXIsIGNvbmZpZyk7DQogICAgICAgIF9pbml0aWFsaXplQXV0aEluc3RhbmNlKGF1dGhJbnN0YW5jZSwgZGVwcyk7DQogICAgICAgIHJldHVybiBhdXRoSW5zdGFuY2U7DQogICAgfSwgIlBVQkxJQyIgLyogQ29tcG9uZW50VHlwZS5QVUJMSUMgKi8pDQogICAgICAgIC8qKg0KICAgICAgICAgKiBBdXRoIGNhbiBvbmx5IGJlIGluaXRpYWxpemVkIGJ5IGV4cGxpY2l0bHkgY2FsbGluZyBnZXRBdXRoKCkgb3IgaW5pdGlhbGl6ZUF1dGgoKQ0KICAgICAgICAgKiBGb3Igd2h5IHdlIGRvIHRoaXMsIFNlZSBnby9maXJlYmFzZS1uZXh0LWF1dGgtaW5pdA0KICAgICAgICAgKi8NCiAgICAgICAgLnNldEluc3RhbnRpYXRpb25Nb2RlKCJFWFBMSUNJVCIgLyogSW5zdGFudGlhdGlvbk1vZGUuRVhQTElDSVQgKi8pDQogICAgICAgIC8qKg0KICAgICAgICAgKiBCZWNhdXNlIGFsbCBmaXJlYmFzZSBwcm9kdWN0cyB0aGF0IGRlcGVuZCBvbiBhdXRoIGRlcGVuZCBvbiBhdXRoLWludGVybmFsIGRpcmVjdGx5LA0KICAgICAgICAgKiB3ZSBuZWVkIHRvIGluaXRpYWxpemUgYXV0aC1pbnRlcm5hbCBhZnRlciBhdXRoIGlzIGluaXRpYWxpemVkIHRvIG1ha2UgaXQgYXZhaWxhYmxlIHRvIG90aGVyIGZpcmViYXNlIHByb2R1Y3RzLg0KICAgICAgICAgKi8NCiAgICAgICAgLnNldEluc3RhbmNlQ3JlYXRlZENhbGxiYWNrKChjb250YWluZXIsIF9pbnN0YW5jZUlkZW50aWZpZXIsIF9pbnN0YW5jZSkgPT4gew0KICAgICAgICBjb25zdCBhdXRoSW50ZXJuYWxQcm92aWRlciA9IGNvbnRhaW5lci5nZXRQcm92aWRlcigiYXV0aC1pbnRlcm5hbCIgLyogX0NvbXBvbmVudE5hbWUuQVVUSF9JTlRFUk5BTCAqLyk7DQogICAgICAgIGF1dGhJbnRlcm5hbFByb3ZpZGVyLmluaXRpYWxpemUoKTsNCiAgICB9KSk7DQogICAgX3JlZ2lzdGVyQ29tcG9uZW50KG5ldyBDb21wb25lbnQoImF1dGgtaW50ZXJuYWwiIC8qIF9Db21wb25lbnROYW1lLkFVVEhfSU5URVJOQUwgKi8sIGNvbnRhaW5lciA9PiB7DQogICAgICAgIGNvbnN0IGF1dGggPSBfY2FzdEF1dGgoY29udGFpbmVyLmdldFByb3ZpZGVyKCJhdXRoIiAvKiBfQ29tcG9uZW50TmFtZS5BVVRIICovKS5nZXRJbW1lZGlhdGUoKSk7DQogICAgICAgIHJldHVybiAoYXV0aCA9PiBuZXcgQXV0aEludGVyb3AoYXV0aCkpKGF1dGgpOw0KICAgIH0sICJQUklWQVRFIiAvKiBDb21wb25lbnRUeXBlLlBSSVZBVEUgKi8pLnNldEluc3RhbnRpYXRpb25Nb2RlKCJFWFBMSUNJVCIgLyogSW5zdGFudGlhdGlvbk1vZGUuRVhQTElDSVQgKi8pKTsNCiAgICByZWdpc3RlclZlcnNpb24obmFtZSRILCB2ZXJzaW9uJDMsIGdldFZlcnNpb25Gb3JQbGF0Zm9ybShjbGllbnRQbGF0Zm9ybSkpOw0KICAgIC8vIEJVSUxEX1RBUkdFVCB3aWxsIGJlIHJlcGxhY2VkIGJ5IHZhbHVlcyBsaWtlIGVzbTUsIGVzbTIwMTcsIGNqczUsIGV0YyBkdXJpbmcgdGhlIGNvbXBpbGF0aW9uDQogICAgcmVnaXN0ZXJWZXJzaW9uKG5hbWUkSCwgdmVyc2lvbiQzLCAnZXNtMjAxNycpOw0KfQoKLyoqDQogKiBAbGljZW5zZQ0KICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQw0KICoNCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0DQogKg0KICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiAqDQogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLA0KICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuDQogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4NCiAqLw0KY29uc3QgREVGQVVMVF9JRF9UT0tFTl9NQVhfQUdFID0gNSAqIDYwOw0KY29uc3QgYXV0aElkVG9rZW5NYXhBZ2UgPSBnZXRFeHBlcmltZW50YWxTZXR0aW5nKCdhdXRoSWRUb2tlbk1heEFnZScpIHx8IERFRkFVTFRfSURfVE9LRU5fTUFYX0FHRTsNCmxldCBsYXN0UG9zdGVkSWRUb2tlbiA9IG51bGw7DQpjb25zdCBtaW50Q29va2llRmFjdG9yeSA9ICh1cmwpID0+IGFzeW5jICh1c2VyKSA9PiB7DQogICAgY29uc3QgaWRUb2tlblJlc3VsdCA9IHVzZXIgJiYgKGF3YWl0IHVzZXIuZ2V0SWRUb2tlblJlc3VsdCgpKTsNCiAgICBjb25zdCBpZFRva2VuQWdlID0gaWRUb2tlblJlc3VsdCAmJg0KICAgICAgICAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSBEYXRlLnBhcnNlKGlkVG9rZW5SZXN1bHQuaXNzdWVkQXRUaW1lKSkgLyAxMDAwOw0KICAgIGlmIChpZFRva2VuQWdlICYmIGlkVG9rZW5BZ2UgPiBhdXRoSWRUb2tlbk1heEFnZSkgew0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIC8vIFNwZWNpZmljYWxseSB0cmlwIG51bGwgPT4gdW5kZWZpbmVkIHdoZW4gbG9nZ2VkIG91dCwgdG8gZGVsZXRlIGFueSBleGlzdGluZyBjb29raWUNCiAgICBjb25zdCBpZFRva2VuID0gaWRUb2tlblJlc3VsdCA9PT0gbnVsbCB8fCBpZFRva2VuUmVzdWx0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpZFRva2VuUmVzdWx0LnRva2VuOw0KICAgIGlmIChsYXN0UG9zdGVkSWRUb2tlbiA9PT0gaWRUb2tlbikgew0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIGxhc3RQb3N0ZWRJZFRva2VuID0gaWRUb2tlbjsNCiAgICBhd2FpdCBmZXRjaCh1cmwsIHsNCiAgICAgICAgbWV0aG9kOiBpZFRva2VuID8gJ1BPU1QnIDogJ0RFTEVURScsDQogICAgICAgIGhlYWRlcnM6IGlkVG9rZW4NCiAgICAgICAgICAgID8gew0KICAgICAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke2lkVG9rZW59YA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgOiB7fQ0KICAgIH0pOw0KfTsNCi8qKg0KICogUmV0dXJucyB0aGUgQXV0aCBpbnN0YW5jZSBhc3NvY2lhdGVkIHdpdGggdGhlIHByb3ZpZGVkIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlQXBwfS4NCiAqIElmIG5vIGluc3RhbmNlIGV4aXN0cywgaW5pdGlhbGl6ZXMgYW4gQXV0aCBpbnN0YW5jZSB3aXRoIHBsYXRmb3JtLXNwZWNpZmljIGRlZmF1bHQgZGVwZW5kZW5jaWVzLg0KICoNCiAqIEBwYXJhbSBhcHAgLSBUaGUgRmlyZWJhc2UgQXBwLg0KICoNCiAqIEBwdWJsaWMNCiAqLw0KZnVuY3Rpb24gZ2V0QXV0aChhcHAgPSBnZXRBcHAoKSkgew0KICAgIGNvbnN0IHByb3ZpZGVyID0gX2dldFByb3ZpZGVyKGFwcCwgJ2F1dGgnKTsNCiAgICBpZiAocHJvdmlkZXIuaXNJbml0aWFsaXplZCgpKSB7DQogICAgICAgIHJldHVybiBwcm92aWRlci5nZXRJbW1lZGlhdGUoKTsNCiAgICB9DQogICAgY29uc3QgYXV0aCA9IGluaXRpYWxpemVBdXRoKGFwcCwgew0KICAgICAgICBwb3B1cFJlZGlyZWN0UmVzb2x2ZXI6IGJyb3dzZXJQb3B1cFJlZGlyZWN0UmVzb2x2ZXIsDQogICAgICAgIHBlcnNpc3RlbmNlOiBbDQogICAgICAgICAgICBpbmRleGVkREJMb2NhbFBlcnNpc3RlbmNlLA0KICAgICAgICAgICAgYnJvd3NlckxvY2FsUGVyc2lzdGVuY2UsDQogICAgICAgICAgICBicm93c2VyU2Vzc2lvblBlcnNpc3RlbmNlDQogICAgICAgIF0NCiAgICB9KTsNCiAgICBjb25zdCBhdXRoVG9rZW5TeW5jVXJsID0gZ2V0RXhwZXJpbWVudGFsU2V0dGluZygnYXV0aFRva2VuU3luY1VSTCcpOw0KICAgIGlmIChhdXRoVG9rZW5TeW5jVXJsKSB7DQogICAgICAgIGNvbnN0IG1pbnRDb29raWUgPSBtaW50Q29va2llRmFjdG9yeShhdXRoVG9rZW5TeW5jVXJsKTsNCiAgICAgICAgYmVmb3JlQXV0aFN0YXRlQ2hhbmdlZChhdXRoLCBtaW50Q29va2llLCAoKSA9PiBtaW50Q29va2llKGF1dGguY3VycmVudFVzZXIpKTsNCiAgICAgICAgb25JZFRva2VuQ2hhbmdlZChhdXRoLCB1c2VyID0+IG1pbnRDb29raWUodXNlcikpOw0KICAgIH0NCiAgICBjb25zdCBhdXRoRW11bGF0b3JIb3N0ID0gZ2V0RGVmYXVsdEVtdWxhdG9ySG9zdCgnYXV0aCcpOw0KICAgIGlmIChhdXRoRW11bGF0b3JIb3N0KSB7DQogICAgICAgIGNvbm5lY3RBdXRoRW11bGF0b3IoYXV0aCwgYGh0dHA6Ly8ke2F1dGhFbXVsYXRvckhvc3R9YCk7DQogICAgfQ0KICAgIHJldHVybiBhdXRoOw0KfQ0KcmVnaXN0ZXJBdXRoKCJCcm93c2VyIiAvKiBDbGllbnRQbGF0Zm9ybS5CUk9XU0VSICovKTsKCmFzeW5jIGZ1bmN0aW9uIHNpZ25hbFN3YXJtKG9mZmVyKSB7CiAgbGV0IGlkID0gdjQoKTsKICBjb25zdCBkYiA9IGdldERhdGFiYXNlKCk7CiAgbGV0IHJlZmYgPSByZWYoZGIsIGAvc3dhcm0vJHtpZH1gKTsKICBzZXQkMShyZWZmLCBvZmZlcik7CiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgIG9uVmFsdWUocmVmZiwgKHNuYXBzaG90KSA9PiB7CiAgICAgIGNvbnN0IHRleHQgPSBzbmFwc2hvdC52YWwoKTsKICAgICAgaWYgKCF0ZXh0KQogICAgICAgIHJldHVybjsKICAgICAgbGV0IGRhdGEgPSBKU09OLnBhcnNlKHRleHQpOwogICAgICBjb25zb2xlLmxvZyhkYXRhKTsKICAgICAgaWYgKGRhdGEuZXJyb3IpIHsKICAgICAgICByZWplY3QobmV3IEVycm9yKGRhdGEuZXJyb3IpKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKCEoZGF0YSAmJiBkYXRhLmFuc3dlciAmJiBkYXRhLmNhbmRpZGF0ZXMpKQogICAgICAgIHJldHVybjsKICAgICAgcmVtb3ZlKHJlZmYpOwogICAgICByZXNvbHZlKGRhdGEpOwogICAgfSk7CiAgfSk7Cn0KYXN5bmMgZnVuY3Rpb24gc2lnbmFsQWNjb3VudChvZmZlcikgewogIGxldCBhdXRoID0gZ2V0QXV0aCgpOwogIGlmICghYXV0aC5jdXJyZW50VXNlcikKICAgIHRocm93IG5ldyBFcnJvcigibm90IHNpZ25lZCBpbiIpOwogIGNvbnN0IGRiID0gZ2V0RGF0YWJhc2UoKTsKICBsZXQgcGVlciA9IHJlZihkYiwgYC9wZWVycy8ke2F1dGguY3VycmVudFVzZXIudWlkfWApOwogIHNldCQxKHBlZXIsIG9mZmVyKTsKICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgb25WYWx1ZShwZWVyLCBhc3luYyAoc25hcHNob3QpID0+IHsKICAgICAgY29uc3Qgc3RyID0gc25hcHNob3QudmFsKCk7CiAgICAgIGlmIChzdHIpIHsKICAgICAgICBsZXQgZGF0YSA9IEpTT04ucGFyc2Uoc3RyKTsKICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmFuc3dlciAmJiBkYXRhLmNhbmRpZGF0ZXMpIHsKICAgICAgICAgIHJlbW92ZShwZWVyKTsKICAgICAgICAgIHJlc29sdmUoZGF0YSk7CiAgICAgICAgICBnb09mZmxpbmUoZGIpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfSk7Cn0KCmZ1bmN0aW9uIGRvd25sb2FkU2hvcnRjdXQobmFtZSwgdGl0bGUpIHsKICBsZXQgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICBhLmhyZWYgPSAiZGF0YTp0ZXh0L3BsYWluO2Jhc2U2NCwiICsgYnRvYShgCiAgICA8IURPQ1RZUEUgaHRtbD4KICAgIDxodG1sIGxhbmc9ImVuIj4KICAgIAogICAgPGhlYWQ+CiAgICAgICAgPG1ldGEgY2hhcnNldD0iVVRGLTgiPgogICAgICAgIDxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wIj4KICAgICAgICA8dGl0bGU+JHt0aXRsZX08L3RpdGxlPgogICAgICAgIDxzdHlsZT4KICAgICAgICAgICAgYm9keSwKICAgICAgICAgICAgaHRtbCB7CiAgICAgICAgICAgICAgICBwYWRkaW5nOiAwOwogICAgICAgICAgICAgICAgbWFyZ2luOiAwOwogICAgICAgICAgICAgICAgd2lkdGg6IDEwMHZ3OwogICAgICAgICAgICAgICAgaGVpZ2h0OiAxMDB2aDsKICAgICAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgICAgIH0KICAgIAogICAgICAgICAgICBpZnJhbWUgewogICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDEwMCU7CiAgICAgICAgICAgICAgICBib3JkZXI6IG5vbmU7CiAgICAgICAgICAgICAgICBvdXRsaW5lOiBub25lOwogICAgCiAgICAgICAgICAgIH0KICAgICAgICA8L3N0eWxlPgogICAgCiAgICA8L2hlYWQ+CiAgICAKICAgIDxib2R5PgogICAgICAgIDxpZnJhbWUgc3JjPSIke2xvY2F0aW9uLmhyZWZ9IiAvPgogICAgPC9ib2R5PgogICAgCiAgICA8L2h0bWw+CmApOwogIGNvbnNvbGUubG9nKGEuaHJlZik7CiAgYS5kb3dubG9hZCA9IG5hbWU7CiAgYS5jbGljaygpOwp9Cgpjb25zdCBnZW5DU1MgPSAobGlnaHQsIGRhcmspID0+IHsKICAgIGNvbnN0IGdlbkNvbG9yVmFyaWFibGUgPSAobmFtZSwgYXJnYikgPT4gewogICAgICAgIGNvbnN0IGtlYmFiQ2FzZSA9IG5hbWUucmVwbGFjZSgvW0EtWl0vZywgKGxldHRlcikgPT4gYC0ke2xldHRlci50b0xvd2VyQ2FzZSgpfWApOwogICAgICAgIGNvbnN0IHJlZCA9IChhcmdiID4+IDE2KSAmIDI1NTsKICAgICAgICBjb25zdCBncmVlbiA9IChhcmdiID4+IDgpICYgMjU1OwogICAgICAgIGNvbnN0IGJsdWUgPSBhcmdiICYgMjU1OwogICAgICAgIHJldHVybiBgLS1tMy1zY2hlbWUtJHtrZWJhYkNhc2V9OiAke3JlZH0gJHtncmVlbn0gJHtibHVlfTtgOwogICAgfTsKICAgIGNvbnN0IGxpZ2h0Q29sb3JzID0gT2JqZWN0LmVudHJpZXMobGlnaHQpCiAgICAgICAgLm1hcCgoW25hbWUsIGFyZ2JdKSA9PiBnZW5Db2xvclZhcmlhYmxlKG5hbWUsIGFyZ2IpKQogICAgICAgIC5qb2luKCJcbiIpOwogICAgY29uc3QgZGFya0NvbG9ycyA9IE9iamVjdC5lbnRyaWVzKGRhcmspCiAgICAgICAgLm1hcCgoW25hbWUsIGFyZ2JdKSA9PiBnZW5Db2xvclZhcmlhYmxlKG5hbWUsIGFyZ2IpKQogICAgICAgIC5qb2luKCJcbiIpOwogICAgY29uc3QgY29sb3JzID0gYAo6cm9vdCB7CiAgYWNjZW50LWNvbG9yOiByZ2IodmFyKC0tbTMtc2NoZW1lLXByaW1hcnkpKTsKfQpAbWVkaWEgKHByZWZlcnMtY29sb3Itc2NoZW1lOiBsaWdodCkgewogIDpyb290IHsKICAgIGNvbG9yLXNjaGVtZTogbGlnaHQ7CiAgfQogIDpyb290LCA6OmJhY2tkcm9wIHsKJHtsaWdodENvbG9yc30KICB9Cn0KQG1lZGlhIChwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyaykgewogIDpyb290IHsKICAgIGNvbG9yLXNjaGVtZTogZGFyazsKICB9CiAgOnJvb3QsIDo6YmFja2Ryb3Agewoke2RhcmtDb2xvcnN9CiAgfQp9YDsKICAgIHJldHVybiBjb2xvcnM7Cn07CgovKiBob21lL2NlL0RvY3VtZW50cy9HaXRIdWIvYWRyaWZ0L25vZGVfbW9kdWxlcy8ucG5wbS9tMy1zdmVsdGVAMi4wLjMvbm9kZV9tb2R1bGVzL20zLXN2ZWx0ZS9wYWNrYWdlL21pc2MvX3N0eWxpbmcuc3ZlbHRlIGdlbmVyYXRlZCBieSBTdmVsdGUgdjQuMi4wICovCgpmdW5jdGlvbiBjcmVhdGVfZnJhZ21lbnQkYyhjdHgpIHsKCWxldCBtZXRhMDsKCWxldCBtZXRhMF9jb250ZW50X3ZhbHVlOwoJbGV0IG1ldGExOwoJbGV0IG1ldGExX2NvbnRlbnRfdmFsdWU7CglsZXQgdDsKCWxldCBodG1sX3RhZzsKCWxldCByYXdfdmFsdWUgPSBgPCR7IiJ9c3R5bGU+JHsvKnN0eWxpbmcqLyBjdHhbMl19PC8keyIifXN0eWxlPmAgKyAiIjsKCWxldCBodG1sX2FuY2hvcjsKCglyZXR1cm4gewoJCWMoKSB7CgkJCW1ldGEwID0gZWxlbWVudCgibWV0YSIpOwoJCQltZXRhMSA9IGVsZW1lbnQoIm1ldGEiKTsKCQkJdCA9IHNwYWNlKCk7CgkJCWh0bWxfdGFnID0gbmV3IEh0bWxUYWcoZmFsc2UpOwoJCQlodG1sX2FuY2hvciA9IGVtcHR5KCk7CgkJCWF0dHIobWV0YTAsICJuYW1lIiwgInRoZW1lLWNvbG9yIik7CgkJCWF0dHIobWV0YTAsICJjb250ZW50IiwgbWV0YTBfY29udGVudF92YWx1ZSA9IC8qaGV4Q29kZSovIGN0eFszXSgvKmxpZ2h0U2NoZW1lKi8gY3R4WzBdWyJwcmltYXJ5Il0pKTsKCQkJYXR0cihtZXRhMSwgIm5hbWUiLCAidGhlbWUtY29sb3IiKTsKCQkJYXR0cihtZXRhMSwgIm1lZGlhIiwgIihwcmVmZXJzLWNvbG9yLXNjaGVtZTogZGFyaykiKTsKCQkJYXR0cihtZXRhMSwgImNvbnRlbnQiLCBtZXRhMV9jb250ZW50X3ZhbHVlID0gLypoZXhDb2RlKi8gY3R4WzNdKC8qZGFya1NjaGVtZSovIGN0eFsxXVsicHJpbWFyeSJdKSk7CgkJCWh0bWxfdGFnLmEgPSBodG1sX2FuY2hvcjsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJYXBwZW5kKGRvY3VtZW50LmhlYWQsIG1ldGEwKTsKCQkJYXBwZW5kKGRvY3VtZW50LmhlYWQsIG1ldGExKTsKCQkJaW5zZXJ0KHRhcmdldCwgdCwgYW5jaG9yKTsKCQkJaHRtbF90YWcubShyYXdfdmFsdWUsIHRhcmdldCwgYW5jaG9yKTsKCQkJaW5zZXJ0KHRhcmdldCwgaHRtbF9hbmNob3IsIGFuY2hvcik7CgkJfSwKCQlwKGN0eCwgW2RpcnR5XSkgewoJCQlpZiAoZGlydHkgJiAvKmxpZ2h0U2NoZW1lKi8gMSAmJiBtZXRhMF9jb250ZW50X3ZhbHVlICE9PSAobWV0YTBfY29udGVudF92YWx1ZSA9IC8qaGV4Q29kZSovIGN0eFszXSgvKmxpZ2h0U2NoZW1lKi8gY3R4WzBdWyJwcmltYXJ5Il0pKSkgewoJCQkJYXR0cihtZXRhMCwgImNvbnRlbnQiLCBtZXRhMF9jb250ZW50X3ZhbHVlKTsKCQkJfQoKCQkJaWYgKGRpcnR5ICYgLypkYXJrU2NoZW1lKi8gMiAmJiBtZXRhMV9jb250ZW50X3ZhbHVlICE9PSAobWV0YTFfY29udGVudF92YWx1ZSA9IC8qaGV4Q29kZSovIGN0eFszXSgvKmRhcmtTY2hlbWUqLyBjdHhbMV1bInByaW1hcnkiXSkpKSB7CgkJCQlhdHRyKG1ldGExLCAiY29udGVudCIsIG1ldGExX2NvbnRlbnRfdmFsdWUpOwoJCQl9CgoJCQlpZiAoZGlydHkgJiAvKnN0eWxpbmcqLyA0ICYmIHJhd192YWx1ZSAhPT0gKHJhd192YWx1ZSA9IGA8JHsiIn1zdHlsZT4key8qc3R5bGluZyovIGN0eFsyXX08LyR7IiJ9c3R5bGU+YCArICIiKSkgaHRtbF90YWcucChyYXdfdmFsdWUpOwoJCX0sCgkJaTogbm9vcCQ0LAoJCW86IG5vb3AkNCwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2godCk7CgkJCQlkZXRhY2goaHRtbF9hbmNob3IpOwoJCQkJaHRtbF90YWcuZCgpOwoJCQl9CgoJCQlkZXRhY2gobWV0YTApOwoJCQlkZXRhY2gobWV0YTEpOwoJCX0KCX07Cn0KCmZ1bmN0aW9uIGluc3RhbmNlJGMoJCRzZWxmLCAkJHByb3BzLCAkJGludmFsaWRhdGUpIHsKCWxldCBzdHlsaW5nOwoJbGV0IHsgbGlnaHRTY2hlbWUgfSA9ICQkcHJvcHM7CglsZXQgeyBkYXJrU2NoZW1lIH0gPSAkJHByb3BzOwoJY29uc3QgaGV4Q29kZSA9IGFyZ2IgPT4gIiMiICsgKChhcmdiICYgMTY3NzcyMTUpICsgMTY3NzcyMTYpLnRvU3RyaW5nKDE2KS5zbGljZSgxKTsKCgkkJHNlbGYuJCRzZXQgPSAkJHByb3BzID0+IHsKCQlpZiAoJ2xpZ2h0U2NoZW1lJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMCwgbGlnaHRTY2hlbWUgPSAkJHByb3BzLmxpZ2h0U2NoZW1lKTsKCQlpZiAoJ2RhcmtTY2hlbWUnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgxLCBkYXJrU2NoZW1lID0gJCRwcm9wcy5kYXJrU2NoZW1lKTsKCX07CgoJJCRzZWxmLiQkLnVwZGF0ZSA9ICgpID0+IHsKCQlpZiAoJCRzZWxmLiQkLmRpcnR5ICYgLypsaWdodFNjaGVtZSwgZGFya1NjaGVtZSovIDMpIHsKCQkJJCRpbnZhbGlkYXRlKDIsIHN0eWxpbmcgPSBnZW5DU1MobGlnaHRTY2hlbWUsIGRhcmtTY2hlbWUpKTsKCQl9Cgl9OwoKCXJldHVybiBbbGlnaHRTY2hlbWUsIGRhcmtTY2hlbWUsIHN0eWxpbmcsIGhleENvZGVdOwp9CgpjbGFzcyBTdHlsaW5nIGV4dGVuZHMgU3ZlbHRlQ29tcG9uZW50IHsKCWNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKCQlzdXBlcigpOwoJCWluaXQodGhpcywgb3B0aW9ucywgaW5zdGFuY2UkYywgY3JlYXRlX2ZyYWdtZW50JGMsIHNhZmVfbm90X2VxdWFsLCB7IGxpZ2h0U2NoZW1lOiAwLCBkYXJrU2NoZW1lOiAxIH0pOwoJfQp9Cgpjb25zdCBTdHlsaW5nJDEgPSBTdHlsaW5nOwoKY29uc3Qgc3R5bGVzID0gJyc7CgovKiBob21lL2NlL0RvY3VtZW50cy9HaXRIdWIvYWRyaWZ0L25vZGVfbW9kdWxlcy8ucG5wbS9tMy1zdmVsdGVAMi4wLjMvbm9kZV9tb2R1bGVzL20zLXN2ZWx0ZS9wYWNrYWdlL21pc2MvU3R5bGVGcm9tU2NoZW1lLnN2ZWx0ZSBnZW5lcmF0ZWQgYnkgU3ZlbHRlIHY0LjIuMCAqLwoKZnVuY3Rpb24gY3JlYXRlX2ZyYWdtZW50JGIoY3R4KSB7CglsZXQgc3R5bGluZzsKCWxldCBjdXJyZW50OwoKCXN0eWxpbmcgPSBuZXcgU3R5bGluZyQxKHsKCQkJcHJvcHM6IHsKCQkJCWxpZ2h0U2NoZW1lOiAvKmxpZ2h0U2NoZW1lKi8gY3R4WzBdLAoJCQkJZGFya1NjaGVtZTogLypkYXJrU2NoZW1lKi8gY3R4WzFdCgkJCX0KCQl9KTsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWNyZWF0ZV9jb21wb25lbnQoc3R5bGluZy4kJC5mcmFnbWVudCk7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCW1vdW50X2NvbXBvbmVudChzdHlsaW5nLCB0YXJnZXQsIGFuY2hvcik7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJcChjdHgsIFtkaXJ0eV0pIHsKCQkJY29uc3Qgc3R5bGluZ19jaGFuZ2VzID0ge307CgkJCWlmIChkaXJ0eSAmIC8qbGlnaHRTY2hlbWUqLyAxKSBzdHlsaW5nX2NoYW5nZXMubGlnaHRTY2hlbWUgPSAvKmxpZ2h0U2NoZW1lKi8gY3R4WzBdOwoJCQlpZiAoZGlydHkgJiAvKmRhcmtTY2hlbWUqLyAyKSBzdHlsaW5nX2NoYW5nZXMuZGFya1NjaGVtZSA9IC8qZGFya1NjaGVtZSovIGN0eFsxXTsKCQkJc3R5bGluZy4kc2V0KHN0eWxpbmdfY2hhbmdlcyk7CgkJfSwKCQlpKGxvY2FsKSB7CgkJCWlmIChjdXJyZW50KSByZXR1cm47CgkJCXRyYW5zaXRpb25faW4oc3R5bGluZy4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoc3R5bGluZy4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gZmFsc2U7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlkZXN0cm95X2NvbXBvbmVudChzdHlsaW5nLCBkZXRhY2hpbmcpOwoJCX0KCX07Cn0KCmZ1bmN0aW9uIGluc3RhbmNlJGIoJCRzZWxmLCAkJHByb3BzLCAkJGludmFsaWRhdGUpIHsKCWxldCB7IGxpZ2h0U2NoZW1lIH0gPSAkJHByb3BzOwoJbGV0IHsgZGFya1NjaGVtZSB9ID0gJCRwcm9wczsKCgkkJHNlbGYuJCRzZXQgPSAkJHByb3BzID0+IHsKCQlpZiAoJ2xpZ2h0U2NoZW1lJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMCwgbGlnaHRTY2hlbWUgPSAkJHByb3BzLmxpZ2h0U2NoZW1lKTsKCQlpZiAoJ2RhcmtTY2hlbWUnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgxLCBkYXJrU2NoZW1lID0gJCRwcm9wcy5kYXJrU2NoZW1lKTsKCX07CgoJcmV0dXJuIFtsaWdodFNjaGVtZSwgZGFya1NjaGVtZV07Cn0KCmNsYXNzIFN0eWxlRnJvbVNjaGVtZSBleHRlbmRzIFN2ZWx0ZUNvbXBvbmVudCB7Cgljb25zdHJ1Y3RvcihvcHRpb25zKSB7CgkJc3VwZXIoKTsKCQlpbml0KHRoaXMsIG9wdGlvbnMsIGluc3RhbmNlJGIsIGNyZWF0ZV9mcmFnbWVudCRiLCBzYWZlX25vdF9lcXVhbCwgeyBsaWdodFNjaGVtZTogMCwgZGFya1NjaGVtZTogMSB9KTsKCX0KfQoKY29uc3QgU3R5bGVGcm9tU2NoZW1lJDEgPSBTdHlsZUZyb21TY2hlbWU7Cgpjb25zdCBCdXR0b25fc3ZlbHRlX3N2ZWx0ZV90eXBlX3N0eWxlX2xhbmcgPSAnJzsKCi8qIGhvbWUvY2UvRG9jdW1lbnRzL0dpdEh1Yi9hZHJpZnQvbm9kZV9tb2R1bGVzLy5wbnBtL20zLXN2ZWx0ZUAyLjAuMy9ub2RlX21vZHVsZXMvbTMtc3ZlbHRlL3BhY2thZ2UvYnV0dG9ucy9CdXR0b24uc3ZlbHRlIGdlbmVyYXRlZCBieSBTdmVsdGUgdjQuMi4wICovCgpmdW5jdGlvbiBjcmVhdGVfZnJhZ21lbnQkYShjdHgpIHsKCWxldCBidXR0b247CglsZXQgZGl2OwoJbGV0IHQ7CglsZXQgYnV0dG9uX2NsYXNzX3ZhbHVlOwoJbGV0IGJ1dHRvbl9zdHlsZV92YWx1ZTsKCWxldCBjdXJyZW50OwoJbGV0IG1vdW50ZWQ7CglsZXQgZGlzcG9zZTsKCWNvbnN0IGRlZmF1bHRfc2xvdF90ZW1wbGF0ZSA9IC8qI3Nsb3RzKi8gY3R4WzZdLmRlZmF1bHQ7Cgljb25zdCBkZWZhdWx0X3Nsb3QgPSBjcmVhdGVfc2xvdChkZWZhdWx0X3Nsb3RfdGVtcGxhdGUsIGN0eCwgLyokJHNjb3BlKi8gY3R4WzVdLCBudWxsKTsKCglsZXQgYnV0dG9uX2xldmVscyA9IFsKCQl7IGRpc2FibGVkOiAvKmRpc2FibGVkKi8gY3R4WzRdIH0sCgkJewoJCQljbGFzczogYnV0dG9uX2NsYXNzX3ZhbHVlID0gIm0zLWNvbnRhaW5lciBtMy1mb250LWxhYmVsLWxhcmdlICIgKyAvKnR5cGUqLyBjdHhbM10gKyAiIGljb24tIiArIC8qaWNvblR5cGUqLyBjdHhbMl0KCQl9LAoJCXsKCQkJc3R5bGU6IGJ1dHRvbl9zdHlsZV92YWx1ZSA9ICJkaXNwbGF5OiAiICsgLypkaXNwbGF5Ki8gY3R4WzBdICsgIjsiCgkJfSwKCQkvKmV4dHJhT3B0aW9ucyovIGN0eFsxXQoJXTsKCglsZXQgYnV0dG9uX2RhdGEgPSB7fTsKCglmb3IgKGxldCBpID0gMDsgaSA8IGJ1dHRvbl9sZXZlbHMubGVuZ3RoOyBpICs9IDEpIHsKCQlidXR0b25fZGF0YSA9IGFzc2lnbihidXR0b25fZGF0YSwgYnV0dG9uX2xldmVsc1tpXSk7Cgl9CgoJcmV0dXJuIHsKCQljKCkgewoJCQlidXR0b24gPSBlbGVtZW50KCJidXR0b24iKTsKCQkJZGl2ID0gZWxlbWVudCgiZGl2Iik7CgkJCXQgPSBzcGFjZSgpOwoJCQlpZiAoZGVmYXVsdF9zbG90KSBkZWZhdWx0X3Nsb3QuYygpOwoJCQlhdHRyKGRpdiwgImNsYXNzIiwgImxheWVyIHN2ZWx0ZS0xbmZqY2RyIik7CgkJCXNldF9hdHRyaWJ1dGVzKGJ1dHRvbiwgYnV0dG9uX2RhdGEpOwoJCQl0b2dnbGVfY2xhc3MoYnV0dG9uLCAic3ZlbHRlLTFuZmpjZHIiLCB0cnVlKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgYnV0dG9uLCBhbmNob3IpOwoJCQlhcHBlbmQoYnV0dG9uLCBkaXYpOwoJCQlhcHBlbmQoYnV0dG9uLCB0KTsKCgkJCWlmIChkZWZhdWx0X3Nsb3QpIHsKCQkJCWRlZmF1bHRfc2xvdC5tKGJ1dHRvbiwgbnVsbCk7CgkJCX0KCgkJCWlmIChidXR0b24uYXV0b2ZvY3VzKSBidXR0b24uZm9jdXMoKTsKCQkJY3VycmVudCA9IHRydWU7CgoJCQlpZiAoIW1vdW50ZWQpIHsKCQkJCWRpc3Bvc2UgPSBsaXN0ZW4oYnV0dG9uLCAiY2xpY2siLCBzdG9wX3Byb3BhZ2F0aW9uKC8qY2xpY2tfaGFuZGxlciovIGN0eFs3XSkpOwoJCQkJbW91bnRlZCA9IHRydWU7CgkJCX0KCQl9LAoJCXAoY3R4LCBbZGlydHldKSB7CgkJCWlmIChkZWZhdWx0X3Nsb3QpIHsKCQkJCWlmIChkZWZhdWx0X3Nsb3QucCAmJiAoIWN1cnJlbnQgfHwgZGlydHkgJiAvKiQkc2NvcGUqLyAzMikpIHsKCQkJCQl1cGRhdGVfc2xvdF9iYXNlKAoJCQkJCQlkZWZhdWx0X3Nsb3QsCgkJCQkJCWRlZmF1bHRfc2xvdF90ZW1wbGF0ZSwKCQkJCQkJY3R4LAoJCQkJCQkvKiQkc2NvcGUqLyBjdHhbNV0sCgkJCQkJCSFjdXJyZW50CgkJCQkJCT8gZ2V0X2FsbF9kaXJ0eV9mcm9tX3Njb3BlKC8qJCRzY29wZSovIGN0eFs1XSkKCQkJCQkJOiBnZXRfc2xvdF9jaGFuZ2VzKGRlZmF1bHRfc2xvdF90ZW1wbGF0ZSwgLyokJHNjb3BlKi8gY3R4WzVdLCBkaXJ0eSwgbnVsbCksCgkJCQkJCW51bGwKCQkJCQkpOwoJCQkJfQoJCQl9CgoJCQlzZXRfYXR0cmlidXRlcyhidXR0b24sIGJ1dHRvbl9kYXRhID0gZ2V0X3NwcmVhZF91cGRhdGUoYnV0dG9uX2xldmVscywgWwoJCQkJKCFjdXJyZW50IHx8IGRpcnR5ICYgLypkaXNhYmxlZCovIDE2KSAmJiB7IGRpc2FibGVkOiAvKmRpc2FibGVkKi8gY3R4WzRdIH0sCgkJCQkoIWN1cnJlbnQgfHwgZGlydHkgJiAvKnR5cGUsIGljb25UeXBlKi8gMTIgJiYgYnV0dG9uX2NsYXNzX3ZhbHVlICE9PSAoYnV0dG9uX2NsYXNzX3ZhbHVlID0gIm0zLWNvbnRhaW5lciBtMy1mb250LWxhYmVsLWxhcmdlICIgKyAvKnR5cGUqLyBjdHhbM10gKyAiIGljb24tIiArIC8qaWNvblR5cGUqLyBjdHhbMl0pKSAmJiB7IGNsYXNzOiBidXR0b25fY2xhc3NfdmFsdWUgfSwKCQkJCSghY3VycmVudCB8fCBkaXJ0eSAmIC8qZGlzcGxheSovIDEgJiYgYnV0dG9uX3N0eWxlX3ZhbHVlICE9PSAoYnV0dG9uX3N0eWxlX3ZhbHVlID0gImRpc3BsYXk6ICIgKyAvKmRpc3BsYXkqLyBjdHhbMF0gKyAiOyIpKSAmJiB7IHN0eWxlOiBidXR0b25fc3R5bGVfdmFsdWUgfSwKCQkJCWRpcnR5ICYgLypleHRyYU9wdGlvbnMqLyAyICYmIC8qZXh0cmFPcHRpb25zKi8gY3R4WzFdCgkJCV0pKTsKCgkJCXRvZ2dsZV9jbGFzcyhidXR0b24sICJzdmVsdGUtMW5mamNkciIsIHRydWUpOwoJCX0sCgkJaShsb2NhbCkgewoJCQlpZiAoY3VycmVudCkgcmV0dXJuOwoJCQl0cmFuc2l0aW9uX2luKGRlZmF1bHRfc2xvdCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoZGVmYXVsdF9zbG90LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChidXR0b24pOwoJCQl9CgoJCQlpZiAoZGVmYXVsdF9zbG90KSBkZWZhdWx0X3Nsb3QuZChkZXRhY2hpbmcpOwoJCQltb3VudGVkID0gZmFsc2U7CgkJCWRpc3Bvc2UoKTsKCQl9Cgl9Owp9CgpmdW5jdGlvbiBpbnN0YW5jZSRhKCQkc2VsZiwgJCRwcm9wcywgJCRpbnZhbGlkYXRlKSB7CglsZXQgeyAkJHNsb3RzOiBzbG90cyA9IHt9LCAkJHNjb3BlIH0gPSAkJHByb3BzOwoJbGV0IHsgZGlzcGxheSA9ICJpbmxpbmUtZmxleCIgfSA9ICQkcHJvcHM7CglsZXQgeyBleHRyYU9wdGlvbnMgPSB7fSB9ID0gJCRwcm9wczsKCWxldCB7IGljb25UeXBlID0gIm5vbmUiIH0gPSAkJHByb3BzOwoJbGV0IHsgdHlwZSB9ID0gJCRwcm9wczsKCWxldCB7IGRpc2FibGVkID0gZmFsc2UgfSA9ICQkcHJvcHM7CgoJZnVuY3Rpb24gY2xpY2tfaGFuZGxlcihldmVudCkgewoJCWJ1YmJsZS5jYWxsKHRoaXMsICQkc2VsZiwgZXZlbnQpOwoJfQoKCSQkc2VsZi4kJHNldCA9ICQkcHJvcHMgPT4gewoJCWlmICgnZGlzcGxheScgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDAsIGRpc3BsYXkgPSAkJHByb3BzLmRpc3BsYXkpOwoJCWlmICgnZXh0cmFPcHRpb25zJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMSwgZXh0cmFPcHRpb25zID0gJCRwcm9wcy5leHRyYU9wdGlvbnMpOwoJCWlmICgnaWNvblR5cGUnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgyLCBpY29uVHlwZSA9ICQkcHJvcHMuaWNvblR5cGUpOwoJCWlmICgndHlwZScgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDMsIHR5cGUgPSAkJHByb3BzLnR5cGUpOwoJCWlmICgnZGlzYWJsZWQnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSg0LCBkaXNhYmxlZCA9ICQkcHJvcHMuZGlzYWJsZWQpOwoJCWlmICgnJCRzY29wZScgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDUsICQkc2NvcGUgPSAkJHByb3BzLiQkc2NvcGUpOwoJfTsKCglyZXR1cm4gW2Rpc3BsYXksIGV4dHJhT3B0aW9ucywgaWNvblR5cGUsIHR5cGUsIGRpc2FibGVkLCAkJHNjb3BlLCBzbG90cywgY2xpY2tfaGFuZGxlcl07Cn0KCmNsYXNzIEJ1dHRvbiBleHRlbmRzIFN2ZWx0ZUNvbXBvbmVudCB7Cgljb25zdHJ1Y3RvcihvcHRpb25zKSB7CgkJc3VwZXIoKTsKCgkJaW5pdCh0aGlzLCBvcHRpb25zLCBpbnN0YW5jZSRhLCBjcmVhdGVfZnJhZ21lbnQkYSwgc2FmZV9ub3RfZXF1YWwsIHsKCQkJZGlzcGxheTogMCwKCQkJZXh0cmFPcHRpb25zOiAxLAoJCQlpY29uVHlwZTogMiwKCQkJdHlwZTogMywKCQkJZGlzYWJsZWQ6IDQKCQl9KTsKCX0KfQoKY29uc3QgQnV0dG9uJDEgPSBCdXR0b247Cgpjb25zdCBtYXRjaEljb25OYW1lID0gL15bYS16MC05XSsoLVthLXowLTldKykqJC87CmNvbnN0IHN0cmluZ1RvSWNvbiA9ICh2YWx1ZSwgdmFsaWRhdGUsIGFsbG93U2ltcGxlTmFtZSwgcHJvdmlkZXIgPSAiIikgPT4gewogIGNvbnN0IGNvbG9uU2VwYXJhdGVkID0gdmFsdWUuc3BsaXQoIjoiKTsKICBpZiAodmFsdWUuc2xpY2UoMCwgMSkgPT09ICJAIikgewogICAgaWYgKGNvbG9uU2VwYXJhdGVkLmxlbmd0aCA8IDIgfHwgY29sb25TZXBhcmF0ZWQubGVuZ3RoID4gMykgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIHByb3ZpZGVyID0gY29sb25TZXBhcmF0ZWQuc2hpZnQoKS5zbGljZSgxKTsKICB9CiAgaWYgKGNvbG9uU2VwYXJhdGVkLmxlbmd0aCA+IDMgfHwgIWNvbG9uU2VwYXJhdGVkLmxlbmd0aCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGlmIChjb2xvblNlcGFyYXRlZC5sZW5ndGggPiAxKSB7CiAgICBjb25zdCBuYW1lMiA9IGNvbG9uU2VwYXJhdGVkLnBvcCgpOwogICAgY29uc3QgcHJlZml4ID0gY29sb25TZXBhcmF0ZWQucG9wKCk7CiAgICBjb25zdCByZXN1bHQgPSB7CiAgICAgIC8vIEFsbG93IHByb3ZpZGVyIHdpdGhvdXQgJ0AnOiAicHJvdmlkZXI6cHJlZml4Om5hbWUiCiAgICAgIHByb3ZpZGVyOiBjb2xvblNlcGFyYXRlZC5sZW5ndGggPiAwID8gY29sb25TZXBhcmF0ZWRbMF0gOiBwcm92aWRlciwKICAgICAgcHJlZml4LAogICAgICBuYW1lOiBuYW1lMgogICAgfTsKICAgIHJldHVybiB2YWxpZGF0ZSAmJiAhdmFsaWRhdGVJY29uTmFtZShyZXN1bHQpID8gbnVsbCA6IHJlc3VsdDsKICB9CiAgY29uc3QgbmFtZSA9IGNvbG9uU2VwYXJhdGVkWzBdOwogIGNvbnN0IGRhc2hTZXBhcmF0ZWQgPSBuYW1lLnNwbGl0KCItIik7CiAgaWYgKGRhc2hTZXBhcmF0ZWQubGVuZ3RoID4gMSkgewogICAgY29uc3QgcmVzdWx0ID0gewogICAgICBwcm92aWRlciwKICAgICAgcHJlZml4OiBkYXNoU2VwYXJhdGVkLnNoaWZ0KCksCiAgICAgIG5hbWU6IGRhc2hTZXBhcmF0ZWQuam9pbigiLSIpCiAgICB9OwogICAgcmV0dXJuIHZhbGlkYXRlICYmICF2YWxpZGF0ZUljb25OYW1lKHJlc3VsdCkgPyBudWxsIDogcmVzdWx0OwogIH0KICBpZiAoYWxsb3dTaW1wbGVOYW1lICYmIHByb3ZpZGVyID09PSAiIikgewogICAgY29uc3QgcmVzdWx0ID0gewogICAgICBwcm92aWRlciwKICAgICAgcHJlZml4OiAiIiwKICAgICAgbmFtZQogICAgfTsKICAgIHJldHVybiB2YWxpZGF0ZSAmJiAhdmFsaWRhdGVJY29uTmFtZShyZXN1bHQsIGFsbG93U2ltcGxlTmFtZSkgPyBudWxsIDogcmVzdWx0OwogIH0KICByZXR1cm4gbnVsbDsKfTsKY29uc3QgdmFsaWRhdGVJY29uTmFtZSA9IChpY29uLCBhbGxvd1NpbXBsZU5hbWUpID0+IHsKICBpZiAoIWljb24pIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgcmV0dXJuICEhKChpY29uLnByb3ZpZGVyID09PSAiIiB8fCBpY29uLnByb3ZpZGVyLm1hdGNoKG1hdGNoSWNvbk5hbWUpKSAmJiAoYWxsb3dTaW1wbGVOYW1lICYmIGljb24ucHJlZml4ID09PSAiIiB8fCBpY29uLnByZWZpeC5tYXRjaChtYXRjaEljb25OYW1lKSkgJiYgaWNvbi5uYW1lLm1hdGNoKG1hdGNoSWNvbk5hbWUpKTsKfTsKCmNvbnN0IGRlZmF1bHRJY29uRGltZW5zaW9ucyA9IE9iamVjdC5mcmVlemUoCiAgewogICAgbGVmdDogMCwKICAgIHRvcDogMCwKICAgIHdpZHRoOiAxNiwKICAgIGhlaWdodDogMTYKICB9Cik7CmNvbnN0IGRlZmF1bHRJY29uVHJhbnNmb3JtYXRpb25zID0gT2JqZWN0LmZyZWV6ZSh7CiAgcm90YXRlOiAwLAogIHZGbGlwOiBmYWxzZSwKICBoRmxpcDogZmFsc2UKfSk7CmNvbnN0IGRlZmF1bHRJY29uUHJvcHMgPSBPYmplY3QuZnJlZXplKHsKICAuLi5kZWZhdWx0SWNvbkRpbWVuc2lvbnMsCiAgLi4uZGVmYXVsdEljb25UcmFuc2Zvcm1hdGlvbnMKfSk7CmNvbnN0IGRlZmF1bHRFeHRlbmRlZEljb25Qcm9wcyA9IE9iamVjdC5mcmVlemUoewogIC4uLmRlZmF1bHRJY29uUHJvcHMsCiAgYm9keTogIiIsCiAgaGlkZGVuOiBmYWxzZQp9KTsKCmZ1bmN0aW9uIG1lcmdlSWNvblRyYW5zZm9ybWF0aW9ucyhvYmoxLCBvYmoyKSB7CiAgY29uc3QgcmVzdWx0ID0ge307CiAgaWYgKCFvYmoxLmhGbGlwICE9PSAhb2JqMi5oRmxpcCkgewogICAgcmVzdWx0LmhGbGlwID0gdHJ1ZTsKICB9CiAgaWYgKCFvYmoxLnZGbGlwICE9PSAhb2JqMi52RmxpcCkgewogICAgcmVzdWx0LnZGbGlwID0gdHJ1ZTsKICB9CiAgY29uc3Qgcm90YXRlID0gKChvYmoxLnJvdGF0ZSB8fCAwKSArIChvYmoyLnJvdGF0ZSB8fCAwKSkgJSA0OwogIGlmIChyb3RhdGUpIHsKICAgIHJlc3VsdC5yb3RhdGUgPSByb3RhdGU7CiAgfQogIHJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIG1lcmdlSWNvbkRhdGEocGFyZW50LCBjaGlsZCkgewogIGNvbnN0IHJlc3VsdCA9IG1lcmdlSWNvblRyYW5zZm9ybWF0aW9ucyhwYXJlbnQsIGNoaWxkKTsKICBmb3IgKGNvbnN0IGtleSBpbiBkZWZhdWx0RXh0ZW5kZWRJY29uUHJvcHMpIHsKICAgIGlmIChrZXkgaW4gZGVmYXVsdEljb25UcmFuc2Zvcm1hdGlvbnMpIHsKICAgICAgaWYgKGtleSBpbiBwYXJlbnQgJiYgIShrZXkgaW4gcmVzdWx0KSkgewogICAgICAgIHJlc3VsdFtrZXldID0gZGVmYXVsdEljb25UcmFuc2Zvcm1hdGlvbnNba2V5XTsKICAgICAgfQogICAgfSBlbHNlIGlmIChrZXkgaW4gY2hpbGQpIHsKICAgICAgcmVzdWx0W2tleV0gPSBjaGlsZFtrZXldOwogICAgfSBlbHNlIGlmIChrZXkgaW4gcGFyZW50KSB7CiAgICAgIHJlc3VsdFtrZXldID0gcGFyZW50W2tleV07CiAgICB9CiAgfQogIHJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIGdldEljb25zVHJlZShkYXRhLCBuYW1lcykgewogIGNvbnN0IGljb25zID0gZGF0YS5pY29uczsKICBjb25zdCBhbGlhc2VzID0gZGF0YS5hbGlhc2VzIHx8IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpOwogIGNvbnN0IHJlc29sdmVkID0gLyogQF9fUFVSRV9fICovIE9iamVjdC5jcmVhdGUobnVsbCk7CiAgZnVuY3Rpb24gcmVzb2x2ZShuYW1lKSB7CiAgICBpZiAoaWNvbnNbbmFtZV0pIHsKICAgICAgcmV0dXJuIHJlc29sdmVkW25hbWVdID0gW107CiAgICB9CiAgICBpZiAoIShuYW1lIGluIHJlc29sdmVkKSkgewogICAgICByZXNvbHZlZFtuYW1lXSA9IG51bGw7CiAgICAgIGNvbnN0IHBhcmVudCA9IGFsaWFzZXNbbmFtZV0gJiYgYWxpYXNlc1tuYW1lXS5wYXJlbnQ7CiAgICAgIGNvbnN0IHZhbHVlID0gcGFyZW50ICYmIHJlc29sdmUocGFyZW50KTsKICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgcmVzb2x2ZWRbbmFtZV0gPSBbcGFyZW50XS5jb25jYXQodmFsdWUpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzb2x2ZWRbbmFtZV07CiAgfQogIChuYW1lcyB8fCBPYmplY3Qua2V5cyhpY29ucykuY29uY2F0KE9iamVjdC5rZXlzKGFsaWFzZXMpKSkuZm9yRWFjaChyZXNvbHZlKTsKICByZXR1cm4gcmVzb2x2ZWQ7Cn0KCmZ1bmN0aW9uIGludGVybmFsR2V0SWNvbkRhdGEoZGF0YSwgbmFtZSwgdHJlZSkgewogIGNvbnN0IGljb25zID0gZGF0YS5pY29uczsKICBjb25zdCBhbGlhc2VzID0gZGF0YS5hbGlhc2VzIHx8IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpOwogIGxldCBjdXJyZW50UHJvcHMgPSB7fTsKICBmdW5jdGlvbiBwYXJzZShuYW1lMikgewogICAgY3VycmVudFByb3BzID0gbWVyZ2VJY29uRGF0YSgKICAgICAgaWNvbnNbbmFtZTJdIHx8IGFsaWFzZXNbbmFtZTJdLAogICAgICBjdXJyZW50UHJvcHMKICAgICk7CiAgfQogIHBhcnNlKG5hbWUpOwogIHRyZWUuZm9yRWFjaChwYXJzZSk7CiAgcmV0dXJuIG1lcmdlSWNvbkRhdGEoZGF0YSwgY3VycmVudFByb3BzKTsKfQoKZnVuY3Rpb24gcGFyc2VJY29uU2V0KGRhdGEsIGNhbGxiYWNrKSB7CiAgY29uc3QgbmFtZXMgPSBbXTsKICBpZiAodHlwZW9mIGRhdGEgIT09ICJvYmplY3QiIHx8IHR5cGVvZiBkYXRhLmljb25zICE9PSAib2JqZWN0IikgewogICAgcmV0dXJuIG5hbWVzOwogIH0KICBpZiAoZGF0YS5ub3RfZm91bmQgaW5zdGFuY2VvZiBBcnJheSkgewogICAgZGF0YS5ub3RfZm91bmQuZm9yRWFjaCgobmFtZSkgPT4gewogICAgICBjYWxsYmFjayhuYW1lLCBudWxsKTsKICAgICAgbmFtZXMucHVzaChuYW1lKTsKICAgIH0pOwogIH0KICBjb25zdCB0cmVlID0gZ2V0SWNvbnNUcmVlKGRhdGEpOwogIGZvciAoY29uc3QgbmFtZSBpbiB0cmVlKSB7CiAgICBjb25zdCBpdGVtID0gdHJlZVtuYW1lXTsKICAgIGlmIChpdGVtKSB7CiAgICAgIGNhbGxiYWNrKG5hbWUsIGludGVybmFsR2V0SWNvbkRhdGEoZGF0YSwgbmFtZSwgaXRlbSkpOwogICAgICBuYW1lcy5wdXNoKG5hbWUpOwogICAgfQogIH0KICByZXR1cm4gbmFtZXM7Cn0KCmNvbnN0IG9wdGlvbmFsUHJvcGVydHlEZWZhdWx0cyA9IHsKICBwcm92aWRlcjogIiIsCiAgYWxpYXNlczoge30sCiAgbm90X2ZvdW5kOiB7fSwKICAuLi5kZWZhdWx0SWNvbkRpbWVuc2lvbnMKfTsKZnVuY3Rpb24gY2hlY2tPcHRpb25hbFByb3BzKGl0ZW0sIGRlZmF1bHRzKSB7CiAgZm9yIChjb25zdCBwcm9wIGluIGRlZmF1bHRzKSB7CiAgICBpZiAocHJvcCBpbiBpdGVtICYmIHR5cGVvZiBpdGVtW3Byb3BdICE9PSB0eXBlb2YgZGVmYXVsdHNbcHJvcF0pIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KICByZXR1cm4gdHJ1ZTsKfQpmdW5jdGlvbiBxdWlja2x5VmFsaWRhdGVJY29uU2V0KG9iaikgewogIGlmICh0eXBlb2Ygb2JqICE9PSAib2JqZWN0IiB8fCBvYmogPT09IG51bGwpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBjb25zdCBkYXRhID0gb2JqOwogIGlmICh0eXBlb2YgZGF0YS5wcmVmaXggIT09ICJzdHJpbmciIHx8ICFvYmouaWNvbnMgfHwgdHlwZW9mIG9iai5pY29ucyAhPT0gIm9iamVjdCIpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBpZiAoIWNoZWNrT3B0aW9uYWxQcm9wcyhvYmosIG9wdGlvbmFsUHJvcGVydHlEZWZhdWx0cykpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBjb25zdCBpY29ucyA9IGRhdGEuaWNvbnM7CiAgZm9yIChjb25zdCBuYW1lIGluIGljb25zKSB7CiAgICBjb25zdCBpY29uID0gaWNvbnNbbmFtZV07CiAgICBpZiAoIW5hbWUubWF0Y2gobWF0Y2hJY29uTmFtZSkgfHwgdHlwZW9mIGljb24uYm9keSAhPT0gInN0cmluZyIgfHwgIWNoZWNrT3B0aW9uYWxQcm9wcygKICAgICAgaWNvbiwKICAgICAgZGVmYXVsdEV4dGVuZGVkSWNvblByb3BzCiAgICApKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0KICBjb25zdCBhbGlhc2VzID0gZGF0YS5hbGlhc2VzIHx8IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpOwogIGZvciAoY29uc3QgbmFtZSBpbiBhbGlhc2VzKSB7CiAgICBjb25zdCBpY29uID0gYWxpYXNlc1tuYW1lXTsKICAgIGNvbnN0IHBhcmVudCA9IGljb24ucGFyZW50OwogICAgaWYgKCFuYW1lLm1hdGNoKG1hdGNoSWNvbk5hbWUpIHx8IHR5cGVvZiBwYXJlbnQgIT09ICJzdHJpbmciIHx8ICFpY29uc1twYXJlbnRdICYmICFhbGlhc2VzW3BhcmVudF0gfHwgIWNoZWNrT3B0aW9uYWxQcm9wcygKICAgICAgaWNvbiwKICAgICAgZGVmYXVsdEV4dGVuZGVkSWNvblByb3BzCiAgICApKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0KICByZXR1cm4gZGF0YTsKfQoKY29uc3QgZGF0YVN0b3JhZ2UgPSAvKiBAX19QVVJFX18gKi8gT2JqZWN0LmNyZWF0ZShudWxsKTsKZnVuY3Rpb24gbmV3U3RvcmFnZShwcm92aWRlciwgcHJlZml4KSB7CiAgcmV0dXJuIHsKICAgIHByb3ZpZGVyLAogICAgcHJlZml4LAogICAgaWNvbnM6IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpLAogICAgbWlzc2luZzogLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKQogIH07Cn0KZnVuY3Rpb24gZ2V0U3RvcmFnZShwcm92aWRlciwgcHJlZml4KSB7CiAgY29uc3QgcHJvdmlkZXJTdG9yYWdlID0gZGF0YVN0b3JhZ2VbcHJvdmlkZXJdIHx8IChkYXRhU3RvcmFnZVtwcm92aWRlcl0gPSAvKiBAX19QVVJFX18gKi8gT2JqZWN0LmNyZWF0ZShudWxsKSk7CiAgcmV0dXJuIHByb3ZpZGVyU3RvcmFnZVtwcmVmaXhdIHx8IChwcm92aWRlclN0b3JhZ2VbcHJlZml4XSA9IG5ld1N0b3JhZ2UocHJvdmlkZXIsIHByZWZpeCkpOwp9CmZ1bmN0aW9uIGFkZEljb25TZXQoc3RvcmFnZSwgZGF0YSkgewogIGlmICghcXVpY2tseVZhbGlkYXRlSWNvblNldChkYXRhKSkgewogICAgcmV0dXJuIFtdOwogIH0KICByZXR1cm4gcGFyc2VJY29uU2V0KGRhdGEsIChuYW1lLCBpY29uKSA9PiB7CiAgICBpZiAoaWNvbikgewogICAgICBzdG9yYWdlLmljb25zW25hbWVdID0gaWNvbjsKICAgIH0gZWxzZSB7CiAgICAgIHN0b3JhZ2UubWlzc2luZy5hZGQobmFtZSk7CiAgICB9CiAgfSk7Cn0KZnVuY3Rpb24gYWRkSWNvblRvU3RvcmFnZShzdG9yYWdlLCBuYW1lLCBpY29uKSB7CiAgdHJ5IHsKICAgIGlmICh0eXBlb2YgaWNvbi5ib2R5ID09PSAic3RyaW5nIikgewogICAgICBzdG9yYWdlLmljb25zW25hbWVdID0geyAuLi5pY29uIH07CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogIH0gY2F0Y2ggKGVycikgewogIH0KICByZXR1cm4gZmFsc2U7Cn0KCmxldCBzaW1wbGVOYW1lcyA9IGZhbHNlOwpmdW5jdGlvbiBhbGxvd1NpbXBsZU5hbWVzKGFsbG93KSB7CiAgaWYgKHR5cGVvZiBhbGxvdyA9PT0gImJvb2xlYW4iKSB7CiAgICBzaW1wbGVOYW1lcyA9IGFsbG93OwogIH0KICByZXR1cm4gc2ltcGxlTmFtZXM7Cn0KZnVuY3Rpb24gZ2V0SWNvbkRhdGEobmFtZSkgewogIGNvbnN0IGljb24gPSB0eXBlb2YgbmFtZSA9PT0gInN0cmluZyIgPyBzdHJpbmdUb0ljb24obmFtZSwgdHJ1ZSwgc2ltcGxlTmFtZXMpIDogbmFtZTsKICBpZiAoaWNvbikgewogICAgY29uc3Qgc3RvcmFnZSA9IGdldFN0b3JhZ2UoaWNvbi5wcm92aWRlciwgaWNvbi5wcmVmaXgpOwogICAgY29uc3QgaWNvbk5hbWUgPSBpY29uLm5hbWU7CiAgICByZXR1cm4gc3RvcmFnZS5pY29uc1tpY29uTmFtZV0gfHwgKHN0b3JhZ2UubWlzc2luZy5oYXMoaWNvbk5hbWUpID8gbnVsbCA6IHZvaWQgMCk7CiAgfQp9CmZ1bmN0aW9uIGFkZEljb24obmFtZSwgZGF0YSkgewogIGNvbnN0IGljb24gPSBzdHJpbmdUb0ljb24obmFtZSwgdHJ1ZSwgc2ltcGxlTmFtZXMpOwogIGlmICghaWNvbikgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBjb25zdCBzdG9yYWdlID0gZ2V0U3RvcmFnZShpY29uLnByb3ZpZGVyLCBpY29uLnByZWZpeCk7CiAgcmV0dXJuIGFkZEljb25Ub1N0b3JhZ2Uoc3RvcmFnZSwgaWNvbi5uYW1lLCBkYXRhKTsKfQpmdW5jdGlvbiBhZGRDb2xsZWN0aW9uKGRhdGEsIHByb3ZpZGVyKSB7CiAgaWYgKHR5cGVvZiBkYXRhICE9PSAib2JqZWN0IikgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBpZiAodHlwZW9mIHByb3ZpZGVyICE9PSAic3RyaW5nIikgewogICAgcHJvdmlkZXIgPSBkYXRhLnByb3ZpZGVyIHx8ICIiOwogIH0KICBpZiAoc2ltcGxlTmFtZXMgJiYgIXByb3ZpZGVyICYmICFkYXRhLnByZWZpeCkgewogICAgbGV0IGFkZGVkID0gZmFsc2U7CiAgICBpZiAocXVpY2tseVZhbGlkYXRlSWNvblNldChkYXRhKSkgewogICAgICBkYXRhLnByZWZpeCA9ICIiOwogICAgICBwYXJzZUljb25TZXQoZGF0YSwgKG5hbWUsIGljb24pID0+IHsKICAgICAgICBpZiAoaWNvbiAmJiBhZGRJY29uKG5hbWUsIGljb24pKSB7CiAgICAgICAgICBhZGRlZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIHJldHVybiBhZGRlZDsKICB9CiAgY29uc3QgcHJlZml4ID0gZGF0YS5wcmVmaXg7CiAgaWYgKCF2YWxpZGF0ZUljb25OYW1lKHsKICAgIHByb3ZpZGVyLAogICAgcHJlZml4LAogICAgbmFtZTogImEiCiAgfSkpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgY29uc3Qgc3RvcmFnZSA9IGdldFN0b3JhZ2UocHJvdmlkZXIsIHByZWZpeCk7CiAgcmV0dXJuICEhYWRkSWNvblNldChzdG9yYWdlLCBkYXRhKTsKfQoKY29uc3QgZGVmYXVsdEljb25TaXplQ3VzdG9taXNhdGlvbnMgPSBPYmplY3QuZnJlZXplKHsKICB3aWR0aDogbnVsbCwKICBoZWlnaHQ6IG51bGwKfSk7CmNvbnN0IGRlZmF1bHRJY29uQ3VzdG9taXNhdGlvbnMgPSBPYmplY3QuZnJlZXplKHsKICAvLyBEaW1lbnNpb25zCiAgLi4uZGVmYXVsdEljb25TaXplQ3VzdG9taXNhdGlvbnMsCiAgLy8gVHJhbnNmb3JtYXRpb25zCiAgLi4uZGVmYXVsdEljb25UcmFuc2Zvcm1hdGlvbnMKfSk7Cgpjb25zdCB1bml0c1NwbGl0ID0gLygtP1swLTkuXSpbMC05XStbMC05Ll0qKS9nOwpjb25zdCB1bml0c1Rlc3QgPSAvXi0/WzAtOS5dKlswLTldK1swLTkuXSokL2c7CmZ1bmN0aW9uIGNhbGN1bGF0ZVNpemUoc2l6ZSwgcmF0aW8sIHByZWNpc2lvbikgewogIGlmIChyYXRpbyA9PT0gMSkgewogICAgcmV0dXJuIHNpemU7CiAgfQogIHByZWNpc2lvbiA9IHByZWNpc2lvbiB8fCAxMDA7CiAgaWYgKHR5cGVvZiBzaXplID09PSAibnVtYmVyIikgewogICAgcmV0dXJuIE1hdGguY2VpbChzaXplICogcmF0aW8gKiBwcmVjaXNpb24pIC8gcHJlY2lzaW9uOwogIH0KICBpZiAodHlwZW9mIHNpemUgIT09ICJzdHJpbmciKSB7CiAgICByZXR1cm4gc2l6ZTsKICB9CiAgY29uc3Qgb2xkUGFydHMgPSBzaXplLnNwbGl0KHVuaXRzU3BsaXQpOwogIGlmIChvbGRQYXJ0cyA9PT0gbnVsbCB8fCAhb2xkUGFydHMubGVuZ3RoKSB7CiAgICByZXR1cm4gc2l6ZTsKICB9CiAgY29uc3QgbmV3UGFydHMgPSBbXTsKICBsZXQgY29kZSA9IG9sZFBhcnRzLnNoaWZ0KCk7CiAgbGV0IGlzTnVtYmVyID0gdW5pdHNUZXN0LnRlc3QoY29kZSk7CiAgd2hpbGUgKHRydWUpIHsKICAgIGlmIChpc051bWJlcikgewogICAgICBjb25zdCBudW0gPSBwYXJzZUZsb2F0KGNvZGUpOwogICAgICBpZiAoaXNOYU4obnVtKSkgewogICAgICAgIG5ld1BhcnRzLnB1c2goY29kZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbmV3UGFydHMucHVzaChNYXRoLmNlaWwobnVtICogcmF0aW8gKiBwcmVjaXNpb24pIC8gcHJlY2lzaW9uKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgbmV3UGFydHMucHVzaChjb2RlKTsKICAgIH0KICAgIGNvZGUgPSBvbGRQYXJ0cy5zaGlmdCgpOwogICAgaWYgKGNvZGUgPT09IHZvaWQgMCkgewogICAgICByZXR1cm4gbmV3UGFydHMuam9pbigiIik7CiAgICB9CiAgICBpc051bWJlciA9ICFpc051bWJlcjsKICB9Cn0KCmNvbnN0IGlzVW5zZXRLZXl3b3JkID0gKHZhbHVlKSA9PiB2YWx1ZSA9PT0gInVuc2V0IiB8fCB2YWx1ZSA9PT0gInVuZGVmaW5lZCIgfHwgdmFsdWUgPT09ICJub25lIjsKZnVuY3Rpb24gaWNvblRvU1ZHKGljb24sIGN1c3RvbWlzYXRpb25zKSB7CiAgY29uc3QgZnVsbEljb24gPSB7CiAgICAuLi5kZWZhdWx0SWNvblByb3BzLAogICAgLi4uaWNvbgogIH07CiAgY29uc3QgZnVsbEN1c3RvbWlzYXRpb25zID0gewogICAgLi4uZGVmYXVsdEljb25DdXN0b21pc2F0aW9ucywKICAgIC4uLmN1c3RvbWlzYXRpb25zCiAgfTsKICBjb25zdCBib3ggPSB7CiAgICBsZWZ0OiBmdWxsSWNvbi5sZWZ0LAogICAgdG9wOiBmdWxsSWNvbi50b3AsCiAgICB3aWR0aDogZnVsbEljb24ud2lkdGgsCiAgICBoZWlnaHQ6IGZ1bGxJY29uLmhlaWdodAogIH07CiAgbGV0IGJvZHkgPSBmdWxsSWNvbi5ib2R5OwogIFtmdWxsSWNvbiwgZnVsbEN1c3RvbWlzYXRpb25zXS5mb3JFYWNoKChwcm9wcykgPT4gewogICAgY29uc3QgdHJhbnNmb3JtYXRpb25zID0gW107CiAgICBjb25zdCBoRmxpcCA9IHByb3BzLmhGbGlwOwogICAgY29uc3QgdkZsaXAgPSBwcm9wcy52RmxpcDsKICAgIGxldCByb3RhdGlvbiA9IHByb3BzLnJvdGF0ZTsKICAgIGlmIChoRmxpcCkgewogICAgICBpZiAodkZsaXApIHsKICAgICAgICByb3RhdGlvbiArPSAyOwogICAgICB9IGVsc2UgewogICAgICAgIHRyYW5zZm9ybWF0aW9ucy5wdXNoKAogICAgICAgICAgInRyYW5zbGF0ZSgiICsgKGJveC53aWR0aCArIGJveC5sZWZ0KS50b1N0cmluZygpICsgIiAiICsgKDAgLSBib3gudG9wKS50b1N0cmluZygpICsgIikiCiAgICAgICAgKTsKICAgICAgICB0cmFuc2Zvcm1hdGlvbnMucHVzaCgic2NhbGUoLTEgMSkiKTsKICAgICAgICBib3gudG9wID0gYm94LmxlZnQgPSAwOwogICAgICB9CiAgICB9IGVsc2UgaWYgKHZGbGlwKSB7CiAgICAgIHRyYW5zZm9ybWF0aW9ucy5wdXNoKAogICAgICAgICJ0cmFuc2xhdGUoIiArICgwIC0gYm94LmxlZnQpLnRvU3RyaW5nKCkgKyAiICIgKyAoYm94LmhlaWdodCArIGJveC50b3ApLnRvU3RyaW5nKCkgKyAiKSIKICAgICAgKTsKICAgICAgdHJhbnNmb3JtYXRpb25zLnB1c2goInNjYWxlKDEgLTEpIik7CiAgICAgIGJveC50b3AgPSBib3gubGVmdCA9IDA7CiAgICB9CiAgICBsZXQgdGVtcFZhbHVlOwogICAgaWYgKHJvdGF0aW9uIDwgMCkgewogICAgICByb3RhdGlvbiAtPSBNYXRoLmZsb29yKHJvdGF0aW9uIC8gNCkgKiA0OwogICAgfQogICAgcm90YXRpb24gPSByb3RhdGlvbiAlIDQ7CiAgICBzd2l0Y2ggKHJvdGF0aW9uKSB7CiAgICAgIGNhc2UgMToKICAgICAgICB0ZW1wVmFsdWUgPSBib3guaGVpZ2h0IC8gMiArIGJveC50b3A7CiAgICAgICAgdHJhbnNmb3JtYXRpb25zLnVuc2hpZnQoCiAgICAgICAgICAicm90YXRlKDkwICIgKyB0ZW1wVmFsdWUudG9TdHJpbmcoKSArICIgIiArIHRlbXBWYWx1ZS50b1N0cmluZygpICsgIikiCiAgICAgICAgKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAyOgogICAgICAgIHRyYW5zZm9ybWF0aW9ucy51bnNoaWZ0KAogICAgICAgICAgInJvdGF0ZSgxODAgIiArIChib3gud2lkdGggLyAyICsgYm94LmxlZnQpLnRvU3RyaW5nKCkgKyAiICIgKyAoYm94LmhlaWdodCAvIDIgKyBib3gudG9wKS50b1N0cmluZygpICsgIikiCiAgICAgICAgKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAzOgogICAgICAgIHRlbXBWYWx1ZSA9IGJveC53aWR0aCAvIDIgKyBib3gubGVmdDsKICAgICAgICB0cmFuc2Zvcm1hdGlvbnMudW5zaGlmdCgKICAgICAgICAgICJyb3RhdGUoLTkwICIgKyB0ZW1wVmFsdWUudG9TdHJpbmcoKSArICIgIiArIHRlbXBWYWx1ZS50b1N0cmluZygpICsgIikiCiAgICAgICAgKTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGlmIChyb3RhdGlvbiAlIDIgPT09IDEpIHsKICAgICAgaWYgKGJveC5sZWZ0ICE9PSBib3gudG9wKSB7CiAgICAgICAgdGVtcFZhbHVlID0gYm94LmxlZnQ7CiAgICAgICAgYm94LmxlZnQgPSBib3gudG9wOwogICAgICAgIGJveC50b3AgPSB0ZW1wVmFsdWU7CiAgICAgIH0KICAgICAgaWYgKGJveC53aWR0aCAhPT0gYm94LmhlaWdodCkgewogICAgICAgIHRlbXBWYWx1ZSA9IGJveC53aWR0aDsKICAgICAgICBib3gud2lkdGggPSBib3guaGVpZ2h0OwogICAgICAgIGJveC5oZWlnaHQgPSB0ZW1wVmFsdWU7CiAgICAgIH0KICAgIH0KICAgIGlmICh0cmFuc2Zvcm1hdGlvbnMubGVuZ3RoKSB7CiAgICAgIGJvZHkgPSAnPGcgdHJhbnNmb3JtPSInICsgdHJhbnNmb3JtYXRpb25zLmpvaW4oIiAiKSArICciPicgKyBib2R5ICsgIjwvZz4iOwogICAgfQogIH0pOwogIGNvbnN0IGN1c3RvbWlzYXRpb25zV2lkdGggPSBmdWxsQ3VzdG9taXNhdGlvbnMud2lkdGg7CiAgY29uc3QgY3VzdG9taXNhdGlvbnNIZWlnaHQgPSBmdWxsQ3VzdG9taXNhdGlvbnMuaGVpZ2h0OwogIGNvbnN0IGJveFdpZHRoID0gYm94LndpZHRoOwogIGNvbnN0IGJveEhlaWdodCA9IGJveC5oZWlnaHQ7CiAgbGV0IHdpZHRoOwogIGxldCBoZWlnaHQ7CiAgaWYgKGN1c3RvbWlzYXRpb25zV2lkdGggPT09IG51bGwpIHsKICAgIGhlaWdodCA9IGN1c3RvbWlzYXRpb25zSGVpZ2h0ID09PSBudWxsID8gIjFlbSIgOiBjdXN0b21pc2F0aW9uc0hlaWdodCA9PT0gImF1dG8iID8gYm94SGVpZ2h0IDogY3VzdG9taXNhdGlvbnNIZWlnaHQ7CiAgICB3aWR0aCA9IGNhbGN1bGF0ZVNpemUoaGVpZ2h0LCBib3hXaWR0aCAvIGJveEhlaWdodCk7CiAgfSBlbHNlIHsKICAgIHdpZHRoID0gY3VzdG9taXNhdGlvbnNXaWR0aCA9PT0gImF1dG8iID8gYm94V2lkdGggOiBjdXN0b21pc2F0aW9uc1dpZHRoOwogICAgaGVpZ2h0ID0gY3VzdG9taXNhdGlvbnNIZWlnaHQgPT09IG51bGwgPyBjYWxjdWxhdGVTaXplKHdpZHRoLCBib3hIZWlnaHQgLyBib3hXaWR0aCkgOiBjdXN0b21pc2F0aW9uc0hlaWdodCA9PT0gImF1dG8iID8gYm94SGVpZ2h0IDogY3VzdG9taXNhdGlvbnNIZWlnaHQ7CiAgfQogIGNvbnN0IGF0dHJpYnV0ZXMgPSB7fTsKICBjb25zdCBzZXRBdHRyID0gKHByb3AsIHZhbHVlKSA9PiB7CiAgICBpZiAoIWlzVW5zZXRLZXl3b3JkKHZhbHVlKSkgewogICAgICBhdHRyaWJ1dGVzW3Byb3BdID0gdmFsdWUudG9TdHJpbmcoKTsKICAgIH0KICB9OwogIHNldEF0dHIoIndpZHRoIiwgd2lkdGgpOwogIHNldEF0dHIoImhlaWdodCIsIGhlaWdodCk7CiAgYXR0cmlidXRlcy52aWV3Qm94ID0gYm94LmxlZnQudG9TdHJpbmcoKSArICIgIiArIGJveC50b3AudG9TdHJpbmcoKSArICIgIiArIGJveFdpZHRoLnRvU3RyaW5nKCkgKyAiICIgKyBib3hIZWlnaHQudG9TdHJpbmcoKTsKICByZXR1cm4gewogICAgYXR0cmlidXRlcywKICAgIGJvZHkKICB9Owp9Cgpjb25zdCByZWdleCA9IC9cc2lkPSIoXFMrKSIvZzsKY29uc3QgcmFuZG9tUHJlZml4ID0gIkljb25pZnlJZCIgKyBEYXRlLm5vdygpLnRvU3RyaW5nKDE2KSArIChNYXRoLnJhbmRvbSgpICogMTY3NzcyMTYgfCAwKS50b1N0cmluZygxNik7CmxldCBjb3VudGVyID0gMDsKZnVuY3Rpb24gcmVwbGFjZUlEcyhib2R5LCBwcmVmaXggPSByYW5kb21QcmVmaXgpIHsKICBjb25zdCBpZHMgPSBbXTsKICBsZXQgbWF0Y2g7CiAgd2hpbGUgKG1hdGNoID0gcmVnZXguZXhlYyhib2R5KSkgewogICAgaWRzLnB1c2gobWF0Y2hbMV0pOwogIH0KICBpZiAoIWlkcy5sZW5ndGgpIHsKICAgIHJldHVybiBib2R5OwogIH0KICBjb25zdCBzdWZmaXggPSAic3VmZml4IiArIChNYXRoLnJhbmRvbSgpICogMTY3NzcyMTYgfCBEYXRlLm5vdygpKS50b1N0cmluZygxNik7CiAgaWRzLmZvckVhY2goKGlkKSA9PiB7CiAgICBjb25zdCBuZXdJRCA9IHR5cGVvZiBwcmVmaXggPT09ICJmdW5jdGlvbiIgPyBwcmVmaXgoaWQpIDogcHJlZml4ICsgKGNvdW50ZXIrKykudG9TdHJpbmcoKTsKICAgIGNvbnN0IGVzY2FwZWRJRCA9IGlkLnJlcGxhY2UoL1suKis/XiR7fSgpfFtcXVxcXS9nLCAiXFwkJiIpOwogICAgYm9keSA9IGJvZHkucmVwbGFjZSgKICAgICAgLy8gQWxsb3dlZCBjaGFyYWN0ZXJzIGJlZm9yZSBpZDogWyM7Il0KICAgICAgLy8gQWxsb3dlZCBjaGFyYWN0ZXJzIGFmdGVyIGlkOiBbKSJdLCAuW2Etel0KICAgICAgbmV3IFJlZ0V4cCgnKFsjOyJdKSgnICsgZXNjYXBlZElEICsgJykoWyIpXXxcXC5bYS16XSknLCAiZyIpLAogICAgICAiJDEiICsgbmV3SUQgKyBzdWZmaXggKyAiJDMiCiAgICApOwogIH0pOwogIGJvZHkgPSBib2R5LnJlcGxhY2UobmV3IFJlZ0V4cChzdWZmaXgsICJnIiksICIiKTsKICByZXR1cm4gYm9keTsKfQoKY29uc3Qgc3RvcmFnZSA9IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpOwpmdW5jdGlvbiBzZXRBUElNb2R1bGUocHJvdmlkZXIsIGl0ZW0pIHsKICBzdG9yYWdlW3Byb3ZpZGVyXSA9IGl0ZW07Cn0KZnVuY3Rpb24gZ2V0QVBJTW9kdWxlKHByb3ZpZGVyKSB7CiAgcmV0dXJuIHN0b3JhZ2VbcHJvdmlkZXJdIHx8IHN0b3JhZ2VbIiJdOwp9CgpmdW5jdGlvbiBjcmVhdGVBUElDb25maWcoc291cmNlKSB7CiAgbGV0IHJlc291cmNlczsKICBpZiAodHlwZW9mIHNvdXJjZS5yZXNvdXJjZXMgPT09ICJzdHJpbmciKSB7CiAgICByZXNvdXJjZXMgPSBbc291cmNlLnJlc291cmNlc107CiAgfSBlbHNlIHsKICAgIHJlc291cmNlcyA9IHNvdXJjZS5yZXNvdXJjZXM7CiAgICBpZiAoIShyZXNvdXJjZXMgaW5zdGFuY2VvZiBBcnJheSkgfHwgIXJlc291cmNlcy5sZW5ndGgpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfQogIGNvbnN0IHJlc3VsdCA9IHsKICAgIC8vIEFQSSBob3N0cwogICAgcmVzb3VyY2VzLAogICAgLy8gUm9vdCBwYXRoCiAgICBwYXRoOiBzb3VyY2UucGF0aCB8fCAiLyIsCiAgICAvLyBVUkwgbGVuZ3RoIGxpbWl0CiAgICBtYXhVUkw6IHNvdXJjZS5tYXhVUkwgfHwgNTAwLAogICAgLy8gVGltZW91dCBiZWZvcmUgbmV4dCBob3N0IGlzIHVzZWQuCiAgICByb3RhdGU6IHNvdXJjZS5yb3RhdGUgfHwgNzUwLAogICAgLy8gVGltZW91dCBiZWZvcmUgZmFpbGluZyBxdWVyeS4KICAgIHRpbWVvdXQ6IHNvdXJjZS50aW1lb3V0IHx8IDVlMywKICAgIC8vIFJhbmRvbWlzZSBkZWZhdWx0IEFQSSBlbmQgcG9pbnQuCiAgICByYW5kb206IHNvdXJjZS5yYW5kb20gPT09IHRydWUsCiAgICAvLyBTdGFydCBpbmRleAogICAgaW5kZXg6IHNvdXJjZS5pbmRleCB8fCAwLAogICAgLy8gUmVjZWl2ZSBkYXRhIGFmdGVyIHRpbWUgb3V0ICh1c2VkIGlmIHRpbWUgb3V0IGtpY2tzIGluIGZpcnN0LCB0aGVuIEFQSSBtb2R1bGUgc2VuZHMgZGF0YSBhbnl3YXkpLgogICAgZGF0YUFmdGVyVGltZW91dDogc291cmNlLmRhdGFBZnRlclRpbWVvdXQgIT09IGZhbHNlCiAgfTsKICByZXR1cm4gcmVzdWx0Owp9CmNvbnN0IGNvbmZpZ1N0b3JhZ2UgPSAvKiBAX19QVVJFX18gKi8gT2JqZWN0LmNyZWF0ZShudWxsKTsKY29uc3QgZmFsbEJhY2tBUElTb3VyY2VzID0gWwogICJodHRwczovL2FwaS5zaW1wbGVzdmcuY29tIiwKICAiaHR0cHM6Ly9hcGkudW5pc3ZnLmNvbSIKXTsKY29uc3QgZmFsbEJhY2tBUEkgPSBbXTsKd2hpbGUgKGZhbGxCYWNrQVBJU291cmNlcy5sZW5ndGggPiAwKSB7CiAgaWYgKGZhbGxCYWNrQVBJU291cmNlcy5sZW5ndGggPT09IDEpIHsKICAgIGZhbGxCYWNrQVBJLnB1c2goZmFsbEJhY2tBUElTb3VyY2VzLnNoaWZ0KCkpOwogIH0gZWxzZSB7CiAgICBpZiAoTWF0aC5yYW5kb20oKSA+IDAuNSkgewogICAgICBmYWxsQmFja0FQSS5wdXNoKGZhbGxCYWNrQVBJU291cmNlcy5zaGlmdCgpKTsKICAgIH0gZWxzZSB7CiAgICAgIGZhbGxCYWNrQVBJLnB1c2goZmFsbEJhY2tBUElTb3VyY2VzLnBvcCgpKTsKICAgIH0KICB9Cn0KY29uZmlnU3RvcmFnZVsiIl0gPSBjcmVhdGVBUElDb25maWcoewogIHJlc291cmNlczogWyJodHRwczovL2FwaS5pY29uaWZ5LmRlc2lnbiJdLmNvbmNhdChmYWxsQmFja0FQSSkKfSk7CmZ1bmN0aW9uIGFkZEFQSVByb3ZpZGVyKHByb3ZpZGVyLCBjdXN0b21Db25maWcpIHsKICBjb25zdCBjb25maWcgPSBjcmVhdGVBUElDb25maWcoY3VzdG9tQ29uZmlnKTsKICBpZiAoY29uZmlnID09PSBudWxsKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGNvbmZpZ1N0b3JhZ2VbcHJvdmlkZXJdID0gY29uZmlnOwogIHJldHVybiB0cnVlOwp9CmZ1bmN0aW9uIGdldEFQSUNvbmZpZyhwcm92aWRlcikgewogIHJldHVybiBjb25maWdTdG9yYWdlW3Byb3ZpZGVyXTsKfQoKY29uc3QgZGV0ZWN0RmV0Y2ggPSAoKSA9PiB7CiAgbGV0IGNhbGxiYWNrOwogIHRyeSB7CiAgICBjYWxsYmFjayA9IGZldGNoOwogICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gImZ1bmN0aW9uIikgewogICAgICByZXR1cm4gY2FsbGJhY2s7CiAgICB9CiAgfSBjYXRjaCAoZXJyKSB7CiAgfQp9OwpsZXQgZmV0Y2hNb2R1bGUgPSBkZXRlY3RGZXRjaCgpOwpmdW5jdGlvbiBjYWxjdWxhdGVNYXhMZW5ndGgocHJvdmlkZXIsIHByZWZpeCkgewogIGNvbnN0IGNvbmZpZyA9IGdldEFQSUNvbmZpZyhwcm92aWRlcik7CiAgaWYgKCFjb25maWcpIHsKICAgIHJldHVybiAwOwogIH0KICBsZXQgcmVzdWx0OwogIGlmICghY29uZmlnLm1heFVSTCkgewogICAgcmVzdWx0ID0gMDsKICB9IGVsc2UgewogICAgbGV0IG1heEhvc3RMZW5ndGggPSAwOwogICAgY29uZmlnLnJlc291cmNlcy5mb3JFYWNoKChpdGVtKSA9PiB7CiAgICAgIGNvbnN0IGhvc3QgPSBpdGVtOwogICAgICBtYXhIb3N0TGVuZ3RoID0gTWF0aC5tYXgobWF4SG9zdExlbmd0aCwgaG9zdC5sZW5ndGgpOwogICAgfSk7CiAgICBjb25zdCB1cmwgPSBwcmVmaXggKyAiLmpzb24/aWNvbnM9IjsKICAgIHJlc3VsdCA9IGNvbmZpZy5tYXhVUkwgLSBtYXhIb3N0TGVuZ3RoIC0gY29uZmlnLnBhdGgubGVuZ3RoIC0gdXJsLmxlbmd0aDsKICB9CiAgcmV0dXJuIHJlc3VsdDsKfQpmdW5jdGlvbiBzaG91bGRBYm9ydChzdGF0dXMpIHsKICByZXR1cm4gc3RhdHVzID09PSA0MDQ7Cn0KY29uc3QgcHJlcGFyZSA9IChwcm92aWRlciwgcHJlZml4LCBpY29ucykgPT4gewogIGNvbnN0IHJlc3VsdHMgPSBbXTsKICBjb25zdCBtYXhMZW5ndGggPSBjYWxjdWxhdGVNYXhMZW5ndGgocHJvdmlkZXIsIHByZWZpeCk7CiAgY29uc3QgdHlwZSA9ICJpY29ucyI7CiAgbGV0IGl0ZW0gPSB7CiAgICB0eXBlLAogICAgcHJvdmlkZXIsCiAgICBwcmVmaXgsCiAgICBpY29uczogW10KICB9OwogIGxldCBsZW5ndGggPSAwOwogIGljb25zLmZvckVhY2goKG5hbWUsIGluZGV4KSA9PiB7CiAgICBsZW5ndGggKz0gbmFtZS5sZW5ndGggKyAxOwogICAgaWYgKGxlbmd0aCA+PSBtYXhMZW5ndGggJiYgaW5kZXggPiAwKSB7CiAgICAgIHJlc3VsdHMucHVzaChpdGVtKTsKICAgICAgaXRlbSA9IHsKICAgICAgICB0eXBlLAogICAgICAgIHByb3ZpZGVyLAogICAgICAgIHByZWZpeCwKICAgICAgICBpY29uczogW10KICAgICAgfTsKICAgICAgbGVuZ3RoID0gbmFtZS5sZW5ndGg7CiAgICB9CiAgICBpdGVtLmljb25zLnB1c2gobmFtZSk7CiAgfSk7CiAgcmVzdWx0cy5wdXNoKGl0ZW0pOwogIHJldHVybiByZXN1bHRzOwp9OwpmdW5jdGlvbiBnZXRQYXRoKHByb3ZpZGVyKSB7CiAgaWYgKHR5cGVvZiBwcm92aWRlciA9PT0gInN0cmluZyIpIHsKICAgIGNvbnN0IGNvbmZpZyA9IGdldEFQSUNvbmZpZyhwcm92aWRlcik7CiAgICBpZiAoY29uZmlnKSB7CiAgICAgIHJldHVybiBjb25maWcucGF0aDsKICAgIH0KICB9CiAgcmV0dXJuICIvIjsKfQpjb25zdCBzZW5kID0gKGhvc3QsIHBhcmFtcywgY2FsbGJhY2spID0+IHsKICBpZiAoIWZldGNoTW9kdWxlKSB7CiAgICBjYWxsYmFjaygiYWJvcnQiLCA0MjQpOwogICAgcmV0dXJuOwogIH0KICBsZXQgcGF0aCA9IGdldFBhdGgocGFyYW1zLnByb3ZpZGVyKTsKICBzd2l0Y2ggKHBhcmFtcy50eXBlKSB7CiAgICBjYXNlICJpY29ucyI6IHsKICAgICAgY29uc3QgcHJlZml4ID0gcGFyYW1zLnByZWZpeDsKICAgICAgY29uc3QgaWNvbnMgPSBwYXJhbXMuaWNvbnM7CiAgICAgIGNvbnN0IGljb25zTGlzdCA9IGljb25zLmpvaW4oIiwiKTsKICAgICAgY29uc3QgdXJsUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh7CiAgICAgICAgaWNvbnM6IGljb25zTGlzdAogICAgICB9KTsKICAgICAgcGF0aCArPSBwcmVmaXggKyAiLmpzb24/IiArIHVybFBhcmFtcy50b1N0cmluZygpOwogICAgICBicmVhazsKICAgIH0KICAgIGNhc2UgImN1c3RvbSI6IHsKICAgICAgY29uc3QgdXJpID0gcGFyYW1zLnVyaTsKICAgICAgcGF0aCArPSB1cmkuc2xpY2UoMCwgMSkgPT09ICIvIiA/IHVyaS5zbGljZSgxKSA6IHVyaTsKICAgICAgYnJlYWs7CiAgICB9CiAgICBkZWZhdWx0OgogICAgICBjYWxsYmFjaygiYWJvcnQiLCA0MDApOwogICAgICByZXR1cm47CiAgfQogIGxldCBkZWZhdWx0RXJyb3IgPSA1MDM7CiAgZmV0Y2hNb2R1bGUoaG9zdCArIHBhdGgpLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICBjb25zdCBzdGF0dXMgPSByZXNwb25zZS5zdGF0dXM7CiAgICBpZiAoc3RhdHVzICE9PSAyMDApIHsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgY2FsbGJhY2soc2hvdWxkQWJvcnQoc3RhdHVzKSA/ICJhYm9ydCIgOiAibmV4dCIsIHN0YXR1cyk7CiAgICAgIH0pOwogICAgICByZXR1cm47CiAgICB9CiAgICBkZWZhdWx0RXJyb3IgPSA1MDE7CiAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpOwogIH0pLnRoZW4oKGRhdGEpID0+IHsKICAgIGlmICh0eXBlb2YgZGF0YSAhPT0gIm9iamVjdCIgfHwgZGF0YSA9PT0gbnVsbCkgewogICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICBpZiAoZGF0YSA9PT0gNDA0KSB7CiAgICAgICAgICBjYWxsYmFjaygiYWJvcnQiLCBkYXRhKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2FsbGJhY2soIm5leHQiLCBkZWZhdWx0RXJyb3IpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICBjYWxsYmFjaygic3VjY2VzcyIsIGRhdGEpOwogICAgfSk7CiAgfSkuY2F0Y2goKCkgPT4gewogICAgY2FsbGJhY2soIm5leHQiLCBkZWZhdWx0RXJyb3IpOwogIH0pOwp9Owpjb25zdCBmZXRjaEFQSU1vZHVsZSA9IHsKICBwcmVwYXJlLAogIHNlbmQKfTsKCmZ1bmN0aW9uIHNvcnRJY29ucyhpY29ucykgewogIGNvbnN0IHJlc3VsdCA9IHsKICAgIGxvYWRlZDogW10sCiAgICBtaXNzaW5nOiBbXSwKICAgIHBlbmRpbmc6IFtdCiAgfTsKICBjb25zdCBzdG9yYWdlID0gLyogQF9fUFVSRV9fICovIE9iamVjdC5jcmVhdGUobnVsbCk7CiAgaWNvbnMuc29ydCgoYSwgYikgPT4gewogICAgaWYgKGEucHJvdmlkZXIgIT09IGIucHJvdmlkZXIpIHsKICAgICAgcmV0dXJuIGEucHJvdmlkZXIubG9jYWxlQ29tcGFyZShiLnByb3ZpZGVyKTsKICAgIH0KICAgIGlmIChhLnByZWZpeCAhPT0gYi5wcmVmaXgpIHsKICAgICAgcmV0dXJuIGEucHJlZml4LmxvY2FsZUNvbXBhcmUoYi5wcmVmaXgpOwogICAgfQogICAgcmV0dXJuIGEubmFtZS5sb2NhbGVDb21wYXJlKGIubmFtZSk7CiAgfSk7CiAgbGV0IGxhc3RJY29uID0gewogICAgcHJvdmlkZXI6ICIiLAogICAgcHJlZml4OiAiIiwKICAgIG5hbWU6ICIiCiAgfTsKICBpY29ucy5mb3JFYWNoKChpY29uKSA9PiB7CiAgICBpZiAobGFzdEljb24ubmFtZSA9PT0gaWNvbi5uYW1lICYmIGxhc3RJY29uLnByZWZpeCA9PT0gaWNvbi5wcmVmaXggJiYgbGFzdEljb24ucHJvdmlkZXIgPT09IGljb24ucHJvdmlkZXIpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGFzdEljb24gPSBpY29uOwogICAgY29uc3QgcHJvdmlkZXIgPSBpY29uLnByb3ZpZGVyOwogICAgY29uc3QgcHJlZml4ID0gaWNvbi5wcmVmaXg7CiAgICBjb25zdCBuYW1lID0gaWNvbi5uYW1lOwogICAgY29uc3QgcHJvdmlkZXJTdG9yYWdlID0gc3RvcmFnZVtwcm92aWRlcl0gfHwgKHN0b3JhZ2VbcHJvdmlkZXJdID0gLyogQF9fUFVSRV9fICovIE9iamVjdC5jcmVhdGUobnVsbCkpOwogICAgY29uc3QgbG9jYWxTdG9yYWdlID0gcHJvdmlkZXJTdG9yYWdlW3ByZWZpeF0gfHwgKHByb3ZpZGVyU3RvcmFnZVtwcmVmaXhdID0gZ2V0U3RvcmFnZShwcm92aWRlciwgcHJlZml4KSk7CiAgICBsZXQgbGlzdDsKICAgIGlmIChuYW1lIGluIGxvY2FsU3RvcmFnZS5pY29ucykgewogICAgICBsaXN0ID0gcmVzdWx0LmxvYWRlZDsKICAgIH0gZWxzZSBpZiAocHJlZml4ID09PSAiIiB8fCBsb2NhbFN0b3JhZ2UubWlzc2luZy5oYXMobmFtZSkpIHsKICAgICAgbGlzdCA9IHJlc3VsdC5taXNzaW5nOwogICAgfSBlbHNlIHsKICAgICAgbGlzdCA9IHJlc3VsdC5wZW5kaW5nOwogICAgfQogICAgY29uc3QgaXRlbSA9IHsKICAgICAgcHJvdmlkZXIsCiAgICAgIHByZWZpeCwKICAgICAgbmFtZQogICAgfTsKICAgIGxpc3QucHVzaChpdGVtKTsKICB9KTsKICByZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiByZW1vdmVDYWxsYmFjayhzdG9yYWdlcywgaWQpIHsKICBzdG9yYWdlcy5mb3JFYWNoKChzdG9yYWdlKSA9PiB7CiAgICBjb25zdCBpdGVtcyA9IHN0b3JhZ2UubG9hZGVyQ2FsbGJhY2tzOwogICAgaWYgKGl0ZW1zKSB7CiAgICAgIHN0b3JhZ2UubG9hZGVyQ2FsbGJhY2tzID0gaXRlbXMuZmlsdGVyKChyb3cpID0+IHJvdy5pZCAhPT0gaWQpOwogICAgfQogIH0pOwp9CmZ1bmN0aW9uIHVwZGF0ZUNhbGxiYWNrcyhzdG9yYWdlKSB7CiAgaWYgKCFzdG9yYWdlLnBlbmRpbmdDYWxsYmFja3NGbGFnKSB7CiAgICBzdG9yYWdlLnBlbmRpbmdDYWxsYmFja3NGbGFnID0gdHJ1ZTsKICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICBzdG9yYWdlLnBlbmRpbmdDYWxsYmFja3NGbGFnID0gZmFsc2U7CiAgICAgIGNvbnN0IGl0ZW1zID0gc3RvcmFnZS5sb2FkZXJDYWxsYmFja3MgPyBzdG9yYWdlLmxvYWRlckNhbGxiYWNrcy5zbGljZSgwKSA6IFtdOwogICAgICBpZiAoIWl0ZW1zLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBsZXQgaGFzUGVuZGluZyA9IGZhbHNlOwogICAgICBjb25zdCBwcm92aWRlciA9IHN0b3JhZ2UucHJvdmlkZXI7CiAgICAgIGNvbnN0IHByZWZpeCA9IHN0b3JhZ2UucHJlZml4OwogICAgICBpdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7CiAgICAgICAgY29uc3QgaWNvbnMgPSBpdGVtLmljb25zOwogICAgICAgIGNvbnN0IG9sZExlbmd0aCA9IGljb25zLnBlbmRpbmcubGVuZ3RoOwogICAgICAgIGljb25zLnBlbmRpbmcgPSBpY29ucy5wZW5kaW5nLmZpbHRlcigoaWNvbikgPT4gewogICAgICAgICAgaWYgKGljb24ucHJlZml4ICE9PSBwcmVmaXgpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBuYW1lID0gaWNvbi5uYW1lOwogICAgICAgICAgaWYgKHN0b3JhZ2UuaWNvbnNbbmFtZV0pIHsKICAgICAgICAgICAgaWNvbnMubG9hZGVkLnB1c2goewogICAgICAgICAgICAgIHByb3ZpZGVyLAogICAgICAgICAgICAgIHByZWZpeCwKICAgICAgICAgICAgICBuYW1lCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChzdG9yYWdlLm1pc3NpbmcuaGFzKG5hbWUpKSB7CiAgICAgICAgICAgIGljb25zLm1pc3NpbmcucHVzaCh7CiAgICAgICAgICAgICAgcHJvdmlkZXIsCiAgICAgICAgICAgICAgcHJlZml4LAogICAgICAgICAgICAgIG5hbWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBoYXNQZW5kaW5nID0gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSk7CiAgICAgICAgaWYgKGljb25zLnBlbmRpbmcubGVuZ3RoICE9PSBvbGRMZW5ndGgpIHsKICAgICAgICAgIGlmICghaGFzUGVuZGluZykgewogICAgICAgICAgICByZW1vdmVDYWxsYmFjayhbc3RvcmFnZV0sIGl0ZW0uaWQpOwogICAgICAgICAgfQogICAgICAgICAgaXRlbS5jYWxsYmFjaygKICAgICAgICAgICAgaWNvbnMubG9hZGVkLnNsaWNlKDApLAogICAgICAgICAgICBpY29ucy5taXNzaW5nLnNsaWNlKDApLAogICAgICAgICAgICBpY29ucy5wZW5kaW5nLnNsaWNlKDApLAogICAgICAgICAgICBpdGVtLmFib3J0CiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICB9Cn0KbGV0IGlkQ291bnRlciA9IDA7CmZ1bmN0aW9uIHN0b3JlQ2FsbGJhY2soY2FsbGJhY2ssIGljb25zLCBwZW5kaW5nU291cmNlcykgewogIGNvbnN0IGlkID0gaWRDb3VudGVyKys7CiAgY29uc3QgYWJvcnQgPSByZW1vdmVDYWxsYmFjay5iaW5kKG51bGwsIHBlbmRpbmdTb3VyY2VzLCBpZCk7CiAgaWYgKCFpY29ucy5wZW5kaW5nLmxlbmd0aCkgewogICAgcmV0dXJuIGFib3J0OwogIH0KICBjb25zdCBpdGVtID0gewogICAgaWQsCiAgICBpY29ucywKICAgIGNhbGxiYWNrLAogICAgYWJvcnQKICB9OwogIHBlbmRpbmdTb3VyY2VzLmZvckVhY2goKHN0b3JhZ2UpID0+IHsKICAgIChzdG9yYWdlLmxvYWRlckNhbGxiYWNrcyB8fCAoc3RvcmFnZS5sb2FkZXJDYWxsYmFja3MgPSBbXSkpLnB1c2goaXRlbSk7CiAgfSk7CiAgcmV0dXJuIGFib3J0Owp9CgpmdW5jdGlvbiBsaXN0VG9JY29ucyhsaXN0LCB2YWxpZGF0ZSA9IHRydWUsIHNpbXBsZU5hbWVzID0gZmFsc2UpIHsKICBjb25zdCByZXN1bHQgPSBbXTsKICBsaXN0LmZvckVhY2goKGl0ZW0pID0+IHsKICAgIGNvbnN0IGljb24gPSB0eXBlb2YgaXRlbSA9PT0gInN0cmluZyIgPyBzdHJpbmdUb0ljb24oaXRlbSwgdmFsaWRhdGUsIHNpbXBsZU5hbWVzKSA6IGl0ZW07CiAgICBpZiAoaWNvbikgewogICAgICByZXN1bHQucHVzaChpY29uKTsKICAgIH0KICB9KTsKICByZXR1cm4gcmVzdWx0Owp9CgovLyBzcmMvY29uZmlnLnRzCnZhciBkZWZhdWx0Q29uZmlnID0gewogIHJlc291cmNlczogW10sCiAgaW5kZXg6IDAsCiAgdGltZW91dDogMmUzLAogIHJvdGF0ZTogNzUwLAogIHJhbmRvbTogZmFsc2UsCiAgZGF0YUFmdGVyVGltZW91dDogZmFsc2UKfTsKCi8vIHNyYy9xdWVyeS50cwpmdW5jdGlvbiBzZW5kUXVlcnkoY29uZmlnLCBwYXlsb2FkLCBxdWVyeSwgZG9uZSkgewogIGNvbnN0IHJlc291cmNlc0NvdW50ID0gY29uZmlnLnJlc291cmNlcy5sZW5ndGg7CiAgY29uc3Qgc3RhcnRJbmRleCA9IGNvbmZpZy5yYW5kb20gPyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiByZXNvdXJjZXNDb3VudCkgOiBjb25maWcuaW5kZXg7CiAgbGV0IHJlc291cmNlczsKICBpZiAoY29uZmlnLnJhbmRvbSkgewogICAgbGV0IGxpc3QgPSBjb25maWcucmVzb3VyY2VzLnNsaWNlKDApOwogICAgcmVzb3VyY2VzID0gW107CiAgICB3aGlsZSAobGlzdC5sZW5ndGggPiAxKSB7CiAgICAgIGNvbnN0IG5leHRJbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGxpc3QubGVuZ3RoKTsKICAgICAgcmVzb3VyY2VzLnB1c2gobGlzdFtuZXh0SW5kZXhdKTsKICAgICAgbGlzdCA9IGxpc3Quc2xpY2UoMCwgbmV4dEluZGV4KS5jb25jYXQobGlzdC5zbGljZShuZXh0SW5kZXggKyAxKSk7CiAgICB9CiAgICByZXNvdXJjZXMgPSByZXNvdXJjZXMuY29uY2F0KGxpc3QpOwogIH0gZWxzZSB7CiAgICByZXNvdXJjZXMgPSBjb25maWcucmVzb3VyY2VzLnNsaWNlKHN0YXJ0SW5kZXgpLmNvbmNhdChjb25maWcucmVzb3VyY2VzLnNsaWNlKDAsIHN0YXJ0SW5kZXgpKTsKICB9CiAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTsKICBsZXQgc3RhdHVzID0gInBlbmRpbmciOwogIGxldCBxdWVyaWVzU2VudCA9IDA7CiAgbGV0IGxhc3RFcnJvcjsKICBsZXQgdGltZXIgPSBudWxsOwogIGxldCBxdWV1ZSA9IFtdOwogIGxldCBkb25lQ2FsbGJhY2tzID0gW107CiAgaWYgKHR5cGVvZiBkb25lID09PSAiZnVuY3Rpb24iKSB7CiAgICBkb25lQ2FsbGJhY2tzLnB1c2goZG9uZSk7CiAgfQogIGZ1bmN0aW9uIHJlc2V0VGltZXIoKSB7CiAgICBpZiAodGltZXIpIHsKICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTsKICAgICAgdGltZXIgPSBudWxsOwogICAgfQogIH0KICBmdW5jdGlvbiBhYm9ydCgpIHsKICAgIGlmIChzdGF0dXMgPT09ICJwZW5kaW5nIikgewogICAgICBzdGF0dXMgPSAiYWJvcnRlZCI7CiAgICB9CiAgICByZXNldFRpbWVyKCk7CiAgICBxdWV1ZS5mb3JFYWNoKChpdGVtKSA9PiB7CiAgICAgIGlmIChpdGVtLnN0YXR1cyA9PT0gInBlbmRpbmciKSB7CiAgICAgICAgaXRlbS5zdGF0dXMgPSAiYWJvcnRlZCI7CiAgICAgIH0KICAgIH0pOwogICAgcXVldWUgPSBbXTsKICB9CiAgZnVuY3Rpb24gc3Vic2NyaWJlKGNhbGxiYWNrLCBvdmVyd3JpdGUpIHsKICAgIGlmIChvdmVyd3JpdGUpIHsKICAgICAgZG9uZUNhbGxiYWNrcyA9IFtdOwogICAgfQogICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gImZ1bmN0aW9uIikgewogICAgICBkb25lQ2FsbGJhY2tzLnB1c2goY2FsbGJhY2spOwogICAgfQogIH0KICBmdW5jdGlvbiBnZXRRdWVyeVN0YXR1cygpIHsKICAgIHJldHVybiB7CiAgICAgIHN0YXJ0VGltZSwKICAgICAgcGF5bG9hZCwKICAgICAgc3RhdHVzLAogICAgICBxdWVyaWVzU2VudCwKICAgICAgcXVlcmllc1BlbmRpbmc6IHF1ZXVlLmxlbmd0aCwKICAgICAgc3Vic2NyaWJlLAogICAgICBhYm9ydAogICAgfTsKICB9CiAgZnVuY3Rpb24gZmFpbFF1ZXJ5KCkgewogICAgc3RhdHVzID0gImZhaWxlZCI7CiAgICBkb25lQ2FsbGJhY2tzLmZvckVhY2goKGNhbGxiYWNrKSA9PiB7CiAgICAgIGNhbGxiYWNrKHZvaWQgMCwgbGFzdEVycm9yKTsKICAgIH0pOwogIH0KICBmdW5jdGlvbiBjbGVhclF1ZXVlKCkgewogICAgcXVldWUuZm9yRWFjaCgoaXRlbSkgPT4gewogICAgICBpZiAoaXRlbS5zdGF0dXMgPT09ICJwZW5kaW5nIikgewogICAgICAgIGl0ZW0uc3RhdHVzID0gImFib3J0ZWQiOwogICAgICB9CiAgICB9KTsKICAgIHF1ZXVlID0gW107CiAgfQogIGZ1bmN0aW9uIG1vZHVsZVJlc3BvbnNlKGl0ZW0sIHJlc3BvbnNlLCBkYXRhKSB7CiAgICBjb25zdCBpc0Vycm9yID0gcmVzcG9uc2UgIT09ICJzdWNjZXNzIjsKICAgIHF1ZXVlID0gcXVldWUuZmlsdGVyKChxdWV1ZWQpID0+IHF1ZXVlZCAhPT0gaXRlbSk7CiAgICBzd2l0Y2ggKHN0YXR1cykgewogICAgICBjYXNlICJwZW5kaW5nIjoKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiZmFpbGVkIjoKICAgICAgICBpZiAoaXNFcnJvciB8fCAhY29uZmlnLmRhdGFBZnRlclRpbWVvdXQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHJlc3BvbnNlID09PSAiYWJvcnQiKSB7CiAgICAgIGxhc3RFcnJvciA9IGRhdGE7CiAgICAgIGZhaWxRdWVyeSgpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoaXNFcnJvcikgewogICAgICBsYXN0RXJyb3IgPSBkYXRhOwogICAgICBpZiAoIXF1ZXVlLmxlbmd0aCkgewogICAgICAgIGlmICghcmVzb3VyY2VzLmxlbmd0aCkgewogICAgICAgICAgZmFpbFF1ZXJ5KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGV4ZWNOZXh0KCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIHJlc2V0VGltZXIoKTsKICAgIGNsZWFyUXVldWUoKTsKICAgIGlmICghY29uZmlnLnJhbmRvbSkgewogICAgICBjb25zdCBpbmRleCA9IGNvbmZpZy5yZXNvdXJjZXMuaW5kZXhPZihpdGVtLnJlc291cmNlKTsKICAgICAgaWYgKGluZGV4ICE9PSAtMSAmJiBpbmRleCAhPT0gY29uZmlnLmluZGV4KSB7CiAgICAgICAgY29uZmlnLmluZGV4ID0gaW5kZXg7CiAgICAgIH0KICAgIH0KICAgIHN0YXR1cyA9ICJjb21wbGV0ZWQiOwogICAgZG9uZUNhbGxiYWNrcy5mb3JFYWNoKChjYWxsYmFjaykgPT4gewogICAgICBjYWxsYmFjayhkYXRhKTsKICAgIH0pOwogIH0KICBmdW5jdGlvbiBleGVjTmV4dCgpIHsKICAgIGlmIChzdGF0dXMgIT09ICJwZW5kaW5nIikgewogICAgICByZXR1cm47CiAgICB9CiAgICByZXNldFRpbWVyKCk7CiAgICBjb25zdCByZXNvdXJjZSA9IHJlc291cmNlcy5zaGlmdCgpOwogICAgaWYgKHJlc291cmNlID09PSB2b2lkIDApIHsKICAgICAgaWYgKHF1ZXVlLmxlbmd0aCkgewogICAgICAgIHRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICByZXNldFRpbWVyKCk7CiAgICAgICAgICBpZiAoc3RhdHVzID09PSAicGVuZGluZyIpIHsKICAgICAgICAgICAgY2xlYXJRdWV1ZSgpOwogICAgICAgICAgICBmYWlsUXVlcnkoKTsKICAgICAgICAgIH0KICAgICAgICB9LCBjb25maWcudGltZW91dCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGZhaWxRdWVyeSgpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBpdGVtID0gewogICAgICBzdGF0dXM6ICJwZW5kaW5nIiwKICAgICAgcmVzb3VyY2UsCiAgICAgIGNhbGxiYWNrOiAoc3RhdHVzMiwgZGF0YSkgPT4gewogICAgICAgIG1vZHVsZVJlc3BvbnNlKGl0ZW0sIHN0YXR1czIsIGRhdGEpOwogICAgICB9CiAgICB9OwogICAgcXVldWUucHVzaChpdGVtKTsKICAgIHF1ZXJpZXNTZW50Kys7CiAgICB0aW1lciA9IHNldFRpbWVvdXQoZXhlY05leHQsIGNvbmZpZy5yb3RhdGUpOwogICAgcXVlcnkocmVzb3VyY2UsIHBheWxvYWQsIGl0ZW0uY2FsbGJhY2spOwogIH0KICBzZXRUaW1lb3V0KGV4ZWNOZXh0KTsKICByZXR1cm4gZ2V0UXVlcnlTdGF0dXM7Cn0KCi8vIHNyYy9pbmRleC50cwpmdW5jdGlvbiBpbml0UmVkdW5kYW5jeShjZmcpIHsKICBjb25zdCBjb25maWcgPSB7CiAgICAuLi5kZWZhdWx0Q29uZmlnLAogICAgLi4uY2ZnCiAgfTsKICBsZXQgcXVlcmllcyA9IFtdOwogIGZ1bmN0aW9uIGNsZWFudXAoKSB7CiAgICBxdWVyaWVzID0gcXVlcmllcy5maWx0ZXIoKGl0ZW0pID0+IGl0ZW0oKS5zdGF0dXMgPT09ICJwZW5kaW5nIik7CiAgfQogIGZ1bmN0aW9uIHF1ZXJ5KHBheWxvYWQsIHF1ZXJ5Q2FsbGJhY2ssIGRvbmVDYWxsYmFjaykgewogICAgY29uc3QgcXVlcnkyID0gc2VuZFF1ZXJ5KAogICAgICBjb25maWcsCiAgICAgIHBheWxvYWQsCiAgICAgIHF1ZXJ5Q2FsbGJhY2ssCiAgICAgIChkYXRhLCBlcnJvcikgPT4gewogICAgICAgIGNsZWFudXAoKTsKICAgICAgICBpZiAoZG9uZUNhbGxiYWNrKSB7CiAgICAgICAgICBkb25lQ2FsbGJhY2soZGF0YSwgZXJyb3IpOwogICAgICAgIH0KICAgICAgfQogICAgKTsKICAgIHF1ZXJpZXMucHVzaChxdWVyeTIpOwogICAgcmV0dXJuIHF1ZXJ5MjsKICB9CiAgZnVuY3Rpb24gZmluZChjYWxsYmFjaykgewogICAgcmV0dXJuIHF1ZXJpZXMuZmluZCgodmFsdWUpID0+IHsKICAgICAgcmV0dXJuIGNhbGxiYWNrKHZhbHVlKTsKICAgIH0pIHx8IG51bGw7CiAgfQogIGNvbnN0IGluc3RhbmNlID0gewogICAgcXVlcnksCiAgICBmaW5kLAogICAgc2V0SW5kZXg6IChpbmRleCkgPT4gewogICAgICBjb25maWcuaW5kZXggPSBpbmRleDsKICAgIH0sCiAgICBnZXRJbmRleDogKCkgPT4gY29uZmlnLmluZGV4LAogICAgY2xlYW51cAogIH07CiAgcmV0dXJuIGluc3RhbmNlOwp9CgpmdW5jdGlvbiBlbXB0eUNhbGxiYWNrJDEoKSB7Cn0KY29uc3QgcmVkdW5kYW5jeUNhY2hlID0gLyogQF9fUFVSRV9fICovIE9iamVjdC5jcmVhdGUobnVsbCk7CmZ1bmN0aW9uIGdldFJlZHVuZGFuY3lDYWNoZShwcm92aWRlcikgewogIGlmICghcmVkdW5kYW5jeUNhY2hlW3Byb3ZpZGVyXSkgewogICAgY29uc3QgY29uZmlnID0gZ2V0QVBJQ29uZmlnKHByb3ZpZGVyKTsKICAgIGlmICghY29uZmlnKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHJlZHVuZGFuY3kgPSBpbml0UmVkdW5kYW5jeShjb25maWcpOwogICAgY29uc3QgY2FjaGVkUmV1bmRhbmN5ID0gewogICAgICBjb25maWcsCiAgICAgIHJlZHVuZGFuY3kKICAgIH07CiAgICByZWR1bmRhbmN5Q2FjaGVbcHJvdmlkZXJdID0gY2FjaGVkUmV1bmRhbmN5OwogIH0KICByZXR1cm4gcmVkdW5kYW5jeUNhY2hlW3Byb3ZpZGVyXTsKfQpmdW5jdGlvbiBzZW5kQVBJUXVlcnkodGFyZ2V0LCBxdWVyeSwgY2FsbGJhY2spIHsKICBsZXQgcmVkdW5kYW5jeTsKICBsZXQgc2VuZDsKICBpZiAodHlwZW9mIHRhcmdldCA9PT0gInN0cmluZyIpIHsKICAgIGNvbnN0IGFwaSA9IGdldEFQSU1vZHVsZSh0YXJnZXQpOwogICAgaWYgKCFhcGkpIHsKICAgICAgY2FsbGJhY2sodm9pZCAwLCA0MjQpOwogICAgICByZXR1cm4gZW1wdHlDYWxsYmFjayQxOwogICAgfQogICAgc2VuZCA9IGFwaS5zZW5kOwogICAgY29uc3QgY2FjaGVkID0gZ2V0UmVkdW5kYW5jeUNhY2hlKHRhcmdldCk7CiAgICBpZiAoY2FjaGVkKSB7CiAgICAgIHJlZHVuZGFuY3kgPSBjYWNoZWQucmVkdW5kYW5jeTsKICAgIH0KICB9IGVsc2UgewogICAgY29uc3QgY29uZmlnID0gY3JlYXRlQVBJQ29uZmlnKHRhcmdldCk7CiAgICBpZiAoY29uZmlnKSB7CiAgICAgIHJlZHVuZGFuY3kgPSBpbml0UmVkdW5kYW5jeShjb25maWcpOwogICAgICBjb25zdCBtb2R1bGVLZXkgPSB0YXJnZXQucmVzb3VyY2VzID8gdGFyZ2V0LnJlc291cmNlc1swXSA6ICIiOwogICAgICBjb25zdCBhcGkgPSBnZXRBUElNb2R1bGUobW9kdWxlS2V5KTsKICAgICAgaWYgKGFwaSkgewogICAgICAgIHNlbmQgPSBhcGkuc2VuZDsKICAgICAgfQogICAgfQogIH0KICBpZiAoIXJlZHVuZGFuY3kgfHwgIXNlbmQpIHsKICAgIGNhbGxiYWNrKHZvaWQgMCwgNDI0KTsKICAgIHJldHVybiBlbXB0eUNhbGxiYWNrJDE7CiAgfQogIHJldHVybiByZWR1bmRhbmN5LnF1ZXJ5KHF1ZXJ5LCBzZW5kLCBjYWxsYmFjaykoKS5hYm9ydDsKfQoKY29uc3QgYnJvd3NlckNhY2hlVmVyc2lvbiA9ICJpY29uaWZ5MiI7CmNvbnN0IGJyb3dzZXJDYWNoZVByZWZpeCA9ICJpY29uaWZ5IjsKY29uc3QgYnJvd3NlckNhY2hlQ291bnRLZXkgPSBicm93c2VyQ2FjaGVQcmVmaXggKyAiLWNvdW50IjsKY29uc3QgYnJvd3NlckNhY2hlVmVyc2lvbktleSA9IGJyb3dzZXJDYWNoZVByZWZpeCArICItdmVyc2lvbiI7CmNvbnN0IGJyb3dzZXJTdG9yYWdlSG91ciA9IDM2ZTU7CmNvbnN0IGJyb3dzZXJTdG9yYWdlQ2FjaGVFeHBpcmF0aW9uID0gMTY4OwoKZnVuY3Rpb24gZ2V0U3RvcmVkSXRlbShmdW5jLCBrZXkpIHsKICB0cnkgewogICAgcmV0dXJuIGZ1bmMuZ2V0SXRlbShrZXkpOwogIH0gY2F0Y2ggKGVycikgewogIH0KfQpmdW5jdGlvbiBzZXRTdG9yZWRJdGVtKGZ1bmMsIGtleSwgdmFsdWUpIHsKICB0cnkgewogICAgZnVuYy5zZXRJdGVtKGtleSwgdmFsdWUpOwogICAgcmV0dXJuIHRydWU7CiAgfSBjYXRjaCAoZXJyKSB7CiAgfQp9CmZ1bmN0aW9uIHJlbW92ZVN0b3JlZEl0ZW0oZnVuYywga2V5KSB7CiAgdHJ5IHsKICAgIGZ1bmMucmVtb3ZlSXRlbShrZXkpOwogIH0gY2F0Y2ggKGVycikgewogIH0KfQoKZnVuY3Rpb24gc2V0QnJvd3NlclN0b3JhZ2VJdGVtc0NvdW50KHN0b3JhZ2UsIHZhbHVlKSB7CiAgcmV0dXJuIHNldFN0b3JlZEl0ZW0oc3RvcmFnZSwgYnJvd3NlckNhY2hlQ291bnRLZXksIHZhbHVlLnRvU3RyaW5nKCkpOwp9CmZ1bmN0aW9uIGdldEJyb3dzZXJTdG9yYWdlSXRlbXNDb3VudChzdG9yYWdlKSB7CiAgcmV0dXJuIHBhcnNlSW50KGdldFN0b3JlZEl0ZW0oc3RvcmFnZSwgYnJvd3NlckNhY2hlQ291bnRLZXkpKSB8fCAwOwp9Cgpjb25zdCBicm93c2VyU3RvcmFnZUNvbmZpZyA9IHsKICBsb2NhbDogdHJ1ZSwKICBzZXNzaW9uOiB0cnVlCn07CmNvbnN0IGJyb3dzZXJTdG9yYWdlRW1wdHlJdGVtcyA9IHsKICBsb2NhbDogLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKSwKICBzZXNzaW9uOiAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpCn07CmxldCBicm93c2VyU3RvcmFnZVN0YXR1cyA9IGZhbHNlOwpmdW5jdGlvbiBzZXRCcm93c2VyU3RvcmFnZVN0YXR1cyhzdGF0dXMpIHsKICBicm93c2VyU3RvcmFnZVN0YXR1cyA9IHN0YXR1czsKfQoKbGV0IF93aW5kb3cgPSB0eXBlb2Ygd2luZG93ID09PSAidW5kZWZpbmVkIiA/IHt9IDogd2luZG93OwpmdW5jdGlvbiBnZXRCcm93c2VyU3RvcmFnZShrZXkpIHsKICBjb25zdCBhdHRyID0ga2V5ICsgIlN0b3JhZ2UiOwogIHRyeSB7CiAgICBpZiAoX3dpbmRvdyAmJiBfd2luZG93W2F0dHJdICYmIHR5cGVvZiBfd2luZG93W2F0dHJdLmxlbmd0aCA9PT0gIm51bWJlciIpIHsKICAgICAgcmV0dXJuIF93aW5kb3dbYXR0cl07CiAgICB9CiAgfSBjYXRjaCAoZXJyKSB7CiAgfQogIGJyb3dzZXJTdG9yYWdlQ29uZmlnW2tleV0gPSBmYWxzZTsKfQoKZnVuY3Rpb24gaXRlcmF0ZUJyb3dzZXJTdG9yYWdlKGtleSwgY2FsbGJhY2spIHsKICBjb25zdCBmdW5jID0gZ2V0QnJvd3NlclN0b3JhZ2Uoa2V5KTsKICBpZiAoIWZ1bmMpIHsKICAgIHJldHVybjsKICB9CiAgY29uc3QgdmVyc2lvbiA9IGdldFN0b3JlZEl0ZW0oZnVuYywgYnJvd3NlckNhY2hlVmVyc2lvbktleSk7CiAgaWYgKHZlcnNpb24gIT09IGJyb3dzZXJDYWNoZVZlcnNpb24pIHsKICAgIGlmICh2ZXJzaW9uKSB7CiAgICAgIGNvbnN0IHRvdGFsMiA9IGdldEJyb3dzZXJTdG9yYWdlSXRlbXNDb3VudChmdW5jKTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3RhbDI7IGkrKykgewogICAgICAgIHJlbW92ZVN0b3JlZEl0ZW0oZnVuYywgYnJvd3NlckNhY2hlUHJlZml4ICsgaS50b1N0cmluZygpKTsKICAgICAgfQogICAgfQogICAgc2V0U3RvcmVkSXRlbShmdW5jLCBicm93c2VyQ2FjaGVWZXJzaW9uS2V5LCBicm93c2VyQ2FjaGVWZXJzaW9uKTsKICAgIHNldEJyb3dzZXJTdG9yYWdlSXRlbXNDb3VudChmdW5jLCAwKTsKICAgIHJldHVybjsKICB9CiAgY29uc3QgbWluVGltZSA9IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIGJyb3dzZXJTdG9yYWdlSG91cikgLSBicm93c2VyU3RvcmFnZUNhY2hlRXhwaXJhdGlvbjsKICBjb25zdCBwYXJzZUl0ZW0gPSAoaW5kZXgpID0+IHsKICAgIGNvbnN0IG5hbWUgPSBicm93c2VyQ2FjaGVQcmVmaXggKyBpbmRleC50b1N0cmluZygpOwogICAgY29uc3QgaXRlbSA9IGdldFN0b3JlZEl0ZW0oZnVuYywgbmFtZSk7CiAgICBpZiAodHlwZW9mIGl0ZW0gIT09ICJzdHJpbmciKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRyeSB7CiAgICAgIGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKGl0ZW0pOwogICAgICBpZiAodHlwZW9mIGRhdGEgPT09ICJvYmplY3QiICYmIHR5cGVvZiBkYXRhLmNhY2hlZCA9PT0gIm51bWJlciIgJiYgZGF0YS5jYWNoZWQgPiBtaW5UaW1lICYmIHR5cGVvZiBkYXRhLnByb3ZpZGVyID09PSAic3RyaW5nIiAmJiB0eXBlb2YgZGF0YS5kYXRhID09PSAib2JqZWN0IiAmJiB0eXBlb2YgZGF0YS5kYXRhLnByZWZpeCA9PT0gInN0cmluZyIgJiYgLy8gVmFsaWQgaXRlbTogcnVuIGNhbGxiYWNrCiAgICAgIGNhbGxiYWNrKGRhdGEsIGluZGV4KSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9IGNhdGNoIChlcnIpIHsKICAgIH0KICAgIHJlbW92ZVN0b3JlZEl0ZW0oZnVuYywgbmFtZSk7CiAgfTsKICBsZXQgdG90YWwgPSBnZXRCcm93c2VyU3RvcmFnZUl0ZW1zQ291bnQoZnVuYyk7CiAgZm9yIChsZXQgaSA9IHRvdGFsIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgIGlmICghcGFyc2VJdGVtKGkpKSB7CiAgICAgIGlmIChpID09PSB0b3RhbCAtIDEpIHsKICAgICAgICB0b3RhbC0tOwogICAgICAgIHNldEJyb3dzZXJTdG9yYWdlSXRlbXNDb3VudChmdW5jLCB0b3RhbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYnJvd3NlclN0b3JhZ2VFbXB0eUl0ZW1zW2tleV0uYWRkKGkpOwogICAgICB9CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBpbml0QnJvd3NlclN0b3JhZ2UoKSB7CiAgaWYgKGJyb3dzZXJTdG9yYWdlU3RhdHVzKSB7CiAgICByZXR1cm47CiAgfQogIHNldEJyb3dzZXJTdG9yYWdlU3RhdHVzKHRydWUpOwogIGZvciAoY29uc3Qga2V5IGluIGJyb3dzZXJTdG9yYWdlQ29uZmlnKSB7CiAgICBpdGVyYXRlQnJvd3NlclN0b3JhZ2Uoa2V5LCAoaXRlbSkgPT4gewogICAgICBjb25zdCBpY29uU2V0ID0gaXRlbS5kYXRhOwogICAgICBjb25zdCBwcm92aWRlciA9IGl0ZW0ucHJvdmlkZXI7CiAgICAgIGNvbnN0IHByZWZpeCA9IGljb25TZXQucHJlZml4OwogICAgICBjb25zdCBzdG9yYWdlID0gZ2V0U3RvcmFnZSgKICAgICAgICBwcm92aWRlciwKICAgICAgICBwcmVmaXgKICAgICAgKTsKICAgICAgaWYgKCFhZGRJY29uU2V0KHN0b3JhZ2UsIGljb25TZXQpLmxlbmd0aCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBjb25zdCBsYXN0TW9kaWZpZWQgPSBpY29uU2V0Lmxhc3RNb2RpZmllZCB8fCAtMTsKICAgICAgc3RvcmFnZS5sYXN0TW9kaWZpZWRDYWNoZWQgPSBzdG9yYWdlLmxhc3RNb2RpZmllZENhY2hlZCA/IE1hdGgubWluKHN0b3JhZ2UubGFzdE1vZGlmaWVkQ2FjaGVkLCBsYXN0TW9kaWZpZWQpIDogbGFzdE1vZGlmaWVkOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0pOwogIH0KfQoKZnVuY3Rpb24gdXBkYXRlTGFzdE1vZGlmaWVkKHN0b3JhZ2UsIGxhc3RNb2RpZmllZCkgewogIGNvbnN0IGxhc3RWYWx1ZSA9IHN0b3JhZ2UubGFzdE1vZGlmaWVkQ2FjaGVkOwogIGlmICgKICAgIC8vIE1hdGNoZXMgb3IgbmV3ZXIKICAgIGxhc3RWYWx1ZSAmJiBsYXN0VmFsdWUgPj0gbGFzdE1vZGlmaWVkCiAgKSB7CiAgICByZXR1cm4gbGFzdFZhbHVlID09PSBsYXN0TW9kaWZpZWQ7CiAgfQogIHN0b3JhZ2UubGFzdE1vZGlmaWVkQ2FjaGVkID0gbGFzdE1vZGlmaWVkOwogIGlmIChsYXN0VmFsdWUpIHsKICAgIGZvciAoY29uc3Qga2V5IGluIGJyb3dzZXJTdG9yYWdlQ29uZmlnKSB7CiAgICAgIGl0ZXJhdGVCcm93c2VyU3RvcmFnZShrZXksIChpdGVtKSA9PiB7CiAgICAgICAgY29uc3QgaWNvblNldCA9IGl0ZW0uZGF0YTsKICAgICAgICByZXR1cm4gaXRlbS5wcm92aWRlciAhPT0gc3RvcmFnZS5wcm92aWRlciB8fCBpY29uU2V0LnByZWZpeCAhPT0gc3RvcmFnZS5wcmVmaXggfHwgaWNvblNldC5sYXN0TW9kaWZpZWQgPT09IGxhc3RNb2RpZmllZDsKICAgICAgfSk7CiAgICB9CiAgfQogIHJldHVybiB0cnVlOwp9CmZ1bmN0aW9uIHN0b3JlSW5Ccm93c2VyU3RvcmFnZShzdG9yYWdlLCBkYXRhKSB7CiAgaWYgKCFicm93c2VyU3RvcmFnZVN0YXR1cykgewogICAgaW5pdEJyb3dzZXJTdG9yYWdlKCk7CiAgfQogIGZ1bmN0aW9uIHN0b3JlKGtleSkgewogICAgbGV0IGZ1bmM7CiAgICBpZiAoIWJyb3dzZXJTdG9yYWdlQ29uZmlnW2tleV0gfHwgIShmdW5jID0gZ2V0QnJvd3NlclN0b3JhZ2Uoa2V5KSkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgc2V0ID0gYnJvd3NlclN0b3JhZ2VFbXB0eUl0ZW1zW2tleV07CiAgICBsZXQgaW5kZXg7CiAgICBpZiAoc2V0LnNpemUpIHsKICAgICAgc2V0LmRlbGV0ZShpbmRleCA9IEFycmF5LmZyb20oc2V0KS5zaGlmdCgpKTsKICAgIH0gZWxzZSB7CiAgICAgIGluZGV4ID0gZ2V0QnJvd3NlclN0b3JhZ2VJdGVtc0NvdW50KGZ1bmMpOwogICAgICBpZiAoIXNldEJyb3dzZXJTdG9yYWdlSXRlbXNDb3VudChmdW5jLCBpbmRleCArIDEpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CiAgICBjb25zdCBpdGVtID0gewogICAgICBjYWNoZWQ6IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIGJyb3dzZXJTdG9yYWdlSG91ciksCiAgICAgIHByb3ZpZGVyOiBzdG9yYWdlLnByb3ZpZGVyLAogICAgICBkYXRhCiAgICB9OwogICAgcmV0dXJuIHNldFN0b3JlZEl0ZW0oCiAgICAgIGZ1bmMsCiAgICAgIGJyb3dzZXJDYWNoZVByZWZpeCArIGluZGV4LnRvU3RyaW5nKCksCiAgICAgIEpTT04uc3RyaW5naWZ5KGl0ZW0pCiAgICApOwogIH0KICBpZiAoZGF0YS5sYXN0TW9kaWZpZWQgJiYgIXVwZGF0ZUxhc3RNb2RpZmllZChzdG9yYWdlLCBkYXRhLmxhc3RNb2RpZmllZCkpIHsKICAgIHJldHVybjsKICB9CiAgaWYgKCFPYmplY3Qua2V5cyhkYXRhLmljb25zKS5sZW5ndGgpIHsKICAgIHJldHVybjsKICB9CiAgaWYgKGRhdGEubm90X2ZvdW5kKSB7CiAgICBkYXRhID0gT2JqZWN0LmFzc2lnbih7fSwgZGF0YSk7CiAgICBkZWxldGUgZGF0YS5ub3RfZm91bmQ7CiAgfQogIGlmICghc3RvcmUoImxvY2FsIikpIHsKICAgIHN0b3JlKCJzZXNzaW9uIik7CiAgfQp9CgpmdW5jdGlvbiBlbXB0eUNhbGxiYWNrKCkgewp9CmZ1bmN0aW9uIGxvYWRlZE5ld0ljb25zKHN0b3JhZ2UpIHsKICBpZiAoIXN0b3JhZ2UuaWNvbnNMb2FkZXJGbGFnKSB7CiAgICBzdG9yYWdlLmljb25zTG9hZGVyRmxhZyA9IHRydWU7CiAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgc3RvcmFnZS5pY29uc0xvYWRlckZsYWcgPSBmYWxzZTsKICAgICAgdXBkYXRlQ2FsbGJhY2tzKHN0b3JhZ2UpOwogICAgfSk7CiAgfQp9CmZ1bmN0aW9uIGxvYWROZXdJY29ucyhzdG9yYWdlLCBpY29ucykgewogIGlmICghc3RvcmFnZS5pY29uc1RvTG9hZCkgewogICAgc3RvcmFnZS5pY29uc1RvTG9hZCA9IGljb25zOwogIH0gZWxzZSB7CiAgICBzdG9yYWdlLmljb25zVG9Mb2FkID0gc3RvcmFnZS5pY29uc1RvTG9hZC5jb25jYXQoaWNvbnMpLnNvcnQoKTsKICB9CiAgaWYgKCFzdG9yYWdlLmljb25zUXVldWVGbGFnKSB7CiAgICBzdG9yYWdlLmljb25zUXVldWVGbGFnID0gdHJ1ZTsKICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICBzdG9yYWdlLmljb25zUXVldWVGbGFnID0gZmFsc2U7CiAgICAgIGNvbnN0IHsgcHJvdmlkZXIsIHByZWZpeCB9ID0gc3RvcmFnZTsKICAgICAgY29uc3QgaWNvbnMyID0gc3RvcmFnZS5pY29uc1RvTG9hZDsKICAgICAgZGVsZXRlIHN0b3JhZ2UuaWNvbnNUb0xvYWQ7CiAgICAgIGxldCBhcGk7CiAgICAgIGlmICghaWNvbnMyIHx8ICEoYXBpID0gZ2V0QVBJTW9kdWxlKHByb3ZpZGVyKSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3QgcGFyYW1zID0gYXBpLnByZXBhcmUocHJvdmlkZXIsIHByZWZpeCwgaWNvbnMyKTsKICAgICAgcGFyYW1zLmZvckVhY2goKGl0ZW0pID0+IHsKICAgICAgICBzZW5kQVBJUXVlcnkocHJvdmlkZXIsIGl0ZW0sIChkYXRhKSA9PiB7CiAgICAgICAgICBpZiAodHlwZW9mIGRhdGEgIT09ICJvYmplY3QiKSB7CiAgICAgICAgICAgIGl0ZW0uaWNvbnMuZm9yRWFjaCgobmFtZSkgPT4gewogICAgICAgICAgICAgIHN0b3JhZ2UubWlzc2luZy5hZGQobmFtZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBjb25zdCBwYXJzZWQgPSBhZGRJY29uU2V0KAogICAgICAgICAgICAgICAgc3RvcmFnZSwKICAgICAgICAgICAgICAgIGRhdGEKICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIGlmICghcGFyc2VkLmxlbmd0aCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBwZW5kaW5nID0gc3RvcmFnZS5wZW5kaW5nSWNvbnM7CiAgICAgICAgICAgICAgaWYgKHBlbmRpbmcpIHsKICAgICAgICAgICAgICAgIHBhcnNlZC5mb3JFYWNoKChuYW1lKSA9PiB7CiAgICAgICAgICAgICAgICAgIHBlbmRpbmcuZGVsZXRlKG5hbWUpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHN0b3JlSW5Ccm93c2VyU3RvcmFnZShzdG9yYWdlLCBkYXRhKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBsb2FkZWROZXdJY29ucyhzdG9yYWdlKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9KTsKICB9Cn0KY29uc3QgbG9hZEljb25zID0gKGljb25zLCBjYWxsYmFjaykgPT4gewogIGNvbnN0IGNsZWFuZWRJY29ucyA9IGxpc3RUb0ljb25zKGljb25zLCB0cnVlLCBhbGxvd1NpbXBsZU5hbWVzKCkpOwogIGNvbnN0IHNvcnRlZEljb25zID0gc29ydEljb25zKGNsZWFuZWRJY29ucyk7CiAgaWYgKCFzb3J0ZWRJY29ucy5wZW5kaW5nLmxlbmd0aCkgewogICAgbGV0IGNhbGxDYWxsYmFjayA9IHRydWU7CiAgICBpZiAoY2FsbGJhY2spIHsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgaWYgKGNhbGxDYWxsYmFjaykgewogICAgICAgICAgY2FsbGJhY2soCiAgICAgICAgICAgIHNvcnRlZEljb25zLmxvYWRlZCwKICAgICAgICAgICAgc29ydGVkSWNvbnMubWlzc2luZywKICAgICAgICAgICAgc29ydGVkSWNvbnMucGVuZGluZywKICAgICAgICAgICAgZW1wdHlDYWxsYmFjawogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuICgpID0+IHsKICAgICAgY2FsbENhbGxiYWNrID0gZmFsc2U7CiAgICB9OwogIH0KICBjb25zdCBuZXdJY29ucyA9IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpOwogIGNvbnN0IHNvdXJjZXMgPSBbXTsKICBsZXQgbGFzdFByb3ZpZGVyLCBsYXN0UHJlZml4OwogIHNvcnRlZEljb25zLnBlbmRpbmcuZm9yRWFjaCgoaWNvbikgPT4gewogICAgY29uc3QgeyBwcm92aWRlciwgcHJlZml4IH0gPSBpY29uOwogICAgaWYgKHByZWZpeCA9PT0gbGFzdFByZWZpeCAmJiBwcm92aWRlciA9PT0gbGFzdFByb3ZpZGVyKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxhc3RQcm92aWRlciA9IHByb3ZpZGVyOwogICAgbGFzdFByZWZpeCA9IHByZWZpeDsKICAgIHNvdXJjZXMucHVzaChnZXRTdG9yYWdlKHByb3ZpZGVyLCBwcmVmaXgpKTsKICAgIGNvbnN0IHByb3ZpZGVyTmV3SWNvbnMgPSBuZXdJY29uc1twcm92aWRlcl0gfHwgKG5ld0ljb25zW3Byb3ZpZGVyXSA9IC8qIEBfX1BVUkVfXyAqLyBPYmplY3QuY3JlYXRlKG51bGwpKTsKICAgIGlmICghcHJvdmlkZXJOZXdJY29uc1twcmVmaXhdKSB7CiAgICAgIHByb3ZpZGVyTmV3SWNvbnNbcHJlZml4XSA9IFtdOwogICAgfQogIH0pOwogIHNvcnRlZEljb25zLnBlbmRpbmcuZm9yRWFjaCgoaWNvbikgPT4gewogICAgY29uc3QgeyBwcm92aWRlciwgcHJlZml4LCBuYW1lIH0gPSBpY29uOwogICAgY29uc3Qgc3RvcmFnZSA9IGdldFN0b3JhZ2UocHJvdmlkZXIsIHByZWZpeCk7CiAgICBjb25zdCBwZW5kaW5nUXVldWUgPSBzdG9yYWdlLnBlbmRpbmdJY29ucyB8fCAoc3RvcmFnZS5wZW5kaW5nSWNvbnMgPSAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpKTsKICAgIGlmICghcGVuZGluZ1F1ZXVlLmhhcyhuYW1lKSkgewogICAgICBwZW5kaW5nUXVldWUuYWRkKG5hbWUpOwogICAgICBuZXdJY29uc1twcm92aWRlcl1bcHJlZml4XS5wdXNoKG5hbWUpOwogICAgfQogIH0pOwogIHNvdXJjZXMuZm9yRWFjaCgoc3RvcmFnZSkgPT4gewogICAgY29uc3QgeyBwcm92aWRlciwgcHJlZml4IH0gPSBzdG9yYWdlOwogICAgaWYgKG5ld0ljb25zW3Byb3ZpZGVyXVtwcmVmaXhdLmxlbmd0aCkgewogICAgICBsb2FkTmV3SWNvbnMoc3RvcmFnZSwgbmV3SWNvbnNbcHJvdmlkZXJdW3ByZWZpeF0pOwogICAgfQogIH0pOwogIHJldHVybiBjYWxsYmFjayA/IHN0b3JlQ2FsbGJhY2soY2FsbGJhY2ssIHNvcnRlZEljb25zLCBzb3VyY2VzKSA6IGVtcHR5Q2FsbGJhY2s7Cn07CgpmdW5jdGlvbiBtZXJnZUN1c3RvbWlzYXRpb25zKGRlZmF1bHRzLCBpdGVtKSB7CiAgY29uc3QgcmVzdWx0ID0gewogICAgLi4uZGVmYXVsdHMKICB9OwogIGZvciAoY29uc3Qga2V5IGluIGl0ZW0pIHsKICAgIGNvbnN0IHZhbHVlID0gaXRlbVtrZXldOwogICAgY29uc3QgdmFsdWVUeXBlID0gdHlwZW9mIHZhbHVlOwogICAgaWYgKGtleSBpbiBkZWZhdWx0SWNvblNpemVDdXN0b21pc2F0aW9ucykgewogICAgICBpZiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgJiYgKHZhbHVlVHlwZSA9PT0gInN0cmluZyIgfHwgdmFsdWVUeXBlID09PSAibnVtYmVyIikpIHsKICAgICAgICByZXN1bHRba2V5XSA9IHZhbHVlOwogICAgICB9CiAgICB9IGVsc2UgaWYgKHZhbHVlVHlwZSA9PT0gdHlwZW9mIHJlc3VsdFtrZXldKSB7CiAgICAgIHJlc3VsdFtrZXldID0ga2V5ID09PSAicm90YXRlIiA/IHZhbHVlICUgNCA6IHZhbHVlOwogICAgfQogIH0KICByZXR1cm4gcmVzdWx0Owp9Cgpjb25zdCBzZXBhcmF0b3IgPSAvW1xzLF0rLzsKZnVuY3Rpb24gZmxpcEZyb21TdHJpbmcoY3VzdG9tLCBmbGlwKSB7CiAgZmxpcC5zcGxpdChzZXBhcmF0b3IpLmZvckVhY2goKHN0cikgPT4gewogICAgY29uc3QgdmFsdWUgPSBzdHIudHJpbSgpOwogICAgc3dpdGNoICh2YWx1ZSkgewogICAgICBjYXNlICJob3Jpem9udGFsIjoKICAgICAgICBjdXN0b20uaEZsaXAgPSB0cnVlOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJ2ZXJ0aWNhbCI6CiAgICAgICAgY3VzdG9tLnZGbGlwID0gdHJ1ZTsKICAgICAgICBicmVhazsKICAgIH0KICB9KTsKfQoKZnVuY3Rpb24gcm90YXRlRnJvbVN0cmluZyh2YWx1ZSwgZGVmYXVsdFZhbHVlID0gMCkgewogIGNvbnN0IHVuaXRzID0gdmFsdWUucmVwbGFjZSgvXi0/WzAtOS5dKi8sICIiKTsKICBmdW5jdGlvbiBjbGVhbnVwKHZhbHVlMikgewogICAgd2hpbGUgKHZhbHVlMiA8IDApIHsKICAgICAgdmFsdWUyICs9IDQ7CiAgICB9CiAgICByZXR1cm4gdmFsdWUyICUgNDsKICB9CiAgaWYgKHVuaXRzID09PSAiIikgewogICAgY29uc3QgbnVtID0gcGFyc2VJbnQodmFsdWUpOwogICAgcmV0dXJuIGlzTmFOKG51bSkgPyAwIDogY2xlYW51cChudW0pOwogIH0gZWxzZSBpZiAodW5pdHMgIT09IHZhbHVlKSB7CiAgICBsZXQgc3BsaXQgPSAwOwogICAgc3dpdGNoICh1bml0cykgewogICAgICBjYXNlICIlIjoKICAgICAgICBzcGxpdCA9IDI1OwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJkZWciOgogICAgICAgIHNwbGl0ID0gOTA7CiAgICB9CiAgICBpZiAoc3BsaXQpIHsKICAgICAgbGV0IG51bSA9IHBhcnNlRmxvYXQodmFsdWUuc2xpY2UoMCwgdmFsdWUubGVuZ3RoIC0gdW5pdHMubGVuZ3RoKSk7CiAgICAgIGlmIChpc05hTihudW0pKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KICAgICAgbnVtID0gbnVtIC8gc3BsaXQ7CiAgICAgIHJldHVybiBudW0gJSAxID09PSAwID8gY2xlYW51cChudW0pIDogMDsKICAgIH0KICB9CiAgcmV0dXJuIGRlZmF1bHRWYWx1ZTsKfQoKZnVuY3Rpb24gaWNvblRvSFRNTChib2R5LCBhdHRyaWJ1dGVzKSB7CiAgbGV0IHJlbmRlckF0dHJpYnNIVE1MID0gYm9keS5pbmRleE9mKCJ4bGluazoiKSA9PT0gLTEgPyAiIiA6ICcgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiJzsKICBmb3IgKGNvbnN0IGF0dHIgaW4gYXR0cmlidXRlcykgewogICAgcmVuZGVyQXR0cmlic0hUTUwgKz0gIiAiICsgYXR0ciArICc9IicgKyBhdHRyaWJ1dGVzW2F0dHJdICsgJyInOwogIH0KICByZXR1cm4gJzxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIicgKyByZW5kZXJBdHRyaWJzSFRNTCArICI+IiArIGJvZHkgKyAiPC9zdmc+IjsKfQoKZnVuY3Rpb24gZW5jb2RlU1ZHZm9yVVJMKHN2ZykgewogIHJldHVybiBzdmcucmVwbGFjZSgvIi9nLCAiJyIpLnJlcGxhY2UoLyUvZywgIiUyNSIpLnJlcGxhY2UoLyMvZywgIiUyMyIpLnJlcGxhY2UoLzwvZywgIiUzQyIpLnJlcGxhY2UoLz4vZywgIiUzRSIpLnJlcGxhY2UoL1xzKy9nLCAiICIpOwp9CmZ1bmN0aW9uIHN2Z1RvRGF0YShzdmcpIHsKICByZXR1cm4gImRhdGE6aW1hZ2Uvc3ZnK3htbCwiICsgZW5jb2RlU1ZHZm9yVVJMKHN2Zyk7Cn0KZnVuY3Rpb24gc3ZnVG9VUkwoc3ZnKSB7CiAgcmV0dXJuICd1cmwoIicgKyBzdmdUb0RhdGEoc3ZnKSArICciKSc7Cn0KCmNvbnN0IGRlZmF1bHRFeHRlbmRlZEljb25DdXN0b21pc2F0aW9ucyA9IHsKICAgIC4uLmRlZmF1bHRJY29uQ3VzdG9taXNhdGlvbnMsCiAgICBpbmxpbmU6IGZhbHNlLAp9OwoKLyoqCiAqIERlZmF1bHQgU1ZHIGF0dHJpYnV0ZXMKICovCmNvbnN0IHN2Z0RlZmF1bHRzID0gewogICAgJ3htbG5zJzogJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywKICAgICd4bWxuczp4bGluayc6ICdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rJywKICAgICdhcmlhLWhpZGRlbic6IHRydWUsCiAgICAncm9sZSc6ICdpbWcnLAp9OwovKioKICogU3R5bGUgbW9kZXMKICovCmNvbnN0IGNvbW1vblByb3BzID0gewogICAgZGlzcGxheTogJ2lubGluZS1ibG9jaycsCn07CmNvbnN0IG1vbm90b25lUHJvcHMgPSB7CiAgICAnYmFja2dyb3VuZC1jb2xvcic6ICdjdXJyZW50Q29sb3InLAp9Owpjb25zdCBjb2xvcmVkUHJvcHMgPSB7CiAgICAnYmFja2dyb3VuZC1jb2xvcic6ICd0cmFuc3BhcmVudCcsCn07Ci8vIER5bmFtaWNhbGx5IGFkZCBjb21tb24gcHJvcHMgdG8gdmFyaWFibGVzIGFib3ZlCmNvbnN0IHByb3BzVG9BZGQgPSB7CiAgICBpbWFnZTogJ3ZhcigtLXN2ZyknLAogICAgcmVwZWF0OiAnbm8tcmVwZWF0JywKICAgIHNpemU6ICcxMDAlIDEwMCUnLAp9Owpjb25zdCBwcm9wc1RvQWRkVG8gPSB7CiAgICAnLXdlYmtpdC1tYXNrJzogbW9ub3RvbmVQcm9wcywKICAgICdtYXNrJzogbW9ub3RvbmVQcm9wcywKICAgICdiYWNrZ3JvdW5kJzogY29sb3JlZFByb3BzLAp9Owpmb3IgKGNvbnN0IHByZWZpeCBpbiBwcm9wc1RvQWRkVG8pIHsKICAgIGNvbnN0IGxpc3QgPSBwcm9wc1RvQWRkVG9bcHJlZml4XTsKICAgIGZvciAoY29uc3QgcHJvcCBpbiBwcm9wc1RvQWRkKSB7CiAgICAgICAgbGlzdFtwcmVmaXggKyAnLScgKyBwcm9wXSA9IHByb3BzVG9BZGRbcHJvcF07CiAgICB9Cn0KLyoqCiAqIEZpeCBzaXplOiBhZGQgJ3B4JyB0byBudW1iZXJzCiAqLwpmdW5jdGlvbiBmaXhTaXplKHZhbHVlKSB7CiAgICByZXR1cm4gdmFsdWUgKyAodmFsdWUubWF0Y2goL15bLTAtOS5dKyQvKSA/ICdweCcgOiAnJyk7Cn0KLyoqCiAqIEdlbmVyYXRlIGljb24gZnJvbSBwcm9wZXJ0aWVzCiAqLwpmdW5jdGlvbiByZW5kZXIoCi8vIEljb24gbXVzdCBiZSB2YWxpZGF0ZWQgYmVmb3JlIGNhbGxpbmcgdGhpcyBmdW5jdGlvbgppY29uLCAKLy8gUHJvcGVydGllcwpwcm9wcykgewogICAgY29uc3QgY3VzdG9taXNhdGlvbnMgPSBtZXJnZUN1c3RvbWlzYXRpb25zKGRlZmF1bHRFeHRlbmRlZEljb25DdXN0b21pc2F0aW9ucywgcHJvcHMpOwogICAgLy8gQ2hlY2sgbW9kZQogICAgY29uc3QgbW9kZSA9IHByb3BzLm1vZGUgfHwgJ3N2Zyc7CiAgICBjb25zdCBjb21wb25lbnRQcm9wcyA9IChtb2RlID09PSAnc3ZnJyA/IHsgLi4uc3ZnRGVmYXVsdHMgfSA6IHt9KTsKICAgIGlmIChpY29uLmJvZHkuaW5kZXhPZigneGxpbms6JykgPT09IC0xKSB7CiAgICAgICAgZGVsZXRlIGNvbXBvbmVudFByb3BzWyd4bWxuczp4bGluayddOwogICAgfQogICAgLy8gQ3JlYXRlIHN0eWxlIGlmIG1pc3NpbmcKICAgIGxldCBzdHlsZSA9IHR5cGVvZiBwcm9wcy5zdHlsZSA9PT0gJ3N0cmluZycgPyBwcm9wcy5zdHlsZSA6ICcnOwogICAgLy8gR2V0IGVsZW1lbnQgcHJvcGVydGllcwogICAgZm9yIChsZXQga2V5IGluIHByb3BzKSB7CiAgICAgICAgY29uc3QgdmFsdWUgPSBwcm9wc1trZXldOwogICAgICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBzd2l0Y2ggKGtleSkgewogICAgICAgICAgICAvLyBQcm9wZXJ0aWVzIHRvIGlnbm9yZQogICAgICAgICAgICBjYXNlICdpY29uJzoKICAgICAgICAgICAgY2FzZSAnc3R5bGUnOgogICAgICAgICAgICBjYXNlICdvbkxvYWQnOgogICAgICAgICAgICBjYXNlICdtb2RlJzoKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAvLyBCb29sZWFuIGF0dHJpYnV0ZXMKICAgICAgICAgICAgY2FzZSAnaW5saW5lJzoKICAgICAgICAgICAgY2FzZSAnaEZsaXAnOgogICAgICAgICAgICBjYXNlICd2RmxpcCc6CiAgICAgICAgICAgICAgICBjdXN0b21pc2F0aW9uc1trZXldID0KICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9PT0gdHJ1ZSB8fCB2YWx1ZSA9PT0gJ3RydWUnIHx8IHZhbHVlID09PSAxOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIC8vIEZsaXAgYXMgc3RyaW5nOiAnaG9yaXpvbnRhbCx2ZXJ0aWNhbCcKICAgICAgICAgICAgY2FzZSAnZmxpcCc6CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICAgIGZsaXBGcm9tU3RyaW5nKGN1c3RvbWlzYXRpb25zLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgLy8gQ29sb3I6IGNvcHkgdG8gc3R5bGUsIGFkZCBleHRyYSAnOycgaW4gY2FzZSBzdHlsZSBpcyBtaXNzaW5nIGl0CiAgICAgICAgICAgIGNhc2UgJ2NvbG9yJzoKICAgICAgICAgICAgICAgIHN0eWxlID0KICAgICAgICAgICAgICAgICAgICBzdHlsZSArCiAgICAgICAgICAgICAgICAgICAgICAgIChzdHlsZS5sZW5ndGggPiAwICYmIHN0eWxlLnRyaW0oKS5zbGljZSgtMSkgIT09ICc7JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAnOycKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogJycpICsKICAgICAgICAgICAgICAgICAgICAgICAgJ2NvbG9yOiAnICsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgKwogICAgICAgICAgICAgICAgICAgICAgICAnOyAnOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIC8vIFJvdGF0aW9uIGFzIHN0cmluZwogICAgICAgICAgICBjYXNlICdyb3RhdGUnOgogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgICBjdXN0b21pc2F0aW9uc1trZXldID0gcm90YXRlRnJvbVN0cmluZyh2YWx1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInKSB7CiAgICAgICAgICAgICAgICAgICAgY3VzdG9taXNhdGlvbnNba2V5XSA9IHZhbHVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIC8vIFJlbW92ZSBhcmlhLWhpZGRlbgogICAgICAgICAgICBjYXNlICdhcmlhSGlkZGVuJzoKICAgICAgICAgICAgY2FzZSAnYXJpYS1oaWRkZW4nOgogICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSB0cnVlICYmIHZhbHVlICE9PSAndHJ1ZScpIHsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgY29tcG9uZW50UHJvcHNbJ2FyaWEtaGlkZGVuJ107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGlmIChrZXkuc2xpY2UoMCwgMykgPT09ICdvbjonKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gU3ZlbHRlIGV2ZW50CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBDb3B5IG1pc3NpbmcgcHJvcGVydHkgaWYgaXQgZG9lcyBub3QgZXhpc3QgaW4gY3VzdG9taXNhdGlvbnMKICAgICAgICAgICAgICAgIGlmIChkZWZhdWx0RXh0ZW5kZWRJY29uQ3VzdG9taXNhdGlvbnNba2V5XSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50UHJvcHNba2V5XSA9IHZhbHVlOwogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIC8vIEdlbmVyYXRlIGljb24KICAgIGNvbnN0IGl0ZW0gPSBpY29uVG9TVkcoaWNvbiwgY3VzdG9taXNhdGlvbnMpOwogICAgY29uc3QgcmVuZGVyQXR0cmlicyA9IGl0ZW0uYXR0cmlidXRlczsKICAgIC8vIElubGluZSBkaXNwbGF5CiAgICBpZiAoY3VzdG9taXNhdGlvbnMuaW5saW5lKSB7CiAgICAgICAgLy8gU3R5bGUgb3ZlcnJpZGVzIGl0CiAgICAgICAgc3R5bGUgPSAndmVydGljYWwtYWxpZ246IC0wLjEyNWVtOyAnICsgc3R5bGU7CiAgICB9CiAgICBpZiAobW9kZSA9PT0gJ3N2ZycpIHsKICAgICAgICAvLyBBZGQgaWNvbiBzdHVmZgogICAgICAgIE9iamVjdC5hc3NpZ24oY29tcG9uZW50UHJvcHMsIHJlbmRlckF0dHJpYnMpOwogICAgICAgIC8vIFN0eWxlCiAgICAgICAgaWYgKHN0eWxlICE9PSAnJykgewogICAgICAgICAgICBjb21wb25lbnRQcm9wcy5zdHlsZSA9IHN0eWxlOwogICAgICAgIH0KICAgICAgICAvLyBDb3VudGVyIGZvciBpZHMgYmFzZWQgb24gImlkIiBwcm9wZXJ0eSB0byByZW5kZXIgaWNvbnMgY29uc2lzdGVudGx5IG9uIHNlcnZlciBhbmQgY2xpZW50CiAgICAgICAgbGV0IGxvY2FsQ291bnRlciA9IDA7CiAgICAgICAgbGV0IGlkID0gcHJvcHMuaWQ7CiAgICAgICAgaWYgKHR5cGVvZiBpZCA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgLy8gQ29udmVydCAnLScgdG8gJ18nIHRvIGF2b2lkIGVycm9ycyBpbiBhbmltYXRpb25zCiAgICAgICAgICAgIGlkID0gaWQucmVwbGFjZSgvLS9nLCAnXycpOwogICAgICAgIH0KICAgICAgICAvLyBHZW5lcmF0ZSBIVE1MCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgc3ZnOiB0cnVlLAogICAgICAgICAgICBhdHRyaWJ1dGVzOiBjb21wb25lbnRQcm9wcywKICAgICAgICAgICAgYm9keTogcmVwbGFjZUlEcyhpdGVtLmJvZHksIGlkID8gKCkgPT4gaWQgKyAnSUQnICsgbG9jYWxDb3VudGVyKysgOiAnaWNvbmlmeVN2ZWx0ZScpLAogICAgICAgIH07CiAgICB9CiAgICAvLyBSZW5kZXIgPHNwYW4+IHdpdGggc3R5bGUKICAgIGNvbnN0IHsgYm9keSwgd2lkdGgsIGhlaWdodCB9ID0gaWNvbjsKICAgIGNvbnN0IHVzZU1hc2sgPSBtb2RlID09PSAnbWFzaycgfHwKICAgICAgICAobW9kZSA9PT0gJ2JnJyA/IGZhbHNlIDogYm9keS5pbmRleE9mKCdjdXJyZW50Q29sb3InKSAhPT0gLTEpOwogICAgLy8gR2VuZXJhdGUgU1ZHCiAgICBjb25zdCBodG1sID0gaWNvblRvSFRNTChib2R5LCB7CiAgICAgICAgLi4ucmVuZGVyQXR0cmlicywKICAgICAgICB3aWR0aDogd2lkdGggKyAnJywKICAgICAgICBoZWlnaHQ6IGhlaWdodCArICcnLAogICAgfSk7CiAgICAvLyBHZW5lcmF0ZSBzdHlsZQogICAgY29uc3QgdXJsID0gc3ZnVG9VUkwoaHRtbCk7CiAgICBjb25zdCBzdHlsZXMgPSB7CiAgICAgICAgJy0tc3ZnJzogdXJsLAogICAgfTsKICAgIGNvbnN0IHNpemUgPSAocHJvcCkgPT4gewogICAgICAgIGNvbnN0IHZhbHVlID0gcmVuZGVyQXR0cmlic1twcm9wXTsKICAgICAgICBpZiAodmFsdWUpIHsKICAgICAgICAgICAgc3R5bGVzW3Byb3BdID0gZml4U2l6ZSh2YWx1ZSk7CiAgICAgICAgfQogICAgfTsKICAgIHNpemUoJ3dpZHRoJyk7CiAgICBzaXplKCdoZWlnaHQnKTsKICAgIE9iamVjdC5hc3NpZ24oc3R5bGVzLCBjb21tb25Qcm9wcywgdXNlTWFzayA/IG1vbm90b25lUHJvcHMgOiBjb2xvcmVkUHJvcHMpOwogICAgbGV0IGN1c3RvbVN0eWxlID0gJyc7CiAgICBmb3IgKGNvbnN0IGtleSBpbiBzdHlsZXMpIHsKICAgICAgICBjdXN0b21TdHlsZSArPSBrZXkgKyAnOiAnICsgc3R5bGVzW2tleV0gKyAnOyc7CiAgICB9CiAgICBjb21wb25lbnRQcm9wcy5zdHlsZSA9IGN1c3RvbVN0eWxlICsgc3R5bGU7CiAgICByZXR1cm4gewogICAgICAgIHN2ZzogZmFsc2UsCiAgICAgICAgYXR0cmlidXRlczogY29tcG9uZW50UHJvcHMsCiAgICB9Owp9Ci8qKgogKiBJbml0aWFsaXNlIHN0dWZmCiAqLwovLyBFbmFibGUgc2hvcnQgbmFtZXMKYWxsb3dTaW1wbGVOYW1lcyh0cnVlKTsKLy8gU2V0IEFQSSBtb2R1bGUKc2V0QVBJTW9kdWxlKCcnLCBmZXRjaEFQSU1vZHVsZSk7Ci8qKgogKiBCcm93c2VyIHN0dWZmCiAqLwppZiAodHlwZW9mIGRvY3VtZW50ICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykgewogICAgLy8gU2V0IGNhY2hlIGFuZCBsb2FkIGV4aXN0aW5nIGNhY2hlCiAgICBpbml0QnJvd3NlclN0b3JhZ2UoKTsKICAgIGNvbnN0IF93aW5kb3cgPSB3aW5kb3c7CiAgICAvLyBMb2FkIGljb25zIGZyb20gZ2xvYmFsICJJY29uaWZ5UHJlbG9hZCIKICAgIGlmIChfd2luZG93Lkljb25pZnlQcmVsb2FkICE9PSB2b2lkIDApIHsKICAgICAgICBjb25zdCBwcmVsb2FkID0gX3dpbmRvdy5JY29uaWZ5UHJlbG9hZDsKICAgICAgICBjb25zdCBlcnIgPSAnSW52YWxpZCBJY29uaWZ5UHJlbG9hZCBzeW50YXguJzsKICAgICAgICBpZiAodHlwZW9mIHByZWxvYWQgPT09ICdvYmplY3QnICYmIHByZWxvYWQgIT09IG51bGwpIHsKICAgICAgICAgICAgKHByZWxvYWQgaW5zdGFuY2VvZiBBcnJheSA/IHByZWxvYWQgOiBbcHJlbG9hZF0pLmZvckVhY2goKGl0ZW0pID0+IHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIGl0ZW0gaXMgYW4gb2JqZWN0IGFuZCBub3QgbnVsbC9hcnJheQogICAgICAgICAgICAgICAgICAgIHR5cGVvZiBpdGVtICE9PSAnb2JqZWN0JyB8fAogICAgICAgICAgICAgICAgICAgICAgICBpdGVtID09PSBudWxsIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0gaW5zdGFuY2VvZiBBcnJheSB8fAogICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBmb3IgJ2ljb25zJyBhbmQgJ3ByZWZpeCcKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZW9mIGl0ZW0uaWNvbnMgIT09ICdvYmplY3QnIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVvZiBpdGVtLnByZWZpeCAhPT0gJ3N0cmluZycgfHwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGljb24gc2V0CiAgICAgICAgICAgICAgICAgICAgICAgICFhZGRDb2xsZWN0aW9uKGl0ZW0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQogICAgLy8gU2V0IEFQSSBmcm9tIGdsb2JhbCAiSWNvbmlmeVByb3ZpZGVycyIKICAgIGlmIChfd2luZG93Lkljb25pZnlQcm92aWRlcnMgIT09IHZvaWQgMCkgewogICAgICAgIGNvbnN0IHByb3ZpZGVycyA9IF93aW5kb3cuSWNvbmlmeVByb3ZpZGVyczsKICAgICAgICBpZiAodHlwZW9mIHByb3ZpZGVycyA9PT0gJ29iamVjdCcgJiYgcHJvdmlkZXJzICE9PSBudWxsKSB7CiAgICAgICAgICAgIGZvciAobGV0IGtleSBpbiBwcm92aWRlcnMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGVyciA9ICdJY29uaWZ5UHJvdmlkZXJzWycgKyBrZXkgKyAnXSBpcyBpbnZhbGlkLic7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gcHJvdmlkZXJzW2tleV07CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ29iamVjdCcgfHwKICAgICAgICAgICAgICAgICAgICAgICAgIXZhbHVlIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLnJlc291cmNlcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoIWFkZEFQSVByb3ZpZGVyKGtleSwgdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQovKioKICogQ2hlY2sgaWYgY29tcG9uZW50IG5lZWRzIHRvIGJlIHVwZGF0ZWQKICovCmZ1bmN0aW9uIGNoZWNrSWNvblN0YXRlKGljb24sIHN0YXRlLCBtb3VudGVkLCBjYWxsYmFjaywgb25sb2FkKSB7CiAgICAvLyBBYm9ydCBsb2FkaW5nIGljb24KICAgIGZ1bmN0aW9uIGFib3J0TG9hZGluZygpIHsKICAgICAgICBpZiAoc3RhdGUubG9hZGluZykgewogICAgICAgICAgICBzdGF0ZS5sb2FkaW5nLmFib3J0KCk7CiAgICAgICAgICAgIHN0YXRlLmxvYWRpbmcgPSBudWxsOwogICAgICAgIH0KICAgIH0KICAgIC8vIEljb24gaXMgYW4gb2JqZWN0CiAgICBpZiAodHlwZW9mIGljb24gPT09ICdvYmplY3QnICYmCiAgICAgICAgaWNvbiAhPT0gbnVsbCAmJgogICAgICAgIHR5cGVvZiBpY29uLmJvZHkgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgLy8gU3RvcCBsb2FkaW5nCiAgICAgICAgc3RhdGUubmFtZSA9ICcnOwogICAgICAgIGFib3J0TG9hZGluZygpOwogICAgICAgIHJldHVybiB7IGRhdGE6IHsgLi4uZGVmYXVsdEljb25Qcm9wcywgLi4uaWNvbiB9IH07CiAgICB9CiAgICAvLyBJbnZhbGlkIGljb24/CiAgICBsZXQgaWNvbk5hbWU7CiAgICBpZiAodHlwZW9mIGljb24gIT09ICdzdHJpbmcnIHx8CiAgICAgICAgKGljb25OYW1lID0gc3RyaW5nVG9JY29uKGljb24sIGZhbHNlLCB0cnVlKSkgPT09IG51bGwpIHsKICAgICAgICBhYm9ydExvYWRpbmcoKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIC8vIExvYWQgaWNvbgogICAgY29uc3QgZGF0YSA9IGdldEljb25EYXRhKGljb25OYW1lKTsKICAgIGlmICghZGF0YSkgewogICAgICAgIC8vIEljb24gZGF0YSBpcyBub3QgYXZhaWxhYmxlCiAgICAgICAgLy8gRG8gbm90IGxvYWQgaWNvbiB1bnRpbCBjb21wb25lbnQgaXMgbW91bnRlZAogICAgICAgIGlmIChtb3VudGVkICYmICghc3RhdGUubG9hZGluZyB8fCBzdGF0ZS5sb2FkaW5nLm5hbWUgIT09IGljb24pKSB7CiAgICAgICAgICAgIC8vIE5ldyBpY29uIHRvIGxvYWQKICAgICAgICAgICAgYWJvcnRMb2FkaW5nKCk7CiAgICAgICAgICAgIHN0YXRlLm5hbWUgPSAnJzsKICAgICAgICAgICAgc3RhdGUubG9hZGluZyA9IHsKICAgICAgICAgICAgICAgIG5hbWU6IGljb24sCiAgICAgICAgICAgICAgICBhYm9ydDogbG9hZEljb25zKFtpY29uTmFtZV0sIGNhbGxiYWNrKSwKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvLyBJY29uIGRhdGEgaXMgYXZhaWxhYmxlCiAgICBhYm9ydExvYWRpbmcoKTsKICAgIGlmIChzdGF0ZS5uYW1lICE9PSBpY29uKSB7CiAgICAgICAgc3RhdGUubmFtZSA9IGljb247CiAgICAgICAgaWYgKG9ubG9hZCAmJiAhc3RhdGUuZGVzdHJveWVkKSB7CiAgICAgICAgICAgIG9ubG9hZChpY29uKTsKICAgICAgICB9CiAgICB9CiAgICAvLyBBZGQgY2xhc3NlcwogICAgY29uc3QgY2xhc3NlcyA9IFsnaWNvbmlmeSddOwogICAgaWYgKGljb25OYW1lLnByZWZpeCAhPT0gJycpIHsKICAgICAgICBjbGFzc2VzLnB1c2goJ2ljb25pZnktLScgKyBpY29uTmFtZS5wcmVmaXgpOwogICAgfQogICAgaWYgKGljb25OYW1lLnByb3ZpZGVyICE9PSAnJykgewogICAgICAgIGNsYXNzZXMucHVzaCgnaWNvbmlmeS0tJyArIGljb25OYW1lLnByb3ZpZGVyKTsKICAgIH0KICAgIHJldHVybiB7IGRhdGEsIGNsYXNzZXMgfTsKfQovKioKICogR2VuZXJhdGUgaWNvbgogKi8KZnVuY3Rpb24gZ2VuZXJhdGVJY29uKGljb24sIHByb3BzKSB7CiAgICByZXR1cm4gaWNvbgogICAgICAgID8gcmVuZGVyKHsKICAgICAgICAgICAgLi4uZGVmYXVsdEljb25Qcm9wcywKICAgICAgICAgICAgLi4uaWNvbiwKICAgICAgICB9LCBwcm9wcykKICAgICAgICA6IG51bGw7Cn0KCi8qIGhvbWUvY2UvRG9jdW1lbnRzL0dpdEh1Yi9hZHJpZnQvbm9kZV9tb2R1bGVzLy5wbnBtL0BpY29uaWZ5K3N2ZWx0ZUAzLjEuNF9zdmVsdGVANC4yLjAvbm9kZV9tb2R1bGVzL0BpY29uaWZ5L3N2ZWx0ZS9kaXN0L0ljb24uc3ZlbHRlIGdlbmVyYXRlZCBieSBTdmVsdGUgdjQuMi4wICovCgpmdW5jdGlvbiBjcmVhdGVfaWZfYmxvY2skNChjdHgpIHsKCWxldCBpZl9ibG9ja19hbmNob3I7CgoJZnVuY3Rpb24gc2VsZWN0X2Jsb2NrX3R5cGUoY3R4LCBkaXJ0eSkgewoJCWlmICgvKmRhdGEqLyBjdHhbMF0uc3ZnKSByZXR1cm4gY3JlYXRlX2lmX2Jsb2NrXzEkMzsKCQlyZXR1cm4gY3JlYXRlX2Vsc2VfYmxvY2skMTsKCX0KCglsZXQgY3VycmVudF9ibG9ja190eXBlID0gc2VsZWN0X2Jsb2NrX3R5cGUoY3R4KTsKCWxldCBpZl9ibG9jayA9IGN1cnJlbnRfYmxvY2tfdHlwZShjdHgpOwoKCXJldHVybiB7CgkJYygpIHsKCQkJaWZfYmxvY2suYygpOwoJCQlpZl9ibG9ja19hbmNob3IgPSBlbXB0eSgpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpZl9ibG9jay5tKHRhcmdldCwgYW5jaG9yKTsKCQkJaW5zZXJ0KHRhcmdldCwgaWZfYmxvY2tfYW5jaG9yLCBhbmNob3IpOwoJCX0sCgkJcChjdHgsIGRpcnR5KSB7CgkJCWlmIChjdXJyZW50X2Jsb2NrX3R5cGUgPT09IChjdXJyZW50X2Jsb2NrX3R5cGUgPSBzZWxlY3RfYmxvY2tfdHlwZShjdHgpKSAmJiBpZl9ibG9jaykgewoJCQkJaWZfYmxvY2sucChjdHgsIGRpcnR5KTsKCQkJfSBlbHNlIHsKCQkJCWlmX2Jsb2NrLmQoMSk7CgkJCQlpZl9ibG9jayA9IGN1cnJlbnRfYmxvY2tfdHlwZShjdHgpOwoKCQkJCWlmIChpZl9ibG9jaykgewoJCQkJCWlmX2Jsb2NrLmMoKTsKCQkJCQlpZl9ibG9jay5tKGlmX2Jsb2NrX2FuY2hvci5wYXJlbnROb2RlLCBpZl9ibG9ja19hbmNob3IpOwoJCQkJfQoJCQl9CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2goaWZfYmxvY2tfYW5jaG9yKTsKCQkJfQoKCQkJaWZfYmxvY2suZChkZXRhY2hpbmcpOwoJCX0KCX07Cn0KCi8vICgxMTM6MSkgezplbHNlfQpmdW5jdGlvbiBjcmVhdGVfZWxzZV9ibG9jayQxKGN0eCkgewoJbGV0IHNwYW47CglsZXQgc3Bhbl9sZXZlbHMgPSBbLypkYXRhKi8gY3R4WzBdLmF0dHJpYnV0ZXNdOwoJbGV0IHNwYW5fZGF0YSA9IHt9OwoKCWZvciAobGV0IGkgPSAwOyBpIDwgc3Bhbl9sZXZlbHMubGVuZ3RoOyBpICs9IDEpIHsKCQlzcGFuX2RhdGEgPSBhc3NpZ24oc3Bhbl9kYXRhLCBzcGFuX2xldmVsc1tpXSk7Cgl9CgoJcmV0dXJuIHsKCQljKCkgewoJCQlzcGFuID0gZWxlbWVudCgic3BhbiIpOwoJCQlzZXRfYXR0cmlidXRlcyhzcGFuLCBzcGFuX2RhdGEpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBzcGFuLCBhbmNob3IpOwoJCX0sCgkJcChjdHgsIGRpcnR5KSB7CgkJCXNldF9hdHRyaWJ1dGVzKHNwYW4sIHNwYW5fZGF0YSA9IGdldF9zcHJlYWRfdXBkYXRlKHNwYW5fbGV2ZWxzLCBbZGlydHkgJiAvKmRhdGEqLyAxICYmIC8qZGF0YSovIGN0eFswXS5hdHRyaWJ1dGVzXSkpOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKHNwYW4pOwoJCQl9CgkJfQoJfTsKfQoKLy8gKDEwOToxKSB7I2lmIGRhdGEuc3ZnfQpmdW5jdGlvbiBjcmVhdGVfaWZfYmxvY2tfMSQzKGN0eCkgewoJbGV0IHN2ZzsKCWxldCByYXdfdmFsdWUgPSAvKmRhdGEqLyBjdHhbMF0uYm9keSArICIiOwoJbGV0IHN2Z19sZXZlbHMgPSBbLypkYXRhKi8gY3R4WzBdLmF0dHJpYnV0ZXNdOwoJbGV0IHN2Z19kYXRhID0ge307CgoJZm9yIChsZXQgaSA9IDA7IGkgPCBzdmdfbGV2ZWxzLmxlbmd0aDsgaSArPSAxKSB7CgkJc3ZnX2RhdGEgPSBhc3NpZ24oc3ZnX2RhdGEsIHN2Z19sZXZlbHNbaV0pOwoJfQoKCXJldHVybiB7CgkJYygpIHsKCQkJc3ZnID0gc3ZnX2VsZW1lbnQoInN2ZyIpOwoJCQlzZXRfc3ZnX2F0dHJpYnV0ZXMoc3ZnLCBzdmdfZGF0YSk7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIHN2ZywgYW5jaG9yKTsKCQkJc3ZnLmlubmVySFRNTCA9IHJhd192YWx1ZTsKCQl9LAoJCXAoY3R4LCBkaXJ0eSkgewoJCQlpZiAoZGlydHkgJiAvKmRhdGEqLyAxICYmIHJhd192YWx1ZSAhPT0gKHJhd192YWx1ZSA9IC8qZGF0YSovIGN0eFswXS5ib2R5ICsgIiIpKSBzdmcuaW5uZXJIVE1MID0gcmF3X3ZhbHVlOwkJCXNldF9zdmdfYXR0cmlidXRlcyhzdmcsIHN2Z19kYXRhID0gZ2V0X3NwcmVhZF91cGRhdGUoc3ZnX2xldmVscywgW2RpcnR5ICYgLypkYXRhKi8gMSAmJiAvKmRhdGEqLyBjdHhbMF0uYXR0cmlidXRlc10pKTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChzdmcpOwoJCQl9CgkJfQoJfTsKfQoKZnVuY3Rpb24gY3JlYXRlX2ZyYWdtZW50JDkoY3R4KSB7CglsZXQgaWZfYmxvY2tfYW5jaG9yOwoJbGV0IGlmX2Jsb2NrID0gLypkYXRhKi8gY3R4WzBdICYmIGNyZWF0ZV9pZl9ibG9jayQ0KGN0eCk7CgoJcmV0dXJuIHsKCQljKCkgewoJCQlpZiAoaWZfYmxvY2spIGlmX2Jsb2NrLmMoKTsKCQkJaWZfYmxvY2tfYW5jaG9yID0gZW1wdHkoKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaWYgKGlmX2Jsb2NrKSBpZl9ibG9jay5tKHRhcmdldCwgYW5jaG9yKTsKCQkJaW5zZXJ0KHRhcmdldCwgaWZfYmxvY2tfYW5jaG9yLCBhbmNob3IpOwoJCX0sCgkJcChjdHgsIFtkaXJ0eV0pIHsKCQkJaWYgKC8qZGF0YSovIGN0eFswXSkgewoJCQkJaWYgKGlmX2Jsb2NrKSB7CgkJCQkJaWZfYmxvY2sucChjdHgsIGRpcnR5KTsKCQkJCX0gZWxzZSB7CgkJCQkJaWZfYmxvY2sgPSBjcmVhdGVfaWZfYmxvY2skNChjdHgpOwoJCQkJCWlmX2Jsb2NrLmMoKTsKCQkJCQlpZl9ibG9jay5tKGlmX2Jsb2NrX2FuY2hvci5wYXJlbnROb2RlLCBpZl9ibG9ja19hbmNob3IpOwoJCQkJfQoJCQl9IGVsc2UgaWYgKGlmX2Jsb2NrKSB7CgkJCQlpZl9ibG9jay5kKDEpOwoJCQkJaWZfYmxvY2sgPSBudWxsOwoJCQl9CgkJfSwKCQlpOiBub29wJDQsCgkJbzogbm9vcCQ0LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChpZl9ibG9ja19hbmNob3IpOwoJCQl9CgoJCQlpZiAoaWZfYmxvY2spIGlmX2Jsb2NrLmQoZGV0YWNoaW5nKTsKCQl9Cgl9Owp9CgpmdW5jdGlvbiBpbnN0YW5jZSQ5KCQkc2VsZiwgJCRwcm9wcywgJCRpbnZhbGlkYXRlKSB7Cgljb25zdCBzdGF0ZSA9IHsKCQkvLyBMYXN0IGljb24gbmFtZQoJCW5hbWU6ICcnLAoJCS8vIExvYWRpbmcgc3RhdHVzCgkJbG9hZGluZzogbnVsbCwKCQkvLyBEZXN0cm95ZWQgc3RhdHVzCgkJZGVzdHJveWVkOiBmYWxzZQoJfTsKCgkvLyBNb3VudGVkIHN0YXR1cwoJbGV0IG1vdW50ZWQgPSBmYWxzZTsKCgkvLyBDYWxsYmFjayBjb3VudGVyCglsZXQgY291bnRlciA9IDA7CgoJLy8gR2VuZXJhdGVkIGRhdGEKCWxldCBkYXRhOwoKCWNvbnN0IG9uTG9hZCA9IGljb24gPT4gewoJCS8vIExlZ2FjeSBvbkxvYWQgcHJvcGVydHkKCQlpZiAodHlwZW9mICQkcHJvcHMub25Mb2FkID09PSAnZnVuY3Rpb24nKSB7CgkJCSQkcHJvcHMub25Mb2FkKGljb24pOwoJCX0KCgkJLy8gb246bG9hZCBldmVudAoJCWNvbnN0IGRpc3BhdGNoID0gY3JlYXRlRXZlbnREaXNwYXRjaGVyKCk7CgoJCWRpc3BhdGNoKCdsb2FkJywgeyBpY29uIH0pOwoJfTsKCgkvLyBJbmNyZWFzZSBjb3VudGVyIHdoZW4gbG9hZGVkIHRvIGZvcmNlIHJlLWNhbGN1bGF0aW9uIG9mIGRhdGEKCWZ1bmN0aW9uIGxvYWRlZCgpIHsKCQkkJGludmFsaWRhdGUoMywgY291bnRlcisrLCBjb3VudGVyKTsKCX0KCgkvLyBGb3JjZSByZS1yZW5kZXIKCW9uTW91bnQoKCkgPT4gewoJCSQkaW52YWxpZGF0ZSgyLCBtb3VudGVkID0gdHJ1ZSk7Cgl9KTsKCgkvLyBBYm9ydCBsb2FkaW5nIHdoZW4gY29tcG9uZW50IGlzIGRlc3Ryb3llZAoJb25EZXN0cm95KCgpID0+IHsKCQkkJGludmFsaWRhdGUoMSwgc3RhdGUuZGVzdHJveWVkID0gdHJ1ZSwgc3RhdGUpOwoKCQlpZiAoc3RhdGUubG9hZGluZykgewoJCQlzdGF0ZS5sb2FkaW5nLmFib3J0KCk7CgkJCSQkaW52YWxpZGF0ZSgxLCBzdGF0ZS5sb2FkaW5nID0gbnVsbCwgc3RhdGUpOwoJCX0KCX0pOwoKCSQkc2VsZi4kJHNldCA9ICQkbmV3X3Byb3BzID0+IHsKCQkkJGludmFsaWRhdGUoNiwgJCRwcm9wcyA9IGFzc2lnbihhc3NpZ24oe30sICQkcHJvcHMpLCBleGNsdWRlX2ludGVybmFsX3Byb3BzKCQkbmV3X3Byb3BzKSkpOwoJfTsKCgkkJHNlbGYuJCQudXBkYXRlID0gKCkgPT4gewoJCXsKCQkJY29uc3QgaWNvbkRhdGEgPSBjaGVja0ljb25TdGF0ZSgkJHByb3BzLmljb24sIHN0YXRlLCBtb3VudGVkLCBsb2FkZWQsIG9uTG9hZCk7CgkJCSQkaW52YWxpZGF0ZSgwLCBkYXRhID0gaWNvbkRhdGEgPyBnZW5lcmF0ZUljb24oaWNvbkRhdGEuZGF0YSwgJCRwcm9wcykgOiBudWxsKTsKCgkJCWlmIChkYXRhICYmIGljb25EYXRhLmNsYXNzZXMpIHsKCQkJCS8vIEFkZCBjbGFzc2VzCgkJCQkkJGludmFsaWRhdGUoCgkJCQkJMCwKCQkJCQlkYXRhLmF0dHJpYnV0ZXNbJ2NsYXNzJ10gPSAodHlwZW9mICQkcHJvcHNbJ2NsYXNzJ10gPT09ICdzdHJpbmcnCgkJCQkJPyAkJHByb3BzWydjbGFzcyddICsgJyAnCgkJCQkJOiAnJykgKyBpY29uRGF0YS5jbGFzc2VzLmpvaW4oJyAnKSwKCQkJCQlkYXRhCgkJCQkpOwoJCQl9CgkJfQoJfTsKCgkkJHByb3BzID0gZXhjbHVkZV9pbnRlcm5hbF9wcm9wcygkJHByb3BzKTsKCXJldHVybiBbZGF0YSwgc3RhdGUsIG1vdW50ZWQsIGNvdW50ZXJdOwp9CgpjbGFzcyBJY29uIGV4dGVuZHMgU3ZlbHRlQ29tcG9uZW50IHsKCWNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKCQlzdXBlcigpOwoJCWluaXQodGhpcywgb3B0aW9ucywgaW5zdGFuY2UkOSwgY3JlYXRlX2ZyYWdtZW50JDksIHNhZmVfbm90X2VxdWFsLCB7fSk7Cgl9Cn0KCmNvbnN0IENhcmRfc3ZlbHRlX3N2ZWx0ZV90eXBlX3N0eWxlX2xhbmcgPSAnJzsKCi8qIGhvbWUvY2UvRG9jdW1lbnRzL0dpdEh1Yi9hZHJpZnQvbm9kZV9tb2R1bGVzLy5wbnBtL20zLXN2ZWx0ZUAyLjAuMy9ub2RlX21vZHVsZXMvbTMtc3ZlbHRlL3BhY2thZ2UvY29udGFpbmVycy9DYXJkLnN2ZWx0ZSBnZW5lcmF0ZWQgYnkgU3ZlbHRlIHY0LjIuMCAqLwoKZnVuY3Rpb24gY3JlYXRlX2ZyYWdtZW50JDgoY3R4KSB7CglsZXQgZGl2OwoJbGV0IGRpdl9jbGFzc192YWx1ZTsKCWxldCBkaXZfc3R5bGVfdmFsdWU7CglsZXQgY3VycmVudDsKCWNvbnN0IGRlZmF1bHRfc2xvdF90ZW1wbGF0ZSA9IC8qI3Nsb3RzKi8gY3R4WzRdLmRlZmF1bHQ7Cgljb25zdCBkZWZhdWx0X3Nsb3QgPSBjcmVhdGVfc2xvdChkZWZhdWx0X3Nsb3RfdGVtcGxhdGUsIGN0eCwgLyokJHNjb3BlKi8gY3R4WzNdLCBudWxsKTsKCglsZXQgZGl2X2xldmVscyA9IFsKCQl7CgkJCWNsYXNzOiBkaXZfY2xhc3NfdmFsdWUgPSAibTMtY29udGFpbmVyIHR5cGUtIiArIC8qdHlwZSovIGN0eFsyXQoJCX0sCgkJewoJCQlzdHlsZTogZGl2X3N0eWxlX3ZhbHVlID0gImRpc3BsYXk6ICIgKyAvKmRpc3BsYXkqLyBjdHhbMF0gKyAiOyIKCQl9LAoJCS8qZXh0cmFPcHRpb25zKi8gY3R4WzFdCgldOwoKCWxldCBkaXZfZGF0YSA9IHt9OwoKCWZvciAobGV0IGkgPSAwOyBpIDwgZGl2X2xldmVscy5sZW5ndGg7IGkgKz0gMSkgewoJCWRpdl9kYXRhID0gYXNzaWduKGRpdl9kYXRhLCBkaXZfbGV2ZWxzW2ldKTsKCX0KCglyZXR1cm4gewoJCWMoKSB7CgkJCWRpdiA9IGVsZW1lbnQoImRpdiIpOwoJCQlpZiAoZGVmYXVsdF9zbG90KSBkZWZhdWx0X3Nsb3QuYygpOwoJCQlzZXRfYXR0cmlidXRlcyhkaXYsIGRpdl9kYXRhKTsKCQkJdG9nZ2xlX2NsYXNzKGRpdiwgInN2ZWx0ZS1jenI1MmQiLCB0cnVlKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgZGl2LCBhbmNob3IpOwoKCQkJaWYgKGRlZmF1bHRfc2xvdCkgewoJCQkJZGVmYXVsdF9zbG90Lm0oZGl2LCBudWxsKTsKCQkJfQoKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlwKGN0eCwgW2RpcnR5XSkgewoJCQlpZiAoZGVmYXVsdF9zbG90KSB7CgkJCQlpZiAoZGVmYXVsdF9zbG90LnAgJiYgKCFjdXJyZW50IHx8IGRpcnR5ICYgLyokJHNjb3BlKi8gOCkpIHsKCQkJCQl1cGRhdGVfc2xvdF9iYXNlKAoJCQkJCQlkZWZhdWx0X3Nsb3QsCgkJCQkJCWRlZmF1bHRfc2xvdF90ZW1wbGF0ZSwKCQkJCQkJY3R4LAoJCQkJCQkvKiQkc2NvcGUqLyBjdHhbM10sCgkJCQkJCSFjdXJyZW50CgkJCQkJCT8gZ2V0X2FsbF9kaXJ0eV9mcm9tX3Njb3BlKC8qJCRzY29wZSovIGN0eFszXSkKCQkJCQkJOiBnZXRfc2xvdF9jaGFuZ2VzKGRlZmF1bHRfc2xvdF90ZW1wbGF0ZSwgLyokJHNjb3BlKi8gY3R4WzNdLCBkaXJ0eSwgbnVsbCksCgkJCQkJCW51bGwKCQkJCQkpOwoJCQkJfQoJCQl9CgoJCQlzZXRfYXR0cmlidXRlcyhkaXYsIGRpdl9kYXRhID0gZ2V0X3NwcmVhZF91cGRhdGUoZGl2X2xldmVscywgWwoJCQkJKCFjdXJyZW50IHx8IGRpcnR5ICYgLyp0eXBlKi8gNCAmJiBkaXZfY2xhc3NfdmFsdWUgIT09IChkaXZfY2xhc3NfdmFsdWUgPSAibTMtY29udGFpbmVyIHR5cGUtIiArIC8qdHlwZSovIGN0eFsyXSkpICYmIHsgY2xhc3M6IGRpdl9jbGFzc192YWx1ZSB9LAoJCQkJKCFjdXJyZW50IHx8IGRpcnR5ICYgLypkaXNwbGF5Ki8gMSAmJiBkaXZfc3R5bGVfdmFsdWUgIT09IChkaXZfc3R5bGVfdmFsdWUgPSAiZGlzcGxheTogIiArIC8qZGlzcGxheSovIGN0eFswXSArICI7IikpICYmIHsgc3R5bGU6IGRpdl9zdHlsZV92YWx1ZSB9LAoJCQkJZGlydHkgJiAvKmV4dHJhT3B0aW9ucyovIDIgJiYgLypleHRyYU9wdGlvbnMqLyBjdHhbMV0KCQkJXSkpOwoKCQkJdG9nZ2xlX2NsYXNzKGRpdiwgInN2ZWx0ZS1jenI1MmQiLCB0cnVlKTsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihkZWZhdWx0X3Nsb3QsIGxvY2FsKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlvKGxvY2FsKSB7CgkJCXRyYW5zaXRpb25fb3V0KGRlZmF1bHRfc2xvdCwgbG9jYWwpOwoJCQljdXJyZW50ID0gZmFsc2U7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2goZGl2KTsKCQkJfQoKCQkJaWYgKGRlZmF1bHRfc2xvdCkgZGVmYXVsdF9zbG90LmQoZGV0YWNoaW5nKTsKCQl9Cgl9Owp9CgpmdW5jdGlvbiBpbnN0YW5jZSQ4KCQkc2VsZiwgJCRwcm9wcywgJCRpbnZhbGlkYXRlKSB7CglsZXQgeyAkJHNsb3RzOiBzbG90cyA9IHt9LCAkJHNjb3BlIH0gPSAkJHByb3BzOwoJbGV0IHsgZGlzcGxheSA9ICJmbGV4IiB9ID0gJCRwcm9wczsKCWxldCB7IGV4dHJhT3B0aW9ucyA9IHt9IH0gPSAkJHByb3BzOwoJbGV0IHsgdHlwZSB9ID0gJCRwcm9wczsKCgkkJHNlbGYuJCRzZXQgPSAkJHByb3BzID0+IHsKCQlpZiAoJ2Rpc3BsYXknIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgwLCBkaXNwbGF5ID0gJCRwcm9wcy5kaXNwbGF5KTsKCQlpZiAoJ2V4dHJhT3B0aW9ucycgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDEsIGV4dHJhT3B0aW9ucyA9ICQkcHJvcHMuZXh0cmFPcHRpb25zKTsKCQlpZiAoJ3R5cGUnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgyLCB0eXBlID0gJCRwcm9wcy50eXBlKTsKCQlpZiAoJyQkc2NvcGUnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgzLCAkJHNjb3BlID0gJCRwcm9wcy4kJHNjb3BlKTsKCX07CgoJcmV0dXJuIFtkaXNwbGF5LCBleHRyYU9wdGlvbnMsIHR5cGUsICQkc2NvcGUsIHNsb3RzXTsKfQoKY2xhc3MgQ2FyZCBleHRlbmRzIFN2ZWx0ZUNvbXBvbmVudCB7Cgljb25zdHJ1Y3RvcihvcHRpb25zKSB7CgkJc3VwZXIoKTsKCQlpbml0KHRoaXMsIG9wdGlvbnMsIGluc3RhbmNlJDgsIGNyZWF0ZV9mcmFnbWVudCQ4LCBzYWZlX25vdF9lcXVhbCwgeyBkaXNwbGF5OiAwLCBleHRyYU9wdGlvbnM6IDEsIHR5cGU6IDIgfSk7Cgl9Cn0KCmNvbnN0IENhcmQkMSA9IENhcmQ7Cgpjb25zdCBEaWFsb2dfc3ZlbHRlX3N2ZWx0ZV90eXBlX3N0eWxlX2xhbmcgPSAnJzsKCi8qIGhvbWUvY2UvRG9jdW1lbnRzL0dpdEh1Yi9hZHJpZnQvbm9kZV9tb2R1bGVzLy5wbnBtL20zLXN2ZWx0ZUAyLjAuMy9ub2RlX21vZHVsZXMvbTMtc3ZlbHRlL3BhY2thZ2UvY29udGFpbmVycy9EaWFsb2cuc3ZlbHRlIGdlbmVyYXRlZCBieSBTdmVsdGUgdjQuMi4wICovCmNvbnN0IGdldF9idXR0b25zX3Nsb3RfY2hhbmdlcyA9IGRpcnR5ID0+ICh7fSk7CmNvbnN0IGdldF9idXR0b25zX3Nsb3RfY29udGV4dCA9IGN0eCA9PiAoe30pOwoKLy8gKDQ0OjQpIHsjaWYgaWNvbn0KZnVuY3Rpb24gY3JlYXRlX2lmX2Jsb2NrJDMoY3R4KSB7CglsZXQgaWNvbl8xOwoJbGV0IGN1cnJlbnQ7CglpY29uXzEgPSBuZXcgSWNvbih7IHByb3BzOiB7IGljb246IC8qaWNvbiovIGN0eFszXSB9IH0pOwoKCXJldHVybiB7CgkJYygpIHsKCQkJY3JlYXRlX2NvbXBvbmVudChpY29uXzEuJCQuZnJhZ21lbnQpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQltb3VudF9jb21wb25lbnQoaWNvbl8xLCB0YXJnZXQsIGFuY2hvcik7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJcChjdHgsIGRpcnR5KSB7CgkJCWNvbnN0IGljb25fMV9jaGFuZ2VzID0ge307CgkJCWlmIChkaXJ0eSAmIC8qaWNvbiovIDgpIGljb25fMV9jaGFuZ2VzLmljb24gPSAvKmljb24qLyBjdHhbM107CgkJCWljb25fMS4kc2V0KGljb25fMV9jaGFuZ2VzKTsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihpY29uXzEuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlvKGxvY2FsKSB7CgkJCXRyYW5zaXRpb25fb3V0KGljb25fMS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gZmFsc2U7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlkZXN0cm95X2NvbXBvbmVudChpY29uXzEsIGRldGFjaGluZyk7CgkJfQoJfTsKfQoKZnVuY3Rpb24gY3JlYXRlX2ZyYWdtZW50JDcoY3R4KSB7CglsZXQgZGlhbG9nXzE7CglsZXQgZGl2MjsKCWxldCB0MDsKCWxldCBwOwoJbGV0IHQxOwoJbGV0IHQyOwoJbGV0IGRpdjA7CglsZXQgdDM7CglsZXQgZGl2MTsKCWxldCBkaWFsb2dfMV9zdHlsZV92YWx1ZTsKCWxldCBjdXJyZW50OwoJbGV0IG1vdW50ZWQ7CglsZXQgZGlzcG9zZTsKCWxldCBpZl9ibG9jayA9IC8qaWNvbiovIGN0eFszXSAmJiBjcmVhdGVfaWZfYmxvY2skMyhjdHgpOwoJY29uc3QgZGVmYXVsdF9zbG90X3RlbXBsYXRlID0gLyojc2xvdHMqLyBjdHhbMTBdLmRlZmF1bHQ7Cgljb25zdCBkZWZhdWx0X3Nsb3QgPSBjcmVhdGVfc2xvdChkZWZhdWx0X3Nsb3RfdGVtcGxhdGUsIGN0eCwgLyokJHNjb3BlKi8gY3R4WzldLCBudWxsKTsKCWNvbnN0IGJ1dHRvbnNfc2xvdF90ZW1wbGF0ZSA9IC8qI3Nsb3RzKi8gY3R4WzEwXS5idXR0b25zOwoJY29uc3QgYnV0dG9uc19zbG90ID0gY3JlYXRlX3Nsb3QoYnV0dG9uc19zbG90X3RlbXBsYXRlLCBjdHgsIC8qJCRzY29wZSovIGN0eFs5XSwgZ2V0X2J1dHRvbnNfc2xvdF9jb250ZXh0KTsKCglsZXQgZGlhbG9nXzFfbGV2ZWxzID0gWwoJCXsKCQkJc3R5bGU6IGRpYWxvZ18xX3N0eWxlX3ZhbHVlID0gImRpc3BsYXk6ICIgKyAvKmRpc3BsYXkqLyBjdHhbMV0gKyAiOyIKCQl9LAoJCS8qZXh0cmFPcHRpb25zKi8gY3R4WzJdCgldOwoKCWxldCBkaWFsb2dfZGF0YSA9IHt9OwoKCWZvciAobGV0IGkgPSAwOyBpIDwgZGlhbG9nXzFfbGV2ZWxzLmxlbmd0aDsgaSArPSAxKSB7CgkJZGlhbG9nX2RhdGEgPSBhc3NpZ24oZGlhbG9nX2RhdGEsIGRpYWxvZ18xX2xldmVsc1tpXSk7Cgl9CgoJcmV0dXJuIHsKCQljKCkgewoJCQlkaWFsb2dfMSA9IGVsZW1lbnQoImRpYWxvZyIpOwoJCQlkaXYyID0gZWxlbWVudCgiZGl2Iik7CgkJCWlmIChpZl9ibG9jaykgaWZfYmxvY2suYygpOwoJCQl0MCA9IHNwYWNlKCk7CgkJCXAgPSBlbGVtZW50KCJwIik7CgkJCXQxID0gdGV4dCgvKmhlYWRsaW5lKi8gY3R4WzRdKTsKCQkJdDIgPSBzcGFjZSgpOwoJCQlkaXYwID0gZWxlbWVudCgiZGl2Iik7CgkJCWlmIChkZWZhdWx0X3Nsb3QpIGRlZmF1bHRfc2xvdC5jKCk7CgkJCXQzID0gc3BhY2UoKTsKCQkJZGl2MSA9IGVsZW1lbnQoImRpdiIpOwoJCQlpZiAoYnV0dG9uc19zbG90KSBidXR0b25zX3Nsb3QuYygpOwoJCQlhdHRyKHAsICJjbGFzcyIsICJoZWFkbGluZSBtMy1mb250LWhlYWRsaW5lLXNtYWxsIHN2ZWx0ZS1idWZ2dmUiKTsKCQkJdG9nZ2xlX2NsYXNzKHAsICJjZW50ZXIiLCAvKmljb24qLyBjdHhbM10pOwoJCQlhdHRyKGRpdjAsICJjbGFzcyIsICJjb250ZW50IG0zLWZvbnQtYm9keS1tZWRpdW0gc3ZlbHRlLWJ1ZnZ2ZSIpOwoJCQlhdHRyKGRpdjEsICJjbGFzcyIsICJidXR0b25zIHN2ZWx0ZS1idWZ2dmUiKTsKCQkJYXR0cihkaXYyLCAiY2xhc3MiLCAibTMtY29udGFpbmVyIHN2ZWx0ZS1idWZ2dmUiKTsKCQkJc2V0X2F0dHJpYnV0ZXMoZGlhbG9nXzEsIGRpYWxvZ19kYXRhKTsKCQkJdG9nZ2xlX2NsYXNzKGRpYWxvZ18xLCAic3ZlbHRlLWJ1ZnZ2ZSIsIHRydWUpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBkaWFsb2dfMSwgYW5jaG9yKTsKCQkJYXBwZW5kKGRpYWxvZ18xLCBkaXYyKTsKCQkJaWYgKGlmX2Jsb2NrKSBpZl9ibG9jay5tKGRpdjIsIG51bGwpOwoJCQlhcHBlbmQoZGl2MiwgdDApOwoJCQlhcHBlbmQoZGl2MiwgcCk7CgkJCWFwcGVuZChwLCB0MSk7CgkJCWFwcGVuZChkaXYyLCB0Mik7CgkJCWFwcGVuZChkaXYyLCBkaXYwKTsKCgkJCWlmIChkZWZhdWx0X3Nsb3QpIHsKCQkJCWRlZmF1bHRfc2xvdC5tKGRpdjAsIG51bGwpOwoJCQl9CgoJCQlhcHBlbmQoZGl2MiwgdDMpOwoJCQlhcHBlbmQoZGl2MiwgZGl2MSk7CgoJCQlpZiAoYnV0dG9uc19zbG90KSB7CgkJCQlidXR0b25zX3Nsb3QubShkaXYxLCBudWxsKTsKCQkJfQoKCQkJLypkaWFsb2dfMV9iaW5kaW5nKi8gY3R4WzEzXShkaWFsb2dfMSk7CgkJCWN1cnJlbnQgPSB0cnVlOwoKCQkJaWYgKCFtb3VudGVkKSB7CgkJCQlkaXNwb3NlID0gWwoJCQkJCWxpc3RlbihkaWFsb2dfMSwgImNhbmNlbCIsIC8qY2FuY2VsX2hhbmRsZXIqLyBjdHhbMTFdKSwKCQkJCQlsaXN0ZW4oZGlhbG9nXzEsICJjbGljayIsIHNlbGYkMSgvKmNsaWNrX2hhbmRsZXIqLyBjdHhbMTJdKSkKCQkJCV07CgoJCQkJbW91bnRlZCA9IHRydWU7CgkJCX0KCQl9LAoJCXAoY3R4LCBbZGlydHldKSB7CgkJCWlmICgvKmljb24qLyBjdHhbM10pIHsKCQkJCWlmIChpZl9ibG9jaykgewoJCQkJCWlmX2Jsb2NrLnAoY3R4LCBkaXJ0eSk7CgoJCQkJCWlmIChkaXJ0eSAmIC8qaWNvbiovIDgpIHsKCQkJCQkJdHJhbnNpdGlvbl9pbihpZl9ibG9jaywgMSk7CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQlpZl9ibG9jayA9IGNyZWF0ZV9pZl9ibG9jayQzKGN0eCk7CgkJCQkJaWZfYmxvY2suYygpOwoJCQkJCXRyYW5zaXRpb25faW4oaWZfYmxvY2ssIDEpOwoJCQkJCWlmX2Jsb2NrLm0oZGl2MiwgdDApOwoJCQkJfQoJCQl9IGVsc2UgaWYgKGlmX2Jsb2NrKSB7CgkJCQlncm91cF9vdXRyb3MoKTsKCgkJCQl0cmFuc2l0aW9uX291dChpZl9ibG9jaywgMSwgMSwgKCkgPT4gewoJCQkJCWlmX2Jsb2NrID0gbnVsbDsKCQkJCX0pOwoKCQkJCWNoZWNrX291dHJvcygpOwoJCQl9CgoJCQlpZiAoIWN1cnJlbnQgfHwgZGlydHkgJiAvKmhlYWRsaW5lKi8gMTYpIHNldF9kYXRhKHQxLCAvKmhlYWRsaW5lKi8gY3R4WzRdKTsKCgkJCWlmICghY3VycmVudCB8fCBkaXJ0eSAmIC8qaWNvbiovIDgpIHsKCQkJCXRvZ2dsZV9jbGFzcyhwLCAiY2VudGVyIiwgLyppY29uKi8gY3R4WzNdKTsKCQkJfQoKCQkJaWYgKGRlZmF1bHRfc2xvdCkgewoJCQkJaWYgKGRlZmF1bHRfc2xvdC5wICYmICghY3VycmVudCB8fCBkaXJ0eSAmIC8qJCRzY29wZSovIDUxMikpIHsKCQkJCQl1cGRhdGVfc2xvdF9iYXNlKAoJCQkJCQlkZWZhdWx0X3Nsb3QsCgkJCQkJCWRlZmF1bHRfc2xvdF90ZW1wbGF0ZSwKCQkJCQkJY3R4LAoJCQkJCQkvKiQkc2NvcGUqLyBjdHhbOV0sCgkJCQkJCSFjdXJyZW50CgkJCQkJCT8gZ2V0X2FsbF9kaXJ0eV9mcm9tX3Njb3BlKC8qJCRzY29wZSovIGN0eFs5XSkKCQkJCQkJOiBnZXRfc2xvdF9jaGFuZ2VzKGRlZmF1bHRfc2xvdF90ZW1wbGF0ZSwgLyokJHNjb3BlKi8gY3R4WzldLCBkaXJ0eSwgbnVsbCksCgkJCQkJCW51bGwKCQkJCQkpOwoJCQkJfQoJCQl9CgoJCQlpZiAoYnV0dG9uc19zbG90KSB7CgkJCQlpZiAoYnV0dG9uc19zbG90LnAgJiYgKCFjdXJyZW50IHx8IGRpcnR5ICYgLyokJHNjb3BlKi8gNTEyKSkgewoJCQkJCXVwZGF0ZV9zbG90X2Jhc2UoCgkJCQkJCWJ1dHRvbnNfc2xvdCwKCQkJCQkJYnV0dG9uc19zbG90X3RlbXBsYXRlLAoJCQkJCQljdHgsCgkJCQkJCS8qJCRzY29wZSovIGN0eFs5XSwKCQkJCQkJIWN1cnJlbnQKCQkJCQkJPyBnZXRfYWxsX2RpcnR5X2Zyb21fc2NvcGUoLyokJHNjb3BlKi8gY3R4WzldKQoJCQkJCQk6IGdldF9zbG90X2NoYW5nZXMoYnV0dG9uc19zbG90X3RlbXBsYXRlLCAvKiQkc2NvcGUqLyBjdHhbOV0sIGRpcnR5LCBnZXRfYnV0dG9uc19zbG90X2NoYW5nZXMpLAoJCQkJCQlnZXRfYnV0dG9uc19zbG90X2NvbnRleHQKCQkJCQkpOwoJCQkJfQoJCQl9CgoJCQlzZXRfYXR0cmlidXRlcyhkaWFsb2dfMSwgZGlhbG9nX2RhdGEgPSBnZXRfc3ByZWFkX3VwZGF0ZShkaWFsb2dfMV9sZXZlbHMsIFsKCQkJCSghY3VycmVudCB8fCBkaXJ0eSAmIC8qZGlzcGxheSovIDIgJiYgZGlhbG9nXzFfc3R5bGVfdmFsdWUgIT09IChkaWFsb2dfMV9zdHlsZV92YWx1ZSA9ICJkaXNwbGF5OiAiICsgLypkaXNwbGF5Ki8gY3R4WzFdICsgIjsiKSkgJiYgeyBzdHlsZTogZGlhbG9nXzFfc3R5bGVfdmFsdWUgfSwKCQkJCWRpcnR5ICYgLypleHRyYU9wdGlvbnMqLyA0ICYmIC8qZXh0cmFPcHRpb25zKi8gY3R4WzJdCgkJCV0pKTsKCgkJCXRvZ2dsZV9jbGFzcyhkaWFsb2dfMSwgInN2ZWx0ZS1idWZ2dmUiLCB0cnVlKTsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihpZl9ibG9jayk7CgkJCXRyYW5zaXRpb25faW4oZGVmYXVsdF9zbG90LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25faW4oYnV0dG9uc19zbG90LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dChpZl9ibG9jayk7CgkJCXRyYW5zaXRpb25fb3V0KGRlZmF1bHRfc2xvdCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX291dChidXR0b25zX3Nsb3QsIGxvY2FsKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGRpYWxvZ18xKTsKCQkJfQoKCQkJaWYgKGlmX2Jsb2NrKSBpZl9ibG9jay5kKCk7CgkJCWlmIChkZWZhdWx0X3Nsb3QpIGRlZmF1bHRfc2xvdC5kKGRldGFjaGluZyk7CgkJCWlmIChidXR0b25zX3Nsb3QpIGJ1dHRvbnNfc2xvdC5kKGRldGFjaGluZyk7CgkJCS8qZGlhbG9nXzFfYmluZGluZyovIGN0eFsxM10obnVsbCk7CgkJCW1vdW50ZWQgPSBmYWxzZTsKCQkJcnVuX2FsbChkaXNwb3NlKTsKCQl9Cgl9Owp9CgpmdW5jdGlvbiBpbnN0YW5jZSQ3KCQkc2VsZiwgJCRwcm9wcywgJCRpbnZhbGlkYXRlKSB7CglsZXQgeyAkJHNsb3RzOiBzbG90cyA9IHt9LCAkJHNjb3BlIH0gPSAkJHByb3BzOwoJbGV0IHsgZGlzcGxheSA9ICJmbGV4IiB9ID0gJCRwcm9wczsKCWxldCB7IGV4dHJhT3B0aW9ucyA9IHt9IH0gPSAkJHByb3BzOwoJbGV0IHsgaWNvbiA9IHZvaWQgMCB9ID0gJCRwcm9wczsKCWxldCB7IGhlYWRsaW5lIH0gPSAkJHByb3BzOwoJbGV0IHsgb3BlbiB9ID0gJCRwcm9wczsKCWxldCB7IGNsb3NlT25Fc2MgPSB0cnVlIH0gPSAkJHByb3BzOwoJbGV0IHsgY2xvc2VPbkNsaWNrID0gdHJ1ZSB9ID0gJCRwcm9wczsKCWNvbnN0IGRpc3BhdGNoID0gY3JlYXRlRXZlbnREaXNwYXRjaGVyKCk7CglsZXQgZGlhbG9nOwoKCWNvbnN0IGNhbmNlbF9oYW5kbGVyID0gZSA9PiB7CgkJaWYgKGNsb3NlT25Fc2MpIHsKCQkJZGlzcGF0Y2goImNsb3NlZEJ5RXNjIik7CgkJCSQkaW52YWxpZGF0ZSgwLCBvcGVuID0gZmFsc2UpOwoJCX0gZWxzZSB7CgkJCWUucHJldmVudERlZmF1bHQoKTsKCQl9Cgl9OwoKCWNvbnN0IGNsaWNrX2hhbmRsZXIgPSAoKSA9PiB7CgkJaWYgKGNsb3NlT25DbGljaykgewoJCQlkaXNwYXRjaCgiY2xvc2VkQnlDbGljayIpOwoJCQkkJGludmFsaWRhdGUoMCwgb3BlbiA9IGZhbHNlKTsKCQl9Cgl9OwoKCWZ1bmN0aW9uIGRpYWxvZ18xX2JpbmRpbmcoJCR2YWx1ZSkgewoJCWJpbmRpbmdfY2FsbGJhY2tzWyQkdmFsdWUgPyAndW5zaGlmdCcgOiAncHVzaCddKCgpID0+IHsKCQkJZGlhbG9nID0gJCR2YWx1ZTsKCQkJJCRpbnZhbGlkYXRlKDcsIGRpYWxvZyk7CgkJfSk7Cgl9CgoJJCRzZWxmLiQkc2V0ID0gJCRwcm9wcyA9PiB7CgkJaWYgKCdkaXNwbGF5JyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMSwgZGlzcGxheSA9ICQkcHJvcHMuZGlzcGxheSk7CgkJaWYgKCdleHRyYU9wdGlvbnMnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgyLCBleHRyYU9wdGlvbnMgPSAkJHByb3BzLmV4dHJhT3B0aW9ucyk7CgkJaWYgKCdpY29uJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMywgaWNvbiA9ICQkcHJvcHMuaWNvbik7CgkJaWYgKCdoZWFkbGluZScgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDQsIGhlYWRsaW5lID0gJCRwcm9wcy5oZWFkbGluZSk7CgkJaWYgKCdvcGVuJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMCwgb3BlbiA9ICQkcHJvcHMub3Blbik7CgkJaWYgKCdjbG9zZU9uRXNjJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoNSwgY2xvc2VPbkVzYyA9ICQkcHJvcHMuY2xvc2VPbkVzYyk7CgkJaWYgKCdjbG9zZU9uQ2xpY2snIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSg2LCBjbG9zZU9uQ2xpY2sgPSAkJHByb3BzLmNsb3NlT25DbGljayk7CgkJaWYgKCckJHNjb3BlJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoOSwgJCRzY29wZSA9ICQkcHJvcHMuJCRzY29wZSk7Cgl9OwoKCSQkc2VsZi4kJC51cGRhdGUgPSAoKSA9PiB7CgkJaWYgKCQkc2VsZi4kJC5kaXJ0eSAmIC8qZGlhbG9nLCBvcGVuKi8gMTI5KSB7CgkJCSQ6IHsKCQkJCWlmICghZGlhbG9nKSBicmVhayAkOwoJCQkJaWYgKG9wZW4pIGRpYWxvZy5zaG93TW9kYWwoKTsgZWxzZSBkaWFsb2cuY2xvc2UoKTsKCQkJfQoJCX0KCX07CgoJcmV0dXJuIFsKCQlvcGVuLAoJCWRpc3BsYXksCgkJZXh0cmFPcHRpb25zLAoJCWljb24sCgkJaGVhZGxpbmUsCgkJY2xvc2VPbkVzYywKCQljbG9zZU9uQ2xpY2ssCgkJZGlhbG9nLAoJCWRpc3BhdGNoLAoJCSQkc2NvcGUsCgkJc2xvdHMsCgkJY2FuY2VsX2hhbmRsZXIsCgkJY2xpY2tfaGFuZGxlciwKCQlkaWFsb2dfMV9iaW5kaW5nCgldOwp9CgpjbGFzcyBEaWFsb2cgZXh0ZW5kcyBTdmVsdGVDb21wb25lbnQgewoJY29uc3RydWN0b3Iob3B0aW9ucykgewoJCXN1cGVyKCk7CgoJCWluaXQodGhpcywgb3B0aW9ucywgaW5zdGFuY2UkNywgY3JlYXRlX2ZyYWdtZW50JDcsIHNhZmVfbm90X2VxdWFsLCB7CgkJCWRpc3BsYXk6IDEsCgkJCWV4dHJhT3B0aW9uczogMiwKCQkJaWNvbjogMywKCQkJaGVhZGxpbmU6IDQsCgkJCW9wZW46IDAsCgkJCWNsb3NlT25Fc2M6IDUsCgkJCWNsb3NlT25DbGljazogNgoJCX0pOwoJfQp9Cgpjb25zdCBEaWFsb2ckMSA9IERpYWxvZzsKCi8qKgogKiBBbmltYXRlcyB0aGUgb3BhY2l0eSBvZiBhbiBlbGVtZW50IGZyb20gMCB0byB0aGUgY3VycmVudCBvcGFjaXR5IGZvciBgaW5gIHRyYW5zaXRpb25zIGFuZCBmcm9tIHRoZSBjdXJyZW50IG9wYWNpdHkgdG8gMCBmb3IgYG91dGAgdHJhbnNpdGlvbnMuCiAqCiAqIGh0dHBzOi8vc3ZlbHRlLmRldi9kb2NzL3N2ZWx0ZS10cmFuc2l0aW9uI2ZhZGUKICogQHBhcmFtIHtFbGVtZW50fSBub2RlCiAqIEBwYXJhbSB7aW1wb3J0KCcuL3B1YmxpYycpLkZhZGVQYXJhbXN9IFtwYXJhbXNdCiAqIEByZXR1cm5zIHtpbXBvcnQoJy4vcHVibGljJykuVHJhbnNpdGlvbkNvbmZpZ30KICovCmZ1bmN0aW9uIGZhZGUobm9kZSwgeyBkZWxheSA9IDAsIGR1cmF0aW9uID0gNDAwLCBlYXNpbmcgPSBpZGVudGl0eSB9ID0ge30pIHsKCWNvbnN0IG8gPSArZ2V0Q29tcHV0ZWRTdHlsZShub2RlKS5vcGFjaXR5OwoJcmV0dXJuIHsKCQlkZWxheSwKCQlkdXJhdGlvbiwKCQllYXNpbmcsCgkJY3NzOiAodCkgPT4gYG9wYWNpdHk6ICR7dCAqIG99YAoJfTsKfQoKY29uc3QgZGF0YSQyID0gewoJIndpZHRoIjogMjQsCgkiaGVpZ2h0IjogMjQsCgkiYm9keSI6ICI8cGF0aCBmaWxsPVwiY3VycmVudENvbG9yXCIgZD1cIk0xOSA2LjQxTDE3LjU5IDVMMTIgMTAuNTlMNi40MSA1TDUgNi40MUwxMC41OSAxMkw1IDE3LjU5TDYuNDEgMTlMMTIgMTMuNDFMMTcuNTkgMTlMMTkgMTcuNTlMMTMuNDEgMTJMMTkgNi40MXpcIi8+Igp9OwoKY29uc3QgU25hY2tiYXJJdGVtX3N2ZWx0ZV9zdmVsdGVfdHlwZV9zdHlsZV9sYW5nID0gJyc7CgovKiBob21lL2NlL0RvY3VtZW50cy9HaXRIdWIvYWRyaWZ0L25vZGVfbW9kdWxlcy8ucG5wbS9tMy1zdmVsdGVAMi4wLjMvbm9kZV9tb2R1bGVzL20zLXN2ZWx0ZS9wYWNrYWdlL2NvbnRhaW5lcnMvU25hY2tiYXJJdGVtLnN2ZWx0ZSBnZW5lcmF0ZWQgYnkgU3ZlbHRlIHY0LjIuMCAqLwoKZnVuY3Rpb24gY3JlYXRlX2ZyYWdtZW50JDYoY3R4KSB7CglsZXQgZGl2OwoJbGV0IGRpdl9zdHlsZV92YWx1ZTsKCWxldCBjdXJyZW50OwoJY29uc3QgZGVmYXVsdF9zbG90X3RlbXBsYXRlID0gLyojc2xvdHMqLyBjdHhbM10uZGVmYXVsdDsKCWNvbnN0IGRlZmF1bHRfc2xvdCA9IGNyZWF0ZV9zbG90KGRlZmF1bHRfc2xvdF90ZW1wbGF0ZSwgY3R4LCAvKiQkc2NvcGUqLyBjdHhbMl0sIG51bGwpOwoKCWxldCBkaXZfbGV2ZWxzID0gWwoJCXsgY2xhc3M6ICJtMy1jb250YWluZXIiIH0sCgkJewoJCQlzdHlsZTogZGl2X3N0eWxlX3ZhbHVlID0gImRpc3BsYXk6ICIgKyAvKmRpc3BsYXkqLyBjdHhbMF0gKyAiOyIKCQl9LAoJCS8qZXh0cmFPcHRpb25zKi8gY3R4WzFdCgldOwoKCWxldCBkaXZfZGF0YSA9IHt9OwoKCWZvciAobGV0IGkgPSAwOyBpIDwgZGl2X2xldmVscy5sZW5ndGg7IGkgKz0gMSkgewoJCWRpdl9kYXRhID0gYXNzaWduKGRpdl9kYXRhLCBkaXZfbGV2ZWxzW2ldKTsKCX0KCglyZXR1cm4gewoJCWMoKSB7CgkJCWRpdiA9IGVsZW1lbnQoImRpdiIpOwoJCQlpZiAoZGVmYXVsdF9zbG90KSBkZWZhdWx0X3Nsb3QuYygpOwoJCQlzZXRfYXR0cmlidXRlcyhkaXYsIGRpdl9kYXRhKTsKCQkJdG9nZ2xlX2NsYXNzKGRpdiwgInN2ZWx0ZS1sOTJydG4iLCB0cnVlKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgZGl2LCBhbmNob3IpOwoKCQkJaWYgKGRlZmF1bHRfc2xvdCkgewoJCQkJZGVmYXVsdF9zbG90Lm0oZGl2LCBudWxsKTsKCQkJfQoKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlwKGN0eCwgW2RpcnR5XSkgewoJCQlpZiAoZGVmYXVsdF9zbG90KSB7CgkJCQlpZiAoZGVmYXVsdF9zbG90LnAgJiYgKCFjdXJyZW50IHx8IGRpcnR5ICYgLyokJHNjb3BlKi8gNCkpIHsKCQkJCQl1cGRhdGVfc2xvdF9iYXNlKAoJCQkJCQlkZWZhdWx0X3Nsb3QsCgkJCQkJCWRlZmF1bHRfc2xvdF90ZW1wbGF0ZSwKCQkJCQkJY3R4LAoJCQkJCQkvKiQkc2NvcGUqLyBjdHhbMl0sCgkJCQkJCSFjdXJyZW50CgkJCQkJCT8gZ2V0X2FsbF9kaXJ0eV9mcm9tX3Njb3BlKC8qJCRzY29wZSovIGN0eFsyXSkKCQkJCQkJOiBnZXRfc2xvdF9jaGFuZ2VzKGRlZmF1bHRfc2xvdF90ZW1wbGF0ZSwgLyokJHNjb3BlKi8gY3R4WzJdLCBkaXJ0eSwgbnVsbCksCgkJCQkJCW51bGwKCQkJCQkpOwoJCQkJfQoJCQl9CgoJCQlzZXRfYXR0cmlidXRlcyhkaXYsIGRpdl9kYXRhID0gZ2V0X3NwcmVhZF91cGRhdGUoZGl2X2xldmVscywgWwoJCQkJeyBjbGFzczogIm0zLWNvbnRhaW5lciIgfSwKCQkJCSghY3VycmVudCB8fCBkaXJ0eSAmIC8qZGlzcGxheSovIDEgJiYgZGl2X3N0eWxlX3ZhbHVlICE9PSAoZGl2X3N0eWxlX3ZhbHVlID0gImRpc3BsYXk6ICIgKyAvKmRpc3BsYXkqLyBjdHhbMF0gKyAiOyIpKSAmJiB7IHN0eWxlOiBkaXZfc3R5bGVfdmFsdWUgfSwKCQkJCWRpcnR5ICYgLypleHRyYU9wdGlvbnMqLyAyICYmIC8qZXh0cmFPcHRpb25zKi8gY3R4WzFdCgkJCV0pKTsKCgkJCXRvZ2dsZV9jbGFzcyhkaXYsICJzdmVsdGUtbDkycnRuIiwgdHJ1ZSk7CgkJfSwKCQlpKGxvY2FsKSB7CgkJCWlmIChjdXJyZW50KSByZXR1cm47CgkJCXRyYW5zaXRpb25faW4oZGVmYXVsdF9zbG90LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dChkZWZhdWx0X3Nsb3QsIGxvY2FsKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGRpdik7CgkJCX0KCgkJCWlmIChkZWZhdWx0X3Nsb3QpIGRlZmF1bHRfc2xvdC5kKGRldGFjaGluZyk7CgkJfQoJfTsKfQoKZnVuY3Rpb24gaW5zdGFuY2UkNigkJHNlbGYsICQkcHJvcHMsICQkaW52YWxpZGF0ZSkgewoJbGV0IHsgJCRzbG90czogc2xvdHMgPSB7fSwgJCRzY29wZSB9ID0gJCRwcm9wczsKCWxldCB7IGRpc3BsYXkgPSAiZmxleCIgfSA9ICQkcHJvcHM7CglsZXQgeyBleHRyYU9wdGlvbnMgPSB7fSB9ID0gJCRwcm9wczsKCgkkJHNlbGYuJCRzZXQgPSAkJHByb3BzID0+IHsKCQlpZiAoJ2Rpc3BsYXknIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgwLCBkaXNwbGF5ID0gJCRwcm9wcy5kaXNwbGF5KTsKCQlpZiAoJ2V4dHJhT3B0aW9ucycgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDEsIGV4dHJhT3B0aW9ucyA9ICQkcHJvcHMuZXh0cmFPcHRpb25zKTsKCQlpZiAoJyQkc2NvcGUnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgyLCAkJHNjb3BlID0gJCRwcm9wcy4kJHNjb3BlKTsKCX07CgoJcmV0dXJuIFtkaXNwbGF5LCBleHRyYU9wdGlvbnMsICQkc2NvcGUsIHNsb3RzXTsKfQoKY2xhc3MgU25hY2tiYXJJdGVtIGV4dGVuZHMgU3ZlbHRlQ29tcG9uZW50IHsKCWNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKCQlzdXBlcigpOwoJCWluaXQodGhpcywgb3B0aW9ucywgaW5zdGFuY2UkNiwgY3JlYXRlX2ZyYWdtZW50JDYsIHNhZmVfbm90X2VxdWFsLCB7IGRpc3BsYXk6IDAsIGV4dHJhT3B0aW9uczogMSB9KTsKCX0KfQoKY29uc3QgU25hY2tiYXJJdGVtJDEgPSBTbmFja2Jhckl0ZW07Cgpjb25zdCBTbmFja2JhckFuaW1fc3ZlbHRlX3N2ZWx0ZV90eXBlX3N0eWxlX2xhbmcgPSAnJzsKCi8qIGhvbWUvY2UvRG9jdW1lbnRzL0dpdEh1Yi9hZHJpZnQvbm9kZV9tb2R1bGVzLy5wbnBtL20zLXN2ZWx0ZUAyLjAuMy9ub2RlX21vZHVsZXMvbTMtc3ZlbHRlL3BhY2thZ2UvY29udGFpbmVycy9TbmFja2JhckFuaW0uc3ZlbHRlIGdlbmVyYXRlZCBieSBTdmVsdGUgdjQuMi4wICovCgpmdW5jdGlvbiBnZXRfZWFjaF9jb250ZXh0JDEoY3R4LCBsaXN0LCBpKSB7Cgljb25zdCBjaGlsZF9jdHggPSBjdHguc2xpY2UoKTsKCWNoaWxkX2N0eFs3XSA9IGxpc3RbaV1bMF07CgljaGlsZF9jdHhbOF0gPSBsaXN0W2ldWzFdOwoJcmV0dXJuIGNoaWxkX2N0eDsKfQoKLy8gKDI1OjApIHsjaWYgc25hY2tiYXJ9CmZ1bmN0aW9uIGNyZWF0ZV9pZl9ibG9jayQyKGN0eCkgewoJbGV0IGRpdjsKCWxldCBwcmV2aW91c19rZXkgPSAvKnNuYWNrYmFyKi8gY3R4WzJdOwoJbGV0IGRpdl9vdXRybzsKCWxldCBjdXJyZW50OwoJbGV0IGtleV9ibG9jayA9IGNyZWF0ZV9rZXlfYmxvY2soY3R4KTsKCWxldCBkaXZfbGV2ZWxzID0gW3sgY2xhc3M6ICJob2xkZXIiIH0sIC8qZXh0cmFXcmFwcGVyT3B0aW9ucyovIGN0eFswXV07CglsZXQgZGl2X2RhdGEgPSB7fTsKCglmb3IgKGxldCBpID0gMDsgaSA8IGRpdl9sZXZlbHMubGVuZ3RoOyBpICs9IDEpIHsKCQlkaXZfZGF0YSA9IGFzc2lnbihkaXZfZGF0YSwgZGl2X2xldmVsc1tpXSk7Cgl9CgoJcmV0dXJuIHsKCQljKCkgewoJCQlkaXYgPSBlbGVtZW50KCJkaXYiKTsKCQkJa2V5X2Jsb2NrLmMoKTsKCQkJc2V0X2F0dHJpYnV0ZXMoZGl2LCBkaXZfZGF0YSk7CgkJCXRvZ2dsZV9jbGFzcyhkaXYsICJzdmVsdGUta2R6cHlnIiwgdHJ1ZSk7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIGRpdiwgYW5jaG9yKTsKCQkJa2V5X2Jsb2NrLm0oZGl2LCBudWxsKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlwKGN0eCwgZGlydHkpIHsKCQkJaWYgKGRpcnR5ICYgLypzbmFja2JhciovIDQgJiYgc2FmZV9ub3RfZXF1YWwocHJldmlvdXNfa2V5LCBwcmV2aW91c19rZXkgPSAvKnNuYWNrYmFyKi8gY3R4WzJdKSkgewoJCQkJZ3JvdXBfb3V0cm9zKCk7CgkJCQl0cmFuc2l0aW9uX291dChrZXlfYmxvY2ssIDEsIDEsIG5vb3AkNCk7CgkJCQljaGVja19vdXRyb3MoKTsKCQkJCWtleV9ibG9jayA9IGNyZWF0ZV9rZXlfYmxvY2soY3R4KTsKCQkJCWtleV9ibG9jay5jKCk7CgkJCQl0cmFuc2l0aW9uX2luKGtleV9ibG9jaywgMSk7CgkJCQlrZXlfYmxvY2subShkaXYsIG51bGwpOwoJCQl9IGVsc2UgewoJCQkJa2V5X2Jsb2NrLnAoY3R4LCBkaXJ0eSk7CgkJCX0KCgkJCXNldF9hdHRyaWJ1dGVzKGRpdiwgZGl2X2RhdGEgPSBnZXRfc3ByZWFkX3VwZGF0ZShkaXZfbGV2ZWxzLCBbCgkJCQl7IGNsYXNzOiAiaG9sZGVyIiB9LAoJCQkJZGlydHkgJiAvKmV4dHJhV3JhcHBlck9wdGlvbnMqLyAxICYmIC8qZXh0cmFXcmFwcGVyT3B0aW9ucyovIGN0eFswXQoJCQldKSk7CgoJCQl0b2dnbGVfY2xhc3MoZGl2LCAic3ZlbHRlLWtkenB5ZyIsIHRydWUpOwoJCX0sCgkJaShsb2NhbCkgewoJCQlpZiAoY3VycmVudCkgcmV0dXJuOwoJCQl0cmFuc2l0aW9uX2luKGtleV9ibG9jayk7CgkJCWlmIChkaXZfb3V0cm8pIGRpdl9vdXRyby5lbmQoMSk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dChrZXlfYmxvY2spOwoKCQkJaWYgKGxvY2FsKSB7CgkJCQlkaXZfb3V0cm8gPSBjcmVhdGVfb3V0X3RyYW5zaXRpb24oZGl2LCBmYWRlLCB7IGR1cmF0aW9uOiAyMDAgfSk7CgkJCX0KCgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChkaXYpOwoJCQl9CgoJCQlrZXlfYmxvY2suZChkZXRhY2hpbmcpOwoJCQlpZiAoZGV0YWNoaW5nICYmIGRpdl9vdXRybykgZGl2X291dHJvLmVuZCgpOwoJCX0KCX07Cn0KCi8vICgzMDo4KSB7I2VhY2ggT2JqZWN0LmVudHJpZXMoc25hY2tiYXIuYWN0aW9ucykgYXMgW2tleSwgYWN0aW9uXX0KZnVuY3Rpb24gY3JlYXRlX2VhY2hfYmxvY2skMShjdHgpIHsKCWxldCBidXR0b247CglsZXQgdF92YWx1ZSA9IC8qa2V5Ki8gY3R4WzddICsgIiI7CglsZXQgdDsKCWxldCBtb3VudGVkOwoJbGV0IGRpc3Bvc2U7CgoJZnVuY3Rpb24gY2xpY2tfaGFuZGxlcigpIHsKCQlyZXR1cm4gLypjbGlja19oYW5kbGVyKi8gY3R4WzRdKC8qYWN0aW9uKi8gY3R4WzhdKTsKCX0KCglyZXR1cm4gewoJCWMoKSB7CgkJCWJ1dHRvbiA9IGVsZW1lbnQoImJ1dHRvbiIpOwoJCQl0ID0gdGV4dCh0X3ZhbHVlKTsKCQkJYXR0cihidXR0b24sICJjbGFzcyIsICJhY3Rpb24gbTMtZm9udC1sYWJlbC1sYXJnZSBzdmVsdGUta2R6cHlnIik7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIGJ1dHRvbiwgYW5jaG9yKTsKCQkJYXBwZW5kKGJ1dHRvbiwgdCk7CgoJCQlpZiAoIW1vdW50ZWQpIHsKCQkJCWRpc3Bvc2UgPSBsaXN0ZW4oYnV0dG9uLCAiY2xpY2siLCBjbGlja19oYW5kbGVyKTsKCQkJCW1vdW50ZWQgPSB0cnVlOwoJCQl9CgkJfSwKCQlwKG5ld19jdHgsIGRpcnR5KSB7CgkJCWN0eCA9IG5ld19jdHg7CgkJCWlmIChkaXJ0eSAmIC8qc25hY2tiYXIqLyA0ICYmIHRfdmFsdWUgIT09ICh0X3ZhbHVlID0gLyprZXkqLyBjdHhbN10gKyAiIikpIHNldF9kYXRhKHQsIHRfdmFsdWUpOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGJ1dHRvbik7CgkJCX0KCgkJCW1vdW50ZWQgPSBmYWxzZTsKCQkJZGlzcG9zZSgpOwoJCX0KCX07Cn0KCi8vICg0MTo4KSB7I2lmIHNuYWNrYmFyLmNsb3NhYmxlfQpmdW5jdGlvbiBjcmVhdGVfaWZfYmxvY2tfMSQyKGN0eCkgewoJbGV0IGJ1dHRvbjsKCWxldCBpY29uOwoJbGV0IGN1cnJlbnQ7CglsZXQgbW91bnRlZDsKCWxldCBkaXNwb3NlOwoJaWNvbiA9IG5ldyBJY29uKHsgcHJvcHM6IHsgaWNvbjogZGF0YSQyIH0gfSk7CgoJcmV0dXJuIHsKCQljKCkgewoJCQlidXR0b24gPSBlbGVtZW50KCJidXR0b24iKTsKCQkJY3JlYXRlX2NvbXBvbmVudChpY29uLiQkLmZyYWdtZW50KTsKCQkJYXR0cihidXR0b24sICJjbGFzcyIsICJjbG9zZSBzdmVsdGUta2R6cHlnIik7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIGJ1dHRvbiwgYW5jaG9yKTsKCQkJbW91bnRfY29tcG9uZW50KGljb24sIGJ1dHRvbiwgbnVsbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoKCQkJaWYgKCFtb3VudGVkKSB7CgkJCQlkaXNwb3NlID0gbGlzdGVuKGJ1dHRvbiwgImNsaWNrIiwgLypjbGlja19oYW5kbGVyXzEqLyBjdHhbNV0pOwoJCQkJbW91bnRlZCA9IHRydWU7CgkJCX0KCQl9LAoJCXA6IG5vb3AkNCwKCQlpKGxvY2FsKSB7CgkJCWlmIChjdXJyZW50KSByZXR1cm47CgkJCXRyYW5zaXRpb25faW4oaWNvbi4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoaWNvbi4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gZmFsc2U7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2goYnV0dG9uKTsKCQkJfQoKCQkJZGVzdHJveV9jb21wb25lbnQoaWNvbik7CgkJCW1vdW50ZWQgPSBmYWxzZTsKCQkJZGlzcG9zZSgpOwoJCX0KCX07Cn0KCi8vICgyODo2KSA8U25hY2tiYXJJdGVtIHsuLi5leHRyYU9wdGlvbnN9PgpmdW5jdGlvbiBjcmVhdGVfZGVmYXVsdF9zbG90JDIoY3R4KSB7CglsZXQgcDsKCWxldCB0MF92YWx1ZSA9IC8qc25hY2tiYXIqLyBjdHhbMl0ubWVzc2FnZSArICIiOwoJbGV0IHQwOwoJbGV0IHQxOwoJbGV0IHQyOwoJbGV0IGlmX2Jsb2NrX2FuY2hvcjsKCWxldCBjdXJyZW50OwoJbGV0IGVhY2hfdmFsdWUgPSBlbnN1cmVfYXJyYXlfbGlrZShPYmplY3QuZW50cmllcygvKnNuYWNrYmFyKi8gY3R4WzJdLmFjdGlvbnMpKTsKCWxldCBlYWNoX2Jsb2NrcyA9IFtdOwoKCWZvciAobGV0IGkgPSAwOyBpIDwgZWFjaF92YWx1ZS5sZW5ndGg7IGkgKz0gMSkgewoJCWVhY2hfYmxvY2tzW2ldID0gY3JlYXRlX2VhY2hfYmxvY2skMShnZXRfZWFjaF9jb250ZXh0JDEoY3R4LCBlYWNoX3ZhbHVlLCBpKSk7Cgl9CgoJbGV0IGlmX2Jsb2NrID0gLypzbmFja2JhciovIGN0eFsyXS5jbG9zYWJsZSAmJiBjcmVhdGVfaWZfYmxvY2tfMSQyKGN0eCk7CgoJcmV0dXJuIHsKCQljKCkgewoJCQlwID0gZWxlbWVudCgicCIpOwoJCQl0MCA9IHRleHQodDBfdmFsdWUpOwoJCQl0MSA9IHNwYWNlKCk7CgoJCQlmb3IgKGxldCBpID0gMDsgaSA8IGVhY2hfYmxvY2tzLmxlbmd0aDsgaSArPSAxKSB7CgkJCQllYWNoX2Jsb2Nrc1tpXS5jKCk7CgkJCX0KCgkJCXQyID0gc3BhY2UoKTsKCQkJaWYgKGlmX2Jsb2NrKSBpZl9ibG9jay5jKCk7CgkJCWlmX2Jsb2NrX2FuY2hvciA9IGVtcHR5KCk7CgkJCWF0dHIocCwgImNsYXNzIiwgIm0zLWZvbnQtYm9keS1tZWRpdW0gc3ZlbHRlLWtkenB5ZyIpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBwLCBhbmNob3IpOwoJCQlhcHBlbmQocCwgdDApOwoJCQlpbnNlcnQodGFyZ2V0LCB0MSwgYW5jaG9yKTsKCgkJCWZvciAobGV0IGkgPSAwOyBpIDwgZWFjaF9ibG9ja3MubGVuZ3RoOyBpICs9IDEpIHsKCQkJCWlmIChlYWNoX2Jsb2Nrc1tpXSkgewoJCQkJCWVhY2hfYmxvY2tzW2ldLm0odGFyZ2V0LCBhbmNob3IpOwoJCQkJfQoJCQl9CgoJCQlpbnNlcnQodGFyZ2V0LCB0MiwgYW5jaG9yKTsKCQkJaWYgKGlmX2Jsb2NrKSBpZl9ibG9jay5tKHRhcmdldCwgYW5jaG9yKTsKCQkJaW5zZXJ0KHRhcmdldCwgaWZfYmxvY2tfYW5jaG9yLCBhbmNob3IpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCXAoY3R4LCBkaXJ0eSkgewoJCQlpZiAoKCFjdXJyZW50IHx8IGRpcnR5ICYgLypzbmFja2JhciovIDQpICYmIHQwX3ZhbHVlICE9PSAodDBfdmFsdWUgPSAvKnNuYWNrYmFyKi8gY3R4WzJdLm1lc3NhZ2UgKyAiIikpIHNldF9kYXRhKHQwLCB0MF92YWx1ZSk7CgoJCQlpZiAoZGlydHkgJiAvKnNuYWNrYmFyLCB1bmRlZmluZWQsIE9iamVjdCovIDQpIHsKCQkJCWVhY2hfdmFsdWUgPSBlbnN1cmVfYXJyYXlfbGlrZShPYmplY3QuZW50cmllcygvKnNuYWNrYmFyKi8gY3R4WzJdLmFjdGlvbnMpKTsKCQkJCWxldCBpOwoKCQkJCWZvciAoaSA9IDA7IGkgPCBlYWNoX3ZhbHVlLmxlbmd0aDsgaSArPSAxKSB7CgkJCQkJY29uc3QgY2hpbGRfY3R4ID0gZ2V0X2VhY2hfY29udGV4dCQxKGN0eCwgZWFjaF92YWx1ZSwgaSk7CgoJCQkJCWlmIChlYWNoX2Jsb2Nrc1tpXSkgewoJCQkJCQllYWNoX2Jsb2Nrc1tpXS5wKGNoaWxkX2N0eCwgZGlydHkpOwoJCQkJCX0gZWxzZSB7CgkJCQkJCWVhY2hfYmxvY2tzW2ldID0gY3JlYXRlX2VhY2hfYmxvY2skMShjaGlsZF9jdHgpOwoJCQkJCQllYWNoX2Jsb2Nrc1tpXS5jKCk7CgkJCQkJCWVhY2hfYmxvY2tzW2ldLm0odDIucGFyZW50Tm9kZSwgdDIpOwoJCQkJCX0KCQkJCX0KCgkJCQlmb3IgKDsgaSA8IGVhY2hfYmxvY2tzLmxlbmd0aDsgaSArPSAxKSB7CgkJCQkJZWFjaF9ibG9ja3NbaV0uZCgxKTsKCQkJCX0KCgkJCQllYWNoX2Jsb2Nrcy5sZW5ndGggPSBlYWNoX3ZhbHVlLmxlbmd0aDsKCQkJfQoKCQkJaWYgKC8qc25hY2tiYXIqLyBjdHhbMl0uY2xvc2FibGUpIHsKCQkJCWlmIChpZl9ibG9jaykgewoJCQkJCWlmX2Jsb2NrLnAoY3R4LCBkaXJ0eSk7CgoJCQkJCWlmIChkaXJ0eSAmIC8qc25hY2tiYXIqLyA0KSB7CgkJCQkJCXRyYW5zaXRpb25faW4oaWZfYmxvY2ssIDEpOwoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJaWZfYmxvY2sgPSBjcmVhdGVfaWZfYmxvY2tfMSQyKGN0eCk7CgkJCQkJaWZfYmxvY2suYygpOwoJCQkJCXRyYW5zaXRpb25faW4oaWZfYmxvY2ssIDEpOwoJCQkJCWlmX2Jsb2NrLm0oaWZfYmxvY2tfYW5jaG9yLnBhcmVudE5vZGUsIGlmX2Jsb2NrX2FuY2hvcik7CgkJCQl9CgkJCX0gZWxzZSBpZiAoaWZfYmxvY2spIHsKCQkJCWdyb3VwX291dHJvcygpOwoKCQkJCXRyYW5zaXRpb25fb3V0KGlmX2Jsb2NrLCAxLCAxLCAoKSA9PiB7CgkJCQkJaWZfYmxvY2sgPSBudWxsOwoJCQkJfSk7CgoJCQkJY2hlY2tfb3V0cm9zKCk7CgkJCX0KCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihpZl9ibG9jayk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dChpZl9ibG9jayk7CgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChwKTsKCQkJCWRldGFjaCh0MSk7CgkJCQlkZXRhY2godDIpOwoJCQkJZGV0YWNoKGlmX2Jsb2NrX2FuY2hvcik7CgkJCX0KCgkJCWRlc3Ryb3lfZWFjaChlYWNoX2Jsb2NrcywgZGV0YWNoaW5nKTsKCQkJaWYgKGlmX2Jsb2NrKSBpZl9ibG9jay5kKGRldGFjaGluZyk7CgkJfQoJfTsKfQoKLy8gKDI3OjQpIHsja2V5IHNuYWNrYmFyfQpmdW5jdGlvbiBjcmVhdGVfa2V5X2Jsb2NrKGN0eCkgewoJbGV0IHNuYWNrYmFyaXRlbTsKCWxldCBjdXJyZW50OwoJY29uc3Qgc25hY2tiYXJpdGVtX3NwcmVhZF9sZXZlbHMgPSBbLypleHRyYU9wdGlvbnMqLyBjdHhbMV1dOwoKCWxldCBzbmFja2Jhcml0ZW1fcHJvcHMgPSB7CgkJJCRzbG90czogeyBkZWZhdWx0OiBbY3JlYXRlX2RlZmF1bHRfc2xvdCQyXSB9LAoJCSQkc2NvcGU6IHsgY3R4IH0KCX07CgoJZm9yIChsZXQgaSA9IDA7IGkgPCBzbmFja2Jhcml0ZW1fc3ByZWFkX2xldmVscy5sZW5ndGg7IGkgKz0gMSkgewoJCXNuYWNrYmFyaXRlbV9wcm9wcyA9IGFzc2lnbihzbmFja2Jhcml0ZW1fcHJvcHMsIHNuYWNrYmFyaXRlbV9zcHJlYWRfbGV2ZWxzW2ldKTsKCX0KCglzbmFja2Jhcml0ZW0gPSBuZXcgU25hY2tiYXJJdGVtJDEoeyBwcm9wczogc25hY2tiYXJpdGVtX3Byb3BzIH0pOwoKCXJldHVybiB7CgkJYygpIHsKCQkJY3JlYXRlX2NvbXBvbmVudChzbmFja2Jhcml0ZW0uJCQuZnJhZ21lbnQpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQltb3VudF9jb21wb25lbnQoc25hY2tiYXJpdGVtLCB0YXJnZXQsIGFuY2hvcik7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJcChjdHgsIGRpcnR5KSB7CgkJCWNvbnN0IHNuYWNrYmFyaXRlbV9jaGFuZ2VzID0gKGRpcnR5ICYgLypleHRyYU9wdGlvbnMqLyAyKQoJCQk/IGdldF9zcHJlYWRfdXBkYXRlKHNuYWNrYmFyaXRlbV9zcHJlYWRfbGV2ZWxzLCBbZ2V0X3NwcmVhZF9vYmplY3QoLypleHRyYU9wdGlvbnMqLyBjdHhbMV0pXSkKCQkJOiB7fTsKCgkJCWlmIChkaXJ0eSAmIC8qJCRzY29wZSwgc25hY2tiYXIqLyAyMDUyKSB7CgkJCQlzbmFja2Jhcml0ZW1fY2hhbmdlcy4kJHNjb3BlID0geyBkaXJ0eSwgY3R4IH07CgkJCX0KCgkJCXNuYWNrYmFyaXRlbS4kc2V0KHNuYWNrYmFyaXRlbV9jaGFuZ2VzKTsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihzbmFja2Jhcml0ZW0uJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlvKGxvY2FsKSB7CgkJCXRyYW5zaXRpb25fb3V0KHNuYWNrYmFyaXRlbS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gZmFsc2U7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlkZXN0cm95X2NvbXBvbmVudChzbmFja2Jhcml0ZW0sIGRldGFjaGluZyk7CgkJfQoJfTsKfQoKZnVuY3Rpb24gY3JlYXRlX2ZyYWdtZW50JDUoY3R4KSB7CglsZXQgaWZfYmxvY2tfYW5jaG9yOwoJbGV0IGN1cnJlbnQ7CglsZXQgaWZfYmxvY2sgPSAvKnNuYWNrYmFyKi8gY3R4WzJdICYmIGNyZWF0ZV9pZl9ibG9jayQyKGN0eCk7CgoJcmV0dXJuIHsKCQljKCkgewoJCQlpZiAoaWZfYmxvY2spIGlmX2Jsb2NrLmMoKTsKCQkJaWZfYmxvY2tfYW5jaG9yID0gZW1wdHkoKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaWYgKGlmX2Jsb2NrKSBpZl9ibG9jay5tKHRhcmdldCwgYW5jaG9yKTsKCQkJaW5zZXJ0KHRhcmdldCwgaWZfYmxvY2tfYW5jaG9yLCBhbmNob3IpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCXAoY3R4LCBbZGlydHldKSB7CgkJCWlmICgvKnNuYWNrYmFyKi8gY3R4WzJdKSB7CgkJCQlpZiAoaWZfYmxvY2spIHsKCQkJCQlpZl9ibG9jay5wKGN0eCwgZGlydHkpOwoKCQkJCQlpZiAoZGlydHkgJiAvKnNuYWNrYmFyKi8gNCkgewoJCQkJCQl0cmFuc2l0aW9uX2luKGlmX2Jsb2NrLCAxKTsKCQkJCQl9CgkJCQl9IGVsc2UgewoJCQkJCWlmX2Jsb2NrID0gY3JlYXRlX2lmX2Jsb2NrJDIoY3R4KTsKCQkJCQlpZl9ibG9jay5jKCk7CgkJCQkJdHJhbnNpdGlvbl9pbihpZl9ibG9jaywgMSk7CgkJCQkJaWZfYmxvY2subShpZl9ibG9ja19hbmNob3IucGFyZW50Tm9kZSwgaWZfYmxvY2tfYW5jaG9yKTsKCQkJCX0KCQkJfSBlbHNlIGlmIChpZl9ibG9jaykgewoJCQkJZ3JvdXBfb3V0cm9zKCk7CgoJCQkJdHJhbnNpdGlvbl9vdXQoaWZfYmxvY2ssIDEsIDEsICgpID0+IHsKCQkJCQlpZl9ibG9jayA9IG51bGw7CgkJCQl9KTsKCgkJCQljaGVja19vdXRyb3MoKTsKCQkJfQoJCX0sCgkJaShsb2NhbCkgewoJCQlpZiAoY3VycmVudCkgcmV0dXJuOwoJCQl0cmFuc2l0aW9uX2luKGlmX2Jsb2NrKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlvKGxvY2FsKSB7CgkJCXRyYW5zaXRpb25fb3V0KGlmX2Jsb2NrKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGlmX2Jsb2NrX2FuY2hvcik7CgkJCX0KCgkJCWlmIChpZl9ibG9jaykgaWZfYmxvY2suZChkZXRhY2hpbmcpOwoJCX0KCX07Cn0KCmZ1bmN0aW9uIGluc3RhbmNlJDUoJCRzZWxmLCAkJHByb3BzLCAkJGludmFsaWRhdGUpIHsKCWxldCB7IGV4dHJhV3JhcHBlck9wdGlvbnMgPSB7fSB9ID0gJCRwcm9wczsKCWxldCB7IGV4dHJhT3B0aW9ucyA9IHt9IH0gPSAkJHByb3BzOwoKCWNvbnN0IHNob3cgPSAoeyBtZXNzYWdlLCBhY3Rpb25zID0ge30sIGNsb3NhYmxlID0gZmFsc2UsIHRpbWVvdXQgPSA0ZTMgfSkgPT4gewoJCSQkaW52YWxpZGF0ZSgyLCBzbmFja2JhciA9IHsgbWVzc2FnZSwgYWN0aW9ucywgY2xvc2FibGUsIHRpbWVvdXQgfSk7CgkJY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7CgoJCWlmICh0aW1lb3V0KSB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KAoJCQkoKSA9PiB7CgkJCQkkJGludmFsaWRhdGUoMiwgc25hY2tiYXIgPSB2b2lkIDApOwoJCQl9LAoJCQl0aW1lb3V0CgkJKTsKCX07CgoJbGV0IHNuYWNrYmFyOwoJbGV0IHRpbWVvdXRJZDsKCglvbkRlc3Ryb3koKCkgPT4gewoJCWNsZWFyVGltZW91dCh0aW1lb3V0SWQpOwoJfSk7CgoJY29uc3QgY2xpY2tfaGFuZGxlciA9IGFjdGlvbiA9PiB7CgkJJCRpbnZhbGlkYXRlKDIsIHNuYWNrYmFyID0gdW5kZWZpbmVkKTsKCQlhY3Rpb24oKTsKCX07CgoJY29uc3QgY2xpY2tfaGFuZGxlcl8xID0gKCkgPT4gewoJCSQkaW52YWxpZGF0ZSgyLCBzbmFja2JhciA9IHVuZGVmaW5lZCk7Cgl9OwoKCSQkc2VsZi4kJHNldCA9ICQkcHJvcHMgPT4gewoJCWlmICgnZXh0cmFXcmFwcGVyT3B0aW9ucycgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDAsIGV4dHJhV3JhcHBlck9wdGlvbnMgPSAkJHByb3BzLmV4dHJhV3JhcHBlck9wdGlvbnMpOwoJCWlmICgnZXh0cmFPcHRpb25zJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMSwgZXh0cmFPcHRpb25zID0gJCRwcm9wcy5leHRyYU9wdGlvbnMpOwoJfTsKCglyZXR1cm4gWwoJCWV4dHJhV3JhcHBlck9wdGlvbnMsCgkJZXh0cmFPcHRpb25zLAoJCXNuYWNrYmFyLAoJCXNob3csCgkJY2xpY2tfaGFuZGxlciwKCQljbGlja19oYW5kbGVyXzEKCV07Cn0KCmNsYXNzIFNuYWNrYmFyQW5pbSBleHRlbmRzIFN2ZWx0ZUNvbXBvbmVudCB7Cgljb25zdHJ1Y3RvcihvcHRpb25zKSB7CgkJc3VwZXIoKTsKCgkJaW5pdCh0aGlzLCBvcHRpb25zLCBpbnN0YW5jZSQ1LCBjcmVhdGVfZnJhZ21lbnQkNSwgc2FmZV9ub3RfZXF1YWwsIHsKCQkJZXh0cmFXcmFwcGVyT3B0aW9uczogMCwKCQkJZXh0cmFPcHRpb25zOiAxLAoJCQlzaG93OiAzCgkJfSk7Cgl9CgoJZ2V0IHNob3coKSB7CgkJcmV0dXJuIHRoaXMuJCQuY3R4WzNdOwoJfQp9Cgpjb25zdCBTbmFja2JhckFuaW0kMSA9IFNuYWNrYmFyQW5pbTsKCmNvbnN0IENpcmN1bGFyUHJvZ3Jlc3NJbmRldGVybWluYXRlX3N2ZWx0ZV9zdmVsdGVfdHlwZV9zdHlsZV9sYW5nID0gJyc7CgovKiBob21lL2NlL0RvY3VtZW50cy9HaXRIdWIvYWRyaWZ0L25vZGVfbW9kdWxlcy8ucG5wbS9tMy1zdmVsdGVAMi4wLjMvbm9kZV9tb2R1bGVzL20zLXN2ZWx0ZS9wYWNrYWdlL2Zvcm1zL0NpcmN1bGFyUHJvZ3Jlc3NJbmRldGVybWluYXRlLnN2ZWx0ZSBnZW5lcmF0ZWQgYnkgU3ZlbHRlIHY0LjIuMCAqLwoKZnVuY3Rpb24gY3JlYXRlX2ZyYWdtZW50JDQoY3R4KSB7CglsZXQgc3ZnOwoJbGV0IGNpcmNsZTsKCWxldCBzdmdfc3R5bGVfdmFsdWU7CgoJbGV0IHN2Z19sZXZlbHMgPSBbCgkJeyB2aWV3Qm94OiAiMCAwIDQ4IDQ4IiB9LAoJCXsgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgfSwKCQl7IGNsYXNzOiAibTMtY29udGFpbmVyIiB9LAoJCXsKCQkJc3R5bGU6IHN2Z19zdHlsZV92YWx1ZSA9ICJkaXNwbGF5OiAiICsgLypkaXNwbGF5Ki8gY3R4WzBdICsgIjsiCgkJfSwKCQl7IHJvbGU6ICJwcm9ncmVzc2JhciIgfSwKCQkvKmV4dHJhT3B0aW9ucyovIGN0eFsxXQoJXTsKCglsZXQgc3ZnX2RhdGEgPSB7fTsKCglmb3IgKGxldCBpID0gMDsgaSA8IHN2Z19sZXZlbHMubGVuZ3RoOyBpICs9IDEpIHsKCQlzdmdfZGF0YSA9IGFzc2lnbihzdmdfZGF0YSwgc3ZnX2xldmVsc1tpXSk7Cgl9CgoJcmV0dXJuIHsKCQljKCkgewoJCQlzdmcgPSBzdmdfZWxlbWVudCgic3ZnIik7CgkJCWNpcmNsZSA9IHN2Z19lbGVtZW50KCJjaXJjbGUiKTsKCQkJYXR0cihjaXJjbGUsICJjeCIsICIyNCIpOwoJCQlhdHRyKGNpcmNsZSwgImN5IiwgIjI0Iik7CgkJCWF0dHIoY2lyY2xlLCAiciIsICIyMCIpOwoJCQlhdHRyKGNpcmNsZSwgInN0cm9rZSIsICJyZ2IodmFyKC0tbTMtc2NoZW1lLXByaW1hcnkpKSIpOwoJCQlhdHRyKGNpcmNsZSwgInN0cm9rZS13aWR0aCIsICI0Iik7CgkJCWF0dHIoY2lyY2xlLCAic3Ryb2tlLWRhc2hhcnJheSIsICIxMjUuNjYgMTI1LjY2Iik7CgkJCWF0dHIoY2lyY2xlLCAiZmlsbCIsICJub25lIik7CgkJCWF0dHIoY2lyY2xlLCAiY2xhc3MiLCAic3ZlbHRlLTFscnhyaG0iKTsKCQkJc2V0X3N2Z19hdHRyaWJ1dGVzKHN2Zywgc3ZnX2RhdGEpOwoJCQl0b2dnbGVfY2xhc3Moc3ZnLCAic3ZlbHRlLTFscnhyaG0iLCB0cnVlKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgc3ZnLCBhbmNob3IpOwoJCQlhcHBlbmQoc3ZnLCBjaXJjbGUpOwoJCX0sCgkJcChjdHgsIFtkaXJ0eV0pIHsKCQkJc2V0X3N2Z19hdHRyaWJ1dGVzKHN2Zywgc3ZnX2RhdGEgPSBnZXRfc3ByZWFkX3VwZGF0ZShzdmdfbGV2ZWxzLCBbCgkJCQl7IHZpZXdCb3g6ICIwIDAgNDggNDgiIH0sCgkJCQl7IHhtbG5zOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIH0sCgkJCQl7IGNsYXNzOiAibTMtY29udGFpbmVyIiB9LAoJCQkJZGlydHkgJiAvKmRpc3BsYXkqLyAxICYmIHN2Z19zdHlsZV92YWx1ZSAhPT0gKHN2Z19zdHlsZV92YWx1ZSA9ICJkaXNwbGF5OiAiICsgLypkaXNwbGF5Ki8gY3R4WzBdICsgIjsiKSAmJiB7IHN0eWxlOiBzdmdfc3R5bGVfdmFsdWUgfSwKCQkJCXsgcm9sZTogInByb2dyZXNzYmFyIiB9LAoJCQkJZGlydHkgJiAvKmV4dHJhT3B0aW9ucyovIDIgJiYgLypleHRyYU9wdGlvbnMqLyBjdHhbMV0KCQkJXSkpOwoKCQkJdG9nZ2xlX2NsYXNzKHN2ZywgInN2ZWx0ZS0xbHJ4cmhtIiwgdHJ1ZSk7CgkJfSwKCQlpOiBub29wJDQsCgkJbzogbm9vcCQ0LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChzdmcpOwoJCQl9CgkJfQoJfTsKfQoKZnVuY3Rpb24gaW5zdGFuY2UkNCgkJHNlbGYsICQkcHJvcHMsICQkaW52YWxpZGF0ZSkgewoJbGV0IHsgZGlzcGxheSA9ICJpbmxpbmUtZmxleCIgfSA9ICQkcHJvcHM7CglsZXQgeyBleHRyYU9wdGlvbnMgPSB7fSB9ID0gJCRwcm9wczsKCgkkJHNlbGYuJCRzZXQgPSAkJHByb3BzID0+IHsKCQlpZiAoJ2Rpc3BsYXknIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgwLCBkaXNwbGF5ID0gJCRwcm9wcy5kaXNwbGF5KTsKCQlpZiAoJ2V4dHJhT3B0aW9ucycgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDEsIGV4dHJhT3B0aW9ucyA9ICQkcHJvcHMuZXh0cmFPcHRpb25zKTsKCX07CgoJcmV0dXJuIFtkaXNwbGF5LCBleHRyYU9wdGlvbnNdOwp9CgpjbGFzcyBDaXJjdWxhclByb2dyZXNzSW5kZXRlcm1pbmF0ZSBleHRlbmRzIFN2ZWx0ZUNvbXBvbmVudCB7Cgljb25zdHJ1Y3RvcihvcHRpb25zKSB7CgkJc3VwZXIoKTsKCQlpbml0KHRoaXMsIG9wdGlvbnMsIGluc3RhbmNlJDQsIGNyZWF0ZV9mcmFnbWVudCQ0LCBzYWZlX25vdF9lcXVhbCwgeyBkaXNwbGF5OiAwLCBleHRyYU9wdGlvbnM6IDEgfSk7Cgl9Cn0KCmNvbnN0IENpcmN1bGFyUHJvZ3Jlc3NJbmRldGVybWluYXRlJDEgPSBDaXJjdWxhclByb2dyZXNzSW5kZXRlcm1pbmF0ZTsKCmNvbnN0IFJhZGlvQW5pbTNfc3ZlbHRlX3N2ZWx0ZV90eXBlX3N0eWxlX2xhbmcgPSAnJzsKCi8qIGhvbWUvY2UvRG9jdW1lbnRzL0dpdEh1Yi9hZHJpZnQvbm9kZV9tb2R1bGVzLy5wbnBtL20zLXN2ZWx0ZUAyLjAuMy9ub2RlX21vZHVsZXMvbTMtc3ZlbHRlL3BhY2thZ2UvZm9ybXMvUmFkaW9BbmltMy5zdmVsdGUgZ2VuZXJhdGVkIGJ5IFN2ZWx0ZSB2NC4yLjAgKi8KCmZ1bmN0aW9uIGNyZWF0ZV9mcmFnbWVudCQzKGN0eCkgewoJbGV0IGRpdjE7CglsZXQgdDsKCWxldCBkaXYwOwoJbGV0IGRpdjFfc3R5bGVfdmFsdWU7CglsZXQgY3VycmVudDsKCWNvbnN0IGRlZmF1bHRfc2xvdF90ZW1wbGF0ZSA9IC8qI3Nsb3RzKi8gY3R4WzNdLmRlZmF1bHQ7Cgljb25zdCBkZWZhdWx0X3Nsb3QgPSBjcmVhdGVfc2xvdChkZWZhdWx0X3Nsb3RfdGVtcGxhdGUsIGN0eCwgLyokJHNjb3BlKi8gY3R4WzJdLCBudWxsKTsKCglsZXQgZGl2MV9sZXZlbHMgPSBbCgkJeyBjbGFzczogIm0zLWNvbnRhaW5lciIgfSwKCQl7CgkJCXN0eWxlOiBkaXYxX3N0eWxlX3ZhbHVlID0gImRpc3BsYXk6ICIgKyAvKmRpc3BsYXkqLyBjdHhbMF0gKyAiOyIKCQl9LAoJCS8qZXh0cmFPcHRpb25zKi8gY3R4WzFdCgldOwoKCWxldCBkaXZfZGF0YV8xID0ge307CgoJZm9yIChsZXQgaSA9IDA7IGkgPCBkaXYxX2xldmVscy5sZW5ndGg7IGkgKz0gMSkgewoJCWRpdl9kYXRhXzEgPSBhc3NpZ24oZGl2X2RhdGFfMSwgZGl2MV9sZXZlbHNbaV0pOwoJfQoKCXJldHVybiB7CgkJYygpIHsKCQkJZGl2MSA9IGVsZW1lbnQoImRpdiIpOwoJCQlpZiAoZGVmYXVsdF9zbG90KSBkZWZhdWx0X3Nsb3QuYygpOwoJCQl0ID0gc3BhY2UoKTsKCQkJZGl2MCA9IGVsZW1lbnQoImRpdiIpOwoJCQlhdHRyKGRpdjAsICJjbGFzcyIsICJsYXllciBzdmVsdGUtMXVxZjcwdSIpOwoJCQlzZXRfYXR0cmlidXRlcyhkaXYxLCBkaXZfZGF0YV8xKTsKCQkJdG9nZ2xlX2NsYXNzKGRpdjEsICJzdmVsdGUtMXVxZjcwdSIsIHRydWUpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBkaXYxLCBhbmNob3IpOwoKCQkJaWYgKGRlZmF1bHRfc2xvdCkgewoJCQkJZGVmYXVsdF9zbG90Lm0oZGl2MSwgbnVsbCk7CgkJCX0KCgkJCWFwcGVuZChkaXYxLCB0KTsKCQkJYXBwZW5kKGRpdjEsIGRpdjApOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCXAoY3R4LCBbZGlydHldKSB7CgkJCWlmIChkZWZhdWx0X3Nsb3QpIHsKCQkJCWlmIChkZWZhdWx0X3Nsb3QucCAmJiAoIWN1cnJlbnQgfHwgZGlydHkgJiAvKiQkc2NvcGUqLyA0KSkgewoJCQkJCXVwZGF0ZV9zbG90X2Jhc2UoCgkJCQkJCWRlZmF1bHRfc2xvdCwKCQkJCQkJZGVmYXVsdF9zbG90X3RlbXBsYXRlLAoJCQkJCQljdHgsCgkJCQkJCS8qJCRzY29wZSovIGN0eFsyXSwKCQkJCQkJIWN1cnJlbnQKCQkJCQkJPyBnZXRfYWxsX2RpcnR5X2Zyb21fc2NvcGUoLyokJHNjb3BlKi8gY3R4WzJdKQoJCQkJCQk6IGdldF9zbG90X2NoYW5nZXMoZGVmYXVsdF9zbG90X3RlbXBsYXRlLCAvKiQkc2NvcGUqLyBjdHhbMl0sIGRpcnR5LCBudWxsKSwKCQkJCQkJbnVsbAoJCQkJCSk7CgkJCQl9CgkJCX0KCgkJCXNldF9hdHRyaWJ1dGVzKGRpdjEsIGRpdl9kYXRhXzEgPSBnZXRfc3ByZWFkX3VwZGF0ZShkaXYxX2xldmVscywgWwoJCQkJeyBjbGFzczogIm0zLWNvbnRhaW5lciIgfSwKCQkJCSghY3VycmVudCB8fCBkaXJ0eSAmIC8qZGlzcGxheSovIDEgJiYgZGl2MV9zdHlsZV92YWx1ZSAhPT0gKGRpdjFfc3R5bGVfdmFsdWUgPSAiZGlzcGxheTogIiArIC8qZGlzcGxheSovIGN0eFswXSArICI7IikpICYmIHsgc3R5bGU6IGRpdjFfc3R5bGVfdmFsdWUgfSwKCQkJCWRpcnR5ICYgLypleHRyYU9wdGlvbnMqLyAyICYmIC8qZXh0cmFPcHRpb25zKi8gY3R4WzFdCgkJCV0pKTsKCgkJCXRvZ2dsZV9jbGFzcyhkaXYxLCAic3ZlbHRlLTF1cWY3MHUiLCB0cnVlKTsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihkZWZhdWx0X3Nsb3QsIGxvY2FsKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlvKGxvY2FsKSB7CgkJCXRyYW5zaXRpb25fb3V0KGRlZmF1bHRfc2xvdCwgbG9jYWwpOwoJCQljdXJyZW50ID0gZmFsc2U7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2goZGl2MSk7CgkJCX0KCgkJCWlmIChkZWZhdWx0X3Nsb3QpIGRlZmF1bHRfc2xvdC5kKGRldGFjaGluZyk7CgkJfQoJfTsKfQoKZnVuY3Rpb24gaW5zdGFuY2UkMygkJHNlbGYsICQkcHJvcHMsICQkaW52YWxpZGF0ZSkgewoJbGV0IHsgJCRzbG90czogc2xvdHMgPSB7fSwgJCRzY29wZSB9ID0gJCRwcm9wczsKCWxldCB7IGRpc3BsYXkgPSAiaW5saW5lLWZsZXgiIH0gPSAkJHByb3BzOwoJbGV0IHsgZXh0cmFPcHRpb25zID0ge30gfSA9ICQkcHJvcHM7CgoJJCRzZWxmLiQkc2V0ID0gJCRwcm9wcyA9PiB7CgkJaWYgKCdkaXNwbGF5JyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMCwgZGlzcGxheSA9ICQkcHJvcHMuZGlzcGxheSk7CgkJaWYgKCdleHRyYU9wdGlvbnMnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgxLCBleHRyYU9wdGlvbnMgPSAkJHByb3BzLmV4dHJhT3B0aW9ucyk7CgkJaWYgKCckJHNjb3BlJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMiwgJCRzY29wZSA9ICQkcHJvcHMuJCRzY29wZSk7Cgl9OwoKCXJldHVybiBbZGlzcGxheSwgZXh0cmFPcHRpb25zLCAkJHNjb3BlLCBzbG90c107Cn0KCmNsYXNzIFJhZGlvQW5pbTMgZXh0ZW5kcyBTdmVsdGVDb21wb25lbnQgewoJY29uc3RydWN0b3Iob3B0aW9ucykgewoJCXN1cGVyKCk7CgkJaW5pdCh0aGlzLCBvcHRpb25zLCBpbnN0YW5jZSQzLCBjcmVhdGVfZnJhZ21lbnQkMywgc2FmZV9ub3RfZXF1YWwsIHsgZGlzcGxheTogMCwgZXh0cmFPcHRpb25zOiAxIH0pOwoJfQp9Cgpjb25zdCBSYWRpb0FuaW0zJDEgPSBSYWRpb0FuaW0zOwoKY29uc3QgVGV4dEZpZWxkX3N2ZWx0ZV9zdmVsdGVfdHlwZV9zdHlsZV9sYW5nID0gJyc7CgovKiBob21lL2NlL0RvY3VtZW50cy9HaXRIdWIvYWRyaWZ0L25vZGVfbW9kdWxlcy8ucG5wbS9tMy1zdmVsdGVAMi4wLjMvbm9kZV9tb2R1bGVzL20zLXN2ZWx0ZS9wYWNrYWdlL2Zvcm1zL1RleHRGaWVsZC5zdmVsdGUgZ2VuZXJhdGVkIGJ5IFN2ZWx0ZSB2NC4yLjAgKi8KCmZ1bmN0aW9uIGNyZWF0ZV9pZl9ibG9ja18xJDEoY3R4KSB7CglsZXQgaWNvbjsKCWxldCBjdXJyZW50OwoKCWljb24gPSBuZXcgSWNvbih7CgkJCXByb3BzOiB7CgkJCQlpY29uOiAvKmxlYWRpbmdJY29uKi8gY3R4WzVdLAoJCQkJY2xhc3M6ICJsZWFkaW5nIgoJCQl9CgkJfSk7CgoJcmV0dXJuIHsKCQljKCkgewoJCQljcmVhdGVfY29tcG9uZW50KGljb24uJCQuZnJhZ21lbnQpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQltb3VudF9jb21wb25lbnQoaWNvbiwgdGFyZ2V0LCBhbmNob3IpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCXAoY3R4LCBkaXJ0eSkgewoJCQljb25zdCBpY29uX2NoYW5nZXMgPSB7fTsKCQkJaWYgKGRpcnR5ICYgLypsZWFkaW5nSWNvbiovIDMyKSBpY29uX2NoYW5nZXMuaWNvbiA9IC8qbGVhZGluZ0ljb24qLyBjdHhbNV07CgkJCWljb24uJHNldChpY29uX2NoYW5nZXMpOwoJCX0sCgkJaShsb2NhbCkgewoJCQlpZiAoY3VycmVudCkgcmV0dXJuOwoJCQl0cmFuc2l0aW9uX2luKGljb24uJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlvKGxvY2FsKSB7CgkJCXRyYW5zaXRpb25fb3V0KGljb24uJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJZGVzdHJveV9jb21wb25lbnQoaWNvbiwgZGV0YWNoaW5nKTsKCQl9Cgl9Owp9CgovLyAoMjk6MikgeyNpZiB0cmFpbGluZ0ljb259CmZ1bmN0aW9uIGNyZWF0ZV9pZl9ibG9jayQxKGN0eCkgewoJbGV0IGJ1dHRvbjsKCWxldCBpY29uOwoJbGV0IGN1cnJlbnQ7CglsZXQgbW91bnRlZDsKCWxldCBkaXNwb3NlOwoJaWNvbiA9IG5ldyBJY29uKHsgcHJvcHM6IHsgaWNvbjogLyp0cmFpbGluZ0ljb24qLyBjdHhbNl0gfSB9KTsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWJ1dHRvbiA9IGVsZW1lbnQoImJ1dHRvbiIpOwoJCQljcmVhdGVfY29tcG9uZW50KGljb24uJCQuZnJhZ21lbnQpOwoJCQlhdHRyKGJ1dHRvbiwgImNsYXNzIiwgInRyYWlsaW5nIHN2ZWx0ZS1nYXYzankiKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgYnV0dG9uLCBhbmNob3IpOwoJCQltb3VudF9jb21wb25lbnQoaWNvbiwgYnV0dG9uLCBudWxsKTsKCQkJY3VycmVudCA9IHRydWU7CgoJCQlpZiAoIW1vdW50ZWQpIHsKCQkJCWRpc3Bvc2UgPSBsaXN0ZW4oYnV0dG9uLCAiY2xpY2siLCAvKmNsaWNrX2hhbmRsZXIqLyBjdHhbMTJdKTsKCQkJCW1vdW50ZWQgPSB0cnVlOwoJCQl9CgkJfSwKCQlwKGN0eCwgZGlydHkpIHsKCQkJY29uc3QgaWNvbl9jaGFuZ2VzID0ge307CgkJCWlmIChkaXJ0eSAmIC8qdHJhaWxpbmdJY29uKi8gNjQpIGljb25fY2hhbmdlcy5pY29uID0gLyp0cmFpbGluZ0ljb24qLyBjdHhbNl07CgkJCWljb24uJHNldChpY29uX2NoYW5nZXMpOwoJCX0sCgkJaShsb2NhbCkgewoJCQlpZiAoY3VycmVudCkgcmV0dXJuOwoJCQl0cmFuc2l0aW9uX2luKGljb24uJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlvKGxvY2FsKSB7CgkJCXRyYW5zaXRpb25fb3V0KGljb24uJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGJ1dHRvbik7CgkJCX0KCgkJCWRlc3Ryb3lfY29tcG9uZW50KGljb24pOwoJCQltb3VudGVkID0gZmFsc2U7CgkJCWRpc3Bvc2UoKTsKCQl9Cgl9Owp9CgpmdW5jdGlvbiBjcmVhdGVfZnJhZ21lbnQkMihjdHgpIHsKCWxldCBkaXYxOwoJbGV0IGlucHV0OwoJbGV0IHQwOwoJbGV0IGxhYmVsOwoJbGV0IHQxOwoJbGV0IHQyOwoJbGV0IGRpdjA7CglsZXQgdDM7CglsZXQgdDQ7CglsZXQgZGl2MV9zdHlsZV92YWx1ZTsKCWxldCBjdXJyZW50OwoJbGV0IG1vdW50ZWQ7CglsZXQgZGlzcG9zZTsKCglsZXQgaW5wdXRfbGV2ZWxzID0gWwoJCXsgY2xhc3M6ICJtMy1mb250LWJvZHktbGFyZ2UiIH0sCgkJeyBwbGFjZWhvbGRlcjogIiAiIH0sCgkJeyBpZDogLyppZCovIGN0eFsxMF0gfSwKCQl7IGRpc2FibGVkOiAvKmRpc2FibGVkKi8gY3R4WzddIH0sCgkJLypleHRyYU9wdGlvbnMqLyBjdHhbM10KCV07CgoJbGV0IGlucHV0X2RhdGEgPSB7fTsKCglmb3IgKGxldCBpID0gMDsgaSA8IGlucHV0X2xldmVscy5sZW5ndGg7IGkgKz0gMSkgewoJCWlucHV0X2RhdGEgPSBhc3NpZ24oaW5wdXRfZGF0YSwgaW5wdXRfbGV2ZWxzW2ldKTsKCX0KCglsZXQgaWZfYmxvY2swID0gLypsZWFkaW5nSWNvbiovIGN0eFs1XSAmJiBjcmVhdGVfaWZfYmxvY2tfMSQxKGN0eCk7CglsZXQgaWZfYmxvY2sxID0gLyp0cmFpbGluZ0ljb24qLyBjdHhbNl0gJiYgY3JlYXRlX2lmX2Jsb2NrJDEoY3R4KTsKCglsZXQgZGl2MV9sZXZlbHMgPSBbCgkJeyBjbGFzczogIm0zLWNvbnRhaW5lciIgfSwKCQl7CgkJCXN0eWxlOiBkaXYxX3N0eWxlX3ZhbHVlID0gImRpc3BsYXk6ICIgKyAvKmRpc3BsYXkqLyBjdHhbMV0KCQl9LAoJCS8qZXh0cmFXcmFwcGVyT3B0aW9ucyovIGN0eFsyXQoJXTsKCglsZXQgZGl2X2RhdGFfMSA9IHt9OwoKCWZvciAobGV0IGkgPSAwOyBpIDwgZGl2MV9sZXZlbHMubGVuZ3RoOyBpICs9IDEpIHsKCQlkaXZfZGF0YV8xID0gYXNzaWduKGRpdl9kYXRhXzEsIGRpdjFfbGV2ZWxzW2ldKTsKCX0KCglyZXR1cm4gewoJCWMoKSB7CgkJCWRpdjEgPSBlbGVtZW50KCJkaXYiKTsKCQkJaW5wdXQgPSBlbGVtZW50KCJpbnB1dCIpOwoJCQl0MCA9IHNwYWNlKCk7CgkJCWxhYmVsID0gZWxlbWVudCgibGFiZWwiKTsKCQkJdDEgPSB0ZXh0KC8qbmFtZSovIGN0eFs0XSk7CgkJCXQyID0gc3BhY2UoKTsKCQkJZGl2MCA9IGVsZW1lbnQoImRpdiIpOwoJCQl0MyA9IHNwYWNlKCk7CgkJCWlmIChpZl9ibG9jazApIGlmX2Jsb2NrMC5jKCk7CgkJCXQ0ID0gc3BhY2UoKTsKCQkJaWYgKGlmX2Jsb2NrMSkgaWZfYmxvY2sxLmMoKTsKCQkJc2V0X2F0dHJpYnV0ZXMoaW5wdXQsIGlucHV0X2RhdGEpOwoJCQl0b2dnbGVfY2xhc3MoaW5wdXQsICJzdmVsdGUtZ2F2M2p5IiwgdHJ1ZSk7CgkJCWF0dHIobGFiZWwsICJjbGFzcyIsICJtMy1mb250LWJvZHktbGFyZ2Ugc3ZlbHRlLWdhdjNqeSIpOwoJCQlhdHRyKGxhYmVsLCAiZm9yIiwgLyppZCovIGN0eFsxMF0pOwoJCQlhdHRyKGRpdjAsICJjbGFzcyIsICJsYXllciBzdmVsdGUtZ2F2M2p5Iik7CgkJCXNldF9hdHRyaWJ1dGVzKGRpdjEsIGRpdl9kYXRhXzEpOwoJCQl0b2dnbGVfY2xhc3MoZGl2MSwgImxlYWRpbmctaWNvbiIsIC8qbGVhZGluZ0ljb24qLyBjdHhbNV0pOwoJCQl0b2dnbGVfY2xhc3MoZGl2MSwgImVycm9yIiwgLyplcnJvciovIGN0eFs4XSk7CgkJCXRvZ2dsZV9jbGFzcyhkaXYxLCAic3ZlbHRlLWdhdjNqeSIsIHRydWUpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBkaXYxLCBhbmNob3IpOwoJCQlhcHBlbmQoZGl2MSwgaW5wdXQpOwoJCQlpZiAoaW5wdXQuYXV0b2ZvY3VzKSBpbnB1dC5mb2N1cygpOwoJCQlzZXRfaW5wdXRfdmFsdWUoaW5wdXQsIC8qdmFsdWUqLyBjdHhbMF0pOwoJCQlhcHBlbmQoZGl2MSwgdDApOwoJCQlhcHBlbmQoZGl2MSwgbGFiZWwpOwoJCQlhcHBlbmQobGFiZWwsIHQxKTsKCQkJYXBwZW5kKGRpdjEsIHQyKTsKCQkJYXBwZW5kKGRpdjEsIGRpdjApOwoJCQlhcHBlbmQoZGl2MSwgdDMpOwoJCQlpZiAoaWZfYmxvY2swKSBpZl9ibG9jazAubShkaXYxLCBudWxsKTsKCQkJYXBwZW5kKGRpdjEsIHQ0KTsKCQkJaWYgKGlmX2Jsb2NrMSkgaWZfYmxvY2sxLm0oZGl2MSwgbnVsbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoKCQkJaWYgKCFtb3VudGVkKSB7CgkJCQlkaXNwb3NlID0gbGlzdGVuKGlucHV0LCAiaW5wdXQiLCAvKmlucHV0X2lucHV0X2hhbmRsZXIqLyBjdHhbMTFdKTsKCQkJCW1vdW50ZWQgPSB0cnVlOwoJCQl9CgkJfSwKCQlwKGN0eCwgW2RpcnR5XSkgewoJCQlzZXRfYXR0cmlidXRlcyhpbnB1dCwgaW5wdXRfZGF0YSA9IGdldF9zcHJlYWRfdXBkYXRlKGlucHV0X2xldmVscywgWwoJCQkJeyBjbGFzczogIm0zLWZvbnQtYm9keS1sYXJnZSIgfSwKCQkJCXsgcGxhY2Vob2xkZXI6ICIgIiB9LAoJCQkJeyBpZDogLyppZCovIGN0eFsxMF0gfSwKCQkJCSghY3VycmVudCB8fCBkaXJ0eSAmIC8qZGlzYWJsZWQqLyAxMjgpICYmIHsgZGlzYWJsZWQ6IC8qZGlzYWJsZWQqLyBjdHhbN10gfSwKCQkJCWRpcnR5ICYgLypleHRyYU9wdGlvbnMqLyA4ICYmIC8qZXh0cmFPcHRpb25zKi8gY3R4WzNdCgkJCV0pKTsKCgkJCWlmIChkaXJ0eSAmIC8qdmFsdWUqLyAxICYmIGlucHV0LnZhbHVlICE9PSAvKnZhbHVlKi8gY3R4WzBdKSB7CgkJCQlzZXRfaW5wdXRfdmFsdWUoaW5wdXQsIC8qdmFsdWUqLyBjdHhbMF0pOwoJCQl9CgoJCQl0b2dnbGVfY2xhc3MoaW5wdXQsICJzdmVsdGUtZ2F2M2p5IiwgdHJ1ZSk7CgkJCWlmICghY3VycmVudCB8fCBkaXJ0eSAmIC8qbmFtZSovIDE2KSBzZXRfZGF0YSh0MSwgLypuYW1lKi8gY3R4WzRdKTsKCgkJCWlmICgvKmxlYWRpbmdJY29uKi8gY3R4WzVdKSB7CgkJCQlpZiAoaWZfYmxvY2swKSB7CgkJCQkJaWZfYmxvY2swLnAoY3R4LCBkaXJ0eSk7CgoJCQkJCWlmIChkaXJ0eSAmIC8qbGVhZGluZ0ljb24qLyAzMikgewoJCQkJCQl0cmFuc2l0aW9uX2luKGlmX2Jsb2NrMCwgMSk7CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQlpZl9ibG9jazAgPSBjcmVhdGVfaWZfYmxvY2tfMSQxKGN0eCk7CgkJCQkJaWZfYmxvY2swLmMoKTsKCQkJCQl0cmFuc2l0aW9uX2luKGlmX2Jsb2NrMCwgMSk7CgkJCQkJaWZfYmxvY2swLm0oZGl2MSwgdDQpOwoJCQkJfQoJCQl9IGVsc2UgaWYgKGlmX2Jsb2NrMCkgewoJCQkJZ3JvdXBfb3V0cm9zKCk7CgoJCQkJdHJhbnNpdGlvbl9vdXQoaWZfYmxvY2swLCAxLCAxLCAoKSA9PiB7CgkJCQkJaWZfYmxvY2swID0gbnVsbDsKCQkJCX0pOwoKCQkJCWNoZWNrX291dHJvcygpOwoJCQl9CgoJCQlpZiAoLyp0cmFpbGluZ0ljb24qLyBjdHhbNl0pIHsKCQkJCWlmIChpZl9ibG9jazEpIHsKCQkJCQlpZl9ibG9jazEucChjdHgsIGRpcnR5KTsKCgkJCQkJaWYgKGRpcnR5ICYgLyp0cmFpbGluZ0ljb24qLyA2NCkgewoJCQkJCQl0cmFuc2l0aW9uX2luKGlmX2Jsb2NrMSwgMSk7CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQlpZl9ibG9jazEgPSBjcmVhdGVfaWZfYmxvY2skMShjdHgpOwoJCQkJCWlmX2Jsb2NrMS5jKCk7CgkJCQkJdHJhbnNpdGlvbl9pbihpZl9ibG9jazEsIDEpOwoJCQkJCWlmX2Jsb2NrMS5tKGRpdjEsIG51bGwpOwoJCQkJfQoJCQl9IGVsc2UgaWYgKGlmX2Jsb2NrMSkgewoJCQkJZ3JvdXBfb3V0cm9zKCk7CgoJCQkJdHJhbnNpdGlvbl9vdXQoaWZfYmxvY2sxLCAxLCAxLCAoKSA9PiB7CgkJCQkJaWZfYmxvY2sxID0gbnVsbDsKCQkJCX0pOwoKCQkJCWNoZWNrX291dHJvcygpOwoJCQl9CgoJCQlzZXRfYXR0cmlidXRlcyhkaXYxLCBkaXZfZGF0YV8xID0gZ2V0X3NwcmVhZF91cGRhdGUoZGl2MV9sZXZlbHMsIFsKCQkJCXsgY2xhc3M6ICJtMy1jb250YWluZXIiIH0sCgkJCQkoIWN1cnJlbnQgfHwgZGlydHkgJiAvKmRpc3BsYXkqLyAyICYmIGRpdjFfc3R5bGVfdmFsdWUgIT09IChkaXYxX3N0eWxlX3ZhbHVlID0gImRpc3BsYXk6ICIgKyAvKmRpc3BsYXkqLyBjdHhbMV0pKSAmJiB7IHN0eWxlOiBkaXYxX3N0eWxlX3ZhbHVlIH0sCgkJCQlkaXJ0eSAmIC8qZXh0cmFXcmFwcGVyT3B0aW9ucyovIDQgJiYgLypleHRyYVdyYXBwZXJPcHRpb25zKi8gY3R4WzJdCgkJCV0pKTsKCgkJCXRvZ2dsZV9jbGFzcyhkaXYxLCAibGVhZGluZy1pY29uIiwgLypsZWFkaW5nSWNvbiovIGN0eFs1XSk7CgkJCXRvZ2dsZV9jbGFzcyhkaXYxLCAiZXJyb3IiLCAvKmVycm9yKi8gY3R4WzhdKTsKCQkJdG9nZ2xlX2NsYXNzKGRpdjEsICJzdmVsdGUtZ2F2M2p5IiwgdHJ1ZSk7CgkJfSwKCQlpKGxvY2FsKSB7CgkJCWlmIChjdXJyZW50KSByZXR1cm47CgkJCXRyYW5zaXRpb25faW4oaWZfYmxvY2swKTsKCQkJdHJhbnNpdGlvbl9pbihpZl9ibG9jazEpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoaWZfYmxvY2swKTsKCQkJdHJhbnNpdGlvbl9vdXQoaWZfYmxvY2sxKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGRpdjEpOwoJCQl9CgoJCQlpZiAoaWZfYmxvY2swKSBpZl9ibG9jazAuZCgpOwoJCQlpZiAoaWZfYmxvY2sxKSBpZl9ibG9jazEuZCgpOwoJCQltb3VudGVkID0gZmFsc2U7CgkJCWRpc3Bvc2UoKTsKCQl9Cgl9Owp9CgpmdW5jdGlvbiBpbnN0YW5jZSQyKCQkc2VsZiwgJCRwcm9wcywgJCRpbnZhbGlkYXRlKSB7CglsZXQgeyBkaXNwbGF5ID0gImlubGluZS1mbGV4IiB9ID0gJCRwcm9wczsKCWxldCB7IGV4dHJhV3JhcHBlck9wdGlvbnMgPSB7fSB9ID0gJCRwcm9wczsKCWxldCB7IGV4dHJhT3B0aW9ucyA9IHt9IH0gPSAkJHByb3BzOwoJbGV0IHsgbmFtZSB9ID0gJCRwcm9wczsKCWxldCB7IGxlYWRpbmdJY29uID0gdm9pZCAwIH0gPSAkJHByb3BzOwoJbGV0IHsgdHJhaWxpbmdJY29uID0gdm9pZCAwIH0gPSAkJHByb3BzOwoJbGV0IHsgZGlzYWJsZWQgPSBmYWxzZSB9ID0gJCRwcm9wczsKCWxldCB7IGVycm9yID0gZmFsc2UgfSA9ICQkcHJvcHM7CglsZXQgeyB2YWx1ZSA9ICIiIH0gPSAkJHByb3BzOwoJY29uc3QgZGlzcGF0Y2ggPSBjcmVhdGVFdmVudERpc3BhdGNoZXIoKTsKCWNvbnN0IGlkID0gY3J5cHRvLnJhbmRvbVVVSUQoKTsKCglmdW5jdGlvbiBpbnB1dF9pbnB1dF9oYW5kbGVyKCkgewoJCXZhbHVlID0gdGhpcy52YWx1ZTsKCQkkJGludmFsaWRhdGUoMCwgdmFsdWUpOwoJfQoKCWNvbnN0IGNsaWNrX2hhbmRsZXIgPSAoKSA9PiBkaXNwYXRjaCgidHJhaWxpbmdDbGljayIpOwoKCSQkc2VsZi4kJHNldCA9ICQkcHJvcHMgPT4gewoJCWlmICgnZGlzcGxheScgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDEsIGRpc3BsYXkgPSAkJHByb3BzLmRpc3BsYXkpOwoJCWlmICgnZXh0cmFXcmFwcGVyT3B0aW9ucycgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDIsIGV4dHJhV3JhcHBlck9wdGlvbnMgPSAkJHByb3BzLmV4dHJhV3JhcHBlck9wdGlvbnMpOwoJCWlmICgnZXh0cmFPcHRpb25zJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoMywgZXh0cmFPcHRpb25zID0gJCRwcm9wcy5leHRyYU9wdGlvbnMpOwoJCWlmICgnbmFtZScgaW4gJCRwcm9wcykgJCRpbnZhbGlkYXRlKDQsIG5hbWUgPSAkJHByb3BzLm5hbWUpOwoJCWlmICgnbGVhZGluZ0ljb24nIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSg1LCBsZWFkaW5nSWNvbiA9ICQkcHJvcHMubGVhZGluZ0ljb24pOwoJCWlmICgndHJhaWxpbmdJY29uJyBpbiAkJHByb3BzKSAkJGludmFsaWRhdGUoNiwgdHJhaWxpbmdJY29uID0gJCRwcm9wcy50cmFpbGluZ0ljb24pOwoJCWlmICgnZGlzYWJsZWQnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSg3LCBkaXNhYmxlZCA9ICQkcHJvcHMuZGlzYWJsZWQpOwoJCWlmICgnZXJyb3InIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSg4LCBlcnJvciA9ICQkcHJvcHMuZXJyb3IpOwoJCWlmICgndmFsdWUnIGluICQkcHJvcHMpICQkaW52YWxpZGF0ZSgwLCB2YWx1ZSA9ICQkcHJvcHMudmFsdWUpOwoJfTsKCglyZXR1cm4gWwoJCXZhbHVlLAoJCWRpc3BsYXksCgkJZXh0cmFXcmFwcGVyT3B0aW9ucywKCQlleHRyYU9wdGlvbnMsCgkJbmFtZSwKCQlsZWFkaW5nSWNvbiwKCQl0cmFpbGluZ0ljb24sCgkJZGlzYWJsZWQsCgkJZXJyb3IsCgkJZGlzcGF0Y2gsCgkJaWQsCgkJaW5wdXRfaW5wdXRfaGFuZGxlciwKCQljbGlja19oYW5kbGVyCgldOwp9CgpjbGFzcyBUZXh0RmllbGQgZXh0ZW5kcyBTdmVsdGVDb21wb25lbnQgewoJY29uc3RydWN0b3Iob3B0aW9ucykgewoJCXN1cGVyKCk7CgoJCWluaXQodGhpcywgb3B0aW9ucywgaW5zdGFuY2UkMiwgY3JlYXRlX2ZyYWdtZW50JDIsIHNhZmVfbm90X2VxdWFsLCB7CgkJCWRpc3BsYXk6IDEsCgkJCWV4dHJhV3JhcHBlck9wdGlvbnM6IDIsCgkJCWV4dHJhT3B0aW9uczogMywKCQkJbmFtZTogNCwKCQkJbGVhZGluZ0ljb246IDUsCgkJCXRyYWlsaW5nSWNvbjogNiwKCQkJZGlzYWJsZWQ6IDcsCgkJCWVycm9yOiA4LAoJCQl2YWx1ZTogMAoJCX0pOwoJfQp9Cgpjb25zdCBUZXh0RmllbGQkMSA9IFRleHRGaWVsZDsKCmNvbnN0IGRhdGEkMSA9IHsKCSJ3aWR0aCI6IDI0LAoJImhlaWdodCI6IDI0LAoJImJvZHkiOiAiPHBhdGggZmlsbD1cImN1cnJlbnRDb2xvclwiIGQ9XCJNMTkuMjcgNS4zM0MxNy45NCA0LjcxIDE2LjUgNC4yNiAxNSA0YS4wOS4wOSAwIDAgMC0uMDcuMDNjLS4xOC4zMy0uMzkuNzYtLjUzIDEuMDlhMTYuMDkgMTYuMDkgMCAwIDAtNC44IDBjLS4xNC0uMzQtLjM1LS43Ni0uNTQtMS4wOWMtLjAxLS4wMi0uMDQtLjAzLS4wNy0uMDNjLTEuNS4yNi0yLjkzLjcxLTQuMjcgMS4zM2MtLjAxIDAtLjAyLjAxLS4wMy4wMmMtMi43MiA0LjA3LTMuNDcgOC4wMy0zLjEgMTEuOTVjMCAuMDIuMDEuMDQuMDMuMDVjMS44IDEuMzIgMy41MyAyLjEyIDUuMjQgMi42NWMuMDMuMDEuMDYgMCAuMDctLjAyYy40LS41NS43Ni0xLjEzIDEuMDctMS43NGMuMDItLjA0IDAtLjA4LS4wNC0uMDljLS41Ny0uMjItMS4xMS0uNDgtMS42NC0uNzhjLS4wNC0uMDItLjA0LS4wOC0uMDEtLjExYy4xMS0uMDguMjItLjE3LjMzLS4yNWMuMDItLjAyLjA1LS4wMi4wNy0uMDFjMy40NCAxLjU3IDcuMTUgMS41NyAxMC41NSAwYy4wMi0uMDEuMDUtLjAxLjA3LjAxYy4xMS4wOS4yMi4xNy4zMy4yNmMuMDQuMDMuMDQuMDktLjAxLjExYy0uNTIuMzEtMS4wNy41Ni0xLjY0Ljc4Yy0uMDQuMDEtLjA1LjA2LS4wNC4wOWMuMzIuNjEuNjggMS4xOSAxLjA3IDEuNzRjLjAzLjAxLjA2LjAyLjA5LjAxYzEuNzItLjUzIDMuNDUtMS4zMyA1LjI1LTIuNjVjLjAyLS4wMS4wMy0uMDMuMDMtLjA1Yy40NC00LjUzLS43My04LjQ2LTMuMS0xMS45NWMtLjAxLS4wMS0uMDItLjAyLS4wNC0uMDJ6TTguNTIgMTQuOTFjLTEuMDMgMC0xLjg5LS45NS0xLjg5LTIuMTJzLjg0LTIuMTIgMS44OS0yLjEyYzEuMDYgMCAxLjkuOTYgMS44OSAyLjEyYzAgMS4xNy0uODQgMi4xMi0xLjg5IDIuMTJ6bTYuOTcgMGMtMS4wMyAwLTEuODktLjk1LTEuODktMi4xMnMuODQtMi4xMiAxLjg5LTIuMTJjMS4wNiAwIDEuOS45NiAxLjg5IDIuMTJjMCAxLjE3LS44MyAyLjEyLTEuODkgMi4xMnpcIi8+Igp9OwoKY29uc3QgZGF0YSA9IHsKCSJib2R5IjogIjxwYXRoIGZpbGw9XCJjdXJyZW50Q29sb3JcIiBkPVwiTTggMEMzLjU4IDAgMCAzLjU4IDAgOGMwIDMuNTQgMi4yOSA2LjUzIDUuNDcgNy41OWMuNC4wNy41NS0uMTcuNTUtLjM4YzAtLjE5LS4wMS0uODItLjAxLTEuNDljLTIuMDEuMzctMi41My0uNDktMi42OS0uOTRjLS4wOS0uMjMtLjQ4LS45NC0uODItMS4xM2MtLjI4LS4xNS0uNjgtLjUyLS4wMS0uNTNjLjYzLS4wMSAxLjA4LjU4IDEuMjMuODJjLjcyIDEuMjEgMS44Ny44NyAyLjMzLjY2Yy4wNy0uNTIuMjgtLjg3LjUxLTEuMDdjLTEuNzgtLjItMy42NC0uODktMy42NC0zLjk1YzAtLjg3LjMxLTEuNTkuODItMi4xNWMtLjA4LS4yLS4zNi0xLjAyLjA4LTIuMTJjMCAwIC42Ny0uMjEgMi4yLjgyYy42NC0uMTggMS4zMi0uMjcgMi0uMjdjLjY4IDAgMS4zNi4wOSAyIC4yN2MxLjUzLTEuMDQgMi4yLS44MiAyLjItLjgyYy40NCAxLjEuMTYgMS45Mi4wOCAyLjEyYy41MS41Ni44MiAxLjI3LjgyIDIuMTVjMCAzLjA3LTEuODcgMy43NS0zLjY1IDMuOTVjLjI5LjI1LjU0LjczLjU0IDEuNDhjMCAxLjA3LS4wMSAxLjkzLS4wMSAyLjJjMCAuMjEuMTUuNDYuNTUuMzhBOC4wMTIgOC4wMTIgMCAwIDAgMTYgOGMwLTQuNDItMy41OC04LTgtOHpcIi8+Igp9OwoKY29uc3Qgc0NsaWVudCA9IFN5bWJvbCgic3BhZGl1bSBjbGllbnQiKTsKY29uc3Qgc0Fib3J0ID0gU3ltYm9sKCJzcGFkaXVtIGFib3J0Iik7CmNvbnN0IHNMb2NhdGlvbiA9IFN5bWJvbCgic3BhZGl1bSBsb2NhdGlvbiIpOwpjb25zdCBzSWZyYW1lU3JjID0gU3ltYm9sKCJzcGFkaXVtIGlmcmFtZSBzcmMiKTsKY29uc3Qgc0Jsb2JVcmxzID0gU3ltYm9sKCJzcGFkaXVtIGJsb2IgdXJscyIpOwpjb25zdCBzVGltZW91dHMgPSBTeW1ib2woInNwYWRpdW0gdGltZW91dHMiKTsKCmNvbnN0IHJlZnJlc2hSZWdleCA9IC9eKFxkKykoPzo7P1xzKnVybD0oLispPyk/JC87CmZ1bmN0aW9uIHBhcnNlUmVmcmVzaEhlYWRlcih2YWx1ZSwgd2luKSB7CiAgY29uc3QgbWF0Y2hlcyA9IHZhbHVlLm1hdGNoKHJlZnJlc2hSZWdleCk7CiAgaWYgKCFtYXRjaGVzKQogICAgcmV0dXJuOwogIHJldHVybiB7CiAgICBkdXJhdGlvbjogcGFyc2VJbnQobWF0Y2hlc1sxXSwgMTApLAogICAgdXJsOiBuZXcgVVJMKG1hdGNoZXNbMl0sIHdpbltzTG9jYXRpb25dKS50b1N0cmluZygpCiAgfTsKfQoKdmFyIGNvbW1vbmpzR2xvYmFsID0gdHlwZW9mIGdsb2JhbFRoaXMgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsVGhpcyA6IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gd2luZG93IDogdHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyBnbG9iYWwgOiB0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgPyBzZWxmIDoge307CgpmdW5jdGlvbiBnZXRBdWdtZW50ZWROYW1lc3BhY2UobikgewogIGlmIChuLl9fZXNNb2R1bGUpIHJldHVybiBuOwogIHZhciBmID0gbi5kZWZhdWx0OwoJaWYgKHR5cGVvZiBmID09ICJmdW5jdGlvbiIpIHsKCQl2YXIgYSA9IGZ1bmN0aW9uIGEgKCkgewoJCQlpZiAodGhpcyBpbnN0YW5jZW9mIGEpIHsKICAgICAgICByZXR1cm4gUmVmbGVjdC5jb25zdHJ1Y3QoZiwgYXJndW1lbnRzLCB0aGlzLmNvbnN0cnVjdG9yKTsKCQkJfQoJCQlyZXR1cm4gZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCX07CgkJYS5wcm90b3R5cGUgPSBmLnByb3RvdHlwZTsKICB9IGVsc2UgYSA9IHt9OwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShhLCAnX19lc01vZHVsZScsIHt2YWx1ZTogdHJ1ZX0pOwoJT2JqZWN0LmtleXMobikuZm9yRWFjaChmdW5jdGlvbiAoaykgewoJCXZhciBkID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihuLCBrKTsKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoYSwgaywgZC5nZXQgPyBkIDogewoJCQllbnVtZXJhYmxlOiB0cnVlLAoJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCQkJCXJldHVybiBuW2tdOwoJCQl9CgkJfSk7Cgl9KTsKCXJldHVybiBhOwp9CgovKiogSGlnaGVzdCBwb3NpdGl2ZSBzaWduZWQgMzItYml0IGZsb2F0IHZhbHVlICovCmNvbnN0IG1heEludCA9IDIxNDc0ODM2NDc7IC8vIGFrYS4gMHg3RkZGRkZGRiBvciAyXjMxLTEKCi8qKiBCb290c3RyaW5nIHBhcmFtZXRlcnMgKi8KY29uc3QgYmFzZSA9IDM2Owpjb25zdCB0TWluID0gMTsKY29uc3QgdE1heCA9IDI2Owpjb25zdCBza2V3ID0gMzg7CmNvbnN0IGRhbXAgPSA3MDA7CmNvbnN0IGluaXRpYWxCaWFzID0gNzI7CmNvbnN0IGluaXRpYWxOID0gMTI4OyAvLyAweDgwCmNvbnN0IGRlbGltaXRlciA9ICctJzsgLy8gJ1x4MkQnCgovKiogUmVndWxhciBleHByZXNzaW9ucyAqLwpjb25zdCByZWdleFB1bnljb2RlID0gL154bi0tLzsKY29uc3QgcmVnZXhOb25BU0NJSSA9IC9bXlwwLVx4N0ZdLzsgLy8gTm90ZTogVSswMDdGIERFTCBpcyBleGNsdWRlZCB0b28uCmNvbnN0IHJlZ2V4U2VwYXJhdG9ycyA9IC9bXHgyRVx1MzAwMlx1RkYwRVx1RkY2MV0vZzsgLy8gUkZDIDM0OTAgc2VwYXJhdG9ycwoKLyoqIEVycm9yIG1lc3NhZ2VzICovCmNvbnN0IGVycm9ycyA9IHsKCSdvdmVyZmxvdyc6ICdPdmVyZmxvdzogaW5wdXQgbmVlZHMgd2lkZXIgaW50ZWdlcnMgdG8gcHJvY2VzcycsCgknbm90LWJhc2ljJzogJ0lsbGVnYWwgaW5wdXQgPj0gMHg4MCAobm90IGEgYmFzaWMgY29kZSBwb2ludCknLAoJJ2ludmFsaWQtaW5wdXQnOiAnSW52YWxpZCBpbnB1dCcKfTsKCi8qKiBDb252ZW5pZW5jZSBzaG9ydGN1dHMgKi8KY29uc3QgYmFzZU1pbnVzVE1pbiA9IGJhc2UgLSB0TWluOwpjb25zdCBmbG9vciA9IE1hdGguZmxvb3I7CmNvbnN0IHN0cmluZ0Zyb21DaGFyQ29kZSA9IFN0cmluZy5mcm9tQ2hhckNvZGU7CgovKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCi8qKgogKiBBIGdlbmVyaWMgZXJyb3IgdXRpbGl0eSBmdW5jdGlvbi4KICogQHByaXZhdGUKICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgVGhlIGVycm9yIHR5cGUuCiAqIEByZXR1cm5zIHtFcnJvcn0gVGhyb3dzIGEgYFJhbmdlRXJyb3JgIHdpdGggdGhlIGFwcGxpY2FibGUgZXJyb3IgbWVzc2FnZS4KICovCmZ1bmN0aW9uIGVycm9yKHR5cGUpIHsKCXRocm93IG5ldyBSYW5nZUVycm9yKGVycm9yc1t0eXBlXSk7Cn0KCi8qKgogKiBBIGdlbmVyaWMgYEFycmF5I21hcGAgdXRpbGl0eSBmdW5jdGlvbi4KICogQHByaXZhdGUKICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci4KICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHRoYXQgZ2V0cyBjYWxsZWQgZm9yIGV2ZXJ5IGFycmF5CiAqIGl0ZW0uCiAqIEByZXR1cm5zIHtBcnJheX0gQSBuZXcgYXJyYXkgb2YgdmFsdWVzIHJldHVybmVkIGJ5IHRoZSBjYWxsYmFjayBmdW5jdGlvbi4KICovCmZ1bmN0aW9uIG1hcChhcnJheSwgY2FsbGJhY2spIHsKCWNvbnN0IHJlc3VsdCA9IFtdOwoJbGV0IGxlbmd0aCA9IGFycmF5Lmxlbmd0aDsKCXdoaWxlIChsZW5ndGgtLSkgewoJCXJlc3VsdFtsZW5ndGhdID0gY2FsbGJhY2soYXJyYXlbbGVuZ3RoXSk7Cgl9CglyZXR1cm4gcmVzdWx0Owp9CgovKioKICogQSBzaW1wbGUgYEFycmF5I21hcGAtbGlrZSB3cmFwcGVyIHRvIHdvcmsgd2l0aCBkb21haW4gbmFtZSBzdHJpbmdzIG9yIGVtYWlsCiAqIGFkZHJlc3Nlcy4KICogQHByaXZhdGUKICogQHBhcmFtIHtTdHJpbmd9IGRvbWFpbiBUaGUgZG9tYWluIG5hbWUgb3IgZW1haWwgYWRkcmVzcy4KICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHRoYXQgZ2V0cyBjYWxsZWQgZm9yIGV2ZXJ5CiAqIGNoYXJhY3Rlci4KICogQHJldHVybnMge1N0cmluZ30gQSBuZXcgc3RyaW5nIG9mIGNoYXJhY3RlcnMgcmV0dXJuZWQgYnkgdGhlIGNhbGxiYWNrCiAqIGZ1bmN0aW9uLgogKi8KZnVuY3Rpb24gbWFwRG9tYWluKGRvbWFpbiwgY2FsbGJhY2spIHsKCWNvbnN0IHBhcnRzID0gZG9tYWluLnNwbGl0KCdAJyk7CglsZXQgcmVzdWx0ID0gJyc7CglpZiAocGFydHMubGVuZ3RoID4gMSkgewoJCS8vIEluIGVtYWlsIGFkZHJlc3Nlcywgb25seSB0aGUgZG9tYWluIG5hbWUgc2hvdWxkIGJlIHB1bnljb2RlZC4gTGVhdmUKCQkvLyB0aGUgbG9jYWwgcGFydCAoaS5lLiBldmVyeXRoaW5nIHVwIHRvIGBAYCkgaW50YWN0LgoJCXJlc3VsdCA9IHBhcnRzWzBdICsgJ0AnOwoJCWRvbWFpbiA9IHBhcnRzWzFdOwoJfQoJLy8gQXZvaWQgYHNwbGl0KHJlZ2V4KWAgZm9yIElFOCBjb21wYXRpYmlsaXR5LiBTZWUgIzE3LgoJZG9tYWluID0gZG9tYWluLnJlcGxhY2UocmVnZXhTZXBhcmF0b3JzLCAnXHgyRScpOwoJY29uc3QgbGFiZWxzID0gZG9tYWluLnNwbGl0KCcuJyk7Cgljb25zdCBlbmNvZGVkID0gbWFwKGxhYmVscywgY2FsbGJhY2spLmpvaW4oJy4nKTsKCXJldHVybiByZXN1bHQgKyBlbmNvZGVkOwp9CgovKioKICogQ3JlYXRlcyBhbiBhcnJheSBjb250YWluaW5nIHRoZSBudW1lcmljIGNvZGUgcG9pbnRzIG9mIGVhY2ggVW5pY29kZQogKiBjaGFyYWN0ZXIgaW4gdGhlIHN0cmluZy4gV2hpbGUgSmF2YVNjcmlwdCB1c2VzIFVDUy0yIGludGVybmFsbHksCiAqIHRoaXMgZnVuY3Rpb24gd2lsbCBjb252ZXJ0IGEgcGFpciBvZiBzdXJyb2dhdGUgaGFsdmVzIChlYWNoIG9mIHdoaWNoCiAqIFVDUy0yIGV4cG9zZXMgYXMgc2VwYXJhdGUgY2hhcmFjdGVycykgaW50byBhIHNpbmdsZSBjb2RlIHBvaW50LAogKiBtYXRjaGluZyBVVEYtMTYuCiAqIEBzZWUgYHB1bnljb2RlLnVjczIuZW5jb2RlYAogKiBAc2VlIDxodHRwczovL21hdGhpYXNieW5lbnMuYmUvbm90ZXMvamF2YXNjcmlwdC1lbmNvZGluZz4KICogQG1lbWJlck9mIHB1bnljb2RlLnVjczIKICogQG5hbWUgZGVjb2RlCiAqIEBwYXJhbSB7U3RyaW5nfSBzdHJpbmcgVGhlIFVuaWNvZGUgaW5wdXQgc3RyaW5nIChVQ1MtMikuCiAqIEByZXR1cm5zIHtBcnJheX0gVGhlIG5ldyBhcnJheSBvZiBjb2RlIHBvaW50cy4KICovCmZ1bmN0aW9uIHVjczJkZWNvZGUoc3RyaW5nKSB7Cgljb25zdCBvdXRwdXQgPSBbXTsKCWxldCBjb3VudGVyID0gMDsKCWNvbnN0IGxlbmd0aCA9IHN0cmluZy5sZW5ndGg7Cgl3aGlsZSAoY291bnRlciA8IGxlbmd0aCkgewoJCWNvbnN0IHZhbHVlID0gc3RyaW5nLmNoYXJDb2RlQXQoY291bnRlcisrKTsKCQlpZiAodmFsdWUgPj0gMHhEODAwICYmIHZhbHVlIDw9IDB4REJGRiAmJiBjb3VudGVyIDwgbGVuZ3RoKSB7CgkJCS8vIEl0J3MgYSBoaWdoIHN1cnJvZ2F0ZSwgYW5kIHRoZXJlIGlzIGEgbmV4dCBjaGFyYWN0ZXIuCgkJCWNvbnN0IGV4dHJhID0gc3RyaW5nLmNoYXJDb2RlQXQoY291bnRlcisrKTsKCQkJaWYgKChleHRyYSAmIDB4RkMwMCkgPT0gMHhEQzAwKSB7IC8vIExvdyBzdXJyb2dhdGUuCgkJCQlvdXRwdXQucHVzaCgoKHZhbHVlICYgMHgzRkYpIDw8IDEwKSArIChleHRyYSAmIDB4M0ZGKSArIDB4MTAwMDApOwoJCQl9IGVsc2UgewoJCQkJLy8gSXQncyBhbiB1bm1hdGNoZWQgc3Vycm9nYXRlOyBvbmx5IGFwcGVuZCB0aGlzIGNvZGUgdW5pdCwgaW4gY2FzZSB0aGUKCQkJCS8vIG5leHQgY29kZSB1bml0IGlzIHRoZSBoaWdoIHN1cnJvZ2F0ZSBvZiBhIHN1cnJvZ2F0ZSBwYWlyLgoJCQkJb3V0cHV0LnB1c2godmFsdWUpOwoJCQkJY291bnRlci0tOwoJCQl9CgkJfSBlbHNlIHsKCQkJb3V0cHV0LnB1c2godmFsdWUpOwoJCX0KCX0KCXJldHVybiBvdXRwdXQ7Cn0KCi8qKgogKiBDcmVhdGVzIGEgc3RyaW5nIGJhc2VkIG9uIGFuIGFycmF5IG9mIG51bWVyaWMgY29kZSBwb2ludHMuCiAqIEBzZWUgYHB1bnljb2RlLnVjczIuZGVjb2RlYAogKiBAbWVtYmVyT2YgcHVueWNvZGUudWNzMgogKiBAbmFtZSBlbmNvZGUKICogQHBhcmFtIHtBcnJheX0gY29kZVBvaW50cyBUaGUgYXJyYXkgb2YgbnVtZXJpYyBjb2RlIHBvaW50cy4KICogQHJldHVybnMge1N0cmluZ30gVGhlIG5ldyBVbmljb2RlIHN0cmluZyAoVUNTLTIpLgogKi8KY29uc3QgdWNzMmVuY29kZSA9IGNvZGVQb2ludHMgPT4gU3RyaW5nLmZyb21Db2RlUG9pbnQoLi4uY29kZVBvaW50cyk7CgovKioKICogQ29udmVydHMgYSBiYXNpYyBjb2RlIHBvaW50IGludG8gYSBkaWdpdC9pbnRlZ2VyLgogKiBAc2VlIGBkaWdpdFRvQmFzaWMoKWAKICogQHByaXZhdGUKICogQHBhcmFtIHtOdW1iZXJ9IGNvZGVQb2ludCBUaGUgYmFzaWMgbnVtZXJpYyBjb2RlIHBvaW50IHZhbHVlLgogKiBAcmV0dXJucyB7TnVtYmVyfSBUaGUgbnVtZXJpYyB2YWx1ZSBvZiBhIGJhc2ljIGNvZGUgcG9pbnQgKGZvciB1c2UgaW4KICogcmVwcmVzZW50aW5nIGludGVnZXJzKSBpbiB0aGUgcmFuZ2UgYDBgIHRvIGBiYXNlIC0gMWAsIG9yIGBiYXNlYCBpZgogKiB0aGUgY29kZSBwb2ludCBkb2VzIG5vdCByZXByZXNlbnQgYSB2YWx1ZS4KICovCmNvbnN0IGJhc2ljVG9EaWdpdCA9IGZ1bmN0aW9uKGNvZGVQb2ludCkgewoJaWYgKGNvZGVQb2ludCA+PSAweDMwICYmIGNvZGVQb2ludCA8IDB4M0EpIHsKCQlyZXR1cm4gMjYgKyAoY29kZVBvaW50IC0gMHgzMCk7Cgl9CglpZiAoY29kZVBvaW50ID49IDB4NDEgJiYgY29kZVBvaW50IDwgMHg1QikgewoJCXJldHVybiBjb2RlUG9pbnQgLSAweDQxOwoJfQoJaWYgKGNvZGVQb2ludCA+PSAweDYxICYmIGNvZGVQb2ludCA8IDB4N0IpIHsKCQlyZXR1cm4gY29kZVBvaW50IC0gMHg2MTsKCX0KCXJldHVybiBiYXNlOwp9OwoKLyoqCiAqIENvbnZlcnRzIGEgZGlnaXQvaW50ZWdlciBpbnRvIGEgYmFzaWMgY29kZSBwb2ludC4KICogQHNlZSBgYmFzaWNUb0RpZ2l0KClgCiAqIEBwcml2YXRlCiAqIEBwYXJhbSB7TnVtYmVyfSBkaWdpdCBUaGUgbnVtZXJpYyB2YWx1ZSBvZiBhIGJhc2ljIGNvZGUgcG9pbnQuCiAqIEByZXR1cm5zIHtOdW1iZXJ9IFRoZSBiYXNpYyBjb2RlIHBvaW50IHdob3NlIHZhbHVlICh3aGVuIHVzZWQgZm9yCiAqIHJlcHJlc2VudGluZyBpbnRlZ2VycykgaXMgYGRpZ2l0YCwgd2hpY2ggbmVlZHMgdG8gYmUgaW4gdGhlIHJhbmdlCiAqIGAwYCB0byBgYmFzZSAtIDFgLiBJZiBgZmxhZ2AgaXMgbm9uLXplcm8sIHRoZSB1cHBlcmNhc2UgZm9ybSBpcwogKiB1c2VkOyBlbHNlLCB0aGUgbG93ZXJjYXNlIGZvcm0gaXMgdXNlZC4gVGhlIGJlaGF2aW9yIGlzIHVuZGVmaW5lZAogKiBpZiBgZmxhZ2AgaXMgbm9uLXplcm8gYW5kIGBkaWdpdGAgaGFzIG5vIHVwcGVyY2FzZSBmb3JtLgogKi8KY29uc3QgZGlnaXRUb0Jhc2ljID0gZnVuY3Rpb24oZGlnaXQsIGZsYWcpIHsKCS8vICAwLi4yNSBtYXAgdG8gQVNDSUkgYS4ueiBvciBBLi5aCgkvLyAyNi4uMzUgbWFwIHRvIEFTQ0lJIDAuLjkKCXJldHVybiBkaWdpdCArIDIyICsgNzUgKiAoZGlnaXQgPCAyNikgLSAoKGZsYWcgIT0gMCkgPDwgNSk7Cn07CgovKioKICogQmlhcyBhZGFwdGF0aW9uIGZ1bmN0aW9uIGFzIHBlciBzZWN0aW9uIDMuNCBvZiBSRkMgMzQ5Mi4KICogaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzM0OTIjc2VjdGlvbi0zLjQKICogQHByaXZhdGUKICovCmNvbnN0IGFkYXB0ID0gZnVuY3Rpb24oZGVsdGEsIG51bVBvaW50cywgZmlyc3RUaW1lKSB7CglsZXQgayA9IDA7CglkZWx0YSA9IGZpcnN0VGltZSA/IGZsb29yKGRlbHRhIC8gZGFtcCkgOiBkZWx0YSA+PiAxOwoJZGVsdGEgKz0gZmxvb3IoZGVsdGEgLyBudW1Qb2ludHMpOwoJZm9yICgvKiBubyBpbml0aWFsaXphdGlvbiAqLzsgZGVsdGEgPiBiYXNlTWludXNUTWluICogdE1heCA+PiAxOyBrICs9IGJhc2UpIHsKCQlkZWx0YSA9IGZsb29yKGRlbHRhIC8gYmFzZU1pbnVzVE1pbik7Cgl9CglyZXR1cm4gZmxvb3IoayArIChiYXNlTWludXNUTWluICsgMSkgKiBkZWx0YSAvIChkZWx0YSArIHNrZXcpKTsKfTsKCi8qKgogKiBDb252ZXJ0cyBhIFB1bnljb2RlIHN0cmluZyBvZiBBU0NJSS1vbmx5IHN5bWJvbHMgdG8gYSBzdHJpbmcgb2YgVW5pY29kZQogKiBzeW1ib2xzLgogKiBAbWVtYmVyT2YgcHVueWNvZGUKICogQHBhcmFtIHtTdHJpbmd9IGlucHV0IFRoZSBQdW55Y29kZSBzdHJpbmcgb2YgQVNDSUktb25seSBzeW1ib2xzLgogKiBAcmV0dXJucyB7U3RyaW5nfSBUaGUgcmVzdWx0aW5nIHN0cmluZyBvZiBVbmljb2RlIHN5bWJvbHMuCiAqLwpjb25zdCBkZWNvZGUkMyA9IGZ1bmN0aW9uKGlucHV0KSB7CgkvLyBEb24ndCB1c2UgVUNTLTIuCgljb25zdCBvdXRwdXQgPSBbXTsKCWNvbnN0IGlucHV0TGVuZ3RoID0gaW5wdXQubGVuZ3RoOwoJbGV0IGkgPSAwOwoJbGV0IG4gPSBpbml0aWFsTjsKCWxldCBiaWFzID0gaW5pdGlhbEJpYXM7CgoJLy8gSGFuZGxlIHRoZSBiYXNpYyBjb2RlIHBvaW50czogbGV0IGBiYXNpY2AgYmUgdGhlIG51bWJlciBvZiBpbnB1dCBjb2RlCgkvLyBwb2ludHMgYmVmb3JlIHRoZSBsYXN0IGRlbGltaXRlciwgb3IgYDBgIGlmIHRoZXJlIGlzIG5vbmUsIHRoZW4gY29weQoJLy8gdGhlIGZpcnN0IGJhc2ljIGNvZGUgcG9pbnRzIHRvIHRoZSBvdXRwdXQuCgoJbGV0IGJhc2ljID0gaW5wdXQubGFzdEluZGV4T2YoZGVsaW1pdGVyKTsKCWlmIChiYXNpYyA8IDApIHsKCQliYXNpYyA9IDA7Cgl9CgoJZm9yIChsZXQgaiA9IDA7IGogPCBiYXNpYzsgKytqKSB7CgkJLy8gaWYgaXQncyBub3QgYSBiYXNpYyBjb2RlIHBvaW50CgkJaWYgKGlucHV0LmNoYXJDb2RlQXQoaikgPj0gMHg4MCkgewoJCQllcnJvcignbm90LWJhc2ljJyk7CgkJfQoJCW91dHB1dC5wdXNoKGlucHV0LmNoYXJDb2RlQXQoaikpOwoJfQoKCS8vIE1haW4gZGVjb2RpbmcgbG9vcDogc3RhcnQganVzdCBhZnRlciB0aGUgbGFzdCBkZWxpbWl0ZXIgaWYgYW55IGJhc2ljIGNvZGUKCS8vIHBvaW50cyB3ZXJlIGNvcGllZDsgc3RhcnQgYXQgdGhlIGJlZ2lubmluZyBvdGhlcndpc2UuCgoJZm9yIChsZXQgaW5kZXggPSBiYXNpYyA+IDAgPyBiYXNpYyArIDEgOiAwOyBpbmRleCA8IGlucHV0TGVuZ3RoOyAvKiBubyBmaW5hbCBleHByZXNzaW9uICovKSB7CgoJCS8vIGBpbmRleGAgaXMgdGhlIGluZGV4IG9mIHRoZSBuZXh0IGNoYXJhY3RlciB0byBiZSBjb25zdW1lZC4KCQkvLyBEZWNvZGUgYSBnZW5lcmFsaXplZCB2YXJpYWJsZS1sZW5ndGggaW50ZWdlciBpbnRvIGBkZWx0YWAsCgkJLy8gd2hpY2ggZ2V0cyBhZGRlZCB0byBgaWAuIFRoZSBvdmVyZmxvdyBjaGVja2luZyBpcyBlYXNpZXIKCQkvLyBpZiB3ZSBpbmNyZWFzZSBgaWAgYXMgd2UgZ28sIHRoZW4gc3VidHJhY3Qgb2ZmIGl0cyBzdGFydGluZwoJCS8vIHZhbHVlIGF0IHRoZSBlbmQgdG8gb2J0YWluIGBkZWx0YWAuCgkJY29uc3Qgb2xkaSA9IGk7CgkJZm9yIChsZXQgdyA9IDEsIGsgPSBiYXNlOyAvKiBubyBjb25kaXRpb24gKi87IGsgKz0gYmFzZSkgewoKCQkJaWYgKGluZGV4ID49IGlucHV0TGVuZ3RoKSB7CgkJCQllcnJvcignaW52YWxpZC1pbnB1dCcpOwoJCQl9CgoJCQljb25zdCBkaWdpdCA9IGJhc2ljVG9EaWdpdChpbnB1dC5jaGFyQ29kZUF0KGluZGV4KyspKTsKCgkJCWlmIChkaWdpdCA+PSBiYXNlKSB7CgkJCQllcnJvcignaW52YWxpZC1pbnB1dCcpOwoJCQl9CgkJCWlmIChkaWdpdCA+IGZsb29yKChtYXhJbnQgLSBpKSAvIHcpKSB7CgkJCQllcnJvcignb3ZlcmZsb3cnKTsKCQkJfQoKCQkJaSArPSBkaWdpdCAqIHc7CgkJCWNvbnN0IHQgPSBrIDw9IGJpYXMgPyB0TWluIDogKGsgPj0gYmlhcyArIHRNYXggPyB0TWF4IDogayAtIGJpYXMpOwoKCQkJaWYgKGRpZ2l0IDwgdCkgewoJCQkJYnJlYWs7CgkJCX0KCgkJCWNvbnN0IGJhc2VNaW51c1QgPSBiYXNlIC0gdDsKCQkJaWYgKHcgPiBmbG9vcihtYXhJbnQgLyBiYXNlTWludXNUKSkgewoJCQkJZXJyb3IoJ292ZXJmbG93Jyk7CgkJCX0KCgkJCXcgKj0gYmFzZU1pbnVzVDsKCgkJfQoKCQljb25zdCBvdXQgPSBvdXRwdXQubGVuZ3RoICsgMTsKCQliaWFzID0gYWRhcHQoaSAtIG9sZGksIG91dCwgb2xkaSA9PSAwKTsKCgkJLy8gYGlgIHdhcyBzdXBwb3NlZCB0byB3cmFwIGFyb3VuZCBmcm9tIGBvdXRgIHRvIGAwYCwKCQkvLyBpbmNyZW1lbnRpbmcgYG5gIGVhY2ggdGltZSwgc28gd2UnbGwgZml4IHRoYXQgbm93OgoJCWlmIChmbG9vcihpIC8gb3V0KSA+IG1heEludCAtIG4pIHsKCQkJZXJyb3IoJ292ZXJmbG93Jyk7CgkJfQoKCQluICs9IGZsb29yKGkgLyBvdXQpOwoJCWkgJT0gb3V0OwoKCQkvLyBJbnNlcnQgYG5gIGF0IHBvc2l0aW9uIGBpYCBvZiB0aGUgb3V0cHV0LgoJCW91dHB1dC5zcGxpY2UoaSsrLCAwLCBuKTsKCgl9CgoJcmV0dXJuIFN0cmluZy5mcm9tQ29kZVBvaW50KC4uLm91dHB1dCk7Cn07CgovKioKICogQ29udmVydHMgYSBzdHJpbmcgb2YgVW5pY29kZSBzeW1ib2xzIChlLmcuIGEgZG9tYWluIG5hbWUgbGFiZWwpIHRvIGEKICogUHVueWNvZGUgc3RyaW5nIG9mIEFTQ0lJLW9ubHkgc3ltYm9scy4KICogQG1lbWJlck9mIHB1bnljb2RlCiAqIEBwYXJhbSB7U3RyaW5nfSBpbnB1dCBUaGUgc3RyaW5nIG9mIFVuaWNvZGUgc3ltYm9scy4KICogQHJldHVybnMge1N0cmluZ30gVGhlIHJlc3VsdGluZyBQdW55Y29kZSBzdHJpbmcgb2YgQVNDSUktb25seSBzeW1ib2xzLgogKi8KY29uc3QgZW5jb2RlJDMgPSBmdW5jdGlvbihpbnB1dCkgewoJY29uc3Qgb3V0cHV0ID0gW107CgoJLy8gQ29udmVydCB0aGUgaW5wdXQgaW4gVUNTLTIgdG8gYW4gYXJyYXkgb2YgVW5pY29kZSBjb2RlIHBvaW50cy4KCWlucHV0ID0gdWNzMmRlY29kZShpbnB1dCk7CgoJLy8gQ2FjaGUgdGhlIGxlbmd0aC4KCWNvbnN0IGlucHV0TGVuZ3RoID0gaW5wdXQubGVuZ3RoOwoKCS8vIEluaXRpYWxpemUgdGhlIHN0YXRlLgoJbGV0IG4gPSBpbml0aWFsTjsKCWxldCBkZWx0YSA9IDA7CglsZXQgYmlhcyA9IGluaXRpYWxCaWFzOwoKCS8vIEhhbmRsZSB0aGUgYmFzaWMgY29kZSBwb2ludHMuCglmb3IgKGNvbnN0IGN1cnJlbnRWYWx1ZSBvZiBpbnB1dCkgewoJCWlmIChjdXJyZW50VmFsdWUgPCAweDgwKSB7CgkJCW91dHB1dC5wdXNoKHN0cmluZ0Zyb21DaGFyQ29kZShjdXJyZW50VmFsdWUpKTsKCQl9Cgl9CgoJY29uc3QgYmFzaWNMZW5ndGggPSBvdXRwdXQubGVuZ3RoOwoJbGV0IGhhbmRsZWRDUENvdW50ID0gYmFzaWNMZW5ndGg7CgoJLy8gYGhhbmRsZWRDUENvdW50YCBpcyB0aGUgbnVtYmVyIG9mIGNvZGUgcG9pbnRzIHRoYXQgaGF2ZSBiZWVuIGhhbmRsZWQ7CgkvLyBgYmFzaWNMZW5ndGhgIGlzIHRoZSBudW1iZXIgb2YgYmFzaWMgY29kZSBwb2ludHMuCgoJLy8gRmluaXNoIHRoZSBiYXNpYyBzdHJpbmcgd2l0aCBhIGRlbGltaXRlciB1bmxlc3MgaXQncyBlbXB0eS4KCWlmIChiYXNpY0xlbmd0aCkgewoJCW91dHB1dC5wdXNoKGRlbGltaXRlcik7Cgl9CgoJLy8gTWFpbiBlbmNvZGluZyBsb29wOgoJd2hpbGUgKGhhbmRsZWRDUENvdW50IDwgaW5wdXRMZW5ndGgpIHsKCgkJLy8gQWxsIG5vbi1iYXNpYyBjb2RlIHBvaW50cyA8IG4gaGF2ZSBiZWVuIGhhbmRsZWQgYWxyZWFkeS4gRmluZCB0aGUgbmV4dAoJCS8vIGxhcmdlciBvbmU6CgkJbGV0IG0gPSBtYXhJbnQ7CgkJZm9yIChjb25zdCBjdXJyZW50VmFsdWUgb2YgaW5wdXQpIHsKCQkJaWYgKGN1cnJlbnRWYWx1ZSA+PSBuICYmIGN1cnJlbnRWYWx1ZSA8IG0pIHsKCQkJCW0gPSBjdXJyZW50VmFsdWU7CgkJCX0KCQl9CgoJCS8vIEluY3JlYXNlIGBkZWx0YWAgZW5vdWdoIHRvIGFkdmFuY2UgdGhlIGRlY29kZXIncyA8bixpPiBzdGF0ZSB0byA8bSwwPiwKCQkvLyBidXQgZ3VhcmQgYWdhaW5zdCBvdmVyZmxvdy4KCQljb25zdCBoYW5kbGVkQ1BDb3VudFBsdXNPbmUgPSBoYW5kbGVkQ1BDb3VudCArIDE7CgkJaWYgKG0gLSBuID4gZmxvb3IoKG1heEludCAtIGRlbHRhKSAvIGhhbmRsZWRDUENvdW50UGx1c09uZSkpIHsKCQkJZXJyb3IoJ292ZXJmbG93Jyk7CgkJfQoKCQlkZWx0YSArPSAobSAtIG4pICogaGFuZGxlZENQQ291bnRQbHVzT25lOwoJCW4gPSBtOwoKCQlmb3IgKGNvbnN0IGN1cnJlbnRWYWx1ZSBvZiBpbnB1dCkgewoJCQlpZiAoY3VycmVudFZhbHVlIDwgbiAmJiArK2RlbHRhID4gbWF4SW50KSB7CgkJCQllcnJvcignb3ZlcmZsb3cnKTsKCQkJfQoJCQlpZiAoY3VycmVudFZhbHVlID09PSBuKSB7CgkJCQkvLyBSZXByZXNlbnQgZGVsdGEgYXMgYSBnZW5lcmFsaXplZCB2YXJpYWJsZS1sZW5ndGggaW50ZWdlci4KCQkJCWxldCBxID0gZGVsdGE7CgkJCQlmb3IgKGxldCBrID0gYmFzZTsgLyogbm8gY29uZGl0aW9uICovOyBrICs9IGJhc2UpIHsKCQkJCQljb25zdCB0ID0gayA8PSBiaWFzID8gdE1pbiA6IChrID49IGJpYXMgKyB0TWF4ID8gdE1heCA6IGsgLSBiaWFzKTsKCQkJCQlpZiAocSA8IHQpIHsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJCWNvbnN0IHFNaW51c1QgPSBxIC0gdDsKCQkJCQljb25zdCBiYXNlTWludXNUID0gYmFzZSAtIHQ7CgkJCQkJb3V0cHV0LnB1c2goCgkJCQkJCXN0cmluZ0Zyb21DaGFyQ29kZShkaWdpdFRvQmFzaWModCArIHFNaW51c1QgJSBiYXNlTWludXNULCAwKSkKCQkJCQkpOwoJCQkJCXEgPSBmbG9vcihxTWludXNUIC8gYmFzZU1pbnVzVCk7CgkJCQl9CgoJCQkJb3V0cHV0LnB1c2goc3RyaW5nRnJvbUNoYXJDb2RlKGRpZ2l0VG9CYXNpYyhxLCAwKSkpOwoJCQkJYmlhcyA9IGFkYXB0KGRlbHRhLCBoYW5kbGVkQ1BDb3VudFBsdXNPbmUsIGhhbmRsZWRDUENvdW50ID09PSBiYXNpY0xlbmd0aCk7CgkJCQlkZWx0YSA9IDA7CgkJCQkrK2hhbmRsZWRDUENvdW50OwoJCQl9CgkJfQoKCQkrK2RlbHRhOwoJCSsrbjsKCgl9CglyZXR1cm4gb3V0cHV0LmpvaW4oJycpOwp9OwoKLyoqCiAqIENvbnZlcnRzIGEgUHVueWNvZGUgc3RyaW5nIHJlcHJlc2VudGluZyBhIGRvbWFpbiBuYW1lIG9yIGFuIGVtYWlsIGFkZHJlc3MKICogdG8gVW5pY29kZS4gT25seSB0aGUgUHVueWNvZGVkIHBhcnRzIG9mIHRoZSBpbnB1dCB3aWxsIGJlIGNvbnZlcnRlZCwgaS5lLgogKiBpdCBkb2Vzbid0IG1hdHRlciBpZiB5b3UgY2FsbCBpdCBvbiBhIHN0cmluZyB0aGF0IGhhcyBhbHJlYWR5IGJlZW4KICogY29udmVydGVkIHRvIFVuaWNvZGUuCiAqIEBtZW1iZXJPZiBwdW55Y29kZQogKiBAcGFyYW0ge1N0cmluZ30gaW5wdXQgVGhlIFB1bnljb2RlZCBkb21haW4gbmFtZSBvciBlbWFpbCBhZGRyZXNzIHRvCiAqIGNvbnZlcnQgdG8gVW5pY29kZS4KICogQHJldHVybnMge1N0cmluZ30gVGhlIFVuaWNvZGUgcmVwcmVzZW50YXRpb24gb2YgdGhlIGdpdmVuIFB1bnljb2RlCiAqIHN0cmluZy4KICovCmNvbnN0IHRvVW5pY29kZSA9IGZ1bmN0aW9uKGlucHV0KSB7CglyZXR1cm4gbWFwRG9tYWluKGlucHV0LCBmdW5jdGlvbihzdHJpbmcpIHsKCQlyZXR1cm4gcmVnZXhQdW55Y29kZS50ZXN0KHN0cmluZykKCQkJPyBkZWNvZGUkMyhzdHJpbmcuc2xpY2UoNCkudG9Mb3dlckNhc2UoKSkKCQkJOiBzdHJpbmc7Cgl9KTsKfTsKCi8qKgogKiBDb252ZXJ0cyBhIFVuaWNvZGUgc3RyaW5nIHJlcHJlc2VudGluZyBhIGRvbWFpbiBuYW1lIG9yIGFuIGVtYWlsIGFkZHJlc3MgdG8KICogUHVueWNvZGUuIE9ubHkgdGhlIG5vbi1BU0NJSSBwYXJ0cyBvZiB0aGUgZG9tYWluIG5hbWUgd2lsbCBiZSBjb252ZXJ0ZWQsCiAqIGkuZS4gaXQgZG9lc24ndCBtYXR0ZXIgaWYgeW91IGNhbGwgaXQgd2l0aCBhIGRvbWFpbiB0aGF0J3MgYWxyZWFkeSBpbgogKiBBU0NJSS4KICogQG1lbWJlck9mIHB1bnljb2RlCiAqIEBwYXJhbSB7U3RyaW5nfSBpbnB1dCBUaGUgZG9tYWluIG5hbWUgb3IgZW1haWwgYWRkcmVzcyB0byBjb252ZXJ0LCBhcyBhCiAqIFVuaWNvZGUgc3RyaW5nLgogKiBAcmV0dXJucyB7U3RyaW5nfSBUaGUgUHVueWNvZGUgcmVwcmVzZW50YXRpb24gb2YgdGhlIGdpdmVuIGRvbWFpbiBuYW1lIG9yCiAqIGVtYWlsIGFkZHJlc3MuCiAqLwpjb25zdCB0b0FTQ0lJID0gZnVuY3Rpb24oaW5wdXQpIHsKCXJldHVybiBtYXBEb21haW4oaW5wdXQsIGZ1bmN0aW9uKHN0cmluZykgewoJCXJldHVybiByZWdleE5vbkFTQ0lJLnRlc3Qoc3RyaW5nKQoJCQk/ICd4bi0tJyArIGVuY29kZSQzKHN0cmluZykKCQkJOiBzdHJpbmc7Cgl9KTsKfTsKCi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKLyoqIERlZmluZSB0aGUgcHVibGljIEFQSSAqLwpjb25zdCBwdW55Y29kZSQxID0gewoJLyoqCgkgKiBBIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIGN1cnJlbnQgUHVueWNvZGUuanMgdmVyc2lvbiBudW1iZXIuCgkgKiBAbWVtYmVyT2YgcHVueWNvZGUKCSAqIEB0eXBlIFN0cmluZwoJICovCgkndmVyc2lvbic6ICcyLjEuMCcsCgkvKioKCSAqIEFuIG9iamVjdCBvZiBtZXRob2RzIHRvIGNvbnZlcnQgZnJvbSBKYXZhU2NyaXB0J3MgaW50ZXJuYWwgY2hhcmFjdGVyCgkgKiByZXByZXNlbnRhdGlvbiAoVUNTLTIpIHRvIFVuaWNvZGUgY29kZSBwb2ludHMsIGFuZCBiYWNrLgoJICogQHNlZSA8aHR0cHM6Ly9tYXRoaWFzYnluZW5zLmJlL25vdGVzL2phdmFzY3JpcHQtZW5jb2Rpbmc+CgkgKiBAbWVtYmVyT2YgcHVueWNvZGUKCSAqIEB0eXBlIE9iamVjdAoJICovCgkndWNzMic6IHsKCQknZGVjb2RlJzogdWNzMmRlY29kZSwKCQknZW5jb2RlJzogdWNzMmVuY29kZQoJfSwKCSdkZWNvZGUnOiBkZWNvZGUkMywKCSdlbmNvZGUnOiBlbmNvZGUkMywKCSd0b0FTQ0lJJzogdG9BU0NJSSwKCSd0b1VuaWNvZGUnOiB0b1VuaWNvZGUKfTsKCmNvbnN0IHB1bnljb2RlX2VzNiA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZGVjb2RlOiBkZWNvZGUkMywKICAgIGRlZmF1bHQ6IHB1bnljb2RlJDEsCiAgICBlbmNvZGU6IGVuY29kZSQzLAogICAgdG9BU0NJSSwKICAgIHRvVW5pY29kZSwKICAgIHVjczJkZWNvZGUsCiAgICB1Y3MyZW5jb2RlCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgcmVxdWlyZSQkMCQyID0gLypAX19QVVJFX18qL2dldEF1Z21lbnRlZE5hbWVzcGFjZShwdW55Y29kZV9lczYpOwoKLyoqCiAqIENoZWNrIGlmIHdlJ3JlIHJlcXVpcmVkIHRvIGFkZCBhIHBvcnQgbnVtYmVyLgogKgogKiBAc2VlIGh0dHBzOi8vdXJsLnNwZWMud2hhdHdnLm9yZy8jZGVmYXVsdC1wb3J0CiAqIEBwYXJhbSB7TnVtYmVyfFN0cmluZ30gcG9ydCBQb3J0IG51bWJlciB3ZSBuZWVkIHRvIGNoZWNrCiAqIEBwYXJhbSB7U3RyaW5nfSBwcm90b2NvbCBQcm90b2NvbCB3ZSBuZWVkIHRvIGNoZWNrIGFnYWluc3QuCiAqIEByZXR1cm5zIHtCb29sZWFufSBJcyBpdCBhIGRlZmF1bHQgcG9ydCBmb3IgdGhlIGdpdmVuIHByb3RvY29sCiAqIEBhcGkgcHJpdmF0ZQogKi8KdmFyIHJlcXVpcmVzUG9ydCA9IGZ1bmN0aW9uIHJlcXVpcmVkKHBvcnQsIHByb3RvY29sKSB7CiAgcHJvdG9jb2wgPSBwcm90b2NvbC5zcGxpdCgnOicpWzBdOwogIHBvcnQgPSArcG9ydDsKCiAgaWYgKCFwb3J0KSByZXR1cm4gZmFsc2U7CgogIHN3aXRjaCAocHJvdG9jb2wpIHsKICAgIGNhc2UgJ2h0dHAnOgogICAgY2FzZSAnd3MnOgogICAgcmV0dXJuIHBvcnQgIT09IDgwOwoKICAgIGNhc2UgJ2h0dHBzJzoKICAgIGNhc2UgJ3dzcyc6CiAgICByZXR1cm4gcG9ydCAhPT0gNDQzOwoKICAgIGNhc2UgJ2Z0cCc6CiAgICByZXR1cm4gcG9ydCAhPT0gMjE7CgogICAgY2FzZSAnZ29waGVyJzoKICAgIHJldHVybiBwb3J0ICE9PSA3MDsKCiAgICBjYXNlICdmaWxlJzoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIHJldHVybiBwb3J0ICE9PSAwOwp9OwoKdmFyIHF1ZXJ5c3RyaW5naWZ5JDEgPSB7fTsKCnZhciBoYXMkMSA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkKICAsIHVuZGVmOwoKLyoqCiAqIERlY29kZSBhIFVSSSBlbmNvZGVkIHN0cmluZy4KICoKICogQHBhcmFtIHtTdHJpbmd9IGlucHV0IFRoZSBVUkkgZW5jb2RlZCBzdHJpbmcuCiAqIEByZXR1cm5zIHtTdHJpbmd8TnVsbH0gVGhlIGRlY29kZWQgc3RyaW5nLgogKiBAYXBpIHByaXZhdGUKICovCmZ1bmN0aW9uIGRlY29kZSQyKGlucHV0KSB7CiAgdHJ5IHsKICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQoaW5wdXQucmVwbGFjZSgvXCsvZywgJyAnKSk7CiAgfSBjYXRjaCAoZSkgewogICAgcmV0dXJuIG51bGw7CiAgfQp9CgovKioKICogQXR0ZW1wdHMgdG8gZW5jb2RlIGEgZ2l2ZW4gaW5wdXQuCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBpbnB1dCBUaGUgc3RyaW5nIHRoYXQgbmVlZHMgdG8gYmUgZW5jb2RlZC4KICogQHJldHVybnMge1N0cmluZ3xOdWxsfSBUaGUgZW5jb2RlZCBzdHJpbmcuCiAqIEBhcGkgcHJpdmF0ZQogKi8KZnVuY3Rpb24gZW5jb2RlJDIoaW5wdXQpIHsKICB0cnkgewogICAgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudChpbnB1dCk7CiAgfSBjYXRjaCAoZSkgewogICAgcmV0dXJuIG51bGw7CiAgfQp9CgovKioKICogU2ltcGxlIHF1ZXJ5IHN0cmluZyBwYXJzZXIuCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBxdWVyeSBUaGUgcXVlcnkgc3RyaW5nIHRoYXQgbmVlZHMgdG8gYmUgcGFyc2VkLgogKiBAcmV0dXJucyB7T2JqZWN0fQogKiBAYXBpIHB1YmxpYwogKi8KZnVuY3Rpb24gcXVlcnlzdHJpbmcocXVlcnkpIHsKICB2YXIgcGFyc2VyID0gLyhbXj0/IyZdKyk9PyhbXiZdKikvZwogICAgLCByZXN1bHQgPSB7fQogICAgLCBwYXJ0OwoKICB3aGlsZSAocGFydCA9IHBhcnNlci5leGVjKHF1ZXJ5KSkgewogICAgdmFyIGtleSA9IGRlY29kZSQyKHBhcnRbMV0pCiAgICAgICwgdmFsdWUgPSBkZWNvZGUkMihwYXJ0WzJdKTsKCiAgICAvLwogICAgLy8gUHJldmVudCBvdmVycmlkaW5nIG9mIGV4aXN0aW5nIHByb3BlcnRpZXMuIFRoaXMgZW5zdXJlcyB0aGF0IGJ1aWxkLWluCiAgICAvLyBtZXRob2RzIGxpa2UgYHRvU3RyaW5nYCBvciBfX3Byb3RvX18gYXJlIG5vdCBvdmVycmlkZW4gYnkgbWFsaWNpb3VzCiAgICAvLyBxdWVyeXN0cmluZ3MuCiAgICAvLwogICAgLy8gSW4gdGhlIGNhc2UgaWYgZmFpbGVkIGRlY29kaW5nLCB3ZSB3YW50IHRvIG9taXQgdGhlIGtleS92YWx1ZSBwYWlycwogICAgLy8gZnJvbSB0aGUgcmVzdWx0LgogICAgLy8KICAgIGlmIChrZXkgPT09IG51bGwgfHwgdmFsdWUgPT09IG51bGwgfHwga2V5IGluIHJlc3VsdCkgY29udGludWU7CiAgICByZXN1bHRba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIHJlc3VsdDsKfQoKLyoqCiAqIFRyYW5zZm9ybSBhIHF1ZXJ5IHN0cmluZyB0byBhbiBvYmplY3QuCiAqCiAqIEBwYXJhbSB7T2JqZWN0fSBvYmogT2JqZWN0IHRoYXQgc2hvdWxkIGJlIHRyYW5zZm9ybWVkLgogKiBAcGFyYW0ge1N0cmluZ30gcHJlZml4IE9wdGlvbmFsIHByZWZpeC4KICogQHJldHVybnMge1N0cmluZ30KICogQGFwaSBwdWJsaWMKICovCmZ1bmN0aW9uIHF1ZXJ5c3RyaW5naWZ5KG9iaiwgcHJlZml4KSB7CiAgcHJlZml4ID0gcHJlZml4IHx8ICcnOwoKICB2YXIgcGFpcnMgPSBbXQogICAgLCB2YWx1ZQogICAgLCBrZXk7CgogIC8vCiAgLy8gT3B0aW9uYWxseSBwcmVmaXggd2l0aCBhICc/JyBpZiBuZWVkZWQKICAvLwogIGlmICgnc3RyaW5nJyAhPT0gdHlwZW9mIHByZWZpeCkgcHJlZml4ID0gJz8nOwoKICBmb3IgKGtleSBpbiBvYmopIHsKICAgIGlmIChoYXMkMS5jYWxsKG9iaiwga2V5KSkgewogICAgICB2YWx1ZSA9IG9ialtrZXldOwoKICAgICAgLy8KICAgICAgLy8gRWRnZSBjYXNlcyB3aGVyZSB3ZSBhY3R1YWxseSB3YW50IHRvIGVuY29kZSB0aGUgdmFsdWUgdG8gYW4gZW1wdHkKICAgICAgLy8gc3RyaW5nIGluc3RlYWQgb2YgdGhlIHN0cmluZ2lmaWVkIHZhbHVlLgogICAgICAvLwogICAgICBpZiAoIXZhbHVlICYmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWYgfHwgaXNOYU4odmFsdWUpKSkgewogICAgICAgIHZhbHVlID0gJyc7CiAgICAgIH0KCiAgICAgIGtleSA9IGVuY29kZSQyKGtleSk7CiAgICAgIHZhbHVlID0gZW5jb2RlJDIodmFsdWUpOwoKICAgICAgLy8KICAgICAgLy8gSWYgd2UgZmFpbGVkIHRvIGVuY29kZSB0aGUgc3RyaW5ncywgd2Ugc2hvdWxkIGJhaWwgb3V0IGFzIHdlIGRvbid0CiAgICAgIC8vIHdhbnQgdG8gYWRkIGludmFsaWQgc3RyaW5ncyB0byB0aGUgcXVlcnkuCiAgICAgIC8vCiAgICAgIGlmIChrZXkgPT09IG51bGwgfHwgdmFsdWUgPT09IG51bGwpIGNvbnRpbnVlOwogICAgICBwYWlycy5wdXNoKGtleSArJz0nKyB2YWx1ZSk7CiAgICB9CiAgfQoKICByZXR1cm4gcGFpcnMubGVuZ3RoID8gcHJlZml4ICsgcGFpcnMuam9pbignJicpIDogJyc7Cn0KCi8vCi8vIEV4cG9zZSB0aGUgbW9kdWxlLgovLwpxdWVyeXN0cmluZ2lmeSQxLnN0cmluZ2lmeSA9IHF1ZXJ5c3RyaW5naWZ5OwpxdWVyeXN0cmluZ2lmeSQxLnBhcnNlID0gcXVlcnlzdHJpbmc7Cgp2YXIgcmVxdWlyZWQgPSByZXF1aXJlc1BvcnQKICAsIHFzJDEgPSBxdWVyeXN0cmluZ2lmeSQxCiAgLCBjb250cm9sT3JXaGl0ZXNwYWNlID0gL15bXHgwMC1ceDIwXHUwMGEwXHUxNjgwXHUyMDAwLVx1MjAwYVx1MjAyOFx1MjAyOVx1MjAyZlx1MjA1Zlx1MzAwMFx1ZmVmZl0rLwogICwgQ1JIVExGID0gL1tcblxyXHRdL2cKICAsIHNsYXNoZXMgPSAvXltBLVphLXpdW0EtWmEtejAtOSstLl0qOlwvXC8vCiAgLCBwb3J0ID0gLzpcZCskLwogICwgcHJvdG9jb2xyZSA9IC9eKFthLXpdW2EtejAtOS4rLV0qOik/KFwvXC8pPyhbXFwvXSspPyhbXFNcc10qKS9pCiAgLCB3aW5kb3dzRHJpdmVMZXR0ZXIgPSAvXlthLXpBLVpdOi87CgovKioKICogUmVtb3ZlIGNvbnRyb2wgY2hhcmFjdGVycyBhbmQgd2hpdGVzcGFjZSBmcm9tIHRoZSBiZWdpbm5pbmcgb2YgYSBzdHJpbmcuCiAqCiAqIEBwYXJhbSB7T2JqZWN0fFN0cmluZ30gc3RyIFN0cmluZyB0byB0cmltLgogKiBAcmV0dXJucyB7U3RyaW5nfSBBIG5ldyBzdHJpbmcgcmVwcmVzZW50aW5nIGBzdHJgIHN0cmlwcGVkIG9mIGNvbnRyb2wKICogICAgIGNoYXJhY3RlcnMgYW5kIHdoaXRlc3BhY2UgZnJvbSBpdHMgYmVnaW5uaW5nLgogKiBAcHVibGljCiAqLwpmdW5jdGlvbiB0cmltTGVmdChzdHIpIHsKICByZXR1cm4gKHN0ciA/IHN0ciA6ICcnKS50b1N0cmluZygpLnJlcGxhY2UoY29udHJvbE9yV2hpdGVzcGFjZSwgJycpOwp9CgovKioKICogVGhlc2UgYXJlIHRoZSBwYXJzZSBydWxlcyBmb3IgdGhlIFVSTCBwYXJzZXIsIGl0IGluZm9ybXMgdGhlIHBhcnNlcgogKiBhYm91dDoKICoKICogMC4gVGhlIGNoYXIgaXQgTmVlZHMgdG8gcGFyc2UsIGlmIGl0J3MgYSBzdHJpbmcgaXQgc2hvdWxkIGJlIGRvbmUgdXNpbmcKICogICAgaW5kZXhPZiwgUmVnRXhwIHVzaW5nIGV4ZWMgYW5kIE5hTiBtZWFucyBzZXQgYXMgY3VycmVudCB2YWx1ZS4KICogMS4gVGhlIHByb3BlcnR5IHdlIHNob3VsZCBzZXQgd2hlbiBwYXJzaW5nIHRoaXMgdmFsdWUuCiAqIDIuIEluZGljYXRpb24gaWYgaXQncyBiYWNrd2FyZHMgb3IgZm9yd2FyZCBwYXJzaW5nLCB3aGVuIHNldCBhcyBudW1iZXIgaXQncwogKiAgICB0aGUgdmFsdWUgb2YgZXh0cmEgY2hhcnMgdGhhdCBzaG91bGQgYmUgc3BsaXQgb2ZmLgogKiAzLiBJbmhlcml0IGZyb20gbG9jYXRpb24gaWYgbm9uIGV4aXN0aW5nIGluIHRoZSBwYXJzZXIuCiAqIDQuIGB0b0xvd2VyQ2FzZWAgdGhlIHJlc3VsdGluZyB2YWx1ZS4KICovCnZhciBydWxlcyA9IFsKICBbJyMnLCAnaGFzaCddLCAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4dHJhY3QgZnJvbSB0aGUgYmFjay4KICBbJz8nLCAncXVlcnknXSwgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4dHJhY3QgZnJvbSB0aGUgYmFjay4KICBmdW5jdGlvbiBzYW5pdGl6ZShhZGRyZXNzLCB1cmwpIHsgICAgIC8vIFNhbml0aXplIHdoYXQgaXMgbGVmdCBvZiB0aGUgYWRkcmVzcwogICAgcmV0dXJuIGlzU3BlY2lhbCh1cmwucHJvdG9jb2wpID8gYWRkcmVzcy5yZXBsYWNlKC9cXC9nLCAnLycpIDogYWRkcmVzczsKICB9LAogIFsnLycsICdwYXRobmFtZSddLCAgICAgICAgICAgICAgICAgICAgLy8gRXh0cmFjdCBmcm9tIHRoZSBiYWNrLgogIFsnQCcsICdhdXRoJywgMV0sICAgICAgICAgICAgICAgICAgICAgLy8gRXh0cmFjdCBmcm9tIHRoZSBmcm9udC4KICBbTmFOLCAnaG9zdCcsIHVuZGVmaW5lZCwgMSwgMV0sICAgICAgIC8vIFNldCBsZWZ0IG92ZXIgdmFsdWUuCiAgWy86KFxkKikkLywgJ3BvcnQnLCB1bmRlZmluZWQsIDFdLCAgICAvLyBSZWdFeHAgdGhlIGJhY2suCiAgW05hTiwgJ2hvc3RuYW1lJywgdW5kZWZpbmVkLCAxLCAxXSAgICAvLyBTZXQgbGVmdCBvdmVyLgpdOwoKLyoqCiAqIFRoZXNlIHByb3BlcnRpZXMgc2hvdWxkIG5vdCBiZSBjb3BpZWQgb3IgaW5oZXJpdGVkIGZyb20uIFRoaXMgaXMgb25seSBuZWVkZWQKICogZm9yIGFsbCBub24gYmxvYiBVUkwncyBhcyBhIGJsb2IgVVJMIGRvZXMgbm90IGluY2x1ZGUgYSBoYXNoLCBvbmx5IHRoZQogKiBvcmlnaW4uCiAqCiAqIEB0eXBlIHtPYmplY3R9CiAqIEBwcml2YXRlCiAqLwp2YXIgaWdub3JlID0geyBoYXNoOiAxLCBxdWVyeTogMSB9OwoKLyoqCiAqIFRoZSBsb2NhdGlvbiBvYmplY3QgZGlmZmVycyB3aGVuIHlvdXIgY29kZSBpcyBsb2FkZWQgdGhyb3VnaCBhIG5vcm1hbCBwYWdlLAogKiBXb3JrZXIgb3IgdGhyb3VnaCBhIHdvcmtlciB1c2luZyBhIGJsb2IuIEFuZCB3aXRoIHRoZSBibG9iYmxlIGJlZ2lucyB0aGUKICogdHJvdWJsZSBhcyB0aGUgbG9jYXRpb24gb2JqZWN0IHdpbGwgY29udGFpbiB0aGUgVVJMIG9mIHRoZSBibG9iLCBub3QgdGhlCiAqIGxvY2F0aW9uIG9mIHRoZSBwYWdlIHdoZXJlIG91ciBjb2RlIGlzIGxvYWRlZCBpbi4gVGhlIGFjdHVhbCBvcmlnaW4gaXMKICogZW5jb2RlZCBpbiB0aGUgYHBhdGhuYW1lYCBzbyB3ZSBjYW4gdGhhbmtmdWxseSBnZW5lcmF0ZSBhIGdvb2QgImRlZmF1bHQiCiAqIGxvY2F0aW9uIGZyb20gaXQgc28gd2UgY2FuIGdlbmVyYXRlIHByb3BlciByZWxhdGl2ZSBVUkwncyBhZ2Fpbi4KICoKICogQHBhcmFtIHtPYmplY3R8U3RyaW5nfSBsb2MgT3B0aW9uYWwgZGVmYXVsdCBsb2NhdGlvbiBvYmplY3QuCiAqIEByZXR1cm5zIHtPYmplY3R9IGxvbGNhdGlvbiBvYmplY3QuCiAqIEBwdWJsaWMKICovCmZ1bmN0aW9uIGxvbGNhdGlvbihsb2MpIHsKICB2YXIgZ2xvYmFsVmFyOwoKICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIGdsb2JhbFZhciA9IHdpbmRvdzsKICBlbHNlIGlmICh0eXBlb2YgY29tbW9uanNHbG9iYWwgIT09ICd1bmRlZmluZWQnKSBnbG9iYWxWYXIgPSBjb21tb25qc0dsb2JhbDsKICBlbHNlIGlmICh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcpIGdsb2JhbFZhciA9IHNlbGY7CiAgZWxzZSBnbG9iYWxWYXIgPSB7fTsKCiAgdmFyIGxvY2F0aW9uID0gZ2xvYmFsVmFyLmxvY2F0aW9uIHx8IHt9OwogIGxvYyA9IGxvYyB8fCBsb2NhdGlvbjsKCiAgdmFyIGZpbmFsZGVzdGluYXRpb24gPSB7fQogICAgLCB0eXBlID0gdHlwZW9mIGxvYwogICAgLCBrZXk7CgogIGlmICgnYmxvYjonID09PSBsb2MucHJvdG9jb2wpIHsKICAgIGZpbmFsZGVzdGluYXRpb24gPSBuZXcgVXJsJDIodW5lc2NhcGUobG9jLnBhdGhuYW1lKSwge30pOwogIH0gZWxzZSBpZiAoJ3N0cmluZycgPT09IHR5cGUpIHsKICAgIGZpbmFsZGVzdGluYXRpb24gPSBuZXcgVXJsJDIobG9jLCB7fSk7CiAgICBmb3IgKGtleSBpbiBpZ25vcmUpIGRlbGV0ZSBmaW5hbGRlc3RpbmF0aW9uW2tleV07CiAgfSBlbHNlIGlmICgnb2JqZWN0JyA9PT0gdHlwZSkgewogICAgZm9yIChrZXkgaW4gbG9jKSB7CiAgICAgIGlmIChrZXkgaW4gaWdub3JlKSBjb250aW51ZTsKICAgICAgZmluYWxkZXN0aW5hdGlvbltrZXldID0gbG9jW2tleV07CiAgICB9CgogICAgaWYgKGZpbmFsZGVzdGluYXRpb24uc2xhc2hlcyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGZpbmFsZGVzdGluYXRpb24uc2xhc2hlcyA9IHNsYXNoZXMudGVzdChsb2MuaHJlZik7CiAgICB9CiAgfQoKICByZXR1cm4gZmluYWxkZXN0aW5hdGlvbjsKfQoKLyoqCiAqIENoZWNrIHdoZXRoZXIgYSBwcm90b2NvbCBzY2hlbWUgaXMgc3BlY2lhbC4KICoKICogQHBhcmFtIHtTdHJpbmd9IFRoZSBwcm90b2NvbCBzY2hlbWUgb2YgdGhlIFVSTAogKiBAcmV0dXJuIHtCb29sZWFufSBgdHJ1ZWAgaWYgdGhlIHByb3RvY29sIHNjaGVtZSBpcyBzcGVjaWFsLCBlbHNlIGBmYWxzZWAKICogQHByaXZhdGUKICovCmZ1bmN0aW9uIGlzU3BlY2lhbChzY2hlbWUpIHsKICByZXR1cm4gKAogICAgc2NoZW1lID09PSAnZmlsZTonIHx8CiAgICBzY2hlbWUgPT09ICdmdHA6JyB8fAogICAgc2NoZW1lID09PSAnaHR0cDonIHx8CiAgICBzY2hlbWUgPT09ICdodHRwczonIHx8CiAgICBzY2hlbWUgPT09ICd3czonIHx8CiAgICBzY2hlbWUgPT09ICd3c3M6JwogICk7Cn0KCi8qKgogKiBAdHlwZWRlZiBQcm90b2NvbEV4dHJhY3QKICogQHR5cGUgT2JqZWN0CiAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBwcm90b2NvbCBQcm90b2NvbCBtYXRjaGVkIGluIHRoZSBVUkwsIGluIGxvd2VyY2FzZS4KICogQHByb3BlcnR5IHtCb29sZWFufSBzbGFzaGVzIGB0cnVlYCBpZiBwcm90b2NvbCBpcyBmb2xsb3dlZCBieSAiLy8iLCBlbHNlIGBmYWxzZWAuCiAqIEBwcm9wZXJ0eSB7U3RyaW5nfSByZXN0IFJlc3Qgb2YgdGhlIFVSTCB0aGF0IGlzIG5vdCBwYXJ0IG9mIHRoZSBwcm90b2NvbC4KICovCgovKioKICogRXh0cmFjdCBwcm90b2NvbCBpbmZvcm1hdGlvbiBmcm9tIGEgVVJMIHdpdGgvd2l0aG91dCBkb3VibGUgc2xhc2ggKCIvLyIpLgogKgogKiBAcGFyYW0ge1N0cmluZ30gYWRkcmVzcyBVUkwgd2Ugd2FudCB0byBleHRyYWN0IGZyb20uCiAqIEBwYXJhbSB7T2JqZWN0fSBsb2NhdGlvbgogKiBAcmV0dXJuIHtQcm90b2NvbEV4dHJhY3R9IEV4dHJhY3RlZCBpbmZvcm1hdGlvbi4KICogQHByaXZhdGUKICovCmZ1bmN0aW9uIGV4dHJhY3RQcm90b2NvbChhZGRyZXNzLCBsb2NhdGlvbikgewogIGFkZHJlc3MgPSB0cmltTGVmdChhZGRyZXNzKTsKICBhZGRyZXNzID0gYWRkcmVzcy5yZXBsYWNlKENSSFRMRiwgJycpOwogIGxvY2F0aW9uID0gbG9jYXRpb24gfHwge307CgogIHZhciBtYXRjaCA9IHByb3RvY29scmUuZXhlYyhhZGRyZXNzKTsKICB2YXIgcHJvdG9jb2wgPSBtYXRjaFsxXSA/IG1hdGNoWzFdLnRvTG93ZXJDYXNlKCkgOiAnJzsKICB2YXIgZm9yd2FyZFNsYXNoZXMgPSAhIW1hdGNoWzJdOwogIHZhciBvdGhlclNsYXNoZXMgPSAhIW1hdGNoWzNdOwogIHZhciBzbGFzaGVzQ291bnQgPSAwOwogIHZhciByZXN0OwoKICBpZiAoZm9yd2FyZFNsYXNoZXMpIHsKICAgIGlmIChvdGhlclNsYXNoZXMpIHsKICAgICAgcmVzdCA9IG1hdGNoWzJdICsgbWF0Y2hbM10gKyBtYXRjaFs0XTsKICAgICAgc2xhc2hlc0NvdW50ID0gbWF0Y2hbMl0ubGVuZ3RoICsgbWF0Y2hbM10ubGVuZ3RoOwogICAgfSBlbHNlIHsKICAgICAgcmVzdCA9IG1hdGNoWzJdICsgbWF0Y2hbNF07CiAgICAgIHNsYXNoZXNDb3VudCA9IG1hdGNoWzJdLmxlbmd0aDsKICAgIH0KICB9IGVsc2UgewogICAgaWYgKG90aGVyU2xhc2hlcykgewogICAgICByZXN0ID0gbWF0Y2hbM10gKyBtYXRjaFs0XTsKICAgICAgc2xhc2hlc0NvdW50ID0gbWF0Y2hbM10ubGVuZ3RoOwogICAgfSBlbHNlIHsKICAgICAgcmVzdCA9IG1hdGNoWzRdOwogICAgfQogIH0KCiAgaWYgKHByb3RvY29sID09PSAnZmlsZTonKSB7CiAgICBpZiAoc2xhc2hlc0NvdW50ID49IDIpIHsKICAgICAgcmVzdCA9IHJlc3Quc2xpY2UoMik7CiAgICB9CiAgfSBlbHNlIGlmIChpc1NwZWNpYWwocHJvdG9jb2wpKSB7CiAgICByZXN0ID0gbWF0Y2hbNF07CiAgfSBlbHNlIGlmIChwcm90b2NvbCkgewogICAgaWYgKGZvcndhcmRTbGFzaGVzKSB7CiAgICAgIHJlc3QgPSByZXN0LnNsaWNlKDIpOwogICAgfQogIH0gZWxzZSBpZiAoc2xhc2hlc0NvdW50ID49IDIgJiYgaXNTcGVjaWFsKGxvY2F0aW9uLnByb3RvY29sKSkgewogICAgcmVzdCA9IG1hdGNoWzRdOwogIH0KCiAgcmV0dXJuIHsKICAgIHByb3RvY29sOiBwcm90b2NvbCwKICAgIHNsYXNoZXM6IGZvcndhcmRTbGFzaGVzIHx8IGlzU3BlY2lhbChwcm90b2NvbCksCiAgICBzbGFzaGVzQ291bnQ6IHNsYXNoZXNDb3VudCwKICAgIHJlc3Q6IHJlc3QKICB9Owp9CgovKioKICogUmVzb2x2ZSBhIHJlbGF0aXZlIFVSTCBwYXRobmFtZSBhZ2FpbnN0IGEgYmFzZSBVUkwgcGF0aG5hbWUuCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSByZWxhdGl2ZSBQYXRobmFtZSBvZiB0aGUgcmVsYXRpdmUgVVJMLgogKiBAcGFyYW0ge1N0cmluZ30gYmFzZSBQYXRobmFtZSBvZiB0aGUgYmFzZSBVUkwuCiAqIEByZXR1cm4ge1N0cmluZ30gUmVzb2x2ZWQgcGF0aG5hbWUuCiAqIEBwcml2YXRlCiAqLwpmdW5jdGlvbiByZXNvbHZlKHJlbGF0aXZlLCBiYXNlKSB7CiAgaWYgKHJlbGF0aXZlID09PSAnJykgcmV0dXJuIGJhc2U7CgogIHZhciBwYXRoID0gKGJhc2UgfHwgJy8nKS5zcGxpdCgnLycpLnNsaWNlKDAsIC0xKS5jb25jYXQocmVsYXRpdmUuc3BsaXQoJy8nKSkKICAgICwgaSA9IHBhdGgubGVuZ3RoCiAgICAsIGxhc3QgPSBwYXRoW2kgLSAxXQogICAgLCB1bnNoaWZ0ID0gZmFsc2UKICAgICwgdXAgPSAwOwoKICB3aGlsZSAoaS0tKSB7CiAgICBpZiAocGF0aFtpXSA9PT0gJy4nKSB7CiAgICAgIHBhdGguc3BsaWNlKGksIDEpOwogICAgfSBlbHNlIGlmIChwYXRoW2ldID09PSAnLi4nKSB7CiAgICAgIHBhdGguc3BsaWNlKGksIDEpOwogICAgICB1cCsrOwogICAgfSBlbHNlIGlmICh1cCkgewogICAgICBpZiAoaSA9PT0gMCkgdW5zaGlmdCA9IHRydWU7CiAgICAgIHBhdGguc3BsaWNlKGksIDEpOwogICAgICB1cC0tOwogICAgfQogIH0KCiAgaWYgKHVuc2hpZnQpIHBhdGgudW5zaGlmdCgnJyk7CiAgaWYgKGxhc3QgPT09ICcuJyB8fCBsYXN0ID09PSAnLi4nKSBwYXRoLnB1c2goJycpOwoKICByZXR1cm4gcGF0aC5qb2luKCcvJyk7Cn0KCi8qKgogKiBUaGUgYWN0dWFsIFVSTCBpbnN0YW5jZS4gSW5zdGVhZCBvZiByZXR1cm5pbmcgYW4gb2JqZWN0IHdlJ3ZlIG9wdGVkLWluIHRvCiAqIGNyZWF0ZSBhbiBhY3R1YWwgY29uc3RydWN0b3IgYXMgaXQncyBtdWNoIG1vcmUgbWVtb3J5IGVmZmljaWVudCBhbmQKICogZmFzdGVyIGFuZCBpdCBwbGVhc2VzIG15IE9DRC4KICoKICogSXQgaXMgd29ydGggbm90aW5nIHRoYXQgd2Ugc2hvdWxkIG5vdCB1c2UgYFVSTGAgYXMgY2xhc3MgbmFtZSB0byBwcmV2ZW50CiAqIGNsYXNoZXMgd2l0aCB0aGUgZ2xvYmFsIFVSTCBpbnN0YW5jZSB0aGF0IGdvdCBpbnRyb2R1Y2VkIGluIGJyb3dzZXJzLgogKgogKiBAY29uc3RydWN0b3IKICogQHBhcmFtIHtTdHJpbmd9IGFkZHJlc3MgVVJMIHdlIHdhbnQgdG8gcGFyc2UuCiAqIEBwYXJhbSB7T2JqZWN0fFN0cmluZ30gW2xvY2F0aW9uXSBMb2NhdGlvbiBkZWZhdWx0cyBmb3IgcmVsYXRpdmUgcGF0aHMuCiAqIEBwYXJhbSB7Qm9vbGVhbnxGdW5jdGlvbn0gW3BhcnNlcl0gUGFyc2VyIGZvciB0aGUgcXVlcnkgc3RyaW5nLgogKiBAcHJpdmF0ZQogKi8KZnVuY3Rpb24gVXJsJDIoYWRkcmVzcywgbG9jYXRpb24sIHBhcnNlcikgewogIGFkZHJlc3MgPSB0cmltTGVmdChhZGRyZXNzKTsKICBhZGRyZXNzID0gYWRkcmVzcy5yZXBsYWNlKENSSFRMRiwgJycpOwoKICBpZiAoISh0aGlzIGluc3RhbmNlb2YgVXJsJDIpKSB7CiAgICByZXR1cm4gbmV3IFVybCQyKGFkZHJlc3MsIGxvY2F0aW9uLCBwYXJzZXIpOwogIH0KCiAgdmFyIHJlbGF0aXZlLCBleHRyYWN0ZWQsIHBhcnNlLCBpbnN0cnVjdGlvbiwgaW5kZXgsIGtleQogICAgLCBpbnN0cnVjdGlvbnMgPSBydWxlcy5zbGljZSgpCiAgICAsIHR5cGUgPSB0eXBlb2YgbG9jYXRpb24KICAgICwgdXJsID0gdGhpcwogICAgLCBpID0gMDsKCiAgLy8KICAvLyBUaGUgZm9sbG93aW5nIGlmIHN0YXRlbWVudHMgYWxsb3dzIHRoaXMgbW9kdWxlIHR3byBoYXZlIGNvbXBhdGliaWxpdHkgd2l0aAogIC8vIDIgZGlmZmVyZW50IEFQSToKICAvLwogIC8vIDEuIE5vZGUuanMncyBgdXJsLnBhcnNlYCBhcGkgd2hpY2ggYWNjZXB0cyBhIFVSTCwgYm9vbGVhbiBhcyBhcmd1bWVudHMKICAvLyAgICB3aGVyZSB0aGUgYm9vbGVhbiBpbmRpY2F0ZXMgdGhhdCB0aGUgcXVlcnkgc3RyaW5nIHNob3VsZCBhbHNvIGJlIHBhcnNlZC4KICAvLwogIC8vIDIuIFRoZSBgVVJMYCBpbnRlcmZhY2Ugb2YgdGhlIGJyb3dzZXIgd2hpY2ggYWNjZXB0cyBhIFVSTCwgb2JqZWN0IGFzCiAgLy8gICAgYXJndW1lbnRzLiBUaGUgc3VwcGxpZWQgb2JqZWN0IHdpbGwgYmUgdXNlZCBhcyBkZWZhdWx0IHZhbHVlcyAvIGZhbGwtYmFjawogIC8vICAgIGZvciByZWxhdGl2ZSBwYXRocy4KICAvLwogIGlmICgnb2JqZWN0JyAhPT0gdHlwZSAmJiAnc3RyaW5nJyAhPT0gdHlwZSkgewogICAgcGFyc2VyID0gbG9jYXRpb247CiAgICBsb2NhdGlvbiA9IG51bGw7CiAgfQoKICBpZiAocGFyc2VyICYmICdmdW5jdGlvbicgIT09IHR5cGVvZiBwYXJzZXIpIHBhcnNlciA9IHFzJDEucGFyc2U7CgogIGxvY2F0aW9uID0gbG9sY2F0aW9uKGxvY2F0aW9uKTsKCiAgLy8KICAvLyBFeHRyYWN0IHByb3RvY29sIGluZm9ybWF0aW9uIGJlZm9yZSBydW5uaW5nIHRoZSBpbnN0cnVjdGlvbnMuCiAgLy8KICBleHRyYWN0ZWQgPSBleHRyYWN0UHJvdG9jb2woYWRkcmVzcyB8fCAnJywgbG9jYXRpb24pOwogIHJlbGF0aXZlID0gIWV4dHJhY3RlZC5wcm90b2NvbCAmJiAhZXh0cmFjdGVkLnNsYXNoZXM7CiAgdXJsLnNsYXNoZXMgPSBleHRyYWN0ZWQuc2xhc2hlcyB8fCByZWxhdGl2ZSAmJiBsb2NhdGlvbi5zbGFzaGVzOwogIHVybC5wcm90b2NvbCA9IGV4dHJhY3RlZC5wcm90b2NvbCB8fCBsb2NhdGlvbi5wcm90b2NvbCB8fCAnJzsKICBhZGRyZXNzID0gZXh0cmFjdGVkLnJlc3Q7CgogIC8vCiAgLy8gV2hlbiB0aGUgYXV0aG9yaXR5IGNvbXBvbmVudCBpcyBhYnNlbnQgdGhlIFVSTCBzdGFydHMgd2l0aCBhIHBhdGgKICAvLyBjb21wb25lbnQuCiAgLy8KICBpZiAoCiAgICBleHRyYWN0ZWQucHJvdG9jb2wgPT09ICdmaWxlOicgJiYgKAogICAgICBleHRyYWN0ZWQuc2xhc2hlc0NvdW50ICE9PSAyIHx8IHdpbmRvd3NEcml2ZUxldHRlci50ZXN0KGFkZHJlc3MpKSB8fAogICAgKCFleHRyYWN0ZWQuc2xhc2hlcyAmJgogICAgICAoZXh0cmFjdGVkLnByb3RvY29sIHx8CiAgICAgICAgZXh0cmFjdGVkLnNsYXNoZXNDb3VudCA8IDIgfHwKICAgICAgICAhaXNTcGVjaWFsKHVybC5wcm90b2NvbCkpKQogICkgewogICAgaW5zdHJ1Y3Rpb25zWzNdID0gWy8oLiopLywgJ3BhdGhuYW1lJ107CiAgfQoKICBmb3IgKDsgaSA8IGluc3RydWN0aW9ucy5sZW5ndGg7IGkrKykgewogICAgaW5zdHJ1Y3Rpb24gPSBpbnN0cnVjdGlvbnNbaV07CgogICAgaWYgKHR5cGVvZiBpbnN0cnVjdGlvbiA9PT0gJ2Z1bmN0aW9uJykgewogICAgICBhZGRyZXNzID0gaW5zdHJ1Y3Rpb24oYWRkcmVzcywgdXJsKTsKICAgICAgY29udGludWU7CiAgICB9CgogICAgcGFyc2UgPSBpbnN0cnVjdGlvblswXTsKICAgIGtleSA9IGluc3RydWN0aW9uWzFdOwoKICAgIGlmIChwYXJzZSAhPT0gcGFyc2UpIHsKICAgICAgdXJsW2tleV0gPSBhZGRyZXNzOwogICAgfSBlbHNlIGlmICgnc3RyaW5nJyA9PT0gdHlwZW9mIHBhcnNlKSB7CiAgICAgIGluZGV4ID0gcGFyc2UgPT09ICdAJwogICAgICAgID8gYWRkcmVzcy5sYXN0SW5kZXhPZihwYXJzZSkKICAgICAgICA6IGFkZHJlc3MuaW5kZXhPZihwYXJzZSk7CgogICAgICBpZiAofmluZGV4KSB7CiAgICAgICAgaWYgKCdudW1iZXInID09PSB0eXBlb2YgaW5zdHJ1Y3Rpb25bMl0pIHsKICAgICAgICAgIHVybFtrZXldID0gYWRkcmVzcy5zbGljZSgwLCBpbmRleCk7CiAgICAgICAgICBhZGRyZXNzID0gYWRkcmVzcy5zbGljZShpbmRleCArIGluc3RydWN0aW9uWzJdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdXJsW2tleV0gPSBhZGRyZXNzLnNsaWNlKGluZGV4KTsKICAgICAgICAgIGFkZHJlc3MgPSBhZGRyZXNzLnNsaWNlKDAsIGluZGV4KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoKGluZGV4ID0gcGFyc2UuZXhlYyhhZGRyZXNzKSkpIHsKICAgICAgdXJsW2tleV0gPSBpbmRleFsxXTsKICAgICAgYWRkcmVzcyA9IGFkZHJlc3Muc2xpY2UoMCwgaW5kZXguaW5kZXgpOwogICAgfQoKICAgIHVybFtrZXldID0gdXJsW2tleV0gfHwgKAogICAgICByZWxhdGl2ZSAmJiBpbnN0cnVjdGlvblszXSA/IGxvY2F0aW9uW2tleV0gfHwgJycgOiAnJwogICAgKTsKCiAgICAvLwogICAgLy8gSG9zdG5hbWUsIGhvc3QgYW5kIHByb3RvY29sIHNob3VsZCBiZSBsb3dlcmNhc2VkIHNvIHRoZXkgY2FuIGJlIHVzZWQgdG8KICAgIC8vIGNyZWF0ZSBhIHByb3BlciBgb3JpZ2luYC4KICAgIC8vCiAgICBpZiAoaW5zdHJ1Y3Rpb25bNF0pIHVybFtrZXldID0gdXJsW2tleV0udG9Mb3dlckNhc2UoKTsKICB9CgogIC8vCiAgLy8gQWxzbyBwYXJzZSB0aGUgc3VwcGxpZWQgcXVlcnkgc3RyaW5nIGluIHRvIGFuIG9iamVjdC4gSWYgd2UncmUgc3VwcGxpZWQKICAvLyB3aXRoIGEgY3VzdG9tIHBhcnNlciBhcyBmdW5jdGlvbiB1c2UgdGhhdCBpbnN0ZWFkIG9mIHRoZSBkZWZhdWx0IGJ1aWxkLWluCiAgLy8gcGFyc2VyLgogIC8vCiAgaWYgKHBhcnNlcikgdXJsLnF1ZXJ5ID0gcGFyc2VyKHVybC5xdWVyeSk7CgogIC8vCiAgLy8gSWYgdGhlIFVSTCBpcyByZWxhdGl2ZSwgcmVzb2x2ZSB0aGUgcGF0aG5hbWUgYWdhaW5zdCB0aGUgYmFzZSBVUkwuCiAgLy8KICBpZiAoCiAgICAgIHJlbGF0aXZlCiAgICAmJiBsb2NhdGlvbi5zbGFzaGVzCiAgICAmJiB1cmwucGF0aG5hbWUuY2hhckF0KDApICE9PSAnLycKICAgICYmICh1cmwucGF0aG5hbWUgIT09ICcnIHx8IGxvY2F0aW9uLnBhdGhuYW1lICE9PSAnJykKICApIHsKICAgIHVybC5wYXRobmFtZSA9IHJlc29sdmUodXJsLnBhdGhuYW1lLCBsb2NhdGlvbi5wYXRobmFtZSk7CiAgfQoKICAvLwogIC8vIERlZmF1bHQgdG8gYSAvIGZvciBwYXRobmFtZSBpZiBub25lIGV4aXN0cy4gVGhpcyBub3JtYWxpemVzIHRoZSBVUkwKICAvLyB0byBhbHdheXMgaGF2ZSBhIC8KICAvLwogIGlmICh1cmwucGF0aG5hbWUuY2hhckF0KDApICE9PSAnLycgJiYgaXNTcGVjaWFsKHVybC5wcm90b2NvbCkpIHsKICAgIHVybC5wYXRobmFtZSA9ICcvJyArIHVybC5wYXRobmFtZTsKICB9CgogIC8vCiAgLy8gV2Ugc2hvdWxkIG5vdCBhZGQgcG9ydCBudW1iZXJzIGlmIHRoZXkgYXJlIGFscmVhZHkgdGhlIGRlZmF1bHQgcG9ydCBudW1iZXIKICAvLyBmb3IgYSBnaXZlbiBwcm90b2NvbC4gQXMgdGhlIGhvc3QgYWxzbyBjb250YWlucyB0aGUgcG9ydCBudW1iZXIgd2UncmUgZ29pbmcKICAvLyBvdmVycmlkZSBpdCB3aXRoIHRoZSBob3N0bmFtZSB3aGljaCBjb250YWlucyBubyBwb3J0IG51bWJlci4KICAvLwogIGlmICghcmVxdWlyZWQodXJsLnBvcnQsIHVybC5wcm90b2NvbCkpIHsKICAgIHVybC5ob3N0ID0gdXJsLmhvc3RuYW1lOwogICAgdXJsLnBvcnQgPSAnJzsKICB9CgogIC8vCiAgLy8gUGFyc2UgZG93biB0aGUgYGF1dGhgIGZvciB0aGUgdXNlcm5hbWUgYW5kIHBhc3N3b3JkLgogIC8vCiAgdXJsLnVzZXJuYW1lID0gdXJsLnBhc3N3b3JkID0gJyc7CgogIGlmICh1cmwuYXV0aCkgewogICAgaW5kZXggPSB1cmwuYXV0aC5pbmRleE9mKCc6Jyk7CgogICAgaWYgKH5pbmRleCkgewogICAgICB1cmwudXNlcm5hbWUgPSB1cmwuYXV0aC5zbGljZSgwLCBpbmRleCk7CiAgICAgIHVybC51c2VybmFtZSA9IGVuY29kZVVSSUNvbXBvbmVudChkZWNvZGVVUklDb21wb25lbnQodXJsLnVzZXJuYW1lKSk7CgogICAgICB1cmwucGFzc3dvcmQgPSB1cmwuYXV0aC5zbGljZShpbmRleCArIDEpOwogICAgICB1cmwucGFzc3dvcmQgPSBlbmNvZGVVUklDb21wb25lbnQoZGVjb2RlVVJJQ29tcG9uZW50KHVybC5wYXNzd29yZCkpOwogICAgfSBlbHNlIHsKICAgICAgdXJsLnVzZXJuYW1lID0gZW5jb2RlVVJJQ29tcG9uZW50KGRlY29kZVVSSUNvbXBvbmVudCh1cmwuYXV0aCkpOwogICAgfQoKICAgIHVybC5hdXRoID0gdXJsLnBhc3N3b3JkID8gdXJsLnVzZXJuYW1lICsnOicrIHVybC5wYXNzd29yZCA6IHVybC51c2VybmFtZTsKICB9CgogIHVybC5vcmlnaW4gPSB1cmwucHJvdG9jb2wgIT09ICdmaWxlOicgJiYgaXNTcGVjaWFsKHVybC5wcm90b2NvbCkgJiYgdXJsLmhvc3QKICAgID8gdXJsLnByb3RvY29sICsnLy8nKyB1cmwuaG9zdAogICAgOiAnbnVsbCc7CgogIC8vCiAgLy8gVGhlIGhyZWYgaXMganVzdCB0aGUgY29tcGlsZWQgcmVzdWx0LgogIC8vCiAgdXJsLmhyZWYgPSB1cmwudG9TdHJpbmcoKTsKfQoKLyoqCiAqIFRoaXMgaXMgY29udmVuaWVuY2UgbWV0aG9kIGZvciBjaGFuZ2luZyBwcm9wZXJ0aWVzIGluIHRoZSBVUkwgaW5zdGFuY2UgdG8KICogaW5zdXJlIHRoYXQgdGhleSBhbGwgcHJvcGFnYXRlIGNvcnJlY3RseS4KICoKICogQHBhcmFtIHtTdHJpbmd9IHBhcnQgICAgICAgICAgUHJvcGVydHkgd2UgbmVlZCB0byBhZGp1c3QuCiAqIEBwYXJhbSB7TWl4ZWR9IHZhbHVlICAgICAgICAgIFRoZSBuZXdseSBhc3NpZ25lZCB2YWx1ZS4KICogQHBhcmFtIHtCb29sZWFufEZ1bmN0aW9ufSBmbiAgV2hlbiBzZXR0aW5nIHRoZSBxdWVyeSwgaXQgd2lsbCBiZSB0aGUgZnVuY3Rpb24KICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlZCB0byBwYXJzZSB0aGUgcXVlcnkuCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdoZW4gc2V0dGluZyB0aGUgcHJvdG9jb2wsIGRvdWJsZSBzbGFzaCB3aWxsIGJlCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZWQgZnJvbSB0aGUgZmluYWwgdXJsIGlmIGl0IGlzIHRydWUuCiAqIEByZXR1cm5zIHtVUkx9IFVSTCBpbnN0YW5jZSBmb3IgY2hhaW5pbmcuCiAqIEBwdWJsaWMKICovCmZ1bmN0aW9uIHNldChwYXJ0LCB2YWx1ZSwgZm4pIHsKICB2YXIgdXJsID0gdGhpczsKCiAgc3dpdGNoIChwYXJ0KSB7CiAgICBjYXNlICdxdWVyeSc6CiAgICAgIGlmICgnc3RyaW5nJyA9PT0gdHlwZW9mIHZhbHVlICYmIHZhbHVlLmxlbmd0aCkgewogICAgICAgIHZhbHVlID0gKGZuIHx8IHFzJDEucGFyc2UpKHZhbHVlKTsKICAgICAgfQoKICAgICAgdXJsW3BhcnRdID0gdmFsdWU7CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgJ3BvcnQnOgogICAgICB1cmxbcGFydF0gPSB2YWx1ZTsKCiAgICAgIGlmICghcmVxdWlyZWQodmFsdWUsIHVybC5wcm90b2NvbCkpIHsKICAgICAgICB1cmwuaG9zdCA9IHVybC5ob3N0bmFtZTsKICAgICAgICB1cmxbcGFydF0gPSAnJzsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSkgewogICAgICAgIHVybC5ob3N0ID0gdXJsLmhvc3RuYW1lICsnOicrIHZhbHVlOwogICAgICB9CgogICAgICBicmVhazsKCiAgICBjYXNlICdob3N0bmFtZSc6CiAgICAgIHVybFtwYXJ0XSA9IHZhbHVlOwoKICAgICAgaWYgKHVybC5wb3J0KSB2YWx1ZSArPSAnOicrIHVybC5wb3J0OwogICAgICB1cmwuaG9zdCA9IHZhbHVlOwogICAgICBicmVhazsKCiAgICBjYXNlICdob3N0JzoKICAgICAgdXJsW3BhcnRdID0gdmFsdWU7CgogICAgICBpZiAocG9ydC50ZXN0KHZhbHVlKSkgewogICAgICAgIHZhbHVlID0gdmFsdWUuc3BsaXQoJzonKTsKICAgICAgICB1cmwucG9ydCA9IHZhbHVlLnBvcCgpOwogICAgICAgIHVybC5ob3N0bmFtZSA9IHZhbHVlLmpvaW4oJzonKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB1cmwuaG9zdG5hbWUgPSB2YWx1ZTsKICAgICAgICB1cmwucG9ydCA9ICcnOwogICAgICB9CgogICAgICBicmVhazsKCiAgICBjYXNlICdwcm90b2NvbCc6CiAgICAgIHVybC5wcm90b2NvbCA9IHZhbHVlLnRvTG93ZXJDYXNlKCk7CiAgICAgIHVybC5zbGFzaGVzID0gIWZuOwogICAgICBicmVhazsKCiAgICBjYXNlICdwYXRobmFtZSc6CiAgICBjYXNlICdoYXNoJzoKICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgdmFyIGNoYXIgPSBwYXJ0ID09PSAncGF0aG5hbWUnID8gJy8nIDogJyMnOwogICAgICAgIHVybFtwYXJ0XSA9IHZhbHVlLmNoYXJBdCgwKSAhPT0gY2hhciA/IGNoYXIgKyB2YWx1ZSA6IHZhbHVlOwogICAgICB9IGVsc2UgewogICAgICAgIHVybFtwYXJ0XSA9IHZhbHVlOwogICAgICB9CiAgICAgIGJyZWFrOwoKICAgIGNhc2UgJ3VzZXJuYW1lJzoKICAgIGNhc2UgJ3Bhc3N3b3JkJzoKICAgICAgdXJsW3BhcnRdID0gZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSAnYXV0aCc6CiAgICAgIHZhciBpbmRleCA9IHZhbHVlLmluZGV4T2YoJzonKTsKCiAgICAgIGlmICh+aW5kZXgpIHsKICAgICAgICB1cmwudXNlcm5hbWUgPSB2YWx1ZS5zbGljZSgwLCBpbmRleCk7CiAgICAgICAgdXJsLnVzZXJuYW1lID0gZW5jb2RlVVJJQ29tcG9uZW50KGRlY29kZVVSSUNvbXBvbmVudCh1cmwudXNlcm5hbWUpKTsKCiAgICAgICAgdXJsLnBhc3N3b3JkID0gdmFsdWUuc2xpY2UoaW5kZXggKyAxKTsKICAgICAgICB1cmwucGFzc3dvcmQgPSBlbmNvZGVVUklDb21wb25lbnQoZGVjb2RlVVJJQ29tcG9uZW50KHVybC5wYXNzd29yZCkpOwogICAgICB9IGVsc2UgewogICAgICAgIHVybC51c2VybmFtZSA9IGVuY29kZVVSSUNvbXBvbmVudChkZWNvZGVVUklDb21wb25lbnQodmFsdWUpKTsKICAgICAgfQogIH0KCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBydWxlcy5sZW5ndGg7IGkrKykgewogICAgdmFyIGlucyA9IHJ1bGVzW2ldOwoKICAgIGlmIChpbnNbNF0pIHVybFtpbnNbMV1dID0gdXJsW2luc1sxXV0udG9Mb3dlckNhc2UoKTsKICB9CgogIHVybC5hdXRoID0gdXJsLnBhc3N3b3JkID8gdXJsLnVzZXJuYW1lICsnOicrIHVybC5wYXNzd29yZCA6IHVybC51c2VybmFtZTsKCiAgdXJsLm9yaWdpbiA9IHVybC5wcm90b2NvbCAhPT0gJ2ZpbGU6JyAmJiBpc1NwZWNpYWwodXJsLnByb3RvY29sKSAmJiB1cmwuaG9zdAogICAgPyB1cmwucHJvdG9jb2wgKycvLycrIHVybC5ob3N0CiAgICA6ICdudWxsJzsKCiAgdXJsLmhyZWYgPSB1cmwudG9TdHJpbmcoKTsKCiAgcmV0dXJuIHVybDsKfQoKLyoqCiAqIFRyYW5zZm9ybSB0aGUgcHJvcGVydGllcyBiYWNrIGluIHRvIGEgdmFsaWQgYW5kIGZ1bGwgVVJMIHN0cmluZy4KICoKICogQHBhcmFtIHtGdW5jdGlvbn0gc3RyaW5naWZ5IE9wdGlvbmFsIHF1ZXJ5IHN0cmluZ2lmeSBmdW5jdGlvbi4KICogQHJldHVybnMge1N0cmluZ30gQ29tcGlsZWQgdmVyc2lvbiBvZiB0aGUgVVJMLgogKiBAcHVibGljCiAqLwpmdW5jdGlvbiB0b1N0cmluZyQxKHN0cmluZ2lmeSkgewogIGlmICghc3RyaW5naWZ5IHx8ICdmdW5jdGlvbicgIT09IHR5cGVvZiBzdHJpbmdpZnkpIHN0cmluZ2lmeSA9IHFzJDEuc3RyaW5naWZ5OwoKICB2YXIgcXVlcnkKICAgICwgdXJsID0gdGhpcwogICAgLCBob3N0ID0gdXJsLmhvc3QKICAgICwgcHJvdG9jb2wgPSB1cmwucHJvdG9jb2w7CgogIGlmIChwcm90b2NvbCAmJiBwcm90b2NvbC5jaGFyQXQocHJvdG9jb2wubGVuZ3RoIC0gMSkgIT09ICc6JykgcHJvdG9jb2wgKz0gJzonOwoKICB2YXIgcmVzdWx0ID0KICAgIHByb3RvY29sICsKICAgICgodXJsLnByb3RvY29sICYmIHVybC5zbGFzaGVzKSB8fCBpc1NwZWNpYWwodXJsLnByb3RvY29sKSA/ICcvLycgOiAnJyk7CgogIGlmICh1cmwudXNlcm5hbWUpIHsKICAgIHJlc3VsdCArPSB1cmwudXNlcm5hbWU7CiAgICBpZiAodXJsLnBhc3N3b3JkKSByZXN1bHQgKz0gJzonKyB1cmwucGFzc3dvcmQ7CiAgICByZXN1bHQgKz0gJ0AnOwogIH0gZWxzZSBpZiAodXJsLnBhc3N3b3JkKSB7CiAgICByZXN1bHQgKz0gJzonKyB1cmwucGFzc3dvcmQ7CiAgICByZXN1bHQgKz0gJ0AnOwogIH0gZWxzZSBpZiAoCiAgICB1cmwucHJvdG9jb2wgIT09ICdmaWxlOicgJiYKICAgIGlzU3BlY2lhbCh1cmwucHJvdG9jb2wpICYmCiAgICAhaG9zdCAmJgogICAgdXJsLnBhdGhuYW1lICE9PSAnLycKICApIHsKICAgIC8vCiAgICAvLyBBZGQgYmFjayB0aGUgZW1wdHkgdXNlcmluZm8sIG90aGVyd2lzZSB0aGUgb3JpZ2luYWwgaW52YWxpZCBVUkwKICAgIC8vIG1pZ2h0IGJlIHRyYW5zZm9ybWVkIGludG8gYSB2YWxpZCBvbmUgd2l0aCBgdXJsLnBhdGhuYW1lYCBhcyBob3N0LgogICAgLy8KICAgIHJlc3VsdCArPSAnQCc7CiAgfQoKICAvLwogIC8vIFRyYWlsaW5nIGNvbG9uIGlzIHJlbW92ZWQgZnJvbSBgdXJsLmhvc3RgIHdoZW4gaXQgaXMgcGFyc2VkLiBJZiBpdCBzdGlsbAogIC8vIGVuZHMgd2l0aCBhIGNvbG9uLCB0aGVuIGFkZCBiYWNrIHRoZSB0cmFpbGluZyBjb2xvbiB0aGF0IHdhcyByZW1vdmVkLiBUaGlzCiAgLy8gcHJldmVudHMgYW4gaW52YWxpZCBVUkwgZnJvbSBiZWluZyB0cmFuc2Zvcm1lZCBpbnRvIGEgdmFsaWQgb25lLgogIC8vCiAgaWYgKGhvc3RbaG9zdC5sZW5ndGggLSAxXSA9PT0gJzonIHx8IChwb3J0LnRlc3QodXJsLmhvc3RuYW1lKSAmJiAhdXJsLnBvcnQpKSB7CiAgICBob3N0ICs9ICc6JzsKICB9CgogIHJlc3VsdCArPSBob3N0ICsgdXJsLnBhdGhuYW1lOwoKICBxdWVyeSA9ICdvYmplY3QnID09PSB0eXBlb2YgdXJsLnF1ZXJ5ID8gc3RyaW5naWZ5KHVybC5xdWVyeSkgOiB1cmwucXVlcnk7CiAgaWYgKHF1ZXJ5KSByZXN1bHQgKz0gJz8nICE9PSBxdWVyeS5jaGFyQXQoMCkgPyAnPycrIHF1ZXJ5IDogcXVlcnk7CgogIGlmICh1cmwuaGFzaCkgcmVzdWx0ICs9IHVybC5oYXNoOwoKICByZXR1cm4gcmVzdWx0Owp9CgpVcmwkMi5wcm90b3R5cGUgPSB7IHNldDogc2V0LCB0b1N0cmluZzogdG9TdHJpbmckMSB9OwoKLy8KLy8gRXhwb3NlIHRoZSBVUkwgcGFyc2VyIGFuZCBzb21lIGFkZGl0aW9uYWwgcHJvcGVydGllcyB0aGF0IG1pZ2h0IGJlIHVzZWZ1bCBmb3IKLy8gb3RoZXJzIG9yIHRlc3RpbmcuCi8vClVybCQyLmV4dHJhY3RQcm90b2NvbCA9IGV4dHJhY3RQcm90b2NvbDsKVXJsJDIubG9jYXRpb24gPSBsb2xjYXRpb247ClVybCQyLnRyaW1MZWZ0ID0gdHJpbUxlZnQ7ClVybCQyLnFzID0gcXMkMTsKCnZhciB1cmxQYXJzZSQxID0gVXJsJDI7Cgp2YXIgcHVic3VmZml4UHNsID0ge307Cgp2YXIgcHNsJDEgPSB7fTsKCmNvbnN0IHJlcXVpcmUkJDEgPSBbCgkiYWMiLAoJImNvbS5hYyIsCgkiZWR1LmFjIiwKCSJnb3YuYWMiLAoJIm5ldC5hYyIsCgkibWlsLmFjIiwKCSJvcmcuYWMiLAoJImFkIiwKCSJub20uYWQiLAoJImFlIiwKCSJjby5hZSIsCgkibmV0LmFlIiwKCSJvcmcuYWUiLAoJInNjaC5hZSIsCgkiYWMuYWUiLAoJImdvdi5hZSIsCgkibWlsLmFlIiwKCSJhZXJvIiwKCSJhY2NpZGVudC1pbnZlc3RpZ2F0aW9uLmFlcm8iLAoJImFjY2lkZW50LXByZXZlbnRpb24uYWVybyIsCgkiYWVyb2JhdGljLmFlcm8iLAoJImFlcm9jbHViLmFlcm8iLAoJImFlcm9kcm9tZS5hZXJvIiwKCSJhZ2VudHMuYWVybyIsCgkiYWlyY3JhZnQuYWVybyIsCgkiYWlybGluZS5hZXJvIiwKCSJhaXJwb3J0LmFlcm8iLAoJImFpci1zdXJ2ZWlsbGFuY2UuYWVybyIsCgkiYWlydHJhZmZpYy5hZXJvIiwKCSJhaXItdHJhZmZpYy1jb250cm9sLmFlcm8iLAoJImFtYnVsYW5jZS5hZXJvIiwKCSJhbXVzZW1lbnQuYWVybyIsCgkiYXNzb2NpYXRpb24uYWVybyIsCgkiYXV0aG9yLmFlcm8iLAoJImJhbGxvb25pbmcuYWVybyIsCgkiYnJva2VyLmFlcm8iLAoJImNhYS5hZXJvIiwKCSJjYXJnby5hZXJvIiwKCSJjYXRlcmluZy5hZXJvIiwKCSJjZXJ0aWZpY2F0aW9uLmFlcm8iLAoJImNoYW1waW9uc2hpcC5hZXJvIiwKCSJjaGFydGVyLmFlcm8iLAoJImNpdmlsYXZpYXRpb24uYWVybyIsCgkiY2x1Yi5hZXJvIiwKCSJjb25mZXJlbmNlLmFlcm8iLAoJImNvbnN1bHRhbnQuYWVybyIsCgkiY29uc3VsdGluZy5hZXJvIiwKCSJjb250cm9sLmFlcm8iLAoJImNvdW5jaWwuYWVybyIsCgkiY3Jldy5hZXJvIiwKCSJkZXNpZ24uYWVybyIsCgkiZGdjYS5hZXJvIiwKCSJlZHVjYXRvci5hZXJvIiwKCSJlbWVyZ2VuY3kuYWVybyIsCgkiZW5naW5lLmFlcm8iLAoJImVuZ2luZWVyLmFlcm8iLAoJImVudGVydGFpbm1lbnQuYWVybyIsCgkiZXF1aXBtZW50LmFlcm8iLAoJImV4Y2hhbmdlLmFlcm8iLAoJImV4cHJlc3MuYWVybyIsCgkiZmVkZXJhdGlvbi5hZXJvIiwKCSJmbGlnaHQuYWVybyIsCgkiZnVlbC5hZXJvIiwKCSJnbGlkaW5nLmFlcm8iLAoJImdvdmVybm1lbnQuYWVybyIsCgkiZ3JvdW5kaGFuZGxpbmcuYWVybyIsCgkiZ3JvdXAuYWVybyIsCgkiaGFuZ2dsaWRpbmcuYWVybyIsCgkiaG9tZWJ1aWx0LmFlcm8iLAoJImluc3VyYW5jZS5hZXJvIiwKCSJqb3VybmFsLmFlcm8iLAoJImpvdXJuYWxpc3QuYWVybyIsCgkibGVhc2luZy5hZXJvIiwKCSJsb2dpc3RpY3MuYWVybyIsCgkibWFnYXppbmUuYWVybyIsCgkibWFpbnRlbmFuY2UuYWVybyIsCgkibWVkaWEuYWVybyIsCgkibWljcm9saWdodC5hZXJvIiwKCSJtb2RlbGxpbmcuYWVybyIsCgkibmF2aWdhdGlvbi5hZXJvIiwKCSJwYXJhY2h1dGluZy5hZXJvIiwKCSJwYXJhZ2xpZGluZy5hZXJvIiwKCSJwYXNzZW5nZXItYXNzb2NpYXRpb24uYWVybyIsCgkicGlsb3QuYWVybyIsCgkicHJlc3MuYWVybyIsCgkicHJvZHVjdGlvbi5hZXJvIiwKCSJyZWNyZWF0aW9uLmFlcm8iLAoJInJlcGJvZHkuYWVybyIsCgkicmVzLmFlcm8iLAoJInJlc2VhcmNoLmFlcm8iLAoJInJvdG9yY3JhZnQuYWVybyIsCgkic2FmZXR5LmFlcm8iLAoJInNjaWVudGlzdC5hZXJvIiwKCSJzZXJ2aWNlcy5hZXJvIiwKCSJzaG93LmFlcm8iLAoJInNreWRpdmluZy5hZXJvIiwKCSJzb2Z0d2FyZS5hZXJvIiwKCSJzdHVkZW50LmFlcm8iLAoJInRyYWRlci5hZXJvIiwKCSJ0cmFkaW5nLmFlcm8iLAoJInRyYWluZXIuYWVybyIsCgkidW5pb24uYWVybyIsCgkid29ya2luZ2dyb3VwLmFlcm8iLAoJIndvcmtzLmFlcm8iLAoJImFmIiwKCSJnb3YuYWYiLAoJImNvbS5hZiIsCgkib3JnLmFmIiwKCSJuZXQuYWYiLAoJImVkdS5hZiIsCgkiYWciLAoJImNvbS5hZyIsCgkib3JnLmFnIiwKCSJuZXQuYWciLAoJImNvLmFnIiwKCSJub20uYWciLAoJImFpIiwKCSJvZmYuYWkiLAoJImNvbS5haSIsCgkibmV0LmFpIiwKCSJvcmcuYWkiLAoJImFsIiwKCSJjb20uYWwiLAoJImVkdS5hbCIsCgkiZ292LmFsIiwKCSJtaWwuYWwiLAoJIm5ldC5hbCIsCgkib3JnLmFsIiwKCSJhbSIsCgkiY28uYW0iLAoJImNvbS5hbSIsCgkiY29tbXVuZS5hbSIsCgkibmV0LmFtIiwKCSJvcmcuYW0iLAoJImFvIiwKCSJlZC5hbyIsCgkiZ3YuYW8iLAoJIm9nLmFvIiwKCSJjby5hbyIsCgkicGIuYW8iLAoJIml0LmFvIiwKCSJhcSIsCgkiYXIiLAoJImJldC5hciIsCgkiY29tLmFyIiwKCSJjb29wLmFyIiwKCSJlZHUuYXIiLAoJImdvYi5hciIsCgkiZ292LmFyIiwKCSJpbnQuYXIiLAoJIm1pbC5hciIsCgkibXVzaWNhLmFyIiwKCSJtdXR1YWwuYXIiLAoJIm5ldC5hciIsCgkib3JnLmFyIiwKCSJzZW5hc2EuYXIiLAoJInR1ci5hciIsCgkiYXJwYSIsCgkiZTE2NC5hcnBhIiwKCSJpbi1hZGRyLmFycGEiLAoJImlwNi5hcnBhIiwKCSJpcmlzLmFycGEiLAoJInVyaS5hcnBhIiwKCSJ1cm4uYXJwYSIsCgkiYXMiLAoJImdvdi5hcyIsCgkiYXNpYSIsCgkiYXQiLAoJImFjLmF0IiwKCSJjby5hdCIsCgkiZ3YuYXQiLAoJIm9yLmF0IiwKCSJzdGguYWMuYXQiLAoJImF1IiwKCSJjb20uYXUiLAoJIm5ldC5hdSIsCgkib3JnLmF1IiwKCSJlZHUuYXUiLAoJImdvdi5hdSIsCgkiYXNuLmF1IiwKCSJpZC5hdSIsCgkiaW5mby5hdSIsCgkiY29uZi5hdSIsCgkib3ouYXUiLAoJImFjdC5hdSIsCgkibnN3LmF1IiwKCSJudC5hdSIsCgkicWxkLmF1IiwKCSJzYS5hdSIsCgkidGFzLmF1IiwKCSJ2aWMuYXUiLAoJIndhLmF1IiwKCSJhY3QuZWR1LmF1IiwKCSJjYXRob2xpYy5lZHUuYXUiLAoJIm5zdy5lZHUuYXUiLAoJIm50LmVkdS5hdSIsCgkicWxkLmVkdS5hdSIsCgkic2EuZWR1LmF1IiwKCSJ0YXMuZWR1LmF1IiwKCSJ2aWMuZWR1LmF1IiwKCSJ3YS5lZHUuYXUiLAoJInFsZC5nb3YuYXUiLAoJInNhLmdvdi5hdSIsCgkidGFzLmdvdi5hdSIsCgkidmljLmdvdi5hdSIsCgkid2EuZ292LmF1IiwKCSJzY2hvb2xzLm5zdy5lZHUuYXUiLAoJImF3IiwKCSJjb20uYXciLAoJImF4IiwKCSJheiIsCgkiY29tLmF6IiwKCSJuZXQuYXoiLAoJImludC5heiIsCgkiZ292LmF6IiwKCSJvcmcuYXoiLAoJImVkdS5heiIsCgkiaW5mby5heiIsCgkicHAuYXoiLAoJIm1pbC5heiIsCgkibmFtZS5heiIsCgkicHJvLmF6IiwKCSJiaXouYXoiLAoJImJhIiwKCSJjb20uYmEiLAoJImVkdS5iYSIsCgkiZ292LmJhIiwKCSJtaWwuYmEiLAoJIm5ldC5iYSIsCgkib3JnLmJhIiwKCSJiYiIsCgkiYml6LmJiIiwKCSJjby5iYiIsCgkiY29tLmJiIiwKCSJlZHUuYmIiLAoJImdvdi5iYiIsCgkiaW5mby5iYiIsCgkibmV0LmJiIiwKCSJvcmcuYmIiLAoJInN0b3JlLmJiIiwKCSJ0di5iYiIsCgkiKi5iZCIsCgkiYmUiLAoJImFjLmJlIiwKCSJiZiIsCgkiZ292LmJmIiwKCSJiZyIsCgkiYS5iZyIsCgkiYi5iZyIsCgkiYy5iZyIsCgkiZC5iZyIsCgkiZS5iZyIsCgkiZi5iZyIsCgkiZy5iZyIsCgkiaC5iZyIsCgkiaS5iZyIsCgkiai5iZyIsCgkiay5iZyIsCgkibC5iZyIsCgkibS5iZyIsCgkibi5iZyIsCgkiby5iZyIsCgkicC5iZyIsCgkicS5iZyIsCgkici5iZyIsCgkicy5iZyIsCgkidC5iZyIsCgkidS5iZyIsCgkidi5iZyIsCgkidy5iZyIsCgkieC5iZyIsCgkieS5iZyIsCgkiei5iZyIsCgkiMC5iZyIsCgkiMS5iZyIsCgkiMi5iZyIsCgkiMy5iZyIsCgkiNC5iZyIsCgkiNS5iZyIsCgkiNi5iZyIsCgkiNy5iZyIsCgkiOC5iZyIsCgkiOS5iZyIsCgkiYmgiLAoJImNvbS5iaCIsCgkiZWR1LmJoIiwKCSJuZXQuYmgiLAoJIm9yZy5iaCIsCgkiZ292LmJoIiwKCSJiaSIsCgkiY28uYmkiLAoJImNvbS5iaSIsCgkiZWR1LmJpIiwKCSJvci5iaSIsCgkib3JnLmJpIiwKCSJiaXoiLAoJImJqIiwKCSJhc3NvLmJqIiwKCSJiYXJyZWF1LmJqIiwKCSJnb3V2LmJqIiwKCSJibSIsCgkiY29tLmJtIiwKCSJlZHUuYm0iLAoJImdvdi5ibSIsCgkibmV0LmJtIiwKCSJvcmcuYm0iLAoJImJuIiwKCSJjb20uYm4iLAoJImVkdS5ibiIsCgkiZ292LmJuIiwKCSJuZXQuYm4iLAoJIm9yZy5ibiIsCgkiYm8iLAoJImNvbS5ibyIsCgkiZWR1LmJvIiwKCSJnb2IuYm8iLAoJImludC5ibyIsCgkib3JnLmJvIiwKCSJuZXQuYm8iLAoJIm1pbC5ibyIsCgkidHYuYm8iLAoJIndlYi5ibyIsCgkiYWNhZGVtaWEuYm8iLAoJImFncm8uYm8iLAoJImFydGUuYm8iLAoJImJsb2cuYm8iLAoJImJvbGl2aWEuYm8iLAoJImNpZW5jaWEuYm8iLAoJImNvb3BlcmF0aXZhLmJvIiwKCSJkZW1vY3JhY2lhLmJvIiwKCSJkZXBvcnRlLmJvIiwKCSJlY29sb2dpYS5ibyIsCgkiZWNvbm9taWEuYm8iLAoJImVtcHJlc2EuYm8iLAoJImluZGlnZW5hLmJvIiwKCSJpbmR1c3RyaWEuYm8iLAoJImluZm8uYm8iLAoJIm1lZGljaW5hLmJvIiwKCSJtb3ZpbWllbnRvLmJvIiwKCSJtdXNpY2EuYm8iLAoJIm5hdHVyYWwuYm8iLAoJIm5vbWJyZS5ibyIsCgkibm90aWNpYXMuYm8iLAoJInBhdHJpYS5ibyIsCgkicG9saXRpY2EuYm8iLAoJInByb2Zlc2lvbmFsLmJvIiwKCSJwbHVyaW5hY2lvbmFsLmJvIiwKCSJwdWVibG8uYm8iLAoJInJldmlzdGEuYm8iLAoJInNhbHVkLmJvIiwKCSJ0ZWNub2xvZ2lhLmJvIiwKCSJ0a3NhdC5ibyIsCgkidHJhbnNwb3J0ZS5ibyIsCgkid2lraS5ibyIsCgkiYnIiLAoJIjlndWFjdS5iciIsCgkiYWJjLmJyIiwKCSJhZG0uYnIiLAoJImFkdi5iciIsCgkiYWdyLmJyIiwKCSJhanUuYnIiLAoJImFtLmJyIiwKCSJhbmFuaS5iciIsCgkiYXBhcmVjaWRhLmJyIiwKCSJhcHAuYnIiLAoJImFycS5iciIsCgkiYXJ0LmJyIiwKCSJhdG8uYnIiLAoJImIuYnIiLAoJImJhcnVlcmkuYnIiLAoJImJlbGVtLmJyIiwKCSJiaHouYnIiLAoJImJpYi5iciIsCgkiYmlvLmJyIiwKCSJibG9nLmJyIiwKCSJibWQuYnIiLAoJImJvYXZpc3RhLmJyIiwKCSJic2IuYnIiLAoJImNhbXBpbmFncmFuZGUuYnIiLAoJImNhbXBpbmFzLmJyIiwKCSJjYXhpYXMuYnIiLAoJImNpbS5iciIsCgkiY25nLmJyIiwKCSJjbnQuYnIiLAoJImNvbS5iciIsCgkiY29udGFnZW0uYnIiLAoJImNvb3AuYnIiLAoJImNvei5iciIsCgkiY3JpLmJyIiwKCSJjdWlhYmEuYnIiLAoJImN1cml0aWJhLmJyIiwKCSJkZWYuYnIiLAoJImRlcy5iciIsCgkiZGV0LmJyIiwKCSJkZXYuYnIiLAoJImVjbi5iciIsCgkiZWNvLmJyIiwKCSJlZHUuYnIiLAoJImVtcC5iciIsCgkiZW5mLmJyIiwKCSJlbmcuYnIiLAoJImVzcC5iciIsCgkiZXRjLmJyIiwKCSJldGkuYnIiLAoJImZhci5iciIsCgkiZmVpcmEuYnIiLAoJImZsb2cuYnIiLAoJImZsb3JpcGEuYnIiLAoJImZtLmJyIiwKCSJmbmQuYnIiLAoJImZvcnRhbC5iciIsCgkiZm90LmJyIiwKCSJmb3ouYnIiLAoJImZzdC5iciIsCgkiZzEyLmJyIiwKCSJnZW8uYnIiLAoJImdnZi5iciIsCgkiZ29pYW5pYS5iciIsCgkiZ292LmJyIiwKCSJhYy5nb3YuYnIiLAoJImFsLmdvdi5iciIsCgkiYW0uZ292LmJyIiwKCSJhcC5nb3YuYnIiLAoJImJhLmdvdi5iciIsCgkiY2UuZ292LmJyIiwKCSJkZi5nb3YuYnIiLAoJImVzLmdvdi5iciIsCgkiZ28uZ292LmJyIiwKCSJtYS5nb3YuYnIiLAoJIm1nLmdvdi5iciIsCgkibXMuZ292LmJyIiwKCSJtdC5nb3YuYnIiLAoJInBhLmdvdi5iciIsCgkicGIuZ292LmJyIiwKCSJwZS5nb3YuYnIiLAoJInBpLmdvdi5iciIsCgkicHIuZ292LmJyIiwKCSJyai5nb3YuYnIiLAoJInJuLmdvdi5iciIsCgkicm8uZ292LmJyIiwKCSJyci5nb3YuYnIiLAoJInJzLmdvdi5iciIsCgkic2MuZ292LmJyIiwKCSJzZS5nb3YuYnIiLAoJInNwLmdvdi5iciIsCgkidG8uZ292LmJyIiwKCSJncnUuYnIiLAoJImltYi5iciIsCgkiaW5kLmJyIiwKCSJpbmYuYnIiLAoJImphYi5iciIsCgkiamFtcGEuYnIiLAoJImpkZi5iciIsCgkiam9pbnZpbGxlLmJyIiwKCSJqb3IuYnIiLAoJImp1cy5iciIsCgkibGVnLmJyIiwKCSJsZWwuYnIiLAoJImxvZy5iciIsCgkibG9uZHJpbmEuYnIiLAoJIm1hY2FwYS5iciIsCgkibWFjZWlvLmJyIiwKCSJtYW5hdXMuYnIiLAoJIm1hcmluZ2EuYnIiLAoJIm1hdC5iciIsCgkibWVkLmJyIiwKCSJtaWwuYnIiLAoJIm1vcmVuYS5iciIsCgkibXAuYnIiLAoJIm11cy5iciIsCgkibmF0YWwuYnIiLAoJIm5ldC5iciIsCgkibml0ZXJvaS5iciIsCgkiKi5ub20uYnIiLAoJIm5vdC5iciIsCgkibnRyLmJyIiwKCSJvZG8uYnIiLAoJIm9uZy5iciIsCgkib3JnLmJyIiwKCSJvc2FzY28uYnIiLAoJInBhbG1hcy5iciIsCgkicG9hLmJyIiwKCSJwcGcuYnIiLAoJInByby5iciIsCgkicHNjLmJyIiwKCSJwc2kuYnIiLAoJInB2aC5iciIsCgkicXNsLmJyIiwKCSJyYWRpby5iciIsCgkicmVjLmJyIiwKCSJyZWNpZmUuYnIiLAoJInJlcC5iciIsCgkicmliZWlyYW8uYnIiLAoJInJpby5iciIsCgkicmlvYnJhbmNvLmJyIiwKCSJyaW9wcmV0by5iciIsCgkic2FsdmFkb3IuYnIiLAoJInNhbXBhLmJyIiwKCSJzYW50YW1hcmlhLmJyIiwKCSJzYW50b2FuZHJlLmJyIiwKCSJzYW9iZXJuYXJkby5iciIsCgkic2FvZ29uY2EuYnIiLAoJInNlZy5iciIsCgkic2pjLmJyIiwKCSJzbGcuYnIiLAoJInNsei5iciIsCgkic29yb2NhYmEuYnIiLAoJInNydi5iciIsCgkidGF4aS5iciIsCgkidGMuYnIiLAoJInRlYy5iciIsCgkidGVvLmJyIiwKCSJ0aGUuYnIiLAoJInRtcC5iciIsCgkidHJkLmJyIiwKCSJ0dXIuYnIiLAoJInR2LmJyIiwKCSJ1ZGkuYnIiLAoJInZldC5iciIsCgkidml4LmJyIiwKCSJ2bG9nLmJyIiwKCSJ3aWtpLmJyIiwKCSJ6bGcuYnIiLAoJImJzIiwKCSJjb20uYnMiLAoJIm5ldC5icyIsCgkib3JnLmJzIiwKCSJlZHUuYnMiLAoJImdvdi5icyIsCgkiYnQiLAoJImNvbS5idCIsCgkiZWR1LmJ0IiwKCSJnb3YuYnQiLAoJIm5ldC5idCIsCgkib3JnLmJ0IiwKCSJidiIsCgkiYnciLAoJImNvLmJ3IiwKCSJvcmcuYnciLAoJImJ5IiwKCSJnb3YuYnkiLAoJIm1pbC5ieSIsCgkiY29tLmJ5IiwKCSJvZi5ieSIsCgkiYnoiLAoJImNvbS5ieiIsCgkibmV0LmJ6IiwKCSJvcmcuYnoiLAoJImVkdS5ieiIsCgkiZ292LmJ6IiwKCSJjYSIsCgkiYWIuY2EiLAoJImJjLmNhIiwKCSJtYi5jYSIsCgkibmIuY2EiLAoJIm5mLmNhIiwKCSJubC5jYSIsCgkibnMuY2EiLAoJIm50LmNhIiwKCSJudS5jYSIsCgkib24uY2EiLAoJInBlLmNhIiwKCSJxYy5jYSIsCgkic2suY2EiLAoJInlrLmNhIiwKCSJnYy5jYSIsCgkiY2F0IiwKCSJjYyIsCgkiY2QiLAoJImdvdi5jZCIsCgkiY2YiLAoJImNnIiwKCSJjaCIsCgkiY2kiLAoJIm9yZy5jaSIsCgkib3IuY2kiLAoJImNvbS5jaSIsCgkiY28uY2kiLAoJImVkdS5jaSIsCgkiZWQuY2kiLAoJImFjLmNpIiwKCSJuZXQuY2kiLAoJImdvLmNpIiwKCSJhc3NvLmNpIiwKCSJhw6lyb3BvcnQuY2kiLAoJImludC5jaSIsCgkicHJlc3NlLmNpIiwKCSJtZC5jaSIsCgkiZ291di5jaSIsCgkiKi5jayIsCgkiIXd3dy5jayIsCgkiY2wiLAoJImNvLmNsIiwKCSJnb2IuY2wiLAoJImdvdi5jbCIsCgkibWlsLmNsIiwKCSJjbSIsCgkiY28uY20iLAoJImNvbS5jbSIsCgkiZ292LmNtIiwKCSJuZXQuY20iLAoJImNuIiwKCSJhYy5jbiIsCgkiY29tLmNuIiwKCSJlZHUuY24iLAoJImdvdi5jbiIsCgkibmV0LmNuIiwKCSJvcmcuY24iLAoJIm1pbC5jbiIsCgki5YWs5Y+4LmNuIiwKCSLnvZHnu5wuY24iLAoJIue2sue1oS5jbiIsCgkiYWguY24iLAoJImJqLmNuIiwKCSJjcS5jbiIsCgkiZmouY24iLAoJImdkLmNuIiwKCSJncy5jbiIsCgkiZ3ouY24iLAoJImd4LmNuIiwKCSJoYS5jbiIsCgkiaGIuY24iLAoJImhlLmNuIiwKCSJoaS5jbiIsCgkiaGwuY24iLAoJImhuLmNuIiwKCSJqbC5jbiIsCgkianMuY24iLAoJImp4LmNuIiwKCSJsbi5jbiIsCgkibm0uY24iLAoJIm54LmNuIiwKCSJxaC5jbiIsCgkic2MuY24iLAoJInNkLmNuIiwKCSJzaC5jbiIsCgkic24uY24iLAoJInN4LmNuIiwKCSJ0ai5jbiIsCgkieGouY24iLAoJInh6LmNuIiwKCSJ5bi5jbiIsCgkiemouY24iLAoJImhrLmNuIiwKCSJtby5jbiIsCgkidHcuY24iLAoJImNvIiwKCSJhcnRzLmNvIiwKCSJjb20uY28iLAoJImVkdS5jbyIsCgkiZmlybS5jbyIsCgkiZ292LmNvIiwKCSJpbmZvLmNvIiwKCSJpbnQuY28iLAoJIm1pbC5jbyIsCgkibmV0LmNvIiwKCSJub20uY28iLAoJIm9yZy5jbyIsCgkicmVjLmNvIiwKCSJ3ZWIuY28iLAoJImNvbSIsCgkiY29vcCIsCgkiY3IiLAoJImFjLmNyIiwKCSJjby5jciIsCgkiZWQuY3IiLAoJImZpLmNyIiwKCSJnby5jciIsCgkib3IuY3IiLAoJInNhLmNyIiwKCSJjdSIsCgkiY29tLmN1IiwKCSJlZHUuY3UiLAoJIm9yZy5jdSIsCgkibmV0LmN1IiwKCSJnb3YuY3UiLAoJImluZi5jdSIsCgkiY3YiLAoJImNvbS5jdiIsCgkiZWR1LmN2IiwKCSJpbnQuY3YiLAoJIm5vbWUuY3YiLAoJIm9yZy5jdiIsCgkiY3ciLAoJImNvbS5jdyIsCgkiZWR1LmN3IiwKCSJuZXQuY3ciLAoJIm9yZy5jdyIsCgkiY3giLAoJImdvdi5jeCIsCgkiY3kiLAoJImFjLmN5IiwKCSJiaXouY3kiLAoJImNvbS5jeSIsCgkiZWtsb2dlcy5jeSIsCgkiZ292LmN5IiwKCSJsdGQuY3kiLAoJIm1pbC5jeSIsCgkibmV0LmN5IiwKCSJvcmcuY3kiLAoJInByZXNzLmN5IiwKCSJwcm8uY3kiLAoJInRtLmN5IiwKCSJjeiIsCgkiZGUiLAoJImRqIiwKCSJkayIsCgkiZG0iLAoJImNvbS5kbSIsCgkibmV0LmRtIiwKCSJvcmcuZG0iLAoJImVkdS5kbSIsCgkiZ292LmRtIiwKCSJkbyIsCgkiYXJ0LmRvIiwKCSJjb20uZG8iLAoJImVkdS5kbyIsCgkiZ29iLmRvIiwKCSJnb3YuZG8iLAoJIm1pbC5kbyIsCgkibmV0LmRvIiwKCSJvcmcuZG8iLAoJInNsZC5kbyIsCgkid2ViLmRvIiwKCSJkeiIsCgkiYXJ0LmR6IiwKCSJhc3NvLmR6IiwKCSJjb20uZHoiLAoJImVkdS5keiIsCgkiZ292LmR6IiwKCSJvcmcuZHoiLAoJIm5ldC5keiIsCgkicG9sLmR6IiwKCSJzb2MuZHoiLAoJInRtLmR6IiwKCSJlYyIsCgkiY29tLmVjIiwKCSJpbmZvLmVjIiwKCSJuZXQuZWMiLAoJImZpbi5lYyIsCgkiazEyLmVjIiwKCSJtZWQuZWMiLAoJInByby5lYyIsCgkib3JnLmVjIiwKCSJlZHUuZWMiLAoJImdvdi5lYyIsCgkiZ29iLmVjIiwKCSJtaWwuZWMiLAoJImVkdSIsCgkiZWUiLAoJImVkdS5lZSIsCgkiZ292LmVlIiwKCSJyaWlrLmVlIiwKCSJsaWIuZWUiLAoJIm1lZC5lZSIsCgkiY29tLmVlIiwKCSJwcmkuZWUiLAoJImFpcC5lZSIsCgkib3JnLmVlIiwKCSJmaWUuZWUiLAoJImVnIiwKCSJjb20uZWciLAoJImVkdS5lZyIsCgkiZXVuLmVnIiwKCSJnb3YuZWciLAoJIm1pbC5lZyIsCgkibmFtZS5lZyIsCgkibmV0LmVnIiwKCSJvcmcuZWciLAoJInNjaS5lZyIsCgkiKi5lciIsCgkiZXMiLAoJImNvbS5lcyIsCgkibm9tLmVzIiwKCSJvcmcuZXMiLAoJImdvYi5lcyIsCgkiZWR1LmVzIiwKCSJldCIsCgkiY29tLmV0IiwKCSJnb3YuZXQiLAoJIm9yZy5ldCIsCgkiZWR1LmV0IiwKCSJiaXouZXQiLAoJIm5hbWUuZXQiLAoJImluZm8uZXQiLAoJIm5ldC5ldCIsCgkiZXUiLAoJImZpIiwKCSJhbGFuZC5maSIsCgkiZmoiLAoJImFjLmZqIiwKCSJiaXouZmoiLAoJImNvbS5maiIsCgkiZ292LmZqIiwKCSJpbmZvLmZqIiwKCSJtaWwuZmoiLAoJIm5hbWUuZmoiLAoJIm5ldC5maiIsCgkib3JnLmZqIiwKCSJwcm8uZmoiLAoJIiouZmsiLAoJImNvbS5mbSIsCgkiZWR1LmZtIiwKCSJuZXQuZm0iLAoJIm9yZy5mbSIsCgkiZm0iLAoJImZvIiwKCSJmciIsCgkiYXNzby5mciIsCgkiY29tLmZyIiwKCSJnb3V2LmZyIiwKCSJub20uZnIiLAoJInByZC5mciIsCgkidG0uZnIiLAoJImFlcm9wb3J0LmZyIiwKCSJhdm9jYXQuZnIiLAoJImF2b3Vlcy5mciIsCgkiY2NpLmZyIiwKCSJjaGFtYmFncmkuZnIiLAoJImNoaXJ1cmdpZW5zLWRlbnRpc3Rlcy5mciIsCgkiZXhwZXJ0cy1jb21wdGFibGVzLmZyIiwKCSJnZW9tZXRyZS1leHBlcnQuZnIiLAoJImdyZXRhLmZyIiwKCSJodWlzc2llci1qdXN0aWNlLmZyIiwKCSJtZWRlY2luLmZyIiwKCSJub3RhaXJlcy5mciIsCgkicGhhcm1hY2llbi5mciIsCgkicG9ydC5mciIsCgkidmV0ZXJpbmFpcmUuZnIiLAoJImdhIiwKCSJnYiIsCgkiZWR1LmdkIiwKCSJnb3YuZ2QiLAoJImdkIiwKCSJnZSIsCgkiY29tLmdlIiwKCSJlZHUuZ2UiLAoJImdvdi5nZSIsCgkib3JnLmdlIiwKCSJtaWwuZ2UiLAoJIm5ldC5nZSIsCgkicHZ0LmdlIiwKCSJnZiIsCgkiZ2ciLAoJImNvLmdnIiwKCSJuZXQuZ2ciLAoJIm9yZy5nZyIsCgkiZ2giLAoJImNvbS5naCIsCgkiZWR1LmdoIiwKCSJnb3YuZ2giLAoJIm9yZy5naCIsCgkibWlsLmdoIiwKCSJnaSIsCgkiY29tLmdpIiwKCSJsdGQuZ2kiLAoJImdvdi5naSIsCgkibW9kLmdpIiwKCSJlZHUuZ2kiLAoJIm9yZy5naSIsCgkiZ2wiLAoJImNvLmdsIiwKCSJjb20uZ2wiLAoJImVkdS5nbCIsCgkibmV0LmdsIiwKCSJvcmcuZ2wiLAoJImdtIiwKCSJnbiIsCgkiYWMuZ24iLAoJImNvbS5nbiIsCgkiZWR1LmduIiwKCSJnb3YuZ24iLAoJIm9yZy5nbiIsCgkibmV0LmduIiwKCSJnb3YiLAoJImdwIiwKCSJjb20uZ3AiLAoJIm5ldC5ncCIsCgkibW9iaS5ncCIsCgkiZWR1LmdwIiwKCSJvcmcuZ3AiLAoJImFzc28uZ3AiLAoJImdxIiwKCSJnciIsCgkiY29tLmdyIiwKCSJlZHUuZ3IiLAoJIm5ldC5nciIsCgkib3JnLmdyIiwKCSJnb3YuZ3IiLAoJImdzIiwKCSJndCIsCgkiY29tLmd0IiwKCSJlZHUuZ3QiLAoJImdvYi5ndCIsCgkiaW5kLmd0IiwKCSJtaWwuZ3QiLAoJIm5ldC5ndCIsCgkib3JnLmd0IiwKCSJndSIsCgkiY29tLmd1IiwKCSJlZHUuZ3UiLAoJImdvdi5ndSIsCgkiZ3VhbS5ndSIsCgkiaW5mby5ndSIsCgkibmV0Lmd1IiwKCSJvcmcuZ3UiLAoJIndlYi5ndSIsCgkiZ3ciLAoJImd5IiwKCSJjby5neSIsCgkiY29tLmd5IiwKCSJlZHUuZ3kiLAoJImdvdi5neSIsCgkibmV0Lmd5IiwKCSJvcmcuZ3kiLAoJImhrIiwKCSJjb20uaGsiLAoJImVkdS5oayIsCgkiZ292LmhrIiwKCSJpZHYuaGsiLAoJIm5ldC5oayIsCgkib3JnLmhrIiwKCSLlhazlj7guaGsiLAoJIuaVmeiCsi5oayIsCgki5pWO6IKyLmhrIiwKCSLmlL/lupwuaGsiLAoJIuWAi+S6ui5oayIsCgki5Liq77+977+9LmhrIiwKCSLnrofkurouaGsiLAoJIue2sue7nC5oayIsCgki572R57ucLmhrIiwKCSLnu4TnuZQuaGsiLAoJIue2sue1oS5oayIsCgki572R57WhLmhrIiwKCSLnu4Tnu4cuaGsiLAoJIue1hOe5lC5oayIsCgki57WE57uHLmhrIiwKCSJobSIsCgkiaG4iLAoJImNvbS5obiIsCgkiZWR1LmhuIiwKCSJvcmcuaG4iLAoJIm5ldC5obiIsCgkibWlsLmhuIiwKCSJnb2IuaG4iLAoJImhyIiwKCSJpei5ociIsCgkiZnJvbS5ociIsCgkibmFtZS5ociIsCgkiY29tLmhyIiwKCSJodCIsCgkiY29tLmh0IiwKCSJzaG9wLmh0IiwKCSJmaXJtLmh0IiwKCSJpbmZvLmh0IiwKCSJhZHVsdC5odCIsCgkibmV0Lmh0IiwKCSJwcm8uaHQiLAoJIm9yZy5odCIsCgkibWVkLmh0IiwKCSJhcnQuaHQiLAoJImNvb3AuaHQiLAoJInBvbC5odCIsCgkiYXNzby5odCIsCgkiZWR1Lmh0IiwKCSJyZWwuaHQiLAoJImdvdXYuaHQiLAoJInBlcnNvLmh0IiwKCSJodSIsCgkiY28uaHUiLAoJImluZm8uaHUiLAoJIm9yZy5odSIsCgkicHJpdi5odSIsCgkic3BvcnQuaHUiLAoJInRtLmh1IiwKCSIyMDAwLmh1IiwKCSJhZ3Jhci5odSIsCgkiYm9sdC5odSIsCgkiY2FzaW5vLmh1IiwKCSJjaXR5Lmh1IiwKCSJlcm90aWNhLmh1IiwKCSJlcm90aWthLmh1IiwKCSJmaWxtLmh1IiwKCSJmb3J1bS5odSIsCgkiZ2FtZXMuaHUiLAoJImhvdGVsLmh1IiwKCSJpbmdhdGxhbi5odSIsCgkiam9nYXN6Lmh1IiwKCSJrb255dmVsby5odSIsCgkibGFrYXMuaHUiLAoJIm1lZGlhLmh1IiwKCSJuZXdzLmh1IiwKCSJyZWtsYW0uaHUiLAoJInNleC5odSIsCgkic2hvcC5odSIsCgkic3VsaS5odSIsCgkic3pleC5odSIsCgkidG96c2RlLmh1IiwKCSJ1dGF6YXMuaHUiLAoJInZpZGVvLmh1IiwKCSJpZCIsCgkiYWMuaWQiLAoJImJpei5pZCIsCgkiY28uaWQiLAoJImRlc2EuaWQiLAoJImdvLmlkIiwKCSJtaWwuaWQiLAoJIm15LmlkIiwKCSJuZXQuaWQiLAoJIm9yLmlkIiwKCSJwb25wZXMuaWQiLAoJInNjaC5pZCIsCgkid2ViLmlkIiwKCSJpZSIsCgkiZ292LmllIiwKCSJpbCIsCgkiYWMuaWwiLAoJImNvLmlsIiwKCSJnb3YuaWwiLAoJImlkZi5pbCIsCgkiazEyLmlsIiwKCSJtdW5pLmlsIiwKCSJuZXQuaWwiLAoJIm9yZy5pbCIsCgkiaW0iLAoJImFjLmltIiwKCSJjby5pbSIsCgkiY29tLmltIiwKCSJsdGQuY28uaW0iLAoJIm5ldC5pbSIsCgkib3JnLmltIiwKCSJwbGMuY28uaW0iLAoJInR0LmltIiwKCSJ0di5pbSIsCgkiaW4iLAoJImNvLmluIiwKCSJmaXJtLmluIiwKCSJuZXQuaW4iLAoJIm9yZy5pbiIsCgkiZ2VuLmluIiwKCSJpbmQuaW4iLAoJIm5pYy5pbiIsCgkiYWMuaW4iLAoJImVkdS5pbiIsCgkicmVzLmluIiwKCSJnb3YuaW4iLAoJIm1pbC5pbiIsCgkiaW5mbyIsCgkiaW50IiwKCSJldS5pbnQiLAoJImlvIiwKCSJjb20uaW8iLAoJImlxIiwKCSJnb3YuaXEiLAoJImVkdS5pcSIsCgkibWlsLmlxIiwKCSJjb20uaXEiLAoJIm9yZy5pcSIsCgkibmV0LmlxIiwKCSJpciIsCgkiYWMuaXIiLAoJImNvLmlyIiwKCSJnb3YuaXIiLAoJImlkLmlyIiwKCSJuZXQuaXIiLAoJIm9yZy5pciIsCgkic2NoLmlyIiwKCSLYp9uM2LHYp9mGLmlyIiwKCSLYp9mK2LHYp9mGLmlyIiwKCSJpcyIsCgkibmV0LmlzIiwKCSJjb20uaXMiLAoJImVkdS5pcyIsCgkiZ292LmlzIiwKCSJvcmcuaXMiLAoJImludC5pcyIsCgkiaXQiLAoJImdvdi5pdCIsCgkiZWR1Lml0IiwKCSJhYnIuaXQiLAoJImFicnV6em8uaXQiLAoJImFvc3RhLXZhbGxleS5pdCIsCgkiYW9zdGF2YWxsZXkuaXQiLAoJImJhcy5pdCIsCgkiYmFzaWxpY2F0YS5pdCIsCgkiY2FsLml0IiwKCSJjYWxhYnJpYS5pdCIsCgkiY2FtLml0IiwKCSJjYW1wYW5pYS5pdCIsCgkiZW1pbGlhLXJvbWFnbmEuaXQiLAoJImVtaWxpYXJvbWFnbmEuaXQiLAoJImVtci5pdCIsCgkiZnJpdWxpLXYtZ2l1bGlhLml0IiwKCSJmcml1bGktdmUtZ2l1bGlhLml0IiwKCSJmcml1bGktdmVnaXVsaWEuaXQiLAoJImZyaXVsaS12ZW5lemlhLWdpdWxpYS5pdCIsCgkiZnJpdWxpLXZlbmV6aWFnaXVsaWEuaXQiLAoJImZyaXVsaS12Z2l1bGlhLml0IiwKCSJmcml1bGl2LWdpdWxpYS5pdCIsCgkiZnJpdWxpdmUtZ2l1bGlhLml0IiwKCSJmcml1bGl2ZWdpdWxpYS5pdCIsCgkiZnJpdWxpdmVuZXppYS1naXVsaWEuaXQiLAoJImZyaXVsaXZlbmV6aWFnaXVsaWEuaXQiLAoJImZyaXVsaXZnaXVsaWEuaXQiLAoJImZ2Zy5pdCIsCgkibGF6Lml0IiwKCSJsYXppby5pdCIsCgkibGlnLml0IiwKCSJsaWd1cmlhLml0IiwKCSJsb20uaXQiLAoJImxvbWJhcmRpYS5pdCIsCgkibG9tYmFyZHkuaXQiLAoJImx1Y2FuaWEuaXQiLAoJIm1hci5pdCIsCgkibWFyY2hlLml0IiwKCSJtb2wuaXQiLAoJIm1vbGlzZS5pdCIsCgkicGllZG1vbnQuaXQiLAoJInBpZW1vbnRlLml0IiwKCSJwbW4uaXQiLAoJInB1Zy5pdCIsCgkicHVnbGlhLml0IiwKCSJzYXIuaXQiLAoJInNhcmRlZ25hLml0IiwKCSJzYXJkaW5pYS5pdCIsCgkic2ljLml0IiwKCSJzaWNpbGlhLml0IiwKCSJzaWNpbHkuaXQiLAoJInRhYS5pdCIsCgkidG9zLml0IiwKCSJ0b3NjYW5hLml0IiwKCSJ0cmVudGluLXN1ZC10aXJvbC5pdCIsCgkidHJlbnRpbi1zw7xkLXRpcm9sLml0IiwKCSJ0cmVudGluLXN1ZHRpcm9sLml0IiwKCSJ0cmVudGluLXPDvGR0aXJvbC5pdCIsCgkidHJlbnRpbi1zdWVkLXRpcm9sLml0IiwKCSJ0cmVudGluLXN1ZWR0aXJvbC5pdCIsCgkidHJlbnRpbm8tYS1hZGlnZS5pdCIsCgkidHJlbnRpbm8tYWFkaWdlLml0IiwKCSJ0cmVudGluby1hbHRvLWFkaWdlLml0IiwKCSJ0cmVudGluby1hbHRvYWRpZ2UuaXQiLAoJInRyZW50aW5vLXMtdGlyb2wuaXQiLAoJInRyZW50aW5vLXN0aXJvbC5pdCIsCgkidHJlbnRpbm8tc3VkLXRpcm9sLml0IiwKCSJ0cmVudGluby1zw7xkLXRpcm9sLml0IiwKCSJ0cmVudGluby1zdWR0aXJvbC5pdCIsCgkidHJlbnRpbm8tc8O8ZHRpcm9sLml0IiwKCSJ0cmVudGluby1zdWVkLXRpcm9sLml0IiwKCSJ0cmVudGluby1zdWVkdGlyb2wuaXQiLAoJInRyZW50aW5vLml0IiwKCSJ0cmVudGlub2EtYWRpZ2UuaXQiLAoJInRyZW50aW5vYWFkaWdlLml0IiwKCSJ0cmVudGlub2FsdG8tYWRpZ2UuaXQiLAoJInRyZW50aW5vYWx0b2FkaWdlLml0IiwKCSJ0cmVudGlub3MtdGlyb2wuaXQiLAoJInRyZW50aW5vc3Rpcm9sLml0IiwKCSJ0cmVudGlub3N1ZC10aXJvbC5pdCIsCgkidHJlbnRpbm9zw7xkLXRpcm9sLml0IiwKCSJ0cmVudGlub3N1ZHRpcm9sLml0IiwKCSJ0cmVudGlub3PDvGR0aXJvbC5pdCIsCgkidHJlbnRpbm9zdWVkLXRpcm9sLml0IiwKCSJ0cmVudGlub3N1ZWR0aXJvbC5pdCIsCgkidHJlbnRpbnN1ZC10aXJvbC5pdCIsCgkidHJlbnRpbnPDvGQtdGlyb2wuaXQiLAoJInRyZW50aW5zdWR0aXJvbC5pdCIsCgkidHJlbnRpbnPDvGR0aXJvbC5pdCIsCgkidHJlbnRpbnN1ZWQtdGlyb2wuaXQiLAoJInRyZW50aW5zdWVkdGlyb2wuaXQiLAoJInR1c2NhbnkuaXQiLAoJInVtYi5pdCIsCgkidW1icmlhLml0IiwKCSJ2YWwtZC1hb3N0YS5pdCIsCgkidmFsLWRhb3N0YS5pdCIsCgkidmFsZC1hb3N0YS5pdCIsCgkidmFsZGFvc3RhLml0IiwKCSJ2YWxsZS1hb3N0YS5pdCIsCgkidmFsbGUtZC1hb3N0YS5pdCIsCgkidmFsbGUtZGFvc3RhLml0IiwKCSJ2YWxsZWFvc3RhLml0IiwKCSJ2YWxsZWQtYW9zdGEuaXQiLAoJInZhbGxlZGFvc3RhLml0IiwKCSJ2YWxsZWUtYW9zdGUuaXQiLAoJInZhbGzDqWUtYW9zdGUuaXQiLAoJInZhbGxlZS1kLWFvc3RlLml0IiwKCSJ2YWxsw6llLWQtYW9zdGUuaXQiLAoJInZhbGxlZWFvc3RlLml0IiwKCSJ2YWxsw6llYW9zdGUuaXQiLAoJInZhbGxlZWRhb3N0ZS5pdCIsCgkidmFsbMOpZWRhb3N0ZS5pdCIsCgkidmFvLml0IiwKCSJ2ZGEuaXQiLAoJInZlbi5pdCIsCgkidmVuZXRvLml0IiwKCSJhZy5pdCIsCgkiYWdyaWdlbnRvLml0IiwKCSJhbC5pdCIsCgkiYWxlc3NhbmRyaWEuaXQiLAoJImFsdG8tYWRpZ2UuaXQiLAoJImFsdG9hZGlnZS5pdCIsCgkiYW4uaXQiLAoJImFuY29uYS5pdCIsCgkiYW5kcmlhLWJhcmxldHRhLXRyYW5pLml0IiwKCSJhbmRyaWEtdHJhbmktYmFybGV0dGEuaXQiLAoJImFuZHJpYWJhcmxldHRhdHJhbmkuaXQiLAoJImFuZHJpYXRyYW5pYmFybGV0dGEuaXQiLAoJImFvLml0IiwKCSJhb3N0YS5pdCIsCgkiYW9zdGUuaXQiLAoJImFwLml0IiwKCSJhcS5pdCIsCgkiYXF1aWxhLml0IiwKCSJhci5pdCIsCgkiYXJlenpvLml0IiwKCSJhc2NvbGktcGljZW5vLml0IiwKCSJhc2NvbGlwaWNlbm8uaXQiLAoJImFzdGkuaXQiLAoJImF0Lml0IiwKCSJhdi5pdCIsCgkiYXZlbGxpbm8uaXQiLAoJImJhLml0IiwKCSJiYWxzYW4tc3VkdGlyb2wuaXQiLAoJImJhbHNhbi1zw7xkdGlyb2wuaXQiLAoJImJhbHNhbi1zdWVkdGlyb2wuaXQiLAoJImJhbHNhbi5pdCIsCgkiYmFyaS5pdCIsCgkiYmFybGV0dGEtdHJhbmktYW5kcmlhLml0IiwKCSJiYXJsZXR0YXRyYW5pYW5kcmlhLml0IiwKCSJiZWxsdW5vLml0IiwKCSJiZW5ldmVudG8uaXQiLAoJImJlcmdhbW8uaXQiLAoJImJnLml0IiwKCSJiaS5pdCIsCgkiYmllbGxhLml0IiwKCSJibC5pdCIsCgkiYm4uaXQiLAoJImJvLml0IiwKCSJib2xvZ25hLml0IiwKCSJib2x6YW5vLWFsdG9hZGlnZS5pdCIsCgkiYm9semFuby5pdCIsCgkiYm96ZW4tc3VkdGlyb2wuaXQiLAoJImJvemVuLXPDvGR0aXJvbC5pdCIsCgkiYm96ZW4tc3VlZHRpcm9sLml0IiwKCSJib3plbi5pdCIsCgkiYnIuaXQiLAoJImJyZXNjaWEuaXQiLAoJImJyaW5kaXNpLml0IiwKCSJicy5pdCIsCgkiYnQuaXQiLAoJImJ1bHNhbi1zdWR0aXJvbC5pdCIsCgkiYnVsc2FuLXPDvGR0aXJvbC5pdCIsCgkiYnVsc2FuLXN1ZWR0aXJvbC5pdCIsCgkiYnVsc2FuLml0IiwKCSJiei5pdCIsCgkiY2EuaXQiLAoJImNhZ2xpYXJpLml0IiwKCSJjYWx0YW5pc3NldHRhLml0IiwKCSJjYW1waWRhbm8tbWVkaW8uaXQiLAoJImNhbXBpZGFub21lZGlvLml0IiwKCSJjYW1wb2Jhc3NvLml0IiwKCSJjYXJib25pYS1pZ2xlc2lhcy5pdCIsCgkiY2FyYm9uaWFpZ2xlc2lhcy5pdCIsCgkiY2FycmFyYS1tYXNzYS5pdCIsCgkiY2FycmFyYW1hc3NhLml0IiwKCSJjYXNlcnRhLml0IiwKCSJjYXRhbmlhLml0IiwKCSJjYXRhbnphcm8uaXQiLAoJImNiLml0IiwKCSJjZS5pdCIsCgkiY2VzZW5hLWZvcmxpLml0IiwKCSJjZXNlbmEtZm9ybMOsLml0IiwKCSJjZXNlbmFmb3JsaS5pdCIsCgkiY2VzZW5hZm9ybMOsLml0IiwKCSJjaC5pdCIsCgkiY2hpZXRpLml0IiwKCSJjaS5pdCIsCgkiY2wuaXQiLAoJImNuLml0IiwKCSJjby5pdCIsCgkiY29tby5pdCIsCgkiY29zZW56YS5pdCIsCgkiY3IuaXQiLAoJImNyZW1vbmEuaXQiLAoJImNyb3RvbmUuaXQiLAoJImNzLml0IiwKCSJjdC5pdCIsCgkiY3VuZW8uaXQiLAoJImN6Lml0IiwKCSJkZWxsLW9nbGlhc3RyYS5pdCIsCgkiZGVsbG9nbGlhc3RyYS5pdCIsCgkiZW4uaXQiLAoJImVubmEuaXQiLAoJImZjLml0IiwKCSJmZS5pdCIsCgkiZmVybW8uaXQiLAoJImZlcnJhcmEuaXQiLAoJImZnLml0IiwKCSJmaS5pdCIsCgkiZmlyZW56ZS5pdCIsCgkiZmxvcmVuY2UuaXQiLAoJImZtLml0IiwKCSJmb2dnaWEuaXQiLAoJImZvcmxpLWNlc2VuYS5pdCIsCgkiZm9ybMOsLWNlc2VuYS5pdCIsCgkiZm9ybGljZXNlbmEuaXQiLAoJImZvcmzDrGNlc2VuYS5pdCIsCgkiZnIuaXQiLAoJImZyb3Npbm9uZS5pdCIsCgkiZ2UuaXQiLAoJImdlbm9hLml0IiwKCSJnZW5vdmEuaXQiLAoJImdvLml0IiwKCSJnb3JpemlhLml0IiwKCSJnci5pdCIsCgkiZ3Jvc3NldG8uaXQiLAoJImlnbGVzaWFzLWNhcmJvbmlhLml0IiwKCSJpZ2xlc2lhc2NhcmJvbmlhLml0IiwKCSJpbS5pdCIsCgkiaW1wZXJpYS5pdCIsCgkiaXMuaXQiLAoJImlzZXJuaWEuaXQiLAoJImtyLml0IiwKCSJsYS1zcGV6aWEuaXQiLAoJImxhcXVpbGEuaXQiLAoJImxhc3BlemlhLml0IiwKCSJsYXRpbmEuaXQiLAoJImxjLml0IiwKCSJsZS5pdCIsCgkibGVjY2UuaXQiLAoJImxlY2NvLml0IiwKCSJsaS5pdCIsCgkibGl2b3Juby5pdCIsCgkibG8uaXQiLAoJImxvZGkuaXQiLAoJImx0Lml0IiwKCSJsdS5pdCIsCgkibHVjY2EuaXQiLAoJIm1hY2VyYXRhLml0IiwKCSJtYW50b3ZhLml0IiwKCSJtYXNzYS1jYXJyYXJhLml0IiwKCSJtYXNzYWNhcnJhcmEuaXQiLAoJIm1hdGVyYS5pdCIsCgkibWIuaXQiLAoJIm1jLml0IiwKCSJtZS5pdCIsCgkibWVkaW8tY2FtcGlkYW5vLml0IiwKCSJtZWRpb2NhbXBpZGFuby5pdCIsCgkibWVzc2luYS5pdCIsCgkibWkuaXQiLAoJIm1pbGFuLml0IiwKCSJtaWxhbm8uaXQiLAoJIm1uLml0IiwKCSJtby5pdCIsCgkibW9kZW5hLml0IiwKCSJtb256YS1icmlhbnphLml0IiwKCSJtb256YS1lLWRlbGxhLWJyaWFuemEuaXQiLAoJIm1vbnphLml0IiwKCSJtb256YWJyaWFuemEuaXQiLAoJIm1vbnphZWJyaWFuemEuaXQiLAoJIm1vbnphZWRlbGxhYnJpYW56YS5pdCIsCgkibXMuaXQiLAoJIm10Lml0IiwKCSJuYS5pdCIsCgkibmFwbGVzLml0IiwKCSJuYXBvbGkuaXQiLAoJIm5vLml0IiwKCSJub3ZhcmEuaXQiLAoJIm51Lml0IiwKCSJudW9yby5pdCIsCgkib2cuaXQiLAoJIm9nbGlhc3RyYS5pdCIsCgkib2xiaWEtdGVtcGlvLml0IiwKCSJvbGJpYXRlbXBpby5pdCIsCgkib3IuaXQiLAoJIm9yaXN0YW5vLml0IiwKCSJvdC5pdCIsCgkicGEuaXQiLAoJInBhZG92YS5pdCIsCgkicGFkdWEuaXQiLAoJInBhbGVybW8uaXQiLAoJInBhcm1hLml0IiwKCSJwYXZpYS5pdCIsCgkicGMuaXQiLAoJInBkLml0IiwKCSJwZS5pdCIsCgkicGVydWdpYS5pdCIsCgkicGVzYXJvLXVyYmluby5pdCIsCgkicGVzYXJvdXJiaW5vLml0IiwKCSJwZXNjYXJhLml0IiwKCSJwZy5pdCIsCgkicGkuaXQiLAoJInBpYWNlbnphLml0IiwKCSJwaXNhLml0IiwKCSJwaXN0b2lhLml0IiwKCSJwbi5pdCIsCgkicG8uaXQiLAoJInBvcmRlbm9uZS5pdCIsCgkicG90ZW56YS5pdCIsCgkicHIuaXQiLAoJInByYXRvLml0IiwKCSJwdC5pdCIsCgkicHUuaXQiLAoJInB2Lml0IiwKCSJwei5pdCIsCgkicmEuaXQiLAoJInJhZ3VzYS5pdCIsCgkicmF2ZW5uYS5pdCIsCgkicmMuaXQiLAoJInJlLml0IiwKCSJyZWdnaW8tY2FsYWJyaWEuaXQiLAoJInJlZ2dpby1lbWlsaWEuaXQiLAoJInJlZ2dpb2NhbGFicmlhLml0IiwKCSJyZWdnaW9lbWlsaWEuaXQiLAoJInJnLml0IiwKCSJyaS5pdCIsCgkicmlldGkuaXQiLAoJInJpbWluaS5pdCIsCgkicm0uaXQiLAoJInJuLml0IiwKCSJyby5pdCIsCgkicm9tYS5pdCIsCgkicm9tZS5pdCIsCgkicm92aWdvLml0IiwKCSJzYS5pdCIsCgkic2FsZXJuby5pdCIsCgkic2Fzc2FyaS5pdCIsCgkic2F2b25hLml0IiwKCSJzaS5pdCIsCgkic2llbmEuaXQiLAoJInNpcmFjdXNhLml0IiwKCSJzby5pdCIsCgkic29uZHJpby5pdCIsCgkic3AuaXQiLAoJInNyLml0IiwKCSJzcy5pdCIsCgkic3VlZHRpcm9sLml0IiwKCSJzw7xkdGlyb2wuaXQiLAoJInN2Lml0IiwKCSJ0YS5pdCIsCgkidGFyYW50by5pdCIsCgkidGUuaXQiLAoJInRlbXBpby1vbGJpYS5pdCIsCgkidGVtcGlvb2xiaWEuaXQiLAoJInRlcmFtby5pdCIsCgkidGVybmkuaXQiLAoJInRuLml0IiwKCSJ0by5pdCIsCgkidG9yaW5vLml0IiwKCSJ0cC5pdCIsCgkidHIuaXQiLAoJInRyYW5pLWFuZHJpYS1iYXJsZXR0YS5pdCIsCgkidHJhbmktYmFybGV0dGEtYW5kcmlhLml0IiwKCSJ0cmFuaWFuZHJpYWJhcmxldHRhLml0IiwKCSJ0cmFuaWJhcmxldHRhYW5kcmlhLml0IiwKCSJ0cmFwYW5pLml0IiwKCSJ0cmVudG8uaXQiLAoJInRyZXZpc28uaXQiLAoJInRyaWVzdGUuaXQiLAoJInRzLml0IiwKCSJ0dXJpbi5pdCIsCgkidHYuaXQiLAoJInVkLml0IiwKCSJ1ZGluZS5pdCIsCgkidXJiaW5vLXBlc2Fyby5pdCIsCgkidXJiaW5vcGVzYXJvLml0IiwKCSJ2YS5pdCIsCgkidmFyZXNlLml0IiwKCSJ2Yi5pdCIsCgkidmMuaXQiLAoJInZlLml0IiwKCSJ2ZW5lemlhLml0IiwKCSJ2ZW5pY2UuaXQiLAoJInZlcmJhbmlhLml0IiwKCSJ2ZXJjZWxsaS5pdCIsCgkidmVyb25hLml0IiwKCSJ2aS5pdCIsCgkidmliby12YWxlbnRpYS5pdCIsCgkidmlib3ZhbGVudGlhLml0IiwKCSJ2aWNlbnphLml0IiwKCSJ2aXRlcmJvLml0IiwKCSJ2ci5pdCIsCgkidnMuaXQiLAoJInZ0Lml0IiwKCSJ2di5pdCIsCgkiamUiLAoJImNvLmplIiwKCSJuZXQuamUiLAoJIm9yZy5qZSIsCgkiKi5qbSIsCgkiam8iLAoJImNvbS5qbyIsCgkib3JnLmpvIiwKCSJuZXQuam8iLAoJImVkdS5qbyIsCgkic2NoLmpvIiwKCSJnb3Yuam8iLAoJIm1pbC5qbyIsCgkibmFtZS5qbyIsCgkiam9icyIsCgkianAiLAoJImFjLmpwIiwKCSJhZC5qcCIsCgkiY28uanAiLAoJImVkLmpwIiwKCSJnby5qcCIsCgkiZ3IuanAiLAoJImxnLmpwIiwKCSJuZS5qcCIsCgkib3IuanAiLAoJImFpY2hpLmpwIiwKCSJha2l0YS5qcCIsCgkiYW9tb3JpLmpwIiwKCSJjaGliYS5qcCIsCgkiZWhpbWUuanAiLAoJImZ1a3VpLmpwIiwKCSJmdWt1b2thLmpwIiwKCSJmdWt1c2hpbWEuanAiLAoJImdpZnUuanAiLAoJImd1bm1hLmpwIiwKCSJoaXJvc2hpbWEuanAiLAoJImhva2thaWRvLmpwIiwKCSJoeW9nby5qcCIsCgkiaWJhcmFraS5qcCIsCgkiaXNoaWthd2EuanAiLAoJIml3YXRlLmpwIiwKCSJrYWdhd2EuanAiLAoJImthZ29zaGltYS5qcCIsCgkia2FuYWdhd2EuanAiLAoJImtvY2hpLmpwIiwKCSJrdW1hbW90by5qcCIsCgkia3lvdG8uanAiLAoJIm1pZS5qcCIsCgkibWl5YWdpLmpwIiwKCSJtaXlhemFraS5qcCIsCgkibmFnYW5vLmpwIiwKCSJuYWdhc2FraS5qcCIsCgkibmFyYS5qcCIsCgkibmlpZ2F0YS5qcCIsCgkib2l0YS5qcCIsCgkib2theWFtYS5qcCIsCgkib2tpbmF3YS5qcCIsCgkib3Nha2EuanAiLAoJInNhZ2EuanAiLAoJInNhaXRhbWEuanAiLAoJInNoaWdhLmpwIiwKCSJzaGltYW5lLmpwIiwKCSJzaGl6dW9rYS5qcCIsCgkidG9jaGlnaS5qcCIsCgkidG9rdXNoaW1hLmpwIiwKCSJ0b2t5by5qcCIsCgkidG90dG9yaS5qcCIsCgkidG95YW1hLmpwIiwKCSJ3YWtheWFtYS5qcCIsCgkieWFtYWdhdGEuanAiLAoJInlhbWFndWNoaS5qcCIsCgkieWFtYW5hc2hpLmpwIiwKCSLmoIPmnKguanAiLAoJIuaEm+efpS5qcCIsCgki5oSb5aqbLmpwIiwKCSLlhbXluqsuanAiLAoJIueGiuacrC5qcCIsCgki6Iyo5Z+OLmpwIiwKCSLljJfmtbfpgZMuanAiLAoJIuWNg+iRiS5qcCIsCgki5ZKM5q2M5bGxLmpwIiwKCSLplbfltI4uanAiLAoJIumVt+mHji5qcCIsCgki5paw5r2fLmpwIiwKCSLpnZLmo64uanAiLAoJIumdmeWyoS5qcCIsCgki5p2x5LqsLmpwIiwKCSLnn7Plt50uanAiLAoJIuWfvOeOiS5qcCIsCgki5LiJ6YeNLmpwIiwKCSLkuqzpg70uanAiLAoJIuS9kOizgC5qcCIsCgki5aSn5YiGLmpwIiwKCSLlpKfpmKouanAiLAoJIuWliOiJry5qcCIsCgki5a6u5Z+OLmpwIiwKCSLlrq7ltI4uanAiLAoJIuWvjOWxsS5qcCIsCgki5bGx5Y+jLmpwIiwKCSLlsbHlvaIuanAiLAoJIuWxseaiqC5qcCIsCgki5bKp5omLLmpwIiwKCSLlspDpmJwuanAiLAoJIuWyoeWxsS5qcCIsCgki5bO25qC5LmpwIiwKCSLluoPls7YuanAiLAoJIuW+s+Wzti5qcCIsCgki5rKW57iELmpwIiwKCSLmu4vos4AuanAiLAoJIuelnuWliOW3nS5qcCIsCgki56aP5LqVLmpwIiwKCSLnpo/lsqEuanAiLAoJIuemj+Wzti5qcCIsCgki56eL55SwLmpwIiwKCSLnvqTppqwuanAiLAoJIummmeW3nS5qcCIsCgki6auY55+lLmpwIiwKCSLps6Xlj5YuanAiLAoJIum5v+WFkOWzti5qcCIsCgkiKi5rYXdhc2FraS5qcCIsCgkiKi5raXRha3l1c2h1LmpwIiwKCSIqLmtvYmUuanAiLAoJIioubmFnb3lhLmpwIiwKCSIqLnNhcHBvcm8uanAiLAoJIiouc2VuZGFpLmpwIiwKCSIqLnlva29oYW1hLmpwIiwKCSIhY2l0eS5rYXdhc2FraS5qcCIsCgkiIWNpdHkua2l0YWt5dXNodS5qcCIsCgkiIWNpdHkua29iZS5qcCIsCgkiIWNpdHkubmFnb3lhLmpwIiwKCSIhY2l0eS5zYXBwb3JvLmpwIiwKCSIhY2l0eS5zZW5kYWkuanAiLAoJIiFjaXR5Lnlva29oYW1hLmpwIiwKCSJhaXNhaS5haWNoaS5qcCIsCgkiYW1hLmFpY2hpLmpwIiwKCSJhbmpvLmFpY2hpLmpwIiwKCSJhc3VrZS5haWNoaS5qcCIsCgkiY2hpcnl1LmFpY2hpLmpwIiwKCSJjaGl0YS5haWNoaS5qcCIsCgkiZnVzby5haWNoaS5qcCIsCgkiZ2FtYWdvcmkuYWljaGkuanAiLAoJImhhbmRhLmFpY2hpLmpwIiwKCSJoYXp1LmFpY2hpLmpwIiwKCSJoZWtpbmFuLmFpY2hpLmpwIiwKCSJoaWdhc2hpdXJhLmFpY2hpLmpwIiwKCSJpY2hpbm9taXlhLmFpY2hpLmpwIiwKCSJpbmF6YXdhLmFpY2hpLmpwIiwKCSJpbnV5YW1hLmFpY2hpLmpwIiwKCSJpc3NoaWtpLmFpY2hpLmpwIiwKCSJpd2FrdXJhLmFpY2hpLmpwIiwKCSJrYW5pZS5haWNoaS5qcCIsCgkia2FyaXlhLmFpY2hpLmpwIiwKCSJrYXN1Z2FpLmFpY2hpLmpwIiwKCSJraXJhLmFpY2hpLmpwIiwKCSJraXlvc3UuYWljaGkuanAiLAoJImtvbWFraS5haWNoaS5qcCIsCgkia29uYW4uYWljaGkuanAiLAoJImtvdGEuYWljaGkuanAiLAoJIm1paGFtYS5haWNoaS5qcCIsCgkibWl5b3NoaS5haWNoaS5qcCIsCgkibmlzaGlvLmFpY2hpLmpwIiwKCSJuaXNzaGluLmFpY2hpLmpwIiwKCSJvYnUuYWljaGkuanAiLAoJIm9ndWNoaS5haWNoaS5qcCIsCgkib2hhcnUuYWljaGkuanAiLAoJIm9rYXpha2kuYWljaGkuanAiLAoJIm93YXJpYXNhaGkuYWljaGkuanAiLAoJInNldG8uYWljaGkuanAiLAoJInNoaWthdHN1LmFpY2hpLmpwIiwKCSJzaGluc2hpcm8uYWljaGkuanAiLAoJInNoaXRhcmEuYWljaGkuanAiLAoJInRhaGFyYS5haWNoaS5qcCIsCgkidGFrYWhhbWEuYWljaGkuanAiLAoJInRvYmlzaGltYS5haWNoaS5qcCIsCgkidG9laS5haWNoaS5qcCIsCgkidG9nby5haWNoaS5qcCIsCgkidG9rYWkuYWljaGkuanAiLAoJInRva29uYW1lLmFpY2hpLmpwIiwKCSJ0b3lvYWtlLmFpY2hpLmpwIiwKCSJ0b3lvaGFzaGkuYWljaGkuanAiLAoJInRveW9rYXdhLmFpY2hpLmpwIiwKCSJ0b3lvbmUuYWljaGkuanAiLAoJInRveW90YS5haWNoaS5qcCIsCgkidHN1c2hpbWEuYWljaGkuanAiLAoJInlhdG9taS5haWNoaS5qcCIsCgkiYWtpdGEuYWtpdGEuanAiLAoJImRhaXNlbi5ha2l0YS5qcCIsCgkiZnVqaXNhdG8uYWtpdGEuanAiLAoJImdvam9tZS5ha2l0YS5qcCIsCgkiaGFjaGlyb2dhdGEuYWtpdGEuanAiLAoJImhhcHBvdS5ha2l0YS5qcCIsCgkiaGlnYXNoaW5hcnVzZS5ha2l0YS5qcCIsCgkiaG9uam8uYWtpdGEuanAiLAoJImhvbmp5by5ha2l0YS5qcCIsCgkiaWthd2EuYWtpdGEuanAiLAoJImthbWlrb2FuaS5ha2l0YS5qcCIsCgkia2FtaW9rYS5ha2l0YS5qcCIsCgkia2F0YWdhbWkuYWtpdGEuanAiLAoJImthenVuby5ha2l0YS5qcCIsCgkia2l0YWFraXRhLmFraXRhLmpwIiwKCSJrb3Nha2EuYWtpdGEuanAiLAoJImt5b3dhLmFraXRhLmpwIiwKCSJtaXNhdG8uYWtpdGEuanAiLAoJIm1pdGFuZS5ha2l0YS5qcCIsCgkibW9yaXlvc2hpLmFraXRhLmpwIiwKCSJuaWthaG8uYWtpdGEuanAiLAoJIm5vc2hpcm8uYWtpdGEuanAiLAoJIm9kYXRlLmFraXRhLmpwIiwKCSJvZ2EuYWtpdGEuanAiLAoJIm9nYXRhLmFraXRhLmpwIiwKCSJzZW1ib2t1LmFraXRhLmpwIiwKCSJ5b2tvdGUuYWtpdGEuanAiLAoJInl1cmlob25qby5ha2l0YS5qcCIsCgkiYW9tb3JpLmFvbW9yaS5qcCIsCgkiZ29ub2hlLmFvbW9yaS5qcCIsCgkiaGFjaGlub2hlLmFvbW9yaS5qcCIsCgkiaGFzaGlrYW1pLmFvbW9yaS5qcCIsCgkiaGlyYW5haS5hb21vcmkuanAiLAoJImhpcm9zYWtpLmFvbW9yaS5qcCIsCgkiaXRheWFuYWdpLmFvbW9yaS5qcCIsCgkia3Vyb2lzaGkuYW9tb3JpLmpwIiwKCSJtaXNhd2EuYW9tb3JpLmpwIiwKCSJtdXRzdS5hb21vcmkuanAiLAoJIm5ha2Fkb21hcmkuYW9tb3JpLmpwIiwKCSJub2hlamkuYW9tb3JpLmpwIiwKCSJvaXJhc2UuYW9tb3JpLmpwIiwKCSJvd2FuaS5hb21vcmkuanAiLAoJInJva3Vub2hlLmFvbW9yaS5qcCIsCgkic2Fubm9oZS5hb21vcmkuanAiLAoJInNoaWNoaW5vaGUuYW9tb3JpLmpwIiwKCSJzaGluZ28uYW9tb3JpLmpwIiwKCSJ0YWtrby5hb21vcmkuanAiLAoJInRvd2FkYS5hb21vcmkuanAiLAoJInRzdWdhcnUuYW9tb3JpLmpwIiwKCSJ0c3VydXRhLmFvbW9yaS5qcCIsCgkiYWJpa28uY2hpYmEuanAiLAoJImFzYWhpLmNoaWJhLmpwIiwKCSJjaG9uYW4uY2hpYmEuanAiLAoJImNob3NlaS5jaGliYS5qcCIsCgkiY2hvc2hpLmNoaWJhLmpwIiwKCSJjaHVvLmNoaWJhLmpwIiwKCSJmdW5hYmFzaGkuY2hpYmEuanAiLAoJImZ1dHRzdS5jaGliYS5qcCIsCgkiaGFuYW1pZ2F3YS5jaGliYS5qcCIsCgkiaWNoaWhhcmEuY2hpYmEuanAiLAoJImljaGlrYXdhLmNoaWJhLmpwIiwKCSJpY2hpbm9taXlhLmNoaWJhLmpwIiwKCSJpbnphaS5jaGliYS5qcCIsCgkiaXN1bWkuY2hpYmEuanAiLAoJImthbWFnYXlhLmNoaWJhLmpwIiwKCSJrYW1vZ2F3YS5jaGliYS5qcCIsCgkia2FzaGl3YS5jaGliYS5qcCIsCgkia2F0b3JpLmNoaWJhLmpwIiwKCSJrYXRzdXVyYS5jaGliYS5qcCIsCgkia2ltaXRzdS5jaGliYS5qcCIsCgkia2lzYXJhenUuY2hpYmEuanAiLAoJImtvemFraS5jaGliYS5qcCIsCgkia3VqdWt1cmkuY2hpYmEuanAiLAoJImt5b25hbi5jaGliYS5qcCIsCgkibWF0c3Vkby5jaGliYS5qcCIsCgkibWlkb3JpLmNoaWJhLmpwIiwKCSJtaWhhbWEuY2hpYmEuanAiLAoJIm1pbmFtaWJvc28uY2hpYmEuanAiLAoJIm1vYmFyYS5jaGliYS5qcCIsCgkibXV0c3V6YXdhLmNoaWJhLmpwIiwKCSJuYWdhcmEuY2hpYmEuanAiLAoJIm5hZ2FyZXlhbWEuY2hpYmEuanAiLAoJIm5hcmFzaGluby5jaGliYS5qcCIsCgkibmFyaXRhLmNoaWJhLmpwIiwKCSJub2RhLmNoaWJhLmpwIiwKCSJvYW1pc2hpcmFzYXRvLmNoaWJhLmpwIiwKCSJvbWlnYXdhLmNoaWJhLmpwIiwKCSJvbmp1a3UuY2hpYmEuanAiLAoJIm90YWtpLmNoaWJhLmpwIiwKCSJzYWthZS5jaGliYS5qcCIsCgkic2FrdXJhLmNoaWJhLmpwIiwKCSJzaGltb2Z1c2EuY2hpYmEuanAiLAoJInNoaXJha28uY2hpYmEuanAiLAoJInNoaXJvaS5jaGliYS5qcCIsCgkic2hpc3VpLmNoaWJhLmpwIiwKCSJzb2RlZ2F1cmEuY2hpYmEuanAiLAoJInNvc2EuY2hpYmEuanAiLAoJInRha28uY2hpYmEuanAiLAoJInRhdGV5YW1hLmNoaWJhLmpwIiwKCSJ0b2dhbmUuY2hpYmEuanAiLAoJInRvaG5vc2hvLmNoaWJhLmpwIiwKCSJ0b21pc2F0by5jaGliYS5qcCIsCgkidXJheWFzdS5jaGliYS5qcCIsCgkieWFjaGltYXRhLmNoaWJhLmpwIiwKCSJ5YWNoaXlvLmNoaWJhLmpwIiwKCSJ5b2thaWNoaWJhLmNoaWJhLmpwIiwKCSJ5b2tvc2hpYmFoaWthcmkuY2hpYmEuanAiLAoJInlvdHN1a2FpZG8uY2hpYmEuanAiLAoJImFpbmFuLmVoaW1lLmpwIiwKCSJob25haS5laGltZS5qcCIsCgkiaWthdGEuZWhpbWUuanAiLAoJImltYWJhcmkuZWhpbWUuanAiLAoJIml5by5laGltZS5qcCIsCgkia2FtaWppbWEuZWhpbWUuanAiLAoJImtpaG9rdS5laGltZS5qcCIsCgkia3VtYWtvZ2VuLmVoaW1lLmpwIiwKCSJtYXNha2kuZWhpbWUuanAiLAoJIm1hdHN1bm8uZWhpbWUuanAiLAoJIm1hdHN1eWFtYS5laGltZS5qcCIsCgkibmFtaWthdGEuZWhpbWUuanAiLAoJIm5paWhhbWEuZWhpbWUuanAiLAoJIm96dS5laGltZS5qcCIsCgkic2Fpam8uZWhpbWUuanAiLAoJInNlaXlvLmVoaW1lLmpwIiwKCSJzaGlrb2t1Y2h1by5laGltZS5qcCIsCgkidG9iZS5laGltZS5qcCIsCgkidG9vbi5laGltZS5qcCIsCgkidWNoaWtvLmVoaW1lLmpwIiwKCSJ1d2FqaW1hLmVoaW1lLmpwIiwKCSJ5YXdhdGFoYW1hLmVoaW1lLmpwIiwKCSJlY2hpemVuLmZ1a3VpLmpwIiwKCSJlaWhlaWppLmZ1a3VpLmpwIiwKCSJmdWt1aS5mdWt1aS5qcCIsCgkiaWtlZGEuZnVrdWkuanAiLAoJImthdHN1eWFtYS5mdWt1aS5qcCIsCgkibWloYW1hLmZ1a3VpLmpwIiwKCSJtaW5hbWllY2hpemVuLmZ1a3VpLmpwIiwKCSJvYmFtYS5mdWt1aS5qcCIsCgkib2hpLmZ1a3VpLmpwIiwKCSJvbm8uZnVrdWkuanAiLAoJInNhYmFlLmZ1a3VpLmpwIiwKCSJzYWthaS5mdWt1aS5qcCIsCgkidGFrYWhhbWEuZnVrdWkuanAiLAoJInRzdXJ1Z2EuZnVrdWkuanAiLAoJIndha2FzYS5mdWt1aS5qcCIsCgkiYXNoaXlhLmZ1a3Vva2EuanAiLAoJImJ1emVuLmZ1a3Vva2EuanAiLAoJImNoaWt1Z28uZnVrdW9rYS5qcCIsCgkiY2hpa3Voby5mdWt1b2thLmpwIiwKCSJjaGlrdWpvLmZ1a3Vva2EuanAiLAoJImNoaWt1c2hpbm8uZnVrdW9rYS5qcCIsCgkiY2hpa3V6ZW4uZnVrdW9rYS5qcCIsCgkiY2h1by5mdWt1b2thLmpwIiwKCSJkYXphaWZ1LmZ1a3Vva2EuanAiLAoJImZ1a3VjaGkuZnVrdW9rYS5qcCIsCgkiaGFrYXRhLmZ1a3Vva2EuanAiLAoJImhpZ2FzaGkuZnVrdW9rYS5qcCIsCgkiaGlyb2thd2EuZnVrdW9rYS5qcCIsCgkiaGlzYXlhbWEuZnVrdW9rYS5qcCIsCgkiaWl6dWthLmZ1a3Vva2EuanAiLAoJImluYXRzdWtpLmZ1a3Vva2EuanAiLAoJImthaG8uZnVrdW9rYS5qcCIsCgkia2FzdWdhLmZ1a3Vva2EuanAiLAoJImthc3V5YS5mdWt1b2thLmpwIiwKCSJrYXdhcmEuZnVrdW9rYS5qcCIsCgkia2Vpc2VuLmZ1a3Vva2EuanAiLAoJImtvZ2EuZnVrdW9rYS5qcCIsCgkia3VyYXRlLmZ1a3Vva2EuanAiLAoJImt1cm9naS5mdWt1b2thLmpwIiwKCSJrdXJ1bWUuZnVrdW9rYS5qcCIsCgkibWluYW1pLmZ1a3Vva2EuanAiLAoJIm1peWFrby5mdWt1b2thLmpwIiwKCSJtaXlhbWEuZnVrdW9rYS5qcCIsCgkibWl5YXdha2EuZnVrdW9rYS5qcCIsCgkibWl6dW1ha2kuZnVrdW9rYS5qcCIsCgkibXVuYWthdGEuZnVrdW9rYS5qcCIsCgkibmFrYWdhd2EuZnVrdW9rYS5qcCIsCgkibmFrYW1hLmZ1a3Vva2EuanAiLAoJIm5pc2hpLmZ1a3Vva2EuanAiLAoJIm5vZ2F0YS5mdWt1b2thLmpwIiwKCSJvZ29yaS5mdWt1b2thLmpwIiwKCSJva2FnYWtpLmZ1a3Vva2EuanAiLAoJIm9rYXdhLmZ1a3Vva2EuanAiLAoJIm9raS5mdWt1b2thLmpwIiwKCSJvbXV0YS5mdWt1b2thLmpwIiwKCSJvbmdhLmZ1a3Vva2EuanAiLAoJIm9ub2pvLmZ1a3Vva2EuanAiLAoJIm90by5mdWt1b2thLmpwIiwKCSJzYWlnYXdhLmZ1a3Vva2EuanAiLAoJInNhc2FndXJpLmZ1a3Vva2EuanAiLAoJInNoaW5ndS5mdWt1b2thLmpwIiwKCSJzaGlueW9zaGl0b21pLmZ1a3Vva2EuanAiLAoJInNob25haS5mdWt1b2thLmpwIiwKCSJzb2VkYS5mdWt1b2thLmpwIiwKCSJzdWUuZnVrdW9rYS5qcCIsCgkidGFjaGlhcmFpLmZ1a3Vva2EuanAiLAoJInRhZ2F3YS5mdWt1b2thLmpwIiwKCSJ0YWthdGEuZnVrdW9rYS5qcCIsCgkidG9oby5mdWt1b2thLmpwIiwKCSJ0b3lvdHN1LmZ1a3Vva2EuanAiLAoJInRzdWlraS5mdWt1b2thLmpwIiwKCSJ1a2loYS5mdWt1b2thLmpwIiwKCSJ1bWkuZnVrdW9rYS5qcCIsCgkidXN1aS5mdWt1b2thLmpwIiwKCSJ5YW1hZGEuZnVrdW9rYS5qcCIsCgkieWFtZS5mdWt1b2thLmpwIiwKCSJ5YW5hZ2F3YS5mdWt1b2thLmpwIiwKCSJ5dWt1aGFzaGkuZnVrdW9rYS5qcCIsCgkiYWl6dWJhbmdlLmZ1a3VzaGltYS5qcCIsCgkiYWl6dW1pc2F0by5mdWt1c2hpbWEuanAiLAoJImFpenV3YWthbWF0c3UuZnVrdXNoaW1hLmpwIiwKCSJhc2FrYXdhLmZ1a3VzaGltYS5qcCIsCgkiYmFuZGFpLmZ1a3VzaGltYS5qcCIsCgkiZGF0ZS5mdWt1c2hpbWEuanAiLAoJImZ1a3VzaGltYS5mdWt1c2hpbWEuanAiLAoJImZ1cnVkb25vLmZ1a3VzaGltYS5qcCIsCgkiZnV0YWJhLmZ1a3VzaGltYS5qcCIsCgkiaGFuYXdhLmZ1a3VzaGltYS5qcCIsCgkiaGlnYXNoaS5mdWt1c2hpbWEuanAiLAoJImhpcmF0YS5mdWt1c2hpbWEuanAiLAoJImhpcm9uby5mdWt1c2hpbWEuanAiLAoJImlpdGF0ZS5mdWt1c2hpbWEuanAiLAoJImluYXdhc2hpcm8uZnVrdXNoaW1hLmpwIiwKCSJpc2hpa2F3YS5mdWt1c2hpbWEuanAiLAoJIml3YWtpLmZ1a3VzaGltYS5qcCIsCgkiaXp1bWl6YWtpLmZ1a3VzaGltYS5qcCIsCgkia2FnYW1paXNoaS5mdWt1c2hpbWEuanAiLAoJImthbmV5YW1hLmZ1a3VzaGltYS5qcCIsCgkia2F3YW1hdGEuZnVrdXNoaW1hLmpwIiwKCSJraXRha2F0YS5mdWt1c2hpbWEuanAiLAoJImtpdGFzaGlvYmFyYS5mdWt1c2hpbWEuanAiLAoJImtvb3JpLmZ1a3VzaGltYS5qcCIsCgkia29yaXlhbWEuZnVrdXNoaW1hLmpwIiwKCSJrdW5pbWkuZnVrdXNoaW1hLmpwIiwKCSJtaWhhcnUuZnVrdXNoaW1hLmpwIiwKCSJtaXNoaW1hLmZ1a3VzaGltYS5qcCIsCgkibmFtaWUuZnVrdXNoaW1hLmpwIiwKCSJuYW5nby5mdWt1c2hpbWEuanAiLAoJIm5pc2hpYWl6dS5mdWt1c2hpbWEuanAiLAoJIm5pc2hpZ28uZnVrdXNoaW1hLmpwIiwKCSJva3VtYS5mdWt1c2hpbWEuanAiLAoJIm9tb3RlZ28uZnVrdXNoaW1hLmpwIiwKCSJvbm8uZnVrdXNoaW1hLmpwIiwKCSJvdGFtYS5mdWt1c2hpbWEuanAiLAoJInNhbWVnYXdhLmZ1a3VzaGltYS5qcCIsCgkic2hpbW9nby5mdWt1c2hpbWEuanAiLAoJInNoaXJha2F3YS5mdWt1c2hpbWEuanAiLAoJInNob3dhLmZ1a3VzaGltYS5qcCIsCgkic29tYS5mdWt1c2hpbWEuanAiLAoJInN1a2FnYXdhLmZ1a3VzaGltYS5qcCIsCgkidGFpc2hpbi5mdWt1c2hpbWEuanAiLAoJInRhbWFrYXdhLmZ1a3VzaGltYS5qcCIsCgkidGFuYWd1cmEuZnVrdXNoaW1hLmpwIiwKCSJ0ZW5laS5mdWt1c2hpbWEuanAiLAoJInlhYnVraS5mdWt1c2hpbWEuanAiLAoJInlhbWF0by5mdWt1c2hpbWEuanAiLAoJInlhbWF0c3VyaS5mdWt1c2hpbWEuanAiLAoJInlhbmFpenUuZnVrdXNoaW1hLmpwIiwKCSJ5dWdhd2EuZnVrdXNoaW1hLmpwIiwKCSJhbnBhY2hpLmdpZnUuanAiLAoJImVuYS5naWZ1LmpwIiwKCSJnaWZ1LmdpZnUuanAiLAoJImdpbmFuLmdpZnUuanAiLAoJImdvZG8uZ2lmdS5qcCIsCgkiZ3Vqby5naWZ1LmpwIiwKCSJoYXNoaW1hLmdpZnUuanAiLAoJImhpY2hpc28uZ2lmdS5qcCIsCgkiaGlkYS5naWZ1LmpwIiwKCSJoaWdhc2hpc2hpcmFrYXdhLmdpZnUuanAiLAoJImliaWdhd2EuZ2lmdS5qcCIsCgkiaWtlZGEuZ2lmdS5qcCIsCgkia2FrYW1pZ2FoYXJhLmdpZnUuanAiLAoJImthbmkuZ2lmdS5qcCIsCgkia2FzYWhhcmEuZ2lmdS5qcCIsCgkia2FzYW1hdHN1LmdpZnUuanAiLAoJImthd2F1ZS5naWZ1LmpwIiwKCSJraXRhZ2F0YS5naWZ1LmpwIiwKCSJtaW5vLmdpZnUuanAiLAoJIm1pbm9rYW1vLmdpZnUuanAiLAoJIm1pdGFrZS5naWZ1LmpwIiwKCSJtaXp1bmFtaS5naWZ1LmpwIiwKCSJtb3Rvc3UuZ2lmdS5qcCIsCgkibmFrYXRzdWdhd2EuZ2lmdS5qcCIsCgkib2dha2kuZ2lmdS5qcCIsCgkic2FrYWhvZ2kuZ2lmdS5qcCIsCgkic2VraS5naWZ1LmpwIiwKCSJzZWtpZ2FoYXJhLmdpZnUuanAiLAoJInNoaXJha2F3YS5naWZ1LmpwIiwKCSJ0YWppbWkuZ2lmdS5qcCIsCgkidGFrYXlhbWEuZ2lmdS5qcCIsCgkidGFydWkuZ2lmdS5qcCIsCgkidG9raS5naWZ1LmpwIiwKCSJ0b21pa2EuZ2lmdS5qcCIsCgkid2Fub3VjaGkuZ2lmdS5qcCIsCgkieWFtYWdhdGEuZ2lmdS5qcCIsCgkieWFvdHN1LmdpZnUuanAiLAoJInlvcm8uZ2lmdS5qcCIsCgkiYW5uYWthLmd1bm1hLmpwIiwKCSJjaGl5b2RhLmd1bm1hLmpwIiwKCSJmdWppb2thLmd1bm1hLmpwIiwKCSJoaWdhc2hpYWdhdHN1bWEuZ3VubWEuanAiLAoJImlzZXNha2kuZ3VubWEuanAiLAoJIml0YWt1cmEuZ3VubWEuanAiLAoJImthbm5hLmd1bm1hLmpwIiwKCSJrYW5yYS5ndW5tYS5qcCIsCgkia2F0YXNoaW5hLmd1bm1hLmpwIiwKCSJrYXdhYmEuZ3VubWEuanAiLAoJImtpcnl1Lmd1bm1hLmpwIiwKCSJrdXNhdHN1Lmd1bm1hLmpwIiwKCSJtYWViYXNoaS5ndW5tYS5qcCIsCgkibWVpd2EuZ3VubWEuanAiLAoJIm1pZG9yaS5ndW5tYS5qcCIsCgkibWluYWthbWkuZ3VubWEuanAiLAoJIm5hZ2Fub2hhcmEuZ3VubWEuanAiLAoJIm5ha2Fub2pvLmd1bm1hLmpwIiwKCSJuYW5tb2t1Lmd1bm1hLmpwIiwKCSJudW1hdGEuZ3VubWEuanAiLAoJIm9penVtaS5ndW5tYS5qcCIsCgkib3JhLmd1bm1hLmpwIiwKCSJvdGEuZ3VubWEuanAiLAoJInNoaWJ1a2F3YS5ndW5tYS5qcCIsCgkic2hpbW9uaXRhLmd1bm1hLmpwIiwKCSJzaGludG8uZ3VubWEuanAiLAoJInNob3dhLmd1bm1hLmpwIiwKCSJ0YWthc2FraS5ndW5tYS5qcCIsCgkidGFrYXlhbWEuZ3VubWEuanAiLAoJInRhbWFtdXJhLmd1bm1hLmpwIiwKCSJ0YXRlYmF5YXNoaS5ndW5tYS5qcCIsCgkidG9taW9rYS5ndW5tYS5qcCIsCgkidHN1a2l5b25vLmd1bm1hLmpwIiwKCSJ0c3VtYWdvaS5ndW5tYS5qcCIsCgkidWVuby5ndW5tYS5qcCIsCgkieW9zaGlva2EuZ3VubWEuanAiLAoJImFzYW1pbmFtaS5oaXJvc2hpbWEuanAiLAoJImRhaXdhLmhpcm9zaGltYS5qcCIsCgkiZXRhamltYS5oaXJvc2hpbWEuanAiLAoJImZ1Y2h1Lmhpcm9zaGltYS5qcCIsCgkiZnVrdXlhbWEuaGlyb3NoaW1hLmpwIiwKCSJoYXRzdWthaWNoaS5oaXJvc2hpbWEuanAiLAoJImhpZ2FzaGloaXJvc2hpbWEuaGlyb3NoaW1hLmpwIiwKCSJob25nby5oaXJvc2hpbWEuanAiLAoJImppbnNla2lrb2dlbi5oaXJvc2hpbWEuanAiLAoJImthaXRhLmhpcm9zaGltYS5qcCIsCgkia3VpLmhpcm9zaGltYS5qcCIsCgkia3VtYW5vLmhpcm9zaGltYS5qcCIsCgkia3VyZS5oaXJvc2hpbWEuanAiLAoJIm1paGFyYS5oaXJvc2hpbWEuanAiLAoJIm1peW9zaGkuaGlyb3NoaW1hLmpwIiwKCSJuYWthLmhpcm9zaGltYS5qcCIsCgkib25vbWljaGkuaGlyb3NoaW1hLmpwIiwKCSJvc2FraWthbWlqaW1hLmhpcm9zaGltYS5qcCIsCgkib3Rha2UuaGlyb3NoaW1hLmpwIiwKCSJzYWthLmhpcm9zaGltYS5qcCIsCgkic2VyYS5oaXJvc2hpbWEuanAiLAoJInNlcmFuaXNoaS5oaXJvc2hpbWEuanAiLAoJInNoaW5pY2hpLmhpcm9zaGltYS5qcCIsCgkic2hvYmFyYS5oaXJvc2hpbWEuanAiLAoJInRha2VoYXJhLmhpcm9zaGltYS5qcCIsCgkiYWJhc2hpcmkuaG9ra2FpZG8uanAiLAoJImFiaXJhLmhva2thaWRvLmpwIiwKCSJhaWJldHN1Lmhva2thaWRvLmpwIiwKCSJha2FiaXJhLmhva2thaWRvLmpwIiwKCSJha2tlc2hpLmhva2thaWRvLmpwIiwKCSJhc2FoaWthd2EuaG9ra2FpZG8uanAiLAoJImFzaGliZXRzdS5ob2trYWlkby5qcCIsCgkiYXNob3JvLmhva2thaWRvLmpwIiwKCSJhc3NhYnUuaG9ra2FpZG8uanAiLAoJImF0c3VtYS5ob2trYWlkby5qcCIsCgkiYmliYWkuaG9ra2FpZG8uanAiLAoJImJpZWkuaG9ra2FpZG8uanAiLAoJImJpZnVrYS5ob2trYWlkby5qcCIsCgkiYmlob3JvLmhva2thaWRvLmpwIiwKCSJiaXJhdG9yaS5ob2trYWlkby5qcCIsCgkiY2hpcHB1YmV0c3UuaG9ra2FpZG8uanAiLAoJImNoaXRvc2UuaG9ra2FpZG8uanAiLAoJImRhdGUuaG9ra2FpZG8uanAiLAoJImViZXRzdS5ob2trYWlkby5qcCIsCgkiZW1iZXRzdS5ob2trYWlkby5qcCIsCgkiZW5pd2EuaG9ra2FpZG8uanAiLAoJImVyaW1vLmhva2thaWRvLmpwIiwKCSJlc2FuLmhva2thaWRvLmpwIiwKCSJlc2FzaGkuaG9ra2FpZG8uanAiLAoJImZ1a2FnYXdhLmhva2thaWRvLmpwIiwKCSJmdWt1c2hpbWEuaG9ra2FpZG8uanAiLAoJImZ1cmFuby5ob2trYWlkby5qcCIsCgkiZnVydWJpcmEuaG9ra2FpZG8uanAiLAoJImhhYm9yby5ob2trYWlkby5qcCIsCgkiaGFrb2RhdGUuaG9ra2FpZG8uanAiLAoJImhhbWF0b25iZXRzdS5ob2trYWlkby5qcCIsCgkiaGlkYWthLmhva2thaWRvLmpwIiwKCSJoaWdhc2hpa2FndXJhLmhva2thaWRvLmpwIiwKCSJoaWdhc2hpa2F3YS5ob2trYWlkby5qcCIsCgkiaGlyb28uaG9ra2FpZG8uanAiLAoJImhva3VyeXUuaG9ra2FpZG8uanAiLAoJImhva3V0by5ob2trYWlkby5qcCIsCgkiaG9uYmV0c3UuaG9ra2FpZG8uanAiLAoJImhvcm9rYW5haS5ob2trYWlkby5qcCIsCgkiaG9yb25vYmUuaG9ra2FpZG8uanAiLAoJImlrZWRhLmhva2thaWRvLmpwIiwKCSJpbWFrYW5lLmhva2thaWRvLmpwIiwKCSJpc2hpa2FyaS5ob2trYWlkby5qcCIsCgkiaXdhbWl6YXdhLmhva2thaWRvLmpwIiwKCSJpd2FuYWkuaG9ra2FpZG8uanAiLAoJImthbWlmdXJhbm8uaG9ra2FpZG8uanAiLAoJImthbWlrYXdhLmhva2thaWRvLmpwIiwKCSJrYW1pc2hpaG9yby5ob2trYWlkby5qcCIsCgkia2FtaXN1bmFnYXdhLmhva2thaWRvLmpwIiwKCSJrYW1vZW5haS5ob2trYWlkby5qcCIsCgkia2F5YWJlLmhva2thaWRvLmpwIiwKCSJrZW1idWNoaS5ob2trYWlkby5qcCIsCgkia2lrb25haS5ob2trYWlkby5qcCIsCgkia2ltb2JldHN1Lmhva2thaWRvLmpwIiwKCSJraXRhaGlyb3NoaW1hLmhva2thaWRvLmpwIiwKCSJraXRhbWkuaG9ra2FpZG8uanAiLAoJImtpeW9zYXRvLmhva2thaWRvLmpwIiwKCSJrb3NoaW1penUuaG9ra2FpZG8uanAiLAoJImt1bm5lcHB1Lmhva2thaWRvLmpwIiwKCSJrdXJpeWFtYS5ob2trYWlkby5qcCIsCgkia3Vyb21hdHN1bmFpLmhva2thaWRvLmpwIiwKCSJrdXNoaXJvLmhva2thaWRvLmpwIiwKCSJrdXRjaGFuLmhva2thaWRvLmpwIiwKCSJreW93YS5ob2trYWlkby5qcCIsCgkibWFzaGlrZS5ob2trYWlkby5qcCIsCgkibWF0c3VtYWUuaG9ra2FpZG8uanAiLAoJIm1pa2FzYS5ob2trYWlkby5qcCIsCgkibWluYW1pZnVyYW5vLmhva2thaWRvLmpwIiwKCSJtb21iZXRzdS5ob2trYWlkby5qcCIsCgkibW9zZXVzaGkuaG9ra2FpZG8uanAiLAoJIm11a2F3YS5ob2trYWlkby5qcCIsCgkibXVyb3Jhbi5ob2trYWlkby5qcCIsCgkibmFpZS5ob2trYWlkby5qcCIsCgkibmFrYWdhd2EuaG9ra2FpZG8uanAiLAoJIm5ha2FzYXRzdW5haS5ob2trYWlkby5qcCIsCgkibmFrYXRvbWJldHN1Lmhva2thaWRvLmpwIiwKCSJuYW5hZS5ob2trYWlkby5qcCIsCgkibmFucG9yby5ob2trYWlkby5qcCIsCgkibmF5b3JvLmhva2thaWRvLmpwIiwKCSJuZW11cm8uaG9ra2FpZG8uanAiLAoJIm5paWthcHB1Lmhva2thaWRvLmpwIiwKCSJuaWtpLmhva2thaWRvLmpwIiwKCSJuaXNoaW9rb3BwZS5ob2trYWlkby5qcCIsCgkibm9ib3JpYmV0c3UuaG9ra2FpZG8uanAiLAoJIm51bWF0YS5ob2trYWlkby5qcCIsCgkib2JpaGlyby5ob2trYWlkby5qcCIsCgkib2JpcmEuaG9ra2FpZG8uanAiLAoJIm9rZXRvLmhva2thaWRvLmpwIiwKCSJva29wcGUuaG9ra2FpZG8uanAiLAoJIm90YXJ1Lmhva2thaWRvLmpwIiwKCSJvdG9iZS5ob2trYWlkby5qcCIsCgkib3RvZnVrZS5ob2trYWlkby5qcCIsCgkib3RvaW5lcHB1Lmhva2thaWRvLmpwIiwKCSJvdW11Lmhva2thaWRvLmpwIiwKCSJvem9yYS5ob2trYWlkby5qcCIsCgkicGlwcHUuaG9ra2FpZG8uanAiLAoJInJhbmtvc2hpLmhva2thaWRvLmpwIiwKCSJyZWJ1bi5ob2trYWlkby5qcCIsCgkicmlrdWJldHN1Lmhva2thaWRvLmpwIiwKCSJyaXNoaXJpLmhva2thaWRvLmpwIiwKCSJyaXNoaXJpZnVqaS5ob2trYWlkby5qcCIsCgkic2Fyb21hLmhva2thaWRvLmpwIiwKCSJzYXJ1ZnV0c3UuaG9ra2FpZG8uanAiLAoJInNoYWtvdGFuLmhva2thaWRvLmpwIiwKCSJzaGFyaS5ob2trYWlkby5qcCIsCgkic2hpYmVjaGEuaG9ra2FpZG8uanAiLAoJInNoaWJldHN1Lmhva2thaWRvLmpwIiwKCSJzaGlrYWJlLmhva2thaWRvLmpwIiwKCSJzaGlrYW9pLmhva2thaWRvLmpwIiwKCSJzaGltYW1ha2kuaG9ra2FpZG8uanAiLAoJInNoaW1penUuaG9ra2FpZG8uanAiLAoJInNoaW1va2F3YS5ob2trYWlkby5qcCIsCgkic2hpbnNoaW5vdHN1Lmhva2thaWRvLmpwIiwKCSJzaGludG9rdS5ob2trYWlkby5qcCIsCgkic2hpcmFudWthLmhva2thaWRvLmpwIiwKCSJzaGlyYW9pLmhva2thaWRvLmpwIiwKCSJzaGlyaXVjaGkuaG9ra2FpZG8uanAiLAoJInNvYmV0c3UuaG9ra2FpZG8uanAiLAoJInN1bmFnYXdhLmhva2thaWRvLmpwIiwKCSJ0YWlraS5ob2trYWlkby5qcCIsCgkidGFrYXN1Lmhva2thaWRvLmpwIiwKCSJ0YWtpa2F3YS5ob2trYWlkby5qcCIsCgkidGFraW5vdWUuaG9ra2FpZG8uanAiLAoJInRlc2hpa2FnYS5ob2trYWlkby5qcCIsCgkidG9iZXRzdS5ob2trYWlkby5qcCIsCgkidG9obWEuaG9ra2FpZG8uanAiLAoJInRvbWFrb21haS5ob2trYWlkby5qcCIsCgkidG9tYXJpLmhva2thaWRvLmpwIiwKCSJ0b3lhLmhva2thaWRvLmpwIiwKCSJ0b3lha28uaG9ra2FpZG8uanAiLAoJInRveW90b21pLmhva2thaWRvLmpwIiwKCSJ0b3lvdXJhLmhva2thaWRvLmpwIiwKCSJ0c3ViZXRzdS5ob2trYWlkby5qcCIsCgkidHN1a2lnYXRhLmhva2thaWRvLmpwIiwKCSJ1cmFrYXdhLmhva2thaWRvLmpwIiwKCSJ1cmF1c3UuaG9ra2FpZG8uanAiLAoJInVyeXUuaG9ra2FpZG8uanAiLAoJInV0YXNoaW5haS5ob2trYWlkby5qcCIsCgkid2Fra2FuYWkuaG9ra2FpZG8uanAiLAoJIndhc3NhbXUuaG9ra2FpZG8uanAiLAoJInlha3Vtby5ob2trYWlkby5qcCIsCgkieW9pY2hpLmhva2thaWRvLmpwIiwKCSJhaW9pLmh5b2dvLmpwIiwKCSJha2FzaGkuaHlvZ28uanAiLAoJImFrby5oeW9nby5qcCIsCgkiYW1hZ2FzYWtpLmh5b2dvLmpwIiwKCSJhb2dha2kuaHlvZ28uanAiLAoJImFzYWdvLmh5b2dvLmpwIiwKCSJhc2hpeWEuaHlvZ28uanAiLAoJImF3YWppLmh5b2dvLmpwIiwKCSJmdWt1c2FraS5oeW9nby5qcCIsCgkiZ29zaGlraS5oeW9nby5qcCIsCgkiaGFyaW1hLmh5b2dvLmpwIiwKCSJoaW1lamkuaHlvZ28uanAiLAoJImljaGlrYXdhLmh5b2dvLmpwIiwKCSJpbmFnYXdhLmh5b2dvLmpwIiwKCSJpdGFtaS5oeW9nby5qcCIsCgkia2Frb2dhd2EuaHlvZ28uanAiLAoJImthbWlnb3JpLmh5b2dvLmpwIiwKCSJrYW1pa2F3YS5oeW9nby5qcCIsCgkia2FzYWkuaHlvZ28uanAiLAoJImthc3VnYS5oeW9nby5qcCIsCgkia2F3YW5pc2hpLmh5b2dvLmpwIiwKCSJtaWtpLmh5b2dvLmpwIiwKCSJtaW5hbWlhd2FqaS5oeW9nby5qcCIsCgkibmlzaGlub21peWEuaHlvZ28uanAiLAoJIm5pc2hpd2FraS5oeW9nby5qcCIsCgkib25vLmh5b2dvLmpwIiwKCSJzYW5kYS5oeW9nby5qcCIsCgkic2FubmFuLmh5b2dvLmpwIiwKCSJzYXNheWFtYS5oeW9nby5qcCIsCgkic2F5by5oeW9nby5qcCIsCgkic2hpbmd1Lmh5b2dvLmpwIiwKCSJzaGlub25zZW4uaHlvZ28uanAiLAoJInNoaXNvLmh5b2dvLmpwIiwKCSJzdW1vdG8uaHlvZ28uanAiLAoJInRhaXNoaS5oeW9nby5qcCIsCgkidGFrYS5oeW9nby5qcCIsCgkidGFrYXJhenVrYS5oeW9nby5qcCIsCgkidGFrYXNhZ28uaHlvZ28uanAiLAoJInRha2luby5oeW9nby5qcCIsCgkidGFtYmEuaHlvZ28uanAiLAoJInRhdHN1bm8uaHlvZ28uanAiLAoJInRveW9va2EuaHlvZ28uanAiLAoJInlhYnUuaHlvZ28uanAiLAoJInlhc2hpcm8uaHlvZ28uanAiLAoJInlva2EuaHlvZ28uanAiLAoJInlva2F3YS5oeW9nby5qcCIsCgkiYW1pLmliYXJha2kuanAiLAoJImFzYWhpLmliYXJha2kuanAiLAoJImJhbmRvLmliYXJha2kuanAiLAoJImNoaWt1c2VpLmliYXJha2kuanAiLAoJImRhaWdvLmliYXJha2kuanAiLAoJImZ1amlzaGlyby5pYmFyYWtpLmpwIiwKCSJoaXRhY2hpLmliYXJha2kuanAiLAoJImhpdGFjaGluYWthLmliYXJha2kuanAiLAoJImhpdGFjaGlvbWl5YS5pYmFyYWtpLmpwIiwKCSJoaXRhY2hpb3RhLmliYXJha2kuanAiLAoJImliYXJha2kuaWJhcmFraS5qcCIsCgkiaW5hLmliYXJha2kuanAiLAoJImluYXNoaWtpLmliYXJha2kuanAiLAoJIml0YWtvLmliYXJha2kuanAiLAoJIml3YW1hLmliYXJha2kuanAiLAoJImpvc28uaWJhcmFraS5qcCIsCgkia2FtaXN1LmliYXJha2kuanAiLAoJImthc2FtYS5pYmFyYWtpLmpwIiwKCSJrYXNoaW1hLmliYXJha2kuanAiLAoJImthc3VtaWdhdXJhLmliYXJha2kuanAiLAoJImtvZ2EuaWJhcmFraS5qcCIsCgkibWloby5pYmFyYWtpLmpwIiwKCSJtaXRvLmliYXJha2kuanAiLAoJIm1vcml5YS5pYmFyYWtpLmpwIiwKCSJuYWthLmliYXJha2kuanAiLAoJIm5hbWVnYXRhLmliYXJha2kuanAiLAoJIm9hcmFpLmliYXJha2kuanAiLAoJIm9nYXdhLmliYXJha2kuanAiLAoJIm9taXRhbWEuaWJhcmFraS5qcCIsCgkicnl1Z2FzYWtpLmliYXJha2kuanAiLAoJInNha2FpLmliYXJha2kuanAiLAoJInNha3VyYWdhd2EuaWJhcmFraS5qcCIsCgkic2hpbW9kYXRlLmliYXJha2kuanAiLAoJInNoaW1vdHN1bWEuaWJhcmFraS5qcCIsCgkic2hpcm9zYXRvLmliYXJha2kuanAiLAoJInNvd2EuaWJhcmFraS5qcCIsCgkic3VpZnUuaWJhcmFraS5qcCIsCgkidGFrYWhhZ2kuaWJhcmFraS5qcCIsCgkidGFtYXRzdWt1cmkuaWJhcmFraS5qcCIsCgkidG9rYWkuaWJhcmFraS5qcCIsCgkidG9tb2JlLmliYXJha2kuanAiLAoJInRvbmUuaWJhcmFraS5qcCIsCgkidG9yaWRlLmliYXJha2kuanAiLAoJInRzdWNoaXVyYS5pYmFyYWtpLmpwIiwKCSJ0c3VrdWJhLmliYXJha2kuanAiLAoJInVjaGloYXJhLmliYXJha2kuanAiLAoJInVzaGlrdS5pYmFyYWtpLmpwIiwKCSJ5YWNoaXlvLmliYXJha2kuanAiLAoJInlhbWFnYXRhLmliYXJha2kuanAiLAoJInlhd2FyYS5pYmFyYWtpLmpwIiwKCSJ5dWtpLmliYXJha2kuanAiLAoJImFuYW1penUuaXNoaWthd2EuanAiLAoJImhha3VpLmlzaGlrYXdhLmpwIiwKCSJoYWt1c2FuLmlzaGlrYXdhLmpwIiwKCSJrYWdhLmlzaGlrYXdhLmpwIiwKCSJrYWhva3UuaXNoaWthd2EuanAiLAoJImthbmF6YXdhLmlzaGlrYXdhLmpwIiwKCSJrYXdha2l0YS5pc2hpa2F3YS5qcCIsCgkia29tYXRzdS5pc2hpa2F3YS5qcCIsCgkibmFrYW5vdG8uaXNoaWthd2EuanAiLAoJIm5hbmFvLmlzaGlrYXdhLmpwIiwKCSJub21pLmlzaGlrYXdhLmpwIiwKCSJub25vaWNoaS5pc2hpa2F3YS5qcCIsCgkibm90by5pc2hpa2F3YS5qcCIsCgkic2hpa2EuaXNoaWthd2EuanAiLAoJInN1enUuaXNoaWthd2EuanAiLAoJInRzdWJhdGEuaXNoaWthd2EuanAiLAoJInRzdXJ1Z2kuaXNoaWthd2EuanAiLAoJInVjaGluYWRhLmlzaGlrYXdhLmpwIiwKCSJ3YWppbWEuaXNoaWthd2EuanAiLAoJImZ1ZGFpLml3YXRlLmpwIiwKCSJmdWppc2F3YS5pd2F0ZS5qcCIsCgkiaGFuYW1ha2kuaXdhdGUuanAiLAoJImhpcmFpenVtaS5pd2F0ZS5qcCIsCgkiaGlyb25vLml3YXRlLmpwIiwKCSJpY2hpbm9oZS5pd2F0ZS5qcCIsCgkiaWNoaW5vc2VraS5pd2F0ZS5qcCIsCgkiaXdhaXp1bWkuaXdhdGUuanAiLAoJIml3YXRlLml3YXRlLmpwIiwKCSJqb2JvamkuaXdhdGUuanAiLAoJImthbWFpc2hpLml3YXRlLmpwIiwKCSJrYW5lZ2FzYWtpLml3YXRlLmpwIiwKCSJrYXJ1bWFpLml3YXRlLmpwIiwKCSJrYXdhaS5pd2F0ZS5qcCIsCgkia2l0YWthbWkuaXdhdGUuanAiLAoJImt1amkuaXdhdGUuanAiLAoJImt1bm9oZS5pd2F0ZS5qcCIsCgkia3V6dW1ha2kuaXdhdGUuanAiLAoJIm1peWFrby5pd2F0ZS5qcCIsCgkibWl6dXNhd2EuaXdhdGUuanAiLAoJIm1vcmlva2EuaXdhdGUuanAiLAoJIm5pbm9oZS5pd2F0ZS5qcCIsCgkibm9kYS5pd2F0ZS5qcCIsCgkib2Z1bmF0by5pd2F0ZS5qcCIsCgkib3NodS5pd2F0ZS5qcCIsCgkib3RzdWNoaS5pd2F0ZS5qcCIsCgkicmlrdXplbnRha2F0YS5pd2F0ZS5qcCIsCgkic2hpd2EuaXdhdGUuanAiLAoJInNoaXp1a3Vpc2hpLml3YXRlLmpwIiwKCSJzdW1pdGEuaXdhdGUuanAiLAoJInRhbm9oYXRhLml3YXRlLmpwIiwKCSJ0b25vLml3YXRlLmpwIiwKCSJ5YWhhYmEuaXdhdGUuanAiLAoJInlhbWFkYS5pd2F0ZS5qcCIsCgkiYXlhZ2F3YS5rYWdhd2EuanAiLAoJImhpZ2FzaGlrYWdhd2Eua2FnYXdhLmpwIiwKCSJrYW5vbmppLmthZ2F3YS5qcCIsCgkia290b2hpcmEua2FnYXdhLmpwIiwKCSJtYW5uby5rYWdhd2EuanAiLAoJIm1hcnVnYW1lLmthZ2F3YS5qcCIsCgkibWl0b3lvLmthZ2F3YS5qcCIsCgkibmFvc2hpbWEua2FnYXdhLmpwIiwKCSJzYW51a2kua2FnYXdhLmpwIiwKCSJ0YWRvdHN1LmthZ2F3YS5qcCIsCgkidGFrYW1hdHN1LmthZ2F3YS5qcCIsCgkidG9ub3Noby5rYWdhd2EuanAiLAoJInVjaGlub21pLmthZ2F3YS5qcCIsCgkidXRhenUua2FnYXdhLmpwIiwKCSJ6ZW50c3VqaS5rYWdhd2EuanAiLAoJImFrdW5lLmthZ29zaGltYS5qcCIsCgkiYW1hbWkua2Fnb3NoaW1hLmpwIiwKCSJoaW9raS5rYWdvc2hpbWEuanAiLAoJImlzYS5rYWdvc2hpbWEuanAiLAoJImlzZW4ua2Fnb3NoaW1hLmpwIiwKCSJpenVtaS5rYWdvc2hpbWEuanAiLAoJImthZ29zaGltYS5rYWdvc2hpbWEuanAiLAoJImthbm95YS5rYWdvc2hpbWEuanAiLAoJImthd2FuYWJlLmthZ29zaGltYS5qcCIsCgkia2lua28ua2Fnb3NoaW1hLmpwIiwKCSJrb3V5YW1hLmthZ29zaGltYS5qcCIsCgkibWFrdXJhemFraS5rYWdvc2hpbWEuanAiLAoJIm1hdHN1bW90by5rYWdvc2hpbWEuanAiLAoJIm1pbmFtaXRhbmUua2Fnb3NoaW1hLmpwIiwKCSJuYWthdGFuZS5rYWdvc2hpbWEuanAiLAoJIm5pc2hpbm9vbW90ZS5rYWdvc2hpbWEuanAiLAoJInNhdHN1bWFzZW5kYWkua2Fnb3NoaW1hLmpwIiwKCSJzb28ua2Fnb3NoaW1hLmpwIiwKCSJ0YXJ1bWl6dS5rYWdvc2hpbWEuanAiLAoJInl1c3VpLmthZ29zaGltYS5qcCIsCgkiYWlrYXdhLmthbmFnYXdhLmpwIiwKCSJhdHN1Z2kua2FuYWdhd2EuanAiLAoJImF5YXNlLmthbmFnYXdhLmpwIiwKCSJjaGlnYXNha2kua2FuYWdhd2EuanAiLAoJImViaW5hLmthbmFnYXdhLmpwIiwKCSJmdWppc2F3YS5rYW5hZ2F3YS5qcCIsCgkiaGFkYW5vLmthbmFnYXdhLmpwIiwKCSJoYWtvbmUua2FuYWdhd2EuanAiLAoJImhpcmF0c3VrYS5rYW5hZ2F3YS5qcCIsCgkiaXNlaGFyYS5rYW5hZ2F3YS5qcCIsCgkia2Fpc2VpLmthbmFnYXdhLmpwIiwKCSJrYW1ha3VyYS5rYW5hZ2F3YS5qcCIsCgkia2l5b2thd2Eua2FuYWdhd2EuanAiLAoJIm1hdHN1ZGEua2FuYWdhd2EuanAiLAoJIm1pbmFtaWFzaGlnYXJhLmthbmFnYXdhLmpwIiwKCSJtaXVyYS5rYW5hZ2F3YS5qcCIsCgkibmFrYWkua2FuYWdhd2EuanAiLAoJIm5pbm9taXlhLmthbmFnYXdhLmpwIiwKCSJvZGF3YXJhLmthbmFnYXdhLmpwIiwKCSJvaS5rYW5hZ2F3YS5qcCIsCgkib2lzby5rYW5hZ2F3YS5qcCIsCgkic2FnYW1paGFyYS5rYW5hZ2F3YS5qcCIsCgkic2FtdWthd2Eua2FuYWdhd2EuanAiLAoJInRzdWt1aS5rYW5hZ2F3YS5qcCIsCgkieWFtYWtpdGEua2FuYWdhd2EuanAiLAoJInlhbWF0by5rYW5hZ2F3YS5qcCIsCgkieW9rb3N1a2Eua2FuYWdhd2EuanAiLAoJInl1Z2F3YXJhLmthbmFnYXdhLmpwIiwKCSJ6YW1hLmthbmFnYXdhLmpwIiwKCSJ6dXNoaS5rYW5hZ2F3YS5qcCIsCgkiYWtpLmtvY2hpLmpwIiwKCSJnZWlzZWkua29jaGkuanAiLAoJImhpZGFrYS5rb2NoaS5qcCIsCgkiaGlnYXNoaXRzdW5vLmtvY2hpLmpwIiwKCSJpbm8ua29jaGkuanAiLAoJImthZ2FtaS5rb2NoaS5qcCIsCgkia2FtaS5rb2NoaS5qcCIsCgkia2l0YWdhd2Eua29jaGkuanAiLAoJImtvY2hpLmtvY2hpLmpwIiwKCSJtaWhhcmEua29jaGkuanAiLAoJIm1vdG95YW1hLmtvY2hpLmpwIiwKCSJtdXJvdG8ua29jaGkuanAiLAoJIm5haGFyaS5rb2NoaS5qcCIsCgkibmFrYW11cmEua29jaGkuanAiLAoJIm5hbmtva3Uua29jaGkuanAiLAoJIm5pc2hpdG9zYS5rb2NoaS5qcCIsCgkibml5b2RvZ2F3YS5rb2NoaS5qcCIsCgkib2NoaS5rb2NoaS5qcCIsCgkib2thd2Eua29jaGkuanAiLAoJIm90b3lvLmtvY2hpLmpwIiwKCSJvdHN1a2kua29jaGkuanAiLAoJInNha2F3YS5rb2NoaS5qcCIsCgkic3VrdW1vLmtvY2hpLmpwIiwKCSJzdXNha2kua29jaGkuanAiLAoJInRvc2Eua29jaGkuanAiLAoJInRvc2FzaGltaXp1LmtvY2hpLmpwIiwKCSJ0b3lvLmtvY2hpLmpwIiwKCSJ0c3Vuby5rb2NoaS5qcCIsCgkidW1hamkua29jaGkuanAiLAoJInlhc3VkYS5rb2NoaS5qcCIsCgkieXVzdWhhcmEua29jaGkuanAiLAoJImFtYWt1c2Eua3VtYW1vdG8uanAiLAoJImFyYW8ua3VtYW1vdG8uanAiLAoJImFzby5rdW1hbW90by5qcCIsCgkiY2hveW8ua3VtYW1vdG8uanAiLAoJImd5b2t1dG8ua3VtYW1vdG8uanAiLAoJImthbWlhbWFrdXNhLmt1bWFtb3RvLmpwIiwKCSJraWt1Y2hpLmt1bWFtb3RvLmpwIiwKCSJrdW1hbW90by5rdW1hbW90by5qcCIsCgkibWFzaGlraS5rdW1hbW90by5qcCIsCgkibWlmdW5lLmt1bWFtb3RvLmpwIiwKCSJtaW5hbWF0YS5rdW1hbW90by5qcCIsCgkibWluYW1pb2d1bmkua3VtYW1vdG8uanAiLAoJIm5hZ2FzdS5rdW1hbW90by5qcCIsCgkibmlzaGloYXJhLmt1bWFtb3RvLmpwIiwKCSJvZ3VuaS5rdW1hbW90by5qcCIsCgkib3p1Lmt1bWFtb3RvLmpwIiwKCSJzdW1vdG8ua3VtYW1vdG8uanAiLAoJInRha2Ftb3JpLmt1bWFtb3RvLmpwIiwKCSJ1a2kua3VtYW1vdG8uanAiLAoJInV0by5rdW1hbW90by5qcCIsCgkieWFtYWdhLmt1bWFtb3RvLmpwIiwKCSJ5YW1hdG8ua3VtYW1vdG8uanAiLAoJInlhdHN1c2hpcm8ua3VtYW1vdG8uanAiLAoJImF5YWJlLmt5b3RvLmpwIiwKCSJmdWt1Y2hpeWFtYS5reW90by5qcCIsCgkiaGlnYXNoaXlhbWEua3lvdG8uanAiLAoJImlkZS5reW90by5qcCIsCgkiaW5lLmt5b3RvLmpwIiwKCSJqb3lvLmt5b3RvLmpwIiwKCSJrYW1lb2thLmt5b3RvLmpwIiwKCSJrYW1vLmt5b3RvLmpwIiwKCSJraXRhLmt5b3RvLmpwIiwKCSJraXp1Lmt5b3RvLmpwIiwKCSJrdW1peWFtYS5reW90by5qcCIsCgkia3lvdGFtYmEua3lvdG8uanAiLAoJImt5b3RhbmFiZS5reW90by5qcCIsCgkia3lvdGFuZ28ua3lvdG8uanAiLAoJIm1haXp1cnUua3lvdG8uanAiLAoJIm1pbmFtaS5reW90by5qcCIsCgkibWluYW1peWFtYXNoaXJvLmt5b3RvLmpwIiwKCSJtaXlhenUua3lvdG8uanAiLAoJIm11a28ua3lvdG8uanAiLAoJIm5hZ2Fva2FreW8ua3lvdG8uanAiLAoJIm5ha2FneW8ua3lvdG8uanAiLAoJIm5hbnRhbi5reW90by5qcCIsCgkib3lhbWF6YWtpLmt5b3RvLmpwIiwKCSJzYWt5by5reW90by5qcCIsCgkic2Vpa2Eua3lvdG8uanAiLAoJInRhbmFiZS5reW90by5qcCIsCgkidWppLmt5b3RvLmpwIiwKCSJ1aml0YXdhcmEua3lvdG8uanAiLAoJIndhenVrYS5reW90by5qcCIsCgkieWFtYXNoaW5hLmt5b3RvLmpwIiwKCSJ5YXdhdGEua3lvdG8uanAiLAoJImFzYWhpLm1pZS5qcCIsCgkiaW5hYmUubWllLmpwIiwKCSJpc2UubWllLmpwIiwKCSJrYW1leWFtYS5taWUuanAiLAoJImthd2Fnb2UubWllLmpwIiwKCSJraWhvLm1pZS5qcCIsCgkia2lzb3Nha2kubWllLmpwIiwKCSJraXdhLm1pZS5qcCIsCgkia29tb25vLm1pZS5qcCIsCgkia3VtYW5vLm1pZS5qcCIsCgkia3V3YW5hLm1pZS5qcCIsCgkibWF0c3VzYWthLm1pZS5qcCIsCgkibWVpd2EubWllLmpwIiwKCSJtaWhhbWEubWllLmpwIiwKCSJtaW5hbWlpc2UubWllLmpwIiwKCSJtaXN1Z2kubWllLmpwIiwKCSJtaXlhbWEubWllLmpwIiwKCSJuYWJhcmkubWllLmpwIiwKCSJzaGltYS5taWUuanAiLAoJInN1enVrYS5taWUuanAiLAoJInRhZG8ubWllLmpwIiwKCSJ0YWlraS5taWUuanAiLAoJInRha2kubWllLmpwIiwKCSJ0YW1ha2kubWllLmpwIiwKCSJ0b2JhLm1pZS5qcCIsCgkidHN1Lm1pZS5qcCIsCgkidWRvbm8ubWllLmpwIiwKCSJ1cmVzaGluby5taWUuanAiLAoJIndhdGFyYWkubWllLmpwIiwKCSJ5b2trYWljaGkubWllLmpwIiwKCSJmdXJ1a2F3YS5taXlhZ2kuanAiLAoJImhpZ2FzaGltYXRzdXNoaW1hLm1peWFnaS5qcCIsCgkiaXNoaW5vbWFraS5taXlhZ2kuanAiLAoJIml3YW51bWEubWl5YWdpLmpwIiwKCSJrYWt1ZGEubWl5YWdpLmpwIiwKCSJrYW1pLm1peWFnaS5qcCIsCgkia2F3YXNha2kubWl5YWdpLmpwIiwKCSJtYXJ1bW9yaS5taXlhZ2kuanAiLAoJIm1hdHN1c2hpbWEubWl5YWdpLmpwIiwKCSJtaW5hbWlzYW5yaWt1Lm1peWFnaS5qcCIsCgkibWlzYXRvLm1peWFnaS5qcCIsCgkibXVyYXRhLm1peWFnaS5qcCIsCgkibmF0b3JpLm1peWFnaS5qcCIsCgkib2dhd2FyYS5taXlhZ2kuanAiLAoJIm9oaXJhLm1peWFnaS5qcCIsCgkib25hZ2F3YS5taXlhZ2kuanAiLAoJIm9zYWtpLm1peWFnaS5qcCIsCgkicmlmdS5taXlhZ2kuanAiLAoJInNlbWluZS5taXlhZ2kuanAiLAoJInNoaWJhdGEubWl5YWdpLmpwIiwKCSJzaGljaGlrYXNodWt1Lm1peWFnaS5qcCIsCgkic2hpa2FtYS5taXlhZ2kuanAiLAoJInNoaW9nYW1hLm1peWFnaS5qcCIsCgkic2hpcm9pc2hpLm1peWFnaS5qcCIsCgkidGFnYWpvLm1peWFnaS5qcCIsCgkidGFpd2EubWl5YWdpLmpwIiwKCSJ0b21lLm1peWFnaS5qcCIsCgkidG9taXlhLm1peWFnaS5qcCIsCgkid2FrdXlhLm1peWFnaS5qcCIsCgkid2F0YXJpLm1peWFnaS5qcCIsCgkieWFtYW1vdG8ubWl5YWdpLmpwIiwKCSJ6YW8ubWl5YWdpLmpwIiwKCSJheWEubWl5YXpha2kuanAiLAoJImViaW5vLm1peWF6YWtpLmpwIiwKCSJnb2thc2UubWl5YXpha2kuanAiLAoJImh5dWdhLm1peWF6YWtpLmpwIiwKCSJrYWRvZ2F3YS5taXlhemFraS5qcCIsCgkia2F3YW1pbmFtaS5taXlhemFraS5qcCIsCgkia2lqby5taXlhemFraS5qcCIsCgkia2l0YWdhd2EubWl5YXpha2kuanAiLAoJImtpdGFrYXRhLm1peWF6YWtpLmpwIiwKCSJraXRhdXJhLm1peWF6YWtpLmpwIiwKCSJrb2JheWFzaGkubWl5YXpha2kuanAiLAoJImt1bml0b21pLm1peWF6YWtpLmpwIiwKCSJrdXNoaW1hLm1peWF6YWtpLmpwIiwKCSJtaW1hdGEubWl5YXpha2kuanAiLAoJIm1peWFrb25vam8ubWl5YXpha2kuanAiLAoJIm1peWF6YWtpLm1peWF6YWtpLmpwIiwKCSJtb3JvdHN1a2EubWl5YXpha2kuanAiLAoJIm5pY2hpbmFuLm1peWF6YWtpLmpwIiwKCSJuaXNoaW1lcmEubWl5YXpha2kuanAiLAoJIm5vYmVva2EubWl5YXpha2kuanAiLAoJInNhaXRvLm1peWF6YWtpLmpwIiwKCSJzaGlpYmEubWl5YXpha2kuanAiLAoJInNoaW50b21pLm1peWF6YWtpLmpwIiwKCSJ0YWthaGFydS5taXlhemFraS5qcCIsCgkidGFrYW5hYmUubWl5YXpha2kuanAiLAoJInRha2F6YWtpLm1peWF6YWtpLmpwIiwKCSJ0c3Vuby5taXlhemFraS5qcCIsCgkiYWNoaS5uYWdhbm8uanAiLAoJImFnZW1hdHN1Lm5hZ2Fuby5qcCIsCgkiYW5hbi5uYWdhbm8uanAiLAoJImFva2kubmFnYW5vLmpwIiwKCSJhc2FoaS5uYWdhbm8uanAiLAoJImF6dW1pbm8ubmFnYW5vLmpwIiwKCSJjaGlrdWhva3UubmFnYW5vLmpwIiwKCSJjaGlrdW1hLm5hZ2Fuby5qcCIsCgkiY2hpbm8ubmFnYW5vLmpwIiwKCSJmdWppbWkubmFnYW5vLmpwIiwKCSJoYWt1YmEubmFnYW5vLmpwIiwKCSJoYXJhLm5hZ2Fuby5qcCIsCgkiaGlyYXlhLm5hZ2Fuby5qcCIsCgkiaWlkYS5uYWdhbm8uanAiLAoJImlpamltYS5uYWdhbm8uanAiLAoJImlpeWFtYS5uYWdhbm8uanAiLAoJImlpenVuYS5uYWdhbm8uanAiLAoJImlrZWRhLm5hZ2Fuby5qcCIsCgkiaWt1c2FrYS5uYWdhbm8uanAiLAoJImluYS5uYWdhbm8uanAiLAoJImthcnVpemF3YS5uYWdhbm8uanAiLAoJImthd2FrYW1pLm5hZ2Fuby5qcCIsCgkia2lzby5uYWdhbm8uanAiLAoJImtpc29mdWt1c2hpbWEubmFnYW5vLmpwIiwKCSJraXRhYWlraS5uYWdhbm8uanAiLAoJImtvbWFnYW5lLm5hZ2Fuby5qcCIsCgkia29tb3JvLm5hZ2Fuby5qcCIsCgkibWF0c3VrYXdhLm5hZ2Fuby5qcCIsCgkibWF0c3Vtb3RvLm5hZ2Fuby5qcCIsCgkibWlhc2EubmFnYW5vLmpwIiwKCSJtaW5hbWlhaWtpLm5hZ2Fuby5qcCIsCgkibWluYW1pbWFraS5uYWdhbm8uanAiLAoJIm1pbmFtaW1pbm93YS5uYWdhbm8uanAiLAoJIm1pbm93YS5uYWdhbm8uanAiLAoJIm1peWFkYS5uYWdhbm8uanAiLAoJIm1peW90YS5uYWdhbm8uanAiLAoJIm1vY2hpenVraS5uYWdhbm8uanAiLAoJIm5hZ2Fuby5uYWdhbm8uanAiLAoJIm5hZ2F3YS5uYWdhbm8uanAiLAoJIm5hZ2lzby5uYWdhbm8uanAiLAoJIm5ha2FnYXdhLm5hZ2Fuby5qcCIsCgkibmFrYW5vLm5hZ2Fuby5qcCIsCgkibm96YXdhb25zZW4ubmFnYW5vLmpwIiwKCSJvYnVzZS5uYWdhbm8uanAiLAoJIm9nYXdhLm5hZ2Fuby5qcCIsCgkib2theWEubmFnYW5vLmpwIiwKCSJvbWFjaGkubmFnYW5vLmpwIiwKCSJvbWkubmFnYW5vLmpwIiwKCSJvb2t1d2EubmFnYW5vLmpwIiwKCSJvb3NoaWthLm5hZ2Fuby5qcCIsCgkib3Rha2kubmFnYW5vLmpwIiwKCSJvdGFyaS5uYWdhbm8uanAiLAoJInNha2FlLm5hZ2Fuby5qcCIsCgkic2FrYWtpLm5hZ2Fuby5qcCIsCgkic2FrdS5uYWdhbm8uanAiLAoJInNha3Voby5uYWdhbm8uanAiLAoJInNoaW1vc3V3YS5uYWdhbm8uanAiLAoJInNoaW5hbm9tYWNoaS5uYWdhbm8uanAiLAoJInNoaW9qaXJpLm5hZ2Fuby5qcCIsCgkic3V3YS5uYWdhbm8uanAiLAoJInN1emFrYS5uYWdhbm8uanAiLAoJInRha2FnaS5uYWdhbm8uanAiLAoJInRha2Ftb3JpLm5hZ2Fuby5qcCIsCgkidGFrYXlhbWEubmFnYW5vLmpwIiwKCSJ0YXRlc2hpbmEubmFnYW5vLmpwIiwKCSJ0YXRzdW5vLm5hZ2Fuby5qcCIsCgkidG9nYWt1c2hpLm5hZ2Fuby5qcCIsCgkidG9ndXJhLm5hZ2Fuby5qcCIsCgkidG9taS5uYWdhbm8uanAiLAoJInVlZGEubmFnYW5vLmpwIiwKCSJ3YWRhLm5hZ2Fuby5qcCIsCgkieWFtYWdhdGEubmFnYW5vLmpwIiwKCSJ5YW1hbm91Y2hpLm5hZ2Fuby5qcCIsCgkieWFzYWthLm5hZ2Fuby5qcCIsCgkieWFzdW9rYS5uYWdhbm8uanAiLAoJImNoaWppd2EubmFnYXNha2kuanAiLAoJImZ1dHN1Lm5hZ2FzYWtpLmpwIiwKCSJnb3RvLm5hZ2FzYWtpLmpwIiwKCSJoYXNhbWkubmFnYXNha2kuanAiLAoJImhpcmFkby5uYWdhc2FraS5qcCIsCgkiaWtpLm5hZ2FzYWtpLmpwIiwKCSJpc2FoYXlhLm5hZ2FzYWtpLmpwIiwKCSJrYXdhdGFuYS5uYWdhc2FraS5qcCIsCgkia3VjaGlub3RzdS5uYWdhc2FraS5qcCIsCgkibWF0c3V1cmEubmFnYXNha2kuanAiLAoJIm5hZ2FzYWtpLm5hZ2FzYWtpLmpwIiwKCSJvYmFtYS5uYWdhc2FraS5qcCIsCgkib211cmEubmFnYXNha2kuanAiLAoJIm9zZXRvLm5hZ2FzYWtpLmpwIiwKCSJzYWlrYWkubmFnYXNha2kuanAiLAoJInNhc2Viby5uYWdhc2FraS5qcCIsCgkic2VpaGkubmFnYXNha2kuanAiLAoJInNoaW1hYmFyYS5uYWdhc2FraS5qcCIsCgkic2hpbmthbWlnb3RvLm5hZ2FzYWtpLmpwIiwKCSJ0b2dpdHN1Lm5hZ2FzYWtpLmpwIiwKCSJ0c3VzaGltYS5uYWdhc2FraS5qcCIsCgkidW56ZW4ubmFnYXNha2kuanAiLAoJImFuZG8ubmFyYS5qcCIsCgkiZ29zZS5uYXJhLmpwIiwKCSJoZWd1cmkubmFyYS5qcCIsCgkiaGlnYXNoaXlvc2hpbm8ubmFyYS5qcCIsCgkiaWthcnVnYS5uYXJhLmpwIiwKCSJpa29tYS5uYXJhLmpwIiwKCSJrYW1pa2l0YXlhbWEubmFyYS5qcCIsCgkia2FubWFraS5uYXJhLmpwIiwKCSJrYXNoaWJhLm5hcmEuanAiLAoJImthc2hpaGFyYS5uYXJhLmpwIiwKCSJrYXRzdXJhZ2kubmFyYS5qcCIsCgkia2F3YWkubmFyYS5qcCIsCgkia2F3YWthbWkubmFyYS5qcCIsCgkia2F3YW5pc2hpLm5hcmEuanAiLAoJImtvcnlvLm5hcmEuanAiLAoJImt1cm90YWtpLm5hcmEuanAiLAoJIm1pdHN1ZS5uYXJhLmpwIiwKCSJtaXlha2UubmFyYS5qcCIsCgkibmFyYS5uYXJhLmpwIiwKCSJub3NlZ2F3YS5uYXJhLmpwIiwKCSJvamkubmFyYS5qcCIsCgkib3VkYS5uYXJhLmpwIiwKCSJveW9kby5uYXJhLmpwIiwKCSJzYWt1cmFpLm5hcmEuanAiLAoJInNhbmdvLm5hcmEuanAiLAoJInNoaW1vaWNoaS5uYXJhLmpwIiwKCSJzaGltb2tpdGF5YW1hLm5hcmEuanAiLAoJInNoaW5qby5uYXJhLmpwIiwKCSJzb25pLm5hcmEuanAiLAoJInRha2F0b3JpLm5hcmEuanAiLAoJInRhd2FyYW1vdG8ubmFyYS5qcCIsCgkidGVua2F3YS5uYXJhLmpwIiwKCSJ0ZW5yaS5uYXJhLmpwIiwKCSJ1ZGEubmFyYS5qcCIsCgkieWFtYXRva29yaXlhbWEubmFyYS5qcCIsCgkieWFtYXRvdGFrYWRhLm5hcmEuanAiLAoJInlhbWF6b2UubmFyYS5qcCIsCgkieW9zaGluby5uYXJhLmpwIiwKCSJhZ2EubmlpZ2F0YS5qcCIsCgkiYWdhbm8ubmlpZ2F0YS5qcCIsCgkiZ29zZW4ubmlpZ2F0YS5qcCIsCgkiaXRvaWdhd2EubmlpZ2F0YS5qcCIsCgkiaXp1bW96YWtpLm5paWdhdGEuanAiLAoJImpvZXRzdS5uaWlnYXRhLmpwIiwKCSJrYW1vLm5paWdhdGEuanAiLAoJImthcml3YS5uaWlnYXRhLmpwIiwKCSJrYXNoaXdhemFraS5uaWlnYXRhLmpwIiwKCSJtaW5hbWl1b251bWEubmlpZ2F0YS5qcCIsCgkibWl0c3VrZS5uaWlnYXRhLmpwIiwKCSJtdWlrYS5uaWlnYXRhLmpwIiwKCSJtdXJha2FtaS5uaWlnYXRhLmpwIiwKCSJteW9rby5uaWlnYXRhLmpwIiwKCSJuYWdhb2thLm5paWdhdGEuanAiLAoJIm5paWdhdGEubmlpZ2F0YS5qcCIsCgkib2ppeWEubmlpZ2F0YS5qcCIsCgkib21pLm5paWdhdGEuanAiLAoJInNhZG8ubmlpZ2F0YS5qcCIsCgkic2Fuam8ubmlpZ2F0YS5qcCIsCgkic2Vpcm8ubmlpZ2F0YS5qcCIsCgkic2Vpcm91Lm5paWdhdGEuanAiLAoJInNla2lrYXdhLm5paWdhdGEuanAiLAoJInNoaWJhdGEubmlpZ2F0YS5qcCIsCgkidGFnYW1pLm5paWdhdGEuanAiLAoJInRhaW5haS5uaWlnYXRhLmpwIiwKCSJ0b2NoaW8ubmlpZ2F0YS5qcCIsCgkidG9rYW1hY2hpLm5paWdhdGEuanAiLAoJInRzdWJhbWUubmlpZ2F0YS5qcCIsCgkidHN1bmFuLm5paWdhdGEuanAiLAoJInVvbnVtYS5uaWlnYXRhLmpwIiwKCSJ5YWhpa28ubmlpZ2F0YS5qcCIsCgkieW9pdGEubmlpZ2F0YS5qcCIsCgkieXV6YXdhLm5paWdhdGEuanAiLAoJImJlcHB1Lm9pdGEuanAiLAoJImJ1bmdvb25vLm9pdGEuanAiLAoJImJ1bmdvdGFrYWRhLm9pdGEuanAiLAoJImhhc2FtYS5vaXRhLmpwIiwKCSJoaWppLm9pdGEuanAiLAoJImhpbWVzaGltYS5vaXRhLmpwIiwKCSJoaXRhLm9pdGEuanAiLAoJImthbWl0c3VlLm9pdGEuanAiLAoJImtva29ub2Uub2l0YS5qcCIsCgkia3VqdS5vaXRhLmpwIiwKCSJrdW5pc2FraS5vaXRhLmpwIiwKCSJrdXN1Lm9pdGEuanAiLAoJIm9pdGEub2l0YS5qcCIsCgkic2Fpa2kub2l0YS5qcCIsCgkidGFrZXRhLm9pdGEuanAiLAoJInRzdWt1bWkub2l0YS5qcCIsCgkidXNhLm9pdGEuanAiLAoJInVzdWtpLm9pdGEuanAiLAoJInl1ZnUub2l0YS5qcCIsCgkiYWthaXdhLm9rYXlhbWEuanAiLAoJImFzYWt1Y2hpLm9rYXlhbWEuanAiLAoJImJpemVuLm9rYXlhbWEuanAiLAoJImhheWFzaGltYS5va2F5YW1hLmpwIiwKCSJpYmFyYS5va2F5YW1hLmpwIiwKCSJrYWdhbWluby5va2F5YW1hLmpwIiwKCSJrYXNhb2thLm9rYXlhbWEuanAiLAoJImtpYmljaHVvLm9rYXlhbWEuanAiLAoJImt1bWVuYW4ub2theWFtYS5qcCIsCgkia3VyYXNoaWtpLm9rYXlhbWEuanAiLAoJIm1hbml3YS5va2F5YW1hLmpwIiwKCSJtaXNha2kub2theWFtYS5qcCIsCgkibmFnaS5va2F5YW1hLmpwIiwKCSJuaWltaS5va2F5YW1hLmpwIiwKCSJuaXNoaWF3YWt1cmEub2theWFtYS5qcCIsCgkib2theWFtYS5va2F5YW1hLmpwIiwKCSJzYXRvc2hvLm9rYXlhbWEuanAiLAoJInNldG91Y2hpLm9rYXlhbWEuanAiLAoJInNoaW5qby5va2F5YW1hLmpwIiwKCSJzaG9vLm9rYXlhbWEuanAiLAoJInNvamEub2theWFtYS5qcCIsCgkidGFrYWhhc2hpLm9rYXlhbWEuanAiLAoJInRhbWFuby5va2F5YW1hLmpwIiwKCSJ0c3V5YW1hLm9rYXlhbWEuanAiLAoJIndha2Uub2theWFtYS5qcCIsCgkieWFrYWdlLm9rYXlhbWEuanAiLAoJImFndW5pLm9raW5hd2EuanAiLAoJImdpbm93YW4ub2tpbmF3YS5qcCIsCgkiZ2lub3phLm9raW5hd2EuanAiLAoJImd1c2hpa2FtaS5va2luYXdhLmpwIiwKCSJoYWViYXJ1Lm9raW5hd2EuanAiLAoJImhpZ2FzaGkub2tpbmF3YS5qcCIsCgkiaGlyYXJhLm9raW5hd2EuanAiLAoJImloZXlhLm9raW5hd2EuanAiLAoJImlzaGlnYWtpLm9raW5hd2EuanAiLAoJImlzaGlrYXdhLm9raW5hd2EuanAiLAoJIml0b21hbi5va2luYXdhLmpwIiwKCSJpemVuYS5va2luYXdhLmpwIiwKCSJrYWRlbmEub2tpbmF3YS5qcCIsCgkia2luLm9raW5hd2EuanAiLAoJImtpdGFkYWl0by5va2luYXdhLmpwIiwKCSJraXRhbmFrYWd1c3VrdS5va2luYXdhLmpwIiwKCSJrdW1lamltYS5va2luYXdhLmpwIiwKCSJrdW5pZ2FtaS5va2luYXdhLmpwIiwKCSJtaW5hbWlkYWl0by5va2luYXdhLmpwIiwKCSJtb3RvYnUub2tpbmF3YS5qcCIsCgkibmFnby5va2luYXdhLmpwIiwKCSJuYWhhLm9raW5hd2EuanAiLAoJIm5ha2FndXN1a3Uub2tpbmF3YS5qcCIsCgkibmFraWppbi5va2luYXdhLmpwIiwKCSJuYW5qby5va2luYXdhLmpwIiwKCSJuaXNoaWhhcmEub2tpbmF3YS5qcCIsCgkib2dpbWkub2tpbmF3YS5qcCIsCgkib2tpbmF3YS5va2luYXdhLmpwIiwKCSJvbm5hLm9raW5hd2EuanAiLAoJInNoaW1vamkub2tpbmF3YS5qcCIsCgkidGFrZXRvbWkub2tpbmF3YS5qcCIsCgkidGFyYW1hLm9raW5hd2EuanAiLAoJInRva2FzaGlraS5va2luYXdhLmpwIiwKCSJ0b21pZ3VzdWt1Lm9raW5hd2EuanAiLAoJInRvbmFraS5va2luYXdhLmpwIiwKCSJ1cmFzb2Uub2tpbmF3YS5qcCIsCgkidXJ1bWEub2tpbmF3YS5qcCIsCgkieWFlc2Uub2tpbmF3YS5qcCIsCgkieW9taXRhbi5va2luYXdhLmpwIiwKCSJ5b25hYmFydS5va2luYXdhLmpwIiwKCSJ5b25hZ3VuaS5va2luYXdhLmpwIiwKCSJ6YW1hbWkub2tpbmF3YS5qcCIsCgkiYWJlbm8ub3Nha2EuanAiLAoJImNoaWhheWFha2FzYWthLm9zYWthLmpwIiwKCSJjaHVvLm9zYWthLmpwIiwKCSJkYWl0by5vc2FrYS5qcCIsCgkiZnVqaWlkZXJhLm9zYWthLmpwIiwKCSJoYWJpa2luby5vc2FrYS5qcCIsCgkiaGFubmFuLm9zYWthLmpwIiwKCSJoaWdhc2hpb3Nha2Eub3Nha2EuanAiLAoJImhpZ2FzaGlzdW1peW9zaGkub3Nha2EuanAiLAoJImhpZ2FzaGl5b2RvZ2F3YS5vc2FrYS5qcCIsCgkiaGlyYWthdGEub3Nha2EuanAiLAoJImliYXJha2kub3Nha2EuanAiLAoJImlrZWRhLm9zYWthLmpwIiwKCSJpenVtaS5vc2FrYS5qcCIsCgkiaXp1bWlvdHN1Lm9zYWthLmpwIiwKCSJpenVtaXNhbm8ub3Nha2EuanAiLAoJImthZG9tYS5vc2FrYS5qcCIsCgkia2FpenVrYS5vc2FrYS5qcCIsCgkia2FuYW4ub3Nha2EuanAiLAoJImthc2hpd2FyYS5vc2FrYS5qcCIsCgkia2F0YW5vLm9zYWthLmpwIiwKCSJrYXdhY2hpbmFnYW5vLm9zYWthLmpwIiwKCSJraXNoaXdhZGEub3Nha2EuanAiLAoJImtpdGEub3Nha2EuanAiLAoJImt1bWF0b3JpLm9zYWthLmpwIiwKCSJtYXRzdWJhcmEub3Nha2EuanAiLAoJIm1pbmF0by5vc2FrYS5qcCIsCgkibWlub2gub3Nha2EuanAiLAoJIm1pc2FraS5vc2FrYS5qcCIsCgkibW9yaWd1Y2hpLm9zYWthLmpwIiwKCSJuZXlhZ2F3YS5vc2FrYS5qcCIsCgkibmlzaGkub3Nha2EuanAiLAoJIm5vc2Uub3Nha2EuanAiLAoJIm9zYWthc2F5YW1hLm9zYWthLmpwIiwKCSJzYWthaS5vc2FrYS5qcCIsCgkic2F5YW1hLm9zYWthLmpwIiwKCSJzZW5uYW4ub3Nha2EuanAiLAoJInNldHRzdS5vc2FrYS5qcCIsCgkic2hpam9uYXdhdGUub3Nha2EuanAiLAoJInNoaW1hbW90by5vc2FrYS5qcCIsCgkic3VpdGEub3Nha2EuanAiLAoJInRhZGFva2Eub3Nha2EuanAiLAoJInRhaXNoaS5vc2FrYS5qcCIsCgkidGFqaXJpLm9zYWthLmpwIiwKCSJ0YWthaXNoaS5vc2FrYS5qcCIsCgkidGFrYXRzdWtpLm9zYWthLmpwIiwKCSJ0b25kYWJheWFzaGkub3Nha2EuanAiLAoJInRveW9uYWthLm9zYWthLmpwIiwKCSJ0b3lvbm8ub3Nha2EuanAiLAoJInlhby5vc2FrYS5qcCIsCgkiYXJpYWtlLnNhZ2EuanAiLAoJImFyaXRhLnNhZ2EuanAiLAoJImZ1a3Vkb21pLnNhZ2EuanAiLAoJImdlbmthaS5zYWdhLmpwIiwKCSJoYW1hdGFtYS5zYWdhLmpwIiwKCSJoaXplbi5zYWdhLmpwIiwKCSJpbWFyaS5zYWdhLmpwIiwKCSJrYW1pbWluZS5zYWdhLmpwIiwKCSJrYW56YWtpLnNhZ2EuanAiLAoJImthcmF0c3Uuc2FnYS5qcCIsCgkia2FzaGltYS5zYWdhLmpwIiwKCSJraXRhZ2F0YS5zYWdhLmpwIiwKCSJraXRhaGF0YS5zYWdhLmpwIiwKCSJraXlhbWEuc2FnYS5qcCIsCgkia291aG9rdS5zYWdhLmpwIiwKCSJreXVyYWdpLnNhZ2EuanAiLAoJIm5pc2hpYXJpdGEuc2FnYS5qcCIsCgkib2dpLnNhZ2EuanAiLAoJIm9tYWNoaS5zYWdhLmpwIiwKCSJvdWNoaS5zYWdhLmpwIiwKCSJzYWdhLnNhZ2EuanAiLAoJInNoaXJvaXNoaS5zYWdhLmpwIiwKCSJ0YWt1LnNhZ2EuanAiLAoJInRhcmEuc2FnYS5qcCIsCgkidG9zdS5zYWdhLmpwIiwKCSJ5b3NoaW5vZ2FyaS5zYWdhLmpwIiwKCSJhcmFrYXdhLnNhaXRhbWEuanAiLAoJImFzYWthLnNhaXRhbWEuanAiLAoJImNoaWNoaWJ1LnNhaXRhbWEuanAiLAoJImZ1amltaS5zYWl0YW1hLmpwIiwKCSJmdWppbWluby5zYWl0YW1hLmpwIiwKCSJmdWtheWEuc2FpdGFtYS5qcCIsCgkiaGFubm8uc2FpdGFtYS5qcCIsCgkiaGFueXUuc2FpdGFtYS5qcCIsCgkiaGFzdWRhLnNhaXRhbWEuanAiLAoJImhhdG9nYXlhLnNhaXRhbWEuanAiLAoJImhhdG95YW1hLnNhaXRhbWEuanAiLAoJImhpZGFrYS5zYWl0YW1hLmpwIiwKCSJoaWdhc2hpY2hpY2hpYnUuc2FpdGFtYS5qcCIsCgkiaGlnYXNoaW1hdHN1eWFtYS5zYWl0YW1hLmpwIiwKCSJob25qby5zYWl0YW1hLmpwIiwKCSJpbmEuc2FpdGFtYS5qcCIsCgkiaXJ1bWEuc2FpdGFtYS5qcCIsCgkiaXdhdHN1a2kuc2FpdGFtYS5qcCIsCgkia2FtaWl6dW1pLnNhaXRhbWEuanAiLAoJImthbWlrYXdhLnNhaXRhbWEuanAiLAoJImthbWlzYXRvLnNhaXRhbWEuanAiLAoJImthc3VrYWJlLnNhaXRhbWEuanAiLAoJImthd2Fnb2Uuc2FpdGFtYS5qcCIsCgkia2F3YWd1Y2hpLnNhaXRhbWEuanAiLAoJImthd2FqaW1hLnNhaXRhbWEuanAiLAoJImthem8uc2FpdGFtYS5qcCIsCgkia2l0YW1vdG8uc2FpdGFtYS5qcCIsCgkia29zaGlnYXlhLnNhaXRhbWEuanAiLAoJImtvdW5vc3Uuc2FpdGFtYS5qcCIsCgkia3VraS5zYWl0YW1hLmpwIiwKCSJrdW1hZ2F5YS5zYWl0YW1hLmpwIiwKCSJtYXRzdWJ1c2hpLnNhaXRhbWEuanAiLAoJIm1pbmFuby5zYWl0YW1hLmpwIiwKCSJtaXNhdG8uc2FpdGFtYS5qcCIsCgkibWl5YXNoaXJvLnNhaXRhbWEuanAiLAoJIm1peW9zaGkuc2FpdGFtYS5qcCIsCgkibW9yb3lhbWEuc2FpdGFtYS5qcCIsCgkibmFnYXRvcm8uc2FpdGFtYS5qcCIsCgkibmFtZWdhd2Euc2FpdGFtYS5qcCIsCgkibmlpemEuc2FpdGFtYS5qcCIsCgkib2dhbm8uc2FpdGFtYS5qcCIsCgkib2dhd2Euc2FpdGFtYS5qcCIsCgkib2dvc2Uuc2FpdGFtYS5qcCIsCgkib2tlZ2F3YS5zYWl0YW1hLmpwIiwKCSJvbWl5YS5zYWl0YW1hLmpwIiwKCSJvdGFraS5zYWl0YW1hLmpwIiwKCSJyYW56YW4uc2FpdGFtYS5qcCIsCgkicnlva2FtaS5zYWl0YW1hLmpwIiwKCSJzYWl0YW1hLnNhaXRhbWEuanAiLAoJInNha2Fkby5zYWl0YW1hLmpwIiwKCSJzYXR0ZS5zYWl0YW1hLmpwIiwKCSJzYXlhbWEuc2FpdGFtYS5qcCIsCgkic2hpa2kuc2FpdGFtYS5qcCIsCgkic2hpcmFva2Euc2FpdGFtYS5qcCIsCgkic29rYS5zYWl0YW1hLmpwIiwKCSJzdWdpdG8uc2FpdGFtYS5qcCIsCgkidG9kYS5zYWl0YW1hLmpwIiwKCSJ0b2tpZ2F3YS5zYWl0YW1hLmpwIiwKCSJ0b2tvcm96YXdhLnNhaXRhbWEuanAiLAoJInRzdXJ1Z2FzaGltYS5zYWl0YW1hLmpwIiwKCSJ1cmF3YS5zYWl0YW1hLmpwIiwKCSJ3YXJhYmkuc2FpdGFtYS5qcCIsCgkieWFzaGlvLnNhaXRhbWEuanAiLAoJInlva296ZS5zYWl0YW1hLmpwIiwKCSJ5b25vLnNhaXRhbWEuanAiLAoJInlvcmlpLnNhaXRhbWEuanAiLAoJInlvc2hpZGEuc2FpdGFtYS5qcCIsCgkieW9zaGlrYXdhLnNhaXRhbWEuanAiLAoJInlvc2hpbWkuc2FpdGFtYS5qcCIsCgkiYWlzaG8uc2hpZ2EuanAiLAoJImdhbW8uc2hpZ2EuanAiLAoJImhpZ2FzaGlvbWkuc2hpZ2EuanAiLAoJImhpa29uZS5zaGlnYS5qcCIsCgkia29rYS5zaGlnYS5qcCIsCgkia29uYW4uc2hpZ2EuanAiLAoJImtvc2VpLnNoaWdhLmpwIiwKCSJrb3RvLnNoaWdhLmpwIiwKCSJrdXNhdHN1LnNoaWdhLmpwIiwKCSJtYWliYXJhLnNoaWdhLmpwIiwKCSJtb3JpeWFtYS5zaGlnYS5qcCIsCgkibmFnYWhhbWEuc2hpZ2EuanAiLAoJIm5pc2hpYXphaS5zaGlnYS5qcCIsCgkibm90b2dhd2Euc2hpZ2EuanAiLAoJIm9taWhhY2hpbWFuLnNoaWdhLmpwIiwKCSJvdHN1LnNoaWdhLmpwIiwKCSJyaXR0by5zaGlnYS5qcCIsCgkicnl1b2guc2hpZ2EuanAiLAoJInRha2FzaGltYS5zaGlnYS5qcCIsCgkidGFrYXRzdWtpLnNoaWdhLmpwIiwKCSJ0b3JhaGltZS5zaGlnYS5qcCIsCgkidG95b3NhdG8uc2hpZ2EuanAiLAoJInlhc3Uuc2hpZ2EuanAiLAoJImFrYWdpLnNoaW1hbmUuanAiLAoJImFtYS5zaGltYW5lLmpwIiwKCSJnb3RzdS5zaGltYW5lLmpwIiwKCSJoYW1hZGEuc2hpbWFuZS5qcCIsCgkiaGlnYXNoaWl6dW1vLnNoaW1hbmUuanAiLAoJImhpa2F3YS5zaGltYW5lLmpwIiwKCSJoaWtpbWkuc2hpbWFuZS5qcCIsCgkiaXp1bW8uc2hpbWFuZS5qcCIsCgkia2FraW5va2kuc2hpbWFuZS5qcCIsCgkibWFzdWRhLnNoaW1hbmUuanAiLAoJIm1hdHN1ZS5zaGltYW5lLmpwIiwKCSJtaXNhdG8uc2hpbWFuZS5qcCIsCgkibmlzaGlub3NoaW1hLnNoaW1hbmUuanAiLAoJIm9oZGEuc2hpbWFuZS5qcCIsCgkib2tpbm9zaGltYS5zaGltYW5lLmpwIiwKCSJva3VpenVtby5zaGltYW5lLmpwIiwKCSJzaGltYW5lLnNoaW1hbmUuanAiLAoJInRhbWF5dS5zaGltYW5lLmpwIiwKCSJ0c3V3YW5vLnNoaW1hbmUuanAiLAoJInVubmFuLnNoaW1hbmUuanAiLAoJInlha3Vtby5zaGltYW5lLmpwIiwKCSJ5YXN1Z2kuc2hpbWFuZS5qcCIsCgkieWF0c3VrYS5zaGltYW5lLmpwIiwKCSJhcmFpLnNoaXp1b2thLmpwIiwKCSJhdGFtaS5zaGl6dW9rYS5qcCIsCgkiZnVqaS5zaGl6dW9rYS5qcCIsCgkiZnVqaWVkYS5zaGl6dW9rYS5qcCIsCgkiZnVqaWthd2Euc2hpenVva2EuanAiLAoJImZ1amlub21peWEuc2hpenVva2EuanAiLAoJImZ1a3Vyb2kuc2hpenVva2EuanAiLAoJImdvdGVtYmEuc2hpenVva2EuanAiLAoJImhhaWJhcmEuc2hpenVva2EuanAiLAoJImhhbWFtYXRzdS5zaGl6dW9rYS5qcCIsCgkiaGlnYXNoaWl6dS5zaGl6dW9rYS5qcCIsCgkiaXRvLnNoaXp1b2thLmpwIiwKCSJpd2F0YS5zaGl6dW9rYS5qcCIsCgkiaXp1LnNoaXp1b2thLmpwIiwKCSJpenVub2t1bmkuc2hpenVva2EuanAiLAoJImtha2VnYXdhLnNoaXp1b2thLmpwIiwKCSJrYW5uYW1pLnNoaXp1b2thLmpwIiwKCSJrYXdhbmVob24uc2hpenVva2EuanAiLAoJImthd2F6dS5zaGl6dW9rYS5qcCIsCgkia2lrdWdhd2Euc2hpenVva2EuanAiLAoJImtvc2FpLnNoaXp1b2thLmpwIiwKCSJtYWtpbm9oYXJhLnNoaXp1b2thLmpwIiwKCSJtYXRzdXpha2kuc2hpenVva2EuanAiLAoJIm1pbmFtaWl6dS5zaGl6dW9rYS5qcCIsCgkibWlzaGltYS5zaGl6dW9rYS5qcCIsCgkibW9yaW1hY2hpLnNoaXp1b2thLmpwIiwKCSJuaXNoaWl6dS5zaGl6dW9rYS5qcCIsCgkibnVtYXp1LnNoaXp1b2thLmpwIiwKCSJvbWFlemFraS5zaGl6dW9rYS5qcCIsCgkic2hpbWFkYS5zaGl6dW9rYS5qcCIsCgkic2hpbWl6dS5zaGl6dW9rYS5qcCIsCgkic2hpbW9kYS5zaGl6dW9rYS5qcCIsCgkic2hpenVva2Euc2hpenVva2EuanAiLAoJInN1c29uby5zaGl6dW9rYS5qcCIsCgkieWFpenUuc2hpenVva2EuanAiLAoJInlvc2hpZGEuc2hpenVva2EuanAiLAoJImFzaGlrYWdhLnRvY2hpZ2kuanAiLAoJImJhdG8udG9jaGlnaS5qcCIsCgkiaGFnYS50b2NoaWdpLmpwIiwKCSJpY2hpa2FpLnRvY2hpZ2kuanAiLAoJIml3YWZ1bmUudG9jaGlnaS5qcCIsCgkia2FtaW5va2F3YS50b2NoaWdpLmpwIiwKCSJrYW51bWEudG9jaGlnaS5qcCIsCgkia2FyYXN1eWFtYS50b2NoaWdpLmpwIiwKCSJrdXJvaXNvLnRvY2hpZ2kuanAiLAoJIm1hc2hpa28udG9jaGlnaS5qcCIsCgkibWlidS50b2NoaWdpLmpwIiwKCSJtb2thLnRvY2hpZ2kuanAiLAoJIm1vdGVnaS50b2NoaWdpLmpwIiwKCSJuYXN1LnRvY2hpZ2kuanAiLAoJIm5hc3VzaGlvYmFyYS50b2NoaWdpLmpwIiwKCSJuaWtrby50b2NoaWdpLmpwIiwKCSJuaXNoaWthdGEudG9jaGlnaS5qcCIsCgkibm9naS50b2NoaWdpLmpwIiwKCSJvaGlyYS50b2NoaWdpLmpwIiwKCSJvaHRhd2FyYS50b2NoaWdpLmpwIiwKCSJveWFtYS50b2NoaWdpLmpwIiwKCSJzYWt1cmEudG9jaGlnaS5qcCIsCgkic2Fuby50b2NoaWdpLmpwIiwKCSJzaGltb3RzdWtlLnRvY2hpZ2kuanAiLAoJInNoaW95YS50b2NoaWdpLmpwIiwKCSJ0YWthbmV6YXdhLnRvY2hpZ2kuanAiLAoJInRvY2hpZ2kudG9jaGlnaS5qcCIsCgkidHN1Z2EudG9jaGlnaS5qcCIsCgkidWppaWUudG9jaGlnaS5qcCIsCgkidXRzdW5vbWl5YS50b2NoaWdpLmpwIiwKCSJ5YWl0YS50b2NoaWdpLmpwIiwKCSJhaXp1bWkudG9rdXNoaW1hLmpwIiwKCSJhbmFuLnRva3VzaGltYS5qcCIsCgkiaWNoaWJhLnRva3VzaGltYS5qcCIsCgkiaXRhbm8udG9rdXNoaW1hLmpwIiwKCSJrYWluYW4udG9rdXNoaW1hLmpwIiwKCSJrb21hdHN1c2hpbWEudG9rdXNoaW1hLmpwIiwKCSJtYXRzdXNoaWdlLnRva3VzaGltYS5qcCIsCgkibWltYS50b2t1c2hpbWEuanAiLAoJIm1pbmFtaS50b2t1c2hpbWEuanAiLAoJIm1peW9zaGkudG9rdXNoaW1hLmpwIiwKCSJtdWdpLnRva3VzaGltYS5qcCIsCgkibmFrYWdhd2EudG9rdXNoaW1hLmpwIiwKCSJuYXJ1dG8udG9rdXNoaW1hLmpwIiwKCSJzYW5hZ29jaGkudG9rdXNoaW1hLmpwIiwKCSJzaGlzaGlrdWkudG9rdXNoaW1hLmpwIiwKCSJ0b2t1c2hpbWEudG9rdXNoaW1hLmpwIiwKCSJ3YWppa2kudG9rdXNoaW1hLmpwIiwKCSJhZGFjaGkudG9reW8uanAiLAoJImFraXJ1bm8udG9reW8uanAiLAoJImFraXNoaW1hLnRva3lvLmpwIiwKCSJhb2dhc2hpbWEudG9reW8uanAiLAoJImFyYWthd2EudG9reW8uanAiLAoJImJ1bmt5by50b2t5by5qcCIsCgkiY2hpeW9kYS50b2t5by5qcCIsCgkiY2hvZnUudG9reW8uanAiLAoJImNodW8udG9reW8uanAiLAoJImVkb2dhd2EudG9reW8uanAiLAoJImZ1Y2h1LnRva3lvLmpwIiwKCSJmdXNzYS50b2t5by5qcCIsCgkiaGFjaGlqby50b2t5by5qcCIsCgkiaGFjaGlvamkudG9reW8uanAiLAoJImhhbXVyYS50b2t5by5qcCIsCgkiaGlnYXNoaWt1cnVtZS50b2t5by5qcCIsCgkiaGlnYXNoaW11cmF5YW1hLnRva3lvLmpwIiwKCSJoaWdhc2hpeWFtYXRvLnRva3lvLmpwIiwKCSJoaW5vLnRva3lvLmpwIiwKCSJoaW5vZGUudG9reW8uanAiLAoJImhpbm9oYXJhLnRva3lvLmpwIiwKCSJpbmFnaS50b2t5by5qcCIsCgkiaXRhYmFzaGkudG9reW8uanAiLAoJImthdHN1c2hpa2EudG9reW8uanAiLAoJImtpdGEudG9reW8uanAiLAoJImtpeW9zZS50b2t5by5qcCIsCgkia29kYWlyYS50b2t5by5qcCIsCgkia29nYW5laS50b2t5by5qcCIsCgkia29rdWJ1bmppLnRva3lvLmpwIiwKCSJrb21hZS50b2t5by5qcCIsCgkia290by50b2t5by5qcCIsCgkia291enVzaGltYS50b2t5by5qcCIsCgkia3VuaXRhY2hpLnRva3lvLmpwIiwKCSJtYWNoaWRhLnRva3lvLmpwIiwKCSJtZWd1cm8udG9reW8uanAiLAoJIm1pbmF0by50b2t5by5qcCIsCgkibWl0YWthLnRva3lvLmpwIiwKCSJtaXp1aG8udG9reW8uanAiLAoJIm11c2FzaGltdXJheWFtYS50b2t5by5qcCIsCgkibXVzYXNoaW5vLnRva3lvLmpwIiwKCSJuYWthbm8udG9reW8uanAiLAoJIm5lcmltYS50b2t5by5qcCIsCgkib2dhc2F3YXJhLnRva3lvLmpwIiwKCSJva3V0YW1hLnRva3lvLmpwIiwKCSJvbWUudG9reW8uanAiLAoJIm9zaGltYS50b2t5by5qcCIsCgkib3RhLnRva3lvLmpwIiwKCSJzZXRhZ2F5YS50b2t5by5qcCIsCgkic2hpYnV5YS50b2t5by5qcCIsCgkic2hpbmFnYXdhLnRva3lvLmpwIiwKCSJzaGluanVrdS50b2t5by5qcCIsCgkic3VnaW5hbWkudG9reW8uanAiLAoJInN1bWlkYS50b2t5by5qcCIsCgkidGFjaGlrYXdhLnRva3lvLmpwIiwKCSJ0YWl0by50b2t5by5qcCIsCgkidGFtYS50b2t5by5qcCIsCgkidG9zaGltYS50b2t5by5qcCIsCgkiY2hpenUudG90dG9yaS5qcCIsCgkiaGluby50b3R0b3JpLmpwIiwKCSJrYXdhaGFyYS50b3R0b3JpLmpwIiwKCSJrb2dlLnRvdHRvcmkuanAiLAoJImtvdG91cmEudG90dG9yaS5qcCIsCgkibWlzYXNhLnRvdHRvcmkuanAiLAoJIm5hbmJ1LnRvdHRvcmkuanAiLAoJIm5pY2hpbmFuLnRvdHRvcmkuanAiLAoJInNha2FpbWluYXRvLnRvdHRvcmkuanAiLAoJInRvdHRvcmkudG90dG9yaS5qcCIsCgkid2FrYXNhLnRvdHRvcmkuanAiLAoJInlhenUudG90dG9yaS5qcCIsCgkieW9uYWdvLnRvdHRvcmkuanAiLAoJImFzYWhpLnRveWFtYS5qcCIsCgkiZnVjaHUudG95YW1hLmpwIiwKCSJmdWt1bWl0c3UudG95YW1hLmpwIiwKCSJmdW5haGFzaGkudG95YW1hLmpwIiwKCSJoaW1pLnRveWFtYS5qcCIsCgkiaW1penUudG95YW1hLmpwIiwKCSJpbmFtaS50b3lhbWEuanAiLAoJImpvaGFuYS50b3lhbWEuanAiLAoJImthbWlpY2hpLnRveWFtYS5qcCIsCgkia3Vyb2JlLnRveWFtYS5qcCIsCgkibmFrYW5paWthd2EudG95YW1hLmpwIiwKCSJuYW1lcmlrYXdhLnRveWFtYS5qcCIsCgkibmFudG8udG95YW1hLmpwIiwKCSJueXV6ZW4udG95YW1hLmpwIiwKCSJveWFiZS50b3lhbWEuanAiLAoJInRhaXJhLnRveWFtYS5qcCIsCgkidGFrYW9rYS50b3lhbWEuanAiLAoJInRhdGV5YW1hLnRveWFtYS5qcCIsCgkidG9nYS50b3lhbWEuanAiLAoJInRvbmFtaS50b3lhbWEuanAiLAoJInRveWFtYS50b3lhbWEuanAiLAoJInVuYXp1a2kudG95YW1hLmpwIiwKCSJ1b3p1LnRveWFtYS5qcCIsCgkieWFtYWRhLnRveWFtYS5qcCIsCgkiYXJpZGEud2FrYXlhbWEuanAiLAoJImFyaWRhZ2F3YS53YWtheWFtYS5qcCIsCgkiZ29iby53YWtheWFtYS5qcCIsCgkiaGFzaGltb3RvLndha2F5YW1hLmpwIiwKCSJoaWRha2Eud2FrYXlhbWEuanAiLAoJImhpcm9nYXdhLndha2F5YW1hLmpwIiwKCSJpbmFtaS53YWtheWFtYS5qcCIsCgkiaXdhZGUud2FrYXlhbWEuanAiLAoJImthaW5hbi53YWtheWFtYS5qcCIsCgkia2FtaXRvbmRhLndha2F5YW1hLmpwIiwKCSJrYXRzdXJhZ2kud2FrYXlhbWEuanAiLAoJImtpbWluby53YWtheWFtYS5qcCIsCgkia2lub2thd2Eud2FrYXlhbWEuanAiLAoJImtpdGF5YW1hLndha2F5YW1hLmpwIiwKCSJrb3lhLndha2F5YW1hLmpwIiwKCSJrb3phLndha2F5YW1hLmpwIiwKCSJrb3phZ2F3YS53YWtheWFtYS5qcCIsCgkia3Vkb3lhbWEud2FrYXlhbWEuanAiLAoJImt1c2hpbW90by53YWtheWFtYS5qcCIsCgkibWloYW1hLndha2F5YW1hLmpwIiwKCSJtaXNhdG8ud2FrYXlhbWEuanAiLAoJIm5hY2hpa2F0c3V1cmEud2FrYXlhbWEuanAiLAoJInNoaW5ndS53YWtheWFtYS5qcCIsCgkic2hpcmFoYW1hLndha2F5YW1hLmpwIiwKCSJ0YWlqaS53YWtheWFtYS5qcCIsCgkidGFuYWJlLndha2F5YW1hLmpwIiwKCSJ3YWtheWFtYS53YWtheWFtYS5qcCIsCgkieXVhc2Eud2FrYXlhbWEuanAiLAoJInl1cmEud2FrYXlhbWEuanAiLAoJImFzYWhpLnlhbWFnYXRhLmpwIiwKCSJmdW5hZ2F0YS55YW1hZ2F0YS5qcCIsCgkiaGlnYXNoaW5lLnlhbWFnYXRhLmpwIiwKCSJpaWRlLnlhbWFnYXRhLmpwIiwKCSJrYWhva3UueWFtYWdhdGEuanAiLAoJImthbWlub3lhbWEueWFtYWdhdGEuanAiLAoJImthbmV5YW1hLnlhbWFnYXRhLmpwIiwKCSJrYXdhbmlzaGkueWFtYWdhdGEuanAiLAoJIm1hbXVyb2dhd2EueWFtYWdhdGEuanAiLAoJIm1pa2F3YS55YW1hZ2F0YS5qcCIsCgkibXVyYXlhbWEueWFtYWdhdGEuanAiLAoJIm5hZ2FpLnlhbWFnYXRhLmpwIiwKCSJuYWtheWFtYS55YW1hZ2F0YS5qcCIsCgkibmFueW8ueWFtYWdhdGEuanAiLAoJIm5pc2hpa2F3YS55YW1hZ2F0YS5qcCIsCgkib2JhbmF6YXdhLnlhbWFnYXRhLmpwIiwKCSJvZS55YW1hZ2F0YS5qcCIsCgkib2d1bmkueWFtYWdhdGEuanAiLAoJIm9oa3VyYS55YW1hZ2F0YS5qcCIsCgkib2lzaGlkYS55YW1hZ2F0YS5qcCIsCgkic2FnYWUueWFtYWdhdGEuanAiLAoJInNha2F0YS55YW1hZ2F0YS5qcCIsCgkic2FrZWdhd2EueWFtYWdhdGEuanAiLAoJInNoaW5qby55YW1hZ2F0YS5qcCIsCgkic2hpcmF0YWthLnlhbWFnYXRhLmpwIiwKCSJzaG9uYWkueWFtYWdhdGEuanAiLAoJInRha2FoYXRhLnlhbWFnYXRhLmpwIiwKCSJ0ZW5kby55YW1hZ2F0YS5qcCIsCgkidG96YXdhLnlhbWFnYXRhLmpwIiwKCSJ0c3VydW9rYS55YW1hZ2F0YS5qcCIsCgkieWFtYWdhdGEueWFtYWdhdGEuanAiLAoJInlhbWFub2JlLnlhbWFnYXRhLmpwIiwKCSJ5b25lemF3YS55YW1hZ2F0YS5qcCIsCgkieXV6YS55YW1hZ2F0YS5qcCIsCgkiYWJ1LnlhbWFndWNoaS5qcCIsCgkiaGFnaS55YW1hZ3VjaGkuanAiLAoJImhpa2FyaS55YW1hZ3VjaGkuanAiLAoJImhvZnUueWFtYWd1Y2hpLmpwIiwKCSJpd2FrdW5pLnlhbWFndWNoaS5qcCIsCgkia3VkYW1hdHN1LnlhbWFndWNoaS5qcCIsCgkibWl0b3UueWFtYWd1Y2hpLmpwIiwKCSJuYWdhdG8ueWFtYWd1Y2hpLmpwIiwKCSJvc2hpbWEueWFtYWd1Y2hpLmpwIiwKCSJzaGltb25vc2VraS55YW1hZ3VjaGkuanAiLAoJInNodW5hbi55YW1hZ3VjaGkuanAiLAoJInRhYnVzZS55YW1hZ3VjaGkuanAiLAoJInRva3V5YW1hLnlhbWFndWNoaS5qcCIsCgkidG95b3RhLnlhbWFndWNoaS5qcCIsCgkidWJlLnlhbWFndWNoaS5qcCIsCgkieXV1LnlhbWFndWNoaS5qcCIsCgkiY2h1by55YW1hbmFzaGkuanAiLAoJImRvc2hpLnlhbWFuYXNoaS5qcCIsCgkiZnVlZnVraS55YW1hbmFzaGkuanAiLAoJImZ1amlrYXdhLnlhbWFuYXNoaS5qcCIsCgkiZnVqaWthd2FndWNoaWtvLnlhbWFuYXNoaS5qcCIsCgkiZnVqaXlvc2hpZGEueWFtYW5hc2hpLmpwIiwKCSJoYXlha2F3YS55YW1hbmFzaGkuanAiLAoJImhva3V0by55YW1hbmFzaGkuanAiLAoJImljaGlrYXdhbWlzYXRvLnlhbWFuYXNoaS5qcCIsCgkia2FpLnlhbWFuYXNoaS5qcCIsCgkia29mdS55YW1hbmFzaGkuanAiLAoJImtvc2h1LnlhbWFuYXNoaS5qcCIsCgkia29zdWdlLnlhbWFuYXNoaS5qcCIsCgkibWluYW1pLWFscHMueWFtYW5hc2hpLmpwIiwKCSJtaW5vYnUueWFtYW5hc2hpLmpwIiwKCSJuYWthbWljaGkueWFtYW5hc2hpLmpwIiwKCSJuYW5idS55YW1hbmFzaGkuanAiLAoJIm5hcnVzYXdhLnlhbWFuYXNoaS5qcCIsCgkibmlyYXNha2kueWFtYW5hc2hpLmpwIiwKCSJuaXNoaWthdHN1cmEueWFtYW5hc2hpLmpwIiwKCSJvc2hpbm8ueWFtYW5hc2hpLmpwIiwKCSJvdHN1a2kueWFtYW5hc2hpLmpwIiwKCSJzaG93YS55YW1hbmFzaGkuanAiLAoJInRhYmF5YW1hLnlhbWFuYXNoaS5qcCIsCgkidHN1cnUueWFtYW5hc2hpLmpwIiwKCSJ1ZW5vaGFyYS55YW1hbmFzaGkuanAiLAoJInlhbWFuYWtha28ueWFtYW5hc2hpLmpwIiwKCSJ5YW1hbmFzaGkueWFtYW5hc2hpLmpwIiwKCSJrZSIsCgkiYWMua2UiLAoJImNvLmtlIiwKCSJnby5rZSIsCgkiaW5mby5rZSIsCgkibWUua2UiLAoJIm1vYmkua2UiLAoJIm5lLmtlIiwKCSJvci5rZSIsCgkic2Mua2UiLAoJImtnIiwKCSJvcmcua2ciLAoJIm5ldC5rZyIsCgkiY29tLmtnIiwKCSJlZHUua2ciLAoJImdvdi5rZyIsCgkibWlsLmtnIiwKCSIqLmtoIiwKCSJraSIsCgkiZWR1LmtpIiwKCSJiaXoua2kiLAoJIm5ldC5raSIsCgkib3JnLmtpIiwKCSJnb3Yua2kiLAoJImluZm8ua2kiLAoJImNvbS5raSIsCgkia20iLAoJIm9yZy5rbSIsCgkibm9tLmttIiwKCSJnb3Yua20iLAoJInByZC5rbSIsCgkidG0ua20iLAoJImVkdS5rbSIsCgkibWlsLmttIiwKCSJhc3Mua20iLAoJImNvbS5rbSIsCgkiY29vcC5rbSIsCgkiYXNzby5rbSIsCgkicHJlc3NlLmttIiwKCSJtZWRlY2luLmttIiwKCSJub3RhaXJlcy5rbSIsCgkicGhhcm1hY2llbnMua20iLAoJInZldGVyaW5haXJlLmttIiwKCSJnb3V2LmttIiwKCSJrbiIsCgkibmV0LmtuIiwKCSJvcmcua24iLAoJImVkdS5rbiIsCgkiZ292LmtuIiwKCSJrcCIsCgkiY29tLmtwIiwKCSJlZHUua3AiLAoJImdvdi5rcCIsCgkib3JnLmtwIiwKCSJyZXAua3AiLAoJInRyYS5rcCIsCgkia3IiLAoJImFjLmtyIiwKCSJjby5rciIsCgkiZXMua3IiLAoJImdvLmtyIiwKCSJocy5rciIsCgkia2cua3IiLAoJIm1pbC5rciIsCgkibXMua3IiLAoJIm5lLmtyIiwKCSJvci5rciIsCgkicGUua3IiLAoJInJlLmtyIiwKCSJzYy5rciIsCgkiYnVzYW4ua3IiLAoJImNodW5nYnVrLmtyIiwKCSJjaHVuZ25hbS5rciIsCgkiZGFlZ3Uua3IiLAoJImRhZWplb24ua3IiLAoJImdhbmd3b24ua3IiLAoJImd3YW5nanUua3IiLAoJImd5ZW9uZ2J1ay5rciIsCgkiZ3llb25nZ2kua3IiLAoJImd5ZW9uZ25hbS5rciIsCgkiaW5jaGVvbi5rciIsCgkiamVqdS5rciIsCgkiamVvbmJ1ay5rciIsCgkiamVvbm5hbS5rciIsCgkic2VvdWwua3IiLAoJInVsc2FuLmtyIiwKCSJrdyIsCgkiY29tLmt3IiwKCSJlZHUua3ciLAoJImVtYi5rdyIsCgkiZ292Lmt3IiwKCSJpbmQua3ciLAoJIm5ldC5rdyIsCgkib3JnLmt3IiwKCSJreSIsCgkiY29tLmt5IiwKCSJlZHUua3kiLAoJIm5ldC5reSIsCgkib3JnLmt5IiwKCSJreiIsCgkib3JnLmt6IiwKCSJlZHUua3oiLAoJIm5ldC5reiIsCgkiZ292Lmt6IiwKCSJtaWwua3oiLAoJImNvbS5reiIsCgkibGEiLAoJImludC5sYSIsCgkibmV0LmxhIiwKCSJpbmZvLmxhIiwKCSJlZHUubGEiLAoJImdvdi5sYSIsCgkicGVyLmxhIiwKCSJjb20ubGEiLAoJIm9yZy5sYSIsCgkibGIiLAoJImNvbS5sYiIsCgkiZWR1LmxiIiwKCSJnb3YubGIiLAoJIm5ldC5sYiIsCgkib3JnLmxiIiwKCSJsYyIsCgkiY29tLmxjIiwKCSJuZXQubGMiLAoJImNvLmxjIiwKCSJvcmcubGMiLAoJImVkdS5sYyIsCgkiZ292LmxjIiwKCSJsaSIsCgkibGsiLAoJImdvdi5sayIsCgkic2NoLmxrIiwKCSJuZXQubGsiLAoJImludC5sayIsCgkiY29tLmxrIiwKCSJvcmcubGsiLAoJImVkdS5sayIsCgkibmdvLmxrIiwKCSJzb2MubGsiLAoJIndlYi5sayIsCgkibHRkLmxrIiwKCSJhc3NuLmxrIiwKCSJncnAubGsiLAoJImhvdGVsLmxrIiwKCSJhYy5sayIsCgkibHIiLAoJImNvbS5sciIsCgkiZWR1LmxyIiwKCSJnb3YubHIiLAoJIm9yZy5sciIsCgkibmV0LmxyIiwKCSJscyIsCgkiYWMubHMiLAoJImJpei5scyIsCgkiY28ubHMiLAoJImVkdS5scyIsCgkiZ292LmxzIiwKCSJpbmZvLmxzIiwKCSJuZXQubHMiLAoJIm9yZy5scyIsCgkic2MubHMiLAoJImx0IiwKCSJnb3YubHQiLAoJImx1IiwKCSJsdiIsCgkiY29tLmx2IiwKCSJlZHUubHYiLAoJImdvdi5sdiIsCgkib3JnLmx2IiwKCSJtaWwubHYiLAoJImlkLmx2IiwKCSJuZXQubHYiLAoJImFzbi5sdiIsCgkiY29uZi5sdiIsCgkibHkiLAoJImNvbS5seSIsCgkibmV0Lmx5IiwKCSJnb3YubHkiLAoJInBsYy5seSIsCgkiZWR1Lmx5IiwKCSJzY2gubHkiLAoJIm1lZC5seSIsCgkib3JnLmx5IiwKCSJpZC5seSIsCgkibWEiLAoJImNvLm1hIiwKCSJuZXQubWEiLAoJImdvdi5tYSIsCgkib3JnLm1hIiwKCSJhYy5tYSIsCgkicHJlc3MubWEiLAoJIm1jIiwKCSJ0bS5tYyIsCgkiYXNzby5tYyIsCgkibWQiLAoJIm1lIiwKCSJjby5tZSIsCgkibmV0Lm1lIiwKCSJvcmcubWUiLAoJImVkdS5tZSIsCgkiYWMubWUiLAoJImdvdi5tZSIsCgkiaXRzLm1lIiwKCSJwcml2Lm1lIiwKCSJtZyIsCgkib3JnLm1nIiwKCSJub20ubWciLAoJImdvdi5tZyIsCgkicHJkLm1nIiwKCSJ0bS5tZyIsCgkiZWR1Lm1nIiwKCSJtaWwubWciLAoJImNvbS5tZyIsCgkiY28ubWciLAoJIm1oIiwKCSJtaWwiLAoJIm1rIiwKCSJjb20ubWsiLAoJIm9yZy5tayIsCgkibmV0Lm1rIiwKCSJlZHUubWsiLAoJImdvdi5tayIsCgkiaW5mLm1rIiwKCSJuYW1lLm1rIiwKCSJtbCIsCgkiY29tLm1sIiwKCSJlZHUubWwiLAoJImdvdXYubWwiLAoJImdvdi5tbCIsCgkibmV0Lm1sIiwKCSJvcmcubWwiLAoJInByZXNzZS5tbCIsCgkiKi5tbSIsCgkibW4iLAoJImdvdi5tbiIsCgkiZWR1Lm1uIiwKCSJvcmcubW4iLAoJIm1vIiwKCSJjb20ubW8iLAoJIm5ldC5tbyIsCgkib3JnLm1vIiwKCSJlZHUubW8iLAoJImdvdi5tbyIsCgkibW9iaSIsCgkibXAiLAoJIm1xIiwKCSJtciIsCgkiZ292Lm1yIiwKCSJtcyIsCgkiY29tLm1zIiwKCSJlZHUubXMiLAoJImdvdi5tcyIsCgkibmV0Lm1zIiwKCSJvcmcubXMiLAoJIm10IiwKCSJjb20ubXQiLAoJImVkdS5tdCIsCgkibmV0Lm10IiwKCSJvcmcubXQiLAoJIm11IiwKCSJjb20ubXUiLAoJIm5ldC5tdSIsCgkib3JnLm11IiwKCSJnb3YubXUiLAoJImFjLm11IiwKCSJjby5tdSIsCgkib3IubXUiLAoJIm11c2V1bSIsCgkiYWNhZGVteS5tdXNldW0iLAoJImFncmljdWx0dXJlLm11c2V1bSIsCgkiYWlyLm11c2V1bSIsCgkiYWlyZ3VhcmQubXVzZXVtIiwKCSJhbGFiYW1hLm11c2V1bSIsCgkiYWxhc2thLm11c2V1bSIsCgkiYW1iZXIubXVzZXVtIiwKCSJhbWJ1bGFuY2UubXVzZXVtIiwKCSJhbWVyaWNhbi5tdXNldW0iLAoJImFtZXJpY2FuYS5tdXNldW0iLAoJImFtZXJpY2FuYW50aXF1ZXMubXVzZXVtIiwKCSJhbWVyaWNhbmFydC5tdXNldW0iLAoJImFtc3RlcmRhbS5tdXNldW0iLAoJImFuZC5tdXNldW0iLAoJImFubmVmcmFuay5tdXNldW0iLAoJImFudGhyby5tdXNldW0iLAoJImFudGhyb3BvbG9neS5tdXNldW0iLAoJImFudGlxdWVzLm11c2V1bSIsCgkiYXF1YXJpdW0ubXVzZXVtIiwKCSJhcmJvcmV0dW0ubXVzZXVtIiwKCSJhcmNoYWVvbG9naWNhbC5tdXNldW0iLAoJImFyY2hhZW9sb2d5Lm11c2V1bSIsCgkiYXJjaGl0ZWN0dXJlLm11c2V1bSIsCgkiYXJ0Lm11c2V1bSIsCgkiYXJ0YW5kZGVzaWduLm11c2V1bSIsCgkiYXJ0Y2VudGVyLm11c2V1bSIsCgkiYXJ0ZGVjby5tdXNldW0iLAoJImFydGVkdWNhdGlvbi5tdXNldW0iLAoJImFydGdhbGxlcnkubXVzZXVtIiwKCSJhcnRzLm11c2V1bSIsCgkiYXJ0c2FuZGNyYWZ0cy5tdXNldW0iLAoJImFzbWF0YXJ0Lm11c2V1bSIsCgkiYXNzYXNzaW5hdGlvbi5tdXNldW0iLAoJImFzc2lzaS5tdXNldW0iLAoJImFzc29jaWF0aW9uLm11c2V1bSIsCgkiYXN0cm9ub215Lm11c2V1bSIsCgkiYXRsYW50YS5tdXNldW0iLAoJImF1c3Rpbi5tdXNldW0iLAoJImF1c3RyYWxpYS5tdXNldW0iLAoJImF1dG9tb3RpdmUubXVzZXVtIiwKCSJhdmlhdGlvbi5tdXNldW0iLAoJImF4aXMubXVzZXVtIiwKCSJiYWRham96Lm11c2V1bSIsCgkiYmFnaGRhZC5tdXNldW0iLAoJImJhaG4ubXVzZXVtIiwKCSJiYWxlLm11c2V1bSIsCgkiYmFsdGltb3JlLm11c2V1bSIsCgkiYmFyY2Vsb25hLm11c2V1bSIsCgkiYmFzZWJhbGwubXVzZXVtIiwKCSJiYXNlbC5tdXNldW0iLAoJImJhdGhzLm11c2V1bSIsCgkiYmF1ZXJuLm11c2V1bSIsCgkiYmVhdXhhcnRzLm11c2V1bSIsCgkiYmVlbGRlbmdlbHVpZC5tdXNldW0iLAoJImJlbGxldnVlLm11c2V1bSIsCgkiYmVyZ2JhdS5tdXNldW0iLAoJImJlcmtlbGV5Lm11c2V1bSIsCgkiYmVybGluLm11c2V1bSIsCgkiYmVybi5tdXNldW0iLAoJImJpYmxlLm11c2V1bSIsCgkiYmlsYmFvLm11c2V1bSIsCgkiYmlsbC5tdXNldW0iLAoJImJpcmRhcnQubXVzZXVtIiwKCSJiaXJ0aHBsYWNlLm11c2V1bSIsCgkiYm9ubi5tdXNldW0iLAoJImJvc3Rvbi5tdXNldW0iLAoJImJvdGFuaWNhbC5tdXNldW0iLAoJImJvdGFuaWNhbGdhcmRlbi5tdXNldW0iLAoJImJvdGFuaWNnYXJkZW4ubXVzZXVtIiwKCSJib3RhbnkubXVzZXVtIiwKCSJicmFuZHl3aW5ldmFsbGV5Lm11c2V1bSIsCgkiYnJhc2lsLm11c2V1bSIsCgkiYnJpc3RvbC5tdXNldW0iLAoJImJyaXRpc2gubXVzZXVtIiwKCSJicml0aXNoY29sdW1iaWEubXVzZXVtIiwKCSJicm9hZGNhc3QubXVzZXVtIiwKCSJicnVuZWwubXVzZXVtIiwKCSJicnVzc2VsLm11c2V1bSIsCgkiYnJ1c3NlbHMubXVzZXVtIiwKCSJicnV4ZWxsZXMubXVzZXVtIiwKCSJidWlsZGluZy5tdXNldW0iLAoJImJ1cmdob2YubXVzZXVtIiwKCSJidXMubXVzZXVtIiwKCSJidXNoZXkubXVzZXVtIiwKCSJjYWRhcXVlcy5tdXNldW0iLAoJImNhbGlmb3JuaWEubXVzZXVtIiwKCSJjYW1icmlkZ2UubXVzZXVtIiwKCSJjYW4ubXVzZXVtIiwKCSJjYW5hZGEubXVzZXVtIiwKCSJjYXBlYnJldG9uLm11c2V1bSIsCgkiY2Fycmllci5tdXNldW0iLAoJImNhcnRvb25hcnQubXVzZXVtIiwKCSJjYXNhZGVsYW1vbmVkYS5tdXNldW0iLAoJImNhc3RsZS5tdXNldW0iLAoJImNhc3RyZXMubXVzZXVtIiwKCSJjZWx0aWMubXVzZXVtIiwKCSJjZW50ZXIubXVzZXVtIiwKCSJjaGF0dGFub29nYS5tdXNldW0iLAoJImNoZWx0ZW5oYW0ubXVzZXVtIiwKCSJjaGVzYXBlYWtlYmF5Lm11c2V1bSIsCgkiY2hpY2Fnby5tdXNldW0iLAoJImNoaWxkcmVuLm11c2V1bSIsCgkiY2hpbGRyZW5zLm11c2V1bSIsCgkiY2hpbGRyZW5zZ2FyZGVuLm11c2V1bSIsCgkiY2hpcm9wcmFjdGljLm11c2V1bSIsCgkiY2hvY29sYXRlLm11c2V1bSIsCgkiY2hyaXN0aWFuc2J1cmcubXVzZXVtIiwKCSJjaW5jaW5uYXRpLm11c2V1bSIsCgkiY2luZW1hLm11c2V1bSIsCgkiY2lyY3VzLm11c2V1bSIsCgkiY2l2aWxpc2F0aW9uLm11c2V1bSIsCgkiY2l2aWxpemF0aW9uLm11c2V1bSIsCgkiY2l2aWx3YXIubXVzZXVtIiwKCSJjbGludG9uLm11c2V1bSIsCgkiY2xvY2subXVzZXVtIiwKCSJjb2FsLm11c2V1bSIsCgkiY29hc3RhbGRlZmVuY2UubXVzZXVtIiwKCSJjb2R5Lm11c2V1bSIsCgkiY29sZHdhci5tdXNldW0iLAoJImNvbGxlY3Rpb24ubXVzZXVtIiwKCSJjb2xvbmlhbHdpbGxpYW1zYnVyZy5tdXNldW0iLAoJImNvbG9yYWRvcGxhdGVhdS5tdXNldW0iLAoJImNvbHVtYmlhLm11c2V1bSIsCgkiY29sdW1idXMubXVzZXVtIiwKCSJjb21tdW5pY2F0aW9uLm11c2V1bSIsCgkiY29tbXVuaWNhdGlvbnMubXVzZXVtIiwKCSJjb21tdW5pdHkubXVzZXVtIiwKCSJjb21wdXRlci5tdXNldW0iLAoJImNvbXB1dGVyaGlzdG9yeS5tdXNldW0iLAoJImNvbXVuaWNhw6fDtWVzLm11c2V1bSIsCgkiY29udGVtcG9yYXJ5Lm11c2V1bSIsCgkiY29udGVtcG9yYXJ5YXJ0Lm11c2V1bSIsCgkiY29udmVudC5tdXNldW0iLAoJImNvcGVuaGFnZW4ubXVzZXVtIiwKCSJjb3Jwb3JhdGlvbi5tdXNldW0iLAoJImNvcnJlaW9zLWUtdGVsZWNvbXVuaWNhw6fDtWVzLm11c2V1bSIsCgkiY29ydmV0dGUubXVzZXVtIiwKCSJjb3N0dW1lLm11c2V1bSIsCgkiY291bnRyeWVzdGF0ZS5tdXNldW0iLAoJImNvdW50eS5tdXNldW0iLAoJImNyYWZ0cy5tdXNldW0iLAoJImNyYW5icm9vay5tdXNldW0iLAoJImNyZWF0aW9uLm11c2V1bSIsCgkiY3VsdHVyYWwubXVzZXVtIiwKCSJjdWx0dXJhbGNlbnRlci5tdXNldW0iLAoJImN1bHR1cmUubXVzZXVtIiwKCSJjeWJlci5tdXNldW0iLAoJImN5bXJ1Lm11c2V1bSIsCgkiZGFsaS5tdXNldW0iLAoJImRhbGxhcy5tdXNldW0iLAoJImRhdGFiYXNlLm11c2V1bSIsCgkiZGRyLm11c2V1bSIsCgkiZGVjb3JhdGl2ZWFydHMubXVzZXVtIiwKCSJkZWxhd2FyZS5tdXNldW0iLAoJImRlbG1lbmhvcnN0Lm11c2V1bSIsCgkiZGVubWFyay5tdXNldW0iLAoJImRlcG90Lm11c2V1bSIsCgkiZGVzaWduLm11c2V1bSIsCgkiZGV0cm9pdC5tdXNldW0iLAoJImRpbm9zYXVyLm11c2V1bSIsCgkiZGlzY292ZXJ5Lm11c2V1bSIsCgkiZG9sbHMubXVzZXVtIiwKCSJkb25vc3RpYS5tdXNldW0iLAoJImR1cmhhbS5tdXNldW0iLAoJImVhc3RhZnJpY2EubXVzZXVtIiwKCSJlYXN0Y29hc3QubXVzZXVtIiwKCSJlZHVjYXRpb24ubXVzZXVtIiwKCSJlZHVjYXRpb25hbC5tdXNldW0iLAoJImVneXB0aWFuLm11c2V1bSIsCgkiZWlzZW5iYWhuLm11c2V1bSIsCgkiZWxidXJnLm11c2V1bSIsCgkiZWx2ZW5kcmVsbC5tdXNldW0iLAoJImVtYnJvaWRlcnkubXVzZXVtIiwKCSJlbmN5Y2xvcGVkaWMubXVzZXVtIiwKCSJlbmdsYW5kLm11c2V1bSIsCgkiZW50b21vbG9neS5tdXNldW0iLAoJImVudmlyb25tZW50Lm11c2V1bSIsCgkiZW52aXJvbm1lbnRhbGNvbnNlcnZhdGlvbi5tdXNldW0iLAoJImVwaWxlcHN5Lm11c2V1bSIsCgkiZXNzZXgubXVzZXVtIiwKCSJlc3RhdGUubXVzZXVtIiwKCSJldGhub2xvZ3kubXVzZXVtIiwKCSJleGV0ZXIubXVzZXVtIiwKCSJleGhpYml0aW9uLm11c2V1bSIsCgkiZmFtaWx5Lm11c2V1bSIsCgkiZmFybS5tdXNldW0iLAoJImZhcm1lcXVpcG1lbnQubXVzZXVtIiwKCSJmYXJtZXJzLm11c2V1bSIsCgkiZmFybXN0ZWFkLm11c2V1bSIsCgkiZmllbGQubXVzZXVtIiwKCSJmaWd1ZXJlcy5tdXNldW0iLAoJImZpbGF0ZWxpYS5tdXNldW0iLAoJImZpbG0ubXVzZXVtIiwKCSJmaW5lYXJ0Lm11c2V1bSIsCgkiZmluZWFydHMubXVzZXVtIiwKCSJmaW5sYW5kLm11c2V1bSIsCgkiZmxhbmRlcnMubXVzZXVtIiwKCSJmbG9yaWRhLm11c2V1bSIsCgkiZm9yY2UubXVzZXVtIiwKCSJmb3J0bWlzc291bGEubXVzZXVtIiwKCSJmb3J0d29ydGgubXVzZXVtIiwKCSJmb3VuZGF0aW9uLm11c2V1bSIsCgkiZnJhbmNhaXNlLm11c2V1bSIsCgkiZnJhbmtmdXJ0Lm11c2V1bSIsCgkiZnJhbnppc2thbmVyLm11c2V1bSIsCgkiZnJlZW1hc29ucnkubXVzZXVtIiwKCSJmcmVpYnVyZy5tdXNldW0iLAoJImZyaWJvdXJnLm11c2V1bSIsCgkiZnJvZy5tdXNldW0iLAoJImZ1bmRhY2lvLm11c2V1bSIsCgkiZnVybml0dXJlLm11c2V1bSIsCgkiZ2FsbGVyeS5tdXNldW0iLAoJImdhcmRlbi5tdXNldW0iLAoJImdhdGV3YXkubXVzZXVtIiwKCSJnZWVsdmluY2subXVzZXVtIiwKCSJnZW1vbG9naWNhbC5tdXNldW0iLAoJImdlb2xvZ3kubXVzZXVtIiwKCSJnZW9yZ2lhLm11c2V1bSIsCgkiZ2llc3Nlbi5tdXNldW0iLAoJImdsYXMubXVzZXVtIiwKCSJnbGFzcy5tdXNldW0iLAoJImdvcmdlLm11c2V1bSIsCgkiZ3JhbmRyYXBpZHMubXVzZXVtIiwKCSJncmF6Lm11c2V1bSIsCgkiZ3Vlcm5zZXkubXVzZXVtIiwKCSJoYWxsb2ZmYW1lLm11c2V1bSIsCgkiaGFtYnVyZy5tdXNldW0iLAoJImhhbmRzb24ubXVzZXVtIiwKCSJoYXJ2ZXN0Y2VsZWJyYXRpb24ubXVzZXVtIiwKCSJoYXdhaWkubXVzZXVtIiwKCSJoZWFsdGgubXVzZXVtIiwKCSJoZWltYXR1bmR1aHJlbi5tdXNldW0iLAoJImhlbGxhcy5tdXNldW0iLAoJImhlbHNpbmtpLm11c2V1bSIsCgkiaGVtYnlnZHNmb3JidW5kLm11c2V1bSIsCgkiaGVyaXRhZ2UubXVzZXVtIiwKCSJoaXN0b2lyZS5tdXNldW0iLAoJImhpc3RvcmljYWwubXVzZXVtIiwKCSJoaXN0b3JpY2Fsc29jaWV0eS5tdXNldW0iLAoJImhpc3RvcmljaG91c2VzLm11c2V1bSIsCgkiaGlzdG9yaXNjaC5tdXNldW0iLAoJImhpc3RvcmlzY2hlcy5tdXNldW0iLAoJImhpc3RvcnkubXVzZXVtIiwKCSJoaXN0b3J5b2ZzY2llbmNlLm11c2V1bSIsCgkiaG9yb2xvZ3kubXVzZXVtIiwKCSJob3VzZS5tdXNldW0iLAoJImh1bWFuaXRpZXMubXVzZXVtIiwKCSJpbGx1c3RyYXRpb24ubXVzZXVtIiwKCSJpbWFnZWFuZHNvdW5kLm11c2V1bSIsCgkiaW5kaWFuLm11c2V1bSIsCgkiaW5kaWFuYS5tdXNldW0iLAoJImluZGlhbmFwb2xpcy5tdXNldW0iLAoJImluZGlhbm1hcmtldC5tdXNldW0iLAoJImludGVsbGlnZW5jZS5tdXNldW0iLAoJImludGVyYWN0aXZlLm11c2V1bSIsCgkiaXJhcS5tdXNldW0iLAoJImlyb24ubXVzZXVtIiwKCSJpc2xlb2ZtYW4ubXVzZXVtIiwKCSJqYW1pc29uLm11c2V1bSIsCgkiamVmZmVyc29uLm11c2V1bSIsCgkiamVydXNhbGVtLm11c2V1bSIsCgkiamV3ZWxyeS5tdXNldW0iLAoJImpld2lzaC5tdXNldW0iLAoJImpld2lzaGFydC5tdXNldW0iLAoJImpmay5tdXNldW0iLAoJImpvdXJuYWxpc20ubXVzZXVtIiwKCSJqdWRhaWNhLm11c2V1bSIsCgkianVkeWdhcmxhbmQubXVzZXVtIiwKCSJqdWVkaXNjaGVzLm11c2V1bSIsCgkianVpZi5tdXNldW0iLAoJImthcmF0ZS5tdXNldW0iLAoJImthcmlrYXR1ci5tdXNldW0iLAoJImtpZHMubXVzZXVtIiwKCSJrb2ViZW5oYXZuLm11c2V1bSIsCgkia29lbG4ubXVzZXVtIiwKCSJrdW5zdC5tdXNldW0iLAoJImt1bnN0c2FtbWx1bmcubXVzZXVtIiwKCSJrdW5zdHVuZGRlc2lnbi5tdXNldW0iLAoJImxhYm9yLm11c2V1bSIsCgkibGFib3VyLm11c2V1bSIsCgkibGFqb2xsYS5tdXNldW0iLAoJImxhbmNhc2hpcmUubXVzZXVtIiwKCSJsYW5kZXMubXVzZXVtIiwKCSJsYW5zLm11c2V1bSIsCgkibMOkbnMubXVzZXVtIiwKCSJsYXJzc29uLm11c2V1bSIsCgkibGV3aXNtaWxsZXIubXVzZXVtIiwKCSJsaW5jb2xuLm11c2V1bSIsCgkibGluei5tdXNldW0iLAoJImxpdmluZy5tdXNldW0iLAoJImxpdmluZ2hpc3RvcnkubXVzZXVtIiwKCSJsb2NhbGhpc3RvcnkubXVzZXVtIiwKCSJsb25kb24ubXVzZXVtIiwKCSJsb3NhbmdlbGVzLm11c2V1bSIsCgkibG91dnJlLm11c2V1bSIsCgkibG95YWxpc3QubXVzZXVtIiwKCSJsdWNlcm5lLm11c2V1bSIsCgkibHV4ZW1ib3VyZy5tdXNldW0iLAoJImx1emVybi5tdXNldW0iLAoJIm1hZC5tdXNldW0iLAoJIm1hZHJpZC5tdXNldW0iLAoJIm1hbGxvcmNhLm11c2V1bSIsCgkibWFuY2hlc3Rlci5tdXNldW0iLAoJIm1hbnNpb24ubXVzZXVtIiwKCSJtYW5zaW9ucy5tdXNldW0iLAoJIm1hbngubXVzZXVtIiwKCSJtYXJidXJnLm11c2V1bSIsCgkibWFyaXRpbWUubXVzZXVtIiwKCSJtYXJpdGltby5tdXNldW0iLAoJIm1hcnlsYW5kLm11c2V1bSIsCgkibWFyeWxodXJzdC5tdXNldW0iLAoJIm1lZGlhLm11c2V1bSIsCgkibWVkaWNhbC5tdXNldW0iLAoJIm1lZGl6aW5oaXN0b3Jpc2NoZXMubXVzZXVtIiwKCSJtZWVyZXMubXVzZXVtIiwKCSJtZW1vcmlhbC5tdXNldW0iLAoJIm1lc2F2ZXJkZS5tdXNldW0iLAoJIm1pY2hpZ2FuLm11c2V1bSIsCgkibWlkYXRsYW50aWMubXVzZXVtIiwKCSJtaWxpdGFyeS5tdXNldW0iLAoJIm1pbGwubXVzZXVtIiwKCSJtaW5lcnMubXVzZXVtIiwKCSJtaW5pbmcubXVzZXVtIiwKCSJtaW5uZXNvdGEubXVzZXVtIiwKCSJtaXNzaWxlLm11c2V1bSIsCgkibWlzc291bGEubXVzZXVtIiwKCSJtb2Rlcm4ubXVzZXVtIiwKCSJtb21hLm11c2V1bSIsCgkibW9uZXkubXVzZXVtIiwKCSJtb25tb3V0aC5tdXNldW0iLAoJIm1vbnRpY2VsbG8ubXVzZXVtIiwKCSJtb250cmVhbC5tdXNldW0iLAoJIm1vc2Nvdy5tdXNldW0iLAoJIm1vdG9yY3ljbGUubXVzZXVtIiwKCSJtdWVuY2hlbi5tdXNldW0iLAoJIm11ZW5zdGVyLm11c2V1bSIsCgkibXVsaG91c2UubXVzZXVtIiwKCSJtdW5jaWUubXVzZXVtIiwKCSJtdXNlZXQubXVzZXVtIiwKCSJtdXNldW1jZW50ZXIubXVzZXVtIiwKCSJtdXNldW12ZXJlbmlnaW5nLm11c2V1bSIsCgkibXVzaWMubXVzZXVtIiwKCSJuYXRpb25hbC5tdXNldW0iLAoJIm5hdGlvbmFsZmlyZWFybXMubXVzZXVtIiwKCSJuYXRpb25hbGhlcml0YWdlLm11c2V1bSIsCgkibmF0aXZlYW1lcmljYW4ubXVzZXVtIiwKCSJuYXR1cmFsaGlzdG9yeS5tdXNldW0iLAoJIm5hdHVyYWxoaXN0b3J5bXVzZXVtLm11c2V1bSIsCgkibmF0dXJhbHNjaWVuY2VzLm11c2V1bSIsCgkibmF0dXJlLm11c2V1bSIsCgkibmF0dXJoaXN0b3Jpc2NoZXMubXVzZXVtIiwKCSJuYXR1dXJ3ZXRlbnNjaGFwcGVuLm11c2V1bSIsCgkibmF1bWJ1cmcubXVzZXVtIiwKCSJuYXZhbC5tdXNldW0iLAoJIm5lYnJhc2thLm11c2V1bSIsCgkibmV1ZXMubXVzZXVtIiwKCSJuZXdoYW1wc2hpcmUubXVzZXVtIiwKCSJuZXdqZXJzZXkubXVzZXVtIiwKCSJuZXdtZXhpY28ubXVzZXVtIiwKCSJuZXdwb3J0Lm11c2V1bSIsCgkibmV3c3BhcGVyLm11c2V1bSIsCgkibmV3eW9yay5tdXNldW0iLAoJIm5pZXBjZS5tdXNldW0iLAoJIm5vcmZvbGsubXVzZXVtIiwKCSJub3J0aC5tdXNldW0iLAoJIm5ydy5tdXNldW0iLAoJIm55Yy5tdXNldW0iLAoJIm55bnkubXVzZXVtIiwKCSJvY2Vhbm9ncmFwaGljLm11c2V1bSIsCgkib2NlYW5vZ3JhcGhpcXVlLm11c2V1bSIsCgkib21haGEubXVzZXVtIiwKCSJvbmxpbmUubXVzZXVtIiwKCSJvbnRhcmlvLm11c2V1bSIsCgkib3BlbmFpci5tdXNldW0iLAoJIm9yZWdvbi5tdXNldW0iLAoJIm9yZWdvbnRyYWlsLm11c2V1bSIsCgkib3RhZ28ubXVzZXVtIiwKCSJveGZvcmQubXVzZXVtIiwKCSJwYWNpZmljLm11c2V1bSIsCgkicGFkZXJib3JuLm11c2V1bSIsCgkicGFsYWNlLm11c2V1bSIsCgkicGFsZW8ubXVzZXVtIiwKCSJwYWxtc3ByaW5ncy5tdXNldW0iLAoJInBhbmFtYS5tdXNldW0iLAoJInBhcmlzLm11c2V1bSIsCgkicGFzYWRlbmEubXVzZXVtIiwKCSJwaGFybWFjeS5tdXNldW0iLAoJInBoaWxhZGVscGhpYS5tdXNldW0iLAoJInBoaWxhZGVscGhpYWFyZWEubXVzZXVtIiwKCSJwaGlsYXRlbHkubXVzZXVtIiwKCSJwaG9lbml4Lm11c2V1bSIsCgkicGhvdG9ncmFwaHkubXVzZXVtIiwKCSJwaWxvdHMubXVzZXVtIiwKCSJwaXR0c2J1cmdoLm11c2V1bSIsCgkicGxhbmV0YXJpdW0ubXVzZXVtIiwKCSJwbGFudGF0aW9uLm11c2V1bSIsCgkicGxhbnRzLm11c2V1bSIsCgkicGxhemEubXVzZXVtIiwKCSJwb3J0YWwubXVzZXVtIiwKCSJwb3J0bGFuZC5tdXNldW0iLAoJInBvcnRsbGlnYXQubXVzZXVtIiwKCSJwb3N0cy1hbmQtdGVsZWNvbW11bmljYXRpb25zLm11c2V1bSIsCgkicHJlc2VydmF0aW9uLm11c2V1bSIsCgkicHJlc2lkaW8ubXVzZXVtIiwKCSJwcmVzcy5tdXNldW0iLAoJInByb2plY3QubXVzZXVtIiwKCSJwdWJsaWMubXVzZXVtIiwKCSJwdWJvbC5tdXNldW0iLAoJInF1ZWJlYy5tdXNldW0iLAoJInJhaWxyb2FkLm11c2V1bSIsCgkicmFpbHdheS5tdXNldW0iLAoJInJlc2VhcmNoLm11c2V1bSIsCgkicmVzaXN0YW5jZS5tdXNldW0iLAoJInJpb2RlamFuZWlyby5tdXNldW0iLAoJInJvY2hlc3Rlci5tdXNldW0iLAoJInJvY2thcnQubXVzZXVtIiwKCSJyb21hLm11c2V1bSIsCgkicnVzc2lhLm11c2V1bSIsCgkic2FpbnRsb3Vpcy5tdXNldW0iLAoJInNhbGVtLm11c2V1bSIsCgkic2FsdmFkb3JkYWxpLm11c2V1bSIsCgkic2FsemJ1cmcubXVzZXVtIiwKCSJzYW5kaWVnby5tdXNldW0iLAoJInNhbmZyYW5jaXNjby5tdXNldW0iLAoJInNhbnRhYmFyYmFyYS5tdXNldW0iLAoJInNhbnRhY3J1ei5tdXNldW0iLAoJInNhbnRhZmUubXVzZXVtIiwKCSJzYXNrYXRjaGV3YW4ubXVzZXVtIiwKCSJzYXR4Lm11c2V1bSIsCgkic2F2YW5uYWhnYS5tdXNldW0iLAoJInNjaGxlc2lzY2hlcy5tdXNldW0iLAoJInNjaG9lbmJydW5uLm11c2V1bSIsCgkic2Nob2tvbGFkZW4ubXVzZXVtIiwKCSJzY2hvb2wubXVzZXVtIiwKCSJzY2h3ZWl6Lm11c2V1bSIsCgkic2NpZW5jZS5tdXNldW0iLAoJInNjaWVuY2VhbmRoaXN0b3J5Lm11c2V1bSIsCgkic2NpZW5jZWFuZGluZHVzdHJ5Lm11c2V1bSIsCgkic2NpZW5jZWNlbnRlci5tdXNldW0iLAoJInNjaWVuY2VjZW50ZXJzLm11c2V1bSIsCgkic2NpZW5jZS1maWN0aW9uLm11c2V1bSIsCgkic2NpZW5jZWhpc3RvcnkubXVzZXVtIiwKCSJzY2llbmNlcy5tdXNldW0iLAoJInNjaWVuY2VzbmF0dXJlbGxlcy5tdXNldW0iLAoJInNjb3RsYW5kLm11c2V1bSIsCgkic2VhcG9ydC5tdXNldW0iLAoJInNldHRsZW1lbnQubXVzZXVtIiwKCSJzZXR0bGVycy5tdXNldW0iLAoJInNoZWxsLm11c2V1bSIsCgkic2hlcmJyb29rZS5tdXNldW0iLAoJInNpYmVuaWsubXVzZXVtIiwKCSJzaWxrLm11c2V1bSIsCgkic2tpLm11c2V1bSIsCgkic2tvbGUubXVzZXVtIiwKCSJzb2NpZXR5Lm11c2V1bSIsCgkic29sb2duZS5tdXNldW0iLAoJInNvdW5kYW5kdmlzaW9uLm11c2V1bSIsCgkic291dGhjYXJvbGluYS5tdXNldW0iLAoJInNvdXRod2VzdC5tdXNldW0iLAoJInNwYWNlLm11c2V1bSIsCgkic3B5Lm11c2V1bSIsCgkic3F1YXJlLm11c2V1bSIsCgkic3RhZHQubXVzZXVtIiwKCSJzdGFsYmFucy5tdXNldW0iLAoJInN0YXJuYmVyZy5tdXNldW0iLAoJInN0YXRlLm11c2V1bSIsCgkic3RhdGVvZmRlbGF3YXJlLm11c2V1bSIsCgkic3RhdGlvbi5tdXNldW0iLAoJInN0ZWFtLm11c2V1bSIsCgkic3RlaWVybWFyay5tdXNldW0iLAoJInN0am9obi5tdXNldW0iLAoJInN0b2NraG9sbS5tdXNldW0iLAoJInN0cGV0ZXJzYnVyZy5tdXNldW0iLAoJInN0dXR0Z2FydC5tdXNldW0iLAoJInN1aXNzZS5tdXNldW0iLAoJInN1cmdlb25zaGFsbC5tdXNldW0iLAoJInN1cnJleS5tdXNldW0iLAoJInN2aXp6ZXJhLm11c2V1bSIsCgkic3dlZGVuLm11c2V1bSIsCgkic3lkbmV5Lm11c2V1bSIsCgkidGFuay5tdXNldW0iLAoJInRjbS5tdXNldW0iLAoJInRlY2hub2xvZ3kubXVzZXVtIiwKCSJ0ZWxla29tbXVuaWthdGlvbi5tdXNldW0iLAoJInRlbGV2aXNpb24ubXVzZXVtIiwKCSJ0ZXhhcy5tdXNldW0iLAoJInRleHRpbGUubXVzZXVtIiwKCSJ0aGVhdGVyLm11c2V1bSIsCgkidGltZS5tdXNldW0iLAoJInRpbWVrZWVwaW5nLm11c2V1bSIsCgkidG9wb2xvZ3kubXVzZXVtIiwKCSJ0b3Jpbm8ubXVzZXVtIiwKCSJ0b3VjaC5tdXNldW0iLAoJInRvd24ubXVzZXVtIiwKCSJ0cmFuc3BvcnQubXVzZXVtIiwKCSJ0cmVlLm11c2V1bSIsCgkidHJvbGxleS5tdXNldW0iLAoJInRydXN0Lm11c2V1bSIsCgkidHJ1c3RlZS5tdXNldW0iLAoJInVocmVuLm11c2V1bSIsCgkidWxtLm11c2V1bSIsCgkidW5kZXJzZWEubXVzZXVtIiwKCSJ1bml2ZXJzaXR5Lm11c2V1bSIsCgkidXNhLm11c2V1bSIsCgkidXNhbnRpcXVlcy5tdXNldW0iLAoJInVzYXJ0cy5tdXNldW0iLAoJInVzY291bnRyeWVzdGF0ZS5tdXNldW0iLAoJInVzY3VsdHVyZS5tdXNldW0iLAoJInVzZGVjb3JhdGl2ZWFydHMubXVzZXVtIiwKCSJ1c2dhcmRlbi5tdXNldW0iLAoJInVzaGlzdG9yeS5tdXNldW0iLAoJInVzaHVhaWEubXVzZXVtIiwKCSJ1c2xpdmluZ2hpc3RvcnkubXVzZXVtIiwKCSJ1dGFoLm11c2V1bSIsCgkidXZpYy5tdXNldW0iLAoJInZhbGxleS5tdXNldW0iLAoJInZhbnRhYS5tdXNldW0iLAoJInZlcnNhaWxsZXMubXVzZXVtIiwKCSJ2aWtpbmcubXVzZXVtIiwKCSJ2aWxsYWdlLm11c2V1bSIsCgkidmlyZ2luaWEubXVzZXVtIiwKCSJ2aXJ0dWFsLm11c2V1bSIsCgkidmlydHVlbC5tdXNldW0iLAoJInZsYWFuZGVyZW4ubXVzZXVtIiwKCSJ2b2xrZW5rdW5kZS5tdXNldW0iLAoJIndhbGVzLm11c2V1bSIsCgkid2FsbG9uaWUubXVzZXVtIiwKCSJ3YXIubXVzZXVtIiwKCSJ3YXNoaW5ndG9uZGMubXVzZXVtIiwKCSJ3YXRjaGFuZGNsb2NrLm11c2V1bSIsCgkid2F0Y2gtYW5kLWNsb2NrLm11c2V1bSIsCgkid2VzdGVybi5tdXNldW0iLAoJIndlc3RmYWxlbi5tdXNldW0iLAoJIndoYWxpbmcubXVzZXVtIiwKCSJ3aWxkbGlmZS5tdXNldW0iLAoJIndpbGxpYW1zYnVyZy5tdXNldW0iLAoJIndpbmRtaWxsLm11c2V1bSIsCgkid29ya3Nob3AubXVzZXVtIiwKCSJ5b3JrLm11c2V1bSIsCgkieW9ya3NoaXJlLm11c2V1bSIsCgkieW9zZW1pdGUubXVzZXVtIiwKCSJ5b3V0aC5tdXNldW0iLAoJInpvb2xvZ2ljYWwubXVzZXVtIiwKCSJ6b29sb2d5Lm11c2V1bSIsCgki15nXqNeV16nXnNeZ150ubXVzZXVtIiwKCSLQuNC60L7QvC5tdXNldW0iLAoJIm12IiwKCSJhZXJvLm12IiwKCSJiaXoubXYiLAoJImNvbS5tdiIsCgkiY29vcC5tdiIsCgkiZWR1Lm12IiwKCSJnb3YubXYiLAoJImluZm8ubXYiLAoJImludC5tdiIsCgkibWlsLm12IiwKCSJtdXNldW0ubXYiLAoJIm5hbWUubXYiLAoJIm5ldC5tdiIsCgkib3JnLm12IiwKCSJwcm8ubXYiLAoJIm13IiwKCSJhYy5tdyIsCgkiYml6Lm13IiwKCSJjby5tdyIsCgkiY29tLm13IiwKCSJjb29wLm13IiwKCSJlZHUubXciLAoJImdvdi5tdyIsCgkiaW50Lm13IiwKCSJtdXNldW0ubXciLAoJIm5ldC5tdyIsCgkib3JnLm13IiwKCSJteCIsCgkiY29tLm14IiwKCSJvcmcubXgiLAoJImdvYi5teCIsCgkiZWR1Lm14IiwKCSJuZXQubXgiLAoJIm15IiwKCSJiaXoubXkiLAoJImNvbS5teSIsCgkiZWR1Lm15IiwKCSJnb3YubXkiLAoJIm1pbC5teSIsCgkibmFtZS5teSIsCgkibmV0Lm15IiwKCSJvcmcubXkiLAoJIm16IiwKCSJhYy5teiIsCgkiYWR2Lm16IiwKCSJjby5teiIsCgkiZWR1Lm16IiwKCSJnb3YubXoiLAoJIm1pbC5teiIsCgkibmV0Lm16IiwKCSJvcmcubXoiLAoJIm5hIiwKCSJpbmZvLm5hIiwKCSJwcm8ubmEiLAoJIm5hbWUubmEiLAoJInNjaG9vbC5uYSIsCgkib3IubmEiLAoJImRyLm5hIiwKCSJ1cy5uYSIsCgkibXgubmEiLAoJImNhLm5hIiwKCSJpbi5uYSIsCgkiY2MubmEiLAoJInR2Lm5hIiwKCSJ3cy5uYSIsCgkibW9iaS5uYSIsCgkiY28ubmEiLAoJImNvbS5uYSIsCgkib3JnLm5hIiwKCSJuYW1lIiwKCSJuYyIsCgkiYXNzby5uYyIsCgkibm9tLm5jIiwKCSJuZSIsCgkibmV0IiwKCSJuZiIsCgkiY29tLm5mIiwKCSJuZXQubmYiLAoJInBlci5uZiIsCgkicmVjLm5mIiwKCSJ3ZWIubmYiLAoJImFydHMubmYiLAoJImZpcm0ubmYiLAoJImluZm8ubmYiLAoJIm90aGVyLm5mIiwKCSJzdG9yZS5uZiIsCgkibmciLAoJImNvbS5uZyIsCgkiZWR1Lm5nIiwKCSJnb3YubmciLAoJImkubmciLAoJIm1pbC5uZyIsCgkibW9iaS5uZyIsCgkibmFtZS5uZyIsCgkibmV0Lm5nIiwKCSJvcmcubmciLAoJInNjaC5uZyIsCgkibmkiLAoJImFjLm5pIiwKCSJiaXoubmkiLAoJImNvLm5pIiwKCSJjb20ubmkiLAoJImVkdS5uaSIsCgkiZ29iLm5pIiwKCSJpbi5uaSIsCgkiaW5mby5uaSIsCgkiaW50Lm5pIiwKCSJtaWwubmkiLAoJIm5ldC5uaSIsCgkibm9tLm5pIiwKCSJvcmcubmkiLAoJIndlYi5uaSIsCgkibmwiLAoJIm5vIiwKCSJmaHMubm8iLAoJInZncy5ubyIsCgkiZnlsa2VzYmlibC5ubyIsCgkiZm9sa2ViaWJsLm5vIiwKCSJtdXNldW0ubm8iLAoJImlkcmV0dC5ubyIsCgkicHJpdi5ubyIsCgkibWlsLm5vIiwKCSJzdGF0Lm5vIiwKCSJkZXAubm8iLAoJImtvbW11bmUubm8iLAoJImhlcmFkLm5vIiwKCSJhYS5ubyIsCgkiYWgubm8iLAoJImJ1Lm5vIiwKCSJmbS5ubyIsCgkiaGwubm8iLAoJImhtLm5vIiwKCSJqYW4tbWF5ZW4ubm8iLAoJIm1yLm5vIiwKCSJubC5ubyIsCgkibnQubm8iLAoJIm9mLm5vIiwKCSJvbC5ubyIsCgkib3Nsby5ubyIsCgkicmwubm8iLAoJInNmLm5vIiwKCSJzdC5ubyIsCgkic3ZhbGJhcmQubm8iLAoJInRtLm5vIiwKCSJ0ci5ubyIsCgkidmEubm8iLAoJInZmLm5vIiwKCSJncy5hYS5ubyIsCgkiZ3MuYWgubm8iLAoJImdzLmJ1Lm5vIiwKCSJncy5mbS5ubyIsCgkiZ3MuaGwubm8iLAoJImdzLmhtLm5vIiwKCSJncy5qYW4tbWF5ZW4ubm8iLAoJImdzLm1yLm5vIiwKCSJncy5ubC5ubyIsCgkiZ3MubnQubm8iLAoJImdzLm9mLm5vIiwKCSJncy5vbC5ubyIsCgkiZ3Mub3Nsby5ubyIsCgkiZ3Mucmwubm8iLAoJImdzLnNmLm5vIiwKCSJncy5zdC5ubyIsCgkiZ3Muc3ZhbGJhcmQubm8iLAoJImdzLnRtLm5vIiwKCSJncy50ci5ubyIsCgkiZ3MudmEubm8iLAoJImdzLnZmLm5vIiwKCSJha3JlaGFtbi5ubyIsCgkiw6VrcmVoYW1uLm5vIiwKCSJhbGdhcmQubm8iLAoJIsOlbGfDpXJkLm5vIiwKCSJhcm5hLm5vIiwKCSJicnVtdW5kZGFsLm5vIiwKCSJicnluZS5ubyIsCgkiYnJvbm5veXN1bmQubm8iLAoJImJyw7hubsO4eXN1bmQubm8iLAoJImRyb2Jhay5ubyIsCgkiZHLDuGJhay5ubyIsCgkiZWdlcnN1bmQubm8iLAoJImZldHN1bmQubm8iLAoJImZsb3JvLm5vIiwKCSJmbG9yw7gubm8iLAoJImZyZWRyaWtzdGFkLm5vIiwKCSJob2trc3VuZC5ubyIsCgkiaG9uZWZvc3Mubm8iLAoJImjDuG5lZm9zcy5ubyIsCgkiamVzc2hlaW0ubm8iLAoJImpvcnBlbGFuZC5ubyIsCgkiasO4cnBlbGFuZC5ubyIsCgkia2lya2VuZXMubm8iLAoJImtvcGVydmlrLm5vIiwKCSJrcm9rc3RhZGVsdmEubm8iLAoJImxhbmdldmFnLm5vIiwKCSJsYW5nZXbDpWcubm8iLAoJImxlaXJ2aWsubm8iLAoJIm1qb25kYWxlbi5ubyIsCgkibWrDuG5kYWxlbi5ubyIsCgkibW8taS1yYW5hLm5vIiwKCSJtb3Nqb2VuLm5vIiwKCSJtb3Nqw7hlbi5ubyIsCgkibmVzb2RkdGFuZ2VuLm5vIiwKCSJvcmthbmdlci5ubyIsCgkib3NveXJvLm5vIiwKCSJvc8O4eXJvLm5vIiwKCSJyYWhvbHQubm8iLAoJInLDpWhvbHQubm8iLAoJInNhbmRuZXNzam9lbi5ubyIsCgkic2FuZG5lc3Nqw7hlbi5ubyIsCgkic2tlZHNtb2tvcnNldC5ubyIsCgkic2xhdHR1bS5ubyIsCgkic3BqZWxrYXZpay5ubyIsCgkic3RhdGhlbGxlLm5vIiwKCSJzdGF2ZXJuLm5vIiwKCSJzdGpvcmRhbHNoYWxzZW4ubm8iLAoJInN0asO4cmRhbHNoYWxzZW4ubm8iLAoJInRhbmFuZ2VyLm5vIiwKCSJ0cmFuYnkubm8iLAoJInZvc3NldmFuZ2VuLm5vIiwKCSJhZmpvcmQubm8iLAoJIsOlZmpvcmQubm8iLAoJImFnZGVuZXMubm8iLAoJImFsLm5vIiwKCSLDpWwubm8iLAoJImFsZXN1bmQubm8iLAoJIsOlbGVzdW5kLm5vIiwKCSJhbHN0YWhhdWcubm8iLAoJImFsdGEubm8iLAoJIsOhbHTDoS5ubyIsCgkiYWxhaGVhZGp1Lm5vIiwKCSLDoWxhaGVhZGp1Lm5vIiwKCSJhbHZkYWwubm8iLAoJImFtbGkubm8iLAoJIsOlbWxpLm5vIiwKCSJhbW90Lm5vIiwKCSLDpW1vdC5ubyIsCgkiYW5kZWJ1Lm5vIiwKCSJhbmRveS5ubyIsCgkiYW5kw7h5Lm5vIiwKCSJhbmRhc3VvbG8ubm8iLAoJImFyZGFsLm5vIiwKCSLDpXJkYWwubm8iLAoJImFyZW1hcmsubm8iLAoJImFyZW5kYWwubm8iLAoJIsOlcy5ubyIsCgkiYXNlcmFsLm5vIiwKCSLDpXNlcmFsLm5vIiwKCSJhc2tlci5ubyIsCgkiYXNraW0ubm8iLAoJImFza3ZvbGwubm8iLAoJImFza295Lm5vIiwKCSJhc2vDuHkubm8iLAoJImFzbmVzLm5vIiwKCSLDpXNuZXMubm8iLAoJImF1ZG5lZGFsbi5ubyIsCgkiYXVrcmEubm8iLAoJImF1cmUubm8iLAoJImF1cmxhbmQubm8iLAoJImF1cnNrb2ctaG9sYW5kLm5vIiwKCSJhdXJza29nLWjDuGxhbmQubm8iLAoJImF1c3Rldm9sbC5ubyIsCgkiYXVzdHJoZWltLm5vIiwKCSJhdmVyb3kubm8iLAoJImF2ZXLDuHkubm8iLAoJImJhbGVzdHJhbmQubm8iLAoJImJhbGxhbmdlbi5ubyIsCgkiYmFsYXQubm8iLAoJImLDoWzDoXQubm8iLAoJImJhbHNmam9yZC5ubyIsCgkiYmFoY2NhdnVvdG5hLm5vIiwKCSJiw6FoY2NhdnVvdG5hLm5vIiwKCSJiYW1ibGUubm8iLAoJImJhcmR1Lm5vIiwKCSJiZWFyZHUubm8iLAoJImJlaWFybi5ubyIsCgkiYmFqZGRhci5ubyIsCgkiYsOhamRkYXIubm8iLAoJImJhaWRhci5ubyIsCgkiYsOhaWTDoXIubm8iLAoJImJlcmcubm8iLAoJImJlcmdlbi5ubyIsCgkiYmVybGV2YWcubm8iLAoJImJlcmxldsOlZy5ubyIsCgkiYmVhcmFsdmFoa2kubm8iLAoJImJlYXJhbHbDoWhraS5ubyIsCgkiYmluZGFsLm5vIiwKCSJiaXJrZW5lcy5ubyIsCgkiYmphcmtveS5ubyIsCgkiYmphcmvDuHkubm8iLAoJImJqZXJrcmVpbS5ubyIsCgkiYmp1Z24ubm8iLAoJImJvZG8ubm8iLAoJImJvZMO4Lm5vIiwKCSJiYWRhZGRqYS5ubyIsCgkiYsOlZMOlZGRqw6Uubm8iLAoJImJ1ZGVqanUubm8iLAoJImJva24ubm8iLAoJImJyZW1hbmdlci5ubyIsCgkiYnJvbm5veS5ubyIsCgkiYnLDuG5uw7h5Lm5vIiwKCSJieWdsYW5kLm5vIiwKCSJieWtsZS5ubyIsCgkiYmFydW0ubm8iLAoJImLDpnJ1bS5ubyIsCgkiYm8udGVsZW1hcmsubm8iLAoJImLDuC50ZWxlbWFyay5ubyIsCgkiYm8ubm9yZGxhbmQubm8iLAoJImLDuC5ub3JkbGFuZC5ubyIsCgkiYmlldmF0Lm5vIiwKCSJiaWV2w6F0Lm5vIiwKCSJib21sby5ubyIsCgkiYsO4bWxvLm5vIiwKCSJiYXRzZmpvcmQubm8iLAoJImLDpXRzZmpvcmQubm8iLAoJImJhaGNhdnVvdG5hLm5vIiwKCSJiw6FoY2F2dW90bmEubm8iLAoJImRvdnJlLm5vIiwKCSJkcmFtbWVuLm5vIiwKCSJkcmFuZ2VkYWwubm8iLAoJImR5cm95Lm5vIiwKCSJkeXLDuHkubm8iLAoJImRvbm5hLm5vIiwKCSJkw7hubmEubm8iLAoJImVpZC5ubyIsCgkiZWlkZmpvcmQubm8iLAoJImVpZHNiZXJnLm5vIiwKCSJlaWRza29nLm5vIiwKCSJlaWRzdm9sbC5ubyIsCgkiZWlnZXJzdW5kLm5vIiwKCSJlbHZlcnVtLm5vIiwKCSJlbmViYWtrLm5vIiwKCSJlbmdlcmRhbC5ubyIsCgkiZXRuZS5ubyIsCgkiZXRuZWRhbC5ubyIsCgkiZXZlbmVzLm5vIiwKCSJldmVuYXNzaS5ubyIsCgkiZXZlbsOhxaHFoWkubm8iLAoJImV2amUtb2ctaG9ybm5lcy5ubyIsCgkiZmFyc3VuZC5ubyIsCgkiZmF1c2tlLm5vIiwKCSJmdW9zc2tvLm5vIiwKCSJmdW9pc2t1Lm5vIiwKCSJmZWRqZS5ubyIsCgkiZmV0Lm5vIiwKCSJmaW5ub3kubm8iLAoJImZpbm7DuHkubm8iLAoJImZpdGphci5ubyIsCgkiZmphbGVyLm5vIiwKCSJmamVsbC5ubyIsCgkiZmxha3N0YWQubm8iLAoJImZsYXRhbmdlci5ubyIsCgkiZmxla2tlZmpvcmQubm8iLAoJImZsZXNiZXJnLm5vIiwKCSJmbG9yYS5ubyIsCgkiZmxhLm5vIiwKCSJmbMOlLm5vIiwKCSJmb2xsZGFsLm5vIiwKCSJmb3JzYW5kLm5vIiwKCSJmb3NuZXMubm8iLAoJImZyZWkubm8iLAoJImZyb2duLm5vIiwKCSJmcm9sYW5kLm5vIiwKCSJmcm9zdGEubm8iLAoJImZyYW5hLm5vIiwKCSJmcsOmbmEubm8iLAoJImZyb3lhLm5vIiwKCSJmcsO4eWEubm8iLAoJImZ1c2Eubm8iLAoJImZ5cmVzZGFsLm5vIiwKCSJmb3JkZS5ubyIsCgkiZsO4cmRlLm5vIiwKCSJnYW12aWsubm8iLAoJImdhbmdhdmlpa2Eubm8iLAoJImfDocWLZ2F2aWlrYS5ubyIsCgkiZ2F1bGFyLm5vIiwKCSJnYXVzZGFsLm5vIiwKCSJnaWxkZXNrYWwubm8iLAoJImdpbGRlc2vDpWwubm8iLAoJImdpc2tlLm5vIiwKCSJnamVtbmVzLm5vIiwKCSJnamVyZHJ1bS5ubyIsCgkiZ2plcnN0YWQubm8iLAoJImdqZXNkYWwubm8iLAoJImdqb3Zpay5ubyIsCgkiZ2rDuHZpay5ubyIsCgkiZ2xvcHBlbi5ubyIsCgkiZ29sLm5vIiwKCSJncmFuLm5vIiwKCSJncmFuZS5ubyIsCgkiZ3JhbnZpbi5ubyIsCgkiZ3JhdGFuZ2VuLm5vIiwKCSJncmltc3RhZC5ubyIsCgkiZ3Jvbmcubm8iLAoJImtyYWFuZ2hrZS5ubyIsCgkia3LDpWFuZ2hrZS5ubyIsCgkiZ3J1ZS5ubyIsCgkiZ3VsZW4ubm8iLAoJImhhZHNlbC5ubyIsCgkiaGFsZGVuLm5vIiwKCSJoYWxzYS5ubyIsCgkiaGFtYXIubm8iLAoJImhhbWFyb3kubm8iLAoJImhhYm1lci5ubyIsCgkiaMOhYm1lci5ubyIsCgkiaGFwbWlyLm5vIiwKCSJow6FwbWlyLm5vIiwKCSJoYW1tZXJmZXN0Lm5vIiwKCSJoYW1tYXJmZWFzdGEubm8iLAoJImjDoW1tw6FyZmVhc3RhLm5vIiwKCSJoYXJhbS5ubyIsCgkiaGFyZWlkLm5vIiwKCSJoYXJzdGFkLm5vIiwKCSJoYXN2aWsubm8iLAoJImFrbm9sdW9rdGEubm8iLAoJIsOha8WLb2x1b2t0YS5ubyIsCgkiaGF0dGZqZWxsZGFsLm5vIiwKCSJhYXJib3J0ZS5ubyIsCgkiaGF1Z2VzdW5kLm5vIiwKCSJoZW1uZS5ubyIsCgkiaGVtbmVzLm5vIiwKCSJoZW1zZWRhbC5ubyIsCgkiaGVyb3kubW9yZS1vZy1yb21zZGFsLm5vIiwKCSJoZXLDuHkubcO4cmUtb2ctcm9tc2RhbC5ubyIsCgkiaGVyb3kubm9yZGxhbmQubm8iLAoJImhlcsO4eS5ub3JkbGFuZC5ubyIsCgkiaGl0cmEubm8iLAoJImhqYXJ0ZGFsLm5vIiwKCSJoamVsbWVsYW5kLm5vIiwKCSJob2JvbC5ubyIsCgkiaG9iw7hsLm5vIiwKCSJob2Yubm8iLAoJImhvbC5ubyIsCgkiaG9sZS5ubyIsCgkiaG9sbWVzdHJhbmQubm8iLAoJImhvbHRhbGVuLm5vIiwKCSJob2x0w6VsZW4ubm8iLAoJImhvcm5pbmRhbC5ubyIsCgkiaG9ydGVuLm5vIiwKCSJodXJkYWwubm8iLAoJImh1cnVtLm5vIiwKCSJodmFsZXIubm8iLAoJImh5bGxlc3RhZC5ubyIsCgkiaGFnZWJvc3RhZC5ubyIsCgkiaMOmZ2Vib3N0YWQubm8iLAoJImhveWFuZ2VyLm5vIiwKCSJow7h5YW5nZXIubm8iLAoJImhveWxhbmRldC5ubyIsCgkiaMO4eWxhbmRldC5ubyIsCgkiaGEubm8iLAoJImjDpS5ubyIsCgkiaWJlc3RhZC5ubyIsCgkiaW5kZXJveS5ubyIsCgkiaW5kZXLDuHkubm8iLAoJIml2ZWxhbmQubm8iLAoJImpldm5ha2VyLm5vIiwKCSJqb25kYWwubm8iLAoJImpvbHN0ZXIubm8iLAoJImrDuGxzdGVyLm5vIiwKCSJrYXJhc2pvay5ubyIsCgkia2FyYXNqb2hrYS5ubyIsCgkia8OhcsOhxaFqb2hrYS5ubyIsCgkia2FybHNveS5ubyIsCgkiZ2Fsc2Eubm8iLAoJImfDoWxzw6Eubm8iLAoJImthcm1veS5ubyIsCgkia2FybcO4eS5ubyIsCgkia2F1dG9rZWluby5ubyIsCgkiZ3VvdmRhZ2VhaWRudS5ubyIsCgkia2xlcHAubm8iLAoJImtsYWJ1Lm5vIiwKCSJrbMOmYnUubm8iLAoJImtvbmdzYmVyZy5ubyIsCgkia29uZ3N2aW5nZXIubm8iLAoJImtyYWdlcm8ubm8iLAoJImtyYWdlcsO4Lm5vIiwKCSJrcmlzdGlhbnNhbmQubm8iLAoJImtyaXN0aWFuc3VuZC5ubyIsCgkia3JvZHNoZXJhZC5ubyIsCgkia3LDuGRzaGVyYWQubm8iLAoJImt2YWxzdW5kLm5vIiwKCSJyYWhra2VyYXZqdS5ubyIsCgkicsOhaGtrZXLDoXZqdS5ubyIsCgkia3ZhbS5ubyIsCgkia3ZpbmVzZGFsLm5vIiwKCSJrdmlubmhlcmFkLm5vIiwKCSJrdml0ZXNlaWQubm8iLAoJImt2aXRzb3kubm8iLAoJImt2aXRzw7h5Lm5vIiwKCSJrdmFmam9yZC5ubyIsCgkia3bDpmZqb3JkLm5vIiwKCSJnaWVodGF2dW9hdG5hLm5vIiwKCSJrdmFuYW5nZW4ubm8iLAoJImt2w6ZuYW5nZW4ubm8iLAoJIm5hdnVvdG5hLm5vIiwKCSJuw6F2dW90bmEubm8iLAoJImthZmpvcmQubm8iLAoJImvDpWZqb3JkLm5vIiwKCSJnYWl2dW90bmEubm8iLAoJImfDoWl2dW90bmEubm8iLAoJImxhcnZpay5ubyIsCgkibGF2YW5nZW4ubm8iLAoJImxhdmFnaXMubm8iLAoJImxvYWJhdC5ubyIsCgkibG9hYsOhdC5ubyIsCgkibGViZXNieS5ubyIsCgkiZGF2dmVzaWlkYS5ubyIsCgkibGVpa2FuZ2VyLm5vIiwKCSJsZWlyZmpvcmQubm8iLAoJImxla2Eubm8iLAoJImxla3N2aWsubm8iLAoJImxlbnZpay5ubyIsCgkibGVhbmdhdmlpa2Eubm8iLAoJImxlYcWLZ2F2aWlrYS5ubyIsCgkibGVzamEubm8iLAoJImxldmFuZ2VyLm5vIiwKCSJsaWVyLm5vIiwKCSJsaWVybmUubm8iLAoJImxpbGxlaGFtbWVyLm5vIiwKCSJsaWxsZXNhbmQubm8iLAoJImxpbmRlc25lcy5ubyIsCgkibGluZGFzLm5vIiwKCSJsaW5kw6VzLm5vIiwKCSJsb20ubm8iLAoJImxvcHBhLm5vIiwKCSJsYWhwcGkubm8iLAoJImzDoWhwcGkubm8iLAoJImx1bmQubm8iLAoJImx1bm5lci5ubyIsCgkibHVyb3kubm8iLAoJImx1csO4eS5ubyIsCgkibHVzdGVyLm5vIiwKCSJseW5nZGFsLm5vIiwKCSJseW5nZW4ubm8iLAoJIml2Z3Uubm8iLAoJImxhcmRhbC5ubyIsCgkibGVyZGFsLm5vIiwKCSJsw6ZyZGFsLm5vIiwKCSJsb2Rpbmdlbi5ubyIsCgkibMO4ZGluZ2VuLm5vIiwKCSJsb3JlbnNrb2cubm8iLAoJImzDuHJlbnNrb2cubm8iLAoJImxvdGVuLm5vIiwKCSJsw7h0ZW4ubm8iLAoJIm1hbHZpay5ubyIsCgkibWFzb3kubm8iLAoJIm3DpXPDuHkubm8iLAoJIm11b3NhdC5ubyIsCgkibXVvc8OhdC5ubyIsCgkibWFuZGFsLm5vIiwKCSJtYXJrZXIubm8iLAoJIm1hcm5hcmRhbC5ubyIsCgkibWFzZmpvcmRlbi5ubyIsCgkibWVsYW5kLm5vIiwKCSJtZWxkYWwubm8iLAoJIm1lbGh1cy5ubyIsCgkibWVsb3kubm8iLAoJIm1lbMO4eS5ubyIsCgkibWVyYWtlci5ubyIsCgkibWVyw6VrZXIubm8iLAoJIm1vYXJla2Uubm8iLAoJIm1vw6VyZWtlLm5vIiwKCSJtaWRzdW5kLm5vIiwKCSJtaWR0cmUtZ2F1bGRhbC5ubyIsCgkibW9kYWxlbi5ubyIsCgkibW9kdW0ubm8iLAoJIm1vbGRlLm5vIiwKCSJtb3NrZW5lcy5ubyIsCgkibW9zcy5ubyIsCgkibW9zdmlrLm5vIiwKCSJtYWxzZWx2Lm5vIiwKCSJtw6Vsc2Vsdi5ubyIsCgkibWFsYXR2dW9wbWkubm8iLAoJIm3DoWxhdHZ1b3BtaS5ubyIsCgkibmFtZGFsc2VpZC5ubyIsCgkiYWVqcmllLm5vIiwKCSJuYW1zb3Mubm8iLAoJIm5hbXNza29nYW4ubm8iLAoJIm5hYW1lc2pldnVlbWllLm5vIiwKCSJuw6XDpW1lc2pldnVlbWllLm5vIiwKCSJsYWFrZXN2dWVtaWUubm8iLAoJIm5hbm5lc3RhZC5ubyIsCgkibmFydmlrLm5vIiwKCSJuYXJ2aWlrYS5ubyIsCgkibmF1c3RkYWwubm8iLAoJIm5lZHJlLWVpa2VyLm5vIiwKCSJuZXMuYWtlcnNodXMubm8iLAoJIm5lcy5idXNrZXJ1ZC5ubyIsCgkibmVzbmEubm8iLAoJIm5lc29kZGVuLm5vIiwKCSJuZXNzZWJ5Lm5vIiwKCSJ1bmphcmdhLm5vIiwKCSJ1bmrDoXJnYS5ubyIsCgkibmVzc2V0Lm5vIiwKCSJuaXNzZWRhbC5ubyIsCgkibml0dGVkYWwubm8iLAoJIm5vcmQtYXVyZGFsLm5vIiwKCSJub3JkLWZyb24ubm8iLAoJIm5vcmQtb2RhbC5ubyIsCgkibm9yZGRhbC5ubyIsCgkibm9yZGthcHAubm8iLAoJImRhdnZlbmphcmdhLm5vIiwKCSJkYXZ2ZW5qw6FyZ2Eubm8iLAoJIm5vcmRyZS1sYW5kLm5vIiwKCSJub3JkcmVpc2Eubm8iLAoJInJhaXNhLm5vIiwKCSJyw6Fpc2Eubm8iLAoJIm5vcmUtb2ctdXZkYWwubm8iLAoJIm5vdG9kZGVuLm5vIiwKCSJuYXJveS5ubyIsCgkibsOmcsO4eS5ubyIsCgkibm90dGVyb3kubm8iLAoJIm7DuHR0ZXLDuHkubm8iLAoJIm9kZGEubm8iLAoJIm9rc25lcy5ubyIsCgkiw7hrc25lcy5ubyIsCgkib3BwZGFsLm5vIiwKCSJvcHBlZ2FyZC5ubyIsCgkib3BwZWfDpXJkLm5vIiwKCSJvcmtkYWwubm8iLAoJIm9ybGFuZC5ubyIsCgkiw7hybGFuZC5ubyIsCgkib3Jza29nLm5vIiwKCSLDuHJza29nLm5vIiwKCSJvcnN0YS5ubyIsCgkiw7hyc3RhLm5vIiwKCSJvcy5oZWRtYXJrLm5vIiwKCSJvcy5ob3JkYWxhbmQubm8iLAoJIm9zZW4ubm8iLAoJIm9zdGVyb3kubm8iLAoJIm9zdGVyw7h5Lm5vIiwKCSJvc3RyZS10b3Rlbi5ubyIsCgkiw7hzdHJlLXRvdGVuLm5vIiwKCSJvdmVyaGFsbGEubm8iLAoJIm92cmUtZWlrZXIubm8iLAoJIsO4dnJlLWVpa2VyLm5vIiwKCSJveWVyLm5vIiwKCSLDuHllci5ubyIsCgkib3lnYXJkZW4ubm8iLAoJIsO4eWdhcmRlbi5ubyIsCgkib3lzdHJlLXNsaWRyZS5ubyIsCgkiw7h5c3RyZS1zbGlkcmUubm8iLAoJInBvcnNhbmdlci5ubyIsCgkicG9yc2FuZ3Uubm8iLAoJInBvcnPDocWLZ3Uubm8iLAoJInBvcnNncnVubi5ubyIsCgkicmFkb3kubm8iLAoJInJhZMO4eS5ubyIsCgkicmFra2VzdGFkLm5vIiwKCSJyYW5hLm5vIiwKCSJydW92YXQubm8iLAoJInJhbmRhYmVyZy5ubyIsCgkicmF1bWEubm8iLAoJInJlbmRhbGVuLm5vIiwKCSJyZW5uZWJ1Lm5vIiwKCSJyZW5uZXNveS5ubyIsCgkicmVubmVzw7h5Lm5vIiwKCSJyaW5kYWwubm8iLAoJInJpbmdlYnUubm8iLAoJInJpbmdlcmlrZS5ubyIsCgkicmluZ3Nha2VyLm5vIiwKCSJyaXNzYS5ubyIsCgkicmlzb3Iubm8iLAoJInJpc8O4ci5ubyIsCgkicm9hbi5ubyIsCgkicm9sbGFnLm5vIiwKCSJyeWdnZS5ubyIsCgkicmFsaW5nZW4ubm8iLAoJInLDpmxpbmdlbi5ubyIsCgkicm9kb3kubm8iLAoJInLDuGTDuHkubm8iLAoJInJvbXNrb2cubm8iLAoJInLDuG1za29nLm5vIiwKCSJyb3Jvcy5ubyIsCgkicsO4cm9zLm5vIiwKCSJyb3N0Lm5vIiwKCSJyw7hzdC5ubyIsCgkicm95a2VuLm5vIiwKCSJyw7h5a2VuLm5vIiwKCSJyb3lydmlrLm5vIiwKCSJyw7h5cnZpay5ubyIsCgkicmFkZS5ubyIsCgkicsOlZGUubm8iLAoJInNhbGFuZ2VuLm5vIiwKCSJzaWVsbGFrLm5vIiwKCSJzYWx0ZGFsLm5vIiwKCSJzYWxhdC5ubyIsCgkic8OhbMOhdC5ubyIsCgkic8OhbGF0Lm5vIiwKCSJzYW1uYW5nZXIubm8iLAoJInNhbmRlLm1vcmUtb2ctcm9tc2RhbC5ubyIsCgkic2FuZGUubcO4cmUtb2ctcm9tc2RhbC5ubyIsCgkic2FuZGUudmVzdGZvbGQubm8iLAoJInNhbmRlZmpvcmQubm8iLAoJInNhbmRuZXMubm8iLAoJInNhbmRveS5ubyIsCgkic2FuZMO4eS5ubyIsCgkic2FycHNib3JnLm5vIiwKCSJzYXVkYS5ubyIsCgkic2F1aGVyYWQubm8iLAoJInNlbC5ubyIsCgkic2VsYnUubm8iLAoJInNlbGplLm5vIiwKCSJzZWxqb3JkLm5vIiwKCSJzaWdkYWwubm8iLAoJInNpbGphbi5ubyIsCgkic2lyZGFsLm5vIiwKCSJza2F1bi5ubyIsCgkic2tlZHNtby5ubyIsCgkic2tpLm5vIiwKCSJza2llbi5ubyIsCgkic2tpcHR2ZXQubm8iLAoJInNramVydm95Lm5vIiwKCSJza2plcnbDuHkubm8iLAoJInNraWVydmEubm8iLAoJInNraWVydsOhLm5vIiwKCSJza2phay5ubyIsCgkic2tqw6VrLm5vIiwKCSJza29kamUubm8iLAoJInNrYW5sYW5kLm5vIiwKCSJza8OlbmxhbmQubm8iLAoJInNrYW5pdC5ubyIsCgkic2vDoW5pdC5ubyIsCgkic21vbGEubm8iLAoJInNtw7hsYS5ubyIsCgkic25pbGxmam9yZC5ubyIsCgkic25hc2Eubm8iLAoJInNuw6VzYS5ubyIsCgkic25vYXNhLm5vIiwKCSJzbmFhc2Uubm8iLAoJInNuw6Vhc2Uubm8iLAoJInNvZ25kYWwubm8iLAoJInNva25kYWwubm8iLAoJInNvbGEubm8iLAoJInNvbHVuZC5ubyIsCgkic29uZ2RhbGVuLm5vIiwKCSJzb3J0bGFuZC5ubyIsCgkic3B5ZGViZXJnLm5vIiwKCSJzdGFuZ2Uubm8iLAoJInN0YXZhbmdlci5ubyIsCgkic3RlaWdlbi5ubyIsCgkic3RlaW5ramVyLm5vIiwKCSJzdGpvcmRhbC5ubyIsCgkic3Rqw7hyZGFsLm5vIiwKCSJzdG9ra2Uubm8iLAoJInN0b3ItZWx2ZGFsLm5vIiwKCSJzdG9yZC5ubyIsCgkic3RvcmRhbC5ubyIsCgkic3RvcmZqb3JkLm5vIiwKCSJvbWFzdnVvdG5hLm5vIiwKCSJzdHJhbmQubm8iLAoJInN0cmFuZGEubm8iLAoJInN0cnluLm5vIiwKCSJzdWxhLm5vIiwKCSJzdWxkYWwubm8iLAoJInN1bmQubm8iLAoJInN1bm5kYWwubm8iLAoJInN1cm5hZGFsLm5vIiwKCSJzdmVpby5ubyIsCgkic3ZlbHZpay5ubyIsCgkic3lra3lsdmVuLm5vIiwKCSJzb2duZS5ubyIsCgkic8O4Z25lLm5vIiwKCSJzb21uYS5ubyIsCgkic8O4bW5hLm5vIiwKCSJzb25kcmUtbGFuZC5ubyIsCgkic8O4bmRyZS1sYW5kLm5vIiwKCSJzb3ItYXVyZGFsLm5vIiwKCSJzw7hyLWF1cmRhbC5ubyIsCgkic29yLWZyb24ubm8iLAoJInPDuHItZnJvbi5ubyIsCgkic29yLW9kYWwubm8iLAoJInPDuHItb2RhbC5ubyIsCgkic29yLXZhcmFuZ2VyLm5vIiwKCSJzw7hyLXZhcmFuZ2VyLm5vIiwKCSJtYXR0YS12YXJqamF0Lm5vIiwKCSJtw6F0dGEtdsOhcmpqYXQubm8iLAoJInNvcmZvbGQubm8iLAoJInPDuHJmb2xkLm5vIiwKCSJzb3JyZWlzYS5ubyIsCgkic8O4cnJlaXNhLm5vIiwKCSJzb3J1bS5ubyIsCgkic8O4cnVtLm5vIiwKCSJ0YW5hLm5vIiwKCSJkZWF0bnUubm8iLAoJInRpbWUubm8iLAoJInRpbmd2b2xsLm5vIiwKCSJ0aW5uLm5vIiwKCSJ0amVsZHN1bmQubm8iLAoJImRpZWxkZGFudW9ycmkubm8iLAoJInRqb21lLm5vIiwKCSJ0asO4bWUubm8iLAoJInRva2tlLm5vIiwKCSJ0b2xnYS5ubyIsCgkidG9yc2tlbi5ubyIsCgkidHJhbm95Lm5vIiwKCSJ0cmFuw7h5Lm5vIiwKCSJ0cm9tc28ubm8iLAoJInRyb21zw7gubm8iLAoJInRyb21zYS5ubyIsCgkicm9tc2Eubm8iLAoJInRyb25kaGVpbS5ubyIsCgkidHJvYW5kaW4ubm8iLAoJInRyeXNpbC5ubyIsCgkidHJhbmEubm8iLAoJInRyw6ZuYS5ubyIsCgkidHJvZ3N0YWQubm8iLAoJInRyw7hnc3RhZC5ubyIsCgkidHZlZGVzdHJhbmQubm8iLAoJInR5ZGFsLm5vIiwKCSJ0eW5zZXQubm8iLAoJInR5c2Zqb3JkLm5vIiwKCSJkaXZ0YXN2dW9kbmEubm8iLAoJImRpdnR0YXN2dW90bmEubm8iLAoJInR5c25lcy5ubyIsCgkidHlzdmFyLm5vIiwKCSJ0eXN2w6ZyLm5vIiwKCSJ0b25zYmVyZy5ubyIsCgkidMO4bnNiZXJnLm5vIiwKCSJ1bGxlbnNha2VyLm5vIiwKCSJ1bGxlbnN2YW5nLm5vIiwKCSJ1bHZpay5ubyIsCgkidXRzaXJhLm5vIiwKCSJ2YWRzby5ubyIsCgkidmFkc8O4Lm5vIiwKCSJjYWhjZXN1b2xvLm5vIiwKCSLEjcOhaGNlc3VvbG8ubm8iLAoJInZha3NkYWwubm8iLAoJInZhbGxlLm5vIiwKCSJ2YW5nLm5vIiwKCSJ2YW55bHZlbi5ubyIsCgkidmFyZG8ubm8iLAoJInZhcmTDuC5ubyIsCgkidmFyZ2dhdC5ubyIsCgkidsOhcmdnw6F0Lm5vIiwKCSJ2ZWZzbi5ubyIsCgkidmFhcHN0ZS5ubyIsCgkidmVnYS5ubyIsCgkidmVnYXJzaGVpLm5vIiwKCSJ2ZWfDpXJzaGVpLm5vIiwKCSJ2ZW5uZXNsYS5ubyIsCgkidmVyZGFsLm5vIiwKCSJ2ZXJyYW4ubm8iLAoJInZlc3RieS5ubyIsCgkidmVzdG5lcy5ubyIsCgkidmVzdHJlLXNsaWRyZS5ubyIsCgkidmVzdHJlLXRvdGVuLm5vIiwKCSJ2ZXN0dmFnb3kubm8iLAoJInZlc3R2w6Vnw7h5Lm5vIiwKCSJ2ZXZlbHN0YWQubm8iLAoJInZpay5ubyIsCgkidmlrbmEubm8iLAoJInZpbmRhZmpvcmQubm8iLAoJInZvbGRhLm5vIiwKCSJ2b3NzLm5vIiwKCSJ2YXJveS5ubyIsCgkidsOmcsO4eS5ubyIsCgkidmFnYW4ubm8iLAoJInbDpWdhbi5ubyIsCgkidm9hZ2F0Lm5vIiwKCSJ2YWdzb3kubm8iLAoJInbDpWdzw7h5Lm5vIiwKCSJ2YWdhLm5vIiwKCSJ2w6Vnw6Uubm8iLAoJInZhbGVyLm9zdGZvbGQubm8iLAoJInbDpWxlci7DuHN0Zm9sZC5ubyIsCgkidmFsZXIuaGVkbWFyay5ubyIsCgkidsOlbGVyLmhlZG1hcmsubm8iLAoJIioubnAiLAoJIm5yIiwKCSJiaXoubnIiLAoJImluZm8ubnIiLAoJImdvdi5uciIsCgkiZWR1Lm5yIiwKCSJvcmcubnIiLAoJIm5ldC5uciIsCgkiY29tLm5yIiwKCSJudSIsCgkibnoiLAoJImFjLm56IiwKCSJjby5ueiIsCgkiY3JpLm56IiwKCSJnZWVrLm56IiwKCSJnZW4ubnoiLAoJImdvdnQubnoiLAoJImhlYWx0aC5ueiIsCgkiaXdpLm56IiwKCSJraXdpLm56IiwKCSJtYW9yaS5ueiIsCgkibWlsLm56IiwKCSJtxIFvcmkubnoiLAoJIm5ldC5ueiIsCgkib3JnLm56IiwKCSJwYXJsaWFtZW50Lm56IiwKCSJzY2hvb2wubnoiLAoJIm9tIiwKCSJjby5vbSIsCgkiY29tLm9tIiwKCSJlZHUub20iLAoJImdvdi5vbSIsCgkibWVkLm9tIiwKCSJtdXNldW0ub20iLAoJIm5ldC5vbSIsCgkib3JnLm9tIiwKCSJwcm8ub20iLAoJIm9uaW9uIiwKCSJvcmciLAoJInBhIiwKCSJhYy5wYSIsCgkiZ29iLnBhIiwKCSJjb20ucGEiLAoJIm9yZy5wYSIsCgkic2xkLnBhIiwKCSJlZHUucGEiLAoJIm5ldC5wYSIsCgkiaW5nLnBhIiwKCSJhYm8ucGEiLAoJIm1lZC5wYSIsCgkibm9tLnBhIiwKCSJwZSIsCgkiZWR1LnBlIiwKCSJnb2IucGUiLAoJIm5vbS5wZSIsCgkibWlsLnBlIiwKCSJvcmcucGUiLAoJImNvbS5wZSIsCgkibmV0LnBlIiwKCSJwZiIsCgkiY29tLnBmIiwKCSJvcmcucGYiLAoJImVkdS5wZiIsCgkiKi5wZyIsCgkicGgiLAoJImNvbS5waCIsCgkibmV0LnBoIiwKCSJvcmcucGgiLAoJImdvdi5waCIsCgkiZWR1LnBoIiwKCSJuZ28ucGgiLAoJIm1pbC5waCIsCgkiaS5waCIsCgkicGsiLAoJImNvbS5wayIsCgkibmV0LnBrIiwKCSJlZHUucGsiLAoJIm9yZy5wayIsCgkiZmFtLnBrIiwKCSJiaXoucGsiLAoJIndlYi5wayIsCgkiZ292LnBrIiwKCSJnb2IucGsiLAoJImdvay5wayIsCgkiZ29uLnBrIiwKCSJnb3AucGsiLAoJImdvcy5wayIsCgkiaW5mby5wayIsCgkicGwiLAoJImNvbS5wbCIsCgkibmV0LnBsIiwKCSJvcmcucGwiLAoJImFpZC5wbCIsCgkiYWdyby5wbCIsCgkiYXRtLnBsIiwKCSJhdXRvLnBsIiwKCSJiaXoucGwiLAoJImVkdS5wbCIsCgkiZ21pbmEucGwiLAoJImdzbS5wbCIsCgkiaW5mby5wbCIsCgkibWFpbC5wbCIsCgkibWlhc3RhLnBsIiwKCSJtZWRpYS5wbCIsCgkibWlsLnBsIiwKCSJuaWVydWNob21vc2NpLnBsIiwKCSJub20ucGwiLAoJInBjLnBsIiwKCSJwb3dpYXQucGwiLAoJInByaXYucGwiLAoJInJlYWxlc3RhdGUucGwiLAoJInJlbC5wbCIsCgkic2V4LnBsIiwKCSJzaG9wLnBsIiwKCSJza2xlcC5wbCIsCgkic29zLnBsIiwKCSJzemtvbGEucGwiLAoJInRhcmdpLnBsIiwKCSJ0bS5wbCIsCgkidG91cmlzbS5wbCIsCgkidHJhdmVsLnBsIiwKCSJ0dXJ5c3R5a2EucGwiLAoJImdvdi5wbCIsCgkiYXAuZ292LnBsIiwKCSJpYy5nb3YucGwiLAoJImlzLmdvdi5wbCIsCgkidXMuZ292LnBsIiwKCSJrbXBzcC5nb3YucGwiLAoJImtwcHNwLmdvdi5wbCIsCgkia3dwc3AuZ292LnBsIiwKCSJwc3AuZ292LnBsIiwKCSJ3c2tyLmdvdi5wbCIsCgkia3dwLmdvdi5wbCIsCgkibXcuZ292LnBsIiwKCSJ1Zy5nb3YucGwiLAoJInVtLmdvdi5wbCIsCgkidW1pZy5nb3YucGwiLAoJInVnaW0uZ292LnBsIiwKCSJ1cG93Lmdvdi5wbCIsCgkidXcuZ292LnBsIiwKCSJzdGFyb3N0d28uZ292LnBsIiwKCSJwYS5nb3YucGwiLAoJInBvLmdvdi5wbCIsCgkicHNzZS5nb3YucGwiLAoJInB1cC5nb3YucGwiLAoJInJ6Z3cuZ292LnBsIiwKCSJzYS5nb3YucGwiLAoJInNvLmdvdi5wbCIsCgkic3IuZ292LnBsIiwKCSJ3c2EuZ292LnBsIiwKCSJza28uZ292LnBsIiwKCSJ1enMuZ292LnBsIiwKCSJ3aWloLmdvdi5wbCIsCgkid2luYi5nb3YucGwiLAoJInBpbmIuZ292LnBsIiwKCSJ3aW9zLmdvdi5wbCIsCgkid2l0ZC5nb3YucGwiLAoJInd6bWl1dy5nb3YucGwiLAoJInBpdy5nb3YucGwiLAoJIndpdy5nb3YucGwiLAoJImdyaXcuZ292LnBsIiwKCSJ3aWYuZ292LnBsIiwKCSJvdW0uZ292LnBsIiwKCSJzZG4uZ292LnBsIiwKCSJ6cC5nb3YucGwiLAoJInVwcG8uZ292LnBsIiwKCSJtdXAuZ292LnBsIiwKCSJ3dW96Lmdvdi5wbCIsCgkia29uc3VsYXQuZ292LnBsIiwKCSJvaXJtLmdvdi5wbCIsCgkiYXVndXN0b3cucGwiLAoJImJhYmlhLWdvcmEucGwiLAoJImJlZHppbi5wbCIsCgkiYmVza2lkeS5wbCIsCgkiYmlhbG93aWV6YS5wbCIsCgkiYmlhbHlzdG9rLnBsIiwKCSJiaWVsYXdhLnBsIiwKCSJiaWVzemN6YWR5LnBsIiwKCSJib2xlc2xhd2llYy5wbCIsCgkiYnlkZ29zemN6LnBsIiwKCSJieXRvbS5wbCIsCgkiY2llc3p5bi5wbCIsCgkiY3plbGFkei5wbCIsCgkiY3plc3QucGwiLAoJImRsdWdvbGVrYS5wbCIsCgkiZWxibGFnLnBsIiwKCSJlbGsucGwiLAoJImdsb2dvdy5wbCIsCgkiZ25pZXpuby5wbCIsCgkiZ29ybGljZS5wbCIsCgkiZ3JhamV3by5wbCIsCgkiaWxhd2EucGwiLAoJImphd29yem5vLnBsIiwKCSJqZWxlbmlhLWdvcmEucGwiLAoJImpnb3JhLnBsIiwKCSJrYWxpc3oucGwiLAoJImthemltaWVyei1kb2xueS5wbCIsCgkia2FycGFjei5wbCIsCgkia2FydHV6eS5wbCIsCgkia2FzenVieS5wbCIsCgkia2F0b3dpY2UucGwiLAoJImtlcG5vLnBsIiwKCSJrZXRyenluLnBsIiwKCSJrbG9kemtvLnBsIiwKCSJrb2JpZXJ6eWNlLnBsIiwKCSJrb2xvYnJ6ZWcucGwiLAoJImtvbmluLnBsIiwKCSJrb25za293b2xhLnBsIiwKCSJrdXRuby5wbCIsCgkibGFweS5wbCIsCgkibGVib3JrLnBsIiwKCSJsZWduaWNhLnBsIiwKCSJsZXphanNrLnBsIiwKCSJsaW1hbm93YS5wbCIsCgkibG9temEucGwiLAoJImxvd2ljei5wbCIsCgkibHViaW4ucGwiLAoJImx1a293LnBsIiwKCSJtYWxib3JrLnBsIiwKCSJtYWxvcG9sc2thLnBsIiwKCSJtYXpvd3N6ZS5wbCIsCgkibWF6dXJ5LnBsIiwKCSJtaWVsZWMucGwiLAoJIm1pZWxuby5wbCIsCgkibXJhZ293by5wbCIsCgkibmFrbG8ucGwiLAoJIm5vd2FydWRhLnBsIiwKCSJueXNhLnBsIiwKCSJvbGF3YS5wbCIsCgkib2xlY2tvLnBsIiwKCSJvbGt1c3oucGwiLAoJIm9sc3p0eW4ucGwiLAoJIm9wb2N6bm8ucGwiLAoJIm9wb2xlLnBsIiwKCSJvc3Ryb2RhLnBsIiwKCSJvc3Ryb2xla2EucGwiLAoJIm9zdHJvd2llYy5wbCIsCgkib3N0cm93d2xrcC5wbCIsCgkicGlsYS5wbCIsCgkicGlzei5wbCIsCgkicG9kaGFsZS5wbCIsCgkicG9kbGFzaWUucGwiLAoJInBvbGtvd2ljZS5wbCIsCgkicG9tb3J6ZS5wbCIsCgkicG9tb3Jza2llLnBsIiwKCSJwcm9jaG93aWNlLnBsIiwKCSJwcnVzemtvdy5wbCIsCgkicHJ6ZXdvcnNrLnBsIiwKCSJwdWxhd3kucGwiLAoJInJhZG9tLnBsIiwKCSJyYXdhLW1hei5wbCIsCgkicnlibmlrLnBsIiwKCSJyemVzem93LnBsIiwKCSJzYW5vay5wbCIsCgkic2VqbnkucGwiLAoJInNsYXNrLnBsIiwKCSJzbHVwc2sucGwiLAoJInNvc25vd2llYy5wbCIsCgkic3RhbG93YS13b2xhLnBsIiwKCSJza29jem93LnBsIiwKCSJzdGFyYWNob3dpY2UucGwiLAoJInN0YXJnYXJkLnBsIiwKCSJzdXdhbGtpLnBsIiwKCSJzd2lkbmljYS5wbCIsCgkic3dpZWJvZHppbi5wbCIsCgkic3dpbm91anNjaWUucGwiLAoJInN6Y3plY2luLnBsIiwKCSJzemN6eXRuby5wbCIsCgkidGFybm9icnplZy5wbCIsCgkidGdvcnkucGwiLAoJInR1cmVrLnBsIiwKCSJ0eWNoeS5wbCIsCgkidXN0a2EucGwiLAoJIndhbGJyenljaC5wbCIsCgkid2FybWlhLnBsIiwKCSJ3YXJzemF3YS5wbCIsCgkid2F3LnBsIiwKCSJ3ZWdyb3cucGwiLAoJIndpZWx1bi5wbCIsCgkid2xvY2wucGwiLAoJIndsb2NsYXdlay5wbCIsCgkid29kemlzbGF3LnBsIiwKCSJ3b2xvbWluLnBsIiwKCSJ3cm9jbGF3LnBsIiwKCSJ6YWNocG9tb3IucGwiLAoJInphZ2FuLnBsIiwKCSJ6YXJvdy5wbCIsCgkiemdvcmEucGwiLAoJInpnb3J6ZWxlYy5wbCIsCgkicG0iLAoJInBuIiwKCSJnb3YucG4iLAoJImNvLnBuIiwKCSJvcmcucG4iLAoJImVkdS5wbiIsCgkibmV0LnBuIiwKCSJwb3N0IiwKCSJwciIsCgkiY29tLnByIiwKCSJuZXQucHIiLAoJIm9yZy5wciIsCgkiZ292LnByIiwKCSJlZHUucHIiLAoJImlzbGEucHIiLAoJInByby5wciIsCgkiYml6LnByIiwKCSJpbmZvLnByIiwKCSJuYW1lLnByIiwKCSJlc3QucHIiLAoJInByb2YucHIiLAoJImFjLnByIiwKCSJwcm8iLAoJImFhYS5wcm8iLAoJImFjYS5wcm8iLAoJImFjY3QucHJvIiwKCSJhdm9jYXQucHJvIiwKCSJiYXIucHJvIiwKCSJjcGEucHJvIiwKCSJlbmcucHJvIiwKCSJqdXIucHJvIiwKCSJsYXcucHJvIiwKCSJtZWQucHJvIiwKCSJyZWNodC5wcm8iLAoJInBzIiwKCSJlZHUucHMiLAoJImdvdi5wcyIsCgkic2VjLnBzIiwKCSJwbG8ucHMiLAoJImNvbS5wcyIsCgkib3JnLnBzIiwKCSJuZXQucHMiLAoJInB0IiwKCSJuZXQucHQiLAoJImdvdi5wdCIsCgkib3JnLnB0IiwKCSJlZHUucHQiLAoJImludC5wdCIsCgkicHVibC5wdCIsCgkiY29tLnB0IiwKCSJub21lLnB0IiwKCSJwdyIsCgkiY28ucHciLAoJIm5lLnB3IiwKCSJvci5wdyIsCgkiZWQucHciLAoJImdvLnB3IiwKCSJiZWxhdS5wdyIsCgkicHkiLAoJImNvbS5weSIsCgkiY29vcC5weSIsCgkiZWR1LnB5IiwKCSJnb3YucHkiLAoJIm1pbC5weSIsCgkibmV0LnB5IiwKCSJvcmcucHkiLAoJInFhIiwKCSJjb20ucWEiLAoJImVkdS5xYSIsCgkiZ292LnFhIiwKCSJtaWwucWEiLAoJIm5hbWUucWEiLAoJIm5ldC5xYSIsCgkib3JnLnFhIiwKCSJzY2gucWEiLAoJInJlIiwKCSJhc3NvLnJlIiwKCSJjb20ucmUiLAoJIm5vbS5yZSIsCgkicm8iLAoJImFydHMucm8iLAoJImNvbS5ybyIsCgkiZmlybS5ybyIsCgkiaW5mby5ybyIsCgkibm9tLnJvIiwKCSJudC5ybyIsCgkib3JnLnJvIiwKCSJyZWMucm8iLAoJInN0b3JlLnJvIiwKCSJ0bS5ybyIsCgkid3d3LnJvIiwKCSJycyIsCgkiYWMucnMiLAoJImNvLnJzIiwKCSJlZHUucnMiLAoJImdvdi5ycyIsCgkiaW4ucnMiLAoJIm9yZy5ycyIsCgkicnUiLAoJInJ3IiwKCSJhYy5ydyIsCgkiY28ucnciLAoJImNvb3AucnciLAoJImdvdi5ydyIsCgkibWlsLnJ3IiwKCSJuZXQucnciLAoJIm9yZy5ydyIsCgkic2EiLAoJImNvbS5zYSIsCgkibmV0LnNhIiwKCSJvcmcuc2EiLAoJImdvdi5zYSIsCgkibWVkLnNhIiwKCSJwdWIuc2EiLAoJImVkdS5zYSIsCgkic2NoLnNhIiwKCSJzYiIsCgkiY29tLnNiIiwKCSJlZHUuc2IiLAoJImdvdi5zYiIsCgkibmV0LnNiIiwKCSJvcmcuc2IiLAoJInNjIiwKCSJjb20uc2MiLAoJImdvdi5zYyIsCgkibmV0LnNjIiwKCSJvcmcuc2MiLAoJImVkdS5zYyIsCgkic2QiLAoJImNvbS5zZCIsCgkibmV0LnNkIiwKCSJvcmcuc2QiLAoJImVkdS5zZCIsCgkibWVkLnNkIiwKCSJ0di5zZCIsCgkiZ292LnNkIiwKCSJpbmZvLnNkIiwKCSJzZSIsCgkiYS5zZSIsCgkiYWMuc2UiLAoJImIuc2UiLAoJImJkLnNlIiwKCSJicmFuZC5zZSIsCgkiYy5zZSIsCgkiZC5zZSIsCgkiZS5zZSIsCgkiZi5zZSIsCgkiZmguc2UiLAoJImZoc2suc2UiLAoJImZodi5zZSIsCgkiZy5zZSIsCgkiaC5zZSIsCgkiaS5zZSIsCgkiay5zZSIsCgkia29tZm9yYi5zZSIsCgkia29tbXVuYWxmb3JidW5kLnNlIiwKCSJrb212dXguc2UiLAoJImwuc2UiLAoJImxhbmJpYi5zZSIsCgkibS5zZSIsCgkibi5zZSIsCgkibmF0dXJicnVrc2d5bW4uc2UiLAoJIm8uc2UiLAoJIm9yZy5zZSIsCgkicC5zZSIsCgkicGFydGkuc2UiLAoJInBwLnNlIiwKCSJwcmVzcy5zZSIsCgkici5zZSIsCgkicy5zZSIsCgkidC5zZSIsCgkidG0uc2UiLAoJInUuc2UiLAoJIncuc2UiLAoJInguc2UiLAoJInkuc2UiLAoJInouc2UiLAoJInNnIiwKCSJjb20uc2ciLAoJIm5ldC5zZyIsCgkib3JnLnNnIiwKCSJnb3Yuc2ciLAoJImVkdS5zZyIsCgkicGVyLnNnIiwKCSJzaCIsCgkiY29tLnNoIiwKCSJuZXQuc2giLAoJImdvdi5zaCIsCgkib3JnLnNoIiwKCSJtaWwuc2giLAoJInNpIiwKCSJzaiIsCgkic2siLAoJInNsIiwKCSJjb20uc2wiLAoJIm5ldC5zbCIsCgkiZWR1LnNsIiwKCSJnb3Yuc2wiLAoJIm9yZy5zbCIsCgkic20iLAoJInNuIiwKCSJhcnQuc24iLAoJImNvbS5zbiIsCgkiZWR1LnNuIiwKCSJnb3V2LnNuIiwKCSJvcmcuc24iLAoJInBlcnNvLnNuIiwKCSJ1bml2LnNuIiwKCSJzbyIsCgkiY29tLnNvIiwKCSJlZHUuc28iLAoJImdvdi5zbyIsCgkibWUuc28iLAoJIm5ldC5zbyIsCgkib3JnLnNvIiwKCSJzciIsCgkic3MiLAoJImJpei5zcyIsCgkiY29tLnNzIiwKCSJlZHUuc3MiLAoJImdvdi5zcyIsCgkibWUuc3MiLAoJIm5ldC5zcyIsCgkib3JnLnNzIiwKCSJzY2guc3MiLAoJInN0IiwKCSJjby5zdCIsCgkiY29tLnN0IiwKCSJjb25zdWxhZG8uc3QiLAoJImVkdS5zdCIsCgkiZW1iYWl4YWRhLnN0IiwKCSJtaWwuc3QiLAoJIm5ldC5zdCIsCgkib3JnLnN0IiwKCSJwcmluY2lwZS5zdCIsCgkic2FvdG9tZS5zdCIsCgkic3RvcmUuc3QiLAoJInN1IiwKCSJzdiIsCgkiY29tLnN2IiwKCSJlZHUuc3YiLAoJImdvYi5zdiIsCgkib3JnLnN2IiwKCSJyZWQuc3YiLAoJInN4IiwKCSJnb3Yuc3giLAoJInN5IiwKCSJlZHUuc3kiLAoJImdvdi5zeSIsCgkibmV0LnN5IiwKCSJtaWwuc3kiLAoJImNvbS5zeSIsCgkib3JnLnN5IiwKCSJzeiIsCgkiY28uc3oiLAoJImFjLnN6IiwKCSJvcmcuc3oiLAoJInRjIiwKCSJ0ZCIsCgkidGVsIiwKCSJ0ZiIsCgkidGciLAoJInRoIiwKCSJhYy50aCIsCgkiY28udGgiLAoJImdvLnRoIiwKCSJpbi50aCIsCgkibWkudGgiLAoJIm5ldC50aCIsCgkib3IudGgiLAoJInRqIiwKCSJhYy50aiIsCgkiYml6LnRqIiwKCSJjby50aiIsCgkiY29tLnRqIiwKCSJlZHUudGoiLAoJImdvLnRqIiwKCSJnb3YudGoiLAoJImludC50aiIsCgkibWlsLnRqIiwKCSJuYW1lLnRqIiwKCSJuZXQudGoiLAoJIm5pYy50aiIsCgkib3JnLnRqIiwKCSJ0ZXN0LnRqIiwKCSJ3ZWIudGoiLAoJInRrIiwKCSJ0bCIsCgkiZ292LnRsIiwKCSJ0bSIsCgkiY29tLnRtIiwKCSJjby50bSIsCgkib3JnLnRtIiwKCSJuZXQudG0iLAoJIm5vbS50bSIsCgkiZ292LnRtIiwKCSJtaWwudG0iLAoJImVkdS50bSIsCgkidG4iLAoJImNvbS50biIsCgkiZW5zLnRuIiwKCSJmaW4udG4iLAoJImdvdi50biIsCgkiaW5kLnRuIiwKCSJpbmZvLnRuIiwKCSJpbnRsLnRuIiwKCSJtaW5jb20udG4iLAoJIm5hdC50biIsCgkibmV0LnRuIiwKCSJvcmcudG4iLAoJInBlcnNvLnRuIiwKCSJ0b3VyaXNtLnRuIiwKCSJ0byIsCgkiY29tLnRvIiwKCSJnb3YudG8iLAoJIm5ldC50byIsCgkib3JnLnRvIiwKCSJlZHUudG8iLAoJIm1pbC50byIsCgkidHIiLAoJImF2LnRyIiwKCSJiYnMudHIiLAoJImJlbC50ciIsCgkiYml6LnRyIiwKCSJjb20udHIiLAoJImRyLnRyIiwKCSJlZHUudHIiLAoJImdlbi50ciIsCgkiZ292LnRyIiwKCSJpbmZvLnRyIiwKCSJtaWwudHIiLAoJImsxMi50ciIsCgkia2VwLnRyIiwKCSJuYW1lLnRyIiwKCSJuZXQudHIiLAoJIm9yZy50ciIsCgkicG9sLnRyIiwKCSJ0ZWwudHIiLAoJInRzay50ciIsCgkidHYudHIiLAoJIndlYi50ciIsCgkibmMudHIiLAoJImdvdi5uYy50ciIsCgkidHQiLAoJImNvLnR0IiwKCSJjb20udHQiLAoJIm9yZy50dCIsCgkibmV0LnR0IiwKCSJiaXoudHQiLAoJImluZm8udHQiLAoJInByby50dCIsCgkiaW50LnR0IiwKCSJjb29wLnR0IiwKCSJqb2JzLnR0IiwKCSJtb2JpLnR0IiwKCSJ0cmF2ZWwudHQiLAoJIm11c2V1bS50dCIsCgkiYWVyby50dCIsCgkibmFtZS50dCIsCgkiZ292LnR0IiwKCSJlZHUudHQiLAoJInR2IiwKCSJ0dyIsCgkiZWR1LnR3IiwKCSJnb3YudHciLAoJIm1pbC50dyIsCgkiY29tLnR3IiwKCSJuZXQudHciLAoJIm9yZy50dyIsCgkiaWR2LnR3IiwKCSJnYW1lLnR3IiwKCSJlYml6LnR3IiwKCSJjbHViLnR3IiwKCSLntrLot68udHciLAoJIue1hOe5lC50dyIsCgki5ZWG5qWtLnR3IiwKCSJ0eiIsCgkiYWMudHoiLAoJImNvLnR6IiwKCSJnby50eiIsCgkiaG90ZWwudHoiLAoJImluZm8udHoiLAoJIm1lLnR6IiwKCSJtaWwudHoiLAoJIm1vYmkudHoiLAoJIm5lLnR6IiwKCSJvci50eiIsCgkic2MudHoiLAoJInR2LnR6IiwKCSJ1YSIsCgkiY29tLnVhIiwKCSJlZHUudWEiLAoJImdvdi51YSIsCgkiaW4udWEiLAoJIm5ldC51YSIsCgkib3JnLnVhIiwKCSJjaGVya2Fzc3kudWEiLAoJImNoZXJrYXN5LnVhIiwKCSJjaGVybmlnb3YudWEiLAoJImNoZXJuaWhpdi51YSIsCgkiY2hlcm5pdnRzaS51YSIsCgkiY2hlcm5vdnRzeS51YSIsCgkiY2sudWEiLAoJImNuLnVhIiwKCSJjci51YSIsCgkiY3JpbWVhLnVhIiwKCSJjdi51YSIsCgkiZG4udWEiLAoJImRuZXByb3BldHJvdnNrLnVhIiwKCSJkbmlwcm9wZXRyb3Zzay51YSIsCgkiZG9uZXRzay51YSIsCgkiZHAudWEiLAoJImlmLnVhIiwKCSJpdmFuby1mcmFua2l2c2sudWEiLAoJImtoLnVhIiwKCSJraGFya2l2LnVhIiwKCSJraGFya292LnVhIiwKCSJraGVyc29uLnVhIiwKCSJraG1lbG5pdHNraXkudWEiLAoJImtobWVsbnl0c2t5aS51YSIsCgkia2lldi51YSIsCgkia2lyb3ZvZ3JhZC51YSIsCgkia20udWEiLAoJImtyLnVhIiwKCSJrcnltLnVhIiwKCSJrcy51YSIsCgkia3YudWEiLAoJImt5aXYudWEiLAoJImxnLnVhIiwKCSJsdC51YSIsCgkibHVnYW5zay51YSIsCgkibHV0c2sudWEiLAoJImx2LnVhIiwKCSJsdml2LnVhIiwKCSJtay51YSIsCgkibXlrb2xhaXYudWEiLAoJIm5pa29sYWV2LnVhIiwKCSJvZC51YSIsCgkib2Rlc2EudWEiLAoJIm9kZXNzYS51YSIsCgkicGwudWEiLAoJInBvbHRhdmEudWEiLAoJInJpdm5lLnVhIiwKCSJyb3Zuby51YSIsCgkicnYudWEiLAoJInNiLnVhIiwKCSJzZWJhc3RvcG9sLnVhIiwKCSJzZXZhc3RvcG9sLnVhIiwKCSJzbS51YSIsCgkic3VteS51YSIsCgkidGUudWEiLAoJInRlcm5vcGlsLnVhIiwKCSJ1ei51YSIsCgkidXpoZ29yb2QudWEiLAoJInZpbm5pY2EudWEiLAoJInZpbm55dHNpYS51YSIsCgkidm4udWEiLAoJInZvbHluLnVhIiwKCSJ5YWx0YS51YSIsCgkiemFwb3Jpemh6aGUudWEiLAoJInphcG9yaXpoemhpYS51YSIsCgkiemhpdG9taXIudWEiLAoJInpoeXRvbXlyLnVhIiwKCSJ6cC51YSIsCgkienQudWEiLAoJInVnIiwKCSJjby51ZyIsCgkib3IudWciLAoJImFjLnVnIiwKCSJzYy51ZyIsCgkiZ28udWciLAoJIm5lLnVnIiwKCSJjb20udWciLAoJIm9yZy51ZyIsCgkidWsiLAoJImFjLnVrIiwKCSJjby51ayIsCgkiZ292LnVrIiwKCSJsdGQudWsiLAoJIm1lLnVrIiwKCSJuZXQudWsiLAoJIm5ocy51ayIsCgkib3JnLnVrIiwKCSJwbGMudWsiLAoJInBvbGljZS51ayIsCgkiKi5zY2gudWsiLAoJInVzIiwKCSJkbmkudXMiLAoJImZlZC51cyIsCgkiaXNhLnVzIiwKCSJraWRzLnVzIiwKCSJuc24udXMiLAoJImFrLnVzIiwKCSJhbC51cyIsCgkiYXIudXMiLAoJImFzLnVzIiwKCSJhei51cyIsCgkiY2EudXMiLAoJImNvLnVzIiwKCSJjdC51cyIsCgkiZGMudXMiLAoJImRlLnVzIiwKCSJmbC51cyIsCgkiZ2EudXMiLAoJImd1LnVzIiwKCSJoaS51cyIsCgkiaWEudXMiLAoJImlkLnVzIiwKCSJpbC51cyIsCgkiaW4udXMiLAoJImtzLnVzIiwKCSJreS51cyIsCgkibGEudXMiLAoJIm1hLnVzIiwKCSJtZC51cyIsCgkibWUudXMiLAoJIm1pLnVzIiwKCSJtbi51cyIsCgkibW8udXMiLAoJIm1zLnVzIiwKCSJtdC51cyIsCgkibmMudXMiLAoJIm5kLnVzIiwKCSJuZS51cyIsCgkibmgudXMiLAoJIm5qLnVzIiwKCSJubS51cyIsCgkibnYudXMiLAoJIm55LnVzIiwKCSJvaC51cyIsCgkib2sudXMiLAoJIm9yLnVzIiwKCSJwYS51cyIsCgkicHIudXMiLAoJInJpLnVzIiwKCSJzYy51cyIsCgkic2QudXMiLAoJInRuLnVzIiwKCSJ0eC51cyIsCgkidXQudXMiLAoJInZpLnVzIiwKCSJ2dC51cyIsCgkidmEudXMiLAoJIndhLnVzIiwKCSJ3aS51cyIsCgkid3YudXMiLAoJInd5LnVzIiwKCSJrMTIuYWsudXMiLAoJImsxMi5hbC51cyIsCgkiazEyLmFyLnVzIiwKCSJrMTIuYXMudXMiLAoJImsxMi5hei51cyIsCgkiazEyLmNhLnVzIiwKCSJrMTIuY28udXMiLAoJImsxMi5jdC51cyIsCgkiazEyLmRjLnVzIiwKCSJrMTIuZGUudXMiLAoJImsxMi5mbC51cyIsCgkiazEyLmdhLnVzIiwKCSJrMTIuZ3UudXMiLAoJImsxMi5pYS51cyIsCgkiazEyLmlkLnVzIiwKCSJrMTIuaWwudXMiLAoJImsxMi5pbi51cyIsCgkiazEyLmtzLnVzIiwKCSJrMTIua3kudXMiLAoJImsxMi5sYS51cyIsCgkiazEyLm1hLnVzIiwKCSJrMTIubWQudXMiLAoJImsxMi5tZS51cyIsCgkiazEyLm1pLnVzIiwKCSJrMTIubW4udXMiLAoJImsxMi5tby51cyIsCgkiazEyLm1zLnVzIiwKCSJrMTIubXQudXMiLAoJImsxMi5uYy51cyIsCgkiazEyLm5lLnVzIiwKCSJrMTIubmgudXMiLAoJImsxMi5uai51cyIsCgkiazEyLm5tLnVzIiwKCSJrMTIubnYudXMiLAoJImsxMi5ueS51cyIsCgkiazEyLm9oLnVzIiwKCSJrMTIub2sudXMiLAoJImsxMi5vci51cyIsCgkiazEyLnBhLnVzIiwKCSJrMTIucHIudXMiLAoJImsxMi5zYy51cyIsCgkiazEyLnRuLnVzIiwKCSJrMTIudHgudXMiLAoJImsxMi51dC51cyIsCgkiazEyLnZpLnVzIiwKCSJrMTIudnQudXMiLAoJImsxMi52YS51cyIsCgkiazEyLndhLnVzIiwKCSJrMTIud2kudXMiLAoJImsxMi53eS51cyIsCgkiY2MuYWsudXMiLAoJImNjLmFsLnVzIiwKCSJjYy5hci51cyIsCgkiY2MuYXMudXMiLAoJImNjLmF6LnVzIiwKCSJjYy5jYS51cyIsCgkiY2MuY28udXMiLAoJImNjLmN0LnVzIiwKCSJjYy5kYy51cyIsCgkiY2MuZGUudXMiLAoJImNjLmZsLnVzIiwKCSJjYy5nYS51cyIsCgkiY2MuZ3UudXMiLAoJImNjLmhpLnVzIiwKCSJjYy5pYS51cyIsCgkiY2MuaWQudXMiLAoJImNjLmlsLnVzIiwKCSJjYy5pbi51cyIsCgkiY2Mua3MudXMiLAoJImNjLmt5LnVzIiwKCSJjYy5sYS51cyIsCgkiY2MubWEudXMiLAoJImNjLm1kLnVzIiwKCSJjYy5tZS51cyIsCgkiY2MubWkudXMiLAoJImNjLm1uLnVzIiwKCSJjYy5tby51cyIsCgkiY2MubXMudXMiLAoJImNjLm10LnVzIiwKCSJjYy5uYy51cyIsCgkiY2MubmQudXMiLAoJImNjLm5lLnVzIiwKCSJjYy5uaC51cyIsCgkiY2MubmoudXMiLAoJImNjLm5tLnVzIiwKCSJjYy5udi51cyIsCgkiY2MubnkudXMiLAoJImNjLm9oLnVzIiwKCSJjYy5vay51cyIsCgkiY2Mub3IudXMiLAoJImNjLnBhLnVzIiwKCSJjYy5wci51cyIsCgkiY2MucmkudXMiLAoJImNjLnNjLnVzIiwKCSJjYy5zZC51cyIsCgkiY2MudG4udXMiLAoJImNjLnR4LnVzIiwKCSJjYy51dC51cyIsCgkiY2MudmkudXMiLAoJImNjLnZ0LnVzIiwKCSJjYy52YS51cyIsCgkiY2Mud2EudXMiLAoJImNjLndpLnVzIiwKCSJjYy53di51cyIsCgkiY2Mud3kudXMiLAoJImxpYi5hay51cyIsCgkibGliLmFsLnVzIiwKCSJsaWIuYXIudXMiLAoJImxpYi5hcy51cyIsCgkibGliLmF6LnVzIiwKCSJsaWIuY2EudXMiLAoJImxpYi5jby51cyIsCgkibGliLmN0LnVzIiwKCSJsaWIuZGMudXMiLAoJImxpYi5mbC51cyIsCgkibGliLmdhLnVzIiwKCSJsaWIuZ3UudXMiLAoJImxpYi5oaS51cyIsCgkibGliLmlhLnVzIiwKCSJsaWIuaWQudXMiLAoJImxpYi5pbC51cyIsCgkibGliLmluLnVzIiwKCSJsaWIua3MudXMiLAoJImxpYi5reS51cyIsCgkibGliLmxhLnVzIiwKCSJsaWIubWEudXMiLAoJImxpYi5tZC51cyIsCgkibGliLm1lLnVzIiwKCSJsaWIubWkudXMiLAoJImxpYi5tbi51cyIsCgkibGliLm1vLnVzIiwKCSJsaWIubXMudXMiLAoJImxpYi5tdC51cyIsCgkibGliLm5jLnVzIiwKCSJsaWIubmQudXMiLAoJImxpYi5uZS51cyIsCgkibGliLm5oLnVzIiwKCSJsaWIubmoudXMiLAoJImxpYi5ubS51cyIsCgkibGliLm52LnVzIiwKCSJsaWIubnkudXMiLAoJImxpYi5vaC51cyIsCgkibGliLm9rLnVzIiwKCSJsaWIub3IudXMiLAoJImxpYi5wYS51cyIsCgkibGliLnByLnVzIiwKCSJsaWIucmkudXMiLAoJImxpYi5zYy51cyIsCgkibGliLnNkLnVzIiwKCSJsaWIudG4udXMiLAoJImxpYi50eC51cyIsCgkibGliLnV0LnVzIiwKCSJsaWIudmkudXMiLAoJImxpYi52dC51cyIsCgkibGliLnZhLnVzIiwKCSJsaWIud2EudXMiLAoJImxpYi53aS51cyIsCgkibGliLnd5LnVzIiwKCSJwdnQuazEyLm1hLnVzIiwKCSJjaHRyLmsxMi5tYS51cyIsCgkicGFyb2NoLmsxMi5tYS51cyIsCgkiYW5uLWFyYm9yLm1pLnVzIiwKCSJjb2cubWkudXMiLAoJImRzdC5taS51cyIsCgkiZWF0b24ubWkudXMiLAoJImdlbi5taS51cyIsCgkibXVzLm1pLnVzIiwKCSJ0ZWMubWkudXMiLAoJIndhc2h0ZW5hdy5taS51cyIsCgkidXkiLAoJImNvbS51eSIsCgkiZWR1LnV5IiwKCSJndWIudXkiLAoJIm1pbC51eSIsCgkibmV0LnV5IiwKCSJvcmcudXkiLAoJInV6IiwKCSJjby51eiIsCgkiY29tLnV6IiwKCSJuZXQudXoiLAoJIm9yZy51eiIsCgkidmEiLAoJInZjIiwKCSJjb20udmMiLAoJIm5ldC52YyIsCgkib3JnLnZjIiwKCSJnb3YudmMiLAoJIm1pbC52YyIsCgkiZWR1LnZjIiwKCSJ2ZSIsCgkiYXJ0cy52ZSIsCgkiYmliLnZlIiwKCSJjby52ZSIsCgkiY29tLnZlIiwKCSJlMTIudmUiLAoJImVkdS52ZSIsCgkiZmlybS52ZSIsCgkiZ29iLnZlIiwKCSJnb3YudmUiLAoJImluZm8udmUiLAoJImludC52ZSIsCgkibWlsLnZlIiwKCSJuZXQudmUiLAoJIm5vbS52ZSIsCgkib3JnLnZlIiwKCSJyYXIudmUiLAoJInJlYy52ZSIsCgkic3RvcmUudmUiLAoJInRlYy52ZSIsCgkid2ViLnZlIiwKCSJ2ZyIsCgkidmkiLAoJImNvLnZpIiwKCSJjb20udmkiLAoJImsxMi52aSIsCgkibmV0LnZpIiwKCSJvcmcudmkiLAoJInZuIiwKCSJjb20udm4iLAoJIm5ldC52biIsCgkib3JnLnZuIiwKCSJlZHUudm4iLAoJImdvdi52biIsCgkiaW50LnZuIiwKCSJhYy52biIsCgkiYml6LnZuIiwKCSJpbmZvLnZuIiwKCSJuYW1lLnZuIiwKCSJwcm8udm4iLAoJImhlYWx0aC52biIsCgkidnUiLAoJImNvbS52dSIsCgkiZWR1LnZ1IiwKCSJuZXQudnUiLAoJIm9yZy52dSIsCgkid2YiLAoJIndzIiwKCSJjb20ud3MiLAoJIm5ldC53cyIsCgkib3JnLndzIiwKCSJnb3Yud3MiLAoJImVkdS53cyIsCgkieXQiLAoJItin2YXYp9ix2KfYqiIsCgki1bDVodW1IiwKCSLgpqzgpr7gpoLgprLgpr4iLAoJItCx0LMiLAoJItin2YTYqNit2LHZitmGIiwKCSLQsdC10LsiLAoJIuS4reWbvSIsCgki5Lit5ZyLIiwKCSLYp9mE2KzYstin2KbYsSIsCgki2YXYtdixIiwKCSLQtdGOIiwKCSLOtc+FIiwKCSLZhdmI2LHZitiq2KfZhtmK2KciLAoJIuGDkuGDlCIsCgkizrXOuyIsCgki6aaZ5rivIiwKCSLlhazlj7gu6aaZ5rivIiwKCSLmlZnogrIu6aaZ5rivIiwKCSLmlL/lupwu6aaZ5rivIiwKCSLlgIvkurou6aaZ5rivIiwKCSLntrLntaEu6aaZ5rivIiwKCSLntYTnuZQu6aaZ5rivIiwKCSLgsq3gsr7gsrDgsqQiLAoJIuCsreCsvuCssOCspCIsCgki4Kat4Ka+4Kew4KakIiwKCSLgpK3gpL7gpLDgpKTgpK7gpY0iLAoJIuCkreCkvuCksOCli+CkpCIsCgki2oDYp9ix2KoiLAoJIuC0reC0vuC0sOC0pOC0giIsCgki4KSt4KS+4KSw4KSkIiwKCSLYqNin2LHYqiIsCgki2Kjavtin2LHYqiIsCgki4LCt4LC+4LCw4LCk4LGNIiwKCSLgqq3gqr7gqrDgqqQiLAoJIuCoreCovuCosOCopCIsCgki4Kat4Ka+4Kaw4KakIiwKCSLgrofgrqjgr43grqTgrr/grq/grr4iLAoJItin24zYsdin2YYiLAoJItin2YrYsdin2YYiLAoJIti52LHYp9mCIiwKCSLYp9mE2KfYsdiv2YYiLAoJIu2VnOq1rSIsCgki0pvQsNC3IiwKCSLguqXgurLguqciLAoJIuC2veC2guC2muC3jyIsCgki4K6H4K6y4K6Z4K+N4K6V4K+IIiwKCSLYp9mE2YXYutix2KgiLAoJItC80LrQtCIsCgki0LzQvtC9IiwKCSLmvrPploAiLAoJIua+s+mXqCIsCgki2YXZhNmK2LPZitinIiwKCSLYudmF2KfZhiIsCgki2b7Yp9qp2LPYqtin2YYiLAoJItm+2KfZg9iz2KrYp9mGIiwKCSLZgdmE2LPYt9mK2YYiLAoJItGB0YDQsSIsCgki0L/RgC7RgdGA0LEiLAoJItC+0YDQsy7RgdGA0LEiLAoJItC+0LHRgC7RgdGA0LEiLAoJItC+0LQu0YHRgNCxIiwKCSLRg9C/0YAu0YHRgNCxIiwKCSLQsNC6LtGB0YDQsSIsCgki0YDRhCIsCgki2YLYt9ixIiwKCSLYp9mE2LPYudmI2K/ZitipIiwKCSLYp9mE2LPYudmI2K/bjNipIiwKCSLYp9mE2LPYudmI2K/bjNuDIiwKCSLYp9mE2LPYudmI2K/ZitmHIiwKCSLYs9mI2K/Yp9mGIiwKCSLmlrDliqDlnaEiLAoJIuCumuCuv+CumeCvjeCuleCuquCvjeCuquCvguCusOCvjSIsCgki2LPZiNix2YrYqSIsCgki2LPZiNix2YrYpyIsCgki4LmE4LiX4LiiIiwKCSLguKjguLbguIHguKnguLIu4LmE4LiX4LiiIiwKCSLguJjguLjguKPguIHguLTguIgu4LmE4LiX4LiiIiwKCSLguKPguLHguJDguJrguLLguKUu4LmE4LiX4LiiIiwKCSLguJfguKvguLLguKMu4LmE4LiX4LiiIiwKCSLguYDguJnguYfguJUu4LmE4LiX4LiiIiwKCSLguK3guIfguITguYzguIHguKMu4LmE4LiX4LiiIiwKCSLYqtmI2YbYsyIsCgki5Y+w54GjIiwKCSLlj7Dmub4iLAoJIuiHuueBoyIsCgki0YPQutGAIiwKCSLYp9mE2YrZhdmGIiwKCSJ4eHgiLAoJInllIiwKCSJjb20ueWUiLAoJImVkdS55ZSIsCgkiZ292LnllIiwKCSJuZXQueWUiLAoJIm1pbC55ZSIsCgkib3JnLnllIiwKCSJhYy56YSIsCgkiYWdyaWMuemEiLAoJImFsdC56YSIsCgkiY28uemEiLAoJImVkdS56YSIsCgkiZ292LnphIiwKCSJncm9uZGFyLnphIiwKCSJsYXcuemEiLAoJIm1pbC56YSIsCgkibmV0LnphIiwKCSJuZ28uemEiLAoJIm5pYy56YSIsCgkibmlzLnphIiwKCSJub20uemEiLAoJIm9yZy56YSIsCgkic2Nob29sLnphIiwKCSJ0bS56YSIsCgkid2ViLnphIiwKCSJ6bSIsCgkiYWMuem0iLAoJImJpei56bSIsCgkiY28uem0iLAoJImNvbS56bSIsCgkiZWR1LnptIiwKCSJnb3Yuem0iLAoJImluZm8uem0iLAoJIm1pbC56bSIsCgkibmV0LnptIiwKCSJvcmcuem0iLAoJInNjaC56bSIsCgkienciLAoJImFjLnp3IiwKCSJjby56dyIsCgkiZ292Lnp3IiwKCSJtaWwuenciLAoJIm9yZy56dyIsCgkiYWFhIiwKCSJhYXJwIiwKCSJhYmFydGgiLAoJImFiYiIsCgkiYWJib3R0IiwKCSJhYmJ2aWUiLAoJImFiYyIsCgkiYWJsZSIsCgkiYWJvZ2FkbyIsCgkiYWJ1ZGhhYmkiLAoJImFjYWRlbXkiLAoJImFjY2VudHVyZSIsCgkiYWNjb3VudGFudCIsCgkiYWNjb3VudGFudHMiLAoJImFjbyIsCgkiYWN0b3IiLAoJImFkYWMiLAoJImFkcyIsCgkiYWR1bHQiLAoJImFlZyIsCgkiYWV0bmEiLAoJImFmbCIsCgkiYWZyaWNhIiwKCSJhZ2FraGFuIiwKCSJhZ2VuY3kiLAoJImFpZyIsCgkiYWlyYnVzIiwKCSJhaXJmb3JjZSIsCgkiYWlydGVsIiwKCSJha2RuIiwKCSJhbGZhcm9tZW8iLAoJImFsaWJhYmEiLAoJImFsaXBheSIsCgkiYWxsZmluYW56IiwKCSJhbGxzdGF0ZSIsCgkiYWxseSIsCgkiYWxzYWNlIiwKCSJhbHN0b20iLAoJImFtYXpvbiIsCgkiYW1lcmljYW5leHByZXNzIiwKCSJhbWVyaWNhbmZhbWlseSIsCgkiYW1leCIsCgkiYW1mYW0iLAoJImFtaWNhIiwKCSJhbXN0ZXJkYW0iLAoJImFuYWx5dGljcyIsCgkiYW5kcm9pZCIsCgkiYW5xdWFuIiwKCSJhbnoiLAoJImFvbCIsCgkiYXBhcnRtZW50cyIsCgkiYXBwIiwKCSJhcHBsZSIsCgkiYXF1YXJlbGxlIiwKCSJhcmFiIiwKCSJhcmFtY28iLAoJImFyY2hpIiwKCSJhcm15IiwKCSJhcnQiLAoJImFydGUiLAoJImFzZGEiLAoJImFzc29jaWF0ZXMiLAoJImF0aGxldGEiLAoJImF0dG9ybmV5IiwKCSJhdWN0aW9uIiwKCSJhdWRpIiwKCSJhdWRpYmxlIiwKCSJhdWRpbyIsCgkiYXVzcG9zdCIsCgkiYXV0aG9yIiwKCSJhdXRvIiwKCSJhdXRvcyIsCgkiYXZpYW5jYSIsCgkiYXdzIiwKCSJheGEiLAoJImF6dXJlIiwKCSJiYWJ5IiwKCSJiYWlkdSIsCgkiYmFuYW1leCIsCgkiYmFuYW5hcmVwdWJsaWMiLAoJImJhbmQiLAoJImJhbmsiLAoJImJhciIsCgkiYmFyY2Vsb25hIiwKCSJiYXJjbGF5Y2FyZCIsCgkiYmFyY2xheXMiLAoJImJhcmVmb290IiwKCSJiYXJnYWlucyIsCgkiYmFzZWJhbGwiLAoJImJhc2tldGJhbGwiLAoJImJhdWhhdXMiLAoJImJheWVybiIsCgkiYmJjIiwKCSJiYnQiLAoJImJidmEiLAoJImJjZyIsCgkiYmNuIiwKCSJiZWF0cyIsCgkiYmVhdXR5IiwKCSJiZWVyIiwKCSJiZW50bGV5IiwKCSJiZXJsaW4iLAoJImJlc3QiLAoJImJlc3RidXkiLAoJImJldCIsCgkiYmhhcnRpIiwKCSJiaWJsZSIsCgkiYmlkIiwKCSJiaWtlIiwKCSJiaW5nIiwKCSJiaW5nbyIsCgkiYmlvIiwKCSJibGFjayIsCgkiYmxhY2tmcmlkYXkiLAoJImJsb2NrYnVzdGVyIiwKCSJibG9nIiwKCSJibG9vbWJlcmciLAoJImJsdWUiLAoJImJtcyIsCgkiYm13IiwKCSJibnBwYXJpYmFzIiwKCSJib2F0cyIsCgkiYm9laHJpbmdlciIsCgkiYm9mYSIsCgkiYm9tIiwKCSJib25kIiwKCSJib28iLAoJImJvb2siLAoJImJvb2tpbmciLAoJImJvc2NoIiwKCSJib3N0aWsiLAoJImJvc3RvbiIsCgkiYm90IiwKCSJib3V0aXF1ZSIsCgkiYm94IiwKCSJicmFkZXNjbyIsCgkiYnJpZGdlc3RvbmUiLAoJImJyb2Fkd2F5IiwKCSJicm9rZXIiLAoJImJyb3RoZXIiLAoJImJydXNzZWxzIiwKCSJidWdhdHRpIiwKCSJidWlsZCIsCgkiYnVpbGRlcnMiLAoJImJ1c2luZXNzIiwKCSJidXkiLAoJImJ1enoiLAoJImJ6aCIsCgkiY2FiIiwKCSJjYWZlIiwKCSJjYWwiLAoJImNhbGwiLAoJImNhbHZpbmtsZWluIiwKCSJjYW0iLAoJImNhbWVyYSIsCgkiY2FtcCIsCgkiY2FuY2VycmVzZWFyY2giLAoJImNhbm9uIiwKCSJjYXBldG93biIsCgkiY2FwaXRhbCIsCgkiY2FwaXRhbG9uZSIsCgkiY2FyIiwKCSJjYXJhdmFuIiwKCSJjYXJkcyIsCgkiY2FyZSIsCgkiY2FyZWVyIiwKCSJjYXJlZXJzIiwKCSJjYXJzIiwKCSJjYXNhIiwKCSJjYXNlIiwKCSJjYXNoIiwKCSJjYXNpbm8iLAoJImNhdGVyaW5nIiwKCSJjYXRob2xpYyIsCgkiY2JhIiwKCSJjYm4iLAoJImNicmUiLAoJImNicyIsCgkiY2VudGVyIiwKCSJjZW8iLAoJImNlcm4iLAoJImNmYSIsCgkiY2ZkIiwKCSJjaGFuZWwiLAoJImNoYW5uZWwiLAoJImNoYXJpdHkiLAoJImNoYXNlIiwKCSJjaGF0IiwKCSJjaGVhcCIsCgkiY2hpbnRhaSIsCgkiY2hyaXN0bWFzIiwKCSJjaHJvbWUiLAoJImNodXJjaCIsCgkiY2lwcmlhbmkiLAoJImNpcmNsZSIsCgkiY2lzY28iLAoJImNpdGFkZWwiLAoJImNpdGkiLAoJImNpdGljIiwKCSJjaXR5IiwKCSJjaXR5ZWF0cyIsCgkiY2xhaW1zIiwKCSJjbGVhbmluZyIsCgkiY2xpY2siLAoJImNsaW5pYyIsCgkiY2xpbmlxdWUiLAoJImNsb3RoaW5nIiwKCSJjbG91ZCIsCgkiY2x1YiIsCgkiY2x1Ym1lZCIsCgkiY29hY2giLAoJImNvZGVzIiwKCSJjb2ZmZWUiLAoJImNvbGxlZ2UiLAoJImNvbG9nbmUiLAoJImNvbWNhc3QiLAoJImNvbW1iYW5rIiwKCSJjb21tdW5pdHkiLAoJImNvbXBhbnkiLAoJImNvbXBhcmUiLAoJImNvbXB1dGVyIiwKCSJjb21zZWMiLAoJImNvbmRvcyIsCgkiY29uc3RydWN0aW9uIiwKCSJjb25zdWx0aW5nIiwKCSJjb250YWN0IiwKCSJjb250cmFjdG9ycyIsCgkiY29va2luZyIsCgkiY29va2luZ2NoYW5uZWwiLAoJImNvb2wiLAoJImNvcnNpY2EiLAoJImNvdW50cnkiLAoJImNvdXBvbiIsCgkiY291cG9ucyIsCgkiY291cnNlcyIsCgkiY3BhIiwKCSJjcmVkaXQiLAoJImNyZWRpdGNhcmQiLAoJImNyZWRpdHVuaW9uIiwKCSJjcmlja2V0IiwKCSJjcm93biIsCgkiY3JzIiwKCSJjcnVpc2UiLAoJImNydWlzZXMiLAoJImN1aXNpbmVsbGEiLAoJImN5bXJ1IiwKCSJjeW91IiwKCSJkYWJ1ciIsCgkiZGFkIiwKCSJkYW5jZSIsCgkiZGF0YSIsCgkiZGF0ZSIsCgkiZGF0aW5nIiwKCSJkYXRzdW4iLAoJImRheSIsCgkiZGNsayIsCgkiZGRzIiwKCSJkZWFsIiwKCSJkZWFsZXIiLAoJImRlYWxzIiwKCSJkZWdyZWUiLAoJImRlbGl2ZXJ5IiwKCSJkZWxsIiwKCSJkZWxvaXR0ZSIsCgkiZGVsdGEiLAoJImRlbW9jcmF0IiwKCSJkZW50YWwiLAoJImRlbnRpc3QiLAoJImRlc2kiLAoJImRlc2lnbiIsCgkiZGV2IiwKCSJkaGwiLAoJImRpYW1vbmRzIiwKCSJkaWV0IiwKCSJkaWdpdGFsIiwKCSJkaXJlY3QiLAoJImRpcmVjdG9yeSIsCgkiZGlzY291bnQiLAoJImRpc2NvdmVyIiwKCSJkaXNoIiwKCSJkaXkiLAoJImRucCIsCgkiZG9jcyIsCgkiZG9jdG9yIiwKCSJkb2ciLAoJImRvbWFpbnMiLAoJImRvdCIsCgkiZG93bmxvYWQiLAoJImRyaXZlIiwKCSJkdHYiLAoJImR1YmFpIiwKCSJkdW5sb3AiLAoJImR1cG9udCIsCgkiZHVyYmFuIiwKCSJkdmFnIiwKCSJkdnIiLAoJImVhcnRoIiwKCSJlYXQiLAoJImVjbyIsCgkiZWRla2EiLAoJImVkdWNhdGlvbiIsCgkiZW1haWwiLAoJImVtZXJjayIsCgkiZW5lcmd5IiwKCSJlbmdpbmVlciIsCgkiZW5naW5lZXJpbmciLAoJImVudGVycHJpc2VzIiwKCSJlcHNvbiIsCgkiZXF1aXBtZW50IiwKCSJlcmljc3NvbiIsCgkiZXJuaSIsCgkiZXNxIiwKCSJlc3RhdGUiLAoJImV0aXNhbGF0IiwKCSJldXJvdmlzaW9uIiwKCSJldXMiLAoJImV2ZW50cyIsCgkiZXhjaGFuZ2UiLAoJImV4cGVydCIsCgkiZXhwb3NlZCIsCgkiZXhwcmVzcyIsCgkiZXh0cmFzcGFjZSIsCgkiZmFnZSIsCgkiZmFpbCIsCgkiZmFpcndpbmRzIiwKCSJmYWl0aCIsCgkiZmFtaWx5IiwKCSJmYW4iLAoJImZhbnMiLAoJImZhcm0iLAoJImZhcm1lcnMiLAoJImZhc2hpb24iLAoJImZhc3QiLAoJImZlZGV4IiwKCSJmZWVkYmFjayIsCgkiZmVycmFyaSIsCgkiZmVycmVybyIsCgkiZmlhdCIsCgkiZmlkZWxpdHkiLAoJImZpZG8iLAoJImZpbG0iLAoJImZpbmFsIiwKCSJmaW5hbmNlIiwKCSJmaW5hbmNpYWwiLAoJImZpcmUiLAoJImZpcmVzdG9uZSIsCgkiZmlybWRhbGUiLAoJImZpc2giLAoJImZpc2hpbmciLAoJImZpdCIsCgkiZml0bmVzcyIsCgkiZmxpY2tyIiwKCSJmbGlnaHRzIiwKCSJmbGlyIiwKCSJmbG9yaXN0IiwKCSJmbG93ZXJzIiwKCSJmbHkiLAoJImZvbyIsCgkiZm9vZCIsCgkiZm9vZG5ldHdvcmsiLAoJImZvb3RiYWxsIiwKCSJmb3JkIiwKCSJmb3JleCIsCgkiZm9yc2FsZSIsCgkiZm9ydW0iLAoJImZvdW5kYXRpb24iLAoJImZveCIsCgkiZnJlZSIsCgkiZnJlc2VuaXVzIiwKCSJmcmwiLAoJImZyb2dhbnMiLAoJImZyb250ZG9vciIsCgkiZnJvbnRpZXIiLAoJImZ0ciIsCgkiZnVqaXRzdSIsCgkiZnVuIiwKCSJmdW5kIiwKCSJmdXJuaXR1cmUiLAoJImZ1dGJvbCIsCgkiZnlpIiwKCSJnYWwiLAoJImdhbGxlcnkiLAoJImdhbGxvIiwKCSJnYWxsdXAiLAoJImdhbWUiLAoJImdhbWVzIiwKCSJnYXAiLAoJImdhcmRlbiIsCgkiZ2F5IiwKCSJnYml6IiwKCSJnZG4iLAoJImdlYSIsCgkiZ2VudCIsCgkiZ2VudGluZyIsCgkiZ2VvcmdlIiwKCSJnZ2VlIiwKCSJnaWZ0IiwKCSJnaWZ0cyIsCgkiZ2l2ZXMiLAoJImdpdmluZyIsCgkiZ2xhc3MiLAoJImdsZSIsCgkiZ2xvYmFsIiwKCSJnbG9ibyIsCgkiZ21haWwiLAoJImdtYmgiLAoJImdtbyIsCgkiZ214IiwKCSJnb2RhZGR5IiwKCSJnb2xkIiwKCSJnb2xkcG9pbnQiLAoJImdvbGYiLAoJImdvbyIsCgkiZ29vZHllYXIiLAoJImdvb2ciLAoJImdvb2dsZSIsCgkiZ29wIiwKCSJnb3QiLAoJImdyYWluZ2VyIiwKCSJncmFwaGljcyIsCgkiZ3JhdGlzIiwKCSJncmVlbiIsCgkiZ3JpcGUiLAoJImdyb2NlcnkiLAoJImdyb3VwIiwKCSJndWFyZGlhbiIsCgkiZ3VjY2kiLAoJImd1Z2UiLAoJImd1aWRlIiwKCSJndWl0YXJzIiwKCSJndXJ1IiwKCSJoYWlyIiwKCSJoYW1idXJnIiwKCSJoYW5nb3V0IiwKCSJoYXVzIiwKCSJoYm8iLAoJImhkZmMiLAoJImhkZmNiYW5rIiwKCSJoZWFsdGgiLAoJImhlYWx0aGNhcmUiLAoJImhlbHAiLAoJImhlbHNpbmtpIiwKCSJoZXJlIiwKCSJoZXJtZXMiLAoJImhndHYiLAoJImhpcGhvcCIsCgkiaGlzYW1pdHN1IiwKCSJoaXRhY2hpIiwKCSJoaXYiLAoJImhrdCIsCgkiaG9ja2V5IiwKCSJob2xkaW5ncyIsCgkiaG9saWRheSIsCgkiaG9tZWRlcG90IiwKCSJob21lZ29vZHMiLAoJImhvbWVzIiwKCSJob21lc2Vuc2UiLAoJImhvbmRhIiwKCSJob3JzZSIsCgkiaG9zcGl0YWwiLAoJImhvc3QiLAoJImhvc3RpbmciLAoJImhvdCIsCgkiaG90ZWxlcyIsCgkiaG90ZWxzIiwKCSJob3RtYWlsIiwKCSJob3VzZSIsCgkiaG93IiwKCSJoc2JjIiwKCSJodWdoZXMiLAoJImh5YXR0IiwKCSJoeXVuZGFpIiwKCSJpYm0iLAoJImljYmMiLAoJImljZSIsCgkiaWN1IiwKCSJpZWVlIiwKCSJpZm0iLAoJImlrYW5vIiwKCSJpbWFtYXQiLAoJImltZGIiLAoJImltbW8iLAoJImltbW9iaWxpZW4iLAoJImluYyIsCgkiaW5kdXN0cmllcyIsCgkiaW5maW5pdGkiLAoJImluZyIsCgkiaW5rIiwKCSJpbnN0aXR1dGUiLAoJImluc3VyYW5jZSIsCgkiaW5zdXJlIiwKCSJpbnRlcm5hdGlvbmFsIiwKCSJpbnR1aXQiLAoJImludmVzdG1lbnRzIiwKCSJpcGlyYW5nYSIsCgkiaXJpc2giLAoJImlzbWFpbGkiLAoJImlzdCIsCgkiaXN0YW5idWwiLAoJIml0YXUiLAoJIml0diIsCgkiamFndWFyIiwKCSJqYXZhIiwKCSJqY2IiLAoJImplZXAiLAoJImpldHp0IiwKCSJqZXdlbHJ5IiwKCSJqaW8iLAoJImpsbCIsCgkiam1wIiwKCSJqbmoiLAoJImpvYnVyZyIsCgkiam90IiwKCSJqb3kiLAoJImpwbW9yZ2FuIiwKCSJqcHJzIiwKCSJqdWVnb3MiLAoJImp1bmlwZXIiLAoJImthdWZlbiIsCgkia2RkaSIsCgkia2Vycnlob3RlbHMiLAoJImtlcnJ5bG9naXN0aWNzIiwKCSJrZXJyeXByb3BlcnRpZXMiLAoJImtmaCIsCgkia2lhIiwKCSJraWRzIiwKCSJraW0iLAoJImtpbmRlciIsCgkia2luZGxlIiwKCSJraXRjaGVuIiwKCSJraXdpIiwKCSJrb2VsbiIsCgkia29tYXRzdSIsCgkia29zaGVyIiwKCSJrcG1nIiwKCSJrcG4iLAoJImtyZCIsCgkia3JlZCIsCgkia3Vva2dyb3VwIiwKCSJreW90byIsCgkibGFjYWl4YSIsCgkibGFtYm9yZ2hpbmkiLAoJImxhbWVyIiwKCSJsYW5jYXN0ZXIiLAoJImxhbmNpYSIsCgkibGFuZCIsCgkibGFuZHJvdmVyIiwKCSJsYW54ZXNzIiwKCSJsYXNhbGxlIiwKCSJsYXQiLAoJImxhdGlubyIsCgkibGF0cm9iZSIsCgkibGF3IiwKCSJsYXd5ZXIiLAoJImxkcyIsCgkibGVhc2UiLAoJImxlY2xlcmMiLAoJImxlZnJhayIsCgkibGVnYWwiLAoJImxlZ28iLAoJImxleHVzIiwKCSJsZ2J0IiwKCSJsaWRsIiwKCSJsaWZlIiwKCSJsaWZlaW5zdXJhbmNlIiwKCSJsaWZlc3R5bGUiLAoJImxpZ2h0aW5nIiwKCSJsaWtlIiwKCSJsaWxseSIsCgkibGltaXRlZCIsCgkibGltbyIsCgkibGluY29sbiIsCgkibGluZGUiLAoJImxpbmsiLAoJImxpcHN5IiwKCSJsaXZlIiwKCSJsaXZpbmciLAoJImxsYyIsCgkibGxwIiwKCSJsb2FuIiwKCSJsb2FucyIsCgkibG9ja2VyIiwKCSJsb2N1cyIsCgkibG9mdCIsCgkibG9sIiwKCSJsb25kb24iLAoJImxvdHRlIiwKCSJsb3R0byIsCgkibG92ZSIsCgkibHBsIiwKCSJscGxmaW5hbmNpYWwiLAoJImx0ZCIsCgkibHRkYSIsCgkibHVuZGJlY2siLAoJImx1eGUiLAoJImx1eHVyeSIsCgkibWFjeXMiLAoJIm1hZHJpZCIsCgkibWFpZiIsCgkibWFpc29uIiwKCSJtYWtldXAiLAoJIm1hbiIsCgkibWFuYWdlbWVudCIsCgkibWFuZ28iLAoJIm1hcCIsCgkibWFya2V0IiwKCSJtYXJrZXRpbmciLAoJIm1hcmtldHMiLAoJIm1hcnJpb3R0IiwKCSJtYXJzaGFsbHMiLAoJIm1hc2VyYXRpIiwKCSJtYXR0ZWwiLAoJIm1iYSIsCgkibWNraW5zZXkiLAoJIm1lZCIsCgkibWVkaWEiLAoJIm1lZXQiLAoJIm1lbGJvdXJuZSIsCgkibWVtZSIsCgkibWVtb3JpYWwiLAoJIm1lbiIsCgkibWVudSIsCgkibWVyY2ttc2QiLAoJIm1pYW1pIiwKCSJtaWNyb3NvZnQiLAoJIm1pbmkiLAoJIm1pbnQiLAoJIm1pdCIsCgkibWl0c3ViaXNoaSIsCgkibWxiIiwKCSJtbHMiLAoJIm1tYSIsCgkibW9iaWxlIiwKCSJtb2RhIiwKCSJtb2UiLAoJIm1vaSIsCgkibW9tIiwKCSJtb25hc2giLAoJIm1vbmV5IiwKCSJtb25zdGVyIiwKCSJtb3Jtb24iLAoJIm1vcnRnYWdlIiwKCSJtb3Njb3ciLAoJIm1vdG8iLAoJIm1vdG9yY3ljbGVzIiwKCSJtb3YiLAoJIm1vdmllIiwKCSJtc2QiLAoJIm10biIsCgkibXRyIiwKCSJtdXNpYyIsCgkibXV0dWFsIiwKCSJuYWIiLAoJIm5hZ295YSIsCgkibmF0dXJhIiwKCSJuYXZ5IiwKCSJuYmEiLAoJIm5lYyIsCgkibmV0YmFuayIsCgkibmV0ZmxpeCIsCgkibmV0d29yayIsCgkibmV1c3RhciIsCgkibmV3IiwKCSJuZXdzIiwKCSJuZXh0IiwKCSJuZXh0ZGlyZWN0IiwKCSJuZXh1cyIsCgkibmZsIiwKCSJuZ28iLAoJIm5oayIsCgkibmljbyIsCgkibmlrZSIsCgkibmlrb24iLAoJIm5pbmphIiwKCSJuaXNzYW4iLAoJIm5pc3NheSIsCgkibm9raWEiLAoJIm5vcnRod2VzdGVybm11dHVhbCIsCgkibm9ydG9uIiwKCSJub3ciLAoJIm5vd3J1eiIsCgkibm93dHYiLAoJIm5yYSIsCgkibnJ3IiwKCSJudHQiLAoJIm55YyIsCgkib2JpIiwKCSJvYnNlcnZlciIsCgkib2ZmaWNlIiwKCSJva2luYXdhIiwKCSJvbGF5YW4iLAoJIm9sYXlhbmdyb3VwIiwKCSJvbGRuYXZ5IiwKCSJvbGxvIiwKCSJvbWVnYSIsCgkib25lIiwKCSJvbmciLAoJIm9ubCIsCgkib25saW5lIiwKCSJvb28iLAoJIm9wZW4iLAoJIm9yYWNsZSIsCgkib3JhbmdlIiwKCSJvcmdhbmljIiwKCSJvcmlnaW5zIiwKCSJvc2FrYSIsCgkib3RzdWthIiwKCSJvdHQiLAoJIm92aCIsCgkicGFnZSIsCgkicGFuYXNvbmljIiwKCSJwYXJpcyIsCgkicGFycyIsCgkicGFydG5lcnMiLAoJInBhcnRzIiwKCSJwYXJ0eSIsCgkicGFzc2FnZW5zIiwKCSJwYXkiLAoJInBjY3ciLAoJInBldCIsCgkicGZpemVyIiwKCSJwaGFybWFjeSIsCgkicGhkIiwKCSJwaGlsaXBzIiwKCSJwaG9uZSIsCgkicGhvdG8iLAoJInBob3RvZ3JhcGh5IiwKCSJwaG90b3MiLAoJInBoeXNpbyIsCgkicGljcyIsCgkicGljdGV0IiwKCSJwaWN0dXJlcyIsCgkicGlkIiwKCSJwaW4iLAoJInBpbmciLAoJInBpbmsiLAoJInBpb25lZXIiLAoJInBpenphIiwKCSJwbGFjZSIsCgkicGxheSIsCgkicGxheXN0YXRpb24iLAoJInBsdW1iaW5nIiwKCSJwbHVzIiwKCSJwbmMiLAoJInBvaGwiLAoJInBva2VyIiwKCSJwb2xpdGllIiwKCSJwb3JuIiwKCSJwcmFtZXJpY2EiLAoJInByYXhpIiwKCSJwcmVzcyIsCgkicHJpbWUiLAoJInByb2QiLAoJInByb2R1Y3Rpb25zIiwKCSJwcm9mIiwKCSJwcm9ncmVzc2l2ZSIsCgkicHJvbW8iLAoJInByb3BlcnRpZXMiLAoJInByb3BlcnR5IiwKCSJwcm90ZWN0aW9uIiwKCSJwcnUiLAoJInBydWRlbnRpYWwiLAoJInB1YiIsCgkicHdjIiwKCSJxcG9uIiwKCSJxdWViZWMiLAoJInF1ZXN0IiwKCSJyYWNpbmciLAoJInJhZGlvIiwKCSJyZWFkIiwKCSJyZWFsZXN0YXRlIiwKCSJyZWFsdG9yIiwKCSJyZWFsdHkiLAoJInJlY2lwZXMiLAoJInJlZCIsCgkicmVkc3RvbmUiLAoJInJlZHVtYnJlbGxhIiwKCSJyZWhhYiIsCgkicmVpc2UiLAoJInJlaXNlbiIsCgkicmVpdCIsCgkicmVsaWFuY2UiLAoJInJlbiIsCgkicmVudCIsCgkicmVudGFscyIsCgkicmVwYWlyIiwKCSJyZXBvcnQiLAoJInJlcHVibGljYW4iLAoJInJlc3QiLAoJInJlc3RhdXJhbnQiLAoJInJldmlldyIsCgkicmV2aWV3cyIsCgkicmV4cm90aCIsCgkicmljaCIsCgkicmljaGFyZGxpIiwKCSJyaWNvaCIsCgkicmlsIiwKCSJyaW8iLAoJInJpcCIsCgkicm9jaGVyIiwKCSJyb2NrcyIsCgkicm9kZW8iLAoJInJvZ2VycyIsCgkicm9vbSIsCgkicnN2cCIsCgkicnVnYnkiLAoJInJ1aHIiLAoJInJ1biIsCgkicndlIiwKCSJyeXVreXUiLAoJInNhYXJsYW5kIiwKCSJzYWZlIiwKCSJzYWZldHkiLAoJInNha3VyYSIsCgkic2FsZSIsCgkic2Fsb24iLAoJInNhbXNjbHViIiwKCSJzYW1zdW5nIiwKCSJzYW5kdmlrIiwKCSJzYW5kdmlrY29yb21hbnQiLAoJInNhbm9maSIsCgkic2FwIiwKCSJzYXJsIiwKCSJzYXMiLAoJInNhdmUiLAoJInNheG8iLAoJInNiaSIsCgkic2JzIiwKCSJzY2EiLAoJInNjYiIsCgkic2NoYWVmZmxlciIsCgkic2NobWlkdCIsCgkic2Nob2xhcnNoaXBzIiwKCSJzY2hvb2wiLAoJInNjaHVsZSIsCgkic2Nod2FyeiIsCgkic2NpZW5jZSIsCgkic2NvdCIsCgkic2VhcmNoIiwKCSJzZWF0IiwKCSJzZWN1cmUiLAoJInNlY3VyaXR5IiwKCSJzZWVrIiwKCSJzZWxlY3QiLAoJInNlbmVyIiwKCSJzZXJ2aWNlcyIsCgkic2VzIiwKCSJzZXZlbiIsCgkic2V3IiwKCSJzZXgiLAoJInNleHkiLAoJInNmciIsCgkic2hhbmdyaWxhIiwKCSJzaGFycCIsCgkic2hhdyIsCgkic2hlbGwiLAoJInNoaWEiLAoJInNoaWtzaGEiLAoJInNob2VzIiwKCSJzaG9wIiwKCSJzaG9wcGluZyIsCgkic2hvdWppIiwKCSJzaG93IiwKCSJzaG93dGltZSIsCgkic2lsayIsCgkic2luYSIsCgkic2luZ2xlcyIsCgkic2l0ZSIsCgkic2tpIiwKCSJza2luIiwKCSJza3kiLAoJInNreXBlIiwKCSJzbGluZyIsCgkic21hcnQiLAoJInNtaWxlIiwKCSJzbmNmIiwKCSJzb2NjZXIiLAoJInNvY2lhbCIsCgkic29mdGJhbmsiLAoJInNvZnR3YXJlIiwKCSJzb2h1IiwKCSJzb2xhciIsCgkic29sdXRpb25zIiwKCSJzb25nIiwKCSJzb255IiwKCSJzb3kiLAoJInNwYSIsCgkic3BhY2UiLAoJInNwb3J0IiwKCSJzcG90IiwKCSJzcmwiLAoJInN0YWRhIiwKCSJzdGFwbGVzIiwKCSJzdGFyIiwKCSJzdGF0ZWJhbmsiLAoJInN0YXRlZmFybSIsCgkic3RjIiwKCSJzdGNncm91cCIsCgkic3RvY2tob2xtIiwKCSJzdG9yYWdlIiwKCSJzdG9yZSIsCgkic3RyZWFtIiwKCSJzdHVkaW8iLAoJInN0dWR5IiwKCSJzdHlsZSIsCgkic3Vja3MiLAoJInN1cHBsaWVzIiwKCSJzdXBwbHkiLAoJInN1cHBvcnQiLAoJInN1cmYiLAoJInN1cmdlcnkiLAoJInN1enVraSIsCgkic3dhdGNoIiwKCSJzd2lzcyIsCgkic3lkbmV5IiwKCSJzeXN0ZW1zIiwKCSJ0YWIiLAoJInRhaXBlaSIsCgkidGFsayIsCgkidGFvYmFvIiwKCSJ0YXJnZXQiLAoJInRhdGFtb3RvcnMiLAoJInRhdGFyIiwKCSJ0YXR0b28iLAoJInRheCIsCgkidGF4aSIsCgkidGNpIiwKCSJ0ZGsiLAoJInRlYW0iLAoJInRlY2giLAoJInRlY2hub2xvZ3kiLAoJInRlbWFzZWsiLAoJInRlbm5pcyIsCgkidGV2YSIsCgkidGhkIiwKCSJ0aGVhdGVyIiwKCSJ0aGVhdHJlIiwKCSJ0aWFhIiwKCSJ0aWNrZXRzIiwKCSJ0aWVuZGEiLAoJInRpZmZhbnkiLAoJInRpcHMiLAoJInRpcmVzIiwKCSJ0aXJvbCIsCgkidGptYXh4IiwKCSJ0angiLAoJInRrbWF4eCIsCgkidG1hbGwiLAoJInRvZGF5IiwKCSJ0b2t5byIsCgkidG9vbHMiLAoJInRvcCIsCgkidG9yYXkiLAoJInRvc2hpYmEiLAoJInRvdGFsIiwKCSJ0b3VycyIsCgkidG93biIsCgkidG95b3RhIiwKCSJ0b3lzIiwKCSJ0cmFkZSIsCgkidHJhZGluZyIsCgkidHJhaW5pbmciLAoJInRyYXZlbCIsCgkidHJhdmVsY2hhbm5lbCIsCgkidHJhdmVsZXJzIiwKCSJ0cmF2ZWxlcnNpbnN1cmFuY2UiLAoJInRydXN0IiwKCSJ0cnYiLAoJInR1YmUiLAoJInR1aSIsCgkidHVuZXMiLAoJInR1c2h1IiwKCSJ0dnMiLAoJInViYW5rIiwKCSJ1YnMiLAoJInVuaWNvbSIsCgkidW5pdmVyc2l0eSIsCgkidW5vIiwKCSJ1b2wiLAoJInVwcyIsCgkidmFjYXRpb25zIiwKCSJ2YW5hIiwKCSJ2YW5ndWFyZCIsCgkidmVnYXMiLAoJInZlbnR1cmVzIiwKCSJ2ZXJpc2lnbiIsCgkidmVyc2ljaGVydW5nIiwKCSJ2ZXQiLAoJInZpYWplcyIsCgkidmlkZW8iLAoJInZpZyIsCgkidmlraW5nIiwKCSJ2aWxsYXMiLAoJInZpbiIsCgkidmlwIiwKCSJ2aXJnaW4iLAoJInZpc2EiLAoJInZpc2lvbiIsCgkidml2YSIsCgkidml2byIsCgkidmxhYW5kZXJlbiIsCgkidm9ka2EiLAoJInZvbGtzd2FnZW4iLAoJInZvbHZvIiwKCSJ2b3RlIiwKCSJ2b3RpbmciLAoJInZvdG8iLAoJInZveWFnZSIsCgkidnVlbG9zIiwKCSJ3YWxlcyIsCgkid2FsbWFydCIsCgkid2FsdGVyIiwKCSJ3YW5nIiwKCSJ3YW5nZ291IiwKCSJ3YXRjaCIsCgkid2F0Y2hlcyIsCgkid2VhdGhlciIsCgkid2VhdGhlcmNoYW5uZWwiLAoJIndlYmNhbSIsCgkid2ViZXIiLAoJIndlYnNpdGUiLAoJIndlZGRpbmciLAoJIndlaWJvIiwKCSJ3ZWlyIiwKCSJ3aG9zd2hvIiwKCSJ3aWVuIiwKCSJ3aWtpIiwKCSJ3aWxsaWFtaGlsbCIsCgkid2luIiwKCSJ3aW5kb3dzIiwKCSJ3aW5lIiwKCSJ3aW5uZXJzIiwKCSJ3bWUiLAoJIndvbHRlcnNrbHV3ZXIiLAoJIndvb2RzaWRlIiwKCSJ3b3JrIiwKCSJ3b3JrcyIsCgkid29ybGQiLAoJIndvdyIsCgkid3RjIiwKCSJ3dGYiLAoJInhib3giLAoJInhlcm94IiwKCSJ4ZmluaXR5IiwKCSJ4aWh1YW4iLAoJInhpbiIsCgki4KSV4KWJ4KSuIiwKCSLjgrvjg7zjg6siLAoJIuS9m+WxsSIsCgki5oWI5ZaEIiwKCSLpm4blm6IiLAoJIuWcqOe6vyIsCgki54K555yLIiwKCSLguITguK3guKEiLAoJIuWFq+WNpiIsCgki2YXZiNmC2LkiLAoJIuWFrOebiiIsCgki5YWs5Y+4IiwKCSLpppnmoLzph4zmi4kiLAoJIue9keermSIsCgki56e75YqoIiwKCSLmiJHniLHkvaAiLAoJItC80L7RgdC60LLQsCIsCgki0LrQsNGC0L7Qu9C40LoiLAoJItC+0L3Qu9Cw0LnQvSIsCgki0YHQsNC50YIiLAoJIuiBlOmAmiIsCgki16fXldedIiwKCSLml7blsJoiLAoJIuW+ruWNmiIsCgki5reh6ams6ZShIiwKCSLjg5XjgqHjg4Pjgrfjg6fjg7MiLAoJItC+0YDQsyIsCgki4KSo4KWH4KSfIiwKCSLjgrnjg4jjgqIiLAoJIuOCouODnuOCvuODsyIsCgki7IK87ISxIiwKCSLllYbmoIciLAoJIuWVhuW6lyIsCgki5ZWG5Z+OIiwKCSLQtNC10YLQuCIsCgki44Od44Kk44Oz44OIIiwKCSLmlrDpl7siLAoJIuWutumbuyIsCgki2YPZiNmFIiwKCSLkuK3mlofnvZEiLAoJIuS4reS/oSIsCgki5aix5LmQIiwKCSLosLfmrYwiLAoJIumbu+ioiuebiOenkSIsCgki6LSt54mpIiwKCSLjgq/jg6njgqbjg4kiLAoJIumAmuiyqSIsCgki572R5bqXIiwKCSLgpLjgpILgpJfgpKDgpKgiLAoJIumkkOWOhSIsCgki572R57ucIiwKCSLQutC+0LwiLAoJIuS6mumprOmAiiIsCgki6K+65Z+65LqaIiwKCSLpo5/lk4EiLAoJIumjnuWIqea1piIsCgki5omL5py6IiwKCSLYp9ix2KfZhdmD2YgiLAoJItin2YTYudmE2YrYp9mGIiwKCSLYp9iq2LXYp9mE2KfYqiIsCgki2KjYp9iy2KfYsSIsCgki2KfYqNmI2LjYqNmKIiwKCSLZg9in2KvZiNmE2YrZgyIsCgki2YfZhdix2KfZhyIsCgki64u37Lu0IiwKCSLmlL/lupwiLAoJIti02KjZg9ipIiwKCSLYqNmK2KrZgyIsCgki2LnYsdioIiwKCSLmnLrmnoQiLAoJIue7hOe7h+acuuaehCIsCgki5YGl5bq3IiwKCSLmi5vogZgiLAoJItGA0YPRgSIsCgki5aSn5ou/IiwKCSLjgb/jgpPjgaoiLAoJIuOCsOODvOOCsOODqyIsCgki5LiW55WMIiwKCSLmm7jnsY0iLAoJIue9keWdgCIsCgki64u364S3IiwKCSLjgrPjg6AiLAoJIuWkqeS4u+aVmSIsCgki5ri45oiPIiwKCSJ2ZXJtw7ZnZW5zYmVyYXRlciIsCgkidmVybcO2Z2Vuc2JlcmF0dW5nIiwKCSLkvIHkuJoiLAoJIuS/oeaBryIsCgki5ZiJ6YeM5aSn6YWS5bqXIiwKCSLlmInph4wiLAoJIuW5v+S4nCIsCgki5pS/5YqhIiwKCSJ4eXoiLAoJInlhY2h0cyIsCgkieWFob28iLAoJInlhbWF4dW4iLAoJInlhbmRleCIsCgkieW9kb2Jhc2hpIiwKCSJ5b2dhIiwKCSJ5b2tvaGFtYSIsCgkieW91IiwKCSJ5b3V0dWJlIiwKCSJ5dW4iLAoJInphcHBvcyIsCgkiemFyYSIsCgkiemVybyIsCgkiemlwIiwKCSJ6b25lIiwKCSJ6dWVyaWNoIiwKCSJjYy51YSIsCgkiaW5mLnVhIiwKCSJsdGQudWEiLAoJIjYxMS50byIsCgkiZ3JhcGhveC51cyIsCgkiKi5kZXZjZG5hY2Nlc3NvLmNvbSIsCgkiYWRvYmVhZW1jbG91ZC5jb20iLAoJIiouZGV2LmFkb2JlYWVtY2xvdWQuY29tIiwKCSJobHgubGl2ZSIsCgkiYWRvYmVhZW1jbG91ZC5uZXQiLAoJImhseC5wYWdlIiwKCSJobHgzLnBhZ2UiLAoJImJlZXAucGwiLAoJImFpcmtpdGFwcHMuY29tIiwKCSJhaXJraXRhcHBzLWF1LmNvbSIsCgkiYWlya2l0YXBwcy5ldSIsCgkiYWl2ZW5jbG91ZC5jb20iLAoJImJhcnN5LmNhIiwKCSIqLmNvbXB1dGUuZXN0YXRlIiwKCSIqLmFsY2VzLm5ldHdvcmsiLAoJImthc3NlcnZlci5jb20iLAoJImFsdGVydmlzdGEub3JnIiwKCSJhbHdheXNkYXRhLm5ldCIsCgkiY2xvdWRmcm9udC5uZXQiLAoJIiouY29tcHV0ZS5hbWF6b25hd3MuY29tIiwKCSIqLmNvbXB1dGUtMS5hbWF6b25hd3MuY29tIiwKCSIqLmNvbXB1dGUuYW1hem9uYXdzLmNvbS5jbiIsCgkidXMtZWFzdC0xLmFtYXpvbmF3cy5jb20iLAoJImNuLW5vcnRoLTEuZWIuYW1hem9uYXdzLmNvbS5jbiIsCgkiY24tbm9ydGh3ZXN0LTEuZWIuYW1hem9uYXdzLmNvbS5jbiIsCgkiZWxhc3RpY2JlYW5zdGFsay5jb20iLAoJImFwLW5vcnRoZWFzdC0xLmVsYXN0aWNiZWFuc3RhbGsuY29tIiwKCSJhcC1ub3J0aGVhc3QtMi5lbGFzdGljYmVhbnN0YWxrLmNvbSIsCgkiYXAtbm9ydGhlYXN0LTMuZWxhc3RpY2JlYW5zdGFsay5jb20iLAoJImFwLXNvdXRoLTEuZWxhc3RpY2JlYW5zdGFsay5jb20iLAoJImFwLXNvdXRoZWFzdC0xLmVsYXN0aWNiZWFuc3RhbGsuY29tIiwKCSJhcC1zb3V0aGVhc3QtMi5lbGFzdGljYmVhbnN0YWxrLmNvbSIsCgkiY2EtY2VudHJhbC0xLmVsYXN0aWNiZWFuc3RhbGsuY29tIiwKCSJldS1jZW50cmFsLTEuZWxhc3RpY2JlYW5zdGFsay5jb20iLAoJImV1LXdlc3QtMS5lbGFzdGljYmVhbnN0YWxrLmNvbSIsCgkiZXUtd2VzdC0yLmVsYXN0aWNiZWFuc3RhbGsuY29tIiwKCSJldS13ZXN0LTMuZWxhc3RpY2JlYW5zdGFsay5jb20iLAoJInNhLWVhc3QtMS5lbGFzdGljYmVhbnN0YWxrLmNvbSIsCgkidXMtZWFzdC0xLmVsYXN0aWNiZWFuc3RhbGsuY29tIiwKCSJ1cy1lYXN0LTIuZWxhc3RpY2JlYW5zdGFsay5jb20iLAoJInVzLWdvdi13ZXN0LTEuZWxhc3RpY2JlYW5zdGFsay5jb20iLAoJInVzLXdlc3QtMS5lbGFzdGljYmVhbnN0YWxrLmNvbSIsCgkidXMtd2VzdC0yLmVsYXN0aWNiZWFuc3RhbGsuY29tIiwKCSIqLmVsYi5hbWF6b25hd3MuY29tIiwKCSIqLmVsYi5hbWF6b25hd3MuY29tLmNuIiwKCSJhd3NnbG9iYWxhY2NlbGVyYXRvci5jb20iLAoJInMzLmFtYXpvbmF3cy5jb20iLAoJInMzLWFwLW5vcnRoZWFzdC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLWFwLW5vcnRoZWFzdC0yLmFtYXpvbmF3cy5jb20iLAoJInMzLWFwLXNvdXRoLTEuYW1hem9uYXdzLmNvbSIsCgkiczMtYXAtc291dGhlYXN0LTEuYW1hem9uYXdzLmNvbSIsCgkiczMtYXAtc291dGhlYXN0LTIuYW1hem9uYXdzLmNvbSIsCgkiczMtY2EtY2VudHJhbC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLWV1LWNlbnRyYWwtMS5hbWF6b25hd3MuY29tIiwKCSJzMy1ldS13ZXN0LTEuYW1hem9uYXdzLmNvbSIsCgkiczMtZXUtd2VzdC0yLmFtYXpvbmF3cy5jb20iLAoJInMzLWV1LXdlc3QtMy5hbWF6b25hd3MuY29tIiwKCSJzMy1leHRlcm5hbC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLWZpcHMtdXMtZ292LXdlc3QtMS5hbWF6b25hd3MuY29tIiwKCSJzMy1zYS1lYXN0LTEuYW1hem9uYXdzLmNvbSIsCgkiczMtdXMtZ292LXdlc3QtMS5hbWF6b25hd3MuY29tIiwKCSJzMy11cy1lYXN0LTIuYW1hem9uYXdzLmNvbSIsCgkiczMtdXMtd2VzdC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLXVzLXdlc3QtMi5hbWF6b25hd3MuY29tIiwKCSJzMy5hcC1ub3J0aGVhc3QtMi5hbWF6b25hd3MuY29tIiwKCSJzMy5hcC1zb3V0aC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLmNuLW5vcnRoLTEuYW1hem9uYXdzLmNvbS5jbiIsCgkiczMuY2EtY2VudHJhbC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLmV1LWNlbnRyYWwtMS5hbWF6b25hd3MuY29tIiwKCSJzMy5ldS13ZXN0LTIuYW1hem9uYXdzLmNvbSIsCgkiczMuZXUtd2VzdC0zLmFtYXpvbmF3cy5jb20iLAoJInMzLnVzLWVhc3QtMi5hbWF6b25hd3MuY29tIiwKCSJzMy5kdWFsc3RhY2suYXAtbm9ydGhlYXN0LTEuYW1hem9uYXdzLmNvbSIsCgkiczMuZHVhbHN0YWNrLmFwLW5vcnRoZWFzdC0yLmFtYXpvbmF3cy5jb20iLAoJInMzLmR1YWxzdGFjay5hcC1zb3V0aC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLmR1YWxzdGFjay5hcC1zb3V0aGVhc3QtMS5hbWF6b25hd3MuY29tIiwKCSJzMy5kdWFsc3RhY2suYXAtc291dGhlYXN0LTIuYW1hem9uYXdzLmNvbSIsCgkiczMuZHVhbHN0YWNrLmNhLWNlbnRyYWwtMS5hbWF6b25hd3MuY29tIiwKCSJzMy5kdWFsc3RhY2suZXUtY2VudHJhbC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLmR1YWxzdGFjay5ldS13ZXN0LTEuYW1hem9uYXdzLmNvbSIsCgkiczMuZHVhbHN0YWNrLmV1LXdlc3QtMi5hbWF6b25hd3MuY29tIiwKCSJzMy5kdWFsc3RhY2suZXUtd2VzdC0zLmFtYXpvbmF3cy5jb20iLAoJInMzLmR1YWxzdGFjay5zYS1lYXN0LTEuYW1hem9uYXdzLmNvbSIsCgkiczMuZHVhbHN0YWNrLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tIiwKCSJzMy5kdWFsc3RhY2sudXMtZWFzdC0yLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUtdXMtZWFzdC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUtdXMtd2VzdC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUtdXMtd2VzdC0yLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUtYXAtbm9ydGhlYXN0LTEuYW1hem9uYXdzLmNvbSIsCgkiczMtd2Vic2l0ZS1hcC1zb3V0aGVhc3QtMS5hbWF6b25hd3MuY29tIiwKCSJzMy13ZWJzaXRlLWFwLXNvdXRoZWFzdC0yLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUtZXUtd2VzdC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUtc2EtZWFzdC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUuYXAtbm9ydGhlYXN0LTIuYW1hem9uYXdzLmNvbSIsCgkiczMtd2Vic2l0ZS5hcC1zb3V0aC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUuY2EtY2VudHJhbC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUuZXUtY2VudHJhbC0xLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUuZXUtd2VzdC0yLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUuZXUtd2VzdC0zLmFtYXpvbmF3cy5jb20iLAoJInMzLXdlYnNpdGUudXMtZWFzdC0yLmFtYXpvbmF3cy5jb20iLAoJInQzbDNwMHJ0Lm5ldCIsCgkidGVsZS5hbXVuZS5vcmciLAoJImFwaWdlZS5pbyIsCgkic2lpaXRlcy5jb20iLAoJImFwcHNwYWNlaG9zdGVkLmNvbSIsCgkiYXBwc3BhY2V1c2VyY29udGVudC5jb20iLAoJImFwcHVkby5uZXQiLAoJIm9uLWFwdGlibGUuY29tIiwKCSJ1c2VyLmFzZWluZXQubmUuanAiLAoJImd2LnZjIiwKCSJkLmd2LnZjIiwKCSJ1c2VyLnBhcnR5LmV1cyIsCgkicGltaWVudGEub3JnIiwKCSJwb2l2cm9uLm9yZyIsCgkicG90YWdlci5vcmciLAoJInN3ZWV0cGVwcGVyLm9yZyIsCgkibXlhc3VzdG9yLmNvbSIsCgkiY2RuLnByb2QuYXRsYXNzaWFuLWRldi5uZXQiLAoJInRyYW5zbGF0ZWQucGFnZSIsCgkibXlmcml0ei5uZXQiLAoJIm9uYXZzdGFjay5uZXQiLAoJIiouYXdkZXYuY2EiLAoJIiouYWR2aXNvci53cyIsCgkiZWNvbW1lcmNlLXNob3AucGwiLAoJImItZGF0YS5pbyIsCgkiYmFja3BsYW5lYXBwLmlvIiwKCSJiYWxlbmEtZGV2aWNlcy5jb20iLAoJInJzLmJhIiwKCSIqLmJhbnphaS5jbG91ZCIsCgkiYXBwLmJhbnphaWNsb3VkLmlvIiwKCSIqLmJhY2t5YXJkcy5iYW56YWljbG91ZC5pbyIsCgkiYmFzZS5lYyIsCgkib2ZmaWNpYWwuZWMiLAoJImJ1eXNob3AuanAiLAoJImZhc2hpb25zdG9yZS5qcCIsCgkiaGFuZGNyYWZ0ZWQuanAiLAoJImthd2FpaXNob3AuanAiLAoJInN1cGVyc2FsZS5qcCIsCgkidGhlc2hvcC5qcCIsCgkic2hvcHNlbGVjdC5uZXQiLAoJImJhc2Uuc2hvcCIsCgkiKi5iZWdldC5hcHAiLAoJImJldGFpbmFib3guY29tIiwKCSJibnIubGEiLAoJImJpdGJ1Y2tldC5pbyIsCgkiYmxhY2tiYXVkY2RuLm5ldCIsCgkib2YuamUiLAoJImJsdWViaXRlLmlvIiwKCSJib29tbGEubmV0IiwKCSJib3V0aXIuY29tIiwKCSJib3hmdXNlLmlvIiwKCSJzcXVhcmU3LmNoIiwKCSJicGxhY2VkLmNvbSIsCgkiYnBsYWNlZC5kZSIsCgkic3F1YXJlNy5kZSIsCgkiYnBsYWNlZC5uZXQiLAoJInNxdWFyZTcubmV0IiwKCSJzaG9wLmJyZW5kbHkucnMiLAoJImJyb3dzZXJzYWZldHltYXJrLmlvIiwKCSJ1azAuYmlndi5pbyIsCgkiZGguYnl0ZW1hcmsuY28udWsiLAoJInZtLmJ5dGVtYXJrLmNvLnVrIiwKCSJjYWZqcy5jb20iLAoJIm15Y2QuZXUiLAoJImRyci5hYyIsCgkidXd1LmFpIiwKCSJjYXJyZC5jbyIsCgkiY3JkLmNvIiwKCSJqdS5tcCIsCgkiYWUub3JnIiwKCSJici5jb20iLAoJImNuLmNvbSIsCgkiY29tLmRlIiwKCSJjb20uc2UiLAoJImRlLmNvbSIsCgkiZXUuY29tIiwKCSJnYi5uZXQiLAoJImh1Lm5ldCIsCgkianAubmV0IiwKCSJqcG4uY29tIiwKCSJtZXguY29tIiwKCSJydS5jb20iLAoJInNhLmNvbSIsCgkic2UubmV0IiwKCSJ1ay5jb20iLAoJInVrLm5ldCIsCgkidXMuY29tIiwKCSJ6YS5ieiIsCgkiemEuY29tIiwKCSJhci5jb20iLAoJImh1LmNvbSIsCgkia3IuY29tIiwKCSJuby5jb20iLAoJInFjLmNvbSIsCgkidXkuY29tIiwKCSJhZnJpY2EuY29tIiwKCSJnci5jb20iLAoJImluLm5ldCIsCgkid2ViLmluIiwKCSJ1cy5vcmciLAoJImNvLmNvbSIsCgkiYXVzLmJhc2tldGJhbGwiLAoJIm56LmJhc2tldGJhbGwiLAoJInJhZGlvLmFtIiwKCSJyYWRpby5mbSIsCgkiYy5sYSIsCgkiY2VydG1nci5vcmciLAoJImN4LnVhIiwKCSJkaXNjb3Vyc2UuZ3JvdXAiLAoJImRpc2NvdXJzZS50ZWFtIiwKCSJjbGV2ZXJhcHBzLmlvIiwKCSJjbGVyay5hcHAiLAoJImNsZXJrc3RhZ2UuYXBwIiwKCSIqLmxjbC5kZXYiLAoJIioubGNsc3RhZ2UuZGV2IiwKCSIqLnN0Zy5kZXYiLAoJIiouc3Rnc3RhZ2UuZGV2IiwKCSJjbGlja3Jpc2luZy5uZXQiLAoJImM2Ni5tZSIsCgkiY2xvdWQ2Ni53cyIsCgkiY2xvdWQ2Ni56b25lIiwKCSJqZGV2Y2xvdWQuY29tIiwKCSJ3cGRldmNsb3VkLmNvbSIsCgkiY2xvdWRhY2Nlc3MuaG9zdCIsCgkiZnJlZXNpdGUuaG9zdCIsCgkiY2xvdWRhY2Nlc3MubmV0IiwKCSJjbG91ZGNvbnRyb2xsZWQuY29tIiwKCSJjbG91ZGNvbnRyb2xhcHAuY29tIiwKCSIqLmNsb3VkZXJhLnNpdGUiLAoJInBhZ2VzLmRldiIsCgkidHJ5Y2xvdWRmbGFyZS5jb20iLAoJIndvcmtlcnMuZGV2IiwKCSJ3bmV4dC5hcHAiLAoJImNvLmNhIiwKCSIqLm90YXAuY28iLAoJImNvLmN6IiwKCSJjLmNkbjc3Lm9yZyIsCgkiY2RuNzctc3NsLm5ldCIsCgkici5jZG43Ny5uZXQiLAoJInJzYy5jZG43Ny5vcmciLAoJInNzbC5vcmlnaW4uY2RuNzctc2VjdXJlLm9yZyIsCgkiY2xvdWRucy5hc2lhIiwKCSJjbG91ZG5zLmJpeiIsCgkiY2xvdWRucy5jbHViIiwKCSJjbG91ZG5zLmNjIiwKCSJjbG91ZG5zLmV1IiwKCSJjbG91ZG5zLmluIiwKCSJjbG91ZG5zLmluZm8iLAoJImNsb3VkbnMub3JnIiwKCSJjbG91ZG5zLnBybyIsCgkiY2xvdWRucy5wdyIsCgkiY2xvdWRucy51cyIsCgkiY25weS5nZG4iLAoJImNvZGViZXJnLnBhZ2UiLAoJImNvLm5sIiwKCSJjby5ubyIsCgkid2ViaG9zdGluZy5iZSIsCgkiaG9zdGluZy1jbHVzdGVyLm5sIiwKCSJhYy5ydSIsCgkiZWR1LnJ1IiwKCSJnb3YucnUiLAoJImludC5ydSIsCgkibWlsLnJ1IiwKCSJ0ZXN0LnJ1IiwKCSJkeW4uY29zaWRucy5kZSIsCgkiZHluYW1pc2NoZXMtZG5zLmRlIiwKCSJkbnN1cGRhdGVyLmRlIiwKCSJpbnRlcm5ldC1kbnMuZGUiLAoJImwtby1nLWktbi5kZSIsCgkiZHluYW1pYy1kbnMuaW5mbyIsCgkiZmVzdGUtaXAubmV0IiwKCSJrbngtc2VydmVyLm5ldCIsCgkic3RhdGljLWFjY2Vzcy5uZXQiLAoJInJlYWxtLmN6IiwKCSIqLmNyeXB0b25vbWljLm5ldCIsCgkiY3VwY2FrZS5pcyIsCgkiY3Vydi5kZXYiLAoJIiouY3VzdG9tZXItb2NpLmNvbSIsCgkiKi5vY2kuY3VzdG9tZXItb2NpLmNvbSIsCgkiKi5vY3AuY3VzdG9tZXItb2NpLmNvbSIsCgkiKi5vY3MuY3VzdG9tZXItb2NpLmNvbSIsCgkiY3lvbi5saW5rIiwKCSJjeW9uLnNpdGUiLAoJImZud2suc2l0ZSIsCgkiZm9saW9uZXR3b3JrLnNpdGUiLAoJInBsYXRmb3JtMC5hcHAiLAoJImRhcGxpZS5tZSIsCgkibG9jYWxob3N0LmRhcGxpZS5tZSIsCgkiZGF0dG9sb2NhbC5jb20iLAoJImRhdHRvcmVsYXkuY29tIiwKCSJkYXR0b3dlYi5jb20iLAoJIm15ZGF0dG8uY29tIiwKCSJkYXR0b2xvY2FsLm5ldCIsCgkibXlkYXR0by5uZXQiLAoJImJpei5kayIsCgkiY28uZGsiLAoJImZpcm0uZGsiLAoJInJlZy5kayIsCgkic3RvcmUuZGsiLAoJImR5bmRucy5kYXBwbm9kZS5pbyIsCgkiKi5kYXBwcy5lYXJ0aCIsCgkiKi5ienouZGFwcHMuZWFydGgiLAoJImJ1aWx0d2l0aGRhcmsuY29tIiwKCSJkZW1vLmRhdGFkZXRlY3QuY29tIiwKCSJpbnN0YW5jZS5kYXRhZGV0ZWN0LmNvbSIsCgkiZWRnZXN0YWNrLm1lIiwKCSJkZG5zNS5jb20iLAoJImRlYmlhbi5uZXQiLAoJImRlbm8uZGV2IiwKCSJkZW5vLXN0YWdpbmcuZGV2IiwKCSJkZWR5bi5pbyIsCgkiZGV0YS5hcHAiLAoJImRldGEuZGV2IiwKCSIqLnJzcy5teS5pZCIsCgkiKi5kaWhlci5zb2x1dGlvbnMiLAoJImRpc2NvcmRzYXlzLmNvbSIsCgkiZGlzY29yZHNlei5jb20iLAoJImpvemkuYml6IiwKCSJkbnNob21lLmRlIiwKCSJvbmxpbmUudGgiLAoJInNob3AudGgiLAoJImRyYXlkZG5zLmNvbSIsCgkic2hvcGFyZW5hLnBsIiwKCSJkcmVhbWhvc3RlcnMuY29tIiwKCSJteWRyb2JvLmNvbSIsCgkiZHJ1ZC5pbyIsCgkiZHJ1ZC51cyIsCgkiZHVja2Rucy5vcmciLAoJImJpcC5zaCIsCgkiYml0YnJpZGdlLm5ldCIsCgkiZHkuZmkiLAoJInR1bmsub3JnIiwKCSJkeW5kbnMtYXQtaG9tZS5jb20iLAoJImR5bmRucy1hdC13b3JrLmNvbSIsCgkiZHluZG5zLWJsb2cuY29tIiwKCSJkeW5kbnMtZnJlZS5jb20iLAoJImR5bmRucy1ob21lLmNvbSIsCgkiZHluZG5zLWlwLmNvbSIsCgkiZHluZG5zLW1haWwuY29tIiwKCSJkeW5kbnMtb2ZmaWNlLmNvbSIsCgkiZHluZG5zLXBpY3MuY29tIiwKCSJkeW5kbnMtcmVtb3RlLmNvbSIsCgkiZHluZG5zLXNlcnZlci5jb20iLAoJImR5bmRucy13ZWIuY29tIiwKCSJkeW5kbnMtd2lraS5jb20iLAoJImR5bmRucy13b3JrLmNvbSIsCgkiZHluZG5zLmJpeiIsCgkiZHluZG5zLmluZm8iLAoJImR5bmRucy5vcmciLAoJImR5bmRucy50diIsCgkiYXQtYmFuZC1jYW1wLm5ldCIsCgkiYXRoLmN4IiwKCSJiYXJyZWwtb2Yta25vd2xlZGdlLmluZm8iLAoJImJhcnJlbGwtb2Yta25vd2xlZGdlLmluZm8iLAoJImJldHRlci10aGFuLnR2IiwKCSJibG9nZG5zLmNvbSIsCgkiYmxvZ2Rucy5uZXQiLAoJImJsb2dkbnMub3JnIiwKCSJibG9nc2l0ZS5vcmciLAoJImJvbGRseWdvaW5nbm93aGVyZS5vcmciLAoJImJyb2tlLWl0Lm5ldCIsCgkiYnV5c2hvdXNlcy5uZXQiLAoJImNlY2hpcmUuY29tIiwKCSJkbnNhbGlhcy5jb20iLAoJImRuc2FsaWFzLm5ldCIsCgkiZG5zYWxpYXMub3JnIiwKCSJkbnNkb2pvLmNvbSIsCgkiZG5zZG9qby5uZXQiLAoJImRuc2Rvam8ub3JnIiwKCSJkb2VzLWl0Lm5ldCIsCgkiZG9lc250ZXhpc3QuY29tIiwKCSJkb2VzbnRleGlzdC5vcmciLAoJImRvbnRleGlzdC5jb20iLAoJImRvbnRleGlzdC5uZXQiLAoJImRvbnRleGlzdC5vcmciLAoJImRvb21kbnMuY29tIiwKCSJkb29tZG5zLm9yZyIsCgkiZHZyZG5zLm9yZyIsCgkiZHluLW8tc2F1ci5jb20iLAoJImR5bmFsaWFzLmNvbSIsCgkiZHluYWxpYXMubmV0IiwKCSJkeW5hbGlhcy5vcmciLAoJImR5bmF0aG9tZS5uZXQiLAoJImR5bmRucy53cyIsCgkiZW5kb2ZpbnRlcm5ldC5uZXQiLAoJImVuZG9maW50ZXJuZXQub3JnIiwKCSJlbmRvZnRoZWludGVybmV0Lm9yZyIsCgkiZXN0LWEtbGEtbWFpc29uLmNvbSIsCgkiZXN0LWEtbGEtbWFzaW9uLmNvbSIsCgkiZXN0LWxlLXBhdHJvbi5jb20iLAoJImVzdC1tb24tYmxvZ3VldXIuY29tIiwKCSJmb3ItYmV0dGVyLmJpeiIsCgkiZm9yLW1vcmUuYml6IiwKCSJmb3Itb3VyLmluZm8iLAoJImZvci1zb21lLmJpeiIsCgkiZm9yLXRoZS5iaXoiLAoJImZvcmdvdC5oZXIubmFtZSIsCgkiZm9yZ290Lmhpcy5uYW1lIiwKCSJmcm9tLWFrLmNvbSIsCgkiZnJvbS1hbC5jb20iLAoJImZyb20tYXIuY29tIiwKCSJmcm9tLWF6Lm5ldCIsCgkiZnJvbS1jYS5jb20iLAoJImZyb20tY28ubmV0IiwKCSJmcm9tLWN0LmNvbSIsCgkiZnJvbS1kYy5jb20iLAoJImZyb20tZGUuY29tIiwKCSJmcm9tLWZsLmNvbSIsCgkiZnJvbS1nYS5jb20iLAoJImZyb20taGkuY29tIiwKCSJmcm9tLWlhLmNvbSIsCgkiZnJvbS1pZC5jb20iLAoJImZyb20taWwuY29tIiwKCSJmcm9tLWluLmNvbSIsCgkiZnJvbS1rcy5jb20iLAoJImZyb20ta3kuY29tIiwKCSJmcm9tLWxhLm5ldCIsCgkiZnJvbS1tYS5jb20iLAoJImZyb20tbWQuY29tIiwKCSJmcm9tLW1lLm9yZyIsCgkiZnJvbS1taS5jb20iLAoJImZyb20tbW4uY29tIiwKCSJmcm9tLW1vLmNvbSIsCgkiZnJvbS1tcy5jb20iLAoJImZyb20tbXQuY29tIiwKCSJmcm9tLW5jLmNvbSIsCgkiZnJvbS1uZC5jb20iLAoJImZyb20tbmUuY29tIiwKCSJmcm9tLW5oLmNvbSIsCgkiZnJvbS1uai5jb20iLAoJImZyb20tbm0uY29tIiwKCSJmcm9tLW52LmNvbSIsCgkiZnJvbS1ueS5uZXQiLAoJImZyb20tb2guY29tIiwKCSJmcm9tLW9rLmNvbSIsCgkiZnJvbS1vci5jb20iLAoJImZyb20tcGEuY29tIiwKCSJmcm9tLXByLmNvbSIsCgkiZnJvbS1yaS5jb20iLAoJImZyb20tc2MuY29tIiwKCSJmcm9tLXNkLmNvbSIsCgkiZnJvbS10bi5jb20iLAoJImZyb20tdHguY29tIiwKCSJmcm9tLXV0LmNvbSIsCgkiZnJvbS12YS5jb20iLAoJImZyb20tdnQuY29tIiwKCSJmcm9tLXdhLmNvbSIsCgkiZnJvbS13aS5jb20iLAoJImZyb20td3YuY29tIiwKCSJmcm9tLXd5LmNvbSIsCgkiZnRwYWNjZXNzLmNjIiwKCSJmdWV0dGVydGRhc25ldHouZGUiLAoJImdhbWUtaG9zdC5vcmciLAoJImdhbWUtc2VydmVyLmNjIiwKCSJnZXRteWlwLmNvbSIsCgkiZ2V0cy1pdC5uZXQiLAoJImdvLmR5bmRucy5vcmciLAoJImdvdGRucy5jb20iLAoJImdvdGRucy5vcmciLAoJImdyb2tzLXRoZS5pbmZvIiwKCSJncm9rcy10aGlzLmluZm8iLAoJImhhbS1yYWRpby1vcC5uZXQiLAoJImhlcmUtZm9yLW1vcmUuaW5mbyIsCgkiaG9iYnktc2l0ZS5jb20iLAoJImhvYmJ5LXNpdGUub3JnIiwKCSJob21lLmR5bmRucy5vcmciLAoJImhvbWVkbnMub3JnIiwKCSJob21lZnRwLm5ldCIsCgkiaG9tZWZ0cC5vcmciLAoJImhvbWVpcC5uZXQiLAoJImhvbWVsaW51eC5jb20iLAoJImhvbWVsaW51eC5uZXQiLAoJImhvbWVsaW51eC5vcmciLAoJImhvbWV1bml4LmNvbSIsCgkiaG9tZXVuaXgubmV0IiwKCSJob21ldW5peC5vcmciLAoJImlhbWFsbGFtYS5jb20iLAoJImluLXRoZS1iYW5kLm5ldCIsCgkiaXMtYS1hbmFyY2hpc3QuY29tIiwKCSJpcy1hLWJsb2dnZXIuY29tIiwKCSJpcy1hLWJvb2trZWVwZXIuY29tIiwKCSJpcy1hLWJydWluc2Zhbi5vcmciLAoJImlzLWEtYnVsbHMtZmFuLmNvbSIsCgkiaXMtYS1jYW5kaWRhdGUub3JnIiwKCSJpcy1hLWNhdGVyZXIuY29tIiwKCSJpcy1hLWNlbHRpY3NmYW4ub3JnIiwKCSJpcy1hLWNoZWYuY29tIiwKCSJpcy1hLWNoZWYubmV0IiwKCSJpcy1hLWNoZWYub3JnIiwKCSJpcy1hLWNvbnNlcnZhdGl2ZS5jb20iLAoJImlzLWEtY3BhLmNvbSIsCgkiaXMtYS1jdWJpY2xlLXNsYXZlLmNvbSIsCgkiaXMtYS1kZW1vY3JhdC5jb20iLAoJImlzLWEtZGVzaWduZXIuY29tIiwKCSJpcy1hLWRvY3Rvci5jb20iLAoJImlzLWEtZmluYW5jaWFsYWR2aXNvci5jb20iLAoJImlzLWEtZ2Vlay5jb20iLAoJImlzLWEtZ2Vlay5uZXQiLAoJImlzLWEtZ2Vlay5vcmciLAoJImlzLWEtZ3JlZW4uY29tIiwKCSJpcy1hLWd1cnUuY29tIiwKCSJpcy1hLWhhcmQtd29ya2VyLmNvbSIsCgkiaXMtYS1odW50ZXIuY29tIiwKCSJpcy1hLWtuaWdodC5vcmciLAoJImlzLWEtbGFuZHNjYXBlci5jb20iLAoJImlzLWEtbGF3eWVyLmNvbSIsCgkiaXMtYS1saWJlcmFsLmNvbSIsCgkiaXMtYS1saWJlcnRhcmlhbi5jb20iLAoJImlzLWEtbGludXgtdXNlci5vcmciLAoJImlzLWEtbGxhbWEuY29tIiwKCSJpcy1hLW11c2ljaWFuLmNvbSIsCgkiaXMtYS1uYXNjYXJmYW4uY29tIiwKCSJpcy1hLW51cnNlLmNvbSIsCgkiaXMtYS1wYWludGVyLmNvbSIsCgkiaXMtYS1wYXRzZmFuLm9yZyIsCgkiaXMtYS1wZXJzb25hbHRyYWluZXIuY29tIiwKCSJpcy1hLXBob3RvZ3JhcGhlci5jb20iLAoJImlzLWEtcGxheWVyLmNvbSIsCgkiaXMtYS1yZXB1YmxpY2FuLmNvbSIsCgkiaXMtYS1yb2Nrc3Rhci5jb20iLAoJImlzLWEtc29jaWFsaXN0LmNvbSIsCgkiaXMtYS1zb3hmYW4ub3JnIiwKCSJpcy1hLXN0dWRlbnQuY29tIiwKCSJpcy1hLXRlYWNoZXIuY29tIiwKCSJpcy1hLXRlY2hpZS5jb20iLAoJImlzLWEtdGhlcmFwaXN0LmNvbSIsCgkiaXMtYW4tYWNjb3VudGFudC5jb20iLAoJImlzLWFuLWFjdG9yLmNvbSIsCgkiaXMtYW4tYWN0cmVzcy5jb20iLAoJImlzLWFuLWFuYXJjaGlzdC5jb20iLAoJImlzLWFuLWFydGlzdC5jb20iLAoJImlzLWFuLWVuZ2luZWVyLmNvbSIsCgkiaXMtYW4tZW50ZXJ0YWluZXIuY29tIiwKCSJpcy1ieS51cyIsCgkiaXMtY2VydGlmaWVkLmNvbSIsCgkiaXMtZm91bmQub3JnIiwKCSJpcy1nb25lLmNvbSIsCgkiaXMtaW50by1hbmltZS5jb20iLAoJImlzLWludG8tY2Fycy5jb20iLAoJImlzLWludG8tY2FydG9vbnMuY29tIiwKCSJpcy1pbnRvLWdhbWVzLmNvbSIsCgkiaXMtbGVldC5jb20iLAoJImlzLWxvc3Qub3JnIiwKCSJpcy1ub3QtY2VydGlmaWVkLmNvbSIsCgkiaXMtc2F2ZWQub3JnIiwKCSJpcy1zbGljay5jb20iLAoJImlzLXViZXJsZWV0LmNvbSIsCgkiaXMtdmVyeS1iYWQub3JnIiwKCSJpcy12ZXJ5LWV2aWwub3JnIiwKCSJpcy12ZXJ5LWdvb2Qub3JnIiwKCSJpcy12ZXJ5LW5pY2Uub3JnIiwKCSJpcy12ZXJ5LXN3ZWV0Lm9yZyIsCgkiaXMtd2l0aC10aGViYW5kLmNvbSIsCgkiaXNhLWdlZWsuY29tIiwKCSJpc2EtZ2Vlay5uZXQiLAoJImlzYS1nZWVrLm9yZyIsCgkiaXNhLWhvY2tleW51dC5jb20iLAoJImlzc21hcnRlcnRoYW55b3UuY29tIiwKCSJpc3RlaW5nZWVrLmRlIiwKCSJpc3RtZWluLmRlIiwKCSJraWNrcy1hc3MubmV0IiwKCSJraWNrcy1hc3Mub3JnIiwKCSJrbm93c2l0YWxsLmluZm8iLAoJImxhbmQtNC1zYWxlLnVzIiwKCSJsZWJ0aW1uZXR6LmRlIiwKCSJsZWl0dW5nc2VuLmRlIiwKCSJsaWtlcy1waWUuY29tIiwKCSJsaWtlc2NhbmR5LmNvbSIsCgkibWVyc2VpbmUubnUiLAoJIm1pbmUubnUiLAoJIm1pc2NvbmZ1c2VkLm9yZyIsCgkibXlwZXRzLndzIiwKCSJteXBob3Rvcy5jYyIsCgkibmVhdC11cmwuY29tIiwKCSJvZmZpY2Utb24tdGhlLm5ldCIsCgkib24tdGhlLXdlYi50diIsCgkicG9kem9uZS5uZXQiLAoJInBvZHpvbmUub3JnIiwKCSJyZWFkbXlibG9nLm9yZyIsCgkic2F2ZXMtdGhlLXdoYWxlcy5jb20iLAoJInNjcmFwcGVyLXNpdGUubmV0IiwKCSJzY3JhcHBpbmcuY2MiLAoJInNlbGZpcC5iaXoiLAoJInNlbGZpcC5jb20iLAoJInNlbGZpcC5pbmZvIiwKCSJzZWxmaXAubmV0IiwKCSJzZWxmaXAub3JnIiwKCSJzZWxscy1mb3ItbGVzcy5jb20iLAoJInNlbGxzLWZvci11LmNvbSIsCgkic2VsbHMtaXQubmV0IiwKCSJzZWxsc3lvdXJob21lLm9yZyIsCgkic2VydmViYnMuY29tIiwKCSJzZXJ2ZWJicy5uZXQiLAoJInNlcnZlYmJzLm9yZyIsCgkic2VydmVmdHAubmV0IiwKCSJzZXJ2ZWZ0cC5vcmciLAoJInNlcnZlZ2FtZS5vcmciLAoJInNoYWNrbmV0Lm51IiwKCSJzaW1wbGUtdXJsLmNvbSIsCgkic3BhY2UtdG8tcmVudC5jb20iLAoJInN0dWZmLTQtc2FsZS5vcmciLAoJInN0dWZmLTQtc2FsZS51cyIsCgkidGVhY2hlcy15b2dhLmNvbSIsCgkidGhydWhlcmUubmV0IiwKCSJ0cmFldW10Z2VyYWRlLmRlIiwKCSJ3ZWJob3AuYml6IiwKCSJ3ZWJob3AuaW5mbyIsCgkid2ViaG9wLm5ldCIsCgkid2ViaG9wLm9yZyIsCgkid29yc2UtdGhhbi50diIsCgkid3JpdGVzdGhpc2Jsb2cuY29tIiwKCSJkZG5zcy5kZSIsCgkiZHluLmRkbnNzLmRlIiwKCSJkeW5kbnMuZGRuc3MuZGUiLAoJImR5bmRuczEuZGUiLAoJImR5bi1pcDI0LmRlIiwKCSJob21lLXdlYnNlcnZlci5kZSIsCgkiZHluLmhvbWUtd2Vic2VydmVyLmRlIiwKCSJteWhvbWUtc2VydmVyLmRlIiwKCSJkZG5zcy5vcmciLAoJImRlZmluaW1hLm5ldCIsCgkiZGVmaW5pbWEuaW8iLAoJIm9uZGlnaXRhbG9jZWFuLmFwcCIsCgkiKi5kaWdpdGFsb2NlYW5zcGFjZXMuY29tIiwKCSJiY2kuZG5zdHJhY2UucHJvIiwKCSJkZG5zZnJlZS5jb20iLAoJImRkbnNnZWVrLmNvbSIsCgkiZ2lpemUuY29tIiwKCSJnbGVlemUuY29tIiwKCSJrb3pvdy5jb20iLAoJImxvc2V5b3VyaXAuY29tIiwKCSJvb2d1eS5jb20iLAoJInRoZXdvcmtwYy5jb20iLAoJImNhc2FjYW0ubmV0IiwKCSJkeW51Lm5ldCIsCgkiYWNjZXNzY2FtLm9yZyIsCgkiY2FtZHZyLm9yZyIsCgkiZnJlZWRkbnMub3JnIiwKCSJteXdpcmUub3JnIiwKCSJ3ZWJyZWRpcmVjdC5vcmciLAoJIm15ZGRucy5yb2NrcyIsCgkiYmxvZ3NpdGUueHl6IiwKCSJkeW52Ni5uZXQiLAoJImU0LmN6IiwKCSJlZXJvLm9ubGluZSIsCgkiZWVyby1zdGFnZS5vbmxpbmUiLAoJImVsZW1lbnRvci5jbG91ZCIsCgkiZWxlbWVudG9yLmNvb2wiLAoJImVuLXJvb3QuZnIiLAoJIm15dHVsZWFwLmNvbSIsCgkidHVsZWFwLXBhcnRuZXJzLmNvbSIsCgkiZW5jci5hcHAiLAoJImVuY29yZWFwaS5jb20iLAoJIm9ucmVkLm9uZSIsCgkic3RhZ2luZy5vbnJlZC5vbmUiLAoJImV1LmVuY293YXkuY2xvdWQiLAoJImV1Lm9yZyIsCgkiYWwuZXUub3JnIiwKCSJhc3NvLmV1Lm9yZyIsCgkiYXQuZXUub3JnIiwKCSJhdS5ldS5vcmciLAoJImJlLmV1Lm9yZyIsCgkiYmcuZXUub3JnIiwKCSJjYS5ldS5vcmciLAoJImNkLmV1Lm9yZyIsCgkiY2guZXUub3JnIiwKCSJjbi5ldS5vcmciLAoJImN5LmV1Lm9yZyIsCgkiY3ouZXUub3JnIiwKCSJkZS5ldS5vcmciLAoJImRrLmV1Lm9yZyIsCgkiZWR1LmV1Lm9yZyIsCgkiZWUuZXUub3JnIiwKCSJlcy5ldS5vcmciLAoJImZpLmV1Lm9yZyIsCgkiZnIuZXUub3JnIiwKCSJnci5ldS5vcmciLAoJImhyLmV1Lm9yZyIsCgkiaHUuZXUub3JnIiwKCSJpZS5ldS5vcmciLAoJImlsLmV1Lm9yZyIsCgkiaW4uZXUub3JnIiwKCSJpbnQuZXUub3JnIiwKCSJpcy5ldS5vcmciLAoJIml0LmV1Lm9yZyIsCgkianAuZXUub3JnIiwKCSJrci5ldS5vcmciLAoJImx0LmV1Lm9yZyIsCgkibHUuZXUub3JnIiwKCSJsdi5ldS5vcmciLAoJIm1jLmV1Lm9yZyIsCgkibWUuZXUub3JnIiwKCSJtay5ldS5vcmciLAoJIm10LmV1Lm9yZyIsCgkibXkuZXUub3JnIiwKCSJuZXQuZXUub3JnIiwKCSJuZy5ldS5vcmciLAoJIm5sLmV1Lm9yZyIsCgkibm8uZXUub3JnIiwKCSJuei5ldS5vcmciLAoJInBhcmlzLmV1Lm9yZyIsCgkicGwuZXUub3JnIiwKCSJwdC5ldS5vcmciLAoJInEtYS5ldS5vcmciLAoJInJvLmV1Lm9yZyIsCgkicnUuZXUub3JnIiwKCSJzZS5ldS5vcmciLAoJInNpLmV1Lm9yZyIsCgkic2suZXUub3JnIiwKCSJ0ci5ldS5vcmciLAoJInVrLmV1Lm9yZyIsCgkidXMuZXUub3JnIiwKCSJldXJvZGlyLnJ1IiwKCSJldS0xLmV2ZW5ub2RlLmNvbSIsCgkiZXUtMi5ldmVubm9kZS5jb20iLAoJImV1LTMuZXZlbm5vZGUuY29tIiwKCSJldS00LmV2ZW5ub2RlLmNvbSIsCgkidXMtMS5ldmVubm9kZS5jb20iLAoJInVzLTIuZXZlbm5vZGUuY29tIiwKCSJ1cy0zLmV2ZW5ub2RlLmNvbSIsCgkidXMtNC5ldmVubm9kZS5jb20iLAoJInR3bWFpbC5jYyIsCgkidHdtYWlsLm5ldCIsCgkidHdtYWlsLm9yZyIsCgkibXltYWlsZXIuY29tLnR3IiwKCSJ1cmwudHciLAoJIm9uZmFicmljYS5jb20iLAoJImFwcHMuZmJzYnguY29tIiwKCSJydS5uZXQiLAoJImFkeWdleWEucnUiLAoJImJhc2hraXJpYS5ydSIsCgkiYmlyLnJ1IiwKCSJjYmcucnUiLAoJImNvbS5ydSIsCgkiZGFnZXN0YW4ucnUiLAoJImdyb3pueS5ydSIsCgkia2FsbXlraWEucnUiLAoJImt1c3RhbmFpLnJ1IiwKCSJtYXJpbmUucnUiLAoJIm1vcmRvdmlhLnJ1IiwKCSJtc2sucnUiLAoJIm15dGlzLnJ1IiwKCSJuYWxjaGlrLnJ1IiwKCSJub3YucnUiLAoJInB5YXRpZ29yc2sucnUiLAoJInNwYi5ydSIsCgkidmxhZGlrYXZrYXoucnUiLAoJInZsYWRpbWlyLnJ1IiwKCSJhYmtoYXppYS5zdSIsCgkiYWR5Z2V5YS5zdSIsCgkiYWt0eXViaW5zay5zdSIsCgkiYXJraGFuZ2Vsc2suc3UiLAoJImFybWVuaWEuc3UiLAoJImFzaGdhYmFkLnN1IiwKCSJhemVyYmFpamFuLnN1IiwKCSJiYWxhc2hvdi5zdSIsCgkiYmFzaGtpcmlhLnN1IiwKCSJicnlhbnNrLnN1IiwKCSJidWtoYXJhLnN1IiwKCSJjaGlta2VudC5zdSIsCgkiZGFnZXN0YW4uc3UiLAoJImVhc3Qta2F6YWtoc3Rhbi5zdSIsCgkiZXhuZXQuc3UiLAoJImdlb3JnaWEuc3UiLAoJImdyb3pueS5zdSIsCgkiaXZhbm92by5zdSIsCgkiamFtYnlsLnN1IiwKCSJrYWxteWtpYS5zdSIsCgkia2FsdWdhLnN1IiwKCSJrYXJhY29sLnN1IiwKCSJrYXJhZ2FuZGEuc3UiLAoJImthcmVsaWEuc3UiLAoJImtoYWthc3NpYS5zdSIsCgkia3Jhc25vZGFyLnN1IiwKCSJrdXJnYW4uc3UiLAoJImt1c3RhbmFpLnN1IiwKCSJsZW51Zy5zdSIsCgkibWFuZ3lzaGxhay5zdSIsCgkibW9yZG92aWEuc3UiLAoJIm1zay5zdSIsCgkibXVybWFuc2suc3UiLAoJIm5hbGNoaWsuc3UiLAoJIm5hdm9pLnN1IiwKCSJub3J0aC1rYXpha2hzdGFuLnN1IiwKCSJub3Yuc3UiLAoJIm9ibmluc2suc3UiLAoJInBlbnphLnN1IiwKCSJwb2tyb3Zzay5zdSIsCgkic29jaGkuc3UiLAoJInNwYi5zdSIsCgkidGFzaGtlbnQuc3UiLAoJInRlcm1lei5zdSIsCgkidG9nbGlhdHRpLnN1IiwKCSJ0cm9pdHNrLnN1IiwKCSJ0c2VsaW5vZ3JhZC5zdSIsCgkidHVsYS5zdSIsCgkidHV2YS5zdSIsCgkidmxhZGlrYXZrYXouc3UiLAoJInZsYWRpbWlyLnN1IiwKCSJ2b2xvZ2RhLnN1IiwKCSJjaGFubmVsc2R2ci5uZXQiLAoJInUuY2hhbm5lbHNkdnIubmV0IiwKCSJlZGdlY29tcHV0ZS5hcHAiLAoJImZhc3RseS10ZXJyYXJpdW0uY29tIiwKCSJmYXN0bHlsYi5uZXQiLAoJIm1hcC5mYXN0bHlsYi5uZXQiLAoJImZyZWV0bHMuZmFzdGx5Lm5ldCIsCgkibWFwLmZhc3RseS5uZXQiLAoJImEucHJvZC5mYXN0bHkubmV0IiwKCSJnbG9iYWwucHJvZC5mYXN0bHkubmV0IiwKCSJhLnNzbC5mYXN0bHkubmV0IiwKCSJiLnNzbC5mYXN0bHkubmV0IiwKCSJnbG9iYWwuc3NsLmZhc3RseS5uZXQiLAoJImZhc3R2cHMtc2VydmVyLmNvbSIsCgkiZmFzdHZwcy5ob3N0IiwKCSJteWZhc3QuaG9zdCIsCgkiZmFzdHZwcy5zaXRlIiwKCSJteWZhc3Quc3BhY2UiLAoJImZlZG9yYWluZnJhY2xvdWQub3JnIiwKCSJmZWRvcmFwZW9wbGUub3JnIiwKCSJjbG91ZC5mZWRvcmFwcm9qZWN0Lm9yZyIsCgkiYXBwLm9zLmZlZG9yYXByb2plY3Qub3JnIiwKCSJhcHAub3Muc3RnLmZlZG9yYXByb2plY3Qub3JnIiwKCSJjb25uLnVrIiwKCSJjb3Byby51ayIsCgkiaG9zcC51ayIsCgkibXlkb2Jpc3MuY29tIiwKCSJmaC1tdWVuc3Rlci5pbyIsCgkiZmlsZWdlYXIubWUiLAoJImZpbGVnZWFyLWF1Lm1lIiwKCSJmaWxlZ2Vhci1kZS5tZSIsCgkiZmlsZWdlYXItZ2IubWUiLAoJImZpbGVnZWFyLWllLm1lIiwKCSJmaWxlZ2Vhci1qcC5tZSIsCgkiZmlsZWdlYXItc2cubWUiLAoJImZpcmViYXNlYXBwLmNvbSIsCgkiZmlyZXdlYi5hcHAiLAoJImZsYXAuaWQiLAoJIm9uZmxhc2hkcml2ZS5hcHAiLAoJImZsZHJ2LmNvbSIsCgkiZmx5LmRldiIsCgkiZWRnZWFwcC5uZXQiLAoJInNody5pbyIsCgkiZmx5bm5ob3N0aW5nLm5ldCIsCgkiZm9yZ2VibG9ja3MuY29tIiwKCSJpZC5mb3JnZXJvY2suaW8iLAoJImZyYW1lci5hcHAiLAoJImZyYW1lcmNhbnZhcy5jb20iLAoJIiouZnJ1c2t5LmRlIiwKCSJyYXZwYWdlLmNvLmlsIiwKCSIwZS52YyIsCgkiZnJlZWJveC1vcy5jb20iLAoJImZyZWVib3hvcy5jb20iLAoJImZieC1vcy5mciIsCgkiZmJ4b3MuZnIiLAoJImZyZWVib3gtb3MuZnIiLAoJImZyZWVib3hvcy5mciIsCgkiZnJlZWRlc2t0b3Aub3JnIiwKCSJmcmVlbXlpcC5jb20iLAoJIndpZW4uZnVua2ZldWVyLmF0IiwKCSIqLmZ1dHVyZWNtcy5hdCIsCgkiKi5leC5mdXR1cmVjbXMuYXQiLAoJIiouaW4uZnV0dXJlY21zLmF0IiwKCSJmdXR1cmVob3N0aW5nLmF0IiwKCSJmdXR1cmVtYWlsaW5nLmF0IiwKCSIqLmV4Lm9ydHNpbmZvLmF0IiwKCSIqLmt1bmRlbi5vcnRzaW5mby5hdCIsCgkiKi5zdGF0aWNzLmNsb3VkIiwKCSJpbmRlcGVuZGVudC1jb21taXNzaW9uLnVrIiwKCSJpbmRlcGVuZGVudC1pbnF1ZXN0LnVrIiwKCSJpbmRlcGVuZGVudC1pbnF1aXJ5LnVrIiwKCSJpbmRlcGVuZGVudC1wYW5lbC51ayIsCgkiaW5kZXBlbmRlbnQtcmV2aWV3LnVrIiwKCSJwdWJsaWMtaW5xdWlyeS51ayIsCgkicm95YWwtY29tbWlzc2lvbi51ayIsCgkiY2FtcGFpZ24uZ292LnVrIiwKCSJzZXJ2aWNlLmdvdi51ayIsCgkiYXBpLmdvdi51ayIsCgkiZ2VoaXJuLm5lLmpwIiwKCSJ1c2VyY29udGVudC5qcCIsCgkiZ2VudGFwcHMuY29tIiwKCSJnZW50bGVudGFwaXMuY29tIiwKCSJsYWIubXMiLAoJImNkbi1lZGdlcy5uZXQiLAoJImdob3N0LmlvIiwKCSJnc2ouYnoiLAoJImdpdGh1YnVzZXJjb250ZW50LmNvbSIsCgkiZ2l0aHVicHJldmlldy5kZXYiLAoJImdpdGh1Yi5pbyIsCgkiZ2l0bGFiLmlvIiwKCSJnaXRhcHAuc2kiLAoJImdpdHBhZ2Uuc2kiLAoJImdsaXRjaC5tZSIsCgkibm9nLmNvbW11bml0eSIsCgkiY28ucm8iLAoJInNob3Aucm8iLAoJImxvbGlwb3AuaW8iLAoJImFuZ3J5LmpwIiwKCSJiYWJ5Ymx1ZS5qcCIsCgkiYmFieW1pbGsuanAiLAoJImJhY2tkcm9wLmpwIiwKCSJiYW1iaW5hLmpwIiwKCSJiaXR0ZXIuanAiLAoJImJsdXNoLmpwIiwKCSJib28uanAiLAoJImJveS5qcCIsCgkiYm95ZnJpZW5kLmpwIiwKCSJidXQuanAiLAoJImNhbmR5cG9wLmpwIiwKCSJjYXBvby5qcCIsCgkiY2F0Zm9vZC5qcCIsCgkiY2hlYXAuanAiLAoJImNoaWNhcHBhLmpwIiwKCSJjaGlsbG91dC5qcCIsCgkiY2hpcHMuanAiLAoJImNob3dkZXIuanAiLAoJImNodS5qcCIsCgkiY2lhby5qcCIsCgkiY29jb3R0ZS5qcCIsCgkiY29vbGJsb2cuanAiLAoJImNyYW5reS5qcCIsCgkiY3V0ZWdpcmwuanAiLAoJImRhYS5qcCIsCgkiZGVjYS5qcCIsCgkiZGVjaS5qcCIsCgkiZGlnaWNrLmpwIiwKCSJlZ29pc20uanAiLAoJImZha2VmdXIuanAiLAoJImZlbS5qcCIsCgkiZmxpZXIuanAiLAoJImZsb3BweS5qcCIsCgkiZm9vbC5qcCIsCgkiZnJlbmNoa2lzcy5qcCIsCgkiZ2lybGZyaWVuZC5qcCIsCgkiZ2lybHkuanAiLAoJImdsb29teS5qcCIsCgkiZ29ubmEuanAiLAoJImdyZWF0ZXIuanAiLAoJImhhY2NhLmpwIiwKCSJoZWF2eS5qcCIsCgkiaGVyLmpwIiwKCSJoaWhvLmpwIiwKCSJoaXBweS5qcCIsCgkiaG9seS5qcCIsCgkiaHVuZ3J5LmpwIiwKCSJpY3VydXMuanAiLAoJIml0aWdvLmpwIiwKCSJqZWxseWJlYW4uanAiLAoJImtpa2lyYXJhLmpwIiwKCSJraWxsLmpwIiwKCSJraWxvLmpwIiwKCSJrdXJvbi5qcCIsCgkibGl0dGxlc3Rhci5qcCIsCgkibG9saXBvcG1jLmpwIiwKCSJsb2xpdGFwdW5rLmpwIiwKCSJsb21vLmpwIiwKCSJsb3ZlcG9wLmpwIiwKCSJsb3Zlc2ljay5qcCIsCgkibWFpbi5qcCIsCgkibW9kcy5qcCIsCgkibW9uZC5qcCIsCgkibW9uZ29saWFuLmpwIiwKCSJtb28uanAiLAoJIm5hbWFzdGUuanAiLAoJIm5pa2l0YS5qcCIsCgkibm9idXNoaS5qcCIsCgkibm9vci5qcCIsCgkib29wcy5qcCIsCgkicGFyYWxsZWwuanAiLAoJInBhcmFzaXRlLmpwIiwKCSJwZWNvcmkuanAiLAoJInBlZXdlZS5qcCIsCgkicGVubmUuanAiLAoJInBlcHBlci5qcCIsCgkicGVybWEuanAiLAoJInBpZ2JvYXQuanAiLAoJInBpbm9rby5qcCIsCgkicHVueXUuanAiLAoJInB1cHUuanAiLAoJInB1c3N5Y2F0LmpwIiwKCSJweWEuanAiLAoJInJhaW5kcm9wLmpwIiwKCSJyZWFkeW1hZGUuanAiLAoJInNhZGlzdC5qcCIsCgkic2Nob29sYnVzLmpwIiwKCSJzZWNyZXQuanAiLAoJInN0YWJhLmpwIiwKCSJzdHJpcHBlci5qcCIsCgkic3ViLmpwIiwKCSJzdW5ueWRheS5qcCIsCgkidGhpY2suanAiLAoJInRvbmtvdHN1LmpwIiwKCSJ1bmRlci5qcCIsCgkidXBwZXIuanAiLAoJInZlbHZldC5qcCIsCgkidmVyc2UuanAiLAoJInZlcnN1cy5qcCIsCgkidml2aWFuLmpwIiwKCSJ3YXRzb24uanAiLAoJIndlYmxpa2UuanAiLAoJIndoaXRlc25vdy5qcCIsCgkiem9tYmllLmpwIiwKCSJoZXRlbWwubmV0IiwKCSJjbG91ZGFwcHMuZGlnaXRhbCIsCgkibG9uZG9uLmNsb3VkYXBwcy5kaWdpdGFsIiwKCSJweW1udC51ayIsCgkiaG9tZW9mZmljZS5nb3YudWsiLAoJInJvLmltIiwKCSJnb2lwLmRlIiwKCSJydW4uYXBwIiwKCSJhLnJ1bi5hcHAiLAoJIndlYi5hcHAiLAoJIiouMGVtbS5jb20iLAoJImFwcHNwb3QuY29tIiwKCSIqLnIuYXBwc3BvdC5jb20iLAoJImNvZGVzcG90LmNvbSIsCgkiZ29vZ2xlYXBpcy5jb20iLAoJImdvb2dsZWNvZGUuY29tIiwKCSJwYWdlc3BlZWRtb2JpbGl6ZXIuY29tIiwKCSJwdWJsaXNocHJveHkuY29tIiwKCSJ3aXRoZ29vZ2xlLmNvbSIsCgkid2l0aHlvdXR1YmUuY29tIiwKCSIqLmdhdGV3YXkuZGV2IiwKCSJjbG91ZC5nb29nIiwKCSJ0cmFuc2xhdGUuZ29vZyIsCgkiKi51c2VyY29udGVudC5nb29nIiwKCSJjbG91ZGZ1bmN0aW9ucy5uZXQiLAoJImJsb2dzcG90LmFlIiwKCSJibG9nc3BvdC5hbCIsCgkiYmxvZ3Nwb3QuYW0iLAoJImJsb2dzcG90LmJhIiwKCSJibG9nc3BvdC5iZSIsCgkiYmxvZ3Nwb3QuYmciLAoJImJsb2dzcG90LmJqIiwKCSJibG9nc3BvdC5jYSIsCgkiYmxvZ3Nwb3QuY2YiLAoJImJsb2dzcG90LmNoIiwKCSJibG9nc3BvdC5jbCIsCgkiYmxvZ3Nwb3QuY28uYXQiLAoJImJsb2dzcG90LmNvLmlkIiwKCSJibG9nc3BvdC5jby5pbCIsCgkiYmxvZ3Nwb3QuY28ua2UiLAoJImJsb2dzcG90LmNvLm56IiwKCSJibG9nc3BvdC5jby51ayIsCgkiYmxvZ3Nwb3QuY28uemEiLAoJImJsb2dzcG90LmNvbSIsCgkiYmxvZ3Nwb3QuY29tLmFyIiwKCSJibG9nc3BvdC5jb20uYXUiLAoJImJsb2dzcG90LmNvbS5iciIsCgkiYmxvZ3Nwb3QuY29tLmJ5IiwKCSJibG9nc3BvdC5jb20uY28iLAoJImJsb2dzcG90LmNvbS5jeSIsCgkiYmxvZ3Nwb3QuY29tLmVlIiwKCSJibG9nc3BvdC5jb20uZWciLAoJImJsb2dzcG90LmNvbS5lcyIsCgkiYmxvZ3Nwb3QuY29tLm10IiwKCSJibG9nc3BvdC5jb20ubmciLAoJImJsb2dzcG90LmNvbS50ciIsCgkiYmxvZ3Nwb3QuY29tLnV5IiwKCSJibG9nc3BvdC5jdiIsCgkiYmxvZ3Nwb3QuY3oiLAoJImJsb2dzcG90LmRlIiwKCSJibG9nc3BvdC5kayIsCgkiYmxvZ3Nwb3QuZmkiLAoJImJsb2dzcG90LmZyIiwKCSJibG9nc3BvdC5nciIsCgkiYmxvZ3Nwb3QuaGsiLAoJImJsb2dzcG90LmhyIiwKCSJibG9nc3BvdC5odSIsCgkiYmxvZ3Nwb3QuaWUiLAoJImJsb2dzcG90LmluIiwKCSJibG9nc3BvdC5pcyIsCgkiYmxvZ3Nwb3QuaXQiLAoJImJsb2dzcG90LmpwIiwKCSJibG9nc3BvdC5rciIsCgkiYmxvZ3Nwb3QubGkiLAoJImJsb2dzcG90Lmx0IiwKCSJibG9nc3BvdC5sdSIsCgkiYmxvZ3Nwb3QubWQiLAoJImJsb2dzcG90Lm1rIiwKCSJibG9nc3BvdC5tciIsCgkiYmxvZ3Nwb3QubXgiLAoJImJsb2dzcG90Lm15IiwKCSJibG9nc3BvdC5ubCIsCgkiYmxvZ3Nwb3Qubm8iLAoJImJsb2dzcG90LnBlIiwKCSJibG9nc3BvdC5wdCIsCgkiYmxvZ3Nwb3QucWEiLAoJImJsb2dzcG90LnJlIiwKCSJibG9nc3BvdC5ybyIsCgkiYmxvZ3Nwb3QucnMiLAoJImJsb2dzcG90LnJ1IiwKCSJibG9nc3BvdC5zZSIsCgkiYmxvZ3Nwb3Quc2ciLAoJImJsb2dzcG90LnNpIiwKCSJibG9nc3BvdC5zayIsCgkiYmxvZ3Nwb3Quc24iLAoJImJsb2dzcG90LnRkIiwKCSJibG9nc3BvdC50dyIsCgkiYmxvZ3Nwb3QudWciLAoJImJsb2dzcG90LnZuIiwKCSJnb3VwaWxlLmZyIiwKCSJnb3YubmwiLAoJImF3c21wcGwuY29tIiwKCSJnw7xuc3RpZ2Jlc3RlbGxlbi5kZSIsCgkiZ8O8bnN0aWdsaWVmZXJuLmRlIiwKCSJmaW4uY2kiLAoJImZyZWUuaHIiLAoJImNhYS5saSIsCgkidWEucnMiLAoJImNvbmYuc2UiLAoJImhzLnpvbmUiLAoJImhzLnJ1biIsCgkiaGFzaGJhbmcuc2giLAoJImhhc3VyYS5hcHAiLAoJImhhc3VyYS1hcHAuaW8iLAoJInBhZ2VzLml0LmhzLWhlaWxicm9ubi5kZSIsCgkiaGVwZm9yZ2Uub3JnIiwKCSJoZXJva3VhcHAuY29tIiwKCSJoZXJva3Vzc2wuY29tIiwKCSJyYXZlbmRiLmNsb3VkIiwKCSJteXJhdmVuZGIuY29tIiwKCSJyYXZlbmRiLmNvbW11bml0eSIsCgkicmF2ZW5kYi5tZSIsCgkiZGV2ZWxvcG1lbnQucnVuIiwKCSJyYXZlbmRiLnJ1biIsCgkiaG9tZXNrbGVwLnBsIiwKCSJzZWNhYXMuaGsiLAoJImhvcGxpeC5zaG9wIiwKCSJvcnguYml6IiwKCSJiaXouZ2wiLAoJImNvbC5uZyIsCgkiZmlybS5uZyIsCgkiZ2VuLm5nIiwKCSJsdGQubmciLAoJIm5nby5uZyIsCgkiZWR1LnNjb3QiLAoJInNjaC5zbyIsCgkiaG9zdHlob3N0aW5nLmlvIiwKCSJow6Rra2luZW4uZmkiLAoJIioubW9vbnNjYWxlLmlvIiwKCSJtb29uc2NhbGUubmV0IiwKCSJpa2kuZmkiLAoJImlieG9zLml0IiwKCSJpbGlhZGJveG9zLml0IiwKCSJpbXBlcnRyaXhjZG4uY29tIiwKCSJpbXBlcnRyaXguY29tIiwKCSJzbXVzaGNkbi5jb20iLAoJIndwaG9zdGVkbWFpbC5jb20iLAoJIndwbXVjZG4uY29tIiwKCSJ0ZW1wdXJsLmhvc3QiLAoJIndwbXVkZXYuaG9zdCIsCgkiZHluLWJlcmxpbi5kZSIsCgkiaW4tYmVybGluLmRlIiwKCSJpbi1icmIuZGUiLAoJImluLWJ1dHRlci5kZSIsCgkiaW4tZHNsLmRlIiwKCSJpbi1kc2wubmV0IiwKCSJpbi1kc2wub3JnIiwKCSJpbi12cG4uZGUiLAoJImluLXZwbi5uZXQiLAoJImluLXZwbi5vcmciLAoJImJpei5hdCIsCgkiaW5mby5hdCIsCgkiaW5mby5jeCIsCgkiYWMubGVnLmJyIiwKCSJhbC5sZWcuYnIiLAoJImFtLmxlZy5iciIsCgkiYXAubGVnLmJyIiwKCSJiYS5sZWcuYnIiLAoJImNlLmxlZy5iciIsCgkiZGYubGVnLmJyIiwKCSJlcy5sZWcuYnIiLAoJImdvLmxlZy5iciIsCgkibWEubGVnLmJyIiwKCSJtZy5sZWcuYnIiLAoJIm1zLmxlZy5iciIsCgkibXQubGVnLmJyIiwKCSJwYS5sZWcuYnIiLAoJInBiLmxlZy5iciIsCgkicGUubGVnLmJyIiwKCSJwaS5sZWcuYnIiLAoJInByLmxlZy5iciIsCgkicmoubGVnLmJyIiwKCSJybi5sZWcuYnIiLAoJInJvLmxlZy5iciIsCgkicnIubGVnLmJyIiwKCSJycy5sZWcuYnIiLAoJInNjLmxlZy5iciIsCgkic2UubGVnLmJyIiwKCSJzcC5sZWcuYnIiLAoJInRvLmxlZy5iciIsCgkicGl4b2xpbm8uY29tIiwKCSJuYTR1LnJ1IiwKCSJpb3BzeXMuc2UiLAoJImlwaWZvbnkubmV0IiwKCSJpc2VydnNjaHVsZS5kZSIsCgkibWVpbi1pc2Vydi5kZSIsCgkic2NodWxwbGF0dGZvcm0uZGUiLAoJInNjaHVsc2VydmVyLmRlIiwKCSJ0ZXN0LWlzZXJ2LmRlIiwKCSJpc2Vydi5kZXYiLAoJImlvYmIubmV0IiwKCSJtZWwuY2xvdWRsZXRzLmNvbS5hdSIsCgkiY2xvdWQuaW50ZXJob3N0c29sdXRpb25zLmJlIiwKCSJ1c2Vycy5zY2FsZS52aXJ0dWFsY2xvdWQuY29tLmJyIiwKCSJteWNsb3VkLmJ5IiwKCSJhbHAxLmFlLmZsb3cuY2giLAoJImFwcGVuZ2luZS5mbG93LmNoIiwKCSJlcy0xLmF4YXJuZXQuY2xvdWQiLAoJImRpYWRlbS5jbG91ZCIsCgkidmlwLmplbGFzdGljLmNsb3VkIiwKCSJqZWxlLmNsb3VkIiwKCSJpdDEuZXVyLmFydWJhLmplbnYtYXJ1YmEuY2xvdWQiLAoJIml0MS5qZW52LWFydWJhLmNsb3VkIiwKCSJrZWxpd2ViLmNsb3VkIiwKCSJjcy5rZWxpd2ViLmNsb3VkIiwKCSJveGEuY2xvdWQiLAoJInRuLm94YS5jbG91ZCIsCgkidWsub3hhLmNsb3VkIiwKCSJwcmltZXRlbC5jbG91ZCIsCgkidWsucHJpbWV0ZWwuY2xvdWQiLAoJImNhLnJlY2xhaW0uY2xvdWQiLAoJInVrLnJlY2xhaW0uY2xvdWQiLAoJInVzLnJlY2xhaW0uY2xvdWQiLAoJImNoLnRyZW5kaG9zdGluZy5jbG91ZCIsCgkiZGUudHJlbmRob3N0aW5nLmNsb3VkIiwKCSJqZWxlLmNsdWIiLAoJImFtc2NvbXB1dGUuY29tIiwKCSJjbGlja2V0Y2xvdWQuY29tIiwKCSJkb3BhYXMuY29tIiwKCSJoaWRvcmEuY29tIiwKCSJwYWFzLmhvc3RlZC1ieS1wcmV2aWRlci5jb20iLAoJInJhZy1jbG91ZC5ob3N0ZXVyLmNvbSIsCgkicmFnLWNsb3VkLWNoLmhvc3RldXIuY29tIiwKCSJqY2xvdWQuaWstc2VydmVyLmNvbSIsCgkiamNsb3VkLXZlci1qcGMuaWstc2VydmVyLmNvbSIsCgkiZGVtby5qZWxhc3RpYy5jb20iLAoJImtpbGF0aXJvbi5jb20iLAoJInBhYXMubWFzc2l2ZWdyaWQuY29tIiwKCSJqZWQud2FmYWljbG91ZC5jb20iLAoJImxvbi53YWZhaWNsb3VkLmNvbSIsCgkicnlkLndhZmFpY2xvdWQuY29tIiwKCSJqLnNjYWxlZm9yY2UuY29tLmN5IiwKCSJqZWxhc3RpYy5kb2dhZG8uZXUiLAoJImZpLmNsb3VkcGxhdGZvcm0uZmkiLAoJImRlbW8uZGF0YWNlbnRlci5maSIsCgkicGFhcy5kYXRhY2VudGVyLmZpIiwKCSJqZWxlLmhvc3QiLAoJIm1pcmNsb3VkLmhvc3QiLAoJInBhYXMuYmVlYnl0ZS5pbyIsCgkic2VrZDEuYmVlYnl0ZWFwcC5pbyIsCgkiamVsZS5pbyIsCgkiY2xvdWQtZnIxLnVuaXNwYWNlLmlvIiwKCSJqYy5uZWVuLml0IiwKCSJjbG91ZC5qZWxhc3RpYy5vcGVuLnRpbS5pdCIsCgkiamNsb3VkLmt6IiwKCSJ1cGFhcy5rYXp0ZWxlcG9ydC5reiIsCgkiY2xvdWRqaWZmeS5uZXQiLAoJImZyYTEtZGUuY2xvdWRqaWZmeS5uZXQiLAoJIndlc3QxLXVzLmNsb3VkamlmZnkubmV0IiwKCSJqbHMtc3RvMS5lbGFzdHgubmV0IiwKCSJqbHMtc3RvMi5lbGFzdHgubmV0IiwKCSJqbHMtc3RvMy5lbGFzdHgubmV0IiwKCSJmYXN0c3RhY2tzLm5ldCIsCgkiZnItMS5wYWFzLm1hc3NpdmVncmlkLm5ldCIsCgkibG9uLTEucGFhcy5tYXNzaXZlZ3JpZC5uZXQiLAoJImxvbi0yLnBhYXMubWFzc2l2ZWdyaWQubmV0IiwKCSJueS0xLnBhYXMubWFzc2l2ZWdyaWQubmV0IiwKCSJueS0yLnBhYXMubWFzc2l2ZWdyaWQubmV0IiwKCSJzZy0xLnBhYXMubWFzc2l2ZWdyaWQubmV0IiwKCSJqZWxhc3RpYy5zYXZlaW5jbG91ZC5uZXQiLAoJIm5vcmRlc3RlLWlkYy5zYXZlaW5jbG91ZC5uZXQiLAoJImouc2NhbGVmb3JjZS5uZXQiLAoJImplbGFzdGljLnRzdWthZXJ1Lm5ldCIsCgkic2RzY2xvdWQucGwiLAoJInVuaWNsb3VkLnBsIiwKCSJtaXJjbG91ZC5ydSIsCgkiamVsYXN0aWMucmVncnVob3N0aW5nLnJ1IiwKCSJlbnNjYWxlZC5zZyIsCgkiamVsZS5zaXRlIiwKCSJqZWxhc3RpYy50ZWFtIiwKCSJvcmFuZ2VjbG91ZC50biIsCgkiai5sYXllcnNoaWZ0LmNvLnVrIiwKCSJwaHguZW5zY2FsZWQudXMiLAoJIm1pcmNsb3VkLnVzIiwKCSJteWppbm8ucnUiLAoJIiouaG9zdGluZy5teWppbm8ucnUiLAoJIioubGFuZGluZy5teWppbm8ucnUiLAoJIiouc3BlY3RydW0ubXlqaW5vLnJ1IiwKCSIqLnZwcy5teWppbm8ucnUiLAoJImpvdGVsdWx1LmNsb3VkIiwKCSIqLnRyaXRvbi56b25lIiwKCSIqLmNucy5qb3llbnQuY29tIiwKCSJqcy5vcmciLAoJImthYXMuZ2ciLAoJImtocGxheS5ubCIsCgkia3Rpc3RvcnkuY29tIiwKCSJrYXBzaS5maSIsCgkia2V5bWFjaGluZS5kZSIsCgkia2luZ2hvc3QubmV0IiwKCSJ1bmk1Lm5ldCIsCgkia25pZ2h0cG9pbnQuc3lzdGVtcyIsCgkia29vYmluLmV2ZW50cyIsCgkib3lhLnRvIiwKCSJrdWxldXZlbi5jbG91ZCIsCgkiZXpwcm94eS5rdWxldXZlbi5iZSIsCgkiY28ua3JkIiwKCSJlZHUua3JkIiwKCSJrcmVsbGlhbi5uZXQiLAoJIndlYnRoaW5ncy5pbyIsCgkiZ2l0LXJlcG9zLmRlIiwKCSJsY3ViZS1zZXJ2ZXIuZGUiLAoJInN2bi1yZXBvcy5kZSIsCgkibGVhZHBhZ2VzLmNvIiwKCSJscGFnZXMuY28iLAoJImxwdXNlcmNvbnRlbnQuY29tIiwKCSJsZWx1eC5zaXRlIiwKCSJjby5idXNpbmVzcyIsCgkiY28uZWR1Y2F0aW9uIiwKCSJjby5ldmVudHMiLAoJImNvLmZpbmFuY2lhbCIsCgkiY28ubmV0d29yayIsCgkiY28ucGxhY2UiLAoJImNvLnRlY2hub2xvZ3kiLAoJImFwcC5sbXBtLmNvbSIsCgkibGlua3lhcmQuY2xvdWQiLAoJImxpbmt5YXJkLWNsb3VkLmNoIiwKCSJtZW1iZXJzLmxpbm9kZS5jb20iLAoJIioubm9kZWJhbGFuY2VyLmxpbm9kZS5jb20iLAoJIioubGlub2Rlb2JqZWN0cy5jb20iLAoJImlwLmxpbm9kZXVzZXJjb250ZW50LmNvbSIsCgkid2UuYnMiLAoJIioudXNlci5sb2NhbGNlcnQuZGV2IiwKCSJsb2NhbHpvbmUueHl6IiwKCSJsb2dpbmxpbmUuYXBwIiwKCSJsb2dpbmxpbmUuZGV2IiwKCSJsb2dpbmxpbmUuaW8iLAoJImxvZ2lubGluZS5zZXJ2aWNlcyIsCgkibG9naW5saW5lLnNpdGUiLAoJInNlcnZlcnMucnVuIiwKCSJsb2htdXMubWUiLAoJImtyYXNuaWsucGwiLAoJImxlY3puYS5wbCIsCgkibHViYXJ0b3cucGwiLAoJImx1Ymxpbi5wbCIsCgkicG9uaWF0b3dhLnBsIiwKCSJzd2lkbmlrLnBsIiwKCSJnbHVnLm9yZy51ayIsCgkibHVnLm9yZy51ayIsCgkibHVncy5vcmcudWsiLAoJImJhcnN5LmJnIiwKCSJiYXJzeS5jby51ayIsCgkiYmFyc3lvbmxpbmUuY28udWsiLAoJImJhcnN5Y2VudGVyLmNvbSIsCgkiYmFyc3lvbmxpbmUuY29tIiwKCSJiYXJzeS5jbHViIiwKCSJiYXJzeS5kZSIsCgkiYmFyc3kuZXUiLAoJImJhcnN5LmluIiwKCSJiYXJzeS5pbmZvIiwKCSJiYXJzeS5pbyIsCgkiYmFyc3kubWUiLAoJImJhcnN5Lm1lbnUiLAoJImJhcnN5Lm1vYmkiLAoJImJhcnN5Lm5ldCIsCgkiYmFyc3kub25saW5lIiwKCSJiYXJzeS5vcmciLAoJImJhcnN5LnBybyIsCgkiYmFyc3kucHViIiwKCSJiYXJzeS5ybyIsCgkiYmFyc3kuc2hvcCIsCgkiYmFyc3kuc2l0ZSIsCgkiYmFyc3kuc3VwcG9ydCIsCgkiYmFyc3kudWsiLAoJIioubWFnZW50b3NpdGUuY2xvdWQiLAoJIm1heWZpcnN0LmluZm8iLAoJIm1heWZpcnN0Lm9yZyIsCgkiaGIuY2xkbWFpbC5ydSIsCgkiY24udnUiLAoJIm1hemVwbGF5LmNvbSIsCgkibWNwZS5tZSIsCgkibWNkaXIubWUiLAoJIm1jZGlyLnJ1IiwKCSJtY3ByZS5ydSIsCgkidnBzLm1jZGlyLnJ1IiwKCSJtZWRpYXRlY2guYnkiLAoJIm1lZGlhdGVjaC5kZXYiLAoJImhyYS5oZWFsdGgiLAoJIm1pbmlzZXJ2ZXIuY29tIiwKCSJtZW1zZXQubmV0IiwKCSJtZXNzZXJsaS5hcHAiLAoJIiouY2xvdWQubWV0YWNlbnRydW0uY3oiLAoJImN1c3RvbS5tZXRhY2VudHJ1bS5jeiIsCgkiZmx0LmNsb3VkLm11bmkuY3oiLAoJInVzci5jbG91ZC5tdW5pLmN6IiwKCSJtZXRlb3JhcHAuY29tIiwKCSJldS5tZXRlb3JhcHAuY29tIiwKCSJjby5wbCIsCgkiKi5henVyZWNvbnRhaW5lci5pbyIsCgkiYXp1cmV3ZWJzaXRlcy5uZXQiLAoJImF6dXJlLW1vYmlsZS5uZXQiLAoJImNsb3VkYXBwLm5ldCIsCgkiYXp1cmVzdGF0aWNhcHBzLm5ldCIsCgkiMS5henVyZXN0YXRpY2FwcHMubmV0IiwKCSJjZW50cmFsdXMuYXp1cmVzdGF0aWNhcHBzLm5ldCIsCgkiZWFzdGFzaWEuYXp1cmVzdGF0aWNhcHBzLm5ldCIsCgkiZWFzdHVzMi5henVyZXN0YXRpY2FwcHMubmV0IiwKCSJ3ZXN0ZXVyb3BlLmF6dXJlc3RhdGljYXBwcy5uZXQiLAoJIndlc3R1czIuYXp1cmVzdGF0aWNhcHBzLm5ldCIsCgkiY3N4LmNjIiwKCSJtaW50ZXJlLnNpdGUiLAoJImZvcnRlLmlkIiwKCSJtb3ppbGxhLWlvdC5vcmciLAoJImJtb2F0dGFjaG1lbnRzLm9yZyIsCgkibmV0LnJ1IiwKCSJvcmcucnUiLAoJInBwLnJ1IiwKCSJob3N0ZWRwaS5jb20iLAoJImN1c3RvbWVyLm15dGhpYy1iZWFzdHMuY29tIiwKCSJjYXJhY2FsLm15dGhpYy1iZWFzdHMuY29tIiwKCSJmZW50aWdlci5teXRoaWMtYmVhc3RzLmNvbSIsCgkibHlueC5teXRoaWMtYmVhc3RzLmNvbSIsCgkib2NlbG90Lm15dGhpYy1iZWFzdHMuY29tIiwKCSJvbmNpbGxhLm15dGhpYy1iZWFzdHMuY29tIiwKCSJvbnphLm15dGhpYy1iZWFzdHMuY29tIiwKCSJzcGhpbngubXl0aGljLWJlYXN0cy5jb20iLAoJInZzLm15dGhpYy1iZWFzdHMuY29tIiwKCSJ4Lm15dGhpYy1iZWFzdHMuY29tIiwKCSJ5YWxpLm15dGhpYy1iZWFzdHMuY29tIiwKCSJjdXN0LnJldHJvc251Yi5jby51ayIsCgkidWkubmFidS5jYXNhIiwKCSJwb255LmNsdWIiLAoJIm9mLmZhc2hpb24iLAoJImluLmxvbmRvbiIsCgkib2YubG9uZG9uIiwKCSJmcm9tLm1hcmtldGluZyIsCgkid2l0aC5tYXJrZXRpbmciLAoJImZvci5tZW4iLAoJInJlcGFpci5tZW4iLAoJImFuZC5tb20iLAoJImZvci5tb20iLAoJImZvci5vbmUiLAoJInVuZGVyLm9uZSIsCgkiZm9yLnNhbGUiLAoJInRoYXQud2luIiwKCSJmcm9tLndvcmsiLAoJInRvLndvcmsiLAoJImNsb3VkLm5vc3BhbXByb3h5LmNvbSIsCgkibmV0bGlmeS5hcHAiLAoJIjR1LmNvbSIsCgkibmdyb2suaW8iLAoJIm5oLXNlcnYuY28udWsiLAoJIm5mc2hvc3QuY29tIiwKCSIqLmRldmVsb3Blci5hcHAiLAoJIm5vb3AuYXBwIiwKCSIqLm5vcnRoZmxhbmsuYXBwIiwKCSIqLmJ1aWxkLnJ1biIsCgkiKi5jb2RlLnJ1biIsCgkiKi5kYXRhYmFzZS5ydW4iLAoJIioubWlncmF0aW9uLnJ1biIsCgkibm90aWNlYWJsZS5uZXdzIiwKCSJkbnNraW5nLmNoIiwKCSJteXBpLmNvIiwKCSJuNHQuY28iLAoJIjAwMXd3dy5jb20iLAoJImRkbnNsaXZlLmNvbSIsCgkibXlpcGhvc3QuY29tIiwKCSJmb3J1bXouaW5mbyIsCgkiMTYtYi5pdCIsCgkiMzItYi5pdCIsCgkiNjQtYi5pdCIsCgkic291bmRjYXN0Lm1lIiwKCSJ0Y3A0Lm1lIiwKCSJkbnN1cC5uZXQiLAoJImhpY2FtLm5ldCIsCgkibm93LWRucy5uZXQiLAoJIm93bmlwLm5ldCIsCgkidnBuZG5zLm5ldCIsCgkiZHluc2Vydi5vcmciLAoJIm5vdy1kbnMub3JnIiwKCSJ4NDQzLnB3IiwKCSJub3ctZG5zLnRvcCIsCgkibnRkbGwudG9wIiwKCSJmcmVlZGRucy51cyIsCgkiY3JhZnRpbmcueHl6IiwKCSJ6YXB0by54eXoiLAoJIm5zdXBkYXRlLmluZm8iLAoJIm5lcmRwb2wub3ZoIiwKCSJibG9nc3l0ZS5jb20iLAoJImJyYXNpbGlhLm1lIiwKCSJjYWJsZS1tb2RlbS5vcmciLAoJImNpc2NvZnJlYWsuY29tIiwKCSJjb2xsZWdlZmFuLm9yZyIsCgkiY291Y2hwb3RhdG9mcmllcy5vcmciLAoJImRhbW5zZXJ2ZXIuY29tIiwKCSJkZG5zLm1lIiwKCSJkaXRjaHlvdXJpcC5jb20iLAoJImRuc2Zvci5tZSIsCgkiZG5zaXNraW5reS5jb20iLAoJImR2cmNhbS5pbmZvIiwKCSJkeW5ucy5jb20iLAoJImVhdGluZy1vcmdhbmljLm5ldCIsCgkiZmFudGFzeWxlYWd1ZS5jYyIsCgkiZ2Vla2dhbGF4eS5jb20iLAoJImdvbGZmYW4udXMiLAoJImhlYWx0aC1jYXJlcmVmb3JtLmNvbSIsCgkiaG9tZXNlY3VyaXR5bWFjLmNvbSIsCgkiaG9tZXNlY3VyaXR5cGMuY29tIiwKCSJob3B0by5tZSIsCgkiaWxvdmVjb2xsZWdlLmluZm8iLAoJImxvZ2ludG8ubWUiLAoJIm1sYmZhbi5vcmciLAoJIm1tYWZhbi5iaXoiLAoJIm15YWN0aXZlZGlyZWN0b3J5LmNvbSIsCgkibXlkaXNzZW50Lm5ldCIsCgkibXllZmZlY3QubmV0IiwKCSJteW1lZGlhcGMubmV0IiwKCSJteXBzeC5uZXQiLAoJIm15c2VjdXJpdHljYW1lcmEuY29tIiwKCSJteXNlY3VyaXR5Y2FtZXJhLm5ldCIsCgkibXlzZWN1cml0eWNhbWVyYS5vcmciLAoJIm5ldC1mcmVha3MuY29tIiwKCSJuZmxmYW4ub3JnIiwKCSJuaGxmYW4ubmV0IiwKCSJuby1pcC5jYSIsCgkibm8taXAuY28udWsiLAoJIm5vLWlwLm5ldCIsCgkibm9pcC51cyIsCgkib250aGV3aWZpLmNvbSIsCgkicGdhZmFuLm5ldCIsCgkicG9pbnQydGhpcy5jb20iLAoJInBvaW50dG8udXMiLAoJInByaXZhdGl6ZWhlYWx0aGluc3VyYW5jZS5uZXQiLAoJInF1aWNrc3l0ZXMuY29tIiwKCSJyZWFkLWJvb2tzLm9yZyIsCgkic2VjdXJpdHl0YWN0aWNzLmNvbSIsCgkic2VydmVleGNoYW5nZS5jb20iLAoJInNlcnZlaHVtb3VyLmNvbSIsCgkic2VydmVwMnAuY29tIiwKCSJzZXJ2ZXNhcmNhc20uY29tIiwKCSJzdHVmZnRvcmVhZC5jb20iLAoJInVmY2Zhbi5vcmciLAoJInVudXN1YWxwZXJzb24uY29tIiwKCSJ3b3JraXNib3JpbmcuY29tIiwKCSIzdXRpbGl0aWVzLmNvbSIsCgkiYm91bmNlbWUubmV0IiwKCSJkZG5zLm5ldCIsCgkiZGRuc2tpbmcuY29tIiwKCSJnb3RkbnMuY2giLAoJImhvcHRvLm9yZyIsCgkibXlmdHAuYml6IiwKCSJteWZ0cC5vcmciLAoJIm15dm5jLmNvbSIsCgkibm8taXAuYml6IiwKCSJuby1pcC5pbmZvIiwKCSJuby1pcC5vcmciLAoJIm5vaXAubWUiLAoJInJlZGlyZWN0bWUubmV0IiwKCSJzZXJ2ZWJlZXIuY29tIiwKCSJzZXJ2ZWJsb2cubmV0IiwKCSJzZXJ2ZWNvdW50ZXJzdHJpa2UuY29tIiwKCSJzZXJ2ZWZ0cC5jb20iLAoJInNlcnZlZ2FtZS5jb20iLAoJInNlcnZlaGFsZmxpZmUuY29tIiwKCSJzZXJ2ZWh0dHAuY29tIiwKCSJzZXJ2ZWlyYy5jb20iLAoJInNlcnZlbWluZWNyYWZ0Lm5ldCIsCgkic2VydmVtcDMuY29tIiwKCSJzZXJ2ZXBpY3MuY29tIiwKCSJzZXJ2ZXF1YWtlLmNvbSIsCgkic3l0ZXMubmV0IiwKCSJ3ZWJob3AubWUiLAoJInphcHRvLm9yZyIsCgkic3RhZ2Uubm9kZWFydC5pbyIsCgkicGNsb3VkLmhvc3QiLAoJIm55Yy5tbiIsCgkic3RhdGljLm9ic2VydmFibGV1c2VyY29udGVudC5jb20iLAoJImN5YS5nZyIsCgkib21nLmxvbCIsCgkiY2xvdWR5Y2x1c3Rlci5uZXQiLAoJIm9tbml3ZS5zaXRlIiwKCSJzZXJ2aWNlLm9uZSIsCgkibmlkLmlvIiwKCSJvcGVuc29jaWFsLnNpdGUiLAoJIm9wZW5jcmFmdC5ob3N0aW5nIiwKCSJvcnNpdGVzLmNvbSIsCgkib3BlcmF1bml0ZS5jb20iLAoJInRlY2gub3JhbmdlIiwKCSJhdXRoZ2Vhci1zdGFnaW5nLmNvbSIsCgkiYXV0aGdlYXJhcHBzLmNvbSIsCgkic2t5Z2VhcmFwcC5jb20iLAoJIm91dHN5c3RlbXNjbG91ZC5jb20iLAoJIioud2VicGFhcy5vdmgubmV0IiwKCSIqLmhvc3Rpbmcub3ZoLm5ldCIsCgkib3ducHJvdmlkZXIuY29tIiwKCSJvd24ucG0iLAoJIioub3dvLmNvZGVzIiwKCSJveC5ycyIsCgkib3kubGMiLAoJInBnZm9nLmNvbSIsCgkicGFnZWZyb250YXBwLmNvbSIsCgkicGFnZXhsLmNvbSIsCgkiKi5wYXl3aGlybC5jb20iLAoJImJhcjAubmV0IiwKCSJiYXIxLm5ldCIsCgkiYmFyMi5uZXQiLAoJInJkdi50byIsCgkiYXJ0LnBsIiwKCSJnbGl3aWNlLnBsIiwKCSJrcmFrb3cucGwiLAoJInBvem5hbi5wbCIsCgkid3JvYy5wbCIsCgkiemFrb3BhbmUucGwiLAoJInBhbnRoZW9uc2l0ZS5pbyIsCgkiZ290cGFudGhlb24uY29tIiwKCSJteXBlcC5saW5rIiwKCSJwZXJzcGVjdGEuY2xvdWQiLAoJImxrMy5ydSIsCgkib24td2ViLmZyIiwKCSJiYy5wbGF0Zm9ybS5zaCIsCgkiZW50LnBsYXRmb3JtLnNoIiwKCSJldS5wbGF0Zm9ybS5zaCIsCgkidXMucGxhdGZvcm0uc2giLAoJIioucGxhdGZvcm1zaC5zaXRlIiwKCSIqLnRzdC5zaXRlIiwKCSJwbGF0dGVyLWFwcC5jb20iLAoJInBsYXR0ZXItYXBwLmRldiIsCgkicGxhdHRlcnAudXMiLAoJInBkbnMucGFnZSIsCgkicGxlc2sucGFnZSIsCgkicGxlc2tucy5jb20iLAoJImR5bjUzLmlvIiwKCSJvbnBvcnRlci5ydW4iLAoJImNvLmJuIiwKCSJwb3N0bWFuLWVjaG8uY29tIiwKCSJwc3Rtbi5pbyIsCgkibW9jay5wc3Rtbi5pbyIsCgkiaHR0cGJpbi5vcmciLAoJInByZXF1YWxpZnltZS50b2RheSIsCgkieGVuLnByZ21yLmNvbSIsCgkicHJpdi5hdCIsCgkicHJ2Y3kucGFnZSIsCgkiKi5kd2ViLmxpbmsiLAoJInByb3RvbmV0LmlvIiwKCSJjaGlydXJnaWVucy1kZW50aXN0ZXMtZW4tZnJhbmNlLmZyIiwKCSJieWVuLnNpdGUiLAoJInB1YnRscy5vcmciLAoJInB5dGhvbmFueXdoZXJlLmNvbSIsCgkiZXUucHl0aG9uYW55d2hlcmUuY29tIiwKCSJxb3RvLmlvIiwKCSJxdWFsaWZpb2FwcC5jb20iLAoJInFidXNlci5jb20iLAoJImNsb3Vkc2l0ZS5idWlsZGVycyIsCgkiaW5zdGFuY2VzLnNwYXduLmNjIiwKCSJpbnN0YW50Y2xvdWQuY24iLAoJInJhcy5ydSIsCgkicWEyLmNvbSIsCgkicWN4LmlvIiwKCSIqLnN5cy5xY3guaW8iLAoJImRldi1teXFuYXBjbG91ZC5jb20iLAoJImFscGhhLW15cW5hcGNsb3VkLmNvbSIsCgkibXlxbmFwY2xvdWQuY29tIiwKCSIqLnF1aXBlbGVtZW50cy5jb20iLAoJInZhcG9yLmNsb3VkIiwKCSJ2YXBvcmNsb3VkLmlvIiwKCSJyYWNrbWF6ZS5jb20iLAoJInJhY2ttYXplLm5ldCIsCgkiZy52YnJwbHNieC5pbyIsCgkiKi5vbi1rM3MuaW8iLAoJIioub24tcmFuY2hlci5jbG91ZCIsCgkiKi5vbi1yaW8uaW8iLAoJInJlYWR0aGVkb2NzLmlvIiwKCSJyaGNsb3VkLmNvbSIsCgkiYXBwLnJlbmRlci5jb20iLAoJIm9ucmVuZGVyLmNvbSIsCgkicmVwbC5jbyIsCgkiaWQucmVwbC5jbyIsCgkicmVwbC5ydW4iLAoJInJlc2luZGV2aWNlLmlvIiwKCSJkZXZpY2VzLnJlc2luc3RhZ2luZy5pbyIsCgkiaHpjLmlvIiwKCSJ3ZWxsYmVpbmd6b25lLmV1IiwKCSJ3ZWxsYmVpbmd6b25lLmNvLnVrIiwKCSJhZGltby5jby51ayIsCgkiaXRjb3VsZGJld29yLnNlIiwKCSJnaXQtcGFnZXMucml0LmVkdSIsCgkicm9ja3kucGFnZSIsCgki0LHQuNC3LtGA0YPRgSIsCgki0LrQvtC8LtGA0YPRgSIsCgki0LrRgNGL0Lwu0YDRg9GBIiwKCSLQvNC40YAu0YDRg9GBIiwKCSLQvNGB0Lou0YDRg9GBIiwKCSLQvtGA0LMu0YDRg9GBIiwKCSLRgdCw0LzQsNGA0LAu0YDRg9GBIiwKCSLRgdC+0YfQuC7RgNGD0YEiLAoJItGB0L/QsS7RgNGD0YEiLAoJItGPLtGA0YPRgSIsCgkiKi5idWlsZGVyLmNvZGUuY29tIiwKCSIqLmRldi1idWlsZGVyLmNvZGUuY29tIiwKCSIqLnN0Zy1idWlsZGVyLmNvZGUuY29tIiwKCSJzYW5kY2F0cy5pbyIsCgkibG9nb2lwLmRlIiwKCSJsb2dvaXAuY29tIiwKCSJmci1wYXItMS5iYXJlbWV0YWwuc2N3LmNsb3VkIiwKCSJmci1wYXItMi5iYXJlbWV0YWwuc2N3LmNsb3VkIiwKCSJubC1hbXMtMS5iYXJlbWV0YWwuc2N3LmNsb3VkIiwKCSJmbmMuZnItcGFyLnNjdy5jbG91ZCIsCgkiZnVuY3Rpb25zLmZuYy5mci1wYXIuc2N3LmNsb3VkIiwKCSJrOHMuZnItcGFyLnNjdy5jbG91ZCIsCgkibm9kZXMuazhzLmZyLXBhci5zY3cuY2xvdWQiLAoJInMzLmZyLXBhci5zY3cuY2xvdWQiLAoJInMzLXdlYnNpdGUuZnItcGFyLnNjdy5jbG91ZCIsCgkid2htLmZyLXBhci5zY3cuY2xvdWQiLAoJInByaXYuaW5zdGFuY2VzLnNjdy5jbG91ZCIsCgkicHViLmluc3RhbmNlcy5zY3cuY2xvdWQiLAoJIms4cy5zY3cuY2xvdWQiLAoJIms4cy5ubC1hbXMuc2N3LmNsb3VkIiwKCSJub2Rlcy5rOHMubmwtYW1zLnNjdy5jbG91ZCIsCgkiczMubmwtYW1zLnNjdy5jbG91ZCIsCgkiczMtd2Vic2l0ZS5ubC1hbXMuc2N3LmNsb3VkIiwKCSJ3aG0ubmwtYW1zLnNjdy5jbG91ZCIsCgkiazhzLnBsLXdhdy5zY3cuY2xvdWQiLAoJIm5vZGVzLms4cy5wbC13YXcuc2N3LmNsb3VkIiwKCSJzMy5wbC13YXcuc2N3LmNsb3VkIiwKCSJzMy13ZWJzaXRlLnBsLXdhdy5zY3cuY2xvdWQiLAoJInNjYWxlYm9vay5zY3cuY2xvdWQiLAoJInNtYXJ0bGFiZWxpbmcuc2N3LmNsb3VkIiwKCSJkZWRpYm94LmZyIiwKCSJzY2hva29rZWtzLm5ldCIsCgkiZ292LnNjb3QiLAoJInNlcnZpY2UuZ292LnNjb3QiLAoJInNjcnlzZWMuY29tIiwKCSJmaXJld2FsbC1nYXRld2F5LmNvbSIsCgkiZmlyZXdhbGwtZ2F0ZXdheS5kZSIsCgkibXktZ2F0ZXdheS5kZSIsCgkibXktcm91dGVyLmRlIiwKCSJzcGRucy5kZSIsCgkic3BkbnMuZXUiLAoJImZpcmV3YWxsLWdhdGV3YXkubmV0IiwKCSJteS1maXJld2FsbC5vcmciLAoJIm15ZmlyZXdhbGwub3JnIiwKCSJzcGRucy5vcmciLAoJInNlaWRhdC5uZXQiLAoJInNlbGxmeS5zdG9yZSIsCgkic2Vuc2VlcmluZy5uZXQiLAoJIm1pbmlzaXRlLm1zIiwKCSJtYWduZXQucGFnZSIsCgkiYml6LnVhIiwKCSJjby51YSIsCgkicHAudWEiLAoJInNoaWZ0Y3J5cHRvLmRldiIsCgkic2hpZnRjcnlwdG8uaW8iLAoJInNoaWZ0ZWRpdC5pbyIsCgkibXlzaG9wYmxvY2tzLmNvbSIsCgkibXlzaG9waWZ5LmNvbSIsCgkic2hvcGl0c2l0ZS5jb20iLAoJInNob3B3YXJlLnN0b3JlIiwKCSJtby1zaWVtZW5zLmlvIiwKCSIxa2FwcC5jb20iLAoJImFwcGNoaXppLmNvbSIsCgkiYXBwbGluemkuY29tIiwKCSJzaW5hYXBwLmNvbSIsCgkidmlwc2luYWFwcC5jb20iLAoJInNpdGVsZWFmLm5ldCIsCgkiYm91bnR5LWZ1bGwuY29tIiwKCSJhbHBoYS5ib3VudHktZnVsbC5jb20iLAoJImJldGEuYm91bnR5LWZ1bGwuY29tIiwKCSJzbWFsbC13ZWIub3JnIiwKCSJ2cDQubWUiLAoJInRyeS1zbm93cGxvdy5jb20iLAoJInNyaHQuc2l0ZSIsCgkic3RhY2toZXJvLW5ldHdvcmsuY29tIiwKCSJtdXNpY2lhbi5pbyIsCgkibm92ZWNvcmUuc2l0ZSIsCgkic3RhdGljLmxhbmQiLAoJImRldi5zdGF0aWMubGFuZCIsCgkic2l0ZXMuc3RhdGljLmxhbmQiLAoJInN0b3JlYmFzZS5zdG9yZSIsCgkidnBzLWhvc3QubmV0IiwKCSJhdGwuamVsYXN0aWMudnBzLWhvc3QubmV0IiwKCSJuanMuamVsYXN0aWMudnBzLWhvc3QubmV0IiwKCSJyaWMuamVsYXN0aWMudnBzLWhvc3QubmV0IiwKCSJwbGF5c3RhdGlvbi1jbG91ZC5jb20iLAoJImFwcHMubGFpci5pbyIsCgkiKi5zdG9sb3MuaW8iLAoJInNwYWNla2l0LmlvIiwKCSJjdXN0b21lci5zcGVlZHBhcnRuZXIuZGUiLAoJIm15c3ByZWFkc2hvcC5hdCIsCgkibXlzcHJlYWRzaG9wLmNvbS5hdSIsCgkibXlzcHJlYWRzaG9wLmJlIiwKCSJteXNwcmVhZHNob3AuY2EiLAoJIm15c3ByZWFkc2hvcC5jaCIsCgkibXlzcHJlYWRzaG9wLmNvbSIsCgkibXlzcHJlYWRzaG9wLmRlIiwKCSJteXNwcmVhZHNob3AuZGsiLAoJIm15c3ByZWFkc2hvcC5lcyIsCgkibXlzcHJlYWRzaG9wLmZpIiwKCSJteXNwcmVhZHNob3AuZnIiLAoJIm15c3ByZWFkc2hvcC5pZSIsCgkibXlzcHJlYWRzaG9wLml0IiwKCSJteXNwcmVhZHNob3AubmV0IiwKCSJteXNwcmVhZHNob3AubmwiLAoJIm15c3ByZWFkc2hvcC5ubyIsCgkibXlzcHJlYWRzaG9wLnBsIiwKCSJteXNwcmVhZHNob3Auc2UiLAoJIm15c3ByZWFkc2hvcC5jby51ayIsCgkiYXBpLnN0ZGxpYi5jb20iLAoJInN0b3JqLmZhcm0iLAoJInV0d2VudGUuaW8iLAoJInNvYy5zcmNmLm5ldCIsCgkidXNlci5zcmNmLm5ldCIsCgkidGVtcC1kbnMuY29tIiwKCSJzdXBhYmFzZS5jbyIsCgkic3VwYWJhc2UuaW4iLAoJInN1cGFiYXNlLm5ldCIsCgkic3UucGFiYS5zZSIsCgkiKi5zNXkuaW8iLAoJIiouc2Vuc2lvc2l0ZS5jbG91ZCIsCgkic3luY2xvdWQuaXQiLAoJImRzY2xvdWQuYml6IiwKCSJkaXJlY3QucXVpY2tjb25uZWN0LmNuIiwKCSJkc215bmFzLmNvbSIsCgkiZmFtaWx5ZHMuY29tIiwKCSJkaXNrc3RhdGlvbi5tZSIsCgkiZHNjbG91ZC5tZSIsCgkiaTIzNC5tZSIsCgkibXlkcy5tZSIsCgkic3lub2xvZ3kubWUiLAoJImRzY2xvdWQubW9iaSIsCgkiZHNteW5hcy5uZXQiLAoJImZhbWlseWRzLm5ldCIsCgkiZHNteW5hcy5vcmciLAoJImZhbWlseWRzLm9yZyIsCgkidnBucGx1cy50byIsCgkiZGlyZWN0LnF1aWNrY29ubmVjdC50byIsCgkidGFiaXRvcmRlci5jby5pbCIsCgkidGFpZnVuLWRucy5kZSIsCgkiYmV0YS50YWlsc2NhbGUubmV0IiwKCSJ0cy5uZXQiLAoJImdkYS5wbCIsCgkiZ2RhbnNrLnBsIiwKCSJnZHluaWEucGwiLAoJIm1lZC5wbCIsCgkic29wb3QucGwiLAoJInNpdGUudGItaG9zdGluZy5jb20iLAoJImVkdWdpdC5pbyIsCgkiczMudGVja2lkcy5vcmciLAoJInRlbGViaXQuYXBwIiwKCSJ0ZWxlYml0LmlvIiwKCSIqLnRlbGViaXQueHl6IiwKCSJnd2lkZGxlLmNvLnVrIiwKCSIqLmZpcmVuZXQuY2giLAoJIiouc3ZjLmZpcmVuZXQuY2giLAoJInJlc2VydmQuY29tIiwKCSJ0aGluZ2R1c3RkYXRhLmNvbSIsCgkiY3VzdC5kZXYudGhpbmdkdXN0LmlvIiwKCSJjdXN0LmRpc3JlYy50aGluZ2R1c3QuaW8iLAoJImN1c3QucHJvZC50aGluZ2R1c3QuaW8iLAoJImN1c3QudGVzdGluZy50aGluZ2R1c3QuaW8iLAoJInJlc2VydmQuZGV2LnRoaW5nZHVzdC5pbyIsCgkicmVzZXJ2ZC5kaXNyZWMudGhpbmdkdXN0LmlvIiwKCSJyZXNlcnZkLnRlc3RpbmcudGhpbmdkdXN0LmlvIiwKCSJ0aWNrZXRzLmlvIiwKCSJhcnZvLm5ldHdvcmsiLAoJImF6aW11dGgubmV0d29yayIsCgkidGxvbi5uZXR3b3JrIiwKCSJ0b3Jwcm9qZWN0Lm5ldCIsCgkicGFnZXMudG9ycHJvamVjdC5uZXQiLAoJImJsb3hjbXMuY29tIiwKCSJ0b3dubmV3cy1zdGFnaW5nLmNvbSIsCgkidGJpdHMubWUiLAoJIjEyaHAuYXQiLAoJIjJpeC5hdCIsCgkiNGxpbWEuYXQiLAoJImxpbWEtY2l0eS5hdCIsCgkiMTJocC5jaCIsCgkiMml4LmNoIiwKCSI0bGltYS5jaCIsCgkibGltYS1jaXR5LmNoIiwKCSJ0cmFmZmljcGxleC5jbG91ZCIsCgkiZGUuY29vbCIsCgkiMTJocC5kZSIsCgkiMml4LmRlIiwKCSI0bGltYS5kZSIsCgkibGltYS1jaXR5LmRlIiwKCSIxMzM3LnBpY3R1cmVzIiwKCSJjbGFuLnJpcCIsCgkibGltYS1jaXR5LnJvY2tzIiwKCSJ3ZWJzcGFjZS5yb2NrcyIsCgkibGltYS56b25lIiwKCSIqLnRyYW5zdXJsLmJlIiwKCSIqLnRyYW5zdXJsLmV1IiwKCSIqLnRyYW5zdXJsLm5sIiwKCSJzaXRlLnRyYW5zaXAubWUiLAoJInR1eGZhbWlseS5vcmciLAoJImRkLWRucy5kZSIsCgkiZGlza3N0YXRpb24uZXUiLAoJImRpc2tzdGF0aW9uLm9yZyIsCgkiZHJheS1kbnMuZGUiLAoJImRyYXlkbnMuZGUiLAoJImR5bi12cG4uZGUiLAoJImR5bnZwbi5kZSIsCgkibWVpbi12aWdvci5kZSIsCgkibXktdmlnb3IuZGUiLAoJIm15LXdhbi5kZSIsCgkic3luby1kcy5kZSIsCgkic3lub2xvZ3ktZGlza3N0YXRpb24uZGUiLAoJInN5bm9sb2d5LWRzLmRlIiwKCSJ0eXBlZHJlYW0uYXBwIiwKCSJwcm8udHlwZWZvcm0uY29tIiwKCSJ1YmVyLnNwYWNlIiwKCSIqLnViZXJzcGFjZS5kZSIsCgkiaGsuY29tIiwKCSJoay5vcmciLAoJImx0ZC5oayIsCgkiaW5jLmhrIiwKCSJuYW1lLnBtIiwKCSJzY2gudGYiLAoJImJpei53ZiIsCgkic2NoLndmIiwKCSJvcmcueXQiLAoJInZpcnR1YWx1c2VyLmRlIiwKCSJ2aXJ0dWFsLXVzZXIuZGUiLAoJInVwbGkuaW8iLAoJInVyb3duLmNsb3VkIiwKCSJkbnN1cGRhdGUuaW5mbyIsCgkibGliLmRlLnVzIiwKCSIyMDM4LmlvIiwKCSJ2ZXJjZWwuYXBwIiwKCSJ2ZXJjZWwuZGV2IiwKCSJub3cuc2giLAoJInJvdXRlci5tYW5hZ2VtZW50IiwKCSJ2LWluZm8uaW5mbyIsCgkidm9vcmxvcGVyLmNsb3VkIiwKCSJuZWtvLmFtIiwKCSJueWFhLmFtIiwKCSJiZS5heCIsCgkiY2F0LmF4IiwKCSJlcy5heCIsCgkiZXUuYXgiLAoJImdnLmF4IiwKCSJtYy5heCIsCgkidXMuYXgiLAoJInh5LmF4IiwKCSJubC5jaSIsCgkieHguZ2wiLAoJImFwcC5ncCIsCgkiYmxvZy5ndCIsCgkiZGUuZ3QiLAoJInRvLmd0IiwKCSJiZS5neSIsCgkiY2MuaG4iLAoJImJsb2cua2ciLAoJImlvLmtnIiwKCSJqcC5rZyIsCgkidHYua2ciLAoJInVrLmtnIiwKCSJ1cy5rZyIsCgkiZGUubHMiLAoJImF0Lm1kIiwKCSJkZS5tZCIsCgkianAubWQiLAoJInRvLm1kIiwKCSJpbmRpZS5wb3JuIiwKCSJ2eGwuc2giLAoJImNoLnRjIiwKCSJtZS50YyIsCgkid2UudGMiLAoJIm55YW4udG8iLAoJImF0LnZnIiwKCSJibG9nLnZ1IiwKCSJkZXYudnUiLAoJIm1lLnZ1IiwKCSJ2LnVhIiwKCSIqLnZ1bHRyb2JqZWN0cy5jb20iLAoJIndhZmZsZWNlbGwuY29tIiwKCSIqLndlYmhhcmUuZGV2IiwKCSJyZXNlcnZlLW9ubGluZS5uZXQiLAoJInJlc2VydmUtb25saW5lLmNvbSIsCgkiYm9va29ubGluZS5hcHAiLAoJImhvdGVsd2l0aGZsaWdodC5jb20iLAoJIndlZGVwbG95LmlvIiwKCSJ3ZWRlcGxveS5tZSIsCgkid2VkZXBsb3kuc2giLAoJInJlbW90ZXdkLmNvbSIsCgkicGFnZXMud2lhcmR3ZWIuY29tIiwKCSJ3bWZsYWJzLm9yZyIsCgkidG9vbGZvcmdlLm9yZyIsCgkid21jbG91ZC5vcmciLAoJInBhbmVsLmdnIiwKCSJkYWVtb24ucGFuZWwuZ2ciLAoJIm1lc3N3aXRoZG5zLmNvbSIsCgkid29sdGxhYi1kZW1vLmNvbSIsCgkibXlmb3J1bS5jb21tdW5pdHkiLAoJImNvbW11bml0eS1wcm8uZGUiLAoJImRpc2t1c3Npb25zYmVyZWljaC5kZSIsCgkiY29tbXVuaXR5LXByby5uZXQiLAoJIm1laW5mb3J1bS5uZXQiLAoJImFmZmluaXR5bG90dGVyeS5vcmcudWsiLAoJInJhZmZsZWVudHJ5Lm9yZy51ayIsCgkid2Vla2x5bG90dGVyeS5vcmcudWsiLAoJIndwZW5naW5lcG93ZXJlZC5jb20iLAoJImpzLndwZW5naW5lcG93ZXJlZC5jb20iLAoJIndpeHNpdGUuY29tIiwKCSJlZGl0b3J4LmlvIiwKCSJoYWxmLmhvc3QiLAoJInhuYmF5LmNvbSIsCgkidTIueG5iYXkuY29tIiwKCSJ1Mi1sb2NhbC54bmJheS5jb20iLAoJImNpc3Ryb24ubmwiLAoJImRlbW9uLm5sIiwKCSJ4czRhbGwuc3BhY2UiLAoJInlhbmRleGNsb3VkLm5ldCIsCgkic3RvcmFnZS55YW5kZXhjbG91ZC5uZXQiLAoJIndlYnNpdGUueWFuZGV4Y2xvdWQubmV0IiwKCSJvZmZpY2lhbC5hY2FkZW15IiwKCSJ5b2xhc2l0ZS5jb20iLAoJInliby5mYWl0aCIsCgkieW9tYm8ubWUiLAoJImhvbWVsaW5rLm9uZSIsCgkieWJvLnBhcnR5IiwKCSJ5Ym8ucmV2aWV3IiwKCSJ5Ym8uc2NpZW5jZSIsCgkieWJvLnRyYWRlIiwKCSJ5bmguZnIiLAoJIm5vaG9zdC5tZSIsCgkibm9oby5zdCIsCgkiemEubmV0IiwKCSJ6YS5vcmciLAoJImJzcy5kZXNpZ24iLAoJImJhc2ljc2VydmVyLmlvIiwKCSJ2aXJ0dWFsc2VydmVyLmlvIiwKCSJlbnRlcnByaXNlY2xvdWQubnUiCl07CgovKmVzbGludCBuby12YXI6MCwgcHJlZmVyLWFycm93LWNhbGxiYWNrOiAwLCBvYmplY3Qtc2hvcnRoYW5kOiAwICovCgooZnVuY3Rpb24gKGV4cG9ydHMpIHsKCgoJdmFyIFB1bnljb2RlID0gcmVxdWlyZSQkMCQyOwoKCgl2YXIgaW50ZXJuYWxzID0ge307CgoKCS8vCgkvLyBSZWFkIHJ1bGVzIGZyb20gZmlsZS4KCS8vCglpbnRlcm5hbHMucnVsZXMgPSByZXF1aXJlJCQxLm1hcChmdW5jdGlvbiAocnVsZSkgewoKCSAgcmV0dXJuIHsKCSAgICBydWxlOiBydWxlLAoJICAgIHN1ZmZpeDogcnVsZS5yZXBsYWNlKC9eKFwqXC58XCEpLywgJycpLAoJICAgIHB1bnlTdWZmaXg6IC0xLAoJICAgIHdpbGRjYXJkOiBydWxlLmNoYXJBdCgwKSA9PT0gJyonLAoJICAgIGV4Y2VwdGlvbjogcnVsZS5jaGFyQXQoMCkgPT09ICchJwoJICB9OwoJfSk7CgoKCS8vCgkvLyBDaGVjayBpcyBnaXZlbiBzdHJpbmcgZW5kcyB3aXRoIGBzdWZmaXhgLgoJLy8KCWludGVybmFscy5lbmRzV2l0aCA9IGZ1bmN0aW9uIChzdHIsIHN1ZmZpeCkgewoKCSAgcmV0dXJuIHN0ci5pbmRleE9mKHN1ZmZpeCwgc3RyLmxlbmd0aCAtIHN1ZmZpeC5sZW5ndGgpICE9PSAtMTsKCX07CgoKCS8vCgkvLyBGaW5kIHJ1bGUgZm9yIGEgZ2l2ZW4gZG9tYWluLgoJLy8KCWludGVybmFscy5maW5kUnVsZSA9IGZ1bmN0aW9uIChkb21haW4pIHsKCgkgIHZhciBwdW55RG9tYWluID0gUHVueWNvZGUudG9BU0NJSShkb21haW4pOwoJICByZXR1cm4gaW50ZXJuYWxzLnJ1bGVzLnJlZHVjZShmdW5jdGlvbiAobWVtbywgcnVsZSkgewoKCSAgICBpZiAocnVsZS5wdW55U3VmZml4ID09PSAtMSl7CgkgICAgICBydWxlLnB1bnlTdWZmaXggPSBQdW55Y29kZS50b0FTQ0lJKHJ1bGUuc3VmZml4KTsKCSAgICB9CgkgICAgaWYgKCFpbnRlcm5hbHMuZW5kc1dpdGgocHVueURvbWFpbiwgJy4nICsgcnVsZS5wdW55U3VmZml4KSAmJiBwdW55RG9tYWluICE9PSBydWxlLnB1bnlTdWZmaXgpIHsKCSAgICAgIHJldHVybiBtZW1vOwoJICAgIH0KCSAgICAvLyBUaGlzIGhhcyBiZWVuIGNvbW1lbnRlZCBvdXQgYXMgaXQgbmV2ZXIgc2VlbXMgdG8gcnVuLiBUaGlzIGlzIGJlY2F1c2UKCSAgICAvLyBzdWIgdGxkcyBhbHdheXMgYXBwZWFyIGFmdGVyIHRoZWlyIHBhcmVudHMgYW5kIHdlIG5ldmVyIGZpbmQgYSBzaG9ydGVyCgkgICAgLy8gbWF0Y2guCgkgICAgLy9pZiAobWVtbykgewoJICAgIC8vICB2YXIgbWVtb1N1ZmZpeCA9IFB1bnljb2RlLnRvQVNDSUkobWVtby5zdWZmaXgpOwoJICAgIC8vICBpZiAobWVtb1N1ZmZpeC5sZW5ndGggPj0gcHVueVN1ZmZpeC5sZW5ndGgpIHsKCSAgICAvLyAgICByZXR1cm4gbWVtbzsKCSAgICAvLyAgfQoJICAgIC8vfQoJICAgIHJldHVybiBydWxlOwoJICB9LCBudWxsKTsKCX07CgoKCS8vCgkvLyBFcnJvciBjb2RlcyBhbmQgbWVzc2FnZXMuCgkvLwoJZXhwb3J0cy5lcnJvckNvZGVzID0gewoJICBET01BSU5fVE9PX1NIT1JUOiAnRG9tYWluIG5hbWUgdG9vIHNob3J0LicsCgkgIERPTUFJTl9UT09fTE9ORzogJ0RvbWFpbiBuYW1lIHRvbyBsb25nLiBJdCBzaG91bGQgYmUgbm8gbW9yZSB0aGFuIDI1NSBjaGFycy4nLAoJICBMQUJFTF9TVEFSVFNfV0lUSF9EQVNIOiAnRG9tYWluIG5hbWUgbGFiZWwgY2FuIG5vdCBzdGFydCB3aXRoIGEgZGFzaC4nLAoJICBMQUJFTF9FTkRTX1dJVEhfREFTSDogJ0RvbWFpbiBuYW1lIGxhYmVsIGNhbiBub3QgZW5kIHdpdGggYSBkYXNoLicsCgkgIExBQkVMX1RPT19MT05HOiAnRG9tYWluIG5hbWUgbGFiZWwgc2hvdWxkIGJlIGF0IG1vc3QgNjMgY2hhcnMgbG9uZy4nLAoJICBMQUJFTF9UT09fU0hPUlQ6ICdEb21haW4gbmFtZSBsYWJlbCBzaG91bGQgYmUgYXQgbGVhc3QgMSBjaGFyYWN0ZXIgbG9uZy4nLAoJICBMQUJFTF9JTlZBTElEX0NIQVJTOiAnRG9tYWluIG5hbWUgbGFiZWwgY2FuIG9ubHkgY29udGFpbiBhbHBoYW51bWVyaWMgY2hhcmFjdGVycyBvciBkYXNoZXMuJwoJfTsKCgoJLy8KCS8vIFZhbGlkYXRlIGRvbWFpbiBuYW1lIGFuZCB0aHJvdyBpZiBub3QgdmFsaWQuCgkvLwoJLy8gRnJvbSB3aWtpcGVkaWE6CgkvLwoJLy8gSG9zdG5hbWVzIGFyZSBjb21wb3NlZCBvZiBzZXJpZXMgb2YgbGFiZWxzIGNvbmNhdGVuYXRlZCB3aXRoIGRvdHMsIGFzIGFyZSBhbGwKCS8vIGRvbWFpbiBuYW1lcy4gRWFjaCBsYWJlbCBtdXN0IGJlIGJldHdlZW4gMSBhbmQgNjMgY2hhcmFjdGVycyBsb25nLCBhbmQgdGhlCgkvLyBlbnRpcmUgaG9zdG5hbWUgKGluY2x1ZGluZyB0aGUgZGVsaW1pdGluZyBkb3RzKSBoYXMgYSBtYXhpbXVtIG9mIDI1NSBjaGFycy4KCS8vCgkvLyBBbGxvd2VkIGNoYXJzOgoJLy8KCS8vICogYGEtemAKCS8vICogYDAtOWAKCS8vICogYC1gIGJ1dCBub3QgYXMgYSBzdGFydGluZyBvciBlbmRpbmcgY2hhcmFjdGVyCgkvLyAqIGAuYCBhcyBhIHNlcGFyYXRvciBmb3IgdGhlIHRleHR1YWwgcG9ydGlvbnMgb2YgYSBkb21haW4gbmFtZQoJLy8KCS8vICogaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Eb21haW5fbmFtZQoJLy8gKiBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0hvc3RuYW1lCgkvLwoJaW50ZXJuYWxzLnZhbGlkYXRlID0gZnVuY3Rpb24gKGlucHV0KSB7CgoJICAvLyBCZWZvcmUgd2UgY2FuIHZhbGlkYXRlIHdlIG5lZWQgdG8gdGFrZSBjYXJlIG9mIElETnMgd2l0aCB1bmljb2RlIGNoYXJzLgoJICB2YXIgYXNjaWkgPSBQdW55Y29kZS50b0FTQ0lJKGlucHV0KTsKCgkgIGlmIChhc2NpaS5sZW5ndGggPCAxKSB7CgkgICAgcmV0dXJuICdET01BSU5fVE9PX1NIT1JUJzsKCSAgfQoJICBpZiAoYXNjaWkubGVuZ3RoID4gMjU1KSB7CgkgICAgcmV0dXJuICdET01BSU5fVE9PX0xPTkcnOwoJICB9CgoJICAvLyBDaGVjayBlYWNoIHBhcnQncyBsZW5ndGggYW5kIGFsbG93ZWQgY2hhcnMuCgkgIHZhciBsYWJlbHMgPSBhc2NpaS5zcGxpdCgnLicpOwoJICB2YXIgbGFiZWw7CgoJICBmb3IgKHZhciBpID0gMDsgaSA8IGxhYmVscy5sZW5ndGg7ICsraSkgewoJICAgIGxhYmVsID0gbGFiZWxzW2ldOwoJICAgIGlmICghbGFiZWwubGVuZ3RoKSB7CgkgICAgICByZXR1cm4gJ0xBQkVMX1RPT19TSE9SVCc7CgkgICAgfQoJICAgIGlmIChsYWJlbC5sZW5ndGggPiA2MykgewoJICAgICAgcmV0dXJuICdMQUJFTF9UT09fTE9ORyc7CgkgICAgfQoJICAgIGlmIChsYWJlbC5jaGFyQXQoMCkgPT09ICctJykgewoJICAgICAgcmV0dXJuICdMQUJFTF9TVEFSVFNfV0lUSF9EQVNIJzsKCSAgICB9CgkgICAgaWYgKGxhYmVsLmNoYXJBdChsYWJlbC5sZW5ndGggLSAxKSA9PT0gJy0nKSB7CgkgICAgICByZXR1cm4gJ0xBQkVMX0VORFNfV0lUSF9EQVNIJzsKCSAgICB9CgkgICAgaWYgKCEvXlthLXowLTlcLV0rJC8udGVzdChsYWJlbCkpIHsKCSAgICAgIHJldHVybiAnTEFCRUxfSU5WQUxJRF9DSEFSUyc7CgkgICAgfQoJICB9Cgl9OwoKCgkvLwoJLy8gUHVibGljIEFQSQoJLy8KCgoJLy8KCS8vIFBhcnNlIGRvbWFpbi4KCS8vCglleHBvcnRzLnBhcnNlID0gZnVuY3Rpb24gKGlucHV0KSB7CgoJICBpZiAodHlwZW9mIGlucHV0ICE9PSAnc3RyaW5nJykgewoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0RvbWFpbiBuYW1lIG11c3QgYmUgYSBzdHJpbmcuJyk7CgkgIH0KCgkgIC8vIEZvcmNlIGRvbWFpbiB0byBsb3dlcmNhc2UuCgkgIHZhciBkb21haW4gPSBpbnB1dC5zbGljZSgwKS50b0xvd2VyQ2FzZSgpOwoKCSAgLy8gSGFuZGxlIEZRRE4uCgkgIC8vIFRPRE86IFNpbXBseSByZW1vdmUgdHJhaWxpbmcgZG90PwoJICBpZiAoZG9tYWluLmNoYXJBdChkb21haW4ubGVuZ3RoIC0gMSkgPT09ICcuJykgewoJICAgIGRvbWFpbiA9IGRvbWFpbi5zbGljZSgwLCBkb21haW4ubGVuZ3RoIC0gMSk7CgkgIH0KCgkgIC8vIFZhbGlkYXRlIGFuZCBzYW5pdGlzZSBpbnB1dC4KCSAgdmFyIGVycm9yID0gaW50ZXJuYWxzLnZhbGlkYXRlKGRvbWFpbik7CgkgIGlmIChlcnJvcikgewoJICAgIHJldHVybiB7CgkgICAgICBpbnB1dDogaW5wdXQsCgkgICAgICBlcnJvcjogewoJICAgICAgICBtZXNzYWdlOiBleHBvcnRzLmVycm9yQ29kZXNbZXJyb3JdLAoJICAgICAgICBjb2RlOiBlcnJvcgoJICAgICAgfQoJICAgIH07CgkgIH0KCgkgIHZhciBwYXJzZWQgPSB7CgkgICAgaW5wdXQ6IGlucHV0LAoJICAgIHRsZDogbnVsbCwKCSAgICBzbGQ6IG51bGwsCgkgICAgZG9tYWluOiBudWxsLAoJICAgIHN1YmRvbWFpbjogbnVsbCwKCSAgICBsaXN0ZWQ6IGZhbHNlCgkgIH07CgoJICB2YXIgZG9tYWluUGFydHMgPSBkb21haW4uc3BsaXQoJy4nKTsKCgkgIC8vIE5vbi1JbnRlcm5ldCBUTEQKCSAgaWYgKGRvbWFpblBhcnRzW2RvbWFpblBhcnRzLmxlbmd0aCAtIDFdID09PSAnbG9jYWwnKSB7CgkgICAgcmV0dXJuIHBhcnNlZDsKCSAgfQoKCSAgdmFyIGhhbmRsZVB1bnljb2RlID0gZnVuY3Rpb24gKCkgewoKCSAgICBpZiAoIS94bi0tLy50ZXN0KGRvbWFpbikpIHsKCSAgICAgIHJldHVybiBwYXJzZWQ7CgkgICAgfQoJICAgIGlmIChwYXJzZWQuZG9tYWluKSB7CgkgICAgICBwYXJzZWQuZG9tYWluID0gUHVueWNvZGUudG9BU0NJSShwYXJzZWQuZG9tYWluKTsKCSAgICB9CgkgICAgaWYgKHBhcnNlZC5zdWJkb21haW4pIHsKCSAgICAgIHBhcnNlZC5zdWJkb21haW4gPSBQdW55Y29kZS50b0FTQ0lJKHBhcnNlZC5zdWJkb21haW4pOwoJICAgIH0KCSAgICByZXR1cm4gcGFyc2VkOwoJICB9OwoKCSAgdmFyIHJ1bGUgPSBpbnRlcm5hbHMuZmluZFJ1bGUoZG9tYWluKTsKCgkgIC8vIFVubGlzdGVkIHRsZC4KCSAgaWYgKCFydWxlKSB7CgkgICAgaWYgKGRvbWFpblBhcnRzLmxlbmd0aCA8IDIpIHsKCSAgICAgIHJldHVybiBwYXJzZWQ7CgkgICAgfQoJICAgIHBhcnNlZC50bGQgPSBkb21haW5QYXJ0cy5wb3AoKTsKCSAgICBwYXJzZWQuc2xkID0gZG9tYWluUGFydHMucG9wKCk7CgkgICAgcGFyc2VkLmRvbWFpbiA9IFtwYXJzZWQuc2xkLCBwYXJzZWQudGxkXS5qb2luKCcuJyk7CgkgICAgaWYgKGRvbWFpblBhcnRzLmxlbmd0aCkgewoJICAgICAgcGFyc2VkLnN1YmRvbWFpbiA9IGRvbWFpblBhcnRzLnBvcCgpOwoJICAgIH0KCSAgICByZXR1cm4gaGFuZGxlUHVueWNvZGUoKTsKCSAgfQoKCSAgLy8gQXQgdGhpcyBwb2ludCB3ZSBrbm93IHRoZSBwdWJsaWMgc3VmZml4IGlzIGxpc3RlZC4KCSAgcGFyc2VkLmxpc3RlZCA9IHRydWU7CgoJICB2YXIgdGxkUGFydHMgPSBydWxlLnN1ZmZpeC5zcGxpdCgnLicpOwoJICB2YXIgcHJpdmF0ZVBhcnRzID0gZG9tYWluUGFydHMuc2xpY2UoMCwgZG9tYWluUGFydHMubGVuZ3RoIC0gdGxkUGFydHMubGVuZ3RoKTsKCgkgIGlmIChydWxlLmV4Y2VwdGlvbikgewoJICAgIHByaXZhdGVQYXJ0cy5wdXNoKHRsZFBhcnRzLnNoaWZ0KCkpOwoJICB9CgoJICBwYXJzZWQudGxkID0gdGxkUGFydHMuam9pbignLicpOwoKCSAgaWYgKCFwcml2YXRlUGFydHMubGVuZ3RoKSB7CgkgICAgcmV0dXJuIGhhbmRsZVB1bnljb2RlKCk7CgkgIH0KCgkgIGlmIChydWxlLndpbGRjYXJkKSB7CgkgICAgdGxkUGFydHMudW5zaGlmdChwcml2YXRlUGFydHMucG9wKCkpOwoJICAgIHBhcnNlZC50bGQgPSB0bGRQYXJ0cy5qb2luKCcuJyk7CgkgIH0KCgkgIGlmICghcHJpdmF0ZVBhcnRzLmxlbmd0aCkgewoJICAgIHJldHVybiBoYW5kbGVQdW55Y29kZSgpOwoJICB9CgoJICBwYXJzZWQuc2xkID0gcHJpdmF0ZVBhcnRzLnBvcCgpOwoJICBwYXJzZWQuZG9tYWluID0gW3BhcnNlZC5zbGQsICBwYXJzZWQudGxkXS5qb2luKCcuJyk7CgoJICBpZiAocHJpdmF0ZVBhcnRzLmxlbmd0aCkgewoJICAgIHBhcnNlZC5zdWJkb21haW4gPSBwcml2YXRlUGFydHMuam9pbignLicpOwoJICB9CgoJICByZXR1cm4gaGFuZGxlUHVueWNvZGUoKTsKCX07CgoKCS8vCgkvLyBHZXQgZG9tYWluLgoJLy8KCWV4cG9ydHMuZ2V0ID0gZnVuY3Rpb24gKGRvbWFpbikgewoKCSAgaWYgKCFkb21haW4pIHsKCSAgICByZXR1cm4gbnVsbDsKCSAgfQoJICByZXR1cm4gZXhwb3J0cy5wYXJzZShkb21haW4pLmRvbWFpbiB8fCBudWxsOwoJfTsKCgoJLy8KCS8vIENoZWNrIHdoZXRoZXIgZG9tYWluIGJlbG9uZ3MgdG8gYSBrbm93biBwdWJsaWMgc3VmZml4LgoJLy8KCWV4cG9ydHMuaXNWYWxpZCA9IGZ1bmN0aW9uIChkb21haW4pIHsKCgkgIHZhciBwYXJzZWQgPSBleHBvcnRzLnBhcnNlKGRvbWFpbik7CgkgIHJldHVybiBCb29sZWFuKHBhcnNlZC5kb21haW4gJiYgcGFyc2VkLmxpc3RlZCk7Cgl9OyAKfSAocHNsJDEpKTsKCi8qIQogKiBDb3B5cmlnaHQgKGMpIDIwMTgsIFNhbGVzZm9yY2UuY29tLCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqCiAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dAogKiBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDoKICoKICogMS4gUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLAogKiB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLgogKgogKiAyLiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsCiAqIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlIGRvY3VtZW50YXRpb24KICogYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uCiAqCiAqIDMuIE5laXRoZXIgdGhlIG5hbWUgb2YgU2FsZXNmb3JjZS5jb20gbm9yIHRoZSBuYW1lcyBvZiBpdHMgY29udHJpYnV0b3JzIG1heQogKiBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0cyBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0CiAqIHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi4KICoKICogVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyAiQVMgSVMiCiAqIEFORCBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUKICogSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UKICogQVJFIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBDT1BZUklHSFQgSE9MREVSIE9SIENPTlRSSUJVVE9SUyBCRQogKiBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SCiAqIENPTlNFUVVFTlRJQUwgREFNQUdFUyAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GCiAqIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7IExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUwogKiBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTgogKiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVCAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKQogKiBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRQogKiBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4KICovCmNvbnN0IHBzbCA9IHBzbCQxOwoKLy8gUkZDIDY3NjEKY29uc3QgU1BFQ0lBTF9VU0VfRE9NQUlOUyA9IFsKICAibG9jYWwiLAogICJleGFtcGxlIiwKICAiaW52YWxpZCIsCiAgImxvY2FsaG9zdCIsCiAgInRlc3QiCl07Cgpjb25zdCBTUEVDSUFMX1RSRUFUTUVOVF9ET01BSU5TID0gWyJsb2NhbGhvc3QiLCAiaW52YWxpZCJdOwoKZnVuY3Rpb24gZ2V0UHVibGljU3VmZml4KGRvbWFpbiwgb3B0aW9ucyA9IHt9KSB7CiAgY29uc3QgZG9tYWluUGFydHMgPSBkb21haW4uc3BsaXQoIi4iKTsKICBjb25zdCB0b3BMZXZlbERvbWFpbiA9IGRvbWFpblBhcnRzW2RvbWFpblBhcnRzLmxlbmd0aCAtIDFdOwogIGNvbnN0IGFsbG93U3BlY2lhbFVzZURvbWFpbiA9ICEhb3B0aW9ucy5hbGxvd1NwZWNpYWxVc2VEb21haW47CiAgY29uc3QgaWdub3JlRXJyb3IgPSAhIW9wdGlvbnMuaWdub3JlRXJyb3I7CgogIGlmIChhbGxvd1NwZWNpYWxVc2VEb21haW4gJiYgU1BFQ0lBTF9VU0VfRE9NQUlOUy5pbmNsdWRlcyh0b3BMZXZlbERvbWFpbikpIHsKICAgIGlmIChkb21haW5QYXJ0cy5sZW5ndGggPiAxKSB7CiAgICAgIGNvbnN0IHNlY29uZExldmVsRG9tYWluID0gZG9tYWluUGFydHNbZG9tYWluUGFydHMubGVuZ3RoIC0gMl07CiAgICAgIC8vIEluIGFmb3JlbWVudGlvbmVkIGV4YW1wbGUsIHRoZSBlVExEL3B1YlN1ZiB3aWxsIGJlIGFwcGxlLmxvY2FsaG9zdAogICAgICByZXR1cm4gYCR7c2Vjb25kTGV2ZWxEb21haW59LiR7dG9wTGV2ZWxEb21haW59YDsKICAgIH0gZWxzZSBpZiAoU1BFQ0lBTF9UUkVBVE1FTlRfRE9NQUlOUy5pbmNsdWRlcyh0b3BMZXZlbERvbWFpbikpIHsKICAgICAgLy8gRm9yIGEgc2luZ2xlIHdvcmQgc3BlY2lhbCB1c2UgZG9tYWluLCBlLmcuICdsb2NhbGhvc3QnIG9yICdpbnZhbGlkJywgcGVyIFJGQyA2NzYxLAogICAgICAvLyAiQXBwbGljYXRpb24gc29mdHdhcmUgTUFZIHJlY29nbml6ZSB7bG9jYWxob3N0L2ludmFsaWR9IG5hbWVzIGFzIHNwZWNpYWwsIG9yCiAgICAgIC8vIE1BWSBwYXNzIHRoZW0gdG8gbmFtZSByZXNvbHV0aW9uIEFQSXMgYXMgdGhleSB3b3VsZCBmb3Igb3RoZXIgZG9tYWluIG5hbWVzLiIKICAgICAgcmV0dXJuIGAke3RvcExldmVsRG9tYWlufWA7CiAgICB9CiAgfQoKICBpZiAoIWlnbm9yZUVycm9yICYmIFNQRUNJQUxfVVNFX0RPTUFJTlMuaW5jbHVkZXModG9wTGV2ZWxEb21haW4pKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgIGBDb29raWUgaGFzIGRvbWFpbiBzZXQgdG8gdGhlIHB1YmxpYyBzdWZmaXggIiR7dG9wTGV2ZWxEb21haW59IiB3aGljaCBpcyBhIHNwZWNpYWwgdXNlIGRvbWFpbi4gVG8gYWxsb3cgdGhpcywgY29uZmlndXJlIHlvdXIgQ29va2llSmFyIHdpdGgge2FsbG93U3BlY2lhbFVzZURvbWFpbjp0cnVlLCByZWplY3RQdWJsaWNTdWZmaXhlczogZmFsc2V9LmAKICAgICk7CiAgfQoKICByZXR1cm4gcHNsLmdldChkb21haW4pOwp9CgpwdWJzdWZmaXhQc2wuZ2V0UHVibGljU3VmZml4ID0gZ2V0UHVibGljU3VmZml4OwoKdmFyIHN0b3JlID0ge307CgovKiEKICogQ29weXJpZ2h0IChjKSAyMDE1LCBTYWxlc2ZvcmNlLmNvbSwgSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKgogKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQKICogbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6CiAqCiAqIDEuIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwKICogdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KICoKICogMi4gUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLAogKiB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZSBkb2N1bWVudGF0aW9uCiAqIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLgogKgogKiAzLiBOZWl0aGVyIHRoZSBuYW1lIG9mIFNhbGVzZm9yY2UuY29tIG5vciB0aGUgbmFtZXMgb2YgaXRzIGNvbnRyaWJ1dG9ycyBtYXkKICogYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHMgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dAogKiBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uCiAqCiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgIkFTIElTIgogKiBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFCiAqIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFCiAqIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUIEhPTERFUiBPUiBDT05UUklCVVRPUlMgQkUKICogTElBQkxFIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUgogKiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRgogKiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MKICogSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4KICogQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkKICogQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUKICogUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCiAqLwovKmpzaGludCB1bnVzZWQ6ZmFsc2UgKi8KCmxldCBTdG9yZSQyID0gY2xhc3MgU3RvcmUgewogIGNvbnN0cnVjdG9yKCkgewogICAgdGhpcy5zeW5jaHJvbm91cyA9IGZhbHNlOwogIH0KCiAgZmluZENvb2tpZShkb21haW4sIHBhdGgsIGtleSwgY2IpIHsKICAgIHRocm93IG5ldyBFcnJvcigiZmluZENvb2tpZSBpcyBub3QgaW1wbGVtZW50ZWQiKTsKICB9CgogIGZpbmRDb29raWVzKGRvbWFpbiwgcGF0aCwgYWxsb3dTcGVjaWFsVXNlRG9tYWluLCBjYikgewogICAgdGhyb3cgbmV3IEVycm9yKCJmaW5kQ29va2llcyBpcyBub3QgaW1wbGVtZW50ZWQiKTsKICB9CgogIHB1dENvb2tpZShjb29raWUsIGNiKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoInB1dENvb2tpZSBpcyBub3QgaW1wbGVtZW50ZWQiKTsKICB9CgogIHVwZGF0ZUNvb2tpZShvbGRDb29raWUsIG5ld0Nvb2tpZSwgY2IpIHsKICAgIC8vIHJlY29tbWVuZGVkIGRlZmF1bHQgaW1wbGVtZW50YXRpb246CiAgICAvLyByZXR1cm4gdGhpcy5wdXRDb29raWUobmV3Q29va2llLCBjYik7CiAgICB0aHJvdyBuZXcgRXJyb3IoInVwZGF0ZUNvb2tpZSBpcyBub3QgaW1wbGVtZW50ZWQiKTsKICB9CgogIHJlbW92ZUNvb2tpZShkb21haW4sIHBhdGgsIGtleSwgY2IpIHsKICAgIHRocm93IG5ldyBFcnJvcigicmVtb3ZlQ29va2llIGlzIG5vdCBpbXBsZW1lbnRlZCIpOwogIH0KCiAgcmVtb3ZlQ29va2llcyhkb21haW4sIHBhdGgsIGNiKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoInJlbW92ZUNvb2tpZXMgaXMgbm90IGltcGxlbWVudGVkIik7CiAgfQoKICByZW1vdmVBbGxDb29raWVzKGNiKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoInJlbW92ZUFsbENvb2tpZXMgaXMgbm90IGltcGxlbWVudGVkIik7CiAgfQoKICBnZXRBbGxDb29raWVzKGNiKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICJnZXRBbGxDb29raWVzIGlzIG5vdCBpbXBsZW1lbnRlZCAodGhlcmVmb3JlIGphciBjYW5ub3QgYmUgc2VyaWFsaXplZCkiCiAgICApOwogIH0KfTsKCnN0b3JlLlN0b3JlID0gU3RvcmUkMjsKCnZhciBtZW1zdG9yZSA9IHt9OwoKdmFyIHVuaXZlcnNhbGlmeSA9IHt9OwoKdW5pdmVyc2FsaWZ5LmZyb21DYWxsYmFjayA9IGZ1bmN0aW9uIChmbikgewogIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkoZnVuY3Rpb24gKCkgewogICAgaWYgKHR5cGVvZiBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aCAtIDFdID09PSAnZnVuY3Rpb24nKSBmbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgZWxzZSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgYXJndW1lbnRzW2FyZ3VtZW50cy5sZW5ndGhdID0gKGVyciwgcmVzKSA9PiB7CiAgICAgICAgICBpZiAoZXJyKSByZXR1cm4gcmVqZWN0KGVycikKICAgICAgICAgIHJlc29sdmUocmVzKTsKICAgICAgICB9OwogICAgICAgIGFyZ3VtZW50cy5sZW5ndGgrKzsKICAgICAgICBmbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9KQogICAgfQogIH0sICduYW1lJywgeyB2YWx1ZTogZm4ubmFtZSB9KQp9OwoKdW5pdmVyc2FsaWZ5LmZyb21Qcm9taXNlID0gZnVuY3Rpb24gKGZuKSB7CiAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShmdW5jdGlvbiAoKSB7CiAgICBjb25zdCBjYiA9IGFyZ3VtZW50c1thcmd1bWVudHMubGVuZ3RoIC0gMV07CiAgICBpZiAodHlwZW9mIGNiICE9PSAnZnVuY3Rpb24nKSByZXR1cm4gZm4uYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgZWxzZSB7CiAgICAgIGRlbGV0ZSBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aCAtIDFdOwogICAgICBhcmd1bWVudHMubGVuZ3RoLS07CiAgICAgIGZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykudGhlbihyID0+IGNiKG51bGwsIHIpLCBjYik7CiAgICB9CiAgfSwgJ25hbWUnLCB7IHZhbHVlOiBmbi5uYW1lIH0pCn07Cgp2YXIgcGVybXV0ZURvbWFpbiQzID0ge307CgovKiEKICogQ29weXJpZ2h0IChjKSAyMDE1LCBTYWxlc2ZvcmNlLmNvbSwgSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKgogKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQKICogbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6CiAqCiAqIDEuIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwKICogdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KICoKICogMi4gUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLAogKiB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZSBkb2N1bWVudGF0aW9uCiAqIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLgogKgogKiAzLiBOZWl0aGVyIHRoZSBuYW1lIG9mIFNhbGVzZm9yY2UuY29tIG5vciB0aGUgbmFtZXMgb2YgaXRzIGNvbnRyaWJ1dG9ycyBtYXkKICogYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHMgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dAogKiBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uCiAqCiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgIkFTIElTIgogKiBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFCiAqIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFCiAqIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUIEhPTERFUiBPUiBDT05UUklCVVRPUlMgQkUKICogTElBQkxFIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUgogKiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRgogKiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MKICogSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4KICogQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkKICogQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUKICogUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCiAqLwpjb25zdCBwdWJzdWZmaXgkMSA9IHB1YnN1ZmZpeFBzbDsKCi8vIEdpdmVzIHRoZSBwZXJtdXRhdGlvbiBvZiBhbGwgcG9zc2libGUgZG9tYWluTWF0Y2goKWVzIG9mIGEgZ2l2ZW4gZG9tYWluLiBUaGUKLy8gYXJyYXkgaXMgaW4gc2hvcnRlc3QtdG8tbG9uZ2VzdCBvcmRlci4gIEhhbmR5IGZvciBpbmRleGluZy4KCmZ1bmN0aW9uIHBlcm11dGVEb21haW4kMihkb21haW4sIGFsbG93U3BlY2lhbFVzZURvbWFpbikgewogIGNvbnN0IHB1YlN1ZiA9IHB1YnN1ZmZpeCQxLmdldFB1YmxpY1N1ZmZpeChkb21haW4sIHsKICAgIGFsbG93U3BlY2lhbFVzZURvbWFpbjogYWxsb3dTcGVjaWFsVXNlRG9tYWluCiAgfSk7CgogIGlmICghcHViU3VmKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgaWYgKHB1YlN1ZiA9PSBkb21haW4pIHsKICAgIHJldHVybiBbZG9tYWluXTsKICB9CgogIC8vIE51a2UgdHJhaWxpbmcgZG90CiAgaWYgKGRvbWFpbi5zbGljZSgtMSkgPT0gIi4iKSB7CiAgICBkb21haW4gPSBkb21haW4uc2xpY2UoMCwgLTEpOwogIH0KCiAgY29uc3QgcHJlZml4ID0gZG9tYWluLnNsaWNlKDAsIC0ocHViU3VmLmxlbmd0aCArIDEpKTsgLy8gIi5leGFtcGxlLmNvbSIKICBjb25zdCBwYXJ0cyA9IHByZWZpeC5zcGxpdCgiLiIpLnJldmVyc2UoKTsKICBsZXQgY3VyID0gcHViU3VmOwogIGNvbnN0IHBlcm11dGF0aW9ucyA9IFtjdXJdOwogIHdoaWxlIChwYXJ0cy5sZW5ndGgpIHsKICAgIGN1ciA9IGAke3BhcnRzLnNoaWZ0KCl9LiR7Y3VyfWA7CiAgICBwZXJtdXRhdGlvbnMucHVzaChjdXIpOwogIH0KICByZXR1cm4gcGVybXV0YXRpb25zOwp9CgpwZXJtdXRlRG9tYWluJDMucGVybXV0ZURvbWFpbiA9IHBlcm11dGVEb21haW4kMjsKCnZhciBwYXRoTWF0Y2gkMyA9IHt9OwoKLyohCiAqIENvcHlyaWdodCAoYykgMjAxNSwgU2FsZXNmb3JjZS5jb20sIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICoKICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0CiAqIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OgogKgogKiAxLiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsCiAqIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuCiAqCiAqIDIuIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwKICogdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9jdW1lbnRhdGlvbgogKiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4KICoKICogMy4gTmVpdGhlciB0aGUgbmFtZSBvZiBTYWxlc2ZvcmNlLmNvbSBub3IgdGhlIG5hbWVzIG9mIGl0cyBjb250cmlidXRvcnMgbWF5CiAqIGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzIGRlcml2ZWQgZnJvbSB0aGlzIHNvZnR3YXJlIHdpdGhvdXQKICogc3BlY2lmaWMgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uLgogKgogKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIKICogQU5EIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRQogKiBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRQogKiBBUkUgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIENPUFlSSUdIVCBIT0xERVIgT1IgQ09OVFJJQlVUT1JTIEJFCiAqIExJQUJMRSBGT1IgQU5ZIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IKICogQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YKICogU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTCiAqIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOCiAqIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpCiAqIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFCiAqIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgogKi8KLyoKICogIkEgcmVxdWVzdC1wYXRoIHBhdGgtbWF0Y2hlcyBhIGdpdmVuIGNvb2tpZS1wYXRoIGlmIGF0IGxlYXN0IG9uZSBvZiB0aGUKICogZm9sbG93aW5nIGNvbmRpdGlvbnMgaG9sZHM6IgogKi8KZnVuY3Rpb24gcGF0aE1hdGNoJDIocmVxUGF0aCwgY29va2llUGF0aCkgewogIC8vICJvICBUaGUgY29va2llLXBhdGggYW5kIHRoZSByZXF1ZXN0LXBhdGggYXJlIGlkZW50aWNhbC4iCiAgaWYgKGNvb2tpZVBhdGggPT09IHJlcVBhdGgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgY29uc3QgaWR4ID0gcmVxUGF0aC5pbmRleE9mKGNvb2tpZVBhdGgpOwogIGlmIChpZHggPT09IDApIHsKICAgIC8vICJvICBUaGUgY29va2llLXBhdGggaXMgYSBwcmVmaXggb2YgdGhlIHJlcXVlc3QtcGF0aCwgYW5kIHRoZSBsYXN0CiAgICAvLyBjaGFyYWN0ZXIgb2YgdGhlIGNvb2tpZS1wYXRoIGlzICV4MkYgKCIvIikuIgogICAgaWYgKGNvb2tpZVBhdGguc3Vic3RyKC0xKSA9PT0gIi8iKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vICIgbyAgVGhlIGNvb2tpZS1wYXRoIGlzIGEgcHJlZml4IG9mIHRoZSByZXF1ZXN0LXBhdGgsIGFuZCB0aGUgZmlyc3QKICAgIC8vIGNoYXJhY3RlciBvZiB0aGUgcmVxdWVzdC1wYXRoIHRoYXQgaXMgbm90IGluY2x1ZGVkIGluIHRoZSBjb29raWUtIHBhdGgKICAgIC8vIGlzIGEgJXgyRiAoIi8iKSBjaGFyYWN0ZXIuIgogICAgaWYgKHJlcVBhdGguc3Vic3RyKGNvb2tpZVBhdGgubGVuZ3RoLCAxKSA9PT0gIi8iKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogIH0KCiAgcmV0dXJuIGZhbHNlOwp9CgpwYXRoTWF0Y2gkMy5wYXRoTWF0Y2ggPSBwYXRoTWF0Y2gkMjsKCnZhciB1dGlsSGVscGVyID0ge307Cgpjb25zdCBfX3ZpdGVCcm93c2VyRXh0ZXJuYWwgPSB7fTsKCmNvbnN0IF9fdml0ZUJyb3dzZXJFeHRlcm5hbCQxID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoLyojX19QVVJFX18qL09iamVjdC5kZWZpbmVQcm9wZXJ0eSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBkZWZhdWx0OiBfX3ZpdGVCcm93c2VyRXh0ZXJuYWwKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCByZXF1aXJlJCQwJDEgPSAvKkBfX1BVUkVfXyovZ2V0QXVnbWVudGVkTmFtZXNwYWNlKF9fdml0ZUJyb3dzZXJFeHRlcm5hbCQxKTsKCmZ1bmN0aW9uIHJlcXVpcmVVdGlsJDEoKSB7CiAgdHJ5IHsKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLW1vZHVsZXMKICAgIHJldHVybiByZXF1aXJlJCQwJDE7CiAgfSBjYXRjaCAoZSkgewogICAgcmV0dXJuIG51bGw7CiAgfQp9CgovLyBmb3IgdjEwLjEyLjArCmZ1bmN0aW9uIGxvb2t1cEN1c3RvbUluc3BlY3RTeW1ib2woKSB7CiAgcmV0dXJuIFN5bWJvbC5mb3IoIm5vZGVqcy51dGlsLmluc3BlY3QuY3VzdG9tIik7Cn0KCi8vIGZvciBvbGRlciBub2RlIGVudmlyb25tZW50cwpmdW5jdGlvbiB0cnlSZWFkaW5nQ3VzdG9tU3ltYm9sRnJvbVV0aWxJbnNwZWN0KG9wdGlvbnMpIHsKICBjb25zdCBfcmVxdWlyZVV0aWwgPSBvcHRpb25zLnJlcXVpcmVVdGlsIHx8IHJlcXVpcmVVdGlsJDE7CiAgY29uc3QgdXRpbCA9IF9yZXF1aXJlVXRpbCgpOwogIHJldHVybiB1dGlsID8gdXRpbC5pbnNwZWN0LmN1c3RvbSA6IG51bGw7Cn0KCnV0aWxIZWxwZXIuZ2V0VXRpbEluc3BlY3QgPSBmdW5jdGlvbiBnZXRVdGlsSW5zcGVjdChmYWxsYmFjaywgb3B0aW9ucyA9IHt9KSB7CiAgY29uc3QgX3JlcXVpcmVVdGlsID0gb3B0aW9ucy5yZXF1aXJlVXRpbCB8fCByZXF1aXJlVXRpbCQxOwogIGNvbnN0IHV0aWwgPSBfcmVxdWlyZVV0aWwoKTsKICByZXR1cm4gZnVuY3Rpb24gaW5zcGVjdCh2YWx1ZSwgc2hvd0hpZGRlbiwgZGVwdGgpIHsKICAgIHJldHVybiB1dGlsID8gdXRpbC5pbnNwZWN0KHZhbHVlLCBzaG93SGlkZGVuLCBkZXB0aCkgOiBmYWxsYmFjayh2YWx1ZSk7CiAgfTsKfTsKCnV0aWxIZWxwZXIuZ2V0Q3VzdG9tSW5zcGVjdFN5bWJvbCA9IGZ1bmN0aW9uIGdldEN1c3RvbUluc3BlY3RTeW1ib2wob3B0aW9ucyA9IHt9KSB7CiAgY29uc3QgX2xvb2t1cEN1c3RvbUluc3BlY3RTeW1ib2wgPQogICAgb3B0aW9ucy5sb29rdXBDdXN0b21JbnNwZWN0U3ltYm9sIHx8IGxvb2t1cEN1c3RvbUluc3BlY3RTeW1ib2w7CgogIC8vIGdldCBjdXN0b20gaW5zcGVjdCBzeW1ib2wgZm9yIG5vZGUgZW52aXJvbm1lbnRzCiAgcmV0dXJuICgKICAgIF9sb29rdXBDdXN0b21JbnNwZWN0U3ltYm9sKCkgfHwKICAgIHRyeVJlYWRpbmdDdXN0b21TeW1ib2xGcm9tVXRpbEluc3BlY3Qob3B0aW9ucykKICApOwp9OwoKLyohCiAqIENvcHlyaWdodCAoYykgMjAxNSwgU2FsZXNmb3JjZS5jb20sIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICoKICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0CiAqIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OgogKgogKiAxLiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsCiAqIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuCiAqCiAqIDIuIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwKICogdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9jdW1lbnRhdGlvbgogKiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4KICoKICogMy4gTmVpdGhlciB0aGUgbmFtZSBvZiBTYWxlc2ZvcmNlLmNvbSBub3IgdGhlIG5hbWVzIG9mIGl0cyBjb250cmlidXRvcnMgbWF5CiAqIGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzIGRlcml2ZWQgZnJvbSB0aGlzIHNvZnR3YXJlIHdpdGhvdXQKICogc3BlY2lmaWMgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uLgogKgogKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIKICogQU5EIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRQogKiBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRQogKiBBUkUgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIENPUFlSSUdIVCBIT0xERVIgT1IgQ09OVFJJQlVUT1JTIEJFCiAqIExJQUJMRSBGT1IgQU5ZIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IKICogQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YKICogU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTCiAqIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOCiAqIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpCiAqIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFCiAqIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgogKi8KY29uc3QgeyBmcm9tQ2FsbGJhY2s6IGZyb21DYWxsYmFjayQxIH0gPSB1bml2ZXJzYWxpZnk7CmNvbnN0IFN0b3JlJDEgPSBzdG9yZS5TdG9yZTsKY29uc3QgcGVybXV0ZURvbWFpbiQxID0gcGVybXV0ZURvbWFpbiQzLnBlcm11dGVEb21haW47CmNvbnN0IHBhdGhNYXRjaCQxID0gcGF0aE1hdGNoJDMucGF0aE1hdGNoOwpjb25zdCB7IGdldEN1c3RvbUluc3BlY3RTeW1ib2w6IGdldEN1c3RvbUluc3BlY3RTeW1ib2wkMSwgZ2V0VXRpbEluc3BlY3QgfSA9IHV0aWxIZWxwZXI7CgpsZXQgTWVtb3J5Q29va2llU3RvcmUkMSA9IGNsYXNzIE1lbW9yeUNvb2tpZVN0b3JlIGV4dGVuZHMgU3RvcmUkMSB7CiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5zeW5jaHJvbm91cyA9IHRydWU7CiAgICB0aGlzLmlkeCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBjb25zdCBjdXN0b21JbnNwZWN0U3ltYm9sID0gZ2V0Q3VzdG9tSW5zcGVjdFN5bWJvbCQxKCk7CiAgICBpZiAoY3VzdG9tSW5zcGVjdFN5bWJvbCkgewogICAgICB0aGlzW2N1c3RvbUluc3BlY3RTeW1ib2xdID0gdGhpcy5pbnNwZWN0OwogICAgfQogIH0KCiAgaW5zcGVjdCgpIHsKICAgIGNvbnN0IHV0aWwgPSB7IGluc3BlY3Q6IGdldFV0aWxJbnNwZWN0KGluc3BlY3RGYWxsYmFjaykgfTsKICAgIHJldHVybiBgeyBpZHg6ICR7dXRpbC5pbnNwZWN0KHRoaXMuaWR4LCBmYWxzZSwgMil9IH1gOwogIH0KCiAgZmluZENvb2tpZShkb21haW4sIHBhdGgsIGtleSwgY2IpIHsKICAgIGlmICghdGhpcy5pZHhbZG9tYWluXSkgewogICAgICByZXR1cm4gY2IobnVsbCwgdW5kZWZpbmVkKTsKICAgIH0KICAgIGlmICghdGhpcy5pZHhbZG9tYWluXVtwYXRoXSkgewogICAgICByZXR1cm4gY2IobnVsbCwgdW5kZWZpbmVkKTsKICAgIH0KICAgIHJldHVybiBjYihudWxsLCB0aGlzLmlkeFtkb21haW5dW3BhdGhdW2tleV0gfHwgbnVsbCk7CiAgfQogIGZpbmRDb29raWVzKGRvbWFpbiwgcGF0aCwgYWxsb3dTcGVjaWFsVXNlRG9tYWluLCBjYikgewogICAgY29uc3QgcmVzdWx0cyA9IFtdOwogICAgaWYgKHR5cGVvZiBhbGxvd1NwZWNpYWxVc2VEb21haW4gPT09ICJmdW5jdGlvbiIpIHsKICAgICAgY2IgPSBhbGxvd1NwZWNpYWxVc2VEb21haW47CiAgICAgIGFsbG93U3BlY2lhbFVzZURvbWFpbiA9IHRydWU7CiAgICB9CiAgICBpZiAoIWRvbWFpbikgewogICAgICByZXR1cm4gY2IobnVsbCwgW10pOwogICAgfQoKICAgIGxldCBwYXRoTWF0Y2hlcjsKICAgIGlmICghcGF0aCkgewogICAgICAvLyBudWxsIG1lYW5zICJhbGwgcGF0aHMiCiAgICAgIHBhdGhNYXRjaGVyID0gZnVuY3Rpb24gbWF0Y2hBbGwoZG9tYWluSW5kZXgpIHsKICAgICAgICBmb3IgKGNvbnN0IGN1clBhdGggaW4gZG9tYWluSW5kZXgpIHsKICAgICAgICAgIGNvbnN0IHBhdGhJbmRleCA9IGRvbWFpbkluZGV4W2N1clBhdGhdOwogICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gcGF0aEluZGV4KSB7CiAgICAgICAgICAgIHJlc3VsdHMucHVzaChwYXRoSW5kZXhba2V5XSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgcGF0aE1hdGNoZXIgPSBmdW5jdGlvbiBtYXRjaFJGQyhkb21haW5JbmRleCkgewogICAgICAgIC8vTk9URTogd2Ugc2hvdWxkIHVzZSBwYXRoLW1hdGNoIGFsZ29yaXRobSBmcm9tIFM1LjEuNCBoZXJlCiAgICAgICAgLy8oc2VlIDogaHR0cHM6Ly9naXRodWIuY29tL0Nocm9taXVtV2ViQXBwcy9jaHJvbWl1bS9ibG9iL2IzZDNiNGRhOGJiOTRjMWIyZTA2MTYwMGRmMTA2ZDU5MGZkYTM2MjAvbmV0L2Nvb2tpZXMvY2Fub25pY2FsX2Nvb2tpZS5jYyNMMjk5KQogICAgICAgIE9iamVjdC5rZXlzKGRvbWFpbkluZGV4KS5mb3JFYWNoKGNvb2tpZVBhdGggPT4gewogICAgICAgICAgaWYgKHBhdGhNYXRjaCQxKHBhdGgsIGNvb2tpZVBhdGgpKSB7CiAgICAgICAgICAgIGNvbnN0IHBhdGhJbmRleCA9IGRvbWFpbkluZGV4W2Nvb2tpZVBhdGhdOwogICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBwYXRoSW5kZXgpIHsKICAgICAgICAgICAgICByZXN1bHRzLnB1c2gocGF0aEluZGV4W2tleV0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH07CiAgICB9CgogICAgY29uc3QgZG9tYWlucyA9IHBlcm11dGVEb21haW4kMShkb21haW4sIGFsbG93U3BlY2lhbFVzZURvbWFpbikgfHwgW2RvbWFpbl07CiAgICBjb25zdCBpZHggPSB0aGlzLmlkeDsKICAgIGRvbWFpbnMuZm9yRWFjaChjdXJEb21haW4gPT4gewogICAgICBjb25zdCBkb21haW5JbmRleCA9IGlkeFtjdXJEb21haW5dOwogICAgICBpZiAoIWRvbWFpbkluZGV4KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHBhdGhNYXRjaGVyKGRvbWFpbkluZGV4KTsKICAgIH0pOwoKICAgIGNiKG51bGwsIHJlc3VsdHMpOwogIH0KCiAgcHV0Q29va2llKGNvb2tpZSwgY2IpIHsKICAgIGlmICghdGhpcy5pZHhbY29va2llLmRvbWFpbl0pIHsKICAgICAgdGhpcy5pZHhbY29va2llLmRvbWFpbl0gPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgfQogICAgaWYgKCF0aGlzLmlkeFtjb29raWUuZG9tYWluXVtjb29raWUucGF0aF0pIHsKICAgICAgdGhpcy5pZHhbY29va2llLmRvbWFpbl1bY29va2llLnBhdGhdID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIH0KICAgIHRoaXMuaWR4W2Nvb2tpZS5kb21haW5dW2Nvb2tpZS5wYXRoXVtjb29raWUua2V5XSA9IGNvb2tpZTsKICAgIGNiKG51bGwpOwogIH0KICB1cGRhdGVDb29raWUob2xkQ29va2llLCBuZXdDb29raWUsIGNiKSB7CiAgICAvLyB1cGRhdGVDb29raWUoKSBtYXkgYXZvaWQgdXBkYXRpbmcgY29va2llcyB0aGF0IGFyZSBpZGVudGljYWwuICBGb3IgZXhhbXBsZSwKICAgIC8vIGxhc3RBY2Nlc3NlZCBtYXkgbm90IGJlIGltcG9ydGFudCB0byBzb21lIHN0b3JlcyBhbmQgYW4gZXF1YWxpdHkKICAgIC8vIGNvbXBhcmlzb24gY291bGQgZXhjbHVkZSB0aGF0IGZpZWxkLgogICAgdGhpcy5wdXRDb29raWUobmV3Q29va2llLCBjYik7CiAgfQogIHJlbW92ZUNvb2tpZShkb21haW4sIHBhdGgsIGtleSwgY2IpIHsKICAgIGlmICgKICAgICAgdGhpcy5pZHhbZG9tYWluXSAmJgogICAgICB0aGlzLmlkeFtkb21haW5dW3BhdGhdICYmCiAgICAgIHRoaXMuaWR4W2RvbWFpbl1bcGF0aF1ba2V5XQogICAgKSB7CiAgICAgIGRlbGV0ZSB0aGlzLmlkeFtkb21haW5dW3BhdGhdW2tleV07CiAgICB9CiAgICBjYihudWxsKTsKICB9CiAgcmVtb3ZlQ29va2llcyhkb21haW4sIHBhdGgsIGNiKSB7CiAgICBpZiAodGhpcy5pZHhbZG9tYWluXSkgewogICAgICBpZiAocGF0aCkgewogICAgICAgIGRlbGV0ZSB0aGlzLmlkeFtkb21haW5dW3BhdGhdOwogICAgICB9IGVsc2UgewogICAgICAgIGRlbGV0ZSB0aGlzLmlkeFtkb21haW5dOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gY2IobnVsbCk7CiAgfQogIHJlbW92ZUFsbENvb2tpZXMoY2IpIHsKICAgIHRoaXMuaWR4ID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIHJldHVybiBjYihudWxsKTsKICB9CiAgZ2V0QWxsQ29va2llcyhjYikgewogICAgY29uc3QgY29va2llcyA9IFtdOwogICAgY29uc3QgaWR4ID0gdGhpcy5pZHg7CgogICAgY29uc3QgZG9tYWlucyA9IE9iamVjdC5rZXlzKGlkeCk7CiAgICBkb21haW5zLmZvckVhY2goZG9tYWluID0+IHsKICAgICAgY29uc3QgcGF0aHMgPSBPYmplY3Qua2V5cyhpZHhbZG9tYWluXSk7CiAgICAgIHBhdGhzLmZvckVhY2gocGF0aCA9PiB7CiAgICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGlkeFtkb21haW5dW3BhdGhdKTsKICAgICAgICBrZXlzLmZvckVhY2goa2V5ID0+IHsKICAgICAgICAgIGlmIChrZXkgIT09IG51bGwpIHsKICAgICAgICAgICAgY29va2llcy5wdXNoKGlkeFtkb21haW5dW3BhdGhdW2tleV0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0pOwoKICAgIC8vIFNvcnQgYnkgY3JlYXRpb25JbmRleCBzbyBkZXNlcmlhbGl6aW5nIHJldGFpbnMgdGhlIGNyZWF0aW9uIG9yZGVyLgogICAgLy8gV2hlbiBpbXBsZW1lbnRpbmcgeW91ciBvd24gc3RvcmUsIHRoaXMgU0hPVUxEIHJldGFpbiB0aGUgb3JkZXIgdG9vCiAgICBjb29raWVzLnNvcnQoKGEsIGIpID0+IHsKICAgICAgcmV0dXJuIChhLmNyZWF0aW9uSW5kZXggfHwgMCkgLSAoYi5jcmVhdGlvbkluZGV4IHx8IDApOwogICAgfSk7CgogICAgY2IobnVsbCwgY29va2llcyk7CiAgfQp9OwoKWwogICJmaW5kQ29va2llIiwKICAiZmluZENvb2tpZXMiLAogICJwdXRDb29raWUiLAogICJ1cGRhdGVDb29raWUiLAogICJyZW1vdmVDb29raWUiLAogICJyZW1vdmVDb29raWVzIiwKICAicmVtb3ZlQWxsQ29va2llcyIsCiAgImdldEFsbENvb2tpZXMiCl0uZm9yRWFjaChuYW1lID0+IHsKICBNZW1vcnlDb29raWVTdG9yZSQxLnByb3RvdHlwZVtuYW1lXSA9IGZyb21DYWxsYmFjayQxKAogICAgTWVtb3J5Q29va2llU3RvcmUkMS5wcm90b3R5cGVbbmFtZV0KICApOwp9KTsKCm1lbXN0b3JlLk1lbW9yeUNvb2tpZVN0b3JlID0gTWVtb3J5Q29va2llU3RvcmUkMTsKCmZ1bmN0aW9uIGluc3BlY3RGYWxsYmFjayh2YWwpIHsKICBjb25zdCBkb21haW5zID0gT2JqZWN0LmtleXModmFsKTsKICBpZiAoZG9tYWlucy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiAiW09iamVjdDogbnVsbCBwcm90b3R5cGVdIHt9IjsKICB9CiAgbGV0IHJlc3VsdCA9ICJbT2JqZWN0OiBudWxsIHByb3RvdHlwZV0ge1xuIjsKICBPYmplY3Qua2V5cyh2YWwpLmZvckVhY2goKGRvbWFpbiwgaSkgPT4gewogICAgcmVzdWx0ICs9IGZvcm1hdERvbWFpbihkb21haW4sIHZhbFtkb21haW5dKTsKICAgIGlmIChpIDwgZG9tYWlucy5sZW5ndGggLSAxKSB7CiAgICAgIHJlc3VsdCArPSAiLCI7CiAgICB9CiAgICByZXN1bHQgKz0gIlxuIjsKICB9KTsKICByZXN1bHQgKz0gIn0iOwogIHJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIGZvcm1hdERvbWFpbihkb21haW5OYW1lLCBkb21haW5WYWx1ZSkgewogIGNvbnN0IGluZGVudCA9ICIgICI7CiAgbGV0IHJlc3VsdCA9IGAke2luZGVudH0nJHtkb21haW5OYW1lfSc6IFtPYmplY3Q6IG51bGwgcHJvdG90eXBlXSB7XG5gOwogIE9iamVjdC5rZXlzKGRvbWFpblZhbHVlKS5mb3JFYWNoKChwYXRoLCBpLCBwYXRocykgPT4gewogICAgcmVzdWx0ICs9IGZvcm1hdFBhdGgocGF0aCwgZG9tYWluVmFsdWVbcGF0aF0pOwogICAgaWYgKGkgPCBwYXRocy5sZW5ndGggLSAxKSB7CiAgICAgIHJlc3VsdCArPSAiLCI7CiAgICB9CiAgICByZXN1bHQgKz0gIlxuIjsKICB9KTsKICByZXN1bHQgKz0gYCR7aW5kZW50fX1gOwogIHJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIGZvcm1hdFBhdGgocGF0aE5hbWUsIHBhdGhWYWx1ZSkgewogIGNvbnN0IGluZGVudCA9ICIgICAgIjsKICBsZXQgcmVzdWx0ID0gYCR7aW5kZW50fScke3BhdGhOYW1lfSc6IFtPYmplY3Q6IG51bGwgcHJvdG90eXBlXSB7XG5gOwogIE9iamVjdC5rZXlzKHBhdGhWYWx1ZSkuZm9yRWFjaCgoY29va2llTmFtZSwgaSwgY29va2llTmFtZXMpID0+IHsKICAgIGNvbnN0IGNvb2tpZSA9IHBhdGhWYWx1ZVtjb29raWVOYW1lXTsKICAgIHJlc3VsdCArPSBgICAgICAgJHtjb29raWVOYW1lfTogJHtjb29raWUuaW5zcGVjdCgpfWA7CiAgICBpZiAoaSA8IGNvb2tpZU5hbWVzLmxlbmd0aCAtIDEpIHsKICAgICAgcmVzdWx0ICs9ICIsIjsKICAgIH0KICAgIHJlc3VsdCArPSAiXG4iOwogIH0pOwogIHJlc3VsdCArPSBgJHtpbmRlbnR9fWA7CiAgcmV0dXJuIHJlc3VsdDsKfQoKbWVtc3RvcmUuaW5zcGVjdEZhbGxiYWNrID0gaW5zcGVjdEZhbGxiYWNrOwoKdmFyIHZhbGlkYXRvcnMkMSA9IHt9OwoKLyogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCkV4dHJhY3RlZCBmcm9tIGNoZWNrLXR5cGVzLmpzCmh0dHBzOi8vZ2l0bGFiLmNvbS9waGlsYm9vdGgvY2hlY2stdHlwZXMuanMKCk1JVCBMaWNlbnNlCgpDb3B5cmlnaHQgKGMpIDIwMTIsIDIwMTMsIDIwMTQsIDIwMTUsIDIwMTYsIDIwMTcsIDIwMTgsIDIwMTkgUGhpbCBCb290aAoKUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQpvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAppbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgpUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwKY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLApGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgpMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLApPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRQpTT0ZUV0FSRS4KCioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLwoKLyogVmFsaWRhdGlvbiBmdW5jdGlvbnMgY29waWVkIGZyb20gY2hlY2stdHlwZXMgcGFja2FnZSAtIGh0dHBzOi8vd3d3Lm5wbWpzLmNvbS9wYWNrYWdlL2NoZWNrLXR5cGVzICovCmZ1bmN0aW9uIGlzRnVuY3Rpb24oZGF0YSkgewogIHJldHVybiB0eXBlb2YgZGF0YSA9PT0gImZ1bmN0aW9uIjsKfQoKZnVuY3Rpb24gaXNOb25FbXB0eVN0cmluZyhkYXRhKSB7CiAgcmV0dXJuIGlzU3RyaW5nKGRhdGEpICYmIGRhdGEgIT09ICIiOwp9CgpmdW5jdGlvbiBpc0RhdGUoZGF0YSkgewogIHJldHVybiBpc0luc3RhbmNlU3RyaWN0KGRhdGEsIERhdGUpICYmIGlzSW50ZWdlcihkYXRhLmdldFRpbWUoKSk7Cn0KCmZ1bmN0aW9uIGlzRW1wdHlTdHJpbmcoZGF0YSkgewogIHJldHVybiBkYXRhID09PSAiIiB8fCAoZGF0YSBpbnN0YW5jZW9mIFN0cmluZyAmJiBkYXRhLnRvU3RyaW5nKCkgPT09ICIiKTsKfQoKZnVuY3Rpb24gaXNTdHJpbmcoZGF0YSkgewogIHJldHVybiB0eXBlb2YgZGF0YSA9PT0gInN0cmluZyIgfHwgZGF0YSBpbnN0YW5jZW9mIFN0cmluZzsKfQoKZnVuY3Rpb24gaXNPYmplY3QoZGF0YSkgewogIHJldHVybiB0b1N0cmluZy5jYWxsKGRhdGEpID09PSAiW29iamVjdCBPYmplY3RdIjsKfQpmdW5jdGlvbiBpc0luc3RhbmNlU3RyaWN0KGRhdGEsIHByb3RvdHlwZSkgewogIHRyeSB7CiAgICByZXR1cm4gZGF0YSBpbnN0YW5jZW9mIHByb3RvdHlwZTsKICB9IGNhdGNoIChlcnJvcikgewogICAgcmV0dXJuIGZhbHNlOwogIH0KfQoKZnVuY3Rpb24gaXNJbnRlZ2VyKGRhdGEpIHsKICByZXR1cm4gdHlwZW9mIGRhdGEgPT09ICJudW1iZXIiICYmIGRhdGEgJSAxID09PSAwOwp9Ci8qIEVuZCB2YWxpZGF0aW9uIGZ1bmN0aW9ucyAqLwoKZnVuY3Rpb24gdmFsaWRhdGUkMShib29sLCBjYiwgb3B0aW9ucykgewogIGlmICghaXNGdW5jdGlvbihjYikpIHsKICAgIG9wdGlvbnMgPSBjYjsKICAgIGNiID0gbnVsbDsKICB9CiAgaWYgKCFpc09iamVjdChvcHRpb25zKSkgb3B0aW9ucyA9IHsgRXJyb3I6ICJGYWlsZWQgQ2hlY2siIH07CiAgaWYgKCFib29sKSB7CiAgICBpZiAoY2IpIHsKICAgICAgY2IobmV3IFBhcmFtZXRlckVycm9yKG9wdGlvbnMpKTsKICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBQYXJhbWV0ZXJFcnJvcihvcHRpb25zKTsKICAgIH0KICB9Cn0KCmNsYXNzIFBhcmFtZXRlckVycm9yIGV4dGVuZHMgRXJyb3IgewogIGNvbnN0cnVjdG9yKC4uLnBhcmFtcykgewogICAgc3VwZXIoLi4ucGFyYW1zKTsKICB9Cn0KCnZhbGlkYXRvcnMkMS5QYXJhbWV0ZXJFcnJvciA9IFBhcmFtZXRlckVycm9yOwp2YWxpZGF0b3JzJDEuaXNGdW5jdGlvbiA9IGlzRnVuY3Rpb247CnZhbGlkYXRvcnMkMS5pc05vbkVtcHR5U3RyaW5nID0gaXNOb25FbXB0eVN0cmluZzsKdmFsaWRhdG9ycyQxLmlzRGF0ZSA9IGlzRGF0ZTsKdmFsaWRhdG9ycyQxLmlzRW1wdHlTdHJpbmcgPSBpc0VtcHR5U3RyaW5nOwp2YWxpZGF0b3JzJDEuaXNTdHJpbmcgPSBpc1N0cmluZzsKdmFsaWRhdG9ycyQxLmlzT2JqZWN0ID0gaXNPYmplY3Q7CnZhbGlkYXRvcnMkMS52YWxpZGF0ZSA9IHZhbGlkYXRlJDE7CgovLyBnZW5lcmF0ZWQgYnkgZ2VudmVyc2lvbgp2YXIgdmVyc2lvbiQyID0gJzQuMS4zJzsKCi8qIQogKiBDb3B5cmlnaHQgKGMpIDIwMTUtMjAyMCwgU2FsZXNmb3JjZS5jb20sIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICoKICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0CiAqIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OgogKgogKiAxLiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsCiAqIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuCiAqCiAqIDIuIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwKICogdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9jdW1lbnRhdGlvbgogKiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4KICoKICogMy4gTmVpdGhlciB0aGUgbmFtZSBvZiBTYWxlc2ZvcmNlLmNvbSBub3IgdGhlIG5hbWVzIG9mIGl0cyBjb250cmlidXRvcnMgbWF5CiAqIGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzIGRlcml2ZWQgZnJvbSB0aGlzIHNvZnR3YXJlIHdpdGhvdXQKICogc3BlY2lmaWMgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uLgogKgogKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIKICogQU5EIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRQogKiBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRQogKiBBUkUgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIENPUFlSSUdIVCBIT0xERVIgT1IgQ09OVFJJQlVUT1JTIEJFCiAqIExJQUJMRSBGT1IgQU5ZIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IKICogQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YKICogU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTCiAqIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOCiAqIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpCiAqIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFCiAqIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgogKi8KY29uc3QgcHVueWNvZGUgPSByZXF1aXJlJCQwJDI7CmNvbnN0IHVybFBhcnNlID0gdXJsUGFyc2UkMTsKY29uc3QgcHVic3VmZml4ID0gcHVic3VmZml4UHNsOwpjb25zdCBTdG9yZSA9IHN0b3JlLlN0b3JlOwpjb25zdCBNZW1vcnlDb29raWVTdG9yZSA9IG1lbXN0b3JlLk1lbW9yeUNvb2tpZVN0b3JlOwpjb25zdCBwYXRoTWF0Y2ggPSBwYXRoTWF0Y2gkMy5wYXRoTWF0Y2g7CmNvbnN0IHZhbGlkYXRvcnMgPSB2YWxpZGF0b3JzJDE7CmNvbnN0IFZFUlNJT04gPSB2ZXJzaW9uJDI7CmNvbnN0IHsgZnJvbUNhbGxiYWNrIH0gPSB1bml2ZXJzYWxpZnk7CmNvbnN0IHsgZ2V0Q3VzdG9tSW5zcGVjdFN5bWJvbCB9ID0gdXRpbEhlbHBlcjsKCi8vIEZyb20gUkZDNjI2NSBTNC4xLjEKLy8gbm90ZSB0aGF0IGl0IGV4Y2x1ZGVzIFx4M0IgIjsiCmNvbnN0IENPT0tJRV9PQ1RFVFMgPSAvXltceDIxXHgyMy1ceDJCXHgyRC1ceDNBXHgzQy1ceDVCXHg1RC1ceDdFXSskLzsKCmNvbnN0IENPTlRST0xfQ0hBUlMgPSAvW1x4MDAtXHgxRl0vOwoKLy8gRnJvbSBDaHJvbWl1bSAvLyAnXHInLCAnXG4nIGFuZCAnXDAnIHNob3VsZCBiZSB0cmVhdGVkIGFzIGEgdGVybWluYXRvciBpbgovLyB0aGUgInJlbGF4ZWQiIG1vZGUsIHNlZToKLy8gaHR0cHM6Ly9naXRodWIuY29tL0Nocm9taXVtV2ViQXBwcy9jaHJvbWl1bS9ibG9iL2IzZDNiNGRhOGJiOTRjMWIyZTA2MTYwMGRmMTA2ZDU5MGZkYTM2MjAvbmV0L2Nvb2tpZXMvcGFyc2VkX2Nvb2tpZS5jYyNMNjAKY29uc3QgVEVSTUlOQVRPUlMgPSBbIlxuIiwgIlxyIiwgIlwwIl07CgovLyBSRkM2MjY1IFM0LjEuMSBkZWZpbmVzIHBhdGggdmFsdWUgYXMgJ2FueSBDSEFSIGV4Y2VwdCBDVExzIG9yICI7IicKLy8gTm90ZSAnOycgaXMgXHgzQgpjb25zdCBQQVRIX1ZBTFVFID0gL1tceDIwLVx4M0FceDNDLVx4N0VdKy87CgovLyBkYXRlLXRpbWUgcGFyc2luZyBjb25zdGFudHMgKFJGQzYyNjUgUzUuMS4xKQoKY29uc3QgREFURV9ERUxJTSA9IC9bXHgwOVx4MjAtXHgyRlx4M0ItXHg0MFx4NUItXHg2MFx4N0ItXHg3RV0vOwoKY29uc3QgTU9OVEhfVE9fTlVNID0gewogIGphbjogMCwKICBmZWI6IDEsCiAgbWFyOiAyLAogIGFwcjogMywKICBtYXk6IDQsCiAganVuOiA1LAogIGp1bDogNiwKICBhdWc6IDcsCiAgc2VwOiA4LAogIG9jdDogOSwKICBub3Y6IDEwLAogIGRlYzogMTEKfTsKCmNvbnN0IE1BWF9USU1FID0gMjE0NzQ4MzY0NzAwMDsgLy8gMzEtYml0IG1heApjb25zdCBNSU5fVElNRSA9IDA7IC8vIDMxLWJpdCBtaW4KY29uc3QgU0FNRV9TSVRFX0NPTlRFWFRfVkFMX0VSUiA9CiAgJ0ludmFsaWQgc2FtZVNpdGVDb250ZXh0IG9wdGlvbiBmb3IgZ2V0Q29va2llcygpOyBleHBlY3RlZCBvbmUgb2YgInN0cmljdCIsICJsYXgiLCBvciAibm9uZSInOwoKZnVuY3Rpb24gY2hlY2tTYW1lU2l0ZUNvbnRleHQodmFsdWUpIHsKICB2YWxpZGF0b3JzLnZhbGlkYXRlKHZhbGlkYXRvcnMuaXNOb25FbXB0eVN0cmluZyh2YWx1ZSksIHZhbHVlKTsKICBjb25zdCBjb250ZXh0ID0gU3RyaW5nKHZhbHVlKS50b0xvd2VyQ2FzZSgpOwogIGlmIChjb250ZXh0ID09PSAibm9uZSIgfHwgY29udGV4dCA9PT0gImxheCIgfHwgY29udGV4dCA9PT0gInN0cmljdCIpIHsKICAgIHJldHVybiBjb250ZXh0OwogIH0gZWxzZSB7CiAgICByZXR1cm4gbnVsbDsKICB9Cn0KCmNvbnN0IFByZWZpeFNlY3VyaXR5RW51bSA9IE9iamVjdC5mcmVlemUoewogIFNJTEVOVDogInNpbGVudCIsCiAgU1RSSUNUOiAic3RyaWN0IiwKICBESVNBQkxFRDogInVuc2FmZS1kaXNhYmxlZCIKfSk7CgovLyBEdW1wZWQgZnJvbSBpcC1yZWdleEA0LjAuMCwgd2l0aCB0aGUgZm9sbG93aW5nIGNoYW5nZXM6Ci8vICogYWxsIGNhcHR1cmluZyBncm91cHMgY29udmVydGVkIHRvIG5vbi1jYXB0dXJpbmcgLS0gIig/OikiCi8vICogc3VwcG9ydCBmb3IgSVB2NiBTY29wZWQgTGl0ZXJhbCAoIiVldGgxIikgcmVtb3ZlZAovLyAqIGxvd2VyY2FzZSBoZXhhZGVjaW1hbCBvbmx5CmNvbnN0IElQX1JFR0VYX0xPV0VSQ0FTRSA9IC8oPzpeKD86MjVbMC01XXwyWzAtNF1cZHwxXGRcZHxbMS05XVxkfFxkKSg/OlwuKD86MjVbMC01XXwyWzAtNF1cZHwxXGRcZHxbMS05XVxkfFxkKSl7M30kKXwoPzpeKD86KD86W2EtZlxkXXsxLDR9Oil7N30oPzpbYS1mXGRdezEsNH18Oil8KD86W2EtZlxkXXsxLDR9Oil7Nn0oPzooPzoyNVswLTVdfDJbMC00XVxkfDFcZFxkfFsxLTldXGR8XGQpKD86XC4oPzoyNVswLTVdfDJbMC00XVxkfDFcZFxkfFsxLTldXGR8XGQpKXszfXw6W2EtZlxkXXsxLDR9fDopfCg/OlthLWZcZF17MSw0fTopezV9KD86Oig/OjI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV1cZHxcZCkoPzpcLig/OjI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV1cZHxcZCkpezN9fCg/OjpbYS1mXGRdezEsNH0pezEsMn18Oil8KD86W2EtZlxkXXsxLDR9Oil7NH0oPzooPzo6W2EtZlxkXXsxLDR9KXswLDF9Oig/OjI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV1cZHxcZCkoPzpcLig/OjI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV1cZHxcZCkpezN9fCg/OjpbYS1mXGRdezEsNH0pezEsM318Oil8KD86W2EtZlxkXXsxLDR9Oil7M30oPzooPzo6W2EtZlxkXXsxLDR9KXswLDJ9Oig/OjI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV1cZHxcZCkoPzpcLig/OjI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV1cZHxcZCkpezN9fCg/OjpbYS1mXGRdezEsNH0pezEsNH18Oil8KD86W2EtZlxkXXsxLDR9Oil7Mn0oPzooPzo6W2EtZlxkXXsxLDR9KXswLDN9Oig/OjI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV1cZHxcZCkoPzpcLig/OjI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV1cZHxcZCkpezN9fCg/OjpbYS1mXGRdezEsNH0pezEsNX18Oil8KD86W2EtZlxkXXsxLDR9Oil7MX0oPzooPzo6W2EtZlxkXXsxLDR9KXswLDR9Oig/OjI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV1cZHxcZCkoPzpcLig/OjI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV1cZHxcZCkpezN9fCg/OjpbYS1mXGRdezEsNH0pezEsNn18Oil8KD86Oig/Oig/OjpbYS1mXGRdezEsNH0pezAsNX06KD86MjVbMC01XXwyWzAtNF1cZHwxXGRcZHxbMS05XVxkfFxkKSg/OlwuKD86MjVbMC01XXwyWzAtNF1cZHwxXGRcZHxbMS05XVxkfFxkKSl7M318KD86OlthLWZcZF17MSw0fSl7MSw3fXw6KSkpJCkvOwpjb25zdCBJUF9WNl9SRUdFWCA9IGAKXFxbPyg/OgooPzpbYS1mQS1GXFxkXXsxLDR9Oil7N30oPzpbYS1mQS1GXFxkXXsxLDR9fDopfAooPzpbYS1mQS1GXFxkXXsxLDR9Oil7Nn0oPzooPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldXFxkfFxcZCkoPzpcXC4oPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldXFxkfFxcZCkpezN9fDpbYS1mQS1GXFxkXXsxLDR9fDopfAooPzpbYS1mQS1GXFxkXXsxLDR9Oil7NX0oPzo6KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XVxcZHxcXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XVxcZHxcXGQpKXszfXwoPzo6W2EtZkEtRlxcZF17MSw0fSl7MSwyfXw6KXwKKD86W2EtZkEtRlxcZF17MSw0fTopezR9KD86KD86OlthLWZBLUZcXGRdezEsNH0pezAsMX06KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XVxcZHxcXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XVxcZHxcXGQpKXszfXwoPzo6W2EtZkEtRlxcZF17MSw0fSl7MSwzfXw6KXwKKD86W2EtZkEtRlxcZF17MSw0fTopezN9KD86KD86OlthLWZBLUZcXGRdezEsNH0pezAsMn06KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XVxcZHxcXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XVxcZHxcXGQpKXszfXwoPzo6W2EtZkEtRlxcZF17MSw0fSl7MSw0fXw6KXwKKD86W2EtZkEtRlxcZF17MSw0fTopezJ9KD86KD86OlthLWZBLUZcXGRdezEsNH0pezAsM306KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XVxcZHxcXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XVxcZHxcXGQpKXszfXwoPzo6W2EtZkEtRlxcZF17MSw0fSl7MSw1fXw6KXwKKD86W2EtZkEtRlxcZF17MSw0fTopezF9KD86KD86OlthLWZBLUZcXGRdezEsNH0pezAsNH06KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XVxcZHxcXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XVxcZHxcXGQpKXszfXwoPzo6W2EtZkEtRlxcZF17MSw0fSl7MSw2fXw6KXwKKD86Oig/Oig/OjpbYS1mQS1GXFxkXXsxLDR9KXswLDV9Oig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV1cXGR8XFxkKSg/OlxcLig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV1cXGR8XFxkKSl7M318KD86OlthLWZBLUZcXGRdezEsNH0pezEsN318OikpCikoPzolWzAtOWEtekEtWl17MSx9KT9cXF0/CmAKICAucmVwbGFjZSgvXHMqXC9cLy4qJC9nbSwgIiIpCiAgLnJlcGxhY2UoL1xuL2csICIiKQogIC50cmltKCk7CmNvbnN0IElQX1Y2X1JFR0VYX09CSkVDVCA9IG5ldyBSZWdFeHAoYF4ke0lQX1Y2X1JFR0VYfSRgKTsKCi8qCiAqIFBhcnNlcyBhIE5hdHVyYWwgbnVtYmVyIChpLmUuLCBub24tbmVnYXRpdmUgaW50ZWdlcikgd2l0aCBlaXRoZXIgdGhlCiAqICAgIDxtaW4+KjxtYXg+RElHSVQgKCBub24tZGlnaXQgKk9DVEVUICkKICogb3IKICogICAgPG1pbj4qPG1heD5ESUdJVAogKiBncmFtbWFyIChSRkM2MjY1IFM1LjEuMSkuCiAqCiAqIFRoZSAidHJhaWxpbmdPSyIgYm9vbGVhbiBjb250cm9scyBpZiB0aGUgZ3JhbW1hciBhY2NlcHRzIGEKICogIiggbm9uLWRpZ2l0ICpPQ1RFVCApIiB0cmFpbGVyLgogKi8KZnVuY3Rpb24gcGFyc2VEaWdpdHModG9rZW4sIG1pbkRpZ2l0cywgbWF4RGlnaXRzLCB0cmFpbGluZ09LKSB7CiAgbGV0IGNvdW50ID0gMDsKICB3aGlsZSAoY291bnQgPCB0b2tlbi5sZW5ndGgpIHsKICAgIGNvbnN0IGMgPSB0b2tlbi5jaGFyQ29kZUF0KGNvdW50KTsKICAgIC8vICJub24tZGlnaXQgPSAleDAwLTJGIC8gJXgzQS1GRiIKICAgIGlmIChjIDw9IDB4MmYgfHwgYyA+PSAweDNhKSB7CiAgICAgIGJyZWFrOwogICAgfQogICAgY291bnQrKzsKICB9CgogIC8vIGNvbnN0cmFpbiB0byBhIG1pbmltdW0gYW5kIG1heGltdW0gbnVtYmVyIG9mIGRpZ2l0cy4KICBpZiAoY291bnQgPCBtaW5EaWdpdHMgfHwgY291bnQgPiBtYXhEaWdpdHMpIHsKICAgIHJldHVybiBudWxsOwogIH0KCiAgaWYgKCF0cmFpbGluZ09LICYmIGNvdW50ICE9IHRva2VuLmxlbmd0aCkgewogICAgcmV0dXJuIG51bGw7CiAgfQoKICByZXR1cm4gcGFyc2VJbnQodG9rZW4uc3Vic3RyKDAsIGNvdW50KSwgMTApOwp9CgpmdW5jdGlvbiBwYXJzZVRpbWUodG9rZW4pIHsKICBjb25zdCBwYXJ0cyA9IHRva2VuLnNwbGl0KCI6Iik7CiAgY29uc3QgcmVzdWx0ID0gWzAsIDAsIDBdOwoKICAvKiBSRjYyNTYgUzUuMS4xOgogICAqICAgICAgdGltZSAgICAgICAgICAgID0gaG1zLXRpbWUgKCBub24tZGlnaXQgKk9DVEVUICkKICAgKiAgICAgIGhtcy10aW1lICAgICAgICA9IHRpbWUtZmllbGQgIjoiIHRpbWUtZmllbGQgIjoiIHRpbWUtZmllbGQKICAgKiAgICAgIHRpbWUtZmllbGQgICAgICA9IDEqMkRJR0lUCiAgICovCgogIGlmIChwYXJ0cy5sZW5ndGggIT09IDMpIHsKICAgIHJldHVybiBudWxsOwogIH0KCiAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHsKICAgIC8vICJ0aW1lLWZpZWxkIiBtdXN0IGJlIHN0cmljdGx5ICIxKjJESUdJVCIsIEhPV0VWRVIsICJobXMtdGltZSIgY2FuIGJlCiAgICAvLyBmb2xsb3dlZCBieSAiKCBub24tZGlnaXQgKk9DVEVUICkiIHNvIHRoZXJlZm9yZSB0aGUgbGFzdCB0aW1lLWZpZWxkIGNhbgogICAgLy8gaGF2ZSBhIHRyYWlsZXIKICAgIGNvbnN0IHRyYWlsaW5nT0sgPSBpID09IDI7CiAgICBjb25zdCBudW0gPSBwYXJzZURpZ2l0cyhwYXJ0c1tpXSwgMSwgMiwgdHJhaWxpbmdPSyk7CiAgICBpZiAobnVtID09PSBudWxsKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgcmVzdWx0W2ldID0gbnVtOwogIH0KCiAgcmV0dXJuIHJlc3VsdDsKfQoKZnVuY3Rpb24gcGFyc2VNb250aCh0b2tlbikgewogIHRva2VuID0gU3RyaW5nKHRva2VuKQogICAgLnN1YnN0cigwLCAzKQogICAgLnRvTG93ZXJDYXNlKCk7CiAgY29uc3QgbnVtID0gTU9OVEhfVE9fTlVNW3Rva2VuXTsKICByZXR1cm4gbnVtID49IDAgPyBudW0gOiBudWxsOwp9CgovKgogKiBSRkM2MjY1IFM1LjEuMSBkYXRlIHBhcnNlciAoc2VlIFJGQyBmb3IgZnVsbCBncmFtbWFyKQogKi8KZnVuY3Rpb24gcGFyc2VEYXRlKHN0cikgewogIGlmICghc3RyKSB7CiAgICByZXR1cm47CiAgfQoKICAvKiBSRkM2MjY1IFM1LjEuMToKICAgKiAyLiBQcm9jZXNzIGVhY2ggZGF0ZS10b2tlbiBzZXF1ZW50aWFsbHkgaW4gdGhlIG9yZGVyIHRoZSBkYXRlLXRva2VucwogICAqIGFwcGVhciBpbiB0aGUgY29va2llLWRhdGUKICAgKi8KICBjb25zdCB0b2tlbnMgPSBzdHIuc3BsaXQoREFURV9ERUxJTSk7CiAgaWYgKCF0b2tlbnMpIHsKICAgIHJldHVybjsKICB9CgogIGxldCBob3VyID0gbnVsbDsKICBsZXQgbWludXRlID0gbnVsbDsKICBsZXQgc2Vjb25kID0gbnVsbDsKICBsZXQgZGF5T2ZNb250aCA9IG51bGw7CiAgbGV0IG1vbnRoID0gbnVsbDsKICBsZXQgeWVhciA9IG51bGw7CgogIGZvciAobGV0IGkgPSAwOyBpIDwgdG9rZW5zLmxlbmd0aDsgaSsrKSB7CiAgICBjb25zdCB0b2tlbiA9IHRva2Vuc1tpXS50cmltKCk7CiAgICBpZiAoIXRva2VuLmxlbmd0aCkgewogICAgICBjb250aW51ZTsKICAgIH0KCiAgICBsZXQgcmVzdWx0OwoKICAgIC8qIDIuMS4gSWYgdGhlIGZvdW5kLXRpbWUgZmxhZyBpcyBub3Qgc2V0IGFuZCB0aGUgdG9rZW4gbWF0Y2hlcyB0aGUgdGltZQogICAgICogcHJvZHVjdGlvbiwgc2V0IHRoZSBmb3VuZC10aW1lIGZsYWcgYW5kIHNldCB0aGUgaG91ci0gdmFsdWUsCiAgICAgKiBtaW51dGUtdmFsdWUsIGFuZCBzZWNvbmQtdmFsdWUgdG8gdGhlIG51bWJlcnMgZGVub3RlZCBieSB0aGUgZGlnaXRzIGluCiAgICAgKiB0aGUgZGF0ZS10b2tlbiwgcmVzcGVjdGl2ZWx5LiAgU2tpcCB0aGUgcmVtYWluaW5nIHN1Yi1zdGVwcyBhbmQgY29udGludWUKICAgICAqIHRvIHRoZSBuZXh0IGRhdGUtdG9rZW4uCiAgICAgKi8KICAgIGlmIChzZWNvbmQgPT09IG51bGwpIHsKICAgICAgcmVzdWx0ID0gcGFyc2VUaW1lKHRva2VuKTsKICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgIGhvdXIgPSByZXN1bHRbMF07CiAgICAgICAgbWludXRlID0gcmVzdWx0WzFdOwogICAgICAgIHNlY29uZCA9IHJlc3VsdFsyXTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgfQoKICAgIC8qIDIuMi4gSWYgdGhlIGZvdW5kLWRheS1vZi1tb250aCBmbGFnIGlzIG5vdCBzZXQgYW5kIHRoZSBkYXRlLXRva2VuIG1hdGNoZXMKICAgICAqIHRoZSBkYXktb2YtbW9udGggcHJvZHVjdGlvbiwgc2V0IHRoZSBmb3VuZC1kYXktb2YtIG1vbnRoIGZsYWcgYW5kIHNldAogICAgICogdGhlIGRheS1vZi1tb250aC12YWx1ZSB0byB0aGUgbnVtYmVyIGRlbm90ZWQgYnkgdGhlIGRhdGUtdG9rZW4uICBTa2lwCiAgICAgKiB0aGUgcmVtYWluaW5nIHN1Yi1zdGVwcyBhbmQgY29udGludWUgdG8gdGhlIG5leHQgZGF0ZS10b2tlbi4KICAgICAqLwogICAgaWYgKGRheU9mTW9udGggPT09IG51bGwpIHsKICAgICAgLy8gImRheS1vZi1tb250aCA9IDEqMkRJR0lUICggbm9uLWRpZ2l0ICpPQ1RFVCApIgogICAgICByZXN1bHQgPSBwYXJzZURpZ2l0cyh0b2tlbiwgMSwgMiwgdHJ1ZSk7CiAgICAgIGlmIChyZXN1bHQgIT09IG51bGwpIHsKICAgICAgICBkYXlPZk1vbnRoID0gcmVzdWx0OwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICB9CgogICAgLyogMi4zLiBJZiB0aGUgZm91bmQtbW9udGggZmxhZyBpcyBub3Qgc2V0IGFuZCB0aGUgZGF0ZS10b2tlbiBtYXRjaGVzIHRoZQogICAgICogbW9udGggcHJvZHVjdGlvbiwgc2V0IHRoZSBmb3VuZC1tb250aCBmbGFnIGFuZCBzZXQgdGhlIG1vbnRoLXZhbHVlIHRvCiAgICAgKiB0aGUgbW9udGggZGVub3RlZCBieSB0aGUgZGF0ZS10b2tlbi4gIFNraXAgdGhlIHJlbWFpbmluZyBzdWItc3RlcHMgYW5kCiAgICAgKiBjb250aW51ZSB0byB0aGUgbmV4dCBkYXRlLXRva2VuLgogICAgICovCiAgICBpZiAobW9udGggPT09IG51bGwpIHsKICAgICAgcmVzdWx0ID0gcGFyc2VNb250aCh0b2tlbik7CiAgICAgIGlmIChyZXN1bHQgIT09IG51bGwpIHsKICAgICAgICBtb250aCA9IHJlc3VsdDsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgfQoKICAgIC8qIDIuNC4gSWYgdGhlIGZvdW5kLXllYXIgZmxhZyBpcyBub3Qgc2V0IGFuZCB0aGUgZGF0ZS10b2tlbiBtYXRjaGVzIHRoZQogICAgICogeWVhciBwcm9kdWN0aW9uLCBzZXQgdGhlIGZvdW5kLXllYXIgZmxhZyBhbmQgc2V0IHRoZSB5ZWFyLXZhbHVlIHRvIHRoZQogICAgICogbnVtYmVyIGRlbm90ZWQgYnkgdGhlIGRhdGUtdG9rZW4uICBTa2lwIHRoZSByZW1haW5pbmcgc3ViLXN0ZXBzIGFuZAogICAgICogY29udGludWUgdG8gdGhlIG5leHQgZGF0ZS10b2tlbi4KICAgICAqLwogICAgaWYgKHllYXIgPT09IG51bGwpIHsKICAgICAgLy8gInllYXIgPSAyKjRESUdJVCAoIG5vbi1kaWdpdCAqT0NURVQgKSIKICAgICAgcmVzdWx0ID0gcGFyc2VEaWdpdHModG9rZW4sIDIsIDQsIHRydWUpOwogICAgICBpZiAocmVzdWx0ICE9PSBudWxsKSB7CiAgICAgICAgeWVhciA9IHJlc3VsdDsKICAgICAgICAvKiBGcm9tIFM1LjEuMToKICAgICAgICAgKiAzLiAgSWYgdGhlIHllYXItdmFsdWUgaXMgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIDcwIGFuZCBsZXNzCiAgICAgICAgICogdGhhbiBvciBlcXVhbCB0byA5OSwgaW5jcmVtZW50IHRoZSB5ZWFyLXZhbHVlIGJ5IDE5MDAuCiAgICAgICAgICogNC4gIElmIHRoZSB5ZWFyLXZhbHVlIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byAwIGFuZCBsZXNzCiAgICAgICAgICogdGhhbiBvciBlcXVhbCB0byA2OSwgaW5jcmVtZW50IHRoZSB5ZWFyLXZhbHVlIGJ5IDIwMDAuCiAgICAgICAgICovCiAgICAgICAgaWYgKHllYXIgPj0gNzAgJiYgeWVhciA8PSA5OSkgewogICAgICAgICAgeWVhciArPSAxOTAwOwogICAgICAgIH0gZWxzZSBpZiAoeWVhciA+PSAwICYmIHllYXIgPD0gNjkpIHsKICAgICAgICAgIHllYXIgKz0gMjAwMDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIC8qIFJGQyA2MjY1IFM1LjEuMQogICAqICI1LiBBYm9ydCB0aGVzZSBzdGVwcyBhbmQgZmFpbCB0byBwYXJzZSB0aGUgY29va2llLWRhdGUgaWY6CiAgICogICAgICogIGF0IGxlYXN0IG9uZSBvZiB0aGUgZm91bmQtZGF5LW9mLW1vbnRoLCBmb3VuZC1tb250aCwgZm91bmQtCiAgICogICAgICAgIHllYXIsIG9yIGZvdW5kLXRpbWUgZmxhZ3MgaXMgbm90IHNldCwKICAgKiAgICAgKiAgdGhlIGRheS1vZi1tb250aC12YWx1ZSBpcyBsZXNzIHRoYW4gMSBvciBncmVhdGVyIHRoYW4gMzEsCiAgICogICAgICogIHRoZSB5ZWFyLXZhbHVlIGlzIGxlc3MgdGhhbiAxNjAxLAogICAqICAgICAqICB0aGUgaG91ci12YWx1ZSBpcyBncmVhdGVyIHRoYW4gMjMsCiAgICogICAgICogIHRoZSBtaW51dGUtdmFsdWUgaXMgZ3JlYXRlciB0aGFuIDU5LCBvcgogICAqICAgICAqICB0aGUgc2Vjb25kLXZhbHVlIGlzIGdyZWF0ZXIgdGhhbiA1OS4KICAgKiAgICAgKE5vdGUgdGhhdCBsZWFwIHNlY29uZHMgY2Fubm90IGJlIHJlcHJlc2VudGVkIGluIHRoaXMgc3ludGF4LikiCiAgICoKICAgKiBTbywgaW4gb3JkZXIgYXMgYWJvdmU6CiAgICovCiAgaWYgKAogICAgZGF5T2ZNb250aCA9PT0gbnVsbCB8fAogICAgbW9udGggPT09IG51bGwgfHwKICAgIHllYXIgPT09IG51bGwgfHwKICAgIHNlY29uZCA9PT0gbnVsbCB8fAogICAgZGF5T2ZNb250aCA8IDEgfHwKICAgIGRheU9mTW9udGggPiAzMSB8fAogICAgeWVhciA8IDE2MDEgfHwKICAgIGhvdXIgPiAyMyB8fAogICAgbWludXRlID4gNTkgfHwKICAgIHNlY29uZCA+IDU5CiAgKSB7CiAgICByZXR1cm47CiAgfQoKICByZXR1cm4gbmV3IERhdGUoRGF0ZS5VVEMoeWVhciwgbW9udGgsIGRheU9mTW9udGgsIGhvdXIsIG1pbnV0ZSwgc2Vjb25kKSk7Cn0KCmZ1bmN0aW9uIGZvcm1hdERhdGUoZGF0ZSkgewogIHZhbGlkYXRvcnMudmFsaWRhdGUodmFsaWRhdG9ycy5pc0RhdGUoZGF0ZSksIGRhdGUpOwogIHJldHVybiBkYXRlLnRvVVRDU3RyaW5nKCk7Cn0KCi8vIFM1LjEuMiBDYW5vbmljYWxpemVkIEhvc3QgTmFtZXMKZnVuY3Rpb24gY2Fub25pY2FsRG9tYWluKHN0cikgewogIGlmIChzdHIgPT0gbnVsbCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIHN0ciA9IHN0ci50cmltKCkucmVwbGFjZSgvXlwuLywgIiIpOyAvLyBTNC4xLjIuMyAmIFM1LjIuMzogaWdub3JlIGxlYWRpbmcgLgoKICBpZiAoSVBfVjZfUkVHRVhfT0JKRUNULnRlc3Qoc3RyKSkgewogICAgc3RyID0gc3RyLnJlcGxhY2UoIlsiLCAiIikucmVwbGFjZSgiXSIsICIiKTsKICB9CgogIC8vIGNvbnZlcnQgdG8gSUROIGlmIGFueSBub24tQVNDSUkgY2hhcmFjdGVycwogIGlmIChwdW55Y29kZSAmJiAvW15cdTAwMDEtXHUwMDdmXS8udGVzdChzdHIpKSB7CiAgICBzdHIgPSBwdW55Y29kZS50b0FTQ0lJKHN0cik7CiAgfQoKICByZXR1cm4gc3RyLnRvTG93ZXJDYXNlKCk7Cn0KCi8vIFM1LjEuMyBEb21haW4gTWF0Y2hpbmcKZnVuY3Rpb24gZG9tYWluTWF0Y2goc3RyLCBkb21TdHIsIGNhbm9uaWNhbGl6ZSkgewogIGlmIChzdHIgPT0gbnVsbCB8fCBkb21TdHIgPT0gbnVsbCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGlmIChjYW5vbmljYWxpemUgIT09IGZhbHNlKSB7CiAgICBzdHIgPSBjYW5vbmljYWxEb21haW4oc3RyKTsKICAgIGRvbVN0ciA9IGNhbm9uaWNhbERvbWFpbihkb21TdHIpOwogIH0KCiAgLyoKICAgKiBTNS4xLjM6CiAgICogIkEgc3RyaW5nIGRvbWFpbi1tYXRjaGVzIGEgZ2l2ZW4gZG9tYWluIHN0cmluZyBpZiBhdCBsZWFzdCBvbmUgb2YgdGhlCiAgICogZm9sbG93aW5nIGNvbmRpdGlvbnMgaG9sZDoiCiAgICoKICAgKiAiIG8gVGhlIGRvbWFpbiBzdHJpbmcgYW5kIHRoZSBzdHJpbmcgYXJlIGlkZW50aWNhbC4gKE5vdGUgdGhhdCBib3RoIHRoZQogICAqIGRvbWFpbiBzdHJpbmcgYW5kIHRoZSBzdHJpbmcgd2lsbCBoYXZlIGJlZW4gY2Fub25pY2FsaXplZCB0byBsb3dlciBjYXNlIGF0CiAgICogdGhpcyBwb2ludCkiCiAgICovCiAgaWYgKHN0ciA9PSBkb21TdHIpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgLyogIiBvIEFsbCBvZiB0aGUgZm9sbG93aW5nIFt0aHJlZV0gY29uZGl0aW9ucyBob2xkOiIgKi8KCiAgLyogIiogVGhlIGRvbWFpbiBzdHJpbmcgaXMgYSBzdWZmaXggb2YgdGhlIHN0cmluZyIgKi8KICBjb25zdCBpZHggPSBzdHIubGFzdEluZGV4T2YoZG9tU3RyKTsKICBpZiAoaWR4IDw9IDApIHsKICAgIHJldHVybiBmYWxzZTsgLy8gaXQncyBhIG5vbi1tYXRjaCAoLTEpIG9yIHByZWZpeCAoMCkKICB9CgogIC8vIG5leHQsIGNoZWNrIGl0J3MgYSBwcm9wZXIgc3VmZml4CiAgLy8gZS5nLiwgImEuYi5jIi5pbmRleE9mKCJiLmMiKSA9PT0gMgogIC8vIDUgPT09IDMrMgogIGlmIChzdHIubGVuZ3RoICE9PSBkb21TdHIubGVuZ3RoICsgaWR4KSB7CiAgICByZXR1cm4gZmFsc2U7IC8vIGl0J3Mgbm90IGEgc3VmZml4CiAgfQoKICAvKiAiICAqIFRoZSBsYXN0IGNoYXJhY3RlciBvZiB0aGUgc3RyaW5nIHRoYXQgaXMgbm90IGluY2x1ZGVkIGluIHRoZQogICAqIGRvbWFpbiBzdHJpbmcgaXMgYSAleDJFICgiLiIpIGNoYXJhY3Rlci4iICovCiAgaWYgKHN0ci5zdWJzdHIoaWR4IC0gMSwgMSkgIT09ICIuIikgewogICAgcmV0dXJuIGZhbHNlOyAvLyBkb2Vzbid0IGFsaWduIG9uICIuIgogIH0KCiAgLyogIiAgKiBUaGUgc3RyaW5nIGlzIGEgaG9zdCBuYW1lIChpLmUuLCBub3QgYW4gSVAgYWRkcmVzcykuIiAqLwogIGlmIChJUF9SRUdFWF9MT1dFUkNBU0UudGVzdChzdHIpKSB7CiAgICByZXR1cm4gZmFsc2U7IC8vIGl0J3MgYW4gSVAgYWRkcmVzcwogIH0KCiAgcmV0dXJuIHRydWU7Cn0KCi8vIFJGQzYyNjUgUzUuMS40IFBhdGhzIGFuZCBQYXRoLU1hdGNoCgovKgogKiAiVGhlIHVzZXIgYWdlbnQgTVVTVCB1c2UgYW4gYWxnb3JpdGhtIGVxdWl2YWxlbnQgdG8gdGhlIGZvbGxvd2luZyBhbGdvcml0aG0KICogdG8gY29tcHV0ZSB0aGUgZGVmYXVsdC1wYXRoIG9mIGEgY29va2llOiIKICoKICogQXNzdW1wdGlvbjogdGhlIHBhdGggKGFuZCBub3QgcXVlcnkgcGFydCBvciBhYnNvbHV0ZSB1cmkpIGlzIHBhc3NlZCBpbi4KICovCmZ1bmN0aW9uIGRlZmF1bHRQYXRoKHBhdGgpIHsKICAvLyAiMi4gSWYgdGhlIHVyaS1wYXRoIGlzIGVtcHR5IG9yIGlmIHRoZSBmaXJzdCBjaGFyYWN0ZXIgb2YgdGhlIHVyaS1wYXRoIGlzIG5vdAogIC8vIGEgJXgyRiAoIi8iKSBjaGFyYWN0ZXIsIG91dHB1dCAleDJGICgiLyIpIGFuZCBza2lwIHRoZSByZW1haW5pbmcgc3RlcHMuCiAgaWYgKCFwYXRoIHx8IHBhdGguc3Vic3RyKDAsIDEpICE9PSAiLyIpIHsKICAgIHJldHVybiAiLyI7CiAgfQoKICAvLyAiMy4gSWYgdGhlIHVyaS1wYXRoIGNvbnRhaW5zIG5vIG1vcmUgdGhhbiBvbmUgJXgyRiAoIi8iKSBjaGFyYWN0ZXIsIG91dHB1dAogIC8vICV4MkYgKCIvIikgYW5kIHNraXAgdGhlIHJlbWFpbmluZyBzdGVwLiIKICBpZiAocGF0aCA9PT0gIi8iKSB7CiAgICByZXR1cm4gcGF0aDsKICB9CgogIGNvbnN0IHJpZ2h0U2xhc2ggPSBwYXRoLmxhc3RJbmRleE9mKCIvIik7CiAgaWYgKHJpZ2h0U2xhc2ggPT09IDApIHsKICAgIHJldHVybiAiLyI7CiAgfQoKICAvLyAiNC4gT3V0cHV0IHRoZSBjaGFyYWN0ZXJzIG9mIHRoZSB1cmktcGF0aCBmcm9tIHRoZSBmaXJzdCBjaGFyYWN0ZXIgdXAgdG8sCiAgLy8gYnV0IG5vdCBpbmNsdWRpbmcsIHRoZSByaWdodC1tb3N0ICV4MkYgKCIvIikuIgogIHJldHVybiBwYXRoLnNsaWNlKDAsIHJpZ2h0U2xhc2gpOwp9CgpmdW5jdGlvbiB0cmltVGVybWluYXRvcihzdHIpIHsKICBpZiAodmFsaWRhdG9ycy5pc0VtcHR5U3RyaW5nKHN0cikpIHJldHVybiBzdHI7CiAgZm9yIChsZXQgdCA9IDA7IHQgPCBURVJNSU5BVE9SUy5sZW5ndGg7IHQrKykgewogICAgY29uc3QgdGVybWluYXRvcklkeCA9IHN0ci5pbmRleE9mKFRFUk1JTkFUT1JTW3RdKTsKICAgIGlmICh0ZXJtaW5hdG9ySWR4ICE9PSAtMSkgewogICAgICBzdHIgPSBzdHIuc3Vic3RyKDAsIHRlcm1pbmF0b3JJZHgpOwogICAgfQogIH0KCiAgcmV0dXJuIHN0cjsKfQoKZnVuY3Rpb24gcGFyc2VDb29raWVQYWlyKGNvb2tpZVBhaXIsIGxvb3NlTW9kZSkgewogIGNvb2tpZVBhaXIgPSB0cmltVGVybWluYXRvcihjb29raWVQYWlyKTsKICB2YWxpZGF0b3JzLnZhbGlkYXRlKHZhbGlkYXRvcnMuaXNTdHJpbmcoY29va2llUGFpciksIGNvb2tpZVBhaXIpOwoKICBsZXQgZmlyc3RFcSA9IGNvb2tpZVBhaXIuaW5kZXhPZigiPSIpOwogIGlmIChsb29zZU1vZGUpIHsKICAgIGlmIChmaXJzdEVxID09PSAwKSB7CiAgICAgIC8vICc9JyBpcyBpbW1lZGlhdGVseSBhdCBzdGFydAogICAgICBjb29raWVQYWlyID0gY29va2llUGFpci5zdWJzdHIoMSk7CiAgICAgIGZpcnN0RXEgPSBjb29raWVQYWlyLmluZGV4T2YoIj0iKTsgLy8gbWlnaHQgc3RpbGwgbmVlZCB0byBzcGxpdCBvbiAnPScKICAgIH0KICB9IGVsc2UgewogICAgLy8gbm9uLWxvb3NlIG1vZGUKICAgIGlmIChmaXJzdEVxIDw9IDApIHsKICAgICAgLy8gbm8gJz0nIG9yIGlzIGF0IHN0YXJ0CiAgICAgIHJldHVybjsgLy8gbmVlZHMgdG8gaGF2ZSBub24tZW1wdHkgImNvb2tpZS1uYW1lIgogICAgfQogIH0KCiAgbGV0IGNvb2tpZU5hbWUsIGNvb2tpZVZhbHVlOwogIGlmIChmaXJzdEVxIDw9IDApIHsKICAgIGNvb2tpZU5hbWUgPSAiIjsKICAgIGNvb2tpZVZhbHVlID0gY29va2llUGFpci50cmltKCk7CiAgfSBlbHNlIHsKICAgIGNvb2tpZU5hbWUgPSBjb29raWVQYWlyLnN1YnN0cigwLCBmaXJzdEVxKS50cmltKCk7CiAgICBjb29raWVWYWx1ZSA9IGNvb2tpZVBhaXIuc3Vic3RyKGZpcnN0RXEgKyAxKS50cmltKCk7CiAgfQoKICBpZiAoQ09OVFJPTF9DSEFSUy50ZXN0KGNvb2tpZU5hbWUpIHx8IENPTlRST0xfQ0hBUlMudGVzdChjb29raWVWYWx1ZSkpIHsKICAgIHJldHVybjsKICB9CgogIGNvbnN0IGMgPSBuZXcgQ29va2llKCk7CiAgYy5rZXkgPSBjb29raWVOYW1lOwogIGMudmFsdWUgPSBjb29raWVWYWx1ZTsKICByZXR1cm4gYzsKfQoKZnVuY3Rpb24gcGFyc2UkSChzdHIsIG9wdGlvbnMpIHsKICBpZiAoIW9wdGlvbnMgfHwgdHlwZW9mIG9wdGlvbnMgIT09ICJvYmplY3QiKSB7CiAgICBvcHRpb25zID0ge307CiAgfQoKICBpZiAodmFsaWRhdG9ycy5pc0VtcHR5U3RyaW5nKHN0cikgfHwgIXZhbGlkYXRvcnMuaXNTdHJpbmcoc3RyKSkgewogICAgcmV0dXJuIG51bGw7CiAgfQoKICBzdHIgPSBzdHIudHJpbSgpOwoKICAvLyBXZSB1c2UgYSByZWdleCB0byBwYXJzZSB0aGUgIm5hbWUtdmFsdWUtcGFpciIgcGFydCBvZiBTNS4yCiAgY29uc3QgZmlyc3RTZW1pID0gc3RyLmluZGV4T2YoIjsiKTsgLy8gUzUuMiBzdGVwIDEKICBjb25zdCBjb29raWVQYWlyID0gZmlyc3RTZW1pID09PSAtMSA/IHN0ciA6IHN0ci5zdWJzdHIoMCwgZmlyc3RTZW1pKTsKICBjb25zdCBjID0gcGFyc2VDb29raWVQYWlyKGNvb2tpZVBhaXIsICEhb3B0aW9ucy5sb29zZSk7CiAgaWYgKCFjKSB7CiAgICByZXR1cm47CiAgfQoKICBpZiAoZmlyc3RTZW1pID09PSAtMSkgewogICAgcmV0dXJuIGM7CiAgfQoKICAvLyBTNS4yLjMgInVucGFyc2VkLWF0dHJpYnV0ZXMgY29uc2lzdCBvZiB0aGUgcmVtYWluZGVyIG9mIHRoZSBzZXQtY29va2llLXN0cmluZwogIC8vIChpbmNsdWRpbmcgdGhlICV4M0IgKCI7IikgaW4gcXVlc3Rpb24pLiIgcGx1cyBsYXRlciBvbiBpbiB0aGUgc2FtZSBzZWN0aW9uCiAgLy8gImRpc2NhcmQgdGhlIGZpcnN0ICI7IiBhbmQgdHJpbSIuCiAgY29uc3QgdW5wYXJzZWQgPSBzdHIuc2xpY2UoZmlyc3RTZW1pICsgMSkudHJpbSgpOwoKICAvLyAiSWYgdGhlIHVucGFyc2VkLWF0dHJpYnV0ZXMgc3RyaW5nIGlzIGVtcHR5LCBza2lwIHRoZSByZXN0IG9mIHRoZXNlCiAgLy8gc3RlcHMuIgogIGlmICh1bnBhcnNlZC5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiBjOwogIH0KCiAgLyoKICAgKiBTNS4yIHNheXMgdGhhdCB3aGVuIGxvb3Bpbmcgb3ZlciB0aGUgaXRlbXMgIltwXXJvY2VzcyB0aGUgYXR0cmlidXRlLW5hbWUKICAgKiBhbmQgYXR0cmlidXRlLXZhbHVlIGFjY29yZGluZyB0byB0aGUgcmVxdWlyZW1lbnRzIGluIHRoZSBmb2xsb3dpbmcKICAgKiBzdWJzZWN0aW9ucyIgZm9yIGV2ZXJ5IGl0ZW0uICBQbHVzLCBmb3IgbWFueSBvZiB0aGUgaW5kaXZpZHVhbCBhdHRyaWJ1dGVzCiAgICogaW4gUzUuMyBpdCBzYXlzIHRvIHVzZSB0aGUgImF0dHJpYnV0ZS12YWx1ZSBvZiB0aGUgbGFzdCBhdHRyaWJ1dGUgaW4gdGhlCiAgICogY29va2llLWF0dHJpYnV0ZS1saXN0Ii4gIFRoZXJlZm9yZSwgaW4gdGhpcyBpbXBsZW1lbnRhdGlvbiwgd2Ugb3ZlcndyaXRlCiAgICogdGhlIHByZXZpb3VzIHZhbHVlLgogICAqLwogIGNvbnN0IGNvb2tpZV9hdnMgPSB1bnBhcnNlZC5zcGxpdCgiOyIpOwogIHdoaWxlIChjb29raWVfYXZzLmxlbmd0aCkgewogICAgY29uc3QgYXYgPSBjb29raWVfYXZzLnNoaWZ0KCkudHJpbSgpOwogICAgaWYgKGF2Lmxlbmd0aCA9PT0gMCkgewogICAgICAvLyBoYXBwZW5zIGlmICI7OyIgYXBwZWFycwogICAgICBjb250aW51ZTsKICAgIH0KICAgIGNvbnN0IGF2X3NlcCA9IGF2LmluZGV4T2YoIj0iKTsKICAgIGxldCBhdl9rZXksIGF2X3ZhbHVlOwoKICAgIGlmIChhdl9zZXAgPT09IC0xKSB7CiAgICAgIGF2X2tleSA9IGF2OwogICAgICBhdl92YWx1ZSA9IG51bGw7CiAgICB9IGVsc2UgewogICAgICBhdl9rZXkgPSBhdi5zdWJzdHIoMCwgYXZfc2VwKTsKICAgICAgYXZfdmFsdWUgPSBhdi5zdWJzdHIoYXZfc2VwICsgMSk7CiAgICB9CgogICAgYXZfa2V5ID0gYXZfa2V5LnRyaW0oKS50b0xvd2VyQ2FzZSgpOwoKICAgIGlmIChhdl92YWx1ZSkgewogICAgICBhdl92YWx1ZSA9IGF2X3ZhbHVlLnRyaW0oKTsKICAgIH0KCiAgICBzd2l0Y2ggKGF2X2tleSkgewogICAgICBjYXNlICJleHBpcmVzIjogLy8gUzUuMi4xCiAgICAgICAgaWYgKGF2X3ZhbHVlKSB7CiAgICAgICAgICBjb25zdCBleHAgPSBwYXJzZURhdGUoYXZfdmFsdWUpOwogICAgICAgICAgLy8gIklmIHRoZSBhdHRyaWJ1dGUtdmFsdWUgZmFpbGVkIHRvIHBhcnNlIGFzIGEgY29va2llIGRhdGUsIGlnbm9yZSB0aGUKICAgICAgICAgIC8vIGNvb2tpZS1hdi4iCiAgICAgICAgICBpZiAoZXhwKSB7CiAgICAgICAgICAgIC8vIG92ZXIgYW5kIHVuZGVyZmxvdyBub3QgcmVhbGlzdGljYWxseSBhIGNvbmNlcm46IFY4J3MgZ2V0VGltZSgpIHNlZW1zIHRvCiAgICAgICAgICAgIC8vIHN0b3JlIHNvbWV0aGluZyBsYXJnZXIgdGhhbiBhIDMyLWJpdCB0aW1lX3QgKGV2ZW4gd2l0aCAzMi1iaXQgbm9kZSkKICAgICAgICAgICAgYy5leHBpcmVzID0gZXhwOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgIm1heC1hZ2UiOiAvLyBTNS4yLjIKICAgICAgICBpZiAoYXZfdmFsdWUpIHsKICAgICAgICAgIC8vICJJZiB0aGUgZmlyc3QgY2hhcmFjdGVyIG9mIHRoZSBhdHRyaWJ1dGUtdmFsdWUgaXMgbm90IGEgRElHSVQgb3IgYSAiLSIKICAgICAgICAgIC8vIGNoYXJhY3RlciAuLi5bb3JdLi4uIElmIHRoZSByZW1haW5kZXIgb2YgYXR0cmlidXRlLXZhbHVlIGNvbnRhaW5zIGEKICAgICAgICAgIC8vIG5vbi1ESUdJVCBjaGFyYWN0ZXIsIGlnbm9yZSB0aGUgY29va2llLWF2LiIKICAgICAgICAgIGlmICgvXi0/WzAtOV0rJC8udGVzdChhdl92YWx1ZSkpIHsKICAgICAgICAgICAgY29uc3QgZGVsdGEgPSBwYXJzZUludChhdl92YWx1ZSwgMTApOwogICAgICAgICAgICAvLyAiSWYgZGVsdGEtc2Vjb25kcyBpcyBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gemVybyAoMCksIGxldCBleHBpcnktdGltZQogICAgICAgICAgICAvLyBiZSB0aGUgZWFybGllc3QgcmVwcmVzZW50YWJsZSBkYXRlIGFuZCB0aW1lLiIKICAgICAgICAgICAgYy5zZXRNYXhBZ2UoZGVsdGEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgImRvbWFpbiI6IC8vIFM1LjIuMwogICAgICAgIC8vICJJZiB0aGUgYXR0cmlidXRlLXZhbHVlIGlzIGVtcHR5LCB0aGUgYmVoYXZpb3IgaXMgdW5kZWZpbmVkLiAgSG93ZXZlciwKICAgICAgICAvLyB0aGUgdXNlciBhZ2VudCBTSE9VTEQgaWdub3JlIHRoZSBjb29raWUtYXYgZW50aXJlbHkuIgogICAgICAgIGlmIChhdl92YWx1ZSkgewogICAgICAgICAgLy8gUzUuMi4zICJMZXQgY29va2llLWRvbWFpbiBiZSB0aGUgYXR0cmlidXRlLXZhbHVlIHdpdGhvdXQgdGhlIGxlYWRpbmcgJXgyRQogICAgICAgICAgLy8gKCIuIikgY2hhcmFjdGVyLiIKICAgICAgICAgIGNvbnN0IGRvbWFpbiA9IGF2X3ZhbHVlLnRyaW0oKS5yZXBsYWNlKC9eXC4vLCAiIik7CiAgICAgICAgICBpZiAoZG9tYWluKSB7CiAgICAgICAgICAgIC8vICJDb252ZXJ0IHRoZSBjb29raWUtZG9tYWluIHRvIGxvd2VyIGNhc2UuIgogICAgICAgICAgICBjLmRvbWFpbiA9IGRvbWFpbi50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgInBhdGgiOiAvLyBTNS4yLjQKICAgICAgICAvKgogICAgICAgICAqICJJZiB0aGUgYXR0cmlidXRlLXZhbHVlIGlzIGVtcHR5IG9yIGlmIHRoZSBmaXJzdCBjaGFyYWN0ZXIgb2YgdGhlCiAgICAgICAgICogYXR0cmlidXRlLXZhbHVlIGlzIG5vdCAleDJGICgiLyIpOgogICAgICAgICAqICAgTGV0IGNvb2tpZS1wYXRoIGJlIHRoZSBkZWZhdWx0LXBhdGguCiAgICAgICAgICogT3RoZXJ3aXNlOgogICAgICAgICAqICAgTGV0IGNvb2tpZS1wYXRoIGJlIHRoZSBhdHRyaWJ1dGUtdmFsdWUuIgogICAgICAgICAqCiAgICAgICAgICogV2UnbGwgcmVwcmVzZW50IHRoZSBkZWZhdWx0LXBhdGggYXMgbnVsbCBzaW5jZSBpdCBkZXBlbmRzIG9uIHRoZQogICAgICAgICAqIGNvbnRleHQgb2YgdGhlIHBhcnNpbmcuCiAgICAgICAgICovCiAgICAgICAgYy5wYXRoID0gYXZfdmFsdWUgJiYgYXZfdmFsdWVbMF0gPT09ICIvIiA/IGF2X3ZhbHVlIDogbnVsbDsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgInNlY3VyZSI6IC8vIFM1LjIuNQogICAgICAgIC8qCiAgICAgICAgICogIklmIHRoZSBhdHRyaWJ1dGUtbmFtZSBjYXNlLWluc2Vuc2l0aXZlbHkgbWF0Y2hlcyB0aGUgc3RyaW5nICJTZWN1cmUiLAogICAgICAgICAqIHRoZSB1c2VyIGFnZW50IE1VU1QgYXBwZW5kIGFuIGF0dHJpYnV0ZSB0byB0aGUgY29va2llLWF0dHJpYnV0ZS1saXN0CiAgICAgICAgICogd2l0aCBhbiBhdHRyaWJ1dGUtbmFtZSBvZiBTZWN1cmUgYW5kIGFuIGVtcHR5IGF0dHJpYnV0ZS12YWx1ZS4iCiAgICAgICAgICovCiAgICAgICAgYy5zZWN1cmUgPSB0cnVlOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAiaHR0cG9ubHkiOiAvLyBTNS4yLjYgLS0gZWZmZWN0aXZlbHkgdGhlIHNhbWUgYXMgJ3NlY3VyZScKICAgICAgICBjLmh0dHBPbmx5ID0gdHJ1ZTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgInNhbWVzaXRlIjogLy8gUkZDNjI2NWJpcy0wMiBTNS4zLjcKICAgICAgICBjb25zdCBlbmZvcmNlbWVudCA9IGF2X3ZhbHVlID8gYXZfdmFsdWUudG9Mb3dlckNhc2UoKSA6ICIiOwogICAgICAgIHN3aXRjaCAoZW5mb3JjZW1lbnQpIHsKICAgICAgICAgIGNhc2UgInN0cmljdCI6CiAgICAgICAgICAgIGMuc2FtZVNpdGUgPSAic3RyaWN0IjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJsYXgiOgogICAgICAgICAgICBjLnNhbWVTaXRlID0gImxheCI7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAibm9uZSI6CiAgICAgICAgICAgIGMuc2FtZVNpdGUgPSAibm9uZSI7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgYy5zYW1lU2l0ZSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwoKICAgICAgZGVmYXVsdDoKICAgICAgICBjLmV4dGVuc2lvbnMgPSBjLmV4dGVuc2lvbnMgfHwgW107CiAgICAgICAgYy5leHRlbnNpb25zLnB1c2goYXYpOwogICAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgcmV0dXJuIGM7Cn0KCi8qKgogKiAgSWYgdGhlIGNvb2tpZS1uYW1lIGJlZ2lucyB3aXRoIGEgY2FzZS1zZW5zaXRpdmUgbWF0Y2ggZm9yIHRoZQogKiAgc3RyaW5nICJfX1NlY3VyZS0iLCBhYm9ydCB0aGVzZSBzdGVwcyBhbmQgaWdub3JlIHRoZSBjb29raWUKICogIGVudGlyZWx5IHVubGVzcyB0aGUgY29va2llJ3Mgc2VjdXJlLW9ubHktZmxhZyBpcyB0cnVlLgogKiBAcGFyYW0gY29va2llCiAqIEByZXR1cm5zIGJvb2xlYW4KICovCmZ1bmN0aW9uIGlzU2VjdXJlUHJlZml4Q29uZGl0aW9uTWV0KGNvb2tpZSkgewogIHZhbGlkYXRvcnMudmFsaWRhdGUodmFsaWRhdG9ycy5pc09iamVjdChjb29raWUpLCBjb29raWUpOwogIHJldHVybiAhY29va2llLmtleS5zdGFydHNXaXRoKCJfX1NlY3VyZS0iKSB8fCBjb29raWUuc2VjdXJlOwp9CgovKioKICogIElmIHRoZSBjb29raWUtbmFtZSBiZWdpbnMgd2l0aCBhIGNhc2Utc2Vuc2l0aXZlIG1hdGNoIGZvciB0aGUKICogIHN0cmluZyAiX19Ib3N0LSIsIGFib3J0IHRoZXNlIHN0ZXBzIGFuZCBpZ25vcmUgdGhlIGNvb2tpZQogKiAgZW50aXJlbHkgdW5sZXNzIHRoZSBjb29raWUgbWVldHMgYWxsIHRoZSBmb2xsb3dpbmcgY3JpdGVyaWE6CiAqICAgIDEuICBUaGUgY29va2llJ3Mgc2VjdXJlLW9ubHktZmxhZyBpcyB0cnVlLgogKiAgICAyLiAgVGhlIGNvb2tpZSdzIGhvc3Qtb25seS1mbGFnIGlzIHRydWUuCiAqICAgIDMuICBUaGUgY29va2llLWF0dHJpYnV0ZS1saXN0IGNvbnRhaW5zIGFuIGF0dHJpYnV0ZSB3aXRoIGFuCiAqICAgICAgICBhdHRyaWJ1dGUtbmFtZSBvZiAiUGF0aCIsIGFuZCB0aGUgY29va2llJ3MgcGF0aCBpcyAiLyIuCiAqIEBwYXJhbSBjb29raWUKICogQHJldHVybnMgYm9vbGVhbgogKi8KZnVuY3Rpb24gaXNIb3N0UHJlZml4Q29uZGl0aW9uTWV0KGNvb2tpZSkgewogIHZhbGlkYXRvcnMudmFsaWRhdGUodmFsaWRhdG9ycy5pc09iamVjdChjb29raWUpKTsKICByZXR1cm4gKAogICAgIWNvb2tpZS5rZXkuc3RhcnRzV2l0aCgiX19Ib3N0LSIpIHx8CiAgICAoY29va2llLnNlY3VyZSAmJgogICAgICBjb29raWUuaG9zdE9ubHkgJiYKICAgICAgY29va2llLnBhdGggIT0gbnVsbCAmJgogICAgICBjb29raWUucGF0aCA9PT0gIi8iKQogICk7Cn0KCi8vIGF2b2lkIHRoZSBWOCBkZW9wdGltaXphdGlvbiBtb25zdGVyIQpmdW5jdGlvbiBqc29uUGFyc2Uoc3RyKSB7CiAgbGV0IG9iajsKICB0cnkgewogICAgb2JqID0gSlNPTi5wYXJzZShzdHIpOwogIH0gY2F0Y2ggKGUpIHsKICAgIHJldHVybiBlOwogIH0KICByZXR1cm4gb2JqOwp9CgpmdW5jdGlvbiBmcm9tSlNPTihzdHIpIHsKICBpZiAoIXN0ciB8fCB2YWxpZGF0b3JzLmlzRW1wdHlTdHJpbmcoc3RyKSkgewogICAgcmV0dXJuIG51bGw7CiAgfQoKICBsZXQgb2JqOwogIGlmICh0eXBlb2Ygc3RyID09PSAic3RyaW5nIikgewogICAgb2JqID0ganNvblBhcnNlKHN0cik7CiAgICBpZiAob2JqIGluc3RhbmNlb2YgRXJyb3IpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfSBlbHNlIHsKICAgIC8vIGFzc3VtZSBpdCdzIGFuIE9iamVjdAogICAgb2JqID0gc3RyOwogIH0KCiAgY29uc3QgYyA9IG5ldyBDb29raWUoKTsKICBmb3IgKGxldCBpID0gMDsgaSA8IENvb2tpZS5zZXJpYWxpemFibGVQcm9wZXJ0aWVzLmxlbmd0aDsgaSsrKSB7CiAgICBjb25zdCBwcm9wID0gQ29va2llLnNlcmlhbGl6YWJsZVByb3BlcnRpZXNbaV07CiAgICBpZiAob2JqW3Byb3BdID09PSB1bmRlZmluZWQgfHwgb2JqW3Byb3BdID09PSBjb29raWVEZWZhdWx0c1twcm9wXSkgewogICAgICBjb250aW51ZTsgLy8gbGVhdmUgYXMgcHJvdG90eXBlIGRlZmF1bHQKICAgIH0KCiAgICBpZiAocHJvcCA9PT0gImV4cGlyZXMiIHx8IHByb3AgPT09ICJjcmVhdGlvbiIgfHwgcHJvcCA9PT0gImxhc3RBY2Nlc3NlZCIpIHsKICAgICAgaWYgKG9ialtwcm9wXSA9PT0gbnVsbCkgewogICAgICAgIGNbcHJvcF0gPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIGNbcHJvcF0gPSBvYmpbcHJvcF0gPT0gIkluZmluaXR5IiA/ICJJbmZpbml0eSIgOiBuZXcgRGF0ZShvYmpbcHJvcF0pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjW3Byb3BdID0gb2JqW3Byb3BdOwogICAgfQogIH0KCiAgcmV0dXJuIGM7Cn0KCi8qIFNlY3Rpb24gNS40IHBhcnQgMjoKICogIiogIENvb2tpZXMgd2l0aCBsb25nZXIgcGF0aHMgYXJlIGxpc3RlZCBiZWZvcmUgY29va2llcyB3aXRoCiAqICAgICBzaG9ydGVyIHBhdGhzLgogKgogKiAgKiAgQW1vbmcgY29va2llcyB0aGF0IGhhdmUgZXF1YWwtbGVuZ3RoIHBhdGggZmllbGRzLCBjb29raWVzIHdpdGgKICogICAgIGVhcmxpZXIgY3JlYXRpb24tdGltZXMgYXJlIGxpc3RlZCBiZWZvcmUgY29va2llcyB3aXRoIGxhdGVyCiAqICAgICBjcmVhdGlvbi10aW1lcy4iCiAqLwoKZnVuY3Rpb24gY29va2llQ29tcGFyZShhLCBiKSB7CiAgdmFsaWRhdG9ycy52YWxpZGF0ZSh2YWxpZGF0b3JzLmlzT2JqZWN0KGEpLCBhKTsKICB2YWxpZGF0b3JzLnZhbGlkYXRlKHZhbGlkYXRvcnMuaXNPYmplY3QoYiksIGIpOwogIGxldCBjbXAgPSAwOwoKICAvLyBkZXNjZW5kaW5nIGZvciBsZW5ndGg6IGIgQ01QIGEKICBjb25zdCBhUGF0aExlbiA9IGEucGF0aCA/IGEucGF0aC5sZW5ndGggOiAwOwogIGNvbnN0IGJQYXRoTGVuID0gYi5wYXRoID8gYi5wYXRoLmxlbmd0aCA6IDA7CiAgY21wID0gYlBhdGhMZW4gLSBhUGF0aExlbjsKICBpZiAoY21wICE9PSAwKSB7CiAgICByZXR1cm4gY21wOwogIH0KCiAgLy8gYXNjZW5kaW5nIGZvciB0aW1lOiBhIENNUCBiCiAgY29uc3QgYVRpbWUgPSBhLmNyZWF0aW9uID8gYS5jcmVhdGlvbi5nZXRUaW1lKCkgOiBNQVhfVElNRTsKICBjb25zdCBiVGltZSA9IGIuY3JlYXRpb24gPyBiLmNyZWF0aW9uLmdldFRpbWUoKSA6IE1BWF9USU1FOwogIGNtcCA9IGFUaW1lIC0gYlRpbWU7CiAgaWYgKGNtcCAhPT0gMCkgewogICAgcmV0dXJuIGNtcDsKICB9CgogIC8vIGJyZWFrIHRpZXMgZm9yIHRoZSBzYW1lIG1pbGxpc2Vjb25kIChwcmVjaXNpb24gb2YgSmF2YVNjcmlwdCdzIGNsb2NrKQogIGNtcCA9IGEuY3JlYXRpb25JbmRleCAtIGIuY3JlYXRpb25JbmRleDsKCiAgcmV0dXJuIGNtcDsKfQoKZnVuY3Rpb24gZ2V0Q29va2llQ29udGV4dCh1cmwpIHsKICBpZiAodXJsIGluc3RhbmNlb2YgT2JqZWN0KSB7CiAgICByZXR1cm4gdXJsOwogIH0KICAvLyBOT1RFOiBkZWNvZGVVUkkgd2lsbCB0aHJvdyBvbiBtYWxmb3JtZWQgVVJJcyAoc2VlIEdILTMyKS4KICAvLyBUaGVyZWZvcmUsIHdlIHdpbGwganVzdCBza2lwIGRlY29kaW5nIGZvciBzdWNoIFVSSXMuCiAgdHJ5IHsKICAgIHVybCA9IGRlY29kZVVSSSh1cmwpOwogIH0gY2F0Y2ggKGVycikgewogICAgLy8gU2lsZW50bHkgc3dhbGxvdyBlcnJvcgogIH0KCiAgcmV0dXJuIHVybFBhcnNlKHVybCk7Cn0KCmNvbnN0IGNvb2tpZURlZmF1bHRzID0gewogIC8vIHRoZSBvcmRlciBpbiB3aGljaCB0aGUgUkZDIGhhcyB0aGVtOgogIGtleTogIiIsCiAgdmFsdWU6ICIiLAogIGV4cGlyZXM6ICJJbmZpbml0eSIsCiAgbWF4QWdlOiBudWxsLAogIGRvbWFpbjogbnVsbCwKICBwYXRoOiBudWxsLAogIHNlY3VyZTogZmFsc2UsCiAgaHR0cE9ubHk6IGZhbHNlLAogIGV4dGVuc2lvbnM6IG51bGwsCiAgLy8gc2V0IGJ5IHRoZSBDb29raWVKYXI6CiAgaG9zdE9ubHk6IG51bGwsCiAgcGF0aElzRGVmYXVsdDogbnVsbCwKICBjcmVhdGlvbjogbnVsbCwKICBsYXN0QWNjZXNzZWQ6IG51bGwsCiAgc2FtZVNpdGU6IHVuZGVmaW5lZAp9OwoKY2xhc3MgQ29va2llIHsKICBjb25zdHJ1Y3RvcihvcHRpb25zID0ge30pIHsKICAgIGNvbnN0IGN1c3RvbUluc3BlY3RTeW1ib2wgPSBnZXRDdXN0b21JbnNwZWN0U3ltYm9sKCk7CiAgICBpZiAoY3VzdG9tSW5zcGVjdFN5bWJvbCkgewogICAgICB0aGlzW2N1c3RvbUluc3BlY3RTeW1ib2xdID0gdGhpcy5pbnNwZWN0OwogICAgfQoKICAgIE9iamVjdC5hc3NpZ24odGhpcywgY29va2llRGVmYXVsdHMsIG9wdGlvbnMpOwogICAgdGhpcy5jcmVhdGlvbiA9IHRoaXMuY3JlYXRpb24gfHwgbmV3IERhdGUoKTsKCiAgICAvLyB1c2VkIHRvIGJyZWFrIGNyZWF0aW9uIHRpZXMgaW4gY29va2llQ29tcGFyZSgpOgogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICJjcmVhdGlvbkluZGV4IiwgewogICAgICBjb25maWd1cmFibGU6IGZhbHNlLAogICAgICBlbnVtZXJhYmxlOiBmYWxzZSwgLy8gaW1wb3J0YW50IGZvciBhc3NlcnQuZGVlcEVxdWFsIGNoZWNrcwogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgdmFsdWU6ICsrQ29va2llLmNvb2tpZXNDcmVhdGVkCiAgICB9KTsKICB9CgogIGluc3BlY3QoKSB7CiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpOwogICAgY29uc3QgaG9zdE9ubHkgPSB0aGlzLmhvc3RPbmx5ICE9IG51bGwgPyB0aGlzLmhvc3RPbmx5IDogIj8iOwogICAgY29uc3QgY3JlYXRlQWdlID0gdGhpcy5jcmVhdGlvbgogICAgICA/IGAke25vdyAtIHRoaXMuY3JlYXRpb24uZ2V0VGltZSgpfW1zYAogICAgICA6ICI/IjsKICAgIGNvbnN0IGFjY2Vzc0FnZSA9IHRoaXMubGFzdEFjY2Vzc2VkCiAgICAgID8gYCR7bm93IC0gdGhpcy5sYXN0QWNjZXNzZWQuZ2V0VGltZSgpfW1zYAogICAgICA6ICI/IjsKICAgIHJldHVybiBgQ29va2llPSIke3RoaXMudG9TdHJpbmcoKX07IGhvc3RPbmx5PSR7aG9zdE9ubHl9OyBhQWdlPSR7YWNjZXNzQWdlfTsgY0FnZT0ke2NyZWF0ZUFnZX0iYDsKICB9CgogIHRvSlNPTigpIHsKICAgIGNvbnN0IG9iaiA9IHt9OwoKICAgIGZvciAoY29uc3QgcHJvcCBvZiBDb29raWUuc2VyaWFsaXphYmxlUHJvcGVydGllcykgewogICAgICBpZiAodGhpc1twcm9wXSA9PT0gY29va2llRGVmYXVsdHNbcHJvcF0pIHsKICAgICAgICBjb250aW51ZTsgLy8gbGVhdmUgYXMgcHJvdG90eXBlIGRlZmF1bHQKICAgICAgfQoKICAgICAgaWYgKAogICAgICAgIHByb3AgPT09ICJleHBpcmVzIiB8fAogICAgICAgIHByb3AgPT09ICJjcmVhdGlvbiIgfHwKICAgICAgICBwcm9wID09PSAibGFzdEFjY2Vzc2VkIgogICAgICApIHsKICAgICAgICBpZiAodGhpc1twcm9wXSA9PT0gbnVsbCkgewogICAgICAgICAgb2JqW3Byb3BdID0gbnVsbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgb2JqW3Byb3BdID0KICAgICAgICAgICAgdGhpc1twcm9wXSA9PSAiSW5maW5pdHkiIC8vIGludGVudGlvbmFsbHkgbm90ID09PQogICAgICAgICAgICAgID8gIkluZmluaXR5IgogICAgICAgICAgICAgIDogdGhpc1twcm9wXS50b0lTT1N0cmluZygpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChwcm9wID09PSAibWF4QWdlIikgewogICAgICAgIGlmICh0aGlzW3Byb3BdICE9PSBudWxsKSB7CiAgICAgICAgICAvLyBhZ2FpbiwgaW50ZW50aW9uYWxseSBub3QgPT09CiAgICAgICAgICBvYmpbcHJvcF0gPQogICAgICAgICAgICB0aGlzW3Byb3BdID09IEluZmluaXR5IHx8IHRoaXNbcHJvcF0gPT0gLUluZmluaXR5CiAgICAgICAgICAgICAgPyB0aGlzW3Byb3BdLnRvU3RyaW5nKCkKICAgICAgICAgICAgICA6IHRoaXNbcHJvcF07CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmICh0aGlzW3Byb3BdICE9PSBjb29raWVEZWZhdWx0c1twcm9wXSkgewogICAgICAgICAgb2JqW3Byb3BdID0gdGhpc1twcm9wXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gb2JqOwogIH0KCiAgY2xvbmUoKSB7CiAgICByZXR1cm4gZnJvbUpTT04odGhpcy50b0pTT04oKSk7CiAgfQoKICB2YWxpZGF0ZSgpIHsKICAgIGlmICghQ09PS0lFX09DVEVUUy50ZXN0KHRoaXMudmFsdWUpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICgKICAgICAgdGhpcy5leHBpcmVzICE9IEluZmluaXR5ICYmCiAgICAgICEodGhpcy5leHBpcmVzIGluc3RhbmNlb2YgRGF0ZSkgJiYKICAgICAgIXBhcnNlRGF0ZSh0aGlzLmV4cGlyZXMpCiAgICApIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKHRoaXMubWF4QWdlICE9IG51bGwgJiYgdGhpcy5tYXhBZ2UgPD0gMCkgewogICAgICByZXR1cm4gZmFsc2U7IC8vICJNYXgtQWdlPSIgbm9uLXplcm8tZGlnaXQgKkRJR0lUCiAgICB9CiAgICBpZiAodGhpcy5wYXRoICE9IG51bGwgJiYgIVBBVEhfVkFMVUUudGVzdCh0aGlzLnBhdGgpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBjb25zdCBjZG9tYWluID0gdGhpcy5jZG9tYWluKCk7CiAgICBpZiAoY2RvbWFpbikgewogICAgICBpZiAoY2RvbWFpbi5tYXRjaCgvXC4kLykpIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIFM0LjEuMi4zIHN1Z2dlc3RzIHRoYXQgdGhpcyBpcyBiYWQuIGRvbWFpbk1hdGNoKCkgdGVzdHMgY29uZmlybSB0aGlzCiAgICAgIH0KICAgICAgY29uc3Qgc3VmZml4ID0gcHVic3VmZml4LmdldFB1YmxpY1N1ZmZpeChjZG9tYWluKTsKICAgICAgaWYgKHN1ZmZpeCA9PSBudWxsKSB7CiAgICAgICAgLy8gaXQncyBhIHB1YmxpYyBzdWZmaXgKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KCiAgc2V0RXhwaXJlcyhleHApIHsKICAgIGlmIChleHAgaW5zdGFuY2VvZiBEYXRlKSB7CiAgICAgIHRoaXMuZXhwaXJlcyA9IGV4cDsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZXhwaXJlcyA9IHBhcnNlRGF0ZShleHApIHx8ICJJbmZpbml0eSI7CiAgICB9CiAgfQoKICBzZXRNYXhBZ2UoYWdlKSB7CiAgICBpZiAoYWdlID09PSBJbmZpbml0eSB8fCBhZ2UgPT09IC1JbmZpbml0eSkgewogICAgICB0aGlzLm1heEFnZSA9IGFnZS50b1N0cmluZygpOyAvLyBzbyBKU09OLnN0cmluZ2lmeSgpIHdvcmtzCiAgICB9IGVsc2UgewogICAgICB0aGlzLm1heEFnZSA9IGFnZTsKICAgIH0KICB9CgogIGNvb2tpZVN0cmluZygpIHsKICAgIGxldCB2YWwgPSB0aGlzLnZhbHVlOwogICAgaWYgKHZhbCA9PSBudWxsKSB7CiAgICAgIHZhbCA9ICIiOwogICAgfQogICAgaWYgKHRoaXMua2V5ID09PSAiIikgewogICAgICByZXR1cm4gdmFsOwogICAgfQogICAgcmV0dXJuIGAke3RoaXMua2V5fT0ke3ZhbH1gOwogIH0KCiAgLy8gZ2l2ZXMgU2V0LUNvb2tpZSBoZWFkZXIgZm9ybWF0CiAgdG9TdHJpbmcoKSB7CiAgICBsZXQgc3RyID0gdGhpcy5jb29raWVTdHJpbmcoKTsKCiAgICBpZiAodGhpcy5leHBpcmVzICE9IEluZmluaXR5KSB7CiAgICAgIGlmICh0aGlzLmV4cGlyZXMgaW5zdGFuY2VvZiBEYXRlKSB7CiAgICAgICAgc3RyICs9IGA7IEV4cGlyZXM9JHtmb3JtYXREYXRlKHRoaXMuZXhwaXJlcyl9YDsKICAgICAgfSBlbHNlIHsKICAgICAgICBzdHIgKz0gYDsgRXhwaXJlcz0ke3RoaXMuZXhwaXJlc31gOwogICAgICB9CiAgICB9CgogICAgaWYgKHRoaXMubWF4QWdlICE9IG51bGwgJiYgdGhpcy5tYXhBZ2UgIT0gSW5maW5pdHkpIHsKICAgICAgc3RyICs9IGA7IE1heC1BZ2U9JHt0aGlzLm1heEFnZX1gOwogICAgfQoKICAgIGlmICh0aGlzLmRvbWFpbiAmJiAhdGhpcy5ob3N0T25seSkgewogICAgICBzdHIgKz0gYDsgRG9tYWluPSR7dGhpcy5kb21haW59YDsKICAgIH0KICAgIGlmICh0aGlzLnBhdGgpIHsKICAgICAgc3RyICs9IGA7IFBhdGg9JHt0aGlzLnBhdGh9YDsKICAgIH0KCiAgICBpZiAodGhpcy5zZWN1cmUpIHsKICAgICAgc3RyICs9ICI7IFNlY3VyZSI7CiAgICB9CiAgICBpZiAodGhpcy5odHRwT25seSkgewogICAgICBzdHIgKz0gIjsgSHR0cE9ubHkiOwogICAgfQogICAgaWYgKHRoaXMuc2FtZVNpdGUgJiYgdGhpcy5zYW1lU2l0ZSAhPT0gIm5vbmUiKSB7CiAgICAgIGNvbnN0IHNzQ2Fub24gPSBDb29raWUuc2FtZVNpdGVDYW5vbmljYWxbdGhpcy5zYW1lU2l0ZS50b0xvd2VyQ2FzZSgpXTsKICAgICAgc3RyICs9IGA7IFNhbWVTaXRlPSR7c3NDYW5vbiA/IHNzQ2Fub24gOiB0aGlzLnNhbWVTaXRlfWA7CiAgICB9CiAgICBpZiAodGhpcy5leHRlbnNpb25zKSB7CiAgICAgIHRoaXMuZXh0ZW5zaW9ucy5mb3JFYWNoKGV4dCA9PiB7CiAgICAgICAgc3RyICs9IGA7ICR7ZXh0fWA7CiAgICAgIH0pOwogICAgfQoKICAgIHJldHVybiBzdHI7CiAgfQoKICAvLyBUVEwoKSBwYXJ0aWFsbHkgcmVwbGFjZXMgdGhlICJleHBpcnktdGltZSIgcGFydHMgb2YgUzUuMyBzdGVwIDMgKHNldENvb2tpZSgpCiAgLy8gZWxzZXdoZXJlKQogIC8vIFM1LjMgc2F5cyB0byBnaXZlIHRoZSAibGF0ZXN0IHJlcHJlc2VudGFibGUgZGF0ZSIgZm9yIHdoaWNoIHdlIHVzZSBJbmZpbml0eQogIC8vIEZvciAiZXhwaXJlZCIgd2UgdXNlIDAKICBUVEwobm93KSB7CiAgICAvKiBSRkM2MjY1IFM0LjEuMi4yIElmIGEgY29va2llIGhhcyBib3RoIHRoZSBNYXgtQWdlIGFuZCB0aGUgRXhwaXJlcwogICAgICogYXR0cmlidXRlLCB0aGUgTWF4LUFnZSBhdHRyaWJ1dGUgaGFzIHByZWNlZGVuY2UgYW5kIGNvbnRyb2xzIHRoZQogICAgICogZXhwaXJhdGlvbiBkYXRlIG9mIHRoZSBjb29raWUuCiAgICAgKiAoQ29uY3VycyB3aXRoIFM1LjMgc3RlcCAzKQogICAgICovCiAgICBpZiAodGhpcy5tYXhBZ2UgIT0gbnVsbCkgewogICAgICByZXR1cm4gdGhpcy5tYXhBZ2UgPD0gMCA/IDAgOiB0aGlzLm1heEFnZSAqIDEwMDA7CiAgICB9CgogICAgbGV0IGV4cGlyZXMgPSB0aGlzLmV4cGlyZXM7CiAgICBpZiAoZXhwaXJlcyAhPSBJbmZpbml0eSkgewogICAgICBpZiAoIShleHBpcmVzIGluc3RhbmNlb2YgRGF0ZSkpIHsKICAgICAgICBleHBpcmVzID0gcGFyc2VEYXRlKGV4cGlyZXMpIHx8IEluZmluaXR5OwogICAgICB9CgogICAgICBpZiAoZXhwaXJlcyA9PSBJbmZpbml0eSkgewogICAgICAgIHJldHVybiBJbmZpbml0eTsKICAgICAgfQoKICAgICAgcmV0dXJuIGV4cGlyZXMuZ2V0VGltZSgpIC0gKG5vdyB8fCBEYXRlLm5vdygpKTsKICAgIH0KCiAgICByZXR1cm4gSW5maW5pdHk7CiAgfQoKICAvLyBleHBpcnlUaW1lKCkgcmVwbGFjZXMgdGhlICJleHBpcnktdGltZSIgcGFydHMgb2YgUzUuMyBzdGVwIDMgKHNldENvb2tpZSgpCiAgLy8gZWxzZXdoZXJlKQogIGV4cGlyeVRpbWUobm93KSB7CiAgICBpZiAodGhpcy5tYXhBZ2UgIT0gbnVsbCkgewogICAgICBjb25zdCByZWxhdGl2ZVRvID0gbm93IHx8IHRoaXMuY3JlYXRpb24gfHwgbmV3IERhdGUoKTsKICAgICAgY29uc3QgYWdlID0gdGhpcy5tYXhBZ2UgPD0gMCA/IC1JbmZpbml0eSA6IHRoaXMubWF4QWdlICogMTAwMDsKICAgICAgcmV0dXJuIHJlbGF0aXZlVG8uZ2V0VGltZSgpICsgYWdlOwogICAgfQoKICAgIGlmICh0aGlzLmV4cGlyZXMgPT0gSW5maW5pdHkpIHsKICAgICAgcmV0dXJuIEluZmluaXR5OwogICAgfQogICAgcmV0dXJuIHRoaXMuZXhwaXJlcy5nZXRUaW1lKCk7CiAgfQoKICAvLyBleHBpcnlEYXRlKCkgcmVwbGFjZXMgdGhlICJleHBpcnktdGltZSIgcGFydHMgb2YgUzUuMyBzdGVwIDMgKHNldENvb2tpZSgpCiAgLy8gZWxzZXdoZXJlKSwgZXhjZXB0IGl0IHJldHVybnMgYSBEYXRlCiAgZXhwaXJ5RGF0ZShub3cpIHsKICAgIGNvbnN0IG1pbGxpc2VjID0gdGhpcy5leHBpcnlUaW1lKG5vdyk7CiAgICBpZiAobWlsbGlzZWMgPT0gSW5maW5pdHkpIHsKICAgICAgcmV0dXJuIG5ldyBEYXRlKE1BWF9USU1FKTsKICAgIH0gZWxzZSBpZiAobWlsbGlzZWMgPT0gLUluZmluaXR5KSB7CiAgICAgIHJldHVybiBuZXcgRGF0ZShNSU5fVElNRSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gbmV3IERhdGUobWlsbGlzZWMpOwogICAgfQogIH0KCiAgLy8gVGhpcyByZXBsYWNlcyB0aGUgInBlcnNpc3RlbnQtZmxhZyIgcGFydHMgb2YgUzUuMyBzdGVwIDMKICBpc1BlcnNpc3RlbnQoKSB7CiAgICByZXR1cm4gdGhpcy5tYXhBZ2UgIT0gbnVsbCB8fCB0aGlzLmV4cGlyZXMgIT0gSW5maW5pdHk7CiAgfQoKICAvLyBNb3N0bHkgUzUuMS4yIGFuZCBTNS4yLjM6CiAgY2Fub25pY2FsaXplZERvbWFpbigpIHsKICAgIGlmICh0aGlzLmRvbWFpbiA9PSBudWxsKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgcmV0dXJuIGNhbm9uaWNhbERvbWFpbih0aGlzLmRvbWFpbik7CiAgfQoKICBjZG9tYWluKCkgewogICAgcmV0dXJuIHRoaXMuY2Fub25pY2FsaXplZERvbWFpbigpOwogIH0KfQoKQ29va2llLmNvb2tpZXNDcmVhdGVkID0gMDsKQ29va2llLnBhcnNlID0gcGFyc2UkSDsKQ29va2llLmZyb21KU09OID0gZnJvbUpTT047CkNvb2tpZS5zZXJpYWxpemFibGVQcm9wZXJ0aWVzID0gT2JqZWN0LmtleXMoY29va2llRGVmYXVsdHMpOwpDb29raWUuc2FtZVNpdGVMZXZlbCA9IHsKICBzdHJpY3Q6IDMsCiAgbGF4OiAyLAogIG5vbmU6IDEKfTsKCkNvb2tpZS5zYW1lU2l0ZUNhbm9uaWNhbCA9IHsKICBzdHJpY3Q6ICJTdHJpY3QiLAogIGxheDogIkxheCIKfTsKCmZ1bmN0aW9uIGdldE5vcm1hbGl6ZWRQcmVmaXhTZWN1cml0eShwcmVmaXhTZWN1cml0eSkgewogIGlmIChwcmVmaXhTZWN1cml0eSAhPSBudWxsKSB7CiAgICBjb25zdCBub3JtYWxpemVkUHJlZml4U2VjdXJpdHkgPSBwcmVmaXhTZWN1cml0eS50b0xvd2VyQ2FzZSgpOwogICAgLyogVGhlIHRocmVlIHN1cHBvcnRlZCBvcHRpb25zICovCiAgICBzd2l0Y2ggKG5vcm1hbGl6ZWRQcmVmaXhTZWN1cml0eSkgewogICAgICBjYXNlIFByZWZpeFNlY3VyaXR5RW51bS5TVFJJQ1Q6CiAgICAgIGNhc2UgUHJlZml4U2VjdXJpdHlFbnVtLlNJTEVOVDoKICAgICAgY2FzZSBQcmVmaXhTZWN1cml0eUVudW0uRElTQUJMRUQ6CiAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZWRQcmVmaXhTZWN1cml0eTsKICAgIH0KICB9CiAgLyogRGVmYXVsdCBpcyBTSUxFTlQgKi8KICByZXR1cm4gUHJlZml4U2VjdXJpdHlFbnVtLlNJTEVOVDsKfQoKY2xhc3MgQ29va2llSmFyIHsKICBjb25zdHJ1Y3RvcihzdG9yZSwgb3B0aW9ucyA9IHsgcmVqZWN0UHVibGljU3VmZml4ZXM6IHRydWUgfSkgewogICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAiYm9vbGVhbiIpIHsKICAgICAgb3B0aW9ucyA9IHsgcmVqZWN0UHVibGljU3VmZml4ZXM6IG9wdGlvbnMgfTsKICAgIH0KICAgIHZhbGlkYXRvcnMudmFsaWRhdGUodmFsaWRhdG9ycy5pc09iamVjdChvcHRpb25zKSwgb3B0aW9ucyk7CiAgICB0aGlzLnJlamVjdFB1YmxpY1N1ZmZpeGVzID0gb3B0aW9ucy5yZWplY3RQdWJsaWNTdWZmaXhlczsKICAgIHRoaXMuZW5hYmxlTG9vc2VNb2RlID0gISFvcHRpb25zLmxvb3NlTW9kZTsKICAgIHRoaXMuYWxsb3dTcGVjaWFsVXNlRG9tYWluID0KICAgICAgdHlwZW9mIG9wdGlvbnMuYWxsb3dTcGVjaWFsVXNlRG9tYWluID09PSAiYm9vbGVhbiIKICAgICAgICA/IG9wdGlvbnMuYWxsb3dTcGVjaWFsVXNlRG9tYWluCiAgICAgICAgOiB0cnVlOwogICAgdGhpcy5zdG9yZSA9IHN0b3JlIHx8IG5ldyBNZW1vcnlDb29raWVTdG9yZSgpOwogICAgdGhpcy5wcmVmaXhTZWN1cml0eSA9IGdldE5vcm1hbGl6ZWRQcmVmaXhTZWN1cml0eShvcHRpb25zLnByZWZpeFNlY3VyaXR5KTsKICAgIHRoaXMuX2Nsb25lU3luYyA9IHN5bmNXcmFwKCJjbG9uZSIpOwogICAgdGhpcy5faW1wb3J0Q29va2llc1N5bmMgPSBzeW5jV3JhcCgiX2ltcG9ydENvb2tpZXMiKTsKICAgIHRoaXMuZ2V0Q29va2llc1N5bmMgPSBzeW5jV3JhcCgiZ2V0Q29va2llcyIpOwogICAgdGhpcy5nZXRDb29raWVTdHJpbmdTeW5jID0gc3luY1dyYXAoImdldENvb2tpZVN0cmluZyIpOwogICAgdGhpcy5nZXRTZXRDb29raWVTdHJpbmdzU3luYyA9IHN5bmNXcmFwKCJnZXRTZXRDb29raWVTdHJpbmdzIik7CiAgICB0aGlzLnJlbW92ZUFsbENvb2tpZXNTeW5jID0gc3luY1dyYXAoInJlbW92ZUFsbENvb2tpZXMiKTsKICAgIHRoaXMuc2V0Q29va2llU3luYyA9IHN5bmNXcmFwKCJzZXRDb29raWUiKTsKICAgIHRoaXMuc2VyaWFsaXplU3luYyA9IHN5bmNXcmFwKCJzZXJpYWxpemUiKTsKICB9CgogIHNldENvb2tpZShjb29raWUsIHVybCwgb3B0aW9ucywgY2IpIHsKICAgIHZhbGlkYXRvcnMudmFsaWRhdGUodmFsaWRhdG9ycy5pc05vbkVtcHR5U3RyaW5nKHVybCksIGNiLCBvcHRpb25zKTsKICAgIGxldCBlcnI7CgogICAgaWYgKHZhbGlkYXRvcnMuaXNGdW5jdGlvbih1cmwpKSB7CiAgICAgIGNiID0gdXJsOwogICAgICByZXR1cm4gY2IobmV3IEVycm9yKCJObyBVUkwgd2FzIHNwZWNpZmllZCIpKTsKICAgIH0KCiAgICBjb25zdCBjb250ZXh0ID0gZ2V0Q29va2llQ29udGV4dCh1cmwpOwogICAgaWYgKHZhbGlkYXRvcnMuaXNGdW5jdGlvbihvcHRpb25zKSkgewogICAgICBjYiA9IG9wdGlvbnM7CiAgICAgIG9wdGlvbnMgPSB7fTsKICAgIH0KCiAgICB2YWxpZGF0b3JzLnZhbGlkYXRlKHZhbGlkYXRvcnMuaXNGdW5jdGlvbihjYiksIGNiKTsKCiAgICBpZiAoCiAgICAgICF2YWxpZGF0b3JzLmlzTm9uRW1wdHlTdHJpbmcoY29va2llKSAmJgogICAgICAhdmFsaWRhdG9ycy5pc09iamVjdChjb29raWUpICYmCiAgICAgIGNvb2tpZSBpbnN0YW5jZW9mIFN0cmluZyAmJgogICAgICBjb29raWUubGVuZ3RoID09IDAKICAgICkgewogICAgICByZXR1cm4gY2IobnVsbCk7CiAgICB9CgogICAgY29uc3QgaG9zdCA9IGNhbm9uaWNhbERvbWFpbihjb250ZXh0Lmhvc3RuYW1lKTsKICAgIGNvbnN0IGxvb3NlID0gb3B0aW9ucy5sb29zZSB8fCB0aGlzLmVuYWJsZUxvb3NlTW9kZTsKCiAgICBsZXQgc2FtZVNpdGVDb250ZXh0ID0gbnVsbDsKICAgIGlmIChvcHRpb25zLnNhbWVTaXRlQ29udGV4dCkgewogICAgICBzYW1lU2l0ZUNvbnRleHQgPSBjaGVja1NhbWVTaXRlQ29udGV4dChvcHRpb25zLnNhbWVTaXRlQ29udGV4dCk7CiAgICAgIGlmICghc2FtZVNpdGVDb250ZXh0KSB7CiAgICAgICAgcmV0dXJuIGNiKG5ldyBFcnJvcihTQU1FX1NJVEVfQ09OVEVYVF9WQUxfRVJSKSk7CiAgICAgIH0KICAgIH0KCiAgICAvLyBTNS4zIHN0ZXAgMQogICAgaWYgKHR5cGVvZiBjb29raWUgPT09ICJzdHJpbmciIHx8IGNvb2tpZSBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICBjb29raWUgPSBDb29raWUucGFyc2UoY29va2llLCB7IGxvb3NlOiBsb29zZSB9KTsKICAgICAgaWYgKCFjb29raWUpIHsKICAgICAgICBlcnIgPSBuZXcgRXJyb3IoIkNvb2tpZSBmYWlsZWQgdG8gcGFyc2UiKTsKICAgICAgICByZXR1cm4gY2Iob3B0aW9ucy5pZ25vcmVFcnJvciA/IG51bGwgOiBlcnIpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKCEoY29va2llIGluc3RhbmNlb2YgQ29va2llKSkgewogICAgICAvLyBJZiB5b3UncmUgc2VlaW5nIHRoaXMgZXJyb3IsIGFuZCBhcmUgcGFzc2luZyBpbiBhIENvb2tpZSBvYmplY3QsCiAgICAgIC8vIGl0ICptaWdodCogYmUgYSBDb29raWUgb2JqZWN0IGZyb20gYW5vdGhlciBsb2FkZWQgdmVyc2lvbiBvZiB0b3VnaC1jb29raWUuCiAgICAgIGVyciA9IG5ldyBFcnJvcigKICAgICAgICAiRmlyc3QgYXJndW1lbnQgdG8gc2V0Q29va2llIG11c3QgYmUgYSBDb29raWUgb2JqZWN0IG9yIHN0cmluZyIKICAgICAgKTsKICAgICAgcmV0dXJuIGNiKG9wdGlvbnMuaWdub3JlRXJyb3IgPyBudWxsIDogZXJyKTsKICAgIH0KCiAgICAvLyBTNS4zIHN0ZXAgMgogICAgY29uc3Qgbm93ID0gb3B0aW9ucy5ub3cgfHwgbmV3IERhdGUoKTsgLy8gd2lsbCBhc3NpZ24gbGF0ZXIgdG8gc2F2ZSBlZmZvcnQgaW4gdGhlIGZhY2Ugb2YgZXJyb3JzCgogICAgLy8gUzUuMyBzdGVwIDM6IE5PT1A7IHBlcnNpc3RlbnQtZmxhZyBhbmQgZXhwaXJ5LXRpbWUgaXMgaGFuZGxlZCBieSBnZXRDb29raWUoKQoKICAgIC8vIFM1LjMgc3RlcCA0OiBOT09QOyBkb21haW4gaXMgbnVsbCBieSBkZWZhdWx0CgogICAgLy8gUzUuMyBzdGVwIDU6IHB1YmxpYyBzdWZmaXhlcwogICAgaWYgKHRoaXMucmVqZWN0UHVibGljU3VmZml4ZXMgJiYgY29va2llLmRvbWFpbikgewogICAgICBjb25zdCBzdWZmaXggPSBwdWJzdWZmaXguZ2V0UHVibGljU3VmZml4KGNvb2tpZS5jZG9tYWluKCksIHsKICAgICAgICBhbGxvd1NwZWNpYWxVc2VEb21haW46IHRoaXMuYWxsb3dTcGVjaWFsVXNlRG9tYWluLAogICAgICAgIGlnbm9yZUVycm9yOiBvcHRpb25zLmlnbm9yZUVycm9yCiAgICAgIH0pOwogICAgICBpZiAoc3VmZml4ID09IG51bGwgJiYgIUlQX1Y2X1JFR0VYX09CSkVDVC50ZXN0KGNvb2tpZS5kb21haW4pKSB7CiAgICAgICAgLy8gZS5nLiAiY29tIgogICAgICAgIGVyciA9IG5ldyBFcnJvcigiQ29va2llIGhhcyBkb21haW4gc2V0IHRvIGEgcHVibGljIHN1ZmZpeCIpOwogICAgICAgIHJldHVybiBjYihvcHRpb25zLmlnbm9yZUVycm9yID8gbnVsbCA6IGVycik7CiAgICAgIH0KICAgIH0KCiAgICAvLyBTNS4zIHN0ZXAgNjoKICAgIGlmIChjb29raWUuZG9tYWluKSB7CiAgICAgIGlmICghZG9tYWluTWF0Y2goaG9zdCwgY29va2llLmNkb21haW4oKSwgZmFsc2UpKSB7CiAgICAgICAgZXJyID0gbmV3IEVycm9yKAogICAgICAgICAgYENvb2tpZSBub3QgaW4gdGhpcyBob3N0J3MgZG9tYWluLiBDb29raWU6JHtjb29raWUuY2RvbWFpbigpfSBSZXF1ZXN0OiR7aG9zdH1gCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gY2Iob3B0aW9ucy5pZ25vcmVFcnJvciA/IG51bGwgOiBlcnIpOwogICAgICB9CgogICAgICBpZiAoY29va2llLmhvc3RPbmx5ID09IG51bGwpIHsKICAgICAgICAvLyBkb24ndCByZXNldCBpZiBhbHJlYWR5IHNldAogICAgICAgIGNvb2tpZS5ob3N0T25seSA9IGZhbHNlOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjb29raWUuaG9zdE9ubHkgPSB0cnVlOwogICAgICBjb29raWUuZG9tYWluID0gaG9zdDsKICAgIH0KCiAgICAvL1M1LjIuNCBJZiB0aGUgYXR0cmlidXRlLXZhbHVlIGlzIGVtcHR5IG9yIGlmIHRoZSBmaXJzdCBjaGFyYWN0ZXIgb2YgdGhlCiAgICAvL2F0dHJpYnV0ZS12YWx1ZSBpcyBub3QgJXgyRiAoIi8iKToKICAgIC8vTGV0IGNvb2tpZS1wYXRoIGJlIHRoZSBkZWZhdWx0LXBhdGguCiAgICBpZiAoIWNvb2tpZS5wYXRoIHx8IGNvb2tpZS5wYXRoWzBdICE9PSAiLyIpIHsKICAgICAgY29va2llLnBhdGggPSBkZWZhdWx0UGF0aChjb250ZXh0LnBhdGhuYW1lKTsKICAgICAgY29va2llLnBhdGhJc0RlZmF1bHQgPSB0cnVlOwogICAgfQoKICAgIC8vIFM1LjMgc3RlcCA4OiBOT09QOyBzZWN1cmUgYXR0cmlidXRlCiAgICAvLyBTNS4zIHN0ZXAgOTogTk9PUDsgaHR0cE9ubHkgYXR0cmlidXRlCgogICAgLy8gUzUuMyBzdGVwIDEwCiAgICBpZiAob3B0aW9ucy5odHRwID09PSBmYWxzZSAmJiBjb29raWUuaHR0cE9ubHkpIHsKICAgICAgZXJyID0gbmV3IEVycm9yKCJDb29raWUgaXMgSHR0cE9ubHkgYW5kIHRoaXMgaXNuJ3QgYW4gSFRUUCBBUEkiKTsKICAgICAgcmV0dXJuIGNiKG9wdGlvbnMuaWdub3JlRXJyb3IgPyBudWxsIDogZXJyKTsKICAgIH0KCiAgICAvLyA2MjUyYmlzLTAyIFM1LjQgU3RlcCAxMyAmIDE0OgogICAgaWYgKAogICAgICBjb29raWUuc2FtZVNpdGUgIT09ICJub25lIiAmJgogICAgICBjb29raWUuc2FtZVNpdGUgIT09IHVuZGVmaW5lZCAmJgogICAgICBzYW1lU2l0ZUNvbnRleHQKICAgICkgewogICAgICAvLyAiSWYgdGhlIGNvb2tpZSdzICJzYW1lLXNpdGUtZmxhZyIgaXMgbm90ICJOb25lIiwgYW5kIHRoZSBjb29raWUKICAgICAgLy8gIGlzIGJlaW5nIHNldCBmcm9tIGEgY29udGV4dCB3aG9zZSAic2l0ZSBmb3IgY29va2llcyIgaXMgbm90IGFuCiAgICAgIC8vICBleGFjdCBtYXRjaCBmb3IgcmVxdWVzdC11cmkncyBob3N0J3MgcmVnaXN0ZXJlZCBkb21haW4sIHRoZW4KICAgICAgLy8gIGFib3J0IHRoZXNlIHN0ZXBzIGFuZCBpZ25vcmUgdGhlIG5ld2x5IGNyZWF0ZWQgY29va2llIGVudGlyZWx5LiIKICAgICAgaWYgKHNhbWVTaXRlQ29udGV4dCA9PT0gIm5vbmUiKSB7CiAgICAgICAgZXJyID0gbmV3IEVycm9yKAogICAgICAgICAgIkNvb2tpZSBpcyBTYW1lU2l0ZSBidXQgdGhpcyBpcyBhIGNyb3NzLW9yaWdpbiByZXF1ZXN0IgogICAgICAgICk7CiAgICAgICAgcmV0dXJuIGNiKG9wdGlvbnMuaWdub3JlRXJyb3IgPyBudWxsIDogZXJyKTsKICAgICAgfQogICAgfQoKICAgIC8qIDYyNjViaXMtMDIgUzUuNCBTdGVwcyAxNSAmIDE2ICovCiAgICBjb25zdCBpZ25vcmVFcnJvckZvclByZWZpeFNlY3VyaXR5ID0KICAgICAgdGhpcy5wcmVmaXhTZWN1cml0eSA9PT0gUHJlZml4U2VjdXJpdHlFbnVtLlNJTEVOVDsKICAgIGNvbnN0IHByZWZpeFNlY3VyaXR5RGlzYWJsZWQgPQogICAgICB0aGlzLnByZWZpeFNlY3VyaXR5ID09PSBQcmVmaXhTZWN1cml0eUVudW0uRElTQUJMRUQ7CiAgICAvKiBJZiBwcmVmaXggY2hlY2tpbmcgaXMgbm90IGRpc2FibGVkIC4uLiovCiAgICBpZiAoIXByZWZpeFNlY3VyaXR5RGlzYWJsZWQpIHsKICAgICAgbGV0IGVycm9yRm91bmQgPSBmYWxzZTsKICAgICAgbGV0IGVycm9yTXNnOwogICAgICAvKiBDaGVjayBzZWN1cmUgcHJlZml4IGNvbmRpdGlvbiAqLwogICAgICBpZiAoIWlzU2VjdXJlUHJlZml4Q29uZGl0aW9uTWV0KGNvb2tpZSkpIHsKICAgICAgICBlcnJvckZvdW5kID0gdHJ1ZTsKICAgICAgICBlcnJvck1zZyA9ICJDb29raWUgaGFzIF9fU2VjdXJlIHByZWZpeCBidXQgU2VjdXJlIGF0dHJpYnV0ZSBpcyBub3Qgc2V0IjsKICAgICAgfSBlbHNlIGlmICghaXNIb3N0UHJlZml4Q29uZGl0aW9uTWV0KGNvb2tpZSkpIHsKICAgICAgICAvKiBDaGVjayBob3N0IHByZWZpeCBjb25kaXRpb24gKi8KICAgICAgICBlcnJvckZvdW5kID0gdHJ1ZTsKICAgICAgICBlcnJvck1zZyA9CiAgICAgICAgICAiQ29va2llIGhhcyBfX0hvc3QgcHJlZml4IGJ1dCBlaXRoZXIgU2VjdXJlIG9yIEhvc3RPbmx5IGF0dHJpYnV0ZSBpcyBub3Qgc2V0IG9yIFBhdGggaXMgbm90ICcvJyI7CiAgICAgIH0KICAgICAgaWYgKGVycm9yRm91bmQpIHsKICAgICAgICByZXR1cm4gY2IoCiAgICAgICAgICBvcHRpb25zLmlnbm9yZUVycm9yIHx8IGlnbm9yZUVycm9yRm9yUHJlZml4U2VjdXJpdHkKICAgICAgICAgICAgPyBudWxsCiAgICAgICAgICAgIDogbmV3IEVycm9yKGVycm9yTXNnKQogICAgICAgICk7CiAgICAgIH0KICAgIH0KCiAgICBjb25zdCBzdG9yZSA9IHRoaXMuc3RvcmU7CgogICAgaWYgKCFzdG9yZS51cGRhdGVDb29raWUpIHsKICAgICAgc3RvcmUudXBkYXRlQ29va2llID0gZnVuY3Rpb24ob2xkQ29va2llLCBuZXdDb29raWUsIGNiKSB7CiAgICAgICAgdGhpcy5wdXRDb29raWUobmV3Q29va2llLCBjYik7CiAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gd2l0aENvb2tpZShlcnIsIG9sZENvb2tpZSkgewogICAgICBpZiAoZXJyKSB7CiAgICAgICAgcmV0dXJuIGNiKGVycik7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5leHQgPSBmdW5jdGlvbihlcnIpIHsKICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICByZXR1cm4gY2IoZXJyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2IobnVsbCwgY29va2llKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAob2xkQ29va2llKSB7CiAgICAgICAgLy8gUzUuMyBzdGVwIDExIC0gIklmIHRoZSBjb29raWUgc3RvcmUgY29udGFpbnMgYSBjb29raWUgd2l0aCB0aGUgc2FtZSBuYW1lLAogICAgICAgIC8vIGRvbWFpbiwgYW5kIHBhdGggYXMgdGhlIG5ld2x5IGNyZWF0ZWQgY29va2llOiIKICAgICAgICBpZiAob3B0aW9ucy5odHRwID09PSBmYWxzZSAmJiBvbGRDb29raWUuaHR0cE9ubHkpIHsKICAgICAgICAgIC8vIHN0ZXAgMTEuMgogICAgICAgICAgZXJyID0gbmV3IEVycm9yKCJvbGQgQ29va2llIGlzIEh0dHBPbmx5IGFuZCB0aGlzIGlzbid0IGFuIEhUVFAgQVBJIik7CiAgICAgICAgICByZXR1cm4gY2Iob3B0aW9ucy5pZ25vcmVFcnJvciA/IG51bGwgOiBlcnIpOwogICAgICAgIH0KICAgICAgICBjb29raWUuY3JlYXRpb24gPSBvbGRDb29raWUuY3JlYXRpb247IC8vIHN0ZXAgMTEuMwogICAgICAgIGNvb2tpZS5jcmVhdGlvbkluZGV4ID0gb2xkQ29va2llLmNyZWF0aW9uSW5kZXg7IC8vIHByZXNlcnZlIHRpZS1icmVha2VyCiAgICAgICAgY29va2llLmxhc3RBY2Nlc3NlZCA9IG5vdzsKICAgICAgICAvLyBTdGVwIDExLjQgKGRlbGV0ZSBjb29raWUpIGlzIGltcGxpZWQgYnkganVzdCBzZXR0aW5nIHRoZSBuZXcgb25lOgogICAgICAgIHN0b3JlLnVwZGF0ZUNvb2tpZShvbGRDb29raWUsIGNvb2tpZSwgbmV4dCk7IC8vIHN0ZXAgMTIKICAgICAgfSBlbHNlIHsKICAgICAgICBjb29raWUuY3JlYXRpb24gPSBjb29raWUubGFzdEFjY2Vzc2VkID0gbm93OwogICAgICAgIHN0b3JlLnB1dENvb2tpZShjb29raWUsIG5leHQpOyAvLyBzdGVwIDEyCiAgICAgIH0KICAgIH0KCiAgICBzdG9yZS5maW5kQ29va2llKGNvb2tpZS5kb21haW4sIGNvb2tpZS5wYXRoLCBjb29raWUua2V5LCB3aXRoQ29va2llKTsKICB9CgogIC8vIFJGQzYzNjUgUzUuNAogIGdldENvb2tpZXModXJsLCBvcHRpb25zLCBjYikgewogICAgdmFsaWRhdG9ycy52YWxpZGF0ZSh2YWxpZGF0b3JzLmlzTm9uRW1wdHlTdHJpbmcodXJsKSwgY2IsIHVybCk7CiAgICBjb25zdCBjb250ZXh0ID0gZ2V0Q29va2llQ29udGV4dCh1cmwpOwogICAgaWYgKHZhbGlkYXRvcnMuaXNGdW5jdGlvbihvcHRpb25zKSkgewogICAgICBjYiA9IG9wdGlvbnM7CiAgICAgIG9wdGlvbnMgPSB7fTsKICAgIH0KICAgIHZhbGlkYXRvcnMudmFsaWRhdGUodmFsaWRhdG9ycy5pc09iamVjdChvcHRpb25zKSwgY2IsIG9wdGlvbnMpOwogICAgdmFsaWRhdG9ycy52YWxpZGF0ZSh2YWxpZGF0b3JzLmlzRnVuY3Rpb24oY2IpLCBjYik7CgogICAgY29uc3QgaG9zdCA9IGNhbm9uaWNhbERvbWFpbihjb250ZXh0Lmhvc3RuYW1lKTsKICAgIGNvbnN0IHBhdGggPSBjb250ZXh0LnBhdGhuYW1lIHx8ICIvIjsKCiAgICBsZXQgc2VjdXJlID0gb3B0aW9ucy5zZWN1cmU7CiAgICBpZiAoCiAgICAgIHNlY3VyZSA9PSBudWxsICYmCiAgICAgIGNvbnRleHQucHJvdG9jb2wgJiYKICAgICAgKGNvbnRleHQucHJvdG9jb2wgPT0gImh0dHBzOiIgfHwgY29udGV4dC5wcm90b2NvbCA9PSAid3NzOiIpCiAgICApIHsKICAgICAgc2VjdXJlID0gdHJ1ZTsKICAgIH0KCiAgICBsZXQgc2FtZVNpdGVMZXZlbCA9IDA7CiAgICBpZiAob3B0aW9ucy5zYW1lU2l0ZUNvbnRleHQpIHsKICAgICAgY29uc3Qgc2FtZVNpdGVDb250ZXh0ID0gY2hlY2tTYW1lU2l0ZUNvbnRleHQob3B0aW9ucy5zYW1lU2l0ZUNvbnRleHQpOwogICAgICBzYW1lU2l0ZUxldmVsID0gQ29va2llLnNhbWVTaXRlTGV2ZWxbc2FtZVNpdGVDb250ZXh0XTsKICAgICAgaWYgKCFzYW1lU2l0ZUxldmVsKSB7CiAgICAgICAgcmV0dXJuIGNiKG5ldyBFcnJvcihTQU1FX1NJVEVfQ09OVEVYVF9WQUxfRVJSKSk7CiAgICAgIH0KICAgIH0KCiAgICBsZXQgaHR0cCA9IG9wdGlvbnMuaHR0cDsKICAgIGlmIChodHRwID09IG51bGwpIHsKICAgICAgaHR0cCA9IHRydWU7CiAgICB9CgogICAgY29uc3Qgbm93ID0gb3B0aW9ucy5ub3cgfHwgRGF0ZS5ub3coKTsKICAgIGNvbnN0IGV4cGlyZUNoZWNrID0gb3B0aW9ucy5leHBpcmUgIT09IGZhbHNlOwogICAgY29uc3QgYWxsUGF0aHMgPSAhIW9wdGlvbnMuYWxsUGF0aHM7CiAgICBjb25zdCBzdG9yZSA9IHRoaXMuc3RvcmU7CgogICAgZnVuY3Rpb24gbWF0Y2hpbmdDb29raWUoYykgewogICAgICAvLyAiRWl0aGVyOgogICAgICAvLyAgIFRoZSBjb29raWUncyBob3N0LW9ubHktZmxhZyBpcyB0cnVlIGFuZCB0aGUgY2Fub25pY2FsaXplZAogICAgICAvLyAgIHJlcXVlc3QtaG9zdCBpcyBpZGVudGljYWwgdG8gdGhlIGNvb2tpZSdzIGRvbWFpbi4KICAgICAgLy8gT3I6CiAgICAgIC8vICAgVGhlIGNvb2tpZSdzIGhvc3Qtb25seS1mbGFnIGlzIGZhbHNlIGFuZCB0aGUgY2Fub25pY2FsaXplZAogICAgICAvLyAgIHJlcXVlc3QtaG9zdCBkb21haW4tbWF0Y2hlcyB0aGUgY29va2llJ3MgZG9tYWluLiIKICAgICAgaWYgKGMuaG9zdE9ubHkpIHsKICAgICAgICBpZiAoYy5kb21haW4gIT0gaG9zdCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoIWRvbWFpbk1hdGNoKGhvc3QsIGMuZG9tYWluLCBmYWxzZSkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vICJUaGUgcmVxdWVzdC11cmkncyBwYXRoIHBhdGgtbWF0Y2hlcyB0aGUgY29va2llJ3MgcGF0aC4iCiAgICAgIGlmICghYWxsUGF0aHMgJiYgIXBhdGhNYXRjaChwYXRoLCBjLnBhdGgpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICAvLyAiSWYgdGhlIGNvb2tpZSdzIHNlY3VyZS1vbmx5LWZsYWcgaXMgdHJ1ZSwgdGhlbiB0aGUgcmVxdWVzdC11cmkncwogICAgICAvLyBzY2hlbWUgbXVzdCBkZW5vdGUgYSAic2VjdXJlIiBwcm90b2NvbCIKICAgICAgaWYgKGMuc2VjdXJlICYmICFzZWN1cmUpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIC8vICJJZiB0aGUgY29va2llJ3MgaHR0cC1vbmx5LWZsYWcgaXMgdHJ1ZSwgdGhlbiBleGNsdWRlIHRoZSBjb29raWUgaWYgdGhlCiAgICAgIC8vIGNvb2tpZS1zdHJpbmcgaXMgYmVpbmcgZ2VuZXJhdGVkIGZvciBhICJub24tSFRUUCIgQVBJIgogICAgICBpZiAoYy5odHRwT25seSAmJiAhaHR0cCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgLy8gUkZDNjI2NWJpcy0wMiBTNS4zLjcKICAgICAgaWYgKHNhbWVTaXRlTGV2ZWwpIHsKICAgICAgICBjb25zdCBjb29raWVMZXZlbCA9IENvb2tpZS5zYW1lU2l0ZUxldmVsW2Muc2FtZVNpdGUgfHwgIm5vbmUiXTsKICAgICAgICBpZiAoY29va2llTGV2ZWwgPiBzYW1lU2l0ZUxldmVsKSB7CiAgICAgICAgICAvLyBvbmx5IGFsbG93IGNvb2tpZXMgYXQgb3IgYmVsb3cgdGhlIHJlcXVlc3QgbGV2ZWwKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIGRlZmVycmVkIGZyb20gUzUuMwogICAgICAvLyBub24tUkZDOiBhbGxvdyByZXRlbnRpb24gb2YgZXhwaXJlZCBjb29raWVzIGJ5IGNob2ljZQogICAgICBpZiAoZXhwaXJlQ2hlY2sgJiYgYy5leHBpcnlUaW1lKCkgPD0gbm93KSB7CiAgICAgICAgc3RvcmUucmVtb3ZlQ29va2llKGMuZG9tYWluLCBjLnBhdGgsIGMua2V5LCAoKSA9PiB7fSk7IC8vIHJlc3VsdCBpZ25vcmVkCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBzdG9yZS5maW5kQ29va2llcygKICAgICAgaG9zdCwKICAgICAgYWxsUGF0aHMgPyBudWxsIDogcGF0aCwKICAgICAgdGhpcy5hbGxvd1NwZWNpYWxVc2VEb21haW4sCiAgICAgIChlcnIsIGNvb2tpZXMpID0+IHsKICAgICAgICBpZiAoZXJyKSB7CiAgICAgICAgICByZXR1cm4gY2IoZXJyKTsKICAgICAgICB9CgogICAgICAgIGNvb2tpZXMgPSBjb29raWVzLmZpbHRlcihtYXRjaGluZ0Nvb2tpZSk7CgogICAgICAgIC8vIHNvcnRpbmcgb2YgUzUuNCBwYXJ0IDIKICAgICAgICBpZiAob3B0aW9ucy5zb3J0ICE9PSBmYWxzZSkgewogICAgICAgICAgY29va2llcyA9IGNvb2tpZXMuc29ydChjb29raWVDb21wYXJlKTsKICAgICAgICB9CgogICAgICAgIC8vIFM1LjQgcGFydCAzCiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTsKICAgICAgICBmb3IgKGNvbnN0IGNvb2tpZSBvZiBjb29raWVzKSB7CiAgICAgICAgICBjb29raWUubGFzdEFjY2Vzc2VkID0gbm93OwogICAgICAgIH0KICAgICAgICAvLyBUT0RPIHBlcnNpc3QgbGFzdEFjY2Vzc2VkCgogICAgICAgIGNiKG51bGwsIGNvb2tpZXMpOwogICAgICB9CiAgICApOwogIH0KCiAgZ2V0Q29va2llU3RyaW5nKC4uLmFyZ3MpIHsKICAgIGNvbnN0IGNiID0gYXJncy5wb3AoKTsKICAgIHZhbGlkYXRvcnMudmFsaWRhdGUodmFsaWRhdG9ycy5pc0Z1bmN0aW9uKGNiKSwgY2IpOwogICAgY29uc3QgbmV4dCA9IGZ1bmN0aW9uKGVyciwgY29va2llcykgewogICAgICBpZiAoZXJyKSB7CiAgICAgICAgY2IoZXJyKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjYigKICAgICAgICAgIG51bGwsCiAgICAgICAgICBjb29raWVzCiAgICAgICAgICAgIC5zb3J0KGNvb2tpZUNvbXBhcmUpCiAgICAgICAgICAgIC5tYXAoYyA9PiBjLmNvb2tpZVN0cmluZygpKQogICAgICAgICAgICAuam9pbigiOyAiKQogICAgICAgICk7CiAgICAgIH0KICAgIH07CiAgICBhcmdzLnB1c2gobmV4dCk7CiAgICB0aGlzLmdldENvb2tpZXMuYXBwbHkodGhpcywgYXJncyk7CiAgfQoKICBnZXRTZXRDb29raWVTdHJpbmdzKC4uLmFyZ3MpIHsKICAgIGNvbnN0IGNiID0gYXJncy5wb3AoKTsKICAgIHZhbGlkYXRvcnMudmFsaWRhdGUodmFsaWRhdG9ycy5pc0Z1bmN0aW9uKGNiKSwgY2IpOwogICAgY29uc3QgbmV4dCA9IGZ1bmN0aW9uKGVyciwgY29va2llcykgewogICAgICBpZiAoZXJyKSB7CiAgICAgICAgY2IoZXJyKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjYigKICAgICAgICAgIG51bGwsCiAgICAgICAgICBjb29raWVzLm1hcChjID0+IHsKICAgICAgICAgICAgcmV0dXJuIGMudG9TdHJpbmcoKTsKICAgICAgICAgIH0pCiAgICAgICAgKTsKICAgICAgfQogICAgfTsKICAgIGFyZ3MucHVzaChuZXh0KTsKICAgIHRoaXMuZ2V0Q29va2llcy5hcHBseSh0aGlzLCBhcmdzKTsKICB9CgogIHNlcmlhbGl6ZShjYikgewogICAgdmFsaWRhdG9ycy52YWxpZGF0ZSh2YWxpZGF0b3JzLmlzRnVuY3Rpb24oY2IpLCBjYik7CiAgICBsZXQgdHlwZSA9IHRoaXMuc3RvcmUuY29uc3RydWN0b3IubmFtZTsKICAgIGlmICh2YWxpZGF0b3JzLmlzT2JqZWN0KHR5cGUpKSB7CiAgICAgIHR5cGUgPSBudWxsOwogICAgfQoKICAgIC8vIHVwZGF0ZSBSRUFETUUubWQgIlNlcmlhbGl6YXRpb24gRm9ybWF0IiBpZiB5b3UgY2hhbmdlIHRoaXMsIHBsZWFzZSEKICAgIGNvbnN0IHNlcmlhbGl6ZWQgPSB7CiAgICAgIC8vIFRoZSB2ZXJzaW9uIG9mIHRvdWdoLWNvb2tpZSB0aGF0IHNlcmlhbGl6ZWQgdGhpcyBqYXIuIEdlbmVyYWxseSBhIGdvb2QKICAgICAgLy8gcHJhY3RpY2Ugc2luY2UgZnV0dXJlIHZlcnNpb25zIGNhbiBtYWtlIGRhdGEgaW1wb3J0IGRlY2lzaW9ucyBiYXNlZCBvbgogICAgICAvLyBrbm93biBwYXN0IGJlaGF2aW9yLiBXaGVuL2lmIHRoaXMgbWF0dGVycywgdXNlIGBzZW12ZXJgLgogICAgICB2ZXJzaW9uOiBgdG91Z2gtY29va2llQCR7VkVSU0lPTn1gLAoKICAgICAgLy8gYWRkIHRoZSBzdG9yZSB0eXBlLCB0byBtYWtlIGh1bWFucyBoYXBweToKICAgICAgc3RvcmVUeXBlOiB0eXBlLAoKICAgICAgLy8gQ29va2llSmFyIGNvbmZpZ3VyYXRpb246CiAgICAgIHJlamVjdFB1YmxpY1N1ZmZpeGVzOiAhIXRoaXMucmVqZWN0UHVibGljU3VmZml4ZXMsCiAgICAgIGVuYWJsZUxvb3NlTW9kZTogISF0aGlzLmVuYWJsZUxvb3NlTW9kZSwKICAgICAgYWxsb3dTcGVjaWFsVXNlRG9tYWluOiAhIXRoaXMuYWxsb3dTcGVjaWFsVXNlRG9tYWluLAogICAgICBwcmVmaXhTZWN1cml0eTogZ2V0Tm9ybWFsaXplZFByZWZpeFNlY3VyaXR5KHRoaXMucHJlZml4U2VjdXJpdHkpLAoKICAgICAgLy8gdGhpcyBnZXRzIGZpbGxlZCBmcm9tIGdldEFsbENvb2tpZXM6CiAgICAgIGNvb2tpZXM6IFtdCiAgICB9OwoKICAgIGlmICgKICAgICAgISgKICAgICAgICB0aGlzLnN0b3JlLmdldEFsbENvb2tpZXMgJiYKICAgICAgICB0eXBlb2YgdGhpcy5zdG9yZS5nZXRBbGxDb29raWVzID09PSAiZnVuY3Rpb24iCiAgICAgICkKICAgICkgewogICAgICByZXR1cm4gY2IoCiAgICAgICAgbmV3IEVycm9yKAogICAgICAgICAgInN0b3JlIGRvZXMgbm90IHN1cHBvcnQgZ2V0QWxsQ29va2llcyBhbmQgY2Fubm90IGJlIHNlcmlhbGl6ZWQiCiAgICAgICAgKQogICAgICApOwogICAgfQoKICAgIHRoaXMuc3RvcmUuZ2V0QWxsQ29va2llcygoZXJyLCBjb29raWVzKSA9PiB7CiAgICAgIGlmIChlcnIpIHsKICAgICAgICByZXR1cm4gY2IoZXJyKTsKICAgICAgfQoKICAgICAgc2VyaWFsaXplZC5jb29raWVzID0gY29va2llcy5tYXAoY29va2llID0+IHsKICAgICAgICAvLyBjb252ZXJ0IHRvIHNlcmlhbGl6ZWQgJ3JhdycgY29va2llcwogICAgICAgIGNvb2tpZSA9IGNvb2tpZSBpbnN0YW5jZW9mIENvb2tpZSA/IGNvb2tpZS50b0pTT04oKSA6IGNvb2tpZTsKCiAgICAgICAgLy8gUmVtb3ZlIHRoZSBpbmRleCBzbyBuZXcgb25lcyBnZXQgYXNzaWduZWQgZHVyaW5nIGRlc2VyaWFsaXphdGlvbgogICAgICAgIGRlbGV0ZSBjb29raWUuY3JlYXRpb25JbmRleDsKCiAgICAgICAgcmV0dXJuIGNvb2tpZTsKICAgICAgfSk7CgogICAgICByZXR1cm4gY2IobnVsbCwgc2VyaWFsaXplZCk7CiAgICB9KTsKICB9CgogIHRvSlNPTigpIHsKICAgIHJldHVybiB0aGlzLnNlcmlhbGl6ZVN5bmMoKTsKICB9CgogIC8vIHVzZSB0aGUgY2xhc3MgbWV0aG9kIENvb2tpZUphci5kZXNlcmlhbGl6ZSBpbnN0ZWFkIG9mIGNhbGxpbmcgdGhpcyBkaXJlY3RseQogIF9pbXBvcnRDb29raWVzKHNlcmlhbGl6ZWQsIGNiKSB7CiAgICBsZXQgY29va2llcyA9IHNlcmlhbGl6ZWQuY29va2llczsKICAgIGlmICghY29va2llcyB8fCAhQXJyYXkuaXNBcnJheShjb29raWVzKSkgewogICAgICByZXR1cm4gY2IobmV3IEVycm9yKCJzZXJpYWxpemVkIGphciBoYXMgbm8gY29va2llcyBhcnJheSIpKTsKICAgIH0KICAgIGNvb2tpZXMgPSBjb29raWVzLnNsaWNlKCk7IC8vIGRvIG5vdCBtb2RpZnkgdGhlIG9yaWdpbmFsCgogICAgY29uc3QgcHV0TmV4dCA9IGVyciA9PiB7CiAgICAgIGlmIChlcnIpIHsKICAgICAgICByZXR1cm4gY2IoZXJyKTsKICAgICAgfQoKICAgICAgaWYgKCFjb29raWVzLmxlbmd0aCkgewogICAgICAgIHJldHVybiBjYihlcnIsIHRoaXMpOwogICAgICB9CgogICAgICBsZXQgY29va2llOwogICAgICB0cnkgewogICAgICAgIGNvb2tpZSA9IGZyb21KU09OKGNvb2tpZXMuc2hpZnQoKSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICByZXR1cm4gY2IoZSk7CiAgICAgIH0KCiAgICAgIGlmIChjb29raWUgPT09IG51bGwpIHsKICAgICAgICByZXR1cm4gcHV0TmV4dChudWxsKTsgLy8gc2tpcCB0aGlzIGNvb2tpZQogICAgICB9CgogICAgICB0aGlzLnN0b3JlLnB1dENvb2tpZShjb29raWUsIHB1dE5leHQpOwogICAgfTsKCiAgICBwdXROZXh0KCk7CiAgfQoKICBjbG9uZShuZXdTdG9yZSwgY2IpIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7CiAgICAgIGNiID0gbmV3U3RvcmU7CiAgICAgIG5ld1N0b3JlID0gbnVsbDsKICAgIH0KCiAgICB0aGlzLnNlcmlhbGl6ZSgoZXJyLCBzZXJpYWxpemVkKSA9PiB7CiAgICAgIGlmIChlcnIpIHsKICAgICAgICByZXR1cm4gY2IoZXJyKTsKICAgICAgfQogICAgICBDb29raWVKYXIuZGVzZXJpYWxpemUoc2VyaWFsaXplZCwgbmV3U3RvcmUsIGNiKTsKICAgIH0pOwogIH0KCiAgY2xvbmVTeW5jKG5ld1N0b3JlKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkgewogICAgICByZXR1cm4gdGhpcy5fY2xvbmVTeW5jKCk7CiAgICB9CiAgICBpZiAoIW5ld1N0b3JlLnN5bmNocm9ub3VzKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAiQ29va2llSmFyIGNsb25lIGRlc3RpbmF0aW9uIHN0b3JlIGlzIG5vdCBzeW5jaHJvbm91czsgdXNlIGFzeW5jIEFQSSBpbnN0ZWFkLiIKICAgICAgKTsKICAgIH0KICAgIHJldHVybiB0aGlzLl9jbG9uZVN5bmMobmV3U3RvcmUpOwogIH0KCiAgcmVtb3ZlQWxsQ29va2llcyhjYikgewogICAgdmFsaWRhdG9ycy52YWxpZGF0ZSh2YWxpZGF0b3JzLmlzRnVuY3Rpb24oY2IpLCBjYik7CiAgICBjb25zdCBzdG9yZSA9IHRoaXMuc3RvcmU7CgogICAgLy8gQ2hlY2sgdGhhdCB0aGUgc3RvcmUgaW1wbGVtZW50cyBpdHMgb3duIHJlbW92ZUFsbENvb2tpZXMoKS4gVGhlIGRlZmF1bHQKICAgIC8vIGltcGxlbWVudGF0aW9uIGluIFN0b3JlIHdpbGwgaW1tZWRpYXRlbHkgY2FsbCB0aGUgY2FsbGJhY2sgd2l0aCBhICJub3QKICAgIC8vIGltcGxlbWVudGVkIiBFcnJvci4KICAgIGlmICgKICAgICAgdHlwZW9mIHN0b3JlLnJlbW92ZUFsbENvb2tpZXMgPT09ICJmdW5jdGlvbiIgJiYKICAgICAgc3RvcmUucmVtb3ZlQWxsQ29va2llcyAhPT0gU3RvcmUucHJvdG90eXBlLnJlbW92ZUFsbENvb2tpZXMKICAgICkgewogICAgICByZXR1cm4gc3RvcmUucmVtb3ZlQWxsQ29va2llcyhjYik7CiAgICB9CgogICAgc3RvcmUuZ2V0QWxsQ29va2llcygoZXJyLCBjb29raWVzKSA9PiB7CiAgICAgIGlmIChlcnIpIHsKICAgICAgICByZXR1cm4gY2IoZXJyKTsKICAgICAgfQoKICAgICAgaWYgKGNvb2tpZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIGNiKG51bGwpOwogICAgICB9CgogICAgICBsZXQgY29tcGxldGVkQ291bnQgPSAwOwogICAgICBjb25zdCByZW1vdmVFcnJvcnMgPSBbXTsKCiAgICAgIGZ1bmN0aW9uIHJlbW92ZUNvb2tpZUNiKHJlbW92ZUVycikgewogICAgICAgIGlmIChyZW1vdmVFcnIpIHsKICAgICAgICAgIHJlbW92ZUVycm9ycy5wdXNoKHJlbW92ZUVycik7CiAgICAgICAgfQoKICAgICAgICBjb21wbGV0ZWRDb3VudCsrOwoKICAgICAgICBpZiAoY29tcGxldGVkQ291bnQgPT09IGNvb2tpZXMubGVuZ3RoKSB7CiAgICAgICAgICByZXR1cm4gY2IocmVtb3ZlRXJyb3JzLmxlbmd0aCA/IHJlbW92ZUVycm9yc1swXSA6IG51bGwpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29va2llcy5mb3JFYWNoKGNvb2tpZSA9PiB7CiAgICAgICAgc3RvcmUucmVtb3ZlQ29va2llKAogICAgICAgICAgY29va2llLmRvbWFpbiwKICAgICAgICAgIGNvb2tpZS5wYXRoLAogICAgICAgICAgY29va2llLmtleSwKICAgICAgICAgIHJlbW92ZUNvb2tpZUNiCiAgICAgICAgKTsKICAgICAgfSk7CiAgICB9KTsKICB9CgogIHN0YXRpYyBkZXNlcmlhbGl6ZShzdHJPck9iaiwgc3RvcmUsIGNiKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMykgewogICAgICAvLyBzdG9yZSBpcyBvcHRpb25hbAogICAgICBjYiA9IHN0b3JlOwogICAgICBzdG9yZSA9IG51bGw7CiAgICB9CiAgICB2YWxpZGF0b3JzLnZhbGlkYXRlKHZhbGlkYXRvcnMuaXNGdW5jdGlvbihjYiksIGNiKTsKCiAgICBsZXQgc2VyaWFsaXplZDsKICAgIGlmICh0eXBlb2Ygc3RyT3JPYmogPT09ICJzdHJpbmciKSB7CiAgICAgIHNlcmlhbGl6ZWQgPSBqc29uUGFyc2Uoc3RyT3JPYmopOwogICAgICBpZiAoc2VyaWFsaXplZCBpbnN0YW5jZW9mIEVycm9yKSB7CiAgICAgICAgcmV0dXJuIGNiKHNlcmlhbGl6ZWQpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBzZXJpYWxpemVkID0gc3RyT3JPYmo7CiAgICB9CgogICAgY29uc3QgamFyID0gbmV3IENvb2tpZUphcihzdG9yZSwgewogICAgICByZWplY3RQdWJsaWNTdWZmaXhlczogc2VyaWFsaXplZC5yZWplY3RQdWJsaWNTdWZmaXhlcywKICAgICAgbG9vc2VNb2RlOiBzZXJpYWxpemVkLmVuYWJsZUxvb3NlTW9kZSwKICAgICAgYWxsb3dTcGVjaWFsVXNlRG9tYWluOiBzZXJpYWxpemVkLmFsbG93U3BlY2lhbFVzZURvbWFpbiwKICAgICAgcHJlZml4U2VjdXJpdHk6IHNlcmlhbGl6ZWQucHJlZml4U2VjdXJpdHkKICAgIH0pOwogICAgamFyLl9pbXBvcnRDb29raWVzKHNlcmlhbGl6ZWQsIGVyciA9PiB7CiAgICAgIGlmIChlcnIpIHsKICAgICAgICByZXR1cm4gY2IoZXJyKTsKICAgICAgfQogICAgICBjYihudWxsLCBqYXIpOwogICAgfSk7CiAgfQoKICBzdGF0aWMgZGVzZXJpYWxpemVTeW5jKHN0ck9yT2JqLCBzdG9yZSkgewogICAgY29uc3Qgc2VyaWFsaXplZCA9CiAgICAgIHR5cGVvZiBzdHJPck9iaiA9PT0gInN0cmluZyIgPyBKU09OLnBhcnNlKHN0ck9yT2JqKSA6IHN0ck9yT2JqOwogICAgY29uc3QgamFyID0gbmV3IENvb2tpZUphcihzdG9yZSwgewogICAgICByZWplY3RQdWJsaWNTdWZmaXhlczogc2VyaWFsaXplZC5yZWplY3RQdWJsaWNTdWZmaXhlcywKICAgICAgbG9vc2VNb2RlOiBzZXJpYWxpemVkLmVuYWJsZUxvb3NlTW9kZQogICAgfSk7CgogICAgLy8gY2F0Y2ggdGhpcyBtaXN0YWtlIGVhcmx5OgogICAgaWYgKCFqYXIuc3RvcmUuc3luY2hyb25vdXMpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgICJDb29raWVKYXIgc3RvcmUgaXMgbm90IHN5bmNocm9ub3VzOyB1c2UgYXN5bmMgQVBJIGluc3RlYWQuIgogICAgICApOwogICAgfQoKICAgIGphci5faW1wb3J0Q29va2llc1N5bmMoc2VyaWFsaXplZCk7CiAgICByZXR1cm4gamFyOwogIH0KfQpDb29raWVKYXIuZnJvbUpTT04gPSBDb29raWVKYXIuZGVzZXJpYWxpemVTeW5jOwoKWwogICJfaW1wb3J0Q29va2llcyIsCiAgImNsb25lIiwKICAiZ2V0Q29va2llcyIsCiAgImdldENvb2tpZVN0cmluZyIsCiAgImdldFNldENvb2tpZVN0cmluZ3MiLAogICJyZW1vdmVBbGxDb29raWVzIiwKICAic2VyaWFsaXplIiwKICAic2V0Q29va2llIgpdLmZvckVhY2gobmFtZSA9PiB7CiAgQ29va2llSmFyLnByb3RvdHlwZVtuYW1lXSA9IGZyb21DYWxsYmFjayhDb29raWVKYXIucHJvdG90eXBlW25hbWVdKTsKfSk7CkNvb2tpZUphci5kZXNlcmlhbGl6ZSA9IGZyb21DYWxsYmFjayhDb29raWVKYXIuZGVzZXJpYWxpemUpOwoKLy8gVXNlIGEgY2xvc3VyZSB0byBwcm92aWRlIGEgdHJ1ZSBpbXBlcmF0aXZlIEFQSSBmb3Igc3luY2hyb25vdXMgc3RvcmVzLgpmdW5jdGlvbiBzeW5jV3JhcChtZXRob2QpIHsKICByZXR1cm4gZnVuY3Rpb24oLi4uYXJncykgewogICAgaWYgKCF0aGlzLnN0b3JlLnN5bmNocm9ub3VzKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAiQ29va2llSmFyIHN0b3JlIGlzIG5vdCBzeW5jaHJvbm91czsgdXNlIGFzeW5jIEFQSSBpbnN0ZWFkLiIKICAgICAgKTsKICAgIH0KCiAgICBsZXQgc3luY0Vyciwgc3luY1Jlc3VsdDsKICAgIHRoaXNbbWV0aG9kXSguLi5hcmdzLCAoZXJyLCByZXN1bHQpID0+IHsKICAgICAgc3luY0VyciA9IGVycjsKICAgICAgc3luY1Jlc3VsdCA9IHJlc3VsdDsKICAgIH0pOwoKICAgIGlmIChzeW5jRXJyKSB7CiAgICAgIHRocm93IHN5bmNFcnI7CiAgICB9CiAgICByZXR1cm4gc3luY1Jlc3VsdDsKICB9Owp9CnZhciBDb29raWVKYXJfMSA9IENvb2tpZUphcjsKdmFyIENvb2tpZV8xID0gQ29va2llOwp2YXIgU3RvcmVfMSA9IFN0b3JlOwpwdWJzdWZmaXguZ2V0UHVibGljU3VmZml4Owp2YXIgcGVybXV0ZURvbWFpbiA9IHBlcm11dGVEb21haW4kMy5wZXJtdXRlRG9tYWluOwp2YWxpZGF0b3JzLlBhcmFtZXRlckVycm9yOwoKY29uc3QgU1RPUkVfS0VZID0gIl9fY29va2llU3RvcmVfXyI7CmNsYXNzIFdlYlN0b3JhZ2VDb29raWVTdG9yZSBleHRlbmRzIFN0b3JlXzEgewogIGNvbnN0cnVjdG9yKCkgewogICAgc3VwZXIoKTsKICAgIHRoaXMuc3luY2hyb25vdXMgPSB0cnVlOwogIH0KICBmaW5kQ29va2llKGRvbWFpbiwgcGF0aCwga2V5LCBjYWxsYmFjaykgewogICAgY29uc3Qgc3RvcmUgPSB0aGlzLl9yZWFkU3RvcmUoKTsKICAgIGNvbnN0IGNvb2tpZSA9IHN0b3JlW2RvbWFpbl0/LltwYXRoXT8uW2tleV0gPz8gbnVsbDsKICAgIGNhbGxiYWNrKG51bGwsIENvb2tpZV8xLmZyb21KU09OKGNvb2tpZSkpOwogIH0KICBmaW5kQ29va2llcyhkb21haW4sIHBhdGgsIGFsbG93U3BlY2lhbFVzZURvbWFpbiwgY2IpIHsKICAgIGlmICghZG9tYWluKQogICAgICByZXR1cm4gdm9pZCBjYihudWxsLCBbXSk7CiAgICBjb25zdCBjb29raWVzID0gW107CiAgICBjb25zdCBzdG9yZSA9IHRoaXMuX3JlYWRTdG9yZSgpOwogICAgY29uc3QgZG9tYWlucyA9IHBlcm11dGVEb21haW4oZG9tYWluLCBhbGxvd1NwZWNpYWxVc2VEb21haW4pIHx8IFtkb21haW5dOwogICAgZm9yIChjb25zdCBkb21haW4yIG9mIGRvbWFpbnMpIHsKICAgICAgaWYgKCFzdG9yZVtkb21haW4yXSkKICAgICAgICBjb250aW51ZTsKICAgICAgbGV0IG1hdGNoaW5nUGF0aHMgPSBPYmplY3Qua2V5cyhzdG9yZVtkb21haW4yXSk7CiAgICAgIGlmIChwYXRoICE9PSBudWxsKSB7CiAgICAgICAgbWF0Y2hpbmdQYXRocyA9IG1hdGNoaW5nUGF0aHMuZmlsdGVyKAogICAgICAgICAgKGNvb2tpZVBhdGgpID0+IHRoaXMuX2lzT25QYXRoKGNvb2tpZVBhdGgsIHBhdGgpCiAgICAgICAgKTsKICAgICAgfQogICAgICBmb3IgKGNvbnN0IHBhdGgyIG9mIG1hdGNoaW5nUGF0aHMpIHsKICAgICAgICBjb29raWVzLnB1c2goLi4uT2JqZWN0LnZhbHVlcyhzdG9yZVtkb21haW4yXVtwYXRoMl0pKTsKICAgICAgfQogICAgfQogICAgY29uc3QgbmV3Q29va2llcyA9IGNvb2tpZXMubWFwKChjb29raWUpID0+IENvb2tpZV8xLmZyb21KU09OKGNvb2tpZSkpLmZpbHRlcihCb29sZWFuKTsKICAgIGNiKG51bGwsIG5ld0Nvb2tpZXMpOwogIH0KICAvKioKICAgKiBSZXR1cm5zIHdoZXRoZXIgYGNvb2tpZVBhdGhgIGlzIG9uIHRoZSBnaXZlbiBgdXJsUGF0aGAKICAgKi8KICBfaXNPblBhdGgoY29va2llUGF0aCwgdXJsUGF0aCkgewogICAgaWYgKCFjb29raWVQYXRoKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmIChjb29raWVQYXRoID09PSB1cmxQYXRoKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKCF1cmxQYXRoLnN0YXJ0c1dpdGgoY29va2llUGF0aCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKGNvb2tpZVBhdGhbY29va2llUGF0aC5sZW5ndGggLSAxXSAhPT0gIi8iICYmIHVybFBhdGhbY29va2llUGF0aC5sZW5ndGhdICE9PSAiLyIpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQogIHB1dENvb2tpZShjb29raWUsIGNhbGxiYWNrKSB7CiAgICBjb25zdCBzdG9yZSA9IHRoaXMuX3JlYWRTdG9yZSgpOwogICAgaWYgKCEoY29va2llLmRvbWFpbiBpbiBzdG9yZSkpCiAgICAgIHN0b3JlW2Nvb2tpZS5kb21haW5dID0ge307CiAgICBpZiAoIShjb29raWUucGF0aCBpbiBzdG9yZVtjb29raWUuZG9tYWluXSkpCiAgICAgIHN0b3JlW2Nvb2tpZS5kb21haW5dW2Nvb2tpZS5wYXRoXSA9IHt9OwogICAgc3RvcmVbY29va2llLmRvbWFpbl1bY29va2llLnBhdGhdW2Nvb2tpZS5rZXldID0gY29va2llOwogICAgdGhpcy5fd3JpdGVTdG9yZShzdG9yZSk7CiAgICBjYWxsYmFjayhudWxsKTsKICB9CiAgdXBkYXRlQ29va2llKG9sZENvb2tpZSwgbmV3Q29va2llLCBjYWxsYmFjaykgewogICAgdGhpcy5wdXRDb29raWUobmV3Q29va2llLCBjYWxsYmFjayk7CiAgfQogIHJlbW92ZUNvb2tpZShkb21haW4sIHBhdGgsIGtleSwgY2FsbGJhY2spIHsKICAgIGNvbnN0IHN0b3JlID0gdGhpcy5fcmVhZFN0b3JlKCk7CiAgICBpZiAoc3RvcmU/Lltkb21haW5dPy5bcGF0aF0pCiAgICAgIGRlbGV0ZSBzdG9yZVtkb21haW5dW3BhdGhdW2tleV07CiAgICB0aGlzLl93cml0ZVN0b3JlKHN0b3JlKTsKICAgIGNhbGxiYWNrKG51bGwpOwogIH0KICByZW1vdmVDb29raWVzKGRvbWFpbiwgcGF0aCwgY2FsbGJhY2spIHsKICAgIGNvbnN0IHN0b3JlID0gdGhpcy5fcmVhZFN0b3JlKCk7CiAgICBpZiAocGF0aCA9PT0gbnVsbCkgewogICAgICBkZWxldGUgc3RvcmVbZG9tYWluXTsKICAgIH0gZWxzZSB7CiAgICAgIGRlbGV0ZSBzdG9yZVtkb21haW5dW3BhdGhdOwogICAgfQogICAgdGhpcy5fd3JpdGVTdG9yZShzdG9yZSk7CiAgICBjYWxsYmFjayhudWxsKTsKICB9CiAgZ2V0QWxsQ29va2llcyhjYWxsYmFjaykgewogICAgY29uc3QgY29va2llcyA9IFtdOwogICAgY29uc3Qgc3RvcmUgPSB0aGlzLl9yZWFkU3RvcmUoKTsKICAgIGZvciAoY29uc3QgZG9tYWluIG9mIE9iamVjdC5rZXlzKHN0b3JlKSkgewogICAgICBmb3IgKGNvbnN0IHBhdGggb2YgT2JqZWN0LmtleXMoc3RvcmVbZG9tYWluXSkpIHsKICAgICAgICBjb29raWVzLnB1c2goLi4uT2JqZWN0LnZhbHVlcyhzdG9yZVtkb21haW5dW3BhdGhdKSk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IG5ld0Nvb2tpZXMgPSBjb29raWVzLm1hcCgoY29va2llKSA9PiBDb29raWVfMS5mcm9tSlNPTihjb29raWUpKS5maWx0ZXIoQm9vbGVhbik7CiAgICBuZXdDb29raWVzLnNvcnQoCiAgICAgIChjMSwgYzIpID0+IChjMS5jcmVhdGlvbkluZGV4IHx8IDApIC0gKGMyLmNyZWF0aW9uSW5kZXggfHwgMCkKICAgICk7CiAgICBjYWxsYmFjayhudWxsLCBuZXdDb29raWVzKTsKICB9CiAgX3JlYWRTdG9yZSgpIHsKICAgIGlmICghKFNUT1JFX0tFWSBpbiBsb2NhbFN0b3JhZ2UpKQogICAgICBsb2NhbFN0b3JhZ2VbU1RPUkVfS0VZXSA9IEpTT04uc3RyaW5naWZ5KHt9KTsKICAgIHJldHVybiBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZVtTVE9SRV9LRVldKTsKICB9CiAgX3dyaXRlU3RvcmUoc3RvcmUpIHsKICAgIGxvY2FsU3RvcmFnZVtTVE9SRV9LRVldID0gSlNPTi5zdHJpbmdpZnkoc3RvcmUpOwogIH0KfQoKY29uc3QgdmFsaWRQcm90b2NvbHMgPSBbImh0dHA6IiwgImh0dHBzOiJdOwpjb25zdCByZWRpcmVjdFN0YXR1c0NvZGVzID0gWzMwMCwgMzAxLCAzMDIsIDMwMywgMzA0LCAzMDUsIDMwNywgMzA4XTsKY29uc3QgY29va2llID0gbmV3IENvb2tpZUphcl8xKG5ldyBXZWJTdG9yYWdlQ29va2llU3RvcmUoKSk7CmFzeW5jIGZ1bmN0aW9uIHJlcXVlc3QocmVxLCBkZXN0LCB3aW4pIHsKICB3aGlsZSAodHJ1ZSkgewogICAgY29uc3QgcmVzID0gYXdhaXQgX3JlcXVlc3QocmVxLCBkZXN0LCB3aW5bc0NsaWVudF0sIHdpbltzQWJvcnRdLnNpZ25hbCk7CiAgICBmb3IgKGNvbnN0IG5hbWUgaW4gcmVzLnJhd0hlYWRlcnMpIHsKICAgICAgaWYgKG5hbWUudG9Mb3dlckNhc2UoKSA9PT0gInNldC1jb29raWUiKSB7CiAgICAgICAgbGV0IGNvb2tpZXMgPSByZXMucmF3SGVhZGVyc1tuYW1lXTsKICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoY29va2llcykpCiAgICAgICAgICBjb29raWVzID0gW2Nvb2tpZXNdOwogICAgICAgIGZvciAoY29uc3QgYyBvZiBjb29raWVzKQogICAgICAgICAgYXdhaXQgY29va2llLnNldENvb2tpZShjLCByZXMuZmluYWxVUkwpOwogICAgICB9CiAgICB9CiAgICBpZiAocmVkaXJlY3RTdGF0dXNDb2Rlcy5pbmNsdWRlcyhyZXMuc3RhdHVzKSkgewogICAgICBjb25zdCBsb2NhdGlvbiA9IG5ldyBVUkwocmVzLmhlYWRlcnMuZ2V0KCJsb2NhdGlvbiIpIHx8ICIiLCByZXEudXJsKTsKICAgICAgcmVxID0gbmV3IFJlcXVlc3QobG9jYXRpb24pOwogICAgICBjb250aW51ZTsKICAgIH0KICAgIHJldHVybiByZXM7CiAgfQp9CmFzeW5jIGZ1bmN0aW9uIF9yZXF1ZXN0KHJlcSwgZGVzdCwgY2xpZW50LCBzaWduYWwpIHsKICBpZiAoIWNsaWVudCkKICAgIHRocm93IG5ldyBFcnJvcigiT0siKTsKICBjb25zdCBoZWFkZXJzID0gbmV3IEhlYWRlcnMocmVxLmhlYWRlcnMpOwogIGhlYWRlcnMuc2V0KCJ1c2VyLWFnZW50IiwgbmF2aWdhdG9yLnVzZXJBZ2VudCk7CiAgaGVhZGVycy5zZXQoInNlYy1mZXRjaC1kZXN0IiwgZGVzdCk7CiAgY29uc3QgY29va2llcyA9IGF3YWl0IGNvb2tpZS5nZXRDb29raWVTdHJpbmcocmVxLnVybCk7CiAgaWYgKGNvb2tpZXMpCiAgICBoZWFkZXJzLnNldCgiY29va2llIiwgY29va2llcyk7CiAgcmV0dXJuIGF3YWl0IGNsaWVudC5mZXRjaChyZXEudXJsLCB7CiAgICBoZWFkZXJzLAogICAgYm9keTogcmVxLmJvZHksCiAgICAvLyBmb3JjaW5nIGNhY2hlIGdyZWF0bHkgaW1wcm92ZXMgbG9hZCB0aW1lcwogICAgY2FjaGU6ICJmb3JjZS1jYWNoZSIsCiAgICBzaWduYWwsCiAgICBtZXRob2Q6IHJlcS5tZXRob2QsCiAgICByZWRpcmVjdDogIm1hbnVhbCIKICB9KTsKfQphc3luYyBmdW5jdGlvbiBsb2NhbGl6ZVJlc291cmNlKHVybCwgZGVzdCwgd2luKSB7CiAgY29uc3QgciA9IG5ldyBVUkwodXJsKTsKICBpZiAoIXZhbGlkUHJvdG9jb2xzLmluY2x1ZGVzKHIucHJvdG9jb2wpIHx8ICFyLmhvc3QgfHwgci5wcm90b2NvbCA9PT0gImRhdGE6IikKICAgIHJldHVybiByLnRvU3RyaW5nKCk7CiAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdChuZXcgUmVxdWVzdChyKSwgZGVzdCwgd2luKTsKICBjb25zdCBibG9iVXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChhd2FpdCByZXMuYmxvYigpKTsKICB3aW5bc0Jsb2JVcmxzXS5wdXNoKGJsb2JVcmwpOwogIHJldHVybiBibG9iVXJsOwp9Cgpjb25zdCBlcnJvck1lc3NhZ2VzID0gew0KICAgIFswXTogJ1VuZXhwZWN0ZWQgdG9rZW4nLA0KICAgIFsyOF06ICJVbmV4cGVjdGVkIHRva2VuOiAnJTAnIiwNCiAgICBbMV06ICdPY3RhbCBlc2NhcGUgc2VxdWVuY2VzIGFyZSBub3QgYWxsb3dlZCBpbiBzdHJpY3QgbW9kZScsDQogICAgWzJdOiAnT2N0YWwgZXNjYXBlIHNlcXVlbmNlcyBhcmUgbm90IGFsbG93ZWQgaW4gdGVtcGxhdGUgc3RyaW5ncycsDQogICAgWzNdOiAnVW5leHBlY3RlZCB0b2tlbiBgI2AnLA0KICAgIFs0XTogJ0lsbGVnYWwgVW5pY29kZSBlc2NhcGUgc2VxdWVuY2UnLA0KICAgIFs1XTogJ0ludmFsaWQgY29kZSBwb2ludCAlMCcsDQogICAgWzZdOiAnSW52YWxpZCBoZXhhZGVjaW1hbCBlc2NhcGUgc2VxdWVuY2UnLA0KICAgIFs4XTogJ09jdGFsIGxpdGVyYWxzIGFyZSBub3QgYWxsb3dlZCBpbiBzdHJpY3QgbW9kZScsDQogICAgWzddOiAnRGVjaW1hbCBpbnRlZ2VyIGxpdGVyYWxzIHdpdGggYSBsZWFkaW5nIHplcm8gYXJlIGZvcmJpZGRlbiBpbiBzdHJpY3QgbW9kZScsDQogICAgWzldOiAnRXhwZWN0ZWQgbnVtYmVyIGluIHJhZGl4ICUwJywNCiAgICBbMTQ2XTogJ0ludmFsaWQgbGVmdC1oYW5kIHNpZGUgYXNzaWdubWVudCB0byBhIGRlc3RydWN0aWJsZSByaWdodC1oYW5kIHNpZGUnLA0KICAgIFsxMF06ICdOb24tbnVtYmVyIGZvdW5kIGFmdGVyIGV4cG9uZW50IGluZGljYXRvcicsDQogICAgWzExXTogJ0ludmFsaWQgQmlnSW50TGl0ZXJhbCcsDQogICAgWzEyXTogJ05vIGlkZW50aWZpZXJzIGFsbG93ZWQgZGlyZWN0bHkgYWZ0ZXIgbnVtZXJpYyBsaXRlcmFsJywNCiAgICBbMTNdOiAnRXNjYXBlcyBcXDggb3IgXFw5IGFyZSBub3Qgc3ludGFjdGljYWxseSB2YWxpZCBlc2NhcGVzJywNCiAgICBbMTRdOiAnVW50ZXJtaW5hdGVkIHN0cmluZyBsaXRlcmFsJywNCiAgICBbMTVdOiAnVW50ZXJtaW5hdGVkIHRlbXBsYXRlIGxpdGVyYWwnLA0KICAgIFsxNl06ICdNdWx0aWxpbmUgY29tbWVudCB3YXMgbm90IGNsb3NlZCBwcm9wZXJseScsDQogICAgWzE3XTogJ1RoZSBpZGVudGlmaWVyIGNvbnRhaW5lZCBkeW5hbWljIHVuaWNvZGUgZXNjYXBlIHRoYXQgd2FzIG5vdCBjbG9zZWQnLA0KICAgIFsxOF06ICJJbGxlZ2FsIGNoYXJhY3RlciAnJTAnIiwNCiAgICBbMTldOiAnTWlzc2luZyBoZXhhZGVjaW1hbCBkaWdpdHMnLA0KICAgIFsyMF06ICdJbnZhbGlkIGltcGxpY2l0IG9jdGFsJywNCiAgICBbMjFdOiAnSW52YWxpZCBsaW5lIGJyZWFrIGluIHN0cmluZyBsaXRlcmFsJywNCiAgICBbMjJdOiAnT25seSB1bmljb2RlIGVzY2FwZXMgYXJlIGxlZ2FsIGluIGlkZW50aWZpZXIgbmFtZXMnLA0KICAgIFsyM106ICJFeHBlY3RlZCAnJTAnIiwNCiAgICBbMjRdOiAnSW52YWxpZCBsZWZ0LWhhbmQgc2lkZSBpbiBhc3NpZ25tZW50JywNCiAgICBbMjVdOiAnSW52YWxpZCBsZWZ0LWhhbmQgc2lkZSBpbiBhc3luYyBhcnJvdycsDQogICAgWzI2XTogJ0NhbGxzIHRvIHN1cGVyIG11c3QgYmUgaW4gdGhlICJjb25zdHJ1Y3RvciIgbWV0aG9kIG9mIGEgY2xhc3MgZXhwcmVzc2lvbiBvciBjbGFzcyBkZWNsYXJhdGlvbiB0aGF0IGhhcyBhIHN1cGVyY2xhc3MnLA0KICAgIFsyN106ICdNZW1iZXIgYWNjZXNzIG9uIHN1cGVyIG11c3QgYmUgaW4gYSBtZXRob2QnLA0KICAgIFsyOV06ICdBd2FpdCBleHByZXNzaW9uIG5vdCBhbGxvd2VkIGluIGZvcm1hbCBwYXJhbWV0ZXInLA0KICAgIFszMF06ICdZaWVsZCBleHByZXNzaW9uIG5vdCBhbGxvd2VkIGluIGZvcm1hbCBwYXJhbWV0ZXInLA0KICAgIFs5M106ICJVbmV4cGVjdGVkIHRva2VuOiAnZXNjYXBlZCBrZXl3b3JkJyIsDQogICAgWzMxXTogJ1VuYXJ5IGV4cHJlc3Npb25zIGFzIHRoZSBsZWZ0IG9wZXJhbmQgb2YgYW4gZXhwb25lbnRpYXRpb24gZXhwcmVzc2lvbiBtdXN0IGJlIGRpc2FtYmlndWF0ZWQgd2l0aCBwYXJlbnRoZXNlcycsDQogICAgWzEyMF06ICdBc3luYyBmdW5jdGlvbnMgY2FuIG9ubHkgYmUgZGVjbGFyZWQgYXQgdGhlIHRvcCBsZXZlbCBvciBpbnNpZGUgYSBibG9jaycsDQogICAgWzMyXTogJ1VudGVybWluYXRlZCByZWd1bGFyIGV4cHJlc3Npb24nLA0KICAgIFszM106ICdVbmV4cGVjdGVkIHJlZ3VsYXIgZXhwcmVzc2lvbiBmbGFnJywNCiAgICBbMzRdOiAiRHVwbGljYXRlIHJlZ3VsYXIgZXhwcmVzc2lvbiBmbGFnICclMCciLA0KICAgIFszNV06ICclMCBmdW5jdGlvbnMgbXVzdCBoYXZlIGV4YWN0bHkgJTEgYXJndW1lbnQlMicsDQogICAgWzM2XTogJ1NldHRlciBmdW5jdGlvbiBhcmd1bWVudCBtdXN0IG5vdCBiZSBhIHJlc3QgcGFyYW1ldGVyJywNCiAgICBbMzddOiAnJTAgZGVjbGFyYXRpb24gbXVzdCBoYXZlIGEgbmFtZSBpbiB0aGlzIGNvbnRleHQnLA0KICAgIFszOF06ICdGdW5jdGlvbiBuYW1lIG1heSBub3QgY29udGFpbiBhbnkgcmVzZXJ2ZWQgd29yZHMgb3IgYmUgZXZhbCBvciBhcmd1bWVudHMgaW4gc3RyaWN0IG1vZGUnLA0KICAgIFszOV06ICdUaGUgcmVzdCBvcGVyYXRvciBpcyBtaXNzaW5nIGFuIGFyZ3VtZW50JywNCiAgICBbNDBdOiAnQSBnZXR0ZXIgY2Fubm90IGJlIGEgZ2VuZXJhdG9yJywNCiAgICBbNDFdOiAnQSBzZXR0ZXIgY2Fubm90IGJlIGEgZ2VuZXJhdG9yJywNCiAgICBbNDJdOiAnQSBjb21wdXRlZCBwcm9wZXJ0eSBuYW1lIG11c3QgYmUgZm9sbG93ZWQgYnkgYSBjb2xvbiBvciBwYXJlbicsDQogICAgWzEzMV06ICdPYmplY3QgbGl0ZXJhbCBrZXlzIHRoYXQgYXJlIHN0cmluZ3Mgb3IgbnVtYmVycyBtdXN0IGJlIGEgbWV0aG9kIG9yIGhhdmUgYSBjb2xvbicsDQogICAgWzQ0XTogJ0ZvdW5kIGAqIGFzeW5jIHgoKXt9YCBidXQgdGhpcyBzaG91bGQgYmUgYGFzeW5jICogeCgpe31gJywNCiAgICBbNDNdOiAnR2V0dGVycyBhbmQgc2V0dGVycyBjYW4gbm90IGJlIGdlbmVyYXRvcnMnLA0KICAgIFs0NV06ICInJTAnIGNhbiBub3QgYmUgZ2VuZXJhdG9yIG1ldGhvZCIsDQogICAgWzQ2XTogIk5vIGxpbmUgYnJlYWsgaXMgYWxsb3dlZCBhZnRlciAnPT4nIiwNCiAgICBbNDddOiAnVGhlIGxlZnQtaGFuZCBzaWRlIG9mIHRoZSBhcnJvdyBjYW4gb25seSBiZSBkZXN0cnVjdGVkIHRocm91Z2ggYXNzaWdubWVudCcsDQogICAgWzQ4XTogJ1RoZSBiaW5kaW5nIGRlY2xhcmF0aW9uIGlzIG5vdCBkZXN0cnVjdGlibGUnLA0KICAgIFs0OV06ICdBc3luYyBhcnJvdyBjYW4gbm90IGJlIGZvbGxvd2VkIGJ5IG5ldyBleHByZXNzaW9uJywNCiAgICBbNTBdOiAiQ2xhc3NlcyBtYXkgbm90IGhhdmUgYSBzdGF0aWMgcHJvcGVydHkgbmFtZWQgJ3Byb3RvdHlwZSciLA0KICAgIFs1MV06ICdDbGFzcyBjb25zdHJ1Y3RvciBtYXkgbm90IGJlIGEgJTAnLA0KICAgIFs1Ml06ICdEdXBsaWNhdGUgY29uc3RydWN0b3IgbWV0aG9kIGluIGNsYXNzJywNCiAgICBbNTNdOiAnSW52YWxpZCBpbmNyZW1lbnQvZGVjcmVtZW50IG9wZXJhbmQnLA0KICAgIFs1NF06ICdJbnZhbGlkIHVzZSBvZiBgbmV3YCBrZXl3b3JkIG9uIGFuIGluY3JlbWVudC9kZWNyZW1lbnQgZXhwcmVzc2lvbicsDQogICAgWzU1XTogJ2A9PmAgaXMgYW4gaW52YWxpZCBhc3NpZ25tZW50IHRhcmdldCcsDQogICAgWzU2XTogJ1Jlc3QgZWxlbWVudCBtYXkgbm90IGhhdmUgYSB0cmFpbGluZyBjb21tYScsDQogICAgWzU3XTogJ01pc3NpbmcgaW5pdGlhbGl6ZXIgaW4gJTAgZGVjbGFyYXRpb24nLA0KICAgIFs1OF06ICInZm9yLSUwJyBsb29wIGhlYWQgZGVjbGFyYXRpb25zIGNhbiBub3QgaGF2ZSBhbiBpbml0aWFsaXplciIsDQogICAgWzU5XTogJ0ludmFsaWQgbGVmdC1oYW5kIHNpZGUgaW4gZm9yLSUwIGxvb3A6IE11c3QgaGF2ZSBhIHNpbmdsZSBiaW5kaW5nJywNCiAgICBbNjBdOiAnSW52YWxpZCBzaG9ydGhhbmQgcHJvcGVydHkgaW5pdGlhbGl6ZXInLA0KICAgIFs2MV06ICdQcm9wZXJ0eSBuYW1lIF9fcHJvdG9fXyBhcHBlYXJzIG1vcmUgdGhhbiBvbmNlIGluIG9iamVjdCBsaXRlcmFsJywNCiAgICBbNjJdOiAnTGV0IGlzIGRpc2FsbG93ZWQgYXMgYSBsZXhpY2FsbHkgYm91bmQgbmFtZScsDQogICAgWzYzXTogIkludmFsaWQgdXNlIG9mICclMCcgaW5zaWRlIG5ldyBleHByZXNzaW9uIiwNCiAgICBbNjRdOiAiSWxsZWdhbCAndXNlIHN0cmljdCcgZGlyZWN0aXZlIGluIGZ1bmN0aW9uIHdpdGggbm9uLXNpbXBsZSBwYXJhbWV0ZXIgbGlzdCIsDQogICAgWzY1XTogJ0lkZW50aWZpZXIgImxldCIgZGlzYWxsb3dlZCBhcyBsZWZ0LWhhbmQgc2lkZSBleHByZXNzaW9uIGluIHN0cmljdCBtb2RlJywNCiAgICBbNjZdOiAnSWxsZWdhbCBjb250aW51ZSBzdGF0ZW1lbnQnLA0KICAgIFs2N106ICdJbGxlZ2FsIGJyZWFrIHN0YXRlbWVudCcsDQogICAgWzY4XTogJ0Nhbm5vdCBoYXZlIGBsZXRbLi4uXWAgYXMgYSB2YXIgbmFtZSBpbiBzdHJpY3QgbW9kZScsDQogICAgWzY5XTogJ0ludmFsaWQgZGVzdHJ1Y3R1cmluZyBhc3NpZ25tZW50IHRhcmdldCcsDQogICAgWzcwXTogJ1Jlc3QgcGFyYW1ldGVyIG1heSBub3QgaGF2ZSBhIGRlZmF1bHQgaW5pdGlhbGl6ZXInLA0KICAgIFs3MV06ICdUaGUgcmVzdCBhcmd1bWVudCBtdXN0IHRoZSBiZSBsYXN0IHBhcmFtZXRlcicsDQogICAgWzcyXTogJ0ludmFsaWQgcmVzdCBhcmd1bWVudCcsDQogICAgWzc0XTogJ0luIHN0cmljdCBtb2RlIGNvZGUsIGZ1bmN0aW9ucyBjYW4gb25seSBiZSBkZWNsYXJlZCBhdCB0b3AgbGV2ZWwgb3IgaW5zaWRlIGEgYmxvY2snLA0KICAgIFs3NV06ICdJbiBub24tc3RyaWN0IG1vZGUgY29kZSwgZnVuY3Rpb25zIGNhbiBvbmx5IGJlIGRlY2xhcmVkIGF0IHRvcCBsZXZlbCwgaW5zaWRlIGEgYmxvY2ssIG9yIGFzIHRoZSBib2R5IG9mIGFuIGlmIHN0YXRlbWVudCcsDQogICAgWzc2XTogJ1dpdGhvdXQgd2ViIGNvbXBhdGliaWxpdHkgZW5hYmxlZCBmdW5jdGlvbnMgY2FuIG5vdCBiZSBkZWNsYXJlZCBhdCB0b3AgbGV2ZWwsIGluc2lkZSBhIGJsb2NrLCBvciBhcyB0aGUgYm9keSBvZiBhbiBpZiBzdGF0ZW1lbnQnLA0KICAgIFs3N106ICJDbGFzcyBkZWNsYXJhdGlvbiBjYW4ndCBhcHBlYXIgaW4gc2luZ2xlLXN0YXRlbWVudCBjb250ZXh0IiwNCiAgICBbNzhdOiAnSW52YWxpZCBsZWZ0LWhhbmQgc2lkZSBpbiBmb3ItJTAnLA0KICAgIFs3OV06ICdJbnZhbGlkIGFzc2lnbm1lbnQgaW4gZm9yLSUwJywNCiAgICBbODBdOiAnZm9yIGF3YWl0ICguLi4gb2YgLi4uKSBpcyBvbmx5IHZhbGlkIGluIGFzeW5jIGZ1bmN0aW9ucyBhbmQgYXN5bmMgZ2VuZXJhdG9ycycsDQogICAgWzgxXTogJ1RoZSBmaXJzdCB0b2tlbiBhZnRlciB0aGUgdGVtcGxhdGUgZXhwcmVzc2lvbiBzaG91bGQgYmUgYSBjb250aW51YXRpb24gb2YgdGhlIHRlbXBsYXRlJywNCiAgICBbODNdOiAnYGxldGAgZGVjbGFyYXRpb24gbm90IGFsbG93ZWQgaGVyZSBhbmQgYGxldGAgY2Fubm90IGJlIGEgcmVndWxhciB2YXIgbmFtZSBpbiBzdHJpY3QgbW9kZScsDQogICAgWzgyXTogJ2BsZXQgXG4gW2AgaXMgYSByZXN0cmljdGVkIHByb2R1Y3Rpb24gYXQgdGhlIHN0YXJ0IG9mIGEgc3RhdGVtZW50JywNCiAgICBbODRdOiAnQ2F0Y2ggY2xhdXNlIHJlcXVpcmVzIGV4YWN0bHkgb25lIHBhcmFtZXRlciwgbm90IG1vcmUgKGFuZCBubyB0cmFpbGluZyBjb21tYSknLA0KICAgIFs4NV06ICdDYXRjaCBjbGF1c2UgcGFyYW1ldGVyIGRvZXMgbm90IHN1cHBvcnQgZGVmYXVsdCB2YWx1ZXMnLA0KICAgIFs4Nl06ICdNaXNzaW5nIGNhdGNoIG9yIGZpbmFsbHkgYWZ0ZXIgdHJ5JywNCiAgICBbODddOiAnTW9yZSB0aGFuIG9uZSBkZWZhdWx0IGNsYXVzZSBpbiBzd2l0Y2ggc3RhdGVtZW50JywNCiAgICBbODhdOiAnSWxsZWdhbCBuZXdsaW5lIGFmdGVyIHRocm93JywNCiAgICBbODldOiAnU3RyaWN0IG1vZGUgY29kZSBtYXkgbm90IGluY2x1ZGUgYSB3aXRoIHN0YXRlbWVudCcsDQogICAgWzkwXTogJ0lsbGVnYWwgcmV0dXJuIHN0YXRlbWVudCcsDQogICAgWzkxXTogJ1RoZSBsZWZ0IGhhbmQgc2lkZSBvZiB0aGUgZm9yLWhlYWRlciBiaW5kaW5nIGRlY2xhcmF0aW9uIGlzIG5vdCBkZXN0cnVjdGlibGUnLA0KICAgIFs5Ml06ICduZXcudGFyZ2V0IG9ubHkgYWxsb3dlZCB3aXRoaW4gZnVuY3Rpb25zJywNCiAgICBbOTRdOiAiJyMnIG5vdCBmb2xsb3dlZCBieSBpZGVudGlmaWVyIiwNCiAgICBbMTAwXTogJ0ludmFsaWQga2V5d29yZCcsDQogICAgWzk5XTogIkNhbiBub3QgdXNlICdsZXQnIGFzIGEgY2xhc3MgbmFtZSIsDQogICAgWzk4XTogIidBIGxleGljYWwgZGVjbGFyYXRpb24gY2FuJ3QgZGVmaW5lIGEgJ2xldCcgYmluZGluZyIsDQogICAgWzk3XTogJ0NhbiBub3QgdXNlIGBsZXRgIGFzIHZhcmlhYmxlIG5hbWUgaW4gc3RyaWN0IG1vZGUnLA0KICAgIFs5NV06ICInJTAnIG1heSBub3QgYmUgdXNlZCBhcyBhbiBpZGVudGlmaWVyIGluIHRoaXMgY29udGV4dCIsDQogICAgWzk2XTogJ0F3YWl0IGlzIG9ubHkgdmFsaWQgaW4gYXN5bmMgZnVuY3Rpb25zJywNCiAgICBbMTAxXTogJ1RoZSAlMCBrZXl3b3JkIGNhbiBvbmx5IGJlIHVzZWQgd2l0aCB0aGUgbW9kdWxlIGdvYWwnLA0KICAgIFsxMDJdOiAnVW5pY29kZSBjb2RlcG9pbnQgbXVzdCBub3QgYmUgZ3JlYXRlciB0aGFuIDB4MTBGRkZGJywNCiAgICBbMTAzXTogJyUwIHNvdXJjZSBtdXN0IGJlIHN0cmluZycsDQogICAgWzEwNF06ICdPbmx5IGEgaWRlbnRpZmllciBjYW4gYmUgdXNlZCB0byBpbmRpY2F0ZSBhbGlhcycsDQogICAgWzEwNV06ICJPbmx5ICcqJyBvciAney4uLn0nIGNhbiBiZSBpbXBvcnRlZCBhZnRlciBkZWZhdWx0IiwNCiAgICBbMTA2XTogJ1RyYWlsaW5nIGRlY29yYXRvciBtYXkgYmUgZm9sbG93ZWQgYnkgbWV0aG9kJywNCiAgICBbMTA3XTogIkRlY29yYXRvcnMgY2FuJ3QgYmUgdXNlZCB3aXRoIGEgY29uc3RydWN0b3IiLA0KICAgIFsxMDldOiAnSFRNTCBjb21tZW50cyBhcmUgb25seSBhbGxvd2VkIHdpdGggd2ViIGNvbXBhdGliaWxpdHkgKEFubmV4IEIpJywNCiAgICBbMTEwXTogIlRoZSBpZGVudGlmaWVyICdsZXQnIG11c3Qgbm90IGJlIGluIGV4cHJlc3Npb24gcG9zaXRpb24gaW4gc3RyaWN0IG1vZGUiLA0KICAgIFsxMTFdOiAnQ2Fubm90IGFzc2lnbiB0byBgZXZhbGAgYW5kIGBhcmd1bWVudHNgIGluIHN0cmljdCBtb2RlJywNCiAgICBbMTEyXTogIlRoZSBsZWZ0LWhhbmQgc2lkZSBvZiBhIGZvci1vZiBsb29wIG1heSBub3Qgc3RhcnQgd2l0aCAnbGV0JyIsDQogICAgWzExM106ICdCbG9jayBib2R5IGFycm93cyBjYW4gbm90IGJlIGltbWVkaWF0ZWx5IGludm9rZWQgd2l0aG91dCBhIGdyb3VwJywNCiAgICBbMTE0XTogJ0Jsb2NrIGJvZHkgYXJyb3dzIGNhbiBub3QgYmUgaW1tZWRpYXRlbHkgYWNjZXNzZWQgd2l0aG91dCBhIGdyb3VwJywNCiAgICBbMTE1XTogJ1VuZXhwZWN0ZWQgc3RyaWN0IG1vZGUgcmVzZXJ2ZWQgd29yZCcsDQogICAgWzExNl06ICdVbmV4cGVjdGVkIGV2YWwgb3IgYXJndW1lbnRzIGluIHN0cmljdCBtb2RlJywNCiAgICBbMTE3XTogJ0RlY29yYXRvcnMgbXVzdCBub3QgYmUgZm9sbG93ZWQgYnkgYSBzZW1pY29sb24nLA0KICAgIFsxMThdOiAnQ2FsbGluZyBkZWxldGUgb24gZXhwcmVzc2lvbiBub3QgYWxsb3dlZCBpbiBzdHJpY3QgbW9kZScsDQogICAgWzExOV06ICdQYXR0ZXJuIGNhbiBub3QgaGF2ZSBhIHRhaWwnLA0KICAgIFsxMjFdOiAnQ2FuIG5vdCBoYXZlIGEgYHlpZWxkYCBleHByZXNzaW9uIG9uIHRoZSBsZWZ0IHNpZGUgb2YgYSB0ZXJuYXJ5JywNCiAgICBbMTIyXTogJ0FuIGFycm93IGZ1bmN0aW9uIGNhbiBub3QgaGF2ZSBhIHBvc3RmaXggdXBkYXRlIG9wZXJhdG9yJywNCiAgICBbMTIzXTogJ0ludmFsaWQgb2JqZWN0IGxpdGVyYWwga2V5IGNoYXJhY3RlciBhZnRlciBnZW5lcmF0b3Igc3RhcicsDQogICAgWzEyNF06ICdQcml2YXRlIGZpZWxkcyBjYW4gbm90IGJlIGRlbGV0ZWQnLA0KICAgIFsxMjZdOiAnQ2xhc3NlcyBtYXkgbm90IGhhdmUgYSBmaWVsZCBjYWxsZWQgY29uc3RydWN0b3InLA0KICAgIFsxMjVdOiAnQ2xhc3NlcyBtYXkgbm90IGhhdmUgYSBwcml2YXRlIGVsZW1lbnQgbmFtZWQgY29uc3RydWN0b3InLA0KICAgIFsxMjddOiAnQSBjbGFzcyBmaWVsZCBpbml0aWFsaXplciBtYXkgbm90IGNvbnRhaW4gYXJndW1lbnRzJywNCiAgICBbMTI4XTogJ0dlbmVyYXRvcnMgY2FuIG9ubHkgYmUgZGVjbGFyZWQgYXQgdGhlIHRvcCBsZXZlbCBvciBpbnNpZGUgYSBibG9jaycsDQogICAgWzEyOV06ICdBc3luYyBtZXRob2RzIGFyZSBhIHJlc3RyaWN0ZWQgcHJvZHVjdGlvbiBhbmQgY2Fubm90IGhhdmUgYSBuZXdsaW5lIGZvbGxvd2luZyBpdCcsDQogICAgWzEzMF06ICdVbmV4cGVjdGVkIGNoYXJhY3RlciBhZnRlciBvYmplY3QgbGl0ZXJhbCBwcm9wZXJ0eSBuYW1lJywNCiAgICBbMTMyXTogJ0ludmFsaWQga2V5IHRva2VuJywNCiAgICBbMTMzXTogIkxhYmVsICclMCcgaGFzIGFscmVhZHkgYmVlbiBkZWNsYXJlZCIsDQogICAgWzEzNF06ICdjb250aW51ZSBzdGF0ZW1lbnQgbXVzdCBiZSBuZXN0ZWQgd2l0aGluIGFuIGl0ZXJhdGlvbiBzdGF0ZW1lbnQnLA0KICAgIFsxMzVdOiAiVW5kZWZpbmVkIGxhYmVsICclMCciLA0KICAgIFsxMzZdOiAnVHJhaWxpbmcgY29tbWEgaXMgZGlzYWxsb3dlZCBpbnNpZGUgaW1wb3J0KC4uLikgYXJndW1lbnRzJywNCiAgICBbMTM3XTogJ2ltcG9ydCgpIHJlcXVpcmVzIGV4YWN0bHkgb25lIGFyZ3VtZW50JywNCiAgICBbMTM4XTogJ0Nhbm5vdCB1c2UgbmV3IHdpdGggaW1wb3J0KC4uLiknLA0KICAgIFsxMzldOiAnLi4uIGlzIG5vdCBhbGxvd2VkIGluIGltcG9ydCgpJywNCiAgICBbMTQwXTogIkV4cGVjdGVkICc9PiciLA0KICAgIFsxNDFdOiAiRHVwbGljYXRlIGJpbmRpbmcgJyUwJyIsDQogICAgWzE0Ml06ICJDYW5ub3QgZXhwb3J0IGEgZHVwbGljYXRlIG5hbWUgJyUwJyIsDQogICAgWzE0NV06ICdEdXBsaWNhdGUgJTAgZm9yLWJpbmRpbmcnLA0KICAgIFsxNDNdOiAiRXhwb3J0ZWQgYmluZGluZyAnJTAnIG5lZWRzIHRvIHJlZmVyIHRvIGEgdG9wLWxldmVsIGRlY2xhcmVkIHZhcmlhYmxlIiwNCiAgICBbMTQ0XTogJ1VuZXhwZWN0ZWQgcHJpdmF0ZSBmaWVsZCcsDQogICAgWzE0OF06ICdOdW1lcmljIHNlcGFyYXRvcnMgYXJlIG5vdCBhbGxvd2VkIGF0IHRoZSBlbmQgb2YgbnVtZXJpYyBsaXRlcmFscycsDQogICAgWzE0N106ICdPbmx5IG9uZSB1bmRlcnNjb3JlIGlzIGFsbG93ZWQgYXMgbnVtZXJpYyBzZXBhcmF0b3InLA0KICAgIFsxNDldOiAnSlNYIHZhbHVlIHNob3VsZCBiZSBlaXRoZXIgYW4gZXhwcmVzc2lvbiBvciBhIHF1b3RlZCBKU1ggdGV4dCcsDQogICAgWzE1MF06ICdFeHBlY3RlZCBjb3JyZXNwb25kaW5nIEpTWCBjbG9zaW5nIHRhZyBmb3IgJTAnLA0KICAgIFsxNTFdOiAnQWRqYWNlbnQgSlNYIGVsZW1lbnRzIG11c3QgYmUgd3JhcHBlZCBpbiBhbiBlbmNsb3NpbmcgdGFnJywNCiAgICBbMTUyXTogIkpTWCBhdHRyaWJ1dGVzIG11c3Qgb25seSBiZSBhc3NpZ25lZCBhIG5vbi1lbXB0eSAnZXhwcmVzc2lvbiciLA0KICAgIFsxNTNdOiAiJyUwJyBoYXMgYWxyZWFkeSBiZWVuIGRlY2xhcmVkIiwNCiAgICBbMTU0XTogIiclMCcgc2hhZG93ZWQgYSBjYXRjaCBjbGF1c2UgYmluZGluZyIsDQogICAgWzE1NV06ICdEb3QgcHJvcGVydHkgbXVzdCBiZSBhbiBpZGVudGlmaWVyJywNCiAgICBbMTU2XTogJ0VuY291bnRlcmVkIGludmFsaWQgaW5wdXQgYWZ0ZXIgc3ByZWFkL3Jlc3QgYXJndW1lbnQnLA0KICAgIFsxNTddOiAnQ2F0Y2ggd2l0aG91dCB0cnknLA0KICAgIFsxNThdOiAnRmluYWxseSB3aXRob3V0IHRyeScsDQogICAgWzE1OV06ICdFeHBlY3RlZCBjb3JyZXNwb25kaW5nIGNsb3NpbmcgdGFnIGZvciBKU1ggZnJhZ21lbnQnLA0KICAgIFsxNjBdOiAnQ29hbGVzY2luZyBhbmQgbG9naWNhbCBvcGVyYXRvcnMgdXNlZCB0b2dldGhlciBpbiB0aGUgc2FtZSBleHByZXNzaW9uIG11c3QgYmUgZGlzYW1iaWd1YXRlZCB3aXRoIHBhcmVudGhlc2VzJywNCiAgICBbMTYxXTogJ0ludmFsaWQgdGFnZ2VkIHRlbXBsYXRlIG9uIG9wdGlvbmFsIGNoYWluJywNCiAgICBbMTYyXTogJ0ludmFsaWQgb3B0aW9uYWwgY2hhaW4gZnJvbSBzdXBlciBwcm9wZXJ0eScsDQogICAgWzE2M106ICdJbnZhbGlkIG9wdGlvbmFsIGNoYWluIGZyb20gbmV3IGV4cHJlc3Npb24nLA0KICAgIFsxNjRdOiAnQ2Fubm90IHVzZSAiaW1wb3J0Lm1ldGEiIG91dHNpZGUgYSBtb2R1bGUnLA0KICAgIFsxNjVdOiAnTGVhZGluZyBkZWNvcmF0b3JzIG11c3QgYmUgYXR0YWNoZWQgdG8gYSBjbGFzcyBkZWNsYXJhdGlvbicNCn07DQpjbGFzcyBQYXJzZUVycm9yIGV4dGVuZHMgU3ludGF4RXJyb3Igew0KICAgIGNvbnN0cnVjdG9yKHN0YXJ0aW5kZXgsIGxpbmUsIGNvbHVtbiwgdHlwZSwgLi4ucGFyYW1zKSB7DQogICAgICAgIGNvbnN0IG1lc3NhZ2UgPSAnWycgKyBsaW5lICsgJzonICsgY29sdW1uICsgJ106ICcgKyBlcnJvck1lc3NhZ2VzW3R5cGVdLnJlcGxhY2UoLyUoXGQrKS9nLCAoXywgaSkgPT4gcGFyYW1zW2ldKTsNCiAgICAgICAgc3VwZXIoYCR7bWVzc2FnZX1gKTsNCiAgICAgICAgdGhpcy5pbmRleCA9IHN0YXJ0aW5kZXg7DQogICAgICAgIHRoaXMubGluZSA9IGxpbmU7DQogICAgICAgIHRoaXMuY29sdW1uID0gY29sdW1uOw0KICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gbWVzc2FnZTsNCiAgICAgICAgdGhpcy5sb2MgPSB7DQogICAgICAgICAgICBsaW5lLA0KICAgICAgICAgICAgY29sdW1uDQogICAgICAgIH07DQogICAgfQ0KfQ0KZnVuY3Rpb24gcmVwb3J0KHBhcnNlciwgdHlwZSwgLi4ucGFyYW1zKSB7DQogICAgdGhyb3cgbmV3IFBhcnNlRXJyb3IocGFyc2VyLmluZGV4LCBwYXJzZXIubGluZSwgcGFyc2VyLmNvbHVtbiwgdHlwZSwgLi4ucGFyYW1zKTsNCn0NCmZ1bmN0aW9uIHJlcG9ydFNjb3BlRXJyb3Ioc2NvcGUpIHsNCiAgICB0aHJvdyBuZXcgUGFyc2VFcnJvcihzY29wZS5pbmRleCwgc2NvcGUubGluZSwgc2NvcGUuY29sdW1uLCBzY29wZS50eXBlLCBzY29wZS5wYXJhbXMpOw0KfQ0KZnVuY3Rpb24gcmVwb3J0TWVzc2FnZUF0KGluZGV4LCBsaW5lLCBjb2x1bW4sIHR5cGUsIC4uLnBhcmFtcykgew0KICAgIHRocm93IG5ldyBQYXJzZUVycm9yKGluZGV4LCBsaW5lLCBjb2x1bW4sIHR5cGUsIC4uLnBhcmFtcyk7DQp9DQpmdW5jdGlvbiByZXBvcnRTY2FubmVyRXJyb3IoaW5kZXgsIGxpbmUsIGNvbHVtbiwgdHlwZSkgew0KICAgIHRocm93IG5ldyBQYXJzZUVycm9yKGluZGV4LCBsaW5lLCBjb2x1bW4sIHR5cGUpOw0KfQoKY29uc3QgdW5pY29kZUxvb2t1cCA9ICgoY29tcHJlc3NlZCwgbG9va3VwKSA9PiB7DQogICAgY29uc3QgcmVzdWx0ID0gbmV3IFVpbnQzMkFycmF5KDEwNDQ0OCk7DQogICAgbGV0IGluZGV4ID0gMDsNCiAgICBsZXQgc3ViSW5kZXggPSAwOw0KICAgIHdoaWxlIChpbmRleCA8IDM1NDApIHsNCiAgICAgICAgY29uc3QgaW5zdCA9IGNvbXByZXNzZWRbaW5kZXgrK107DQogICAgICAgIGlmIChpbnN0IDwgMCkgew0KICAgICAgICAgICAgc3ViSW5kZXggLT0gaW5zdDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGxldCBjb2RlID0gY29tcHJlc3NlZFtpbmRleCsrXTsNCiAgICAgICAgICAgIGlmIChpbnN0ICYgMikNCiAgICAgICAgICAgICAgICBjb2RlID0gbG9va3VwW2NvZGVdOw0KICAgICAgICAgICAgaWYgKGluc3QgJiAxKSB7DQogICAgICAgICAgICAgICAgcmVzdWx0LmZpbGwoY29kZSwgc3ViSW5kZXgsIHN1YkluZGV4ICs9IGNvbXByZXNzZWRbaW5kZXgrK10pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmVzdWx0W3N1YkluZGV4KytdID0gY29kZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0Ow0KfSkoWy0xLCAyLCAyNCwgMiwgMjUsIDIsIDUsIC0xLCAwLCA3NzU5NTY0OCwgMywgNDQsIDIsIDMsIDAsIDE0LCAyLCA1NywgMiwgNTgsIDMsIDAsIDMsIDAsIDMxNjg3OTY2NzEsIDAsIDQyOTQ5NTY5OTIsIDIsIDEsIDIsIDAsIDIsIDU5LCAzLCAwLCA0LCAwLCA0Mjk0OTY2NTIzLCAzLCAwLCA0LCAyLCAxNiwgMiwgNjAsIDIsIDAsIDAsIDQyOTQ4MzY3MzUsIDAsIDMyMjEyMjU0NzEsIDAsIDQyOTQ5MDE5NDIsIDIsIDYxLCAwLCAxMzQxNTIxOTIsIDMsIDAsIDIsIDAsIDQyOTQ5NTE5MzUsIDMsIDAsIDIsIDAsIDI2ODMzMDU5ODMsIDAsIDI2ODQzNTQwNDcsIDIsIDE3LCAyLCAwLCAwLCA0Mjk0OTYxMTUxLCAzLCAwLCAyLCAyLCAxOSwgMiwgMCwgMCwgNjA4MTc0MDc5LCAyLCAwLCAyLCAxMzEsIDIsIDYsIDIsIDU2LCAtMSwgMiwgMzcsIDAsIDQyOTQ0NDMyNjMsIDIsIDEsIDMsIDAsIDMsIDAsIDQyOTQ5MDE3MTEsIDIsIDM5LCAwLCA0MDg5ODM5MTAzLCAwLCAyOTYxMjA5NzU5LCAwLCAxMzQyNDM5Mzc1LCAwLCA0Mjk0NTQzMzQyLCAwLCAzNTQ3MjAxMDIzLCAwLCAxNTc3MjA0MTAzLCAwLCA0MTk0MjQwLCAwLCA0Mjk0Njg4NzUwLCAyLCAyLCAwLCA4MDgzMSwgMCwgNDI2MTQ3ODM1MSwgMCwgNDI5NDU0OTQ4NiwgMiwgMiwgMCwgMjk2NzQ4NDgzMSwgMCwgMTk2NTU5LCAwLCAzNTk0MzczMTAwLCAwLCAzMjg4MzE5NzY4LCAwLCA4NDY5OTU5LCAyLCAxOTQsIDIsIDMsIDAsIDM4MjUyMDQ3MzUsIDAsIDEyMzc0NzgwNywgMCwgNjU0ODcsIDAsIDQyOTQ4MjgwMTUsIDAsIDQwOTI1OTE2MTUsIDAsIDEwODAwNDkxMTksIDAsIDQ1ODcwMywgMiwgMywgMiwgMCwgMCwgMjE2MzI0NDUxMSwgMCwgNDIyNzkyMzkxOSwgMCwgNDIzNjI0NzAyMiwgMiwgNjYsIDAsIDQyODQ0NDk5MTksIDAsIDg1MTkwNCwgMiwgNCwgMiwgMTEsIDAsIDY3MDc2MDk1LCAtMSwgMiwgNjcsIDAsIDEwNzM3NDE3NDMsIDAsIDQwOTM1OTEzOTEsIC0xLCAwLCA1MDMzMTY0OSwgMCwgMzI2NTI2NjY4NywgMiwgMzIsIDAsIDQyOTQ4NDQ0MTUsIDAsIDQyNzgxOTAwNDcsIDIsIDE4LCAyLCAxMjksIC0xLCAzLCAwLCAyLCAyLCAyMSwgMiwgMCwgMiwgOSwgMiwgMCwgMiwgMTQsIDIsIDE1LCAzLCAwLCAxMCwgMiwgNjksIDIsIDAsIDIsIDcwLCAyLCA3MSwgMiwgNzIsIDIsIDAsIDIsIDczLCAyLCAwLCAyLCAxMCwgMCwgMjYxNjMyLCAyLCAyMywgMywgMCwgMiwgMiwgMTIsIDIsIDQsIDMsIDAsIDE4LCAyLCA3NCwgMiwgNSwgMywgMCwgMiwgMiwgNzUsIDAsIDIwODg5NTksIDIsIDI3LCAyLCA4LCAwLCA5MDkzMTEsIDMsIDAsIDIsIDAsIDgxNDc0MzU1MSwgMiwgNDEsIDAsIDY3MDU3NjY0LCAzLCAwLCAyLCAyLCA0MCwgMiwgMCwgMiwgMjgsIDIsIDAsIDIsIDI5LCAyLCA3LCAwLCAyNjgzNzQwMTUsIDIsIDI2LCAyLCA0OSwgMiwgMCwgMiwgNzYsIDAsIDEzNDE1MzIxNSwgLTEsIDIsIDYsIDIsIDAsIDIsIDcsIDAsIDI2ODQzNTQ1NTksIDAsIDY3MDQ0MzUxLCAwLCAzMjIxMTYwMDY0LCAwLCAxLCAtMSwgMywgMCwgMiwgMiwgNDIsIDAsIDEwNDY1MjgsIDMsIDAsIDMsIDIsIDgsIDIsIDAsIDIsIDUxLCAwLCA0Mjk0OTYwMTI3LCAyLCA5LCAyLCAzOCwgMiwgMTAsIDAsIDQyOTQzNzc0NzIsIDIsIDExLCAzLCAwLCA3LCAwLCA0MjI3ODU4NDMxLCAzLCAwLCA4LCAyLCAxMiwgMiwgMCwgMiwgNzgsIDIsIDksIDIsIDAsIDIsIDc5LCAyLCA4MCwgMiwgODEsIC0xLCAyLCAxMjQsIDAsIDEwNDg1NzcsIDIsIDgyLCAyLCAxMywgLTEsIDIsIDEzLCAwLCAxMzEwNDIsIDIsIDgzLCAyLCA4NCwgMiwgODUsIDIsIDAsIDIsIDMzLCAtODMsIDIsIDAsIDIsIDUzLCAyLCA3LCAzLCAwLCA0LCAwLCAxMDQ2NTU5LCAyLCAwLCAyLCAxNCwgMiwgMCwgMCwgMjE0NzUxNjY3MSwgMiwgMjAsIDMsIDg2LCAyLCAyLCAwLCAtMTYsIDIsIDg3LCAwLCA1MjQyMjI0NjIsIDIsIDQsIDIsIDAsIDAsIDQyNjk4MDE0NzEsIDIsIDQsIDIsIDAsIDIsIDE1LCAyLCA3NywgMiwgMTYsIDMsIDAsIDIsIDIsIDQ3LCAyLCAwLCAtMSwgMiwgMTcsIC0xNiwgMywgMCwgMjA2LCAtMiwgMywgMCwgNjU1LCAyLCAxOCwgMywgMCwgMzYsIDIsIDY4LCAtMSwgMiwgMTcsIDIsIDksIDMsIDAsIDgsIDIsIDg5LCAyLCAxMjEsIDIsIDAsIDAsIDMyMjAyNDI0MzEsIDMsIDAsIDMsIDIsIDE5LCAyLCA5MCwgMiwgOTEsIDMsIDAsIDIsIDIsIDkyLCAyLCAwLCAyLCA5MywgMiwgOTQsIDIsIDAsIDAsIDQzNTEsIDIsIDAsIDIsIDgsIDMsIDAsIDIsIDAsIDY3MDQzMzkxLCAwLCAzOTA5MDkxMzI3LCAyLCAwLCAyLCAyMiwgMiwgOCwgMiwgMTgsIDMsIDAsIDIsIDAsIDY3MDc2MDk3LCAyLCA3LCAyLCAwLCAyLCAyMCwgMCwgNjcwNTk3MTEsIDAsIDQyMzYyNDcwMzksIDMsIDAsIDIsIDAsIDkzOTUyNDEwMywgMCwgODE5MTk5OSwgMiwgOTcsIDIsIDk4LCAyLCAxNSwgMiwgMjEsIDMsIDAsIDMsIDAsIDY3MDU3NjYzLCAzLCAwLCAzNDksIDIsIDk5LCAyLCAxMDAsIDIsIDYsIC0yNjQsIDMsIDAsIDExLCAyLCAyMiwgMywgMCwgMiwgMiwgMzEsIC0xLCAwLCAzNzc0MzQ5NDM5LCAyLCAxMDEsIDIsIDEwMiwgMywgMCwgMiwgMiwgMTksIDIsIDEwMywgMywgMCwgMTAsIDIsIDksIDIsIDE3LCAyLCAwLCAyLCA0NSwgMiwgMCwgMiwgMzAsIDIsIDEwNCwgMiwgMjMsIDAsIDE2MzgzOTksIDIsIDE3MiwgMiwgMTA1LCAzLCAwLCAzLCAyLCAxOCwgMiwgMjQsIDIsIDI1LCAyLCA1LCAyLCAyNiwgMiwgMCwgMiwgNywgMiwgMTA2LCAtMSwgMiwgMTA3LCAyLCAxMDgsIDIsIDEwOSwgLTEsIDMsIDAsIDMsIDIsIDExLCAtMiwgMiwgMCwgMiwgMjcsIC0zLCAyLCAxNTAsIC00LCAyLCAxOCwgMiwgMCwgMiwgMzUsIDAsIDEsIDIsIDAsIDIsIDYyLCAyLCAyOCwgMiwgMTEsIDIsIDksIDIsIDAsIDIsIDExMCwgLTEsIDMsIDAsIDQsIDIsIDksIDIsIDIxLCAyLCAxMTEsIDIsIDYsIDIsIDAsIDIsIDExMiwgMiwgMCwgMiwgNDgsIC00LCAzLCAwLCA5LCAyLCAyMCwgMiwgMjksIDIsIDMwLCAtNCwgMiwgMTEzLCAyLCAxMTQsIDIsIDI5LCAyLCAyMCwgMiwgNywgLTIsIDIsIDExNSwgMiwgMjksIDIsIDMxLCAtMiwgMiwgMCwgMiwgMTE2LCAtMiwgMCwgNDI3NzEzNzUxOSwgMCwgMjI2OTExODQ2MywgLTEsIDMsIDE4LCAyLCAtMSwgMiwgMzIsIDIsIDM2LCAyLCAwLCAzLCAyOSwgMiwgMiwgMzQsIDIsIDE5LCAtMywgMywgMCwgMiwgMiwgMzMsIC0xLCAyLCAwLCAyLCAzNCwgMiwgMCwgMiwgMzQsIDIsIDAsIDIsIDQ2LCAtMTAsIDIsIDAsIDAsIDIwMzc3NSwgLTIsIDIsIDE4LCAyLCA0MywgMiwgMzUsIC0yLCAyLCAxNywgMiwgMTE3LCAyLCAyMCwgMywgMCwgMiwgMiwgMzYsIDAsIDIxNDc1NDkxMjAsIDIsIDAsIDIsIDExLCAyLCAxNywgMiwgMTM1LCAyLCAwLCAyLCAzNywgMiwgNTIsIDAsIDUyNDI4NzksIDMsIDAsIDIsIDAsIDQwMjY0NDUxMSwgLTEsIDIsIDEyMCwgMCwgMTA5MDUxOTAzOSwgLTIsIDIsIDEyMiwgMiwgMzgsIDIsIDAsIDAsIDY3MDQ1Mzc1LCAyLCAzOSwgMCwgNDIyNjY3ODI3MSwgMCwgMzc2NjU2NTI3OSwgMCwgMjAzOTc1OSwgLTQsIDMsIDAsIDIsIDAsIDMyODgyNzA4NDcsIDAsIDMsIDMsIDAsIDIsIDAsIDY3MDQzNTE5LCAtNSwgMiwgMCwgMCwgNDI4MjM4NDM4MywgMCwgMTA1Njk2NDYwOSwgLTEsIDMsIDAsIDIsIDAsIDY3MDQzMzQ1LCAtMSwgMiwgMCwgMiwgNDAsIDIsIDQxLCAtMSwgMiwgMTAsIDIsIDQyLCAtNiwgMiwgMCwgMiwgMTEsIC0zLCAzLCAwLCAyLCAwLCAyMTQ3NDg0NjcxLCAyLCAxMjUsIDAsIDQxOTAxMDk2OTUsIDIsIDUwLCAtMiwgMiwgMTI2LCAwLCA0MjQ0NjM1NjQ3LCAwLCAyNywgMiwgMCwgMiwgNywgMiwgNDMsIDIsIDAsIDIsIDYzLCAtMSwgMiwgMCwgMiwgNDAsIC04LCAyLCA1NCwgMiwgNDQsIDAsIDY3MDQzMzI5LCAyLCAxMjcsIDIsIDQ1LCAwLCA4Mzg4MzUxLCAtMiwgMiwgMTI4LCAwLCAzMDI4Mjg3NDg3LCAyLCA0NiwgMiwgMTMwLCAwLCAzMzI1OTUxOSwgMiwgNDEsIC05LCAyLCAyMCwgLTUsIDIsIDY0LCAtMiwgMywgMCwgMjgsIDIsIDMxLCAtMywgMywgMCwgMywgMiwgNDcsIDMsIDAsIDYsIDIsIDQ4LCAtODUsIDMsIDAsIDMzLCAyLCA0NywgLTEyNiwgMywgMCwgMTgsIDIsIDM2LCAtMjY5LCAzLCAwLCAxNywgMiwgNDAsIDIsIDcsIDIsIDQxLCAtMiwgMiwgMTcsIDIsIDQ5LCAyLCAwLCAyLCAyMCwgMiwgNTAsIDIsIDEzMiwgMiwgMjMsIC0yMSwgMywgMCwgMiwgLTQsIDMsIDAsIDIsIDAsIDQyOTQ5MzY1NzUsIDIsIDAsIDAsIDQyOTQ5MzQ3ODMsIC0yLCAwLCAxOTY2MzUsIDMsIDAsIDE5MSwgMiwgNTEsIDMsIDAsIDM4LCAyLCAyOSwgLTEsIDIsIDMzLCAtMjc5LCAzLCAwLCA4LCAyLCA3LCAtMSwgMiwgMTMzLCAyLCA1MiwgMywgMCwgMTEsIDIsIDYsIC03MiwgMywgMCwgMywgMiwgMTM0LCAwLCAxNjc3NjU2NTc1LCAtMTY2LCAwLCA0MTYxMjY2NjU2LCAwLCA0MDcxLCAwLCAxNTM2MCwgLTQsIDAsIDI4LCAtMTMsIDMsIDAsIDIsIDIsIDM3LCAyLCAwLCAyLCAxMzYsIDIsIDEzNywgMiwgNTUsIDIsIDAsIDIsIDEzOCwgMiwgMTM5LCAyLCAxNDAsIDMsIDAsIDEwLCAyLCAxNDEsIDIsIDE0MiwgMiwgMTUsIDMsIDM3LCAyLCAzLCA1MywgMiwgMywgNTQsIDIsIDAsIDQyOTQ5NTQ5OTksIDIsIDAsIC0xNiwgMiwgMCwgMiwgODgsIDIsIDAsIDAsIDIxMDUzNDMsIDAsIDQxNjA3NDk1ODQsIDAsIDY1NTM0LCAtNDIsIDAsIDQxOTQzMDM4NzEsIDAsIDIwMTEsIC02LCAyLCAwLCAwLCAxMDczNjg0NDc5LCAwLCAxNzQwNywgLTExLCAyLCAwLCAyLCAzMSwgLTQwLCAzLCAwLCA2LCAwLCA4MzIzMTAzLCAtMSwgMywgMCwgMiwgMiwgNDIsIC0zNywgMiwgNTUsIDIsIDE0NCwgMiwgMTQ1LCAyLCAxNDYsIDIsIDE0NywgMiwgMTQ4LCAtMTA1LCAyLCAyNCwgLTMyLCAzLCAwLCAxMzM0LCAyLCA5LCAtMSwgMywgMCwgMTI5LCAyLCAyNywgMywgMCwgNiwgMiwgOSwgMywgMCwgMTgwLCAyLCAxNDksIDMsIDAsIDIzMywgMCwgMSwgLTk2LCAzLCAwLCAxNiwgMiwgOSwgLTQ3LCAzLCAwLCAxNTQsIDIsIDU2LCAtMjIzODEsIDMsIDAsIDcsIDIsIDIzLCAtNjEzMCwgMywgNSwgMiwgLTEsIDAsIDY5MjA3MDQwLCAzLCA0NCwgMiwgMywgMCwgMTQsIDIsIDU3LCAyLCA1OCwgLTMsIDAsIDMxNjg3MzExMzYsIDAsIDQyOTQ5NTY4NjQsIDIsIDEsIDIsIDAsIDIsIDU5LCAzLCAwLCA0LCAwLCA0Mjk0OTY2Mjc1LCAzLCAwLCA0LCAyLCAxNiwgMiwgNjAsIDIsIDAsIDIsIDMzLCAtMSwgMiwgMTcsIDIsIDYxLCAtMSwgMiwgMCwgMiwgNTYsIDAsIDQyOTQ4ODUzNzYsIDMsIDAsIDIsIDAsIDMxNDU3MjcsIDAsIDI2MTcyOTQ5NDQsIDAsIDQyOTQ3NzA2ODgsIDIsIDIzLCAyLCA2MiwgMywgMCwgMiwgMCwgMTMxMTM1LCAyLCA5NSwgMCwgNzAyNTY2MzksIDAsIDcxMzAzMTY3LCAwLCAyNzIsIDIsIDQwLCAyLCA1NiwgLTEsIDIsIDM3LCAyLCAzMCwgLTEsIDIsIDk2LCAyLCA2MywgMCwgNDI3ODI1NTYxNiwgMCwgNDI5NDgzNjIyNywgMCwgNDI5NDU0OTQ3MywgMCwgNjAwMTc4MTc1LCAwLCAyOTUyODA2NDAwLCAwLCAyNjg2MzIwNjcsIDAsIDQyOTQ1NDMzMjgsIDAsIDU3NTQwMDk1LCAwLCAxNTc3MDU4MzA0LCAwLCAxODM1MDA4LCAwLCA0Mjk0Njg4NzM2LCAyLCA2NSwgMiwgNjQsIDAsIDMzNTU0NDM1LCAyLCAxMjMsIDIsIDY1LCAyLCAxNTEsIDAsIDEzMTA3NSwgMCwgMzU5NDM3MzA5NiwgMCwgNjcwOTQyOTYsIDIsIDY0LCAtMSwgMCwgNDI5NDgyODAwMCwgMCwgNjAzOTc5MjYzLCAyLCAxNjAsIDAsIDMsIDAsIDQyOTQ4MjgwMDEsIDAsIDYwMjkzMDY4NywgMiwgMTgzLCAwLCAzOTMyMTksIDAsIDQyOTQ4MjgwMTYsIDAsIDY3MTA4ODYzOSwgMCwgMjE1NDg0MDA2NCwgMCwgNDIyNzg1ODQzNSwgMCwgNDIzNjI0NzAwOCwgMiwgNjYsIDIsIDM2LCAtMSwgMiwgNCwgMCwgOTE3NTAzLCAyLCAzNiwgLTEsIDIsIDY3LCAwLCA1Mzc3ODgzMzUsIDAsIDQwMjY1MzE5MzUsIC0xLCAwLCAxLCAtMSwgMiwgMzIsIDIsIDY4LCAwLCA3OTM2LCAtMywgMiwgMCwgMCwgMjE0NzQ4NTY5NSwgMCwgMTAxMDc2MTcyOCwgMCwgNDI5Mjk4NDkzMCwgMCwgMTYzODcsIDIsIDAsIDIsIDE0LCAyLCAxNSwgMywgMCwgMTAsIDIsIDY5LCAyLCAwLCAyLCA3MCwgMiwgNzEsIDIsIDcyLCAyLCAwLCAyLCA3MywgMiwgMCwgMiwgMTEsIC0xLCAyLCAyMywgMywgMCwgMiwgMiwgMTIsIDIsIDQsIDMsIDAsIDE4LCAyLCA3NCwgMiwgNSwgMywgMCwgMiwgMiwgNzUsIDAsIDI1Mzk1MSwgMywgMTksIDIsIDAsIDEyMjg3OSwgMiwgMCwgMiwgOCwgMCwgMjc2ODI0MDY0LCAtMiwgMywgMCwgMiwgMiwgNDAsIDIsIDAsIDAsIDQyOTQ5MDMyOTUsIDIsIDAsIDIsIDI5LCAyLCA3LCAtMSwgMiwgMTcsIDIsIDQ5LCAyLCAwLCAyLCA3NiwgMiwgNDEsIC0xLCAyLCAyMCwgMiwgMCwgMiwgMjcsIC0yLCAwLCAxMjgsIC0yLCAyLCA3NywgMiwgOCwgMCwgNDA2NCwgLTEsIDIsIDExOSwgMCwgNDIyNzkwNzU4NSwgMiwgMCwgMiwgMTE4LCAyLCAwLCAyLCA0OCwgMiwgMTczLCAyLCA5LCAyLCAzOCwgMiwgMTAsIC0xLCAwLCA3NDQ0MDE5MiwgMywgMCwgNiwgLTIsIDMsIDAsIDgsIDIsIDEyLCAyLCAwLCAyLCA3OCwgMiwgOSwgMiwgMCwgMiwgNzksIDIsIDgwLCAyLCA4MSwgLTMsIDIsIDgyLCAyLCAxMywgLTMsIDIsIDgzLCAyLCA4NCwgMiwgODUsIDIsIDAsIDIsIDMzLCAtODMsIDIsIDAsIDIsIDUzLCAyLCA3LCAzLCAwLCA0LCAwLCA4MTcxODMsIDIsIDAsIDIsIDE0LCAyLCAwLCAwLCAzMzAyMywgMiwgMjAsIDMsIDg2LCAyLCAtMTcsIDIsIDg3LCAwLCA1MjQxNTc5NTAsIDIsIDQsIDIsIDAsIDIsIDg4LCAyLCA0LCAyLCAwLCAyLCAxNSwgMiwgNzcsIDIsIDE2LCAzLCAwLCAyLCAyLCA0NywgMiwgMCwgLTEsIDIsIDE3LCAtMTYsIDMsIDAsIDIwNiwgLTIsIDMsIDAsIDY1NSwgMiwgMTgsIDMsIDAsIDM2LCAyLCA2OCwgLTEsIDIsIDE3LCAyLCA5LCAzLCAwLCA4LCAyLCA4OSwgMCwgMzA3MiwgMiwgMCwgMCwgMjE0NzUxNjQxNSwgMiwgOSwgMywgMCwgMiwgMiwgMjMsIDIsIDkwLCAyLCA5MSwgMywgMCwgMiwgMiwgOTIsIDIsIDAsIDIsIDkzLCAyLCA5NCwgMCwgNDI5NDk2NTE3OSwgMCwgNywgMiwgMCwgMiwgOCwgMiwgOTEsIDIsIDgsIC0xLCAwLCAxNzYxMzQ1NTM2LCAyLCA5NSwgMCwgNDI5NDkwMTgyMywgMiwgMzYsIDIsIDE4LCAyLCA5NiwgMiwgMzQsIDIsIDE2NiwgMCwgMjA4MDQ0MDI4NywgMiwgMCwgMiwgMzMsIDIsIDE0MywgMCwgMzI5NjcyMjk0MywgMiwgMCwgMCwgMTA0NjY3NTQ1NSwgMCwgOTM5NTI0MTAxLCAwLCAxODM3MDU1LCAyLCA5NywgMiwgOTgsIDIsIDE1LCAyLCAyMSwgMywgMCwgMywgMCwgNywgMywgMCwgMzQ5LCAyLCA5OSwgMiwgMTAwLCAyLCA2LCAtMjY0LCAzLCAwLCAxMSwgMiwgMjIsIDMsIDAsIDIsIDIsIDMxLCAtMSwgMCwgMjcwMDYwNzYxNSwgMiwgMTAxLCAyLCAxMDIsIDMsIDAsIDIsIDIsIDE5LCAyLCAxMDMsIDMsIDAsIDEwLCAyLCA5LCAyLCAxNywgMiwgMCwgMiwgNDUsIDIsIDAsIDIsIDMwLCAyLCAxMDQsIC0zLCAyLCAxMDUsIDMsIDAsIDMsIDIsIDE4LCAtMSwgMywgNSwgMiwgMiwgMjYsIDIsIDAsIDIsIDcsIDIsIDEwNiwgLTEsIDIsIDEwNywgMiwgMTA4LCAyLCAxMDksIC0xLCAzLCAwLCAzLCAyLCAxMSwgLTIsIDIsIDAsIDIsIDI3LCAtOCwgMiwgMTgsIDIsIDAsIDIsIDM1LCAtMSwgMiwgMCwgMiwgNjIsIDIsIDI4LCAyLCAyOSwgMiwgOSwgMiwgMCwgMiwgMTEwLCAtMSwgMywgMCwgNCwgMiwgOSwgMiwgMTcsIDIsIDExMSwgMiwgNiwgMiwgMCwgMiwgMTEyLCAyLCAwLCAyLCA0OCwgLTQsIDMsIDAsIDksIDIsIDIwLCAyLCAyOSwgMiwgMzAsIC00LCAyLCAxMTMsIDIsIDExNCwgMiwgMjksIDIsIDIwLCAyLCA3LCAtMiwgMiwgMTE1LCAyLCAyOSwgMiwgMzEsIC0yLCAyLCAwLCAyLCAxMTYsIC0yLCAwLCA0Mjc3MDc1OTY5LCAyLCAyOSwgLTEsIDMsIDE4LCAyLCAtMSwgMiwgMzIsIDIsIDExNywgMiwgMCwgMywgMjksIDIsIDIsIDM0LCAyLCAxOSwgLTMsIDMsIDAsIDIsIDIsIDMzLCAtMSwgMiwgMCwgMiwgMzQsIDIsIDAsIDIsIDM0LCAyLCAwLCAyLCA0OCwgLTEwLCAyLCAwLCAwLCAxOTc2MzEsIC0yLCAyLCAxOCwgMiwgNDMsIDIsIDExOCwgLTIsIDIsIDE3LCAyLCAxMTcsIDIsIDIwLCAyLCAxMTksIDIsIDUxLCAtMiwgMiwgMTE5LCAyLCAyMywgMiwgMTcsIDIsIDMzLCAyLCAxMTksIDIsIDM2LCAwLCA0Mjk0OTAxOTA0LCAwLCA0NzE4NTkxLCAyLCAxMTksIDIsIDM0LCAwLCAzMzU1NDQzNTAsIC0xLCAyLCAxMjAsIDIsIDEyMSwgLTIsIDIsIDEyMiwgMiwgMzgsIDIsIDcsIC0xLCAyLCAxMjMsIDIsIDY1LCAwLCAzNzU4MTYxOTIwLCAwLCAzLCAtNCwgMiwgMCwgMiwgMjcsIDAsIDIxNDc0ODU1NjgsIDAsIDMsIDIsIDAsIDIsIDIzLCAwLCAxNzYsIC01LCAyLCAwLCAyLCA0NywgMiwgMTg2LCAtMSwgMiwgMCwgMiwgMjMsIDIsIDE5NywgLTEsIDIsIDAsIDAsIDE2Nzc5MjYzLCAtMiwgMiwgMTEsIC03LCAyLCAwLCAyLCAxMjEsIC0zLCAzLCAwLCAyLCAyLCAxMjQsIDIsIDEyNSwgMCwgMjE0NzU0OTE4MywgMCwgMiwgLTIsIDIsIDEyNiwgMiwgMzUsIDAsIDEwLCAwLCA0Mjk0OTY1MjQ5LCAwLCA2NzYzMzE1MSwgMCwgNDAyNjU5NzM3NiwgMiwgMCwgMCwgNTM2ODcxOTM1LCAtMSwgMiwgMCwgMiwgNDAsIC04LCAyLCA1NCwgMiwgNDcsIDAsIDEsIDIsIDEyNywgMiwgMjMsIC0zLCAyLCAxMjgsIDIsIDM1LCAyLCAxMjksIDIsIDEzMCwgMCwgMTY3NzgyMzksIC0xMCwgMiwgMzQsIC01LCAyLCA2NCwgLTIsIDMsIDAsIDI4LCAyLCAzMSwgLTMsIDMsIDAsIDMsIDIsIDQ3LCAzLCAwLCA2LCAyLCA0OCwgLTg1LCAzLCAwLCAzMywgMiwgNDcsIC0xMjYsIDMsIDAsIDE4LCAyLCAzNiwgLTI2OSwgMywgMCwgMTcsIDIsIDQwLCAyLCA3LCAtMywgMiwgMTcsIDIsIDEzMSwgMiwgMCwgMiwgMjMsIDIsIDQ4LCAyLCAxMzIsIDIsIDIzLCAtMjEsIDMsIDAsIDIsIC00LCAzLCAwLCAyLCAwLCA2NzU4MywgLTEsIDIsIDEwMywgLTIsIDAsIDExLCAzLCAwLCAxOTEsIDIsIDUxLCAzLCAwLCAzOCwgMiwgMjksIC0xLCAyLCAzMywgLTI3OSwgMywgMCwgOCwgMiwgNywgLTEsIDIsIDEzMywgMiwgNTIsIDMsIDAsIDExLCAyLCA2LCAtNzIsIDMsIDAsIDMsIDIsIDEzNCwgMiwgMTM1LCAtMTg3LCAzLCAwLCAyLCAyLCAzNywgMiwgMCwgMiwgMTM2LCAyLCAxMzcsIDIsIDU1LCAyLCAwLCAyLCAxMzgsIDIsIDEzOSwgMiwgMTQwLCAzLCAwLCAxMCwgMiwgMTQxLCAyLCAxNDIsIDIsIDE1LCAzLCAzNywgMiwgMywgNTMsIDIsIDMsIDU0LCAyLCAyLCAxNDMsIC03MywgMiwgMCwgMCwgMTA2NTM2MTQwNywgMCwgMTYzODQsIC0xMSwgMiwgMCwgMiwgMTIxLCAtNDAsIDMsIDAsIDYsIDIsIDExNywgLTEsIDMsIDAsIDIsIDAsIDIwNjMsIC0zNywgMiwgNTUsIDIsIDE0NCwgMiwgMTQ1LCAyLCAxNDYsIDIsIDE0NywgMiwgMTQ4LCAtMTM4LCAzLCAwLCAxMzM0LCAyLCA5LCAtMSwgMywgMCwgMTI5LCAyLCAyNywgMywgMCwgNiwgMiwgOSwgMywgMCwgMTgwLCAyLCAxNDksIDMsIDAsIDIzMywgMCwgMSwgLTk2LCAzLCAwLCAxNiwgMiwgOSwgLTQ3LCAzLCAwLCAxNTQsIDIsIDU2LCAtMjg1MTcsIDIsIDAsIDAsIDEsIC0xLCAyLCAxMjQsIDIsIDAsIDAsIDgxOTMsIC0yMSwgMiwgMTkzLCAwLCAxMDI1NSwgMCwgNCwgLTExLCAyLCA2NCwgMiwgMTcxLCAtMSwgMCwgNzE2ODAsIC0xLCAyLCAxNjEsIDAsIDQyOTI5MDA4NjQsIDAsIDgwNTMwNjQzMSwgLTUsIDIsIDE1MCwgLTEsIDIsIDE1NywgLTEsIDAsIDYxNDQsIC0yLCAyLCAxMjcsIC0xLCAyLCAxNTQsIC0xLCAwLCAyMTQ3NTMyODAwLCAyLCAxNTEsIDIsIDE2NSwgMiwgMCwgMiwgMTY0LCAwLCA1MjQwMzIsIDAsIDQsIC00LCAyLCAxOTAsIDAsIDIwNTEyODE5MiwgMCwgMTMzMzc1NzUzNiwgMCwgMjE0NzQ4MzY5NiwgMCwgNDIzOTUzLCAwLCA3NDc3NjYyNzIsIDAsIDI3MTc3NjMxOTIsIDAsIDQyODY1Nzg3NTEsIDAsIDI3ODU0NSwgMiwgMTUyLCAwLCA0Mjk0ODg2NDY0LCAwLCAzMzI5MjMzNiwgMCwgNDE3ODA5LCAyLCAxNTIsIDAsIDEzMjc0ODI0NjQsIDAsIDQyNzgxOTAxMjgsIDAsIDcwMDU5NDE5NSwgMCwgMTAwNjY0NzUyNywgMCwgNDI4NjQ5NzMzNiwgMCwgNDE2MDc0OTYzMSwgMiwgMTUzLCAwLCA0Njk3NjI1NjAsIDAsIDQxNzEyMTk0ODgsIDAsIDgzMjMxMjAsIDIsIDE1MywgMCwgMjAyMzc1NjgwLCAwLCAzMjE0OTE4MTc2LCAwLCA0Mjk0NTA4NTkyLCAyLCAxNTMsIC0xLCAwLCA5ODM1ODQsIDAsIDQ4LCAwLCA1ODcyMDI3MywgMCwgMzQ4OTkyMzA3MiwgMCwgMTA1MTczNzYsIDAsIDQyOTMwNjY4MTUsIDAsIDEsIDAsIDIwMTMyNjU5MjAsIDIsIDE3NywgMiwgMCwgMCwgMjA4OSwgMCwgMzIyMTIyNTU1MiwgMCwgMjAxMzc1OTA0LCAyLCAwLCAtMiwgMCwgMjU2LCAwLCAxMjI4ODAsIDAsIDE2Nzc3MjE2LCAyLCAxNTAsIDAsIDQxNjA3NTc3NjAsIDIsIDAsIC02LCAyLCAxNjcsIC0xMSwgMCwgMzI2MzIxODE3NiwgLTEsIDAsIDQ5NjY0LCAwLCAyMTYwMTk3NjMyLCAwLCA4Mzg4ODAyLCAtMSwgMCwgMTI3MTM5ODQsIC0xLCAyLCAxNTQsIDIsIDE1OSwgMiwgMTc4LCAtMiwgMiwgMTYyLCAtMjAsIDAsIDM3NTgwOTYzODUsIC0yLCAyLCAxNTUsIDAsIDQyOTI4NzgzMzYsIDIsIDkwLCAyLCAxNjksIDAsIDQyOTQwNTc5ODQsIC0yLCAyLCAxNjMsIDIsIDE1NiwgMiwgMTc1LCAtMiwgMiwgMTU1LCAtMSwgMiwgMTgyLCAtMSwgMiwgMTcwLCAyLCAxMjQsIDAsIDQwMjY1OTMyODAsIDAsIDE0LCAwLCA0MjkyOTE5Mjk2LCAtMSwgMiwgMTU4LCAwLCA5Mzk1ODg2MDgsIC0xLCAwLCA4MDUzMDYzNjgsIC0xLCAyLCAxMjQsIDAsIDE2MTA2MTI3MzYsIDIsIDE1NiwgMiwgMTU3LCAyLCA0LCAyLCAwLCAtMiwgMiwgMTU4LCAyLCAxNTksIC0zLCAwLCAyNjczODY4ODAsIC0xLCAyLCAxNjAsIDAsIDcxNjgsIC0xLCAwLCA2NTAyNCwgMiwgMTU0LCAyLCAxNjEsIDIsIDE3OSwgLTcsIDIsIDE2OCwgLTgsIDIsIDE2MiwgLTEsIDAsIDE0MjYxMTI3MDQsIDIsIDE2MywgLTEsIDIsIDE2NCwgMCwgMjcxNTgxMjE2LCAwLCAyMTQ5Nzc3NDA4LCAyLCAyMywgMiwgMTYxLCAyLCAxMjQsIDAsIDg1MTk2NywgMiwgMTgwLCAtMSwgMiwgMjMsIDIsIDE4MSwgLTQsIDIsIDE1OCwgLTIwLCAyLCAxOTUsIDIsIDE2NSwgLTU2LCAwLCAzMTQ1NzI4LCAyLCAxODUsIC00LCAyLCAxNjYsIDIsIDEyNCwgLTQsIDAsIDMyNTA1ODU2LCAtMSwgMiwgMTY3LCAtMSwgMCwgMjE0NzM4NTA4OCwgMiwgOTAsIDEsIDIxNTU5MDUxNTIsIDIsIC0zLCAyLCAxMDMsIDIsIDAsIDIsIDE2OCwgLTIsIDIsIDE2OSwgLTYsIDIsIDE3MCwgMCwgNDAyNjU5NzM3NSwgMCwgMSwgLTEsIDAsIDEsIC0xLCAyLCAxNzEsIC0zLCAyLCAxMTcsIDIsIDY0LCAtMiwgMiwgMTY2LCAtMiwgMiwgMTc2LCAyLCAxMjQsIC04NzgsIDIsIDE1OSwgLTM2LCAyLCAxNzIsIC0xLCAyLCAyMDEsIC0xMCwgMiwgMTg4LCAtNSwgMiwgMTc0LCAtNiwgMCwgNDI5NDk2NTI1MSwgMiwgMjcsIC0xLCAyLCAxNzMsIC0xLCAyLCAxNzQsIC0yLCAwLCA0MjI3ODc0NzUyLCAtMywgMCwgMjE0NjQzNTA3MiwgMiwgMTU5LCAtMiwgMCwgMTAwNjY0OTM0NCwgMiwgMTI0LCAtMSwgMiwgOTAsIDAsIDIwMTM3NTc0NCwgLTMsIDAsIDEzNDIxNzcyMCwgMiwgOTAsIDAsIDQyODY2NzczNzcsIDAsIDMyODk2LCAtMSwgMiwgMTU4LCAtMywgMiwgMTc1LCAtMzQ5LCAyLCAxNzYsIDAsIDE5MjAsIDIsIDE3NywgMywgMCwgMjY0LCAtMTEsIDIsIDE1NywgLTIsIDIsIDE3OCwgMiwgMCwgMCwgNTIwNjE3ODU2LCAwLCAyNjkyNzQzMTY4LCAwLCAzNiwgLTMsIDAsIDUyNDI4NCwgLTExLCAyLCAyMywgLTEsIDIsIDE4NywgLTEsIDIsIDE4NCwgMCwgMzIyMTI5MTAwNywgMiwgMTc4LCAtMSwgMiwgMjAyLCAwLCAyMTU4NzIwLCAtMywgMiwgMTU5LCAwLCAxLCAtNCwgMiwgMTI0LCAwLCAzODA4NjI1NDExLCAwLCAzNDg5NjI4Mjg4LCAyLCAyMDAsIDAsIDEyMDc5NTk2ODAsIDAsIDMyMjEyNzQ2MjQsIDIsIDAsIC0zLCAyLCAxNzksIDAsIDEyMCwgMCwgNzM0MDAzMiwgLTIsIDIsIDE4MCwgMiwgNCwgMiwgMjMsIDIsIDE2MywgMywgMCwgNCwgMiwgMTU5LCAtMSwgMiwgMTgxLCAyLCAxNzcsIC0xLCAwLCA4MTc2LCAyLCAxODIsIDIsIDE3OSwgMiwgMTgzLCAtMSwgMCwgNDI5MDc3MzIzMiwgMiwgMCwgLTQsIDIsIDE2MywgMiwgMTg5LCAwLCAxNTcyODY0MCwgMiwgMTc3LCAtMSwgMiwgMTYxLCAtMSwgMCwgNDI5NDkzNDUxMiwgMywgMCwgNCwgLTksIDIsIDkwLCAyLCAxNzAsIDIsIDE4NCwgMywgMCwgNCwgMCwgNzA0LCAwLCAxODQ5Njg4MDY0LCAyLCAxODUsIC0xLCAyLCAxMjQsIDAsIDQyOTQ5MDE4ODcsIDIsIDAsIDAsIDEzMDU0NzcxMiwgMCwgMTg3OTA0ODE5MiwgMiwgMTk5LCAzLCAwLCAyLCAtMSwgMiwgMTg2LCAyLCAxODcsIC0xLCAwLCAxNzgyOTc3NiwgMCwgMjAyNTg0ODgzMiwgMCwgNDI2MTQ3Nzg4OCwgLTIsIDIsIDAsIC0xLCAwLCA0Mjg2NTgwNjA4LCAtMSwgMCwgMjkzNjAxMjgsIDIsIDE5MiwgMCwgMTYyNTI5MjgsIDAsIDM3OTEzODg2NzIsIDIsIDM4LCAzLCAwLCAyLCAtMiwgMiwgMTk2LCAyLCAwLCAtMSwgMiwgMTAzLCAtMSwgMCwgNjY1ODQ1NzYsIC0xLCAyLCAxOTEsIDMsIDAsIDksIDIsIDEyNCwgLTEsIDAsIDQyOTQ3NTUzMjgsIDMsIDAsIDIsIC0xLCAyLCAxNjEsIDIsIDE3OCwgMywgMCwgMiwgMiwgMjMsIDIsIDE4OCwgMiwgOTAsIC0yLCAwLCAyNDU3NjAsIDAsIDIxNDc0MTgxMTIsIC0xLCAyLCAxNTAsIDIsIDIwMywgMCwgNDIyNzkyMzQ1NiwgLTEsIDIsIDE2NCwgMiwgMTYxLCAyLCA5MCwgLTMsIDAsIDQyOTI4NzAxNDUsIDAsIDI2MjE0NCwgMiwgMTI0LCAzLCAwLCAyLCAwLCAxMDczNzU4ODQ4LCAyLCAxODksIC0xLCAwLCA0MjI3OTIxOTIwLCAyLCAxOTAsIDAsIDY4Mjg5MDI0LCAwLCA1Mjg0MDIwMTYsIDAsIDQyOTI5Mjc1MzYsIDMsIDAsIDQsIC0yLCAwLCAyNjg0MzU0NTYsIDIsIDkxLCAtMiwgMiwgMTkxLCAzLCAwLCA1LCAtMSwgMiwgMTkyLCAyLCAxNjMsIDIsIDAsIC0yLCAwLCA0MjI3OTIzOTM2LCAyLCA2MiwgLTEsIDIsIDE1NSwgMiwgOTUsIDIsIDAsIDIsIDE1NCwgMiwgMTU4LCAzLCAwLCA2LCAtMSwgMiwgMTc3LCAzLCAwLCAzLCAtMiwgMCwgMjE0Njk1OTM2MCwgMCwgOTQ0MDY0MCwgMCwgMTA0ODU3NjAwLCAwLCA0MjI3OTIzODQwLCAzLCAwLCAyLCAwLCA3NjgsIDIsIDE5MywgMiwgNzcsIC0yLCAyLCAxNjEsIC0yLCAyLCAxMTksIC0xLCAyLCAxNTUsIDMsIDAsIDgsIDAsIDUxMiwgMCwgODM4ODYwOCwgMiwgMTk0LCAyLCAxNzIsIDIsIDE4NywgMCwgNDI4NjU3ODk0NCwgMywgMCwgMiwgMCwgMTE1MiwgMCwgMTI2NjY3OTgwOCwgMiwgMTkxLCAwLCA1NzYsIDAsIDQyNjE3MDc3NzYsIDIsIDk1LCAzLCAwLCA5LCAyLCAxNTUsIDMsIDAsIDUsIDIsIDE2LCAtMSwgMCwgMjE0NzIyMTUwNCwgLTI4LCAyLCAxNzgsIDMsIDAsIDMsIC0zLCAwLCA0MjkyOTAyOTEyLCAtNiwgMiwgOTYsIDMsIDAsIDg1LCAtMzMsIDAsIDQyOTQ5MzQ1MjgsIDMsIDAsIDEyNiwgLTE4LCAyLCAxOTUsIDMsIDAsIDI2OSwgLTE3LCAyLCAxNTUsIDIsIDEyNCwgMiwgMTk4LCAzLCAwLCAyLCAyLCAyMywgMCwgNDI5MDgyMjE0NCwgLTIsIDAsIDY3MTc0MzM2LCAwLCA1MjAwOTM3MDAsIDIsIDE3LCAzLCAwLCAyMSwgLTIsIDIsIDE3OSwgMywgMCwgMywgLTIsIDAsIDMwNzIwLCAtMSwgMCwgMzI1MTIsIDMsIDAsIDIsIDAsIDQyOTQ3NzA2NTYsIC0xOTEsIDIsIDE3NCwgLTM4LCAyLCAxNzAsIDIsIDAsIDIsIDE5NiwgMywgMCwgMjc5LCAtOCwgMiwgMTI0LCAyLCAwLCAwLCA0Mjk0NTA4NTQzLCAwLCA2NTI5NSwgLTExLCAyLCAxNzcsIDMsIDAsIDcyLCAtMywgMCwgMzc1ODE1OTg3MiwgMCwgMjAxMzkxNjE2LCAzLCAwLCAxNTUsIC03LCAyLCAxNzAsIC0xLCAwLCAzODQsIC0xLCAwLCAxMzM2OTM0NDAsIC0zLCAyLCAxOTYsIC0yLCAyLCAyNiwgMywgMCwgNCwgMiwgMTY5LCAtMiwgMiwgOTAsIDIsIDE1NSwgMywgMCwgNCwgLTIsIDIsIDE2NCwgLTEsIDIsIDE1MCwgMCwgMzM1NTUyOTIzLCAyLCAxOTcsIC0xLCAwLCA1Mzg5NzQyNzIsIDAsIDIyMTQ1OTI1MTIsIDAsIDEzMjAwMCwgLTEwLCAwLCAxOTIsIC04LCAwLCAxMjI4OCwgLTIxLCAwLCAxMzQyMTM2MzIsIDAsIDQyOTQ5MDE3NjEsIDMsIDAsIDQyLCAwLCAxMDA2NjM0MjQsIDAsIDQyOTQ5NjUyODQsIDMsIDAsIDYsIC0xLCAwLCAzMjIxMjgyODE2LCAyLCAxOTgsIDMsIDAsIDExLCAtMSwgMiwgMTk5LCAzLCAwLCA0MCwgLTYsIDAsIDQyODY1Nzg3ODQsIDIsIDAsIC0yLCAwLCAxMDA2Njk0NDAwLCAzLCAwLCAyNCwgMiwgMzUsIC0xLCAyLCA5NCwgMywgMCwgMiwgMCwgMSwgMiwgMTYzLCAzLCAwLCA2LCAyLCAxOTcsIDAsIDQxMTA5NDI1NjksIDAsIDE0MzI5NTAxMzksIDAsIDI3MDE2NTgyMTcsIDAsIDQwMjY1MzI4NjQsIDAsIDQwMjY1MzI4ODEsIDIsIDAsIDIsIDQ1LCAzLCAwLCA4LCAtMSwgMiwgMTU4LCAtMiwgMiwgMTY5LCAwLCA5ODMwNCwgMCwgNjU1MzcsIDIsIDE3MCwgLTUsIDAsIDQyOTQ5NTA5MTIsIDIsIDAsIDIsIDExOCwgMCwgNjU1MjgsIDIsIDE3NywgMCwgNDI5NDc3MDE3NiwgMiwgMjYsIDMsIDAsIDQsIC0zMCwgMiwgMTc0LCAwLCAzNzU4MTUzNzI4LCAtMywgMiwgMTY5LCAtMiwgMiwgMTU1LCAyLCAxODgsIDIsIDE1OCwgLTEsIDIsIDE5MSwgLTEsIDIsIDE2MSwgMCwgNDI5NDc1NDMwNCwgMywgMCwgMiwgLTMsIDAsIDMzNTU0NDMyLCAtMiwgMiwgMjAwLCAtMywgMiwgMTY5LCAwLCA0MTc1NDc4Nzg0LCAyLCAyMDEsIDAsIDQyODY2NDM3MTIsIDAsIDQyODY2NDQyMTYsIDIsIDAsIC00LCAyLCAyMDIsIC0xLCAyLCAxNjUsIDAsIDQyMjc5MjM5NjcsIDMsIDAsIDMyLCAtMTMzNCwgMiwgMTYzLCAyLCAwLCAtMTI5LCAyLCA5NCwgLTYsIDIsIDE2MywgLTE4MCwgMiwgMjAzLCAtMjMzLCAyLCA0LCAzLCAwLCA5NiwgLTE2LCAyLCAxNjMsIDMsIDAsIDQ3LCAtMTU0LCAyLCAxNjUsIDMsIDAsIDIyMzgxLCAtNywgMiwgMTcsIDMsIDAsIDYxMjhdLCBbNDI5NDk2NzI5NSwgNDI5NDk2NzI5MSwgNDA5MjQ2MDU0MywgNDI5NDgyODAzMSwgNDI5NDk2NzI5NCwgMTM0MjE3NzI2LCAyNjg0MzU0NTUsIDIxNDc0ODM2NDcsIDEwNDg1NzUsIDEwNzM3NDE4MjMsIDM4OTIzMTQxMTEsIDEzNDIxNzcyNywgMTA2MTE1ODkxMSwgNTM2ODA1Mzc2LCA0Mjk0OTEwMTQzLCA0MTYwNzQ5NTY3LCA0Mjk0OTAxNzU5LCA0Mjk0OTAxNzYwLCA1MzY4NzA5MTEsIDI2MjE0MywgODM4ODYwNywgNDI5NDkwMjc4MywgNDI5NDkxODE0MywgNjU1MzUsIDY3MDQzMzI4LCAyMjgxNzAxMzc0LCA0Mjk0OTY3MjMyLCAyMDk3MTUxLCA0Mjk0OTAzODA3LCA0MTk0MzAzLCAyNTUsIDY3MTA4ODYzLCA0Mjk0OTY3MDM5LCA1MTEsIDUyNDI4NywgMTMxMDcxLCAxMjcsIDQyOTI4NzAxNDMsIDQyOTQ5MDIyNzEsIDQyOTQ1NDk0ODcsIDMzNTU0NDMxLCAxMDIzLCA2NzA0NzQyMywgNDI5NDkwMTg4OCwgNDI4NjU3ODY4NywgNDI5NDc3MDY4NywgNjcwNDM1ODMsIDMyNzY3LCAxNSwgMjA0Nzk5OSwgNjcwNDMzNDMsIDE2Nzc3MjE1LCA0Mjk0OTAyMDAwLCA0Mjk0OTM0NTI3LCA0Mjk0OTY2NzgzLCA0Mjk0OTY3Mjc5LCAyMDQ3LCAyNjIwODMsIDIwNTExLCA0MjkwNzcyOTkxLCA0MTk0MzAzOSwgNDkzNTY3LCA0Mjk0OTU5MTA0LCA2MDM5Nzk3NzUsIDY1NTM2LCA2MDI3OTk2MTUsIDgwNTA0NDIyMywgNDI5NDk2NTIwNiwgODE5MSwgMTAzMTc0OTExOSwgNDI5NDkxNzYzMSwgMjEzNDc2OTY2MywgNDI4NjU3ODQ5MywgNDI4MjI1MzMxMSwgNDI5NDk0MjcxOSwgMzM1NDAwOTUsIDQyOTQ5MDU4NTUsIDQyOTQ5NjcyNjQsIDI4Njg4NTQ1OTEsIDE2MDg1MTU1ODMsIDI2NTIzMjM0OCwgNTM0NTE5ODA3LCAyMTQ3NjE0NzIwLCAxMDYwMTA5NDQ0LCA0MDkzNjQwMDE2LCAxNzM3NiwgMjEzOTA2MjE0MywgMjI0LCA0MTY5MTM4MTc1LCA0Mjk0OTA5OTUxLCA0Mjg2NTc4Njg4LCA0Mjk0OTY3MjkyLCA0Mjk0OTY1NzU5LCAyMDQ0LCA0MjkyODcwMTQ0LCA0Mjk0OTY2MjcyLCA0Mjk0OTY3MjgwLCA4Mjg5OTE4LCA0Mjk0OTM0Mzk5LCA0Mjk0OTAxNzc1LCA0Mjk0OTY1Mzc1LCAxNjAyMjIzNjE1LCA0Mjk0OTY3MjU5LCA0Mjk0NDQzMDA4LCAyNjgzNjk5MjAsIDQyOTI4MDQ2MDgsIDQ4NjM0MTg4NCwgNDI5NDk2MzE5OSwgMzA4NzAwNzYxNSwgMTA3MzY5MjY3MSwgNDEyODUyNywgNDI3OTIzODY1NSwgNDI5NDkwMjAxNSwgNDI5NDk2NjU5MSwgMjQ0NTI3OTIzMSwgMzY3MDAxNSwgMzIzODAwMjY4NywgMzEsIDYzLCA0Mjk0OTY3Mjg4LCA0Mjk0NzA1MTUxLCA0MDk1LCAzMjIxMjA4NDQ3LCA0Mjk0NTQ5NDcyLCAyMTQ3NDgzNjQ4LCA0Mjg1NTI2NjU1LCA0Mjk0OTY2NTI3LCA0Mjk0NzA1MTUyLCA0Mjk0OTY2MTQzLCA2NCwgNDI5NDk2NjcxOSwgMTYzODMsIDM3NzQ4NzM1OTIsIDQ1ODc1MiwgNTM2ODA3NDIzLCA2NzA0MzgzOSwgMzc1ODA5NjM4MywgMzk1OTQxNDM3MiwgMzc1NTk5MzAyMywgMjA4MDM3NDc4MywgNDI5NDgzNTI5NSwgNDI5NDk2NzEwMywgNDE2MDc0OTU2NSwgNDA4NywgMTg0MDI0NzI2LCAyODYyMDE3MTU2LCAxNTkzMzA5MDc4LCAyNjg0MzQ0MzEsIDI2ODQzNDQxNCwgNDI5NDkwMTc2MywgNTM2ODcwOTEyLCAyOTUyNzkwMDE2LCAyMDI1MDY3NTIsIDEzOTI2NCwgNDAyNjUzMTg0LCA0MjYxNDEyODY0LCA0MjI3OTIyOTQ0LCA0OTE1MiwgNjE0NDAsIDM3NTgwOTYzODQsIDExNzQ0MDUxMiwgNjUyODAsIDMyMzM4MDgzODQsIDMyMjEyMjU0NzIsIDIwOTcxNTIsIDQyOTQ5NjUyNDgsIDMyNzY4LCA1NzE1MiwgNjcxMDg4NjQsIDQyOTM5MTg3MjAsIDQyOTA3NzI5OTIsIDI1MTY1ODI0LCA1NzM0NCwgNDIyNzkxNTc3NiwgNDI3ODE5MDA4MCwgNDIyNzkwNzU4NCwgNjU1MjAsIDQwMjY1MzE4NDAsIDQyMjc4NTg0MzIsIDQxNjA3NDk1NjgsIDM3NTgxMjkxNTIsIDQyOTQ4MzYyMjQsIDYzNDg4LCAxMDczNzQxODI0LCA0Mjk0OTY3MDQwLCA0MTk0MzA0LCAyNTE2NTgyNDAsIDE5NjYwOCwgNDI5NDk2MzIwMCwgNjQ1MTIsIDQxNzgwOCwgNDIyNzkyMzcxMiwgMTI1ODI5MTIsIDUwMzMxNjQ4LCA2NTQ3MiwgNDI5NDk2NzE2OCwgNDI5NDk2Njc4NCwgMTYsIDQyOTQ5MTcxMjAsIDIwODAzNzQ3ODQsIDQwOTYsIDY1NDA4LCA1MjQyODgsIDY1NTMyXSk7CgpmdW5jdGlvbiBhZHZhbmNlQ2hhcihwYXJzZXIpIHsNCiAgICBwYXJzZXIuY29sdW1uKys7DQogICAgcmV0dXJuIChwYXJzZXIuY3VycmVudENoYXIgPSBwYXJzZXIuc291cmNlLmNoYXJDb2RlQXQoKytwYXJzZXIuaW5kZXgpKTsNCn0NCmZ1bmN0aW9uIGNvbnN1bWVNdWx0aVVuaXRDb2RlUG9pbnQocGFyc2VyLCBoaSkgew0KICAgIGlmICgoaGkgJiAweGZjMDApICE9PSA1NTI5NikNCiAgICAgICAgcmV0dXJuIDA7DQogICAgY29uc3QgbG8gPSBwYXJzZXIuc291cmNlLmNoYXJDb2RlQXQocGFyc2VyLmluZGV4ICsgMSk7DQogICAgaWYgKChsbyAmIDB4ZmMwMCkgIT09IDB4ZGMwMCkNCiAgICAgICAgcmV0dXJuIDA7DQogICAgaGkgPSBwYXJzZXIuY3VycmVudENoYXIgPSA2NTUzNiArICgoaGkgJiAweDNmZikgPDwgMTApICsgKGxvICYgMHgzZmYpOw0KICAgIGlmICgoKHVuaWNvZGVMb29rdXBbKGhpID4+PiA1KSArIDBdID4+PiBoaSkgJiAzMSAmIDEpID09PSAwKSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDE4LCBmcm9tQ29kZVBvaW50KGhpKSk7DQogICAgfQ0KICAgIHBhcnNlci5pbmRleCsrOw0KICAgIHBhcnNlci5jb2x1bW4rKzsNCiAgICByZXR1cm4gMTsNCn0NCmZ1bmN0aW9uIGNvbnN1bWVMaW5lRmVlZChwYXJzZXIsIHN0YXRlKSB7DQogICAgcGFyc2VyLmN1cnJlbnRDaGFyID0gcGFyc2VyLnNvdXJjZS5jaGFyQ29kZUF0KCsrcGFyc2VyLmluZGV4KTsNCiAgICBwYXJzZXIuZmxhZ3MgfD0gMTsNCiAgICBpZiAoKHN0YXRlICYgNCkgPT09IDApIHsNCiAgICAgICAgcGFyc2VyLmNvbHVtbiA9IDA7DQogICAgICAgIHBhcnNlci5saW5lKys7DQogICAgfQ0KfQ0KZnVuY3Rpb24gc2Nhbk5ld0xpbmUocGFyc2VyKSB7DQogICAgcGFyc2VyLmZsYWdzIHw9IDE7DQogICAgcGFyc2VyLmN1cnJlbnRDaGFyID0gcGFyc2VyLnNvdXJjZS5jaGFyQ29kZUF0KCsrcGFyc2VyLmluZGV4KTsNCiAgICBwYXJzZXIuY29sdW1uID0gMDsNCiAgICBwYXJzZXIubGluZSsrOw0KfQ0KZnVuY3Rpb24gaXNFeG90aWNFQ01BU2NyaXB0V2hpdGVzcGFjZShjaCkgew0KICAgIHJldHVybiAoY2ggPT09IDE2MCB8fA0KICAgICAgICBjaCA9PT0gNjUyNzkgfHwNCiAgICAgICAgY2ggPT09IDEzMyB8fA0KICAgICAgICBjaCA9PT0gNTc2MCB8fA0KICAgICAgICAoY2ggPj0gODE5MiAmJiBjaCA8PSA4MjAzKSB8fA0KICAgICAgICBjaCA9PT0gODIzOSB8fA0KICAgICAgICBjaCA9PT0gODI4NyB8fA0KICAgICAgICBjaCA9PT0gMTIyODggfHwNCiAgICAgICAgY2ggPT09IDgyMDEgfHwNCiAgICAgICAgY2ggPT09IDY1NTE5KTsNCn0NCmZ1bmN0aW9uIGZyb21Db2RlUG9pbnQoY29kZVBvaW50KSB7DQogICAgcmV0dXJuIGNvZGVQb2ludCA8PSA2NTUzNQ0KICAgICAgICA/IFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZVBvaW50KQ0KICAgICAgICA6IFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZVBvaW50ID4+PiAxMCkgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGVQb2ludCAmIDB4M2ZmKTsNCn0NCmZ1bmN0aW9uIHRvSGV4KGNvZGUpIHsNCiAgICByZXR1cm4gY29kZSA8IDY1ID8gY29kZSAtIDQ4IDogKGNvZGUgLSA2NSArIDEwKSAmIDB4ZjsNCn0NCmZ1bmN0aW9uIGNvbnZlcnRUb2tlblR5cGUodCkgew0KICAgIHN3aXRjaCAodCkgew0KICAgICAgICBjYXNlIDEzNDI4MzI2NjoNCiAgICAgICAgICAgIHJldHVybiAnTnVtZXJpY0xpdGVyYWwnOw0KICAgICAgICBjYXNlIDEzNDI4MzI2NzoNCiAgICAgICAgICAgIHJldHVybiAnU3RyaW5nTGl0ZXJhbCc7DQogICAgICAgIGNhc2UgODYwMjE6DQogICAgICAgIGNhc2UgODYwMjI6DQogICAgICAgICAgICByZXR1cm4gJ0Jvb2xlYW5MaXRlcmFsJzsNCiAgICAgICAgY2FzZSA4NjAyMzoNCiAgICAgICAgICAgIHJldHVybiAnTnVsbExpdGVyYWwnOw0KICAgICAgICBjYXNlIDY1NTQwOg0KICAgICAgICAgICAgcmV0dXJuICdSZWd1bGFyRXhwcmVzc2lvbic7DQogICAgICAgIGNhc2UgNjcxNzQ0MDg6DQogICAgICAgIGNhc2UgNjcxNzQ0MDk6DQogICAgICAgIGNhc2UgMTMyOg0KICAgICAgICAgICAgcmV0dXJuICdUZW1wbGF0ZUxpdGVyYWwnOw0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgaWYgKCh0ICYgMTQzMzYwKSA9PT0gMTQzMzYwKQ0KICAgICAgICAgICAgICAgIHJldHVybiAnSWRlbnRpZmllcic7DQogICAgICAgICAgICBpZiAoKHQgJiA0MDk2KSA9PT0gNDA5NikNCiAgICAgICAgICAgICAgICByZXR1cm4gJ0tleXdvcmQnOw0KICAgICAgICAgICAgcmV0dXJuICdQdW5jdHVhdG9yJzsNCiAgICB9DQp9Cgpjb25zdCBDaGFyVHlwZXMgPSBbDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICA4IHwgMTAyNCwNCiAgICAwLA0KICAgIDAsDQogICAgOCB8IDIwNDgsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDgxOTIsDQogICAgMCwNCiAgICAxIHwgMiwNCiAgICAwLA0KICAgIDAsDQogICAgODE5MiwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAyNTYsDQogICAgMCwNCiAgICAyNTYgfCAzMjc2OCwNCiAgICAwLA0KICAgIDAsDQogICAgMiB8IDE2IHwgMTI4IHwgMzIgfCA2NCwNCiAgICAyIHwgMTYgfCAxMjggfCAzMiB8IDY0LA0KICAgIDIgfCAxNiB8IDMyIHwgNjQsDQogICAgMiB8IDE2IHwgMzIgfCA2NCwNCiAgICAyIHwgMTYgfCAzMiB8IDY0LA0KICAgIDIgfCAxNiB8IDMyIHwgNjQsDQogICAgMiB8IDE2IHwgMzIgfCA2NCwNCiAgICAyIHwgMTYgfCAzMiB8IDY0LA0KICAgIDIgfCAxNiB8IDUxMiB8IDY0LA0KICAgIDIgfCAxNiB8IDUxMiB8IDY0LA0KICAgIDAsDQogICAgMCwNCiAgICAxNjM4NCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDEgfCAyIHwgNjQsDQogICAgMSB8IDIgfCA2NCwNCiAgICAxIHwgMiB8IDY0LA0KICAgIDEgfCAyIHwgNjQsDQogICAgMSB8IDIgfCA2NCwNCiAgICAxIHwgMiB8IDY0LA0KICAgIDEgfCAyLA0KICAgIDEgfCAyLA0KICAgIDEgfCAyLA0KICAgIDEgfCAyLA0KICAgIDEgfCAyLA0KICAgIDEgfCAyLA0KICAgIDEgfCAyLA0KICAgIDEgfCAyLA0KICAgIDEgfCAyLA0KICAgIDEgfCAyLA0KICAgIDEgfCAyLA0KICAgIDEgfCAyLA0KICAgIDEgfCAyLA0KICAgIDEgfCAyLA0KICAgIDEgfCAyLA0KICAgIDEgfCAyLA0KICAgIDEgfCAyLA0KICAgIDEgfCAyLA0KICAgIDEgfCAyLA0KICAgIDEgfCAyLA0KICAgIDAsDQogICAgMSwNCiAgICAwLA0KICAgIDAsDQogICAgMSB8IDIgfCA0MDk2LA0KICAgIDAsDQogICAgMSB8IDIgfCA0IHwgNjQsDQogICAgMSB8IDIgfCA0IHwgNjQsDQogICAgMSB8IDIgfCA0IHwgNjQsDQogICAgMSB8IDIgfCA0IHwgNjQsDQogICAgMSB8IDIgfCA0IHwgNjQsDQogICAgMSB8IDIgfCA0IHwgNjQsDQogICAgMSB8IDIgfCA0LA0KICAgIDEgfCAyIHwgNCwNCiAgICAxIHwgMiB8IDQsDQogICAgMSB8IDIgfCA0LA0KICAgIDEgfCAyIHwgNCwNCiAgICAxIHwgMiB8IDQsDQogICAgMSB8IDIgfCA0LA0KICAgIDEgfCAyIHwgNCwNCiAgICAxIHwgMiB8IDQsDQogICAgMSB8IDIgfCA0LA0KICAgIDEgfCAyIHwgNCwNCiAgICAxIHwgMiB8IDQsDQogICAgMSB8IDIgfCA0LA0KICAgIDEgfCAyIHwgNCwNCiAgICAxIHwgMiB8IDQsDQogICAgMSB8IDIgfCA0LA0KICAgIDEgfCAyIHwgNCwNCiAgICAxIHwgMiB8IDQsDQogICAgMSB8IDIgfCA0LA0KICAgIDEgfCAyIHwgNCwNCiAgICAxNjM4NCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwDQpdOw0KY29uc3QgaXNJZFN0YXJ0ID0gWw0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDEsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAxLA0KICAgIDAsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMA0KXTsNCmNvbnN0IGlzSWRQYXJ0ID0gWw0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDEsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMCwNCiAgICAxLA0KICAgIDAsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDEsDQogICAgMSwNCiAgICAxLA0KICAgIDAsDQogICAgMCwNCiAgICAwLA0KICAgIDAsDQogICAgMA0KXTsNCmZ1bmN0aW9uIGlzSWRlbnRpZmllclN0YXJ0JDEoY29kZSkgew0KICAgIHJldHVybiBjb2RlIDw9IDB4N0YNCiAgICAgICAgPyBpc0lkU3RhcnRbY29kZV0NCiAgICAgICAgOiAodW5pY29kZUxvb2t1cFsoY29kZSA+Pj4gNSkgKyAzNDgxNl0gPj4+IGNvZGUpICYgMzEgJiAxOw0KfQ0KZnVuY3Rpb24gaXNJZGVudGlmaWVyUGFydChjb2RlKSB7DQogICAgcmV0dXJuIGNvZGUgPD0gMHg3Rg0KICAgICAgICA/IGlzSWRQYXJ0W2NvZGVdDQogICAgICAgIDogKHVuaWNvZGVMb29rdXBbKGNvZGUgPj4+IDUpICsgMF0gPj4+IGNvZGUpICYgMzEgJiAxIHx8IChjb2RlID09PSA4MjA0IHx8IGNvZGUgPT09IDgyMDUpOw0KfQoKY29uc3QgQ29tbWVudFR5cGVzID0gWydTaW5nbGVMaW5lJywgJ011bHRpTGluZScsICdIVE1MT3BlbicsICdIVE1MQ2xvc2UnLCAnSGFzaGJhbmdDb21tZW50J107DQpmdW5jdGlvbiBza2lwSGFzaEJhbmcocGFyc2VyKSB7DQogICAgY29uc3Qgc291cmNlID0gcGFyc2VyLnNvdXJjZTsNCiAgICBpZiAocGFyc2VyLmN1cnJlbnRDaGFyID09PSAzNSAmJiBzb3VyY2UuY2hhckNvZGVBdChwYXJzZXIuaW5kZXggKyAxKSA9PT0gMzMpIHsNCiAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgc2tpcFNpbmdsZUxpbmVDb21tZW50KHBhcnNlciwgc291cmNlLCAwLCA0LCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICB9DQp9DQpmdW5jdGlvbiBza2lwU2luZ2xlSFRNTENvbW1lbnQocGFyc2VyLCBzb3VyY2UsIHN0YXRlLCBjb250ZXh0LCB0eXBlLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgaWYgKGNvbnRleHQgJiAyMDQ4KQ0KICAgICAgICByZXBvcnQocGFyc2VyLCAwKTsNCiAgICByZXR1cm4gc2tpcFNpbmdsZUxpbmVDb21tZW50KHBhcnNlciwgc291cmNlLCBzdGF0ZSwgdHlwZSwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQp9DQpmdW5jdGlvbiBza2lwU2luZ2xlTGluZUNvbW1lbnQocGFyc2VyLCBzb3VyY2UsIHN0YXRlLCB0eXBlLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgY29uc3QgeyBpbmRleCB9ID0gcGFyc2VyOw0KICAgIHBhcnNlci50b2tlblBvcyA9IHBhcnNlci5pbmRleDsNCiAgICBwYXJzZXIubGluZVBvcyA9IHBhcnNlci5saW5lOw0KICAgIHBhcnNlci5jb2xQb3MgPSBwYXJzZXIuY29sdW1uOw0KICAgIHdoaWxlIChwYXJzZXIuaW5kZXggPCBwYXJzZXIuZW5kKSB7DQogICAgICAgIGlmIChDaGFyVHlwZXNbcGFyc2VyLmN1cnJlbnRDaGFyXSAmIDgpIHsNCiAgICAgICAgICAgIGNvbnN0IGlzQ1IgPSBwYXJzZXIuY3VycmVudENoYXIgPT09IDEzOw0KICAgICAgICAgICAgc2Nhbk5ld0xpbmUocGFyc2VyKTsNCiAgICAgICAgICAgIGlmIChpc0NSICYmIHBhcnNlci5pbmRleCA8IHBhcnNlci5lbmQgJiYgcGFyc2VyLmN1cnJlbnRDaGFyID09PSAxMCkNCiAgICAgICAgICAgICAgICBwYXJzZXIuY3VycmVudENoYXIgPSBzb3VyY2UuY2hhckNvZGVBdCgrK3BhcnNlci5pbmRleCk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmICgocGFyc2VyLmN1cnJlbnRDaGFyIF4gODIzMikgPD0gMSkgew0KICAgICAgICAgICAgc2Nhbk5ld0xpbmUocGFyc2VyKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgIHBhcnNlci50b2tlblBvcyA9IHBhcnNlci5pbmRleDsNCiAgICAgICAgcGFyc2VyLmxpbmVQb3MgPSBwYXJzZXIubGluZTsNCiAgICAgICAgcGFyc2VyLmNvbFBvcyA9IHBhcnNlci5jb2x1bW47DQogICAgfQ0KICAgIGlmIChwYXJzZXIub25Db21tZW50KSB7DQogICAgICAgIGNvbnN0IGxvYyA9IHsNCiAgICAgICAgICAgIHN0YXJ0OiB7DQogICAgICAgICAgICAgICAgbGluZSwNCiAgICAgICAgICAgICAgICBjb2x1bW4NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBlbmQ6IHsNCiAgICAgICAgICAgICAgICBsaW5lOiBwYXJzZXIubGluZVBvcywNCiAgICAgICAgICAgICAgICBjb2x1bW46IHBhcnNlci5jb2xQb3MNCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgcGFyc2VyLm9uQ29tbWVudChDb21tZW50VHlwZXNbdHlwZSAmIDB4ZmZdLCBzb3VyY2Uuc2xpY2UoaW5kZXgsIHBhcnNlci50b2tlblBvcyksIHN0YXJ0LCBwYXJzZXIudG9rZW5Qb3MsIGxvYyk7DQogICAgfQ0KICAgIHJldHVybiBzdGF0ZSB8IDE7DQp9DQpmdW5jdGlvbiBza2lwTXVsdGlMaW5lQ29tbWVudChwYXJzZXIsIHNvdXJjZSwgc3RhdGUpIHsNCiAgICBjb25zdCB7IGluZGV4IH0gPSBwYXJzZXI7DQogICAgd2hpbGUgKHBhcnNlci5pbmRleCA8IHBhcnNlci5lbmQpIHsNCiAgICAgICAgaWYgKHBhcnNlci5jdXJyZW50Q2hhciA8IDB4MmIpIHsNCiAgICAgICAgICAgIGxldCBza2lwcGVkT25lQXN0ZXJpc2sgPSBmYWxzZTsNCiAgICAgICAgICAgIHdoaWxlIChwYXJzZXIuY3VycmVudENoYXIgPT09IDQyKSB7DQogICAgICAgICAgICAgICAgaWYgKCFza2lwcGVkT25lQXN0ZXJpc2spIHsNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUgJj0gfjQ7DQogICAgICAgICAgICAgICAgICAgIHNraXBwZWRPbmVBc3RlcmlzayA9IHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChhZHZhbmNlQ2hhcihwYXJzZXIpID09PSA0Nykgew0KICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLm9uQ29tbWVudCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9jID0gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IHBhcnNlci5saW5lUG9zLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW46IHBhcnNlci5jb2xQb3MNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZDogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBwYXJzZXIubGluZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uOiBwYXJzZXIuY29sdW1uDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci5vbkNvbW1lbnQoQ29tbWVudFR5cGVzWzEgJiAweGZmXSwgc291cmNlLnNsaWNlKGluZGV4LCBwYXJzZXIuaW5kZXggLSAyKSwgaW5kZXggLSAyLCBwYXJzZXIuaW5kZXgsIGxvYyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLnRva2VuUG9zID0gcGFyc2VyLmluZGV4Ow0KICAgICAgICAgICAgICAgICAgICBwYXJzZXIubGluZVBvcyA9IHBhcnNlci5saW5lOw0KICAgICAgICAgICAgICAgICAgICBwYXJzZXIuY29sUG9zID0gcGFyc2VyLmNvbHVtbjsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChza2lwcGVkT25lQXN0ZXJpc2spIHsNCiAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChDaGFyVHlwZXNbcGFyc2VyLmN1cnJlbnRDaGFyXSAmIDgpIHsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VyLmN1cnJlbnRDaGFyID09PSAxMykgew0KICAgICAgICAgICAgICAgICAgICBzdGF0ZSB8PSAxIHwgNDsNCiAgICAgICAgICAgICAgICAgICAgc2Nhbk5ld0xpbmUocGFyc2VyKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN1bWVMaW5lRmVlZChwYXJzZXIsIHN0YXRlKTsNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSAoc3RhdGUgJiB+NCkgfCAxOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoKHBhcnNlci5jdXJyZW50Q2hhciBeIDgyMzIpIDw9IDEpIHsNCiAgICAgICAgICAgIHN0YXRlID0gKHN0YXRlICYgfjQpIHwgMTsNCiAgICAgICAgICAgIHNjYW5OZXdMaW5lKHBhcnNlcik7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBzdGF0ZSAmPSB+NDsNCiAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgIH0NCiAgICB9DQogICAgcmVwb3J0KHBhcnNlciwgMTYpOw0KfQoKZnVuY3Rpb24gc2NhblJlZ3VsYXJFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCkgew0KICAgIGNvbnN0IGJvZHlTdGFydCA9IHBhcnNlci5pbmRleDsNCiAgICBsZXQgcHJlcGFyc2VTdGF0ZSA9IDA7DQogICAgbG9vcDogd2hpbGUgKHRydWUpIHsNCiAgICAgICAgY29uc3QgY2ggPSBwYXJzZXIuY3VycmVudENoYXI7DQogICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgIGlmIChwcmVwYXJzZVN0YXRlICYgMSkgew0KICAgICAgICAgICAgcHJlcGFyc2VTdGF0ZSAmPSB+MTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHN3aXRjaCAoY2gpIHsNCiAgICAgICAgICAgICAgICBjYXNlIDQ3Og0KICAgICAgICAgICAgICAgICAgICBpZiAoIXByZXBhcnNlU3RhdGUpDQogICAgICAgICAgICAgICAgICAgICAgICBicmVhayBsb29wOw0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIDkyOg0KICAgICAgICAgICAgICAgICAgICBwcmVwYXJzZVN0YXRlIHw9IDE7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgOTE6DQogICAgICAgICAgICAgICAgICAgIHByZXBhcnNlU3RhdGUgfD0gMjsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSA5MzoNCiAgICAgICAgICAgICAgICAgICAgcHJlcGFyc2VTdGF0ZSAmPSAxOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIDEzOg0KICAgICAgICAgICAgICAgIGNhc2UgMTA6DQogICAgICAgICAgICAgICAgY2FzZSA4MjMyOg0KICAgICAgICAgICAgICAgIGNhc2UgODIzMzoNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMzIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmIChwYXJzZXIuaW5kZXggPj0gcGFyc2VyLnNvdXJjZS5sZW5ndGgpIHsNCiAgICAgICAgICAgIHJldHVybiByZXBvcnQocGFyc2VyLCAzMik7DQogICAgICAgIH0NCiAgICB9DQogICAgY29uc3QgYm9keUVuZCA9IHBhcnNlci5pbmRleCAtIDE7DQogICAgbGV0IG1hc2sgPSAwOw0KICAgIGxldCBjaGFyID0gcGFyc2VyLmN1cnJlbnRDaGFyOw0KICAgIGNvbnN0IHsgaW5kZXg6IGZsYWdTdGFydCB9ID0gcGFyc2VyOw0KICAgIHdoaWxlIChpc0lkZW50aWZpZXJQYXJ0KGNoYXIpKSB7DQogICAgICAgIHN3aXRjaCAoY2hhcikgew0KICAgICAgICAgICAgY2FzZSAxMDM6DQogICAgICAgICAgICAgICAgaWYgKG1hc2sgJiAyKQ0KICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAzNCwgJ2cnKTsNCiAgICAgICAgICAgICAgICBtYXNrIHw9IDI7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlIDEwNToNCiAgICAgICAgICAgICAgICBpZiAobWFzayAmIDEpDQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDM0LCAnaScpOw0KICAgICAgICAgICAgICAgIG1hc2sgfD0gMTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgMTA5Og0KICAgICAgICAgICAgICAgIGlmIChtYXNrICYgNCkNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMzQsICdtJyk7DQogICAgICAgICAgICAgICAgbWFzayB8PSA0Ow0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAxMTc6DQogICAgICAgICAgICAgICAgaWYgKG1hc2sgJiAxNikNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMzQsICd1Jyk7DQogICAgICAgICAgICAgICAgbWFzayB8PSAxNjsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgMTIxOg0KICAgICAgICAgICAgICAgIGlmIChtYXNrICYgOCkNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMzQsICd5Jyk7DQogICAgICAgICAgICAgICAgbWFzayB8PSA4Ow0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAxMTU6DQogICAgICAgICAgICAgICAgaWYgKG1hc2sgJiAzMikNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMzQsICdzJyk7DQogICAgICAgICAgICAgICAgbWFzayB8PSAzMjsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgMTAwOg0KICAgICAgICAgICAgICAgIGlmIChtYXNrICYgNjQpDQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDM0LCAnZCcpOw0KICAgICAgICAgICAgICAgIG1hc2sgfD0gNjQ7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDMzKTsNCiAgICAgICAgfQ0KICAgICAgICBjaGFyID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICB9DQogICAgY29uc3QgZmxhZ3MgPSBwYXJzZXIuc291cmNlLnNsaWNlKGZsYWdTdGFydCwgcGFyc2VyLmluZGV4KTsNCiAgICBjb25zdCBwYXR0ZXJuID0gcGFyc2VyLnNvdXJjZS5zbGljZShib2R5U3RhcnQsIGJvZHlFbmQpOw0KICAgIHBhcnNlci50b2tlblJlZ0V4cCA9IHsgcGF0dGVybiwgZmxhZ3MgfTsNCiAgICBpZiAoY29udGV4dCAmIDUxMikNCiAgICAgICAgcGFyc2VyLnRva2VuUmF3ID0gcGFyc2VyLnNvdXJjZS5zbGljZShwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5pbmRleCk7DQogICAgcGFyc2VyLnRva2VuVmFsdWUgPSB2YWxpZGF0ZShwYXJzZXIsIHBhdHRlcm4sIGZsYWdzKTsNCiAgICByZXR1cm4gNjU1NDA7DQp9DQpmdW5jdGlvbiB2YWxpZGF0ZShwYXJzZXIsIHBhdHRlcm4sIGZsYWdzKSB7DQogICAgdHJ5IHsNCiAgICAgICAgcmV0dXJuIG5ldyBSZWdFeHAocGF0dGVybiwgZmxhZ3MpOw0KICAgIH0NCiAgICBjYXRjaCAoZSkgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgbmV3IFJlZ0V4cChwYXR0ZXJuLCBmbGFncy5yZXBsYWNlKCdkJywgJycpKTsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIGNhdGNoIChlKSB7DQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAzMik7DQogICAgICAgIH0NCiAgICB9DQp9CgpmdW5jdGlvbiBzY2FuU3RyaW5nJDEocGFyc2VyLCBjb250ZXh0LCBxdW90ZSkgew0KICAgIGNvbnN0IHsgaW5kZXg6IHN0YXJ0IH0gPSBwYXJzZXI7DQogICAgbGV0IHJldCA9ICcnOw0KICAgIGxldCBjaGFyID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICBsZXQgbWFya2VyID0gcGFyc2VyLmluZGV4Ow0KICAgIHdoaWxlICgoQ2hhclR5cGVzW2NoYXJdICYgOCkgPT09IDApIHsNCiAgICAgICAgaWYgKGNoYXIgPT09IHF1b3RlKSB7DQogICAgICAgICAgICByZXQgKz0gcGFyc2VyLnNvdXJjZS5zbGljZShtYXJrZXIsIHBhcnNlci5pbmRleCk7DQogICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgaWYgKGNvbnRleHQgJiA1MTIpDQogICAgICAgICAgICAgICAgcGFyc2VyLnRva2VuUmF3ID0gcGFyc2VyLnNvdXJjZS5zbGljZShzdGFydCwgcGFyc2VyLmluZGV4KTsNCiAgICAgICAgICAgIHBhcnNlci50b2tlblZhbHVlID0gcmV0Ow0KICAgICAgICAgICAgcmV0dXJuIDEzNDI4MzI2NzsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoKGNoYXIgJiA4KSA9PT0gOCAmJiBjaGFyID09PSA5Mikgew0KICAgICAgICAgICAgcmV0ICs9IHBhcnNlci5zb3VyY2Uuc2xpY2UobWFya2VyLCBwYXJzZXIuaW5kZXgpOw0KICAgICAgICAgICAgY2hhciA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICBpZiAoY2hhciA8IDB4N2YgfHwgY2hhciA9PT0gODIzMiB8fCBjaGFyID09PSA4MjMzKSB7DQogICAgICAgICAgICAgICAgY29uc3QgY29kZSA9IHBhcnNlRXNjYXBlKHBhcnNlciwgY29udGV4dCwgY2hhcik7DQogICAgICAgICAgICAgICAgaWYgKGNvZGUgPj0gMCkNCiAgICAgICAgICAgICAgICAgICAgcmV0ICs9IGZyb21Db2RlUG9pbnQoY29kZSk7DQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICBoYW5kbGVTdHJpbmdFcnJvcihwYXJzZXIsIGNvZGUsIDApOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0ICs9IGZyb21Db2RlUG9pbnQoY2hhcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBtYXJrZXIgPSBwYXJzZXIuaW5kZXggKyAxOw0KICAgICAgICB9DQogICAgICAgIGlmIChwYXJzZXIuaW5kZXggPj0gcGFyc2VyLmVuZCkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDE0KTsNCiAgICAgICAgY2hhciA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgfQ0KICAgIHJlcG9ydChwYXJzZXIsIDE0KTsNCn0NCmZ1bmN0aW9uIHBhcnNlRXNjYXBlKHBhcnNlciwgY29udGV4dCwgZmlyc3QpIHsNCiAgICBzd2l0Y2ggKGZpcnN0KSB7DQogICAgICAgIGNhc2UgOTg6DQogICAgICAgICAgICByZXR1cm4gODsNCiAgICAgICAgY2FzZSAxMDI6DQogICAgICAgICAgICByZXR1cm4gMTI7DQogICAgICAgIGNhc2UgMTE0Og0KICAgICAgICAgICAgcmV0dXJuIDEzOw0KICAgICAgICBjYXNlIDExMDoNCiAgICAgICAgICAgIHJldHVybiAxMDsNCiAgICAgICAgY2FzZSAxMTY6DQogICAgICAgICAgICByZXR1cm4gOTsNCiAgICAgICAgY2FzZSAxMTg6DQogICAgICAgICAgICByZXR1cm4gMTE7DQogICAgICAgIGNhc2UgMTM6IHsNCiAgICAgICAgICAgIGlmIChwYXJzZXIuaW5kZXggPCBwYXJzZXIuZW5kKSB7DQogICAgICAgICAgICAgICAgY29uc3QgbmV4dENoYXIgPSBwYXJzZXIuc291cmNlLmNoYXJDb2RlQXQocGFyc2VyLmluZGV4ICsgMSk7DQogICAgICAgICAgICAgICAgaWYgKG5leHRDaGFyID09PSAxMCkgew0KICAgICAgICAgICAgICAgICAgICBwYXJzZXIuaW5kZXggPSBwYXJzZXIuaW5kZXggKyAxOw0KICAgICAgICAgICAgICAgICAgICBwYXJzZXIuY3VycmVudENoYXIgPSBuZXh0Q2hhcjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY2FzZSAxMDoNCiAgICAgICAgY2FzZSA4MjMyOg0KICAgICAgICBjYXNlIDgyMzM6DQogICAgICAgICAgICBwYXJzZXIuY29sdW1uID0gLTE7DQogICAgICAgICAgICBwYXJzZXIubGluZSsrOw0KICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICBjYXNlIDQ4Og0KICAgICAgICBjYXNlIDQ5Og0KICAgICAgICBjYXNlIDUwOg0KICAgICAgICBjYXNlIDUxOiB7DQogICAgICAgICAgICBsZXQgY29kZSA9IGZpcnN0IC0gNDg7DQogICAgICAgICAgICBsZXQgaW5kZXggPSBwYXJzZXIuaW5kZXggKyAxOw0KICAgICAgICAgICAgbGV0IGNvbHVtbiA9IHBhcnNlci5jb2x1bW4gKyAxOw0KICAgICAgICAgICAgaWYgKGluZGV4IDwgcGFyc2VyLmVuZCkgew0KICAgICAgICAgICAgICAgIGNvbnN0IG5leHQgPSBwYXJzZXIuc291cmNlLmNoYXJDb2RlQXQoaW5kZXgpOw0KICAgICAgICAgICAgICAgIGlmICgoQ2hhclR5cGVzW25leHRdICYgMzIpID09PSAwKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICgoY29kZSAhPT0gMCB8fCBDaGFyVHlwZXNbbmV4dF0gJiA1MTIpICYmIGNvbnRleHQgJiAxMDI0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0yOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChjb250ZXh0ICYgMTAyNCkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBwYXJzZXIuY3VycmVudENoYXIgPSBuZXh0Ow0KICAgICAgICAgICAgICAgICAgICBjb2RlID0gKGNvZGUgPDwgMykgfCAobmV4dCAtIDQ4KTsNCiAgICAgICAgICAgICAgICAgICAgaW5kZXgrKzsNCiAgICAgICAgICAgICAgICAgICAgY29sdW1uKys7DQogICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA8IHBhcnNlci5lbmQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5leHQgPSBwYXJzZXIuc291cmNlLmNoYXJDb2RlQXQoaW5kZXgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKENoYXJUeXBlc1tuZXh0XSAmIDMyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmN1cnJlbnRDaGFyID0gbmV4dDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlID0gKGNvZGUgPDwgMykgfCAobmV4dCAtIDQ4KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleCsrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbisrOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHBhcnNlci5mbGFncyB8PSA2NDsNCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmluZGV4ID0gaW5kZXggLSAxOw0KICAgICAgICAgICAgICAgICAgICBwYXJzZXIuY29sdW1uID0gY29sdW1uIC0gMTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gY29kZTsNCiAgICAgICAgfQ0KICAgICAgICBjYXNlIDUyOg0KICAgICAgICBjYXNlIDUzOg0KICAgICAgICBjYXNlIDU0Og0KICAgICAgICBjYXNlIDU1OiB7DQogICAgICAgICAgICBpZiAoY29udGV4dCAmIDEwMjQpDQogICAgICAgICAgICAgICAgcmV0dXJuIC0yOw0KICAgICAgICAgICAgbGV0IGNvZGUgPSBmaXJzdCAtIDQ4Ow0KICAgICAgICAgICAgY29uc3QgaW5kZXggPSBwYXJzZXIuaW5kZXggKyAxOw0KICAgICAgICAgICAgY29uc3QgY29sdW1uID0gcGFyc2VyLmNvbHVtbiArIDE7DQogICAgICAgICAgICBpZiAoaW5kZXggPCBwYXJzZXIuZW5kKSB7DQogICAgICAgICAgICAgICAgY29uc3QgbmV4dCA9IHBhcnNlci5zb3VyY2UuY2hhckNvZGVBdChpbmRleCk7DQogICAgICAgICAgICAgICAgaWYgKENoYXJUeXBlc1tuZXh0XSAmIDMyKSB7DQogICAgICAgICAgICAgICAgICAgIGNvZGUgPSAoY29kZSA8PCAzKSB8IChuZXh0IC0gNDgpOw0KICAgICAgICAgICAgICAgICAgICBwYXJzZXIuY3VycmVudENoYXIgPSBuZXh0Ow0KICAgICAgICAgICAgICAgICAgICBwYXJzZXIuaW5kZXggPSBpbmRleDsNCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmNvbHVtbiA9IGNvbHVtbjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBwYXJzZXIuZmxhZ3MgfD0gNjQ7DQogICAgICAgICAgICByZXR1cm4gY29kZTsNCiAgICAgICAgfQ0KICAgICAgICBjYXNlIDEyMDogew0KICAgICAgICAgICAgY29uc3QgY2gxID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgIGlmICgoQ2hhclR5cGVzW2NoMV0gJiA2NCkgPT09IDApDQogICAgICAgICAgICAgICAgcmV0dXJuIC00Ow0KICAgICAgICAgICAgY29uc3QgaGkgPSB0b0hleChjaDEpOw0KICAgICAgICAgICAgY29uc3QgY2gyID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgIGlmICgoQ2hhclR5cGVzW2NoMl0gJiA2NCkgPT09IDApDQogICAgICAgICAgICAgICAgcmV0dXJuIC00Ow0KICAgICAgICAgICAgY29uc3QgbG8gPSB0b0hleChjaDIpOw0KICAgICAgICAgICAgcmV0dXJuIChoaSA8PCA0KSB8IGxvOw0KICAgICAgICB9DQogICAgICAgIGNhc2UgMTE3OiB7DQogICAgICAgICAgICBjb25zdCBjaCA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICBpZiAocGFyc2VyLmN1cnJlbnRDaGFyID09PSAxMjMpIHsNCiAgICAgICAgICAgICAgICBsZXQgY29kZSA9IDA7DQogICAgICAgICAgICAgICAgd2hpbGUgKChDaGFyVHlwZXNbYWR2YW5jZUNoYXIocGFyc2VyKV0gJiA2NCkgIT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgY29kZSA9IChjb2RlIDw8IDQpIHwgdG9IZXgocGFyc2VyLmN1cnJlbnRDaGFyKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNvZGUgPiAxMTE0MTExKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC01Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAocGFyc2VyLmN1cnJlbnRDaGFyIDwgMSB8fCBwYXJzZXIuY3VycmVudENoYXIgIT09IDEyNSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBjb2RlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgaWYgKChDaGFyVHlwZXNbY2hdICYgNjQpID09PSAwKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTQ7DQogICAgICAgICAgICAgICAgY29uc3QgY2gyID0gcGFyc2VyLnNvdXJjZS5jaGFyQ29kZUF0KHBhcnNlci5pbmRleCArIDEpOw0KICAgICAgICAgICAgICAgIGlmICgoQ2hhclR5cGVzW2NoMl0gJiA2NCkgPT09IDApDQogICAgICAgICAgICAgICAgICAgIHJldHVybiAtNDsNCiAgICAgICAgICAgICAgICBjb25zdCBjaDMgPSBwYXJzZXIuc291cmNlLmNoYXJDb2RlQXQocGFyc2VyLmluZGV4ICsgMik7DQogICAgICAgICAgICAgICAgaWYgKChDaGFyVHlwZXNbY2gzXSAmIDY0KSA9PT0gMCkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC00Ow0KICAgICAgICAgICAgICAgIGNvbnN0IGNoNCA9IHBhcnNlci5zb3VyY2UuY2hhckNvZGVBdChwYXJzZXIuaW5kZXggKyAzKTsNCiAgICAgICAgICAgICAgICBpZiAoKENoYXJUeXBlc1tjaDRdICYgNjQpID09PSAwKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTQ7DQogICAgICAgICAgICAgICAgcGFyc2VyLmluZGV4ICs9IDM7DQogICAgICAgICAgICAgICAgcGFyc2VyLmNvbHVtbiArPSAzOw0KICAgICAgICAgICAgICAgIHBhcnNlci5jdXJyZW50Q2hhciA9IHBhcnNlci5zb3VyY2UuY2hhckNvZGVBdChwYXJzZXIuaW5kZXgpOw0KICAgICAgICAgICAgICAgIHJldHVybiAodG9IZXgoY2gpIDw8IDEyKSB8ICh0b0hleChjaDIpIDw8IDgpIHwgKHRvSGV4KGNoMykgPDwgNCkgfCB0b0hleChjaDQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGNhc2UgNTY6DQogICAgICAgIGNhc2UgNTc6DQogICAgICAgICAgICBpZiAoKGNvbnRleHQgJiAyNTYpID09PSAwKQ0KICAgICAgICAgICAgICAgIHJldHVybiAtMzsNCiAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgIHJldHVybiBmaXJzdDsNCiAgICB9DQp9DQpmdW5jdGlvbiBoYW5kbGVTdHJpbmdFcnJvcihzdGF0ZSwgY29kZSwgaXNUZW1wbGF0ZSkgew0KICAgIHN3aXRjaCAoY29kZSkgew0KICAgICAgICBjYXNlIC0xOg0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICBjYXNlIC0yOg0KICAgICAgICAgICAgcmVwb3J0KHN0YXRlLCBpc1RlbXBsYXRlID8gMiA6IDEpOw0KICAgICAgICBjYXNlIC0zOg0KICAgICAgICAgICAgcmVwb3J0KHN0YXRlLCAxMyk7DQogICAgICAgIGNhc2UgLTQ6DQogICAgICAgICAgICByZXBvcnQoc3RhdGUsIDYpOw0KICAgICAgICBjYXNlIC01Og0KICAgICAgICAgICAgcmVwb3J0KHN0YXRlLCAxMDIpOw0KICAgIH0NCn0KCmZ1bmN0aW9uIHNjYW5UZW1wbGF0ZShwYXJzZXIsIGNvbnRleHQpIHsNCiAgICBjb25zdCB7IGluZGV4OiBzdGFydCB9ID0gcGFyc2VyOw0KICAgIGxldCB0b2tlbiA9IDY3MTc0NDA5Ow0KICAgIGxldCByZXQgPSAnJzsNCiAgICBsZXQgY2hhciA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgd2hpbGUgKGNoYXIgIT09IDk2KSB7DQogICAgICAgIGlmIChjaGFyID09PSAzNiAmJiBwYXJzZXIuc291cmNlLmNoYXJDb2RlQXQocGFyc2VyLmluZGV4ICsgMSkgPT09IDEyMykgew0KICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgIHRva2VuID0gNjcxNzQ0MDg7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmICgoY2hhciAmIDgpID09PSA4ICYmIGNoYXIgPT09IDkyKSB7DQogICAgICAgICAgICBjaGFyID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgIGlmIChjaGFyID4gMHg3ZSkgew0KICAgICAgICAgICAgICAgIHJldCArPSBmcm9tQ29kZVBvaW50KGNoYXIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgY29uc3QgY29kZSA9IHBhcnNlRXNjYXBlKHBhcnNlciwgY29udGV4dCB8IDEwMjQsIGNoYXIpOw0KICAgICAgICAgICAgICAgIGlmIChjb2RlID49IDApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0ICs9IGZyb21Db2RlUG9pbnQoY29kZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNvZGUgIT09IC0xICYmIGNvbnRleHQgJiA2NTUzNikgew0KICAgICAgICAgICAgICAgICAgICByZXQgPSB1bmRlZmluZWQ7DQogICAgICAgICAgICAgICAgICAgIGNoYXIgPSBzY2FuQmFkVGVtcGxhdGUocGFyc2VyLCBjaGFyKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNoYXIgPCAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSA2NzE3NDQwODsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBoYW5kbGVTdHJpbmdFcnJvcihwYXJzZXIsIGNvZGUsIDEpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGlmIChwYXJzZXIuaW5kZXggPCBwYXJzZXIuZW5kICYmDQogICAgICAgICAgICAgICAgY2hhciA9PT0gMTMgJiYNCiAgICAgICAgICAgICAgICBwYXJzZXIuc291cmNlLmNoYXJDb2RlQXQocGFyc2VyLmluZGV4KSA9PT0gMTApIHsNCiAgICAgICAgICAgICAgICByZXQgKz0gZnJvbUNvZGVQb2ludChjaGFyKTsNCiAgICAgICAgICAgICAgICBwYXJzZXIuY3VycmVudENoYXIgPSBwYXJzZXIuc291cmNlLmNoYXJDb2RlQXQoKytwYXJzZXIuaW5kZXgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCgoY2hhciAmIDgzKSA8IDMgJiYgY2hhciA9PT0gMTApIHx8IChjaGFyIF4gODIzMikgPD0gMSkgew0KICAgICAgICAgICAgICAgIHBhcnNlci5jb2x1bW4gPSAtMTsNCiAgICAgICAgICAgICAgICBwYXJzZXIubGluZSsrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0ICs9IGZyb21Db2RlUG9pbnQoY2hhcik7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHBhcnNlci5pbmRleCA+PSBwYXJzZXIuZW5kKQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTUpOw0KICAgICAgICBjaGFyID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICB9DQogICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICBwYXJzZXIudG9rZW5WYWx1ZSA9IHJldDsNCiAgICBwYXJzZXIudG9rZW5SYXcgPSBwYXJzZXIuc291cmNlLnNsaWNlKHN0YXJ0ICsgMSwgcGFyc2VyLmluZGV4IC0gKHRva2VuID09PSA2NzE3NDQwOSA/IDEgOiAyKSk7DQogICAgcmV0dXJuIHRva2VuOw0KfQ0KZnVuY3Rpb24gc2NhbkJhZFRlbXBsYXRlKHBhcnNlciwgY2gpIHsNCiAgICB3aGlsZSAoY2ggIT09IDk2KSB7DQogICAgICAgIHN3aXRjaCAoY2gpIHsNCiAgICAgICAgICAgIGNhc2UgMzY6IHsNCiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHBhcnNlci5pbmRleCArIDE7DQogICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgcGFyc2VyLmVuZCAmJiBwYXJzZXIuc291cmNlLmNoYXJDb2RlQXQoaW5kZXgpID09PSAxMjMpIHsNCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmluZGV4ID0gaW5kZXg7DQogICAgICAgICAgICAgICAgICAgIHBhcnNlci5jb2x1bW4rKzsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC1jaDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDEwOg0KICAgICAgICAgICAgY2FzZSA4MjMyOg0KICAgICAgICAgICAgY2FzZSA4MjMzOg0KICAgICAgICAgICAgICAgIHBhcnNlci5jb2x1bW4gPSAtMTsNCiAgICAgICAgICAgICAgICBwYXJzZXIubGluZSsrOw0KICAgICAgICB9DQogICAgICAgIGlmIChwYXJzZXIuaW5kZXggPj0gcGFyc2VyLmVuZCkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDE1KTsNCiAgICAgICAgY2ggPSBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgIH0NCiAgICByZXR1cm4gY2g7DQp9DQpmdW5jdGlvbiBzY2FuVGVtcGxhdGVUYWlsKHBhcnNlciwgY29udGV4dCkgew0KICAgIGlmIChwYXJzZXIuaW5kZXggPj0gcGFyc2VyLmVuZCkNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMCk7DQogICAgcGFyc2VyLmluZGV4LS07DQogICAgcGFyc2VyLmNvbHVtbi0tOw0KICAgIHJldHVybiBzY2FuVGVtcGxhdGUocGFyc2VyLCBjb250ZXh0KTsNCn0KCmZ1bmN0aW9uIHNjYW5OdW1iZXIkMShwYXJzZXIsIGNvbnRleHQsIGtpbmQpIHsNCiAgICBsZXQgY2hhciA9IHBhcnNlci5jdXJyZW50Q2hhcjsNCiAgICBsZXQgdmFsdWUgPSAwOw0KICAgIGxldCBkaWdpdCA9IDk7DQogICAgbGV0IGF0U3RhcnQgPSBraW5kICYgNjQgPyAwIDogMTsNCiAgICBsZXQgZGlnaXRzID0gMDsNCiAgICBsZXQgYWxsb3dTZXBhcmF0b3IgPSAwOw0KICAgIGlmIChraW5kICYgNjQpIHsNCiAgICAgICAgdmFsdWUgPSAnLicgKyBzY2FuRGVjaW1hbERpZ2l0c09yU2VwYXJhdG9yKHBhcnNlciwgY2hhcik7DQogICAgICAgIGNoYXIgPSBwYXJzZXIuY3VycmVudENoYXI7DQogICAgICAgIGlmIChjaGFyID09PSAxMTApDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMSk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBpZiAoY2hhciA9PT0gNDgpIHsNCiAgICAgICAgICAgIGNoYXIgPSBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgaWYgKChjaGFyIHwgMzIpID09PSAxMjApIHsNCiAgICAgICAgICAgICAgICBraW5kID0gOCB8IDEyODsNCiAgICAgICAgICAgICAgICBjaGFyID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICB3aGlsZSAoQ2hhclR5cGVzW2NoYXJdICYgKDY0IHwgNDA5NikpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNoYXIgPT09IDk1KSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWFsbG93U2VwYXJhdG9yKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDE0Nyk7DQogICAgICAgICAgICAgICAgICAgICAgICBhbGxvd1NlcGFyYXRvciA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICBjaGFyID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGFsbG93U2VwYXJhdG9yID0gMTsNCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZSAqIDB4MTAgKyB0b0hleChjaGFyKTsNCiAgICAgICAgICAgICAgICAgICAgZGlnaXRzKys7DQogICAgICAgICAgICAgICAgICAgIGNoYXIgPSBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoZGlnaXRzID09PSAwIHx8ICFhbGxvd1NlcGFyYXRvcikgew0KICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCBkaWdpdHMgPT09IDAgPyAxOSA6IDE0OCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoKGNoYXIgfCAzMikgPT09IDExMSkgew0KICAgICAgICAgICAgICAgIGtpbmQgPSA0IHwgMTI4Ow0KICAgICAgICAgICAgICAgIGNoYXIgPSBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgIHdoaWxlIChDaGFyVHlwZXNbY2hhcl0gJiAoMzIgfCA0MDk2KSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoY2hhciA9PT0gOTUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYWxsb3dTZXBhcmF0b3IpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxNDcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dTZXBhcmF0b3IgPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgY2hhciA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBhbGxvd1NlcGFyYXRvciA9IDE7DQogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUgKiA4ICsgKGNoYXIgLSA0OCk7DQogICAgICAgICAgICAgICAgICAgIGRpZ2l0cysrOw0KICAgICAgICAgICAgICAgICAgICBjaGFyID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGRpZ2l0cyA9PT0gMCB8fCAhYWxsb3dTZXBhcmF0b3IpIHsNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgZGlnaXRzID09PSAwID8gMCA6IDE0OCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoKGNoYXIgfCAzMikgPT09IDk4KSB7DQogICAgICAgICAgICAgICAga2luZCA9IDIgfCAxMjg7DQogICAgICAgICAgICAgICAgY2hhciA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgd2hpbGUgKENoYXJUeXBlc1tjaGFyXSAmICgxMjggfCA0MDk2KSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoY2hhciA9PT0gOTUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYWxsb3dTZXBhcmF0b3IpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxNDcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dTZXBhcmF0b3IgPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgY2hhciA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBhbGxvd1NlcGFyYXRvciA9IDE7DQogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUgKiAyICsgKGNoYXIgLSA0OCk7DQogICAgICAgICAgICAgICAgICAgIGRpZ2l0cysrOw0KICAgICAgICAgICAgICAgICAgICBjaGFyID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGRpZ2l0cyA9PT0gMCB8fCAhYWxsb3dTZXBhcmF0b3IpIHsNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgZGlnaXRzID09PSAwID8gMCA6IDE0OCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoQ2hhclR5cGVzW2NoYXJdICYgMzIpIHsNCiAgICAgICAgICAgICAgICBpZiAoY29udGV4dCAmIDEwMjQpDQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDEpOw0KICAgICAgICAgICAgICAgIGtpbmQgPSAxOw0KICAgICAgICAgICAgICAgIHdoaWxlIChDaGFyVHlwZXNbY2hhcl0gJiAxNikgew0KICAgICAgICAgICAgICAgICAgICBpZiAoQ2hhclR5cGVzW2NoYXJdICYgNTEyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBraW5kID0gMzI7DQogICAgICAgICAgICAgICAgICAgICAgICBhdFN0YXJ0ID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUgKiA4ICsgKGNoYXIgLSA0OCk7DQogICAgICAgICAgICAgICAgICAgIGNoYXIgPSBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKENoYXJUeXBlc1tjaGFyXSAmIDUxMikgew0KICAgICAgICAgICAgICAgIGlmIChjb250ZXh0ICYgMTAyNCkNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMSk7DQogICAgICAgICAgICAgICAgcGFyc2VyLmZsYWdzIHw9IDY0Ow0KICAgICAgICAgICAgICAgIGtpbmQgPSAzMjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKGNoYXIgPT09IDk1KSB7DQogICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKGtpbmQgJiA0OCkgew0KICAgICAgICAgICAgaWYgKGF0U3RhcnQpIHsNCiAgICAgICAgICAgICAgICB3aGlsZSAoZGlnaXQgPj0gMCAmJiBDaGFyVHlwZXNbY2hhcl0gJiAoMTYgfCA0MDk2KSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoY2hhciA9PT0gOTUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXIgPSBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoYXIgPT09IDk1IHx8IGtpbmQgJiAzMikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydFNjYW5uZXJFcnJvcihwYXJzZXIuaW5kZXgsIHBhcnNlci5saW5lLCBwYXJzZXIuaW5kZXggKyAxLCAxNDcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dTZXBhcmF0b3IgPSAxOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYWxsb3dTZXBhcmF0b3IgPSAwOw0KICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IDEwICogdmFsdWUgKyAoY2hhciAtIDQ4KTsNCiAgICAgICAgICAgICAgICAgICAgY2hhciA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgIC0tZGlnaXQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChhbGxvd1NlcGFyYXRvcikgew0KICAgICAgICAgICAgICAgICAgICByZXBvcnRTY2FubmVyRXJyb3IocGFyc2VyLmluZGV4LCBwYXJzZXIubGluZSwgcGFyc2VyLmluZGV4ICsgMSwgMTQ4KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGRpZ2l0ID49IDAgJiYgIWlzSWRlbnRpZmllclN0YXJ0JDEoY2hhcikgJiYgY2hhciAhPT0gNDYpIHsNCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLnRva2VuVmFsdWUgPSB2YWx1ZTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRleHQgJiA1MTIpDQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIudG9rZW5SYXcgPSBwYXJzZXIuc291cmNlLnNsaWNlKHBhcnNlci50b2tlblBvcywgcGFyc2VyLmluZGV4KTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEzNDI4MzI2NjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICB2YWx1ZSArPSBzY2FuRGVjaW1hbERpZ2l0c09yU2VwYXJhdG9yKHBhcnNlciwgY2hhcik7DQogICAgICAgICAgICBjaGFyID0gcGFyc2VyLmN1cnJlbnRDaGFyOw0KICAgICAgICAgICAgaWYgKGNoYXIgPT09IDQ2KSB7DQogICAgICAgICAgICAgICAgaWYgKGFkdmFuY2VDaGFyKHBhcnNlcikgPT09IDk1KQ0KICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAwKTsNCiAgICAgICAgICAgICAgICBraW5kID0gNjQ7DQogICAgICAgICAgICAgICAgdmFsdWUgKz0gJy4nICsgc2NhbkRlY2ltYWxEaWdpdHNPclNlcGFyYXRvcihwYXJzZXIsIHBhcnNlci5jdXJyZW50Q2hhcik7DQogICAgICAgICAgICAgICAgY2hhciA9IHBhcnNlci5jdXJyZW50Q2hhcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBjb25zdCBlbmQgPSBwYXJzZXIuaW5kZXg7DQogICAgbGV0IGlzQmlnSW50ID0gMDsNCiAgICBpZiAoY2hhciA9PT0gMTEwICYmIGtpbmQgJiAxMjgpIHsNCiAgICAgICAgaXNCaWdJbnQgPSAxOw0KICAgICAgICBjaGFyID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGlmICgoY2hhciB8IDMyKSA9PT0gMTAxKSB7DQogICAgICAgICAgICBjaGFyID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgIGlmIChDaGFyVHlwZXNbY2hhcl0gJiAyNTYpDQogICAgICAgICAgICAgICAgY2hhciA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICBjb25zdCB7IGluZGV4IH0gPSBwYXJzZXI7DQogICAgICAgICAgICBpZiAoKENoYXJUeXBlc1tjaGFyXSAmIDE2KSA9PT0gMCkNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMCk7DQogICAgICAgICAgICB2YWx1ZSArPSBwYXJzZXIuc291cmNlLnN1YnN0cmluZyhlbmQsIGluZGV4KSArIHNjYW5EZWNpbWFsRGlnaXRzT3JTZXBhcmF0b3IocGFyc2VyLCBjaGFyKTsNCiAgICAgICAgICAgIGNoYXIgPSBwYXJzZXIuY3VycmVudENoYXI7DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKChwYXJzZXIuaW5kZXggPCBwYXJzZXIuZW5kICYmIENoYXJUeXBlc1tjaGFyXSAmIDE2KSB8fCBpc0lkZW50aWZpZXJTdGFydCQxKGNoYXIpKSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDEyKTsNCiAgICB9DQogICAgaWYgKGlzQmlnSW50KSB7DQogICAgICAgIHBhcnNlci50b2tlblJhdyA9IHBhcnNlci5zb3VyY2Uuc2xpY2UocGFyc2VyLnRva2VuUG9zLCBwYXJzZXIuaW5kZXgpOw0KICAgICAgICBwYXJzZXIudG9rZW5WYWx1ZSA9IEJpZ0ludCh2YWx1ZSk7DQogICAgICAgIHJldHVybiAxMzQyODMzODk7DQogICAgfQ0KICAgIHBhcnNlci50b2tlblZhbHVlID0NCiAgICAgICAga2luZCAmICgxIHwgMiB8IDggfCA0KQ0KICAgICAgICAgICAgPyB2YWx1ZQ0KICAgICAgICAgICAgOiBraW5kICYgMzINCiAgICAgICAgICAgICAgICA/IHBhcnNlRmxvYXQocGFyc2VyLnNvdXJjZS5zdWJzdHJpbmcocGFyc2VyLnRva2VuUG9zLCBwYXJzZXIuaW5kZXgpKQ0KICAgICAgICAgICAgICAgIDogK3ZhbHVlOw0KICAgIGlmIChjb250ZXh0ICYgNTEyKQ0KICAgICAgICBwYXJzZXIudG9rZW5SYXcgPSBwYXJzZXIuc291cmNlLnNsaWNlKHBhcnNlci50b2tlblBvcywgcGFyc2VyLmluZGV4KTsNCiAgICByZXR1cm4gMTM0MjgzMjY2Ow0KfQ0KZnVuY3Rpb24gc2NhbkRlY2ltYWxEaWdpdHNPclNlcGFyYXRvcihwYXJzZXIsIGNoYXIpIHsNCiAgICBsZXQgYWxsb3dTZXBhcmF0b3IgPSAwOw0KICAgIGxldCBzdGFydCA9IHBhcnNlci5pbmRleDsNCiAgICBsZXQgcmV0ID0gJyc7DQogICAgd2hpbGUgKENoYXJUeXBlc1tjaGFyXSAmICgxNiB8IDQwOTYpKSB7DQogICAgICAgIGlmIChjaGFyID09PSA5NSkgew0KICAgICAgICAgICAgY29uc3QgeyBpbmRleCB9ID0gcGFyc2VyOw0KICAgICAgICAgICAgY2hhciA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICBpZiAoY2hhciA9PT0gOTUpIHsNCiAgICAgICAgICAgICAgICByZXBvcnRTY2FubmVyRXJyb3IocGFyc2VyLmluZGV4LCBwYXJzZXIubGluZSwgcGFyc2VyLmluZGV4ICsgMSwgMTQ3KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGFsbG93U2VwYXJhdG9yID0gMTsNCiAgICAgICAgICAgIHJldCArPSBwYXJzZXIuc291cmNlLnN1YnN0cmluZyhzdGFydCwgaW5kZXgpOw0KICAgICAgICAgICAgc3RhcnQgPSBwYXJzZXIuaW5kZXg7DQogICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgfQ0KICAgICAgICBhbGxvd1NlcGFyYXRvciA9IDA7DQogICAgICAgIGNoYXIgPSBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgIH0NCiAgICBpZiAoYWxsb3dTZXBhcmF0b3IpIHsNCiAgICAgICAgcmVwb3J0U2Nhbm5lckVycm9yKHBhcnNlci5pbmRleCwgcGFyc2VyLmxpbmUsIHBhcnNlci5pbmRleCArIDEsIDE0OCk7DQogICAgfQ0KICAgIHJldHVybiByZXQgKyBwYXJzZXIuc291cmNlLnN1YnN0cmluZyhzdGFydCwgcGFyc2VyLmluZGV4KTsNCn0KCmNvbnN0IEtleXdvcmREZXNjVGFibGUgPSBbDQogICAgJ2VuZCBvZiBzb3VyY2UnLA0KICAgICdpZGVudGlmaWVyJywgJ251bWJlcicsICdzdHJpbmcnLCAncmVndWxhciBleHByZXNzaW9uJywNCiAgICAnZmFsc2UnLCAndHJ1ZScsICdudWxsJywNCiAgICAndGVtcGxhdGUgY29udGludWF0aW9uJywgJ3RlbXBsYXRlIHRhaWwnLA0KICAgICc9PicsICcoJywgJ3snLCAnLicsICcuLi4nLCAnfScsICcpJywgJzsnLCAnLCcsICdbJywgJ10nLCAnOicsICc/JywgJ1wnJywgJyInLCAnPC8nLCAnLz4nLA0KICAgICcrKycsICctLScsDQogICAgJz0nLCAnPDw9JywgJz4+PScsICc+Pj49JywgJyoqPScsICcrPScsICctPScsICcqPScsICcvPScsICclPScsICdePScsICd8PScsDQogICAgJyY9JywgJ3x8PScsICcmJj0nLCAnPz89JywNCiAgICAndHlwZW9mJywgJ2RlbGV0ZScsICd2b2lkJywgJyEnLCAnficsICcrJywgJy0nLCAnaW4nLCAnaW5zdGFuY2VvZicsICcqJywgJyUnLCAnLycsICcqKicsICcmJicsDQogICAgJ3x8JywgJz09PScsICchPT0nLCAnPT0nLCAnIT0nLCAnPD0nLCAnPj0nLCAnPCcsICc+JywgJzw8JywgJz4+JywgJz4+PicsICcmJywgJ3wnLCAnXicsDQogICAgJ3ZhcicsICdsZXQnLCAnY29uc3QnLA0KICAgICdicmVhaycsICdjYXNlJywgJ2NhdGNoJywgJ2NsYXNzJywgJ2NvbnRpbnVlJywgJ2RlYnVnZ2VyJywgJ2RlZmF1bHQnLCAnZG8nLCAnZWxzZScsICdleHBvcnQnLA0KICAgICdleHRlbmRzJywgJ2ZpbmFsbHknLCAnZm9yJywgJ2Z1bmN0aW9uJywgJ2lmJywgJ2ltcG9ydCcsICduZXcnLCAncmV0dXJuJywgJ3N1cGVyJywgJ3N3aXRjaCcsDQogICAgJ3RoaXMnLCAndGhyb3cnLCAndHJ5JywgJ3doaWxlJywgJ3dpdGgnLA0KICAgICdpbXBsZW1lbnRzJywgJ2ludGVyZmFjZScsICdwYWNrYWdlJywgJ3ByaXZhdGUnLCAncHJvdGVjdGVkJywgJ3B1YmxpYycsICdzdGF0aWMnLCAneWllbGQnLA0KICAgICdhcycsICdhc3luYycsICdhd2FpdCcsICdjb25zdHJ1Y3RvcicsICdnZXQnLCAnc2V0JywgJ2Zyb20nLCAnb2YnLA0KICAgICdlbnVtJywgJ2V2YWwnLCAnYXJndW1lbnRzJywgJ2VzY2FwZWQga2V5d29yZCcsICdlc2NhcGVkIGZ1dHVyZSByZXNlcnZlZCBrZXl3b3JkJywgJ3Jlc2VydmVkIGlmIHN0cmljdCcsICcjJywNCiAgICAnQmlnSW50TGl0ZXJhbCcsICc/PycsICc/LicsICdXaGl0ZVNwYWNlJywgJ0lsbGVnYWwnLCAnTGluZVRlcm1pbmF0b3InLCAnUHJpdmF0ZUZpZWxkJywNCiAgICAnVGVtcGxhdGUnLCAnQCcsICd0YXJnZXQnLCAnbWV0YScsICdMaW5lRmVlZCcsICdFc2NhcGVkJywgJ0pTWFRleHQnDQpdOw0KY29uc3QgZGVzY0tleXdvcmRUYWJsZSA9IE9iamVjdC5jcmVhdGUobnVsbCwgew0KICAgIHRoaXM6IHsgdmFsdWU6IDg2MTEzIH0sDQogICAgZnVuY3Rpb246IHsgdmFsdWU6IDg2MTA2IH0sDQogICAgaWY6IHsgdmFsdWU6IDIwNTcxIH0sDQogICAgcmV0dXJuOiB7IHZhbHVlOiAyMDU3NCB9LA0KICAgIHZhcjogeyB2YWx1ZTogODYwOTAgfSwNCiAgICBlbHNlOiB7IHZhbHVlOiAyMDU2NSB9LA0KICAgIGZvcjogeyB2YWx1ZTogMjA1NjkgfSwNCiAgICBuZXc6IHsgdmFsdWU6IDg2MTA5IH0sDQogICAgaW46IHsgdmFsdWU6IDg3Mzg4NjggfSwNCiAgICB0eXBlb2Y6IHsgdmFsdWU6IDE2ODYzMjc3IH0sDQogICAgd2hpbGU6IHsgdmFsdWU6IDIwNTgwIH0sDQogICAgY2FzZTogeyB2YWx1ZTogMjA1NTggfSwNCiAgICBicmVhazogeyB2YWx1ZTogMjA1NTcgfSwNCiAgICB0cnk6IHsgdmFsdWU6IDIwNTc5IH0sDQogICAgY2F0Y2g6IHsgdmFsdWU6IDIwNTU5IH0sDQogICAgZGVsZXRlOiB7IHZhbHVlOiAxNjg2MzI3OCB9LA0KICAgIHRocm93OiB7IHZhbHVlOiA4NjExNCB9LA0KICAgIHN3aXRjaDogeyB2YWx1ZTogODYxMTIgfSwNCiAgICBjb250aW51ZTogeyB2YWx1ZTogMjA1NjEgfSwNCiAgICBkZWZhdWx0OiB7IHZhbHVlOiAyMDU2MyB9LA0KICAgIGluc3RhbmNlb2Y6IHsgdmFsdWU6IDg0NzY3MjUgfSwNCiAgICBkbzogeyB2YWx1ZTogMjA1NjQgfSwNCiAgICB2b2lkOiB7IHZhbHVlOiAxNjg2MzI3OSB9LA0KICAgIGZpbmFsbHk6IHsgdmFsdWU6IDIwNTY4IH0sDQogICAgYXN5bmM6IHsgdmFsdWU6IDIwOTAwNyB9LA0KICAgIGF3YWl0OiB7IHZhbHVlOiAyMDkwMDggfSwNCiAgICBjbGFzczogeyB2YWx1ZTogODYwOTYgfSwNCiAgICBjb25zdDogeyB2YWx1ZTogODYwOTIgfSwNCiAgICBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogMTI0MDEgfSwNCiAgICBkZWJ1Z2dlcjogeyB2YWx1ZTogMjA1NjIgfSwNCiAgICBleHBvcnQ6IHsgdmFsdWU6IDIwNTY2IH0sDQogICAgZXh0ZW5kczogeyB2YWx1ZTogMjA1NjcgfSwNCiAgICBmYWxzZTogeyB2YWx1ZTogODYwMjEgfSwNCiAgICBmcm9tOiB7IHZhbHVlOiAxMjQwNCB9LA0KICAgIGdldDogeyB2YWx1ZTogMTI0MDIgfSwNCiAgICBpbXBsZW1lbnRzOiB7IHZhbHVlOiAzNjk2NiB9LA0KICAgIGltcG9ydDogeyB2YWx1ZTogODYxMDggfSwNCiAgICBpbnRlcmZhY2U6IHsgdmFsdWU6IDM2OTY3IH0sDQogICAgbGV0OiB7IHZhbHVlOiAyNDE3MzkgfSwNCiAgICBudWxsOiB7IHZhbHVlOiA4NjAyMyB9LA0KICAgIG9mOiB7IHZhbHVlOiAyNzQ1NDkgfSwNCiAgICBwYWNrYWdlOiB7IHZhbHVlOiAzNjk2OCB9LA0KICAgIHByaXZhdGU6IHsgdmFsdWU6IDM2OTY5IH0sDQogICAgcHJvdGVjdGVkOiB7IHZhbHVlOiAzNjk3MCB9LA0KICAgIHB1YmxpYzogeyB2YWx1ZTogMzY5NzEgfSwNCiAgICBzZXQ6IHsgdmFsdWU6IDEyNDAzIH0sDQogICAgc3RhdGljOiB7IHZhbHVlOiAzNjk3MiB9LA0KICAgIHN1cGVyOiB7IHZhbHVlOiA4NjExMSB9LA0KICAgIHRydWU6IHsgdmFsdWU6IDg2MDIyIH0sDQogICAgd2l0aDogeyB2YWx1ZTogMjA1ODEgfSwNCiAgICB5aWVsZDogeyB2YWx1ZTogMjQxNzczIH0sDQogICAgZW51bTogeyB2YWx1ZTogODYxMzQgfSwNCiAgICBldmFsOiB7IHZhbHVlOiA1MzcwNzk5MjcgfSwNCiAgICBhczogeyB2YWx1ZTogNzc5MzQgfSwNCiAgICBhcmd1bWVudHM6IHsgdmFsdWU6IDUzNzA3OTkyOCB9LA0KICAgIHRhcmdldDogeyB2YWx1ZTogMTQzNDk0IH0sDQogICAgbWV0YTogeyB2YWx1ZTogMTQzNDk1IH0sDQp9KTsKCmZ1bmN0aW9uIHNjYW5JZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgaXNWYWxpZEFzS2V5d29yZCkgew0KICAgIHdoaWxlIChpc0lkUGFydFthZHZhbmNlQ2hhcihwYXJzZXIpXSkgeyB9DQogICAgcGFyc2VyLnRva2VuVmFsdWUgPSBwYXJzZXIuc291cmNlLnNsaWNlKHBhcnNlci50b2tlblBvcywgcGFyc2VyLmluZGV4KTsNCiAgICByZXR1cm4gcGFyc2VyLmN1cnJlbnRDaGFyICE9PSA5MiAmJiBwYXJzZXIuY3VycmVudENoYXIgPD0gMHg3ZQ0KICAgICAgICA/IGRlc2NLZXl3b3JkVGFibGVbcGFyc2VyLnRva2VuVmFsdWVdIHx8IDIwODg5Nw0KICAgICAgICA6IHNjYW5JZGVudGlmaWVyU2xvd0Nhc2UocGFyc2VyLCBjb250ZXh0LCAwLCBpc1ZhbGlkQXNLZXl3b3JkKTsNCn0NCmZ1bmN0aW9uIHNjYW5Vbmljb2RlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQpIHsNCiAgICBjb25zdCBjb29rZWRDaGFyID0gc2NhbklkZW50aWZpZXJVbmljb2RlRXNjYXBlKHBhcnNlcik7DQogICAgaWYgKCFpc0lkZW50aWZpZXJQYXJ0KGNvb2tlZENoYXIpKQ0KICAgICAgICByZXBvcnQocGFyc2VyLCA0KTsNCiAgICBwYXJzZXIudG9rZW5WYWx1ZSA9IGZyb21Db2RlUG9pbnQoY29va2VkQ2hhcik7DQogICAgcmV0dXJuIHNjYW5JZGVudGlmaWVyU2xvd0Nhc2UocGFyc2VyLCBjb250ZXh0LCAxLCBDaGFyVHlwZXNbY29va2VkQ2hhcl0gJiA0KTsNCn0NCmZ1bmN0aW9uIHNjYW5JZGVudGlmaWVyU2xvd0Nhc2UocGFyc2VyLCBjb250ZXh0LCBoYXNFc2NhcGUsIGlzVmFsaWRBc0tleXdvcmQpIHsNCiAgICBsZXQgc3RhcnQgPSBwYXJzZXIuaW5kZXg7DQogICAgd2hpbGUgKHBhcnNlci5pbmRleCA8IHBhcnNlci5lbmQpIHsNCiAgICAgICAgaWYgKHBhcnNlci5jdXJyZW50Q2hhciA9PT0gOTIpIHsNCiAgICAgICAgICAgIHBhcnNlci50b2tlblZhbHVlICs9IHBhcnNlci5zb3VyY2Uuc2xpY2Uoc3RhcnQsIHBhcnNlci5pbmRleCk7DQogICAgICAgICAgICBoYXNFc2NhcGUgPSAxOw0KICAgICAgICAgICAgY29uc3QgY29kZSA9IHNjYW5JZGVudGlmaWVyVW5pY29kZUVzY2FwZShwYXJzZXIpOw0KICAgICAgICAgICAgaWYgKCFpc0lkZW50aWZpZXJQYXJ0KGNvZGUpKQ0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDQpOw0KICAgICAgICAgICAgaXNWYWxpZEFzS2V5d29yZCA9IGlzVmFsaWRBc0tleXdvcmQgJiYgQ2hhclR5cGVzW2NvZGVdICYgNDsNCiAgICAgICAgICAgIHBhcnNlci50b2tlblZhbHVlICs9IGZyb21Db2RlUG9pbnQoY29kZSk7DQogICAgICAgICAgICBzdGFydCA9IHBhcnNlci5pbmRleDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChpc0lkZW50aWZpZXJQYXJ0KHBhcnNlci5jdXJyZW50Q2hhcikgfHwgY29uc3VtZU11bHRpVW5pdENvZGVQb2ludChwYXJzZXIsIHBhcnNlci5jdXJyZW50Q2hhcikpIHsNCiAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBpZiAocGFyc2VyLmluZGV4IDw9IHBhcnNlci5lbmQpIHsNCiAgICAgICAgcGFyc2VyLnRva2VuVmFsdWUgKz0gcGFyc2VyLnNvdXJjZS5zbGljZShzdGFydCwgcGFyc2VyLmluZGV4KTsNCiAgICB9DQogICAgY29uc3QgbGVuZ3RoID0gcGFyc2VyLnRva2VuVmFsdWUubGVuZ3RoOw0KICAgIGlmIChpc1ZhbGlkQXNLZXl3b3JkICYmIGxlbmd0aCA+PSAyICYmIGxlbmd0aCA8PSAxMSkgew0KICAgICAgICBjb25zdCB0b2tlbiA9IGRlc2NLZXl3b3JkVGFibGVbcGFyc2VyLnRva2VuVmFsdWVdOw0KICAgICAgICBpZiAodG9rZW4gPT09IHZvaWQgMCkNCiAgICAgICAgICAgIHJldHVybiAyMDg4OTc7DQogICAgICAgIGlmICghaGFzRXNjYXBlKQ0KICAgICAgICAgICAgcmV0dXJuIHRva2VuOw0KICAgICAgICBpZiAodG9rZW4gPT09IDIwOTAwOCkgew0KICAgICAgICAgICAgaWYgKChjb250ZXh0ICYgKDIwNDggfCA0MTk0MzA0KSkgPT09IDApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdG9rZW47DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gMTIxOw0KICAgICAgICB9DQogICAgICAgIGlmIChjb250ZXh0ICYgMTAyNCkgew0KICAgICAgICAgICAgaWYgKHRva2VuID09PSAzNjk3Mikgew0KICAgICAgICAgICAgICAgIHJldHVybiAxMjI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoKHRva2VuICYgMzY4NjQpID09PSAzNjg2NCkgew0KICAgICAgICAgICAgICAgIHJldHVybiAxMjI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoKHRva2VuICYgMjA0ODApID09PSAyMDQ4MCkgew0KICAgICAgICAgICAgICAgIGlmIChjb250ZXh0ICYgMTA3Mzc0MTgyNCAmJiAoY29udGV4dCAmIDgxOTIpID09PSAwKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0b2tlbjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAxMjE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIDE0MzQ4MzsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoY29udGV4dCAmIDEwNzM3NDE4MjQgJiYNCiAgICAgICAgICAgIChjb250ZXh0ICYgODE5MikgPT09IDAgJiYNCiAgICAgICAgICAgICh0b2tlbiAmIDIwNDgwKSA9PT0gMjA0ODApDQogICAgICAgICAgICByZXR1cm4gdG9rZW47DQogICAgICAgIGlmICh0b2tlbiA9PT0gMjQxNzczKSB7DQogICAgICAgICAgICByZXR1cm4gY29udGV4dCAmIDEwNzM3NDE4MjQNCiAgICAgICAgICAgICAgICA/IDE0MzQ4Mw0KICAgICAgICAgICAgICAgIDogY29udGV4dCAmIDIwOTcxNTINCiAgICAgICAgICAgICAgICAgICAgPyAxMjENCiAgICAgICAgICAgICAgICAgICAgOiB0b2tlbjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodG9rZW4gPT09IDIwOTAwNykgew0KICAgICAgICAgICAgcmV0dXJuIDE0MzQ4MzsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoKHRva2VuICYgMzY4NjQpID09PSAzNjg2NCkgew0KICAgICAgICAgICAgcmV0dXJuIHRva2VuOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAxMjE7DQogICAgfQ0KICAgIHJldHVybiAyMDg4OTc7DQp9DQpmdW5jdGlvbiBzY2FuUHJpdmF0ZUlkZW50aWZpZXIocGFyc2VyKSB7DQogICAgaWYgKCFpc0lkZW50aWZpZXJTdGFydCQxKGFkdmFuY2VDaGFyKHBhcnNlcikpKQ0KICAgICAgICByZXBvcnQocGFyc2VyLCA5NCk7DQogICAgcmV0dXJuIDEzMTsNCn0NCmZ1bmN0aW9uIHNjYW5JZGVudGlmaWVyVW5pY29kZUVzY2FwZShwYXJzZXIpIHsNCiAgICBpZiAocGFyc2VyLnNvdXJjZS5jaGFyQ29kZUF0KHBhcnNlci5pbmRleCArIDEpICE9PSAxMTcpIHsNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgNCk7DQogICAgfQ0KICAgIHBhcnNlci5jdXJyZW50Q2hhciA9IHBhcnNlci5zb3VyY2UuY2hhckNvZGVBdCgocGFyc2VyLmluZGV4ICs9IDIpKTsNCiAgICByZXR1cm4gc2NhblVuaWNvZGVFc2NhcGUocGFyc2VyKTsNCn0NCmZ1bmN0aW9uIHNjYW5Vbmljb2RlRXNjYXBlKHBhcnNlcikgew0KICAgIGxldCBjb2RlUG9pbnQgPSAwOw0KICAgIGNvbnN0IGNoYXIgPSBwYXJzZXIuY3VycmVudENoYXI7DQogICAgaWYgKGNoYXIgPT09IDEyMykgew0KICAgICAgICBjb25zdCBiZWdpbiA9IHBhcnNlci5pbmRleCAtIDI7DQogICAgICAgIHdoaWxlIChDaGFyVHlwZXNbYWR2YW5jZUNoYXIocGFyc2VyKV0gJiA2NCkgew0KICAgICAgICAgICAgY29kZVBvaW50ID0gKGNvZGVQb2ludCA8PCA0KSB8IHRvSGV4KHBhcnNlci5jdXJyZW50Q2hhcik7DQogICAgICAgICAgICBpZiAoY29kZVBvaW50ID4gMTExNDExMSkNCiAgICAgICAgICAgICAgICByZXBvcnRTY2FubmVyRXJyb3IoYmVnaW4sIHBhcnNlci5saW5lLCBwYXJzZXIuaW5kZXggKyAxLCAxMDIpOw0KICAgICAgICB9DQogICAgICAgIGlmIChwYXJzZXIuY3VycmVudENoYXIgIT09IDEyNSkgew0KICAgICAgICAgICAgcmVwb3J0U2Nhbm5lckVycm9yKGJlZ2luLCBwYXJzZXIubGluZSwgcGFyc2VyLmluZGV4IC0gMSwgNik7DQogICAgICAgIH0NCiAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgcmV0dXJuIGNvZGVQb2ludDsNCiAgICB9DQogICAgaWYgKChDaGFyVHlwZXNbY2hhcl0gJiA2NCkgPT09IDApDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDYpOw0KICAgIGNvbnN0IGNoYXIyID0gcGFyc2VyLnNvdXJjZS5jaGFyQ29kZUF0KHBhcnNlci5pbmRleCArIDEpOw0KICAgIGlmICgoQ2hhclR5cGVzW2NoYXIyXSAmIDY0KSA9PT0gMCkNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgNik7DQogICAgY29uc3QgY2hhcjMgPSBwYXJzZXIuc291cmNlLmNoYXJDb2RlQXQocGFyc2VyLmluZGV4ICsgMik7DQogICAgaWYgKChDaGFyVHlwZXNbY2hhcjNdICYgNjQpID09PSAwKQ0KICAgICAgICByZXBvcnQocGFyc2VyLCA2KTsNCiAgICBjb25zdCBjaGFyNCA9IHBhcnNlci5zb3VyY2UuY2hhckNvZGVBdChwYXJzZXIuaW5kZXggKyAzKTsNCiAgICBpZiAoKENoYXJUeXBlc1tjaGFyNF0gJiA2NCkgPT09IDApDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDYpOw0KICAgIGNvZGVQb2ludCA9ICh0b0hleChjaGFyKSA8PCAxMikgfCAodG9IZXgoY2hhcjIpIDw8IDgpIHwgKHRvSGV4KGNoYXIzKSA8PCA0KSB8IHRvSGV4KGNoYXI0KTsNCiAgICBwYXJzZXIuY3VycmVudENoYXIgPSBwYXJzZXIuc291cmNlLmNoYXJDb2RlQXQoKHBhcnNlci5pbmRleCArPSA0KSk7DQogICAgcmV0dXJuIGNvZGVQb2ludDsNCn0KCmNvbnN0IFRva2VuTG9va3VwID0gWw0KICAgIDEyOSwNCiAgICAxMjksDQogICAgMTI5LA0KICAgIDEyOSwNCiAgICAxMjksDQogICAgMTI5LA0KICAgIDEyOSwNCiAgICAxMjksDQogICAgMTI5LA0KICAgIDEyOCwNCiAgICAxMzYsDQogICAgMTI4LA0KICAgIDEyOCwNCiAgICAxMzAsDQogICAgMTI5LA0KICAgIDEyOSwNCiAgICAxMjksDQogICAgMTI5LA0KICAgIDEyOSwNCiAgICAxMjksDQogICAgMTI5LA0KICAgIDEyOSwNCiAgICAxMjksDQogICAgMTI5LA0KICAgIDEyOSwNCiAgICAxMjksDQogICAgMTI5LA0KICAgIDEyOSwNCiAgICAxMjksDQogICAgMTI5LA0KICAgIDEyOSwNCiAgICAxMjksDQogICAgMTI4LA0KICAgIDE2ODQyODAwLA0KICAgIDEzNDI4MzI2NywNCiAgICAxMzEsDQogICAgMjA4ODk3LA0KICAgIDg0NTcwMTUsDQogICAgODQ1NTc1MSwNCiAgICAxMzQyODMyNjcsDQogICAgNjcxNzQ0MTEsDQogICAgMTYsDQogICAgODQ1NzAxNCwNCiAgICAyNTIzMzk3MCwNCiAgICAxOCwNCiAgICAyNTIzMzk3MSwNCiAgICA2NzEwODg3NywNCiAgICA4NDU3MDE2LA0KICAgIDEzNDI4MzI2NiwNCiAgICAxMzQyODMyNjYsDQogICAgMTM0MjgzMjY2LA0KICAgIDEzNDI4MzI2NiwNCiAgICAxMzQyODMyNjYsDQogICAgMTM0MjgzMjY2LA0KICAgIDEzNDI4MzI2NiwNCiAgICAxMzQyODMyNjYsDQogICAgMTM0MjgzMjY2LA0KICAgIDEzNDI4MzI2NiwNCiAgICAyMSwNCiAgICAxMDc0NzkwNDE3LA0KICAgIDg0NTYyNTgsDQogICAgMTA3NzkzNjE1NywNCiAgICA4NDU2MjU5LA0KICAgIDIyLA0KICAgIDEzMywNCiAgICAyMDg4OTcsDQogICAgMjA4ODk3LA0KICAgIDIwODg5NywNCiAgICAyMDg4OTcsDQogICAgMjA4ODk3LA0KICAgIDIwODg5NywNCiAgICAyMDg4OTcsDQogICAgMjA4ODk3LA0KICAgIDIwODg5NywNCiAgICAyMDg4OTcsDQogICAgMjA4ODk3LA0KICAgIDIwODg5NywNCiAgICAyMDg4OTcsDQogICAgMjA4ODk3LA0KICAgIDIwODg5NywNCiAgICAyMDg4OTcsDQogICAgMjA4ODk3LA0KICAgIDIwODg5NywNCiAgICAyMDg4OTcsDQogICAgMjA4ODk3LA0KICAgIDIwODg5NywNCiAgICAyMDg4OTcsDQogICAgMjA4ODk3LA0KICAgIDIwODg5NywNCiAgICAyMDg4OTcsDQogICAgMjA4ODk3LA0KICAgIDY5MjcxNTcxLA0KICAgIDEzNywNCiAgICAyMCwNCiAgICA4NDU1NDk3LA0KICAgIDIwODg5NywNCiAgICAxMzIsDQogICAgNDA5NiwNCiAgICA0MDk2LA0KICAgIDQwOTYsDQogICAgNDA5NiwNCiAgICA0MDk2LA0KICAgIDQwOTYsDQogICAgNDA5NiwNCiAgICAyMDg4OTcsDQogICAgNDA5NiwNCiAgICAyMDg4OTcsDQogICAgMjA4ODk3LA0KICAgIDQwOTYsDQogICAgMjA4ODk3LA0KICAgIDQwOTYsDQogICAgMjA4ODk3LA0KICAgIDQwOTYsDQogICAgMjA4ODk3LA0KICAgIDQwOTYsDQogICAgNDA5NiwNCiAgICA0MDk2LA0KICAgIDIwODg5NywNCiAgICA0MDk2LA0KICAgIDQwOTYsDQogICAgMjA4ODk3LA0KICAgIDQwOTYsDQogICAgNDA5NiwNCiAgICAyMTYyNzAwLA0KICAgIDg0NTUyNDAsDQogICAgMTA3NDc5MDQxNSwNCiAgICAxNjg0MjgwMSwNCiAgICAxMjkNCl07DQpmdW5jdGlvbiBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KSB7DQogICAgcGFyc2VyLmZsYWdzID0gKHBhcnNlci5mbGFncyB8IDEpIF4gMTsNCiAgICBwYXJzZXIuc3RhcnRQb3MgPSBwYXJzZXIuaW5kZXg7DQogICAgcGFyc2VyLnN0YXJ0Q29sdW1uID0gcGFyc2VyLmNvbHVtbjsNCiAgICBwYXJzZXIuc3RhcnRMaW5lID0gcGFyc2VyLmxpbmU7DQogICAgcGFyc2VyLnRva2VuID0gc2NhblNpbmdsZVRva2VuKHBhcnNlciwgY29udGV4dCwgMCk7DQogICAgaWYgKHBhcnNlci5vblRva2VuICYmIHBhcnNlci50b2tlbiAhPT0gMTA0ODU3Nikgew0KICAgICAgICBjb25zdCBsb2MgPSB7DQogICAgICAgICAgICBzdGFydDogew0KICAgICAgICAgICAgICAgIGxpbmU6IHBhcnNlci5saW5lUG9zLA0KICAgICAgICAgICAgICAgIGNvbHVtbjogcGFyc2VyLmNvbFBvcw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGVuZDogew0KICAgICAgICAgICAgICAgIGxpbmU6IHBhcnNlci5saW5lLA0KICAgICAgICAgICAgICAgIGNvbHVtbjogcGFyc2VyLmNvbHVtbg0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgICAgICBwYXJzZXIub25Ub2tlbihjb252ZXJ0VG9rZW5UeXBlKHBhcnNlci50b2tlbiksIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmluZGV4LCBsb2MpOw0KICAgIH0NCn0NCmZ1bmN0aW9uIHNjYW5TaW5nbGVUb2tlbihwYXJzZXIsIGNvbnRleHQsIHN0YXRlKSB7DQogICAgY29uc3QgaXNTdGFydE9mTGluZSA9IHBhcnNlci5pbmRleCA9PT0gMDsNCiAgICBjb25zdCBzb3VyY2UgPSBwYXJzZXIuc291cmNlOw0KICAgIGxldCBzdGFydFBvcyA9IHBhcnNlci5pbmRleDsNCiAgICBsZXQgc3RhcnRMaW5lID0gcGFyc2VyLmxpbmU7DQogICAgbGV0IHN0YXJ0Q29sdW1uID0gcGFyc2VyLmNvbHVtbjsNCiAgICB3aGlsZSAocGFyc2VyLmluZGV4IDwgcGFyc2VyLmVuZCkgew0KICAgICAgICBwYXJzZXIudG9rZW5Qb3MgPSBwYXJzZXIuaW5kZXg7DQogICAgICAgIHBhcnNlci5jb2xQb3MgPSBwYXJzZXIuY29sdW1uOw0KICAgICAgICBwYXJzZXIubGluZVBvcyA9IHBhcnNlci5saW5lOw0KICAgICAgICBsZXQgY2hhciA9IHBhcnNlci5jdXJyZW50Q2hhcjsNCiAgICAgICAgaWYgKGNoYXIgPD0gMHg3ZSkgew0KICAgICAgICAgICAgY29uc3QgdG9rZW4gPSBUb2tlbkxvb2t1cFtjaGFyXTsNCiAgICAgICAgICAgIHN3aXRjaCAodG9rZW4pIHsNCiAgICAgICAgICAgICAgICBjYXNlIDY3MTc0NDExOg0KICAgICAgICAgICAgICAgIGNhc2UgMTY6DQogICAgICAgICAgICAgICAgY2FzZSAyMTYyNzAwOg0KICAgICAgICAgICAgICAgIGNhc2UgMTA3NDc5MDQxNToNCiAgICAgICAgICAgICAgICBjYXNlIDY5MjcxNTcxOg0KICAgICAgICAgICAgICAgIGNhc2UgMjA6DQogICAgICAgICAgICAgICAgY2FzZSAyMToNCiAgICAgICAgICAgICAgICBjYXNlIDEwNzQ3OTA0MTc6DQogICAgICAgICAgICAgICAgY2FzZSAxODoNCiAgICAgICAgICAgICAgICBjYXNlIDE2ODQyODAxOg0KICAgICAgICAgICAgICAgIGNhc2UgMTMzOg0KICAgICAgICAgICAgICAgIGNhc2UgMTI5Og0KICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG9rZW47DQogICAgICAgICAgICAgICAgY2FzZSAyMDg4OTc6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzY2FuSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDApOw0KICAgICAgICAgICAgICAgIGNhc2UgNDA5NjoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjYW5JZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMSk7DQogICAgICAgICAgICAgICAgY2FzZSAxMzQyODMyNjY6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzY2FuTnVtYmVyJDEocGFyc2VyLCBjb250ZXh0LCAxNiB8IDEyOCk7DQogICAgICAgICAgICAgICAgY2FzZSAxMzQyODMyNjc6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzY2FuU3RyaW5nJDEocGFyc2VyLCBjb250ZXh0LCBjaGFyKTsNCiAgICAgICAgICAgICAgICBjYXNlIDEzMjoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjYW5UZW1wbGF0ZShwYXJzZXIsIGNvbnRleHQpOw0KICAgICAgICAgICAgICAgIGNhc2UgMTM3Og0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NhblVuaWNvZGVJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCk7DQogICAgICAgICAgICAgICAgY2FzZSAxMzE6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzY2FuUHJpdmF0ZUlkZW50aWZpZXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICBjYXNlIDEyODoNCiAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSAxMzA6DQogICAgICAgICAgICAgICAgICAgIHN0YXRlIHw9IDEgfCA0Ow0KICAgICAgICAgICAgICAgICAgICBzY2FuTmV3TGluZShwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlIDEzNjoNCiAgICAgICAgICAgICAgICAgICAgY29uc3VtZUxpbmVGZWVkKHBhcnNlciwgc3RhdGUpOw0KICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IChzdGF0ZSAmIH40KSB8IDE7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgODQ1NjI1ODoNCiAgICAgICAgICAgICAgICAgICAgbGV0IGNoID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci5pbmRleCA8IHBhcnNlci5lbmQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gNjApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLmluZGV4IDwgcGFyc2VyLmVuZCAmJiBhZHZhbmNlQ2hhcihwYXJzZXIpID09PSA2MSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gNDE5NDMzNDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDg0NTY1MTY7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjaCA9PT0gNjEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA4NDU2MjU2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoID09PSAzMykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gcGFyc2VyLmluZGV4ICsgMTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggKyAxIDwgcGFyc2VyLmVuZCAmJg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2UuY2hhckNvZGVBdChpbmRleCkgPT09IDQ1ICYmDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZS5jaGFyQ29kZUF0KGluZGV4ICsgMSkgPT0gNDUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmNvbHVtbiArPSAzOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIuY3VycmVudENoYXIgPSBzb3VyY2UuY2hhckNvZGVBdCgocGFyc2VyLmluZGV4ICs9IDMpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBza2lwU2luZ2xlSFRNTENvbW1lbnQocGFyc2VyLCBzb3VyY2UsIHN0YXRlLCBjb250ZXh0LCAyLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRQb3MgPSBwYXJzZXIudG9rZW5Qb3M7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0TGluZSA9IHBhcnNlci5saW5lUG9zOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydENvbHVtbiA9IHBhcnNlci5jb2xQb3M7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gODQ1NjI1ODsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gNDcpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGNvbnRleHQgJiAxNikgPT09IDApDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA4NDU2MjU4Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gcGFyc2VyLmluZGV4ICsgMTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCBwYXJzZXIuZW5kKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoID0gc291cmNlLmNoYXJDb2RlQXQoaW5kZXgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2ggPT09IDQyIHx8IGNoID09PSA0NykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAyNTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gODQ1NjI1ODsNCiAgICAgICAgICAgICAgICBjYXNlIDEwNzc5MzYxNTc6IHsNCiAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2ggPSBwYXJzZXIuY3VycmVudENoYXI7DQogICAgICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gNjEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhZHZhbmNlQ2hhcihwYXJzZXIpID09PSA2MSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDg0NTU5OTY7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gODQ1NTk5ODsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoY2ggPT09IDYyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEwOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAxMDc3OTM2MTU3Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXNlIDE2ODQyODAwOg0KICAgICAgICAgICAgICAgICAgICBpZiAoYWR2YW5jZUNoYXIocGFyc2VyKSAhPT0gNjEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxNjg0MjgwMDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoYWR2YW5jZUNoYXIocGFyc2VyKSAhPT0gNjEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA4NDU1OTk5Ow0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiA4NDU1OTk3Ow0KICAgICAgICAgICAgICAgIGNhc2UgODQ1NzAxNToNCiAgICAgICAgICAgICAgICAgICAgaWYgKGFkdmFuY2VDaGFyKHBhcnNlcikgIT09IDYxKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDg0NTcwMTU7DQogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiA0MTk0MzQyOw0KICAgICAgICAgICAgICAgIGNhc2UgODQ1NzAxNDogew0KICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLmluZGV4ID49IHBhcnNlci5lbmQpDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gODQ1NzAxNDsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2ggPSBwYXJzZXIuY3VycmVudENoYXI7DQogICAgICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gNjEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gNDE5NDM0MDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoY2ggIT09IDQyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDg0NTcwMTQ7DQogICAgICAgICAgICAgICAgICAgIGlmIChhZHZhbmNlQ2hhcihwYXJzZXIpICE9PSA2MSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA4NDU3MjczOw0KICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gNDE5NDMzNzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2FzZSA4NDU1NDk3Og0KICAgICAgICAgICAgICAgICAgICBpZiAoYWR2YW5jZUNoYXIocGFyc2VyKSAhPT0gNjEpDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gODQ1NTQ5NzsNCiAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDQxOTQzNDM7DQogICAgICAgICAgICAgICAgY2FzZSAyNTIzMzk3MDogew0KICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBjaCA9IHBhcnNlci5jdXJyZW50Q2hhcjsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNoID09PSA0Mykgew0KICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAzMzYxOTk5NTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoY2ggPT09IDYxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDQxOTQzMzg7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDI1MjMzOTcwOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXNlIDI1MjMzOTcxOiB7DQogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoID0gcGFyc2VyLmN1cnJlbnRDaGFyOw0KICAgICAgICAgICAgICAgICAgICBpZiAoY2ggPT09IDQ1KSB7DQogICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChzdGF0ZSAmIDEgfHwgaXNTdGFydE9mTGluZSkgJiYgcGFyc2VyLmN1cnJlbnRDaGFyID09PSA2Mikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoY29udGV4dCAmIDI1NikgPT09IDApDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDEwOSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IHNraXBTaW5nbGVIVE1MQ29tbWVudChwYXJzZXIsIHNvdXJjZSwgc3RhdGUsIGNvbnRleHQsIDMsIHN0YXJ0UG9zLCBzdGFydExpbmUsIHN0YXJ0Q29sdW1uKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydFBvcyA9IHBhcnNlci50b2tlblBvczsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydExpbmUgPSBwYXJzZXIubGluZVBvczsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydENvbHVtbiA9IHBhcnNlci5jb2xQb3M7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMzM2MTk5OTY7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKGNoID09PSA2MSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA0MTk0MzM5Ow0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAyNTIzMzk3MTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2FzZSA4NDU3MDE2OiB7DQogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIuaW5kZXggPCBwYXJzZXIuZW5kKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjaCA9IHBhcnNlci5jdXJyZW50Q2hhcjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gNDcpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlID0gc2tpcFNpbmdsZUxpbmVDb21tZW50KHBhcnNlciwgc291cmNlLCBzdGF0ZSwgMCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRQb3MgPSBwYXJzZXIudG9rZW5Qb3M7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRMaW5lID0gcGFyc2VyLmxpbmVQb3M7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRDb2x1bW4gPSBwYXJzZXIuY29sUG9zOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoID09PSA0Mikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBza2lwTXVsdGlMaW5lQ29tbWVudChwYXJzZXIsIHNvdXJjZSwgc3RhdGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0UG9zID0gcGFyc2VyLnRva2VuUG9zOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0TGluZSA9IHBhcnNlci5saW5lUG9zOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0Q29sdW1uID0gcGFyc2VyLmNvbFBvczsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb250ZXh0ICYgMzI3NjgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NhblJlZ3VsYXJFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2ggPT09IDYxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gNDI1OTg3NzsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gODQ1NzAxNjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2FzZSA2NzEwODg3NzoNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV4dCA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgIGlmIChuZXh0ID49IDQ4ICYmIG5leHQgPD0gNTcpDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2Nhbk51bWJlciQxKHBhcnNlciwgY29udGV4dCwgNjQgfCAxNik7DQogICAgICAgICAgICAgICAgICAgIGlmIChuZXh0ID09PSA0Nikgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBwYXJzZXIuaW5kZXggKyAxOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgcGFyc2VyLmVuZCAmJiBzb3VyY2UuY2hhckNvZGVBdChpbmRleCkgPT09IDQ2KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmNvbHVtbiArPSAyOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci5jdXJyZW50Q2hhciA9IHNvdXJjZS5jaGFyQ29kZUF0KChwYXJzZXIuaW5kZXggKz0gMikpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxNDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gNjcxMDg4Nzc7DQogICAgICAgICAgICAgICAgY2FzZSA4NDU1MjQwOiB7DQogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoID0gcGFyc2VyLmN1cnJlbnRDaGFyOw0KICAgICAgICAgICAgICAgICAgICBpZiAoY2ggPT09IDEyNCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIuY3VycmVudENoYXIgPT09IDYxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gNDE5NDM0NjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA4OTc5MDAzOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gNjEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gNDE5NDM0NDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gODQ1NTI0MDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2FzZSA4NDU2MjU5OiB7DQogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoID0gcGFyc2VyLmN1cnJlbnRDaGFyOw0KICAgICAgICAgICAgICAgICAgICBpZiAoY2ggPT09IDYxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDg0NTYyNTc7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKGNoICE9PSA2MikNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA4NDU2MjU5Ow0KICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLmluZGV4IDwgcGFyc2VyLmVuZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2ggPSBwYXJzZXIuY3VycmVudENoYXI7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2ggPT09IDYyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFkdmFuY2VDaGFyKHBhcnNlcikgPT09IDYxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA0MTk0MzM2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gODQ1NjUxODsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gNjEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA0MTk0MzM1Ow0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiA4NDU2NTE3Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXNlIDg0NTU3NTE6IHsNCiAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2ggPSBwYXJzZXIuY3VycmVudENoYXI7DQogICAgICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gMzgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLmN1cnJlbnRDaGFyID09PSA2MSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDQxOTQzNDc7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gODk3OTI1ODsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoY2ggPT09IDYxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDQxOTQzNDU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDg0NTU3NTE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhc2UgMjI6IHsNCiAgICAgICAgICAgICAgICAgICAgbGV0IGNoID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNoID09PSA2Mykgew0KICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIuY3VycmVudENoYXIgPT09IDYxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gNDE5NDM0ODsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAyNzY4ODk5ODI7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKGNoID09PSA0Nikgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBwYXJzZXIuaW5kZXggKyAxOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgcGFyc2VyLmVuZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoID0gc291cmNlLmNoYXJDb2RlQXQoaW5kZXgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKGNoID49IDQ4ICYmIGNoIDw9IDU3KSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlQ2hhcihwYXJzZXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gNjcxMDg5OTE7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAyMjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBpZiAoKGNoYXIgXiA4MjMyKSA8PSAxKSB7DQogICAgICAgICAgICAgICAgc3RhdGUgPSAoc3RhdGUgJiB+NCkgfCAxOw0KICAgICAgICAgICAgICAgIHNjYW5OZXdMaW5lKHBhcnNlcik7DQogICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoKGNoYXIgJiAweGZjMDApID09PSAweGQ4MDAgfHwgKCh1bmljb2RlTG9va3VwWyhjaGFyID4+PiA1KSArIDM0ODE2XSA+Pj4gY2hhcikgJiAzMSAmIDEpICE9PSAwKSB7DQogICAgICAgICAgICAgICAgaWYgKChjaGFyICYgMHhmYzAwKSA9PT0gMHhkYzAwKSB7DQogICAgICAgICAgICAgICAgICAgIGNoYXIgPSAoKGNoYXIgJiAweDNmZikgPDwgMTApIHwgKGNoYXIgJiAweDNmZikgfCAweDEwMDAwOw0KICAgICAgICAgICAgICAgICAgICBpZiAoKCh1bmljb2RlTG9va3VwWyhjaGFyID4+PiA1KSArIDBdID4+PiBjaGFyKSAmIDMxICYgMSkgPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDE4LCBmcm9tQ29kZVBvaW50KGNoYXIpKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBwYXJzZXIuaW5kZXgrKzsNCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmN1cnJlbnRDaGFyID0gY2hhcjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcGFyc2VyLmNvbHVtbisrOw0KICAgICAgICAgICAgICAgIHBhcnNlci50b2tlblZhbHVlID0gJyc7DQogICAgICAgICAgICAgICAgcmV0dXJuIHNjYW5JZGVudGlmaWVyU2xvd0Nhc2UocGFyc2VyLCBjb250ZXh0LCAwLCAwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChpc0V4b3RpY0VDTUFTY3JpcHRXaGl0ZXNwYWNlKGNoYXIpKSB7DQogICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDE4LCBmcm9tQ29kZVBvaW50KGNoYXIpKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gMTA0ODU3NjsNCn0KCmNvbnN0IGVudGl0aWVzID0gew0KICAgIEFFbGlnOiAnXHUwMEM2JywNCiAgICBBTVA6ICdcdTAwMjYnLA0KICAgIEFhY3V0ZTogJ1x1MDBDMScsDQogICAgQWJyZXZlOiAnXHUwMTAyJywNCiAgICBBY2lyYzogJ1x1MDBDMicsDQogICAgQWN5OiAnXHUwNDEwJywNCiAgICBBZnI6ICdcdUQ4MzVcdUREMDQnLA0KICAgIEFncmF2ZTogJ1x1MDBDMCcsDQogICAgQWxwaGE6ICdcdTAzOTEnLA0KICAgIEFtYWNyOiAnXHUwMTAwJywNCiAgICBBbmQ6ICdcdTJBNTMnLA0KICAgIEFvZ29uOiAnXHUwMTA0JywNCiAgICBBb3BmOiAnXHVEODM1XHVERDM4JywNCiAgICBBcHBseUZ1bmN0aW9uOiAnXHUyMDYxJywNCiAgICBBcmluZzogJ1x1MDBDNScsDQogICAgQXNjcjogJ1x1RDgzNVx1REM5QycsDQogICAgQXNzaWduOiAnXHUyMjU0JywNCiAgICBBdGlsZGU6ICdcdTAwQzMnLA0KICAgIEF1bWw6ICdcdTAwQzQnLA0KICAgIEJhY2tzbGFzaDogJ1x1MjIxNicsDQogICAgQmFydjogJ1x1MkFFNycsDQogICAgQmFyd2VkOiAnXHUyMzA2JywNCiAgICBCY3k6ICdcdTA0MTEnLA0KICAgIEJlY2F1c2U6ICdcdTIyMzUnLA0KICAgIEJlcm5vdWxsaXM6ICdcdTIxMkMnLA0KICAgIEJldGE6ICdcdTAzOTInLA0KICAgIEJmcjogJ1x1RDgzNVx1REQwNScsDQogICAgQm9wZjogJ1x1RDgzNVx1REQzOScsDQogICAgQnJldmU6ICdcdTAyRDgnLA0KICAgIEJzY3I6ICdcdTIxMkMnLA0KICAgIEJ1bXBlcTogJ1x1MjI0RScsDQogICAgQ0hjeTogJ1x1MDQyNycsDQogICAgQ09QWTogJ1x1MDBBOScsDQogICAgQ2FjdXRlOiAnXHUwMTA2JywNCiAgICBDYXA6ICdcdTIyRDInLA0KICAgIENhcGl0YWxEaWZmZXJlbnRpYWxEOiAnXHUyMTQ1JywNCiAgICBDYXlsZXlzOiAnXHUyMTJEJywNCiAgICBDY2Fyb246ICdcdTAxMEMnLA0KICAgIENjZWRpbDogJ1x1MDBDNycsDQogICAgQ2NpcmM6ICdcdTAxMDgnLA0KICAgIENjb25pbnQ6ICdcdTIyMzAnLA0KICAgIENkb3Q6ICdcdTAxMEEnLA0KICAgIENlZGlsbGE6ICdcdTAwQjgnLA0KICAgIENlbnRlckRvdDogJ1x1MDBCNycsDQogICAgQ2ZyOiAnXHUyMTJEJywNCiAgICBDaGk6ICdcdTAzQTcnLA0KICAgIENpcmNsZURvdDogJ1x1MjI5OScsDQogICAgQ2lyY2xlTWludXM6ICdcdTIyOTYnLA0KICAgIENpcmNsZVBsdXM6ICdcdTIyOTUnLA0KICAgIENpcmNsZVRpbWVzOiAnXHUyMjk3JywNCiAgICBDbG9ja3dpc2VDb250b3VySW50ZWdyYWw6ICdcdTIyMzInLA0KICAgIENsb3NlQ3VybHlEb3VibGVRdW90ZTogJ1x1MjAxRCcsDQogICAgQ2xvc2VDdXJseVF1b3RlOiAnXHUyMDE5JywNCiAgICBDb2xvbjogJ1x1MjIzNycsDQogICAgQ29sb25lOiAnXHUyQTc0JywNCiAgICBDb25ncnVlbnQ6ICdcdTIyNjEnLA0KICAgIENvbmludDogJ1x1MjIyRicsDQogICAgQ29udG91ckludGVncmFsOiAnXHUyMjJFJywNCiAgICBDb3BmOiAnXHUyMTAyJywNCiAgICBDb3Byb2R1Y3Q6ICdcdTIyMTAnLA0KICAgIENvdW50ZXJDbG9ja3dpc2VDb250b3VySW50ZWdyYWw6ICdcdTIyMzMnLA0KICAgIENyb3NzOiAnXHUyQTJGJywNCiAgICBDc2NyOiAnXHVEODM1XHVEQzlFJywNCiAgICBDdXA6ICdcdTIyRDMnLA0KICAgIEN1cENhcDogJ1x1MjI0RCcsDQogICAgREQ6ICdcdTIxNDUnLA0KICAgIEREb3RyYWhkOiAnXHUyOTExJywNCiAgICBESmN5OiAnXHUwNDAyJywNCiAgICBEU2N5OiAnXHUwNDA1JywNCiAgICBEWmN5OiAnXHUwNDBGJywNCiAgICBEYWdnZXI6ICdcdTIwMjEnLA0KICAgIERhcnI6ICdcdTIxQTEnLA0KICAgIERhc2h2OiAnXHUyQUU0JywNCiAgICBEY2Fyb246ICdcdTAxMEUnLA0KICAgIERjeTogJ1x1MDQxNCcsDQogICAgRGVsOiAnXHUyMjA3JywNCiAgICBEZWx0YTogJ1x1MDM5NCcsDQogICAgRGZyOiAnXHVEODM1XHVERDA3JywNCiAgICBEaWFjcml0aWNhbEFjdXRlOiAnXHUwMEI0JywNCiAgICBEaWFjcml0aWNhbERvdDogJ1x1MDJEOScsDQogICAgRGlhY3JpdGljYWxEb3VibGVBY3V0ZTogJ1x1MDJERCcsDQogICAgRGlhY3JpdGljYWxHcmF2ZTogJ1x1MDA2MCcsDQogICAgRGlhY3JpdGljYWxUaWxkZTogJ1x1MDJEQycsDQogICAgRGlhbW9uZDogJ1x1MjJDNCcsDQogICAgRGlmZmVyZW50aWFsRDogJ1x1MjE0NicsDQogICAgRG9wZjogJ1x1RDgzNVx1REQzQicsDQogICAgRG90OiAnXHUwMEE4JywNCiAgICBEb3REb3Q6ICdcdTIwREMnLA0KICAgIERvdEVxdWFsOiAnXHUyMjUwJywNCiAgICBEb3VibGVDb250b3VySW50ZWdyYWw6ICdcdTIyMkYnLA0KICAgIERvdWJsZURvdDogJ1x1MDBBOCcsDQogICAgRG91YmxlRG93bkFycm93OiAnXHUyMUQzJywNCiAgICBEb3VibGVMZWZ0QXJyb3c6ICdcdTIxRDAnLA0KICAgIERvdWJsZUxlZnRSaWdodEFycm93OiAnXHUyMUQ0JywNCiAgICBEb3VibGVMZWZ0VGVlOiAnXHUyQUU0JywNCiAgICBEb3VibGVMb25nTGVmdEFycm93OiAnXHUyN0Y4JywNCiAgICBEb3VibGVMb25nTGVmdFJpZ2h0QXJyb3c6ICdcdTI3RkEnLA0KICAgIERvdWJsZUxvbmdSaWdodEFycm93OiAnXHUyN0Y5JywNCiAgICBEb3VibGVSaWdodEFycm93OiAnXHUyMUQyJywNCiAgICBEb3VibGVSaWdodFRlZTogJ1x1MjJBOCcsDQogICAgRG91YmxlVXBBcnJvdzogJ1x1MjFEMScsDQogICAgRG91YmxlVXBEb3duQXJyb3c6ICdcdTIxRDUnLA0KICAgIERvdWJsZVZlcnRpY2FsQmFyOiAnXHUyMjI1JywNCiAgICBEb3duQXJyb3c6ICdcdTIxOTMnLA0KICAgIERvd25BcnJvd0JhcjogJ1x1MjkxMycsDQogICAgRG93bkFycm93VXBBcnJvdzogJ1x1MjFGNScsDQogICAgRG93bkJyZXZlOiAnXHUwMzExJywNCiAgICBEb3duTGVmdFJpZ2h0VmVjdG9yOiAnXHUyOTUwJywNCiAgICBEb3duTGVmdFRlZVZlY3RvcjogJ1x1Mjk1RScsDQogICAgRG93bkxlZnRWZWN0b3I6ICdcdTIxQkQnLA0KICAgIERvd25MZWZ0VmVjdG9yQmFyOiAnXHUyOTU2JywNCiAgICBEb3duUmlnaHRUZWVWZWN0b3I6ICdcdTI5NUYnLA0KICAgIERvd25SaWdodFZlY3RvcjogJ1x1MjFDMScsDQogICAgRG93blJpZ2h0VmVjdG9yQmFyOiAnXHUyOTU3JywNCiAgICBEb3duVGVlOiAnXHUyMkE0JywNCiAgICBEb3duVGVlQXJyb3c6ICdcdTIxQTcnLA0KICAgIERvd25hcnJvdzogJ1x1MjFEMycsDQogICAgRHNjcjogJ1x1RDgzNVx1REM5RicsDQogICAgRHN0cm9rOiAnXHUwMTEwJywNCiAgICBFTkc6ICdcdTAxNEEnLA0KICAgIEVUSDogJ1x1MDBEMCcsDQogICAgRWFjdXRlOiAnXHUwMEM5JywNCiAgICBFY2Fyb246ICdcdTAxMUEnLA0KICAgIEVjaXJjOiAnXHUwMENBJywNCiAgICBFY3k6ICdcdTA0MkQnLA0KICAgIEVkb3Q6ICdcdTAxMTYnLA0KICAgIEVmcjogJ1x1RDgzNVx1REQwOCcsDQogICAgRWdyYXZlOiAnXHUwMEM4JywNCiAgICBFbGVtZW50OiAnXHUyMjA4JywNCiAgICBFbWFjcjogJ1x1MDExMicsDQogICAgRW1wdHlTbWFsbFNxdWFyZTogJ1x1MjVGQicsDQogICAgRW1wdHlWZXJ5U21hbGxTcXVhcmU6ICdcdTI1QUInLA0KICAgIEVvZ29uOiAnXHUwMTE4JywNCiAgICBFb3BmOiAnXHVEODM1XHVERDNDJywNCiAgICBFcHNpbG9uOiAnXHUwMzk1JywNCiAgICBFcXVhbDogJ1x1MkE3NScsDQogICAgRXF1YWxUaWxkZTogJ1x1MjI0MicsDQogICAgRXF1aWxpYnJpdW06ICdcdTIxQ0MnLA0KICAgIEVzY3I6ICdcdTIxMzAnLA0KICAgIEVzaW06ICdcdTJBNzMnLA0KICAgIEV0YTogJ1x1MDM5NycsDQogICAgRXVtbDogJ1x1MDBDQicsDQogICAgRXhpc3RzOiAnXHUyMjAzJywNCiAgICBFeHBvbmVudGlhbEU6ICdcdTIxNDcnLA0KICAgIEZjeTogJ1x1MDQyNCcsDQogICAgRmZyOiAnXHVEODM1XHVERDA5JywNCiAgICBGaWxsZWRTbWFsbFNxdWFyZTogJ1x1MjVGQycsDQogICAgRmlsbGVkVmVyeVNtYWxsU3F1YXJlOiAnXHUyNUFBJywNCiAgICBGb3BmOiAnXHVEODM1XHVERDNEJywNCiAgICBGb3JBbGw6ICdcdTIyMDAnLA0KICAgIEZvdXJpZXJ0cmY6ICdcdTIxMzEnLA0KICAgIEZzY3I6ICdcdTIxMzEnLA0KICAgIEdKY3k6ICdcdTA0MDMnLA0KICAgIEdUOiAnXHUwMDNFJywNCiAgICBHYW1tYTogJ1x1MDM5MycsDQogICAgR2FtbWFkOiAnXHUwM0RDJywNCiAgICBHYnJldmU6ICdcdTAxMUUnLA0KICAgIEdjZWRpbDogJ1x1MDEyMicsDQogICAgR2NpcmM6ICdcdTAxMUMnLA0KICAgIEdjeTogJ1x1MDQxMycsDQogICAgR2RvdDogJ1x1MDEyMCcsDQogICAgR2ZyOiAnXHVEODM1XHVERDBBJywNCiAgICBHZzogJ1x1MjJEOScsDQogICAgR29wZjogJ1x1RDgzNVx1REQzRScsDQogICAgR3JlYXRlckVxdWFsOiAnXHUyMjY1JywNCiAgICBHcmVhdGVyRXF1YWxMZXNzOiAnXHUyMkRCJywNCiAgICBHcmVhdGVyRnVsbEVxdWFsOiAnXHUyMjY3JywNCiAgICBHcmVhdGVyR3JlYXRlcjogJ1x1MkFBMicsDQogICAgR3JlYXRlckxlc3M6ICdcdTIyNzcnLA0KICAgIEdyZWF0ZXJTbGFudEVxdWFsOiAnXHUyQTdFJywNCiAgICBHcmVhdGVyVGlsZGU6ICdcdTIyNzMnLA0KICAgIEdzY3I6ICdcdUQ4MzVcdURDQTInLA0KICAgIEd0OiAnXHUyMjZCJywNCiAgICBIQVJEY3k6ICdcdTA0MkEnLA0KICAgIEhhY2VrOiAnXHUwMkM3JywNCiAgICBIYXQ6ICdcdTAwNUUnLA0KICAgIEhjaXJjOiAnXHUwMTI0JywNCiAgICBIZnI6ICdcdTIxMEMnLA0KICAgIEhpbGJlcnRTcGFjZTogJ1x1MjEwQicsDQogICAgSG9wZjogJ1x1MjEwRCcsDQogICAgSG9yaXpvbnRhbExpbmU6ICdcdTI1MDAnLA0KICAgIEhzY3I6ICdcdTIxMEInLA0KICAgIEhzdHJvazogJ1x1MDEyNicsDQogICAgSHVtcERvd25IdW1wOiAnXHUyMjRFJywNCiAgICBIdW1wRXF1YWw6ICdcdTIyNEYnLA0KICAgIElFY3k6ICdcdTA0MTUnLA0KICAgIElKbGlnOiAnXHUwMTMyJywNCiAgICBJT2N5OiAnXHUwNDAxJywNCiAgICBJYWN1dGU6ICdcdTAwQ0QnLA0KICAgIEljaXJjOiAnXHUwMENFJywNCiAgICBJY3k6ICdcdTA0MTgnLA0KICAgIElkb3Q6ICdcdTAxMzAnLA0KICAgIElmcjogJ1x1MjExMScsDQogICAgSWdyYXZlOiAnXHUwMENDJywNCiAgICBJbTogJ1x1MjExMScsDQogICAgSW1hY3I6ICdcdTAxMkEnLA0KICAgIEltYWdpbmFyeUk6ICdcdTIxNDgnLA0KICAgIEltcGxpZXM6ICdcdTIxRDInLA0KICAgIEludDogJ1x1MjIyQycsDQogICAgSW50ZWdyYWw6ICdcdTIyMkInLA0KICAgIEludGVyc2VjdGlvbjogJ1x1MjJDMicsDQogICAgSW52aXNpYmxlQ29tbWE6ICdcdTIwNjMnLA0KICAgIEludmlzaWJsZVRpbWVzOiAnXHUyMDYyJywNCiAgICBJb2dvbjogJ1x1MDEyRScsDQogICAgSW9wZjogJ1x1RDgzNVx1REQ0MCcsDQogICAgSW90YTogJ1x1MDM5OScsDQogICAgSXNjcjogJ1x1MjExMCcsDQogICAgSXRpbGRlOiAnXHUwMTI4JywNCiAgICBJdWtjeTogJ1x1MDQwNicsDQogICAgSXVtbDogJ1x1MDBDRicsDQogICAgSmNpcmM6ICdcdTAxMzQnLA0KICAgIEpjeTogJ1x1MDQxOScsDQogICAgSmZyOiAnXHVEODM1XHVERDBEJywNCiAgICBKb3BmOiAnXHVEODM1XHVERDQxJywNCiAgICBKc2NyOiAnXHVEODM1XHVEQ0E1JywNCiAgICBKc2VyY3k6ICdcdTA0MDgnLA0KICAgIEp1a2N5OiAnXHUwNDA0JywNCiAgICBLSGN5OiAnXHUwNDI1JywNCiAgICBLSmN5OiAnXHUwNDBDJywNCiAgICBLYXBwYTogJ1x1MDM5QScsDQogICAgS2NlZGlsOiAnXHUwMTM2JywNCiAgICBLY3k6ICdcdTA0MUEnLA0KICAgIEtmcjogJ1x1RDgzNVx1REQwRScsDQogICAgS29wZjogJ1x1RDgzNVx1REQ0MicsDQogICAgS3NjcjogJ1x1RDgzNVx1RENBNicsDQogICAgTEpjeTogJ1x1MDQwOScsDQogICAgTFQ6ICdcdTAwM0MnLA0KICAgIExhY3V0ZTogJ1x1MDEzOScsDQogICAgTGFtYmRhOiAnXHUwMzlCJywNCiAgICBMYW5nOiAnXHUyN0VBJywNCiAgICBMYXBsYWNldHJmOiAnXHUyMTEyJywNCiAgICBMYXJyOiAnXHUyMTlFJywNCiAgICBMY2Fyb246ICdcdTAxM0QnLA0KICAgIExjZWRpbDogJ1x1MDEzQicsDQogICAgTGN5OiAnXHUwNDFCJywNCiAgICBMZWZ0QW5nbGVCcmFja2V0OiAnXHUyN0U4JywNCiAgICBMZWZ0QXJyb3c6ICdcdTIxOTAnLA0KICAgIExlZnRBcnJvd0JhcjogJ1x1MjFFNCcsDQogICAgTGVmdEFycm93UmlnaHRBcnJvdzogJ1x1MjFDNicsDQogICAgTGVmdENlaWxpbmc6ICdcdTIzMDgnLA0KICAgIExlZnREb3VibGVCcmFja2V0OiAnXHUyN0U2JywNCiAgICBMZWZ0RG93blRlZVZlY3RvcjogJ1x1Mjk2MScsDQogICAgTGVmdERvd25WZWN0b3I6ICdcdTIxQzMnLA0KICAgIExlZnREb3duVmVjdG9yQmFyOiAnXHUyOTU5JywNCiAgICBMZWZ0Rmxvb3I6ICdcdTIzMEEnLA0KICAgIExlZnRSaWdodEFycm93OiAnXHUyMTk0JywNCiAgICBMZWZ0UmlnaHRWZWN0b3I6ICdcdTI5NEUnLA0KICAgIExlZnRUZWU6ICdcdTIyQTMnLA0KICAgIExlZnRUZWVBcnJvdzogJ1x1MjFBNCcsDQogICAgTGVmdFRlZVZlY3RvcjogJ1x1Mjk1QScsDQogICAgTGVmdFRyaWFuZ2xlOiAnXHUyMkIyJywNCiAgICBMZWZ0VHJpYW5nbGVCYXI6ICdcdTI5Q0YnLA0KICAgIExlZnRUcmlhbmdsZUVxdWFsOiAnXHUyMkI0JywNCiAgICBMZWZ0VXBEb3duVmVjdG9yOiAnXHUyOTUxJywNCiAgICBMZWZ0VXBUZWVWZWN0b3I6ICdcdTI5NjAnLA0KICAgIExlZnRVcFZlY3RvcjogJ1x1MjFCRicsDQogICAgTGVmdFVwVmVjdG9yQmFyOiAnXHUyOTU4JywNCiAgICBMZWZ0VmVjdG9yOiAnXHUyMUJDJywNCiAgICBMZWZ0VmVjdG9yQmFyOiAnXHUyOTUyJywNCiAgICBMZWZ0YXJyb3c6ICdcdTIxRDAnLA0KICAgIExlZnRyaWdodGFycm93OiAnXHUyMUQ0JywNCiAgICBMZXNzRXF1YWxHcmVhdGVyOiAnXHUyMkRBJywNCiAgICBMZXNzRnVsbEVxdWFsOiAnXHUyMjY2JywNCiAgICBMZXNzR3JlYXRlcjogJ1x1MjI3NicsDQogICAgTGVzc0xlc3M6ICdcdTJBQTEnLA0KICAgIExlc3NTbGFudEVxdWFsOiAnXHUyQTdEJywNCiAgICBMZXNzVGlsZGU6ICdcdTIyNzInLA0KICAgIExmcjogJ1x1RDgzNVx1REQwRicsDQogICAgTGw6ICdcdTIyRDgnLA0KICAgIExsZWZ0YXJyb3c6ICdcdTIxREEnLA0KICAgIExtaWRvdDogJ1x1MDEzRicsDQogICAgTG9uZ0xlZnRBcnJvdzogJ1x1MjdGNScsDQogICAgTG9uZ0xlZnRSaWdodEFycm93OiAnXHUyN0Y3JywNCiAgICBMb25nUmlnaHRBcnJvdzogJ1x1MjdGNicsDQogICAgTG9uZ2xlZnRhcnJvdzogJ1x1MjdGOCcsDQogICAgTG9uZ2xlZnRyaWdodGFycm93OiAnXHUyN0ZBJywNCiAgICBMb25ncmlnaHRhcnJvdzogJ1x1MjdGOScsDQogICAgTG9wZjogJ1x1RDgzNVx1REQ0MycsDQogICAgTG93ZXJMZWZ0QXJyb3c6ICdcdTIxOTknLA0KICAgIExvd2VyUmlnaHRBcnJvdzogJ1x1MjE5OCcsDQogICAgTHNjcjogJ1x1MjExMicsDQogICAgTHNoOiAnXHUyMUIwJywNCiAgICBMc3Ryb2s6ICdcdTAxNDEnLA0KICAgIEx0OiAnXHUyMjZBJywNCiAgICBNYXA6ICdcdTI5MDUnLA0KICAgIE1jeTogJ1x1MDQxQycsDQogICAgTWVkaXVtU3BhY2U6ICdcdTIwNUYnLA0KICAgIE1lbGxpbnRyZjogJ1x1MjEzMycsDQogICAgTWZyOiAnXHVEODM1XHVERDEwJywNCiAgICBNaW51c1BsdXM6ICdcdTIyMTMnLA0KICAgIE1vcGY6ICdcdUQ4MzVcdURENDQnLA0KICAgIE1zY3I6ICdcdTIxMzMnLA0KICAgIE11OiAnXHUwMzlDJywNCiAgICBOSmN5OiAnXHUwNDBBJywNCiAgICBOYWN1dGU6ICdcdTAxNDMnLA0KICAgIE5jYXJvbjogJ1x1MDE0NycsDQogICAgTmNlZGlsOiAnXHUwMTQ1JywNCiAgICBOY3k6ICdcdTA0MUQnLA0KICAgIE5lZ2F0aXZlTWVkaXVtU3BhY2U6ICdcdTIwMEInLA0KICAgIE5lZ2F0aXZlVGhpY2tTcGFjZTogJ1x1MjAwQicsDQogICAgTmVnYXRpdmVUaGluU3BhY2U6ICdcdTIwMEInLA0KICAgIE5lZ2F0aXZlVmVyeVRoaW5TcGFjZTogJ1x1MjAwQicsDQogICAgTmVzdGVkR3JlYXRlckdyZWF0ZXI6ICdcdTIyNkInLA0KICAgIE5lc3RlZExlc3NMZXNzOiAnXHUyMjZBJywNCiAgICBOZXdMaW5lOiAnXHUwMDBBJywNCiAgICBOZnI6ICdcdUQ4MzVcdUREMTEnLA0KICAgIE5vQnJlYWs6ICdcdTIwNjAnLA0KICAgIE5vbkJyZWFraW5nU3BhY2U6ICdcdTAwQTAnLA0KICAgIE5vcGY6ICdcdTIxMTUnLA0KICAgIE5vdDogJ1x1MkFFQycsDQogICAgTm90Q29uZ3J1ZW50OiAnXHUyMjYyJywNCiAgICBOb3RDdXBDYXA6ICdcdTIyNkQnLA0KICAgIE5vdERvdWJsZVZlcnRpY2FsQmFyOiAnXHUyMjI2JywNCiAgICBOb3RFbGVtZW50OiAnXHUyMjA5JywNCiAgICBOb3RFcXVhbDogJ1x1MjI2MCcsDQogICAgTm90RXF1YWxUaWxkZTogJ1x1MjI0Mlx1MDMzOCcsDQogICAgTm90RXhpc3RzOiAnXHUyMjA0JywNCiAgICBOb3RHcmVhdGVyOiAnXHUyMjZGJywNCiAgICBOb3RHcmVhdGVyRXF1YWw6ICdcdTIyNzEnLA0KICAgIE5vdEdyZWF0ZXJGdWxsRXF1YWw6ICdcdTIyNjdcdTAzMzgnLA0KICAgIE5vdEdyZWF0ZXJHcmVhdGVyOiAnXHUyMjZCXHUwMzM4JywNCiAgICBOb3RHcmVhdGVyTGVzczogJ1x1MjI3OScsDQogICAgTm90R3JlYXRlclNsYW50RXF1YWw6ICdcdTJBN0VcdTAzMzgnLA0KICAgIE5vdEdyZWF0ZXJUaWxkZTogJ1x1MjI3NScsDQogICAgTm90SHVtcERvd25IdW1wOiAnXHUyMjRFXHUwMzM4JywNCiAgICBOb3RIdW1wRXF1YWw6ICdcdTIyNEZcdTAzMzgnLA0KICAgIE5vdExlZnRUcmlhbmdsZTogJ1x1MjJFQScsDQogICAgTm90TGVmdFRyaWFuZ2xlQmFyOiAnXHUyOUNGXHUwMzM4JywNCiAgICBOb3RMZWZ0VHJpYW5nbGVFcXVhbDogJ1x1MjJFQycsDQogICAgTm90TGVzczogJ1x1MjI2RScsDQogICAgTm90TGVzc0VxdWFsOiAnXHUyMjcwJywNCiAgICBOb3RMZXNzR3JlYXRlcjogJ1x1MjI3OCcsDQogICAgTm90TGVzc0xlc3M6ICdcdTIyNkFcdTAzMzgnLA0KICAgIE5vdExlc3NTbGFudEVxdWFsOiAnXHUyQTdEXHUwMzM4JywNCiAgICBOb3RMZXNzVGlsZGU6ICdcdTIyNzQnLA0KICAgIE5vdE5lc3RlZEdyZWF0ZXJHcmVhdGVyOiAnXHUyQUEyXHUwMzM4JywNCiAgICBOb3ROZXN0ZWRMZXNzTGVzczogJ1x1MkFBMVx1MDMzOCcsDQogICAgTm90UHJlY2VkZXM6ICdcdTIyODAnLA0KICAgIE5vdFByZWNlZGVzRXF1YWw6ICdcdTJBQUZcdTAzMzgnLA0KICAgIE5vdFByZWNlZGVzU2xhbnRFcXVhbDogJ1x1MjJFMCcsDQogICAgTm90UmV2ZXJzZUVsZW1lbnQ6ICdcdTIyMEMnLA0KICAgIE5vdFJpZ2h0VHJpYW5nbGU6ICdcdTIyRUInLA0KICAgIE5vdFJpZ2h0VHJpYW5nbGVCYXI6ICdcdTI5RDBcdTAzMzgnLA0KICAgIE5vdFJpZ2h0VHJpYW5nbGVFcXVhbDogJ1x1MjJFRCcsDQogICAgTm90U3F1YXJlU3Vic2V0OiAnXHUyMjhGXHUwMzM4JywNCiAgICBOb3RTcXVhcmVTdWJzZXRFcXVhbDogJ1x1MjJFMicsDQogICAgTm90U3F1YXJlU3VwZXJzZXQ6ICdcdTIyOTBcdTAzMzgnLA0KICAgIE5vdFNxdWFyZVN1cGVyc2V0RXF1YWw6ICdcdTIyRTMnLA0KICAgIE5vdFN1YnNldDogJ1x1MjI4Mlx1MjBEMicsDQogICAgTm90U3Vic2V0RXF1YWw6ICdcdTIyODgnLA0KICAgIE5vdFN1Y2NlZWRzOiAnXHUyMjgxJywNCiAgICBOb3RTdWNjZWVkc0VxdWFsOiAnXHUyQUIwXHUwMzM4JywNCiAgICBOb3RTdWNjZWVkc1NsYW50RXF1YWw6ICdcdTIyRTEnLA0KICAgIE5vdFN1Y2NlZWRzVGlsZGU6ICdcdTIyN0ZcdTAzMzgnLA0KICAgIE5vdFN1cGVyc2V0OiAnXHUyMjgzXHUyMEQyJywNCiAgICBOb3RTdXBlcnNldEVxdWFsOiAnXHUyMjg5JywNCiAgICBOb3RUaWxkZTogJ1x1MjI0MScsDQogICAgTm90VGlsZGVFcXVhbDogJ1x1MjI0NCcsDQogICAgTm90VGlsZGVGdWxsRXF1YWw6ICdcdTIyNDcnLA0KICAgIE5vdFRpbGRlVGlsZGU6ICdcdTIyNDknLA0KICAgIE5vdFZlcnRpY2FsQmFyOiAnXHUyMjI0JywNCiAgICBOc2NyOiAnXHVEODM1XHVEQ0E5JywNCiAgICBOdGlsZGU6ICdcdTAwRDEnLA0KICAgIE51OiAnXHUwMzlEJywNCiAgICBPRWxpZzogJ1x1MDE1MicsDQogICAgT2FjdXRlOiAnXHUwMEQzJywNCiAgICBPY2lyYzogJ1x1MDBENCcsDQogICAgT2N5OiAnXHUwNDFFJywNCiAgICBPZGJsYWM6ICdcdTAxNTAnLA0KICAgIE9mcjogJ1x1RDgzNVx1REQxMicsDQogICAgT2dyYXZlOiAnXHUwMEQyJywNCiAgICBPbWFjcjogJ1x1MDE0QycsDQogICAgT21lZ2E6ICdcdTAzQTknLA0KICAgIE9taWNyb246ICdcdTAzOUYnLA0KICAgIE9vcGY6ICdcdUQ4MzVcdURENDYnLA0KICAgIE9wZW5DdXJseURvdWJsZVF1b3RlOiAnXHUyMDFDJywNCiAgICBPcGVuQ3VybHlRdW90ZTogJ1x1MjAxOCcsDQogICAgT3I6ICdcdTJBNTQnLA0KICAgIE9zY3I6ICdcdUQ4MzVcdURDQUEnLA0KICAgIE9zbGFzaDogJ1x1MDBEOCcsDQogICAgT3RpbGRlOiAnXHUwMEQ1JywNCiAgICBPdGltZXM6ICdcdTJBMzcnLA0KICAgIE91bWw6ICdcdTAwRDYnLA0KICAgIE92ZXJCYXI6ICdcdTIwM0UnLA0KICAgIE92ZXJCcmFjZTogJ1x1MjNERScsDQogICAgT3ZlckJyYWNrZXQ6ICdcdTIzQjQnLA0KICAgIE92ZXJQYXJlbnRoZXNpczogJ1x1MjNEQycsDQogICAgUGFydGlhbEQ6ICdcdTIyMDInLA0KICAgIFBjeTogJ1x1MDQxRicsDQogICAgUGZyOiAnXHVEODM1XHVERDEzJywNCiAgICBQaGk6ICdcdTAzQTYnLA0KICAgIFBpOiAnXHUwM0EwJywNCiAgICBQbHVzTWludXM6ICdcdTAwQjEnLA0KICAgIFBvaW5jYXJlcGxhbmU6ICdcdTIxMEMnLA0KICAgIFBvcGY6ICdcdTIxMTknLA0KICAgIFByOiAnXHUyQUJCJywNCiAgICBQcmVjZWRlczogJ1x1MjI3QScsDQogICAgUHJlY2VkZXNFcXVhbDogJ1x1MkFBRicsDQogICAgUHJlY2VkZXNTbGFudEVxdWFsOiAnXHUyMjdDJywNCiAgICBQcmVjZWRlc1RpbGRlOiAnXHUyMjdFJywNCiAgICBQcmltZTogJ1x1MjAzMycsDQogICAgUHJvZHVjdDogJ1x1MjIwRicsDQogICAgUHJvcG9ydGlvbjogJ1x1MjIzNycsDQogICAgUHJvcG9ydGlvbmFsOiAnXHUyMjFEJywNCiAgICBQc2NyOiAnXHVEODM1XHVEQ0FCJywNCiAgICBQc2k6ICdcdTAzQTgnLA0KICAgIFFVT1Q6ICdcdTAwMjInLA0KICAgIFFmcjogJ1x1RDgzNVx1REQxNCcsDQogICAgUW9wZjogJ1x1MjExQScsDQogICAgUXNjcjogJ1x1RDgzNVx1RENBQycsDQogICAgUkJhcnI6ICdcdTI5MTAnLA0KICAgIFJFRzogJ1x1MDBBRScsDQogICAgUmFjdXRlOiAnXHUwMTU0JywNCiAgICBSYW5nOiAnXHUyN0VCJywNCiAgICBSYXJyOiAnXHUyMUEwJywNCiAgICBSYXJydGw6ICdcdTI5MTYnLA0KICAgIFJjYXJvbjogJ1x1MDE1OCcsDQogICAgUmNlZGlsOiAnXHUwMTU2JywNCiAgICBSY3k6ICdcdTA0MjAnLA0KICAgIFJlOiAnXHUyMTFDJywNCiAgICBSZXZlcnNlRWxlbWVudDogJ1x1MjIwQicsDQogICAgUmV2ZXJzZUVxdWlsaWJyaXVtOiAnXHUyMUNCJywNCiAgICBSZXZlcnNlVXBFcXVpbGlicml1bTogJ1x1Mjk2RicsDQogICAgUmZyOiAnXHUyMTFDJywNCiAgICBSaG86ICdcdTAzQTEnLA0KICAgIFJpZ2h0QW5nbGVCcmFja2V0OiAnXHUyN0U5JywNCiAgICBSaWdodEFycm93OiAnXHUyMTkyJywNCiAgICBSaWdodEFycm93QmFyOiAnXHUyMUU1JywNCiAgICBSaWdodEFycm93TGVmdEFycm93OiAnXHUyMUM0JywNCiAgICBSaWdodENlaWxpbmc6ICdcdTIzMDknLA0KICAgIFJpZ2h0RG91YmxlQnJhY2tldDogJ1x1MjdFNycsDQogICAgUmlnaHREb3duVGVlVmVjdG9yOiAnXHUyOTVEJywNCiAgICBSaWdodERvd25WZWN0b3I6ICdcdTIxQzInLA0KICAgIFJpZ2h0RG93blZlY3RvckJhcjogJ1x1Mjk1NScsDQogICAgUmlnaHRGbG9vcjogJ1x1MjMwQicsDQogICAgUmlnaHRUZWU6ICdcdTIyQTInLA0KICAgIFJpZ2h0VGVlQXJyb3c6ICdcdTIxQTYnLA0KICAgIFJpZ2h0VGVlVmVjdG9yOiAnXHUyOTVCJywNCiAgICBSaWdodFRyaWFuZ2xlOiAnXHUyMkIzJywNCiAgICBSaWdodFRyaWFuZ2xlQmFyOiAnXHUyOUQwJywNCiAgICBSaWdodFRyaWFuZ2xlRXF1YWw6ICdcdTIyQjUnLA0KICAgIFJpZ2h0VXBEb3duVmVjdG9yOiAnXHUyOTRGJywNCiAgICBSaWdodFVwVGVlVmVjdG9yOiAnXHUyOTVDJywNCiAgICBSaWdodFVwVmVjdG9yOiAnXHUyMUJFJywNCiAgICBSaWdodFVwVmVjdG9yQmFyOiAnXHUyOTU0JywNCiAgICBSaWdodFZlY3RvcjogJ1x1MjFDMCcsDQogICAgUmlnaHRWZWN0b3JCYXI6ICdcdTI5NTMnLA0KICAgIFJpZ2h0YXJyb3c6ICdcdTIxRDInLA0KICAgIFJvcGY6ICdcdTIxMUQnLA0KICAgIFJvdW5kSW1wbGllczogJ1x1Mjk3MCcsDQogICAgUnJpZ2h0YXJyb3c6ICdcdTIxREInLA0KICAgIFJzY3I6ICdcdTIxMUInLA0KICAgIFJzaDogJ1x1MjFCMScsDQogICAgUnVsZURlbGF5ZWQ6ICdcdTI5RjQnLA0KICAgIFNIQ0hjeTogJ1x1MDQyOScsDQogICAgU0hjeTogJ1x1MDQyOCcsDQogICAgU09GVGN5OiAnXHUwNDJDJywNCiAgICBTYWN1dGU6ICdcdTAxNUEnLA0KICAgIFNjOiAnXHUyQUJDJywNCiAgICBTY2Fyb246ICdcdTAxNjAnLA0KICAgIFNjZWRpbDogJ1x1MDE1RScsDQogICAgU2NpcmM6ICdcdTAxNUMnLA0KICAgIFNjeTogJ1x1MDQyMScsDQogICAgU2ZyOiAnXHVEODM1XHVERDE2JywNCiAgICBTaG9ydERvd25BcnJvdzogJ1x1MjE5MycsDQogICAgU2hvcnRMZWZ0QXJyb3c6ICdcdTIxOTAnLA0KICAgIFNob3J0UmlnaHRBcnJvdzogJ1x1MjE5MicsDQogICAgU2hvcnRVcEFycm93OiAnXHUyMTkxJywNCiAgICBTaWdtYTogJ1x1MDNBMycsDQogICAgU21hbGxDaXJjbGU6ICdcdTIyMTgnLA0KICAgIFNvcGY6ICdcdUQ4MzVcdURENEEnLA0KICAgIFNxcnQ6ICdcdTIyMUEnLA0KICAgIFNxdWFyZTogJ1x1MjVBMScsDQogICAgU3F1YXJlSW50ZXJzZWN0aW9uOiAnXHUyMjkzJywNCiAgICBTcXVhcmVTdWJzZXQ6ICdcdTIyOEYnLA0KICAgIFNxdWFyZVN1YnNldEVxdWFsOiAnXHUyMjkxJywNCiAgICBTcXVhcmVTdXBlcnNldDogJ1x1MjI5MCcsDQogICAgU3F1YXJlU3VwZXJzZXRFcXVhbDogJ1x1MjI5MicsDQogICAgU3F1YXJlVW5pb246ICdcdTIyOTQnLA0KICAgIFNzY3I6ICdcdUQ4MzVcdURDQUUnLA0KICAgIFN0YXI6ICdcdTIyQzYnLA0KICAgIFN1YjogJ1x1MjJEMCcsDQogICAgU3Vic2V0OiAnXHUyMkQwJywNCiAgICBTdWJzZXRFcXVhbDogJ1x1MjI4NicsDQogICAgU3VjY2VlZHM6ICdcdTIyN0InLA0KICAgIFN1Y2NlZWRzRXF1YWw6ICdcdTJBQjAnLA0KICAgIFN1Y2NlZWRzU2xhbnRFcXVhbDogJ1x1MjI3RCcsDQogICAgU3VjY2VlZHNUaWxkZTogJ1x1MjI3RicsDQogICAgU3VjaFRoYXQ6ICdcdTIyMEInLA0KICAgIFN1bTogJ1x1MjIxMScsDQogICAgU3VwOiAnXHUyMkQxJywNCiAgICBTdXBlcnNldDogJ1x1MjI4MycsDQogICAgU3VwZXJzZXRFcXVhbDogJ1x1MjI4NycsDQogICAgU3Vwc2V0OiAnXHUyMkQxJywNCiAgICBUSE9STjogJ1x1MDBERScsDQogICAgVFJBREU6ICdcdTIxMjInLA0KICAgIFRTSGN5OiAnXHUwNDBCJywNCiAgICBUU2N5OiAnXHUwNDI2JywNCiAgICBUYWI6ICdcdTAwMDknLA0KICAgIFRhdTogJ1x1MDNBNCcsDQogICAgVGNhcm9uOiAnXHUwMTY0JywNCiAgICBUY2VkaWw6ICdcdTAxNjInLA0KICAgIFRjeTogJ1x1MDQyMicsDQogICAgVGZyOiAnXHVEODM1XHVERDE3JywNCiAgICBUaGVyZWZvcmU6ICdcdTIyMzQnLA0KICAgIFRoZXRhOiAnXHUwMzk4JywNCiAgICBUaGlja1NwYWNlOiAnXHUyMDVGXHUyMDBBJywNCiAgICBUaGluU3BhY2U6ICdcdTIwMDknLA0KICAgIFRpbGRlOiAnXHUyMjNDJywNCiAgICBUaWxkZUVxdWFsOiAnXHUyMjQzJywNCiAgICBUaWxkZUZ1bGxFcXVhbDogJ1x1MjI0NScsDQogICAgVGlsZGVUaWxkZTogJ1x1MjI0OCcsDQogICAgVG9wZjogJ1x1RDgzNVx1REQ0QicsDQogICAgVHJpcGxlRG90OiAnXHUyMERCJywNCiAgICBUc2NyOiAnXHVEODM1XHVEQ0FGJywNCiAgICBUc3Ryb2s6ICdcdTAxNjYnLA0KICAgIFVhY3V0ZTogJ1x1MDBEQScsDQogICAgVWFycjogJ1x1MjE5RicsDQogICAgVWFycm9jaXI6ICdcdTI5NDknLA0KICAgIFVicmN5OiAnXHUwNDBFJywNCiAgICBVYnJldmU6ICdcdTAxNkMnLA0KICAgIFVjaXJjOiAnXHUwMERCJywNCiAgICBVY3k6ICdcdTA0MjMnLA0KICAgIFVkYmxhYzogJ1x1MDE3MCcsDQogICAgVWZyOiAnXHVEODM1XHVERDE4JywNCiAgICBVZ3JhdmU6ICdcdTAwRDknLA0KICAgIFVtYWNyOiAnXHUwMTZBJywNCiAgICBVbmRlckJhcjogJ1x1MDA1RicsDQogICAgVW5kZXJCcmFjZTogJ1x1MjNERicsDQogICAgVW5kZXJCcmFja2V0OiAnXHUyM0I1JywNCiAgICBVbmRlclBhcmVudGhlc2lzOiAnXHUyM0REJywNCiAgICBVbmlvbjogJ1x1MjJDMycsDQogICAgVW5pb25QbHVzOiAnXHUyMjhFJywNCiAgICBVb2dvbjogJ1x1MDE3MicsDQogICAgVW9wZjogJ1x1RDgzNVx1REQ0QycsDQogICAgVXBBcnJvdzogJ1x1MjE5MScsDQogICAgVXBBcnJvd0JhcjogJ1x1MjkxMicsDQogICAgVXBBcnJvd0Rvd25BcnJvdzogJ1x1MjFDNScsDQogICAgVXBEb3duQXJyb3c6ICdcdTIxOTUnLA0KICAgIFVwRXF1aWxpYnJpdW06ICdcdTI5NkUnLA0KICAgIFVwVGVlOiAnXHUyMkE1JywNCiAgICBVcFRlZUFycm93OiAnXHUyMUE1JywNCiAgICBVcGFycm93OiAnXHUyMUQxJywNCiAgICBVcGRvd25hcnJvdzogJ1x1MjFENScsDQogICAgVXBwZXJMZWZ0QXJyb3c6ICdcdTIxOTYnLA0KICAgIFVwcGVyUmlnaHRBcnJvdzogJ1x1MjE5NycsDQogICAgVXBzaTogJ1x1MDNEMicsDQogICAgVXBzaWxvbjogJ1x1MDNBNScsDQogICAgVXJpbmc6ICdcdTAxNkUnLA0KICAgIFVzY3I6ICdcdUQ4MzVcdURDQjAnLA0KICAgIFV0aWxkZTogJ1x1MDE2OCcsDQogICAgVXVtbDogJ1x1MDBEQycsDQogICAgVkRhc2g6ICdcdTIyQUInLA0KICAgIFZiYXI6ICdcdTJBRUInLA0KICAgIFZjeTogJ1x1MDQxMicsDQogICAgVmRhc2g6ICdcdTIyQTknLA0KICAgIFZkYXNobDogJ1x1MkFFNicsDQogICAgVmVlOiAnXHUyMkMxJywNCiAgICBWZXJiYXI6ICdcdTIwMTYnLA0KICAgIFZlcnQ6ICdcdTIwMTYnLA0KICAgIFZlcnRpY2FsQmFyOiAnXHUyMjIzJywNCiAgICBWZXJ0aWNhbExpbmU6ICdcdTAwN0MnLA0KICAgIFZlcnRpY2FsU2VwYXJhdG9yOiAnXHUyNzU4JywNCiAgICBWZXJ0aWNhbFRpbGRlOiAnXHUyMjQwJywNCiAgICBWZXJ5VGhpblNwYWNlOiAnXHUyMDBBJywNCiAgICBWZnI6ICdcdUQ4MzVcdUREMTknLA0KICAgIFZvcGY6ICdcdUQ4MzVcdURENEQnLA0KICAgIFZzY3I6ICdcdUQ4MzVcdURDQjEnLA0KICAgIFZ2ZGFzaDogJ1x1MjJBQScsDQogICAgV2NpcmM6ICdcdTAxNzQnLA0KICAgIFdlZGdlOiAnXHUyMkMwJywNCiAgICBXZnI6ICdcdUQ4MzVcdUREMUEnLA0KICAgIFdvcGY6ICdcdUQ4MzVcdURENEUnLA0KICAgIFdzY3I6ICdcdUQ4MzVcdURDQjInLA0KICAgIFhmcjogJ1x1RDgzNVx1REQxQicsDQogICAgWGk6ICdcdTAzOUUnLA0KICAgIFhvcGY6ICdcdUQ4MzVcdURENEYnLA0KICAgIFhzY3I6ICdcdUQ4MzVcdURDQjMnLA0KICAgIFlBY3k6ICdcdTA0MkYnLA0KICAgIFlJY3k6ICdcdTA0MDcnLA0KICAgIFlVY3k6ICdcdTA0MkUnLA0KICAgIFlhY3V0ZTogJ1x1MDBERCcsDQogICAgWWNpcmM6ICdcdTAxNzYnLA0KICAgIFljeTogJ1x1MDQyQicsDQogICAgWWZyOiAnXHVEODM1XHVERDFDJywNCiAgICBZb3BmOiAnXHVEODM1XHVERDUwJywNCiAgICBZc2NyOiAnXHVEODM1XHVEQ0I0JywNCiAgICBZdW1sOiAnXHUwMTc4JywNCiAgICBaSGN5OiAnXHUwNDE2JywNCiAgICBaYWN1dGU6ICdcdTAxNzknLA0KICAgIFpjYXJvbjogJ1x1MDE3RCcsDQogICAgWmN5OiAnXHUwNDE3JywNCiAgICBaZG90OiAnXHUwMTdCJywNCiAgICBaZXJvV2lkdGhTcGFjZTogJ1x1MjAwQicsDQogICAgWmV0YTogJ1x1MDM5NicsDQogICAgWmZyOiAnXHUyMTI4JywNCiAgICBab3BmOiAnXHUyMTI0JywNCiAgICBac2NyOiAnXHVEODM1XHVEQ0I1JywNCiAgICBhYWN1dGU6ICdcdTAwRTEnLA0KICAgIGFicmV2ZTogJ1x1MDEwMycsDQogICAgYWM6ICdcdTIyM0UnLA0KICAgIGFjRTogJ1x1MjIzRVx1MDMzMycsDQogICAgYWNkOiAnXHUyMjNGJywNCiAgICBhY2lyYzogJ1x1MDBFMicsDQogICAgYWN1dGU6ICdcdTAwQjQnLA0KICAgIGFjeTogJ1x1MDQzMCcsDQogICAgYWVsaWc6ICdcdTAwRTYnLA0KICAgIGFmOiAnXHUyMDYxJywNCiAgICBhZnI6ICdcdUQ4MzVcdUREMUUnLA0KICAgIGFncmF2ZTogJ1x1MDBFMCcsDQogICAgYWxlZnN5bTogJ1x1MjEzNScsDQogICAgYWxlcGg6ICdcdTIxMzUnLA0KICAgIGFscGhhOiAnXHUwM0IxJywNCiAgICBhbWFjcjogJ1x1MDEwMScsDQogICAgYW1hbGc6ICdcdTJBM0YnLA0KICAgIGFtcDogJ1x1MDAyNicsDQogICAgYW5kOiAnXHUyMjI3JywNCiAgICBhbmRhbmQ6ICdcdTJBNTUnLA0KICAgIGFuZGQ6ICdcdTJBNUMnLA0KICAgIGFuZHNsb3BlOiAnXHUyQTU4JywNCiAgICBhbmR2OiAnXHUyQTVBJywNCiAgICBhbmc6ICdcdTIyMjAnLA0KICAgIGFuZ2U6ICdcdTI5QTQnLA0KICAgIGFuZ2xlOiAnXHUyMjIwJywNCiAgICBhbmdtc2Q6ICdcdTIyMjEnLA0KICAgIGFuZ21zZGFhOiAnXHUyOUE4JywNCiAgICBhbmdtc2RhYjogJ1x1MjlBOScsDQogICAgYW5nbXNkYWM6ICdcdTI5QUEnLA0KICAgIGFuZ21zZGFkOiAnXHUyOUFCJywNCiAgICBhbmdtc2RhZTogJ1x1MjlBQycsDQogICAgYW5nbXNkYWY6ICdcdTI5QUQnLA0KICAgIGFuZ21zZGFnOiAnXHUyOUFFJywNCiAgICBhbmdtc2RhaDogJ1x1MjlBRicsDQogICAgYW5ncnQ6ICdcdTIyMUYnLA0KICAgIGFuZ3J0dmI6ICdcdTIyQkUnLA0KICAgIGFuZ3J0dmJkOiAnXHUyOTlEJywNCiAgICBhbmdzcGg6ICdcdTIyMjInLA0KICAgIGFuZ3N0OiAnXHUwMEM1JywNCiAgICBhbmd6YXJyOiAnXHUyMzdDJywNCiAgICBhb2dvbjogJ1x1MDEwNScsDQogICAgYW9wZjogJ1x1RDgzNVx1REQ1MicsDQogICAgYXA6ICdcdTIyNDgnLA0KICAgIGFwRTogJ1x1MkE3MCcsDQogICAgYXBhY2lyOiAnXHUyQTZGJywNCiAgICBhcGU6ICdcdTIyNEEnLA0KICAgIGFwaWQ6ICdcdTIyNEInLA0KICAgIGFwb3M6ICdcdTAwMjcnLA0KICAgIGFwcHJveDogJ1x1MjI0OCcsDQogICAgYXBwcm94ZXE6ICdcdTIyNEEnLA0KICAgIGFyaW5nOiAnXHUwMEU1JywNCiAgICBhc2NyOiAnXHVEODM1XHVEQ0I2JywNCiAgICBhc3Q6ICdcdTAwMkEnLA0KICAgIGFzeW1wOiAnXHUyMjQ4JywNCiAgICBhc3ltcGVxOiAnXHUyMjREJywNCiAgICBhdGlsZGU6ICdcdTAwRTMnLA0KICAgIGF1bWw6ICdcdTAwRTQnLA0KICAgIGF3Y29uaW50OiAnXHUyMjMzJywNCiAgICBhd2ludDogJ1x1MkExMScsDQogICAgYk5vdDogJ1x1MkFFRCcsDQogICAgYmFja2Nvbmc6ICdcdTIyNEMnLA0KICAgIGJhY2tlcHNpbG9uOiAnXHUwM0Y2JywNCiAgICBiYWNrcHJpbWU6ICdcdTIwMzUnLA0KICAgIGJhY2tzaW06ICdcdTIyM0QnLA0KICAgIGJhY2tzaW1lcTogJ1x1MjJDRCcsDQogICAgYmFydmVlOiAnXHUyMkJEJywNCiAgICBiYXJ3ZWQ6ICdcdTIzMDUnLA0KICAgIGJhcndlZGdlOiAnXHUyMzA1JywNCiAgICBiYnJrOiAnXHUyM0I1JywNCiAgICBiYnJrdGJyazogJ1x1MjNCNicsDQogICAgYmNvbmc6ICdcdTIyNEMnLA0KICAgIGJjeTogJ1x1MDQzMScsDQogICAgYmRxdW86ICdcdTIwMUUnLA0KICAgIGJlY2F1czogJ1x1MjIzNScsDQogICAgYmVjYXVzZTogJ1x1MjIzNScsDQogICAgYmVtcHR5djogJ1x1MjlCMCcsDQogICAgYmVwc2k6ICdcdTAzRjYnLA0KICAgIGJlcm5vdTogJ1x1MjEyQycsDQogICAgYmV0YTogJ1x1MDNCMicsDQogICAgYmV0aDogJ1x1MjEzNicsDQogICAgYmV0d2VlbjogJ1x1MjI2QycsDQogICAgYmZyOiAnXHVEODM1XHVERDFGJywNCiAgICBiaWdjYXA6ICdcdTIyQzInLA0KICAgIGJpZ2NpcmM6ICdcdTI1RUYnLA0KICAgIGJpZ2N1cDogJ1x1MjJDMycsDQogICAgYmlnb2RvdDogJ1x1MkEwMCcsDQogICAgYmlnb3BsdXM6ICdcdTJBMDEnLA0KICAgIGJpZ290aW1lczogJ1x1MkEwMicsDQogICAgYmlnc3FjdXA6ICdcdTJBMDYnLA0KICAgIGJpZ3N0YXI6ICdcdTI2MDUnLA0KICAgIGJpZ3RyaWFuZ2xlZG93bjogJ1x1MjVCRCcsDQogICAgYmlndHJpYW5nbGV1cDogJ1x1MjVCMycsDQogICAgYmlndXBsdXM6ICdcdTJBMDQnLA0KICAgIGJpZ3ZlZTogJ1x1MjJDMScsDQogICAgYmlnd2VkZ2U6ICdcdTIyQzAnLA0KICAgIGJrYXJvdzogJ1x1MjkwRCcsDQogICAgYmxhY2tsb3plbmdlOiAnXHUyOUVCJywNCiAgICBibGFja3NxdWFyZTogJ1x1MjVBQScsDQogICAgYmxhY2t0cmlhbmdsZTogJ1x1MjVCNCcsDQogICAgYmxhY2t0cmlhbmdsZWRvd246ICdcdTI1QkUnLA0KICAgIGJsYWNrdHJpYW5nbGVsZWZ0OiAnXHUyNUMyJywNCiAgICBibGFja3RyaWFuZ2xlcmlnaHQ6ICdcdTI1QjgnLA0KICAgIGJsYW5rOiAnXHUyNDIzJywNCiAgICBibGsxMjogJ1x1MjU5MicsDQogICAgYmxrMTQ6ICdcdTI1OTEnLA0KICAgIGJsazM0OiAnXHUyNTkzJywNCiAgICBibG9jazogJ1x1MjU4OCcsDQogICAgYm5lOiAnXHUwMDNEXHUyMEU1JywNCiAgICBibmVxdWl2OiAnXHUyMjYxXHUyMEU1JywNCiAgICBibm90OiAnXHUyMzEwJywNCiAgICBib3BmOiAnXHVEODM1XHVERDUzJywNCiAgICBib3Q6ICdcdTIyQTUnLA0KICAgIGJvdHRvbTogJ1x1MjJBNScsDQogICAgYm93dGllOiAnXHUyMkM4JywNCiAgICBib3hETDogJ1x1MjU1NycsDQogICAgYm94RFI6ICdcdTI1NTQnLA0KICAgIGJveERsOiAnXHUyNTU2JywNCiAgICBib3hEcjogJ1x1MjU1MycsDQogICAgYm94SDogJ1x1MjU1MCcsDQogICAgYm94SEQ6ICdcdTI1NjYnLA0KICAgIGJveEhVOiAnXHUyNTY5JywNCiAgICBib3hIZDogJ1x1MjU2NCcsDQogICAgYm94SHU6ICdcdTI1NjcnLA0KICAgIGJveFVMOiAnXHUyNTVEJywNCiAgICBib3hVUjogJ1x1MjU1QScsDQogICAgYm94VWw6ICdcdTI1NUMnLA0KICAgIGJveFVyOiAnXHUyNTU5JywNCiAgICBib3hWOiAnXHUyNTUxJywNCiAgICBib3hWSDogJ1x1MjU2QycsDQogICAgYm94Vkw6ICdcdTI1NjMnLA0KICAgIGJveFZSOiAnXHUyNTYwJywNCiAgICBib3hWaDogJ1x1MjU2QicsDQogICAgYm94Vmw6ICdcdTI1NjInLA0KICAgIGJveFZyOiAnXHUyNTVGJywNCiAgICBib3hib3g6ICdcdTI5QzknLA0KICAgIGJveGRMOiAnXHUyNTU1JywNCiAgICBib3hkUjogJ1x1MjU1MicsDQogICAgYm94ZGw6ICdcdTI1MTAnLA0KICAgIGJveGRyOiAnXHUyNTBDJywNCiAgICBib3hoOiAnXHUyNTAwJywNCiAgICBib3hoRDogJ1x1MjU2NScsDQogICAgYm94aFU6ICdcdTI1NjgnLA0KICAgIGJveGhkOiAnXHUyNTJDJywNCiAgICBib3hodTogJ1x1MjUzNCcsDQogICAgYm94bWludXM6ICdcdTIyOUYnLA0KICAgIGJveHBsdXM6ICdcdTIyOUUnLA0KICAgIGJveHRpbWVzOiAnXHUyMkEwJywNCiAgICBib3h1TDogJ1x1MjU1QicsDQogICAgYm94dVI6ICdcdTI1NTgnLA0KICAgIGJveHVsOiAnXHUyNTE4JywNCiAgICBib3h1cjogJ1x1MjUxNCcsDQogICAgYm94djogJ1x1MjUwMicsDQogICAgYm94dkg6ICdcdTI1NkEnLA0KICAgIGJveHZMOiAnXHUyNTYxJywNCiAgICBib3h2UjogJ1x1MjU1RScsDQogICAgYm94dmg6ICdcdTI1M0MnLA0KICAgIGJveHZsOiAnXHUyNTI0JywNCiAgICBib3h2cjogJ1x1MjUxQycsDQogICAgYnByaW1lOiAnXHUyMDM1JywNCiAgICBicmV2ZTogJ1x1MDJEOCcsDQogICAgYnJ2YmFyOiAnXHUwMEE2JywNCiAgICBic2NyOiAnXHVEODM1XHVEQ0I3JywNCiAgICBic2VtaTogJ1x1MjA0RicsDQogICAgYnNpbTogJ1x1MjIzRCcsDQogICAgYnNpbWU6ICdcdTIyQ0QnLA0KICAgIGJzb2w6ICdcdTAwNUMnLA0KICAgIGJzb2xiOiAnXHUyOUM1JywNCiAgICBic29saHN1YjogJ1x1MjdDOCcsDQogICAgYnVsbDogJ1x1MjAyMicsDQogICAgYnVsbGV0OiAnXHUyMDIyJywNCiAgICBidW1wOiAnXHUyMjRFJywNCiAgICBidW1wRTogJ1x1MkFBRScsDQogICAgYnVtcGU6ICdcdTIyNEYnLA0KICAgIGJ1bXBlcTogJ1x1MjI0RicsDQogICAgY2FjdXRlOiAnXHUwMTA3JywNCiAgICBjYXA6ICdcdTIyMjknLA0KICAgIGNhcGFuZDogJ1x1MkE0NCcsDQogICAgY2FwYnJjdXA6ICdcdTJBNDknLA0KICAgIGNhcGNhcDogJ1x1MkE0QicsDQogICAgY2FwY3VwOiAnXHUyQTQ3JywNCiAgICBjYXBkb3Q6ICdcdTJBNDAnLA0KICAgIGNhcHM6ICdcdTIyMjlcdUZFMDAnLA0KICAgIGNhcmV0OiAnXHUyMDQxJywNCiAgICBjYXJvbjogJ1x1MDJDNycsDQogICAgY2NhcHM6ICdcdTJBNEQnLA0KICAgIGNjYXJvbjogJ1x1MDEwRCcsDQogICAgY2NlZGlsOiAnXHUwMEU3JywNCiAgICBjY2lyYzogJ1x1MDEwOScsDQogICAgY2N1cHM6ICdcdTJBNEMnLA0KICAgIGNjdXBzc206ICdcdTJBNTAnLA0KICAgIGNkb3Q6ICdcdTAxMEInLA0KICAgIGNlZGlsOiAnXHUwMEI4JywNCiAgICBjZW1wdHl2OiAnXHUyOUIyJywNCiAgICBjZW50OiAnXHUwMEEyJywNCiAgICBjZW50ZXJkb3Q6ICdcdTAwQjcnLA0KICAgIGNmcjogJ1x1RDgzNVx1REQyMCcsDQogICAgY2hjeTogJ1x1MDQ0NycsDQogICAgY2hlY2s6ICdcdTI3MTMnLA0KICAgIGNoZWNrbWFyazogJ1x1MjcxMycsDQogICAgY2hpOiAnXHUwM0M3JywNCiAgICBjaXI6ICdcdTI1Q0InLA0KICAgIGNpckU6ICdcdTI5QzMnLA0KICAgIGNpcmM6ICdcdTAyQzYnLA0KICAgIGNpcmNlcTogJ1x1MjI1NycsDQogICAgY2lyY2xlYXJyb3dsZWZ0OiAnXHUyMUJBJywNCiAgICBjaXJjbGVhcnJvd3JpZ2h0OiAnXHUyMUJCJywNCiAgICBjaXJjbGVkUjogJ1x1MDBBRScsDQogICAgY2lyY2xlZFM6ICdcdTI0QzgnLA0KICAgIGNpcmNsZWRhc3Q6ICdcdTIyOUInLA0KICAgIGNpcmNsZWRjaXJjOiAnXHUyMjlBJywNCiAgICBjaXJjbGVkZGFzaDogJ1x1MjI5RCcsDQogICAgY2lyZTogJ1x1MjI1NycsDQogICAgY2lyZm5pbnQ6ICdcdTJBMTAnLA0KICAgIGNpcm1pZDogJ1x1MkFFRicsDQogICAgY2lyc2NpcjogJ1x1MjlDMicsDQogICAgY2x1YnM6ICdcdTI2NjMnLA0KICAgIGNsdWJzdWl0OiAnXHUyNjYzJywNCiAgICBjb2xvbjogJ1x1MDAzQScsDQogICAgY29sb25lOiAnXHUyMjU0JywNCiAgICBjb2xvbmVxOiAnXHUyMjU0JywNCiAgICBjb21tYTogJ1x1MDAyQycsDQogICAgY29tbWF0OiAnXHUwMDQwJywNCiAgICBjb21wOiAnXHUyMjAxJywNCiAgICBjb21wZm46ICdcdTIyMTgnLA0KICAgIGNvbXBsZW1lbnQ6ICdcdTIyMDEnLA0KICAgIGNvbXBsZXhlczogJ1x1MjEwMicsDQogICAgY29uZzogJ1x1MjI0NScsDQogICAgY29uZ2RvdDogJ1x1MkE2RCcsDQogICAgY29uaW50OiAnXHUyMjJFJywNCiAgICBjb3BmOiAnXHVEODM1XHVERDU0JywNCiAgICBjb3Byb2Q6ICdcdTIyMTAnLA0KICAgIGNvcHk6ICdcdTAwQTknLA0KICAgIGNvcHlzcjogJ1x1MjExNycsDQogICAgY3JhcnI6ICdcdTIxQjUnLA0KICAgIGNyb3NzOiAnXHUyNzE3JywNCiAgICBjc2NyOiAnXHVEODM1XHVEQ0I4JywNCiAgICBjc3ViOiAnXHUyQUNGJywNCiAgICBjc3ViZTogJ1x1MkFEMScsDQogICAgY3N1cDogJ1x1MkFEMCcsDQogICAgY3N1cGU6ICdcdTJBRDInLA0KICAgIGN0ZG90OiAnXHUyMkVGJywNCiAgICBjdWRhcnJsOiAnXHUyOTM4JywNCiAgICBjdWRhcnJyOiAnXHUyOTM1JywNCiAgICBjdWVwcjogJ1x1MjJERScsDQogICAgY3Vlc2M6ICdcdTIyREYnLA0KICAgIGN1bGFycjogJ1x1MjFCNicsDQogICAgY3VsYXJycDogJ1x1MjkzRCcsDQogICAgY3VwOiAnXHUyMjJBJywNCiAgICBjdXBicmNhcDogJ1x1MkE0OCcsDQogICAgY3VwY2FwOiAnXHUyQTQ2JywNCiAgICBjdXBjdXA6ICdcdTJBNEEnLA0KICAgIGN1cGRvdDogJ1x1MjI4RCcsDQogICAgY3Vwb3I6ICdcdTJBNDUnLA0KICAgIGN1cHM6ICdcdTIyMkFcdUZFMDAnLA0KICAgIGN1cmFycjogJ1x1MjFCNycsDQogICAgY3VyYXJybTogJ1x1MjkzQycsDQogICAgY3VybHllcXByZWM6ICdcdTIyREUnLA0KICAgIGN1cmx5ZXFzdWNjOiAnXHUyMkRGJywNCiAgICBjdXJseXZlZTogJ1x1MjJDRScsDQogICAgY3VybHl3ZWRnZTogJ1x1MjJDRicsDQogICAgY3VycmVuOiAnXHUwMEE0JywNCiAgICBjdXJ2ZWFycm93bGVmdDogJ1x1MjFCNicsDQogICAgY3VydmVhcnJvd3JpZ2h0OiAnXHUyMUI3JywNCiAgICBjdXZlZTogJ1x1MjJDRScsDQogICAgY3V3ZWQ6ICdcdTIyQ0YnLA0KICAgIGN3Y29uaW50OiAnXHUyMjMyJywNCiAgICBjd2ludDogJ1x1MjIzMScsDQogICAgY3lsY3R5OiAnXHUyMzJEJywNCiAgICBkQXJyOiAnXHUyMUQzJywNCiAgICBkSGFyOiAnXHUyOTY1JywNCiAgICBkYWdnZXI6ICdcdTIwMjAnLA0KICAgIGRhbGV0aDogJ1x1MjEzOCcsDQogICAgZGFycjogJ1x1MjE5MycsDQogICAgZGFzaDogJ1x1MjAxMCcsDQogICAgZGFzaHY6ICdcdTIyQTMnLA0KICAgIGRia2Fyb3c6ICdcdTI5MEYnLA0KICAgIGRibGFjOiAnXHUwMkREJywNCiAgICBkY2Fyb246ICdcdTAxMEYnLA0KICAgIGRjeTogJ1x1MDQzNCcsDQogICAgZGQ6ICdcdTIxNDYnLA0KICAgIGRkYWdnZXI6ICdcdTIwMjEnLA0KICAgIGRkYXJyOiAnXHUyMUNBJywNCiAgICBkZG90c2VxOiAnXHUyQTc3JywNCiAgICBkZWc6ICdcdTAwQjAnLA0KICAgIGRlbHRhOiAnXHUwM0I0JywNCiAgICBkZW1wdHl2OiAnXHUyOUIxJywNCiAgICBkZmlzaHQ6ICdcdTI5N0YnLA0KICAgIGRmcjogJ1x1RDgzNVx1REQyMScsDQogICAgZGhhcmw6ICdcdTIxQzMnLA0KICAgIGRoYXJyOiAnXHUyMUMyJywNCiAgICBkaWFtOiAnXHUyMkM0JywNCiAgICBkaWFtb25kOiAnXHUyMkM0JywNCiAgICBkaWFtb25kc3VpdDogJ1x1MjY2NicsDQogICAgZGlhbXM6ICdcdTI2NjYnLA0KICAgIGRpZTogJ1x1MDBBOCcsDQogICAgZGlnYW1tYTogJ1x1MDNERCcsDQogICAgZGlzaW46ICdcdTIyRjInLA0KICAgIGRpdjogJ1x1MDBGNycsDQogICAgZGl2aWRlOiAnXHUwMEY3JywNCiAgICBkaXZpZGVvbnRpbWVzOiAnXHUyMkM3JywNCiAgICBkaXZvbng6ICdcdTIyQzcnLA0KICAgIGRqY3k6ICdcdTA0NTInLA0KICAgIGRsY29ybjogJ1x1MjMxRScsDQogICAgZGxjcm9wOiAnXHUyMzBEJywNCiAgICBkb2xsYXI6ICdcdTAwMjQnLA0KICAgIGRvcGY6ICdcdUQ4MzVcdURENTUnLA0KICAgIGRvdDogJ1x1MDJEOScsDQogICAgZG90ZXE6ICdcdTIyNTAnLA0KICAgIGRvdGVxZG90OiAnXHUyMjUxJywNCiAgICBkb3RtaW51czogJ1x1MjIzOCcsDQogICAgZG90cGx1czogJ1x1MjIxNCcsDQogICAgZG90c3F1YXJlOiAnXHUyMkExJywNCiAgICBkb3VibGViYXJ3ZWRnZTogJ1x1MjMwNicsDQogICAgZG93bmFycm93OiAnXHUyMTkzJywNCiAgICBkb3duZG93bmFycm93czogJ1x1MjFDQScsDQogICAgZG93bmhhcnBvb25sZWZ0OiAnXHUyMUMzJywNCiAgICBkb3duaGFycG9vbnJpZ2h0OiAnXHUyMUMyJywNCiAgICBkcmJrYXJvdzogJ1x1MjkxMCcsDQogICAgZHJjb3JuOiAnXHUyMzFGJywNCiAgICBkcmNyb3A6ICdcdTIzMEMnLA0KICAgIGRzY3I6ICdcdUQ4MzVcdURDQjknLA0KICAgIGRzY3k6ICdcdTA0NTUnLA0KICAgIGRzb2w6ICdcdTI5RjYnLA0KICAgIGRzdHJvazogJ1x1MDExMScsDQogICAgZHRkb3Q6ICdcdTIyRjEnLA0KICAgIGR0cmk6ICdcdTI1QkYnLA0KICAgIGR0cmlmOiAnXHUyNUJFJywNCiAgICBkdWFycjogJ1x1MjFGNScsDQogICAgZHVoYXI6ICdcdTI5NkYnLA0KICAgIGR3YW5nbGU6ICdcdTI5QTYnLA0KICAgIGR6Y3k6ICdcdTA0NUYnLA0KICAgIGR6aWdyYXJyOiAnXHUyN0ZGJywNCiAgICBlRERvdDogJ1x1MkE3NycsDQogICAgZURvdDogJ1x1MjI1MScsDQogICAgZWFjdXRlOiAnXHUwMEU5JywNCiAgICBlYXN0ZXI6ICdcdTJBNkUnLA0KICAgIGVjYXJvbjogJ1x1MDExQicsDQogICAgZWNpcjogJ1x1MjI1NicsDQogICAgZWNpcmM6ICdcdTAwRUEnLA0KICAgIGVjb2xvbjogJ1x1MjI1NScsDQogICAgZWN5OiAnXHUwNDREJywNCiAgICBlZG90OiAnXHUwMTE3JywNCiAgICBlZTogJ1x1MjE0NycsDQogICAgZWZEb3Q6ICdcdTIyNTInLA0KICAgIGVmcjogJ1x1RDgzNVx1REQyMicsDQogICAgZWc6ICdcdTJBOUEnLA0KICAgIGVncmF2ZTogJ1x1MDBFOCcsDQogICAgZWdzOiAnXHUyQTk2JywNCiAgICBlZ3Nkb3Q6ICdcdTJBOTgnLA0KICAgIGVsOiAnXHUyQTk5JywNCiAgICBlbGludGVyczogJ1x1MjNFNycsDQogICAgZWxsOiAnXHUyMTEzJywNCiAgICBlbHM6ICdcdTJBOTUnLA0KICAgIGVsc2RvdDogJ1x1MkE5NycsDQogICAgZW1hY3I6ICdcdTAxMTMnLA0KICAgIGVtcHR5OiAnXHUyMjA1JywNCiAgICBlbXB0eXNldDogJ1x1MjIwNScsDQogICAgZW1wdHl2OiAnXHUyMjA1JywNCiAgICBlbXNwMTM6ICdcdTIwMDQnLA0KICAgIGVtc3AxNDogJ1x1MjAwNScsDQogICAgZW1zcDogJ1x1MjAwMycsDQogICAgZW5nOiAnXHUwMTRCJywNCiAgICBlbnNwOiAnXHUyMDAyJywNCiAgICBlb2dvbjogJ1x1MDExOScsDQogICAgZW9wZjogJ1x1RDgzNVx1REQ1NicsDQogICAgZXBhcjogJ1x1MjJENScsDQogICAgZXBhcnNsOiAnXHUyOUUzJywNCiAgICBlcGx1czogJ1x1MkE3MScsDQogICAgZXBzaTogJ1x1MDNCNScsDQogICAgZXBzaWxvbjogJ1x1MDNCNScsDQogICAgZXBzaXY6ICdcdTAzRjUnLA0KICAgIGVxY2lyYzogJ1x1MjI1NicsDQogICAgZXFjb2xvbjogJ1x1MjI1NScsDQogICAgZXFzaW06ICdcdTIyNDInLA0KICAgIGVxc2xhbnRndHI6ICdcdTJBOTYnLA0KICAgIGVxc2xhbnRsZXNzOiAnXHUyQTk1JywNCiAgICBlcXVhbHM6ICdcdTAwM0QnLA0KICAgIGVxdWVzdDogJ1x1MjI1RicsDQogICAgZXF1aXY6ICdcdTIyNjEnLA0KICAgIGVxdWl2REQ6ICdcdTJBNzgnLA0KICAgIGVxdnBhcnNsOiAnXHUyOUU1JywNCiAgICBlckRvdDogJ1x1MjI1MycsDQogICAgZXJhcnI6ICdcdTI5NzEnLA0KICAgIGVzY3I6ICdcdTIxMkYnLA0KICAgIGVzZG90OiAnXHUyMjUwJywNCiAgICBlc2ltOiAnXHUyMjQyJywNCiAgICBldGE6ICdcdTAzQjcnLA0KICAgIGV0aDogJ1x1MDBGMCcsDQogICAgZXVtbDogJ1x1MDBFQicsDQogICAgZXVybzogJ1x1MjBBQycsDQogICAgZXhjbDogJ1x1MDAyMScsDQogICAgZXhpc3Q6ICdcdTIyMDMnLA0KICAgIGV4cGVjdGF0aW9uOiAnXHUyMTMwJywNCiAgICBleHBvbmVudGlhbGU6ICdcdTIxNDcnLA0KICAgIGZhbGxpbmdkb3RzZXE6ICdcdTIyNTInLA0KICAgIGZjeTogJ1x1MDQ0NCcsDQogICAgZmVtYWxlOiAnXHUyNjQwJywNCiAgICBmZmlsaWc6ICdcdUZCMDMnLA0KICAgIGZmbGlnOiAnXHVGQjAwJywNCiAgICBmZmxsaWc6ICdcdUZCMDQnLA0KICAgIGZmcjogJ1x1RDgzNVx1REQyMycsDQogICAgZmlsaWc6ICdcdUZCMDEnLA0KICAgIGZqbGlnOiAnXHUwMDY2XHUwMDZBJywNCiAgICBmbGF0OiAnXHUyNjZEJywNCiAgICBmbGxpZzogJ1x1RkIwMicsDQogICAgZmx0bnM6ICdcdTI1QjEnLA0KICAgIGZub2Y6ICdcdTAxOTInLA0KICAgIGZvcGY6ICdcdUQ4MzVcdURENTcnLA0KICAgIGZvcmFsbDogJ1x1MjIwMCcsDQogICAgZm9yazogJ1x1MjJENCcsDQogICAgZm9ya3Y6ICdcdTJBRDknLA0KICAgIGZwYXJ0aW50OiAnXHUyQTBEJywNCiAgICBmcmFjMTI6ICdcdTAwQkQnLA0KICAgIGZyYWMxMzogJ1x1MjE1MycsDQogICAgZnJhYzE0OiAnXHUwMEJDJywNCiAgICBmcmFjMTU6ICdcdTIxNTUnLA0KICAgIGZyYWMxNjogJ1x1MjE1OScsDQogICAgZnJhYzE4OiAnXHUyMTVCJywNCiAgICBmcmFjMjM6ICdcdTIxNTQnLA0KICAgIGZyYWMyNTogJ1x1MjE1NicsDQogICAgZnJhYzM0OiAnXHUwMEJFJywNCiAgICBmcmFjMzU6ICdcdTIxNTcnLA0KICAgIGZyYWMzODogJ1x1MjE1QycsDQogICAgZnJhYzQ1OiAnXHUyMTU4JywNCiAgICBmcmFjNTY6ICdcdTIxNUEnLA0KICAgIGZyYWM1ODogJ1x1MjE1RCcsDQogICAgZnJhYzc4OiAnXHUyMTVFJywNCiAgICBmcmFzbDogJ1x1MjA0NCcsDQogICAgZnJvd246ICdcdTIzMjInLA0KICAgIGZzY3I6ICdcdUQ4MzVcdURDQkInLA0KICAgIGdFOiAnXHUyMjY3JywNCiAgICBnRWw6ICdcdTJBOEMnLA0KICAgIGdhY3V0ZTogJ1x1MDFGNScsDQogICAgZ2FtbWE6ICdcdTAzQjMnLA0KICAgIGdhbW1hZDogJ1x1MDNERCcsDQogICAgZ2FwOiAnXHUyQTg2JywNCiAgICBnYnJldmU6ICdcdTAxMUYnLA0KICAgIGdjaXJjOiAnXHUwMTFEJywNCiAgICBnY3k6ICdcdTA0MzMnLA0KICAgIGdkb3Q6ICdcdTAxMjEnLA0KICAgIGdlOiAnXHUyMjY1JywNCiAgICBnZWw6ICdcdTIyREInLA0KICAgIGdlcTogJ1x1MjI2NScsDQogICAgZ2VxcTogJ1x1MjI2NycsDQogICAgZ2Vxc2xhbnQ6ICdcdTJBN0UnLA0KICAgIGdlczogJ1x1MkE3RScsDQogICAgZ2VzY2M6ICdcdTJBQTknLA0KICAgIGdlc2RvdDogJ1x1MkE4MCcsDQogICAgZ2VzZG90bzogJ1x1MkE4MicsDQogICAgZ2VzZG90b2w6ICdcdTJBODQnLA0KICAgIGdlc2w6ICdcdTIyREJcdUZFMDAnLA0KICAgIGdlc2xlczogJ1x1MkE5NCcsDQogICAgZ2ZyOiAnXHVEODM1XHVERDI0JywNCiAgICBnZzogJ1x1MjI2QicsDQogICAgZ2dnOiAnXHUyMkQ5JywNCiAgICBnaW1lbDogJ1x1MjEzNycsDQogICAgZ2pjeTogJ1x1MDQ1MycsDQogICAgZ2w6ICdcdTIyNzcnLA0KICAgIGdsRTogJ1x1MkE5MicsDQogICAgZ2xhOiAnXHUyQUE1JywNCiAgICBnbGo6ICdcdTJBQTQnLA0KICAgIGduRTogJ1x1MjI2OScsDQogICAgZ25hcDogJ1x1MkE4QScsDQogICAgZ25hcHByb3g6ICdcdTJBOEEnLA0KICAgIGduZTogJ1x1MkE4OCcsDQogICAgZ25lcTogJ1x1MkE4OCcsDQogICAgZ25lcXE6ICdcdTIyNjknLA0KICAgIGduc2ltOiAnXHUyMkU3JywNCiAgICBnb3BmOiAnXHVEODM1XHVERDU4JywNCiAgICBncmF2ZTogJ1x1MDA2MCcsDQogICAgZ3NjcjogJ1x1MjEwQScsDQogICAgZ3NpbTogJ1x1MjI3MycsDQogICAgZ3NpbWU6ICdcdTJBOEUnLA0KICAgIGdzaW1sOiAnXHUyQTkwJywNCiAgICBndDogJ1x1MDAzRScsDQogICAgZ3RjYzogJ1x1MkFBNycsDQogICAgZ3RjaXI6ICdcdTJBN0EnLA0KICAgIGd0ZG90OiAnXHUyMkQ3JywNCiAgICBndGxQYXI6ICdcdTI5OTUnLA0KICAgIGd0cXVlc3Q6ICdcdTJBN0MnLA0KICAgIGd0cmFwcHJveDogJ1x1MkE4NicsDQogICAgZ3RyYXJyOiAnXHUyOTc4JywNCiAgICBndHJkb3Q6ICdcdTIyRDcnLA0KICAgIGd0cmVxbGVzczogJ1x1MjJEQicsDQogICAgZ3RyZXFxbGVzczogJ1x1MkE4QycsDQogICAgZ3RybGVzczogJ1x1MjI3NycsDQogICAgZ3Ryc2ltOiAnXHUyMjczJywNCiAgICBndmVydG5lcXE6ICdcdTIyNjlcdUZFMDAnLA0KICAgIGd2bkU6ICdcdTIyNjlcdUZFMDAnLA0KICAgIGhBcnI6ICdcdTIxRDQnLA0KICAgIGhhaXJzcDogJ1x1MjAwQScsDQogICAgaGFsZjogJ1x1MDBCRCcsDQogICAgaGFtaWx0OiAnXHUyMTBCJywNCiAgICBoYXJkY3k6ICdcdTA0NEEnLA0KICAgIGhhcnI6ICdcdTIxOTQnLA0KICAgIGhhcnJjaXI6ICdcdTI5NDgnLA0KICAgIGhhcnJ3OiAnXHUyMUFEJywNCiAgICBoYmFyOiAnXHUyMTBGJywNCiAgICBoY2lyYzogJ1x1MDEyNScsDQogICAgaGVhcnRzOiAnXHUyNjY1JywNCiAgICBoZWFydHN1aXQ6ICdcdTI2NjUnLA0KICAgIGhlbGxpcDogJ1x1MjAyNicsDQogICAgaGVyY29uOiAnXHUyMkI5JywNCiAgICBoZnI6ICdcdUQ4MzVcdUREMjUnLA0KICAgIGhrc2Vhcm93OiAnXHUyOTI1JywNCiAgICBoa3N3YXJvdzogJ1x1MjkyNicsDQogICAgaG9hcnI6ICdcdTIxRkYnLA0KICAgIGhvbXRodDogJ1x1MjIzQicsDQogICAgaG9va2xlZnRhcnJvdzogJ1x1MjFBOScsDQogICAgaG9va3JpZ2h0YXJyb3c6ICdcdTIxQUEnLA0KICAgIGhvcGY6ICdcdUQ4MzVcdURENTknLA0KICAgIGhvcmJhcjogJ1x1MjAxNScsDQogICAgaHNjcjogJ1x1RDgzNVx1RENCRCcsDQogICAgaHNsYXNoOiAnXHUyMTBGJywNCiAgICBoc3Ryb2s6ICdcdTAxMjcnLA0KICAgIGh5YnVsbDogJ1x1MjA0MycsDQogICAgaHlwaGVuOiAnXHUyMDEwJywNCiAgICBpYWN1dGU6ICdcdTAwRUQnLA0KICAgIGljOiAnXHUyMDYzJywNCiAgICBpY2lyYzogJ1x1MDBFRScsDQogICAgaWN5OiAnXHUwNDM4JywNCiAgICBpZWN5OiAnXHUwNDM1JywNCiAgICBpZXhjbDogJ1x1MDBBMScsDQogICAgaWZmOiAnXHUyMUQ0JywNCiAgICBpZnI6ICdcdUQ4MzVcdUREMjYnLA0KICAgIGlncmF2ZTogJ1x1MDBFQycsDQogICAgaWk6ICdcdTIxNDgnLA0KICAgIGlpaWludDogJ1x1MkEwQycsDQogICAgaWlpbnQ6ICdcdTIyMkQnLA0KICAgIGlpbmZpbjogJ1x1MjlEQycsDQogICAgaWlvdGE6ICdcdTIxMjknLA0KICAgIGlqbGlnOiAnXHUwMTMzJywNCiAgICBpbWFjcjogJ1x1MDEyQicsDQogICAgaW1hZ2U6ICdcdTIxMTEnLA0KICAgIGltYWdsaW5lOiAnXHUyMTEwJywNCiAgICBpbWFncGFydDogJ1x1MjExMScsDQogICAgaW1hdGg6ICdcdTAxMzEnLA0KICAgIGltb2Y6ICdcdTIyQjcnLA0KICAgIGltcGVkOiAnXHUwMUI1JywNCiAgICBpbjogJ1x1MjIwOCcsDQogICAgaW5jYXJlOiAnXHUyMTA1JywNCiAgICBpbmZpbjogJ1x1MjIxRScsDQogICAgaW5maW50aWU6ICdcdTI5REQnLA0KICAgIGlub2RvdDogJ1x1MDEzMScsDQogICAgaW50OiAnXHUyMjJCJywNCiAgICBpbnRjYWw6ICdcdTIyQkEnLA0KICAgIGludGVnZXJzOiAnXHUyMTI0JywNCiAgICBpbnRlcmNhbDogJ1x1MjJCQScsDQogICAgaW50bGFyaGs6ICdcdTJBMTcnLA0KICAgIGludHByb2Q6ICdcdTJBM0MnLA0KICAgIGlvY3k6ICdcdTA0NTEnLA0KICAgIGlvZ29uOiAnXHUwMTJGJywNCiAgICBpb3BmOiAnXHVEODM1XHVERDVBJywNCiAgICBpb3RhOiAnXHUwM0I5JywNCiAgICBpcHJvZDogJ1x1MkEzQycsDQogICAgaXF1ZXN0OiAnXHUwMEJGJywNCiAgICBpc2NyOiAnXHVEODM1XHVEQ0JFJywNCiAgICBpc2luOiAnXHUyMjA4JywNCiAgICBpc2luRTogJ1x1MjJGOScsDQogICAgaXNpbmRvdDogJ1x1MjJGNScsDQogICAgaXNpbnM6ICdcdTIyRjQnLA0KICAgIGlzaW5zdjogJ1x1MjJGMycsDQogICAgaXNpbnY6ICdcdTIyMDgnLA0KICAgIGl0OiAnXHUyMDYyJywNCiAgICBpdGlsZGU6ICdcdTAxMjknLA0KICAgIGl1a2N5OiAnXHUwNDU2JywNCiAgICBpdW1sOiAnXHUwMEVGJywNCiAgICBqY2lyYzogJ1x1MDEzNScsDQogICAgamN5OiAnXHUwNDM5JywNCiAgICBqZnI6ICdcdUQ4MzVcdUREMjcnLA0KICAgIGptYXRoOiAnXHUwMjM3JywNCiAgICBqb3BmOiAnXHVEODM1XHVERDVCJywNCiAgICBqc2NyOiAnXHVEODM1XHVEQ0JGJywNCiAgICBqc2VyY3k6ICdcdTA0NTgnLA0KICAgIGp1a2N5OiAnXHUwNDU0JywNCiAgICBrYXBwYTogJ1x1MDNCQScsDQogICAga2FwcGF2OiAnXHUwM0YwJywNCiAgICBrY2VkaWw6ICdcdTAxMzcnLA0KICAgIGtjeTogJ1x1MDQzQScsDQogICAga2ZyOiAnXHVEODM1XHVERDI4JywNCiAgICBrZ3JlZW46ICdcdTAxMzgnLA0KICAgIGtoY3k6ICdcdTA0NDUnLA0KICAgIGtqY3k6ICdcdTA0NUMnLA0KICAgIGtvcGY6ICdcdUQ4MzVcdURENUMnLA0KICAgIGtzY3I6ICdcdUQ4MzVcdURDQzAnLA0KICAgIGxBYXJyOiAnXHUyMURBJywNCiAgICBsQXJyOiAnXHUyMUQwJywNCiAgICBsQXRhaWw6ICdcdTI5MUInLA0KICAgIGxCYXJyOiAnXHUyOTBFJywNCiAgICBsRTogJ1x1MjI2NicsDQogICAgbEVnOiAnXHUyQThCJywNCiAgICBsSGFyOiAnXHUyOTYyJywNCiAgICBsYWN1dGU6ICdcdTAxM0EnLA0KICAgIGxhZW1wdHl2OiAnXHUyOUI0JywNCiAgICBsYWdyYW46ICdcdTIxMTInLA0KICAgIGxhbWJkYTogJ1x1MDNCQicsDQogICAgbGFuZzogJ1x1MjdFOCcsDQogICAgbGFuZ2Q6ICdcdTI5OTEnLA0KICAgIGxhbmdsZTogJ1x1MjdFOCcsDQogICAgbGFwOiAnXHUyQTg1JywNCiAgICBsYXF1bzogJ1x1MDBBQicsDQogICAgbGFycjogJ1x1MjE5MCcsDQogICAgbGFycmI6ICdcdTIxRTQnLA0KICAgIGxhcnJiZnM6ICdcdTI5MUYnLA0KICAgIGxhcnJmczogJ1x1MjkxRCcsDQogICAgbGFycmhrOiAnXHUyMUE5JywNCiAgICBsYXJybHA6ICdcdTIxQUInLA0KICAgIGxhcnJwbDogJ1x1MjkzOScsDQogICAgbGFycnNpbTogJ1x1Mjk3MycsDQogICAgbGFycnRsOiAnXHUyMUEyJywNCiAgICBsYXQ6ICdcdTJBQUInLA0KICAgIGxhdGFpbDogJ1x1MjkxOScsDQogICAgbGF0ZTogJ1x1MkFBRCcsDQogICAgbGF0ZXM6ICdcdTJBQURcdUZFMDAnLA0KICAgIGxiYXJyOiAnXHUyOTBDJywNCiAgICBsYmJyazogJ1x1Mjc3MicsDQogICAgbGJyYWNlOiAnXHUwMDdCJywNCiAgICBsYnJhY2s6ICdcdTAwNUInLA0KICAgIGxicmtlOiAnXHUyOThCJywNCiAgICBsYnJrc2xkOiAnXHUyOThGJywNCiAgICBsYnJrc2x1OiAnXHUyOThEJywNCiAgICBsY2Fyb246ICdcdTAxM0UnLA0KICAgIGxjZWRpbDogJ1x1MDEzQycsDQogICAgbGNlaWw6ICdcdTIzMDgnLA0KICAgIGxjdWI6ICdcdTAwN0InLA0KICAgIGxjeTogJ1x1MDQzQicsDQogICAgbGRjYTogJ1x1MjkzNicsDQogICAgbGRxdW86ICdcdTIwMUMnLA0KICAgIGxkcXVvcjogJ1x1MjAxRScsDQogICAgbGRyZGhhcjogJ1x1Mjk2NycsDQogICAgbGRydXNoYXI6ICdcdTI5NEInLA0KICAgIGxkc2g6ICdcdTIxQjInLA0KICAgIGxlOiAnXHUyMjY0JywNCiAgICBsZWZ0YXJyb3c6ICdcdTIxOTAnLA0KICAgIGxlZnRhcnJvd3RhaWw6ICdcdTIxQTInLA0KICAgIGxlZnRoYXJwb29uZG93bjogJ1x1MjFCRCcsDQogICAgbGVmdGhhcnBvb251cDogJ1x1MjFCQycsDQogICAgbGVmdGxlZnRhcnJvd3M6ICdcdTIxQzcnLA0KICAgIGxlZnRyaWdodGFycm93OiAnXHUyMTk0JywNCiAgICBsZWZ0cmlnaHRhcnJvd3M6ICdcdTIxQzYnLA0KICAgIGxlZnRyaWdodGhhcnBvb25zOiAnXHUyMUNCJywNCiAgICBsZWZ0cmlnaHRzcXVpZ2Fycm93OiAnXHUyMUFEJywNCiAgICBsZWZ0dGhyZWV0aW1lczogJ1x1MjJDQicsDQogICAgbGVnOiAnXHUyMkRBJywNCiAgICBsZXE6ICdcdTIyNjQnLA0KICAgIGxlcXE6ICdcdTIyNjYnLA0KICAgIGxlcXNsYW50OiAnXHUyQTdEJywNCiAgICBsZXM6ICdcdTJBN0QnLA0KICAgIGxlc2NjOiAnXHUyQUE4JywNCiAgICBsZXNkb3Q6ICdcdTJBN0YnLA0KICAgIGxlc2RvdG86ICdcdTJBODEnLA0KICAgIGxlc2RvdG9yOiAnXHUyQTgzJywNCiAgICBsZXNnOiAnXHUyMkRBXHVGRTAwJywNCiAgICBsZXNnZXM6ICdcdTJBOTMnLA0KICAgIGxlc3NhcHByb3g6ICdcdTJBODUnLA0KICAgIGxlc3Nkb3Q6ICdcdTIyRDYnLA0KICAgIGxlc3NlcWd0cjogJ1x1MjJEQScsDQogICAgbGVzc2VxcWd0cjogJ1x1MkE4QicsDQogICAgbGVzc2d0cjogJ1x1MjI3NicsDQogICAgbGVzc3NpbTogJ1x1MjI3MicsDQogICAgbGZpc2h0OiAnXHUyOTdDJywNCiAgICBsZmxvb3I6ICdcdTIzMEEnLA0KICAgIGxmcjogJ1x1RDgzNVx1REQyOScsDQogICAgbGc6ICdcdTIyNzYnLA0KICAgIGxnRTogJ1x1MkE5MScsDQogICAgbGhhcmQ6ICdcdTIxQkQnLA0KICAgIGxoYXJ1OiAnXHUyMUJDJywNCiAgICBsaGFydWw6ICdcdTI5NkEnLA0KICAgIGxoYmxrOiAnXHUyNTg0JywNCiAgICBsamN5OiAnXHUwNDU5JywNCiAgICBsbDogJ1x1MjI2QScsDQogICAgbGxhcnI6ICdcdTIxQzcnLA0KICAgIGxsY29ybmVyOiAnXHUyMzFFJywNCiAgICBsbGhhcmQ6ICdcdTI5NkInLA0KICAgIGxsdHJpOiAnXHUyNUZBJywNCiAgICBsbWlkb3Q6ICdcdTAxNDAnLA0KICAgIGxtb3VzdDogJ1x1MjNCMCcsDQogICAgbG1vdXN0YWNoZTogJ1x1MjNCMCcsDQogICAgbG5FOiAnXHUyMjY4JywNCiAgICBsbmFwOiAnXHUyQTg5JywNCiAgICBsbmFwcHJveDogJ1x1MkE4OScsDQogICAgbG5lOiAnXHUyQTg3JywNCiAgICBsbmVxOiAnXHUyQTg3JywNCiAgICBsbmVxcTogJ1x1MjI2OCcsDQogICAgbG5zaW06ICdcdTIyRTYnLA0KICAgIGxvYW5nOiAnXHUyN0VDJywNCiAgICBsb2FycjogJ1x1MjFGRCcsDQogICAgbG9icms6ICdcdTI3RTYnLA0KICAgIGxvbmdsZWZ0YXJyb3c6ICdcdTI3RjUnLA0KICAgIGxvbmdsZWZ0cmlnaHRhcnJvdzogJ1x1MjdGNycsDQogICAgbG9uZ21hcHN0bzogJ1x1MjdGQycsDQogICAgbG9uZ3JpZ2h0YXJyb3c6ICdcdTI3RjYnLA0KICAgIGxvb3BhcnJvd2xlZnQ6ICdcdTIxQUInLA0KICAgIGxvb3BhcnJvd3JpZ2h0OiAnXHUyMUFDJywNCiAgICBsb3BhcjogJ1x1Mjk4NScsDQogICAgbG9wZjogJ1x1RDgzNVx1REQ1RCcsDQogICAgbG9wbHVzOiAnXHUyQTJEJywNCiAgICBsb3RpbWVzOiAnXHUyQTM0JywNCiAgICBsb3dhc3Q6ICdcdTIyMTcnLA0KICAgIGxvd2JhcjogJ1x1MDA1RicsDQogICAgbG96OiAnXHUyNUNBJywNCiAgICBsb3plbmdlOiAnXHUyNUNBJywNCiAgICBsb3pmOiAnXHUyOUVCJywNCiAgICBscGFyOiAnXHUwMDI4JywNCiAgICBscGFybHQ6ICdcdTI5OTMnLA0KICAgIGxyYXJyOiAnXHUyMUM2JywNCiAgICBscmNvcm5lcjogJ1x1MjMxRicsDQogICAgbHJoYXI6ICdcdTIxQ0InLA0KICAgIGxyaGFyZDogJ1x1Mjk2RCcsDQogICAgbHJtOiAnXHUyMDBFJywNCiAgICBscnRyaTogJ1x1MjJCRicsDQogICAgbHNhcXVvOiAnXHUyMDM5JywNCiAgICBsc2NyOiAnXHVEODM1XHVEQ0MxJywNCiAgICBsc2g6ICdcdTIxQjAnLA0KICAgIGxzaW06ICdcdTIyNzInLA0KICAgIGxzaW1lOiAnXHUyQThEJywNCiAgICBsc2ltZzogJ1x1MkE4RicsDQogICAgbHNxYjogJ1x1MDA1QicsDQogICAgbHNxdW86ICdcdTIwMTgnLA0KICAgIGxzcXVvcjogJ1x1MjAxQScsDQogICAgbHN0cm9rOiAnXHUwMTQyJywNCiAgICBsdDogJ1x1MDAzQycsDQogICAgbHRjYzogJ1x1MkFBNicsDQogICAgbHRjaXI6ICdcdTJBNzknLA0KICAgIGx0ZG90OiAnXHUyMkQ2JywNCiAgICBsdGhyZWU6ICdcdTIyQ0InLA0KICAgIGx0aW1lczogJ1x1MjJDOScsDQogICAgbHRsYXJyOiAnXHUyOTc2JywNCiAgICBsdHF1ZXN0OiAnXHUyQTdCJywNCiAgICBsdHJQYXI6ICdcdTI5OTYnLA0KICAgIGx0cmk6ICdcdTI1QzMnLA0KICAgIGx0cmllOiAnXHUyMkI0JywNCiAgICBsdHJpZjogJ1x1MjVDMicsDQogICAgbHVyZHNoYXI6ICdcdTI5NEEnLA0KICAgIGx1cnVoYXI6ICdcdTI5NjYnLA0KICAgIGx2ZXJ0bmVxcTogJ1x1MjI2OFx1RkUwMCcsDQogICAgbHZuRTogJ1x1MjI2OFx1RkUwMCcsDQogICAgbUREb3Q6ICdcdTIyM0EnLA0KICAgIG1hY3I6ICdcdTAwQUYnLA0KICAgIG1hbGU6ICdcdTI2NDInLA0KICAgIG1hbHQ6ICdcdTI3MjAnLA0KICAgIG1hbHRlc2U6ICdcdTI3MjAnLA0KICAgIG1hcDogJ1x1MjFBNicsDQogICAgbWFwc3RvOiAnXHUyMUE2JywNCiAgICBtYXBzdG9kb3duOiAnXHUyMUE3JywNCiAgICBtYXBzdG9sZWZ0OiAnXHUyMUE0JywNCiAgICBtYXBzdG91cDogJ1x1MjFBNScsDQogICAgbWFya2VyOiAnXHUyNUFFJywNCiAgICBtY29tbWE6ICdcdTJBMjknLA0KICAgIG1jeTogJ1x1MDQzQycsDQogICAgbWRhc2g6ICdcdTIwMTQnLA0KICAgIG1lYXN1cmVkYW5nbGU6ICdcdTIyMjEnLA0KICAgIG1mcjogJ1x1RDgzNVx1REQyQScsDQogICAgbWhvOiAnXHUyMTI3JywNCiAgICBtaWNybzogJ1x1MDBCNScsDQogICAgbWlkOiAnXHUyMjIzJywNCiAgICBtaWRhc3Q6ICdcdTAwMkEnLA0KICAgIG1pZGNpcjogJ1x1MkFGMCcsDQogICAgbWlkZG90OiAnXHUwMEI3JywNCiAgICBtaW51czogJ1x1MjIxMicsDQogICAgbWludXNiOiAnXHUyMjlGJywNCiAgICBtaW51c2Q6ICdcdTIyMzgnLA0KICAgIG1pbnVzZHU6ICdcdTJBMkEnLA0KICAgIG1sY3A6ICdcdTJBREInLA0KICAgIG1sZHI6ICdcdTIwMjYnLA0KICAgIG1ucGx1czogJ1x1MjIxMycsDQogICAgbW9kZWxzOiAnXHUyMkE3JywNCiAgICBtb3BmOiAnXHVEODM1XHVERDVFJywNCiAgICBtcDogJ1x1MjIxMycsDQogICAgbXNjcjogJ1x1RDgzNVx1RENDMicsDQogICAgbXN0cG9zOiAnXHUyMjNFJywNCiAgICBtdTogJ1x1MDNCQycsDQogICAgbXVsdGltYXA6ICdcdTIyQjgnLA0KICAgIG11bWFwOiAnXHUyMkI4JywNCiAgICBuR2c6ICdcdTIyRDlcdTAzMzgnLA0KICAgIG5HdDogJ1x1MjI2Qlx1MjBEMicsDQogICAgbkd0djogJ1x1MjI2Qlx1MDMzOCcsDQogICAgbkxlZnRhcnJvdzogJ1x1MjFDRCcsDQogICAgbkxlZnRyaWdodGFycm93OiAnXHUyMUNFJywNCiAgICBuTGw6ICdcdTIyRDhcdTAzMzgnLA0KICAgIG5MdDogJ1x1MjI2QVx1MjBEMicsDQogICAgbkx0djogJ1x1MjI2QVx1MDMzOCcsDQogICAgblJpZ2h0YXJyb3c6ICdcdTIxQ0YnLA0KICAgIG5WRGFzaDogJ1x1MjJBRicsDQogICAgblZkYXNoOiAnXHUyMkFFJywNCiAgICBuYWJsYTogJ1x1MjIwNycsDQogICAgbmFjdXRlOiAnXHUwMTQ0JywNCiAgICBuYW5nOiAnXHUyMjIwXHUyMEQyJywNCiAgICBuYXA6ICdcdTIyNDknLA0KICAgIG5hcEU6ICdcdTJBNzBcdTAzMzgnLA0KICAgIG5hcGlkOiAnXHUyMjRCXHUwMzM4JywNCiAgICBuYXBvczogJ1x1MDE0OScsDQogICAgbmFwcHJveDogJ1x1MjI0OScsDQogICAgbmF0dXI6ICdcdTI2NkUnLA0KICAgIG5hdHVyYWw6ICdcdTI2NkUnLA0KICAgIG5hdHVyYWxzOiAnXHUyMTE1JywNCiAgICBuYnNwOiAnXHUwMEEwJywNCiAgICBuYnVtcDogJ1x1MjI0RVx1MDMzOCcsDQogICAgbmJ1bXBlOiAnXHUyMjRGXHUwMzM4JywNCiAgICBuY2FwOiAnXHUyQTQzJywNCiAgICBuY2Fyb246ICdcdTAxNDgnLA0KICAgIG5jZWRpbDogJ1x1MDE0NicsDQogICAgbmNvbmc6ICdcdTIyNDcnLA0KICAgIG5jb25nZG90OiAnXHUyQTZEXHUwMzM4JywNCiAgICBuY3VwOiAnXHUyQTQyJywNCiAgICBuY3k6ICdcdTA0M0QnLA0KICAgIG5kYXNoOiAnXHUyMDEzJywNCiAgICBuZTogJ1x1MjI2MCcsDQogICAgbmVBcnI6ICdcdTIxRDcnLA0KICAgIG5lYXJoazogJ1x1MjkyNCcsDQogICAgbmVhcnI6ICdcdTIxOTcnLA0KICAgIG5lYXJyb3c6ICdcdTIxOTcnLA0KICAgIG5lZG90OiAnXHUyMjUwXHUwMzM4JywNCiAgICBuZXF1aXY6ICdcdTIyNjInLA0KICAgIG5lc2VhcjogJ1x1MjkyOCcsDQogICAgbmVzaW06ICdcdTIyNDJcdTAzMzgnLA0KICAgIG5leGlzdDogJ1x1MjIwNCcsDQogICAgbmV4aXN0czogJ1x1MjIwNCcsDQogICAgbmZyOiAnXHVEODM1XHVERDJCJywNCiAgICBuZ0U6ICdcdTIyNjdcdTAzMzgnLA0KICAgIG5nZTogJ1x1MjI3MScsDQogICAgbmdlcTogJ1x1MjI3MScsDQogICAgbmdlcXE6ICdcdTIyNjdcdTAzMzgnLA0KICAgIG5nZXFzbGFudDogJ1x1MkE3RVx1MDMzOCcsDQogICAgbmdlczogJ1x1MkE3RVx1MDMzOCcsDQogICAgbmdzaW06ICdcdTIyNzUnLA0KICAgIG5ndDogJ1x1MjI2RicsDQogICAgbmd0cjogJ1x1MjI2RicsDQogICAgbmhBcnI6ICdcdTIxQ0UnLA0KICAgIG5oYXJyOiAnXHUyMUFFJywNCiAgICBuaHBhcjogJ1x1MkFGMicsDQogICAgbmk6ICdcdTIyMEInLA0KICAgIG5pczogJ1x1MjJGQycsDQogICAgbmlzZDogJ1x1MjJGQScsDQogICAgbml2OiAnXHUyMjBCJywNCiAgICBuamN5OiAnXHUwNDVBJywNCiAgICBubEFycjogJ1x1MjFDRCcsDQogICAgbmxFOiAnXHUyMjY2XHUwMzM4JywNCiAgICBubGFycjogJ1x1MjE5QScsDQogICAgbmxkcjogJ1x1MjAyNScsDQogICAgbmxlOiAnXHUyMjcwJywNCiAgICBubGVmdGFycm93OiAnXHUyMTlBJywNCiAgICBubGVmdHJpZ2h0YXJyb3c6ICdcdTIxQUUnLA0KICAgIG5sZXE6ICdcdTIyNzAnLA0KICAgIG5sZXFxOiAnXHUyMjY2XHUwMzM4JywNCiAgICBubGVxc2xhbnQ6ICdcdTJBN0RcdTAzMzgnLA0KICAgIG5sZXM6ICdcdTJBN0RcdTAzMzgnLA0KICAgIG5sZXNzOiAnXHUyMjZFJywNCiAgICBubHNpbTogJ1x1MjI3NCcsDQogICAgbmx0OiAnXHUyMjZFJywNCiAgICBubHRyaTogJ1x1MjJFQScsDQogICAgbmx0cmllOiAnXHUyMkVDJywNCiAgICBubWlkOiAnXHUyMjI0JywNCiAgICBub3BmOiAnXHVEODM1XHVERDVGJywNCiAgICBub3Q6ICdcdTAwQUMnLA0KICAgIG5vdGluOiAnXHUyMjA5JywNCiAgICBub3RpbkU6ICdcdTIyRjlcdTAzMzgnLA0KICAgIG5vdGluZG90OiAnXHUyMkY1XHUwMzM4JywNCiAgICBub3RpbnZhOiAnXHUyMjA5JywNCiAgICBub3RpbnZiOiAnXHUyMkY3JywNCiAgICBub3RpbnZjOiAnXHUyMkY2JywNCiAgICBub3RuaTogJ1x1MjIwQycsDQogICAgbm90bml2YTogJ1x1MjIwQycsDQogICAgbm90bml2YjogJ1x1MjJGRScsDQogICAgbm90bml2YzogJ1x1MjJGRCcsDQogICAgbnBhcjogJ1x1MjIyNicsDQogICAgbnBhcmFsbGVsOiAnXHUyMjI2JywNCiAgICBucGFyc2w6ICdcdTJBRkRcdTIwRTUnLA0KICAgIG5wYXJ0OiAnXHUyMjAyXHUwMzM4JywNCiAgICBucG9saW50OiAnXHUyQTE0JywNCiAgICBucHI6ICdcdTIyODAnLA0KICAgIG5wcmN1ZTogJ1x1MjJFMCcsDQogICAgbnByZTogJ1x1MkFBRlx1MDMzOCcsDQogICAgbnByZWM6ICdcdTIyODAnLA0KICAgIG5wcmVjZXE6ICdcdTJBQUZcdTAzMzgnLA0KICAgIG5yQXJyOiAnXHUyMUNGJywNCiAgICBucmFycjogJ1x1MjE5QicsDQogICAgbnJhcnJjOiAnXHUyOTMzXHUwMzM4JywNCiAgICBucmFycnc6ICdcdTIxOURcdTAzMzgnLA0KICAgIG5yaWdodGFycm93OiAnXHUyMTlCJywNCiAgICBucnRyaTogJ1x1MjJFQicsDQogICAgbnJ0cmllOiAnXHUyMkVEJywNCiAgICBuc2M6ICdcdTIyODEnLA0KICAgIG5zY2N1ZTogJ1x1MjJFMScsDQogICAgbnNjZTogJ1x1MkFCMFx1MDMzOCcsDQogICAgbnNjcjogJ1x1RDgzNVx1RENDMycsDQogICAgbnNob3J0bWlkOiAnXHUyMjI0JywNCiAgICBuc2hvcnRwYXJhbGxlbDogJ1x1MjIyNicsDQogICAgbnNpbTogJ1x1MjI0MScsDQogICAgbnNpbWU6ICdcdTIyNDQnLA0KICAgIG5zaW1lcTogJ1x1MjI0NCcsDQogICAgbnNtaWQ6ICdcdTIyMjQnLA0KICAgIG5zcGFyOiAnXHUyMjI2JywNCiAgICBuc3FzdWJlOiAnXHUyMkUyJywNCiAgICBuc3FzdXBlOiAnXHUyMkUzJywNCiAgICBuc3ViOiAnXHUyMjg0JywNCiAgICBuc3ViRTogJ1x1MkFDNVx1MDMzOCcsDQogICAgbnN1YmU6ICdcdTIyODgnLA0KICAgIG5zdWJzZXQ6ICdcdTIyODJcdTIwRDInLA0KICAgIG5zdWJzZXRlcTogJ1x1MjI4OCcsDQogICAgbnN1YnNldGVxcTogJ1x1MkFDNVx1MDMzOCcsDQogICAgbnN1Y2M6ICdcdTIyODEnLA0KICAgIG5zdWNjZXE6ICdcdTJBQjBcdTAzMzgnLA0KICAgIG5zdXA6ICdcdTIyODUnLA0KICAgIG5zdXBFOiAnXHUyQUM2XHUwMzM4JywNCiAgICBuc3VwZTogJ1x1MjI4OScsDQogICAgbnN1cHNldDogJ1x1MjI4M1x1MjBEMicsDQogICAgbnN1cHNldGVxOiAnXHUyMjg5JywNCiAgICBuc3Vwc2V0ZXFxOiAnXHUyQUM2XHUwMzM4JywNCiAgICBudGdsOiAnXHUyMjc5JywNCiAgICBudGlsZGU6ICdcdTAwRjEnLA0KICAgIG50bGc6ICdcdTIyNzgnLA0KICAgIG50cmlhbmdsZWxlZnQ6ICdcdTIyRUEnLA0KICAgIG50cmlhbmdsZWxlZnRlcTogJ1x1MjJFQycsDQogICAgbnRyaWFuZ2xlcmlnaHQ6ICdcdTIyRUInLA0KICAgIG50cmlhbmdsZXJpZ2h0ZXE6ICdcdTIyRUQnLA0KICAgIG51OiAnXHUwM0JEJywNCiAgICBudW06ICdcdTAwMjMnLA0KICAgIG51bWVybzogJ1x1MjExNicsDQogICAgbnVtc3A6ICdcdTIwMDcnLA0KICAgIG52RGFzaDogJ1x1MjJBRCcsDQogICAgbnZIYXJyOiAnXHUyOTA0JywNCiAgICBudmFwOiAnXHUyMjREXHUyMEQyJywNCiAgICBudmRhc2g6ICdcdTIyQUMnLA0KICAgIG52Z2U6ICdcdTIyNjVcdTIwRDInLA0KICAgIG52Z3Q6ICdcdTAwM0VcdTIwRDInLA0KICAgIG52aW5maW46ICdcdTI5REUnLA0KICAgIG52bEFycjogJ1x1MjkwMicsDQogICAgbnZsZTogJ1x1MjI2NFx1MjBEMicsDQogICAgbnZsdDogJ1x1MDAzQ1x1MjBEMicsDQogICAgbnZsdHJpZTogJ1x1MjJCNFx1MjBEMicsDQogICAgbnZyQXJyOiAnXHUyOTAzJywNCiAgICBudnJ0cmllOiAnXHUyMkI1XHUyMEQyJywNCiAgICBudnNpbTogJ1x1MjIzQ1x1MjBEMicsDQogICAgbndBcnI6ICdcdTIxRDYnLA0KICAgIG53YXJoazogJ1x1MjkyMycsDQogICAgbndhcnI6ICdcdTIxOTYnLA0KICAgIG53YXJyb3c6ICdcdTIxOTYnLA0KICAgIG53bmVhcjogJ1x1MjkyNycsDQogICAgb1M6ICdcdTI0QzgnLA0KICAgIG9hY3V0ZTogJ1x1MDBGMycsDQogICAgb2FzdDogJ1x1MjI5QicsDQogICAgb2NpcjogJ1x1MjI5QScsDQogICAgb2NpcmM6ICdcdTAwRjQnLA0KICAgIG9jeTogJ1x1MDQzRScsDQogICAgb2Rhc2g6ICdcdTIyOUQnLA0KICAgIG9kYmxhYzogJ1x1MDE1MScsDQogICAgb2RpdjogJ1x1MkEzOCcsDQogICAgb2RvdDogJ1x1MjI5OScsDQogICAgb2Rzb2xkOiAnXHUyOUJDJywNCiAgICBvZWxpZzogJ1x1MDE1MycsDQogICAgb2ZjaXI6ICdcdTI5QkYnLA0KICAgIG9mcjogJ1x1RDgzNVx1REQyQycsDQogICAgb2dvbjogJ1x1MDJEQicsDQogICAgb2dyYXZlOiAnXHUwMEYyJywNCiAgICBvZ3Q6ICdcdTI5QzEnLA0KICAgIG9oYmFyOiAnXHUyOUI1JywNCiAgICBvaG06ICdcdTAzQTknLA0KICAgIG9pbnQ6ICdcdTIyMkUnLA0KICAgIG9sYXJyOiAnXHUyMUJBJywNCiAgICBvbGNpcjogJ1x1MjlCRScsDQogICAgb2xjcm9zczogJ1x1MjlCQicsDQogICAgb2xpbmU6ICdcdTIwM0UnLA0KICAgIG9sdDogJ1x1MjlDMCcsDQogICAgb21hY3I6ICdcdTAxNEQnLA0KICAgIG9tZWdhOiAnXHUwM0M5JywNCiAgICBvbWljcm9uOiAnXHUwM0JGJywNCiAgICBvbWlkOiAnXHUyOUI2JywNCiAgICBvbWludXM6ICdcdTIyOTYnLA0KICAgIG9vcGY6ICdcdUQ4MzVcdURENjAnLA0KICAgIG9wYXI6ICdcdTI5QjcnLA0KICAgIG9wZXJwOiAnXHUyOUI5JywNCiAgICBvcGx1czogJ1x1MjI5NScsDQogICAgb3I6ICdcdTIyMjgnLA0KICAgIG9yYXJyOiAnXHUyMUJCJywNCiAgICBvcmQ6ICdcdTJBNUQnLA0KICAgIG9yZGVyOiAnXHUyMTM0JywNCiAgICBvcmRlcm9mOiAnXHUyMTM0JywNCiAgICBvcmRmOiAnXHUwMEFBJywNCiAgICBvcmRtOiAnXHUwMEJBJywNCiAgICBvcmlnb2Y6ICdcdTIyQjYnLA0KICAgIG9yb3I6ICdcdTJBNTYnLA0KICAgIG9yc2xvcGU6ICdcdTJBNTcnLA0KICAgIG9ydjogJ1x1MkE1QicsDQogICAgb3NjcjogJ1x1MjEzNCcsDQogICAgb3NsYXNoOiAnXHUwMEY4JywNCiAgICBvc29sOiAnXHUyMjk4JywNCiAgICBvdGlsZGU6ICdcdTAwRjUnLA0KICAgIG90aW1lczogJ1x1MjI5NycsDQogICAgb3RpbWVzYXM6ICdcdTJBMzYnLA0KICAgIG91bWw6ICdcdTAwRjYnLA0KICAgIG92YmFyOiAnXHUyMzNEJywNCiAgICBwYXI6ICdcdTIyMjUnLA0KICAgIHBhcmE6ICdcdTAwQjYnLA0KICAgIHBhcmFsbGVsOiAnXHUyMjI1JywNCiAgICBwYXJzaW06ICdcdTJBRjMnLA0KICAgIHBhcnNsOiAnXHUyQUZEJywNCiAgICBwYXJ0OiAnXHUyMjAyJywNCiAgICBwY3k6ICdcdTA0M0YnLA0KICAgIHBlcmNudDogJ1x1MDAyNScsDQogICAgcGVyaW9kOiAnXHUwMDJFJywNCiAgICBwZXJtaWw6ICdcdTIwMzAnLA0KICAgIHBlcnA6ICdcdTIyQTUnLA0KICAgIHBlcnRlbms6ICdcdTIwMzEnLA0KICAgIHBmcjogJ1x1RDgzNVx1REQyRCcsDQogICAgcGhpOiAnXHUwM0M2JywNCiAgICBwaGl2OiAnXHUwM0Q1JywNCiAgICBwaG1tYXQ6ICdcdTIxMzMnLA0KICAgIHBob25lOiAnXHUyNjBFJywNCiAgICBwaTogJ1x1MDNDMCcsDQogICAgcGl0Y2hmb3JrOiAnXHUyMkQ0JywNCiAgICBwaXY6ICdcdTAzRDYnLA0KICAgIHBsYW5jazogJ1x1MjEwRicsDQogICAgcGxhbmNraDogJ1x1MjEwRScsDQogICAgcGxhbmt2OiAnXHUyMTBGJywNCiAgICBwbHVzOiAnXHUwMDJCJywNCiAgICBwbHVzYWNpcjogJ1x1MkEyMycsDQogICAgcGx1c2I6ICdcdTIyOUUnLA0KICAgIHBsdXNjaXI6ICdcdTJBMjInLA0KICAgIHBsdXNkbzogJ1x1MjIxNCcsDQogICAgcGx1c2R1OiAnXHUyQTI1JywNCiAgICBwbHVzZTogJ1x1MkE3MicsDQogICAgcGx1c21uOiAnXHUwMEIxJywNCiAgICBwbHVzc2ltOiAnXHUyQTI2JywNCiAgICBwbHVzdHdvOiAnXHUyQTI3JywNCiAgICBwbTogJ1x1MDBCMScsDQogICAgcG9pbnRpbnQ6ICdcdTJBMTUnLA0KICAgIHBvcGY6ICdcdUQ4MzVcdURENjEnLA0KICAgIHBvdW5kOiAnXHUwMEEzJywNCiAgICBwcjogJ1x1MjI3QScsDQogICAgcHJFOiAnXHUyQUIzJywNCiAgICBwcmFwOiAnXHUyQUI3JywNCiAgICBwcmN1ZTogJ1x1MjI3QycsDQogICAgcHJlOiAnXHUyQUFGJywNCiAgICBwcmVjOiAnXHUyMjdBJywNCiAgICBwcmVjYXBwcm94OiAnXHUyQUI3JywNCiAgICBwcmVjY3VybHllcTogJ1x1MjI3QycsDQogICAgcHJlY2VxOiAnXHUyQUFGJywNCiAgICBwcmVjbmFwcHJveDogJ1x1MkFCOScsDQogICAgcHJlY25lcXE6ICdcdTJBQjUnLA0KICAgIHByZWNuc2ltOiAnXHUyMkU4JywNCiAgICBwcmVjc2ltOiAnXHUyMjdFJywNCiAgICBwcmltZTogJ1x1MjAzMicsDQogICAgcHJpbWVzOiAnXHUyMTE5JywNCiAgICBwcm5FOiAnXHUyQUI1JywNCiAgICBwcm5hcDogJ1x1MkFCOScsDQogICAgcHJuc2ltOiAnXHUyMkU4JywNCiAgICBwcm9kOiAnXHUyMjBGJywNCiAgICBwcm9mYWxhcjogJ1x1MjMyRScsDQogICAgcHJvZmxpbmU6ICdcdTIzMTInLA0KICAgIHByb2ZzdXJmOiAnXHUyMzEzJywNCiAgICBwcm9wOiAnXHUyMjFEJywNCiAgICBwcm9wdG86ICdcdTIyMUQnLA0KICAgIHByc2ltOiAnXHUyMjdFJywNCiAgICBwcnVyZWw6ICdcdTIyQjAnLA0KICAgIHBzY3I6ICdcdUQ4MzVcdURDQzUnLA0KICAgIHBzaTogJ1x1MDNDOCcsDQogICAgcHVuY3NwOiAnXHUyMDA4JywNCiAgICBxZnI6ICdcdUQ4MzVcdUREMkUnLA0KICAgIHFpbnQ6ICdcdTJBMEMnLA0KICAgIHFvcGY6ICdcdUQ4MzVcdURENjInLA0KICAgIHFwcmltZTogJ1x1MjA1NycsDQogICAgcXNjcjogJ1x1RDgzNVx1RENDNicsDQogICAgcXVhdGVybmlvbnM6ICdcdTIxMEQnLA0KICAgIHF1YXRpbnQ6ICdcdTJBMTYnLA0KICAgIHF1ZXN0OiAnXHUwMDNGJywNCiAgICBxdWVzdGVxOiAnXHUyMjVGJywNCiAgICBxdW90OiAnXHUwMDIyJywNCiAgICByQWFycjogJ1x1MjFEQicsDQogICAgckFycjogJ1x1MjFEMicsDQogICAgckF0YWlsOiAnXHUyOTFDJywNCiAgICByQmFycjogJ1x1MjkwRicsDQogICAgckhhcjogJ1x1Mjk2NCcsDQogICAgcmFjZTogJ1x1MjIzRFx1MDMzMScsDQogICAgcmFjdXRlOiAnXHUwMTU1JywNCiAgICByYWRpYzogJ1x1MjIxQScsDQogICAgcmFlbXB0eXY6ICdcdTI5QjMnLA0KICAgIHJhbmc6ICdcdTI3RTknLA0KICAgIHJhbmdkOiAnXHUyOTkyJywNCiAgICByYW5nZTogJ1x1MjlBNScsDQogICAgcmFuZ2xlOiAnXHUyN0U5JywNCiAgICByYXF1bzogJ1x1MDBCQicsDQogICAgcmFycjogJ1x1MjE5MicsDQogICAgcmFycmFwOiAnXHUyOTc1JywNCiAgICByYXJyYjogJ1x1MjFFNScsDQogICAgcmFycmJmczogJ1x1MjkyMCcsDQogICAgcmFycmM6ICdcdTI5MzMnLA0KICAgIHJhcnJmczogJ1x1MjkxRScsDQogICAgcmFycmhrOiAnXHUyMUFBJywNCiAgICByYXJybHA6ICdcdTIxQUMnLA0KICAgIHJhcnJwbDogJ1x1Mjk0NScsDQogICAgcmFycnNpbTogJ1x1Mjk3NCcsDQogICAgcmFycnRsOiAnXHUyMUEzJywNCiAgICByYXJydzogJ1x1MjE5RCcsDQogICAgcmF0YWlsOiAnXHUyOTFBJywNCiAgICByYXRpbzogJ1x1MjIzNicsDQogICAgcmF0aW9uYWxzOiAnXHUyMTFBJywNCiAgICByYmFycjogJ1x1MjkwRCcsDQogICAgcmJicms6ICdcdTI3NzMnLA0KICAgIHJicmFjZTogJ1x1MDA3RCcsDQogICAgcmJyYWNrOiAnXHUwMDVEJywNCiAgICByYnJrZTogJ1x1Mjk4QycsDQogICAgcmJya3NsZDogJ1x1Mjk4RScsDQogICAgcmJya3NsdTogJ1x1Mjk5MCcsDQogICAgcmNhcm9uOiAnXHUwMTU5JywNCiAgICByY2VkaWw6ICdcdTAxNTcnLA0KICAgIHJjZWlsOiAnXHUyMzA5JywNCiAgICByY3ViOiAnXHUwMDdEJywNCiAgICByY3k6ICdcdTA0NDAnLA0KICAgIHJkY2E6ICdcdTI5MzcnLA0KICAgIHJkbGRoYXI6ICdcdTI5NjknLA0KICAgIHJkcXVvOiAnXHUyMDFEJywNCiAgICByZHF1b3I6ICdcdTIwMUQnLA0KICAgIHJkc2g6ICdcdTIxQjMnLA0KICAgIHJlYWw6ICdcdTIxMUMnLA0KICAgIHJlYWxpbmU6ICdcdTIxMUInLA0KICAgIHJlYWxwYXJ0OiAnXHUyMTFDJywNCiAgICByZWFsczogJ1x1MjExRCcsDQogICAgcmVjdDogJ1x1MjVBRCcsDQogICAgcmVnOiAnXHUwMEFFJywNCiAgICByZmlzaHQ6ICdcdTI5N0QnLA0KICAgIHJmbG9vcjogJ1x1MjMwQicsDQogICAgcmZyOiAnXHVEODM1XHVERDJGJywNCiAgICByaGFyZDogJ1x1MjFDMScsDQogICAgcmhhcnU6ICdcdTIxQzAnLA0KICAgIHJoYXJ1bDogJ1x1Mjk2QycsDQogICAgcmhvOiAnXHUwM0MxJywNCiAgICByaG92OiAnXHUwM0YxJywNCiAgICByaWdodGFycm93OiAnXHUyMTkyJywNCiAgICByaWdodGFycm93dGFpbDogJ1x1MjFBMycsDQogICAgcmlnaHRoYXJwb29uZG93bjogJ1x1MjFDMScsDQogICAgcmlnaHRoYXJwb29udXA6ICdcdTIxQzAnLA0KICAgIHJpZ2h0bGVmdGFycm93czogJ1x1MjFDNCcsDQogICAgcmlnaHRsZWZ0aGFycG9vbnM6ICdcdTIxQ0MnLA0KICAgIHJpZ2h0cmlnaHRhcnJvd3M6ICdcdTIxQzknLA0KICAgIHJpZ2h0c3F1aWdhcnJvdzogJ1x1MjE5RCcsDQogICAgcmlnaHR0aHJlZXRpbWVzOiAnXHUyMkNDJywNCiAgICByaW5nOiAnXHUwMkRBJywNCiAgICByaXNpbmdkb3RzZXE6ICdcdTIyNTMnLA0KICAgIHJsYXJyOiAnXHUyMUM0JywNCiAgICBybGhhcjogJ1x1MjFDQycsDQogICAgcmxtOiAnXHUyMDBGJywNCiAgICBybW91c3Q6ICdcdTIzQjEnLA0KICAgIHJtb3VzdGFjaGU6ICdcdTIzQjEnLA0KICAgIHJubWlkOiAnXHUyQUVFJywNCiAgICByb2FuZzogJ1x1MjdFRCcsDQogICAgcm9hcnI6ICdcdTIxRkUnLA0KICAgIHJvYnJrOiAnXHUyN0U3JywNCiAgICByb3BhcjogJ1x1Mjk4NicsDQogICAgcm9wZjogJ1x1RDgzNVx1REQ2MycsDQogICAgcm9wbHVzOiAnXHUyQTJFJywNCiAgICByb3RpbWVzOiAnXHUyQTM1JywNCiAgICBycGFyOiAnXHUwMDI5JywNCiAgICBycGFyZ3Q6ICdcdTI5OTQnLA0KICAgIHJwcG9saW50OiAnXHUyQTEyJywNCiAgICBycmFycjogJ1x1MjFDOScsDQogICAgcnNhcXVvOiAnXHUyMDNBJywNCiAgICByc2NyOiAnXHVEODM1XHVEQ0M3JywNCiAgICByc2g6ICdcdTIxQjEnLA0KICAgIHJzcWI6ICdcdTAwNUQnLA0KICAgIHJzcXVvOiAnXHUyMDE5JywNCiAgICByc3F1b3I6ICdcdTIwMTknLA0KICAgIHJ0aHJlZTogJ1x1MjJDQycsDQogICAgcnRpbWVzOiAnXHUyMkNBJywNCiAgICBydHJpOiAnXHUyNUI5JywNCiAgICBydHJpZTogJ1x1MjJCNScsDQogICAgcnRyaWY6ICdcdTI1QjgnLA0KICAgIHJ0cmlsdHJpOiAnXHUyOUNFJywNCiAgICBydWx1aGFyOiAnXHUyOTY4JywNCiAgICByeDogJ1x1MjExRScsDQogICAgc2FjdXRlOiAnXHUwMTVCJywNCiAgICBzYnF1bzogJ1x1MjAxQScsDQogICAgc2M6ICdcdTIyN0InLA0KICAgIHNjRTogJ1x1MkFCNCcsDQogICAgc2NhcDogJ1x1MkFCOCcsDQogICAgc2Nhcm9uOiAnXHUwMTYxJywNCiAgICBzY2N1ZTogJ1x1MjI3RCcsDQogICAgc2NlOiAnXHUyQUIwJywNCiAgICBzY2VkaWw6ICdcdTAxNUYnLA0KICAgIHNjaXJjOiAnXHUwMTVEJywNCiAgICBzY25FOiAnXHUyQUI2JywNCiAgICBzY25hcDogJ1x1MkFCQScsDQogICAgc2Nuc2ltOiAnXHUyMkU5JywNCiAgICBzY3BvbGludDogJ1x1MkExMycsDQogICAgc2NzaW06ICdcdTIyN0YnLA0KICAgIHNjeTogJ1x1MDQ0MScsDQogICAgc2RvdDogJ1x1MjJDNScsDQogICAgc2RvdGI6ICdcdTIyQTEnLA0KICAgIHNkb3RlOiAnXHUyQTY2JywNCiAgICBzZUFycjogJ1x1MjFEOCcsDQogICAgc2VhcmhrOiAnXHUyOTI1JywNCiAgICBzZWFycjogJ1x1MjE5OCcsDQogICAgc2VhcnJvdzogJ1x1MjE5OCcsDQogICAgc2VjdDogJ1x1MDBBNycsDQogICAgc2VtaTogJ1x1MDAzQicsDQogICAgc2Vzd2FyOiAnXHUyOTI5JywNCiAgICBzZXRtaW51czogJ1x1MjIxNicsDQogICAgc2V0bW46ICdcdTIyMTYnLA0KICAgIHNleHQ6ICdcdTI3MzYnLA0KICAgIHNmcjogJ1x1RDgzNVx1REQzMCcsDQogICAgc2Zyb3duOiAnXHUyMzIyJywNCiAgICBzaGFycDogJ1x1MjY2RicsDQogICAgc2hjaGN5OiAnXHUwNDQ5JywNCiAgICBzaGN5OiAnXHUwNDQ4JywNCiAgICBzaG9ydG1pZDogJ1x1MjIyMycsDQogICAgc2hvcnRwYXJhbGxlbDogJ1x1MjIyNScsDQogICAgc2h5OiAnXHUwMEFEJywNCiAgICBzaWdtYTogJ1x1MDNDMycsDQogICAgc2lnbWFmOiAnXHUwM0MyJywNCiAgICBzaWdtYXY6ICdcdTAzQzInLA0KICAgIHNpbTogJ1x1MjIzQycsDQogICAgc2ltZG90OiAnXHUyQTZBJywNCiAgICBzaW1lOiAnXHUyMjQzJywNCiAgICBzaW1lcTogJ1x1MjI0MycsDQogICAgc2ltZzogJ1x1MkE5RScsDQogICAgc2ltZ0U6ICdcdTJBQTAnLA0KICAgIHNpbWw6ICdcdTJBOUQnLA0KICAgIHNpbWxFOiAnXHUyQTlGJywNCiAgICBzaW1uZTogJ1x1MjI0NicsDQogICAgc2ltcGx1czogJ1x1MkEyNCcsDQogICAgc2ltcmFycjogJ1x1Mjk3MicsDQogICAgc2xhcnI6ICdcdTIxOTAnLA0KICAgIHNtYWxsc2V0bWludXM6ICdcdTIyMTYnLA0KICAgIHNtYXNocDogJ1x1MkEzMycsDQogICAgc21lcGFyc2w6ICdcdTI5RTQnLA0KICAgIHNtaWQ6ICdcdTIyMjMnLA0KICAgIHNtaWxlOiAnXHUyMzIzJywNCiAgICBzbXQ6ICdcdTJBQUEnLA0KICAgIHNtdGU6ICdcdTJBQUMnLA0KICAgIHNtdGVzOiAnXHUyQUFDXHVGRTAwJywNCiAgICBzb2Z0Y3k6ICdcdTA0NEMnLA0KICAgIHNvbDogJ1x1MDAyRicsDQogICAgc29sYjogJ1x1MjlDNCcsDQogICAgc29sYmFyOiAnXHUyMzNGJywNCiAgICBzb3BmOiAnXHVEODM1XHVERDY0JywNCiAgICBzcGFkZXM6ICdcdTI2NjAnLA0KICAgIHNwYWRlc3VpdDogJ1x1MjY2MCcsDQogICAgc3BhcjogJ1x1MjIyNScsDQogICAgc3FjYXA6ICdcdTIyOTMnLA0KICAgIHNxY2FwczogJ1x1MjI5M1x1RkUwMCcsDQogICAgc3FjdXA6ICdcdTIyOTQnLA0KICAgIHNxY3VwczogJ1x1MjI5NFx1RkUwMCcsDQogICAgc3FzdWI6ICdcdTIyOEYnLA0KICAgIHNxc3ViZTogJ1x1MjI5MScsDQogICAgc3FzdWJzZXQ6ICdcdTIyOEYnLA0KICAgIHNxc3Vic2V0ZXE6ICdcdTIyOTEnLA0KICAgIHNxc3VwOiAnXHUyMjkwJywNCiAgICBzcXN1cGU6ICdcdTIyOTInLA0KICAgIHNxc3Vwc2V0OiAnXHUyMjkwJywNCiAgICBzcXN1cHNldGVxOiAnXHUyMjkyJywNCiAgICBzcXU6ICdcdTI1QTEnLA0KICAgIHNxdWFyZTogJ1x1MjVBMScsDQogICAgc3F1YXJmOiAnXHUyNUFBJywNCiAgICBzcXVmOiAnXHUyNUFBJywNCiAgICBzcmFycjogJ1x1MjE5MicsDQogICAgc3NjcjogJ1x1RDgzNVx1RENDOCcsDQogICAgc3NldG1uOiAnXHUyMjE2JywNCiAgICBzc21pbGU6ICdcdTIzMjMnLA0KICAgIHNzdGFyZjogJ1x1MjJDNicsDQogICAgc3RhcjogJ1x1MjYwNicsDQogICAgc3RhcmY6ICdcdTI2MDUnLA0KICAgIHN0cmFpZ2h0ZXBzaWxvbjogJ1x1MDNGNScsDQogICAgc3RyYWlnaHRwaGk6ICdcdTAzRDUnLA0KICAgIHN0cm5zOiAnXHUwMEFGJywNCiAgICBzdWI6ICdcdTIyODInLA0KICAgIHN1YkU6ICdcdTJBQzUnLA0KICAgIHN1YmRvdDogJ1x1MkFCRCcsDQogICAgc3ViZTogJ1x1MjI4NicsDQogICAgc3ViZWRvdDogJ1x1MkFDMycsDQogICAgc3VibXVsdDogJ1x1MkFDMScsDQogICAgc3VibkU6ICdcdTJBQ0InLA0KICAgIHN1Ym5lOiAnXHUyMjhBJywNCiAgICBzdWJwbHVzOiAnXHUyQUJGJywNCiAgICBzdWJyYXJyOiAnXHUyOTc5JywNCiAgICBzdWJzZXQ6ICdcdTIyODInLA0KICAgIHN1YnNldGVxOiAnXHUyMjg2JywNCiAgICBzdWJzZXRlcXE6ICdcdTJBQzUnLA0KICAgIHN1YnNldG5lcTogJ1x1MjI4QScsDQogICAgc3Vic2V0bmVxcTogJ1x1MkFDQicsDQogICAgc3Vic2ltOiAnXHUyQUM3JywNCiAgICBzdWJzdWI6ICdcdTJBRDUnLA0KICAgIHN1YnN1cDogJ1x1MkFEMycsDQogICAgc3VjYzogJ1x1MjI3QicsDQogICAgc3VjY2FwcHJveDogJ1x1MkFCOCcsDQogICAgc3VjY2N1cmx5ZXE6ICdcdTIyN0QnLA0KICAgIHN1Y2NlcTogJ1x1MkFCMCcsDQogICAgc3VjY25hcHByb3g6ICdcdTJBQkEnLA0KICAgIHN1Y2NuZXFxOiAnXHUyQUI2JywNCiAgICBzdWNjbnNpbTogJ1x1MjJFOScsDQogICAgc3VjY3NpbTogJ1x1MjI3RicsDQogICAgc3VtOiAnXHUyMjExJywNCiAgICBzdW5nOiAnXHUyNjZBJywNCiAgICBzdXAxOiAnXHUwMEI5JywNCiAgICBzdXAyOiAnXHUwMEIyJywNCiAgICBzdXAzOiAnXHUwMEIzJywNCiAgICBzdXA6ICdcdTIyODMnLA0KICAgIHN1cEU6ICdcdTJBQzYnLA0KICAgIHN1cGRvdDogJ1x1MkFCRScsDQogICAgc3VwZHN1YjogJ1x1MkFEOCcsDQogICAgc3VwZTogJ1x1MjI4NycsDQogICAgc3VwZWRvdDogJ1x1MkFDNCcsDQogICAgc3VwaHNvbDogJ1x1MjdDOScsDQogICAgc3VwaHN1YjogJ1x1MkFENycsDQogICAgc3VwbGFycjogJ1x1Mjk3QicsDQogICAgc3VwbXVsdDogJ1x1MkFDMicsDQogICAgc3VwbkU6ICdcdTJBQ0MnLA0KICAgIHN1cG5lOiAnXHUyMjhCJywNCiAgICBzdXBwbHVzOiAnXHUyQUMwJywNCiAgICBzdXBzZXQ6ICdcdTIyODMnLA0KICAgIHN1cHNldGVxOiAnXHUyMjg3JywNCiAgICBzdXBzZXRlcXE6ICdcdTJBQzYnLA0KICAgIHN1cHNldG5lcTogJ1x1MjI4QicsDQogICAgc3Vwc2V0bmVxcTogJ1x1MkFDQycsDQogICAgc3Vwc2ltOiAnXHUyQUM4JywNCiAgICBzdXBzdWI6ICdcdTJBRDQnLA0KICAgIHN1cHN1cDogJ1x1MkFENicsDQogICAgc3dBcnI6ICdcdTIxRDknLA0KICAgIHN3YXJoazogJ1x1MjkyNicsDQogICAgc3dhcnI6ICdcdTIxOTknLA0KICAgIHN3YXJyb3c6ICdcdTIxOTknLA0KICAgIHN3bndhcjogJ1x1MjkyQScsDQogICAgc3psaWc6ICdcdTAwREYnLA0KICAgIHRhcmdldDogJ1x1MjMxNicsDQogICAgdGF1OiAnXHUwM0M0JywNCiAgICB0YnJrOiAnXHUyM0I0JywNCiAgICB0Y2Fyb246ICdcdTAxNjUnLA0KICAgIHRjZWRpbDogJ1x1MDE2MycsDQogICAgdGN5OiAnXHUwNDQyJywNCiAgICB0ZG90OiAnXHUyMERCJywNCiAgICB0ZWxyZWM6ICdcdTIzMTUnLA0KICAgIHRmcjogJ1x1RDgzNVx1REQzMScsDQogICAgdGhlcmU0OiAnXHUyMjM0JywNCiAgICB0aGVyZWZvcmU6ICdcdTIyMzQnLA0KICAgIHRoZXRhOiAnXHUwM0I4JywNCiAgICB0aGV0YXN5bTogJ1x1MDNEMScsDQogICAgdGhldGF2OiAnXHUwM0QxJywNCiAgICB0aGlja2FwcHJveDogJ1x1MjI0OCcsDQogICAgdGhpY2tzaW06ICdcdTIyM0MnLA0KICAgIHRoaW5zcDogJ1x1MjAwOScsDQogICAgdGhrYXA6ICdcdTIyNDgnLA0KICAgIHRoa3NpbTogJ1x1MjIzQycsDQogICAgdGhvcm46ICdcdTAwRkUnLA0KICAgIHRpbGRlOiAnXHUwMkRDJywNCiAgICB0aW1lczogJ1x1MDBENycsDQogICAgdGltZXNiOiAnXHUyMkEwJywNCiAgICB0aW1lc2JhcjogJ1x1MkEzMScsDQogICAgdGltZXNkOiAnXHUyQTMwJywNCiAgICB0aW50OiAnXHUyMjJEJywNCiAgICB0b2VhOiAnXHUyOTI4JywNCiAgICB0b3A6ICdcdTIyQTQnLA0KICAgIHRvcGJvdDogJ1x1MjMzNicsDQogICAgdG9wY2lyOiAnXHUyQUYxJywNCiAgICB0b3BmOiAnXHVEODM1XHVERDY1JywNCiAgICB0b3Bmb3JrOiAnXHUyQURBJywNCiAgICB0b3NhOiAnXHUyOTI5JywNCiAgICB0cHJpbWU6ICdcdTIwMzQnLA0KICAgIHRyYWRlOiAnXHUyMTIyJywNCiAgICB0cmlhbmdsZTogJ1x1MjVCNScsDQogICAgdHJpYW5nbGVkb3duOiAnXHUyNUJGJywNCiAgICB0cmlhbmdsZWxlZnQ6ICdcdTI1QzMnLA0KICAgIHRyaWFuZ2xlbGVmdGVxOiAnXHUyMkI0JywNCiAgICB0cmlhbmdsZXE6ICdcdTIyNUMnLA0KICAgIHRyaWFuZ2xlcmlnaHQ6ICdcdTI1QjknLA0KICAgIHRyaWFuZ2xlcmlnaHRlcTogJ1x1MjJCNScsDQogICAgdHJpZG90OiAnXHUyNUVDJywNCiAgICB0cmllOiAnXHUyMjVDJywNCiAgICB0cmltaW51czogJ1x1MkEzQScsDQogICAgdHJpcGx1czogJ1x1MkEzOScsDQogICAgdHJpc2I6ICdcdTI5Q0QnLA0KICAgIHRyaXRpbWU6ICdcdTJBM0InLA0KICAgIHRycGV6aXVtOiAnXHUyM0UyJywNCiAgICB0c2NyOiAnXHVEODM1XHVEQ0M5JywNCiAgICB0c2N5OiAnXHUwNDQ2JywNCiAgICB0c2hjeTogJ1x1MDQ1QicsDQogICAgdHN0cm9rOiAnXHUwMTY3JywNCiAgICB0d2l4dDogJ1x1MjI2QycsDQogICAgdHdvaGVhZGxlZnRhcnJvdzogJ1x1MjE5RScsDQogICAgdHdvaGVhZHJpZ2h0YXJyb3c6ICdcdTIxQTAnLA0KICAgIHVBcnI6ICdcdTIxRDEnLA0KICAgIHVIYXI6ICdcdTI5NjMnLA0KICAgIHVhY3V0ZTogJ1x1MDBGQScsDQogICAgdWFycjogJ1x1MjE5MScsDQogICAgdWJyY3k6ICdcdTA0NUUnLA0KICAgIHVicmV2ZTogJ1x1MDE2RCcsDQogICAgdWNpcmM6ICdcdTAwRkInLA0KICAgIHVjeTogJ1x1MDQ0MycsDQogICAgdWRhcnI6ICdcdTIxQzUnLA0KICAgIHVkYmxhYzogJ1x1MDE3MScsDQogICAgdWRoYXI6ICdcdTI5NkUnLA0KICAgIHVmaXNodDogJ1x1Mjk3RScsDQogICAgdWZyOiAnXHVEODM1XHVERDMyJywNCiAgICB1Z3JhdmU6ICdcdTAwRjknLA0KICAgIHVoYXJsOiAnXHUyMUJGJywNCiAgICB1aGFycjogJ1x1MjFCRScsDQogICAgdWhibGs6ICdcdTI1ODAnLA0KICAgIHVsY29ybjogJ1x1MjMxQycsDQogICAgdWxjb3JuZXI6ICdcdTIzMUMnLA0KICAgIHVsY3JvcDogJ1x1MjMwRicsDQogICAgdWx0cmk6ICdcdTI1RjgnLA0KICAgIHVtYWNyOiAnXHUwMTZCJywNCiAgICB1bWw6ICdcdTAwQTgnLA0KICAgIHVvZ29uOiAnXHUwMTczJywNCiAgICB1b3BmOiAnXHVEODM1XHVERDY2JywNCiAgICB1cGFycm93OiAnXHUyMTkxJywNCiAgICB1cGRvd25hcnJvdzogJ1x1MjE5NScsDQogICAgdXBoYXJwb29ubGVmdDogJ1x1MjFCRicsDQogICAgdXBoYXJwb29ucmlnaHQ6ICdcdTIxQkUnLA0KICAgIHVwbHVzOiAnXHUyMjhFJywNCiAgICB1cHNpOiAnXHUwM0M1JywNCiAgICB1cHNpaDogJ1x1MDNEMicsDQogICAgdXBzaWxvbjogJ1x1MDNDNScsDQogICAgdXB1cGFycm93czogJ1x1MjFDOCcsDQogICAgdXJjb3JuOiAnXHUyMzFEJywNCiAgICB1cmNvcm5lcjogJ1x1MjMxRCcsDQogICAgdXJjcm9wOiAnXHUyMzBFJywNCiAgICB1cmluZzogJ1x1MDE2RicsDQogICAgdXJ0cmk6ICdcdTI1RjknLA0KICAgIHVzY3I6ICdcdUQ4MzVcdURDQ0EnLA0KICAgIHV0ZG90OiAnXHUyMkYwJywNCiAgICB1dGlsZGU6ICdcdTAxNjknLA0KICAgIHV0cmk6ICdcdTI1QjUnLA0KICAgIHV0cmlmOiAnXHUyNUI0JywNCiAgICB1dWFycjogJ1x1MjFDOCcsDQogICAgdXVtbDogJ1x1MDBGQycsDQogICAgdXdhbmdsZTogJ1x1MjlBNycsDQogICAgdkFycjogJ1x1MjFENScsDQogICAgdkJhcjogJ1x1MkFFOCcsDQogICAgdkJhcnY6ICdcdTJBRTknLA0KICAgIHZEYXNoOiAnXHUyMkE4JywNCiAgICB2YW5ncnQ6ICdcdTI5OUMnLA0KICAgIHZhcmVwc2lsb246ICdcdTAzRjUnLA0KICAgIHZhcmthcHBhOiAnXHUwM0YwJywNCiAgICB2YXJub3RoaW5nOiAnXHUyMjA1JywNCiAgICB2YXJwaGk6ICdcdTAzRDUnLA0KICAgIHZhcnBpOiAnXHUwM0Q2JywNCiAgICB2YXJwcm9wdG86ICdcdTIyMUQnLA0KICAgIHZhcnI6ICdcdTIxOTUnLA0KICAgIHZhcnJobzogJ1x1MDNGMScsDQogICAgdmFyc2lnbWE6ICdcdTAzQzInLA0KICAgIHZhcnN1YnNldG5lcTogJ1x1MjI4QVx1RkUwMCcsDQogICAgdmFyc3Vic2V0bmVxcTogJ1x1MkFDQlx1RkUwMCcsDQogICAgdmFyc3Vwc2V0bmVxOiAnXHUyMjhCXHVGRTAwJywNCiAgICB2YXJzdXBzZXRuZXFxOiAnXHUyQUNDXHVGRTAwJywNCiAgICB2YXJ0aGV0YTogJ1x1MDNEMScsDQogICAgdmFydHJpYW5nbGVsZWZ0OiAnXHUyMkIyJywNCiAgICB2YXJ0cmlhbmdsZXJpZ2h0OiAnXHUyMkIzJywNCiAgICB2Y3k6ICdcdTA0MzInLA0KICAgIHZkYXNoOiAnXHUyMkEyJywNCiAgICB2ZWU6ICdcdTIyMjgnLA0KICAgIHZlZWJhcjogJ1x1MjJCQicsDQogICAgdmVlZXE6ICdcdTIyNUEnLA0KICAgIHZlbGxpcDogJ1x1MjJFRScsDQogICAgdmVyYmFyOiAnXHUwMDdDJywNCiAgICB2ZXJ0OiAnXHUwMDdDJywNCiAgICB2ZnI6ICdcdUQ4MzVcdUREMzMnLA0KICAgIHZsdHJpOiAnXHUyMkIyJywNCiAgICB2bnN1YjogJ1x1MjI4Mlx1MjBEMicsDQogICAgdm5zdXA6ICdcdTIyODNcdTIwRDInLA0KICAgIHZvcGY6ICdcdUQ4MzVcdURENjcnLA0KICAgIHZwcm9wOiAnXHUyMjFEJywNCiAgICB2cnRyaTogJ1x1MjJCMycsDQogICAgdnNjcjogJ1x1RDgzNVx1RENDQicsDQogICAgdnN1Ym5FOiAnXHUyQUNCXHVGRTAwJywNCiAgICB2c3VibmU6ICdcdTIyOEFcdUZFMDAnLA0KICAgIHZzdXBuRTogJ1x1MkFDQ1x1RkUwMCcsDQogICAgdnN1cG5lOiAnXHUyMjhCXHVGRTAwJywNCiAgICB2emlnemFnOiAnXHUyOTlBJywNCiAgICB3Y2lyYzogJ1x1MDE3NScsDQogICAgd2VkYmFyOiAnXHUyQTVGJywNCiAgICB3ZWRnZTogJ1x1MjIyNycsDQogICAgd2VkZ2VxOiAnXHUyMjU5JywNCiAgICB3ZWllcnA6ICdcdTIxMTgnLA0KICAgIHdmcjogJ1x1RDgzNVx1REQzNCcsDQogICAgd29wZjogJ1x1RDgzNVx1REQ2OCcsDQogICAgd3A6ICdcdTIxMTgnLA0KICAgIHdyOiAnXHUyMjQwJywNCiAgICB3cmVhdGg6ICdcdTIyNDAnLA0KICAgIHdzY3I6ICdcdUQ4MzVcdURDQ0MnLA0KICAgIHhjYXA6ICdcdTIyQzInLA0KICAgIHhjaXJjOiAnXHUyNUVGJywNCiAgICB4Y3VwOiAnXHUyMkMzJywNCiAgICB4ZHRyaTogJ1x1MjVCRCcsDQogICAgeGZyOiAnXHVEODM1XHVERDM1JywNCiAgICB4aEFycjogJ1x1MjdGQScsDQogICAgeGhhcnI6ICdcdTI3RjcnLA0KICAgIHhpOiAnXHUwM0JFJywNCiAgICB4bEFycjogJ1x1MjdGOCcsDQogICAgeGxhcnI6ICdcdTI3RjUnLA0KICAgIHhtYXA6ICdcdTI3RkMnLA0KICAgIHhuaXM6ICdcdTIyRkInLA0KICAgIHhvZG90OiAnXHUyQTAwJywNCiAgICB4b3BmOiAnXHVEODM1XHVERDY5JywNCiAgICB4b3BsdXM6ICdcdTJBMDEnLA0KICAgIHhvdGltZTogJ1x1MkEwMicsDQogICAgeHJBcnI6ICdcdTI3RjknLA0KICAgIHhyYXJyOiAnXHUyN0Y2JywNCiAgICB4c2NyOiAnXHVEODM1XHVEQ0NEJywNCiAgICB4c3FjdXA6ICdcdTJBMDYnLA0KICAgIHh1cGx1czogJ1x1MkEwNCcsDQogICAgeHV0cmk6ICdcdTI1QjMnLA0KICAgIHh2ZWU6ICdcdTIyQzEnLA0KICAgIHh3ZWRnZTogJ1x1MjJDMCcsDQogICAgeWFjdXRlOiAnXHUwMEZEJywNCiAgICB5YWN5OiAnXHUwNDRGJywNCiAgICB5Y2lyYzogJ1x1MDE3NycsDQogICAgeWN5OiAnXHUwNDRCJywNCiAgICB5ZW46ICdcdTAwQTUnLA0KICAgIHlmcjogJ1x1RDgzNVx1REQzNicsDQogICAgeWljeTogJ1x1MDQ1NycsDQogICAgeW9wZjogJ1x1RDgzNVx1REQ2QScsDQogICAgeXNjcjogJ1x1RDgzNVx1RENDRScsDQogICAgeXVjeTogJ1x1MDQ0RScsDQogICAgeXVtbDogJ1x1MDBGRicsDQogICAgemFjdXRlOiAnXHUwMTdBJywNCiAgICB6Y2Fyb246ICdcdTAxN0UnLA0KICAgIHpjeTogJ1x1MDQzNycsDQogICAgemRvdDogJ1x1MDE3QycsDQogICAgemVldHJmOiAnXHUyMTI4JywNCiAgICB6ZXRhOiAnXHUwM0I2JywNCiAgICB6ZnI6ICdcdUQ4MzVcdUREMzcnLA0KICAgIHpoY3k6ICdcdTA0MzYnLA0KICAgIHppZ3JhcnI6ICdcdTIxREQnLA0KICAgIHpvcGY6ICdcdUQ4MzVcdURENkInLA0KICAgIHpzY3I6ICdcdUQ4MzVcdURDQ0YnLA0KICAgIHp3ajogJ1x1MjAwRCcsDQogICAgenduajogJ1x1MjAwQycNCn07DQpjb25zdCBkZWNvZGVNYXAgPSB7DQogICAgJzAnOiA2NTUzMywNCiAgICAnMTI4JzogODM2NCwNCiAgICAnMTMwJzogODIxOCwNCiAgICAnMTMxJzogNDAyLA0KICAgICcxMzInOiA4MjIyLA0KICAgICcxMzMnOiA4MjMwLA0KICAgICcxMzQnOiA4MjI0LA0KICAgICcxMzUnOiA4MjI1LA0KICAgICcxMzYnOiA3MTAsDQogICAgJzEzNyc6IDgyNDAsDQogICAgJzEzOCc6IDM1MiwNCiAgICAnMTM5JzogODI0OSwNCiAgICAnMTQwJzogMzM4LA0KICAgICcxNDInOiAzODEsDQogICAgJzE0NSc6IDgyMTYsDQogICAgJzE0Nic6IDgyMTcsDQogICAgJzE0Nyc6IDgyMjAsDQogICAgJzE0OCc6IDgyMjEsDQogICAgJzE0OSc6IDgyMjYsDQogICAgJzE1MCc6IDgyMTEsDQogICAgJzE1MSc6IDgyMTIsDQogICAgJzE1Mic6IDczMiwNCiAgICAnMTUzJzogODQ4MiwNCiAgICAnMTU0JzogMzUzLA0KICAgICcxNTUnOiA4MjUwLA0KICAgICcxNTYnOiAzMzksDQogICAgJzE1OCc6IDM4MiwNCiAgICAnMTU5JzogMzc2DQp9Ow0KZnVuY3Rpb24gZGVjb2RlSFRNTFN0cmljdCh0ZXh0KSB7DQogICAgcmV0dXJuIHRleHQucmVwbGFjZSgvJig/OlthLXpBLVpdK3wjW3hYXVtcZGEtZkEtRl0rfCNcZCspOy9nLCAoa2V5KSA9PiB7DQogICAgICAgIGlmIChrZXkuY2hhckF0KDEpID09PSAnIycpIHsNCiAgICAgICAgICAgIGNvbnN0IHNlY29uZENoYXIgPSBrZXkuY2hhckF0KDIpOw0KICAgICAgICAgICAgY29uc3QgY29kZVBvaW50ID0gc2Vjb25kQ2hhciA9PT0gJ1gnIHx8IHNlY29uZENoYXIgPT09ICd4Jw0KICAgICAgICAgICAgICAgID8gcGFyc2VJbnQoa2V5LnNsaWNlKDMpLCAxNikNCiAgICAgICAgICAgICAgICA6IHBhcnNlSW50KGtleS5zbGljZSgyKSwgMTApOw0KICAgICAgICAgICAgcmV0dXJuIGRlY29kZUNvZGVQb2ludChjb2RlUG9pbnQpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBlbnRpdGllc1trZXkuc2xpY2UoMSwgLTEpXSB8fCBrZXk7DQogICAgfSk7DQp9DQpmdW5jdGlvbiBkZWNvZGVDb2RlUG9pbnQoY29kZVBvaW50KSB7DQogICAgaWYgKChjb2RlUG9pbnQgPj0gMHhkODAwICYmIGNvZGVQb2ludCA8PSAweGRmZmYpIHx8IGNvZGVQb2ludCA+IDB4MTBmZmZmKSB7DQogICAgICAgIHJldHVybiAnXHVGRkZEJzsNCiAgICB9DQogICAgaWYgKGNvZGVQb2ludCBpbiBkZWNvZGVNYXApIHsNCiAgICAgICAgY29kZVBvaW50ID0gZGVjb2RlTWFwW2NvZGVQb2ludF07DQogICAgfQ0KICAgIHJldHVybiBTdHJpbmcuZnJvbUNvZGVQb2ludChjb2RlUG9pbnQpOw0KfQoKZnVuY3Rpb24gc2NhbkpTWEF0dHJpYnV0ZVZhbHVlKHBhcnNlciwgY29udGV4dCkgew0KICAgIHBhcnNlci5zdGFydFBvcyA9IHBhcnNlci50b2tlblBvcyA9IHBhcnNlci5pbmRleDsNCiAgICBwYXJzZXIuc3RhcnRDb2x1bW4gPSBwYXJzZXIuY29sUG9zID0gcGFyc2VyLmNvbHVtbjsNCiAgICBwYXJzZXIuc3RhcnRMaW5lID0gcGFyc2VyLmxpbmVQb3MgPSBwYXJzZXIubGluZTsNCiAgICBwYXJzZXIudG9rZW4gPQ0KICAgICAgICBDaGFyVHlwZXNbcGFyc2VyLmN1cnJlbnRDaGFyXSAmIDgxOTINCiAgICAgICAgICAgID8gc2NhbkpTWFN0cmluZyhwYXJzZXIsIGNvbnRleHQpDQogICAgICAgICAgICA6IHNjYW5TaW5nbGVUb2tlbihwYXJzZXIsIGNvbnRleHQsIDApOw0KICAgIHJldHVybiBwYXJzZXIudG9rZW47DQp9DQpmdW5jdGlvbiBzY2FuSlNYU3RyaW5nKHBhcnNlciwgY29udGV4dCkgew0KICAgIGNvbnN0IHF1b3RlID0gcGFyc2VyLmN1cnJlbnRDaGFyOw0KICAgIGxldCBjaGFyID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICBjb25zdCBzdGFydCA9IHBhcnNlci5pbmRleDsNCiAgICB3aGlsZSAoY2hhciAhPT0gcXVvdGUpIHsNCiAgICAgICAgaWYgKHBhcnNlci5pbmRleCA+PSBwYXJzZXIuZW5kKQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTQpOw0KICAgICAgICBjaGFyID0gYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICB9DQogICAgaWYgKGNoYXIgIT09IHF1b3RlKQ0KICAgICAgICByZXBvcnQocGFyc2VyLCAxNCk7DQogICAgcGFyc2VyLnRva2VuVmFsdWUgPSBwYXJzZXIuc291cmNlLnNsaWNlKHN0YXJ0LCBwYXJzZXIuaW5kZXgpOw0KICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgaWYgKGNvbnRleHQgJiA1MTIpDQogICAgICAgIHBhcnNlci50b2tlblJhdyA9IHBhcnNlci5zb3VyY2Uuc2xpY2UocGFyc2VyLnRva2VuUG9zLCBwYXJzZXIuaW5kZXgpOw0KICAgIHJldHVybiAxMzQyODMyNjc7DQp9DQpmdW5jdGlvbiBzY2FuSlNYVG9rZW4ocGFyc2VyLCBjb250ZXh0KSB7DQogICAgcGFyc2VyLnN0YXJ0UG9zID0gcGFyc2VyLnRva2VuUG9zID0gcGFyc2VyLmluZGV4Ow0KICAgIHBhcnNlci5zdGFydENvbHVtbiA9IHBhcnNlci5jb2xQb3MgPSBwYXJzZXIuY29sdW1uOw0KICAgIHBhcnNlci5zdGFydExpbmUgPSBwYXJzZXIubGluZVBvcyA9IHBhcnNlci5saW5lOw0KICAgIGlmIChwYXJzZXIuaW5kZXggPj0gcGFyc2VyLmVuZCkNCiAgICAgICAgcmV0dXJuIChwYXJzZXIudG9rZW4gPSAxMDQ4NTc2KTsNCiAgICBjb25zdCB0b2tlbiA9IFRva2VuTG9va3VwW3BhcnNlci5zb3VyY2UuY2hhckNvZGVBdChwYXJzZXIuaW5kZXgpXTsNCiAgICBzd2l0Y2ggKHRva2VuKSB7DQogICAgICAgIGNhc2UgODQ1NjI1ODogew0KICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgIGlmIChwYXJzZXIuY3VycmVudENoYXIgPT09IDQ3KSB7DQogICAgICAgICAgICAgICAgYWR2YW5jZUNoYXIocGFyc2VyKTsNCiAgICAgICAgICAgICAgICBwYXJzZXIudG9rZW4gPSAyNTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIHBhcnNlci50b2tlbiA9IDg0NTYyNTg7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgICAgICBjYXNlIDIxNjI3MDA6IHsNCiAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICBwYXJzZXIudG9rZW4gPSAyMTYyNzAwOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgZGVmYXVsdDogew0KICAgICAgICAgICAgbGV0IHN0YXRlID0gMDsNCiAgICAgICAgICAgIHdoaWxlIChwYXJzZXIuaW5kZXggPCBwYXJzZXIuZW5kKSB7DQogICAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IENoYXJUeXBlc1twYXJzZXIuc291cmNlLmNoYXJDb2RlQXQocGFyc2VyLmluZGV4KV07DQogICAgICAgICAgICAgICAgaWYgKHR5cGUgJiAxMDI0KSB7DQogICAgICAgICAgICAgICAgICAgIHN0YXRlIHw9IDEgfCA0Ow0KICAgICAgICAgICAgICAgICAgICBzY2FuTmV3TGluZShwYXJzZXIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlICYgMjA0OCkgew0KICAgICAgICAgICAgICAgICAgICBjb25zdW1lTGluZUZlZWQocGFyc2VyLCBzdGF0ZSk7DQogICAgICAgICAgICAgICAgICAgIHN0YXRlID0gKHN0YXRlICYgfjQpIHwgMTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChDaGFyVHlwZXNbcGFyc2VyLmN1cnJlbnRDaGFyXSAmIDE2Mzg0KQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHJhdyA9IHBhcnNlci5zb3VyY2Uuc2xpY2UocGFyc2VyLnRva2VuUG9zLCBwYXJzZXIuaW5kZXgpOw0KICAgICAgICAgICAgaWYgKGNvbnRleHQgJiA1MTIpDQogICAgICAgICAgICAgICAgcGFyc2VyLnRva2VuUmF3ID0gcmF3Ow0KICAgICAgICAgICAgcGFyc2VyLnRva2VuVmFsdWUgPSBkZWNvZGVIVE1MU3RyaWN0KHJhdyk7DQogICAgICAgICAgICBwYXJzZXIudG9rZW4gPSAxMzg7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHBhcnNlci50b2tlbjsNCn0NCmZ1bmN0aW9uIHNjYW5KU1hJZGVudGlmaWVyKHBhcnNlcikgew0KICAgIGlmICgocGFyc2VyLnRva2VuICYgMTQzMzYwKSA9PT0gMTQzMzYwKSB7DQogICAgICAgIGNvbnN0IHsgaW5kZXggfSA9IHBhcnNlcjsNCiAgICAgICAgbGV0IGNoYXIgPSBwYXJzZXIuY3VycmVudENoYXI7DQogICAgICAgIHdoaWxlIChDaGFyVHlwZXNbY2hhcl0gJiAoMzI3NjggfCAyKSkgew0KICAgICAgICAgICAgY2hhciA9IGFkdmFuY2VDaGFyKHBhcnNlcik7DQogICAgICAgIH0NCiAgICAgICAgcGFyc2VyLnRva2VuVmFsdWUgKz0gcGFyc2VyLnNvdXJjZS5zbGljZShpbmRleCwgcGFyc2VyLmluZGV4KTsNCiAgICB9DQogICAgcGFyc2VyLnRva2VuID0gMjA4ODk3Ow0KICAgIHJldHVybiBwYXJzZXIudG9rZW47DQp9CgpmdW5jdGlvbiBtYXRjaE9ySW5zZXJ0U2VtaWNvbG9uKHBhcnNlciwgY29udGV4dCwgc3BlY0RldmlhdGlvbikgew0KICAgIGlmICgocGFyc2VyLmZsYWdzICYgMSkgPT09IDAgJiYNCiAgICAgICAgKHBhcnNlci50b2tlbiAmIDEwNDg1NzYpICE9PSAxMDQ4NTc2ICYmDQogICAgICAgICFzcGVjRGV2aWF0aW9uKSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDI4LCBLZXl3b3JkRGVzY1RhYmxlW3BhcnNlci50b2tlbiAmIDI1NV0pOw0KICAgIH0NCiAgICBjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCwgMTA3NDc5MDQxNyk7DQp9DQpmdW5jdGlvbiBpc1ZhbGlkU3RyaWN0TW9kZShwYXJzZXIsIGluZGV4LCB0b2tlblBvcywgdG9rZW5WYWx1ZSkgew0KICAgIGlmIChpbmRleCAtIHRva2VuUG9zIDwgMTMgJiYgdG9rZW5WYWx1ZSA9PT0gJ3VzZSBzdHJpY3QnKSB7DQogICAgICAgIGlmICgocGFyc2VyLnRva2VuICYgMTA0ODU3NikgPT09IDEwNDg1NzYgfHwgcGFyc2VyLmZsYWdzICYgMSkgew0KICAgICAgICAgICAgcmV0dXJuIDE7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIDA7DQp9DQpmdW5jdGlvbiBvcHRpb25hbEJpdChwYXJzZXIsIGNvbnRleHQsIHQpIHsNCiAgICBpZiAocGFyc2VyLnRva2VuICE9PSB0KQ0KICAgICAgICByZXR1cm4gMDsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICByZXR1cm4gMTsNCn0NCmZ1bmN0aW9uIGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0LCB0KSB7DQogICAgaWYgKHBhcnNlci50b2tlbiAhPT0gdCkNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIHJldHVybiB0cnVlOw0KfQ0KZnVuY3Rpb24gY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIHQpIHsNCiAgICBpZiAocGFyc2VyLnRva2VuICE9PSB0KQ0KICAgICAgICByZXBvcnQocGFyc2VyLCAyMywgS2V5d29yZERlc2NUYWJsZVt0ICYgMjU1XSk7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQp9DQpmdW5jdGlvbiByZWludGVycHJldFRvUGF0dGVybihzdGF0ZSwgbm9kZSkgew0KICAgIHN3aXRjaCAobm9kZS50eXBlKSB7DQogICAgICAgIGNhc2UgJ0FycmF5RXhwcmVzc2lvbic6DQogICAgICAgICAgICBub2RlLnR5cGUgPSAnQXJyYXlQYXR0ZXJuJzsNCiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRzID0gbm9kZS5lbGVtZW50czsNCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBuID0gZWxlbWVudHMubGVuZ3RoOyBpIDwgbjsgKytpKSB7DQogICAgICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IGVsZW1lbnRzW2ldOw0KICAgICAgICAgICAgICAgIGlmIChlbGVtZW50KQ0KICAgICAgICAgICAgICAgICAgICByZWludGVycHJldFRvUGF0dGVybihzdGF0ZSwgZWxlbWVudCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIGNhc2UgJ09iamVjdEV4cHJlc3Npb24nOg0KICAgICAgICAgICAgbm9kZS50eXBlID0gJ09iamVjdFBhdHRlcm4nOw0KICAgICAgICAgICAgY29uc3QgcHJvcGVydGllcyA9IG5vZGUucHJvcGVydGllczsNCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBuID0gcHJvcGVydGllcy5sZW5ndGg7IGkgPCBuOyArK2kpIHsNCiAgICAgICAgICAgICAgICByZWludGVycHJldFRvUGF0dGVybihzdGF0ZSwgcHJvcGVydGllc1tpXSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIGNhc2UgJ0Fzc2lnbm1lbnRFeHByZXNzaW9uJzoNCiAgICAgICAgICAgIG5vZGUudHlwZSA9ICdBc3NpZ25tZW50UGF0dGVybic7DQogICAgICAgICAgICBpZiAobm9kZS5vcGVyYXRvciAhPT0gJz0nKQ0KICAgICAgICAgICAgICAgIHJlcG9ydChzdGF0ZSwgNjkpOw0KICAgICAgICAgICAgZGVsZXRlIG5vZGUub3BlcmF0b3I7DQogICAgICAgICAgICByZWludGVycHJldFRvUGF0dGVybihzdGF0ZSwgbm9kZS5sZWZ0KTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgY2FzZSAnUHJvcGVydHknOg0KICAgICAgICAgICAgcmVpbnRlcnByZXRUb1BhdHRlcm4oc3RhdGUsIG5vZGUudmFsdWUpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICBjYXNlICdTcHJlYWRFbGVtZW50JzoNCiAgICAgICAgICAgIG5vZGUudHlwZSA9ICdSZXN0RWxlbWVudCc7DQogICAgICAgICAgICByZWludGVycHJldFRvUGF0dGVybihzdGF0ZSwgbm9kZS5hcmd1bWVudCk7DQogICAgfQ0KfQ0KZnVuY3Rpb24gdmFsaWRhdGVCaW5kaW5nSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIGtpbmQsIHQsIHNraXBFdmFsQXJnQ2hlY2spIHsNCiAgICBpZiAoY29udGV4dCAmIDEwMjQpIHsNCiAgICAgICAgaWYgKCh0ICYgMzY4NjQpID09PSAzNjg2NCkgew0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTE1KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXNraXBFdmFsQXJnQ2hlY2sgJiYgKHQgJiA1MzcwNzk4MDgpID09PSA1MzcwNzk4MDgpIHsNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDExNik7DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKCh0ICYgMjA0ODApID09PSAyMDQ4MCkgew0KICAgICAgICByZXBvcnQocGFyc2VyLCAxMDApOw0KICAgIH0NCiAgICBpZiAoa2luZCAmICg4IHwgMTYpICYmIHQgPT09IDI0MTczOSkgew0KICAgICAgICByZXBvcnQocGFyc2VyLCA5OCk7DQogICAgfQ0KICAgIGlmIChjb250ZXh0ICYgKDQxOTQzMDQgfCAyMDQ4KSAmJiB0ID09PSAyMDkwMDgpIHsNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgOTYpOw0KICAgIH0NCiAgICBpZiAoY29udGV4dCAmICgyMDk3MTUyIHwgMTAyNCkgJiYgdCA9PT0gMjQxNzczKSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDk1LCAneWllbGQnKTsNCiAgICB9DQp9DQpmdW5jdGlvbiB2YWxpZGF0ZUZ1bmN0aW9uTmFtZShwYXJzZXIsIGNvbnRleHQsIHQpIHsNCiAgICBpZiAoY29udGV4dCAmIDEwMjQpIHsNCiAgICAgICAgaWYgKCh0ICYgMzY4NjQpID09PSAzNjg2NCkgew0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTE1KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoKHQgJiA1MzcwNzk4MDgpID09PSA1MzcwNzk4MDgpIHsNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDExNik7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHQgPT09IDEyMikgew0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgOTMpOw0KICAgICAgICB9DQogICAgICAgIGlmICh0ID09PSAxMjEpIHsNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDkzKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBpZiAoKHQgJiAyMDQ4MCkgPT09IDIwNDgwKSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDEwMCk7DQogICAgfQ0KICAgIGlmIChjb250ZXh0ICYgKDQxOTQzMDQgfCAyMDQ4KSAmJiB0ID09PSAyMDkwMDgpIHsNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgOTYpOw0KICAgIH0NCiAgICBpZiAoY29udGV4dCAmICgyMDk3MTUyIHwgMTAyNCkgJiYgdCA9PT0gMjQxNzczKSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDk1LCAneWllbGQnKTsNCiAgICB9DQp9DQpmdW5jdGlvbiBpc1N0cmljdFJlc2VydmVkV29yZChwYXJzZXIsIGNvbnRleHQsIHQpIHsNCiAgICBpZiAodCA9PT0gMjA5MDA4KSB7DQogICAgICAgIGlmIChjb250ZXh0ICYgKDQxOTQzMDQgfCAyMDQ4KSkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDk2KTsNCiAgICAgICAgcGFyc2VyLmRlc3RydWN0aWJsZSB8PSAxMjg7DQogICAgfQ0KICAgIGlmICh0ID09PSAyNDE3NzMgJiYgY29udGV4dCAmIDIwOTcxNTIpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDk1LCAneWllbGQnKTsNCiAgICByZXR1cm4gKCh0ICYgMjA0ODApID09PSAyMDQ4MCB8fA0KICAgICAgICAodCAmIDM2ODY0KSA9PT0gMzY4NjQgfHwNCiAgICAgICAgdCA9PSAxMjIpOw0KfQ0KZnVuY3Rpb24gaXNQcm9wZXJ0eVdpdGhQcml2YXRlRmllbGRLZXkoZXhwcikgew0KICAgIHJldHVybiAhZXhwci5wcm9wZXJ0eSA/IGZhbHNlIDogZXhwci5wcm9wZXJ0eS50eXBlID09PSAnUHJpdmF0ZUlkZW50aWZpZXInOw0KfQ0KZnVuY3Rpb24gaXNWYWxpZExhYmVsKHBhcnNlciwgbGFiZWxzLCBuYW1lLCBpc0l0ZXJhdGlvblN0YXRlbWVudCkgew0KICAgIHdoaWxlIChsYWJlbHMpIHsNCiAgICAgICAgaWYgKGxhYmVsc1snJCcgKyBuYW1lXSkgew0KICAgICAgICAgICAgaWYgKGlzSXRlcmF0aW9uU3RhdGVtZW50KQ0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDEzNCk7DQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNJdGVyYXRpb25TdGF0ZW1lbnQgJiYgbGFiZWxzLmxvb3ApDQogICAgICAgICAgICBpc0l0ZXJhdGlvblN0YXRlbWVudCA9IDA7DQogICAgICAgIGxhYmVscyA9IGxhYmVsc1snJCddOw0KICAgIH0NCiAgICByZXR1cm4gMDsNCn0NCmZ1bmN0aW9uIHZhbGlkYXRlQW5kRGVjbGFyZUxhYmVsKHBhcnNlciwgbGFiZWxzLCBuYW1lKSB7DQogICAgbGV0IHNldCA9IGxhYmVsczsNCiAgICB3aGlsZSAoc2V0KSB7DQogICAgICAgIGlmIChzZXRbJyQnICsgbmFtZV0pDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMzMsIG5hbWUpOw0KICAgICAgICBzZXQgPSBzZXRbJyQnXTsNCiAgICB9DQogICAgbGFiZWxzWyckJyArIG5hbWVdID0gMTsNCn0NCmZ1bmN0aW9uIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCBub2RlKSB7DQogICAgaWYgKGNvbnRleHQgJiAyKSB7DQogICAgICAgIG5vZGUuc3RhcnQgPSBzdGFydDsNCiAgICAgICAgbm9kZS5lbmQgPSBwYXJzZXIuc3RhcnRQb3M7DQogICAgICAgIG5vZGUucmFuZ2UgPSBbc3RhcnQsIHBhcnNlci5zdGFydFBvc107DQogICAgfQ0KICAgIGlmIChjb250ZXh0ICYgNCkgew0KICAgICAgICBub2RlLmxvYyA9IHsNCiAgICAgICAgICAgIHN0YXJ0OiB7DQogICAgICAgICAgICAgICAgbGluZSwNCiAgICAgICAgICAgICAgICBjb2x1bW4NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBlbmQ6IHsNCiAgICAgICAgICAgICAgICBsaW5lOiBwYXJzZXIuc3RhcnRMaW5lLA0KICAgICAgICAgICAgICAgIGNvbHVtbjogcGFyc2VyLnN0YXJ0Q29sdW1uDQogICAgICAgICAgICB9DQogICAgICAgIH07DQogICAgICAgIGlmIChwYXJzZXIuc291cmNlRmlsZSkgew0KICAgICAgICAgICAgbm9kZS5sb2Muc291cmNlID0gcGFyc2VyLnNvdXJjZUZpbGU7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIG5vZGU7DQp9DQpmdW5jdGlvbiBpc0VxdWFsVGFnTmFtZShlbGVtZW50TmFtZSkgew0KICAgIHN3aXRjaCAoZWxlbWVudE5hbWUudHlwZSkgew0KICAgICAgICBjYXNlICdKU1hJZGVudGlmaWVyJzoNCiAgICAgICAgICAgIHJldHVybiBlbGVtZW50TmFtZS5uYW1lOw0KICAgICAgICBjYXNlICdKU1hOYW1lc3BhY2VkTmFtZSc6DQogICAgICAgICAgICByZXR1cm4gZWxlbWVudE5hbWUubmFtZXNwYWNlICsgJzonICsgZWxlbWVudE5hbWUubmFtZTsNCiAgICAgICAgY2FzZSAnSlNYTWVtYmVyRXhwcmVzc2lvbic6DQogICAgICAgICAgICByZXR1cm4gaXNFcXVhbFRhZ05hbWUoZWxlbWVudE5hbWUub2JqZWN0KSArICcuJyArIGlzRXF1YWxUYWdOYW1lKGVsZW1lbnROYW1lLnByb3BlcnR5KTsNCiAgICB9DQp9DQpmdW5jdGlvbiBjcmVhdGVBcnJvd0hlYWRQYXJzaW5nU2NvcGUocGFyc2VyLCBjb250ZXh0LCB2YWx1ZSkgew0KICAgIGNvbnN0IHNjb3BlID0gYWRkQ2hpbGRTY29wZShjcmVhdGVTY29wZSgpLCAxMDI0KTsNCiAgICBhZGRCbG9ja05hbWUocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgdmFsdWUsIDEsIDApOw0KICAgIHJldHVybiBzY29wZTsNCn0NCmZ1bmN0aW9uIHJlY29yZFNjb3BlRXJyb3IocGFyc2VyLCB0eXBlLCAuLi5wYXJhbXMpIHsNCiAgICBjb25zdCB7IGluZGV4LCBsaW5lLCBjb2x1bW4gfSA9IHBhcnNlcjsNCiAgICByZXR1cm4gew0KICAgICAgICB0eXBlLA0KICAgICAgICBwYXJhbXMsDQogICAgICAgIGluZGV4LA0KICAgICAgICBsaW5lLA0KICAgICAgICBjb2x1bW4NCiAgICB9Ow0KfQ0KZnVuY3Rpb24gY3JlYXRlU2NvcGUoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgICAgcGFyZW50OiB2b2lkIDAsDQogICAgICAgIHR5cGU6IDINCiAgICB9Ow0KfQ0KZnVuY3Rpb24gYWRkQ2hpbGRTY29wZShwYXJlbnQsIHR5cGUpIHsNCiAgICByZXR1cm4gew0KICAgICAgICBwYXJlbnQsDQogICAgICAgIHR5cGUsDQogICAgICAgIHNjb3BlRXJyb3I6IHZvaWQgMA0KICAgIH07DQp9DQpmdW5jdGlvbiBhZGRWYXJPckJsb2NrKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIG5hbWUsIGtpbmQsIG9yaWdpbikgew0KICAgIGlmIChraW5kICYgNCkgew0KICAgICAgICBhZGRWYXJOYW1lKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIG5hbWUsIGtpbmQpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgYWRkQmxvY2tOYW1lKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIG5hbWUsIGtpbmQsIG9yaWdpbik7DQogICAgfQ0KICAgIGlmIChvcmlnaW4gJiA2NCkgew0KICAgICAgICBkZWNsYXJlVW5ib3VuZFZhcmlhYmxlKHBhcnNlciwgbmFtZSk7DQogICAgfQ0KfQ0KZnVuY3Rpb24gYWRkQmxvY2tOYW1lKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIG5hbWUsIGtpbmQsIG9yaWdpbikgew0KICAgIGNvbnN0IHZhbHVlID0gc2NvcGVbJyMnICsgbmFtZV07DQogICAgaWYgKHZhbHVlICYmICh2YWx1ZSAmIDIpID09PSAwKSB7DQogICAgICAgIGlmIChraW5kICYgMSkgew0KICAgICAgICAgICAgc2NvcGUuc2NvcGVFcnJvciA9IHJlY29yZFNjb3BlRXJyb3IocGFyc2VyLCAxNDEsIG5hbWUpOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKGNvbnRleHQgJiAyNTYgJiYNCiAgICAgICAgICAgIHZhbHVlICYgNjQgJiYNCiAgICAgICAgICAgIG9yaWdpbiAmIDIpIDsNCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxNDEsIG5hbWUpOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChzY29wZS50eXBlICYgMTI4ICYmDQogICAgICAgIChzY29wZS5wYXJlbnRbJyMnICsgbmFtZV0gJiYgKHNjb3BlLnBhcmVudFsnIycgKyBuYW1lXSAmIDIpID09PSAwKSkgew0KICAgICAgICByZXBvcnQocGFyc2VyLCAxNDEsIG5hbWUpOw0KICAgIH0NCiAgICBpZiAoc2NvcGUudHlwZSAmIDEwMjQgJiYgdmFsdWUgJiYgKHZhbHVlICYgMikgPT09IDApIHsNCiAgICAgICAgaWYgKGtpbmQgJiAxKSB7DQogICAgICAgICAgICBzY29wZS5zY29wZUVycm9yID0gcmVjb3JkU2NvcGVFcnJvcihwYXJzZXIsIDE0MSwgbmFtZSk7DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKHNjb3BlLnR5cGUgJiA2NCkgew0KICAgICAgICBpZiAoc2NvcGUucGFyZW50WycjJyArIG5hbWVdICYgNzY4KQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTU0LCBuYW1lKTsNCiAgICB9DQogICAgc2NvcGVbJyMnICsgbmFtZV0gPSBraW5kOw0KfQ0KZnVuY3Rpb24gYWRkVmFyTmFtZShwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBuYW1lLCBraW5kKSB7DQogICAgbGV0IGN1cnJlbnRTY29wZSA9IHNjb3BlOw0KICAgIHdoaWxlIChjdXJyZW50U2NvcGUgJiYgKGN1cnJlbnRTY29wZS50eXBlICYgMjU2KSA9PT0gMCkgew0KICAgICAgICBjb25zdCB2YWx1ZSA9IGN1cnJlbnRTY29wZVsnIycgKyBuYW1lXTsNCiAgICAgICAgaWYgKHZhbHVlICYgMjQ4KSB7DQogICAgICAgICAgICBpZiAoY29udGV4dCAmIDI1NiAmJg0KICAgICAgICAgICAgICAgIChjb250ZXh0ICYgMTAyNCkgPT09IDAgJiYNCiAgICAgICAgICAgICAgICAoKGtpbmQgJiAxMjggJiYgdmFsdWUgJiA2OCkgfHwNCiAgICAgICAgICAgICAgICAgICAgKHZhbHVlICYgMTI4ICYmIGtpbmQgJiA2OCkpKSA7DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxNDEsIG5hbWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmIChjdXJyZW50U2NvcGUgPT09IHNjb3BlKSB7DQogICAgICAgICAgICBpZiAodmFsdWUgJiAxICYmIGtpbmQgJiAxKSB7DQogICAgICAgICAgICAgICAgY3VycmVudFNjb3BlLnNjb3BlRXJyb3IgPSByZWNvcmRTY29wZUVycm9yKHBhcnNlciwgMTQxLCBuYW1lKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAodmFsdWUgJiAoNTEyIHwgMjU2KSkgew0KICAgICAgICAgICAgaWYgKCh2YWx1ZSAmIDUxMikgPT09IDAgfHwNCiAgICAgICAgICAgICAgICAoY29udGV4dCAmIDI1NikgPT09IDAgfHwNCiAgICAgICAgICAgICAgICBjb250ZXh0ICYgMTAyNCkgew0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDE0MSwgbmFtZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgY3VycmVudFNjb3BlWycjJyArIG5hbWVdID0ga2luZDsNCiAgICAgICAgY3VycmVudFNjb3BlID0gY3VycmVudFNjb3BlLnBhcmVudDsNCiAgICB9DQp9DQpmdW5jdGlvbiBkZWNsYXJlVW5ib3VuZFZhcmlhYmxlKHBhcnNlciwgbmFtZSkgew0KICAgIGlmIChwYXJzZXIuZXhwb3J0ZWROYW1lcyAhPT0gdm9pZCAwICYmIG5hbWUgIT09ICcnKSB7DQogICAgICAgIGlmIChwYXJzZXIuZXhwb3J0ZWROYW1lc1snIycgKyBuYW1lXSkgew0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTQyLCBuYW1lKTsNCiAgICAgICAgfQ0KICAgICAgICBwYXJzZXIuZXhwb3J0ZWROYW1lc1snIycgKyBuYW1lXSA9IDE7DQogICAgfQ0KfQ0KZnVuY3Rpb24gYWRkQmluZGluZ1RvRXhwb3J0cyhwYXJzZXIsIG5hbWUpIHsNCiAgICBpZiAocGFyc2VyLmV4cG9ydGVkQmluZGluZ3MgIT09IHZvaWQgMCAmJiBuYW1lICE9PSAnJykgew0KICAgICAgICBwYXJzZXIuZXhwb3J0ZWRCaW5kaW5nc1snIycgKyBuYW1lXSA9IDE7DQogICAgfQ0KfQ0KZnVuY3Rpb24gcHVzaENvbW1lbnQoY29udGV4dCwgYXJyYXkpIHsNCiAgICByZXR1cm4gZnVuY3Rpb24gKHR5cGUsIHZhbHVlLCBzdGFydCwgZW5kLCBsb2MpIHsNCiAgICAgICAgY29uc3QgY29tbWVudCA9IHsNCiAgICAgICAgICAgIHR5cGUsDQogICAgICAgICAgICB2YWx1ZQ0KICAgICAgICB9Ow0KICAgICAgICBpZiAoY29udGV4dCAmIDIpIHsNCiAgICAgICAgICAgIGNvbW1lbnQuc3RhcnQgPSBzdGFydDsNCiAgICAgICAgICAgIGNvbW1lbnQuZW5kID0gZW5kOw0KICAgICAgICAgICAgY29tbWVudC5yYW5nZSA9IFtzdGFydCwgZW5kXTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoY29udGV4dCAmIDQpIHsNCiAgICAgICAgICAgIGNvbW1lbnQubG9jID0gbG9jOw0KICAgICAgICB9DQogICAgICAgIGFycmF5LnB1c2goY29tbWVudCk7DQogICAgfTsNCn0NCmZ1bmN0aW9uIHB1c2hUb2tlbihjb250ZXh0LCBhcnJheSkgew0KICAgIHJldHVybiBmdW5jdGlvbiAodG9rZW4sIHN0YXJ0LCBlbmQsIGxvYykgew0KICAgICAgICBjb25zdCB0b2tlbnMgPSB7DQogICAgICAgICAgICB0b2tlbg0KICAgICAgICB9Ow0KICAgICAgICBpZiAoY29udGV4dCAmIDIpIHsNCiAgICAgICAgICAgIHRva2Vucy5zdGFydCA9IHN0YXJ0Ow0KICAgICAgICAgICAgdG9rZW5zLmVuZCA9IGVuZDsNCiAgICAgICAgICAgIHRva2Vucy5yYW5nZSA9IFtzdGFydCwgZW5kXTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoY29udGV4dCAmIDQpIHsNCiAgICAgICAgICAgIHRva2Vucy5sb2MgPSBsb2M7DQogICAgICAgIH0NCiAgICAgICAgYXJyYXkucHVzaCh0b2tlbnMpOw0KICAgIH07DQp9DQpmdW5jdGlvbiBpc1ZhbGlkSWRlbnRpZmllcihjb250ZXh0LCB0KSB7DQogICAgaWYgKGNvbnRleHQgJiAoMTAyNCB8IDIwOTcxNTIpKSB7DQogICAgICAgIGlmIChjb250ZXh0ICYgMjA0OCAmJiB0ID09PSAyMDkwMDgpDQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIGlmIChjb250ZXh0ICYgMjA5NzE1MiAmJiB0ID09PSAyNDE3NzMpDQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIHJldHVybiAodCAmIDE0MzM2MCkgPT09IDE0MzM2MCB8fCAodCAmIDEyMjg4KSA9PT0gMTIyODg7DQogICAgfQ0KICAgIHJldHVybiAoKHQgJiAxNDMzNjApID09PSAxNDMzNjAgfHwNCiAgICAgICAgKHQgJiAxMjI4OCkgPT09IDEyMjg4IHx8DQogICAgICAgICh0ICYgMzY4NjQpID09PSAzNjg2NCk7DQp9DQpmdW5jdGlvbiBjbGFzc2lmeUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCB0LCBpc0Fycm93KSB7DQogICAgaWYgKCh0ICYgNTM3MDc5ODA4KSA9PT0gNTM3MDc5ODA4KSB7DQogICAgICAgIGlmIChjb250ZXh0ICYgMTAyNCkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDExNik7DQogICAgICAgIGlmIChpc0Fycm93KQ0KICAgICAgICAgICAgcGFyc2VyLmZsYWdzIHw9IDUxMjsNCiAgICB9DQogICAgaWYgKCFpc1ZhbGlkSWRlbnRpZmllcihjb250ZXh0LCB0KSkNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMCk7DQp9CgpmdW5jdGlvbiBjcmVhdGUoc291cmNlLCBzb3VyY2VGaWxlLCBvbkNvbW1lbnQsIG9uVG9rZW4pIHsNCiAgICByZXR1cm4gew0KICAgICAgICBzb3VyY2UsDQogICAgICAgIGZsYWdzOiAwLA0KICAgICAgICBpbmRleDogMCwNCiAgICAgICAgbGluZTogMSwNCiAgICAgICAgY29sdW1uOiAwLA0KICAgICAgICBzdGFydFBvczogMCwNCiAgICAgICAgZW5kOiBzb3VyY2UubGVuZ3RoLA0KICAgICAgICB0b2tlblBvczogMCwNCiAgICAgICAgc3RhcnRDb2x1bW46IDAsDQogICAgICAgIGNvbFBvczogMCwNCiAgICAgICAgbGluZVBvczogMSwNCiAgICAgICAgc3RhcnRMaW5lOiAxLA0KICAgICAgICBzb3VyY2VGaWxlLA0KICAgICAgICB0b2tlblZhbHVlOiAnJywNCiAgICAgICAgdG9rZW46IDEwNDg1NzYsDQogICAgICAgIHRva2VuUmF3OiAnJywNCiAgICAgICAgdG9rZW5SZWdFeHA6IHZvaWQgMCwNCiAgICAgICAgY3VycmVudENoYXI6IHNvdXJjZS5jaGFyQ29kZUF0KDApLA0KICAgICAgICBleHBvcnRlZE5hbWVzOiBbXSwNCiAgICAgICAgZXhwb3J0ZWRCaW5kaW5nczogW10sDQogICAgICAgIGFzc2lnbmFibGU6IDEsDQogICAgICAgIGRlc3RydWN0aWJsZTogMCwNCiAgICAgICAgb25Db21tZW50LA0KICAgICAgICBvblRva2VuLA0KICAgICAgICBsZWFkaW5nRGVjb3JhdG9yczogW10NCiAgICB9Ow0KfQ0KZnVuY3Rpb24gcGFyc2VTb3VyY2Uoc291cmNlLCBvcHRpb25zLCBjb250ZXh0KSB7DQogICAgbGV0IHNvdXJjZUZpbGUgPSAnJzsNCiAgICBsZXQgb25Db21tZW50Ow0KICAgIGxldCBvblRva2VuOw0KICAgIGlmIChvcHRpb25zICE9IG51bGwpIHsNCiAgICAgICAgaWYgKG9wdGlvbnMubW9kdWxlKQ0KICAgICAgICAgICAgY29udGV4dCB8PSAyMDQ4IHwgMTAyNDsNCiAgICAgICAgaWYgKG9wdGlvbnMubmV4dCkNCiAgICAgICAgICAgIGNvbnRleHQgfD0gMTsNCiAgICAgICAgaWYgKG9wdGlvbnMubG9jKQ0KICAgICAgICAgICAgY29udGV4dCB8PSA0Ow0KICAgICAgICBpZiAob3B0aW9ucy5yYW5nZXMpDQogICAgICAgICAgICBjb250ZXh0IHw9IDI7DQogICAgICAgIGlmIChvcHRpb25zLnVuaXF1ZUtleUluUGF0dGVybikNCiAgICAgICAgICAgIGNvbnRleHQgfD0gLTIxNDc0ODM2NDg7DQogICAgICAgIGlmIChvcHRpb25zLmxleGljYWwpDQogICAgICAgICAgICBjb250ZXh0IHw9IDY0Ow0KICAgICAgICBpZiAob3B0aW9ucy53ZWJjb21wYXQpDQogICAgICAgICAgICBjb250ZXh0IHw9IDI1NjsNCiAgICAgICAgaWYgKG9wdGlvbnMuZGlyZWN0aXZlcykNCiAgICAgICAgICAgIGNvbnRleHQgfD0gOCB8IDUxMjsNCiAgICAgICAgaWYgKG9wdGlvbnMuZ2xvYmFsUmV0dXJuKQ0KICAgICAgICAgICAgY29udGV4dCB8PSAzMjsNCiAgICAgICAgaWYgKG9wdGlvbnMucmF3KQ0KICAgICAgICAgICAgY29udGV4dCB8PSA1MTI7DQogICAgICAgIGlmIChvcHRpb25zLnByZXNlcnZlUGFyZW5zKQ0KICAgICAgICAgICAgY29udGV4dCB8PSAxMjg7DQogICAgICAgIGlmIChvcHRpb25zLmltcGxpZWRTdHJpY3QpDQogICAgICAgICAgICBjb250ZXh0IHw9IDEwMjQ7DQogICAgICAgIGlmIChvcHRpb25zLmpzeCkNCiAgICAgICAgICAgIGNvbnRleHQgfD0gMTY7DQogICAgICAgIGlmIChvcHRpb25zLmlkZW50aWZpZXJQYXR0ZXJuKQ0KICAgICAgICAgICAgY29udGV4dCB8PSAyNjg0MzU0NTY7DQogICAgICAgIGlmIChvcHRpb25zLnNwZWNEZXZpYXRpb24pDQogICAgICAgICAgICBjb250ZXh0IHw9IDUzNjg3MDkxMjsNCiAgICAgICAgaWYgKG9wdGlvbnMuc291cmNlKQ0KICAgICAgICAgICAgc291cmNlRmlsZSA9IG9wdGlvbnMuc291cmNlOw0KICAgICAgICBpZiAob3B0aW9ucy5vbkNvbW1lbnQgIT0gbnVsbCkgew0KICAgICAgICAgICAgb25Db21tZW50ID0gQXJyYXkuaXNBcnJheShvcHRpb25zLm9uQ29tbWVudCkgPyBwdXNoQ29tbWVudChjb250ZXh0LCBvcHRpb25zLm9uQ29tbWVudCkgOiBvcHRpb25zLm9uQ29tbWVudDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob3B0aW9ucy5vblRva2VuICE9IG51bGwpIHsNCiAgICAgICAgICAgIG9uVG9rZW4gPSBBcnJheS5pc0FycmF5KG9wdGlvbnMub25Ub2tlbikgPyBwdXNoVG9rZW4oY29udGV4dCwgb3B0aW9ucy5vblRva2VuKSA6IG9wdGlvbnMub25Ub2tlbjsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBjb25zdCBwYXJzZXIgPSBjcmVhdGUoc291cmNlLCBzb3VyY2VGaWxlLCBvbkNvbW1lbnQsIG9uVG9rZW4pOw0KICAgIGlmIChjb250ZXh0ICYgMSkNCiAgICAgICAgc2tpcEhhc2hCYW5nKHBhcnNlcik7DQogICAgY29uc3Qgc2NvcGUgPSBjb250ZXh0ICYgNjQgPyBjcmVhdGVTY29wZSgpIDogdm9pZCAwOw0KICAgIGxldCBib2R5ID0gW107DQogICAgbGV0IHNvdXJjZVR5cGUgPSAnc2NyaXB0JzsNCiAgICBpZiAoY29udGV4dCAmIDIwNDgpIHsNCiAgICAgICAgc291cmNlVHlwZSA9ICdtb2R1bGUnOw0KICAgICAgICBib2R5ID0gcGFyc2VNb2R1bGVJdGVtTGlzdChwYXJzZXIsIGNvbnRleHQgfCA4MTkyLCBzY29wZSk7DQogICAgICAgIGlmIChzY29wZSkgew0KICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gcGFyc2VyLmV4cG9ydGVkQmluZGluZ3MpIHsNCiAgICAgICAgICAgICAgICBpZiAoa2V5WzBdID09PSAnIycgJiYgIXNjb3BlW2tleV0pDQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDE0Mywga2V5LnNsaWNlKDEpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgYm9keSA9IHBhcnNlU3RhdGVtZW50TGlzdChwYXJzZXIsIGNvbnRleHQgfCA4MTkyLCBzY29wZSk7DQogICAgfQ0KICAgIGNvbnN0IG5vZGUgPSB7DQogICAgICAgIHR5cGU6ICdQcm9ncmFtJywNCiAgICAgICAgc291cmNlVHlwZSwNCiAgICAgICAgYm9keQ0KICAgIH07DQogICAgaWYgKGNvbnRleHQgJiAyKSB7DQogICAgICAgIG5vZGUuc3RhcnQgPSAwOw0KICAgICAgICBub2RlLmVuZCA9IHNvdXJjZS5sZW5ndGg7DQogICAgICAgIG5vZGUucmFuZ2UgPSBbMCwgc291cmNlLmxlbmd0aF07DQogICAgfQ0KICAgIGlmIChjb250ZXh0ICYgNCkgew0KICAgICAgICBub2RlLmxvYyA9IHsNCiAgICAgICAgICAgIHN0YXJ0OiB7IGxpbmU6IDEsIGNvbHVtbjogMCB9LA0KICAgICAgICAgICAgZW5kOiB7IGxpbmU6IHBhcnNlci5saW5lLCBjb2x1bW46IHBhcnNlci5jb2x1bW4gfQ0KICAgICAgICB9Ow0KICAgICAgICBpZiAocGFyc2VyLnNvdXJjZUZpbGUpDQogICAgICAgICAgICBub2RlLmxvYy5zb3VyY2UgPSBzb3VyY2VGaWxlOw0KICAgIH0NCiAgICByZXR1cm4gbm9kZTsNCn0NCmZ1bmN0aW9uIHBhcnNlU3RhdGVtZW50TGlzdChwYXJzZXIsIGNvbnRleHQsIHNjb3BlKSB7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDMyNzY4IHwgMTA3Mzc0MTgyNCk7DQogICAgY29uc3Qgc3RhdGVtZW50cyA9IFtdOw0KICAgIHdoaWxlIChwYXJzZXIudG9rZW4gPT09IDEzNDI4MzI2Nykgew0KICAgICAgICBjb25zdCB7IGluZGV4LCB0b2tlblBvcywgdG9rZW5WYWx1ZSwgbGluZVBvcywgY29sUG9zLCB0b2tlbiB9ID0gcGFyc2VyOw0KICAgICAgICBjb25zdCBleHByID0gcGFyc2VMaXRlcmFsKHBhcnNlciwgY29udGV4dCk7DQogICAgICAgIGlmIChpc1ZhbGlkU3RyaWN0TW9kZShwYXJzZXIsIGluZGV4LCB0b2tlblBvcywgdG9rZW5WYWx1ZSkpDQogICAgICAgICAgICBjb250ZXh0IHw9IDEwMjQ7DQogICAgICAgIHN0YXRlbWVudHMucHVzaChwYXJzZURpcmVjdGl2ZShwYXJzZXIsIGNvbnRleHQsIGV4cHIsIHRva2VuLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKSk7DQogICAgfQ0KICAgIHdoaWxlIChwYXJzZXIudG9rZW4gIT09IDEwNDg1NzYpIHsNCiAgICAgICAgc3RhdGVtZW50cy5wdXNoKHBhcnNlU3RhdGVtZW50TGlzdEl0ZW0ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgNCwge30pKTsNCiAgICB9DQogICAgcmV0dXJuIHN0YXRlbWVudHM7DQp9DQpmdW5jdGlvbiBwYXJzZU1vZHVsZUl0ZW1MaXN0KHBhcnNlciwgY29udGV4dCwgc2NvcGUpIHsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIGNvbnN0IHN0YXRlbWVudHMgPSBbXTsNCiAgICBpZiAoY29udGV4dCAmIDgpIHsNCiAgICAgICAgd2hpbGUgKHBhcnNlci50b2tlbiA9PT0gMTM0MjgzMjY3KSB7DQogICAgICAgICAgICBjb25zdCB7IHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHRva2VuIH0gPSBwYXJzZXI7DQogICAgICAgICAgICBzdGF0ZW1lbnRzLnB1c2gocGFyc2VEaXJlY3RpdmUocGFyc2VyLCBjb250ZXh0LCBwYXJzZUxpdGVyYWwocGFyc2VyLCBjb250ZXh0KSwgdG9rZW4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICB3aGlsZSAocGFyc2VyLnRva2VuICE9PSAxMDQ4NTc2KSB7DQogICAgICAgIHN0YXRlbWVudHMucHVzaChwYXJzZU1vZHVsZUl0ZW0ocGFyc2VyLCBjb250ZXh0LCBzY29wZSkpOw0KICAgIH0NCiAgICByZXR1cm4gc3RhdGVtZW50czsNCn0NCmZ1bmN0aW9uIHBhcnNlTW9kdWxlSXRlbShwYXJzZXIsIGNvbnRleHQsIHNjb3BlKSB7DQogICAgcGFyc2VyLmxlYWRpbmdEZWNvcmF0b3JzID0gcGFyc2VEZWNvcmF0b3JzKHBhcnNlciwgY29udGV4dCk7DQogICAgbGV0IG1vZHVsZUl0ZW07DQogICAgc3dpdGNoIChwYXJzZXIudG9rZW4pIHsNCiAgICAgICAgY2FzZSAyMDU2NjoNCiAgICAgICAgICAgIG1vZHVsZUl0ZW0gPSBwYXJzZUV4cG9ydERlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUpOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgODYxMDg6DQogICAgICAgICAgICBtb2R1bGVJdGVtID0gcGFyc2VJbXBvcnREZWNsYXJhdGlvbihwYXJzZXIsIGNvbnRleHQsIHNjb3BlKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgbW9kdWxlSXRlbSA9IHBhcnNlU3RhdGVtZW50TGlzdEl0ZW0ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgNCwge30pOw0KICAgIH0NCiAgICBpZiAocGFyc2VyLmxlYWRpbmdEZWNvcmF0b3JzLmxlbmd0aCkgew0KICAgICAgICByZXBvcnQocGFyc2VyLCAxNjUpOw0KICAgIH0NCiAgICByZXR1cm4gbW9kdWxlSXRlbTsNCn0NCmZ1bmN0aW9uIHBhcnNlU3RhdGVtZW50TGlzdEl0ZW0ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgb3JpZ2luLCBsYWJlbHMpIHsNCiAgICBjb25zdCBzdGFydCA9IHBhcnNlci50b2tlblBvczsNCiAgICBjb25zdCBsaW5lID0gcGFyc2VyLmxpbmVQb3M7DQogICAgY29uc3QgY29sdW1uID0gcGFyc2VyLmNvbFBvczsNCiAgICBzd2l0Y2ggKHBhcnNlci50b2tlbikgew0KICAgICAgICBjYXNlIDg2MTA2Og0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlRnVuY3Rpb25EZWNsYXJhdGlvbihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBvcmlnaW4sIDEsIDAsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBjYXNlIDEzMzoNCiAgICAgICAgY2FzZSA4NjA5NjoNCiAgICAgICAgICAgIHJldHVybiBwYXJzZUNsYXNzRGVjbGFyYXRpb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgODYwOTI6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VMZXhpY2FsRGVjbGFyYXRpb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgMTYsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBjYXNlIDI0MTczOToNCiAgICAgICAgICAgIHJldHVybiBwYXJzZUxldElkZW50T3JWYXJEZWNsYXJhdGlvblN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBvcmlnaW4sIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBjYXNlIDIwNTY2Og0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTAxLCAnZXhwb3J0Jyk7DQogICAgICAgIGNhc2UgODYxMDg6DQogICAgICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICAgICAgICAgIHN3aXRjaCAocGFyc2VyLnRva2VuKSB7DQogICAgICAgICAgICAgICAgY2FzZSA2NzE3NDQxMToNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW1wb3J0Q2FsbERlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgICAgICAgICAgY2FzZSA2NzEwODg3NzoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW1wb3J0TWV0YURlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTAxLCAnaW1wb3J0Jyk7DQogICAgICAgICAgICB9DQogICAgICAgIGNhc2UgMjA5MDA3Og0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlQXN5bmNBcnJvd09yQXN5bmNGdW5jdGlvbkRlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIG9yaWdpbiwgbGFiZWxzLCAxLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgIHJldHVybiBwYXJzZVN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBvcmlnaW4sIGxhYmVscywgMSwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgfQ0KfQ0KZnVuY3Rpb24gcGFyc2VTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgb3JpZ2luLCBsYWJlbHMsIGFsbG93RnVuY0RlY2wsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBzd2l0Y2ggKHBhcnNlci50b2tlbikgew0KICAgICAgICBjYXNlIDg2MDkwOg0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlVmFyaWFibGVTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgMjA1NzQ6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VSZXR1cm5TdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSAyMDU3MToNCiAgICAgICAgICAgIHJldHVybiBwYXJzZUlmU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGxhYmVscywgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgMjA1Njk6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VGb3JTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgbGFiZWxzLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSAyMDU2NDoNCiAgICAgICAgICAgIHJldHVybiBwYXJzZURvV2hpbGVTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgbGFiZWxzLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSAyMDU4MDoNCiAgICAgICAgICAgIHJldHVybiBwYXJzZVdoaWxlU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGxhYmVscywgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgODYxMTI6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VTd2l0Y2hTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgbGFiZWxzLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSAxMDc0NzkwNDE3Og0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlRW1wdHlTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSAyMTYyNzAwOg0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlQmxvY2socGFyc2VyLCBjb250ZXh0LCBzY29wZSA/IGFkZENoaWxkU2NvcGUoc2NvcGUsIDIpIDogc2NvcGUsIGxhYmVscywgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgODYxMTQ6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VUaHJvd1N0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBjYXNlIDIwNTU3Og0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlQnJlYWtTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBsYWJlbHMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBjYXNlIDIwNTYxOg0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlQ29udGludWVTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBsYWJlbHMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBjYXNlIDIwNTc5Og0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlVHJ5U3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGxhYmVscywgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgMjA1ODE6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VXaXRoU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGxhYmVscywgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgMjA1NjI6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VEZWJ1Z2dlclN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBjYXNlIDIwOTAwNzoNCiAgICAgICAgICAgIHJldHVybiBwYXJzZUFzeW5jQXJyb3dPckFzeW5jRnVuY3Rpb25EZWNsYXJhdGlvbihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBvcmlnaW4sIGxhYmVscywgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgMjA1NTk6DQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxNTcpOw0KICAgICAgICBjYXNlIDIwNTY4Og0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTU4KTsNCiAgICAgICAgY2FzZSA4NjEwNjoNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIGNvbnRleHQgJiAxMDI0DQogICAgICAgICAgICAgICAgPyA3NA0KICAgICAgICAgICAgICAgIDogKGNvbnRleHQgJiAyNTYpID09PSAwDQogICAgICAgICAgICAgICAgICAgID8gNzYNCiAgICAgICAgICAgICAgICAgICAgOiA3NSk7DQogICAgICAgIGNhc2UgODYwOTY6DQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCA3Nyk7DQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VFeHByZXNzaW9uT3JMYWJlbGxlZFN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBvcmlnaW4sIGxhYmVscywgYWxsb3dGdW5jRGVjbCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgfQ0KfQ0KZnVuY3Rpb24gcGFyc2VFeHByZXNzaW9uT3JMYWJlbGxlZFN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBvcmlnaW4sIGxhYmVscywgYWxsb3dGdW5jRGVjbCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnN0IHsgdG9rZW5WYWx1ZSwgdG9rZW4gfSA9IHBhcnNlcjsNCiAgICBsZXQgZXhwcjsNCiAgICBzd2l0Y2ggKHRva2VuKSB7DQogICAgICAgIGNhc2UgMjQxNzM5Og0KICAgICAgICAgICAgZXhwciA9IHBhcnNlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDApOw0KICAgICAgICAgICAgaWYgKGNvbnRleHQgJiAxMDI0KQ0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDgzKTsNCiAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDY5MjcxNTcxKQ0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDgyKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgZXhwciA9IHBhcnNlUHJpbWFyeUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAyLCAwLCAxLCAwLCAwLCAxLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICB9DQogICAgaWYgKHRva2VuICYgMTQzMzYwICYmIHBhcnNlci50b2tlbiA9PT0gMjEpIHsNCiAgICAgICAgcmV0dXJuIHBhcnNlTGFiZWxsZWRTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgb3JpZ2luLCBsYWJlbHMsIHRva2VuVmFsdWUsIGV4cHIsIHRva2VuLCBhbGxvd0Z1bmNEZWNsLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICB9DQogICAgZXhwciA9IHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgZXhwciwgMCwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgZXhwciA9IHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAwLCAwLCBzdGFydCwgbGluZSwgY29sdW1uLCBleHByKTsNCiAgICBpZiAocGFyc2VyLnRva2VuID09PSAxOCkgew0KICAgICAgICBleHByID0gcGFyc2VTZXF1ZW5jZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAwLCBzdGFydCwgbGluZSwgY29sdW1uLCBleHByKTsNCiAgICB9DQogICAgcmV0dXJuIHBhcnNlRXhwcmVzc2lvblN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIGV4cHIsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KfQ0KZnVuY3Rpb24gcGFyc2VCbG9jayhwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBsYWJlbHMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBjb25zdCBib2R5ID0gW107DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMjE2MjcwMCk7DQogICAgd2hpbGUgKHBhcnNlci50b2tlbiAhPT0gMTA3NDc5MDQxNSkgew0KICAgICAgICBib2R5LnB1c2gocGFyc2VTdGF0ZW1lbnRMaXN0SXRlbShwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCAyLCB7ICQ6IGxhYmVscyB9KSk7DQogICAgfQ0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDEwNzQ3OTA0MTUpOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnQmxvY2tTdGF0ZW1lbnQnLA0KICAgICAgICBib2R5DQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZVJldHVyblN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBpZiAoKGNvbnRleHQgJiAzMikgPT09IDAgJiYgY29udGV4dCAmIDgxOTIpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDkwKTsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIGNvbnN0IGFyZ3VtZW50ID0gcGFyc2VyLmZsYWdzICYgMSB8fCBwYXJzZXIudG9rZW4gJiAxMDQ4NTc2DQogICAgICAgID8gbnVsbA0KICAgICAgICA6IHBhcnNlRXhwcmVzc2lvbnMocGFyc2VyLCBjb250ZXh0LCAwLCAxLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICBtYXRjaE9ySW5zZXJ0U2VtaWNvbG9uKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ1JldHVyblN0YXRlbWVudCcsDQogICAgICAgIGFyZ3VtZW50DQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUV4cHJlc3Npb25TdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBleHByZXNzaW9uLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbWF0Y2hPckluc2VydFNlbWljb2xvbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdFeHByZXNzaW9uU3RhdGVtZW50JywNCiAgICAgICAgZXhwcmVzc2lvbg0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VMYWJlbGxlZFN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBvcmlnaW4sIGxhYmVscywgdmFsdWUsIGV4cHIsIHRva2VuLCBhbGxvd0Z1bmNEZWNsLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgdmFsaWRhdGVCaW5kaW5nSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDAsIHRva2VuLCAxKTsNCiAgICB2YWxpZGF0ZUFuZERlY2xhcmVMYWJlbChwYXJzZXIsIGxhYmVscywgdmFsdWUpOw0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgY29uc3QgYm9keSA9IGFsbG93RnVuY0RlY2wgJiYNCiAgICAgICAgKGNvbnRleHQgJiAxMDI0KSA9PT0gMCAmJg0KICAgICAgICBjb250ZXh0ICYgMjU2ICYmDQogICAgICAgIHBhcnNlci50b2tlbiA9PT0gODYxMDYNCiAgICAgICAgPyBwYXJzZUZ1bmN0aW9uRGVjbGFyYXRpb24ocGFyc2VyLCBjb250ZXh0LCBhZGRDaGlsZFNjb3BlKHNjb3BlLCAyKSwgb3JpZ2luLCAwLCAwLCAwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKQ0KICAgICAgICA6IHBhcnNlU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIG9yaWdpbiwgbGFiZWxzLCBhbGxvd0Z1bmNEZWNsLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0xhYmVsZWRTdGF0ZW1lbnQnLA0KICAgICAgICBsYWJlbDogZXhwciwNCiAgICAgICAgYm9keQ0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VBc3luY0Fycm93T3JBc3luY0Z1bmN0aW9uRGVjbGFyYXRpb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgb3JpZ2luLCBsYWJlbHMsIGFsbG93RnVuY0RlY2wsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBjb25zdCB7IHRva2VuLCB0b2tlblZhbHVlIH0gPSBwYXJzZXI7DQogICAgbGV0IGV4cHIgPSBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICBpZiAocGFyc2VyLnRva2VuID09PSAyMSkgew0KICAgICAgICByZXR1cm4gcGFyc2VMYWJlbGxlZFN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBvcmlnaW4sIGxhYmVscywgdG9rZW5WYWx1ZSwgZXhwciwgdG9rZW4sIDEsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIH0NCiAgICBjb25zdCBhc3luY05ld0xpbmUgPSBwYXJzZXIuZmxhZ3MgJiAxOw0KICAgIGlmICghYXN5bmNOZXdMaW5lKSB7DQogICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDg2MTA2KSB7DQogICAgICAgICAgICBpZiAoIWFsbG93RnVuY0RlY2wpDQogICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTIwKTsNCiAgICAgICAgICAgIHJldHVybiBwYXJzZUZ1bmN0aW9uRGVjbGFyYXRpb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgb3JpZ2luLCAxLCAwLCAxLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoKHBhcnNlci50b2tlbiAmIDE0MzM2MCkgPT09IDE0MzM2MCkgew0KICAgICAgICAgICAgZXhwciA9IHBhcnNlQXN5bmNBcnJvd0FmdGVySWRlbnQocGFyc2VyLCBjb250ZXh0LCAxLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDE4KQ0KICAgICAgICAgICAgICAgIGV4cHIgPSBwYXJzZVNlcXVlbmNlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIGV4cHIpOw0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlRXhwcmVzc2lvblN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIGV4cHIsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDY3MTc0NDExKSB7DQogICAgICAgIGV4cHIgPSBwYXJzZUFzeW5jQXJyb3dPckNhbGxFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgZXhwciwgMSwgMSwgMCwgYXN5bmNOZXdMaW5lLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDEwKSB7DQogICAgICAgICAgICBjbGFzc2lmeUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCB0b2tlbiwgMSk7DQogICAgICAgICAgICBleHByID0gcGFyc2VBcnJvd0Zyb21JZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgcGFyc2VyLnRva2VuVmFsdWUsIGV4cHIsIDAsIDEsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICB9DQogICAgICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMTsNCiAgICB9DQogICAgZXhwciA9IHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgZXhwciwgMCwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTgpDQogICAgICAgIGV4cHIgPSBwYXJzZVNlcXVlbmNlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIGV4cHIpOw0KICAgIGV4cHIgPSBwYXJzZUFzc2lnbm1lbnRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMCwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgZXhwcik7DQogICAgcGFyc2VyLmFzc2lnbmFibGUgPSAxOw0KICAgIHJldHVybiBwYXJzZUV4cHJlc3Npb25TdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBleHByLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCn0NCmZ1bmN0aW9uIHBhcnNlRGlyZWN0aXZlKHBhcnNlciwgY29udGV4dCwgZXhwcmVzc2lvbiwgdG9rZW4sIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBpZiAodG9rZW4gIT09IDEwNzQ3OTA0MTcpIHsNCiAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgICAgICBleHByZXNzaW9uID0gcGFyc2VNZW1iZXJPclVwZGF0ZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBleHByZXNzaW9uLCAwLCAwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTA3NDc5MDQxNykgew0KICAgICAgICAgICAgZXhwcmVzc2lvbiA9IHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAwLCAwLCBzdGFydCwgbGluZSwgY29sdW1uLCBleHByZXNzaW9uKTsNCiAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDE4KSB7DQogICAgICAgICAgICAgICAgZXhwcmVzc2lvbiA9IHBhcnNlU2VxdWVuY2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgZXhwcmVzc2lvbik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgbWF0Y2hPckluc2VydFNlbWljb2xvbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgfQ0KICAgIHJldHVybiBjb250ZXh0ICYgOCAmJiBleHByZXNzaW9uLnR5cGUgPT09ICdMaXRlcmFsJyAmJiB0eXBlb2YgZXhwcmVzc2lvbi52YWx1ZSA9PT0gJ3N0cmluZycNCiAgICAgICAgPyBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICAgICAgdHlwZTogJ0V4cHJlc3Npb25TdGF0ZW1lbnQnLA0KICAgICAgICAgICAgZXhwcmVzc2lvbiwNCiAgICAgICAgICAgIGRpcmVjdGl2ZTogZXhwcmVzc2lvbi5yYXcuc2xpY2UoMSwgLTEpDQogICAgICAgIH0pDQogICAgICAgIDogZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgICAgIHR5cGU6ICdFeHByZXNzaW9uU3RhdGVtZW50JywNCiAgICAgICAgICAgIGV4cHJlc3Npb24NCiAgICAgICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUVtcHR5U3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdFbXB0eVN0YXRlbWVudCcNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlVGhyb3dTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICBpZiAocGFyc2VyLmZsYWdzICYgMSkNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgODgpOw0KICAgIGNvbnN0IGFyZ3VtZW50ID0gcGFyc2VFeHByZXNzaW9ucyhwYXJzZXIsIGNvbnRleHQsIDAsIDEsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgIG1hdGNoT3JJbnNlcnRTZW1pY29sb24ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnVGhyb3dTdGF0ZW1lbnQnLA0KICAgICAgICBhcmd1bWVudA0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VJZlN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBsYWJlbHMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCA2NzE3NDQxMSk7DQogICAgcGFyc2VyLmFzc2lnbmFibGUgPSAxOw0KICAgIGNvbnN0IHRlc3QgPSBwYXJzZUV4cHJlc3Npb25zKHBhcnNlciwgY29udGV4dCwgMCwgMSwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZSwgcGFyc2VyLmNvbFBvcyk7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMTYpOw0KICAgIGNvbnN0IGNvbnNlcXVlbnQgPSBwYXJzZUNvbnNlcXVlbnRPckFsdGVybmF0aXZlKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGxhYmVscywgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgbGV0IGFsdGVybmF0ZSA9IG51bGw7DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMjA1NjUpIHsNCiAgICAgICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICAgICAgYWx0ZXJuYXRlID0gcGFyc2VDb25zZXF1ZW50T3JBbHRlcm5hdGl2ZShwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBsYWJlbHMsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgIH0NCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0lmU3RhdGVtZW50JywNCiAgICAgICAgdGVzdCwNCiAgICAgICAgY29uc2VxdWVudCwNCiAgICAgICAgYWx0ZXJuYXRlDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUNvbnNlcXVlbnRPckFsdGVybmF0aXZlKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGxhYmVscywgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIHJldHVybiBjb250ZXh0ICYgMTAyNCB8fA0KICAgICAgICAoY29udGV4dCAmIDI1NikgPT09IDAgfHwNCiAgICAgICAgcGFyc2VyLnRva2VuICE9PSA4NjEwNg0KICAgICAgICA/IHBhcnNlU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDAsIHsgJDogbGFiZWxzIH0sIDAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpDQogICAgICAgIDogcGFyc2VGdW5jdGlvbkRlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgYWRkQ2hpbGRTY29wZShzY29wZSwgMiksIDAsIDAsIDAsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KfQ0KZnVuY3Rpb24gcGFyc2VTd2l0Y2hTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgbGFiZWxzLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgNjcxNzQ0MTEpOw0KICAgIGNvbnN0IGRpc2NyaW1pbmFudCA9IHBhcnNlRXhwcmVzc2lvbnMocGFyc2VyLCBjb250ZXh0LCAwLCAxLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgMTYpOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCAyMTYyNzAwKTsNCiAgICBjb25zdCBjYXNlcyA9IFtdOw0KICAgIGxldCBzZWVuRGVmYXVsdCA9IDA7DQogICAgaWYgKHNjb3BlKQ0KICAgICAgICBzY29wZSA9IGFkZENoaWxkU2NvcGUoc2NvcGUsIDgpOw0KICAgIHdoaWxlIChwYXJzZXIudG9rZW4gIT09IDEwNzQ3OTA0MTUpIHsNCiAgICAgICAgY29uc3QgeyB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgICAgIGxldCB0ZXN0ID0gbnVsbDsNCiAgICAgICAgY29uc3QgY29uc2VxdWVudCA9IFtdOw0KICAgICAgICBpZiAoY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMjA1NTgpKSB7DQogICAgICAgICAgICB0ZXN0ID0gcGFyc2VFeHByZXNzaW9ucyhwYXJzZXIsIGNvbnRleHQsIDAsIDEsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMjA1NjMpOw0KICAgICAgICAgICAgaWYgKHNlZW5EZWZhdWx0KQ0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDg3KTsNCiAgICAgICAgICAgIHNlZW5EZWZhdWx0ID0gMTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAyMSk7DQogICAgICAgIHdoaWxlIChwYXJzZXIudG9rZW4gIT09IDIwNTU4ICYmDQogICAgICAgICAgICBwYXJzZXIudG9rZW4gIT09IDEwNzQ3OTA0MTUgJiYNCiAgICAgICAgICAgIHBhcnNlci50b2tlbiAhPT0gMjA1NjMpIHsNCiAgICAgICAgICAgIGNvbnNlcXVlbnQucHVzaChwYXJzZVN0YXRlbWVudExpc3RJdGVtKHBhcnNlciwgY29udGV4dCB8IDQwOTYsIHNjb3BlLCAyLCB7DQogICAgICAgICAgICAgICAgJDogbGFiZWxzDQogICAgICAgICAgICB9KSk7DQogICAgICAgIH0NCiAgICAgICAgY2FzZXMucHVzaChmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgew0KICAgICAgICAgICAgdHlwZTogJ1N3aXRjaENhc2UnLA0KICAgICAgICAgICAgdGVzdCwNCiAgICAgICAgICAgIGNvbnNlcXVlbnQNCiAgICAgICAgfSkpOw0KICAgIH0NCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAxMDc0NzkwNDE1KTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ1N3aXRjaFN0YXRlbWVudCcsDQogICAgICAgIGRpc2NyaW1pbmFudCwNCiAgICAgICAgY2FzZXMNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlV2hpbGVTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgbGFiZWxzLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgNjcxNzQ0MTEpOw0KICAgIGNvbnN0IHRlc3QgPSBwYXJzZUV4cHJlc3Npb25zKHBhcnNlciwgY29udGV4dCwgMCwgMSwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMTYpOw0KICAgIGNvbnN0IGJvZHkgPSBwYXJzZUl0ZXJhdGlvblN0YXRlbWVudEJvZHkocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgbGFiZWxzKTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ1doaWxlU3RhdGVtZW50JywNCiAgICAgICAgdGVzdCwNCiAgICAgICAgYm9keQ0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VJdGVyYXRpb25TdGF0ZW1lbnRCb2R5KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGxhYmVscykgew0KICAgIHJldHVybiBwYXJzZVN0YXRlbWVudChwYXJzZXIsICgoY29udGV4dCB8IDEzNDIxNzcyOCkgXiAxMzQyMTc3MjgpIHwgMTMxMDcyLCBzY29wZSwgMCwgeyBsb29wOiAxLCAkOiBsYWJlbHMgfSwgMCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQp9DQpmdW5jdGlvbiBwYXJzZUNvbnRpbnVlU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgbGFiZWxzLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgaWYgKChjb250ZXh0ICYgMTMxMDcyKSA9PT0gMCkNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgNjYpOw0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIGxldCBsYWJlbCA9IG51bGw7DQogICAgaWYgKChwYXJzZXIuZmxhZ3MgJiAxKSA9PT0gMCAmJiBwYXJzZXIudG9rZW4gJiAxNDMzNjApIHsNCiAgICAgICAgY29uc3QgeyB0b2tlblZhbHVlIH0gPSBwYXJzZXI7DQogICAgICAgIGxhYmVsID0gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAwKTsNCiAgICAgICAgaWYgKCFpc1ZhbGlkTGFiZWwocGFyc2VyLCBsYWJlbHMsIHRva2VuVmFsdWUsIDEpKQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTM1LCB0b2tlblZhbHVlKTsNCiAgICB9DQogICAgbWF0Y2hPckluc2VydFNlbWljb2xvbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdDb250aW51ZVN0YXRlbWVudCcsDQogICAgICAgIGxhYmVsDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUJyZWFrU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgbGFiZWxzLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICBsZXQgbGFiZWwgPSBudWxsOw0KICAgIGlmICgocGFyc2VyLmZsYWdzICYgMSkgPT09IDAgJiYgcGFyc2VyLnRva2VuICYgMTQzMzYwKSB7DQogICAgICAgIGNvbnN0IHsgdG9rZW5WYWx1ZSB9ID0gcGFyc2VyOw0KICAgICAgICBsYWJlbCA9IHBhcnNlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMCk7DQogICAgICAgIGlmICghaXNWYWxpZExhYmVsKHBhcnNlciwgbGFiZWxzLCB0b2tlblZhbHVlLCAwKSkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDEzNSwgdG9rZW5WYWx1ZSk7DQogICAgfQ0KICAgIGVsc2UgaWYgKChjb250ZXh0ICYgKDQwOTYgfCAxMzEwNzIpKSA9PT0gMCkgew0KICAgICAgICByZXBvcnQocGFyc2VyLCA2Nyk7DQogICAgfQ0KICAgIG1hdGNoT3JJbnNlcnRTZW1pY29sb24ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnQnJlYWtTdGF0ZW1lbnQnLA0KICAgICAgICBsYWJlbA0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VXaXRoU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGxhYmVscywgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIGlmIChjb250ZXh0ICYgMTAyNCkNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgODkpOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDY3MTc0NDExKTsNCiAgICBjb25zdCBvYmplY3QgPSBwYXJzZUV4cHJlc3Npb25zKHBhcnNlciwgY29udGV4dCwgMCwgMSwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMTYpOw0KICAgIGNvbnN0IGJvZHkgPSBwYXJzZVN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCAyLCBsYWJlbHMsIDAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnV2l0aFN0YXRlbWVudCcsDQogICAgICAgIG9iamVjdCwNCiAgICAgICAgYm9keQ0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VEZWJ1Z2dlclN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIG1hdGNoT3JJbnNlcnRTZW1pY29sb24ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnRGVidWdnZXJTdGF0ZW1lbnQnDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZVRyeVN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBsYWJlbHMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIGNvbnN0IGZpcnN0U2NvcGUgPSBzY29wZSA/IGFkZENoaWxkU2NvcGUoc2NvcGUsIDMyKSA6IHZvaWQgMDsNCiAgICBjb25zdCBibG9jayA9IHBhcnNlQmxvY2socGFyc2VyLCBjb250ZXh0LCBmaXJzdFNjb3BlLCB7ICQ6IGxhYmVscyB9LCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICBjb25zdCB7IHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICBjb25zdCBoYW5kbGVyID0gY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMjA1NTkpDQogICAgICAgID8gcGFyc2VDYXRjaEJsb2NrKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGxhYmVscywgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcykNCiAgICAgICAgOiBudWxsOw0KICAgIGxldCBmaW5hbGl6ZXIgPSBudWxsOw0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDIwNTY4KSB7DQogICAgICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgICAgIGNvbnN0IGZpbmFsaXplclNjb3BlID0gZmlyc3RTY29wZSA/IGFkZENoaWxkU2NvcGUoc2NvcGUsIDQpIDogdm9pZCAwOw0KICAgICAgICBmaW5hbGl6ZXIgPSBwYXJzZUJsb2NrKHBhcnNlciwgY29udGV4dCwgZmluYWxpemVyU2NvcGUsIHsgJDogbGFiZWxzIH0sIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgIH0NCiAgICBpZiAoIWhhbmRsZXIgJiYgIWZpbmFsaXplcikgew0KICAgICAgICByZXBvcnQocGFyc2VyLCA4Nik7DQogICAgfQ0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnVHJ5U3RhdGVtZW50JywNCiAgICAgICAgYmxvY2ssDQogICAgICAgIGhhbmRsZXIsDQogICAgICAgIGZpbmFsaXplcg0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VDYXRjaEJsb2NrKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGxhYmVscywgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGxldCBwYXJhbSA9IG51bGw7DQogICAgbGV0IGFkZGl0aW9uYWxTY29wZSA9IHNjb3BlOw0KICAgIGlmIChjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCwgNjcxNzQ0MTEpKSB7DQogICAgICAgIGlmIChzY29wZSkNCiAgICAgICAgICAgIHNjb3BlID0gYWRkQ2hpbGRTY29wZShzY29wZSwgNCk7DQogICAgICAgIHBhcmFtID0gcGFyc2VCaW5kaW5nUGF0dGVybihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCAocGFyc2VyLnRva2VuICYgMjA5NzE1MikgPT09IDIwOTcxNTINCiAgICAgICAgICAgID8gMjU2DQogICAgICAgICAgICA6IDUxMiwgMCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDE4KSB7DQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCA4NCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAocGFyc2VyLnRva2VuID09PSAxMDc3OTM2MTU3KSB7DQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCA4NSk7DQogICAgICAgIH0NCiAgICAgICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMTYpOw0KICAgICAgICBpZiAoc2NvcGUpDQogICAgICAgICAgICBhZGRpdGlvbmFsU2NvcGUgPSBhZGRDaGlsZFNjb3BlKHNjb3BlLCA2NCk7DQogICAgfQ0KICAgIGNvbnN0IGJvZHkgPSBwYXJzZUJsb2NrKHBhcnNlciwgY29udGV4dCwgYWRkaXRpb25hbFNjb3BlLCB7ICQ6IGxhYmVscyB9LCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0NhdGNoQ2xhdXNlJywNCiAgICAgICAgcGFyYW0sDQogICAgICAgIGJvZHkNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlU3RhdGljQmxvY2socGFyc2VyLCBjb250ZXh0LCBzY29wZSwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGlmIChzY29wZSkNCiAgICAgICAgc2NvcGUgPSBhZGRDaGlsZFNjb3BlKHNjb3BlLCAyKTsNCiAgICBjb25zdCBjdG9yQ29udGV4dCA9IDE2Mzg0IHwgNTI0Mjg4Ow0KICAgIGNvbnRleHQgPSAoKGNvbnRleHQgfCBjdG9yQ29udGV4dCkgXiBjdG9yQ29udGV4dCkgfCAyNjIxNDQ7DQogICAgY29uc3QgeyBib2R5IH0gPSBwYXJzZUJsb2NrKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIHt9LCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ1N0YXRpY0Jsb2NrJywNCiAgICAgICAgYm9keQ0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VEb1doaWxlU3RhdGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGxhYmVscywgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgY29uc3QgYm9keSA9IHBhcnNlSXRlcmF0aW9uU3RhdGVtZW50Qm9keShwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBsYWJlbHMpOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCAyMDU4MCk7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgNjcxNzQ0MTEpOw0KICAgIGNvbnN0IHRlc3QgPSBwYXJzZUV4cHJlc3Npb25zKHBhcnNlciwgY29udGV4dCwgMCwgMSwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMTYpOw0KICAgIGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0LCAxMDc0NzkwNDE3KTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0RvV2hpbGVTdGF0ZW1lbnQnLA0KICAgICAgICBib2R5LA0KICAgICAgICB0ZXN0DQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUxldElkZW50T3JWYXJEZWNsYXJhdGlvblN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBvcmlnaW4sIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBjb25zdCB7IHRva2VuLCB0b2tlblZhbHVlIH0gPSBwYXJzZXI7DQogICAgbGV0IGV4cHIgPSBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICBpZiAocGFyc2VyLnRva2VuICYgKDE0MzM2MCB8IDIwOTcxNTIpKSB7DQogICAgICAgIGNvbnN0IGRlY2xhcmF0aW9ucyA9IHBhcnNlVmFyaWFibGVEZWNsYXJhdGlvbkxpc3QocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgOCwgMCk7DQogICAgICAgIG1hdGNoT3JJbnNlcnRTZW1pY29sb24ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgICAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgICAgIHR5cGU6ICdWYXJpYWJsZURlY2xhcmF0aW9uJywNCiAgICAgICAgICAgIGtpbmQ6ICdsZXQnLA0KICAgICAgICAgICAgZGVjbGFyYXRpb25zDQogICAgICAgIH0pOw0KICAgIH0NCiAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDE7DQogICAgaWYgKGNvbnRleHQgJiAxMDI0KQ0KICAgICAgICByZXBvcnQocGFyc2VyLCA4Myk7DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMjEpIHsNCiAgICAgICAgcmV0dXJuIHBhcnNlTGFiZWxsZWRTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgb3JpZ2luLCB7fSwgdG9rZW5WYWx1ZSwgZXhwciwgdG9rZW4sIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIH0NCiAgICBpZiAocGFyc2VyLnRva2VuID09PSAxMCkgew0KICAgICAgICBsZXQgc2NvcGUgPSB2b2lkIDA7DQogICAgICAgIGlmIChjb250ZXh0ICYgNjQpDQogICAgICAgICAgICBzY29wZSA9IGNyZWF0ZUFycm93SGVhZFBhcnNpbmdTY29wZShwYXJzZXIsIGNvbnRleHQsIHRva2VuVmFsdWUpOw0KICAgICAgICBwYXJzZXIuZmxhZ3MgPSAocGFyc2VyLmZsYWdzIHwgMTI4KSBeIDEyODsNCiAgICAgICAgZXhwciA9IHBhcnNlQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgW2V4cHJdLCAwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGV4cHIgPSBwYXJzZU1lbWJlck9yVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGV4cHIsIDAsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBleHByID0gcGFyc2VBc3NpZ25tZW50RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDAsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIGV4cHIpOw0KICAgIH0NCiAgICBpZiAocGFyc2VyLnRva2VuID09PSAxOCkgew0KICAgICAgICBleHByID0gcGFyc2VTZXF1ZW5jZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAwLCBzdGFydCwgbGluZSwgY29sdW1uLCBleHByKTsNCiAgICB9DQogICAgcmV0dXJuIHBhcnNlRXhwcmVzc2lvblN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIGV4cHIsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KfQ0KZnVuY3Rpb24gcGFyc2VMZXhpY2FsRGVjbGFyYXRpb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwga2luZCwgb3JpZ2luLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgY29uc3QgZGVjbGFyYXRpb25zID0gcGFyc2VWYXJpYWJsZURlY2xhcmF0aW9uTGlzdChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBraW5kLCBvcmlnaW4pOw0KICAgIG1hdGNoT3JJbnNlcnRTZW1pY29sb24ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnVmFyaWFibGVEZWNsYXJhdGlvbicsDQogICAgICAgIGtpbmQ6IGtpbmQgJiA4ID8gJ2xldCcgOiAnY29uc3QnLA0KICAgICAgICBkZWNsYXJhdGlvbnMNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlVmFyaWFibGVTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgb3JpZ2luLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgY29uc3QgZGVjbGFyYXRpb25zID0gcGFyc2VWYXJpYWJsZURlY2xhcmF0aW9uTGlzdChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCA0LCBvcmlnaW4pOw0KICAgIG1hdGNoT3JJbnNlcnRTZW1pY29sb24ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnVmFyaWFibGVEZWNsYXJhdGlvbicsDQogICAgICAgIGtpbmQ6ICd2YXInLA0KICAgICAgICBkZWNsYXJhdGlvbnMNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlVmFyaWFibGVEZWNsYXJhdGlvbkxpc3QocGFyc2VyLCBjb250ZXh0LCBzY29wZSwga2luZCwgb3JpZ2luKSB7DQogICAgbGV0IGJpbmRpbmdDb3VudCA9IDE7DQogICAgY29uc3QgbGlzdCA9IFtwYXJzZVZhcmlhYmxlRGVjbGFyYXRpb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwga2luZCwgb3JpZ2luKV07DQogICAgd2hpbGUgKGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0LCAxOCkpIHsNCiAgICAgICAgYmluZGluZ0NvdW50Kys7DQogICAgICAgIGxpc3QucHVzaChwYXJzZVZhcmlhYmxlRGVjbGFyYXRpb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwga2luZCwgb3JpZ2luKSk7DQogICAgfQ0KICAgIGlmIChiaW5kaW5nQ291bnQgPiAxICYmIG9yaWdpbiAmIDMyICYmIHBhcnNlci50b2tlbiAmIDI2MjE0NCkgew0KICAgICAgICByZXBvcnQocGFyc2VyLCA1OSwgS2V5d29yZERlc2NUYWJsZVtwYXJzZXIudG9rZW4gJiAyNTVdKTsNCiAgICB9DQogICAgcmV0dXJuIGxpc3Q7DQp9DQpmdW5jdGlvbiBwYXJzZVZhcmlhYmxlRGVjbGFyYXRpb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwga2luZCwgb3JpZ2luKSB7DQogICAgY29uc3QgeyB0b2tlbiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgIGxldCBpbml0ID0gbnVsbDsNCiAgICBjb25zdCBpZCA9IHBhcnNlQmluZGluZ1BhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwga2luZCwgb3JpZ2luLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICBpZiAocGFyc2VyLnRva2VuID09PSAxMDc3OTM2MTU3KSB7DQogICAgICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgICAgIGluaXQgPSBwYXJzZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAwLCAwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICAgICAgaWYgKG9yaWdpbiAmIDMyIHx8ICh0b2tlbiAmIDIwOTcxNTIpID09PSAwKSB7DQogICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAyNzQ1NDkgfHwNCiAgICAgICAgICAgICAgICAocGFyc2VyLnRva2VuID09PSA4NzM4ODY4ICYmDQogICAgICAgICAgICAgICAgICAgICh0b2tlbiAmIDIwOTcxNTIgfHwgKGtpbmQgJiA0KSA9PT0gMCB8fCBjb250ZXh0ICYgMTAyNCkpKSB7DQogICAgICAgICAgICAgICAgcmVwb3J0TWVzc2FnZUF0KHRva2VuUG9zLCBwYXJzZXIubGluZSwgcGFyc2VyLmluZGV4IC0gMywgNTgsIHBhcnNlci50b2tlbiA9PT0gMjc0NTQ5ID8gJ29mJyA6ICdpbicpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIGVsc2UgaWYgKChraW5kICYgMTYgfHwgKHRva2VuICYgMjA5NzE1MikgPiAwKSAmJg0KICAgICAgICAocGFyc2VyLnRva2VuICYgMjYyMTQ0KSAhPT0gMjYyMTQ0KSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDU3LCBraW5kICYgMTYgPyAnY29uc3QnIDogJ2Rlc3RydWN0dXJpbmcnKTsNCiAgICB9DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCB7DQogICAgICAgIHR5cGU6ICdWYXJpYWJsZURlY2xhcmF0b3InLA0KICAgICAgICBpZCwNCiAgICAgICAgaW5pdA0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VGb3JTdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgbGFiZWxzLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgY29uc3QgZm9yQXdhaXQgPSAoKGNvbnRleHQgJiA0MTk0MzA0KSA+IDAgfHwgKChjb250ZXh0ICYgMjA0OCkgPiAwICYmIChjb250ZXh0ICYgODE5MikgPiAwKSkgJiYNCiAgICAgICAgY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQsIDIwOTAwOCk7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgNjcxNzQ0MTEpOw0KICAgIGlmIChzY29wZSkNCiAgICAgICAgc2NvcGUgPSBhZGRDaGlsZFNjb3BlKHNjb3BlLCAxKTsNCiAgICBsZXQgdGVzdCA9IG51bGw7DQogICAgbGV0IHVwZGF0ZSA9IG51bGw7DQogICAgbGV0IGRlc3RydWN0aWJsZSA9IDA7DQogICAgbGV0IGluaXQgPSBudWxsOw0KICAgIGxldCBpc1ZhckRlY2wgPSBwYXJzZXIudG9rZW4gPT09IDg2MDkwIHx8IHBhcnNlci50b2tlbiA9PT0gMjQxNzM5IHx8IHBhcnNlci50b2tlbiA9PT0gODYwOTI7DQogICAgbGV0IHJpZ2h0Ow0KICAgIGNvbnN0IHsgdG9rZW4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICBpZiAoaXNWYXJEZWNsKSB7DQogICAgICAgIGlmICh0b2tlbiA9PT0gMjQxNzM5KSB7DQogICAgICAgICAgICBpbml0ID0gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMCk7DQogICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICYgKDE0MzM2MCB8IDIwOTcxNTIpKSB7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gODczODg2OCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoY29udGV4dCAmIDEwMjQpDQogICAgICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCA2NSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBpbml0ID0gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdWYXJpYWJsZURlY2xhcmF0aW9uJywNCiAgICAgICAgICAgICAgICAgICAgICAgIGtpbmQ6ICdsZXQnLA0KICAgICAgICAgICAgICAgICAgICAgICAgZGVjbGFyYXRpb25zOiBwYXJzZVZhcmlhYmxlRGVjbGFyYXRpb25MaXN0KHBhcnNlciwgY29udGV4dCB8IDEzNDIxNzcyOCwgc2NvcGUsIDgsIDMyKQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPSAxOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoY29udGV4dCAmIDEwMjQpIHsNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCA2NSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBpc1ZhckRlY2wgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDE7DQogICAgICAgICAgICAgICAgaW5pdCA9IHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaW5pdCwgMCwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMjc0NTQ5KQ0KICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMTIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgICAgICAgICBpbml0ID0gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHRva2VuID09PSA4NjA5MA0KICAgICAgICAgICAgICAgID8gew0KICAgICAgICAgICAgICAgICAgICB0eXBlOiAnVmFyaWFibGVEZWNsYXJhdGlvbicsDQogICAgICAgICAgICAgICAgICAgIGtpbmQ6ICd2YXInLA0KICAgICAgICAgICAgICAgICAgICBkZWNsYXJhdGlvbnM6IHBhcnNlVmFyaWFibGVEZWNsYXJhdGlvbkxpc3QocGFyc2VyLCBjb250ZXh0IHwgMTM0MjE3NzI4LCBzY29wZSwgNCwgMzIpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIDogew0KICAgICAgICAgICAgICAgICAgICB0eXBlOiAnVmFyaWFibGVEZWNsYXJhdGlvbicsDQogICAgICAgICAgICAgICAgICAgIGtpbmQ6ICdjb25zdCcsDQogICAgICAgICAgICAgICAgICAgIGRlY2xhcmF0aW9uczogcGFyc2VWYXJpYWJsZURlY2xhcmF0aW9uTGlzdChwYXJzZXIsIGNvbnRleHQgfCAxMzQyMTc3MjgsIHNjb3BlLCAxNiwgMzIpDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDE7DQogICAgICAgIH0NCiAgICB9DQogICAgZWxzZSBpZiAodG9rZW4gPT09IDEwNzQ3OTA0MTcpIHsNCiAgICAgICAgaWYgKGZvckF3YWl0KQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgODApOw0KICAgIH0NCiAgICBlbHNlIGlmICgodG9rZW4gJiAyMDk3MTUyKSA9PT0gMjA5NzE1Mikgew0KICAgICAgICBpbml0ID0NCiAgICAgICAgICAgIHRva2VuID09PSAyMTYyNzAwDQogICAgICAgICAgICAgICAgPyBwYXJzZU9iamVjdExpdGVyYWxPclBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCB2b2lkIDAsIDEsIDAsIDAsIDIsIDMyLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKQ0KICAgICAgICAgICAgICAgIDogcGFyc2VBcnJheUV4cHJlc3Npb25PclBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCB2b2lkIDAsIDEsIDAsIDAsIDIsIDMyLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgZGVzdHJ1Y3RpYmxlID0gcGFyc2VyLmRlc3RydWN0aWJsZTsNCiAgICAgICAgaWYgKGNvbnRleHQgJiAyNTYgJiYgZGVzdHJ1Y3RpYmxlICYgNjQpIHsNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDYxKTsNCiAgICAgICAgfQ0KICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9DQogICAgICAgICAgICBkZXN0cnVjdGlibGUgJiAxNiA/IDIgOiAxOw0KICAgICAgICBpbml0ID0gcGFyc2VNZW1iZXJPclVwZGF0ZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0IHwgMTM0MjE3NzI4LCBpbml0LCAwLCAwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGluaXQgPSBwYXJzZUxlZnRIYW5kU2lkZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0IHwgMTM0MjE3NzI4LCAxLCAwLCAxLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICB9DQogICAgaWYgKChwYXJzZXIudG9rZW4gJiAyNjIxNDQpID09PSAyNjIxNDQpIHsNCiAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMjc0NTQ5KSB7DQogICAgICAgICAgICBpZiAocGFyc2VyLmFzc2lnbmFibGUgJiAyKQ0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDc4LCBmb3JBd2FpdCA/ICdhd2FpdCcgOiAnb2YnKTsNCiAgICAgICAgICAgIHJlaW50ZXJwcmV0VG9QYXR0ZXJuKHBhcnNlciwgaW5pdCk7DQogICAgICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgICAgICAgICAgcmlnaHQgPSBwYXJzZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAwLCAwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICAgICAgICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDE2KTsNCiAgICAgICAgICAgIGNvbnN0IGJvZHkgPSBwYXJzZUl0ZXJhdGlvblN0YXRlbWVudEJvZHkocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgbGFiZWxzKTsNCiAgICAgICAgICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICAgICAgICAgIHR5cGU6ICdGb3JPZlN0YXRlbWVudCcsDQogICAgICAgICAgICAgICAgbGVmdDogaW5pdCwNCiAgICAgICAgICAgICAgICByaWdodCwNCiAgICAgICAgICAgICAgICBib2R5LA0KICAgICAgICAgICAgICAgIGF3YWl0OiBmb3JBd2FpdA0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHBhcnNlci5hc3NpZ25hYmxlICYgMikNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDc4LCAnaW4nKTsNCiAgICAgICAgcmVpbnRlcnByZXRUb1BhdHRlcm4ocGFyc2VyLCBpbml0KTsNCiAgICAgICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICAgICAgaWYgKGZvckF3YWl0KQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgODApOw0KICAgICAgICByaWdodCA9IHBhcnNlRXhwcmVzc2lvbnMocGFyc2VyLCBjb250ZXh0LCAwLCAxLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICAgICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMTYpOw0KICAgICAgICBjb25zdCBib2R5ID0gcGFyc2VJdGVyYXRpb25TdGF0ZW1lbnRCb2R5KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGxhYmVscyk7DQogICAgICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICAgICAgdHlwZTogJ0ZvckluU3RhdGVtZW50JywNCiAgICAgICAgICAgIGJvZHksDQogICAgICAgICAgICBsZWZ0OiBpbml0LA0KICAgICAgICAgICAgcmlnaHQNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGlmIChmb3JBd2FpdCkNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgODApOw0KICAgIGlmICghaXNWYXJEZWNsKSB7DQogICAgICAgIGlmIChkZXN0cnVjdGlibGUgJiA4ICYmIHBhcnNlci50b2tlbiAhPT0gMTA3NzkzNjE1Nykgew0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgNzgsICdsb29wJyk7DQogICAgICAgIH0NCiAgICAgICAgaW5pdCA9IHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0IHwgMTM0MjE3NzI4LCAwLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCBpbml0KTsNCiAgICB9DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTgpDQogICAgICAgIGluaXQgPSBwYXJzZVNlcXVlbmNlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MsIGluaXQpOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDEwNzQ3OTA0MTcpOw0KICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDEwNzQ3OTA0MTcpDQogICAgICAgIHRlc3QgPSBwYXJzZUV4cHJlc3Npb25zKHBhcnNlciwgY29udGV4dCwgMCwgMSwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMTA3NDc5MDQxNyk7DQogICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTYpDQogICAgICAgIHVwZGF0ZSA9IHBhcnNlRXhwcmVzc2lvbnMocGFyc2VyLCBjb250ZXh0LCAwLCAxLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAxNik7DQogICAgY29uc3QgYm9keSA9IHBhcnNlSXRlcmF0aW9uU3RhdGVtZW50Qm9keShwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBsYWJlbHMpOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnRm9yU3RhdGVtZW50JywNCiAgICAgICAgaW5pdCwNCiAgICAgICAgdGVzdCwNCiAgICAgICAgdXBkYXRlLA0KICAgICAgICBib2R5DQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZVJlc3RyaWN0ZWRJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgc2NvcGUpIHsNCiAgICBpZiAoIWlzVmFsaWRJZGVudGlmaWVyKGNvbnRleHQsIHBhcnNlci50b2tlbikpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDExNSk7DQogICAgaWYgKChwYXJzZXIudG9rZW4gJiA1MzcwNzk4MDgpID09PSA1MzcwNzk4MDgpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDExNik7DQogICAgaWYgKHNjb3BlKQ0KICAgICAgICBhZGRCbG9ja05hbWUocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgcGFyc2VyLnRva2VuVmFsdWUsIDgsIDApOw0KICAgIHJldHVybiBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKTsNCn0NCmZ1bmN0aW9uIHBhcnNlSW1wb3J0RGVjbGFyYXRpb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSkgew0KICAgIGNvbnN0IHN0YXJ0ID0gcGFyc2VyLnRva2VuUG9zOw0KICAgIGNvbnN0IGxpbmUgPSBwYXJzZXIubGluZVBvczsNCiAgICBjb25zdCBjb2x1bW4gPSBwYXJzZXIuY29sUG9zOw0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIGxldCBzb3VyY2UgPSBudWxsOw0KICAgIGNvbnN0IHsgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgIGxldCBzcGVjaWZpZXJzID0gW107DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTM0MjgzMjY3KSB7DQogICAgICAgIHNvdXJjZSA9IHBhcnNlTGl0ZXJhbChwYXJzZXIsIGNvbnRleHQpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgaWYgKHBhcnNlci50b2tlbiAmIDE0MzM2MCkgew0KICAgICAgICAgICAgY29uc3QgbG9jYWwgPSBwYXJzZVJlc3RyaWN0ZWRJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgc2NvcGUpOw0KICAgICAgICAgICAgc3BlY2lmaWVycyA9IFsNCiAgICAgICAgICAgICAgICBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgew0KICAgICAgICAgICAgICAgICAgICB0eXBlOiAnSW1wb3J0RGVmYXVsdFNwZWNpZmllcicsDQogICAgICAgICAgICAgICAgICAgIGxvY2FsDQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIF07DQogICAgICAgICAgICBpZiAoY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQsIDE4KSkgew0KICAgICAgICAgICAgICAgIHN3aXRjaCAocGFyc2VyLnRva2VuKSB7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgODQ1NzAxNDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHNwZWNpZmllcnMucHVzaChwYXJzZUltcG9ydE5hbWVzcGFjZVNwZWNpZmllcihwYXJzZXIsIGNvbnRleHQsIHNjb3BlKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAyMTYyNzAwOg0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VJbXBvcnRTcGVjaWZpZXJPck5hbWVkSW1wb3J0cyhwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBzcGVjaWZpZXJzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTA1KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBzd2l0Y2ggKHBhcnNlci50b2tlbikgew0KICAgICAgICAgICAgICAgIGNhc2UgODQ1NzAxNDoNCiAgICAgICAgICAgICAgICAgICAgc3BlY2lmaWVycyA9IFtwYXJzZUltcG9ydE5hbWVzcGFjZVNwZWNpZmllcihwYXJzZXIsIGNvbnRleHQsIHNjb3BlKV07DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgMjE2MjcwMDoNCiAgICAgICAgICAgICAgICAgICAgcGFyc2VJbXBvcnRTcGVjaWZpZXJPck5hbWVkSW1wb3J0cyhwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBzcGVjaWZpZXJzKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSA2NzE3NDQxMToNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW1wb3J0Q2FsbERlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgICAgICAgICAgY2FzZSA2NzEwODg3NzoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW1wb3J0TWV0YURlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMjgsIEtleXdvcmREZXNjVGFibGVbcGFyc2VyLnRva2VuICYgMjU1XSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgc291cmNlID0gcGFyc2VNb2R1bGVTcGVjaWZpZXIocGFyc2VyLCBjb250ZXh0KTsNCiAgICB9DQogICAgbWF0Y2hPckluc2VydFNlbWljb2xvbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdJbXBvcnREZWNsYXJhdGlvbicsDQogICAgICAgIHNwZWNpZmllcnMsDQogICAgICAgIHNvdXJjZQ0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VJbXBvcnROYW1lc3BhY2VTcGVjaWZpZXIocGFyc2VyLCBjb250ZXh0LCBzY29wZSkgew0KICAgIGNvbnN0IHsgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCA3NzkzNCk7DQogICAgaWYgKChwYXJzZXIudG9rZW4gJiAxMzQyMTc3MjgpID09PSAxMzQyMTc3MjgpIHsNCiAgICAgICAgcmVwb3J0TWVzc2FnZUF0KHRva2VuUG9zLCBwYXJzZXIubGluZSwgcGFyc2VyLmluZGV4LCAyOCwgS2V5d29yZERlc2NUYWJsZVtwYXJzZXIudG9rZW4gJiAyNTVdKTsNCiAgICB9DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCB7DQogICAgICAgIHR5cGU6ICdJbXBvcnROYW1lc3BhY2VTcGVjaWZpZXInLA0KICAgICAgICBsb2NhbDogcGFyc2VSZXN0cmljdGVkSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIHNjb3BlKQ0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VNb2R1bGVTcGVjaWZpZXIocGFyc2VyLCBjb250ZXh0KSB7DQogICAgY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQsIDEyNDA0KTsNCiAgICBpZiAocGFyc2VyLnRva2VuICE9PSAxMzQyODMyNjcpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDEwMywgJ0ltcG9ydCcpOw0KICAgIHJldHVybiBwYXJzZUxpdGVyYWwocGFyc2VyLCBjb250ZXh0KTsNCn0NCmZ1bmN0aW9uIHBhcnNlSW1wb3J0U3BlY2lmaWVyT3JOYW1lZEltcG9ydHMocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgc3BlY2lmaWVycykgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIHdoaWxlIChwYXJzZXIudG9rZW4gJiAxNDMzNjApIHsNCiAgICAgICAgbGV0IHsgdG9rZW4sIHRva2VuVmFsdWUsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICAgICAgY29uc3QgaW1wb3J0ZWQgPSBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICAgICAgbGV0IGxvY2FsOw0KICAgICAgICBpZiAoY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQsIDc3OTM0KSkgew0KICAgICAgICAgICAgaWYgKChwYXJzZXIudG9rZW4gJiAxMzQyMTc3MjgpID09PSAxMzQyMTc3MjggfHwgcGFyc2VyLnRva2VuID09PSAxOCkgew0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDEwNCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICB2YWxpZGF0ZUJpbmRpbmdJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMTYsIHBhcnNlci50b2tlbiwgMCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0b2tlblZhbHVlID0gcGFyc2VyLnRva2VuVmFsdWU7DQogICAgICAgICAgICBsb2NhbCA9IHBhcnNlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDApOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgdmFsaWRhdGVCaW5kaW5nSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDE2LCB0b2tlbiwgMCk7DQogICAgICAgICAgICBsb2NhbCA9IGltcG9ydGVkOw0KICAgICAgICB9DQogICAgICAgIGlmIChzY29wZSkNCiAgICAgICAgICAgIGFkZEJsb2NrTmFtZShwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCB0b2tlblZhbHVlLCA4LCAwKTsNCiAgICAgICAgc3BlY2lmaWVycy5wdXNoKGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCB7DQogICAgICAgICAgICB0eXBlOiAnSW1wb3J0U3BlY2lmaWVyJywNCiAgICAgICAgICAgIGxvY2FsLA0KICAgICAgICAgICAgaW1wb3J0ZWQNCiAgICAgICAgfSkpOw0KICAgICAgICBpZiAocGFyc2VyLnRva2VuICE9PSAxMDc0NzkwNDE1KQ0KICAgICAgICAgICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDE4KTsNCiAgICB9DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDEwNzQ3OTA0MTUpOw0KICAgIHJldHVybiBzcGVjaWZpZXJzOw0KfQ0KZnVuY3Rpb24gcGFyc2VJbXBvcnRNZXRhRGVjbGFyYXRpb24ocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbGV0IGV4cHIgPSBwYXJzZUltcG9ydE1ldGFFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0lkZW50aWZpZXInLA0KICAgICAgICBuYW1lOiAnaW1wb3J0Jw0KICAgIH0pLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICBleHByID0gcGFyc2VNZW1iZXJPclVwZGF0ZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBleHByLCAwLCAwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICBleHByID0gcGFyc2VBc3NpZ25tZW50RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDAsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIGV4cHIpOw0KICAgIHJldHVybiBwYXJzZUV4cHJlc3Npb25TdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBleHByLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCn0NCmZ1bmN0aW9uIHBhcnNlSW1wb3J0Q2FsbERlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGxldCBleHByID0gcGFyc2VJbXBvcnRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgZXhwciA9IHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgZXhwciwgMCwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTgpIHsNCiAgICAgICAgZXhwciA9IHBhcnNlU2VxdWVuY2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgZXhwcik7DQogICAgfQ0KICAgIHJldHVybiBwYXJzZUV4cHJlc3Npb25TdGF0ZW1lbnQocGFyc2VyLCBjb250ZXh0LCBleHByLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCn0NCmZ1bmN0aW9uIHBhcnNlRXhwb3J0RGVjbGFyYXRpb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSkgew0KICAgIGNvbnN0IHN0YXJ0ID0gcGFyc2VyLnRva2VuUG9zOw0KICAgIGNvbnN0IGxpbmUgPSBwYXJzZXIubGluZVBvczsNCiAgICBjb25zdCBjb2x1bW4gPSBwYXJzZXIuY29sUG9zOw0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgY29uc3Qgc3BlY2lmaWVycyA9IFtdOw0KICAgIGxldCBkZWNsYXJhdGlvbiA9IG51bGw7DQogICAgbGV0IHNvdXJjZSA9IG51bGw7DQogICAgbGV0IGtleTsNCiAgICBpZiAoY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMjA1NjMpKSB7DQogICAgICAgIHN3aXRjaCAocGFyc2VyLnRva2VuKSB7DQogICAgICAgICAgICBjYXNlIDg2MTA2OiB7DQogICAgICAgICAgICAgICAgZGVjbGFyYXRpb24gPSBwYXJzZUZ1bmN0aW9uRGVjbGFyYXRpb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgNCwgMSwgMSwgMCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDEzMzoNCiAgICAgICAgICAgIGNhc2UgODYwOTY6DQogICAgICAgICAgICAgICAgZGVjbGFyYXRpb24gPSBwYXJzZUNsYXNzRGVjbGFyYXRpb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgMSwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlIDIwOTAwNzoNCiAgICAgICAgICAgICAgICBjb25zdCB7IHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICAgICAgICAgICAgICBkZWNsYXJhdGlvbiA9IHBhcnNlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDApOw0KICAgICAgICAgICAgICAgIGNvbnN0IHsgZmxhZ3MgfSA9IHBhcnNlcjsNCiAgICAgICAgICAgICAgICBpZiAoKGZsYWdzICYgMSkgPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gODYxMDYpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlY2xhcmF0aW9uID0gcGFyc2VGdW5jdGlvbkRlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDQsIDEsIDEsIDEsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gNjcxNzQ0MTEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWNsYXJhdGlvbiA9IHBhcnNlQXN5bmNBcnJvd09yQ2FsbEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBkZWNsYXJhdGlvbiwgMSwgMSwgMCwgZmxhZ3MsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlY2xhcmF0aW9uID0gcGFyc2VNZW1iZXJPclVwZGF0ZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBkZWNsYXJhdGlvbiwgMCwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVjbGFyYXRpb24gPSBwYXJzZUFzc2lnbm1lbnRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMCwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgZGVjbGFyYXRpb24pOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocGFyc2VyLnRva2VuICYgMTQzMzYwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZSA9IGNyZWF0ZUFycm93SGVhZFBhcnNpbmdTY29wZShwYXJzZXIsIGNvbnRleHQsIHBhcnNlci50b2tlblZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWNsYXJhdGlvbiA9IHBhcnNlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDApOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlY2xhcmF0aW9uID0gcGFyc2VBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBbZGVjbGFyYXRpb25dLCAxLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgZGVjbGFyYXRpb24gPSBwYXJzZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAwLCAwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICAgICAgICAgICAgICBtYXRjaE9ySW5zZXJ0U2VtaWNvbG9uKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoc2NvcGUpDQogICAgICAgICAgICBkZWNsYXJlVW5ib3VuZFZhcmlhYmxlKHBhcnNlciwgJ2RlZmF1bHQnKTsNCiAgICAgICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgICAgICB0eXBlOiAnRXhwb3J0RGVmYXVsdERlY2xhcmF0aW9uJywNCiAgICAgICAgICAgIGRlY2xhcmF0aW9uDQogICAgICAgIH0pOw0KICAgIH0NCiAgICBzd2l0Y2ggKHBhcnNlci50b2tlbikgew0KICAgICAgICBjYXNlIDg0NTcwMTQ6IHsNCiAgICAgICAgICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgICAgICAgICAgbGV0IGV4cG9ydGVkID0gbnVsbDsNCiAgICAgICAgICAgIGNvbnN0IGlzTmFtZWREZWNsYXJhdGlvbiA9IGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0LCA3NzkzNCk7DQogICAgICAgICAgICBpZiAoaXNOYW1lZERlY2xhcmF0aW9uKSB7DQogICAgICAgICAgICAgICAgaWYgKHNjb3BlKQ0KICAgICAgICAgICAgICAgICAgICBkZWNsYXJlVW5ib3VuZFZhcmlhYmxlKHBhcnNlciwgcGFyc2VyLnRva2VuVmFsdWUpOw0KICAgICAgICAgICAgICAgIGV4cG9ydGVkID0gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgMTI0MDQpOw0KICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTM0MjgzMjY3KQ0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDEwMywgJ0V4cG9ydCcpOw0KICAgICAgICAgICAgc291cmNlID0gcGFyc2VMaXRlcmFsKHBhcnNlciwgY29udGV4dCk7DQogICAgICAgICAgICBtYXRjaE9ySW5zZXJ0U2VtaWNvbG9uKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICAgICAgICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICAgICAgICAgIHR5cGU6ICdFeHBvcnRBbGxEZWNsYXJhdGlvbicsDQogICAgICAgICAgICAgICAgc291cmNlLA0KICAgICAgICAgICAgICAgIGV4cG9ydGVkDQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBjYXNlIDIxNjI3MDA6IHsNCiAgICAgICAgICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgICAgICAgICAgY29uc3QgdG1wRXhwb3J0ZWROYW1lcyA9IFtdOw0KICAgICAgICAgICAgY29uc3QgdG1wRXhwb3J0ZWRCaW5kaW5ncyA9IFtdOw0KICAgICAgICAgICAgd2hpbGUgKHBhcnNlci50b2tlbiAmIDE0MzM2MCkgew0KICAgICAgICAgICAgICAgIGNvbnN0IHsgdG9rZW5Qb3MsIHRva2VuVmFsdWUsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgICAgICAgICAgICAgIGNvbnN0IGxvY2FsID0gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMCk7DQogICAgICAgICAgICAgICAgbGV0IGV4cG9ydGVkOw0KICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDc3OTM0KSB7DQogICAgICAgICAgICAgICAgICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoKHBhcnNlci50b2tlbiAmIDEzNDIxNzcyOCkgPT09IDEzNDIxNzcyOCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTA0KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRtcEV4cG9ydGVkTmFtZXMucHVzaChwYXJzZXIudG9rZW5WYWx1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB0bXBFeHBvcnRlZEJpbmRpbmdzLnB1c2godG9rZW5WYWx1ZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZXhwb3J0ZWQgPSBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChzY29wZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdG1wRXhwb3J0ZWROYW1lcy5wdXNoKHBhcnNlci50b2tlblZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRtcEV4cG9ydGVkQmluZGluZ3MucHVzaChwYXJzZXIudG9rZW5WYWx1ZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZXhwb3J0ZWQgPSBsb2NhbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgc3BlY2lmaWVycy5wdXNoKGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCB7DQogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdFeHBvcnRTcGVjaWZpZXInLA0KICAgICAgICAgICAgICAgICAgICBsb2NhbCwNCiAgICAgICAgICAgICAgICAgICAgZXhwb3J0ZWQNCiAgICAgICAgICAgICAgICB9KSk7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTA3NDc5MDQxNSkNCiAgICAgICAgICAgICAgICAgICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDE4KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCAxMDc0NzkwNDE1KTsNCiAgICAgICAgICAgIGlmIChjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCwgMTI0MDQpKSB7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTM0MjgzMjY3KQ0KICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMDMsICdFeHBvcnQnKTsNCiAgICAgICAgICAgICAgICBzb3VyY2UgPSBwYXJzZUxpdGVyYWwocGFyc2VyLCBjb250ZXh0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHNjb3BlKSB7DQogICAgICAgICAgICAgICAgbGV0IGkgPSAwOw0KICAgICAgICAgICAgICAgIGxldCBpTWF4ID0gdG1wRXhwb3J0ZWROYW1lcy5sZW5ndGg7DQogICAgICAgICAgICAgICAgZm9yICg7IGkgPCBpTWF4OyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgZGVjbGFyZVVuYm91bmRWYXJpYWJsZShwYXJzZXIsIHRtcEV4cG9ydGVkTmFtZXNbaV0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpID0gMDsNCiAgICAgICAgICAgICAgICBpTWF4ID0gdG1wRXhwb3J0ZWRCaW5kaW5ncy5sZW5ndGg7DQogICAgICAgICAgICAgICAgZm9yICg7IGkgPCBpTWF4OyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgYWRkQmluZGluZ1RvRXhwb3J0cyhwYXJzZXIsIHRtcEV4cG9ydGVkQmluZGluZ3NbaV0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIG1hdGNoT3JJbnNlcnRTZW1pY29sb24ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgY2FzZSA4NjA5NjoNCiAgICAgICAgICAgIGRlY2xhcmF0aW9uID0gcGFyc2VDbGFzc0RlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDIsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgODYxMDY6DQogICAgICAgICAgICBkZWNsYXJhdGlvbiA9IHBhcnNlRnVuY3Rpb25EZWNsYXJhdGlvbihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCA0LCAxLCAyLCAwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlIDI0MTczOToNCiAgICAgICAgICAgIGRlY2xhcmF0aW9uID0gcGFyc2VMZXhpY2FsRGVjbGFyYXRpb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgOCwgNjQsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgODYwOTI6DQogICAgICAgICAgICBkZWNsYXJhdGlvbiA9IHBhcnNlTGV4aWNhbERlY2xhcmF0aW9uKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDE2LCA2NCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSA4NjA5MDoNCiAgICAgICAgICAgIGRlY2xhcmF0aW9uID0gcGFyc2VWYXJpYWJsZVN0YXRlbWVudChwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCA2NCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAyMDkwMDc6DQogICAgICAgICAgICBjb25zdCB7IHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICAgICAgICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgICAgICAgICAgaWYgKChwYXJzZXIuZmxhZ3MgJiAxKSA9PT0gMCAmJiBwYXJzZXIudG9rZW4gPT09IDg2MTA2KSB7DQogICAgICAgICAgICAgICAgZGVjbGFyYXRpb24gPSBwYXJzZUZ1bmN0aW9uRGVjbGFyYXRpb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgNCwgMSwgMiwgMSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgaWYgKHNjb3BlKSB7DQogICAgICAgICAgICAgICAgICAgIGtleSA9IGRlY2xhcmF0aW9uLmlkID8gZGVjbGFyYXRpb24uaWQubmFtZSA6ICcnOw0KICAgICAgICAgICAgICAgICAgICBkZWNsYXJlVW5ib3VuZFZhcmlhYmxlKHBhcnNlciwga2V5KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAyOCwgS2V5d29yZERlc2NUYWJsZVtwYXJzZXIudG9rZW4gJiAyNTVdKTsNCiAgICB9DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdFeHBvcnROYW1lZERlY2xhcmF0aW9uJywNCiAgICAgICAgZGVjbGFyYXRpb24sDQogICAgICAgIHNwZWNpZmllcnMsDQogICAgICAgIHNvdXJjZQ0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgY2FuQXNzaWduLCBpc1BhdHRlcm4sIGluR3JvdXAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBsZXQgZXhwciA9IHBhcnNlUHJpbWFyeUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAyLCAwLCBjYW5Bc3NpZ24sIGlzUGF0dGVybiwgaW5Hcm91cCwgMSwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgZXhwciA9IHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgZXhwciwgaW5Hcm91cCwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgcmV0dXJuIHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCAwLCBzdGFydCwgbGluZSwgY29sdW1uLCBleHByKTsNCn0NCmZ1bmN0aW9uIHBhcnNlU2VxdWVuY2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgZXhwcikgew0KICAgIGNvbnN0IGV4cHJlc3Npb25zID0gW2V4cHJdOw0KICAgIHdoaWxlIChjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAxOCkpIHsNCiAgICAgICAgZXhwcmVzc2lvbnMucHVzaChwYXJzZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAwLCBpbkdyb3VwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKSk7DQogICAgfQ0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnU2VxdWVuY2VFeHByZXNzaW9uJywNCiAgICAgICAgZXhwcmVzc2lvbnMNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlRXhwcmVzc2lvbnMocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBjYW5Bc3NpZ24sIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBjb25zdCBleHByID0gcGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgY2FuQXNzaWduLCAwLCBpbkdyb3VwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICByZXR1cm4gcGFyc2VyLnRva2VuID09PSAxOA0KICAgICAgICA/IHBhcnNlU2VxdWVuY2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgZXhwcikNCiAgICAgICAgOiBleHByOw0KfQ0KZnVuY3Rpb24gcGFyc2VBc3NpZ25tZW50RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIGlzUGF0dGVybiwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgbGVmdCkgew0KICAgIGNvbnN0IHsgdG9rZW4gfSA9IHBhcnNlcjsNCiAgICBpZiAoKHRva2VuICYgNDE5NDMwNCkgPT09IDQxOTQzMDQpIHsNCiAgICAgICAgaWYgKHBhcnNlci5hc3NpZ25hYmxlICYgMikNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDI0KTsNCiAgICAgICAgaWYgKCghaXNQYXR0ZXJuICYmIHRva2VuID09PSAxMDc3OTM2MTU3ICYmIGxlZnQudHlwZSA9PT0gJ0FycmF5RXhwcmVzc2lvbicpIHx8DQogICAgICAgICAgICBsZWZ0LnR5cGUgPT09ICdPYmplY3RFeHByZXNzaW9uJykgew0KICAgICAgICAgICAgcmVpbnRlcnByZXRUb1BhdHRlcm4ocGFyc2VyLCBsZWZ0KTsNCiAgICAgICAgfQ0KICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgICAgICBjb25zdCByaWdodCA9IHBhcnNlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDEsIDEsIGluR3JvdXAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgaXNQYXR0ZXJuDQogICAgICAgICAgICA/IHsNCiAgICAgICAgICAgICAgICB0eXBlOiAnQXNzaWdubWVudFBhdHRlcm4nLA0KICAgICAgICAgICAgICAgIGxlZnQsDQogICAgICAgICAgICAgICAgcmlnaHQNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIDogew0KICAgICAgICAgICAgICAgIHR5cGU6ICdBc3NpZ25tZW50RXhwcmVzc2lvbicsDQogICAgICAgICAgICAgICAgbGVmdCwNCiAgICAgICAgICAgICAgICBvcGVyYXRvcjogS2V5d29yZERlc2NUYWJsZVt0b2tlbiAmIDI1NV0sDQogICAgICAgICAgICAgICAgcmlnaHQNCiAgICAgICAgICAgIH0pOw0KICAgIH0NCiAgICBpZiAoKHRva2VuICYgODQ1NDE0NCkgPT09IDg0NTQxNDQpIHsNCiAgICAgICAgbGVmdCA9IHBhcnNlQmluYXJ5RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIDQsIHRva2VuLCBsZWZ0KTsNCiAgICB9DQogICAgaWYgKGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDIyKSkgew0KICAgICAgICBsZWZ0ID0gcGFyc2VDb25kaXRpb25hbEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBsZWZ0LCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICB9DQogICAgcmV0dXJuIGxlZnQ7DQp9DQpmdW5jdGlvbiBwYXJzZUFzc2lnbm1lbnRFeHByZXNzaW9uT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgaXNQYXR0ZXJuLCBzdGFydCwgbGluZSwgY29sdW1uLCBsZWZ0KSB7DQogICAgY29uc3QgeyB0b2tlbiB9ID0gcGFyc2VyOw0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgY29uc3QgcmlnaHQgPSBwYXJzZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAxLCBpbkdyb3VwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICBsZWZ0ID0gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIGlzUGF0dGVybg0KICAgICAgICA/IHsNCiAgICAgICAgICAgIHR5cGU6ICdBc3NpZ25tZW50UGF0dGVybicsDQogICAgICAgICAgICBsZWZ0LA0KICAgICAgICAgICAgcmlnaHQNCiAgICAgICAgfQ0KICAgICAgICA6IHsNCiAgICAgICAgICAgIHR5cGU6ICdBc3NpZ25tZW50RXhwcmVzc2lvbicsDQogICAgICAgICAgICBsZWZ0LA0KICAgICAgICAgICAgb3BlcmF0b3I6IEtleXdvcmREZXNjVGFibGVbdG9rZW4gJiAyNTVdLA0KICAgICAgICAgICAgcmlnaHQNCiAgICAgICAgfSk7DQogICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgIHJldHVybiBsZWZ0Ow0KfQ0KZnVuY3Rpb24gcGFyc2VDb25kaXRpb25hbEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCB0ZXN0LCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgY29uc3QgY29uc2VxdWVudCA9IHBhcnNlRXhwcmVzc2lvbihwYXJzZXIsIChjb250ZXh0IHwgMTM0MjE3NzI4KSBeIDEzNDIxNzcyOCwgMSwgMCwgMCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMjEpOw0KICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMTsNCiAgICBjb25zdCBhbHRlcm5hdGUgPSBwYXJzZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAwLCAwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdDb25kaXRpb25hbEV4cHJlc3Npb24nLA0KICAgICAgICB0ZXN0LA0KICAgICAgICBjb25zZXF1ZW50LA0KICAgICAgICBhbHRlcm5hdGUNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlQmluYXJ5RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIG1pblByZWMsIG9wZXJhdG9yLCBsZWZ0KSB7DQogICAgY29uc3QgYml0ID0gLSgoY29udGV4dCAmIDEzNDIxNzcyOCkgPiAwKSAmIDg3Mzg4Njg7DQogICAgbGV0IHQ7DQogICAgbGV0IHByZWM7DQogICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgIHdoaWxlIChwYXJzZXIudG9rZW4gJiA4NDU0MTQ0KSB7DQogICAgICAgIHQgPSBwYXJzZXIudG9rZW47DQogICAgICAgIHByZWMgPSB0ICYgMzg0MDsNCiAgICAgICAgaWYgKCh0ICYgNTI0Mjg4ICYmIG9wZXJhdG9yICYgMjY4NDM1NDU2KSB8fCAob3BlcmF0b3IgJiA1MjQyODggJiYgdCAmIDI2ODQzNTQ1NikpIHsNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDE2MCk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHByZWMgKyAoKHQgPT09IDg0NTcyNzMpIDw8IDgpIC0gKChiaXQgPT09IHQpIDw8IDEyKSA8PSBtaW5QcmVjKQ0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgICAgIGxlZnQgPSBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICAgICAgdHlwZTogdCAmIDUyNDI4OCB8fCB0ICYgMjY4NDM1NDU2ID8gJ0xvZ2ljYWxFeHByZXNzaW9uJyA6ICdCaW5hcnlFeHByZXNzaW9uJywNCiAgICAgICAgICAgIGxlZnQsDQogICAgICAgICAgICByaWdodDogcGFyc2VCaW5hcnlFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcywgcHJlYywgdCwgcGFyc2VMZWZ0SGFuZFNpZGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMCwgaW5Hcm91cCwgMSwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcykpLA0KICAgICAgICAgICAgb3BlcmF0b3I6IEtleXdvcmREZXNjVGFibGVbdCAmIDI1NV0NCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDEwNzc5MzYxNTcpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDI0KTsNCiAgICByZXR1cm4gbGVmdDsNCn0NCmZ1bmN0aW9uIHBhcnNlVW5hcnlFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaXNMSFMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIGluR3JvdXApIHsNCiAgICBpZiAoIWlzTEhTKQ0KICAgICAgICByZXBvcnQocGFyc2VyLCAwKTsNCiAgICBjb25zdCB1bmFyeU9wZXJhdG9yID0gcGFyc2VyLnRva2VuOw0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgY29uc3QgYXJnID0gcGFyc2VMZWZ0SGFuZFNpZGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMCwgaW5Hcm91cCwgMSwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gODQ1NzI3MykNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMzEpOw0KICAgIGlmIChjb250ZXh0ICYgMTAyNCAmJiB1bmFyeU9wZXJhdG9yID09PSAxNjg2MzI3OCkgew0KICAgICAgICBpZiAoYXJnLnR5cGUgPT09ICdJZGVudGlmaWVyJykgew0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTE4KTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChpc1Byb3BlcnR5V2l0aFByaXZhdGVGaWVsZEtleShhcmcpKSB7DQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMjQpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ1VuYXJ5RXhwcmVzc2lvbicsDQogICAgICAgIG9wZXJhdG9yOiBLZXl3b3JkRGVzY1RhYmxlW3VuYXJ5T3BlcmF0b3IgJiAyNTVdLA0KICAgICAgICBhcmd1bWVudDogYXJnLA0KICAgICAgICBwcmVmaXg6IHRydWUNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlQXN5bmNFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgaXNMSFMsIGNhbkFzc2lnbiwgaXNQYXR0ZXJuLCBpbk5ldywgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnN0IHsgdG9rZW4gfSA9IHBhcnNlcjsNCiAgICBjb25zdCBleHByID0gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgaXNQYXR0ZXJuKTsNCiAgICBjb25zdCB7IGZsYWdzIH0gPSBwYXJzZXI7DQogICAgaWYgKChmbGFncyAmIDEpID09PSAwKSB7DQogICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDg2MTA2KSB7DQogICAgICAgICAgICByZXR1cm4gcGFyc2VGdW5jdGlvbkV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCBpbkdyb3VwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoKHBhcnNlci50b2tlbiAmIDE0MzM2MCkgPT09IDE0MzM2MCkgew0KICAgICAgICAgICAgaWYgKCFpc0xIUykNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAwKTsNCiAgICAgICAgICAgIHJldHVybiBwYXJzZUFzeW5jQXJyb3dBZnRlcklkZW50KHBhcnNlciwgY29udGV4dCwgY2FuQXNzaWduLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBpZiAoIWluTmV3ICYmIHBhcnNlci50b2tlbiA9PT0gNjcxNzQ0MTEpIHsNCiAgICAgICAgcmV0dXJuIHBhcnNlQXN5bmNBcnJvd09yQ2FsbEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBleHByLCBjYW5Bc3NpZ24sIDEsIDAsIGZsYWdzLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICB9DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTApIHsNCiAgICAgICAgY2xhc3NpZnlJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgdG9rZW4sIDEpOw0KICAgICAgICBpZiAoaW5OZXcpDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCA0OSk7DQogICAgICAgIHJldHVybiBwYXJzZUFycm93RnJvbUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCBwYXJzZXIudG9rZW5WYWx1ZSwgZXhwciwgaW5OZXcsIGNhbkFzc2lnbiwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgfQ0KICAgIHJldHVybiBleHByOw0KfQ0KZnVuY3Rpb24gcGFyc2VZaWVsZEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBjYW5Bc3NpZ24sIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBpZiAoaW5Hcm91cCkNCiAgICAgICAgcGFyc2VyLmRlc3RydWN0aWJsZSB8PSAyNTY7DQogICAgaWYgKGNvbnRleHQgJiAyMDk3MTUyKSB7DQogICAgICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgICAgIGlmIChjb250ZXh0ICYgODM4ODYwOCkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDMwKTsNCiAgICAgICAgaWYgKCFjYW5Bc3NpZ24pDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAyNCk7DQogICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDIyKQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTIxKTsNCiAgICAgICAgbGV0IGFyZ3VtZW50ID0gbnVsbDsNCiAgICAgICAgbGV0IGRlbGVnYXRlID0gZmFsc2U7DQogICAgICAgIGlmICgocGFyc2VyLmZsYWdzICYgMSkgPT09IDApIHsNCiAgICAgICAgICAgIGRlbGVnYXRlID0gY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgODQ1NzAxNCk7DQogICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICYgKDEyMjg4IHwgNjU1MzYpIHx8IGRlbGVnYXRlKSB7DQogICAgICAgICAgICAgICAgYXJndW1lbnQgPSBwYXJzZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAwLCAwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICAgICAgdHlwZTogJ1lpZWxkRXhwcmVzc2lvbicsDQogICAgICAgICAgICBhcmd1bWVudCwNCiAgICAgICAgICAgIGRlbGVnYXRlDQogICAgICAgIH0pOw0KICAgIH0NCiAgICBpZiAoY29udGV4dCAmIDEwMjQpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDk1LCAneWllbGQnKTsNCiAgICByZXR1cm4gcGFyc2VJZGVudGlmaWVyT3JBcnJvdyhwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KfQ0KZnVuY3Rpb24gcGFyc2VBd2FpdEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbk5ldywgaW5Hcm91cCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGlmIChpbkdyb3VwKQ0KICAgICAgICBwYXJzZXIuZGVzdHJ1Y3RpYmxlIHw9IDEyODsNCiAgICBpZiAoY29udGV4dCAmIDQxOTQzMDQgfHwgKGNvbnRleHQgJiAyMDQ4ICYmIGNvbnRleHQgJiA4MTkyKSkgew0KICAgICAgICBpZiAoaW5OZXcpDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAwKTsNCiAgICAgICAgaWYgKGNvbnRleHQgJiA4Mzg4NjA4KSB7DQogICAgICAgICAgICByZXBvcnRNZXNzYWdlQXQocGFyc2VyLmluZGV4LCBwYXJzZXIubGluZSwgcGFyc2VyLmluZGV4LCAyOSk7DQogICAgICAgIH0NCiAgICAgICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICAgICAgY29uc3QgYXJndW1lbnQgPSBwYXJzZUxlZnRIYW5kU2lkZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAwLCAwLCAxLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gODQ1NzI3MykNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDMxKTsNCiAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgICAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgICAgIHR5cGU6ICdBd2FpdEV4cHJlc3Npb24nLA0KICAgICAgICAgICAgYXJndW1lbnQNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGlmIChjb250ZXh0ICYgMjA0OCkNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgOTYpOw0KICAgIHJldHVybiBwYXJzZUlkZW50aWZpZXJPckFycm93KHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQp9DQpmdW5jdGlvbiBwYXJzZUZ1bmN0aW9uQm9keShwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBvcmlnaW4sIGZpcnN0UmVzdHJpY3RlZCwgc2NvcGVFcnJvcikgew0KICAgIGNvbnN0IHsgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDIxNjI3MDApOw0KICAgIGNvbnN0IGJvZHkgPSBbXTsNCiAgICBjb25zdCBwcmV2Q29udGV4dCA9IGNvbnRleHQ7DQogICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTA3NDc5MDQxNSkgew0KICAgICAgICB3aGlsZSAocGFyc2VyLnRva2VuID09PSAxMzQyODMyNjcpIHsNCiAgICAgICAgICAgIGNvbnN0IHsgaW5kZXgsIHRva2VuUG9zLCB0b2tlblZhbHVlLCB0b2tlbiB9ID0gcGFyc2VyOw0KICAgICAgICAgICAgY29uc3QgZXhwciA9IHBhcnNlTGl0ZXJhbChwYXJzZXIsIGNvbnRleHQpOw0KICAgICAgICAgICAgaWYgKGlzVmFsaWRTdHJpY3RNb2RlKHBhcnNlciwgaW5kZXgsIHRva2VuUG9zLCB0b2tlblZhbHVlKSkgew0KICAgICAgICAgICAgICAgIGNvbnRleHQgfD0gMTAyNDsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VyLmZsYWdzICYgMTI4KSB7DQogICAgICAgICAgICAgICAgICAgIHJlcG9ydE1lc3NhZ2VBdChwYXJzZXIuaW5kZXgsIHBhcnNlci5saW5lLCBwYXJzZXIudG9rZW5Qb3MsIDY0KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlci5mbGFncyAmIDY0KSB7DQogICAgICAgICAgICAgICAgICAgIHJlcG9ydE1lc3NhZ2VBdChwYXJzZXIuaW5kZXgsIHBhcnNlci5saW5lLCBwYXJzZXIudG9rZW5Qb3MsIDgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGJvZHkucHVzaChwYXJzZURpcmVjdGl2ZShwYXJzZXIsIGNvbnRleHQsIGV4cHIsIHRva2VuLCB0b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoY29udGV4dCAmIDEwMjQpIHsNCiAgICAgICAgICAgIGlmIChmaXJzdFJlc3RyaWN0ZWQpIHsNCiAgICAgICAgICAgICAgICBpZiAoKGZpcnN0UmVzdHJpY3RlZCAmIDUzNzA3OTgwOCkgPT09IDUzNzA3OTgwOCkgew0KICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMTYpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoKGZpcnN0UmVzdHJpY3RlZCAmIDM2ODY0KSA9PT0gMzY4NjQpIHsNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMzgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChwYXJzZXIuZmxhZ3MgJiA1MTIpDQogICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTE2KTsNCiAgICAgICAgICAgIGlmIChwYXJzZXIuZmxhZ3MgJiAyNTYpDQogICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTE1KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoY29udGV4dCAmIDY0ICYmDQogICAgICAgICAgICBzY29wZSAmJg0KICAgICAgICAgICAgc2NvcGVFcnJvciAhPT0gdm9pZCAwICYmDQogICAgICAgICAgICAocHJldkNvbnRleHQgJiAxMDI0KSA9PT0gMCAmJg0KICAgICAgICAgICAgKGNvbnRleHQgJiA4MTkyKSA9PT0gMCkgew0KICAgICAgICAgICAgcmVwb3J0U2NvcGVFcnJvcihzY29wZUVycm9yKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBwYXJzZXIuZmxhZ3MgPQ0KICAgICAgICAocGFyc2VyLmZsYWdzIHwgNTEyIHwgMjU2IHwgNjQpIF4NCiAgICAgICAgICAgICg1MTIgfCAyNTYgfCA2NCk7DQogICAgcGFyc2VyLmRlc3RydWN0aWJsZSA9IChwYXJzZXIuZGVzdHJ1Y3RpYmxlIHwgMjU2KSBeIDI1NjsNCiAgICB3aGlsZSAocGFyc2VyLnRva2VuICE9PSAxMDc0NzkwNDE1KSB7DQogICAgICAgIGJvZHkucHVzaChwYXJzZVN0YXRlbWVudExpc3RJdGVtKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDQsIHt9KSk7DQogICAgfQ0KICAgIGNvbnN1bWUocGFyc2VyLCBvcmlnaW4gJiAoMTYgfCA4KSA/IGNvbnRleHQgfCAzMjc2OCA6IGNvbnRleHQsIDEwNzQ3OTA0MTUpOw0KICAgIHBhcnNlci5mbGFncyAmPSB+KDEyOCB8IDY0KTsNCiAgICBpZiAocGFyc2VyLnRva2VuID09PSAxMDc3OTM2MTU3KQ0KICAgICAgICByZXBvcnQocGFyc2VyLCAyNCk7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCB7DQogICAgICAgIHR5cGU6ICdCbG9ja1N0YXRlbWVudCcsDQogICAgICAgIGJvZHkNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlU3VwZXJFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIHN3aXRjaCAocGFyc2VyLnRva2VuKSB7DQogICAgICAgIGNhc2UgNjcxMDg5OTE6DQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxNjIpOw0KICAgICAgICBjYXNlIDY3MTc0NDExOiB7DQogICAgICAgICAgICBpZiAoKGNvbnRleHQgJiA1MjQyODgpID09PSAwKQ0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDI2KTsNCiAgICAgICAgICAgIGlmIChjb250ZXh0ICYgMTYzODQpDQogICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMjcpOw0KICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgY2FzZSA2OTI3MTU3MToNCiAgICAgICAgY2FzZSA2NzEwODg3Nzogew0KICAgICAgICAgICAgaWYgKChjb250ZXh0ICYgMjYyMTQ0KSA9PT0gMCkNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAyNyk7DQogICAgICAgICAgICBpZiAoY29udGV4dCAmIDE2Mzg0KQ0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDI3KTsNCiAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAyOCwgJ3N1cGVyJyk7DQogICAgfQ0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgeyB0eXBlOiAnU3VwZXInIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VMZWZ0SGFuZFNpZGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgY2FuQXNzaWduLCBpbkdyb3VwLCBpc0xIUywgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnN0IGV4cHJlc3Npb24gPSBwYXJzZVByaW1hcnlFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMiwgMCwgY2FuQXNzaWduLCAwLCBpbkdyb3VwLCBpc0xIUywgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgcmV0dXJuIHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgZXhwcmVzc2lvbiwgaW5Hcm91cCwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQp9DQpmdW5jdGlvbiBwYXJzZVVwZGF0ZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBleHByLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgaWYgKHBhcnNlci5hc3NpZ25hYmxlICYgMikNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgNTMpOw0KICAgIGNvbnN0IHsgdG9rZW4gfSA9IHBhcnNlcjsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdVcGRhdGVFeHByZXNzaW9uJywNCiAgICAgICAgYXJndW1lbnQ6IGV4cHIsDQogICAgICAgIG9wZXJhdG9yOiBLZXl3b3JkRGVzY1RhYmxlW3Rva2VuICYgMjU1XSwNCiAgICAgICAgcHJlZml4OiBmYWxzZQ0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VNZW1iZXJPclVwZGF0ZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBleHByLCBpbkdyb3VwLCBpbkNoYWluLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgaWYgKChwYXJzZXIudG9rZW4gJiAzMzYxOTk2OCkgPT09IDMzNjE5OTY4ICYmIChwYXJzZXIuZmxhZ3MgJiAxKSA9PT0gMCkgew0KICAgICAgICBleHByID0gcGFyc2VVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgZXhwciwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgfQ0KICAgIGVsc2UgaWYgKChwYXJzZXIudG9rZW4gJiA2NzEwODg2NCkgPT09IDY3MTA4ODY0KSB7DQogICAgICAgIGNvbnRleHQgPSAoY29udGV4dCB8IDEzNDIxNzcyOCkgXiAxMzQyMTc3Mjg7DQogICAgICAgIHN3aXRjaCAocGFyc2VyLnRva2VuKSB7DQogICAgICAgICAgICBjYXNlIDY3MTA4ODc3OiB7DQogICAgICAgICAgICAgICAgbmV4dFRva2VuKHBhcnNlciwgKGNvbnRleHQgfCAxMDczNzQxODI0IHwgODE5MikgXiA4MTkyKTsNCiAgICAgICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDE7DQogICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHkgPSBwYXJzZVByb3BlcnR5T3JQcml2YXRlUHJvcGVydHlOYW1lKHBhcnNlciwgY29udGV4dCk7DQogICAgICAgICAgICAgICAgZXhwciA9IGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdNZW1iZXJFeHByZXNzaW9uJywNCiAgICAgICAgICAgICAgICAgICAgb2JqZWN0OiBleHByLA0KICAgICAgICAgICAgICAgICAgICBjb21wdXRlZDogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIHByb3BlcnR5DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXNlIDY5MjcxNTcxOiB7DQogICAgICAgICAgICAgICAgbGV0IHJlc3RvcmVIYXNPcHRpb25hbENoYWluaW5nID0gZmFsc2U7DQogICAgICAgICAgICAgICAgaWYgKChwYXJzZXIuZmxhZ3MgJiAyMDQ4KSA9PT0gMjA0OCkgew0KICAgICAgICAgICAgICAgICAgICByZXN0b3JlSGFzT3B0aW9uYWxDaGFpbmluZyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIHBhcnNlci5mbGFncyA9IChwYXJzZXIuZmxhZ3MgfCAyMDQ4KSBeIDIwNDg7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgICAgICAgICAgICAgY29uc3QgeyB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHkgPSBwYXJzZUV4cHJlc3Npb25zKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgMSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDIwKTsNCiAgICAgICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDE7DQogICAgICAgICAgICAgICAgZXhwciA9IGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdNZW1iZXJFeHByZXNzaW9uJywNCiAgICAgICAgICAgICAgICAgICAgb2JqZWN0OiBleHByLA0KICAgICAgICAgICAgICAgICAgICBjb21wdXRlZDogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHkNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBpZiAocmVzdG9yZUhhc09wdGlvbmFsQ2hhaW5pbmcpIHsNCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmZsYWdzIHw9IDIwNDg7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2FzZSA2NzE3NDQxMTogew0KICAgICAgICAgICAgICAgIGlmICgocGFyc2VyLmZsYWdzICYgMTAyNCkgPT09IDEwMjQpIHsNCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmZsYWdzID0gKHBhcnNlci5mbGFncyB8IDEwMjQpIF4gMTAyNDsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV4cHI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGxldCByZXN0b3JlSGFzT3B0aW9uYWxDaGFpbmluZyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIGlmICgocGFyc2VyLmZsYWdzICYgMjA0OCkgPT09IDIwNDgpIHsNCiAgICAgICAgICAgICAgICAgICAgcmVzdG9yZUhhc09wdGlvbmFsQ2hhaW5pbmcgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICBwYXJzZXIuZmxhZ3MgPSAocGFyc2VyLmZsYWdzIHwgMjA0OCkgXiAyMDQ4Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjb25zdCBhcmdzID0gcGFyc2VBcmd1bWVudHMocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwKTsNCiAgICAgICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgICAgICAgICAgICAgZXhwciA9IGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdDYWxsRXhwcmVzc2lvbicsDQogICAgICAgICAgICAgICAgICAgIGNhbGxlZTogZXhwciwNCiAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzOiBhcmdzDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgaWYgKHJlc3RvcmVIYXNPcHRpb25hbENoYWluaW5nKSB7DQogICAgICAgICAgICAgICAgICAgIHBhcnNlci5mbGFncyB8PSAyMDQ4Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhc2UgNjcxMDg5OTE6IHsNCiAgICAgICAgICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCAoY29udGV4dCB8IDEwNzM3NDE4MjQgfCA4MTkyKSBeIDgxOTIpOw0KICAgICAgICAgICAgICAgIHBhcnNlci5mbGFncyB8PSAyMDQ4Ow0KICAgICAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICAgICAgICAgICAgICBleHByID0gcGFyc2VPcHRpb25hbENoYWluKHBhcnNlciwgY29udGV4dCwgZXhwciwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgIGlmICgocGFyc2VyLmZsYWdzICYgMjA0OCkgPT09IDIwNDgpIHsNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTYxKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgICAgICAgICAgICAgIGV4cHIgPSBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICAgICAgICAgICAgICB0eXBlOiAnVGFnZ2VkVGVtcGxhdGVFeHByZXNzaW9uJywNCiAgICAgICAgICAgICAgICAgICAgdGFnOiBleHByLA0KICAgICAgICAgICAgICAgICAgICBxdWFzaTogcGFyc2VyLnRva2VuID09PSA2NzE3NDQwOA0KICAgICAgICAgICAgICAgICAgICAgICAgPyBwYXJzZVRlbXBsYXRlKHBhcnNlciwgY29udGV4dCB8IDY1NTM2KQ0KICAgICAgICAgICAgICAgICAgICAgICAgOiBwYXJzZVRlbXBsYXRlTGl0ZXJhbChwYXJzZXIsIGNvbnRleHQsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgZXhwciA9IHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgZXhwciwgMCwgMSwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgfQ0KICAgIGlmIChpbkNoYWluID09PSAwICYmIChwYXJzZXIuZmxhZ3MgJiAyMDQ4KSA9PT0gMjA0OCkgew0KICAgICAgICBwYXJzZXIuZmxhZ3MgPSAocGFyc2VyLmZsYWdzIHwgMjA0OCkgXiAyMDQ4Ow0KICAgICAgICBleHByID0gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgICAgIHR5cGU6ICdDaGFpbkV4cHJlc3Npb24nLA0KICAgICAgICAgICAgZXhwcmVzc2lvbjogZXhwcg0KICAgICAgICB9KTsNCiAgICB9DQogICAgcmV0dXJuIGV4cHI7DQp9DQpmdW5jdGlvbiBwYXJzZU9wdGlvbmFsQ2hhaW4ocGFyc2VyLCBjb250ZXh0LCBleHByLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbGV0IHJlc3RvcmVIYXNPcHRpb25hbENoYWluaW5nID0gZmFsc2U7DQogICAgbGV0IG5vZGU7DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gNjkyNzE1NzEgfHwgcGFyc2VyLnRva2VuID09PSA2NzE3NDQxMSkgew0KICAgICAgICBpZiAoKHBhcnNlci5mbGFncyAmIDIwNDgpID09PSAyMDQ4KSB7DQogICAgICAgICAgICByZXN0b3JlSGFzT3B0aW9uYWxDaGFpbmluZyA9IHRydWU7DQogICAgICAgICAgICBwYXJzZXIuZmxhZ3MgPSAocGFyc2VyLmZsYWdzIHwgMjA0OCkgXiAyMDQ4Ow0KICAgICAgICB9DQogICAgfQ0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDY5MjcxNTcxKSB7DQogICAgICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgICAgIGNvbnN0IHsgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgICAgICBjb25zdCBwcm9wZXJ0eSA9IHBhcnNlRXhwcmVzc2lvbnMocGFyc2VyLCBjb250ZXh0LCAwLCAxLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDIwKTsNCiAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgICAgICBub2RlID0gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgICAgIHR5cGU6ICdNZW1iZXJFeHByZXNzaW9uJywNCiAgICAgICAgICAgIG9iamVjdDogZXhwciwNCiAgICAgICAgICAgIGNvbXB1dGVkOiB0cnVlLA0KICAgICAgICAgICAgb3B0aW9uYWw6IHRydWUsDQogICAgICAgICAgICBwcm9wZXJ0eQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgZWxzZSBpZiAocGFyc2VyLnRva2VuID09PSA2NzE3NDQxMSkgew0KICAgICAgICBjb25zdCBhcmdzID0gcGFyc2VBcmd1bWVudHMocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgICAgICBub2RlID0gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgICAgIHR5cGU6ICdDYWxsRXhwcmVzc2lvbicsDQogICAgICAgICAgICBjYWxsZWU6IGV4cHIsDQogICAgICAgICAgICBhcmd1bWVudHM6IGFyZ3MsDQogICAgICAgICAgICBvcHRpb25hbDogdHJ1ZQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGlmICgocGFyc2VyLnRva2VuICYgKDE0MzM2MCB8IDQwOTYpKSA9PT0gMCkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDE1NSk7DQogICAgICAgIGNvbnN0IHByb3BlcnR5ID0gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMCk7DQogICAgICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICAgICAgbm9kZSA9IGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgICAgICB0eXBlOiAnTWVtYmVyRXhwcmVzc2lvbicsDQogICAgICAgICAgICBvYmplY3Q6IGV4cHIsDQogICAgICAgICAgICBjb21wdXRlZDogZmFsc2UsDQogICAgICAgICAgICBvcHRpb25hbDogdHJ1ZSwNCiAgICAgICAgICAgIHByb3BlcnR5DQogICAgICAgIH0pOw0KICAgIH0NCiAgICBpZiAocmVzdG9yZUhhc09wdGlvbmFsQ2hhaW5pbmcpIHsNCiAgICAgICAgcGFyc2VyLmZsYWdzIHw9IDIwNDg7DQogICAgfQ0KICAgIHJldHVybiBub2RlOw0KfQ0KZnVuY3Rpb24gcGFyc2VQcm9wZXJ0eU9yUHJpdmF0ZVByb3BlcnR5TmFtZShwYXJzZXIsIGNvbnRleHQpIHsNCiAgICBpZiAoKHBhcnNlci50b2tlbiAmICgxNDMzNjAgfCA0MDk2KSkgPT09IDAgJiYgcGFyc2VyLnRva2VuICE9PSAxMzEpIHsNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMTU1KTsNCiAgICB9DQogICAgcmV0dXJuIGNvbnRleHQgJiAxICYmIHBhcnNlci50b2tlbiA9PT0gMTMxDQogICAgICAgID8gcGFyc2VQcml2YXRlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpDQogICAgICAgIDogcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMCk7DQp9DQpmdW5jdGlvbiBwYXJzZVVwZGF0ZUV4cHJlc3Npb25QcmVmaXhlZChwYXJzZXIsIGNvbnRleHQsIGluTmV3LCBpc0xIUywgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGlmIChpbk5ldykNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgNTQpOw0KICAgIGlmICghaXNMSFMpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDApOw0KICAgIGNvbnN0IHsgdG9rZW4gfSA9IHBhcnNlcjsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIGNvbnN0IGFyZyA9IHBhcnNlTGVmdEhhbmRTaWRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDAsIDAsIDEsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgIGlmIChwYXJzZXIuYXNzaWduYWJsZSAmIDIpIHsNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgNTMpOw0KICAgIH0NCiAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdVcGRhdGVFeHByZXNzaW9uJywNCiAgICAgICAgYXJndW1lbnQ6IGFyZywNCiAgICAgICAgb3BlcmF0b3I6IEtleXdvcmREZXNjVGFibGVbdG9rZW4gJiAyNTVdLA0KICAgICAgICBwcmVmaXg6IHRydWUNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlUHJpbWFyeUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBraW5kLCBpbk5ldywgY2FuQXNzaWduLCBpc1BhdHRlcm4sIGluR3JvdXAsIGlzTEhTLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgaWYgKChwYXJzZXIudG9rZW4gJiAxNDMzNjApID09PSAxNDMzNjApIHsNCiAgICAgICAgc3dpdGNoIChwYXJzZXIudG9rZW4pIHsNCiAgICAgICAgICAgIGNhc2UgMjA5MDA4Og0KICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUF3YWl0RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluTmV3LCBpbkdyb3VwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgICAgIGNhc2UgMjQxNzczOg0KICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZVlpZWxkRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIGNhbkFzc2lnbiwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgICAgICBjYXNlIDIwOTAwNzoNCiAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VBc3luY0V4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBpc0xIUywgY2FuQXNzaWduLCBpc1BhdHRlcm4sIGluTmV3LCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgfQ0KICAgICAgICBjb25zdCB7IHRva2VuLCB0b2tlblZhbHVlIH0gPSBwYXJzZXI7DQogICAgICAgIGNvbnN0IGV4cHIgPSBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0IHwgNjU1MzYsIGlzUGF0dGVybik7DQogICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDEwKSB7DQogICAgICAgICAgICBpZiAoIWlzTEhTKQ0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDApOw0KICAgICAgICAgICAgY2xhc3NpZnlJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgdG9rZW4sIDEpOw0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlQXJyb3dGcm9tSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIHRva2VuVmFsdWUsIGV4cHIsIGluTmV3LCBjYW5Bc3NpZ24sIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICB9DQogICAgICAgIGlmIChjb250ZXh0ICYgMTYzODQgJiYgdG9rZW4gPT09IDUzNzA3OTkyOCkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDEyNyk7DQogICAgICAgIGlmICh0b2tlbiA9PT0gMjQxNzM5KSB7DQogICAgICAgICAgICBpZiAoY29udGV4dCAmIDEwMjQpDQogICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTEwKTsNCiAgICAgICAgICAgIGlmIChraW5kICYgKDggfCAxNikpDQogICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgOTgpOw0KICAgICAgICB9DQogICAgICAgIHBhcnNlci5hc3NpZ25hYmxlID0NCiAgICAgICAgICAgIGNvbnRleHQgJiAxMDI0ICYmICh0b2tlbiAmIDUzNzA3OTgwOCkgPT09IDUzNzA3OTgwOA0KICAgICAgICAgICAgICAgID8gMg0KICAgICAgICAgICAgICAgIDogMTsNCiAgICAgICAgcmV0dXJuIGV4cHI7DQogICAgfQ0KICAgIGlmICgocGFyc2VyLnRva2VuICYgMTM0MjE3NzI4KSA9PT0gMTM0MjE3NzI4KSB7DQogICAgICAgIHJldHVybiBwYXJzZUxpdGVyYWwocGFyc2VyLCBjb250ZXh0KTsNCiAgICB9DQogICAgc3dpdGNoIChwYXJzZXIudG9rZW4pIHsNCiAgICAgICAgY2FzZSAzMzYxOTk5NToNCiAgICAgICAgY2FzZSAzMzYxOTk5NjoNCiAgICAgICAgICAgIHJldHVybiBwYXJzZVVwZGF0ZUV4cHJlc3Npb25QcmVmaXhlZChwYXJzZXIsIGNvbnRleHQsIGluTmV3LCBpc0xIUywgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgMTY4NjMyNzg6DQogICAgICAgIGNhc2UgMTY4NDI4MDA6DQogICAgICAgIGNhc2UgMTY4NDI4MDE6DQogICAgICAgIGNhc2UgMjUyMzM5NzA6DQogICAgICAgIGNhc2UgMjUyMzM5NzE6DQogICAgICAgIGNhc2UgMTY4NjMyNzc6DQogICAgICAgIGNhc2UgMTY4NjMyNzk6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VVbmFyeUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpc0xIUywgc3RhcnQsIGxpbmUsIGNvbHVtbiwgaW5Hcm91cCk7DQogICAgICAgIGNhc2UgODYxMDY6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VGdW5jdGlvbkV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAwLCBpbkdyb3VwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSAyMTYyNzAwOg0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlT2JqZWN0TGl0ZXJhbChwYXJzZXIsIGNvbnRleHQsIGNhbkFzc2lnbiA/IDAgOiAxLCBpbkdyb3VwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSA2OTI3MTU3MToNCiAgICAgICAgICAgIHJldHVybiBwYXJzZUFycmF5TGl0ZXJhbChwYXJzZXIsIGNvbnRleHQsIGNhbkFzc2lnbiA/IDAgOiAxLCBpbkdyb3VwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSA2NzE3NDQxMToNCiAgICAgICAgICAgIHJldHVybiBwYXJzZVBhcmVudGhlc2l6ZWRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgY2FuQXNzaWduLCAxLCAwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSA4NjAyMToNCiAgICAgICAgY2FzZSA4NjAyMjoNCiAgICAgICAgY2FzZSA4NjAyMzoNCiAgICAgICAgICAgIHJldHVybiBwYXJzZU51bGxPclRydWVPckZhbHNlTGl0ZXJhbChwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBjYXNlIDg2MTEzOg0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlVGhpc0V4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0KTsNCiAgICAgICAgY2FzZSA2NTU0MDoNCiAgICAgICAgICAgIHJldHVybiBwYXJzZVJlZ0V4cExpdGVyYWwocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSAxMzM6DQogICAgICAgIGNhc2UgODYwOTY6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VDbGFzc0V4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSA4NjExMToNCiAgICAgICAgICAgIHJldHVybiBwYXJzZVN1cGVyRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBjYXNlIDY3MTc0NDA5Og0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlVGVtcGxhdGVMaXRlcmFsKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgNjcxNzQ0MDg6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VUZW1wbGF0ZShwYXJzZXIsIGNvbnRleHQpOw0KICAgICAgICBjYXNlIDg2MTA5Og0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlTmV3RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBjYXNlIDEzNDI4MzM4OToNCiAgICAgICAgICAgIHJldHVybiBwYXJzZUJpZ0ludExpdGVyYWwocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgY2FzZSAxMzE6DQogICAgICAgICAgICByZXR1cm4gcGFyc2VQcml2YXRlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICBjYXNlIDg2MTA4Og0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW1wb3J0Q2FsbE9yTWV0YUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbk5ldywgaW5Hcm91cCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGNhc2UgODQ1NjI1ODoNCiAgICAgICAgICAgIGlmIChjb250ZXh0ICYgMTYpDQogICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSlNYUm9vdEVsZW1lbnRPckZyYWdtZW50KHBhcnNlciwgY29udGV4dCwgMSwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICBpZiAoaXNWYWxpZElkZW50aWZpZXIoY29udGV4dCwgcGFyc2VyLnRva2VuKSkNCiAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VJZGVudGlmaWVyT3JBcnJvdyhwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMjgsIEtleXdvcmREZXNjVGFibGVbcGFyc2VyLnRva2VuICYgMjU1XSk7DQogICAgfQ0KfQ0KZnVuY3Rpb24gcGFyc2VJbXBvcnRDYWxsT3JNZXRhRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluTmV3LCBpbkdyb3VwLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbGV0IGV4cHIgPSBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICBpZiAocGFyc2VyLnRva2VuID09PSA2NzEwODg3Nykgew0KICAgICAgICByZXR1cm4gcGFyc2VJbXBvcnRNZXRhRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGV4cHIsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIH0NCiAgICBpZiAoaW5OZXcpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDEzOCk7DQogICAgZXhwciA9IHBhcnNlSW1wb3J0RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICByZXR1cm4gcGFyc2VNZW1iZXJPclVwZGF0ZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBleHByLCBpbkdyb3VwLCAwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCn0NCmZ1bmN0aW9uIHBhcnNlSW1wb3J0TWV0YUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBtZXRhLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgaWYgKChjb250ZXh0ICYgMjA0OCkgPT09IDApDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDE2NCk7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTQzNDk1ICYmIHBhcnNlci50b2tlblZhbHVlICE9PSAnbWV0YScpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDI4LCBLZXl3b3JkRGVzY1RhYmxlW3BhcnNlci50b2tlbiAmIDI1NV0pOw0KICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ01ldGFQcm9wZXJ0eScsDQogICAgICAgIG1ldGEsDQogICAgICAgIHByb3BlcnR5OiBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKQ0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VJbXBvcnRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDY3MTc0NDExKTsNCiAgICBpZiAocGFyc2VyLnRva2VuID09PSAxNCkNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMTM5KTsNCiAgICBjb25zdCBzb3VyY2UgPSBwYXJzZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAwLCBpbkdyb3VwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgMTYpOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnSW1wb3J0RXhwcmVzc2lvbicsDQogICAgICAgIHNvdXJjZQ0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VCaWdJbnRMaXRlcmFsKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnN0IHsgdG9rZW5SYXcsIHRva2VuVmFsdWUgfSA9IHBhcnNlcjsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCBjb250ZXh0ICYgNTEyDQogICAgICAgID8gew0KICAgICAgICAgICAgdHlwZTogJ0xpdGVyYWwnLA0KICAgICAgICAgICAgdmFsdWU6IHRva2VuVmFsdWUsDQogICAgICAgICAgICBiaWdpbnQ6IHRva2VuUmF3LnNsaWNlKDAsIC0xKSwNCiAgICAgICAgICAgIHJhdzogdG9rZW5SYXcNCiAgICAgICAgfQ0KICAgICAgICA6IHsNCiAgICAgICAgICAgIHR5cGU6ICdMaXRlcmFsJywNCiAgICAgICAgICAgIHZhbHVlOiB0b2tlblZhbHVlLA0KICAgICAgICAgICAgYmlnaW50OiB0b2tlblJhdy5zbGljZSgwLCAtMSkNCiAgICAgICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZVRlbXBsYXRlTGl0ZXJhbChwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgY29uc3QgeyB0b2tlblZhbHVlLCB0b2tlblJhdywgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCA2NzE3NDQwOSk7DQogICAgY29uc3QgcXVhc2lzID0gW3BhcnNlVGVtcGxhdGVFbGVtZW50KHBhcnNlciwgY29udGV4dCwgdG9rZW5WYWx1ZSwgdG9rZW5SYXcsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHRydWUpXTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ1RlbXBsYXRlTGl0ZXJhbCcsDQogICAgICAgIGV4cHJlc3Npb25zOiBbXSwNCiAgICAgICAgcXVhc2lzDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZVRlbXBsYXRlKHBhcnNlciwgY29udGV4dCkgew0KICAgIGNvbnRleHQgPSAoY29udGV4dCB8IDEzNDIxNzcyOCkgXiAxMzQyMTc3Mjg7DQogICAgY29uc3QgeyB0b2tlblZhbHVlLCB0b2tlblJhdywgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDY3MTc0NDA4KTsNCiAgICBjb25zdCBxdWFzaXMgPSBbDQogICAgICAgIHBhcnNlVGVtcGxhdGVFbGVtZW50KHBhcnNlciwgY29udGV4dCwgdG9rZW5WYWx1ZSwgdG9rZW5SYXcsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIGZhbHNlKQ0KICAgIF07DQogICAgY29uc3QgZXhwcmVzc2lvbnMgPSBbcGFyc2VFeHByZXNzaW9ucyhwYXJzZXIsIGNvbnRleHQsIDAsIDEsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpXTsNCiAgICBpZiAocGFyc2VyLnRva2VuICE9PSAxMDc0NzkwNDE1KQ0KICAgICAgICByZXBvcnQocGFyc2VyLCA4MSk7DQogICAgd2hpbGUgKChwYXJzZXIudG9rZW4gPSBzY2FuVGVtcGxhdGVUYWlsKHBhcnNlciwgY29udGV4dCkpICE9PSA2NzE3NDQwOSkgew0KICAgICAgICBjb25zdCB7IHRva2VuVmFsdWUsIHRva2VuUmF3LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDY3MTc0NDA4KTsNCiAgICAgICAgcXVhc2lzLnB1c2gocGFyc2VUZW1wbGF0ZUVsZW1lbnQocGFyc2VyLCBjb250ZXh0LCB0b2tlblZhbHVlLCB0b2tlblJhdywgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgZmFsc2UpKTsNCiAgICAgICAgZXhwcmVzc2lvbnMucHVzaChwYXJzZUV4cHJlc3Npb25zKHBhcnNlciwgY29udGV4dCwgMCwgMSwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcykpOw0KICAgICAgICBpZiAocGFyc2VyLnRva2VuICE9PSAxMDc0NzkwNDE1KQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgODEpOw0KICAgIH0NCiAgICB7DQogICAgICAgIGNvbnN0IHsgdG9rZW5WYWx1ZSwgdG9rZW5SYXcsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICAgICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDY3MTc0NDA5KTsNCiAgICAgICAgcXVhc2lzLnB1c2gocGFyc2VUZW1wbGF0ZUVsZW1lbnQocGFyc2VyLCBjb250ZXh0LCB0b2tlblZhbHVlLCB0b2tlblJhdywgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgdHJ1ZSkpOw0KICAgIH0NCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHsNCiAgICAgICAgdHlwZTogJ1RlbXBsYXRlTGl0ZXJhbCcsDQogICAgICAgIGV4cHJlc3Npb25zLA0KICAgICAgICBxdWFzaXMNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlVGVtcGxhdGVFbGVtZW50KHBhcnNlciwgY29udGV4dCwgY29va2VkLCByYXcsIHN0YXJ0LCBsaW5lLCBjb2wsIHRhaWwpIHsNCiAgICBjb25zdCBub2RlID0gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2wsIHsNCiAgICAgICAgdHlwZTogJ1RlbXBsYXRlRWxlbWVudCcsDQogICAgICAgIHZhbHVlOiB7DQogICAgICAgICAgICBjb29rZWQsDQogICAgICAgICAgICByYXcNCiAgICAgICAgfSwNCiAgICAgICAgdGFpbA0KICAgIH0pOw0KICAgIGNvbnN0IHRhaWxTaXplID0gdGFpbCA/IDEgOiAyOw0KICAgIGlmIChjb250ZXh0ICYgMikgew0KICAgICAgICBub2RlLnN0YXJ0ICs9IDE7DQogICAgICAgIG5vZGUucmFuZ2VbMF0gKz0gMTsNCiAgICAgICAgbm9kZS5lbmQgLT0gdGFpbFNpemU7DQogICAgICAgIG5vZGUucmFuZ2VbMV0gLT0gdGFpbFNpemU7DQogICAgfQ0KICAgIGlmIChjb250ZXh0ICYgNCkgew0KICAgICAgICBub2RlLmxvYy5zdGFydC5jb2x1bW4gKz0gMTsNCiAgICAgICAgbm9kZS5sb2MuZW5kLmNvbHVtbiAtPSB0YWlsU2l6ZTsNCiAgICB9DQogICAgcmV0dXJuIG5vZGU7DQp9DQpmdW5jdGlvbiBwYXJzZVNwcmVhZEVsZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgY29udGV4dCA9IChjb250ZXh0IHwgMTM0MjE3NzI4KSBeIDEzNDIxNzcyODsNCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAxNCk7DQogICAgY29uc3QgYXJndW1lbnQgPSBwYXJzZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAwLCAwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDE7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdTcHJlYWRFbGVtZW50JywNCiAgICAgICAgYXJndW1lbnQNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlQXJndW1lbnRzKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCkgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgY29uc3QgYXJncyA9IFtdOw0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDE2KSB7DQogICAgICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgICAgICByZXR1cm4gYXJnczsNCiAgICB9DQogICAgd2hpbGUgKHBhcnNlci50b2tlbiAhPT0gMTYpIHsNCiAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTQpIHsNCiAgICAgICAgICAgIGFyZ3MucHVzaChwYXJzZVNwcmVhZEVsZW1lbnQocGFyc2VyLCBjb250ZXh0LCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBhcmdzLnB1c2gocGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMCwgaW5Hcm91cCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcykpOw0KICAgICAgICB9DQogICAgICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDE4KQ0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDE2KQ0KICAgICAgICAgICAgYnJlYWs7DQogICAgfQ0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCAxNik7DQogICAgcmV0dXJuIGFyZ3M7DQp9DQpmdW5jdGlvbiBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCBpc1BhdHRlcm4pIHsNCiAgICBjb25zdCB7IHRva2VuVmFsdWUsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIGNvbnRleHQgJiAyNjg0MzU0NTYNCiAgICAgICAgPyB7DQogICAgICAgICAgICB0eXBlOiAnSWRlbnRpZmllcicsDQogICAgICAgICAgICBuYW1lOiB0b2tlblZhbHVlLA0KICAgICAgICAgICAgcGF0dGVybjogaXNQYXR0ZXJuID09PSAxDQogICAgICAgIH0NCiAgICAgICAgOiB7DQogICAgICAgICAgICB0eXBlOiAnSWRlbnRpZmllcicsDQogICAgICAgICAgICBuYW1lOiB0b2tlblZhbHVlDQogICAgICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VMaXRlcmFsKHBhcnNlciwgY29udGV4dCkgew0KICAgIGNvbnN0IHsgdG9rZW5WYWx1ZSwgdG9rZW5SYXcsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICBpZiAocGFyc2VyLnRva2VuID09PSAxMzQyODMzODkpIHsNCiAgICAgICAgcmV0dXJuIHBhcnNlQmlnSW50TGl0ZXJhbChwYXJzZXIsIGNvbnRleHQsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgIH0NCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCBjb250ZXh0ICYgNTEyDQogICAgICAgID8gew0KICAgICAgICAgICAgdHlwZTogJ0xpdGVyYWwnLA0KICAgICAgICAgICAgdmFsdWU6IHRva2VuVmFsdWUsDQogICAgICAgICAgICByYXc6IHRva2VuUmF3DQogICAgICAgIH0NCiAgICAgICAgOiB7DQogICAgICAgICAgICB0eXBlOiAnTGl0ZXJhbCcsDQogICAgICAgICAgICB2YWx1ZTogdG9rZW5WYWx1ZQ0KICAgICAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlTnVsbE9yVHJ1ZU9yRmFsc2VMaXRlcmFsKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnN0IHJhdyA9IEtleXdvcmREZXNjVGFibGVbcGFyc2VyLnRva2VuICYgMjU1XTsNCiAgICBjb25zdCB2YWx1ZSA9IHBhcnNlci50b2tlbiA9PT0gODYwMjMgPyBudWxsIDogcmF3ID09PSAndHJ1ZSc7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgY29udGV4dCAmIDUxMg0KICAgICAgICA/IHsNCiAgICAgICAgICAgIHR5cGU6ICdMaXRlcmFsJywNCiAgICAgICAgICAgIHZhbHVlLA0KICAgICAgICAgICAgcmF3DQogICAgICAgIH0NCiAgICAgICAgOiB7DQogICAgICAgICAgICB0eXBlOiAnTGl0ZXJhbCcsDQogICAgICAgICAgICB2YWx1ZQ0KICAgICAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlVGhpc0V4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0KSB7DQogICAgY29uc3QgeyB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgew0KICAgICAgICB0eXBlOiAnVGhpc0V4cHJlc3Npb24nDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUZ1bmN0aW9uRGVjbGFyYXRpb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgb3JpZ2luLCBhbGxvd0dlbiwgZmxhZ3MsIGlzQXN5bmMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIGNvbnN0IGlzR2VuZXJhdG9yID0gYWxsb3dHZW4gPyBvcHRpb25hbEJpdChwYXJzZXIsIGNvbnRleHQsIDg0NTcwMTQpIDogMDsNCiAgICBsZXQgaWQgPSBudWxsOw0KICAgIGxldCBmaXJzdFJlc3RyaWN0ZWQ7DQogICAgbGV0IGZ1bmN0aW9uU2NvcGUgPSBzY29wZSA/IGNyZWF0ZVNjb3BlKCkgOiB2b2lkIDA7DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gNjcxNzQ0MTEpIHsNCiAgICAgICAgaWYgKChmbGFncyAmIDEpID09PSAwKQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMzcsICdGdW5jdGlvbicpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgY29uc3Qga2luZCA9IG9yaWdpbiAmIDQgJiYgKChjb250ZXh0ICYgODE5MikgPT09IDAgfHwgKGNvbnRleHQgJiAyMDQ4KSA9PT0gMCkNCiAgICAgICAgICAgID8gNA0KICAgICAgICAgICAgOiA2NDsNCiAgICAgICAgdmFsaWRhdGVGdW5jdGlvbk5hbWUocGFyc2VyLCBjb250ZXh0IHwgKChjb250ZXh0ICYgMzA3MikgPDwgMTEpLCBwYXJzZXIudG9rZW4pOw0KICAgICAgICBpZiAoc2NvcGUpIHsNCiAgICAgICAgICAgIGlmIChraW5kICYgNCkgew0KICAgICAgICAgICAgICAgIGFkZFZhck5hbWUocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgcGFyc2VyLnRva2VuVmFsdWUsIGtpbmQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgYWRkQmxvY2tOYW1lKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIHBhcnNlci50b2tlblZhbHVlLCBraW5kLCBvcmlnaW4pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZnVuY3Rpb25TY29wZSA9IGFkZENoaWxkU2NvcGUoZnVuY3Rpb25TY29wZSwgMjU2KTsNCiAgICAgICAgICAgIGlmIChmbGFncykgew0KICAgICAgICAgICAgICAgIGlmIChmbGFncyAmIDIpIHsNCiAgICAgICAgICAgICAgICAgICAgZGVjbGFyZVVuYm91bmRWYXJpYWJsZShwYXJzZXIsIHBhcnNlci50b2tlblZhbHVlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZmlyc3RSZXN0cmljdGVkID0gcGFyc2VyLnRva2VuOw0KICAgICAgICBpZiAocGFyc2VyLnRva2VuICYgMTQzMzYwKSB7DQogICAgICAgICAgICBpZCA9IHBhcnNlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDApOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMjgsIEtleXdvcmREZXNjVGFibGVbcGFyc2VyLnRva2VuICYgMjU1XSk7DQogICAgICAgIH0NCiAgICB9DQogICAgY29udGV4dCA9DQogICAgICAgICgoY29udGV4dCB8IDMyMjQzNzEyKSBeIDMyMjQzNzEyKSB8DQogICAgICAgICAgICA2NzEwODg2NCB8DQogICAgICAgICAgICAoKGlzQXN5bmMgKiAyICsgaXNHZW5lcmF0b3IpIDw8IDIxKSB8DQogICAgICAgICAgICAoaXNHZW5lcmF0b3IgPyAwIDogMTA3Mzc0MTgyNCk7DQogICAgaWYgKHNjb3BlKQ0KICAgICAgICBmdW5jdGlvblNjb3BlID0gYWRkQ2hpbGRTY29wZShmdW5jdGlvblNjb3BlLCA1MTIpOw0KICAgIGNvbnN0IHBhcmFtcyA9IHBhcnNlRm9ybWFsUGFyYW1ldGVyc09yRm9ybWFsTGlzdChwYXJzZXIsIGNvbnRleHQgfCA4Mzg4NjA4LCBmdW5jdGlvblNjb3BlLCAwLCAxKTsNCiAgICBjb25zdCBib2R5ID0gcGFyc2VGdW5jdGlvbkJvZHkocGFyc2VyLCAoY29udGV4dCB8IDgxOTIgfCA0MDk2IHwgMTMxMDcyKSBeDQogICAgICAgICg4MTkyIHwgNDA5NiB8IDEzMTA3MiksIHNjb3BlID8gYWRkQ2hpbGRTY29wZShmdW5jdGlvblNjb3BlLCAxMjgpIDogZnVuY3Rpb25TY29wZSwgOCwgZmlyc3RSZXN0cmljdGVkLCBzY29wZSA/IGZ1bmN0aW9uU2NvcGUuc2NvcGVFcnJvciA6IHZvaWQgMCk7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdGdW5jdGlvbkRlY2xhcmF0aW9uJywNCiAgICAgICAgaWQsDQogICAgICAgIHBhcmFtcywNCiAgICAgICAgYm9keSwNCiAgICAgICAgYXN5bmM6IGlzQXN5bmMgPT09IDEsDQogICAgICAgIGdlbmVyYXRvcjogaXNHZW5lcmF0b3IgPT09IDENCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlRnVuY3Rpb25FeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaXNBc3luYywgaW5Hcm91cCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgY29uc3QgaXNHZW5lcmF0b3IgPSBvcHRpb25hbEJpdChwYXJzZXIsIGNvbnRleHQsIDg0NTcwMTQpOw0KICAgIGNvbnN0IGdlbmVyYXRvckFuZEFzeW5jRmxhZ3MgPSAoaXNBc3luYyAqIDIgKyBpc0dlbmVyYXRvcikgPDwgMjE7DQogICAgbGV0IGlkID0gbnVsbDsNCiAgICBsZXQgZmlyc3RSZXN0cmljdGVkOw0KICAgIGxldCBzY29wZSA9IGNvbnRleHQgJiA2NCA/IGNyZWF0ZVNjb3BlKCkgOiB2b2lkIDA7DQogICAgaWYgKChwYXJzZXIudG9rZW4gJiAoMTQzMzYwIHwgNDA5NiB8IDM2ODY0KSkgPiAwKSB7DQogICAgICAgIHZhbGlkYXRlRnVuY3Rpb25OYW1lKHBhcnNlciwgKChjb250ZXh0IHwgMHgxZWMwMDAwKSBeIDB4MWVjMDAwMCkgfCBnZW5lcmF0b3JBbmRBc3luY0ZsYWdzLCBwYXJzZXIudG9rZW4pOw0KICAgICAgICBpZiAoc2NvcGUpDQogICAgICAgICAgICBzY29wZSA9IGFkZENoaWxkU2NvcGUoc2NvcGUsIDI1Nik7DQogICAgICAgIGZpcnN0UmVzdHJpY3RlZCA9IHBhcnNlci50b2tlbjsNCiAgICAgICAgaWQgPSBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICB9DQogICAgY29udGV4dCA9DQogICAgICAgICgoY29udGV4dCB8IDMyMjQzNzEyKSBeIDMyMjQzNzEyKSB8DQogICAgICAgICAgICA2NzEwODg2NCB8DQogICAgICAgICAgICBnZW5lcmF0b3JBbmRBc3luY0ZsYWdzIHwNCiAgICAgICAgICAgIChpc0dlbmVyYXRvciA/IDAgOiAxMDczNzQxODI0KTsNCiAgICBpZiAoc2NvcGUpDQogICAgICAgIHNjb3BlID0gYWRkQ2hpbGRTY29wZShzY29wZSwgNTEyKTsNCiAgICBjb25zdCBwYXJhbXMgPSBwYXJzZUZvcm1hbFBhcmFtZXRlcnNPckZvcm1hbExpc3QocGFyc2VyLCBjb250ZXh0IHwgODM4ODYwOCwgc2NvcGUsIGluR3JvdXAsIDEpOw0KICAgIGNvbnN0IGJvZHkgPSBwYXJzZUZ1bmN0aW9uQm9keShwYXJzZXIsIGNvbnRleHQgJiB+KDB4ODAwMTAwMCB8IDgxOTIgfCA0MDk2IHwgMTMxMDcyIHwgMTYzODQpLCBzY29wZSA/IGFkZENoaWxkU2NvcGUoc2NvcGUsIDEyOCkgOiBzY29wZSwgMCwgZmlyc3RSZXN0cmljdGVkLCB2b2lkIDApOw0KICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0Z1bmN0aW9uRXhwcmVzc2lvbicsDQogICAgICAgIGlkLA0KICAgICAgICBwYXJhbXMsDQogICAgICAgIGJvZHksDQogICAgICAgIGFzeW5jOiBpc0FzeW5jID09PSAxLA0KICAgICAgICBnZW5lcmF0b3I6IGlzR2VuZXJhdG9yID09PSAxDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUFycmF5TGl0ZXJhbChwYXJzZXIsIGNvbnRleHQsIHNraXBJbml0aWFsaXplciwgaW5Hcm91cCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnN0IGV4cHIgPSBwYXJzZUFycmF5RXhwcmVzc2lvbk9yUGF0dGVybihwYXJzZXIsIGNvbnRleHQsIHZvaWQgMCwgc2tpcEluaXRpYWxpemVyLCBpbkdyb3VwLCAwLCAyLCAwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICBpZiAoY29udGV4dCAmIDI1NiAmJiBwYXJzZXIuZGVzdHJ1Y3RpYmxlICYgNjQpIHsNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgNjEpOw0KICAgIH0NCiAgICBpZiAocGFyc2VyLmRlc3RydWN0aWJsZSAmIDgpIHsNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgNjApOw0KICAgIH0NCiAgICByZXR1cm4gZXhwcjsNCn0NCmZ1bmN0aW9uIHBhcnNlQXJyYXlFeHByZXNzaW9uT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIHNraXBJbml0aWFsaXplciwgaW5Hcm91cCwgaXNQYXR0ZXJuLCBraW5kLCBvcmlnaW4sIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIGNvbnN0IGVsZW1lbnRzID0gW107DQogICAgbGV0IGRlc3RydWN0aWJsZSA9IDA7DQogICAgY29udGV4dCA9IChjb250ZXh0IHwgMTM0MjE3NzI4KSBeIDEzNDIxNzcyODsNCiAgICB3aGlsZSAocGFyc2VyLnRva2VuICE9PSAyMCkgew0KICAgICAgICBpZiAoY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMTgpKSB7DQogICAgICAgICAgICBlbGVtZW50cy5wdXNoKG51bGwpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgbGV0IGxlZnQ7DQogICAgICAgICAgICBjb25zdCB7IHRva2VuLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCB0b2tlblZhbHVlIH0gPSBwYXJzZXI7DQogICAgICAgICAgICBpZiAodG9rZW4gJiAxNDMzNjApIHsNCiAgICAgICAgICAgICAgICBsZWZ0ID0gcGFyc2VQcmltYXJ5RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGtpbmQsIDAsIDEsIDAsIGluR3JvdXAsIDEsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDEwNzc5MzYxNTcpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci5hc3NpZ25hYmxlICYgMikNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDI0KTsNCiAgICAgICAgICAgICAgICAgICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgYWRkVmFyT3JCbG9jayhwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCB0b2tlblZhbHVlLCBraW5kLCBvcmlnaW4pOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCByaWdodCA9IHBhcnNlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDEsIDEsIGluR3JvdXAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICBsZWZ0ID0gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIGlzUGF0dGVybg0KICAgICAgICAgICAgICAgICAgICAgICAgPyB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0Fzc2lnbm1lbnRQYXR0ZXJuJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICA6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnQXNzaWdubWVudEV4cHJlc3Npb24nLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yOiAnPScsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByaWdodA0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PQ0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmRlc3RydWN0aWJsZSAmIDI1Ng0KICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gMjU2DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAwIHwgKHBhcnNlci5kZXN0cnVjdGlibGUgJiAxMjgpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gMTI4DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogMDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAocGFyc2VyLnRva2VuID09PSAxOCB8fCBwYXJzZXIudG9rZW4gPT09IDIwKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIuYXNzaWduYWJsZSAmIDIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChzY29wZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYWRkVmFyT3JCbG9jayhwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCB0b2tlblZhbHVlLCBraW5kLCBvcmlnaW4pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PQ0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmRlc3RydWN0aWJsZSAmIDI1Ng0KICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gMjU2DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAwIHwgKHBhcnNlci5kZXN0cnVjdGlibGUgJiAxMjgpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gMTI4DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogMDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PQ0KICAgICAgICAgICAgICAgICAgICAgICAga2luZCAmIDENCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IDMyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAoa2luZCAmIDIpID09PSAwDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gMTYNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAwOw0KICAgICAgICAgICAgICAgICAgICBsZWZ0ID0gcGFyc2VNZW1iZXJPclVwZGF0ZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBsZWZ0LCBpbkdyb3VwLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTggJiYgcGFyc2VyLnRva2VuICE9PSAyMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTA3NzkzNjE1NykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgICAgICBsZWZ0ID0gcGFyc2VBc3NpZ25tZW50RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIGlzUGF0dGVybiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgbGVmdCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocGFyc2VyLnRva2VuICE9PSAxMDc3OTM2MTU3KSB7DQogICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSAmIDINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAxNg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IDMyOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAodG9rZW4gJiAyMDk3MTUyKSB7DQogICAgICAgICAgICAgICAgbGVmdCA9DQogICAgICAgICAgICAgICAgICAgIHBhcnNlci50b2tlbiA9PT0gMjE2MjcwMA0KICAgICAgICAgICAgICAgICAgICAgICAgPyBwYXJzZU9iamVjdExpdGVyYWxPclBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgMCwgaW5Hcm91cCwgaXNQYXR0ZXJuLCBraW5kLCBvcmlnaW4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpDQogICAgICAgICAgICAgICAgICAgICAgICA6IHBhcnNlQXJyYXlFeHByZXNzaW9uT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDAsIGluR3JvdXAsIGlzUGF0dGVybiwga2luZCwgb3JpZ2luLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gcGFyc2VyLmRlc3RydWN0aWJsZTsNCiAgICAgICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9DQogICAgICAgICAgICAgICAgICAgIHBhcnNlci5kZXN0cnVjdGlibGUgJiAxNg0KICAgICAgICAgICAgICAgICAgICAgICAgPyAyDQogICAgICAgICAgICAgICAgICAgICAgICA6IDE7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTggfHwgcGFyc2VyLnRva2VuID09PSAyMCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLmFzc2lnbmFibGUgJiAyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAocGFyc2VyLmRlc3RydWN0aWJsZSAmIDgpIHsNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgNjkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgbGVmdCA9IHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgbGVmdCwgaW5Hcm91cCwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSA9IHBhcnNlci5hc3NpZ25hYmxlICYgMiA/IDE2IDogMDsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTggJiYgcGFyc2VyLnRva2VuICE9PSAyMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGVmdCA9IHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBpc1BhdHRlcm4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIGxlZnQpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhcnNlci50b2tlbiAhPT0gMTA3NzkzNjE1Nykgew0KICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgJiAyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gMTYNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAzMjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHRva2VuID09PSAxNCkgew0KICAgICAgICAgICAgICAgIGxlZnQgPSBwYXJzZVNwcmVhZE9yUmVzdEVsZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgMjAsIGtpbmQsIG9yaWdpbiwgMCwgaW5Hcm91cCwgaXNQYXR0ZXJuLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gcGFyc2VyLmRlc3RydWN0aWJsZTsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICE9PSAxOCAmJiBwYXJzZXIudG9rZW4gIT09IDIwKQ0KICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAyOCwgS2V5d29yZERlc2NUYWJsZVtwYXJzZXIudG9rZW4gJiAyNTVdKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGxlZnQgPSBwYXJzZUxlZnRIYW5kU2lkZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAwLCAxLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICE9PSAxOCAmJiBwYXJzZXIudG9rZW4gIT09IDIwKSB7DQogICAgICAgICAgICAgICAgICAgIGxlZnQgPSBwYXJzZUFzc2lnbm1lbnRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgaXNQYXR0ZXJuLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCBsZWZ0KTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKChraW5kICYgKDIgfCAxKSkgPT09IDAgJiYgdG9rZW4gPT09IDY3MTc0NDExKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChwYXJzZXIuYXNzaWduYWJsZSAmIDIpIHsNCiAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmICh0b2tlbiA9PT0gNjcxNzQ0MTEpIHsNCiAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9DQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSAmIDEgJiYga2luZCAmICgyIHwgMSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IDMyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAxNjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbGVtZW50cy5wdXNoKGxlZnQpOw0KICAgICAgICAgICAgaWYgKGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDE4KSkgew0KICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDIwKQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgMjApOw0KICAgIGNvbnN0IG5vZGUgPSBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiBpc1BhdHRlcm4gPyAnQXJyYXlQYXR0ZXJuJyA6ICdBcnJheUV4cHJlc3Npb24nLA0KICAgICAgICBlbGVtZW50cw0KICAgIH0pOw0KICAgIGlmICghc2tpcEluaXRpYWxpemVyICYmIHBhcnNlci50b2tlbiAmIDQxOTQzMDQpIHsNCiAgICAgICAgcmV0dXJuIHBhcnNlQXJyYXlPck9iamVjdEFzc2lnbm1lbnRQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgZGVzdHJ1Y3RpYmxlLCBpbkdyb3VwLCBpc1BhdHRlcm4sIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIG5vZGUpOw0KICAgIH0NCiAgICBwYXJzZXIuZGVzdHJ1Y3RpYmxlID0gZGVzdHJ1Y3RpYmxlOw0KICAgIHJldHVybiBub2RlOw0KfQ0KZnVuY3Rpb24gcGFyc2VBcnJheU9yT2JqZWN0QXNzaWdubWVudFBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCBkZXN0cnVjdGlibGUsIGluR3JvdXAsIGlzUGF0dGVybiwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgbm9kZSkgew0KICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDEwNzc5MzYxNTcpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDI0KTsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIGlmIChkZXN0cnVjdGlibGUgJiAxNikNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMjQpOw0KICAgIGlmICghaXNQYXR0ZXJuKQ0KICAgICAgICByZWludGVycHJldFRvUGF0dGVybihwYXJzZXIsIG5vZGUpOw0KICAgIGNvbnN0IHsgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgIGNvbnN0IHJpZ2h0ID0gcGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMSwgaW5Hcm91cCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgcGFyc2VyLmRlc3RydWN0aWJsZSA9DQogICAgICAgICgoZGVzdHJ1Y3RpYmxlIHwgNjQgfCA4KSBeDQogICAgICAgICAgICAoOCB8IDY0KSkgfA0KICAgICAgICAgICAgKHBhcnNlci5kZXN0cnVjdGlibGUgJiAxMjggPyAxMjggOiAwKSB8DQogICAgICAgICAgICAocGFyc2VyLmRlc3RydWN0aWJsZSAmIDI1NiA/IDI1NiA6IDApOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgaXNQYXR0ZXJuDQogICAgICAgID8gew0KICAgICAgICAgICAgdHlwZTogJ0Fzc2lnbm1lbnRQYXR0ZXJuJywNCiAgICAgICAgICAgIGxlZnQ6IG5vZGUsDQogICAgICAgICAgICByaWdodA0KICAgICAgICB9DQogICAgICAgIDogew0KICAgICAgICAgICAgdHlwZTogJ0Fzc2lnbm1lbnRFeHByZXNzaW9uJywNCiAgICAgICAgICAgIGxlZnQ6IG5vZGUsDQogICAgICAgICAgICBvcGVyYXRvcjogJz0nLA0KICAgICAgICAgICAgcmlnaHQNCiAgICAgICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZVNwcmVhZE9yUmVzdEVsZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgY2xvc2luZ1Rva2VuLCBraW5kLCBvcmlnaW4sIGlzQXN5bmMsIGluR3JvdXAsIGlzUGF0dGVybiwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgbGV0IGFyZ3VtZW50ID0gbnVsbDsNCiAgICBsZXQgZGVzdHJ1Y3RpYmxlID0gMDsNCiAgICBsZXQgeyB0b2tlbiwgdG9rZW5WYWx1ZSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgIGlmICh0b2tlbiAmICg0MDk2IHwgMTQzMzYwKSkgew0KICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDE7DQogICAgICAgIGFyZ3VtZW50ID0gcGFyc2VQcmltYXJ5RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGtpbmQsIDAsIDEsIDAsIGluR3JvdXAsIDEsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICB0b2tlbiA9IHBhcnNlci50b2tlbjsNCiAgICAgICAgYXJndW1lbnQgPSBwYXJzZU1lbWJlck9yVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGFyZ3VtZW50LCBpbkdyb3VwLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTggJiYgcGFyc2VyLnRva2VuICE9PSBjbG9zaW5nVG9rZW4pIHsNCiAgICAgICAgICAgIGlmIChwYXJzZXIuYXNzaWduYWJsZSAmIDIgJiYgcGFyc2VyLnRva2VuID09PSAxMDc3OTM2MTU3KQ0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDY5KTsNCiAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgIGFyZ3VtZW50ID0gcGFyc2VBc3NpZ25tZW50RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIGlzUGF0dGVybiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgYXJndW1lbnQpOw0KICAgICAgICB9DQogICAgICAgIGlmIChwYXJzZXIuYXNzaWduYWJsZSAmIDIpIHsNCiAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmICh0b2tlbiA9PT0gY2xvc2luZ1Rva2VuIHx8IHRva2VuID09PSAxOCkgew0KICAgICAgICAgICAgaWYgKHNjb3BlKQ0KICAgICAgICAgICAgICAgIGFkZFZhck9yQmxvY2socGFyc2VyLCBjb250ZXh0LCBzY29wZSwgdG9rZW5WYWx1ZSwga2luZCwgb3JpZ2luKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAzMjsNCiAgICAgICAgfQ0KICAgICAgICBkZXN0cnVjdGlibGUgfD0gcGFyc2VyLmRlc3RydWN0aWJsZSAmIDEyOCA/IDEyOCA6IDA7DQogICAgfQ0KICAgIGVsc2UgaWYgKHRva2VuID09PSBjbG9zaW5nVG9rZW4pIHsNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMzkpOw0KICAgIH0NCiAgICBlbHNlIGlmICh0b2tlbiAmIDIwOTcxNTIpIHsNCiAgICAgICAgYXJndW1lbnQgPQ0KICAgICAgICAgICAgcGFyc2VyLnRva2VuID09PSAyMTYyNzAwDQogICAgICAgICAgICAgICAgPyBwYXJzZU9iamVjdExpdGVyYWxPclBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgMSwgaW5Hcm91cCwgaXNQYXR0ZXJuLCBraW5kLCBvcmlnaW4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpDQogICAgICAgICAgICAgICAgOiBwYXJzZUFycmF5RXhwcmVzc2lvbk9yUGF0dGVybihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCAxLCBpbkdyb3VwLCBpc1BhdHRlcm4sIGtpbmQsIG9yaWdpbiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgIHRva2VuID0gcGFyc2VyLnRva2VuOw0KICAgICAgICBpZiAodG9rZW4gIT09IDEwNzc5MzYxNTcgJiYgdG9rZW4gIT09IGNsb3NpbmdUb2tlbiAmJiB0b2tlbiAhPT0gMTgpIHsNCiAgICAgICAgICAgIGlmIChwYXJzZXIuZGVzdHJ1Y3RpYmxlICYgOCkNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCA2OSk7DQogICAgICAgICAgICBhcmd1bWVudCA9IHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgYXJndW1lbnQsIGluR3JvdXAsIDAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IHBhcnNlci5hc3NpZ25hYmxlICYgMiA/IDE2IDogMDsNCiAgICAgICAgICAgIGlmICgocGFyc2VyLnRva2VuICYgNDE5NDMwNCkgPT09IDQxOTQzMDQpIHsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICE9PSAxMDc3OTM2MTU3KQ0KICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgYXJndW1lbnQgPSBwYXJzZUFzc2lnbm1lbnRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgaXNQYXR0ZXJuLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCBhcmd1bWVudCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBpZiAoKHBhcnNlci50b2tlbiAmIDg0NTQxNDQpID09PSA4NDU0MTQ0KSB7DQogICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50ID0gcGFyc2VCaW5hcnlFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgNCwgdG9rZW4sIGFyZ3VtZW50KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDIyKSkgew0KICAgICAgICAgICAgICAgICAgICBhcmd1bWVudCA9IHBhcnNlQ29uZGl0aW9uYWxFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgYXJndW1lbnQsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0NCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgJiAyDQogICAgICAgICAgICAgICAgICAgICAgICA/IDE2DQogICAgICAgICAgICAgICAgICAgICAgICA6IDMyOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9DQogICAgICAgICAgICAgICAgY2xvc2luZ1Rva2VuID09PSAxMDc0NzkwNDE1ICYmIHRva2VuICE9PSAxMDc3OTM2MTU3DQogICAgICAgICAgICAgICAgICAgID8gMTYNCiAgICAgICAgICAgICAgICAgICAgOiBwYXJzZXIuZGVzdHJ1Y3RpYmxlOw0KICAgICAgICB9DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBkZXN0cnVjdGlibGUgfD0gMzI7DQogICAgICAgIGFyZ3VtZW50ID0gcGFyc2VMZWZ0SGFuZFNpZGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgaW5Hcm91cCwgMSwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgIGNvbnN0IHsgdG9rZW4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICAgICAgaWYgKHRva2VuID09PSAxMDc3OTM2MTU3ICYmIHRva2VuICE9PSBjbG9zaW5nVG9rZW4gJiYgdG9rZW4gIT09IDE4KSB7DQogICAgICAgICAgICBpZiAocGFyc2VyLmFzc2lnbmFibGUgJiAyKQ0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDI0KTsNCiAgICAgICAgICAgIGFyZ3VtZW50ID0gcGFyc2VBc3NpZ25tZW50RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIGlzUGF0dGVybiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgYXJndW1lbnQpOw0KICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgaWYgKHRva2VuID09PSAxOCkgew0KICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHRva2VuICE9PSBjbG9zaW5nVG9rZW4pIHsNCiAgICAgICAgICAgICAgICBhcmd1bWVudCA9IHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBpc1BhdHRlcm4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIGFyZ3VtZW50KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PQ0KICAgICAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlICYgMSA/IDMyIDogMTY7DQogICAgICAgIH0NCiAgICAgICAgcGFyc2VyLmRlc3RydWN0aWJsZSA9IGRlc3RydWN0aWJsZTsNCiAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gY2xvc2luZ1Rva2VuICYmIHBhcnNlci50b2tlbiAhPT0gMTgpDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxNTYpOw0KICAgICAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgICAgIHR5cGU6IGlzUGF0dGVybiA/ICdSZXN0RWxlbWVudCcgOiAnU3ByZWFkRWxlbWVudCcsDQogICAgICAgICAgICBhcmd1bWVudDogYXJndW1lbnQNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGlmIChwYXJzZXIudG9rZW4gIT09IGNsb3NpbmdUb2tlbikgew0KICAgICAgICBpZiAoa2luZCAmIDEpDQogICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gaXNBc3luYyA/IDE2IDogMzI7DQogICAgICAgIGlmIChjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAxMDc3OTM2MTU3KSkgew0KICAgICAgICAgICAgaWYgKGRlc3RydWN0aWJsZSAmIDE2KQ0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDI0KTsNCiAgICAgICAgICAgIHJlaW50ZXJwcmV0VG9QYXR0ZXJuKHBhcnNlciwgYXJndW1lbnQpOw0KICAgICAgICAgICAgY29uc3QgcmlnaHQgPSBwYXJzZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAxLCBpbkdyb3VwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICAgICAgICAgIGFyZ3VtZW50ID0gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIGlzUGF0dGVybg0KICAgICAgICAgICAgICAgID8gew0KICAgICAgICAgICAgICAgICAgICB0eXBlOiAnQXNzaWdubWVudFBhdHRlcm4nLA0KICAgICAgICAgICAgICAgICAgICBsZWZ0OiBhcmd1bWVudCwNCiAgICAgICAgICAgICAgICAgICAgcmlnaHQNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgOiB7DQogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdBc3NpZ25tZW50RXhwcmVzc2lvbicsDQogICAgICAgICAgICAgICAgICAgIGxlZnQ6IGFyZ3VtZW50LA0KICAgICAgICAgICAgICAgICAgICBvcGVyYXRvcjogJz0nLA0KICAgICAgICAgICAgICAgICAgICByaWdodA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlID0gMTY7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgIH0NCiAgICB9DQogICAgcGFyc2VyLmRlc3RydWN0aWJsZSA9IGRlc3RydWN0aWJsZTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogaXNQYXR0ZXJuID8gJ1Jlc3RFbGVtZW50JyA6ICdTcHJlYWRFbGVtZW50JywNCiAgICAgICAgYXJndW1lbnQ6IGFyZ3VtZW50DQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZU1ldGhvZERlZmluaXRpb24ocGFyc2VyLCBjb250ZXh0LCBraW5kLCBpbkdyb3VwLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgY29uc3QgbW9kaWZpZXJGbGFncyA9IChraW5kICYgNjQpID09PSAwID8gMzE5ODE1NjggOiAxNDY4MDA2NDsNCiAgICBjb250ZXh0ID0NCiAgICAgICAgKChjb250ZXh0IHwgbW9kaWZpZXJGbGFncykgXiBtb2RpZmllckZsYWdzKSB8DQogICAgICAgICAgICAoKGtpbmQgJiA4OCkgPDwgMTgpIHwNCiAgICAgICAgICAgIDEwMDkyNTQ0MDsNCiAgICBsZXQgc2NvcGUgPSBjb250ZXh0ICYgNjQgPyBhZGRDaGlsZFNjb3BlKGNyZWF0ZVNjb3BlKCksIDUxMikgOiB2b2lkIDA7DQogICAgY29uc3QgcGFyYW1zID0gcGFyc2VNZXRob2RGb3JtYWxzKHBhcnNlciwgY29udGV4dCB8IDgzODg2MDgsIHNjb3BlLCBraW5kLCAxLCBpbkdyb3VwKTsNCiAgICBpZiAoc2NvcGUpDQogICAgICAgIHNjb3BlID0gYWRkQ2hpbGRTY29wZShzY29wZSwgMTI4KTsNCiAgICBjb25zdCBib2R5ID0gcGFyc2VGdW5jdGlvbkJvZHkocGFyc2VyLCBjb250ZXh0ICYgfigweDgwMDEwMDAgfCA4MTkyKSwgc2NvcGUsIDAsIHZvaWQgMCwgdm9pZCAwKTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0Z1bmN0aW9uRXhwcmVzc2lvbicsDQogICAgICAgIHBhcmFtcywNCiAgICAgICAgYm9keSwNCiAgICAgICAgYXN5bmM6IChraW5kICYgMTYpID4gMCwNCiAgICAgICAgZ2VuZXJhdG9yOiAoa2luZCAmIDgpID4gMCwNCiAgICAgICAgaWQ6IG51bGwNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlT2JqZWN0TGl0ZXJhbChwYXJzZXIsIGNvbnRleHQsIHNraXBJbml0aWFsaXplciwgaW5Hcm91cCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnN0IGV4cHIgPSBwYXJzZU9iamVjdExpdGVyYWxPclBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCB2b2lkIDAsIHNraXBJbml0aWFsaXplciwgaW5Hcm91cCwgMCwgMiwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgaWYgKGNvbnRleHQgJiAyNTYgJiYgcGFyc2VyLmRlc3RydWN0aWJsZSAmIDY0KSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDYxKTsNCiAgICB9DQogICAgaWYgKHBhcnNlci5kZXN0cnVjdGlibGUgJiA4KSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDYwKTsNCiAgICB9DQogICAgcmV0dXJuIGV4cHI7DQp9DQpmdW5jdGlvbiBwYXJzZU9iamVjdExpdGVyYWxPclBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgc2tpcEluaXRpYWxpemVyLCBpbkdyb3VwLCBpc1BhdHRlcm4sIGtpbmQsIG9yaWdpbiwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIGNvbnN0IHByb3BlcnRpZXMgPSBbXTsNCiAgICBsZXQgZGVzdHJ1Y3RpYmxlID0gMDsNCiAgICBsZXQgcHJvdG90eXBlQ291bnQgPSAwOw0KICAgIGNvbnRleHQgPSAoY29udGV4dCB8IDEzNDIxNzcyOCkgXiAxMzQyMTc3Mjg7DQogICAgd2hpbGUgKHBhcnNlci50b2tlbiAhPT0gMTA3NDc5MDQxNSkgew0KICAgICAgICBjb25zdCB7IHRva2VuLCB0b2tlblZhbHVlLCBsaW5lUG9zLCBjb2xQb3MsIHRva2VuUG9zIH0gPSBwYXJzZXI7DQogICAgICAgIGlmICh0b2tlbiA9PT0gMTQpIHsNCiAgICAgICAgICAgIHByb3BlcnRpZXMucHVzaChwYXJzZVNwcmVhZE9yUmVzdEVsZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgMTA3NDc5MDQxNSwga2luZCwgb3JpZ2luLCAwLCBpbkdyb3VwLCBpc1BhdHRlcm4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGxldCBzdGF0ZSA9IDA7DQogICAgICAgICAgICBsZXQga2V5ID0gbnVsbDsNCiAgICAgICAgICAgIGxldCB2YWx1ZTsNCiAgICAgICAgICAgIGNvbnN0IHQgPSBwYXJzZXIudG9rZW47DQogICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICYgKDE0MzM2MCB8IDQwOTYpIHx8IHBhcnNlci50b2tlbiA9PT0gMTIxKSB7DQogICAgICAgICAgICAgICAga2V5ID0gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMCk7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTggfHwgcGFyc2VyLnRva2VuID09PSAxMDc0NzkwNDE1IHx8IHBhcnNlci50b2tlbiA9PT0gMTA3NzkzNjE1Nykgew0KICAgICAgICAgICAgICAgICAgICBzdGF0ZSB8PSA0Ow0KICAgICAgICAgICAgICAgICAgICBpZiAoY29udGV4dCAmIDEwMjQgJiYgKHRva2VuICYgNTM3MDc5ODA4KSA9PT0gNTM3MDc5ODA4KSB7DQogICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YWxpZGF0ZUJpbmRpbmdJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwga2luZCwgdG9rZW4sIDApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChzY29wZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZFZhck9yQmxvY2socGFyc2VyLCBjb250ZXh0LCBzY29wZSwgdG9rZW5WYWx1ZSwga2luZCwgb3JpZ2luKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDEwNzc5MzYxNTcpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gODsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJpZ2h0ID0gcGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMSwgaW5Hcm91cCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIuZGVzdHJ1Y3RpYmxlICYgMjU2DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gMjU2DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogMCB8IChwYXJzZXIuZGVzdHJ1Y3RpYmxlICYgMTI4KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAxMjgNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnQXNzaWdubWVudFBhdHRlcm4nLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGNvbnRleHQgJiAtMjE0NzQ4MzY0OCA/IE9iamVjdC5hc3NpZ24oe30sIGtleSkgOiBrZXksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHQNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKHRva2VuID09PSAyMDkwMDggPyAxMjggOiAwKSB8DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0b2tlbiA9PT0gMTIxID8gMTYgOiAwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY29udGV4dCAmIC0yMTQ3NDgzNjQ4ID8gT2JqZWN0LmFzc2lnbih7fSwga2V5KSA6IGtleTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAyMSkpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgICAgICAgICAgICAgICAgIGlmICh0b2tlblZhbHVlID09PSAnX19wcm90b19fJykNCiAgICAgICAgICAgICAgICAgICAgICAgIHByb3RvdHlwZUNvdW50Kys7DQogICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gJiAxNDMzNjApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRva2VuQWZ0ZXJDb2xvbiA9IHBhcnNlci50b2tlbjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlQWZ0ZXJDb2xvbiA9IHBhcnNlci50b2tlblZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IHQgPT09IDEyMSA/IDE2IDogMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VQcmltYXJ5RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGtpbmQsIDAsIDEsIDAsIGluR3JvdXAsIDEsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgeyB0b2tlbiB9ID0gcGFyc2VyOw0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZU1lbWJlck9yVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIHZhbHVlLCBpbkdyb3VwLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDE4IHx8IHBhcnNlci50b2tlbiA9PT0gMTA3NDc5MDQxNSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlbiA9PT0gMTA3NzkzNjE1NyB8fCB0b2tlbiA9PT0gMTA3NDc5MDQxNSB8fCB0b2tlbiA9PT0gMTgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IHBhcnNlci5kZXN0cnVjdGlibGUgJiAxMjggPyAxMjggOiAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLmFzc2lnbmFibGUgJiAyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoc2NvcGUgJiYgKHRva2VuQWZ0ZXJDb2xvbiAmIDE0MzM2MCkgPT09IDE0MzM2MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkVmFyT3JCbG9jayhwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCB2YWx1ZUFmdGVyQ29sb24sIGtpbmQsIG9yaWdpbik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgJiAxDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAzMg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogMTY7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoKHBhcnNlci50b2tlbiAmIDQxOTQzMDQpID09PSA0MTk0MzA0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci5hc3NpZ25hYmxlICYgMikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRva2VuICE9PSAxMDc3OTM2MTU3KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAzMjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoc2NvcGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkVmFyT3JCbG9jayhwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCB2YWx1ZUFmdGVyQ29sb24sIGtpbmQsIG9yaWdpbik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VBc3NpZ25tZW50RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIGlzUGF0dGVybiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgdmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgocGFyc2VyLnRva2VuICYgODQ1NDE0NCkgPT09IDg0NTQxNDQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZUJpbmFyeUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCA0LCB0b2tlbiwgdmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMjIpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VDb25kaXRpb25hbEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCB2YWx1ZSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKChwYXJzZXIudG9rZW4gJiAyMDk3MTUyKSA9PT0gMjA5NzE1Mikgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci50b2tlbiA9PT0gNjkyNzE1NzENCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBwYXJzZUFycmF5RXhwcmVzc2lvbk9yUGF0dGVybihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCAwLCBpbkdyb3VwLCBpc1BhdHRlcm4sIGtpbmQsIG9yaWdpbiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBwYXJzZU9iamVjdExpdGVyYWxPclBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgMCwgaW5Hcm91cCwgaXNQYXR0ZXJuLCBraW5kLCBvcmlnaW4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlID0gcGFyc2VyLmRlc3RydWN0aWJsZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlID0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgJiAxNiA/IDIgOiAxOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTggfHwgcGFyc2VyLnRva2VuID09PSAxMDc0NzkwNDE1KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci5hc3NpZ25hYmxlICYgMikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocGFyc2VyLmRlc3RydWN0aWJsZSAmIDgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCA2OSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgdmFsdWUsIGluR3JvdXAsIDAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSA9IHBhcnNlci5hc3NpZ25hYmxlICYgMiA/IDE2IDogMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHBhcnNlci50b2tlbiAmIDQxOTQzMDQpID09PSA0MTk0MzA0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VBc3NpZ25tZW50RXhwcmVzc2lvbk9yUGF0dGVybihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIGlzUGF0dGVybiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgdmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChwYXJzZXIudG9rZW4gJiA4NDU0MTQ0KSA9PT0gODQ1NDE0NCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZUJpbmFyeUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCA0LCB0b2tlbiwgdmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAyMikpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VDb25kaXRpb25hbEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCB2YWx1ZSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSAmIDINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IDE2DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAzMjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlTGVmdEhhbmRTaWRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDEsIGluR3JvdXAsIDEsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgJiAxDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gMzINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAxNjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDE4IHx8IHBhcnNlci50b2tlbiA9PT0gMTA3NDc5MDQxNSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIuYXNzaWduYWJsZSAmIDIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VNZW1iZXJPclVwZGF0ZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCB2YWx1ZSwgaW5Hcm91cCwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlID0gcGFyc2VyLmFzc2lnbmFibGUgJiAyID8gMTYgOiAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDE4ICYmIHRva2VuICE9PSAxMDc0NzkwNDE1KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDEwNzc5MzYxNTcpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VBc3NpZ25tZW50RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIGlzUGF0dGVybiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgdmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChwYXJzZXIudG9rZW4gPT09IDY5MjcxNTcxKSB7DQogICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuID09PSAyMDkwMDcpDQogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSB8PSAxNjsNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUgfD0NCiAgICAgICAgICAgICAgICAgICAgICAgICh0b2tlbiA9PT0gMTI0MDINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IDI1Ng0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogdG9rZW4gPT09IDEyNDAzDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gNTEyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogMSkgfCAyOw0KICAgICAgICAgICAgICAgICAgICBrZXkgPSBwYXJzZUNvbXB1dGVkUHJvcGVydHlOYW1lKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCk7DQogICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSBwYXJzZXIuYXNzaWduYWJsZTsNCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZU1ldGhvZERlZmluaXRpb24ocGFyc2VyLCBjb250ZXh0LCBzdGF0ZSwgaW5Hcm91cCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhcnNlci50b2tlbiAmICgxNDMzNjAgfCA0MDk2KSkgew0KICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgIGlmICh0b2tlbiA9PT0gMTIxKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgOTMpOw0KICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW4gPT09IDIwOTAwNykgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci5mbGFncyAmIDEpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTI5KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGtleSA9IHBhcnNlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDApOw0KICAgICAgICAgICAgICAgICAgICBzdGF0ZSB8PQ0KICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPT09IDEyNDAyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAyNTYNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IHRva2VuID09PSAxMjQwMw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IDUxMg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IDE7DQogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VNZXRob2REZWZpbml0aW9uKHBhcnNlciwgY29udGV4dCwgc3RhdGUsIGluR3JvdXAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmIChwYXJzZXIudG9rZW4gPT09IDY3MTc0NDExKSB7DQogICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUgfD0gMTsNCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZU1ldGhvZERlZmluaXRpb24ocGFyc2VyLCBjb250ZXh0LCBzdGF0ZSwgaW5Hcm91cCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhcnNlci50b2tlbiA9PT0gODQ1NzAxNCkgew0KICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgIGlmICh0b2tlbiA9PT0gMTI0MDIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDQwKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0b2tlbiA9PT0gMTI0MDMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDQxKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0b2tlbiA9PT0gMTQzNDgzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCA5Myk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgICAgICAgICAgICAgICAgIHN0YXRlIHw9DQogICAgICAgICAgICAgICAgICAgICAgICA4IHwgMSB8ICh0b2tlbiA9PT0gMjA5MDA3ID8gMTYgOiAwKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiAmIDE0MzM2MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAga2V5ID0gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoKHBhcnNlci50b2tlbiAmIDEzNDIxNzcyOCkgPT09IDEzNDIxNzcyOCkgew0KICAgICAgICAgICAgICAgICAgICAgICAga2V5ID0gcGFyc2VMaXRlcmFsKHBhcnNlciwgY29udGV4dCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocGFyc2VyLnRva2VuID09PSA2OTI3MTU3MSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgfD0gMjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGtleSA9IHBhcnNlQ29tcHV0ZWRQcm9wZXJ0eU5hbWUocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSBwYXJzZXIuYXNzaWduYWJsZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDI4LCBLZXl3b3JkRGVzY1RhYmxlW3BhcnNlci50b2tlbiAmIDI1NV0pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VNZXRob2REZWZpbml0aW9uKHBhcnNlciwgY29udGV4dCwgc3RhdGUsIGluR3JvdXAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmICgocGFyc2VyLnRva2VuICYgMTM0MjE3NzI4KSA9PT0gMTM0MjE3NzI4KSB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0b2tlbiA9PT0gMjA5MDA3KQ0KICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgIHN0YXRlIHw9DQogICAgICAgICAgICAgICAgICAgICAgICB0b2tlbiA9PT0gMTI0MDINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IDI1Ng0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogdG9rZW4gPT09IDEyNDAzDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gNTEyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogMTsNCiAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICBrZXkgPSBwYXJzZUxpdGVyYWwocGFyc2VyLCBjb250ZXh0KTsNCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZU1ldGhvZERlZmluaXRpb24ocGFyc2VyLCBjb250ZXh0LCBzdGF0ZSwgaW5Hcm91cCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMzApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKChwYXJzZXIudG9rZW4gJiAxMzQyMTc3MjgpID09PSAxMzQyMTc3MjgpIHsNCiAgICAgICAgICAgICAgICBrZXkgPSBwYXJzZUxpdGVyYWwocGFyc2VyLCBjb250ZXh0KTsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAyMSkgew0KICAgICAgICAgICAgICAgICAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAyMSk7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW5WYWx1ZSA9PT0gJ19fcHJvdG9fXycpDQogICAgICAgICAgICAgICAgICAgICAgICBwcm90b3R5cGVDb3VudCsrOw0KICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICYgMTQzMzYwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlUHJpbWFyeUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBraW5kLCAwLCAxLCAwLCBpbkdyb3VwLCAxLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgdG9rZW4sIHRva2VuVmFsdWU6IHZhbHVlQWZ0ZXJDb2xvbiB9ID0gcGFyc2VyOw0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZU1lbWJlck9yVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIHZhbHVlLCBpbkdyb3VwLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDE4IHx8IHBhcnNlci50b2tlbiA9PT0gMTA3NDc5MDQxNSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlbiA9PT0gMTA3NzkzNjE1NyB8fCB0b2tlbiA9PT0gMTA3NDc5MDQxNSB8fCB0b2tlbiA9PT0gMTgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci5hc3NpZ25hYmxlICYgMikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNjb3BlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRWYXJPckJsb2NrKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIHZhbHVlQWZ0ZXJDb2xvbiwga2luZCwgb3JpZ2luKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSAmIDENCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IDMyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAxNjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChwYXJzZXIudG9rZW4gPT09IDEwNzc5MzYxNTcpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLmFzc2lnbmFibGUgJiAyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZUFzc2lnbm1lbnRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgaXNQYXR0ZXJuLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCB2YWx1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZUFzc2lnbm1lbnRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgaXNQYXR0ZXJuLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCB2YWx1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoKHBhcnNlci50b2tlbiAmIDIwOTcxNTIpID09PSAyMDk3MTUyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLnRva2VuID09PSA2OTI3MTU3MQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHBhcnNlQXJyYXlFeHByZXNzaW9uT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDAsIGluR3JvdXAsIGlzUGF0dGVybiwga2luZCwgb3JpZ2luLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IHBhcnNlT2JqZWN0TGl0ZXJhbE9yUGF0dGVybihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCAwLCBpbkdyb3VwLCBpc1BhdHRlcm4sIGtpbmQsIG9yaWdpbiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgPSBwYXJzZXIuZGVzdHJ1Y3RpYmxlOw0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSAmIDE2ID8gMiA6IDE7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxOCB8fCBwYXJzZXIudG9rZW4gPT09IDEwNzQ3OTA0MTUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLmFzc2lnbmFibGUgJiAyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgocGFyc2VyLmRlc3RydWN0aWJsZSAmIDgpICE9PSA4KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZU1lbWJlck9yVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIHZhbHVlLCBpbkdyb3VwLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgPSBwYXJzZXIuYXNzaWduYWJsZSAmIDIgPyAxNiA6IDA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChwYXJzZXIudG9rZW4gJiA0MTk0MzA0KSA9PT0gNDE5NDMwNCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb25PclBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBpc1BhdHRlcm4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgocGFyc2VyLnRva2VuICYgODQ1NDE0NCkgPT09IDg0NTQxNDQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VCaW5hcnlFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgNCwgdG9rZW4sIHZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMjIpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlQ29uZGl0aW9uYWxFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgdmFsdWUsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgJiAyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAxNg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogMzI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZUxlZnRIYW5kU2lkZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAwLCAxLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlICYgMQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IDMyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogMTY7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxOCB8fCBwYXJzZXIudG9rZW4gPT09IDEwNzQ3OTA0MTUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLmFzc2lnbmFibGUgJiAyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgdmFsdWUsIGluR3JvdXAsIDAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSA9IHBhcnNlci5hc3NpZ25hYmxlICYgMSA/IDAgOiAxNjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICE9PSAxOCAmJiBwYXJzZXIudG9rZW4gIT09IDEwNzQ3OTA0MTUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gMTA3NzkzNjE1NykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZUFzc2lnbm1lbnRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCwgaXNQYXR0ZXJuLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCB2YWx1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhcnNlci50b2tlbiA9PT0gNjcxNzQ0MTEpIHsNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUgfD0gMTsNCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZU1ldGhvZERlZmluaXRpb24ocGFyc2VyLCBjb250ZXh0LCBzdGF0ZSwgaW5Hcm91cCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSA9IHBhcnNlci5hc3NpZ25hYmxlIHwgMTY7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMzEpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHBhcnNlci50b2tlbiA9PT0gNjkyNzE1NzEpIHsNCiAgICAgICAgICAgICAgICBrZXkgPSBwYXJzZUNvbXB1dGVkUHJvcGVydHlOYW1lKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCk7DQogICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IHBhcnNlci5kZXN0cnVjdGlibGUgJiAyNTYgPyAyNTYgOiAwOw0KICAgICAgICAgICAgICAgIHN0YXRlIHw9IDI7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMjEpIHsNCiAgICAgICAgICAgICAgICAgICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCB0b2tlblZhbHVlLCB0b2tlbjogdG9rZW5BZnRlckNvbG9uIH0gPSBwYXJzZXI7DQogICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gJiAxNDMzNjApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VQcmltYXJ5RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGtpbmQsIDAsIDEsIDAsIGluR3JvdXAsIDEsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgeyB0b2tlbiB9ID0gcGFyc2VyOw0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZU1lbWJlck9yVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIHZhbHVlLCBpbkdyb3VwLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgocGFyc2VyLnRva2VuICYgNDE5NDMwNCkgPT09IDQxOTQzMDQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgJiAyDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IDE2DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IHRva2VuID09PSAxMDc3OTM2MTU3DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAwDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAzMjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb25PclBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBpc1BhdHRlcm4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhcnNlci50b2tlbiA9PT0gMTggfHwgcGFyc2VyLnRva2VuID09PSAxMDc0NzkwNDE1KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuID09PSAxMDc3OTM2MTU3IHx8IHRva2VuID09PSAxMDc0NzkwNDE1IHx8IHRva2VuID09PSAxOCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLmFzc2lnbmFibGUgJiAyKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoc2NvcGUgJiYgKHRva2VuQWZ0ZXJDb2xvbiAmIDE0MzM2MCkgPT09IDE0MzM2MCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkVmFyT3JCbG9jayhwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCB0b2tlblZhbHVlLCBraW5kLCBvcmlnaW4pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlICYgMQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gMzINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IDE2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBpc1BhdHRlcm4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgocGFyc2VyLnRva2VuICYgMjA5NzE1MikgPT09IDIwOTcxNTIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIudG9rZW4gPT09IDY5MjcxNTcxDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gcGFyc2VBcnJheUV4cHJlc3Npb25PclBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgMCwgaW5Hcm91cCwgaXNQYXR0ZXJuLCBraW5kLCBvcmlnaW4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogcGFyc2VPYmplY3RMaXRlcmFsT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDAsIGluR3JvdXAsIGlzUGF0dGVybiwga2luZCwgb3JpZ2luLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSA9IHBhcnNlci5kZXN0cnVjdGlibGU7DQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlICYgMTYgPyAyIDogMTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDE4IHx8IHBhcnNlci50b2tlbiA9PT0gMTA3NDc5MDQxNSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIuYXNzaWduYWJsZSAmIDIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGRlc3RydWN0aWJsZSAmIDgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCA2MCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgdmFsdWUsIGluR3JvdXAsIDAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSA9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlICYgMiA/IGRlc3RydWN0aWJsZSB8IDE2IDogMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKHBhcnNlci50b2tlbiAmIDQxOTQzMDQpID09PSA0MTk0MzA0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDEwNzc5MzYxNTcpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VBc3NpZ25tZW50RXhwcmVzc2lvbk9yUGF0dGVybihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIGlzUGF0dGVybiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgdmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChwYXJzZXIudG9rZW4gJiA4NDU0MTQ0KSA9PT0gODQ1NDE0NCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZUJpbmFyeUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCA0LCB0b2tlbiwgdmFsdWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAyMikpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VDb25kaXRpb25hbEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCB2YWx1ZSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSAmIDINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IDE2DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAzMjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlTGVmdEhhbmRTaWRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDEsIDAsIDEsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgJiAxDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gMzINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAxNjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDE4IHx8IHBhcnNlci50b2tlbiA9PT0gMTA3NDc5MDQxNSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIuYXNzaWduYWJsZSAmIDIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VNZW1iZXJPclVwZGF0ZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCB2YWx1ZSwgaW5Hcm91cCwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlID0gcGFyc2VyLmFzc2lnbmFibGUgJiAxID8gMCA6IDE2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDE4ICYmIHBhcnNlci50b2tlbiAhPT0gMTA3NDc5MDQxNSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICE9PSAxMDc3OTM2MTU3KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBpc1BhdHRlcm4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAocGFyc2VyLnRva2VuID09PSA2NzE3NDQxMSkgew0KICAgICAgICAgICAgICAgICAgICBzdGF0ZSB8PSAxOw0KICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlTWV0aG9kRGVmaW5pdGlvbihwYXJzZXIsIGNvbnRleHQsIHN0YXRlLCBpbkdyb3VwLCBwYXJzZXIudG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSA9IDE2Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgNDIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHRva2VuID09PSA4NDU3MDE0KSB7DQogICAgICAgICAgICAgICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgODQ1NzAxNCk7DQogICAgICAgICAgICAgICAgc3RhdGUgfD0gODsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICYgMTQzMzYwKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgdG9rZW4sIGxpbmUsIGluZGV4IH0gPSBwYXJzZXI7DQogICAgICAgICAgICAgICAgICAgIGtleSA9IHBhcnNlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDApOw0KICAgICAgICAgICAgICAgICAgICBzdGF0ZSB8PSAxOw0KICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSA2NzE3NDQxMSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZU1ldGhvZERlZmluaXRpb24ocGFyc2VyLCBjb250ZXh0LCBzdGF0ZSwgaW5Hcm91cCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXBvcnRNZXNzYWdlQXQoaW5kZXgsIGxpbmUsIGluZGV4LCB0b2tlbiA9PT0gMjA5MDA3DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPyA0NA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogdG9rZW4gPT09IDEyNDAyIHx8IHBhcnNlci50b2tlbiA9PT0gMTI0MDMNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyA0Mw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IDQ1LCBLZXl3b3JkRGVzY1RhYmxlW3Rva2VuICYgMjU1XSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAoKHBhcnNlci50b2tlbiAmIDEzNDIxNzcyOCkgPT09IDEzNDIxNzcyOCkgew0KICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgIGtleSA9IHBhcnNlTGl0ZXJhbChwYXJzZXIsIGNvbnRleHQpOw0KICAgICAgICAgICAgICAgICAgICBzdGF0ZSB8PSAxOw0KICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlTWV0aG9kRGVmaW5pdGlvbihwYXJzZXIsIGNvbnRleHQsIHN0YXRlLCBpbkdyb3VwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAocGFyc2VyLnRva2VuID09PSA2OTI3MTU3MSkgew0KICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgIHN0YXRlIHw9IDIgfCAxOw0KICAgICAgICAgICAgICAgICAgICBrZXkgPSBwYXJzZUNvbXB1dGVkUHJvcGVydHlOYW1lKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCk7DQogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VNZXRob2REZWZpbml0aW9uKHBhcnNlciwgY29udGV4dCwgc3RhdGUsIGluR3JvdXAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTIzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAyOCwgS2V5d29yZERlc2NUYWJsZVt0b2tlbiAmIDI1NV0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IHBhcnNlci5kZXN0cnVjdGlibGUgJiAxMjggPyAxMjggOiAwOw0KICAgICAgICAgICAgcGFyc2VyLmRlc3RydWN0aWJsZSA9IGRlc3RydWN0aWJsZTsNCiAgICAgICAgICAgIHByb3BlcnRpZXMucHVzaChmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgew0KICAgICAgICAgICAgICAgIHR5cGU6ICdQcm9wZXJ0eScsDQogICAgICAgICAgICAgICAga2V5OiBrZXksDQogICAgICAgICAgICAgICAgdmFsdWUsDQogICAgICAgICAgICAgICAga2luZDogIShzdGF0ZSAmIDc2OCkgPyAnaW5pdCcgOiBzdGF0ZSAmIDUxMiA/ICdzZXQnIDogJ2dldCcsDQogICAgICAgICAgICAgICAgY29tcHV0ZWQ6IChzdGF0ZSAmIDIpID4gMCwNCiAgICAgICAgICAgICAgICBtZXRob2Q6IChzdGF0ZSAmIDEpID4gMCwNCiAgICAgICAgICAgICAgICBzaG9ydGhhbmQ6IChzdGF0ZSAmIDQpID4gMA0KICAgICAgICAgICAgfSkpOw0KICAgICAgICB9DQogICAgICAgIGRlc3RydWN0aWJsZSB8PSBwYXJzZXIuZGVzdHJ1Y3RpYmxlOw0KICAgICAgICBpZiAocGFyc2VyLnRva2VuICE9PSAxOCkNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICB9DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDEwNzQ3OTA0MTUpOw0KICAgIGlmIChwcm90b3R5cGVDb3VudCA+IDEpDQogICAgICAgIGRlc3RydWN0aWJsZSB8PSA2NDsNCiAgICBjb25zdCBub2RlID0gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogaXNQYXR0ZXJuID8gJ09iamVjdFBhdHRlcm4nIDogJ09iamVjdEV4cHJlc3Npb24nLA0KICAgICAgICBwcm9wZXJ0aWVzDQogICAgfSk7DQogICAgaWYgKCFza2lwSW5pdGlhbGl6ZXIgJiYgcGFyc2VyLnRva2VuICYgNDE5NDMwNCkgew0KICAgICAgICByZXR1cm4gcGFyc2VBcnJheU9yT2JqZWN0QXNzaWdubWVudFBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCBkZXN0cnVjdGlibGUsIGluR3JvdXAsIGlzUGF0dGVybiwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgbm9kZSk7DQogICAgfQ0KICAgIHBhcnNlci5kZXN0cnVjdGlibGUgPSBkZXN0cnVjdGlibGU7DQogICAgcmV0dXJuIG5vZGU7DQp9DQpmdW5jdGlvbiBwYXJzZU1ldGhvZEZvcm1hbHMocGFyc2VyLCBjb250ZXh0LCBzY29wZSwga2luZCwgdHlwZSwgaW5Hcm91cCkgew0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCA2NzE3NDQxMSk7DQogICAgY29uc3QgcGFyYW1zID0gW107DQogICAgcGFyc2VyLmZsYWdzID0gKHBhcnNlci5mbGFncyB8IDEyOCkgXiAxMjg7DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTYpIHsNCiAgICAgICAgaWYgKGtpbmQgJiA1MTIpIHsNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDM1LCAnU2V0dGVyJywgJ29uZScsICcnKTsNCiAgICAgICAgfQ0KICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICAgICAgcmV0dXJuIHBhcmFtczsNCiAgICB9DQogICAgaWYgKGtpbmQgJiAyNTYpIHsNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMzUsICdHZXR0ZXInLCAnbm8nLCAncycpOw0KICAgIH0NCiAgICBpZiAoa2luZCAmIDUxMiAmJiBwYXJzZXIudG9rZW4gPT09IDE0KSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDM2KTsNCiAgICB9DQogICAgY29udGV4dCA9IChjb250ZXh0IHwgMTM0MjE3NzI4KSBeIDEzNDIxNzcyODsNCiAgICBsZXQgc2V0dGVyQXJncyA9IDA7DQogICAgbGV0IGlzU2ltcGxlUGFyYW1ldGVyTGlzdCA9IDA7DQogICAgd2hpbGUgKHBhcnNlci50b2tlbiAhPT0gMTgpIHsNCiAgICAgICAgbGV0IGxlZnQgPSBudWxsOw0KICAgICAgICBjb25zdCB7IHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICAgICAgaWYgKHBhcnNlci50b2tlbiAmIDE0MzM2MCkgew0KICAgICAgICAgICAgaWYgKChjb250ZXh0ICYgMTAyNCkgPT09IDApIHsNCiAgICAgICAgICAgICAgICBpZiAoKHBhcnNlci50b2tlbiAmIDM2ODY0KSA9PT0gMzY4NjQpIHsNCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmZsYWdzIHw9IDI1NjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKChwYXJzZXIudG9rZW4gJiA1MzcwNzk4MDgpID09PSA1MzcwNzk4MDgpIHsNCiAgICAgICAgICAgICAgICAgICAgcGFyc2VyLmZsYWdzIHw9IDUxMjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBsZWZ0ID0gcGFyc2VBbmRDbGFzc2lmeUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCBzY29wZSwga2luZCB8IDEsIDAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMjE2MjcwMCkgew0KICAgICAgICAgICAgICAgIGxlZnQgPSBwYXJzZU9iamVjdExpdGVyYWxPclBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgMSwgaW5Hcm91cCwgMSwgdHlwZSwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIGlmIChwYXJzZXIudG9rZW4gPT09IDY5MjcxNTcxKSB7DQogICAgICAgICAgICAgICAgbGVmdCA9IHBhcnNlQXJyYXlFeHByZXNzaW9uT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDEsIGluR3JvdXAsIDEsIHR5cGUsIDAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAocGFyc2VyLnRva2VuID09PSAxNCkgew0KICAgICAgICAgICAgICAgIGxlZnQgPSBwYXJzZVNwcmVhZE9yUmVzdEVsZW1lbnQocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgMTYsIHR5cGUsIDAsIDAsIGluR3JvdXAsIDEsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaXNTaW1wbGVQYXJhbWV0ZXJMaXN0ID0gMTsNCiAgICAgICAgICAgIGlmIChwYXJzZXIuZGVzdHJ1Y3RpYmxlICYgKDMyIHwgMTYpKQ0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDQ4KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxMDc3OTM2MTU3KSB7DQogICAgICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgICAgICAgICAgaXNTaW1wbGVQYXJhbWV0ZXJMaXN0ID0gMTsNCiAgICAgICAgICAgIGNvbnN0IHJpZ2h0ID0gcGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMSwgMCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgICAgICBsZWZ0ID0gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MsIHsNCiAgICAgICAgICAgICAgICB0eXBlOiAnQXNzaWdubWVudFBhdHRlcm4nLA0KICAgICAgICAgICAgICAgIGxlZnQ6IGxlZnQsDQogICAgICAgICAgICAgICAgcmlnaHQNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIHNldHRlckFyZ3MrKzsNCiAgICAgICAgcGFyYW1zLnB1c2gobGVmdCk7DQogICAgICAgIGlmICghY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQsIDE4KSkNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxNikgew0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKGtpbmQgJiA1MTIgJiYgc2V0dGVyQXJncyAhPT0gMSkgew0KICAgICAgICByZXBvcnQocGFyc2VyLCAzNSwgJ1NldHRlcicsICdvbmUnLCAnJyk7DQogICAgfQ0KICAgIGlmIChzY29wZSAmJiBzY29wZS5zY29wZUVycm9yICE9PSB2b2lkIDApDQogICAgICAgIHJlcG9ydFNjb3BlRXJyb3Ioc2NvcGUuc2NvcGVFcnJvcik7DQogICAgaWYgKGlzU2ltcGxlUGFyYW1ldGVyTGlzdCkNCiAgICAgICAgcGFyc2VyLmZsYWdzIHw9IDEyODsNCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgMTYpOw0KICAgIHJldHVybiBwYXJhbXM7DQp9DQpmdW5jdGlvbiBwYXJzZUNvbXB1dGVkUHJvcGVydHlOYW1lKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCkgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgY29uc3Qga2V5ID0gcGFyc2VFeHByZXNzaW9uKHBhcnNlciwgKGNvbnRleHQgfCAxMzQyMTc3MjgpIF4gMTM0MjE3NzI4LCAxLCAwLCBpbkdyb3VwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgMjApOw0KICAgIHJldHVybiBrZXk7DQp9DQpmdW5jdGlvbiBwYXJzZVBhcmVudGhlc2l6ZWRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgY2FuQXNzaWduLCBraW5kLCBvcmlnaW4sIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBwYXJzZXIuZmxhZ3MgPSAocGFyc2VyLmZsYWdzIHwgMTI4KSBeIDEyODsNCiAgICBjb25zdCB7IHRva2VuUG9zOiBwaVN0YXJ0LCBsaW5lUG9zOiBwbFN0YXJ0LCBjb2xQb3M6IHBjU3RhcnQgfSA9IHBhcnNlcjsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjggfCAxMDczNzQxODI0KTsNCiAgICBjb25zdCBzY29wZSA9IGNvbnRleHQgJiA2NCA/IGFkZENoaWxkU2NvcGUoY3JlYXRlU2NvcGUoKSwgMTAyNCkgOiB2b2lkIDA7DQogICAgY29udGV4dCA9IChjb250ZXh0IHwgMTM0MjE3NzI4KSBeIDEzNDIxNzcyODsNCiAgICBpZiAoY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQsIDE2KSkgew0KICAgICAgICByZXR1cm4gcGFyc2VQYXJlbnRoZXNpemVkQXJyb3cocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgW10sIGNhbkFzc2lnbiwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgfQ0KICAgIGxldCBkZXN0cnVjdGlibGUgPSAwOw0KICAgIHBhcnNlci5kZXN0cnVjdGlibGUgJj0gfigyNTYgfCAxMjgpOw0KICAgIGxldCBleHByOw0KICAgIGxldCBleHByZXNzaW9ucyA9IFtdOw0KICAgIGxldCBpc1NlcXVlbmNlID0gMDsNCiAgICBsZXQgaXNTaW1wbGVQYXJhbWV0ZXJMaXN0ID0gMDsNCiAgICBjb25zdCB7IHRva2VuUG9zOiBpU3RhcnQsIGxpbmVQb3M6IGxTdGFydCwgY29sUG9zOiBjU3RhcnQgfSA9IHBhcnNlcjsNCiAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDE7DQogICAgd2hpbGUgKHBhcnNlci50b2tlbiAhPT0gMTYpIHsNCiAgICAgICAgY29uc3QgeyB0b2tlbiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgICAgICBpZiAodG9rZW4gJiAoMTQzMzYwIHwgNDA5NikpIHsNCiAgICAgICAgICAgIGlmIChzY29wZSkNCiAgICAgICAgICAgICAgICBhZGRCbG9ja05hbWUocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgcGFyc2VyLnRva2VuVmFsdWUsIDEsIDApOw0KICAgICAgICAgICAgZXhwciA9IHBhcnNlUHJpbWFyeUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBraW5kLCAwLCAxLCAwLCAxLCAxLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDE2IHx8IHBhcnNlci50b2tlbiA9PT0gMTgpIHsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VyLmFzc2lnbmFibGUgJiAyKSB7DQogICAgICAgICAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgICAgICAgICAgaXNTaW1wbGVQYXJhbWV0ZXJMaXN0ID0gMTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSBpZiAoKHRva2VuICYgNTM3MDc5ODA4KSA9PT0gNTM3MDc5ODA4IHx8DQogICAgICAgICAgICAgICAgICAgICh0b2tlbiAmIDM2ODY0KSA9PT0gMzY4NjQpIHsNCiAgICAgICAgICAgICAgICAgICAgaXNTaW1wbGVQYXJhbWV0ZXJMaXN0ID0gMTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxMDc3OTM2MTU3KSB7DQogICAgICAgICAgICAgICAgICAgIGlzU2ltcGxlUGFyYW1ldGVyTGlzdCA9IDE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGV4cHIgPSBwYXJzZU1lbWJlck9yVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGV4cHIsIDEsIDAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDE2ICYmIHBhcnNlci50b2tlbiAhPT0gMTgpIHsNCiAgICAgICAgICAgICAgICAgICAgZXhwciA9IHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCBleHByKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoKHRva2VuICYgMjA5NzE1MikgPT09IDIwOTcxNTIpIHsNCiAgICAgICAgICAgIGV4cHIgPQ0KICAgICAgICAgICAgICAgIHRva2VuID09PSAyMTYyNzAwDQogICAgICAgICAgICAgICAgICAgID8gcGFyc2VPYmplY3RMaXRlcmFsT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCB8IDEwNzM3NDE4MjQsIHNjb3BlLCAwLCAxLCAwLCBraW5kLCBvcmlnaW4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpDQogICAgICAgICAgICAgICAgICAgIDogcGFyc2VBcnJheUV4cHJlc3Npb25PclBhdHRlcm4ocGFyc2VyLCBjb250ZXh0IHwgMTA3Mzc0MTgyNCwgc2NvcGUsIDAsIDEsIDAsIGtpbmQsIG9yaWdpbiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gcGFyc2VyLmRlc3RydWN0aWJsZTsNCiAgICAgICAgICAgIGlzU2ltcGxlUGFyYW1ldGVyTGlzdCA9IDE7DQogICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICE9PSAxNiAmJiBwYXJzZXIudG9rZW4gIT09IDE4KSB7DQogICAgICAgICAgICAgICAgaWYgKGRlc3RydWN0aWJsZSAmIDgpDQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDExOSk7DQogICAgICAgICAgICAgICAgZXhwciA9IHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgZXhwciwgMCwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDE2ICYmIHBhcnNlci50b2tlbiAhPT0gMTgpIHsNCiAgICAgICAgICAgICAgICAgICAgZXhwciA9IHBhcnNlQXNzaWdubWVudEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAwLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zLCBleHByKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAodG9rZW4gPT09IDE0KSB7DQogICAgICAgICAgICBleHByID0gcGFyc2VTcHJlYWRPclJlc3RFbGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDE2LCBraW5kLCBvcmlnaW4sIDAsIDEsIDAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgaWYgKHBhcnNlci5kZXN0cnVjdGlibGUgJiAxNikNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCA3Mik7DQogICAgICAgICAgICBpc1NpbXBsZVBhcmFtZXRlckxpc3QgPSAxOw0KICAgICAgICAgICAgaWYgKGlzU2VxdWVuY2UgJiYgKHBhcnNlci50b2tlbiA9PT0gMTYgfHwgcGFyc2VyLnRva2VuID09PSAxOCkpIHsNCiAgICAgICAgICAgICAgICBleHByZXNzaW9ucy5wdXNoKGV4cHIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDg7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGRlc3RydWN0aWJsZSB8PSAxNjsNCiAgICAgICAgICAgIGV4cHIgPSBwYXJzZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAwLCAxLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgIGlmIChpc1NlcXVlbmNlICYmIChwYXJzZXIudG9rZW4gPT09IDE2IHx8IHBhcnNlci50b2tlbiA9PT0gMTgpKSB7DQogICAgICAgICAgICAgICAgZXhwcmVzc2lvbnMucHVzaChleHByKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDE4KSB7DQogICAgICAgICAgICAgICAgaWYgKCFpc1NlcXVlbmNlKSB7DQogICAgICAgICAgICAgICAgICAgIGlzU2VxdWVuY2UgPSAxOw0KICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9ucyA9IFtleHByXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoaXNTZXF1ZW5jZSkgew0KICAgICAgICAgICAgICAgIHdoaWxlIChjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAxOCkpIHsNCiAgICAgICAgICAgICAgICAgICAgZXhwcmVzc2lvbnMucHVzaChwYXJzZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAwLCAxLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICAgICAgICAgICAgICBleHByID0gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIGlTdGFydCwgbFN0YXJ0LCBjU3RhcnQsIHsNCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1NlcXVlbmNlRXhwcmVzc2lvbicsDQogICAgICAgICAgICAgICAgICAgIGV4cHJlc3Npb25zDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgMTYpOw0KICAgICAgICAgICAgcGFyc2VyLmRlc3RydWN0aWJsZSA9IGRlc3RydWN0aWJsZTsNCiAgICAgICAgICAgIHJldHVybiBleHByOw0KICAgICAgICB9DQogICAgICAgIGlmIChpc1NlcXVlbmNlICYmIChwYXJzZXIudG9rZW4gPT09IDE2IHx8IHBhcnNlci50b2tlbiA9PT0gMTgpKSB7DQogICAgICAgICAgICBleHByZXNzaW9ucy5wdXNoKGV4cHIpOw0KICAgICAgICB9DQogICAgICAgIGlmICghY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMTgpKQ0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIGlmICghaXNTZXF1ZW5jZSkgew0KICAgICAgICAgICAgaXNTZXF1ZW5jZSA9IDE7DQogICAgICAgICAgICBleHByZXNzaW9ucyA9IFtleHByXTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxNikgew0KICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDg7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBpZiAoaXNTZXF1ZW5jZSkgew0KICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgICAgIGV4cHIgPSBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgaVN0YXJ0LCBsU3RhcnQsIGNTdGFydCwgew0KICAgICAgICAgICAgdHlwZTogJ1NlcXVlbmNlRXhwcmVzc2lvbicsDQogICAgICAgICAgICBleHByZXNzaW9ucw0KICAgICAgICB9KTsNCiAgICB9DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDE2KTsNCiAgICBpZiAoZGVzdHJ1Y3RpYmxlICYgMTYgJiYgZGVzdHJ1Y3RpYmxlICYgOCkNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMTQ2KTsNCiAgICBkZXN0cnVjdGlibGUgfD0NCiAgICAgICAgcGFyc2VyLmRlc3RydWN0aWJsZSAmIDI1Ng0KICAgICAgICAgICAgPyAyNTYNCiAgICAgICAgICAgIDogMCB8IChwYXJzZXIuZGVzdHJ1Y3RpYmxlICYgMTI4KQ0KICAgICAgICAgICAgICAgID8gMTI4DQogICAgICAgICAgICAgICAgOiAwOw0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDEwKSB7DQogICAgICAgIGlmIChkZXN0cnVjdGlibGUgJiAoMzIgfCAxNikpDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCA0Nyk7DQogICAgICAgIGlmIChjb250ZXh0ICYgKDQxOTQzMDQgfCAyMDQ4KSAmJiBkZXN0cnVjdGlibGUgJiAxMjgpDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAyOSk7DQogICAgICAgIGlmIChjb250ZXh0ICYgKDEwMjQgfCAyMDk3MTUyKSAmJiBkZXN0cnVjdGlibGUgJiAyNTYpIHsNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDMwKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNTaW1wbGVQYXJhbWV0ZXJMaXN0KQ0KICAgICAgICAgICAgcGFyc2VyLmZsYWdzIHw9IDEyODsNCiAgICAgICAgcmV0dXJuIHBhcnNlUGFyZW50aGVzaXplZEFycm93KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGlzU2VxdWVuY2UgPyBleHByZXNzaW9ucyA6IFtleHByXSwgY2FuQXNzaWduLCAwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICB9DQogICAgZWxzZSBpZiAoZGVzdHJ1Y3RpYmxlICYgOCkgew0KICAgICAgICByZXBvcnQocGFyc2VyLCAxNDApOw0KICAgIH0NCiAgICBwYXJzZXIuZGVzdHJ1Y3RpYmxlID0gKChwYXJzZXIuZGVzdHJ1Y3RpYmxlIHwgMjU2KSBeIDI1NikgfCBkZXN0cnVjdGlibGU7DQogICAgcmV0dXJuIGNvbnRleHQgJiAxMjgNCiAgICAgICAgPyBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgcGlTdGFydCwgcGxTdGFydCwgcGNTdGFydCwgew0KICAgICAgICAgICAgdHlwZTogJ1BhcmVudGhlc2l6ZWRFeHByZXNzaW9uJywNCiAgICAgICAgICAgIGV4cHJlc3Npb246IGV4cHINCiAgICAgICAgfSkNCiAgICAgICAgOiBleHByOw0KfQ0KZnVuY3Rpb24gcGFyc2VJZGVudGlmaWVyT3JBcnJvdyhwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBjb25zdCB7IHRva2VuVmFsdWUgfSA9IHBhcnNlcjsNCiAgICBjb25zdCBleHByID0gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMCk7DQogICAgcGFyc2VyLmFzc2lnbmFibGUgPSAxOw0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDEwKSB7DQogICAgICAgIGxldCBzY29wZSA9IHZvaWQgMDsNCiAgICAgICAgaWYgKGNvbnRleHQgJiA2NCkNCiAgICAgICAgICAgIHNjb3BlID0gY3JlYXRlQXJyb3dIZWFkUGFyc2luZ1Njb3BlKHBhcnNlciwgY29udGV4dCwgdG9rZW5WYWx1ZSk7DQogICAgICAgIHBhcnNlci5mbGFncyA9IChwYXJzZXIuZmxhZ3MgfCAxMjgpIF4gMTI4Ow0KICAgICAgICByZXR1cm4gcGFyc2VBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBbZXhwcl0sIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIH0NCiAgICByZXR1cm4gZXhwcjsNCn0NCmZ1bmN0aW9uIHBhcnNlQXJyb3dGcm9tSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIHZhbHVlLCBleHByLCBpbk5ldywgY2FuQXNzaWduLCBpc0FzeW5jLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgaWYgKCFjYW5Bc3NpZ24pDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDU1KTsNCiAgICBpZiAoaW5OZXcpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDQ5KTsNCiAgICBwYXJzZXIuZmxhZ3MgJj0gfjEyODsNCiAgICBjb25zdCBzY29wZSA9IGNvbnRleHQgJiA2NCA/IGNyZWF0ZUFycm93SGVhZFBhcnNpbmdTY29wZShwYXJzZXIsIGNvbnRleHQsIHZhbHVlKSA6IHZvaWQgMDsNCiAgICByZXR1cm4gcGFyc2VBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBbZXhwcl0sIGlzQXN5bmMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KfQ0KZnVuY3Rpb24gcGFyc2VQYXJlbnRoZXNpemVkQXJyb3cocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgcGFyYW1zLCBjYW5Bc3NpZ24sIGlzQXN5bmMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBpZiAoIWNhbkFzc2lnbikNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgNTUpOw0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFyYW1zLmxlbmd0aDsgKytpKQ0KICAgICAgICByZWludGVycHJldFRvUGF0dGVybihwYXJzZXIsIHBhcmFtc1tpXSk7DQogICAgcmV0dXJuIHBhcnNlQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgcGFyYW1zLCBpc0FzeW5jLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCn0NCmZ1bmN0aW9uIHBhcnNlQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgcGFyYW1zLCBpc0FzeW5jLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgaWYgKHBhcnNlci5mbGFncyAmIDEpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDQ2KTsNCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAxMCk7DQogICAgY29udGV4dCA9ICgoY29udGV4dCB8IDE1NzI4NjQwKSBeIDE1NzI4NjQwKSB8IChpc0FzeW5jIDw8IDIyKTsNCiAgICBjb25zdCBleHByZXNzaW9uID0gcGFyc2VyLnRva2VuICE9PSAyMTYyNzAwOw0KICAgIGxldCBib2R5Ow0KICAgIGlmIChzY29wZSAmJiBzY29wZS5zY29wZUVycm9yICE9PSB2b2lkIDApIHsNCiAgICAgICAgcmVwb3J0U2NvcGVFcnJvcihzY29wZS5zY29wZUVycm9yKTsNCiAgICB9DQogICAgaWYgKGV4cHJlc3Npb24pIHsNCiAgICAgICAgYm9keSA9IHBhcnNlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDEsIDAsIDAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgaWYgKHNjb3BlKQ0KICAgICAgICAgICAgc2NvcGUgPSBhZGRDaGlsZFNjb3BlKHNjb3BlLCAxMjgpOw0KICAgICAgICBib2R5ID0gcGFyc2VGdW5jdGlvbkJvZHkocGFyc2VyLCAoY29udGV4dCB8IDEzNDIyMTgyNCB8IDgxOTIgfCAxNjM4NCkgXg0KICAgICAgICAgICAgKDEzNDIyMTgyNCB8IDgxOTIgfCAxNjM4NCksIHNjb3BlLCAxNiwgdm9pZCAwLCB2b2lkIDApOw0KICAgICAgICBzd2l0Y2ggKHBhcnNlci50b2tlbikgew0KICAgICAgICAgICAgY2FzZSA2OTI3MTU3MToNCiAgICAgICAgICAgICAgICBpZiAoKHBhcnNlci5mbGFncyAmIDEpID09PSAwKSB7DQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDExMyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSA2NzEwODg3NzoNCiAgICAgICAgICAgIGNhc2UgNjcxNzQ0MDk6DQogICAgICAgICAgICBjYXNlIDIyOg0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDExNCk7DQogICAgICAgICAgICBjYXNlIDY3MTc0NDExOg0KICAgICAgICAgICAgICAgIGlmICgocGFyc2VyLmZsYWdzICYgMSkgPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTEzKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcGFyc2VyLmZsYWdzIHw9IDEwMjQ7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgaWYgKChwYXJzZXIudG9rZW4gJiA4NDU0MTQ0KSA9PT0gODQ1NDE0NCAmJiAocGFyc2VyLmZsYWdzICYgMSkgPT09IDApDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAyOCwgS2V5d29yZERlc2NUYWJsZVtwYXJzZXIudG9rZW4gJiAyNTVdKTsNCiAgICAgICAgaWYgKChwYXJzZXIudG9rZW4gJiAzMzYxOTk2OCkgPT09IDMzNjE5OTY4KQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTIyKTsNCiAgICB9DQogICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24nLA0KICAgICAgICBwYXJhbXMsDQogICAgICAgIGJvZHksDQogICAgICAgIGFzeW5jOiBpc0FzeW5jID09PSAxLA0KICAgICAgICBleHByZXNzaW9uDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUZvcm1hbFBhcmFtZXRlcnNPckZvcm1hbExpc3QocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgaW5Hcm91cCwga2luZCkgew0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCA2NzE3NDQxMSk7DQogICAgcGFyc2VyLmZsYWdzID0gKHBhcnNlci5mbGFncyB8IDEyOCkgXiAxMjg7DQogICAgY29uc3QgcGFyYW1zID0gW107DQogICAgaWYgKGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0LCAxNikpDQogICAgICAgIHJldHVybiBwYXJhbXM7DQogICAgY29udGV4dCA9IChjb250ZXh0IHwgMTM0MjE3NzI4KSBeIDEzNDIxNzcyODsNCiAgICBsZXQgaXNTaW1wbGVQYXJhbWV0ZXJMaXN0ID0gMDsNCiAgICB3aGlsZSAocGFyc2VyLnRva2VuICE9PSAxOCkgew0KICAgICAgICBsZXQgbGVmdDsNCiAgICAgICAgY29uc3QgeyB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgICAgIGlmIChwYXJzZXIudG9rZW4gJiAxNDMzNjApIHsNCiAgICAgICAgICAgIGlmICgoY29udGV4dCAmIDEwMjQpID09PSAwKSB7DQogICAgICAgICAgICAgICAgaWYgKChwYXJzZXIudG9rZW4gJiAzNjg2NCkgPT09IDM2ODY0KSB7DQogICAgICAgICAgICAgICAgICAgIHBhcnNlci5mbGFncyB8PSAyNTY7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICgocGFyc2VyLnRva2VuICYgNTM3MDc5ODA4KSA9PT0gNTM3MDc5ODA4KSB7DQogICAgICAgICAgICAgICAgICAgIHBhcnNlci5mbGFncyB8PSA1MTI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbGVmdCA9IHBhcnNlQW5kQ2xhc3NpZnlJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGtpbmQgfCAxLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDIxNjI3MDApIHsNCiAgICAgICAgICAgICAgICBsZWZ0ID0gcGFyc2VPYmplY3RMaXRlcmFsT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDEsIGluR3JvdXAsIDEsIGtpbmQsIDAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAocGFyc2VyLnRva2VuID09PSA2OTI3MTU3MSkgew0KICAgICAgICAgICAgICAgIGxlZnQgPSBwYXJzZUFycmF5RXhwcmVzc2lvbk9yUGF0dGVybihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCAxLCBpbkdyb3VwLCAxLCBraW5kLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKHBhcnNlci50b2tlbiA9PT0gMTQpIHsNCiAgICAgICAgICAgICAgICBsZWZ0ID0gcGFyc2VTcHJlYWRPclJlc3RFbGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDE2LCBraW5kLCAwLCAwLCBpbkdyb3VwLCAxLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDI4LCBLZXl3b3JkRGVzY1RhYmxlW3BhcnNlci50b2tlbiAmIDI1NV0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaXNTaW1wbGVQYXJhbWV0ZXJMaXN0ID0gMTsNCiAgICAgICAgICAgIGlmIChwYXJzZXIuZGVzdHJ1Y3RpYmxlICYgKDMyIHwgMTYpKSB7DQogICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgNDgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDEwNzc5MzYxNTcpIHsNCiAgICAgICAgICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgICAgICAgICBpc1NpbXBsZVBhcmFtZXRlckxpc3QgPSAxOw0KICAgICAgICAgICAgY29uc3QgcmlnaHQgPSBwYXJzZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAxLCBpbkdyb3VwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICAgICAgICAgIGxlZnQgPSBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgew0KICAgICAgICAgICAgICAgIHR5cGU6ICdBc3NpZ25tZW50UGF0dGVybicsDQogICAgICAgICAgICAgICAgbGVmdCwNCiAgICAgICAgICAgICAgICByaWdodA0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgcGFyYW1zLnB1c2gobGVmdCk7DQogICAgICAgIGlmICghY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQsIDE4KSkNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxNikgew0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKGlzU2ltcGxlUGFyYW1ldGVyTGlzdCkNCiAgICAgICAgcGFyc2VyLmZsYWdzIHw9IDEyODsNCiAgICBpZiAoc2NvcGUgJiYgKGlzU2ltcGxlUGFyYW1ldGVyTGlzdCB8fCBjb250ZXh0ICYgMTAyNCkgJiYgc2NvcGUuc2NvcGVFcnJvciAhPT0gdm9pZCAwKSB7DQogICAgICAgIHJlcG9ydFNjb3BlRXJyb3Ioc2NvcGUuc2NvcGVFcnJvcik7DQogICAgfQ0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCAxNik7DQogICAgcmV0dXJuIHBhcmFtczsNCn0NCmZ1bmN0aW9uIHBhcnNlTWVtYmVFeHByZXNzaW9uTm9DYWxsKHBhcnNlciwgY29udGV4dCwgZXhwciwgaW5Hcm91cCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnN0IHsgdG9rZW4gfSA9IHBhcnNlcjsNCiAgICBpZiAodG9rZW4gJiA2NzEwODg2NCkgew0KICAgICAgICBpZiAodG9rZW4gPT09IDY3MTA4ODc3KSB7DQogICAgICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMTA3Mzc0MTgyNCk7DQogICAgICAgICAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDE7DQogICAgICAgICAgICBjb25zdCBwcm9wZXJ0eSA9IHBhcnNlUHJvcGVydHlPclByaXZhdGVQcm9wZXJ0eU5hbWUocGFyc2VyLCBjb250ZXh0KTsNCiAgICAgICAgICAgIHJldHVybiBwYXJzZU1lbWJlRXhwcmVzc2lvbk5vQ2FsbChwYXJzZXIsIGNvbnRleHQsIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgICAgICAgICAgdHlwZTogJ01lbWJlckV4cHJlc3Npb24nLA0KICAgICAgICAgICAgICAgIG9iamVjdDogZXhwciwNCiAgICAgICAgICAgICAgICBjb21wdXRlZDogZmFsc2UsDQogICAgICAgICAgICAgICAgcHJvcGVydHkNCiAgICAgICAgICAgIH0pLCAwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmICh0b2tlbiA9PT0gNjkyNzE1NzEpIHsNCiAgICAgICAgICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgICAgICAgICBjb25zdCB7IHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5ID0gcGFyc2VFeHByZXNzaW9ucyhwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIDEsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDIwKTsNCiAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMTsNCiAgICAgICAgICAgIHJldHVybiBwYXJzZU1lbWJlRXhwcmVzc2lvbk5vQ2FsbChwYXJzZXIsIGNvbnRleHQsIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgICAgICAgICAgdHlwZTogJ01lbWJlckV4cHJlc3Npb24nLA0KICAgICAgICAgICAgICAgIG9iamVjdDogZXhwciwNCiAgICAgICAgICAgICAgICBjb21wdXRlZDogdHJ1ZSwNCiAgICAgICAgICAgICAgICBwcm9wZXJ0eQ0KICAgICAgICAgICAgfSksIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKHRva2VuID09PSA2NzE3NDQwOCB8fCB0b2tlbiA9PT0gNjcxNzQ0MDkpIHsNCiAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICAgICAgICAgIHJldHVybiBwYXJzZU1lbWJlRXhwcmVzc2lvbk5vQ2FsbChwYXJzZXIsIGNvbnRleHQsIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgICAgICAgICAgdHlwZTogJ1RhZ2dlZFRlbXBsYXRlRXhwcmVzc2lvbicsDQogICAgICAgICAgICAgICAgdGFnOiBleHByLA0KICAgICAgICAgICAgICAgIHF1YXNpOiBwYXJzZXIudG9rZW4gPT09IDY3MTc0NDA4DQogICAgICAgICAgICAgICAgICAgID8gcGFyc2VUZW1wbGF0ZShwYXJzZXIsIGNvbnRleHQgfCA2NTUzNikNCiAgICAgICAgICAgICAgICAgICAgOiBwYXJzZVRlbXBsYXRlTGl0ZXJhbChwYXJzZXIsIGNvbnRleHQsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpDQogICAgICAgICAgICB9KSwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGV4cHI7DQp9DQpmdW5jdGlvbiBwYXJzZU5ld0V4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBpbkdyb3VwLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgY29uc3QgaWQgPSBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDApOw0KICAgIGNvbnN0IHsgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyB9ID0gcGFyc2VyOw0KICAgIGlmIChjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCwgNjcxMDg4NzcpKSB7DQogICAgICAgIGlmIChjb250ZXh0ICYgNjcxMDg4NjQgJiYgcGFyc2VyLnRva2VuID09PSAxNDM0OTQpIHsNCiAgICAgICAgICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICAgICAgICAgIHJldHVybiBwYXJzZU1ldGFQcm9wZXJ0eShwYXJzZXIsIGNvbnRleHQsIGlkLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgfQ0KICAgICAgICByZXBvcnQocGFyc2VyLCA5Mik7DQogICAgfQ0KICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICBpZiAoKHBhcnNlci50b2tlbiAmIDE2ODQyNzUyKSA9PT0gMTY4NDI3NTIpIHsNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgNjMsIEtleXdvcmREZXNjVGFibGVbcGFyc2VyLnRva2VuICYgMjU1XSk7DQogICAgfQ0KICAgIGNvbnN0IGV4cHIgPSBwYXJzZVByaW1hcnlFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMiwgMSwgMCwgMCwgaW5Hcm91cCwgMSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgY29udGV4dCA9IChjb250ZXh0IHwgMTM0MjE3NzI4KSBeIDEzNDIxNzcyODsNCiAgICBpZiAocGFyc2VyLnRva2VuID09PSA2NzEwODk5MSkNCiAgICAgICAgcmVwb3J0KHBhcnNlciwgMTYzKTsNCiAgICBjb25zdCBjYWxsZWUgPSBwYXJzZU1lbWJlRXhwcmVzc2lvbk5vQ2FsbChwYXJzZXIsIGNvbnRleHQsIGV4cHIsIGluR3JvdXAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ05ld0V4cHJlc3Npb24nLA0KICAgICAgICBjYWxsZWUsDQogICAgICAgIGFyZ3VtZW50czogcGFyc2VyLnRva2VuID09PSA2NzE3NDQxMSA/IHBhcnNlQXJndW1lbnRzKHBhcnNlciwgY29udGV4dCwgaW5Hcm91cCkgOiBbXQ0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VNZXRhUHJvcGVydHkocGFyc2VyLCBjb250ZXh0LCBtZXRhLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgY29uc3QgcHJvcGVydHkgPSBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ01ldGFQcm9wZXJ0eScsDQogICAgICAgIG1ldGEsDQogICAgICAgIHByb3BlcnR5DQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUFzeW5jQXJyb3dBZnRlcklkZW50KHBhcnNlciwgY29udGV4dCwgY2FuQXNzaWduLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMjA5MDA4KQ0KICAgICAgICByZXBvcnQocGFyc2VyLCAyOSk7DQogICAgaWYgKGNvbnRleHQgJiAoMTAyNCB8IDIwOTcxNTIpICYmIHBhcnNlci50b2tlbiA9PT0gMjQxNzczKSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDMwKTsNCiAgICB9DQogICAgaWYgKChwYXJzZXIudG9rZW4gJiA1MzcwNzk4MDgpID09PSA1MzcwNzk4MDgpIHsNCiAgICAgICAgcGFyc2VyLmZsYWdzIHw9IDUxMjsNCiAgICB9DQogICAgcmV0dXJuIHBhcnNlQXJyb3dGcm9tSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIHBhcnNlci50b2tlblZhbHVlLCBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKSwgMCwgY2FuQXNzaWduLCAxLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCn0NCmZ1bmN0aW9uIHBhcnNlQXN5bmNBcnJvd09yQ2FsbEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBjYWxsZWUsIGNhbkFzc2lnbiwga2luZCwgb3JpZ2luLCBmbGFncywgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgY29uc3Qgc2NvcGUgPSBjb250ZXh0ICYgNjQgPyBhZGRDaGlsZFNjb3BlKGNyZWF0ZVNjb3BlKCksIDEwMjQpIDogdm9pZCAwOw0KICAgIGNvbnRleHQgPSAoY29udGV4dCB8IDEzNDIxNzcyOCkgXiAxMzQyMTc3Mjg7DQogICAgaWYgKGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0LCAxNikpIHsNCiAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTApIHsNCiAgICAgICAgICAgIGlmIChmbGFncyAmIDEpDQogICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgNDYpOw0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlUGFyZW50aGVzaXplZEFycm93KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIFtdLCBjYW5Bc3NpZ24sIDEsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICAgICAgdHlwZTogJ0NhbGxFeHByZXNzaW9uJywNCiAgICAgICAgICAgIGNhbGxlZSwNCiAgICAgICAgICAgIGFyZ3VtZW50czogW10NCiAgICAgICAgfSk7DQogICAgfQ0KICAgIGxldCBkZXN0cnVjdGlibGUgPSAwOw0KICAgIGxldCBleHByID0gbnVsbDsNCiAgICBsZXQgaXNTaW1wbGVQYXJhbWV0ZXJMaXN0ID0gMDsNCiAgICBwYXJzZXIuZGVzdHJ1Y3RpYmxlID0NCiAgICAgICAgKHBhcnNlci5kZXN0cnVjdGlibGUgfCAyNTYgfCAxMjgpIF4NCiAgICAgICAgICAgICgyNTYgfCAxMjgpOw0KICAgIGNvbnN0IHBhcmFtcyA9IFtdOw0KICAgIHdoaWxlIChwYXJzZXIudG9rZW4gIT09IDE2KSB7DQogICAgICAgIGNvbnN0IHsgdG9rZW4sIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MgfSA9IHBhcnNlcjsNCiAgICAgICAgaWYgKHRva2VuICYgKDE0MzM2MCB8IDQwOTYpKSB7DQogICAgICAgICAgICBpZiAoc2NvcGUpDQogICAgICAgICAgICAgICAgYWRkQmxvY2tOYW1lKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIHBhcnNlci50b2tlblZhbHVlLCBraW5kLCAwKTsNCiAgICAgICAgICAgIGV4cHIgPSBwYXJzZVByaW1hcnlFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwga2luZCwgMCwgMSwgMCwgMSwgMSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxNiB8fCBwYXJzZXIudG9rZW4gPT09IDE4KSB7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlci5hc3NpZ25hYmxlICYgMikgew0KICAgICAgICAgICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gMTY7DQogICAgICAgICAgICAgICAgICAgIGlzU2ltcGxlUGFyYW1ldGVyTGlzdCA9IDE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKCh0b2tlbiAmIDUzNzA3OTgwOCkgPT09IDUzNzA3OTgwOCkgew0KICAgICAgICAgICAgICAgICAgICBwYXJzZXIuZmxhZ3MgfD0gNTEyOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmICgodG9rZW4gJiAzNjg2NCkgPT09IDM2ODY0KSB7DQogICAgICAgICAgICAgICAgICAgIHBhcnNlci5mbGFncyB8PSAyNTY7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTA3NzkzNjE1Nykgew0KICAgICAgICAgICAgICAgICAgICBpc1NpbXBsZVBhcmFtZXRlckxpc3QgPSAxOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBleHByID0gcGFyc2VNZW1iZXJPclVwZGF0ZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBleHByLCAxLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICE9PSAxNiAmJiBwYXJzZXIudG9rZW4gIT09IDE4KSB7DQogICAgICAgICAgICAgICAgICAgIGV4cHIgPSBwYXJzZUFzc2lnbm1lbnRFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgZXhwcik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKHRva2VuICYgMjA5NzE1Mikgew0KICAgICAgICAgICAgZXhwciA9DQogICAgICAgICAgICAgICAgdG9rZW4gPT09IDIxNjI3MDANCiAgICAgICAgICAgICAgICAgICAgPyBwYXJzZU9iamVjdExpdGVyYWxPclBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgMCwgMSwgMCwga2luZCwgb3JpZ2luLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKQ0KICAgICAgICAgICAgICAgICAgICA6IHBhcnNlQXJyYXlFeHByZXNzaW9uT3JQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDAsIDEsIDAsIGtpbmQsIG9yaWdpbiwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gcGFyc2VyLmRlc3RydWN0aWJsZTsNCiAgICAgICAgICAgIGlzU2ltcGxlUGFyYW1ldGVyTGlzdCA9IDE7DQogICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICE9PSAxNiAmJiBwYXJzZXIudG9rZW4gIT09IDE4KSB7DQogICAgICAgICAgICAgICAgaWYgKGRlc3RydWN0aWJsZSAmIDgpDQogICAgICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDExOSk7DQogICAgICAgICAgICAgICAgZXhwciA9IHBhcnNlTWVtYmVyT3JVcGRhdGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgZXhwciwgMCwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IDE2Ow0KICAgICAgICAgICAgICAgIGlmICgocGFyc2VyLnRva2VuICYgODQ1NDE0NCkgPT09IDg0NTQxNDQpIHsNCiAgICAgICAgICAgICAgICAgICAgZXhwciA9IHBhcnNlQmluYXJ5RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDEsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIDQsIHRva2VuLCBleHByKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDIyKSkgew0KICAgICAgICAgICAgICAgICAgICBleHByID0gcGFyc2VDb25kaXRpb25hbEV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBleHByLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAodG9rZW4gPT09IDE0KSB7DQogICAgICAgICAgICBleHByID0gcGFyc2VTcHJlYWRPclJlc3RFbGVtZW50KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIDE2LCBraW5kLCBvcmlnaW4sIDEsIDEsIDAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlIHw9IChwYXJzZXIudG9rZW4gPT09IDE2ID8gMCA6IDE2KSB8IHBhcnNlci5kZXN0cnVjdGlibGU7DQogICAgICAgICAgICBpc1NpbXBsZVBhcmFtZXRlckxpc3QgPSAxOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgZXhwciA9IHBhcnNlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDEsIDAsIDAsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgZGVzdHJ1Y3RpYmxlID0gcGFyc2VyLmFzc2lnbmFibGU7DQogICAgICAgICAgICBwYXJhbXMucHVzaChleHByKTsNCiAgICAgICAgICAgIHdoaWxlIChjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAxOCkpIHsNCiAgICAgICAgICAgICAgICBwYXJhbXMucHVzaChwYXJzZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAwLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBkZXN0cnVjdGlibGUgfD0gcGFyc2VyLmFzc2lnbmFibGU7DQogICAgICAgICAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgMTYpOw0KICAgICAgICAgICAgcGFyc2VyLmRlc3RydWN0aWJsZSA9IGRlc3RydWN0aWJsZSB8IDE2Ow0KICAgICAgICAgICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgICAgICAgICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgICAgICAgICAgdHlwZTogJ0NhbGxFeHByZXNzaW9uJywNCiAgICAgICAgICAgICAgICBjYWxsZWUsDQogICAgICAgICAgICAgICAgYXJndW1lbnRzOiBwYXJhbXMNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIHBhcmFtcy5wdXNoKGV4cHIpOw0KICAgICAgICBpZiAoIWNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDE4KSkNCiAgICAgICAgICAgIGJyZWFrOw0KICAgIH0NCiAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgMTYpOw0KICAgIGRlc3RydWN0aWJsZSB8PQ0KICAgICAgICBwYXJzZXIuZGVzdHJ1Y3RpYmxlICYgMjU2DQogICAgICAgICAgICA/IDI1Ng0KICAgICAgICAgICAgOiAwIHwgKHBhcnNlci5kZXN0cnVjdGlibGUgJiAxMjgpDQogICAgICAgICAgICAgICAgPyAxMjgNCiAgICAgICAgICAgICAgICA6IDA7DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTApIHsNCiAgICAgICAgaWYgKGRlc3RydWN0aWJsZSAmICgzMiB8IDE2KSkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDI1KTsNCiAgICAgICAgaWYgKHBhcnNlci5mbGFncyAmIDEgfHwgZmxhZ3MgJiAxKQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgNDYpOw0KICAgICAgICBpZiAoZGVzdHJ1Y3RpYmxlICYgMTI4KQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMjkpOw0KICAgICAgICBpZiAoY29udGV4dCAmICgxMDI0IHwgMjA5NzE1MikgJiYgZGVzdHJ1Y3RpYmxlICYgMjU2KQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMzApOw0KICAgICAgICBpZiAoaXNTaW1wbGVQYXJhbWV0ZXJMaXN0KQ0KICAgICAgICAgICAgcGFyc2VyLmZsYWdzIHw9IDEyODsNCiAgICAgICAgcmV0dXJuIHBhcnNlUGFyZW50aGVzaXplZEFycm93KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIHBhcmFtcywgY2FuQXNzaWduLCAxLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICB9DQogICAgZWxzZSBpZiAoZGVzdHJ1Y3RpYmxlICYgOCkgew0KICAgICAgICByZXBvcnQocGFyc2VyLCA2MCk7DQogICAgfQ0KICAgIHBhcnNlci5hc3NpZ25hYmxlID0gMjsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0NhbGxFeHByZXNzaW9uJywNCiAgICAgICAgY2FsbGVlLA0KICAgICAgICBhcmd1bWVudHM6IHBhcmFtcw0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VSZWdFeHBMaXRlcmFsKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnN0IHsgdG9rZW5SYXcsIHRva2VuUmVnRXhwLCB0b2tlblZhbHVlIH0gPSBwYXJzZXI7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgcGFyc2VyLmFzc2lnbmFibGUgPSAyOw0KICAgIHJldHVybiBjb250ZXh0ICYgNTEyDQogICAgICAgID8gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgICAgIHR5cGU6ICdMaXRlcmFsJywNCiAgICAgICAgICAgIHZhbHVlOiB0b2tlblZhbHVlLA0KICAgICAgICAgICAgcmVnZXg6IHRva2VuUmVnRXhwLA0KICAgICAgICAgICAgcmF3OiB0b2tlblJhdw0KICAgICAgICB9KQ0KICAgICAgICA6IGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgICAgICB0eXBlOiAnTGl0ZXJhbCcsDQogICAgICAgICAgICB2YWx1ZTogdG9rZW5WYWx1ZSwNCiAgICAgICAgICAgIHJlZ2V4OiB0b2tlblJlZ0V4cA0KICAgICAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlQ2xhc3NEZWNsYXJhdGlvbihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBmbGFncywgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnRleHQgPSAoY29udGV4dCB8IDE2Nzc3MjE2IHwgMTAyNCkgXiAxNjc3NzIxNjsNCiAgICBsZXQgZGVjb3JhdG9ycyA9IHBhcnNlRGVjb3JhdG9ycyhwYXJzZXIsIGNvbnRleHQpOw0KICAgIGlmIChkZWNvcmF0b3JzLmxlbmd0aCkgew0KICAgICAgICBzdGFydCA9IHBhcnNlci50b2tlblBvczsNCiAgICAgICAgbGluZSA9IHBhcnNlci5saW5lUG9zOw0KICAgICAgICBjb2x1bW4gPSBwYXJzZXIuY29sUG9zOw0KICAgIH0NCiAgICBpZiAocGFyc2VyLmxlYWRpbmdEZWNvcmF0b3JzLmxlbmd0aCkgew0KICAgICAgICBwYXJzZXIubGVhZGluZ0RlY29yYXRvcnMucHVzaCguLi5kZWNvcmF0b3JzKTsNCiAgICAgICAgZGVjb3JhdG9ycyA9IHBhcnNlci5sZWFkaW5nRGVjb3JhdG9yczsNCiAgICAgICAgcGFyc2VyLmxlYWRpbmdEZWNvcmF0b3JzID0gW107DQogICAgfQ0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIGxldCBpZCA9IG51bGw7DQogICAgbGV0IHN1cGVyQ2xhc3MgPSBudWxsOw0KICAgIGNvbnN0IHsgdG9rZW5WYWx1ZSB9ID0gcGFyc2VyOw0KICAgIGlmIChwYXJzZXIudG9rZW4gJiA0MDk2ICYmIHBhcnNlci50b2tlbiAhPT0gMjA1NjcpIHsNCiAgICAgICAgaWYgKGlzU3RyaWN0UmVzZXJ2ZWRXb3JkKHBhcnNlciwgY29udGV4dCwgcGFyc2VyLnRva2VuKSkgew0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTE1KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoKHBhcnNlci50b2tlbiAmIDUzNzA3OTgwOCkgPT09IDUzNzA3OTgwOCkgew0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTE2KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoc2NvcGUpIHsNCiAgICAgICAgICAgIGFkZEJsb2NrTmFtZShwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCB0b2tlblZhbHVlLCAzMiwgMCk7DQogICAgICAgICAgICBpZiAoZmxhZ3MpIHsNCiAgICAgICAgICAgICAgICBpZiAoZmxhZ3MgJiAyKSB7DQogICAgICAgICAgICAgICAgICAgIGRlY2xhcmVVbmJvdW5kVmFyaWFibGUocGFyc2VyLCB0b2tlblZhbHVlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWQgPSBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGlmICgoZmxhZ3MgJiAxKSA9PT0gMCkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDM3LCAnQ2xhc3MnKTsNCiAgICB9DQogICAgbGV0IGluaGVyaXRlZENvbnRleHQgPSBjb250ZXh0Ow0KICAgIGlmIChjb25zdW1lT3B0KHBhcnNlciwgY29udGV4dCB8IDMyNzY4LCAyMDU2NykpIHsNCiAgICAgICAgc3VwZXJDbGFzcyA9IHBhcnNlTGVmdEhhbmRTaWRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDAsIDAsIDAsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgICAgICBpbmhlcml0ZWRDb250ZXh0IHw9IDUyNDI4ODsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGluaGVyaXRlZENvbnRleHQgPSAoaW5oZXJpdGVkQ29udGV4dCB8IDUyNDI4OCkgXiA1MjQyODg7DQogICAgfQ0KICAgIGNvbnN0IGJvZHkgPSBwYXJzZUNsYXNzQm9keShwYXJzZXIsIGluaGVyaXRlZENvbnRleHQsIGNvbnRleHQsIHNjb3BlLCAyLCA4LCAwKTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIGNvbnRleHQgJiAxDQogICAgICAgID8gew0KICAgICAgICAgICAgdHlwZTogJ0NsYXNzRGVjbGFyYXRpb24nLA0KICAgICAgICAgICAgaWQsDQogICAgICAgICAgICBzdXBlckNsYXNzLA0KICAgICAgICAgICAgZGVjb3JhdG9ycywNCiAgICAgICAgICAgIGJvZHkNCiAgICAgICAgfQ0KICAgICAgICA6IHsNCiAgICAgICAgICAgIHR5cGU6ICdDbGFzc0RlY2xhcmF0aW9uJywNCiAgICAgICAgICAgIGlkLA0KICAgICAgICAgICAgc3VwZXJDbGFzcywNCiAgICAgICAgICAgIGJvZHkNCiAgICAgICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUNsYXNzRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGluR3JvdXAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBsZXQgaWQgPSBudWxsOw0KICAgIGxldCBzdXBlckNsYXNzID0gbnVsbDsNCiAgICBjb250ZXh0ID0gKGNvbnRleHQgfCAxMDI0IHwgMTY3NzcyMTYpIF4gMTY3NzcyMTY7DQogICAgY29uc3QgZGVjb3JhdG9ycyA9IHBhcnNlRGVjb3JhdG9ycyhwYXJzZXIsIGNvbnRleHQpOw0KICAgIGlmIChkZWNvcmF0b3JzLmxlbmd0aCkgew0KICAgICAgICBzdGFydCA9IHBhcnNlci50b2tlblBvczsNCiAgICAgICAgbGluZSA9IHBhcnNlci5saW5lUG9zOw0KICAgICAgICBjb2x1bW4gPSBwYXJzZXIuY29sUG9zOw0KICAgIH0NCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICBpZiAocGFyc2VyLnRva2VuICYgNDA5NiAmJiBwYXJzZXIudG9rZW4gIT09IDIwNTY3KSB7DQogICAgICAgIGlmIChpc1N0cmljdFJlc2VydmVkV29yZChwYXJzZXIsIGNvbnRleHQsIHBhcnNlci50b2tlbikpDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMTUpOw0KICAgICAgICBpZiAoKHBhcnNlci50b2tlbiAmIDUzNzA3OTgwOCkgPT09IDUzNzA3OTgwOCkgew0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTE2KTsNCiAgICAgICAgfQ0KICAgICAgICBpZCA9IHBhcnNlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDApOw0KICAgIH0NCiAgICBsZXQgaW5oZXJpdGVkQ29udGV4dCA9IGNvbnRleHQ7DQogICAgaWYgKGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgsIDIwNTY3KSkgew0KICAgICAgICBzdXBlckNsYXNzID0gcGFyc2VMZWZ0SGFuZFNpZGVFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMCwgaW5Hcm91cCwgMCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgICAgIGluaGVyaXRlZENvbnRleHQgfD0gNTI0Mjg4Ow0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgaW5oZXJpdGVkQ29udGV4dCA9IChpbmhlcml0ZWRDb250ZXh0IHwgNTI0Mjg4KSBeIDUyNDI4ODsNCiAgICB9DQogICAgY29uc3QgYm9keSA9IHBhcnNlQ2xhc3NCb2R5KHBhcnNlciwgaW5oZXJpdGVkQ29udGV4dCwgY29udGV4dCwgdm9pZCAwLCAyLCAwLCBpbkdyb3VwKTsNCiAgICBwYXJzZXIuYXNzaWduYWJsZSA9IDI7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCBjb250ZXh0ICYgMQ0KICAgICAgICA/IHsNCiAgICAgICAgICAgIHR5cGU6ICdDbGFzc0V4cHJlc3Npb24nLA0KICAgICAgICAgICAgaWQsDQogICAgICAgICAgICBzdXBlckNsYXNzLA0KICAgICAgICAgICAgZGVjb3JhdG9ycywNCiAgICAgICAgICAgIGJvZHkNCiAgICAgICAgfQ0KICAgICAgICA6IHsNCiAgICAgICAgICAgIHR5cGU6ICdDbGFzc0V4cHJlc3Npb24nLA0KICAgICAgICAgICAgaWQsDQogICAgICAgICAgICBzdXBlckNsYXNzLA0KICAgICAgICAgICAgYm9keQ0KICAgICAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlRGVjb3JhdG9ycyhwYXJzZXIsIGNvbnRleHQpIHsNCiAgICBjb25zdCBsaXN0ID0gW107DQogICAgaWYgKGNvbnRleHQgJiAxKSB7DQogICAgICAgIHdoaWxlIChwYXJzZXIudG9rZW4gPT09IDEzMykgew0KICAgICAgICAgICAgbGlzdC5wdXNoKHBhcnNlRGVjb3JhdG9yTGlzdChwYXJzZXIsIGNvbnRleHQsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gbGlzdDsNCn0NCmZ1bmN0aW9uIHBhcnNlRGVjb3JhdG9yTGlzdChwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0IHwgMzI3NjgpOw0KICAgIGxldCBleHByZXNzaW9uID0gcGFyc2VQcmltYXJ5RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIDIsIDAsIDEsIDAsIDAsIDEsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIGV4cHJlc3Npb24gPSBwYXJzZU1lbWJlck9yVXBkYXRlRXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIGV4cHJlc3Npb24sIDAsIDAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnRGVjb3JhdG9yJywNCiAgICAgICAgZXhwcmVzc2lvbg0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VDbGFzc0JvZHkocGFyc2VyLCBjb250ZXh0LCBpbmhlcml0ZWRDb250ZXh0LCBzY29wZSwga2luZCwgb3JpZ2luLCBpbkdyb3VwKSB7DQogICAgY29uc3QgeyB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCwgMjE2MjcwMCk7DQogICAgY29udGV4dCA9IChjb250ZXh0IHwgMTM0MjE3NzI4KSBeIDEzNDIxNzcyODsNCiAgICBsZXQgaGFzQ29uc3RyID0gcGFyc2VyLmZsYWdzICYgMzI7DQogICAgcGFyc2VyLmZsYWdzID0gKHBhcnNlci5mbGFncyB8IDMyKSBeIDMyOw0KICAgIGNvbnN0IGJvZHkgPSBbXTsNCiAgICBsZXQgZGVjb3JhdG9yczsNCiAgICB3aGlsZSAocGFyc2VyLnRva2VuICE9PSAxMDc0NzkwNDE1KSB7DQogICAgICAgIGxldCBsZW5ndGggPSAwOw0KICAgICAgICBkZWNvcmF0b3JzID0gcGFyc2VEZWNvcmF0b3JzKHBhcnNlciwgY29udGV4dCk7DQogICAgICAgIGxlbmd0aCA9IGRlY29yYXRvcnMubGVuZ3RoOw0KICAgICAgICBpZiAobGVuZ3RoID4gMCAmJiBwYXJzZXIudG9rZW5WYWx1ZSA9PT0gJ2NvbnN0cnVjdG9yJykgew0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTA3KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAocGFyc2VyLnRva2VuID09PSAxMDc0NzkwNDE1KQ0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTA2KTsNCiAgICAgICAgaWYgKGNvbnN1bWVPcHQocGFyc2VyLCBjb250ZXh0LCAxMDc0NzkwNDE3KSkgew0KICAgICAgICAgICAgaWYgKGxlbmd0aCA+IDApDQogICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTE3KTsNCiAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICB9DQogICAgICAgIGJvZHkucHVzaChwYXJzZUNsYXNzRWxlbWVudExpc3QocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgaW5oZXJpdGVkQ29udGV4dCwga2luZCwgZGVjb3JhdG9ycywgMCwgaW5Hcm91cCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcykpOw0KICAgIH0NCiAgICBjb25zdW1lKHBhcnNlciwgb3JpZ2luICYgOCA/IGNvbnRleHQgfCAzMjc2OCA6IGNvbnRleHQsIDEwNzQ3OTA0MTUpOw0KICAgIHBhcnNlci5mbGFncyA9IChwYXJzZXIuZmxhZ3MgJiB+MzIpIHwgaGFzQ29uc3RyOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgew0KICAgICAgICB0eXBlOiAnQ2xhc3NCb2R5JywNCiAgICAgICAgYm9keQ0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VDbGFzc0VsZW1lbnRMaXN0KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGluaGVyaXRlZENvbnRleHQsIHR5cGUsIGRlY29yYXRvcnMsIGlzU3RhdGljLCBpbkdyb3VwLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbGV0IGtpbmQgPSBpc1N0YXRpYyA/IDMyIDogMDsNCiAgICBsZXQga2V5ID0gbnVsbDsNCiAgICBjb25zdCB7IHRva2VuLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgaWYgKHRva2VuICYgKDE0MzM2MCB8IDM2ODY0KSkgew0KICAgICAgICBrZXkgPSBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICAgICAgc3dpdGNoICh0b2tlbikgew0KICAgICAgICAgICAgY2FzZSAzNjk3MjoNCiAgICAgICAgICAgICAgICBpZiAoIWlzU3RhdGljICYmDQogICAgICAgICAgICAgICAgICAgIHBhcnNlci50b2tlbiAhPT0gNjcxNzQ0MTEgJiYNCiAgICAgICAgICAgICAgICAgICAgKHBhcnNlci50b2tlbiAmIDEwNDg1NzYpICE9PSAxMDQ4NTc2ICYmDQogICAgICAgICAgICAgICAgICAgIHBhcnNlci50b2tlbiAhPT0gMTA3NzkzNjE1Nykgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VDbGFzc0VsZW1lbnRMaXN0KHBhcnNlciwgY29udGV4dCwgc2NvcGUsIGluaGVyaXRlZENvbnRleHQsIHR5cGUsIGRlY29yYXRvcnMsIDEsIGluR3JvdXAsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgMjA5MDA3Og0KICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDY3MTc0NDExICYmIChwYXJzZXIuZmxhZ3MgJiAxKSA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoY29udGV4dCAmIDEgJiYgKHBhcnNlci50b2tlbiAmIDEwNzM3NDE4MjQpID09PSAxMDczNzQxODI0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VQcm9wZXJ0eURlZmluaXRpb24ocGFyc2VyLCBjb250ZXh0LCBrZXksIGtpbmQsIGRlY29yYXRvcnMsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGtpbmQgfD0gMTYgfCAob3B0aW9uYWxCaXQocGFyc2VyLCBjb250ZXh0LCA4NDU3MDE0KSA/IDggOiAwKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlIDEyNDAyOg0KICAgICAgICAgICAgICAgIGlmIChwYXJzZXIudG9rZW4gIT09IDY3MTc0NDExKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChjb250ZXh0ICYgMSAmJiAocGFyc2VyLnRva2VuICYgMTA3Mzc0MTgyNCkgPT09IDEwNzM3NDE4MjQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZVByb3BlcnR5RGVmaW5pdGlvbihwYXJzZXIsIGNvbnRleHQsIGtleSwga2luZCwgZGVjb3JhdG9ycywgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAga2luZCB8PSAyNTY7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAxMjQwMzoNCiAgICAgICAgICAgICAgICBpZiAocGFyc2VyLnRva2VuICE9PSA2NzE3NDQxMSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoY29udGV4dCAmIDEgJiYgKHBhcnNlci50b2tlbiAmIDEwNzM3NDE4MjQpID09PSAxMDczNzQxODI0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VQcm9wZXJ0eURlZmluaXRpb24ocGFyc2VyLCBjb250ZXh0LCBrZXksIGtpbmQsIGRlY29yYXRvcnMsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGtpbmQgfD0gNTEyOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBlbHNlIGlmICh0b2tlbiA9PT0gNjkyNzE1NzEpIHsNCiAgICAgICAga2luZCB8PSAyOw0KICAgICAgICBrZXkgPSBwYXJzZUNvbXB1dGVkUHJvcGVydHlOYW1lKHBhcnNlciwgaW5oZXJpdGVkQ29udGV4dCwgaW5Hcm91cCk7DQogICAgfQ0KICAgIGVsc2UgaWYgKCh0b2tlbiAmIDEzNDIxNzcyOCkgPT09IDEzNDIxNzcyOCkgew0KICAgICAgICBrZXkgPSBwYXJzZUxpdGVyYWwocGFyc2VyLCBjb250ZXh0KTsNCiAgICB9DQogICAgZWxzZSBpZiAodG9rZW4gPT09IDg0NTcwMTQpIHsNCiAgICAgICAga2luZCB8PSA4Ow0KICAgICAgICBuZXh0VG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICB9DQogICAgZWxzZSBpZiAoY29udGV4dCAmIDEgJiYgcGFyc2VyLnRva2VuID09PSAxMzEpIHsNCiAgICAgICAga2luZCB8PSA0MDk2Ow0KICAgICAgICBrZXkgPSBwYXJzZVByaXZhdGVJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCB8IDE2Mzg0LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICB9DQogICAgZWxzZSBpZiAoY29udGV4dCAmIDEgJiYgKHBhcnNlci50b2tlbiAmIDEwNzM3NDE4MjQpID09PSAxMDczNzQxODI0KSB7DQogICAgICAgIGtpbmQgfD0gMTI4Ow0KICAgIH0NCiAgICBlbHNlIGlmIChpc1N0YXRpYyAmJiB0b2tlbiA9PT0gMjE2MjcwMCkgew0KICAgICAgICByZXR1cm4gcGFyc2VTdGF0aWNCbG9jayhwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICB9DQogICAgZWxzZSBpZiAodG9rZW4gPT09IDEyMikgew0KICAgICAgICBrZXkgPSBwYXJzZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICAgICAgaWYgKHBhcnNlci50b2tlbiAhPT0gNjcxNzQ0MTEpDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAyOCwgS2V5d29yZERlc2NUYWJsZVtwYXJzZXIudG9rZW4gJiAyNTVdKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDI4LCBLZXl3b3JkRGVzY1RhYmxlW3BhcnNlci50b2tlbiAmIDI1NV0pOw0KICAgIH0NCiAgICBpZiAoa2luZCAmICg4IHwgMTYgfCA3NjgpKSB7DQogICAgICAgIGlmIChwYXJzZXIudG9rZW4gJiAxNDMzNjApIHsNCiAgICAgICAgICAgIGtleSA9IHBhcnNlSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIDApOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKChwYXJzZXIudG9rZW4gJiAxMzQyMTc3MjgpID09PSAxMzQyMTc3MjgpIHsNCiAgICAgICAgICAgIGtleSA9IHBhcnNlTGl0ZXJhbChwYXJzZXIsIGNvbnRleHQpOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYgKHBhcnNlci50b2tlbiA9PT0gNjkyNzE1NzEpIHsNCiAgICAgICAgICAgIGtpbmQgfD0gMjsNCiAgICAgICAgICAgIGtleSA9IHBhcnNlQ29tcHV0ZWRQcm9wZXJ0eU5hbWUocGFyc2VyLCBjb250ZXh0LCAwKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChwYXJzZXIudG9rZW4gPT09IDEyMikgew0KICAgICAgICAgICAga2V5ID0gcGFyc2VJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgMCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoY29udGV4dCAmIDEgJiYgcGFyc2VyLnRva2VuID09PSAxMzEpIHsNCiAgICAgICAgICAgIGtpbmQgfD0gNDA5NjsNCiAgICAgICAgICAgIGtleSA9IHBhcnNlUHJpdmF0ZUlkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMzIpOw0KICAgIH0NCiAgICBpZiAoKGtpbmQgJiAyKSA9PT0gMCkgew0KICAgICAgICBpZiAocGFyc2VyLnRva2VuVmFsdWUgPT09ICdjb25zdHJ1Y3RvcicpIHsNCiAgICAgICAgICAgIGlmICgocGFyc2VyLnRva2VuICYgMTA3Mzc0MTgyNCkgPT09IDEwNzM3NDE4MjQpIHsNCiAgICAgICAgICAgICAgICByZXBvcnQocGFyc2VyLCAxMjYpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSBpZiAoKGtpbmQgJiAzMikgPT09IDAgJiYgcGFyc2VyLnRva2VuID09PSA2NzE3NDQxMSkgew0KICAgICAgICAgICAgICAgIGlmIChraW5kICYgKDc2OCB8IDE2IHwgMTI4IHwgOCkpIHsNCiAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgNTEsICdhY2Nlc3NvcicpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIGlmICgoY29udGV4dCAmIDUyNDI4OCkgPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlci5mbGFncyAmIDMyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgNTIpOw0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZXIuZmxhZ3MgfD0gMzI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAga2luZCB8PSA2NDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmICgoa2luZCAmIDQwOTYpID09PSAwICYmDQogICAgICAgICAgICBraW5kICYgKDMyIHwgNzY4IHwgOCB8IDE2KSAmJg0KICAgICAgICAgICAgcGFyc2VyLnRva2VuVmFsdWUgPT09ICdwcm90b3R5cGUnKSB7DQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCA1MCk7DQogICAgICAgIH0NCiAgICB9DQogICAgaWYgKGNvbnRleHQgJiAxICYmIHBhcnNlci50b2tlbiAhPT0gNjcxNzQ0MTEpIHsNCiAgICAgICAgcmV0dXJuIHBhcnNlUHJvcGVydHlEZWZpbml0aW9uKHBhcnNlciwgY29udGV4dCwga2V5LCBraW5kLCBkZWNvcmF0b3JzLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICB9DQogICAgY29uc3QgdmFsdWUgPSBwYXJzZU1ldGhvZERlZmluaXRpb24ocGFyc2VyLCBjb250ZXh0LCBraW5kLCBpbkdyb3VwLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIGNvbnRleHQgJiAxDQogICAgICAgID8gew0KICAgICAgICAgICAgdHlwZTogJ01ldGhvZERlZmluaXRpb24nLA0KICAgICAgICAgICAga2luZDogKGtpbmQgJiAzMikgPT09IDAgJiYga2luZCAmIDY0DQogICAgICAgICAgICAgICAgPyAnY29uc3RydWN0b3InDQogICAgICAgICAgICAgICAgOiBraW5kICYgMjU2DQogICAgICAgICAgICAgICAgICAgID8gJ2dldCcNCiAgICAgICAgICAgICAgICAgICAgOiBraW5kICYgNTEyDQogICAgICAgICAgICAgICAgICAgICAgICA/ICdzZXQnDQogICAgICAgICAgICAgICAgICAgICAgICA6ICdtZXRob2QnLA0KICAgICAgICAgICAgc3RhdGljOiAoa2luZCAmIDMyKSA+IDAsDQogICAgICAgICAgICBjb21wdXRlZDogKGtpbmQgJiAyKSA+IDAsDQogICAgICAgICAgICBrZXksDQogICAgICAgICAgICBkZWNvcmF0b3JzLA0KICAgICAgICAgICAgdmFsdWUNCiAgICAgICAgfQ0KICAgICAgICA6IHsNCiAgICAgICAgICAgIHR5cGU6ICdNZXRob2REZWZpbml0aW9uJywNCiAgICAgICAgICAgIGtpbmQ6IChraW5kICYgMzIpID09PSAwICYmIGtpbmQgJiA2NA0KICAgICAgICAgICAgICAgID8gJ2NvbnN0cnVjdG9yJw0KICAgICAgICAgICAgICAgIDoga2luZCAmIDI1Ng0KICAgICAgICAgICAgICAgICAgICA/ICdnZXQnDQogICAgICAgICAgICAgICAgICAgIDoga2luZCAmIDUxMg0KICAgICAgICAgICAgICAgICAgICAgICAgPyAnc2V0Jw0KICAgICAgICAgICAgICAgICAgICAgICAgOiAnbWV0aG9kJywNCiAgICAgICAgICAgIHN0YXRpYzogKGtpbmQgJiAzMikgPiAwLA0KICAgICAgICAgICAgY29tcHV0ZWQ6IChraW5kICYgMikgPiAwLA0KICAgICAgICAgICAga2V5LA0KICAgICAgICAgICAgdmFsdWUNCiAgICAgICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZVByaXZhdGVJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIGNvbnN0IHsgdG9rZW5WYWx1ZSB9ID0gcGFyc2VyOw0KICAgIGlmICh0b2tlblZhbHVlID09PSAnY29uc3RydWN0b3InKQ0KICAgICAgICByZXBvcnQocGFyc2VyLCAxMjUpOw0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnUHJpdmF0ZUlkZW50aWZpZXInLA0KICAgICAgICBuYW1lOiB0b2tlblZhbHVlDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZVByb3BlcnR5RGVmaW5pdGlvbihwYXJzZXIsIGNvbnRleHQsIGtleSwgc3RhdGUsIGRlY29yYXRvcnMsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBsZXQgdmFsdWUgPSBudWxsOw0KICAgIGlmIChzdGF0ZSAmIDgpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDApOw0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDEwNzc5MzYxNTcpIHsNCiAgICAgICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCB8IDMyNzY4KTsNCiAgICAgICAgY29uc3QgeyB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDUzNzA3OTkyOCkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDExNik7DQogICAgICAgIHZhbHVlID0gcGFyc2VQcmltYXJ5RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQgfCAxNjM4NCwgMiwgMCwgMSwgMCwgMCwgMSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgIGlmICgocGFyc2VyLnRva2VuICYgMTA3Mzc0MTgyNCkgIT09IDEwNzM3NDE4MjQpIHsNCiAgICAgICAgICAgIHZhbHVlID0gcGFyc2VNZW1iZXJPclVwZGF0ZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0IHwgMTYzODQsIHZhbHVlLCAwLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICAgICAgICAgIHZhbHVlID0gcGFyc2VBc3NpZ25tZW50RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQgfCAxNjM4NCwgMCwgMCwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcywgdmFsdWUpOw0KICAgICAgICAgICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTgpIHsNCiAgICAgICAgICAgICAgICB2YWx1ZSA9IHBhcnNlU2VxdWVuY2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgdmFsdWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnUHJvcGVydHlEZWZpbml0aW9uJywNCiAgICAgICAga2V5LA0KICAgICAgICB2YWx1ZSwNCiAgICAgICAgc3RhdGljOiAoc3RhdGUgJiAzMikgPiAwLA0KICAgICAgICBjb21wdXRlZDogKHN0YXRlICYgMikgPiAwLA0KICAgICAgICBkZWNvcmF0b3JzDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUJpbmRpbmdQYXR0ZXJuKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIHR5cGUsIG9yaWdpbiwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGlmIChwYXJzZXIudG9rZW4gJiAxNDMzNjApDQogICAgICAgIHJldHVybiBwYXJzZUFuZENsYXNzaWZ5SWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCB0eXBlLCBvcmlnaW4sIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIGlmICgocGFyc2VyLnRva2VuICYgMjA5NzE1MikgIT09IDIwOTcxNTIpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDI4LCBLZXl3b3JkRGVzY1RhYmxlW3BhcnNlci50b2tlbiAmIDI1NV0pOw0KICAgIGNvbnN0IGxlZnQgPSBwYXJzZXIudG9rZW4gPT09IDY5MjcxNTcxDQogICAgICAgID8gcGFyc2VBcnJheUV4cHJlc3Npb25PclBhdHRlcm4ocGFyc2VyLCBjb250ZXh0LCBzY29wZSwgMSwgMCwgMSwgdHlwZSwgb3JpZ2luLCBzdGFydCwgbGluZSwgY29sdW1uKQ0KICAgICAgICA6IHBhcnNlT2JqZWN0TGl0ZXJhbE9yUGF0dGVybihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCAxLCAwLCAxLCB0eXBlLCBvcmlnaW4sIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIGlmIChwYXJzZXIuZGVzdHJ1Y3RpYmxlICYgMTYpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDQ4KTsNCiAgICBpZiAocGFyc2VyLmRlc3RydWN0aWJsZSAmIDMyKQ0KICAgICAgICByZXBvcnQocGFyc2VyLCA0OCk7DQogICAgcmV0dXJuIGxlZnQ7DQp9DQpmdW5jdGlvbiBwYXJzZUFuZENsYXNzaWZ5SWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIHNjb3BlLCBraW5kLCBvcmlnaW4sIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBjb25zdCB7IHRva2VuVmFsdWUsIHRva2VuIH0gPSBwYXJzZXI7DQogICAgaWYgKGNvbnRleHQgJiAxMDI0KSB7DQogICAgICAgIGlmICgodG9rZW4gJiA1MzcwNzk4MDgpID09PSA1MzcwNzk4MDgpIHsNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDExNik7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoKHRva2VuICYgMzY4NjQpID09PSAzNjg2NCkgew0KICAgICAgICAgICAgcmVwb3J0KHBhcnNlciwgMTE1KTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBpZiAoKHRva2VuICYgMjA0ODApID09PSAyMDQ4MCkgew0KICAgICAgICByZXBvcnQocGFyc2VyLCAxMDApOw0KICAgIH0NCiAgICBpZiAoY29udGV4dCAmICgyMDQ4IHwgMjA5NzE1MikgJiYgdG9rZW4gPT09IDI0MTc3Mykgew0KICAgICAgICByZXBvcnQocGFyc2VyLCAzMCk7DQogICAgfQ0KICAgIGlmICh0b2tlbiA9PT0gMjQxNzM5KSB7DQogICAgICAgIGlmIChraW5kICYgKDggfCAxNikpDQogICAgICAgICAgICByZXBvcnQocGFyc2VyLCA5OCk7DQogICAgfQ0KICAgIGlmIChjb250ZXh0ICYgKDQxOTQzMDQgfCAyMDQ4KSAmJiB0b2tlbiA9PT0gMjA5MDA4KSB7DQogICAgICAgIHJlcG9ydChwYXJzZXIsIDk2KTsNCiAgICB9DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgaWYgKHNjb3BlKQ0KICAgICAgICBhZGRWYXJPckJsb2NrKHBhcnNlciwgY29udGV4dCwgc2NvcGUsIHRva2VuVmFsdWUsIGtpbmQsIG9yaWdpbik7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdJZGVudGlmaWVyJywNCiAgICAgICAgbmFtZTogdG9rZW5WYWx1ZQ0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VKU1hSb290RWxlbWVudE9yRnJhZ21lbnQocGFyc2VyLCBjb250ZXh0LCBpbkpTWENoaWxkLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gODQ1NjI1OSkgew0KICAgICAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgICAgIHR5cGU6ICdKU1hGcmFnbWVudCcsDQogICAgICAgICAgICBvcGVuaW5nRnJhZ21lbnQ6IHBhcnNlT3BlbmluZ0ZyYWdtZW50KHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiksDQogICAgICAgICAgICBjaGlsZHJlbjogcGFyc2VKU1hDaGlsZHJlbihwYXJzZXIsIGNvbnRleHQpLA0KICAgICAgICAgICAgY2xvc2luZ0ZyYWdtZW50OiBwYXJzZUpTWENsb3NpbmdGcmFnbWVudChwYXJzZXIsIGNvbnRleHQsIGluSlNYQ2hpbGQsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpDQogICAgICAgIH0pOw0KICAgIH0NCiAgICBsZXQgY2xvc2luZ0VsZW1lbnQgPSBudWxsOw0KICAgIGxldCBjaGlsZHJlbiA9IFtdOw0KICAgIGNvbnN0IG9wZW5pbmdFbGVtZW50ID0gcGFyc2VKU1hPcGVuaW5nRnJhZ21lbnRPclNlbGZDbG9zZUVsZW1lbnQocGFyc2VyLCBjb250ZXh0LCBpbkpTWENoaWxkLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICBpZiAoIW9wZW5pbmdFbGVtZW50LnNlbGZDbG9zaW5nKSB7DQogICAgICAgIGNoaWxkcmVuID0gcGFyc2VKU1hDaGlsZHJlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgICAgICBjbG9zaW5nRWxlbWVudCA9IHBhcnNlSlNYQ2xvc2luZ0VsZW1lbnQocGFyc2VyLCBjb250ZXh0LCBpbkpTWENoaWxkLCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICAgICAgY29uc3QgY2xvc2UgPSBpc0VxdWFsVGFnTmFtZShjbG9zaW5nRWxlbWVudC5uYW1lKTsNCiAgICAgICAgaWYgKGlzRXF1YWxUYWdOYW1lKG9wZW5pbmdFbGVtZW50Lm5hbWUpICE9PSBjbG9zZSkNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDE1MCwgY2xvc2UpOw0KICAgIH0NCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0pTWEVsZW1lbnQnLA0KICAgICAgICBjaGlsZHJlbiwNCiAgICAgICAgb3BlbmluZ0VsZW1lbnQsDQogICAgICAgIGNsb3NpbmdFbGVtZW50DQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZU9wZW5pbmdGcmFnbWVudChwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBzY2FuSlNYVG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0pTWE9wZW5pbmdGcmFnbWVudCcNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlSlNYQ2xvc2luZ0VsZW1lbnQocGFyc2VyLCBjb250ZXh0LCBpbkpTWENoaWxkLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDI1KTsNCiAgICBjb25zdCBuYW1lID0gcGFyc2VKU1hFbGVtZW50TmFtZShwYXJzZXIsIGNvbnRleHQsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgIGlmIChpbkpTWENoaWxkKSB7DQogICAgICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCA4NDU2MjU5KTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIHBhcnNlci50b2tlbiA9IHNjYW5KU1hUb2tlbihwYXJzZXIsIGNvbnRleHQpOw0KICAgIH0NCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0pTWENsb3NpbmdFbGVtZW50JywNCiAgICAgICAgbmFtZQ0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VKU1hDbG9zaW5nRnJhZ21lbnQocGFyc2VyLCBjb250ZXh0LCBpbkpTWENoaWxkLCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDI1KTsNCiAgICBpZiAoaW5KU1hDaGlsZCkgew0KICAgICAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgODQ1NjI1OSk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgODQ1NjI1OSk7DQogICAgfQ0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnSlNYQ2xvc2luZ0ZyYWdtZW50Jw0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VKU1hDaGlsZHJlbihwYXJzZXIsIGNvbnRleHQpIHsNCiAgICBjb25zdCBjaGlsZHJlbiA9IFtdOw0KICAgIHdoaWxlIChwYXJzZXIudG9rZW4gIT09IDI1KSB7DQogICAgICAgIHBhcnNlci5pbmRleCA9IHBhcnNlci50b2tlblBvcyA9IHBhcnNlci5zdGFydFBvczsNCiAgICAgICAgcGFyc2VyLmNvbHVtbiA9IHBhcnNlci5jb2xQb3MgPSBwYXJzZXIuc3RhcnRDb2x1bW47DQogICAgICAgIHBhcnNlci5saW5lID0gcGFyc2VyLmxpbmVQb3MgPSBwYXJzZXIuc3RhcnRMaW5lOw0KICAgICAgICBzY2FuSlNYVG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICAgICAgY2hpbGRyZW4ucHVzaChwYXJzZUpTWENoaWxkKHBhcnNlciwgY29udGV4dCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcykpOw0KICAgIH0NCiAgICByZXR1cm4gY2hpbGRyZW47DQp9DQpmdW5jdGlvbiBwYXJzZUpTWENoaWxkKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDEzOCkNCiAgICAgICAgcmV0dXJuIHBhcnNlSlNYVGV4dChwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDIxNjI3MDApDQogICAgICAgIHJldHVybiBwYXJzZUpTWEV4cHJlc3Npb25Db250YWluZXIocGFyc2VyLCBjb250ZXh0LCAwLCAwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICBpZiAocGFyc2VyLnRva2VuID09PSA4NDU2MjU4KQ0KICAgICAgICByZXR1cm4gcGFyc2VKU1hSb290RWxlbWVudE9yRnJhZ21lbnQocGFyc2VyLCBjb250ZXh0LCAwLCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICByZXBvcnQocGFyc2VyLCAwKTsNCn0NCmZ1bmN0aW9uIHBhcnNlSlNYVGV4dChwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBzY2FuSlNYVG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICBjb25zdCBub2RlID0gew0KICAgICAgICB0eXBlOiAnSlNYVGV4dCcsDQogICAgICAgIHZhbHVlOiBwYXJzZXIudG9rZW5WYWx1ZQ0KICAgIH07DQogICAgaWYgKGNvbnRleHQgJiA1MTIpIHsNCiAgICAgICAgbm9kZS5yYXcgPSBwYXJzZXIudG9rZW5SYXc7DQogICAgfQ0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgbm9kZSk7DQp9DQpmdW5jdGlvbiBwYXJzZUpTWE9wZW5pbmdGcmFnbWVudE9yU2VsZkNsb3NlRWxlbWVudChwYXJzZXIsIGNvbnRleHQsIGluSlNYQ2hpbGQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBpZiAoKHBhcnNlci50b2tlbiAmIDE0MzM2MCkgIT09IDE0MzM2MCAmJiAocGFyc2VyLnRva2VuICYgNDA5NikgIT09IDQwOTYpDQogICAgICAgIHJlcG9ydChwYXJzZXIsIDApOw0KICAgIGNvbnN0IHRhZ05hbWUgPSBwYXJzZUpTWEVsZW1lbnROYW1lKHBhcnNlciwgY29udGV4dCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgY29uc3QgYXR0cmlidXRlcyA9IHBhcnNlSlNYQXR0cmlidXRlcyhwYXJzZXIsIGNvbnRleHQpOw0KICAgIGNvbnN0IHNlbGZDbG9zaW5nID0gcGFyc2VyLnRva2VuID09PSA4NDU3MDE2Ow0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDg0NTYyNTkpIHsNCiAgICAgICAgc2NhbkpTWFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgODQ1NzAxNik7DQogICAgICAgIGlmIChpbkpTWENoaWxkKSB7DQogICAgICAgICAgICBjb25zdW1lKHBhcnNlciwgY29udGV4dCwgODQ1NjI1OSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBzY2FuSlNYVG9rZW4ocGFyc2VyLCBjb250ZXh0KTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0pTWE9wZW5pbmdFbGVtZW50JywNCiAgICAgICAgbmFtZTogdGFnTmFtZSwNCiAgICAgICAgYXR0cmlidXRlcywNCiAgICAgICAgc2VsZkNsb3NpbmcNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlSlNYRWxlbWVudE5hbWUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgc2NhbkpTWElkZW50aWZpZXIocGFyc2VyKTsNCiAgICBsZXQga2V5ID0gcGFyc2VKU1hJZGVudGlmaWVyKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMjEpDQogICAgICAgIHJldHVybiBwYXJzZUpTWE5hbWVzcGFjZWROYW1lKHBhcnNlciwgY29udGV4dCwga2V5LCBzdGFydCwgbGluZSwgY29sdW1uKTsNCiAgICB3aGlsZSAoY29uc3VtZU9wdChwYXJzZXIsIGNvbnRleHQsIDY3MTA4ODc3KSkgew0KICAgICAgICBzY2FuSlNYSWRlbnRpZmllcihwYXJzZXIpOw0KICAgICAgICBrZXkgPSBwYXJzZUpTWE1lbWJlckV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCBrZXksIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIH0NCiAgICByZXR1cm4ga2V5Ow0KfQ0KZnVuY3Rpb24gcGFyc2VKU1hNZW1iZXJFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgb2JqZWN0LCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgY29uc3QgcHJvcGVydHkgPSBwYXJzZUpTWElkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKTsNCiAgICByZXR1cm4gZmluaXNoTm9kZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4sIHsNCiAgICAgICAgdHlwZTogJ0pTWE1lbWJlckV4cHJlc3Npb24nLA0KICAgICAgICBvYmplY3QsDQogICAgICAgIHByb3BlcnR5DQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUpTWEF0dHJpYnV0ZXMocGFyc2VyLCBjb250ZXh0KSB7DQogICAgY29uc3QgYXR0cmlidXRlcyA9IFtdOw0KICAgIHdoaWxlIChwYXJzZXIudG9rZW4gIT09IDg0NTcwMTYgJiYgcGFyc2VyLnRva2VuICE9PSA4NDU2MjU5ICYmIHBhcnNlci50b2tlbiAhPT0gMTA0ODU3Nikgew0KICAgICAgICBhdHRyaWJ1dGVzLnB1c2gocGFyc2VKc3hBdHRyaWJ1dGUocGFyc2VyLCBjb250ZXh0LCBwYXJzZXIudG9rZW5Qb3MsIHBhcnNlci5saW5lUG9zLCBwYXJzZXIuY29sUG9zKSk7DQogICAgfQ0KICAgIHJldHVybiBhdHRyaWJ1dGVzOw0KfQ0KZnVuY3Rpb24gcGFyc2VKU1hTcHJlYWRBdHRyaWJ1dGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDE0KTsNCiAgICBjb25zdCBleHByZXNzaW9uID0gcGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMCwgMCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDEwNzQ3OTA0MTUpOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnSlNYU3ByZWFkQXR0cmlidXRlJywNCiAgICAgICAgYXJndW1lbnQ6IGV4cHJlc3Npb24NCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlSnN4QXR0cmlidXRlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDIxNjI3MDApDQogICAgICAgIHJldHVybiBwYXJzZUpTWFNwcmVhZEF0dHJpYnV0ZShwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIHNjYW5KU1hJZGVudGlmaWVyKHBhcnNlcik7DQogICAgbGV0IHZhbHVlID0gbnVsbDsNCiAgICBsZXQgbmFtZSA9IHBhcnNlSlNYSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pOw0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDIxKSB7DQogICAgICAgIG5hbWUgPSBwYXJzZUpTWE5hbWVzcGFjZWROYW1lKHBhcnNlciwgY29udGV4dCwgbmFtZSwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgfQ0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDEwNzc5MzYxNTcpIHsNCiAgICAgICAgY29uc3QgdG9rZW4gPSBzY2FuSlNYQXR0cmlidXRlVmFsdWUocGFyc2VyLCBjb250ZXh0KTsNCiAgICAgICAgY29uc3QgeyB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgICAgIHN3aXRjaCAodG9rZW4pIHsNCiAgICAgICAgICAgIGNhc2UgMTM0MjgzMjY3Og0KICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VMaXRlcmFsKHBhcnNlciwgY29udGV4dCk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlIDg0NTYyNTg6DQogICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZUpTWFJvb3RFbGVtZW50T3JGcmFnbWVudChwYXJzZXIsIGNvbnRleHQsIDEsIHRva2VuUG9zLCBsaW5lUG9zLCBjb2xQb3MpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAyMTYyNzAwOg0KICAgICAgICAgICAgICAgIHZhbHVlID0gcGFyc2VKU1hFeHByZXNzaW9uQ29udGFpbmVyKHBhcnNlciwgY29udGV4dCwgMSwgMSwgdG9rZW5Qb3MsIGxpbmVQb3MsIGNvbFBvcyk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDE0OSk7DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdKU1hBdHRyaWJ1dGUnLA0KICAgICAgICB2YWx1ZSwNCiAgICAgICAgbmFtZQ0KICAgIH0pOw0KfQ0KZnVuY3Rpb24gcGFyc2VKU1hOYW1lc3BhY2VkTmFtZShwYXJzZXIsIGNvbnRleHQsIG5hbWVzcGFjZSwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIGNvbnN1bWUocGFyc2VyLCBjb250ZXh0LCAyMSk7DQogICAgY29uc3QgbmFtZSA9IHBhcnNlSlNYSWRlbnRpZmllcihwYXJzZXIsIGNvbnRleHQsIHBhcnNlci50b2tlblBvcywgcGFyc2VyLmxpbmVQb3MsIHBhcnNlci5jb2xQb3MpOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnSlNYTmFtZXNwYWNlZE5hbWUnLA0KICAgICAgICBuYW1lc3BhY2UsDQogICAgICAgIG5hbWUNCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlSlNYRXhwcmVzc2lvbkNvbnRhaW5lcihwYXJzZXIsIGNvbnRleHQsIGluSlNYQ2hpbGQsIGlzQXR0ciwgc3RhcnQsIGxpbmUsIGNvbHVtbikgew0KICAgIG5leHRUb2tlbihwYXJzZXIsIGNvbnRleHQgfCAzMjc2OCk7DQogICAgY29uc3QgeyB0b2tlblBvcywgbGluZVBvcywgY29sUG9zIH0gPSBwYXJzZXI7DQogICAgaWYgKHBhcnNlci50b2tlbiA9PT0gMTQpDQogICAgICAgIHJldHVybiBwYXJzZUpTWFNwcmVhZENoaWxkKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbik7DQogICAgbGV0IGV4cHJlc3Npb24gPSBudWxsOw0KICAgIGlmIChwYXJzZXIudG9rZW4gPT09IDEwNzQ3OTA0MTUpIHsNCiAgICAgICAgaWYgKGlzQXR0cikNCiAgICAgICAgICAgIHJlcG9ydChwYXJzZXIsIDE1Mik7DQogICAgICAgIGV4cHJlc3Npb24gPSBwYXJzZUpTWEVtcHR5RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIHBhcnNlci5zdGFydFBvcywgcGFyc2VyLnN0YXJ0TGluZSwgcGFyc2VyLnN0YXJ0Q29sdW1uKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGV4cHJlc3Npb24gPSBwYXJzZUV4cHJlc3Npb24ocGFyc2VyLCBjb250ZXh0LCAxLCAwLCAwLCB0b2tlblBvcywgbGluZVBvcywgY29sUG9zKTsNCiAgICB9DQogICAgaWYgKGluSlNYQ2hpbGQpIHsNCiAgICAgICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDEwNzQ3OTA0MTUpOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgICAgc2NhbkpTWFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgfQ0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnSlNYRXhwcmVzc2lvbkNvbnRhaW5lcicsDQogICAgICAgIGV4cHJlc3Npb24NCiAgICB9KTsNCn0NCmZ1bmN0aW9uIHBhcnNlSlNYU3ByZWFkQ2hpbGQocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDE0KTsNCiAgICBjb25zdCBleHByZXNzaW9uID0gcGFyc2VFeHByZXNzaW9uKHBhcnNlciwgY29udGV4dCwgMSwgMCwgMCwgcGFyc2VyLnRva2VuUG9zLCBwYXJzZXIubGluZVBvcywgcGFyc2VyLmNvbFBvcyk7DQogICAgY29uc3VtZShwYXJzZXIsIGNvbnRleHQsIDEwNzQ3OTA0MTUpOw0KICAgIHJldHVybiBmaW5pc2hOb2RlKHBhcnNlciwgY29udGV4dCwgc3RhcnQsIGxpbmUsIGNvbHVtbiwgew0KICAgICAgICB0eXBlOiAnSlNYU3ByZWFkQ2hpbGQnLA0KICAgICAgICBleHByZXNzaW9uDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUpTWEVtcHR5RXhwcmVzc2lvbihwYXJzZXIsIGNvbnRleHQsIHN0YXJ0LCBsaW5lLCBjb2x1bW4pIHsNCiAgICBwYXJzZXIuc3RhcnRQb3MgPSBwYXJzZXIudG9rZW5Qb3M7DQogICAgcGFyc2VyLnN0YXJ0TGluZSA9IHBhcnNlci5saW5lUG9zOw0KICAgIHBhcnNlci5zdGFydENvbHVtbiA9IHBhcnNlci5jb2xQb3M7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdKU1hFbXB0eUV4cHJlc3Npb24nDQogICAgfSk7DQp9DQpmdW5jdGlvbiBwYXJzZUpTWElkZW50aWZpZXIocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uKSB7DQogICAgY29uc3QgeyB0b2tlblZhbHVlIH0gPSBwYXJzZXI7DQogICAgbmV4dFRva2VuKHBhcnNlciwgY29udGV4dCk7DQogICAgcmV0dXJuIGZpbmlzaE5vZGUocGFyc2VyLCBjb250ZXh0LCBzdGFydCwgbGluZSwgY29sdW1uLCB7DQogICAgICAgIHR5cGU6ICdKU1hJZGVudGlmaWVyJywNCiAgICAgICAgbmFtZTogdG9rZW5WYWx1ZQ0KICAgIH0pOw0KfQpmdW5jdGlvbiBwYXJzZVNjcmlwdChzb3VyY2UsIG9wdGlvbnMpIHsNCiAgICByZXR1cm4gcGFyc2VTb3VyY2Uoc291cmNlLCBvcHRpb25zLCAwKTsNCn0KCmNvbnN0IHN5bWJvbE5vUmVzdWx0ID0gU3ltYm9sKCJzeW1ib2xOb1Jlc3VsdCIpOwpjb25zdCBzeW1ib2xSZXN1bHQgPSBTeW1ib2woInN5bWJvbFJlc3VsdCIpOwpmdW5jdGlvbiByZXN1bHQobm9kZSkgewogIG5vZGVbc3ltYm9sUmVzdWx0XSA9IHRydWU7CiAgcmV0dXJuIG5vZGU7Cn0KY2xhc3MgQWNvcm5Db250ZXh0IHsKICBub2RlOwogIHBhcmVudDsKICBwYXJlbnRLZXk7CiAgYXR0YWNoZWQ7CiAgcm9vdDsKICBzdGFjazsKICBlbnRyaWVzOwogIGNvbnN0cnVjdG9yKG5vZGUsIHBhcmVudCwgcGFyZW50S2V5LCBzdGFjaywgcm9vdCA9IGZhbHNlKSB7CiAgICB0aGlzLm5vZGUgPSBub2RlOwogICAgdGhpcy5zdGFjayA9IHN0YWNrOwogICAgdGhpcy5lbnRyaWVzID0gW107CiAgICBpZiAocGFyZW50KSB7CiAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50OwogICAgICB0aGlzLnBhcmVudEtleSA9IHBhcmVudEtleTsKICAgICAgdGhpcy5hdHRhY2hlZCA9IHRydWU7CiAgICB9IGVsc2UgaWYgKCFyb290KSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIk5ldyBwYXJlbnQgaXNudCBhbiBpbnN0YW5jZSBvZiBBY29ybkNvbnRleHQuIik7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmF0dGFjaGVkID0gZmFsc2U7CiAgICB9CiAgICB0aGlzLnJvb3QgPSByb290OwogIH0KICAvLyBvbmx5IHVzZWQgYnkgYXJyYXkoKSBhbmQgaW5kZXgoKQogIGdldCBwYXJlbnRPYmplY3QoKSB7CiAgICBpZiAoIXRoaXMucGFyZW50IHx8ICF0aGlzLnBhcmVudEtleSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIHBhcmVudCIpOwogICAgfQogICAgcmV0dXJuIHRoaXMucGFyZW50Lm5vZGVbdGhpcy5wYXJlbnRLZXldOwogIH0KICBnZXQgcGFyZW50SW5kZXgoKSB7CiAgICBpZiAoISh0aGlzLnBhcmVudE9iamVjdCBpbnN0YW5jZW9mIEFycmF5KSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vdCBhbiBhcnJheSIpOwogICAgfQogICAgcmV0dXJuIHRoaXMucGFyZW50T2JqZWN0LmluZGV4T2YodGhpcy5ub2RlKTsKICB9CiAgZGV0YWNoKCkgewogICAgaWYgKHRoaXMucm9vdCkgewogICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQ2Fubm90IGRldGFjaCB0aGUgcm9vdC4iKTsKICAgIH0gZWxzZSBpZiAoIXRoaXMuYXR0YWNoZWQpIHsKICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkNhbm5vdCBkZXRhY2ggYSBkZXRhY2hlZCBub2RlLiIpOwogICAgfQogICAgaWYgKHRoaXMucGFyZW50T2JqZWN0IGluc3RhbmNlb2YgQXJyYXkpIHsKICAgICAgY29uc3QgcGxhY2UgPSB0aGlzLnBhcmVudE9iamVjdC5pbmRleE9mKHRoaXMubm9kZSk7CiAgICAgIGlmIChwbGFjZSA9PT0gLTEpCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB0aGlzLnBhcmVudE9iamVjdC5zcGxpY2UocGxhY2UsIDEpOwogICAgfSBlbHNlIHsKICAgICAgZGVsZXRlIHRoaXMucGFyZW50Lm5vZGVbdGhpcy5wYXJlbnRLZXldOwogICAgfQogICAgdGhpcy5hdHRhY2hlZCA9IGZhbHNlOwogICAgcmV0dXJuIHRydWU7CiAgfQogIC8vIHN1Y2Nlc3MgPSBuZXcgQWNvcm5Db250ZXh0LCBmYWlsdXJlID0gZmFsc2UKICByZXBsYWNlV2l0aChub2RlKSB7CiAgICBpZiAodGhpcy5yb290KSB7CiAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJDYW5ub3QgcmVwbGFjZSB0aGUgcm9vdC4iKTsKICAgIH0gZWxzZSBpZiAoIXRoaXMuYXR0YWNoZWQpIHsKICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkNhbm5vdCByZXBsYWNlIGEgZGV0YWNoZWQgbm9kZS4iKTsKICAgIH0KICAgIGlmICh0aGlzLnBhcmVudE9iamVjdCBpbnN0YW5jZW9mIEFycmF5KSB7CiAgICAgIGNvbnN0IHBsYWNlID0gdGhpcy5wYXJlbnRPYmplY3QuaW5kZXhPZih0aGlzLm5vZGUpOwogICAgICBpZiAocGxhY2UgPT09IC0xKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHRoaXMucGFyZW50T2JqZWN0LnNwbGljZShwbGFjZSwgMSwgbm9kZSk7CiAgICB9IGVsc2UgewogICAgICBkZWxldGUgdGhpcy5wYXJlbnQubm9kZVt0aGlzLnBhcmVudEtleV07CiAgICAgIHRoaXMucGFyZW50Lm5vZGVbdGhpcy5wYXJlbnRLZXldID0gbm9kZTsKICAgIH0KICAgIHRoaXMuYXR0YWNoZWQgPSBmYWxzZTsKICAgIGNvbnN0IGNyZWF0ZWQgPSBuZXcgQWNvcm5Db250ZXh0KAogICAgICBub2RlLAogICAgICB0aGlzLnBhcmVudCwKICAgICAgdGhpcy5wYXJlbnRLZXksCiAgICAgIHRoaXMuc3RhY2sKICAgICk7CiAgICBkZWxldGUgdGhpcy5wYXJlbnQ7CiAgICB0aGlzLnJlbW92ZURlc2NlbmRhbnRzRnJvbVN0YWNrKCk7CiAgICBjcmVhdGVkLm5vZGVbc3ltYm9sTm9SZXN1bHRdID0gdHJ1ZTsKICAgIHRoaXMuc3RhY2sucHVzaChjcmVhdGVkKTsKICAgIGNyZWF0ZWQuYWRkRW50cmllc1RvU3RhY2soKTsKICAgIGZvciAoY29uc3QgY3R4IG9mIG5ldyBBY29ybkl0ZXJhdG9yKGNyZWF0ZWQubm9kZSkpIHsKICAgICAgaWYgKGN0eC5ub2RlW3N5bWJvbFJlc3VsdF0pIHsKICAgICAgICBkZWxldGUgY3R4Lm5vZGVbc3ltYm9sUmVzdWx0XTsKICAgICAgICBjdHgucmVtb3ZlRGVzY2VuZGFudHNGcm9tU3RhY2soKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjdHgubm9kZVtzeW1ib2xOb1Jlc3VsdF0gPSB0cnVlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gY3JlYXRlZDsKICB9CiAgYWRkRW50cmllc1RvU3RhY2soKSB7CiAgICBjb25zdCBlbnRyaWVzID0gW107CiAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzLm5vZGUpIHsKICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLm5vZGVba2V5XTsKICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gIm9iamVjdCIgfHwgdmFsdWUgPT09IG51bGwpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkgewogICAgICAgIGZvciAoY29uc3Qgc3Ygb2YgdmFsdWUpIHsKICAgICAgICAgIGlmICh0eXBlb2Ygc3YgIT09ICJvYmplY3QiIHx8IHN2ID09PSBudWxsKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHR5cGVvZiBzdi50eXBlID09PSAic3RyaW5nIikgewogICAgICAgICAgICBlbnRyaWVzLnB1c2goW2tleSwgc3ZdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlLnR5cGUgPT09ICJzdHJpbmciKSB7CiAgICAgICAgZW50cmllcy5wdXNoKFtrZXksIHZhbHVlXSk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy5zdGFjay5sZW5ndGggLSAxOwogICAgbGV0IGxlbmd0aCA9IGVudHJpZXMubGVuZ3RoOwogICAgZm9yIChjb25zdCBba2V5LCBub2RlXSBvZiBlbnRyaWVzKSB7CiAgICAgIGNvbnN0IGN0eCA9IG5ldyBBY29ybkNvbnRleHQobm9kZSwgdGhpcywga2V5LCB0aGlzLnN0YWNrKTsKICAgICAgdGhpcy5zdGFja1tzdGFydCArIGxlbmd0aC0tXSA9IGN0eDsKICAgICAgdGhpcy5lbnRyaWVzLnB1c2goY3R4KTsKICAgIH0KICB9CiAgcmVtb3ZlRGVzY2VuZGFudHNGcm9tU3RhY2soKSB7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZW50cmllcy5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCBlbnRyeSA9IHRoaXMuZW50cmllc1tpXTsKICAgICAgY29uc3Qgc3RhY2tJID0gdGhpcy5zdGFjay5pbmRleE9mKGVudHJ5KTsKICAgICAgaWYgKHN0YWNrSSAhPT0gLTEpIHsKICAgICAgICB0aGlzLnN0YWNrLnNwbGljZShzdGFja0ksIDEpOwogICAgICB9CiAgICAgIGVudHJ5LnJlbW92ZURlc2NlbmRhbnRzRnJvbVN0YWNrKCk7CiAgICB9CiAgfQp9CmNsYXNzIEFjb3JuSXRlcmF0b3IgewogIHN0YWNrOwogIGNvbnN0cnVjdG9yKGFzdCkgewogICAgdGhpcy5zdGFjayA9IFtdOwogICAgdGhpcy5zdGFjay5wdXNoKAogICAgICBuZXcgQWNvcm5Db250ZXh0KGFzdCwgdm9pZCAwLCB2b2lkIDAsIHRoaXMuc3RhY2ssIHRydWUpCiAgICApOwogIH0KICBuZXh0KCkgewogICAgd2hpbGUgKHRydWUpIHsKICAgICAgY29uc3QgY29udGV4dCA9IHRoaXMuc3RhY2sucG9wKCk7CiAgICAgIGlmIChjb250ZXh0ID09PSB2b2lkIDApIHsKICAgICAgICByZXR1cm4geyB2YWx1ZTogdm9pZCAwLCBkb25lOiB0cnVlIH07CiAgICAgIH0KICAgICAgY29udGV4dC5hZGRFbnRyaWVzVG9TdGFjaygpOwogICAgICBpZiAoY29udGV4dC5ub2RlW3N5bWJvbE5vUmVzdWx0XSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHJldHVybiB7IHZhbHVlOiBjb250ZXh0LCBkb25lOiBmYWxzZSB9OwogICAgfQogIH0KICBbU3ltYm9sLml0ZXJhdG9yXSgpIHsKICAgIHJldHVybiB0aGlzOwogIH0KfQoKdmFyIG1haW4kMSA9IHt9OwoKY29uc3QgcmVxdWlyZSQkMCA9IC8qQF9fUFVSRV9fKi9nZXRBdWdtZW50ZWROYW1lc3BhY2UodHNsaWJfZXM2JDEpOwoKdmFyIGZvcmskMSA9IHtleHBvcnRzOiB7fX07Cgp2YXIgdHlwZXMgPSB7fTsKCnZhciBoYXNSZXF1aXJlZFR5cGVzOwoKZnVuY3Rpb24gcmVxdWlyZVR5cGVzICgpIHsKCWlmIChoYXNSZXF1aXJlZFR5cGVzKSByZXR1cm4gdHlwZXM7CgloYXNSZXF1aXJlZFR5cGVzID0gMTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0eXBlcywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdHlwZXMuRGVmID0gdm9pZCAwOwoJdmFyIHRzbGliXzEgPSByZXF1aXJlJCQwOwoJdmFyIE9wID0gT2JqZWN0LnByb3RvdHlwZTsKCXZhciBvYmpUb1N0ciA9IE9wLnRvU3RyaW5nOwoJdmFyIGhhc093biA9IE9wLmhhc093blByb3BlcnR5OwoJdmFyIEJhc2VUeXBlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEJhc2VUeXBlKCkgewoJICAgIH0KCSAgICBCYXNlVHlwZS5wcm90b3R5cGUuYXNzZXJ0ID0gZnVuY3Rpb24gKHZhbHVlLCBkZWVwKSB7CgkgICAgICAgIGlmICghdGhpcy5jaGVjayh2YWx1ZSwgZGVlcCkpIHsKCSAgICAgICAgICAgIHZhciBzdHIgPSBzaGFsbG93U3RyaW5naWZ5KHZhbHVlKTsKCSAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihzdHIgKyAiIGRvZXMgbm90IG1hdGNoIHR5cGUgIiArIHRoaXMpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0cnVlOwoJICAgIH07CgkgICAgQmFzZVR5cGUucHJvdG90eXBlLmFycmF5T2YgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBlbGVtVHlwZSA9IHRoaXM7CgkgICAgICAgIHJldHVybiBuZXcgQXJyYXlUeXBlKGVsZW1UeXBlKTsKCSAgICB9OwoJICAgIHJldHVybiBCYXNlVHlwZTsKCX0oKSk7Cgl2YXIgQXJyYXlUeXBlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIHRzbGliXzEuX19leHRlbmRzKEFycmF5VHlwZSwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBBcnJheVR5cGUoZWxlbVR5cGUpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpczsKCSAgICAgICAgX3RoaXMuZWxlbVR5cGUgPSBlbGVtVHlwZTsKCSAgICAgICAgX3RoaXMua2luZCA9ICJBcnJheVR5cGUiOwoJICAgICAgICByZXR1cm4gX3RoaXM7CgkgICAgfQoJICAgIEFycmF5VHlwZS5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiAiWyIgKyB0aGlzLmVsZW1UeXBlICsgIl0iOwoJICAgIH07CgkgICAgQXJyYXlUeXBlLnByb3RvdHlwZS5jaGVjayA9IGZ1bmN0aW9uICh2YWx1ZSwgZGVlcCkgewoJICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoJICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheSh2YWx1ZSkgJiYgdmFsdWUuZXZlcnkoZnVuY3Rpb24gKGVsZW0pIHsgcmV0dXJuIF90aGlzLmVsZW1UeXBlLmNoZWNrKGVsZW0sIGRlZXApOyB9KTsKCSAgICB9OwoJICAgIHJldHVybiBBcnJheVR5cGU7Cgl9KEJhc2VUeXBlKSk7Cgl2YXIgSWRlbnRpdHlUeXBlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIHRzbGliXzEuX19leHRlbmRzKElkZW50aXR5VHlwZSwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBJZGVudGl0eVR5cGUodmFsdWUpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpczsKCSAgICAgICAgX3RoaXMudmFsdWUgPSB2YWx1ZTsKCSAgICAgICAgX3RoaXMua2luZCA9ICJJZGVudGl0eVR5cGUiOwoJICAgICAgICByZXR1cm4gX3RoaXM7CgkgICAgfQoJICAgIElkZW50aXR5VHlwZS5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBTdHJpbmcodGhpcy52YWx1ZSk7CgkgICAgfTsKCSAgICBJZGVudGl0eVR5cGUucHJvdG90eXBlLmNoZWNrID0gZnVuY3Rpb24gKHZhbHVlLCBkZWVwKSB7CgkgICAgICAgIHZhciByZXN1bHQgPSB2YWx1ZSA9PT0gdGhpcy52YWx1ZTsKCSAgICAgICAgaWYgKCFyZXN1bHQgJiYgdHlwZW9mIGRlZXAgPT09ICJmdW5jdGlvbiIpIHsKCSAgICAgICAgICAgIGRlZXAodGhpcywgdmFsdWUpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCSAgICByZXR1cm4gSWRlbnRpdHlUeXBlOwoJfShCYXNlVHlwZSkpOwoJdmFyIE9iamVjdFR5cGUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgdHNsaWJfMS5fX2V4dGVuZHMoT2JqZWN0VHlwZSwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBPYmplY3RUeXBlKGZpZWxkcykgewoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5maWVsZHMgPSBmaWVsZHM7CgkgICAgICAgIF90aGlzLmtpbmQgPSAiT2JqZWN0VHlwZSI7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgT2JqZWN0VHlwZS5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiAieyAiICsgdGhpcy5maWVsZHMuam9pbigiLCAiKSArICIgfSI7CgkgICAgfTsKCSAgICBPYmplY3RUeXBlLnByb3RvdHlwZS5jaGVjayA9IGZ1bmN0aW9uICh2YWx1ZSwgZGVlcCkgewoJICAgICAgICByZXR1cm4gKG9ialRvU3RyLmNhbGwodmFsdWUpID09PSBvYmpUb1N0ci5jYWxsKHt9KSAmJgoJICAgICAgICAgICAgdGhpcy5maWVsZHMuZXZlcnkoZnVuY3Rpb24gKGZpZWxkKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkLnR5cGUuY2hlY2sodmFsdWVbZmllbGQubmFtZV0sIGRlZXApOwoJICAgICAgICAgICAgfSkpOwoJICAgIH07CgkgICAgcmV0dXJuIE9iamVjdFR5cGU7Cgl9KEJhc2VUeXBlKSk7Cgl2YXIgT3JUeXBlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIHRzbGliXzEuX19leHRlbmRzKE9yVHlwZSwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBPclR5cGUodHlwZXMpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpczsKCSAgICAgICAgX3RoaXMudHlwZXMgPSB0eXBlczsKCSAgICAgICAgX3RoaXMua2luZCA9ICJPclR5cGUiOwoJICAgICAgICByZXR1cm4gX3RoaXM7CgkgICAgfQoJICAgIE9yVHlwZS5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnR5cGVzLmpvaW4oIiB8ICIpOwoJICAgIH07CgkgICAgT3JUeXBlLnByb3RvdHlwZS5jaGVjayA9IGZ1bmN0aW9uICh2YWx1ZSwgZGVlcCkgewoJICAgICAgICByZXR1cm4gdGhpcy50eXBlcy5zb21lKGZ1bmN0aW9uICh0eXBlKSB7CgkgICAgICAgICAgICByZXR1cm4gdHlwZS5jaGVjayh2YWx1ZSwgZGVlcCk7CgkgICAgICAgIH0pOwoJICAgIH07CgkgICAgcmV0dXJuIE9yVHlwZTsKCX0oQmFzZVR5cGUpKTsKCXZhciBQcmVkaWNhdGVUeXBlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIHRzbGliXzEuX19leHRlbmRzKFByZWRpY2F0ZVR5cGUsIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gUHJlZGljYXRlVHlwZShuYW1lLCBwcmVkaWNhdGUpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpczsKCSAgICAgICAgX3RoaXMubmFtZSA9IG5hbWU7CgkgICAgICAgIF90aGlzLnByZWRpY2F0ZSA9IHByZWRpY2F0ZTsKCSAgICAgICAgX3RoaXMua2luZCA9ICJQcmVkaWNhdGVUeXBlIjsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBQcmVkaWNhdGVUeXBlLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMubmFtZTsKCSAgICB9OwoJICAgIFByZWRpY2F0ZVR5cGUucHJvdG90eXBlLmNoZWNrID0gZnVuY3Rpb24gKHZhbHVlLCBkZWVwKSB7CgkgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLnByZWRpY2F0ZSh2YWx1ZSwgZGVlcCk7CgkgICAgICAgIGlmICghcmVzdWx0ICYmIHR5cGVvZiBkZWVwID09PSAiZnVuY3Rpb24iKSB7CgkgICAgICAgICAgICBkZWVwKHRoaXMsIHZhbHVlKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgcmV0dXJuIFByZWRpY2F0ZVR5cGU7Cgl9KEJhc2VUeXBlKSk7Cgl2YXIgRGVmID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIERlZih0eXBlLCB0eXBlTmFtZSkgewoJICAgICAgICB0aGlzLnR5cGUgPSB0eXBlOwoJICAgICAgICB0aGlzLnR5cGVOYW1lID0gdHlwZU5hbWU7CgkgICAgICAgIHRoaXMuYmFzZU5hbWVzID0gW107CgkgICAgICAgIHRoaXMub3duRmllbGRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKCSAgICAgICAgLy8gSW5jbHVkZXMgb3duIHR5cGVOYW1lLiBQb3B1bGF0ZWQgZHVyaW5nIGZpbmFsaXphdGlvbi4KCSAgICAgICAgdGhpcy5hbGxTdXBlcnR5cGVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKCSAgICAgICAgLy8gTGluZWFyIGluaGVyaXRhbmNlIGhpZXJhcmNoeS4gUG9wdWxhdGVkIGR1cmluZyBmaW5hbGl6YXRpb24uCgkgICAgICAgIHRoaXMuc3VwZXJ0eXBlTGlzdCA9IFtdOwoJICAgICAgICAvLyBJbmNsdWRlcyBpbmhlcml0ZWQgZmllbGRzLgoJICAgICAgICB0aGlzLmFsbEZpZWxkcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgkgICAgICAgIC8vIE5vbi1oaWRkZW4ga2V5cyBvZiBhbGxGaWVsZHMuCgkgICAgICAgIHRoaXMuZmllbGROYW1lcyA9IFtdOwoJICAgICAgICAvLyBUaGlzIHByb3BlcnR5IHdpbGwgYmUgb3ZlcnJpZGRlbiBhcyB0cnVlIGJ5IGluZGl2aWR1YWwgRGVmIGluc3RhbmNlcwoJICAgICAgICAvLyB3aGVuIHRoZXkgYXJlIGZpbmFsaXplZC4KCSAgICAgICAgdGhpcy5maW5hbGl6ZWQgPSBmYWxzZTsKCSAgICAgICAgLy8gRmFsc2UgYnkgZGVmYXVsdCB1bnRpbCAuYnVpbGQoLi4uKSBpcyBjYWxsZWQgb24gYW4gaW5zdGFuY2UuCgkgICAgICAgIHRoaXMuYnVpbGRhYmxlID0gZmFsc2U7CgkgICAgICAgIHRoaXMuYnVpbGRQYXJhbXMgPSBbXTsKCSAgICB9CgkgICAgRGVmLnByb3RvdHlwZS5pc1N1cGVydHlwZU9mID0gZnVuY3Rpb24gKHRoYXQpIHsKCSAgICAgICAgaWYgKHRoYXQgaW5zdGFuY2VvZiBEZWYpIHsKCSAgICAgICAgICAgIGlmICh0aGlzLmZpbmFsaXplZCAhPT0gdHJ1ZSB8fAoJICAgICAgICAgICAgICAgIHRoYXQuZmluYWxpemVkICE9PSB0cnVlKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiBoYXNPd24uY2FsbCh0aGF0LmFsbFN1cGVydHlwZXMsIHRoaXMudHlwZU5hbWUpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHRoYXQgKyAiIGlzIG5vdCBhIERlZiIpOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBEZWYucHJvdG90eXBlLmNoZWNrQWxsRmllbGRzID0gZnVuY3Rpb24gKHZhbHVlLCBkZWVwKSB7CgkgICAgICAgIHZhciBhbGxGaWVsZHMgPSB0aGlzLmFsbEZpZWxkczsKCSAgICAgICAgaWYgKHRoaXMuZmluYWxpemVkICE9PSB0cnVlKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIgKyB0aGlzLnR5cGVOYW1lKTsKCSAgICAgICAgfQoJICAgICAgICBmdW5jdGlvbiBjaGVja0ZpZWxkQnlOYW1lKG5hbWUpIHsKCSAgICAgICAgICAgIHZhciBmaWVsZCA9IGFsbEZpZWxkc1tuYW1lXTsKCSAgICAgICAgICAgIHZhciB0eXBlID0gZmllbGQudHlwZTsKCSAgICAgICAgICAgIHZhciBjaGlsZCA9IGZpZWxkLmdldFZhbHVlKHZhbHVlKTsKCSAgICAgICAgICAgIHJldHVybiB0eXBlLmNoZWNrKGNoaWxkLCBkZWVwKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdmFsdWUgIT09IG51bGwgJiYKCSAgICAgICAgICAgIHR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIgJiYKCSAgICAgICAgICAgIE9iamVjdC5rZXlzKGFsbEZpZWxkcykuZXZlcnkoY2hlY2tGaWVsZEJ5TmFtZSk7CgkgICAgfTsKCSAgICBEZWYucHJvdG90eXBlLmJhc2VzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgc3VwZXJ0eXBlTmFtZXMgPSBbXTsKCSAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgICAgICAgIHN1cGVydHlwZU5hbWVzW19pXSA9IGFyZ3VtZW50c1tfaV07CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGJhc2VzID0gdGhpcy5iYXNlTmFtZXM7CgkgICAgICAgIGlmICh0aGlzLmZpbmFsaXplZCkgewoJICAgICAgICAgICAgaWYgKHN1cGVydHlwZU5hbWVzLmxlbmd0aCAhPT0gYmFzZXMubGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3VwZXJ0eXBlTmFtZXMubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgICAgICBpZiAoc3VwZXJ0eXBlTmFtZXNbaV0gIT09IGJhc2VzW2ldKSB7CgkgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgICAgIH0KCSAgICAgICAgc3VwZXJ0eXBlTmFtZXMuZm9yRWFjaChmdW5jdGlvbiAoYmFzZU5hbWUpIHsKCSAgICAgICAgICAgIC8vIFRoaXMgaW5kZXhPZiBsb29rdXAgbWF5IGJlIE8obiksIGJ1dCB0aGUgdHlwaWNhbCBudW1iZXIgb2YgYmFzZQoJICAgICAgICAgICAgLy8gbmFtZXMgaXMgdmVyeSBzbWFsbCwgYW5kIGluZGV4T2YgaXMgYSBuYXRpdmUgQXJyYXkgbWV0aG9kLgoJICAgICAgICAgICAgaWYgKGJhc2VzLmluZGV4T2YoYmFzZU5hbWUpIDwgMCkgewoJICAgICAgICAgICAgICAgIGJhc2VzLnB1c2goYmFzZU5hbWUpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9KTsKCSAgICAgICAgcmV0dXJuIHRoaXM7IC8vIEZvciBjaGFpbmluZy4KCSAgICB9OwoJICAgIHJldHVybiBEZWY7Cgl9KCkpOwoJdHlwZXMuRGVmID0gRGVmOwoJdmFyIEZpZWxkID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEZpZWxkKG5hbWUsIHR5cGUsIGRlZmF1bHRGbiwgaGlkZGVuKSB7CgkgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7CgkgICAgICAgIHRoaXMudHlwZSA9IHR5cGU7CgkgICAgICAgIHRoaXMuZGVmYXVsdEZuID0gZGVmYXVsdEZuOwoJICAgICAgICB0aGlzLmhpZGRlbiA9ICEhaGlkZGVuOwoJICAgIH0KCSAgICBGaWVsZC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzLm5hbWUpICsgIjogIiArIHRoaXMudHlwZTsKCSAgICB9OwoJICAgIEZpZWxkLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uIChvYmopIHsKCSAgICAgICAgdmFyIHZhbHVlID0gb2JqW3RoaXMubmFtZV07CgkgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICJ1bmRlZmluZWQiKSB7CgkgICAgICAgICAgICByZXR1cm4gdmFsdWU7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmRlZmF1bHRGbiA9PT0gImZ1bmN0aW9uIikgewoJICAgICAgICAgICAgdmFsdWUgPSB0aGlzLmRlZmF1bHRGbi5jYWxsKG9iaik7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHZhbHVlOwoJICAgIH07CgkgICAgcmV0dXJuIEZpZWxkOwoJfSgpKTsKCWZ1bmN0aW9uIHNoYWxsb3dTdHJpbmdpZnkodmFsdWUpIHsKCSAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsKCSAgICAgICAgcmV0dXJuICJbIiArIHZhbHVlLm1hcChzaGFsbG93U3RyaW5naWZ5KS5qb2luKCIsICIpICsgIl0iOwoJICAgIH0KCSAgICBpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAib2JqZWN0IikgewoJICAgICAgICByZXR1cm4gInsgIiArIE9iamVjdC5rZXlzKHZhbHVlKS5tYXAoZnVuY3Rpb24gKGtleSkgewoJICAgICAgICAgICAgcmV0dXJuIGtleSArICI6ICIgKyB2YWx1ZVtrZXldOwoJICAgICAgICB9KS5qb2luKCIsICIpICsgIiB9IjsKCSAgICB9CgkgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHZhbHVlKTsKCX0KCWZ1bmN0aW9uIHR5cGVzUGx1Z2luKF9mb3JrKSB7CgkgICAgdmFyIFR5cGUgPSB7CgkgICAgICAgIG9yOiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICB2YXIgdHlwZXMgPSBbXTsKCSAgICAgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7CgkgICAgICAgICAgICAgICAgdHlwZXNbX2ldID0gYXJndW1lbnRzW19pXTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiBuZXcgT3JUeXBlKHR5cGVzLm1hcChmdW5jdGlvbiAodHlwZSkgeyByZXR1cm4gVHlwZS5mcm9tKHR5cGUpOyB9KSk7CgkgICAgICAgIH0sCgkgICAgICAgIGZyb206IGZ1bmN0aW9uICh2YWx1ZSwgbmFtZSkgewoJICAgICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQXJyYXlUeXBlIHx8CgkgICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBJZGVudGl0eVR5cGUgfHwKCSAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIE9iamVjdFR5cGUgfHwKCSAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIE9yVHlwZSB8fAoJICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgUHJlZGljYXRlVHlwZSkgewoJICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIFRoZSBEZWYgdHlwZSBpcyB1c2VkIGFzIGEgaGVscGVyIGZvciBjb25zdHJ1Y3RpbmcgY29tcG91bmQKCSAgICAgICAgICAgIC8vIGludGVyZmFjZSB0eXBlcyBmb3IgQVNUIG5vZGVzLgoJICAgICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgRGVmKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlLnR5cGU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBTdXBwb3J0IFtFbGVtVHlwZV0gc3ludGF4LgoJICAgICAgICAgICAgaWYgKGlzQXJyYXkuY2hlY2sodmFsdWUpKSB7CgkgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCAhPT0gMSkgewoJICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIm9ubHkgb25lIGVsZW1lbnQgdHlwZSBpcyBwZXJtaXR0ZWQgZm9yIHR5cGVkIGFycmF5cyIpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEFycmF5VHlwZShUeXBlLmZyb20odmFsdWVbMF0pKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIFN1cHBvcnQgeyBzb21lRmllbGQ6IEZpZWxkVHlwZSwgLi4uIH0gc3ludGF4LgoJICAgICAgICAgICAgaWYgKGlzT2JqZWN0LmNoZWNrKHZhbHVlKSkgewoJICAgICAgICAgICAgICAgIHJldHVybiBuZXcgT2JqZWN0VHlwZShPYmplY3Qua2V5cyh2YWx1ZSkubWFwKGZ1bmN0aW9uIChuYW1lKSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRmllbGQobmFtZSwgVHlwZS5mcm9tKHZhbHVlW25hbWVdLCBuYW1lKSk7CgkgICAgICAgICAgICAgICAgfSkpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gImZ1bmN0aW9uIikgewoJICAgICAgICAgICAgICAgIHZhciBiaWNmSW5kZXggPSBidWlsdEluQ3RvckZucy5pbmRleE9mKHZhbHVlKTsKCSAgICAgICAgICAgICAgICBpZiAoYmljZkluZGV4ID49IDApIHsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWx0SW5DdG9yVHlwZXNbYmljZkluZGV4XTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBuYW1lICE9PSAic3RyaW5nIikgewoJICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIm1pc3NpbmcgbmFtZSIpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByZWRpY2F0ZVR5cGUobmFtZSwgdmFsdWUpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gQXMgYSBsYXN0IHJlc29ydCwgdG9UeXBlIHJldHVybnMgYSB0eXBlIHRoYXQgbWF0Y2hlcyBhbnkgdmFsdWUgdGhhdAoJICAgICAgICAgICAgLy8gaXMgPT09IGZyb20uIFRoaXMgaXMgcHJpbWFyaWx5IHVzZWZ1bCBmb3IgbGl0ZXJhbCB2YWx1ZXMgbGlrZQoJICAgICAgICAgICAgLy8gdG9UeXBlKG51bGwpLCBidXQgaXQgaGFzIHRoZSBhZGRpdGlvbmFsIGFkdmFudGFnZSBvZiBhbGxvd2luZwoJICAgICAgICAgICAgLy8gdG9UeXBlIHRvIGJlIGEgdG90YWwgZnVuY3Rpb24uCgkgICAgICAgICAgICByZXR1cm4gbmV3IElkZW50aXR5VHlwZSh2YWx1ZSk7CgkgICAgICAgIH0sCgkgICAgICAgIC8vIERlZmluZSBhIHR5cGUgd2hvc2UgbmFtZSBpcyByZWdpc3RlcmVkIGluIGEgbmFtZXNwYWNlICh0aGUgZGVmQ2FjaGUpIHNvCgkgICAgICAgIC8vIHRoYXQgZnV0dXJlIGRlZmluaXRpb25zIHdpbGwgcmV0dXJuIHRoZSBzYW1lIHR5cGUgZ2l2ZW4gdGhlIHNhbWUgbmFtZS4KCSAgICAgICAgLy8gSW4gcGFydGljdWxhciwgdGhpcyBzeXN0ZW0gYWxsb3dzIGZvciBjaXJjdWxhciBhbmQgZm9yd2FyZCBkZWZpbml0aW9ucy4KCSAgICAgICAgLy8gVGhlIERlZiBvYmplY3QgZCByZXR1cm5lZCBmcm9tIFR5cGUuZGVmIG1heSBiZSB1c2VkIHRvIGNvbmZpZ3VyZSB0aGUKCSAgICAgICAgLy8gdHlwZSBkLnR5cGUgYnkgY2FsbGluZyBtZXRob2RzIHN1Y2ggYXMgZC5iYXNlcywgZC5idWlsZCwgYW5kIGQuZmllbGQuCgkgICAgICAgIGRlZjogZnVuY3Rpb24gKHR5cGVOYW1lKSB7CgkgICAgICAgICAgICByZXR1cm4gaGFzT3duLmNhbGwoZGVmQ2FjaGUsIHR5cGVOYW1lKQoJICAgICAgICAgICAgICAgID8gZGVmQ2FjaGVbdHlwZU5hbWVdCgkgICAgICAgICAgICAgICAgOiBkZWZDYWNoZVt0eXBlTmFtZV0gPSBuZXcgRGVmSW1wbCh0eXBlTmFtZSk7CgkgICAgICAgIH0sCgkgICAgICAgIGhhc0RlZjogZnVuY3Rpb24gKHR5cGVOYW1lKSB7CgkgICAgICAgICAgICByZXR1cm4gaGFzT3duLmNhbGwoZGVmQ2FjaGUsIHR5cGVOYW1lKTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdmFyIGJ1aWx0SW5DdG9yRm5zID0gW107CgkgICAgdmFyIGJ1aWx0SW5DdG9yVHlwZXMgPSBbXTsKCSAgICBmdW5jdGlvbiBkZWZCdWlsdEluVHlwZShuYW1lLCBleGFtcGxlKSB7CgkgICAgICAgIHZhciBvYmpTdHIgPSBvYmpUb1N0ci5jYWxsKGV4YW1wbGUpOwoJICAgICAgICB2YXIgdHlwZSA9IG5ldyBQcmVkaWNhdGVUeXBlKG5hbWUsIGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gb2JqVG9TdHIuY2FsbCh2YWx1ZSkgPT09IG9ialN0cjsgfSk7CgkgICAgICAgIGlmIChleGFtcGxlICYmIHR5cGVvZiBleGFtcGxlLmNvbnN0cnVjdG9yID09PSAiZnVuY3Rpb24iKSB7CgkgICAgICAgICAgICBidWlsdEluQ3RvckZucy5wdXNoKGV4YW1wbGUuY29uc3RydWN0b3IpOwoJICAgICAgICAgICAgYnVpbHRJbkN0b3JUeXBlcy5wdXNoKHR5cGUpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0eXBlOwoJICAgIH0KCSAgICAvLyBUaGVzZSB0eXBlcyBjaGVjayB0aGUgdW5kZXJseWluZyBbW0NsYXNzXV0gYXR0cmlidXRlIG9mIHRoZSBnaXZlbgoJICAgIC8vIHZhbHVlLCByYXRoZXIgdGhhbiB1c2luZyB0aGUgcHJvYmxlbWF0aWMgdHlwZW9mIG9wZXJhdG9yLiBOb3RlIGhvd2V2ZXIKCSAgICAvLyB0aGF0IG5vIHN1YnR5cGluZyBpcyBjb25zaWRlcmVkOyBzbywgZm9yIGluc3RhbmNlLCBpc09iamVjdC5jaGVjawoJICAgIC8vIHJldHVybnMgZmFsc2UgZm9yIFtdLCAvLi8sIG5ldyBEYXRlLCBhbmQgbnVsbC4KCSAgICB2YXIgaXNTdHJpbmcgPSBkZWZCdWlsdEluVHlwZSgic3RyaW5nIiwgInRydXRoeSIpOwoJICAgIHZhciBpc0Z1bmN0aW9uID0gZGVmQnVpbHRJblR5cGUoImZ1bmN0aW9uIiwgZnVuY3Rpb24gKCkgeyB9KTsKCSAgICB2YXIgaXNBcnJheSA9IGRlZkJ1aWx0SW5UeXBlKCJhcnJheSIsIFtdKTsKCSAgICB2YXIgaXNPYmplY3QgPSBkZWZCdWlsdEluVHlwZSgib2JqZWN0Iiwge30pOwoJICAgIHZhciBpc1JlZ0V4cCA9IGRlZkJ1aWx0SW5UeXBlKCJSZWdFeHAiLCAvLi8pOwoJICAgIHZhciBpc0RhdGUgPSBkZWZCdWlsdEluVHlwZSgiRGF0ZSIsIG5ldyBEYXRlKCkpOwoJICAgIHZhciBpc051bWJlciA9IGRlZkJ1aWx0SW5UeXBlKCJudW1iZXIiLCAzKTsKCSAgICB2YXIgaXNCb29sZWFuID0gZGVmQnVpbHRJblR5cGUoImJvb2xlYW4iLCB0cnVlKTsKCSAgICB2YXIgaXNOdWxsID0gZGVmQnVpbHRJblR5cGUoIm51bGwiLCBudWxsKTsKCSAgICB2YXIgaXNVbmRlZmluZWQgPSBkZWZCdWlsdEluVHlwZSgidW5kZWZpbmVkIiwgdW5kZWZpbmVkKTsKCSAgICB2YXIgYnVpbHRJblR5cGVzID0gewoJICAgICAgICBzdHJpbmc6IGlzU3RyaW5nLAoJICAgICAgICBmdW5jdGlvbjogaXNGdW5jdGlvbiwKCSAgICAgICAgYXJyYXk6IGlzQXJyYXksCgkgICAgICAgIG9iamVjdDogaXNPYmplY3QsCgkgICAgICAgIFJlZ0V4cDogaXNSZWdFeHAsCgkgICAgICAgIERhdGU6IGlzRGF0ZSwKCSAgICAgICAgbnVtYmVyOiBpc051bWJlciwKCSAgICAgICAgYm9vbGVhbjogaXNCb29sZWFuLAoJICAgICAgICBudWxsOiBpc051bGwsCgkgICAgICAgIHVuZGVmaW5lZDogaXNVbmRlZmluZWQsCgkgICAgfTsKCSAgICAvLyBJbiBvcmRlciB0byByZXR1cm4gdGhlIHNhbWUgRGVmIGluc3RhbmNlIGV2ZXJ5IHRpbWUgVHlwZS5kZWYgaXMgY2FsbGVkCgkgICAgLy8gd2l0aCBhIHBhcnRpY3VsYXIgbmFtZSwgdGhvc2UgaW5zdGFuY2VzIG5lZWQgdG8gYmUgc3RvcmVkIGluIGEgY2FjaGUuCgkgICAgdmFyIGRlZkNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKCSAgICBmdW5jdGlvbiBkZWZGcm9tVmFsdWUodmFsdWUpIHsKCSAgICAgICAgaWYgKHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gIm9iamVjdCIpIHsKCSAgICAgICAgICAgIHZhciB0eXBlID0gdmFsdWUudHlwZTsKCSAgICAgICAgICAgIGlmICh0eXBlb2YgdHlwZSA9PT0gInN0cmluZyIgJiYKCSAgICAgICAgICAgICAgICBoYXNPd24uY2FsbChkZWZDYWNoZSwgdHlwZSkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZCA9IGRlZkNhY2hlW3R5cGVdOwoJICAgICAgICAgICAgICAgIGlmIChkLmZpbmFsaXplZCkgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gZDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG51bGw7CgkgICAgfQoJICAgIHZhciBEZWZJbXBsID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgICAgICB0c2xpYl8xLl9fZXh0ZW5kcyhEZWZJbXBsLCBfc3VwZXIpOwoJICAgICAgICBmdW5jdGlvbiBEZWZJbXBsKHR5cGVOYW1lKSB7CgkgICAgICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBuZXcgUHJlZGljYXRlVHlwZSh0eXBlTmFtZSwgZnVuY3Rpb24gKHZhbHVlLCBkZWVwKSB7IHJldHVybiBfdGhpcy5jaGVjayh2YWx1ZSwgZGVlcCk7IH0pLCB0eXBlTmFtZSkgfHwgdGhpczsKCSAgICAgICAgICAgIHJldHVybiBfdGhpczsKCSAgICAgICAgfQoJICAgICAgICBEZWZJbXBsLnByb3RvdHlwZS5jaGVjayA9IGZ1bmN0aW9uICh2YWx1ZSwgZGVlcCkgewoJICAgICAgICAgICAgaWYgKHRoaXMuZmluYWxpemVkICE9PSB0cnVlKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJwcmVtYXR1cmVseSBjaGVja2luZyB1bmZpbmFsaXplZCB0eXBlICIgKyB0aGlzLnR5cGVOYW1lKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIEEgRGVmIHR5cGUgY2FuIG9ubHkgbWF0Y2ggYW4gb2JqZWN0IHZhbHVlLgoJICAgICAgICAgICAgaWYgKHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSAhPT0gIm9iamVjdCIpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgdkRlZiA9IGRlZkZyb21WYWx1ZSh2YWx1ZSk7CgkgICAgICAgICAgICBpZiAoIXZEZWYpIHsKCSAgICAgICAgICAgICAgICAvLyBJZiB3ZSBjb3VsZG4ndCBpbmZlciB0aGUgRGVmIGFzc29jaWF0ZWQgd2l0aCB0aGUgZ2l2ZW4gdmFsdWUsCgkgICAgICAgICAgICAgICAgLy8gYW5kIHdlIGV4cGVjdGVkIGl0IHRvIGJlIGEgU291cmNlTG9jYXRpb24gb3IgYSBQb3NpdGlvbiwgaXQgd2FzCgkgICAgICAgICAgICAgICAgLy8gcHJvYmFibHkganVzdCBtaXNzaW5nIGEgInR5cGUiIGZpZWxkIChiZWNhdXNlIEVzcHJpbWEgZG9lcyBub3QKCSAgICAgICAgICAgICAgICAvLyBhc3NpZ24gYSB0eXBlIHByb3BlcnR5IHRvIHN1Y2ggbm9kZXMpLiBCZSBvcHRpbWlzdGljIGFuZCBsZXQKCSAgICAgICAgICAgICAgICAvLyB0aGlzLmNoZWNrQWxsRmllbGRzIG1ha2UgdGhlIGZpbmFsIGRlY2lzaW9uLgoJICAgICAgICAgICAgICAgIGlmICh0aGlzLnR5cGVOYW1lID09PSAiU291cmNlTG9jYXRpb24iIHx8CgkgICAgICAgICAgICAgICAgICAgIHRoaXMudHlwZU5hbWUgPT09ICJQb3NpdGlvbiIpIHsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tBbGxGaWVsZHModmFsdWUsIGRlZXApOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAvLyBDYWxsaW5nIHRoaXMuY2hlY2tBbGxGaWVsZHMgZm9yIGFueSBvdGhlciB0eXBlIG9mIG5vZGUgaXMgYm90aAoJICAgICAgICAgICAgICAgIC8vIGJhZCBmb3IgcGVyZm9ybWFuY2UgYW5kIHdheSB0b28gZm9yZ2l2aW5nLgoJICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIElmIGNoZWNraW5nIGRlZXBseSBhbmQgdkRlZiA9PT0gdGhpcywgdGhlbiB3ZSBvbmx5IG5lZWQgdG8gY2FsbAoJICAgICAgICAgICAgLy8gY2hlY2tBbGxGaWVsZHMgb25jZS4gQ2FsbGluZyBjaGVja0FsbEZpZWxkcyBpcyB0b28gc3RyaWN0IHdoZW4gZGVlcAoJICAgICAgICAgICAgLy8gaXMgZmFsc2UsIGJlY2F1c2UgdGhlbiB3ZSBvbmx5IGNhcmUgYWJvdXQgdGhpcy5pc1N1cGVydHlwZU9mKHZEZWYpLgoJICAgICAgICAgICAgaWYgKGRlZXAgJiYgdkRlZiA9PT0gdGhpcykgewoJICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNoZWNrQWxsRmllbGRzKHZhbHVlLCBkZWVwKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIEluIG1vc3QgY2FzZXMgd2UgcmVseSBleGNsdXNpdmVseSBvbiBpc1N1cGVydHlwZU9mIHRvIG1ha2UgTygxKQoJICAgICAgICAgICAgLy8gc3VidHlwaW5nIGRldGVybWluYXRpb25zLiBUaGlzIHN1ZmZpY2VzIGluIG1vc3Qgc2l0dWF0aW9ucyBvdXRzaWRlCgkgICAgICAgICAgICAvLyBvZiB1bml0IHRlc3RzLCBzaW5jZSBpbnRlcmZhY2UgY29uZm9ybWFuY2UgaXMgY2hlY2tlZCB3aGVuZXZlciBuZXcKCSAgICAgICAgICAgIC8vIGluc3RhbmNlcyBhcmUgY3JlYXRlZCB1c2luZyBidWlsZGVyIGZ1bmN0aW9ucy4KCSAgICAgICAgICAgIGlmICghdGhpcy5pc1N1cGVydHlwZU9mKHZEZWYpKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gVGhlIGV4Y2VwdGlvbiBpcyB3aGVuIGRlZXAgaXMgdHJ1ZTsgdGhlbiwgd2UgcmVjdXJzaXZlbHkgY2hlY2sgYWxsCgkgICAgICAgICAgICAvLyBmaWVsZHMuCgkgICAgICAgICAgICBpZiAoIWRlZXApIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIFVzZSB0aGUgbW9yZSBzcGVjaWZpYyBEZWYgKHZEZWYpIHRvIHBlcmZvcm0gdGhlIGRlZXAgY2hlY2ssIGJ1dAoJICAgICAgICAgICAgLy8gc2hhbGxvdy1jaGVjayBmaWVsZHMgZGVmaW5lZCBieSB0aGUgbGVzcyBzcGVjaWZpYyBEZWYgKHRoaXMpLgoJICAgICAgICAgICAgcmV0dXJuIHZEZWYuY2hlY2tBbGxGaWVsZHModmFsdWUsIGRlZXApCgkgICAgICAgICAgICAgICAgJiYgdGhpcy5jaGVja0FsbEZpZWxkcyh2YWx1ZSwgZmFsc2UpOwoJICAgICAgICB9OwoJICAgICAgICBEZWZJbXBsLnByb3RvdHlwZS5idWlsZCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgkgICAgICAgICAgICB2YXIgYnVpbGRQYXJhbXMgPSBbXTsKCSAgICAgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7CgkgICAgICAgICAgICAgICAgYnVpbGRQYXJhbXNbX2ldID0gYXJndW1lbnRzW19pXTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIENhbGxpbmcgRGVmLnByb3RvdHlwZS5idWlsZCBtdWx0aXBsZSB0aW1lcyBoYXMgdGhlIGVmZmVjdCBvZiBtZXJlbHkKCSAgICAgICAgICAgIC8vIHJlZGVmaW5pbmcgdGhpcyBwcm9wZXJ0eS4KCSAgICAgICAgICAgIHRoaXMuYnVpbGRQYXJhbXMgPSBidWlsZFBhcmFtczsKCSAgICAgICAgICAgIGlmICh0aGlzLmJ1aWxkYWJsZSkgewoJICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgRGVmIGlzIGFscmVhZHkgYnVpbGRhYmxlLCB1cGRhdGUgc2VsZi5idWlsZFBhcmFtcyBhbmQKCSAgICAgICAgICAgICAgICAvLyBjb250aW51ZSB1c2luZyB0aGUgb2xkIGJ1aWxkZXIgZnVuY3Rpb24uCgkgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBFdmVyeSBidWlsZGFibGUgdHlwZSB3aWxsIGhhdmUgaXRzICJ0eXBlIiBmaWVsZCBmaWxsZWQgaW4KCSAgICAgICAgICAgIC8vIGF1dG9tYXRpY2FsbHkuIFRoaXMgaW5jbHVkZXMgdHlwZXMgdGhhdCBhcmUgbm90IHN1YnR5cGVzIG9mIE5vZGUsCgkgICAgICAgICAgICAvLyBsaWtlIFNvdXJjZUxvY2F0aW9uLCBidXQgdGhhdCBzZWVtcyBoYXJtbGVzcyAoVE9ETz8pLgoJICAgICAgICAgICAgdGhpcy5maWVsZCgidHlwZSIsIFN0cmluZywgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMudHlwZU5hbWU7IH0pOwoJICAgICAgICAgICAgLy8gT3ZlcnJpZGUgRHAuYnVpbGRhYmxlIGZvciB0aGlzIERlZiBpbnN0YW5jZS4KCSAgICAgICAgICAgIHRoaXMuYnVpbGRhYmxlID0gdHJ1ZTsKCSAgICAgICAgICAgIHZhciBhZGRQYXJhbSA9IGZ1bmN0aW9uIChidWlsdCwgcGFyYW0sIGFyZywgaXNBcmdBdmFpbGFibGUpIHsKCSAgICAgICAgICAgICAgICBpZiAoaGFzT3duLmNhbGwoYnVpbHQsIHBhcmFtKSkKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICAgICAgICAgIHZhciBhbGwgPSBfdGhpcy5hbGxGaWVsZHM7CgkgICAgICAgICAgICAgICAgaWYgKCFoYXNPd24uY2FsbChhbGwsIHBhcmFtKSkgewoJICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIgKyBwYXJhbSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHZhciBmaWVsZCA9IGFsbFtwYXJhbV07CgkgICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBmaWVsZC50eXBlOwoJICAgICAgICAgICAgICAgIHZhciB2YWx1ZTsKCSAgICAgICAgICAgICAgICBpZiAoaXNBcmdBdmFpbGFibGUpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBhcmc7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgaWYgKGZpZWxkLmRlZmF1bHRGbikgewoJICAgICAgICAgICAgICAgICAgICAvLyBFeHBvc2UgdGhlIHBhcnRpYWxseS1idWlsdCBvYmplY3QgdG8gdGhlIGRlZmF1bHQKCSAgICAgICAgICAgICAgICAgICAgLy8gZnVuY3Rpb24gYXMgaXRzIGB0aGlzYCBvYmplY3QuCgkgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gZmllbGQuZGVmYXVsdEZuLmNhbGwoYnVpbHQpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSAibm8gdmFsdWUgb3IgZGVmYXVsdCBmdW5jdGlvbiBnaXZlbiBmb3IgZmllbGQgIiArCgkgICAgICAgICAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeShwYXJhbSkgKyAiIG9mICIgKyBfdGhpcy50eXBlTmFtZSArICIoIiArCgkgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5idWlsZFBhcmFtcy5tYXAoZnVuY3Rpb24gKG5hbWUpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWxsW25hbWVdOwoJICAgICAgICAgICAgICAgICAgICAgICAgfSkuam9pbigiLCAiKSArICIpIjsKCSAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBpZiAoIXR5cGUuY2hlY2sodmFsdWUpKSB7CgkgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihzaGFsbG93U3RyaW5naWZ5KHZhbHVlKSArCgkgICAgICAgICAgICAgICAgICAgICAgICAiIGRvZXMgbm90IG1hdGNoIGZpZWxkICIgKyBmaWVsZCArCgkgICAgICAgICAgICAgICAgICAgICAgICAiIG9mIHR5cGUgIiArIF90aGlzLnR5cGVOYW1lKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgYnVpbHRbcGFyYW1dID0gdmFsdWU7CgkgICAgICAgICAgICB9OwoJICAgICAgICAgICAgLy8gQ2FsbGluZyB0aGUgYnVpbGRlciBmdW5jdGlvbiB3aWxsIGNvbnN0cnVjdCBhbiBpbnN0YW5jZSBvZiB0aGUgRGVmLAoJICAgICAgICAgICAgLy8gd2l0aCBwb3NpdGlvbmFsIGFyZ3VtZW50cyBtYXBwZWQgdG8gdGhlIGZpZWxkcyBvcmlnaW5hbCBwYXNzZWQgdG8gLmJ1aWxkLgoJICAgICAgICAgICAgLy8gSWYgbm90IGVub3VnaCBhcmd1bWVudHMgYXJlIHByb3ZpZGVkLCB0aGUgZGVmYXVsdCB2YWx1ZSBmb3IgdGhlIHJlbWFpbmluZyBmaWVsZHMKCSAgICAgICAgICAgIC8vIHdpbGwgYmUgdXNlZC4KCSAgICAgICAgICAgIHZhciBidWlsZGVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgICAgIHZhciBhcmdzID0gW107CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgICAgICAgICAgICAgICAgYXJnc1tfaV0gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB2YXIgYXJnYyA9IGFyZ3MubGVuZ3RoOwoJICAgICAgICAgICAgICAgIGlmICghX3RoaXMuZmluYWxpemVkKSB7CgkgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiYXR0ZW1wdGluZyB0byBpbnN0YW50aWF0ZSB1bmZpbmFsaXplZCB0eXBlICIgKwoJICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudHlwZU5hbWUpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB2YXIgYnVpbHQgPSBPYmplY3QuY3JlYXRlKG5vZGVQcm90b3R5cGUpOwoJICAgICAgICAgICAgICAgIF90aGlzLmJ1aWxkUGFyYW1zLmZvckVhY2goZnVuY3Rpb24gKHBhcmFtLCBpKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChpIDwgYXJnYykgewoJICAgICAgICAgICAgICAgICAgICAgICAgYWRkUGFyYW0oYnVpbHQsIHBhcmFtLCBhcmdzW2ldLCB0cnVlKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGFkZFBhcmFtKGJ1aWx0LCBwYXJhbSwgbnVsbCwgZmFsc2UpOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfSk7CgkgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoX3RoaXMuYWxsRmllbGRzKS5mb3JFYWNoKGZ1bmN0aW9uIChwYXJhbSkgewoJICAgICAgICAgICAgICAgICAgICAvLyBVc2UgdGhlIGRlZmF1bHQgdmFsdWUuCgkgICAgICAgICAgICAgICAgICAgIGFkZFBhcmFtKGJ1aWx0LCBwYXJhbSwgbnVsbCwgZmFsc2UpOwoJICAgICAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHRoZSAidHlwZSIgZmllbGQgd2FzIGZpbGxlZCBhdXRvbWF0aWNhbGx5LgoJICAgICAgICAgICAgICAgIGlmIChidWlsdC50eXBlICE9PSBfdGhpcy50eXBlTmFtZSkgewoJICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICByZXR1cm4gYnVpbHQ7CgkgICAgICAgICAgICB9OwoJICAgICAgICAgICAgLy8gQ2FsbGluZyAuZnJvbSBvbiB0aGUgYnVpbGRlciBmdW5jdGlvbiB3aWxsIGNvbnN0cnVjdCBhbiBpbnN0YW5jZSBvZiB0aGUgRGVmLAoJICAgICAgICAgICAgLy8gdXNpbmcgZmllbGQgdmFsdWVzIGZyb20gdGhlIHBhc3NlZCBvYmplY3QuIEZvciBmaWVsZHMgbWlzc2luZyBmcm9tIHRoZSBwYXNzZWQgb2JqZWN0LAoJICAgICAgICAgICAgLy8gdGhlaXIgZGVmYXVsdCB2YWx1ZSB3aWxsIGJlIHVzZWQuCgkgICAgICAgICAgICBidWlsZGVyLmZyb20gPSBmdW5jdGlvbiAob2JqKSB7CgkgICAgICAgICAgICAgICAgaWYgKCFfdGhpcy5maW5hbGl6ZWQpIHsKCSAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJhdHRlbXB0aW5nIHRvIGluc3RhbnRpYXRlIHVuZmluYWxpemVkIHR5cGUgIiArCgkgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy50eXBlTmFtZSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHZhciBidWlsdCA9IE9iamVjdC5jcmVhdGUobm9kZVByb3RvdHlwZSk7CgkgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoX3RoaXMuYWxsRmllbGRzKS5mb3JFYWNoKGZ1bmN0aW9uIChwYXJhbSkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaGFzT3duLmNhbGwob2JqLCBwYXJhbSkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGFkZFBhcmFtKGJ1aWx0LCBwYXJhbSwgb2JqW3BhcmFtXSwgdHJ1ZSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBhZGRQYXJhbShidWlsdCwgcGFyYW0sIG51bGwsIGZhbHNlKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHRoZSAidHlwZSIgZmllbGQgd2FzIGZpbGxlZCBhdXRvbWF0aWNhbGx5LgoJICAgICAgICAgICAgICAgIGlmIChidWlsdC50eXBlICE9PSBfdGhpcy50eXBlTmFtZSkgewoJICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICByZXR1cm4gYnVpbHQ7CgkgICAgICAgICAgICB9OwoJICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGJ1aWxkZXJzLCBnZXRCdWlsZGVyTmFtZSh0aGlzLnR5cGVOYW1lKSwgewoJICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCgkgICAgICAgICAgICAgICAgdmFsdWU6IGJ1aWxkZXIKCSAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgICAgIH07CgkgICAgICAgIC8vIFRoZSByZWFzb24gZmllbGRzIGFyZSBzcGVjaWZpZWQgdXNpbmcgLmZpZWxkKC4uLikgaW5zdGVhZCBvZiBhbiBvYmplY3QKCSAgICAgICAgLy8gbGl0ZXJhbCBzeW50YXggaXMgc29tZXdoYXQgc3VidGxlOiB0aGUgb2JqZWN0IGxpdGVyYWwgc3ludGF4IHdvdWxkCgkgICAgICAgIC8vIHN1cHBvcnQgb25seSBvbmUga2V5IGFuZCBvbmUgdmFsdWUsIGJ1dCB3aXRoIC5maWVsZCguLi4pIHdlIGNhbiBwYXNzCgkgICAgICAgIC8vIGFueSBudW1iZXIgb2YgYXJndW1lbnRzIHRvIHNwZWNpZnkgdGhlIGZpZWxkLgoJICAgICAgICBEZWZJbXBsLnByb3RvdHlwZS5maWVsZCA9IGZ1bmN0aW9uIChuYW1lLCB0eXBlLCBkZWZhdWx0Rm4sIGhpZGRlbikgewoJICAgICAgICAgICAgaWYgKHRoaXMuZmluYWxpemVkKSB7CgkgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiSWdub3JpbmcgYXR0ZW1wdCB0byByZWRlZmluZSBmaWVsZCAiICsKCSAgICAgICAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkobmFtZSkgKyAiIG9mIGZpbmFsaXplZCB0eXBlICIgKwoJICAgICAgICAgICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh0aGlzLnR5cGVOYW1lKSk7CgkgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0aGlzLm93bkZpZWxkc1tuYW1lXSA9IG5ldyBGaWVsZChuYW1lLCBUeXBlLmZyb20odHlwZSksIGRlZmF1bHRGbiwgaGlkZGVuKTsKCSAgICAgICAgICAgIHJldHVybiB0aGlzOyAvLyBGb3IgY2hhaW5pbmcuCgkgICAgICAgIH07CgkgICAgICAgIERlZkltcGwucHJvdG90eXBlLmZpbmFsaXplID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCSAgICAgICAgICAgIC8vIEl0J3Mgbm90IGFuIGVycm9yIHRvIGZpbmFsaXplIGEgdHlwZSBtb3JlIHRoYW4gb25jZSwgYnV0IG9ubHkgdGhlCgkgICAgICAgICAgICAvLyBmaXJzdCBjYWxsIHRvIC5maW5hbGl6ZSBkb2VzIGFueXRoaW5nLgoJICAgICAgICAgICAgaWYgKCF0aGlzLmZpbmFsaXplZCkgewoJICAgICAgICAgICAgICAgIHZhciBhbGxGaWVsZHMgPSB0aGlzLmFsbEZpZWxkczsKCSAgICAgICAgICAgICAgICB2YXIgYWxsU3VwZXJ0eXBlcyA9IHRoaXMuYWxsU3VwZXJ0eXBlczsKCSAgICAgICAgICAgICAgICB0aGlzLmJhc2VOYW1lcy5mb3JFYWNoKGZ1bmN0aW9uIChuYW1lKSB7CgkgICAgICAgICAgICAgICAgICAgIHZhciBkZWYgPSBkZWZDYWNoZVtuYW1lXTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKGRlZiBpbnN0YW5jZW9mIERlZikgewoJICAgICAgICAgICAgICAgICAgICAgICAgZGVmLmZpbmFsaXplKCk7CgkgICAgICAgICAgICAgICAgICAgICAgICBleHRlbmQoYWxsRmllbGRzLCBkZWYuYWxsRmllbGRzKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVuZChhbGxTdXBlcnR5cGVzLCBkZWYuYWxsU3VwZXJ0eXBlcyk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9ICJ1bmtub3duIHN1cGVydHlwZSBuYW1lICIgKwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KG5hbWUpICsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAiIGZvciBzdWJ0eXBlICIgKwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KF90aGlzLnR5cGVOYW1lKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgICAgIC8vIFRPRE8gV2FybiBpZiBmaWVsZHMgYXJlIG92ZXJyaWRkZW4gd2l0aCBpbmNvbXBhdGlibGUgdHlwZXMuCgkgICAgICAgICAgICAgICAgZXh0ZW5kKGFsbEZpZWxkcywgdGhpcy5vd25GaWVsZHMpOwoJICAgICAgICAgICAgICAgIGFsbFN1cGVydHlwZXNbdGhpcy50eXBlTmFtZV0gPSB0aGlzOwoJICAgICAgICAgICAgICAgIHRoaXMuZmllbGROYW1lcy5sZW5ndGggPSAwOwoJICAgICAgICAgICAgICAgIGZvciAodmFyIGZpZWxkTmFtZSBpbiBhbGxGaWVsZHMpIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKGhhc093bi5jYWxsKGFsbEZpZWxkcywgZmllbGROYW1lKSAmJgoJICAgICAgICAgICAgICAgICAgICAgICAgIWFsbEZpZWxkc1tmaWVsZE5hbWVdLmhpZGRlbikgewoJICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maWVsZE5hbWVzLnB1c2goZmllbGROYW1lKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAvLyBUeXBlcyBhcmUgZXhwb3J0ZWQgb25seSBvbmNlIHRoZXkgaGF2ZSBiZWVuIGZpbmFsaXplZC4KCSAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmFtZWRUeXBlcywgdGhpcy50eXBlTmFtZSwgewoJICAgICAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAoJICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy50eXBlCgkgICAgICAgICAgICAgICAgfSk7CgkgICAgICAgICAgICAgICAgdGhpcy5maW5hbGl6ZWQgPSB0cnVlOwoJICAgICAgICAgICAgICAgIC8vIEEgbGluZWFyaXphdGlvbiBvZiB0aGUgaW5oZXJpdGFuY2UgaGllcmFyY2h5LgoJICAgICAgICAgICAgICAgIHBvcHVsYXRlU3VwZXJ0eXBlTGlzdCh0aGlzLnR5cGVOYW1lLCB0aGlzLnN1cGVydHlwZUxpc3QpOwoJICAgICAgICAgICAgICAgIGlmICh0aGlzLmJ1aWxkYWJsZSAmJgoJICAgICAgICAgICAgICAgICAgICB0aGlzLnN1cGVydHlwZUxpc3QubGFzdEluZGV4T2YoIkV4cHJlc3Npb24iKSA+PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgIHdyYXBFeHByZXNzaW9uQnVpbGRlcldpdGhTdGF0ZW1lbnQodGhpcy50eXBlTmFtZSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9OwoJICAgICAgICByZXR1cm4gRGVmSW1wbDsKCSAgICB9KERlZikpOwoJICAgIC8vIE5vdGUgdGhhdCB0aGUgbGlzdCByZXR1cm5lZCBieSB0aGlzIGZ1bmN0aW9uIGlzIGEgY29weSBvZiB0aGUgaW50ZXJuYWwKCSAgICAvLyBzdXBlcnR5cGVMaXN0LCAqd2l0aG91dCogdGhlIHR5cGVOYW1lIGl0c2VsZiBhcyB0aGUgZmlyc3QgZWxlbWVudC4KCSAgICBmdW5jdGlvbiBnZXRTdXBlcnR5cGVOYW1lcyh0eXBlTmFtZSkgewoJICAgICAgICBpZiAoIWhhc093bi5jYWxsKGRlZkNhY2hlLCB0eXBlTmFtZSkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGQgPSBkZWZDYWNoZVt0eXBlTmFtZV07CgkgICAgICAgIGlmIChkLmZpbmFsaXplZCAhPT0gdHJ1ZSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gZC5zdXBlcnR5cGVMaXN0LnNsaWNlKDEpOwoJICAgIH0KCSAgICAvLyBSZXR1cm5zIGFuIG9iamVjdCBtYXBwaW5nIGZyb20gZXZlcnkga25vd24gdHlwZSBpbiB0aGUgZGVmQ2FjaGUgdG8gdGhlCgkgICAgLy8gbW9zdCBzcGVjaWZpYyBzdXBlcnR5cGUgd2hvc2UgbmFtZSBpcyBhbiBvd24gcHJvcGVydHkgb2YgdGhlIGNhbmRpZGF0ZXMKCSAgICAvLyBvYmplY3QuCgkgICAgZnVuY3Rpb24gY29tcHV0ZVN1cGVydHlwZUxvb2t1cFRhYmxlKGNhbmRpZGF0ZXMpIHsKCSAgICAgICAgdmFyIHRhYmxlID0ge307CgkgICAgICAgIHZhciB0eXBlTmFtZXMgPSBPYmplY3Qua2V5cyhkZWZDYWNoZSk7CgkgICAgICAgIHZhciB0eXBlTmFtZUNvdW50ID0gdHlwZU5hbWVzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0eXBlTmFtZUNvdW50OyArK2kpIHsKCSAgICAgICAgICAgIHZhciB0eXBlTmFtZSA9IHR5cGVOYW1lc1tpXTsKCSAgICAgICAgICAgIHZhciBkID0gZGVmQ2FjaGVbdHlwZU5hbWVdOwoJICAgICAgICAgICAgaWYgKGQuZmluYWxpemVkICE9PSB0cnVlKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiICsgdHlwZU5hbWUpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBkLnN1cGVydHlwZUxpc3QubGVuZ3RoOyArK2opIHsKCSAgICAgICAgICAgICAgICB2YXIgc3VwZXJUeXBlTmFtZSA9IGQuc3VwZXJ0eXBlTGlzdFtqXTsKCSAgICAgICAgICAgICAgICBpZiAoaGFzT3duLmNhbGwoY2FuZGlkYXRlcywgc3VwZXJUeXBlTmFtZSkpIHsKCSAgICAgICAgICAgICAgICAgICAgdGFibGVbdHlwZU5hbWVdID0gc3VwZXJUeXBlTmFtZTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0YWJsZTsKCSAgICB9CgkgICAgdmFyIGJ1aWxkZXJzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKCSAgICAvLyBUaGlzIG9iamVjdCBpcyB1c2VkIGFzIHByb3RvdHlwZSBmb3IgYW55IG5vZGUgY3JlYXRlZCBieSBhIGJ1aWxkZXIuCgkgICAgdmFyIG5vZGVQcm90b3R5cGUgPSB7fTsKCSAgICAvLyBDYWxsIHRoaXMgZnVuY3Rpb24gdG8gZGVmaW5lIGEgbmV3IG1ldGhvZCB0byBiZSBzaGFyZWQgYnkgYWxsIEFTVAoJICAgIC8vIG5vZGVzLiBUaGUgcmVwbGFjZWQgbWV0aG9kIChpZiBhbnkpIGlzIHJldHVybmVkIGZvciBlYXN5IHdyYXBwaW5nLgoJICAgIGZ1bmN0aW9uIGRlZmluZU1ldGhvZChuYW1lLCBmdW5jKSB7CgkgICAgICAgIHZhciBvbGQgPSBub2RlUHJvdG90eXBlW25hbWVdOwoJICAgICAgICAvLyBQYXNzIHVuZGVmaW5lZCBhcyBmdW5jIHRvIGRlbGV0ZSBub2RlUHJvdG90eXBlW25hbWVdLgoJICAgICAgICBpZiAoaXNVbmRlZmluZWQuY2hlY2soZnVuYykpIHsKCSAgICAgICAgICAgIGRlbGV0ZSBub2RlUHJvdG90eXBlW25hbWVdOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgaXNGdW5jdGlvbi5hc3NlcnQoZnVuYyk7CgkgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobm9kZVByb3RvdHlwZSwgbmFtZSwgewoJICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCgkgICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAoJICAgICAgICAgICAgICAgIHZhbHVlOiBmdW5jCgkgICAgICAgICAgICB9KTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gb2xkOwoJICAgIH0KCSAgICBmdW5jdGlvbiBnZXRCdWlsZGVyTmFtZSh0eXBlTmFtZSkgewoJICAgICAgICByZXR1cm4gdHlwZU5hbWUucmVwbGFjZSgvXltBLVpdKy8sIGZ1bmN0aW9uICh1cHBlckNhc2VQcmVmaXgpIHsKCSAgICAgICAgICAgIHZhciBsZW4gPSB1cHBlckNhc2VQcmVmaXgubGVuZ3RoOwoJICAgICAgICAgICAgc3dpdGNoIChsZW4pIHsKCSAgICAgICAgICAgICAgICBjYXNlIDA6IHJldHVybiAiIjsKCSAgICAgICAgICAgICAgICAvLyBJZiB0aGVyZSdzIG9ubHkgb25lIGluaXRpYWwgY2FwaXRhbCBsZXR0ZXIsIGp1c3QgbG93ZXItY2FzZSBpdC4KCSAgICAgICAgICAgICAgICBjYXNlIDE6IHJldHVybiB1cHBlckNhc2VQcmVmaXgudG9Mb3dlckNhc2UoKTsKCSAgICAgICAgICAgICAgICBkZWZhdWx0OgoJICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGVyZSdzIG1vcmUgdGhhbiBvbmUgaW5pdGlhbCBjYXBpdGFsIGxldHRlciwgbG93ZXItY2FzZQoJICAgICAgICAgICAgICAgICAgICAvLyBhbGwgYnV0IHRoZSBsYXN0IG9uZSwgc28gdGhhdCBYTUxEZWZhdWx0RGVjbGFyYXRpb24gKGZvcgoJICAgICAgICAgICAgICAgICAgICAvLyBleGFtcGxlKSBiZWNvbWVzIHhtbERlZmF1bHREZWNsYXJhdGlvbi4KCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVwcGVyQ2FzZVByZWZpeC5zbGljZSgwLCBsZW4gLSAxKS50b0xvd2VyQ2FzZSgpICsKCSAgICAgICAgICAgICAgICAgICAgICAgIHVwcGVyQ2FzZVByZWZpeC5jaGFyQXQobGVuIC0gMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0pOwoJICAgIH0KCSAgICBmdW5jdGlvbiBnZXRTdGF0ZW1lbnRCdWlsZGVyTmFtZSh0eXBlTmFtZSkgewoJICAgICAgICB0eXBlTmFtZSA9IGdldEJ1aWxkZXJOYW1lKHR5cGVOYW1lKTsKCSAgICAgICAgcmV0dXJuIHR5cGVOYW1lLnJlcGxhY2UoLyhFeHByZXNzaW9uKT8kLywgIlN0YXRlbWVudCIpOwoJICAgIH0KCSAgICB2YXIgbmFtZWRUeXBlcyA9IHt9OwoJICAgIC8vIExpa2UgT2JqZWN0LmtleXMsIGJ1dCBhd2FyZSBvZiB3aGF0IGZpZWxkcyBlYWNoIEFTVCB0eXBlIHNob3VsZCBoYXZlLgoJICAgIGZ1bmN0aW9uIGdldEZpZWxkTmFtZXMob2JqZWN0KSB7CgkgICAgICAgIHZhciBkID0gZGVmRnJvbVZhbHVlKG9iamVjdCk7CgkgICAgICAgIGlmIChkKSB7CgkgICAgICAgICAgICByZXR1cm4gZC5maWVsZE5hbWVzLnNsaWNlKDApOwoJICAgICAgICB9CgkgICAgICAgIGlmICgidHlwZSIgaW4gb2JqZWN0KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImRpZCBub3QgcmVjb2duaXplIG9iamVjdCBvZiB0eXBlICIgKwoJICAgICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KG9iamVjdC50eXBlKSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKG9iamVjdCk7CgkgICAgfQoJICAgIC8vIEdldCB0aGUgdmFsdWUgb2YgYW4gb2JqZWN0IHByb3BlcnR5LCB0YWtpbmcgb2JqZWN0LnR5cGUgYW5kIGRlZmF1bHQKCSAgICAvLyBmdW5jdGlvbnMgaW50byBhY2NvdW50LgoJICAgIGZ1bmN0aW9uIGdldEZpZWxkVmFsdWUob2JqZWN0LCBmaWVsZE5hbWUpIHsKCSAgICAgICAgdmFyIGQgPSBkZWZGcm9tVmFsdWUob2JqZWN0KTsKCSAgICAgICAgaWYgKGQpIHsKCSAgICAgICAgICAgIHZhciBmaWVsZCA9IGQuYWxsRmllbGRzW2ZpZWxkTmFtZV07CgkgICAgICAgICAgICBpZiAoZmllbGQpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmllbGQuZ2V0VmFsdWUob2JqZWN0KTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gb2JqZWN0ICYmIG9iamVjdFtmaWVsZE5hbWVdOwoJICAgIH0KCSAgICAvLyBJdGVyYXRlIG92ZXIgYWxsIGRlZmluZWQgZmllbGRzIG9mIGFuIG9iamVjdCwgaW5jbHVkaW5nIHRob3NlIG1pc3NpbmcKCSAgICAvLyBvciB1bmRlZmluZWQsIHBhc3NpbmcgZWFjaCBmaWVsZCBuYW1lIGFuZCBlZmZlY3RpdmUgdmFsdWUgKGFzIHJldHVybmVkCgkgICAgLy8gYnkgZ2V0RmllbGRWYWx1ZSkgdG8gdGhlIGNhbGxiYWNrLiBJZiB0aGUgb2JqZWN0IGhhcyBubyBjb3JyZXNwb25kaW5nCgkgICAgLy8gRGVmLCB0aGUgY2FsbGJhY2sgd2lsbCBuZXZlciBiZSBjYWxsZWQuCgkgICAgZnVuY3Rpb24gZWFjaEZpZWxkKG9iamVjdCwgY2FsbGJhY2ssIGNvbnRleHQpIHsKCSAgICAgICAgZ2V0RmllbGROYW1lcyhvYmplY3QpLmZvckVhY2goZnVuY3Rpb24gKG5hbWUpIHsKCSAgICAgICAgICAgIGNhbGxiYWNrLmNhbGwodGhpcywgbmFtZSwgZ2V0RmllbGRWYWx1ZShvYmplY3QsIG5hbWUpKTsKCSAgICAgICAgfSwgY29udGV4dCk7CgkgICAgfQoJICAgIC8vIFNpbWlsYXIgdG8gZWFjaEZpZWxkLCBleGNlcHQgdGhhdCBpdGVyYXRpb24gc3RvcHMgYXMgc29vbiBhcyB0aGUKCSAgICAvLyBjYWxsYmFjayByZXR1cm5zIGEgdHJ1dGh5IHZhbHVlLiBMaWtlIEFycmF5LnByb3RvdHlwZS5zb21lLCB0aGUgZmluYWwKCSAgICAvLyByZXN1bHQgaXMgZWl0aGVyIHRydWUgb3IgZmFsc2UgdG8gaW5kaWNhdGVzIHdoZXRoZXIgdGhlIGNhbGxiYWNrCgkgICAgLy8gcmV0dXJuZWQgdHJ1ZSBmb3IgYW55IGVsZW1lbnQgb3Igbm90LgoJICAgIGZ1bmN0aW9uIHNvbWVGaWVsZChvYmplY3QsIGNhbGxiYWNrLCBjb250ZXh0KSB7CgkgICAgICAgIHJldHVybiBnZXRGaWVsZE5hbWVzKG9iamVjdCkuc29tZShmdW5jdGlvbiAobmFtZSkgewoJICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrLmNhbGwodGhpcywgbmFtZSwgZ2V0RmllbGRWYWx1ZShvYmplY3QsIG5hbWUpKTsKCSAgICAgICAgfSwgY29udGV4dCk7CgkgICAgfQoJICAgIC8vIEFkZHMgYW4gYWRkaXRpb25hbCBidWlsZGVyIGZvciBFeHByZXNzaW9uIHN1YnR5cGVzCgkgICAgLy8gdGhhdCB3cmFwcyB0aGUgYnVpbHQgRXhwcmVzc2lvbiBpbiBhbiBFeHByZXNzaW9uU3RhdGVtZW50cy4KCSAgICBmdW5jdGlvbiB3cmFwRXhwcmVzc2lvbkJ1aWxkZXJXaXRoU3RhdGVtZW50KHR5cGVOYW1lKSB7CgkgICAgICAgIHZhciB3cmFwcGVyTmFtZSA9IGdldFN0YXRlbWVudEJ1aWxkZXJOYW1lKHR5cGVOYW1lKTsKCSAgICAgICAgLy8gc2tpcCBpZiB0aGUgYnVpbGRlciBhbHJlYWR5IGV4aXN0cwoJICAgICAgICBpZiAoYnVpbGRlcnNbd3JhcHBlck5hbWVdKQoJICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICAvLyB0aGUgYnVpbGRlciBmdW5jdGlvbiB0byB3cmFwIHdpdGggYnVpbGRlcnMuRXhwcmVzc2lvblN0YXRlbWVudAoJICAgICAgICB2YXIgd3JhcHBlZCA9IGJ1aWxkZXJzW2dldEJ1aWxkZXJOYW1lKHR5cGVOYW1lKV07CgkgICAgICAgIC8vIHNraXAgaWYgdGhlcmUgaXMgbm90aGluZyB0byB3cmFwCgkgICAgICAgIGlmICghd3JhcHBlZCkKCSAgICAgICAgICAgIHJldHVybjsKCSAgICAgICAgdmFyIGJ1aWxkZXIgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICB2YXIgYXJncyA9IFtdOwoJICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgICAgICAgICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gYnVpbGRlcnMuZXhwcmVzc2lvblN0YXRlbWVudCh3cmFwcGVkLmFwcGx5KGJ1aWxkZXJzLCBhcmdzKSk7CgkgICAgICAgIH07CgkgICAgICAgIGJ1aWxkZXIuZnJvbSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIHZhciBhcmdzID0gW107CgkgICAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJICAgICAgICAgICAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzW19pXTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiBidWlsZGVycy5leHByZXNzaW9uU3RhdGVtZW50KHdyYXBwZWQuZnJvbS5hcHBseShidWlsZGVycywgYXJncykpOwoJICAgICAgICB9OwoJICAgICAgICBidWlsZGVyc1t3cmFwcGVyTmFtZV0gPSBidWlsZGVyOwoJICAgIH0KCSAgICBmdW5jdGlvbiBwb3B1bGF0ZVN1cGVydHlwZUxpc3QodHlwZU5hbWUsIGxpc3QpIHsKCSAgICAgICAgbGlzdC5sZW5ndGggPSAwOwoJICAgICAgICBsaXN0LnB1c2godHlwZU5hbWUpOwoJICAgICAgICB2YXIgbGFzdFNlZW4gPSBPYmplY3QuY3JlYXRlKG51bGwpOwoJICAgICAgICBmb3IgKHZhciBwb3MgPSAwOyBwb3MgPCBsaXN0Lmxlbmd0aDsgKytwb3MpIHsKCSAgICAgICAgICAgIHR5cGVOYW1lID0gbGlzdFtwb3NdOwoJICAgICAgICAgICAgdmFyIGQgPSBkZWZDYWNoZVt0eXBlTmFtZV07CgkgICAgICAgICAgICBpZiAoZC5maW5hbGl6ZWQgIT09IHRydWUpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gSWYgd2Ugc2F3IHR5cGVOYW1lIGVhcmxpZXIgaW4gdGhlIGJyZWFkdGgtZmlyc3QgdHJhdmVyc2FsLAoJICAgICAgICAgICAgLy8gZGVsZXRlIHRoZSBsYXN0LXNlZW4gb2NjdXJyZW5jZS4KCSAgICAgICAgICAgIGlmIChoYXNPd24uY2FsbChsYXN0U2VlbiwgdHlwZU5hbWUpKSB7CgkgICAgICAgICAgICAgICAgZGVsZXRlIGxpc3RbbGFzdFNlZW5bdHlwZU5hbWVdXTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIFJlY29yZCB0aGUgbmV3IGluZGV4IG9mIHRoZSBsYXN0LXNlZW4gb2NjdXJyZW5jZSBvZiB0eXBlTmFtZS4KCSAgICAgICAgICAgIGxhc3RTZWVuW3R5cGVOYW1lXSA9IHBvczsKCSAgICAgICAgICAgIC8vIEVucXVldWUgdGhlIGJhc2UgbmFtZXMgb2YgdGhpcyB0eXBlLgoJICAgICAgICAgICAgbGlzdC5wdXNoLmFwcGx5KGxpc3QsIGQuYmFzZU5hbWVzKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBDb21wYWN0aW9uIGxvb3AgdG8gcmVtb3ZlIGFycmF5IGhvbGVzLgoJICAgICAgICBmb3IgKHZhciB0byA9IDAsIGZyb20gPSB0bywgbGVuID0gbGlzdC5sZW5ndGg7IGZyb20gPCBsZW47ICsrZnJvbSkgewoJICAgICAgICAgICAgaWYgKGhhc093bi5jYWxsKGxpc3QsIGZyb20pKSB7CgkgICAgICAgICAgICAgICAgbGlzdFt0bysrXSA9IGxpc3RbZnJvbV07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgbGlzdC5sZW5ndGggPSB0bzsKCSAgICB9CgkgICAgZnVuY3Rpb24gZXh0ZW5kKGludG8sIGZyb20pIHsKCSAgICAgICAgT2JqZWN0LmtleXMoZnJvbSkuZm9yRWFjaChmdW5jdGlvbiAobmFtZSkgewoJICAgICAgICAgICAgaW50b1tuYW1lXSA9IGZyb21bbmFtZV07CgkgICAgICAgIH0pOwoJICAgICAgICByZXR1cm4gaW50bzsKCSAgICB9CgkgICAgZnVuY3Rpb24gZmluYWxpemUoKSB7CgkgICAgICAgIE9iamVjdC5rZXlzKGRlZkNhY2hlKS5mb3JFYWNoKGZ1bmN0aW9uIChuYW1lKSB7CgkgICAgICAgICAgICBkZWZDYWNoZVtuYW1lXS5maW5hbGl6ZSgpOwoJICAgICAgICB9KTsKCSAgICB9CgkgICAgcmV0dXJuIHsKCSAgICAgICAgVHlwZTogVHlwZSwKCSAgICAgICAgYnVpbHRJblR5cGVzOiBidWlsdEluVHlwZXMsCgkgICAgICAgIGdldFN1cGVydHlwZU5hbWVzOiBnZXRTdXBlcnR5cGVOYW1lcywKCSAgICAgICAgY29tcHV0ZVN1cGVydHlwZUxvb2t1cFRhYmxlOiBjb21wdXRlU3VwZXJ0eXBlTG9va3VwVGFibGUsCgkgICAgICAgIGJ1aWxkZXJzOiBidWlsZGVycywKCSAgICAgICAgZGVmaW5lTWV0aG9kOiBkZWZpbmVNZXRob2QsCgkgICAgICAgIGdldEJ1aWxkZXJOYW1lOiBnZXRCdWlsZGVyTmFtZSwKCSAgICAgICAgZ2V0U3RhdGVtZW50QnVpbGRlck5hbWU6IGdldFN0YXRlbWVudEJ1aWxkZXJOYW1lLAoJICAgICAgICBuYW1lZFR5cGVzOiBuYW1lZFR5cGVzLAoJICAgICAgICBnZXRGaWVsZE5hbWVzOiBnZXRGaWVsZE5hbWVzLAoJICAgICAgICBnZXRGaWVsZFZhbHVlOiBnZXRGaWVsZFZhbHVlLAoJICAgICAgICBlYWNoRmllbGQ6IGVhY2hGaWVsZCwKCSAgICAgICAgc29tZUZpZWxkOiBzb21lRmllbGQsCgkgICAgICAgIGZpbmFsaXplOiBmaW5hbGl6ZSwKCSAgICB9OwoJfQoJdHlwZXMuZGVmYXVsdCA9IHR5cGVzUGx1Z2luOwoJcmV0dXJuIHR5cGVzOwp9Cgp2YXIgcGF0aFZpc2l0b3IgPSB7ZXhwb3J0czoge319OwoKdmFyIG5vZGVQYXRoID0ge2V4cG9ydHM6IHt9fTsKCnZhciBwYXRoID0ge2V4cG9ydHM6IHt9fTsKCnZhciBoYXNSZXF1aXJlZFBhdGg7CgpmdW5jdGlvbiByZXF1aXJlUGF0aCAoKSB7CglpZiAoaGFzUmVxdWlyZWRQYXRoKSByZXR1cm4gcGF0aC5leHBvcnRzOwoJaGFzUmVxdWlyZWRQYXRoID0gMTsKCShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCQl2YXIgdHNsaWJfMSA9IHJlcXVpcmUkJDA7CgkJdmFyIHR5cGVzXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlVHlwZXMoKSk7CgkJdmFyIE9wID0gT2JqZWN0LnByb3RvdHlwZTsKCQl2YXIgaGFzT3duID0gT3AuaGFzT3duUHJvcGVydHk7CgkJZnVuY3Rpb24gcGF0aFBsdWdpbihmb3JrKSB7CgkJICAgIHZhciB0eXBlcyA9IGZvcmsudXNlKHR5cGVzXzEuZGVmYXVsdCk7CgkJICAgIHZhciBpc0FycmF5ID0gdHlwZXMuYnVpbHRJblR5cGVzLmFycmF5OwoJCSAgICB2YXIgaXNOdW1iZXIgPSB0eXBlcy5idWlsdEluVHlwZXMubnVtYmVyOwoJCSAgICB2YXIgUGF0aCA9IGZ1bmN0aW9uIFBhdGgodmFsdWUsIHBhcmVudFBhdGgsIG5hbWUpIHsKCQkgICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBQYXRoKSkgewoJCSAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiUGF0aCBjb25zdHJ1Y3RvciBjYW5ub3QgYmUgaW52b2tlZCB3aXRob3V0ICduZXcnIik7CgkJICAgICAgICB9CgkJICAgICAgICBpZiAocGFyZW50UGF0aCkgewoJCSAgICAgICAgICAgIGlmICghKHBhcmVudFBhdGggaW5zdGFuY2VvZiBQYXRoKSkgewoJCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgIH0KCQkgICAgICAgIGVsc2UgewoJCSAgICAgICAgICAgIHBhcmVudFBhdGggPSBudWxsOwoJCSAgICAgICAgICAgIG5hbWUgPSBudWxsOwoJCSAgICAgICAgfQoJCSAgICAgICAgLy8gVGhlIHZhbHVlIGVuY2Fwc3VsYXRlZCBieSB0aGlzIFBhdGgsIGdlbmVyYWxseSBlcXVhbCB0bwoJCSAgICAgICAgLy8gcGFyZW50UGF0aC52YWx1ZVtuYW1lXSBpZiB3ZSBoYXZlIGEgcGFyZW50UGF0aC4KCQkgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKCQkgICAgICAgIC8vIFRoZSBpbW1lZGlhdGUgcGFyZW50IFBhdGggb2YgdGhpcyBQYXRoLgoJCSAgICAgICAgdGhpcy5wYXJlbnRQYXRoID0gcGFyZW50UGF0aDsKCQkgICAgICAgIC8vIFRoZSBuYW1lIG9mIHRoZSBwcm9wZXJ0eSBvZiBwYXJlbnRQYXRoLnZhbHVlIHRocm91Z2ggd2hpY2ggdGhpcwoJCSAgICAgICAgLy8gUGF0aCdzIHZhbHVlIHdhcyByZWFjaGVkLgoJCSAgICAgICAgdGhpcy5uYW1lID0gbmFtZTsKCQkgICAgICAgIC8vIENhbGxpbmcgcGF0aC5nZXQoImNoaWxkIikgbXVsdGlwbGUgdGltZXMgYWx3YXlzIHJldHVybnMgdGhlIHNhbWUKCQkgICAgICAgIC8vIGNoaWxkIFBhdGggb2JqZWN0LCBmb3IgYm90aCBwZXJmb3JtYW5jZSBhbmQgY29uc2lzdGVuY3kgcmVhc29ucy4KCQkgICAgICAgIHRoaXMuX19jaGlsZENhY2hlID0gbnVsbDsKCQkgICAgfTsKCQkgICAgdmFyIFBwID0gUGF0aC5wcm90b3R5cGU7CgkJICAgIGZ1bmN0aW9uIGdldENoaWxkQ2FjaGUocGF0aCkgewoJCSAgICAgICAgLy8gTGF6aWx5IGNyZWF0ZSB0aGUgY2hpbGQgY2FjaGUuIFRoaXMgYWxzbyBjaGVhcGVucyBjYWNoZQoJCSAgICAgICAgLy8gaW52YWxpZGF0aW9uLCBzaW5jZSB5b3UgY2FuIGp1c3QgcmVzZXQgcGF0aC5fX2NoaWxkQ2FjaGUgdG8gbnVsbC4KCQkgICAgICAgIHJldHVybiBwYXRoLl9fY2hpbGRDYWNoZSB8fCAocGF0aC5fX2NoaWxkQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpKTsKCQkgICAgfQoJCSAgICBmdW5jdGlvbiBnZXRDaGlsZFBhdGgocGF0aCwgbmFtZSkgewoJCSAgICAgICAgdmFyIGNhY2hlID0gZ2V0Q2hpbGRDYWNoZShwYXRoKTsKCQkgICAgICAgIHZhciBhY3R1YWxDaGlsZFZhbHVlID0gcGF0aC5nZXRWYWx1ZVByb3BlcnR5KG5hbWUpOwoJCSAgICAgICAgdmFyIGNoaWxkUGF0aCA9IGNhY2hlW25hbWVdOwoJCSAgICAgICAgaWYgKCFoYXNPd24uY2FsbChjYWNoZSwgbmFtZSkgfHwKCQkgICAgICAgICAgICAvLyBFbnN1cmUgY29uc2lzdGVuY3kgYmV0d2VlbiBjYWNoZSBhbmQgcmVhbGl0eS4KCQkgICAgICAgICAgICBjaGlsZFBhdGgudmFsdWUgIT09IGFjdHVhbENoaWxkVmFsdWUpIHsKCQkgICAgICAgICAgICBjaGlsZFBhdGggPSBjYWNoZVtuYW1lXSA9IG5ldyBwYXRoLmNvbnN0cnVjdG9yKGFjdHVhbENoaWxkVmFsdWUsIHBhdGgsIG5hbWUpOwoJCSAgICAgICAgfQoJCSAgICAgICAgcmV0dXJuIGNoaWxkUGF0aDsKCQkgICAgfQoJCSAgICAvLyBUaGlzIG1ldGhvZCBpcyBkZXNpZ25lZCB0byBiZSBvdmVycmlkZGVuIGJ5IHN1YmNsYXNzZXMgdGhhdCBuZWVkIHRvCgkJICAgIC8vIGhhbmRsZSBtaXNzaW5nIHByb3BlcnRpZXMsIGV0Yy4KCQkgICAgUHAuZ2V0VmFsdWVQcm9wZXJ0eSA9IGZ1bmN0aW9uIGdldFZhbHVlUHJvcGVydHkobmFtZSkgewoJCSAgICAgICAgcmV0dXJuIHRoaXMudmFsdWVbbmFtZV07CgkJICAgIH07CgkJICAgIFBwLmdldCA9IGZ1bmN0aW9uIGdldCgpIHsKCQkgICAgICAgIHZhciBuYW1lcyA9IFtdOwoJCSAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCQkgICAgICAgICAgICBuYW1lc1tfaV0gPSBhcmd1bWVudHNbX2ldOwoJCSAgICAgICAgfQoJCSAgICAgICAgdmFyIHBhdGggPSB0aGlzOwoJCSAgICAgICAgdmFyIGNvdW50ID0gbmFtZXMubGVuZ3RoOwoJCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb3VudDsgKytpKSB7CgkJICAgICAgICAgICAgcGF0aCA9IGdldENoaWxkUGF0aChwYXRoLCBuYW1lc1tpXSk7CgkJICAgICAgICB9CgkJICAgICAgICByZXR1cm4gcGF0aDsKCQkgICAgfTsKCQkgICAgUHAuZWFjaCA9IGZ1bmN0aW9uIGVhY2goY2FsbGJhY2ssIGNvbnRleHQpIHsKCQkgICAgICAgIHZhciBjaGlsZFBhdGhzID0gW107CgkJICAgICAgICB2YXIgbGVuID0gdGhpcy52YWx1ZS5sZW5ndGg7CgkJICAgICAgICB2YXIgaSA9IDA7CgkJICAgICAgICAvLyBDb2xsZWN0IGFsbCB0aGUgb3JpZ2luYWwgY2hpbGQgcGF0aHMgYmVmb3JlIGludm9raW5nIHRoZSBjYWxsYmFjay4KCQkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyArK2kpIHsKCQkgICAgICAgICAgICBpZiAoaGFzT3duLmNhbGwodGhpcy52YWx1ZSwgaSkpIHsKCQkgICAgICAgICAgICAgICAgY2hpbGRQYXRoc1tpXSA9IHRoaXMuZ2V0KGkpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgIH0KCQkgICAgICAgIC8vIEludm9rZSB0aGUgY2FsbGJhY2sgb24ganVzdCB0aGUgb3JpZ2luYWwgY2hpbGQgcGF0aHMsIHJlZ2FyZGxlc3Mgb2YKCQkgICAgICAgIC8vIGFueSBtb2RpZmljYXRpb25zIG1hZGUgdG8gdGhlIGFycmF5IGJ5IHRoZSBjYWxsYmFjay4gSSBjaG9zZSB0aGVzZQoJCSAgICAgICAgLy8gc2VtYW50aWNzIG92ZXIgY2xldmVybHkgaW52b2tpbmcgdGhlIGNhbGxiYWNrIG9uIG5ldyBlbGVtZW50cyBiZWNhdXNlCgkJICAgICAgICAvLyB0aGlzIHdheSBpcyBtdWNoIGVhc2llciB0byByZWFzb24gYWJvdXQuCgkJICAgICAgICBjb250ZXh0ID0gY29udGV4dCB8fCB0aGlzOwoJCSAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgKytpKSB7CgkJICAgICAgICAgICAgaWYgKGhhc093bi5jYWxsKGNoaWxkUGF0aHMsIGkpKSB7CgkJICAgICAgICAgICAgICAgIGNhbGxiYWNrLmNhbGwoY29udGV4dCwgY2hpbGRQYXRoc1tpXSk7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgfQoJCSAgICB9OwoJCSAgICBQcC5tYXAgPSBmdW5jdGlvbiBtYXAoY2FsbGJhY2ssIGNvbnRleHQpIHsKCQkgICAgICAgIHZhciByZXN1bHQgPSBbXTsKCQkgICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbiAoY2hpbGRQYXRoKSB7CgkJICAgICAgICAgICAgcmVzdWx0LnB1c2goY2FsbGJhY2suY2FsbCh0aGlzLCBjaGlsZFBhdGgpKTsKCQkgICAgICAgIH0sIGNvbnRleHQpOwoJCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCQkgICAgfTsKCQkgICAgUHAuZmlsdGVyID0gZnVuY3Rpb24gZmlsdGVyKGNhbGxiYWNrLCBjb250ZXh0KSB7CgkJICAgICAgICB2YXIgcmVzdWx0ID0gW107CgkJICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24gKGNoaWxkUGF0aCkgewoJCSAgICAgICAgICAgIGlmIChjYWxsYmFjay5jYWxsKHRoaXMsIGNoaWxkUGF0aCkpIHsKCQkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goY2hpbGRQYXRoKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICB9LCBjb250ZXh0KTsKCQkgICAgICAgIHJldHVybiByZXN1bHQ7CgkJICAgIH07CgkJICAgIGZ1bmN0aW9uIGVtcHR5TW92ZXMoKSB7IH0KCQkgICAgZnVuY3Rpb24gZ2V0TW92ZXMocGF0aCwgb2Zmc2V0LCBzdGFydCwgZW5kKSB7CgkJICAgICAgICBpc0FycmF5LmFzc2VydChwYXRoLnZhbHVlKTsKCQkgICAgICAgIGlmIChvZmZzZXQgPT09IDApIHsKCQkgICAgICAgICAgICByZXR1cm4gZW1wdHlNb3ZlczsKCQkgICAgICAgIH0KCQkgICAgICAgIHZhciBsZW5ndGggPSBwYXRoLnZhbHVlLmxlbmd0aDsKCQkgICAgICAgIGlmIChsZW5ndGggPCAxKSB7CgkJICAgICAgICAgICAgcmV0dXJuIGVtcHR5TW92ZXM7CgkJICAgICAgICB9CgkJICAgICAgICB2YXIgYXJnYyA9IGFyZ3VtZW50cy5sZW5ndGg7CgkJICAgICAgICBpZiAoYXJnYyA9PT0gMikgewoJCSAgICAgICAgICAgIHN0YXJ0ID0gMDsKCQkgICAgICAgICAgICBlbmQgPSBsZW5ndGg7CgkJICAgICAgICB9CgkJICAgICAgICBlbHNlIGlmIChhcmdjID09PSAzKSB7CgkJICAgICAgICAgICAgc3RhcnQgPSBNYXRoLm1heChzdGFydCwgMCk7CgkJICAgICAgICAgICAgZW5kID0gbGVuZ3RoOwoJCSAgICAgICAgfQoJCSAgICAgICAgZWxzZSB7CgkJICAgICAgICAgICAgc3RhcnQgPSBNYXRoLm1heChzdGFydCwgMCk7CgkJICAgICAgICAgICAgZW5kID0gTWF0aC5taW4oZW5kLCBsZW5ndGgpOwoJCSAgICAgICAgfQoJCSAgICAgICAgaXNOdW1iZXIuYXNzZXJ0KHN0YXJ0KTsKCQkgICAgICAgIGlzTnVtYmVyLmFzc2VydChlbmQpOwoJCSAgICAgICAgdmFyIG1vdmVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKCQkgICAgICAgIHZhciBjYWNoZSA9IGdldENoaWxkQ2FjaGUocGF0aCk7CgkJICAgICAgICBmb3IgKHZhciBpID0gc3RhcnQ7IGkgPCBlbmQ7ICsraSkgewoJCSAgICAgICAgICAgIGlmIChoYXNPd24uY2FsbChwYXRoLnZhbHVlLCBpKSkgewoJCSAgICAgICAgICAgICAgICB2YXIgY2hpbGRQYXRoID0gcGF0aC5nZXQoaSk7CgkJICAgICAgICAgICAgICAgIGlmIChjaGlsZFBhdGgubmFtZSAhPT0gaSkgewoJCSAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICB2YXIgbmV3SW5kZXggPSBpICsgb2Zmc2V0OwoJCSAgICAgICAgICAgICAgICBjaGlsZFBhdGgubmFtZSA9IG5ld0luZGV4OwoJCSAgICAgICAgICAgICAgICBtb3Zlc1tuZXdJbmRleF0gPSBjaGlsZFBhdGg7CgkJICAgICAgICAgICAgICAgIGRlbGV0ZSBjYWNoZVtpXTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICB9CgkJICAgICAgICBkZWxldGUgY2FjaGUubGVuZ3RoOwoJCSAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKCQkgICAgICAgICAgICBmb3IgKHZhciBuZXdJbmRleCBpbiBtb3ZlcykgewoJCSAgICAgICAgICAgICAgICB2YXIgY2hpbGRQYXRoID0gbW92ZXNbbmV3SW5kZXhdOwoJCSAgICAgICAgICAgICAgICBpZiAoY2hpbGRQYXRoLm5hbWUgIT09ICtuZXdJbmRleCkgewoJCSAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICBjYWNoZVtuZXdJbmRleF0gPSBjaGlsZFBhdGg7CgkJICAgICAgICAgICAgICAgIHBhdGgudmFsdWVbbmV3SW5kZXhdID0gY2hpbGRQYXRoLnZhbHVlOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgIH07CgkJICAgIH0KCQkgICAgUHAuc2hpZnQgPSBmdW5jdGlvbiBzaGlmdCgpIHsKCQkgICAgICAgIHZhciBtb3ZlID0gZ2V0TW92ZXModGhpcywgLTEpOwoJCSAgICAgICAgdmFyIHJlc3VsdCA9IHRoaXMudmFsdWUuc2hpZnQoKTsKCQkgICAgICAgIG1vdmUoKTsKCQkgICAgICAgIHJldHVybiByZXN1bHQ7CgkJICAgIH07CgkJICAgIFBwLnVuc2hpZnQgPSBmdW5jdGlvbiB1bnNoaWZ0KCkgewoJCSAgICAgICAgdmFyIGFyZ3MgPSBbXTsKCQkgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7CgkJICAgICAgICAgICAgYXJnc1tfaV0gPSBhcmd1bWVudHNbX2ldOwoJCSAgICAgICAgfQoJCSAgICAgICAgdmFyIG1vdmUgPSBnZXRNb3Zlcyh0aGlzLCBhcmdzLmxlbmd0aCk7CgkJICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy52YWx1ZS51bnNoaWZ0LmFwcGx5KHRoaXMudmFsdWUsIGFyZ3MpOwoJCSAgICAgICAgbW92ZSgpOwoJCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCQkgICAgfTsKCQkgICAgUHAucHVzaCA9IGZ1bmN0aW9uIHB1c2goKSB7CgkJICAgICAgICB2YXIgYXJncyA9IFtdOwoJCSAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCQkgICAgICAgICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07CgkJICAgICAgICB9CgkJICAgICAgICBpc0FycmF5LmFzc2VydCh0aGlzLnZhbHVlKTsKCQkgICAgICAgIGRlbGV0ZSBnZXRDaGlsZENhY2hlKHRoaXMpLmxlbmd0aDsKCQkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLnB1c2guYXBwbHkodGhpcy52YWx1ZSwgYXJncyk7CgkJICAgIH07CgkJICAgIFBwLnBvcCA9IGZ1bmN0aW9uIHBvcCgpIHsKCQkgICAgICAgIGlzQXJyYXkuYXNzZXJ0KHRoaXMudmFsdWUpOwoJCSAgICAgICAgdmFyIGNhY2hlID0gZ2V0Q2hpbGRDYWNoZSh0aGlzKTsKCQkgICAgICAgIGRlbGV0ZSBjYWNoZVt0aGlzLnZhbHVlLmxlbmd0aCAtIDFdOwoJCSAgICAgICAgZGVsZXRlIGNhY2hlLmxlbmd0aDsKCQkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLnBvcCgpOwoJCSAgICB9OwoJCSAgICBQcC5pbnNlcnRBdCA9IGZ1bmN0aW9uIGluc2VydEF0KGluZGV4KSB7CgkJICAgICAgICB2YXIgYXJnYyA9IGFyZ3VtZW50cy5sZW5ndGg7CgkJICAgICAgICB2YXIgbW92ZSA9IGdldE1vdmVzKHRoaXMsIGFyZ2MgLSAxLCBpbmRleCk7CgkJICAgICAgICBpZiAobW92ZSA9PT0gZW1wdHlNb3ZlcyAmJiBhcmdjIDw9IDEpIHsKCQkgICAgICAgICAgICByZXR1cm4gdGhpczsKCQkgICAgICAgIH0KCQkgICAgICAgIGluZGV4ID0gTWF0aC5tYXgoaW5kZXgsIDApOwoJCSAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmdjOyArK2kpIHsKCQkgICAgICAgICAgICB0aGlzLnZhbHVlW2luZGV4ICsgaSAtIDFdID0gYXJndW1lbnRzW2ldOwoJCSAgICAgICAgfQoJCSAgICAgICAgbW92ZSgpOwoJCSAgICAgICAgcmV0dXJuIHRoaXM7CgkJICAgIH07CgkJICAgIFBwLmluc2VydEJlZm9yZSA9IGZ1bmN0aW9uIGluc2VydEJlZm9yZSgpIHsKCQkgICAgICAgIHZhciBhcmdzID0gW107CgkJICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJCSAgICAgICAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzW19pXTsKCQkgICAgICAgIH0KCQkgICAgICAgIHZhciBwcCA9IHRoaXMucGFyZW50UGF0aDsKCQkgICAgICAgIHZhciBhcmdjID0gYXJncy5sZW5ndGg7CgkJICAgICAgICB2YXIgaW5zZXJ0QXRBcmdzID0gW3RoaXMubmFtZV07CgkJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ2M7ICsraSkgewoJCSAgICAgICAgICAgIGluc2VydEF0QXJncy5wdXNoKGFyZ3NbaV0pOwoJCSAgICAgICAgfQoJCSAgICAgICAgcmV0dXJuIHBwLmluc2VydEF0LmFwcGx5KHBwLCBpbnNlcnRBdEFyZ3MpOwoJCSAgICB9OwoJCSAgICBQcC5pbnNlcnRBZnRlciA9IGZ1bmN0aW9uIGluc2VydEFmdGVyKCkgewoJCSAgICAgICAgdmFyIGFyZ3MgPSBbXTsKCQkgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7CgkJICAgICAgICAgICAgYXJnc1tfaV0gPSBhcmd1bWVudHNbX2ldOwoJCSAgICAgICAgfQoJCSAgICAgICAgdmFyIHBwID0gdGhpcy5wYXJlbnRQYXRoOwoJCSAgICAgICAgdmFyIGFyZ2MgPSBhcmdzLmxlbmd0aDsKCQkgICAgICAgIHZhciBpbnNlcnRBdEFyZ3MgPSBbdGhpcy5uYW1lICsgMV07CgkJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ2M7ICsraSkgewoJCSAgICAgICAgICAgIGluc2VydEF0QXJncy5wdXNoKGFyZ3NbaV0pOwoJCSAgICAgICAgfQoJCSAgICAgICAgcmV0dXJuIHBwLmluc2VydEF0LmFwcGx5KHBwLCBpbnNlcnRBdEFyZ3MpOwoJCSAgICB9OwoJCSAgICBmdW5jdGlvbiByZXBhaXJSZWxhdGlvbnNoaXBXaXRoUGFyZW50KHBhdGgpIHsKCQkgICAgICAgIGlmICghKHBhdGggaW5zdGFuY2VvZiBQYXRoKSkgewoJCSAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkJICAgICAgICB9CgkJICAgICAgICB2YXIgcHAgPSBwYXRoLnBhcmVudFBhdGg7CgkJICAgICAgICBpZiAoIXBwKSB7CgkJICAgICAgICAgICAgLy8gT3JwaGFuIHBhdGhzIGhhdmUgbm8gcmVsYXRpb25zaGlwIHRvIHJlcGFpci4KCQkgICAgICAgICAgICByZXR1cm4gcGF0aDsKCQkgICAgICAgIH0KCQkgICAgICAgIHZhciBwYXJlbnRWYWx1ZSA9IHBwLnZhbHVlOwoJCSAgICAgICAgdmFyIHBhcmVudENhY2hlID0gZ2V0Q2hpbGRDYWNoZShwcCk7CgkJICAgICAgICAvLyBNYWtlIHN1cmUgcGFyZW50Q2FjaGVbcGF0aC5uYW1lXSBpcyBwb3B1bGF0ZWQuCgkJICAgICAgICBpZiAocGFyZW50VmFsdWVbcGF0aC5uYW1lXSA9PT0gcGF0aC52YWx1ZSkgewoJCSAgICAgICAgICAgIHBhcmVudENhY2hlW3BhdGgubmFtZV0gPSBwYXRoOwoJCSAgICAgICAgfQoJCSAgICAgICAgZWxzZSBpZiAoaXNBcnJheS5jaGVjayhwYXJlbnRWYWx1ZSkpIHsKCQkgICAgICAgICAgICAvLyBTb21ldGhpbmcgY2F1c2VkIHBhdGgubmFtZSB0byBiZWNvbWUgb3V0IG9mIGRhdGUsIHNvIGF0dGVtcHQgdG8KCQkgICAgICAgICAgICAvLyByZWNvdmVyIGJ5IHNlYXJjaGluZyBmb3IgcGF0aC52YWx1ZSBpbiBwYXJlbnRWYWx1ZS4KCQkgICAgICAgICAgICB2YXIgaSA9IHBhcmVudFZhbHVlLmluZGV4T2YocGF0aC52YWx1ZSk7CgkJICAgICAgICAgICAgaWYgKGkgPj0gMCkgewoJCSAgICAgICAgICAgICAgICBwYXJlbnRDYWNoZVtwYXRoLm5hbWUgPSBpXSA9IHBhdGg7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgfQoJCSAgICAgICAgZWxzZSB7CgkJICAgICAgICAgICAgLy8gSWYgcGF0aC52YWx1ZSBkaXNhZ3JlZXMgd2l0aCBwYXJlbnRWYWx1ZVtwYXRoLm5hbWVdLCBhbmQKCQkgICAgICAgICAgICAvLyBwYXRoLm5hbWUgaXMgbm90IGFuIGFycmF5IGluZGV4LCBsZXQgcGF0aC52YWx1ZSBiZWNvbWUgdGhlIG5ldwoJCSAgICAgICAgICAgIC8vIHBhcmVudFZhbHVlW3BhdGgubmFtZV0gYW5kIHVwZGF0ZSBwYXJlbnRDYWNoZSBhY2NvcmRpbmdseS4KCQkgICAgICAgICAgICBwYXJlbnRWYWx1ZVtwYXRoLm5hbWVdID0gcGF0aC52YWx1ZTsKCQkgICAgICAgICAgICBwYXJlbnRDYWNoZVtwYXRoLm5hbWVdID0gcGF0aDsKCQkgICAgICAgIH0KCQkgICAgICAgIGlmIChwYXJlbnRWYWx1ZVtwYXRoLm5hbWVdICE9PSBwYXRoLnZhbHVlKSB7CgkJICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgIH0KCQkgICAgICAgIGlmIChwYXRoLnBhcmVudFBhdGguZ2V0KHBhdGgubmFtZSkgIT09IHBhdGgpIHsKCQkgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJCSAgICAgICAgfQoJCSAgICAgICAgcmV0dXJuIHBhdGg7CgkJICAgIH0KCQkgICAgUHAucmVwbGFjZSA9IGZ1bmN0aW9uIHJlcGxhY2UocmVwbGFjZW1lbnQpIHsKCQkgICAgICAgIHZhciByZXN1bHRzID0gW107CgkJICAgICAgICB2YXIgcGFyZW50VmFsdWUgPSB0aGlzLnBhcmVudFBhdGgudmFsdWU7CgkJICAgICAgICB2YXIgcGFyZW50Q2FjaGUgPSBnZXRDaGlsZENhY2hlKHRoaXMucGFyZW50UGF0aCk7CgkJICAgICAgICB2YXIgY291bnQgPSBhcmd1bWVudHMubGVuZ3RoOwoJCSAgICAgICAgcmVwYWlyUmVsYXRpb25zaGlwV2l0aFBhcmVudCh0aGlzKTsKCQkgICAgICAgIGlmIChpc0FycmF5LmNoZWNrKHBhcmVudFZhbHVlKSkgewoJCSAgICAgICAgICAgIHZhciBvcmlnaW5hbExlbmd0aCA9IHBhcmVudFZhbHVlLmxlbmd0aDsKCQkgICAgICAgICAgICB2YXIgbW92ZSA9IGdldE1vdmVzKHRoaXMucGFyZW50UGF0aCwgY291bnQgLSAxLCB0aGlzLm5hbWUgKyAxKTsKCQkgICAgICAgICAgICB2YXIgc3BsaWNlQXJncyA9IFt0aGlzLm5hbWUsIDFdOwoJCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY291bnQ7ICsraSkgewoJCSAgICAgICAgICAgICAgICBzcGxpY2VBcmdzLnB1c2goYXJndW1lbnRzW2ldKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgdmFyIHNwbGljZWRPdXQgPSBwYXJlbnRWYWx1ZS5zcGxpY2UuYXBwbHkocGFyZW50VmFsdWUsIHNwbGljZUFyZ3MpOwoJCSAgICAgICAgICAgIGlmIChzcGxpY2VkT3V0WzBdICE9PSB0aGlzLnZhbHVlKSB7CgkJICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGlmIChwYXJlbnRWYWx1ZS5sZW5ndGggIT09IChvcmlnaW5hbExlbmd0aCAtIDEgKyBjb3VudCkpIHsKCQkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgbW92ZSgpOwoJCSAgICAgICAgICAgIGlmIChjb3VudCA9PT0gMCkgewoJCSAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy52YWx1ZTsKCQkgICAgICAgICAgICAgICAgZGVsZXRlIHBhcmVudENhY2hlW3RoaXMubmFtZV07CgkJICAgICAgICAgICAgICAgIHRoaXMuX19jaGlsZENhY2hlID0gbnVsbDsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgZWxzZSB7CgkJICAgICAgICAgICAgICAgIGlmIChwYXJlbnRWYWx1ZVt0aGlzLm5hbWVdICE9PSByZXBsYWNlbWVudCkgewoJCSAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICBpZiAodGhpcy52YWx1ZSAhPT0gcmVwbGFjZW1lbnQpIHsKCQkgICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWUgPSByZXBsYWNlbWVudDsKCQkgICAgICAgICAgICAgICAgICAgIHRoaXMuX19jaGlsZENhY2hlID0gbnVsbDsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY291bnQ7ICsraSkgewoJCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHRoaXMucGFyZW50UGF0aC5nZXQodGhpcy5uYW1lICsgaSkpOwoJCSAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgICAgIGlmIChyZXN1bHRzWzBdICE9PSB0aGlzKSB7CgkJICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJCSAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgfQoJCSAgICAgICAgZWxzZSBpZiAoY291bnQgPT09IDEpIHsKCQkgICAgICAgICAgICBpZiAodGhpcy52YWx1ZSAhPT0gcmVwbGFjZW1lbnQpIHsKCQkgICAgICAgICAgICAgICAgdGhpcy5fX2NoaWxkQ2FjaGUgPSBudWxsOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICB0aGlzLnZhbHVlID0gcGFyZW50VmFsdWVbdGhpcy5uYW1lXSA9IHJlcGxhY2VtZW50OwoJCSAgICAgICAgICAgIHJlc3VsdHMucHVzaCh0aGlzKTsKCQkgICAgICAgIH0KCQkgICAgICAgIGVsc2UgaWYgKGNvdW50ID09PSAwKSB7CgkJICAgICAgICAgICAgZGVsZXRlIHBhcmVudFZhbHVlW3RoaXMubmFtZV07CgkJICAgICAgICAgICAgZGVsZXRlIHRoaXMudmFsdWU7CgkJICAgICAgICAgICAgdGhpcy5fX2NoaWxkQ2FjaGUgPSBudWxsOwoJCSAgICAgICAgICAgIC8vIExlYXZlIHRoaXMgcGF0aCBjYWNoZWQgYXMgcGFyZW50Q2FjaGVbdGhpcy5uYW1lXSwgZXZlbiB0aG91Z2gKCQkgICAgICAgICAgICAvLyBpdCBubyBsb25nZXIgaGFzIGEgdmFsdWUgZGVmaW5lZC4KCQkgICAgICAgIH0KCQkgICAgICAgIGVsc2UgewoJCSAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ291bGQgbm90IHJlcGxhY2UgcGF0aCIpOwoJCSAgICAgICAgfQoJCSAgICAgICAgcmV0dXJuIHJlc3VsdHM7CgkJICAgIH07CgkJICAgIHJldHVybiBQYXRoOwoJCX0KCQlleHBvcnRzLmRlZmF1bHQgPSBwYXRoUGx1Z2luOwoJCW1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1siZGVmYXVsdCJdOyAKCX0gKHBhdGgsIHBhdGguZXhwb3J0cykpOwoJcmV0dXJuIHBhdGguZXhwb3J0czsKfQoKdmFyIHNjb3BlJDEgPSB7ZXhwb3J0czoge319OwoKdmFyIGhhc1JlcXVpcmVkU2NvcGU7CgpmdW5jdGlvbiByZXF1aXJlU2NvcGUgKCkgewoJaWYgKGhhc1JlcXVpcmVkU2NvcGUpIHJldHVybiBzY29wZSQxLmV4cG9ydHM7CgloYXNSZXF1aXJlZFNjb3BlID0gMTsKCShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCQl2YXIgdHNsaWJfMSA9IHJlcXVpcmUkJDA7CgkJdmFyIHR5cGVzXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlVHlwZXMoKSk7CgkJdmFyIGhhc093biA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7CgkJZnVuY3Rpb24gc2NvcGVQbHVnaW4oZm9yaykgewoJCSAgICB2YXIgdHlwZXMgPSBmb3JrLnVzZSh0eXBlc18xLmRlZmF1bHQpOwoJCSAgICB2YXIgVHlwZSA9IHR5cGVzLlR5cGU7CgkJICAgIHZhciBuYW1lZFR5cGVzID0gdHlwZXMubmFtZWRUeXBlczsKCQkgICAgdmFyIE5vZGUgPSBuYW1lZFR5cGVzLk5vZGU7CgkJICAgIHZhciBFeHByZXNzaW9uID0gbmFtZWRUeXBlcy5FeHByZXNzaW9uOwoJCSAgICB2YXIgaXNBcnJheSA9IHR5cGVzLmJ1aWx0SW5UeXBlcy5hcnJheTsKCQkgICAgdmFyIGIgPSB0eXBlcy5idWlsZGVyczsKCQkgICAgdmFyIFNjb3BlID0gZnVuY3Rpb24gU2NvcGUocGF0aCwgcGFyZW50U2NvcGUpIHsKCQkgICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTY29wZSkpIHsKCQkgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlNjb3BlIGNvbnN0cnVjdG9yIGNhbm5vdCBiZSBpbnZva2VkIHdpdGhvdXQgJ25ldyciKTsKCQkgICAgICAgIH0KCQkgICAgICAgIFNjb3BlVHlwZS5hc3NlcnQocGF0aC52YWx1ZSk7CgkJICAgICAgICB2YXIgZGVwdGg7CgkJICAgICAgICBpZiAocGFyZW50U2NvcGUpIHsKCQkgICAgICAgICAgICBpZiAoIShwYXJlbnRTY29wZSBpbnN0YW5jZW9mIFNjb3BlKSkgewoJCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBkZXB0aCA9IHBhcmVudFNjb3BlLmRlcHRoICsgMTsKCQkgICAgICAgIH0KCQkgICAgICAgIGVsc2UgewoJCSAgICAgICAgICAgIHBhcmVudFNjb3BlID0gbnVsbDsKCQkgICAgICAgICAgICBkZXB0aCA9IDA7CgkJICAgICAgICB9CgkJICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0aGlzLCB7CgkJICAgICAgICAgICAgcGF0aDogeyB2YWx1ZTogcGF0aCB9LAoJCSAgICAgICAgICAgIG5vZGU6IHsgdmFsdWU6IHBhdGgudmFsdWUgfSwKCQkgICAgICAgICAgICBpc0dsb2JhbDogeyB2YWx1ZTogIXBhcmVudFNjb3BlLCBlbnVtZXJhYmxlOiB0cnVlIH0sCgkJICAgICAgICAgICAgZGVwdGg6IHsgdmFsdWU6IGRlcHRoIH0sCgkJICAgICAgICAgICAgcGFyZW50OiB7IHZhbHVlOiBwYXJlbnRTY29wZSB9LAoJCSAgICAgICAgICAgIGJpbmRpbmdzOiB7IHZhbHVlOiB7fSB9LAoJCSAgICAgICAgICAgIHR5cGVzOiB7IHZhbHVlOiB7fSB9LAoJCSAgICAgICAgfSk7CgkJICAgIH07CgkJICAgIHZhciBzY29wZVR5cGVzID0gWwoJCSAgICAgICAgLy8gUHJvZ3JhbSBub2RlcyBpbnRyb2R1Y2UgZ2xvYmFsIHNjb3Blcy4KCQkgICAgICAgIG5hbWVkVHlwZXMuUHJvZ3JhbSwKCQkgICAgICAgIC8vIEZ1bmN0aW9uIGlzIHRoZSBzdXBlcnR5cGUgb2YgRnVuY3Rpb25FeHByZXNzaW9uLAoJCSAgICAgICAgLy8gRnVuY3Rpb25EZWNsYXJhdGlvbiwgQXJyb3dFeHByZXNzaW9uLCBldGMuCgkJICAgICAgICBuYW1lZFR5cGVzLkZ1bmN0aW9uLAoJCSAgICAgICAgLy8gSW4gY2FzZSB5b3UgZGlkbid0IGtub3csIHRoZSBjYXVnaHQgcGFyYW1ldGVyIHNoYWRvd3MgYW55IHZhcmlhYmxlCgkJICAgICAgICAvLyBvZiB0aGUgc2FtZSBuYW1lIGluIGFuIG91dGVyIHNjb3BlLgoJCSAgICAgICAgbmFtZWRUeXBlcy5DYXRjaENsYXVzZQoJCSAgICBdOwoJCSAgICB2YXIgU2NvcGVUeXBlID0gVHlwZS5vci5hcHBseShUeXBlLCBzY29wZVR5cGVzKTsKCQkgICAgU2NvcGUuaXNFc3RhYmxpc2hlZEJ5ID0gZnVuY3Rpb24gKG5vZGUpIHsKCQkgICAgICAgIHJldHVybiBTY29wZVR5cGUuY2hlY2sobm9kZSk7CgkJICAgIH07CgkJICAgIHZhciBTcCA9IFNjb3BlLnByb3RvdHlwZTsKCQkgICAgLy8gV2lsbCBiZSBvdmVycmlkZGVuIGFmdGVyIGFuIGluc3RhbmNlIGxhemlseSBjYWxscyBzY2FuU2NvcGUuCgkJICAgIFNwLmRpZFNjYW4gPSBmYWxzZTsKCQkgICAgU3AuZGVjbGFyZXMgPSBmdW5jdGlvbiAobmFtZSkgewoJCSAgICAgICAgdGhpcy5zY2FuKCk7CgkJICAgICAgICByZXR1cm4gaGFzT3duLmNhbGwodGhpcy5iaW5kaW5ncywgbmFtZSk7CgkJICAgIH07CgkJICAgIFNwLmRlY2xhcmVzVHlwZSA9IGZ1bmN0aW9uIChuYW1lKSB7CgkJICAgICAgICB0aGlzLnNjYW4oKTsKCQkgICAgICAgIHJldHVybiBoYXNPd24uY2FsbCh0aGlzLnR5cGVzLCBuYW1lKTsKCQkgICAgfTsKCQkgICAgU3AuZGVjbGFyZVRlbXBvcmFyeSA9IGZ1bmN0aW9uIChwcmVmaXgpIHsKCQkgICAgICAgIGlmIChwcmVmaXgpIHsKCQkgICAgICAgICAgICBpZiAoIS9eW2EteiRfXS9pLnRlc3QocHJlZml4KSkgewoJCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgIH0KCQkgICAgICAgIGVsc2UgewoJCSAgICAgICAgICAgIHByZWZpeCA9ICJ0JCI7CgkJICAgICAgICB9CgkJICAgICAgICAvLyBJbmNsdWRlIHRoaXMuZGVwdGggaW4gdGhlIG5hbWUgdG8gbWFrZSBzdXJlIHRoZSBuYW1lIGRvZXMgbm90CgkJICAgICAgICAvLyBjb2xsaWRlIHdpdGggYW55IHZhcmlhYmxlcyBpbiBuZXN0ZWQvZW5jbG9zaW5nIHNjb3Blcy4KCQkgICAgICAgIHByZWZpeCArPSB0aGlzLmRlcHRoLnRvU3RyaW5nKDM2KSArICIkIjsKCQkgICAgICAgIHRoaXMuc2NhbigpOwoJCSAgICAgICAgdmFyIGluZGV4ID0gMDsKCQkgICAgICAgIHdoaWxlICh0aGlzLmRlY2xhcmVzKHByZWZpeCArIGluZGV4KSkgewoJCSAgICAgICAgICAgICsraW5kZXg7CgkJICAgICAgICB9CgkJICAgICAgICB2YXIgbmFtZSA9IHByZWZpeCArIGluZGV4OwoJCSAgICAgICAgcmV0dXJuIHRoaXMuYmluZGluZ3NbbmFtZV0gPSB0eXBlcy5idWlsZGVycy5pZGVudGlmaWVyKG5hbWUpOwoJCSAgICB9OwoJCSAgICBTcC5pbmplY3RUZW1wb3JhcnkgPSBmdW5jdGlvbiAoaWRlbnRpZmllciwgaW5pdCkgewoJCSAgICAgICAgaWRlbnRpZmllciB8fCAoaWRlbnRpZmllciA9IHRoaXMuZGVjbGFyZVRlbXBvcmFyeSgpKTsKCQkgICAgICAgIHZhciBib2R5UGF0aCA9IHRoaXMucGF0aC5nZXQoImJvZHkiKTsKCQkgICAgICAgIGlmIChuYW1lZFR5cGVzLkJsb2NrU3RhdGVtZW50LmNoZWNrKGJvZHlQYXRoLnZhbHVlKSkgewoJCSAgICAgICAgICAgIGJvZHlQYXRoID0gYm9keVBhdGguZ2V0KCJib2R5Iik7CgkJICAgICAgICB9CgkJICAgICAgICBib2R5UGF0aC51bnNoaWZ0KGIudmFyaWFibGVEZWNsYXJhdGlvbigidmFyIiwgW2IudmFyaWFibGVEZWNsYXJhdG9yKGlkZW50aWZpZXIsIGluaXQgfHwgbnVsbCldKSk7CgkJICAgICAgICByZXR1cm4gaWRlbnRpZmllcjsKCQkgICAgfTsKCQkgICAgU3Auc2NhbiA9IGZ1bmN0aW9uIChmb3JjZSkgewoJCSAgICAgICAgaWYgKGZvcmNlIHx8ICF0aGlzLmRpZFNjYW4pIHsKCQkgICAgICAgICAgICBmb3IgKHZhciBuYW1lIGluIHRoaXMuYmluZGluZ3MpIHsKCQkgICAgICAgICAgICAgICAgLy8gRW1wdHkgb3V0IHRoaXMuYmluZGluZ3MsIGp1c3QgaW4gY2FzZXMuCgkJICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmJpbmRpbmdzW25hbWVdOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBzY2FuU2NvcGUodGhpcy5wYXRoLCB0aGlzLmJpbmRpbmdzLCB0aGlzLnR5cGVzKTsKCQkgICAgICAgICAgICB0aGlzLmRpZFNjYW4gPSB0cnVlOwoJCSAgICAgICAgfQoJCSAgICB9OwoJCSAgICBTcC5nZXRCaW5kaW5ncyA9IGZ1bmN0aW9uICgpIHsKCQkgICAgICAgIHRoaXMuc2NhbigpOwoJCSAgICAgICAgcmV0dXJuIHRoaXMuYmluZGluZ3M7CgkJICAgIH07CgkJICAgIFNwLmdldFR5cGVzID0gZnVuY3Rpb24gKCkgewoJCSAgICAgICAgdGhpcy5zY2FuKCk7CgkJICAgICAgICByZXR1cm4gdGhpcy50eXBlczsKCQkgICAgfTsKCQkgICAgZnVuY3Rpb24gc2NhblNjb3BlKHBhdGgsIGJpbmRpbmdzLCBzY29wZVR5cGVzKSB7CgkJICAgICAgICB2YXIgbm9kZSA9IHBhdGgudmFsdWU7CgkJICAgICAgICBTY29wZVR5cGUuYXNzZXJ0KG5vZGUpOwoJCSAgICAgICAgaWYgKG5hbWVkVHlwZXMuQ2F0Y2hDbGF1c2UuY2hlY2sobm9kZSkpIHsKCQkgICAgICAgICAgICAvLyBBIGNhdGNoIGNsYXVzZSBlc3RhYmxpc2hlcyBhIG5ldyBzY29wZSBidXQgdGhlIG9ubHkgdmFyaWFibGUKCQkgICAgICAgICAgICAvLyBib3VuZCBpbiB0aGF0IHNjb3BlIGlzIHRoZSBjYXRjaCBwYXJhbWV0ZXIuIEFueSBvdGhlcgoJCSAgICAgICAgICAgIC8vIGRlY2xhcmF0aW9ucyBjcmVhdGUgYmluZGluZ3MgaW4gdGhlIG91dGVyIHNjb3BlLgoJCSAgICAgICAgICAgIHZhciBwYXJhbSA9IHBhdGguZ2V0KCJwYXJhbSIpOwoJCSAgICAgICAgICAgIGlmIChwYXJhbS52YWx1ZSkgewoJCSAgICAgICAgICAgICAgICBhZGRQYXR0ZXJuKHBhcmFtLCBiaW5kaW5ncyk7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgfQoJCSAgICAgICAgZWxzZSB7CgkJICAgICAgICAgICAgcmVjdXJzaXZlU2NhblNjb3BlKHBhdGgsIGJpbmRpbmdzLCBzY29wZVR5cGVzKTsKCQkgICAgICAgIH0KCQkgICAgfQoJCSAgICBmdW5jdGlvbiByZWN1cnNpdmVTY2FuU2NvcGUocGF0aCwgYmluZGluZ3MsIHNjb3BlVHlwZXMpIHsKCQkgICAgICAgIHZhciBub2RlID0gcGF0aC52YWx1ZTsKCQkgICAgICAgIGlmIChwYXRoLnBhcmVudCAmJgoJCSAgICAgICAgICAgIG5hbWVkVHlwZXMuRnVuY3Rpb25FeHByZXNzaW9uLmNoZWNrKHBhdGgucGFyZW50Lm5vZGUpICYmCgkJICAgICAgICAgICAgcGF0aC5wYXJlbnQubm9kZS5pZCkgewoJCSAgICAgICAgICAgIGFkZFBhdHRlcm4ocGF0aC5wYXJlbnQuZ2V0KCJpZCIpLCBiaW5kaW5ncyk7CgkJICAgICAgICB9CgkJICAgICAgICBpZiAoIW5vZGUpIDsKCQkgICAgICAgIGVsc2UgaWYgKGlzQXJyYXkuY2hlY2sobm9kZSkpIHsKCQkgICAgICAgICAgICBwYXRoLmVhY2goZnVuY3Rpb24gKGNoaWxkUGF0aCkgewoJCSAgICAgICAgICAgICAgICByZWN1cnNpdmVTY2FuQ2hpbGQoY2hpbGRQYXRoLCBiaW5kaW5ncywgc2NvcGVUeXBlcyk7CgkJICAgICAgICAgICAgfSk7CgkJICAgICAgICB9CgkJICAgICAgICBlbHNlIGlmIChuYW1lZFR5cGVzLkZ1bmN0aW9uLmNoZWNrKG5vZGUpKSB7CgkJICAgICAgICAgICAgcGF0aC5nZXQoInBhcmFtcyIpLmVhY2goZnVuY3Rpb24gKHBhcmFtUGF0aCkgewoJCSAgICAgICAgICAgICAgICBhZGRQYXR0ZXJuKHBhcmFtUGF0aCwgYmluZGluZ3MpOwoJCSAgICAgICAgICAgIH0pOwoJCSAgICAgICAgICAgIHJlY3Vyc2l2ZVNjYW5DaGlsZChwYXRoLmdldCgiYm9keSIpLCBiaW5kaW5ncywgc2NvcGVUeXBlcyk7CgkJICAgICAgICB9CgkJICAgICAgICBlbHNlIGlmICgobmFtZWRUeXBlcy5UeXBlQWxpYXMgJiYgbmFtZWRUeXBlcy5UeXBlQWxpYXMuY2hlY2sobm9kZSkpIHx8CgkJICAgICAgICAgICAgKG5hbWVkVHlwZXMuSW50ZXJmYWNlRGVjbGFyYXRpb24gJiYgbmFtZWRUeXBlcy5JbnRlcmZhY2VEZWNsYXJhdGlvbi5jaGVjayhub2RlKSkgfHwKCQkgICAgICAgICAgICAobmFtZWRUeXBlcy5UU1R5cGVBbGlhc0RlY2xhcmF0aW9uICYmIG5hbWVkVHlwZXMuVFNUeXBlQWxpYXNEZWNsYXJhdGlvbi5jaGVjayhub2RlKSkgfHwKCQkgICAgICAgICAgICAobmFtZWRUeXBlcy5UU0ludGVyZmFjZURlY2xhcmF0aW9uICYmIG5hbWVkVHlwZXMuVFNJbnRlcmZhY2VEZWNsYXJhdGlvbi5jaGVjayhub2RlKSkpIHsKCQkgICAgICAgICAgICBhZGRUeXBlUGF0dGVybihwYXRoLmdldCgiaWQiKSwgc2NvcGVUeXBlcyk7CgkJICAgICAgICB9CgkJICAgICAgICBlbHNlIGlmIChuYW1lZFR5cGVzLlZhcmlhYmxlRGVjbGFyYXRvci5jaGVjayhub2RlKSkgewoJCSAgICAgICAgICAgIGFkZFBhdHRlcm4ocGF0aC5nZXQoImlkIiksIGJpbmRpbmdzKTsKCQkgICAgICAgICAgICByZWN1cnNpdmVTY2FuQ2hpbGQocGF0aC5nZXQoImluaXQiKSwgYmluZGluZ3MsIHNjb3BlVHlwZXMpOwoJCSAgICAgICAgfQoJCSAgICAgICAgZWxzZSBpZiAobm9kZS50eXBlID09PSAiSW1wb3J0U3BlY2lmaWVyIiB8fAoJCSAgICAgICAgICAgIG5vZGUudHlwZSA9PT0gIkltcG9ydE5hbWVzcGFjZVNwZWNpZmllciIgfHwKCQkgICAgICAgICAgICBub2RlLnR5cGUgPT09ICJJbXBvcnREZWZhdWx0U3BlY2lmaWVyIikgewoJCSAgICAgICAgICAgIGFkZFBhdHRlcm4oCgkJICAgICAgICAgICAgLy8gRXNwcmltYSB1c2VkIHRvIHVzZSB0aGUgLm5hbWUgZmllbGQgdG8gcmVmZXIgdG8gdGhlIGxvY2FsCgkJICAgICAgICAgICAgLy8gYmluZGluZyBpZGVudGlmaWVyIGZvciBJbXBvcnRTcGVjaWZpZXIgbm9kZXMsIGJ1dCAuaWQgZm9yCgkJICAgICAgICAgICAgLy8gSW1wb3J0TmFtZXNwYWNlU3BlY2lmaWVyIGFuZCBJbXBvcnREZWZhdWx0U3BlY2lmaWVyIG5vZGVzLgoJCSAgICAgICAgICAgIC8vIEVTVHJlZS9BY29ybi9FU3ByZWUgdXNlIC5sb2NhbCBmb3IgYWxsIHRocmVlIG5vZGUgdHlwZXMuCgkJICAgICAgICAgICAgcGF0aC5nZXQobm9kZS5sb2NhbCA/ICJsb2NhbCIgOgoJCSAgICAgICAgICAgICAgICBub2RlLm5hbWUgPyAibmFtZSIgOiAiaWQiKSwgYmluZGluZ3MpOwoJCSAgICAgICAgfQoJCSAgICAgICAgZWxzZSBpZiAoTm9kZS5jaGVjayhub2RlKSAmJiAhRXhwcmVzc2lvbi5jaGVjayhub2RlKSkgewoJCSAgICAgICAgICAgIHR5cGVzLmVhY2hGaWVsZChub2RlLCBmdW5jdGlvbiAobmFtZSwgY2hpbGQpIHsKCQkgICAgICAgICAgICAgICAgdmFyIGNoaWxkUGF0aCA9IHBhdGguZ2V0KG5hbWUpOwoJCSAgICAgICAgICAgICAgICBpZiAoIXBhdGhIYXNWYWx1ZShjaGlsZFBhdGgsIGNoaWxkKSkgewoJCSAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICByZWN1cnNpdmVTY2FuQ2hpbGQoY2hpbGRQYXRoLCBiaW5kaW5ncywgc2NvcGVUeXBlcyk7CgkJICAgICAgICAgICAgfSk7CgkJICAgICAgICB9CgkJICAgIH0KCQkgICAgZnVuY3Rpb24gcGF0aEhhc1ZhbHVlKHBhdGgsIHZhbHVlKSB7CgkJICAgICAgICBpZiAocGF0aC52YWx1ZSA9PT0gdmFsdWUpIHsKCQkgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgICAgICAgIH0KCQkgICAgICAgIC8vIEVtcHR5IGFycmF5cyBhcmUgcHJvYmFibHkgcHJvZHVjZWQgYnkgZGVmYXVsdHMuZW1wdHlBcnJheSwgaW4gd2hpY2gKCQkgICAgICAgIC8vIGNhc2UgaXMgbWFrZXMgc2Vuc2UgdG8gcmVnYXJkIHRoZW0gYXMgZXF1aXZhbGVudCwgaWYgbm90ID09PS4KCQkgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHBhdGgudmFsdWUpICYmCgkJICAgICAgICAgICAgcGF0aC52YWx1ZS5sZW5ndGggPT09IDAgJiYKCQkgICAgICAgICAgICBBcnJheS5pc0FycmF5KHZhbHVlKSAmJgoJCSAgICAgICAgICAgIHZhbHVlLmxlbmd0aCA9PT0gMCkgewoJCSAgICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAgICAgICAgfQoJCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAgICB9CgkJICAgIGZ1bmN0aW9uIHJlY3Vyc2l2ZVNjYW5DaGlsZChwYXRoLCBiaW5kaW5ncywgc2NvcGVUeXBlcykgewoJCSAgICAgICAgdmFyIG5vZGUgPSBwYXRoLnZhbHVlOwoJCSAgICAgICAgaWYgKCFub2RlIHx8IEV4cHJlc3Npb24uY2hlY2sobm9kZSkpIDsKCQkgICAgICAgIGVsc2UgaWYgKG5hbWVkVHlwZXMuRnVuY3Rpb25EZWNsYXJhdGlvbi5jaGVjayhub2RlKSAmJgoJCSAgICAgICAgICAgIG5vZGUuaWQgIT09IG51bGwpIHsKCQkgICAgICAgICAgICBhZGRQYXR0ZXJuKHBhdGguZ2V0KCJpZCIpLCBiaW5kaW5ncyk7CgkJICAgICAgICB9CgkJICAgICAgICBlbHNlIGlmIChuYW1lZFR5cGVzLkNsYXNzRGVjbGFyYXRpb24gJiYKCQkgICAgICAgICAgICBuYW1lZFR5cGVzLkNsYXNzRGVjbGFyYXRpb24uY2hlY2sobm9kZSkpIHsKCQkgICAgICAgICAgICBhZGRQYXR0ZXJuKHBhdGguZ2V0KCJpZCIpLCBiaW5kaW5ncyk7CgkJICAgICAgICB9CgkJICAgICAgICBlbHNlIGlmIChTY29wZVR5cGUuY2hlY2sobm9kZSkpIHsKCQkgICAgICAgICAgICBpZiAobmFtZWRUeXBlcy5DYXRjaENsYXVzZS5jaGVjayhub2RlKSAmJgoJCSAgICAgICAgICAgICAgICAvLyBUT0RPIEJyb2FkZW4gdGhpcyB0byBhY2NlcHQgYW55IHBhdHRlcm4uCgkJICAgICAgICAgICAgICAgIG5hbWVkVHlwZXMuSWRlbnRpZmllci5jaGVjayhub2RlLnBhcmFtKSkgewoJCSAgICAgICAgICAgICAgICB2YXIgY2F0Y2hQYXJhbU5hbWUgPSBub2RlLnBhcmFtLm5hbWU7CgkJICAgICAgICAgICAgICAgIHZhciBoYWRCaW5kaW5nID0gaGFzT3duLmNhbGwoYmluZGluZ3MsIGNhdGNoUGFyYW1OYW1lKTsKCQkgICAgICAgICAgICAgICAgLy8gQW55IGRlY2xhcmF0aW9ucyB0aGF0IG9jY3VyIGluc2lkZSB0aGUgY2F0Y2ggYm9keSB0aGF0IGRvCgkJICAgICAgICAgICAgICAgIC8vIG5vdCBoYXZlIHRoZSBzYW1lIG5hbWUgYXMgdGhlIGNhdGNoIHBhcmFtZXRlciBzaG91bGQgY291bnQKCQkgICAgICAgICAgICAgICAgLy8gYXMgYmluZGluZ3MgaW4gdGhlIG91dGVyIHNjb3BlLgoJCSAgICAgICAgICAgICAgICByZWN1cnNpdmVTY2FuU2NvcGUocGF0aC5nZXQoImJvZHkiKSwgYmluZGluZ3MsIHNjb3BlVHlwZXMpOwoJCSAgICAgICAgICAgICAgICAvLyBJZiBhIG5ldyBiaW5kaW5nIG1hdGNoaW5nIHRoZSBjYXRjaCBwYXJhbWV0ZXIgbmFtZSB3YXMKCQkgICAgICAgICAgICAgICAgLy8gY3JlYXRlZCB3aGlsZSBzY2FubmluZyB0aGUgY2F0Y2ggYm9keSwgaWdub3JlIGl0IGJlY2F1c2UgaXQKCQkgICAgICAgICAgICAgICAgLy8gYWN0dWFsbHkgcmVmZXJzIHRvIHRoZSBjYXRjaCBwYXJhbWV0ZXIgYW5kIG5vdCB0aGUgb3V0ZXIKCQkgICAgICAgICAgICAgICAgLy8gc2NvcGUgdGhhdCB3ZSdyZSBjdXJyZW50bHkgc2Nhbm5pbmcuCgkJICAgICAgICAgICAgICAgIGlmICghaGFkQmluZGluZykgewoJCSAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGJpbmRpbmdzW2NhdGNoUGFyYW1OYW1lXTsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIH0KCQkgICAgICAgIH0KCQkgICAgICAgIGVsc2UgewoJCSAgICAgICAgICAgIHJlY3Vyc2l2ZVNjYW5TY29wZShwYXRoLCBiaW5kaW5ncywgc2NvcGVUeXBlcyk7CgkJICAgICAgICB9CgkJICAgIH0KCQkgICAgZnVuY3Rpb24gYWRkUGF0dGVybihwYXR0ZXJuUGF0aCwgYmluZGluZ3MpIHsKCQkgICAgICAgIHZhciBwYXR0ZXJuID0gcGF0dGVyblBhdGgudmFsdWU7CgkJICAgICAgICBuYW1lZFR5cGVzLlBhdHRlcm4uYXNzZXJ0KHBhdHRlcm4pOwoJCSAgICAgICAgaWYgKG5hbWVkVHlwZXMuSWRlbnRpZmllci5jaGVjayhwYXR0ZXJuKSkgewoJCSAgICAgICAgICAgIGlmIChoYXNPd24uY2FsbChiaW5kaW5ncywgcGF0dGVybi5uYW1lKSkgewoJCSAgICAgICAgICAgICAgICBiaW5kaW5nc1twYXR0ZXJuLm5hbWVdLnB1c2gocGF0dGVyblBhdGgpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBlbHNlIHsKCQkgICAgICAgICAgICAgICAgYmluZGluZ3NbcGF0dGVybi5uYW1lXSA9IFtwYXR0ZXJuUGF0aF07CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgfQoJCSAgICAgICAgZWxzZSBpZiAobmFtZWRUeXBlcy5Bc3NpZ25tZW50UGF0dGVybiAmJgoJCSAgICAgICAgICAgIG5hbWVkVHlwZXMuQXNzaWdubWVudFBhdHRlcm4uY2hlY2socGF0dGVybikpIHsKCQkgICAgICAgICAgICBhZGRQYXR0ZXJuKHBhdHRlcm5QYXRoLmdldCgnbGVmdCcpLCBiaW5kaW5ncyk7CgkJICAgICAgICB9CgkJICAgICAgICBlbHNlIGlmIChuYW1lZFR5cGVzLk9iamVjdFBhdHRlcm4gJiYKCQkgICAgICAgICAgICBuYW1lZFR5cGVzLk9iamVjdFBhdHRlcm4uY2hlY2socGF0dGVybikpIHsKCQkgICAgICAgICAgICBwYXR0ZXJuUGF0aC5nZXQoJ3Byb3BlcnRpZXMnKS5lYWNoKGZ1bmN0aW9uIChwcm9wZXJ0eVBhdGgpIHsKCQkgICAgICAgICAgICAgICAgdmFyIHByb3BlcnR5ID0gcHJvcGVydHlQYXRoLnZhbHVlOwoJCSAgICAgICAgICAgICAgICBpZiAobmFtZWRUeXBlcy5QYXR0ZXJuLmNoZWNrKHByb3BlcnR5KSkgewoJCSAgICAgICAgICAgICAgICAgICAgYWRkUGF0dGVybihwcm9wZXJ0eVBhdGgsIGJpbmRpbmdzKTsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICBlbHNlIGlmIChuYW1lZFR5cGVzLlByb3BlcnR5LmNoZWNrKHByb3BlcnR5KSkgewoJCSAgICAgICAgICAgICAgICAgICAgYWRkUGF0dGVybihwcm9wZXJ0eVBhdGguZ2V0KCd2YWx1ZScpLCBiaW5kaW5ncyk7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgZWxzZSBpZiAobmFtZWRUeXBlcy5TcHJlYWRQcm9wZXJ0eSAmJgoJCSAgICAgICAgICAgICAgICAgICAgbmFtZWRUeXBlcy5TcHJlYWRQcm9wZXJ0eS5jaGVjayhwcm9wZXJ0eSkpIHsKCQkgICAgICAgICAgICAgICAgICAgIGFkZFBhdHRlcm4ocHJvcGVydHlQYXRoLmdldCgnYXJndW1lbnQnKSwgYmluZGluZ3MpOwoJCSAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgfSk7CgkJICAgICAgICB9CgkJICAgICAgICBlbHNlIGlmIChuYW1lZFR5cGVzLkFycmF5UGF0dGVybiAmJgoJCSAgICAgICAgICAgIG5hbWVkVHlwZXMuQXJyYXlQYXR0ZXJuLmNoZWNrKHBhdHRlcm4pKSB7CgkJICAgICAgICAgICAgcGF0dGVyblBhdGguZ2V0KCdlbGVtZW50cycpLmVhY2goZnVuY3Rpb24gKGVsZW1lbnRQYXRoKSB7CgkJICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gZWxlbWVudFBhdGgudmFsdWU7CgkJICAgICAgICAgICAgICAgIGlmIChuYW1lZFR5cGVzLlBhdHRlcm4uY2hlY2soZWxlbWVudCkpIHsKCQkgICAgICAgICAgICAgICAgICAgIGFkZFBhdHRlcm4oZWxlbWVudFBhdGgsIGJpbmRpbmdzKTsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICBlbHNlIGlmIChuYW1lZFR5cGVzLlNwcmVhZEVsZW1lbnQgJiYKCQkgICAgICAgICAgICAgICAgICAgIG5hbWVkVHlwZXMuU3ByZWFkRWxlbWVudC5jaGVjayhlbGVtZW50KSkgewoJCSAgICAgICAgICAgICAgICAgICAgYWRkUGF0dGVybihlbGVtZW50UGF0aC5nZXQoImFyZ3VtZW50IiksIGJpbmRpbmdzKTsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIH0pOwoJCSAgICAgICAgfQoJCSAgICAgICAgZWxzZSBpZiAobmFtZWRUeXBlcy5Qcm9wZXJ0eVBhdHRlcm4gJiYKCQkgICAgICAgICAgICBuYW1lZFR5cGVzLlByb3BlcnR5UGF0dGVybi5jaGVjayhwYXR0ZXJuKSkgewoJCSAgICAgICAgICAgIGFkZFBhdHRlcm4ocGF0dGVyblBhdGguZ2V0KCdwYXR0ZXJuJyksIGJpbmRpbmdzKTsKCQkgICAgICAgIH0KCQkgICAgICAgIGVsc2UgaWYgKChuYW1lZFR5cGVzLlNwcmVhZEVsZW1lbnRQYXR0ZXJuICYmCgkJICAgICAgICAgICAgbmFtZWRUeXBlcy5TcHJlYWRFbGVtZW50UGF0dGVybi5jaGVjayhwYXR0ZXJuKSkgfHwKCQkgICAgICAgICAgICAobmFtZWRUeXBlcy5SZXN0RWxlbWVudCAmJgoJCSAgICAgICAgICAgICAgICBuYW1lZFR5cGVzLlJlc3RFbGVtZW50LmNoZWNrKHBhdHRlcm4pKSB8fAoJCSAgICAgICAgICAgIChuYW1lZFR5cGVzLlNwcmVhZFByb3BlcnR5UGF0dGVybiAmJgoJCSAgICAgICAgICAgICAgICBuYW1lZFR5cGVzLlNwcmVhZFByb3BlcnR5UGF0dGVybi5jaGVjayhwYXR0ZXJuKSkpIHsKCQkgICAgICAgICAgICBhZGRQYXR0ZXJuKHBhdHRlcm5QYXRoLmdldCgnYXJndW1lbnQnKSwgYmluZGluZ3MpOwoJCSAgICAgICAgfQoJCSAgICB9CgkJICAgIGZ1bmN0aW9uIGFkZFR5cGVQYXR0ZXJuKHBhdHRlcm5QYXRoLCB0eXBlcykgewoJCSAgICAgICAgdmFyIHBhdHRlcm4gPSBwYXR0ZXJuUGF0aC52YWx1ZTsKCQkgICAgICAgIG5hbWVkVHlwZXMuUGF0dGVybi5hc3NlcnQocGF0dGVybik7CgkJICAgICAgICBpZiAobmFtZWRUeXBlcy5JZGVudGlmaWVyLmNoZWNrKHBhdHRlcm4pKSB7CgkJICAgICAgICAgICAgaWYgKGhhc093bi5jYWxsKHR5cGVzLCBwYXR0ZXJuLm5hbWUpKSB7CgkJICAgICAgICAgICAgICAgIHR5cGVzW3BhdHRlcm4ubmFtZV0ucHVzaChwYXR0ZXJuUGF0aCk7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGVsc2UgewoJCSAgICAgICAgICAgICAgICB0eXBlc1twYXR0ZXJuLm5hbWVdID0gW3BhdHRlcm5QYXRoXTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICB9CgkJICAgIH0KCQkgICAgU3AubG9va3VwID0gZnVuY3Rpb24gKG5hbWUpIHsKCQkgICAgICAgIGZvciAodmFyIHNjb3BlID0gdGhpczsgc2NvcGU7IHNjb3BlID0gc2NvcGUucGFyZW50KQoJCSAgICAgICAgICAgIGlmIChzY29wZS5kZWNsYXJlcyhuYW1lKSkKCQkgICAgICAgICAgICAgICAgYnJlYWs7CgkJICAgICAgICByZXR1cm4gc2NvcGU7CgkJICAgIH07CgkJICAgIFNwLmxvb2t1cFR5cGUgPSBmdW5jdGlvbiAobmFtZSkgewoJCSAgICAgICAgZm9yICh2YXIgc2NvcGUgPSB0aGlzOyBzY29wZTsgc2NvcGUgPSBzY29wZS5wYXJlbnQpCgkJICAgICAgICAgICAgaWYgKHNjb3BlLmRlY2xhcmVzVHlwZShuYW1lKSkKCQkgICAgICAgICAgICAgICAgYnJlYWs7CgkJICAgICAgICByZXR1cm4gc2NvcGU7CgkJICAgIH07CgkJICAgIFNwLmdldEdsb2JhbFNjb3BlID0gZnVuY3Rpb24gKCkgewoJCSAgICAgICAgdmFyIHNjb3BlID0gdGhpczsKCQkgICAgICAgIHdoaWxlICghc2NvcGUuaXNHbG9iYWwpCgkJICAgICAgICAgICAgc2NvcGUgPSBzY29wZS5wYXJlbnQ7CgkJICAgICAgICByZXR1cm4gc2NvcGU7CgkJICAgIH07CgkJICAgIHJldHVybiBTY29wZTsKCQl9CgkJZXhwb3J0cy5kZWZhdWx0ID0gc2NvcGVQbHVnaW47CgkJbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07IAoJfSAoc2NvcGUkMSwgc2NvcGUkMS5leHBvcnRzKSk7CglyZXR1cm4gc2NvcGUkMS5leHBvcnRzOwp9Cgp2YXIgaGFzUmVxdWlyZWROb2RlUGF0aDsKCmZ1bmN0aW9uIHJlcXVpcmVOb2RlUGF0aCAoKSB7CglpZiAoaGFzUmVxdWlyZWROb2RlUGF0aCkgcmV0dXJuIG5vZGVQYXRoLmV4cG9ydHM7CgloYXNSZXF1aXJlZE5vZGVQYXRoID0gMTsKCShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCQl2YXIgdHNsaWJfMSA9IHJlcXVpcmUkJDA7CgkJdmFyIHR5cGVzXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlVHlwZXMoKSk7CgkJdmFyIHBhdGhfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVQYXRoKCkpOwoJCXZhciBzY29wZV8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVNjb3BlKCkpOwoJCWZ1bmN0aW9uIG5vZGVQYXRoUGx1Z2luKGZvcmspIHsKCQkgICAgdmFyIHR5cGVzID0gZm9yay51c2UodHlwZXNfMS5kZWZhdWx0KTsKCQkgICAgdmFyIG4gPSB0eXBlcy5uYW1lZFR5cGVzOwoJCSAgICB2YXIgYiA9IHR5cGVzLmJ1aWxkZXJzOwoJCSAgICB2YXIgaXNOdW1iZXIgPSB0eXBlcy5idWlsdEluVHlwZXMubnVtYmVyOwoJCSAgICB2YXIgaXNBcnJheSA9IHR5cGVzLmJ1aWx0SW5UeXBlcy5hcnJheTsKCQkgICAgdmFyIFBhdGggPSBmb3JrLnVzZShwYXRoXzEuZGVmYXVsdCk7CgkJICAgIHZhciBTY29wZSA9IGZvcmsudXNlKHNjb3BlXzEuZGVmYXVsdCk7CgkJICAgIHZhciBOb2RlUGF0aCA9IGZ1bmN0aW9uIE5vZGVQYXRoKHZhbHVlLCBwYXJlbnRQYXRoLCBuYW1lKSB7CgkJICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgTm9kZVBhdGgpKSB7CgkJICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJOb2RlUGF0aCBjb25zdHJ1Y3RvciBjYW5ub3QgYmUgaW52b2tlZCB3aXRob3V0ICduZXcnIik7CgkJICAgICAgICB9CgkJICAgICAgICBQYXRoLmNhbGwodGhpcywgdmFsdWUsIHBhcmVudFBhdGgsIG5hbWUpOwoJCSAgICB9OwoJCSAgICB2YXIgTlBwID0gTm9kZVBhdGgucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShQYXRoLnByb3RvdHlwZSwgewoJCSAgICAgICAgY29uc3RydWN0b3I6IHsKCQkgICAgICAgICAgICB2YWx1ZTogTm9kZVBhdGgsCgkJICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsCgkJICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsCgkJICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCgkJICAgICAgICB9CgkJICAgIH0pOwoJCSAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhOUHAsIHsKCQkgICAgICAgIG5vZGU6IHsKCQkgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsKCQkgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICJub2RlIiwgewoJCSAgICAgICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAoJCSAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX2NvbXB1dGVOb2RlKCkKCQkgICAgICAgICAgICAgICAgfSk7CgkJICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm5vZGU7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgfSwKCQkgICAgICAgIHBhcmVudDogewoJCSAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgewoJCSAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgInBhcmVudCIsIHsKCQkgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQkgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9jb21wdXRlUGFyZW50KCkKCQkgICAgICAgICAgICAgICAgfSk7CgkJICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcmVudDsKCQkgICAgICAgICAgICB9CgkJICAgICAgICB9LAoJCSAgICAgICAgc2NvcGU6IHsKCQkgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsKCQkgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICJzY29wZSIsIHsKCQkgICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQkgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9jb21wdXRlU2NvcGUoKQoJCSAgICAgICAgICAgICAgICB9KTsKCQkgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2NvcGU7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgfQoJCSAgICB9KTsKCQkgICAgTlBwLnJlcGxhY2UgPSBmdW5jdGlvbiAoKSB7CgkJICAgICAgICBkZWxldGUgdGhpcy5ub2RlOwoJCSAgICAgICAgZGVsZXRlIHRoaXMucGFyZW50OwoJCSAgICAgICAgZGVsZXRlIHRoaXMuc2NvcGU7CgkJICAgICAgICByZXR1cm4gUGF0aC5wcm90b3R5cGUucmVwbGFjZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCSAgICB9OwoJCSAgICBOUHAucHJ1bmUgPSBmdW5jdGlvbiAoKSB7CgkJICAgICAgICB2YXIgcmVtYWluaW5nTm9kZVBhdGggPSB0aGlzLnBhcmVudDsKCQkgICAgICAgIHRoaXMucmVwbGFjZSgpOwoJCSAgICAgICAgcmV0dXJuIGNsZWFuVXBOb2Rlc0FmdGVyUHJ1bmUocmVtYWluaW5nTm9kZVBhdGgpOwoJCSAgICB9OwoJCSAgICAvLyBUaGUgdmFsdWUgb2YgdGhlIGZpcnN0IGFuY2VzdG9yIFBhdGggd2hvc2UgdmFsdWUgaXMgYSBOb2RlLgoJCSAgICBOUHAuX2NvbXB1dGVOb2RlID0gZnVuY3Rpb24gKCkgewoJCSAgICAgICAgdmFyIHZhbHVlID0gdGhpcy52YWx1ZTsKCQkgICAgICAgIGlmIChuLk5vZGUuY2hlY2sodmFsdWUpKSB7CgkJICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwoJCSAgICAgICAgfQoJCSAgICAgICAgdmFyIHBwID0gdGhpcy5wYXJlbnRQYXRoOwoJCSAgICAgICAgcmV0dXJuIHBwICYmIHBwLm5vZGUgfHwgbnVsbDsKCQkgICAgfTsKCQkgICAgLy8gVGhlIGZpcnN0IGFuY2VzdG9yIFBhdGggd2hvc2UgdmFsdWUgaXMgYSBOb2RlIGRpc3RpbmN0IGZyb20gdGhpcy5ub2RlLgoJCSAgICBOUHAuX2NvbXB1dGVQYXJlbnQgPSBmdW5jdGlvbiAoKSB7CgkJICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLnZhbHVlOwoJCSAgICAgICAgdmFyIHBwID0gdGhpcy5wYXJlbnRQYXRoOwoJCSAgICAgICAgaWYgKCFuLk5vZGUuY2hlY2sodmFsdWUpKSB7CgkJICAgICAgICAgICAgd2hpbGUgKHBwICYmICFuLk5vZGUuY2hlY2socHAudmFsdWUpKSB7CgkJICAgICAgICAgICAgICAgIHBwID0gcHAucGFyZW50UGF0aDsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgaWYgKHBwKSB7CgkJICAgICAgICAgICAgICAgIHBwID0gcHAucGFyZW50UGF0aDsKCQkgICAgICAgICAgICB9CgkJICAgICAgICB9CgkJICAgICAgICB3aGlsZSAocHAgJiYgIW4uTm9kZS5jaGVjayhwcC52YWx1ZSkpIHsKCQkgICAgICAgICAgICBwcCA9IHBwLnBhcmVudFBhdGg7CgkJICAgICAgICB9CgkJICAgICAgICByZXR1cm4gcHAgfHwgbnVsbDsKCQkgICAgfTsKCQkgICAgLy8gVGhlIGNsb3Nlc3QgZW5jbG9zaW5nIHNjb3BlIHRoYXQgZ292ZXJucyB0aGlzIG5vZGUuCgkJICAgIE5QcC5fY29tcHV0ZVNjb3BlID0gZnVuY3Rpb24gKCkgewoJCSAgICAgICAgdmFyIHZhbHVlID0gdGhpcy52YWx1ZTsKCQkgICAgICAgIHZhciBwcCA9IHRoaXMucGFyZW50UGF0aDsKCQkgICAgICAgIHZhciBzY29wZSA9IHBwICYmIHBwLnNjb3BlOwoJCSAgICAgICAgaWYgKG4uTm9kZS5jaGVjayh2YWx1ZSkgJiYKCQkgICAgICAgICAgICBTY29wZS5pc0VzdGFibGlzaGVkQnkodmFsdWUpKSB7CgkJICAgICAgICAgICAgc2NvcGUgPSBuZXcgU2NvcGUodGhpcywgc2NvcGUpOwoJCSAgICAgICAgfQoJCSAgICAgICAgcmV0dXJuIHNjb3BlIHx8IG51bGw7CgkJICAgIH07CgkJICAgIE5QcC5nZXRWYWx1ZVByb3BlcnR5ID0gZnVuY3Rpb24gKG5hbWUpIHsKCQkgICAgICAgIHJldHVybiB0eXBlcy5nZXRGaWVsZFZhbHVlKHRoaXMudmFsdWUsIG5hbWUpOwoJCSAgICB9OwoJCSAgICAvKioKCQkgICAgICogRGV0ZXJtaW5lIHdoZXRoZXIgdGhpcy5ub2RlIG5lZWRzIHRvIGJlIHdyYXBwZWQgaW4gcGFyZW50aGVzZXMgaW4gb3JkZXIKCQkgICAgICogZm9yIGEgcGFyc2VyIHRvIHJlcHJvZHVjZSB0aGUgc2FtZSBsb2NhbCBBU1Qgc3RydWN0dXJlLgoJCSAgICAgKgoJCSAgICAgKiBGb3IgaW5zdGFuY2UsIGluIHRoZSBleHByZXNzaW9uIGAoMSArIDIpICogM2AsIHRoZSBCaW5hcnlFeHByZXNzaW9uCgkJICAgICAqIHdob3NlIG9wZXJhdG9yIGlzICIrIiBuZWVkcyBwYXJlbnRoZXNlcywgYmVjYXVzZSBgMSArIDIgKiAzYCB3b3VsZAoJCSAgICAgKiBwYXJzZSBkaWZmZXJlbnRseS4KCQkgICAgICoKCQkgICAgICogSWYgYXNzdW1lRXhwcmVzc2lvbkNvbnRleHQgPT09IHRydWUsIHdlIGRvbid0IHdvcnJ5IGFib3V0IGVkZ2UgY2FzZXMKCQkgICAgICogbGlrZSBhbiBhbm9ueW1vdXMgRnVuY3Rpb25FeHByZXNzaW9uIGFwcGVhcmluZyBsZXhpY2FsbHkgZmlyc3QgaW4gaXRzCgkJICAgICAqIGVuY2xvc2luZyBzdGF0ZW1lbnQgYW5kIHRodXMgbmVlZGluZyBwYXJlbnRoZXNlcyB0byBhdm9pZCBiZWluZyBwYXJzZWQKCQkgICAgICogYXMgYSBGdW5jdGlvbkRlY2xhcmF0aW9uIHdpdGggYSBtaXNzaW5nIG5hbWUuCgkJICAgICAqLwoJCSAgICBOUHAubmVlZHNQYXJlbnMgPSBmdW5jdGlvbiAoYXNzdW1lRXhwcmVzc2lvbkNvbnRleHQpIHsKCQkgICAgICAgIHZhciBwcCA9IHRoaXMucGFyZW50UGF0aDsKCQkgICAgICAgIGlmICghcHApIHsKCQkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkJICAgICAgICB9CgkJICAgICAgICB2YXIgbm9kZSA9IHRoaXMudmFsdWU7CgkJICAgICAgICAvLyBPbmx5IGV4cHJlc3Npb25zIG5lZWQgcGFyZW50aGVzZXMuCgkJICAgICAgICBpZiAoIW4uRXhwcmVzc2lvbi5jaGVjayhub2RlKSkgewoJCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCQkgICAgICAgIH0KCQkgICAgICAgIC8vIElkZW50aWZpZXJzIG5ldmVyIG5lZWQgcGFyZW50aGVzZXMuCgkJICAgICAgICBpZiAobm9kZS50eXBlID09PSAiSWRlbnRpZmllciIpIHsKCQkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkJICAgICAgICB9CgkJICAgICAgICB3aGlsZSAoIW4uTm9kZS5jaGVjayhwcC52YWx1ZSkpIHsKCQkgICAgICAgICAgICBwcCA9IHBwLnBhcmVudFBhdGg7CgkJICAgICAgICAgICAgaWYgKCFwcCkgewoJCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgfQoJCSAgICAgICAgdmFyIHBhcmVudCA9IHBwLnZhbHVlOwoJCSAgICAgICAgc3dpdGNoIChub2RlLnR5cGUpIHsKCQkgICAgICAgICAgICBjYXNlICJVbmFyeUV4cHJlc3Npb24iOgoJCSAgICAgICAgICAgIGNhc2UgIlNwcmVhZEVsZW1lbnQiOgoJCSAgICAgICAgICAgIGNhc2UgIlNwcmVhZFByb3BlcnR5IjoKCQkgICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudC50eXBlID09PSAiTWVtYmVyRXhwcmVzc2lvbiIKCQkgICAgICAgICAgICAgICAgICAgICYmIHRoaXMubmFtZSA9PT0gIm9iamVjdCIKCQkgICAgICAgICAgICAgICAgICAgICYmIHBhcmVudC5vYmplY3QgPT09IG5vZGU7CgkJICAgICAgICAgICAgY2FzZSAiQmluYXJ5RXhwcmVzc2lvbiI6CgkJICAgICAgICAgICAgY2FzZSAiTG9naWNhbEV4cHJlc3Npb24iOgoJCSAgICAgICAgICAgICAgICBzd2l0Y2ggKHBhcmVudC50eXBlKSB7CgkJICAgICAgICAgICAgICAgICAgICBjYXNlICJDYWxsRXhwcmVzc2lvbiI6CgkJICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubmFtZSA9PT0gImNhbGxlZSIKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgcGFyZW50LmNhbGxlZSA9PT0gbm9kZTsKCQkgICAgICAgICAgICAgICAgICAgIGNhc2UgIlVuYXJ5RXhwcmVzc2lvbiI6CgkJICAgICAgICAgICAgICAgICAgICBjYXNlICJTcHJlYWRFbGVtZW50IjoKCQkgICAgICAgICAgICAgICAgICAgIGNhc2UgIlNwcmVhZFByb3BlcnR5IjoKCQkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgICAgICAgICAgICAgICAgICAgIGNhc2UgIk1lbWJlckV4cHJlc3Npb24iOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm5hbWUgPT09ICJvYmplY3QiCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmIHBhcmVudC5vYmplY3QgPT09IG5vZGU7CgkJICAgICAgICAgICAgICAgICAgICBjYXNlICJCaW5hcnlFeHByZXNzaW9uIjoKCQkgICAgICAgICAgICAgICAgICAgIGNhc2UgIkxvZ2ljYWxFeHByZXNzaW9uIjogewoJCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuXzEgPSBub2RlOwoJCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwbyA9IHBhcmVudC5vcGVyYXRvcjsKCQkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHBfMSA9IFBSRUNFREVOQ0VbcG9dOwoJCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBubyA9IG5fMS5vcGVyYXRvcjsKCQkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbnAgPSBQUkVDRURFTkNFW25vXTsKCQkgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHBfMSA+IG5wKSB7CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHBfMSA9PT0gbnAgJiYgdGhpcy5uYW1lID09PSAicmlnaHQiKSB7CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQucmlnaHQgIT09IG5fMSkgewoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJOb2RlcyBtdXN0IGJlIGVxdWFsIik7CgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkJICAgICAgICAgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBjYXNlICJTZXF1ZW5jZUV4cHJlc3Npb24iOgoJCSAgICAgICAgICAgICAgICBzd2l0Y2ggKHBhcmVudC50eXBlKSB7CgkJICAgICAgICAgICAgICAgICAgICBjYXNlICJGb3JTdGF0ZW1lbnQiOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFsdGhvdWdoIHBhcmVudGhlc2VzIHdvdWxkbid0IGh1cnQgYXJvdW5kIHNlcXVlbmNlCgkJICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXhwcmVzc2lvbnMgaW4gdGhlIGhlYWQgb2YgZm9yIGxvb3BzLCB0cmFkaXRpb25hbCBzdHlsZQoJCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRpY3RhdGVzIHRoYXQgZS5nLiBpKyssIGorKyBzaG91bGQgbm90IGJlIHdyYXBwZWQgd2l0aAoJCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIHBhcmVudGhlc2VzLgoJCSAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCQkgICAgICAgICAgICAgICAgICAgIGNhc2UgIkV4cHJlc3Npb25TdGF0ZW1lbnQiOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm5hbWUgIT09ICJleHByZXNzaW9uIjsKCQkgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CgkJICAgICAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlIGVyciBvbiB0aGUgc2lkZSBvZiBvdmVycGFyZW50aGVzaXphdGlvbiwgYWRkaW5nCgkJICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXhwbGljaXQgZXhjZXB0aW9ucyBhYm92ZSBpZiB0aGlzIHByb3ZlcyBvdmVyemVhbG91cy4KCQkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGNhc2UgIllpZWxkRXhwcmVzc2lvbiI6CgkJICAgICAgICAgICAgICAgIHN3aXRjaCAocGFyZW50LnR5cGUpIHsKCQkgICAgICAgICAgICAgICAgICAgIGNhc2UgIkJpbmFyeUV4cHJlc3Npb24iOgoJCSAgICAgICAgICAgICAgICAgICAgY2FzZSAiTG9naWNhbEV4cHJlc3Npb24iOgoJCSAgICAgICAgICAgICAgICAgICAgY2FzZSAiVW5hcnlFeHByZXNzaW9uIjoKCQkgICAgICAgICAgICAgICAgICAgIGNhc2UgIlNwcmVhZEVsZW1lbnQiOgoJCSAgICAgICAgICAgICAgICAgICAgY2FzZSAiU3ByZWFkUHJvcGVydHkiOgoJCSAgICAgICAgICAgICAgICAgICAgY2FzZSAiQ2FsbEV4cHJlc3Npb24iOgoJCSAgICAgICAgICAgICAgICAgICAgY2FzZSAiTWVtYmVyRXhwcmVzc2lvbiI6CgkJICAgICAgICAgICAgICAgICAgICBjYXNlICJOZXdFeHByZXNzaW9uIjoKCQkgICAgICAgICAgICAgICAgICAgIGNhc2UgIkNvbmRpdGlvbmFsRXhwcmVzc2lvbiI6CgkJICAgICAgICAgICAgICAgICAgICBjYXNlICJZaWVsZEV4cHJlc3Npb24iOgoJCSAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBjYXNlICJMaXRlcmFsIjoKCQkgICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudC50eXBlID09PSAiTWVtYmVyRXhwcmVzc2lvbiIKCQkgICAgICAgICAgICAgICAgICAgICYmIGlzTnVtYmVyLmNoZWNrKG5vZGUudmFsdWUpCgkJICAgICAgICAgICAgICAgICAgICAmJiB0aGlzLm5hbWUgPT09ICJvYmplY3QiCgkJICAgICAgICAgICAgICAgICAgICAmJiBwYXJlbnQub2JqZWN0ID09PSBub2RlOwoJCSAgICAgICAgICAgIGNhc2UgIkFzc2lnbm1lbnRFeHByZXNzaW9uIjoKCQkgICAgICAgICAgICBjYXNlICJDb25kaXRpb25hbEV4cHJlc3Npb24iOgoJCSAgICAgICAgICAgICAgICBzd2l0Y2ggKHBhcmVudC50eXBlKSB7CgkJICAgICAgICAgICAgICAgICAgICBjYXNlICJVbmFyeUV4cHJlc3Npb24iOgoJCSAgICAgICAgICAgICAgICAgICAgY2FzZSAiU3ByZWFkRWxlbWVudCI6CgkJICAgICAgICAgICAgICAgICAgICBjYXNlICJTcHJlYWRQcm9wZXJ0eSI6CgkJICAgICAgICAgICAgICAgICAgICBjYXNlICJCaW5hcnlFeHByZXNzaW9uIjoKCQkgICAgICAgICAgICAgICAgICAgIGNhc2UgIkxvZ2ljYWxFeHByZXNzaW9uIjoKCQkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgICAgICAgICAgICAgICAgICAgIGNhc2UgIkNhbGxFeHByZXNzaW9uIjoKCQkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uYW1lID09PSAiY2FsbGVlIgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiBwYXJlbnQuY2FsbGVlID09PSBub2RlOwoJCSAgICAgICAgICAgICAgICAgICAgY2FzZSAiQ29uZGl0aW9uYWxFeHByZXNzaW9uIjoKCQkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uYW1lID09PSAidGVzdCIKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgcGFyZW50LnRlc3QgPT09IG5vZGU7CgkJICAgICAgICAgICAgICAgICAgICBjYXNlICJNZW1iZXJFeHByZXNzaW9uIjoKCQkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uYW1lID09PSAib2JqZWN0IgoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiBwYXJlbnQub2JqZWN0ID09PSBub2RlOwoJCSAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKCQkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBkZWZhdWx0OgoJCSAgICAgICAgICAgICAgICBpZiAocGFyZW50LnR5cGUgPT09ICJOZXdFeHByZXNzaW9uIiAmJgoJCSAgICAgICAgICAgICAgICAgICAgdGhpcy5uYW1lID09PSAiY2FsbGVlIiAmJgoJCSAgICAgICAgICAgICAgICAgICAgcGFyZW50LmNhbGxlZSA9PT0gbm9kZSkgewoJCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRhaW5zQ2FsbEV4cHJlc3Npb24obm9kZSk7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgIH0KCQkgICAgICAgIGlmIChhc3N1bWVFeHByZXNzaW9uQ29udGV4dCAhPT0gdHJ1ZSAmJgoJCSAgICAgICAgICAgICF0aGlzLmNhbkJlRmlyc3RJblN0YXRlbWVudCgpICYmCgkJICAgICAgICAgICAgdGhpcy5maXJzdEluU3RhdGVtZW50KCkpCgkJICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkJICAgICAgICByZXR1cm4gZmFsc2U7CgkJICAgIH07CgkJICAgIGZ1bmN0aW9uIGlzQmluYXJ5KG5vZGUpIHsKCQkgICAgICAgIHJldHVybiBuLkJpbmFyeUV4cHJlc3Npb24uY2hlY2sobm9kZSkKCQkgICAgICAgICAgICB8fCBuLkxvZ2ljYWxFeHByZXNzaW9uLmNoZWNrKG5vZGUpOwoJCSAgICB9CgkJICAgIHZhciBQUkVDRURFTkNFID0ge307CgkJICAgIFtbInx8Il0sCgkJICAgICAgICBbIiYmIl0sCgkJICAgICAgICBbInwiXSwKCQkgICAgICAgIFsiXiJdLAoJCSAgICAgICAgWyImIl0sCgkJICAgICAgICBbIj09IiwgIj09PSIsICIhPSIsICIhPT0iXSwKCQkgICAgICAgIFsiPCIsICI+IiwgIjw9IiwgIj49IiwgImluIiwgImluc3RhbmNlb2YiXSwKCQkgICAgICAgIFsiPj4iLCAiPDwiLCAiPj4+Il0sCgkJICAgICAgICBbIisiLCAiLSJdLAoJCSAgICAgICAgWyIqIiwgIi8iLCAiJSJdCgkJICAgIF0uZm9yRWFjaChmdW5jdGlvbiAodGllciwgaSkgewoJCSAgICAgICAgdGllci5mb3JFYWNoKGZ1bmN0aW9uIChvcCkgewoJCSAgICAgICAgICAgIFBSRUNFREVOQ0Vbb3BdID0gaTsKCQkgICAgICAgIH0pOwoJCSAgICB9KTsKCQkgICAgZnVuY3Rpb24gY29udGFpbnNDYWxsRXhwcmVzc2lvbihub2RlKSB7CgkJICAgICAgICBpZiAobi5DYWxsRXhwcmVzc2lvbi5jaGVjayhub2RlKSkgewoJCSAgICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAgICAgICAgfQoJCSAgICAgICAgaWYgKGlzQXJyYXkuY2hlY2sobm9kZSkpIHsKCQkgICAgICAgICAgICByZXR1cm4gbm9kZS5zb21lKGNvbnRhaW5zQ2FsbEV4cHJlc3Npb24pOwoJCSAgICAgICAgfQoJCSAgICAgICAgaWYgKG4uTm9kZS5jaGVjayhub2RlKSkgewoJCSAgICAgICAgICAgIHJldHVybiB0eXBlcy5zb21lRmllbGQobm9kZSwgZnVuY3Rpb24gKF9uYW1lLCBjaGlsZCkgewoJCSAgICAgICAgICAgICAgICByZXR1cm4gY29udGFpbnNDYWxsRXhwcmVzc2lvbihjaGlsZCk7CgkJICAgICAgICAgICAgfSk7CgkJICAgICAgICB9CgkJICAgICAgICByZXR1cm4gZmFsc2U7CgkJICAgIH0KCQkgICAgTlBwLmNhbkJlRmlyc3RJblN0YXRlbWVudCA9IGZ1bmN0aW9uICgpIHsKCQkgICAgICAgIHZhciBub2RlID0gdGhpcy5ub2RlOwoJCSAgICAgICAgcmV0dXJuICFuLkZ1bmN0aW9uRXhwcmVzc2lvbi5jaGVjayhub2RlKQoJCSAgICAgICAgICAgICYmICFuLk9iamVjdEV4cHJlc3Npb24uY2hlY2sobm9kZSk7CgkJICAgIH07CgkJICAgIE5QcC5maXJzdEluU3RhdGVtZW50ID0gZnVuY3Rpb24gKCkgewoJCSAgICAgICAgcmV0dXJuIGZpcnN0SW5TdGF0ZW1lbnQodGhpcyk7CgkJICAgIH07CgkJICAgIGZ1bmN0aW9uIGZpcnN0SW5TdGF0ZW1lbnQocGF0aCkgewoJCSAgICAgICAgZm9yICh2YXIgbm9kZSwgcGFyZW50OyBwYXRoLnBhcmVudDsgcGF0aCA9IHBhdGgucGFyZW50KSB7CgkJICAgICAgICAgICAgbm9kZSA9IHBhdGgubm9kZTsKCQkgICAgICAgICAgICBwYXJlbnQgPSBwYXRoLnBhcmVudC5ub2RlOwoJCSAgICAgICAgICAgIGlmIChuLkJsb2NrU3RhdGVtZW50LmNoZWNrKHBhcmVudCkgJiYKCQkgICAgICAgICAgICAgICAgcGF0aC5wYXJlbnQubmFtZSA9PT0gImJvZHkiICYmCgkJICAgICAgICAgICAgICAgIHBhdGgubmFtZSA9PT0gMCkgewoJCSAgICAgICAgICAgICAgICBpZiAocGFyZW50LmJvZHlbMF0gIT09IG5vZGUpIHsKCQkgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTm9kZXMgbXVzdCBiZSBlcXVhbCIpOwoJCSAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBpZiAobi5FeHByZXNzaW9uU3RhdGVtZW50LmNoZWNrKHBhcmVudCkgJiYKCQkgICAgICAgICAgICAgICAgcGF0aC5uYW1lID09PSAiZXhwcmVzc2lvbiIpIHsKCQkgICAgICAgICAgICAgICAgaWYgKHBhcmVudC5leHByZXNzaW9uICE9PSBub2RlKSB7CgkJICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vZGVzIG11c3QgYmUgZXF1YWwiKTsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgaWYgKG4uU2VxdWVuY2VFeHByZXNzaW9uLmNoZWNrKHBhcmVudCkgJiYKCQkgICAgICAgICAgICAgICAgcGF0aC5wYXJlbnQubmFtZSA9PT0gImV4cHJlc3Npb25zIiAmJgoJCSAgICAgICAgICAgICAgICBwYXRoLm5hbWUgPT09IDApIHsKCQkgICAgICAgICAgICAgICAgaWYgKHBhcmVudC5leHByZXNzaW9uc1swXSAhPT0gbm9kZSkgewoJCSAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJOb2RlcyBtdXN0IGJlIGVxdWFsIik7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgY29udGludWU7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGlmIChuLkNhbGxFeHByZXNzaW9uLmNoZWNrKHBhcmVudCkgJiYKCQkgICAgICAgICAgICAgICAgcGF0aC5uYW1lID09PSAiY2FsbGVlIikgewoJCSAgICAgICAgICAgICAgICBpZiAocGFyZW50LmNhbGxlZSAhPT0gbm9kZSkgewoJCSAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJOb2RlcyBtdXN0IGJlIGVxdWFsIik7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgY29udGludWU7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGlmIChuLk1lbWJlckV4cHJlc3Npb24uY2hlY2socGFyZW50KSAmJgoJCSAgICAgICAgICAgICAgICBwYXRoLm5hbWUgPT09ICJvYmplY3QiKSB7CgkJICAgICAgICAgICAgICAgIGlmIChwYXJlbnQub2JqZWN0ICE9PSBub2RlKSB7CgkJICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vZGVzIG11c3QgYmUgZXF1YWwiKTsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICBjb250aW51ZTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgaWYgKG4uQ29uZGl0aW9uYWxFeHByZXNzaW9uLmNoZWNrKHBhcmVudCkgJiYKCQkgICAgICAgICAgICAgICAgcGF0aC5uYW1lID09PSAidGVzdCIpIHsKCQkgICAgICAgICAgICAgICAgaWYgKHBhcmVudC50ZXN0ICE9PSBub2RlKSB7CgkJICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vZGVzIG11c3QgYmUgZXF1YWwiKTsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICBjb250aW51ZTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgaWYgKGlzQmluYXJ5KHBhcmVudCkgJiYKCQkgICAgICAgICAgICAgICAgcGF0aC5uYW1lID09PSAibGVmdCIpIHsKCQkgICAgICAgICAgICAgICAgaWYgKHBhcmVudC5sZWZ0ICE9PSBub2RlKSB7CgkJICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vZGVzIG11c3QgYmUgZXF1YWwiKTsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICBjb250aW51ZTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgaWYgKG4uVW5hcnlFeHByZXNzaW9uLmNoZWNrKHBhcmVudCkgJiYKCQkgICAgICAgICAgICAgICAgIXBhcmVudC5wcmVmaXggJiYKCQkgICAgICAgICAgICAgICAgcGF0aC5uYW1lID09PSAiYXJndW1lbnQiKSB7CgkJICAgICAgICAgICAgICAgIGlmIChwYXJlbnQuYXJndW1lbnQgIT09IG5vZGUpIHsKCQkgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTm9kZXMgbXVzdCBiZSBlcXVhbCIpOwoJCSAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkJICAgICAgICB9CgkJICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgICAgfQoJCSAgICAvKioKCQkgICAgICogUHJ1bmluZyBjZXJ0YWluIG5vZGVzIHdpbGwgcmVzdWx0IGluIGVtcHR5IG9yIGluY29tcGxldGUgbm9kZXMsIGhlcmUgd2UgY2xlYW4gdGhvc2Ugbm9kZXMgdXAuCgkJICAgICAqLwoJCSAgICBmdW5jdGlvbiBjbGVhblVwTm9kZXNBZnRlclBydW5lKHJlbWFpbmluZ05vZGVQYXRoKSB7CgkJICAgICAgICBpZiAobi5WYXJpYWJsZURlY2xhcmF0aW9uLmNoZWNrKHJlbWFpbmluZ05vZGVQYXRoLm5vZGUpKSB7CgkJICAgICAgICAgICAgdmFyIGRlY2xhcmF0aW9ucyA9IHJlbWFpbmluZ05vZGVQYXRoLmdldCgnZGVjbGFyYXRpb25zJykudmFsdWU7CgkJICAgICAgICAgICAgaWYgKCFkZWNsYXJhdGlvbnMgfHwgZGVjbGFyYXRpb25zLmxlbmd0aCA9PT0gMCkgewoJCSAgICAgICAgICAgICAgICByZXR1cm4gcmVtYWluaW5nTm9kZVBhdGgucHJ1bmUoKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICB9CgkJICAgICAgICBlbHNlIGlmIChuLkV4cHJlc3Npb25TdGF0ZW1lbnQuY2hlY2socmVtYWluaW5nTm9kZVBhdGgubm9kZSkpIHsKCQkgICAgICAgICAgICBpZiAoIXJlbWFpbmluZ05vZGVQYXRoLmdldCgnZXhwcmVzc2lvbicpLnZhbHVlKSB7CgkJICAgICAgICAgICAgICAgIHJldHVybiByZW1haW5pbmdOb2RlUGF0aC5wcnVuZSgpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgIH0KCQkgICAgICAgIGVsc2UgaWYgKG4uSWZTdGF0ZW1lbnQuY2hlY2socmVtYWluaW5nTm9kZVBhdGgubm9kZSkpIHsKCQkgICAgICAgICAgICBjbGVhblVwSWZTdGF0ZW1lbnRBZnRlclBydW5lKHJlbWFpbmluZ05vZGVQYXRoKTsKCQkgICAgICAgIH0KCQkgICAgICAgIHJldHVybiByZW1haW5pbmdOb2RlUGF0aDsKCQkgICAgfQoJCSAgICBmdW5jdGlvbiBjbGVhblVwSWZTdGF0ZW1lbnRBZnRlclBydW5lKGlmU3RhdGVtZW50KSB7CgkJICAgICAgICB2YXIgdGVzdEV4cHJlc3Npb24gPSBpZlN0YXRlbWVudC5nZXQoJ3Rlc3QnKS52YWx1ZTsKCQkgICAgICAgIHZhciBhbHRlcm5hdGUgPSBpZlN0YXRlbWVudC5nZXQoJ2FsdGVybmF0ZScpLnZhbHVlOwoJCSAgICAgICAgdmFyIGNvbnNlcXVlbnQgPSBpZlN0YXRlbWVudC5nZXQoJ2NvbnNlcXVlbnQnKS52YWx1ZTsKCQkgICAgICAgIGlmICghY29uc2VxdWVudCAmJiAhYWx0ZXJuYXRlKSB7CgkJICAgICAgICAgICAgdmFyIHRlc3RFeHByZXNzaW9uU3RhdGVtZW50ID0gYi5leHByZXNzaW9uU3RhdGVtZW50KHRlc3RFeHByZXNzaW9uKTsKCQkgICAgICAgICAgICBpZlN0YXRlbWVudC5yZXBsYWNlKHRlc3RFeHByZXNzaW9uU3RhdGVtZW50KTsKCQkgICAgICAgIH0KCQkgICAgICAgIGVsc2UgaWYgKCFjb25zZXF1ZW50ICYmIGFsdGVybmF0ZSkgewoJCSAgICAgICAgICAgIHZhciBuZWdhdGVkVGVzdEV4cHJlc3Npb24gPSBiLnVuYXJ5RXhwcmVzc2lvbignIScsIHRlc3RFeHByZXNzaW9uLCB0cnVlKTsKCQkgICAgICAgICAgICBpZiAobi5VbmFyeUV4cHJlc3Npb24uY2hlY2sodGVzdEV4cHJlc3Npb24pICYmIHRlc3RFeHByZXNzaW9uLm9wZXJhdG9yID09PSAnIScpIHsKCQkgICAgICAgICAgICAgICAgbmVnYXRlZFRlc3RFeHByZXNzaW9uID0gdGVzdEV4cHJlc3Npb24uYXJndW1lbnQ7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGlmU3RhdGVtZW50LmdldCgidGVzdCIpLnJlcGxhY2UobmVnYXRlZFRlc3RFeHByZXNzaW9uKTsKCQkgICAgICAgICAgICBpZlN0YXRlbWVudC5nZXQoImNvbnNlcXVlbnQiKS5yZXBsYWNlKGFsdGVybmF0ZSk7CgkJICAgICAgICAgICAgaWZTdGF0ZW1lbnQuZ2V0KCJhbHRlcm5hdGUiKS5yZXBsYWNlKCk7CgkJICAgICAgICB9CgkJICAgIH0KCQkgICAgcmV0dXJuIE5vZGVQYXRoOwoJCX0KCQlleHBvcnRzLmRlZmF1bHQgPSBub2RlUGF0aFBsdWdpbjsKCQltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbImRlZmF1bHQiXTsgCgl9IChub2RlUGF0aCwgbm9kZVBhdGguZXhwb3J0cykpOwoJcmV0dXJuIG5vZGVQYXRoLmV4cG9ydHM7Cn0KCnZhciBoYXNSZXF1aXJlZFBhdGhWaXNpdG9yOwoKZnVuY3Rpb24gcmVxdWlyZVBhdGhWaXNpdG9yICgpIHsKCWlmIChoYXNSZXF1aXJlZFBhdGhWaXNpdG9yKSByZXR1cm4gcGF0aFZpc2l0b3IuZXhwb3J0czsKCWhhc1JlcXVpcmVkUGF0aFZpc2l0b3IgPSAxOwoJKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJCXZhciB0c2xpYl8xID0gcmVxdWlyZSQkMDsKCQl2YXIgdHlwZXNfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVUeXBlcygpKTsKCQl2YXIgbm9kZV9wYXRoXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlTm9kZVBhdGgoKSk7CgkJdmFyIGhhc093biA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7CgkJZnVuY3Rpb24gcGF0aFZpc2l0b3JQbHVnaW4oZm9yaykgewoJCSAgICB2YXIgdHlwZXMgPSBmb3JrLnVzZSh0eXBlc18xLmRlZmF1bHQpOwoJCSAgICB2YXIgTm9kZVBhdGggPSBmb3JrLnVzZShub2RlX3BhdGhfMS5kZWZhdWx0KTsKCQkgICAgdmFyIGlzQXJyYXkgPSB0eXBlcy5idWlsdEluVHlwZXMuYXJyYXk7CgkJICAgIHZhciBpc09iamVjdCA9IHR5cGVzLmJ1aWx0SW5UeXBlcy5vYmplY3Q7CgkJICAgIHZhciBpc0Z1bmN0aW9uID0gdHlwZXMuYnVpbHRJblR5cGVzLmZ1bmN0aW9uOwoJCSAgICB2YXIgdW5kZWZpbmVkJDE7CgkJICAgIHZhciBQYXRoVmlzaXRvciA9IGZ1bmN0aW9uIFBhdGhWaXNpdG9yKCkgewoJCSAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFBhdGhWaXNpdG9yKSkgewoJCSAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiUGF0aFZpc2l0b3IgY29uc3RydWN0b3IgY2Fubm90IGJlIGludm9rZWQgd2l0aG91dCAnbmV3JyIpOwoJCSAgICAgICAgfQoJCSAgICAgICAgLy8gUGVybWFuZW50IHN0YXRlLgoJCSAgICAgICAgdGhpcy5fcmV1c2FibGVDb250ZXh0U3RhY2sgPSBbXTsKCQkgICAgICAgIHRoaXMuX21ldGhvZE5hbWVUYWJsZSA9IGNvbXB1dGVNZXRob2ROYW1lVGFibGUodGhpcyk7CgkJICAgICAgICB0aGlzLl9zaG91bGRWaXNpdENvbW1lbnRzID0KCQkgICAgICAgICAgICBoYXNPd24uY2FsbCh0aGlzLl9tZXRob2ROYW1lVGFibGUsICJCbG9jayIpIHx8CgkJICAgICAgICAgICAgICAgIGhhc093bi5jYWxsKHRoaXMuX21ldGhvZE5hbWVUYWJsZSwgIkxpbmUiKTsKCQkgICAgICAgIHRoaXMuQ29udGV4dCA9IG1ha2VDb250ZXh0Q29uc3RydWN0b3IodGhpcyk7CgkJICAgICAgICAvLyBTdGF0ZSByZXNldCBldmVyeSB0aW1lIFBhdGhWaXNpdG9yLnByb3RvdHlwZS52aXNpdCBpcyBjYWxsZWQuCgkJICAgICAgICB0aGlzLl92aXNpdGluZyA9IGZhbHNlOwoJCSAgICAgICAgdGhpcy5fY2hhbmdlUmVwb3J0ZWQgPSBmYWxzZTsKCQkgICAgfTsKCQkgICAgZnVuY3Rpb24gY29tcHV0ZU1ldGhvZE5hbWVUYWJsZSh2aXNpdG9yKSB7CgkJICAgICAgICB2YXIgdHlwZU5hbWVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKCQkgICAgICAgIGZvciAodmFyIG1ldGhvZE5hbWUgaW4gdmlzaXRvcikgewoJCSAgICAgICAgICAgIGlmICgvXnZpc2l0W0EtWl0vLnRlc3QobWV0aG9kTmFtZSkpIHsKCQkgICAgICAgICAgICAgICAgdHlwZU5hbWVzW21ldGhvZE5hbWUuc2xpY2UoInZpc2l0Ii5sZW5ndGgpXSA9IHRydWU7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgfQoJCSAgICAgICAgdmFyIHN1cGVydHlwZVRhYmxlID0gdHlwZXMuY29tcHV0ZVN1cGVydHlwZUxvb2t1cFRhYmxlKHR5cGVOYW1lcyk7CgkJICAgICAgICB2YXIgbWV0aG9kTmFtZVRhYmxlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKCQkgICAgICAgIHZhciB0eXBlTmFtZUtleXMgPSBPYmplY3Qua2V5cyhzdXBlcnR5cGVUYWJsZSk7CgkJICAgICAgICB2YXIgdHlwZU5hbWVDb3VudCA9IHR5cGVOYW1lS2V5cy5sZW5ndGg7CgkJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHR5cGVOYW1lQ291bnQ7ICsraSkgewoJCSAgICAgICAgICAgIHZhciB0eXBlTmFtZSA9IHR5cGVOYW1lS2V5c1tpXTsKCQkgICAgICAgICAgICBtZXRob2ROYW1lID0gInZpc2l0IiArIHN1cGVydHlwZVRhYmxlW3R5cGVOYW1lXTsKCQkgICAgICAgICAgICBpZiAoaXNGdW5jdGlvbi5jaGVjayh2aXNpdG9yW21ldGhvZE5hbWVdKSkgewoJCSAgICAgICAgICAgICAgICBtZXRob2ROYW1lVGFibGVbdHlwZU5hbWVdID0gbWV0aG9kTmFtZTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICB9CgkJICAgICAgICByZXR1cm4gbWV0aG9kTmFtZVRhYmxlOwoJCSAgICB9CgkJICAgIFBhdGhWaXNpdG9yLmZyb21NZXRob2RzT2JqZWN0ID0gZnVuY3Rpb24gZnJvbU1ldGhvZHNPYmplY3QobWV0aG9kcykgewoJCSAgICAgICAgaWYgKG1ldGhvZHMgaW5zdGFuY2VvZiBQYXRoVmlzaXRvcikgewoJCSAgICAgICAgICAgIHJldHVybiBtZXRob2RzOwoJCSAgICAgICAgfQoJCSAgICAgICAgaWYgKCFpc09iamVjdC5jaGVjayhtZXRob2RzKSkgewoJCSAgICAgICAgICAgIC8vIEFuIGVtcHR5IHZpc2l0b3I/CgkJICAgICAgICAgICAgcmV0dXJuIG5ldyBQYXRoVmlzaXRvcjsKCQkgICAgICAgIH0KCQkgICAgICAgIHZhciBWaXNpdG9yID0gZnVuY3Rpb24gVmlzaXRvcigpIHsKCQkgICAgICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgVmlzaXRvcikpIHsKCQkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJWaXNpdG9yIGNvbnN0cnVjdG9yIGNhbm5vdCBiZSBpbnZva2VkIHdpdGhvdXQgJ25ldyciKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgUGF0aFZpc2l0b3IuY2FsbCh0aGlzKTsKCQkgICAgICAgIH07CgkJICAgICAgICB2YXIgVnAgPSBWaXNpdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoUFZwKTsKCQkgICAgICAgIFZwLmNvbnN0cnVjdG9yID0gVmlzaXRvcjsKCQkgICAgICAgIGV4dGVuZChWcCwgbWV0aG9kcyk7CgkJICAgICAgICBleHRlbmQoVmlzaXRvciwgUGF0aFZpc2l0b3IpOwoJCSAgICAgICAgaXNGdW5jdGlvbi5hc3NlcnQoVmlzaXRvci5mcm9tTWV0aG9kc09iamVjdCk7CgkJICAgICAgICBpc0Z1bmN0aW9uLmFzc2VydChWaXNpdG9yLnZpc2l0KTsKCQkgICAgICAgIHJldHVybiBuZXcgVmlzaXRvcjsKCQkgICAgfTsKCQkgICAgZnVuY3Rpb24gZXh0ZW5kKHRhcmdldCwgc291cmNlKSB7CgkJICAgICAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBzb3VyY2UpIHsKCQkgICAgICAgICAgICBpZiAoaGFzT3duLmNhbGwoc291cmNlLCBwcm9wZXJ0eSkpIHsKCQkgICAgICAgICAgICAgICAgdGFyZ2V0W3Byb3BlcnR5XSA9IHNvdXJjZVtwcm9wZXJ0eV07CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgfQoJCSAgICAgICAgcmV0dXJuIHRhcmdldDsKCQkgICAgfQoJCSAgICBQYXRoVmlzaXRvci52aXNpdCA9IGZ1bmN0aW9uIHZpc2l0KG5vZGUsIG1ldGhvZHMpIHsKCQkgICAgICAgIHJldHVybiBQYXRoVmlzaXRvci5mcm9tTWV0aG9kc09iamVjdChtZXRob2RzKS52aXNpdChub2RlKTsKCQkgICAgfTsKCQkgICAgdmFyIFBWcCA9IFBhdGhWaXNpdG9yLnByb3RvdHlwZTsKCQkgICAgUFZwLnZpc2l0ID0gZnVuY3Rpb24gKCkgewoJCSAgICAgICAgaWYgKHRoaXMuX3Zpc2l0aW5nKSB7CgkJICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJSZWN1cnNpdmVseSBjYWxsaW5nIHZpc2l0b3IudmlzaXQocGF0aCkgcmVzZXRzIHZpc2l0b3Igc3RhdGUuICIgKwoJCSAgICAgICAgICAgICAgICAiVHJ5IHRoaXMudmlzaXQocGF0aCkgb3IgdGhpcy50cmF2ZXJzZShwYXRoKSBpbnN0ZWFkLiIpOwoJCSAgICAgICAgfQoJCSAgICAgICAgLy8gUHJpdmF0ZSBzdGF0ZSB0aGF0IG5lZWRzIHRvIGJlIHJlc2V0IGJlZm9yZSBldmVyeSB0cmF2ZXJzYWwuCgkJICAgICAgICB0aGlzLl92aXNpdGluZyA9IHRydWU7CgkJICAgICAgICB0aGlzLl9jaGFuZ2VSZXBvcnRlZCA9IGZhbHNlOwoJCSAgICAgICAgdGhpcy5fYWJvcnRSZXF1ZXN0ZWQgPSBmYWxzZTsKCQkgICAgICAgIHZhciBhcmdjID0gYXJndW1lbnRzLmxlbmd0aDsKCQkgICAgICAgIHZhciBhcmdzID0gbmV3IEFycmF5KGFyZ2MpOwoJCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmdjOyArK2kpIHsKCQkgICAgICAgICAgICBhcmdzW2ldID0gYXJndW1lbnRzW2ldOwoJCSAgICAgICAgfQoJCSAgICAgICAgaWYgKCEoYXJnc1swXSBpbnN0YW5jZW9mIE5vZGVQYXRoKSkgewoJCSAgICAgICAgICAgIGFyZ3NbMF0gPSBuZXcgTm9kZVBhdGgoeyByb290OiBhcmdzWzBdIH0pLmdldCgicm9vdCIpOwoJCSAgICAgICAgfQoJCSAgICAgICAgLy8gQ2FsbGVkIHdpdGggdGhlIHNhbWUgYXJndW1lbnRzIGFzIC52aXNpdC4KCQkgICAgICAgIHRoaXMucmVzZXQuYXBwbHkodGhpcywgYXJncyk7CgkJICAgICAgICB2YXIgZGlkTm90VGhyb3c7CgkJICAgICAgICB0cnkgewoJCSAgICAgICAgICAgIHZhciByb290ID0gdGhpcy52aXNpdFdpdGhvdXRSZXNldChhcmdzWzBdKTsKCQkgICAgICAgICAgICBkaWROb3RUaHJvdyA9IHRydWU7CgkJICAgICAgICB9CgkJICAgICAgICBmaW5hbGx5IHsKCQkgICAgICAgICAgICB0aGlzLl92aXNpdGluZyA9IGZhbHNlOwoJCSAgICAgICAgICAgIGlmICghZGlkTm90VGhyb3cgJiYgdGhpcy5fYWJvcnRSZXF1ZXN0ZWQpIHsKCQkgICAgICAgICAgICAgICAgLy8gSWYgdGhpcy52aXNpdFdpdGhvdXRSZXNldCB0aHJldyBhbiBleGNlcHRpb24gYW5kCgkJICAgICAgICAgICAgICAgIC8vIHRoaXMuX2Fib3J0UmVxdWVzdGVkIHdhcyBzZXQgdG8gdHJ1ZSwgcmV0dXJuIHRoZSByb290IG9mCgkJICAgICAgICAgICAgICAgIC8vIHRoZSBBU1QgaW5zdGVhZCBvZiBsZXR0aW5nIHRoZSBleGNlcHRpb24gcHJvcGFnYXRlLCBzbyB0aGF0CgkJICAgICAgICAgICAgICAgIC8vIGNsaWVudCBjb2RlIGRvZXMgbm90IGhhdmUgdG8gcHJvdmlkZSBhIHRyeS1jYXRjaCBibG9jayB0bwoJCSAgICAgICAgICAgICAgICAvLyBpbnRlcmNlcHQgdGhlIEFib3J0UmVxdWVzdCBleGNlcHRpb24uICBPdGhlciBraW5kcyBvZgoJCSAgICAgICAgICAgICAgICAvLyBleGNlcHRpb25zIHdpbGwgcHJvcGFnYXRlIHdpdGhvdXQgYmVpbmcgaW50ZXJjZXB0ZWQgYW5kCgkJICAgICAgICAgICAgICAgIC8vIHJldGhyb3duIGJ5IGEgY2F0Y2ggYmxvY2ssIHNvIHRoZWlyIHN0YWNrcyB3aWxsIGFjY3VyYXRlbHkKCQkgICAgICAgICAgICAgICAgLy8gcmVmbGVjdCB0aGUgb3JpZ2luYWwgdGhyb3dpbmcgY29udGV4dC4KCQkgICAgICAgICAgICAgICAgcmV0dXJuIGFyZ3NbMF0udmFsdWU7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgfQoJCSAgICAgICAgcmV0dXJuIHJvb3Q7CgkJICAgIH07CgkJICAgIFBWcC5BYm9ydFJlcXVlc3QgPSBmdW5jdGlvbiBBYm9ydFJlcXVlc3QoKSB7IH07CgkJICAgIFBWcC5hYm9ydCA9IGZ1bmN0aW9uICgpIHsKCQkgICAgICAgIHZhciB2aXNpdG9yID0gdGhpczsKCQkgICAgICAgIHZpc2l0b3IuX2Fib3J0UmVxdWVzdGVkID0gdHJ1ZTsKCQkgICAgICAgIHZhciByZXF1ZXN0ID0gbmV3IHZpc2l0b3IuQWJvcnRSZXF1ZXN0KCk7CgkJICAgICAgICAvLyBJZiB5b3UgZGVjaWRlIHRvIGNhdGNoIHRoaXMgZXhjZXB0aW9uIGFuZCBzdG9wIGl0IGZyb20gcHJvcGFnYXRpbmcsCgkJICAgICAgICAvLyBtYWtlIHN1cmUgdG8gY2FsbCBpdHMgY2FuY2VsIG1ldGhvZCB0byBhdm9pZCBzaWxlbmNpbmcgb3RoZXIKCQkgICAgICAgIC8vIGV4Y2VwdGlvbnMgdGhhdCBtaWdodCBiZSB0aHJvd24gbGF0ZXIgaW4gdGhlIHRyYXZlcnNhbC4KCQkgICAgICAgIHJlcXVlc3QuY2FuY2VsID0gZnVuY3Rpb24gKCkgewoJCSAgICAgICAgICAgIHZpc2l0b3IuX2Fib3J0UmVxdWVzdGVkID0gZmFsc2U7CgkJICAgICAgICB9OwoJCSAgICAgICAgdGhyb3cgcmVxdWVzdDsKCQkgICAgfTsKCQkgICAgUFZwLnJlc2V0ID0gZnVuY3Rpb24gKF9wYXRoIC8qLCBhZGRpdGlvbmFsIGFyZ3VtZW50cyAqLykgewoJCSAgICAgICAgLy8gRW1wdHkgc3R1YjsgbWF5IGJlIHJlYXNzaWduZWQgb3Igb3ZlcnJpZGRlbiBieSBzdWJjbGFzc2VzLgoJCSAgICB9OwoJCSAgICBQVnAudmlzaXRXaXRob3V0UmVzZXQgPSBmdW5jdGlvbiAocGF0aCkgewoJCSAgICAgICAgaWYgKHRoaXMgaW5zdGFuY2VvZiB0aGlzLkNvbnRleHQpIHsKCQkgICAgICAgICAgICAvLyBTaW5jZSB0aGlzLkNvbnRleHQucHJvdG90eXBlID09PSB0aGlzLCB0aGVyZSdzIGEgY2hhbmNlIHdlCgkJICAgICAgICAgICAgLy8gbWlnaHQgYWNjaWRlbnRhbGx5IGNhbGwgY29udGV4dC52aXNpdFdpdGhvdXRSZXNldC4gSWYgdGhhdAoJCSAgICAgICAgICAgIC8vIGhhcHBlbnMsIHJlLWludm9rZSB0aGUgbWV0aG9kIGFnYWluc3QgY29udGV4dC52aXNpdG9yLgoJCSAgICAgICAgICAgIHJldHVybiB0aGlzLnZpc2l0b3IudmlzaXRXaXRob3V0UmVzZXQocGF0aCk7CgkJICAgICAgICB9CgkJICAgICAgICBpZiAoIShwYXRoIGluc3RhbmNlb2YgTm9kZVBhdGgpKSB7CgkJICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgIH0KCQkgICAgICAgIHZhciB2YWx1ZSA9IHBhdGgudmFsdWU7CgkJICAgICAgICB2YXIgbWV0aG9kTmFtZSA9IHZhbHVlICYmCgkJICAgICAgICAgICAgdHlwZW9mIHZhbHVlID09PSAib2JqZWN0IiAmJgoJCSAgICAgICAgICAgIHR5cGVvZiB2YWx1ZS50eXBlID09PSAic3RyaW5nIiAmJgoJCSAgICAgICAgICAgIHRoaXMuX21ldGhvZE5hbWVUYWJsZVt2YWx1ZS50eXBlXTsKCQkgICAgICAgIGlmIChtZXRob2ROYW1lKSB7CgkJICAgICAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzLmFjcXVpcmVDb250ZXh0KHBhdGgpOwoJCSAgICAgICAgICAgIHRyeSB7CgkJICAgICAgICAgICAgICAgIHJldHVybiBjb250ZXh0Lmludm9rZVZpc2l0b3JNZXRob2QobWV0aG9kTmFtZSk7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGZpbmFsbHkgewoJCSAgICAgICAgICAgICAgICB0aGlzLnJlbGVhc2VDb250ZXh0KGNvbnRleHQpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgIH0KCQkgICAgICAgIGVsc2UgewoJCSAgICAgICAgICAgIC8vIElmIHRoZXJlIHdhcyBubyB2aXNpdG9yIG1ldGhvZCB0byBjYWxsLCB2aXNpdCB0aGUgY2hpbGRyZW4gb2YKCQkgICAgICAgICAgICAvLyB0aGlzIG5vZGUgZ2VuZXJpY2FsbHkuCgkJICAgICAgICAgICAgcmV0dXJuIHZpc2l0Q2hpbGRyZW4ocGF0aCwgdGhpcyk7CgkJICAgICAgICB9CgkJICAgIH07CgkJICAgIGZ1bmN0aW9uIHZpc2l0Q2hpbGRyZW4ocGF0aCwgdmlzaXRvcikgewoJCSAgICAgICAgaWYgKCEocGF0aCBpbnN0YW5jZW9mIE5vZGVQYXRoKSkgewoJCSAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkJICAgICAgICB9CgkJICAgICAgICBpZiAoISh2aXNpdG9yIGluc3RhbmNlb2YgUGF0aFZpc2l0b3IpKSB7CgkJICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgIH0KCQkgICAgICAgIHZhciB2YWx1ZSA9IHBhdGgudmFsdWU7CgkJICAgICAgICBpZiAoaXNBcnJheS5jaGVjayh2YWx1ZSkpIHsKCQkgICAgICAgICAgICBwYXRoLmVhY2godmlzaXRvci52aXNpdFdpdGhvdXRSZXNldCwgdmlzaXRvcik7CgkJICAgICAgICB9CgkJICAgICAgICBlbHNlIGlmICghaXNPYmplY3QuY2hlY2sodmFsdWUpKSA7CgkJICAgICAgICBlbHNlIHsKCQkgICAgICAgICAgICB2YXIgY2hpbGROYW1lcyA9IHR5cGVzLmdldEZpZWxkTmFtZXModmFsdWUpOwoJCSAgICAgICAgICAgIC8vIFRoZSAuY29tbWVudHMgZmllbGQgb2YgdGhlIE5vZGUgdHlwZSBpcyBoaWRkZW4sIHNvIHdlIG9ubHkKCQkgICAgICAgICAgICAvLyB2aXNpdCBpdCBpZiB0aGUgdmlzaXRvciBkZWZpbmVzIHZpc2l0QmxvY2sgb3IgdmlzaXRMaW5lLCBhbmQKCQkgICAgICAgICAgICAvLyB2YWx1ZS5jb21tZW50cyBpcyBkZWZpbmVkLgoJCSAgICAgICAgICAgIGlmICh2aXNpdG9yLl9zaG91bGRWaXNpdENvbW1lbnRzICYmCgkJICAgICAgICAgICAgICAgIHZhbHVlLmNvbW1lbnRzICYmCgkJICAgICAgICAgICAgICAgIGNoaWxkTmFtZXMuaW5kZXhPZigiY29tbWVudHMiKSA8IDApIHsKCQkgICAgICAgICAgICAgICAgY2hpbGROYW1lcy5wdXNoKCJjb21tZW50cyIpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICB2YXIgY2hpbGRDb3VudCA9IGNoaWxkTmFtZXMubGVuZ3RoOwoJCSAgICAgICAgICAgIHZhciBjaGlsZFBhdGhzID0gW107CgkJICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZENvdW50OyArK2kpIHsKCQkgICAgICAgICAgICAgICAgdmFyIGNoaWxkTmFtZSA9IGNoaWxkTmFtZXNbaV07CgkJICAgICAgICAgICAgICAgIGlmICghaGFzT3duLmNhbGwodmFsdWUsIGNoaWxkTmFtZSkpIHsKCQkgICAgICAgICAgICAgICAgICAgIHZhbHVlW2NoaWxkTmFtZV0gPSB0eXBlcy5nZXRGaWVsZFZhbHVlKHZhbHVlLCBjaGlsZE5hbWUpOwoJCSAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgICAgIGNoaWxkUGF0aHMucHVzaChwYXRoLmdldChjaGlsZE5hbWUpKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZENvdW50OyArK2kpIHsKCQkgICAgICAgICAgICAgICAgdmlzaXRvci52aXNpdFdpdGhvdXRSZXNldChjaGlsZFBhdGhzW2ldKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICB9CgkJICAgICAgICByZXR1cm4gcGF0aC52YWx1ZTsKCQkgICAgfQoJCSAgICBQVnAuYWNxdWlyZUNvbnRleHQgPSBmdW5jdGlvbiAocGF0aCkgewoJCSAgICAgICAgaWYgKHRoaXMuX3JldXNhYmxlQ29udGV4dFN0YWNrLmxlbmd0aCA9PT0gMCkgewoJCSAgICAgICAgICAgIHJldHVybiBuZXcgdGhpcy5Db250ZXh0KHBhdGgpOwoJCSAgICAgICAgfQoJCSAgICAgICAgcmV0dXJuIHRoaXMuX3JldXNhYmxlQ29udGV4dFN0YWNrLnBvcCgpLnJlc2V0KHBhdGgpOwoJCSAgICB9OwoJCSAgICBQVnAucmVsZWFzZUNvbnRleHQgPSBmdW5jdGlvbiAoY29udGV4dCkgewoJCSAgICAgICAgaWYgKCEoY29udGV4dCBpbnN0YW5jZW9mIHRoaXMuQ29udGV4dCkpIHsKCQkgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJCSAgICAgICAgfQoJCSAgICAgICAgdGhpcy5fcmV1c2FibGVDb250ZXh0U3RhY2sucHVzaChjb250ZXh0KTsKCQkgICAgICAgIGNvbnRleHQuY3VycmVudFBhdGggPSBudWxsOwoJCSAgICB9OwoJCSAgICBQVnAucmVwb3J0Q2hhbmdlZCA9IGZ1bmN0aW9uICgpIHsKCQkgICAgICAgIHRoaXMuX2NoYW5nZVJlcG9ydGVkID0gdHJ1ZTsKCQkgICAgfTsKCQkgICAgUFZwLndhc0NoYW5nZVJlcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJCSAgICAgICAgcmV0dXJuIHRoaXMuX2NoYW5nZVJlcG9ydGVkOwoJCSAgICB9OwoJCSAgICBmdW5jdGlvbiBtYWtlQ29udGV4dENvbnN0cnVjdG9yKHZpc2l0b3IpIHsKCQkgICAgICAgIGZ1bmN0aW9uIENvbnRleHQocGF0aCkgewoJCSAgICAgICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBDb250ZXh0KSkgewoJCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgUGF0aFZpc2l0b3IpKSB7CgkJICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGlmICghKHBhdGggaW5zdGFuY2VvZiBOb2RlUGF0aCkpIHsKCQkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICJ2aXNpdG9yIiwgewoJCSAgICAgICAgICAgICAgICB2YWx1ZTogdmlzaXRvciwKCQkgICAgICAgICAgICAgICAgd3JpdGFibGU6IGZhbHNlLAoJCSAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAoJCSAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IGZhbHNlCgkJICAgICAgICAgICAgfSk7CgkJICAgICAgICAgICAgdGhpcy5jdXJyZW50UGF0aCA9IHBhdGg7CgkJICAgICAgICAgICAgdGhpcy5uZWVkVG9DYWxsVHJhdmVyc2UgPSB0cnVlOwoJCSAgICAgICAgICAgIE9iamVjdC5zZWFsKHRoaXMpOwoJCSAgICAgICAgfQoJCSAgICAgICAgaWYgKCEodmlzaXRvciBpbnN0YW5jZW9mIFBhdGhWaXNpdG9yKSkgewoJCSAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkJICAgICAgICB9CgkJICAgICAgICAvLyBOb3RlIHRoYXQgdGhlIHZpc2l0b3Igb2JqZWN0IGlzIHRoZSBwcm90b3R5cGUgb2YgQ29udGV4dC5wcm90b3R5cGUsCgkJICAgICAgICAvLyBzbyBhbGwgdmlzaXRvciBtZXRob2RzIGFyZSBpbmhlcml0ZWQgYnkgY29udGV4dCBvYmplY3RzLgoJCSAgICAgICAgdmFyIENwID0gQ29udGV4dC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHZpc2l0b3IpOwoJCSAgICAgICAgQ3AuY29uc3RydWN0b3IgPSBDb250ZXh0OwoJCSAgICAgICAgZXh0ZW5kKENwLCBzaGFyZWRDb250ZXh0UHJvdG9NZXRob2RzKTsKCQkgICAgICAgIHJldHVybiBDb250ZXh0OwoJCSAgICB9CgkJICAgIC8vIEV2ZXJ5IFBhdGhWaXNpdG9yIGhhcyBhIGRpZmZlcmVudCB0aGlzLkNvbnRleHQgY29uc3RydWN0b3IgYW5kCgkJICAgIC8vIHRoaXMuQ29udGV4dC5wcm90b3R5cGUgb2JqZWN0LCBidXQgdGhvc2UgcHJvdG90eXBlcyBjYW4gYWxsIHVzZSB0aGUKCQkgICAgLy8gc2FtZSByZXNldCwgaW52b2tlVmlzaXRvck1ldGhvZCwgYW5kIHRyYXZlcnNlIGZ1bmN0aW9uIG9iamVjdHMuCgkJICAgIHZhciBzaGFyZWRDb250ZXh0UHJvdG9NZXRob2RzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKCQkgICAgc2hhcmVkQ29udGV4dFByb3RvTWV0aG9kcy5yZXNldCA9CgkJICAgICAgICBmdW5jdGlvbiByZXNldChwYXRoKSB7CgkJICAgICAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIHRoaXMuQ29udGV4dCkpIHsKCQkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgaWYgKCEocGF0aCBpbnN0YW5jZW9mIE5vZGVQYXRoKSkgewoJCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICB0aGlzLmN1cnJlbnRQYXRoID0gcGF0aDsKCQkgICAgICAgICAgICB0aGlzLm5lZWRUb0NhbGxUcmF2ZXJzZSA9IHRydWU7CgkJICAgICAgICAgICAgcmV0dXJuIHRoaXM7CgkJICAgICAgICB9OwoJCSAgICBzaGFyZWRDb250ZXh0UHJvdG9NZXRob2RzLmludm9rZVZpc2l0b3JNZXRob2QgPQoJCSAgICAgICAgZnVuY3Rpb24gaW52b2tlVmlzaXRvck1ldGhvZChtZXRob2ROYW1lKSB7CgkJICAgICAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIHRoaXMuQ29udGV4dCkpIHsKCQkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgaWYgKCEodGhpcy5jdXJyZW50UGF0aCBpbnN0YW5jZW9mIE5vZGVQYXRoKSkgewoJCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy52aXNpdG9yW21ldGhvZE5hbWVdLmNhbGwodGhpcywgdGhpcy5jdXJyZW50UGF0aCk7CgkJICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gZmFsc2UpIHsKCQkgICAgICAgICAgICAgICAgLy8gVmlzaXRvciBtZXRob2RzIHJldHVybiBmYWxzZSB0byBpbmRpY2F0ZSB0aGF0IHRoZXkgaGF2ZSBoYW5kbGVkCgkJICAgICAgICAgICAgICAgIC8vIHRoZWlyIG93biB0cmF2ZXJzYWwgbmVlZHMsIGFuZCB3ZSBzaG91bGQgbm90IGNvbXBsYWluIGlmCgkJICAgICAgICAgICAgICAgIC8vIHRoaXMubmVlZFRvQ2FsbFRyYXZlcnNlIGlzIHN0aWxsIHRydWUuCgkJICAgICAgICAgICAgICAgIHRoaXMubmVlZFRvQ2FsbFRyYXZlcnNlID0gZmFsc2U7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGVsc2UgaWYgKHJlc3VsdCAhPT0gdW5kZWZpbmVkJDEpIHsKCQkgICAgICAgICAgICAgICAgLy8gQW55IG90aGVyIG5vbi11bmRlZmluZWQgdmFsdWUgcmV0dXJuZWQgZnJvbSB0aGUgdmlzaXRvciBtZXRob2QKCQkgICAgICAgICAgICAgICAgLy8gaXMgaW50ZXJwcmV0ZWQgYXMgYSByZXBsYWNlbWVudCB2YWx1ZS4KCQkgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50UGF0aCA9IHRoaXMuY3VycmVudFBhdGgucmVwbGFjZShyZXN1bHQpWzBdOwoJCSAgICAgICAgICAgICAgICBpZiAodGhpcy5uZWVkVG9DYWxsVHJhdmVyc2UpIHsKCQkgICAgICAgICAgICAgICAgICAgIC8vIElmIHRoaXMudHJhdmVyc2Ugc3RpbGwgaGFzbid0IGJlZW4gY2FsbGVkLCB2aXNpdCB0aGUKCQkgICAgICAgICAgICAgICAgICAgIC8vIGNoaWxkcmVuIG9mIHRoZSByZXBsYWNlbWVudCBub2RlLgoJCSAgICAgICAgICAgICAgICAgICAgdGhpcy50cmF2ZXJzZSh0aGlzLmN1cnJlbnRQYXRoKTsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBpZiAodGhpcy5uZWVkVG9DYWxsVHJhdmVyc2UgIT09IGZhbHNlKSB7CgkJICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTXVzdCBlaXRoZXIgY2FsbCB0aGlzLnRyYXZlcnNlIG9yIHJldHVybiBmYWxzZSBpbiAiICsgbWV0aG9kTmFtZSk7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIHZhciBwYXRoID0gdGhpcy5jdXJyZW50UGF0aDsKCQkgICAgICAgICAgICByZXR1cm4gcGF0aCAmJiBwYXRoLnZhbHVlOwoJCSAgICAgICAgfTsKCQkgICAgc2hhcmVkQ29udGV4dFByb3RvTWV0aG9kcy50cmF2ZXJzZSA9CgkJICAgICAgICBmdW5jdGlvbiB0cmF2ZXJzZShwYXRoLCBuZXdWaXNpdG9yKSB7CgkJICAgICAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIHRoaXMuQ29udGV4dCkpIHsKCQkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgaWYgKCEocGF0aCBpbnN0YW5jZW9mIE5vZGVQYXRoKSkgewoJCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBpZiAoISh0aGlzLmN1cnJlbnRQYXRoIGluc3RhbmNlb2YgTm9kZVBhdGgpKSB7CgkJICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIHRoaXMubmVlZFRvQ2FsbFRyYXZlcnNlID0gZmFsc2U7CgkJICAgICAgICAgICAgcmV0dXJuIHZpc2l0Q2hpbGRyZW4ocGF0aCwgUGF0aFZpc2l0b3IuZnJvbU1ldGhvZHNPYmplY3QobmV3VmlzaXRvciB8fCB0aGlzLnZpc2l0b3IpKTsKCQkgICAgICAgIH07CgkJICAgIHNoYXJlZENvbnRleHRQcm90b01ldGhvZHMudmlzaXQgPQoJCSAgICAgICAgZnVuY3Rpb24gdmlzaXQocGF0aCwgbmV3VmlzaXRvcikgewoJCSAgICAgICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiB0aGlzLkNvbnRleHQpKSB7CgkJICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiIik7CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIGlmICghKHBhdGggaW5zdGFuY2VvZiBOb2RlUGF0aCkpIHsKCQkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgaWYgKCEodGhpcy5jdXJyZW50UGF0aCBpbnN0YW5jZW9mIE5vZGVQYXRoKSkgewoJCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICB0aGlzLm5lZWRUb0NhbGxUcmF2ZXJzZSA9IGZhbHNlOwoJCSAgICAgICAgICAgIHJldHVybiBQYXRoVmlzaXRvci5mcm9tTWV0aG9kc09iamVjdChuZXdWaXNpdG9yIHx8IHRoaXMudmlzaXRvcikudmlzaXRXaXRob3V0UmVzZXQocGF0aCk7CgkJICAgICAgICB9OwoJCSAgICBzaGFyZWRDb250ZXh0UHJvdG9NZXRob2RzLnJlcG9ydENoYW5nZWQgPSBmdW5jdGlvbiByZXBvcnRDaGFuZ2VkKCkgewoJCSAgICAgICAgdGhpcy52aXNpdG9yLnJlcG9ydENoYW5nZWQoKTsKCQkgICAgfTsKCQkgICAgc2hhcmVkQ29udGV4dFByb3RvTWV0aG9kcy5hYm9ydCA9IGZ1bmN0aW9uIGFib3J0KCkgewoJCSAgICAgICAgdGhpcy5uZWVkVG9DYWxsVHJhdmVyc2UgPSBmYWxzZTsKCQkgICAgICAgIHRoaXMudmlzaXRvci5hYm9ydCgpOwoJCSAgICB9OwoJCSAgICByZXR1cm4gUGF0aFZpc2l0b3I7CgkJfQoJCWV4cG9ydHMuZGVmYXVsdCA9IHBhdGhWaXNpdG9yUGx1Z2luOwoJCW1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1siZGVmYXVsdCJdOyAKCX0gKHBhdGhWaXNpdG9yLCBwYXRoVmlzaXRvci5leHBvcnRzKSk7CglyZXR1cm4gcGF0aFZpc2l0b3IuZXhwb3J0czsKfQoKdmFyIGVxdWl2ID0ge2V4cG9ydHM6IHt9fTsKCnZhciBoYXNSZXF1aXJlZEVxdWl2OwoKZnVuY3Rpb24gcmVxdWlyZUVxdWl2ICgpIHsKCWlmIChoYXNSZXF1aXJlZEVxdWl2KSByZXR1cm4gZXF1aXYuZXhwb3J0czsKCWhhc1JlcXVpcmVkRXF1aXYgPSAxOwoJKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJCXZhciB0c2xpYl8xID0gcmVxdWlyZSQkMDsKCQl2YXIgdHlwZXNfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVUeXBlcygpKTsKCQlmdW5jdGlvbiBkZWZhdWx0XzEoZm9yaykgewoJCSAgICB2YXIgdHlwZXMgPSBmb3JrLnVzZSh0eXBlc18xLmRlZmF1bHQpOwoJCSAgICB2YXIgZ2V0RmllbGROYW1lcyA9IHR5cGVzLmdldEZpZWxkTmFtZXM7CgkJICAgIHZhciBnZXRGaWVsZFZhbHVlID0gdHlwZXMuZ2V0RmllbGRWYWx1ZTsKCQkgICAgdmFyIGlzQXJyYXkgPSB0eXBlcy5idWlsdEluVHlwZXMuYXJyYXk7CgkJICAgIHZhciBpc09iamVjdCA9IHR5cGVzLmJ1aWx0SW5UeXBlcy5vYmplY3Q7CgkJICAgIHZhciBpc0RhdGUgPSB0eXBlcy5idWlsdEluVHlwZXMuRGF0ZTsKCQkgICAgdmFyIGlzUmVnRXhwID0gdHlwZXMuYnVpbHRJblR5cGVzLlJlZ0V4cDsKCQkgICAgdmFyIGhhc093biA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7CgkJICAgIGZ1bmN0aW9uIGFzdE5vZGVzQXJlRXF1aXZhbGVudChhLCBiLCBwcm9ibGVtUGF0aCkgewoJCSAgICAgICAgaWYgKGlzQXJyYXkuY2hlY2socHJvYmxlbVBhdGgpKSB7CgkJICAgICAgICAgICAgcHJvYmxlbVBhdGgubGVuZ3RoID0gMDsKCQkgICAgICAgIH0KCQkgICAgICAgIGVsc2UgewoJCSAgICAgICAgICAgIHByb2JsZW1QYXRoID0gbnVsbDsKCQkgICAgICAgIH0KCQkgICAgICAgIHJldHVybiBhcmVFcXVpdmFsZW50KGEsIGIsIHByb2JsZW1QYXRoKTsKCQkgICAgfQoJCSAgICBhc3ROb2Rlc0FyZUVxdWl2YWxlbnQuYXNzZXJ0ID0gZnVuY3Rpb24gKGEsIGIpIHsKCQkgICAgICAgIHZhciBwcm9ibGVtUGF0aCA9IFtdOwoJCSAgICAgICAgaWYgKCFhc3ROb2Rlc0FyZUVxdWl2YWxlbnQoYSwgYiwgcHJvYmxlbVBhdGgpKSB7CgkJICAgICAgICAgICAgaWYgKHByb2JsZW1QYXRoLmxlbmd0aCA9PT0gMCkgewoJCSAgICAgICAgICAgICAgICBpZiAoYSAhPT0gYikgewoJCSAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJOb2RlcyBtdXN0IGJlIGVxdWFsIik7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgZWxzZSB7CgkJICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTm9kZXMgZGlmZmVyIGluIHRoZSBmb2xsb3dpbmcgcGF0aDogIiArCgkJICAgICAgICAgICAgICAgICAgICBwcm9ibGVtUGF0aC5tYXAoc3Vic2NyaXB0Rm9yUHJvcGVydHkpLmpvaW4oIiIpKTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICB9CgkJICAgIH07CgkJICAgIGZ1bmN0aW9uIHN1YnNjcmlwdEZvclByb3BlcnR5KHByb3BlcnR5KSB7CgkJICAgICAgICBpZiAoL1tfJGEtel1bXyRhLXowLTldKi9pLnRlc3QocHJvcGVydHkpKSB7CgkJICAgICAgICAgICAgcmV0dXJuICIuIiArIHByb3BlcnR5OwoJCSAgICAgICAgfQoJCSAgICAgICAgcmV0dXJuICJbIiArIEpTT04uc3RyaW5naWZ5KHByb3BlcnR5KSArICJdIjsKCQkgICAgfQoJCSAgICBmdW5jdGlvbiBhcmVFcXVpdmFsZW50KGEsIGIsIHByb2JsZW1QYXRoKSB7CgkJICAgICAgICBpZiAoYSA9PT0gYikgewoJCSAgICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAgICAgICAgfQoJCSAgICAgICAgaWYgKGlzQXJyYXkuY2hlY2soYSkpIHsKCQkgICAgICAgICAgICByZXR1cm4gYXJyYXlzQXJlRXF1aXZhbGVudChhLCBiLCBwcm9ibGVtUGF0aCk7CgkJICAgICAgICB9CgkJICAgICAgICBpZiAoaXNPYmplY3QuY2hlY2soYSkpIHsKCQkgICAgICAgICAgICByZXR1cm4gb2JqZWN0c0FyZUVxdWl2YWxlbnQoYSwgYiwgcHJvYmxlbVBhdGgpOwoJCSAgICAgICAgfQoJCSAgICAgICAgaWYgKGlzRGF0ZS5jaGVjayhhKSkgewoJCSAgICAgICAgICAgIHJldHVybiBpc0RhdGUuY2hlY2soYikgJiYgKCthID09PSArYik7CgkJICAgICAgICB9CgkJICAgICAgICBpZiAoaXNSZWdFeHAuY2hlY2soYSkpIHsKCQkgICAgICAgICAgICByZXR1cm4gaXNSZWdFeHAuY2hlY2soYikgJiYgKGEuc291cmNlID09PSBiLnNvdXJjZSAmJgoJCSAgICAgICAgICAgICAgICBhLmdsb2JhbCA9PT0gYi5nbG9iYWwgJiYKCQkgICAgICAgICAgICAgICAgYS5tdWx0aWxpbmUgPT09IGIubXVsdGlsaW5lICYmCgkJICAgICAgICAgICAgICAgIGEuaWdub3JlQ2FzZSA9PT0gYi5pZ25vcmVDYXNlKTsKCQkgICAgICAgIH0KCQkgICAgICAgIHJldHVybiBhID09IGI7CgkJICAgIH0KCQkgICAgZnVuY3Rpb24gYXJyYXlzQXJlRXF1aXZhbGVudChhLCBiLCBwcm9ibGVtUGF0aCkgewoJCSAgICAgICAgaXNBcnJheS5hc3NlcnQoYSk7CgkJICAgICAgICB2YXIgYUxlbmd0aCA9IGEubGVuZ3RoOwoJCSAgICAgICAgaWYgKCFpc0FycmF5LmNoZWNrKGIpIHx8IGIubGVuZ3RoICE9PSBhTGVuZ3RoKSB7CgkJICAgICAgICAgICAgaWYgKHByb2JsZW1QYXRoKSB7CgkJICAgICAgICAgICAgICAgIHByb2JsZW1QYXRoLnB1c2goImxlbmd0aCIpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkJICAgICAgICB9CgkJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFMZW5ndGg7ICsraSkgewoJCSAgICAgICAgICAgIGlmIChwcm9ibGVtUGF0aCkgewoJCSAgICAgICAgICAgICAgICBwcm9ibGVtUGF0aC5wdXNoKGkpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBpZiAoaSBpbiBhICE9PSBpIGluIGIpIHsKCQkgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBpZiAoIWFyZUVxdWl2YWxlbnQoYVtpXSwgYltpXSwgcHJvYmxlbVBhdGgpKSB7CgkJICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCQkgICAgICAgICAgICB9CgkJICAgICAgICAgICAgaWYgKHByb2JsZW1QYXRoKSB7CgkJICAgICAgICAgICAgICAgIHZhciBwcm9ibGVtUGF0aFRhaWwgPSBwcm9ibGVtUGF0aC5wb3AoKTsKCQkgICAgICAgICAgICAgICAgaWYgKHByb2JsZW1QYXRoVGFpbCAhPT0gaSkgewoJCSAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCIiICsgcHJvYmxlbVBhdGhUYWlsKTsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIH0KCQkgICAgICAgIH0KCQkgICAgICAgIHJldHVybiB0cnVlOwoJCSAgICB9CgkJICAgIGZ1bmN0aW9uIG9iamVjdHNBcmVFcXVpdmFsZW50KGEsIGIsIHByb2JsZW1QYXRoKSB7CgkJICAgICAgICBpc09iamVjdC5hc3NlcnQoYSk7CgkJICAgICAgICBpZiAoIWlzT2JqZWN0LmNoZWNrKGIpKSB7CgkJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAgICAgICAgfQoJCSAgICAgICAgLy8gRmFzdCBwYXRoIGZvciBhIGNvbW1vbiBwcm9wZXJ0eSBvZiBBU1Qgbm9kZXMuCgkJICAgICAgICBpZiAoYS50eXBlICE9PSBiLnR5cGUpIHsKCQkgICAgICAgICAgICBpZiAocHJvYmxlbVBhdGgpIHsKCQkgICAgICAgICAgICAgICAgcHJvYmxlbVBhdGgucHVzaCgidHlwZSIpOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkJICAgICAgICB9CgkJICAgICAgICB2YXIgYU5hbWVzID0gZ2V0RmllbGROYW1lcyhhKTsKCQkgICAgICAgIHZhciBhTmFtZUNvdW50ID0gYU5hbWVzLmxlbmd0aDsKCQkgICAgICAgIHZhciBiTmFtZXMgPSBnZXRGaWVsZE5hbWVzKGIpOwoJCSAgICAgICAgdmFyIGJOYW1lQ291bnQgPSBiTmFtZXMubGVuZ3RoOwoJCSAgICAgICAgaWYgKGFOYW1lQ291bnQgPT09IGJOYW1lQ291bnQpIHsKCQkgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFOYW1lQ291bnQ7ICsraSkgewoJCSAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IGFOYW1lc1tpXTsKCQkgICAgICAgICAgICAgICAgdmFyIGFDaGlsZCA9IGdldEZpZWxkVmFsdWUoYSwgbmFtZSk7CgkJICAgICAgICAgICAgICAgIHZhciBiQ2hpbGQgPSBnZXRGaWVsZFZhbHVlKGIsIG5hbWUpOwoJCSAgICAgICAgICAgICAgICBpZiAocHJvYmxlbVBhdGgpIHsKCQkgICAgICAgICAgICAgICAgICAgIHByb2JsZW1QYXRoLnB1c2gobmFtZSk7CgkJICAgICAgICAgICAgICAgIH0KCQkgICAgICAgICAgICAgICAgaWYgKCFhcmVFcXVpdmFsZW50KGFDaGlsZCwgYkNoaWxkLCBwcm9ibGVtUGF0aCkpIHsKCQkgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCQkgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICBpZiAocHJvYmxlbVBhdGgpIHsKCQkgICAgICAgICAgICAgICAgICAgIHZhciBwcm9ibGVtUGF0aFRhaWwgPSBwcm9ibGVtUGF0aC5wb3AoKTsKCQkgICAgICAgICAgICAgICAgICAgIGlmIChwcm9ibGVtUGF0aFRhaWwgIT09IG5hbWUpIHsKCQkgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIiIgKyBwcm9ibGVtUGF0aFRhaWwpOwoJCSAgICAgICAgICAgICAgICAgICAgfQoJCSAgICAgICAgICAgICAgICB9CgkJICAgICAgICAgICAgfQoJCSAgICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAgICAgICAgfQoJCSAgICAgICAgaWYgKCFwcm9ibGVtUGF0aCkgewoJCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCQkgICAgICAgIH0KCQkgICAgICAgIC8vIFNpbmNlIGFOYW1lQ291bnQgIT09IGJOYW1lQ291bnQsIHdlIG5lZWQgdG8gZmluZCBzb21lIG5hbWUgdGhhdCdzCgkJICAgICAgICAvLyBtaXNzaW5nIGluIGFOYW1lcyBidXQgcHJlc2VudCBpbiBiTmFtZXMsIG9yIHZpY2UtdmVyc2EuCgkJICAgICAgICB2YXIgc2Vlbk5hbWVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKCQkgICAgICAgIGZvciAoaSA9IDA7IGkgPCBhTmFtZUNvdW50OyArK2kpIHsKCQkgICAgICAgICAgICBzZWVuTmFtZXNbYU5hbWVzW2ldXSA9IHRydWU7CgkJICAgICAgICB9CgkJICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYk5hbWVDb3VudDsgKytpKSB7CgkJICAgICAgICAgICAgbmFtZSA9IGJOYW1lc1tpXTsKCQkgICAgICAgICAgICBpZiAoIWhhc093bi5jYWxsKHNlZW5OYW1lcywgbmFtZSkpIHsKCQkgICAgICAgICAgICAgICAgcHJvYmxlbVBhdGgucHVzaChuYW1lKTsKCQkgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAgICAgICAgICAgIH0KCQkgICAgICAgICAgICBkZWxldGUgc2Vlbk5hbWVzW25hbWVdOwoJCSAgICAgICAgfQoJCSAgICAgICAgZm9yIChuYW1lIGluIHNlZW5OYW1lcykgewoJCSAgICAgICAgICAgIHByb2JsZW1QYXRoLnB1c2gobmFtZSk7CgkJICAgICAgICAgICAgYnJlYWs7CgkJICAgICAgICB9CgkJICAgICAgICByZXR1cm4gZmFsc2U7CgkJICAgIH0KCQkgICAgcmV0dXJuIGFzdE5vZGVzQXJlRXF1aXZhbGVudDsKCQl9CgkJZXhwb3J0cy5kZWZhdWx0ID0gZGVmYXVsdF8xOwoJCW1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1siZGVmYXVsdCJdOyAKCX0gKGVxdWl2LCBlcXVpdi5leHBvcnRzKSk7CglyZXR1cm4gZXF1aXYuZXhwb3J0czsKfQoKdmFyIGhhc1JlcXVpcmVkRm9yazsKCmZ1bmN0aW9uIHJlcXVpcmVGb3JrICgpIHsKCWlmIChoYXNSZXF1aXJlZEZvcmspIHJldHVybiBmb3JrJDEuZXhwb3J0czsKCWhhc1JlcXVpcmVkRm9yayA9IDE7CgkoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkJdmFyIHRzbGliXzEgPSByZXF1aXJlJCQwOwoJCXZhciB0eXBlc18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVR5cGVzKCkpOwoJCXZhciBwYXRoX3Zpc2l0b3JfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVQYXRoVmlzaXRvcigpKTsKCQl2YXIgZXF1aXZfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVFcXVpdigpKTsKCQl2YXIgcGF0aF8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVBhdGgoKSk7CgkJdmFyIG5vZGVfcGF0aF8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZU5vZGVQYXRoKCkpOwoJCWZ1bmN0aW9uIGRlZmF1bHRfMShkZWZzKSB7CgkJICAgIHZhciBmb3JrID0gY3JlYXRlRm9yaygpOwoJCSAgICB2YXIgdHlwZXMgPSBmb3JrLnVzZSh0eXBlc18xLmRlZmF1bHQpOwoJCSAgICBkZWZzLmZvckVhY2goZm9yay51c2UpOwoJCSAgICB0eXBlcy5maW5hbGl6ZSgpOwoJCSAgICB2YXIgUGF0aFZpc2l0b3IgPSBmb3JrLnVzZShwYXRoX3Zpc2l0b3JfMS5kZWZhdWx0KTsKCQkgICAgcmV0dXJuIHsKCQkgICAgICAgIFR5cGU6IHR5cGVzLlR5cGUsCgkJICAgICAgICBidWlsdEluVHlwZXM6IHR5cGVzLmJ1aWx0SW5UeXBlcywKCQkgICAgICAgIG5hbWVkVHlwZXM6IHR5cGVzLm5hbWVkVHlwZXMsCgkJICAgICAgICBidWlsZGVyczogdHlwZXMuYnVpbGRlcnMsCgkJICAgICAgICBkZWZpbmVNZXRob2Q6IHR5cGVzLmRlZmluZU1ldGhvZCwKCQkgICAgICAgIGdldEZpZWxkTmFtZXM6IHR5cGVzLmdldEZpZWxkTmFtZXMsCgkJICAgICAgICBnZXRGaWVsZFZhbHVlOiB0eXBlcy5nZXRGaWVsZFZhbHVlLAoJCSAgICAgICAgZWFjaEZpZWxkOiB0eXBlcy5lYWNoRmllbGQsCgkJICAgICAgICBzb21lRmllbGQ6IHR5cGVzLnNvbWVGaWVsZCwKCQkgICAgICAgIGdldFN1cGVydHlwZU5hbWVzOiB0eXBlcy5nZXRTdXBlcnR5cGVOYW1lcywKCQkgICAgICAgIGdldEJ1aWxkZXJOYW1lOiB0eXBlcy5nZXRCdWlsZGVyTmFtZSwKCQkgICAgICAgIGFzdE5vZGVzQXJlRXF1aXZhbGVudDogZm9yay51c2UoZXF1aXZfMS5kZWZhdWx0KSwKCQkgICAgICAgIGZpbmFsaXplOiB0eXBlcy5maW5hbGl6ZSwKCQkgICAgICAgIFBhdGg6IGZvcmsudXNlKHBhdGhfMS5kZWZhdWx0KSwKCQkgICAgICAgIE5vZGVQYXRoOiBmb3JrLnVzZShub2RlX3BhdGhfMS5kZWZhdWx0KSwKCQkgICAgICAgIFBhdGhWaXNpdG9yOiBQYXRoVmlzaXRvciwKCQkgICAgICAgIHVzZTogZm9yay51c2UsCgkJICAgICAgICB2aXNpdDogUGF0aFZpc2l0b3IudmlzaXQsCgkJICAgIH07CgkJfQoJCWV4cG9ydHMuZGVmYXVsdCA9IGRlZmF1bHRfMTsKCQlmdW5jdGlvbiBjcmVhdGVGb3JrKCkgewoJCSAgICB2YXIgdXNlZCA9IFtdOwoJCSAgICB2YXIgdXNlZFJlc3VsdCA9IFtdOwoJCSAgICBmdW5jdGlvbiB1c2UocGx1Z2luKSB7CgkJICAgICAgICB2YXIgaWR4ID0gdXNlZC5pbmRleE9mKHBsdWdpbik7CgkJICAgICAgICBpZiAoaWR4ID09PSAtMSkgewoJCSAgICAgICAgICAgIGlkeCA9IHVzZWQubGVuZ3RoOwoJCSAgICAgICAgICAgIHVzZWQucHVzaChwbHVnaW4pOwoJCSAgICAgICAgICAgIHVzZWRSZXN1bHRbaWR4XSA9IHBsdWdpbihmb3JrKTsKCQkgICAgICAgIH0KCQkgICAgICAgIHJldHVybiB1c2VkUmVzdWx0W2lkeF07CgkJICAgIH0KCQkgICAgdmFyIGZvcmsgPSB7IHVzZTogdXNlIH07CgkJICAgIHJldHVybiBmb3JrOwoJCX0KCQltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbImRlZmF1bHQiXTsgCgl9IChmb3JrJDEsIGZvcmskMS5leHBvcnRzKSk7CglyZXR1cm4gZm9yayQxLmV4cG9ydHM7Cn0KCnZhciBjb3JlID0ge2V4cG9ydHM6IHt9fTsKCnZhciBjb3JlT3BlcmF0b3JzID0ge307Cgp2YXIgaGFzUmVxdWlyZWRDb3JlT3BlcmF0b3JzOwoKZnVuY3Rpb24gcmVxdWlyZUNvcmVPcGVyYXRvcnMgKCkgewoJaWYgKGhhc1JlcXVpcmVkQ29yZU9wZXJhdG9ycykgcmV0dXJuIGNvcmVPcGVyYXRvcnM7CgloYXNSZXF1aXJlZENvcmVPcGVyYXRvcnMgPSAxOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KGNvcmVPcGVyYXRvcnMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCWNvcmVPcGVyYXRvcnMuTG9naWNhbE9wZXJhdG9ycyA9IGNvcmVPcGVyYXRvcnMuQXNzaWdubWVudE9wZXJhdG9ycyA9IGNvcmVPcGVyYXRvcnMuQmluYXJ5T3BlcmF0b3JzID0gdm9pZCAwOwoJY29yZU9wZXJhdG9ycy5CaW5hcnlPcGVyYXRvcnMgPSBbCgkgICAgIj09IiwgIiE9IiwgIj09PSIsICIhPT0iLAoJICAgICI8IiwgIjw9IiwgIj4iLCAiPj0iLAoJICAgICI8PCIsICI+PiIsICI+Pj4iLAoJICAgICIrIiwgIi0iLCAiKiIsICIvIiwgIiUiLAoJICAgICImIiwKCSAgICAifCIsICJeIiwgImluIiwKCSAgICAiaW5zdGFuY2VvZiIsCgldOwoJY29yZU9wZXJhdG9ycy5Bc3NpZ25tZW50T3BlcmF0b3JzID0gWwoJICAgICI9IiwgIis9IiwgIi09IiwgIio9IiwgIi89IiwgIiU9IiwKCSAgICAiPDw9IiwgIj4+PSIsICI+Pj49IiwKCSAgICAifD0iLCAiXj0iLCAiJj0iLAoJXTsKCWNvcmVPcGVyYXRvcnMuTG9naWNhbE9wZXJhdG9ycyA9IFsKCSAgICAifHwiLCAiJiYiLAoJXTsKCXJldHVybiBjb3JlT3BlcmF0b3JzOwp9Cgp2YXIgc2hhcmVkID0ge2V4cG9ydHM6IHt9fTsKCnZhciBoYXNSZXF1aXJlZFNoYXJlZDsKCmZ1bmN0aW9uIHJlcXVpcmVTaGFyZWQgKCkgewoJaWYgKGhhc1JlcXVpcmVkU2hhcmVkKSByZXR1cm4gc2hhcmVkLmV4cG9ydHM7CgloYXNSZXF1aXJlZFNoYXJlZCA9IDE7CgkoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkJdmFyIHRzbGliXzEgPSByZXF1aXJlJCQwOwoJCXZhciB0eXBlc18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVR5cGVzKCkpOwoJCWZ1bmN0aW9uIGRlZmF1bHRfMShmb3JrKSB7CgkJICAgIHZhciB0eXBlcyA9IGZvcmsudXNlKHR5cGVzXzEuZGVmYXVsdCk7CgkJICAgIHZhciBUeXBlID0gdHlwZXMuVHlwZTsKCQkgICAgdmFyIGJ1aWx0aW4gPSB0eXBlcy5idWlsdEluVHlwZXM7CgkJICAgIHZhciBpc051bWJlciA9IGJ1aWx0aW4ubnVtYmVyOwoJCSAgICAvLyBBbiBleGFtcGxlIG9mIGNvbnN0cnVjdGluZyBhIG5ldyB0eXBlIHdpdGggYXJiaXRyYXJ5IGNvbnN0cmFpbnRzIGZyb20KCQkgICAgLy8gYW4gZXhpc3RpbmcgdHlwZS4KCQkgICAgZnVuY3Rpb24gZ2VxKHRoYW4pIHsKCQkgICAgICAgIHJldHVybiBUeXBlLmZyb20oZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiBpc051bWJlci5jaGVjayh2YWx1ZSkgJiYgdmFsdWUgPj0gdGhhbjsgfSwgaXNOdW1iZXIgKyAiID49ICIgKyB0aGFuKTsKCQkgICAgfQoJCSAgICAvLyBEZWZhdWx0IHZhbHVlLXJldHVybmluZyBmdW5jdGlvbnMgdGhhdCBtYXkgb3B0aW9uYWxseSBiZSBwYXNzZWQgYXMgYQoJCSAgICAvLyB0aGlyZCBhcmd1bWVudCB0byBEZWYucHJvdG90eXBlLmZpZWxkLgoJCSAgICB2YXIgZGVmYXVsdHMgPSB7CgkJICAgICAgICAvLyBGdW5jdGlvbnMgd2VyZSB1c2VkIGJlY2F1c2UgKGFtb25nIG90aGVyIHJlYXNvbnMpIHRoYXQncyB0aGUgbW9zdAoJCSAgICAgICAgLy8gZWxlZ2FudCB3YXkgdG8gYWxsb3cgZm9yIHRoZSBlbXB0eUFycmF5IG9uZSBhbHdheXMgdG8gZ2l2ZSBhIG5ldwoJCSAgICAgICAgLy8gYXJyYXkgaW5zdGFuY2UuCgkJICAgICAgICAibnVsbCI6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG51bGw7IH0sCgkJICAgICAgICAiZW1wdHlBcnJheSI6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFtdOyB9LAoJCSAgICAgICAgImZhbHNlIjogZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH0sCgkJICAgICAgICAidHJ1ZSI6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRydWU7IH0sCgkJICAgICAgICAidW5kZWZpbmVkIjogZnVuY3Rpb24gKCkgeyB9LAoJCSAgICAgICAgInVzZSBzdHJpY3QiOiBmdW5jdGlvbiAoKSB7IHJldHVybiAidXNlIHN0cmljdCI7IH0KCQkgICAgfTsKCQkgICAgdmFyIG5haXZlSXNQcmltaXRpdmUgPSBUeXBlLm9yKGJ1aWx0aW4uc3RyaW5nLCBidWlsdGluLm51bWJlciwgYnVpbHRpbi5ib29sZWFuLCBidWlsdGluLm51bGwsIGJ1aWx0aW4udW5kZWZpbmVkKTsKCQkgICAgdmFyIGlzUHJpbWl0aXZlID0gVHlwZS5mcm9tKGZ1bmN0aW9uICh2YWx1ZSkgewoJCSAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKQoJCSAgICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAgICAgICAgdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWU7CgkJICAgICAgICBpZiAodHlwZSA9PT0gIm9iamVjdCIgfHwKCQkgICAgICAgICAgICB0eXBlID09PSAiZnVuY3Rpb24iKSB7CgkJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAgICAgICAgfQoJCSAgICAgICAgcmV0dXJuIHRydWU7CgkJICAgIH0sIG5haXZlSXNQcmltaXRpdmUudG9TdHJpbmcoKSk7CgkJICAgIHJldHVybiB7CgkJICAgICAgICBnZXE6IGdlcSwKCQkgICAgICAgIGRlZmF1bHRzOiBkZWZhdWx0cywKCQkgICAgICAgIGlzUHJpbWl0aXZlOiBpc1ByaW1pdGl2ZSwKCQkgICAgfTsKCQl9CgkJZXhwb3J0cy5kZWZhdWx0ID0gZGVmYXVsdF8xOwoJCW1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1siZGVmYXVsdCJdOyAKCX0gKHNoYXJlZCwgc2hhcmVkLmV4cG9ydHMpKTsKCXJldHVybiBzaGFyZWQuZXhwb3J0czsKfQoKdmFyIGhhc1JlcXVpcmVkQ29yZTsKCmZ1bmN0aW9uIHJlcXVpcmVDb3JlICgpIHsKCWlmIChoYXNSZXF1aXJlZENvcmUpIHJldHVybiBjb3JlLmV4cG9ydHM7CgloYXNSZXF1aXJlZENvcmUgPSAxOwoJKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJCXZhciB0c2xpYl8xID0gcmVxdWlyZSQkMDsKCQl2YXIgY29yZV9vcGVyYXRvcnNfMSA9IHJlcXVpcmVDb3JlT3BlcmF0b3JzKCk7CgkJdmFyIHR5cGVzXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlVHlwZXMoKSk7CgkJdmFyIHNoYXJlZF8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVNoYXJlZCgpKTsKCQlmdW5jdGlvbiBkZWZhdWx0XzEoZm9yaykgewoJCSAgICB2YXIgdHlwZXMgPSBmb3JrLnVzZSh0eXBlc18xLmRlZmF1bHQpOwoJCSAgICB2YXIgVHlwZSA9IHR5cGVzLlR5cGU7CgkJICAgIHZhciBkZWYgPSBUeXBlLmRlZjsKCQkgICAgdmFyIG9yID0gVHlwZS5vcjsKCQkgICAgdmFyIHNoYXJlZCA9IGZvcmsudXNlKHNoYXJlZF8xLmRlZmF1bHQpOwoJCSAgICB2YXIgZGVmYXVsdHMgPSBzaGFyZWQuZGVmYXVsdHM7CgkJICAgIHZhciBnZXEgPSBzaGFyZWQuZ2VxOwoJCSAgICAvLyBBYnN0cmFjdCBzdXBlcnR5cGUgb2YgYWxsIHN5bnRhY3RpYyBlbnRpdGllcyB0aGF0IGFyZSBhbGxvd2VkIHRvIGhhdmUgYQoJCSAgICAvLyAubG9jIGZpZWxkLgoJCSAgICBkZWYoIlByaW50YWJsZSIpCgkJICAgICAgICAuZmllbGQoImxvYyIsIG9yKGRlZigiU291cmNlTG9jYXRpb24iKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0sIHRydWUpOwoJCSAgICBkZWYoIk5vZGUiKQoJCSAgICAgICAgLmJhc2VzKCJQcmludGFibGUiKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlIiwgU3RyaW5nKQoJCSAgICAgICAgLmZpZWxkKCJjb21tZW50cyIsIG9yKFtkZWYoIkNvbW1lbnQiKV0sIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdLCB0cnVlKTsKCQkgICAgZGVmKCJTb3VyY2VMb2NhdGlvbiIpCgkJICAgICAgICAuZmllbGQoInN0YXJ0IiwgZGVmKCJQb3NpdGlvbiIpKQoJCSAgICAgICAgLmZpZWxkKCJlbmQiLCBkZWYoIlBvc2l0aW9uIikpCgkJICAgICAgICAuZmllbGQoInNvdXJjZSIsIG9yKFN0cmluZywgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIlBvc2l0aW9uIikKCQkgICAgICAgIC5maWVsZCgibGluZSIsIGdlcSgxKSkKCQkgICAgICAgIC5maWVsZCgiY29sdW1uIiwgZ2VxKDApKTsKCQkgICAgZGVmKCJGaWxlIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoInByb2dyYW0iLCAibmFtZSIpCgkJICAgICAgICAuZmllbGQoInByb2dyYW0iLCBkZWYoIlByb2dyYW0iKSkKCQkgICAgICAgIC5maWVsZCgibmFtZSIsIG9yKFN0cmluZywgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIlByb2dyYW0iKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgiYm9keSIpCgkJICAgICAgICAuZmllbGQoImJvZHkiLCBbZGVmKCJTdGF0ZW1lbnQiKV0pOwoJCSAgICBkZWYoIkZ1bmN0aW9uIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuZmllbGQoImlkIiwgb3IoZGVmKCJJZGVudGlmaWVyIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKQoJCSAgICAgICAgLmZpZWxkKCJwYXJhbXMiLCBbZGVmKCJQYXR0ZXJuIildKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgZGVmKCJCbG9ja1N0YXRlbWVudCIpKQoJCSAgICAgICAgLmZpZWxkKCJnZW5lcmF0b3IiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgiYXN5bmMiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSk7CgkJICAgIGRlZigiU3RhdGVtZW50IikuYmFzZXMoIk5vZGUiKTsKCQkgICAgLy8gVGhlIGVtcHR5IC5idWlsZCgpIGhlcmUgbWVhbnMgdGhhdCBhbiBFbXB0eVN0YXRlbWVudCBjYW4gYmUgY29uc3RydWN0ZWQKCQkgICAgLy8gKGkuZS4gaXQncyBub3QgYWJzdHJhY3QpIGJ1dCB0aGF0IGl0IG5lZWRzIG5vIGFyZ3VtZW50cy4KCQkgICAgZGVmKCJFbXB0eVN0YXRlbWVudCIpLmJhc2VzKCJTdGF0ZW1lbnQiKS5idWlsZCgpOwoJCSAgICBkZWYoIkJsb2NrU3RhdGVtZW50IikKCQkgICAgICAgIC5iYXNlcygiU3RhdGVtZW50IikKCQkgICAgICAgIC5idWlsZCgiYm9keSIpCgkJICAgICAgICAuZmllbGQoImJvZHkiLCBbZGVmKCJTdGF0ZW1lbnQiKV0pOwoJCSAgICAvLyBUT0RPIEZpZ3VyZSBvdXQgaG93IHRvIHNpbGVudGx5IGNvZXJjZSBFeHByZXNzaW9ucyB0bwoJCSAgICAvLyBFeHByZXNzaW9uU3RhdGVtZW50cyB3aGVyZSBhIFN0YXRlbWVudCB3YXMgZXhwZWN0ZWQuCgkJICAgIGRlZigiRXhwcmVzc2lvblN0YXRlbWVudCIpCgkJICAgICAgICAuYmFzZXMoIlN0YXRlbWVudCIpCgkJICAgICAgICAuYnVpbGQoImV4cHJlc3Npb24iKQoJCSAgICAgICAgLmZpZWxkKCJleHByZXNzaW9uIiwgZGVmKCJFeHByZXNzaW9uIikpOwoJCSAgICBkZWYoIklmU3RhdGVtZW50IikKCQkgICAgICAgIC5iYXNlcygiU3RhdGVtZW50IikKCQkgICAgICAgIC5idWlsZCgidGVzdCIsICJjb25zZXF1ZW50IiwgImFsdGVybmF0ZSIpCgkJICAgICAgICAuZmllbGQoInRlc3QiLCBkZWYoIkV4cHJlc3Npb24iKSkKCQkgICAgICAgIC5maWVsZCgiY29uc2VxdWVudCIsIGRlZigiU3RhdGVtZW50IikpCgkJICAgICAgICAuZmllbGQoImFsdGVybmF0ZSIsIG9yKGRlZigiU3RhdGVtZW50IiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgZGVmKCJMYWJlbGVkU3RhdGVtZW50IikKCQkgICAgICAgIC5iYXNlcygiU3RhdGVtZW50IikKCQkgICAgICAgIC5idWlsZCgibGFiZWwiLCAiYm9keSIpCgkJICAgICAgICAuZmllbGQoImxhYmVsIiwgZGVmKCJJZGVudGlmaWVyIikpCgkJICAgICAgICAuZmllbGQoImJvZHkiLCBkZWYoIlN0YXRlbWVudCIpKTsKCQkgICAgZGVmKCJCcmVha1N0YXRlbWVudCIpCgkJICAgICAgICAuYmFzZXMoIlN0YXRlbWVudCIpCgkJICAgICAgICAuYnVpbGQoImxhYmVsIikKCQkgICAgICAgIC5maWVsZCgibGFiZWwiLCBvcihkZWYoIklkZW50aWZpZXIiKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIkNvbnRpbnVlU3RhdGVtZW50IikKCQkgICAgICAgIC5iYXNlcygiU3RhdGVtZW50IikKCQkgICAgICAgIC5idWlsZCgibGFiZWwiKQoJCSAgICAgICAgLmZpZWxkKCJsYWJlbCIsIG9yKGRlZigiSWRlbnRpZmllciIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiV2l0aFN0YXRlbWVudCIpCgkJICAgICAgICAuYmFzZXMoIlN0YXRlbWVudCIpCgkJICAgICAgICAuYnVpbGQoIm9iamVjdCIsICJib2R5IikKCQkgICAgICAgIC5maWVsZCgib2JqZWN0IiwgZGVmKCJFeHByZXNzaW9uIikpCgkJICAgICAgICAuZmllbGQoImJvZHkiLCBkZWYoIlN0YXRlbWVudCIpKTsKCQkgICAgZGVmKCJTd2l0Y2hTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJhc2VzKCJTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJ1aWxkKCJkaXNjcmltaW5hbnQiLCAiY2FzZXMiLCAibGV4aWNhbCIpCgkJICAgICAgICAuZmllbGQoImRpc2NyaW1pbmFudCIsIGRlZigiRXhwcmVzc2lvbiIpKQoJCSAgICAgICAgLmZpZWxkKCJjYXNlcyIsIFtkZWYoIlN3aXRjaENhc2UiKV0pCgkJICAgICAgICAuZmllbGQoImxleGljYWwiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSk7CgkJICAgIGRlZigiUmV0dXJuU3RhdGVtZW50IikKCQkgICAgICAgIC5iYXNlcygiU3RhdGVtZW50IikKCQkgICAgICAgIC5idWlsZCgiYXJndW1lbnQiKQoJCSAgICAgICAgLmZpZWxkKCJhcmd1bWVudCIsIG9yKGRlZigiRXhwcmVzc2lvbiIpLCBudWxsKSk7CgkJICAgIGRlZigiVGhyb3dTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJhc2VzKCJTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJ1aWxkKCJhcmd1bWVudCIpCgkJICAgICAgICAuZmllbGQoImFyZ3VtZW50IiwgZGVmKCJFeHByZXNzaW9uIikpOwoJCSAgICBkZWYoIlRyeVN0YXRlbWVudCIpCgkJICAgICAgICAuYmFzZXMoIlN0YXRlbWVudCIpCgkJICAgICAgICAuYnVpbGQoImJsb2NrIiwgImhhbmRsZXIiLCAiZmluYWxpemVyIikKCQkgICAgICAgIC5maWVsZCgiYmxvY2siLCBkZWYoIkJsb2NrU3RhdGVtZW50IikpCgkJICAgICAgICAuZmllbGQoImhhbmRsZXIiLCBvcihkZWYoIkNhdGNoQ2xhdXNlIiksIG51bGwpLCBmdW5jdGlvbiAoKSB7CgkJICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVycyAmJiB0aGlzLmhhbmRsZXJzWzBdIHx8IG51bGw7CgkJICAgIH0pCgkJICAgICAgICAuZmllbGQoImhhbmRsZXJzIiwgW2RlZigiQ2F0Y2hDbGF1c2UiKV0sIGZ1bmN0aW9uICgpIHsKCQkgICAgICAgIHJldHVybiB0aGlzLmhhbmRsZXIgPyBbdGhpcy5oYW5kbGVyXSA6IFtdOwoJCSAgICB9LCB0cnVlKSAvLyBJbmRpY2F0ZXMgdGhpcyBmaWVsZCBpcyBoaWRkZW4gZnJvbSBlYWNoRmllbGQgaXRlcmF0aW9uLgoJCSAgICAgICAgLmZpZWxkKCJndWFyZGVkSGFuZGxlcnMiLCBbZGVmKCJDYXRjaENsYXVzZSIpXSwgZGVmYXVsdHMuZW1wdHlBcnJheSkKCQkgICAgICAgIC5maWVsZCgiZmluYWxpemVyIiwgb3IoZGVmKCJCbG9ja1N0YXRlbWVudCIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiQ2F0Y2hDbGF1c2UiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgicGFyYW0iLCAiZ3VhcmQiLCAiYm9keSIpCgkJICAgICAgICAuZmllbGQoInBhcmFtIiwgZGVmKCJQYXR0ZXJuIikpCgkJICAgICAgICAuZmllbGQoImd1YXJkIiwgb3IoZGVmKCJFeHByZXNzaW9uIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgZGVmKCJCbG9ja1N0YXRlbWVudCIpKTsKCQkgICAgZGVmKCJXaGlsZVN0YXRlbWVudCIpCgkJICAgICAgICAuYmFzZXMoIlN0YXRlbWVudCIpCgkJICAgICAgICAuYnVpbGQoInRlc3QiLCAiYm9keSIpCgkJICAgICAgICAuZmllbGQoInRlc3QiLCBkZWYoIkV4cHJlc3Npb24iKSkKCQkgICAgICAgIC5maWVsZCgiYm9keSIsIGRlZigiU3RhdGVtZW50IikpOwoJCSAgICBkZWYoIkRvV2hpbGVTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJhc2VzKCJTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJ1aWxkKCJib2R5IiwgInRlc3QiKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgZGVmKCJTdGF0ZW1lbnQiKSkKCQkgICAgICAgIC5maWVsZCgidGVzdCIsIGRlZigiRXhwcmVzc2lvbiIpKTsKCQkgICAgZGVmKCJGb3JTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJhc2VzKCJTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJ1aWxkKCJpbml0IiwgInRlc3QiLCAidXBkYXRlIiwgImJvZHkiKQoJCSAgICAgICAgLmZpZWxkKCJpbml0Iiwgb3IoZGVmKCJWYXJpYWJsZURlY2xhcmF0aW9uIiksIGRlZigiRXhwcmVzc2lvbiIpLCBudWxsKSkKCQkgICAgICAgIC5maWVsZCgidGVzdCIsIG9yKGRlZigiRXhwcmVzc2lvbiIpLCBudWxsKSkKCQkgICAgICAgIC5maWVsZCgidXBkYXRlIiwgb3IoZGVmKCJFeHByZXNzaW9uIiksIG51bGwpKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgZGVmKCJTdGF0ZW1lbnQiKSk7CgkJICAgIGRlZigiRm9ySW5TdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJhc2VzKCJTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJ1aWxkKCJsZWZ0IiwgInJpZ2h0IiwgImJvZHkiKQoJCSAgICAgICAgLmZpZWxkKCJsZWZ0Iiwgb3IoZGVmKCJWYXJpYWJsZURlY2xhcmF0aW9uIiksIGRlZigiRXhwcmVzc2lvbiIpKSkKCQkgICAgICAgIC5maWVsZCgicmlnaHQiLCBkZWYoIkV4cHJlc3Npb24iKSkKCQkgICAgICAgIC5maWVsZCgiYm9keSIsIGRlZigiU3RhdGVtZW50IikpOwoJCSAgICBkZWYoIkRlYnVnZ2VyU3RhdGVtZW50IikuYmFzZXMoIlN0YXRlbWVudCIpLmJ1aWxkKCk7CgkJICAgIGRlZigiRGVjbGFyYXRpb24iKS5iYXNlcygiU3RhdGVtZW50Iik7CgkJICAgIGRlZigiRnVuY3Rpb25EZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkZ1bmN0aW9uIiwgIkRlY2xhcmF0aW9uIikKCQkgICAgICAgIC5idWlsZCgiaWQiLCAicGFyYW1zIiwgImJvZHkiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIGRlZigiSWRlbnRpZmllciIpKTsKCQkgICAgZGVmKCJGdW5jdGlvbkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJhc2VzKCJGdW5jdGlvbiIsICJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgiaWQiLCAicGFyYW1zIiwgImJvZHkiKTsKCQkgICAgZGVmKCJWYXJpYWJsZURlY2xhcmF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJraW5kIiwgImRlY2xhcmF0aW9ucyIpCgkJICAgICAgICAuZmllbGQoImtpbmQiLCBvcigidmFyIiwgImxldCIsICJjb25zdCIpKQoJCSAgICAgICAgLmZpZWxkKCJkZWNsYXJhdGlvbnMiLCBbZGVmKCJWYXJpYWJsZURlY2xhcmF0b3IiKV0pOwoJCSAgICBkZWYoIlZhcmlhYmxlRGVjbGFyYXRvciIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIsICJpbml0IikKCQkgICAgICAgIC5maWVsZCgiaWQiLCBkZWYoIlBhdHRlcm4iKSkKCQkgICAgICAgIC5maWVsZCgiaW5pdCIsIG9yKGRlZigiRXhwcmVzc2lvbiIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiRXhwcmVzc2lvbiIpLmJhc2VzKCJOb2RlIik7CgkJICAgIGRlZigiVGhpc0V4cHJlc3Npb24iKS5iYXNlcygiRXhwcmVzc2lvbiIpLmJ1aWxkKCk7CgkJICAgIGRlZigiQXJyYXlFeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoImVsZW1lbnRzIikKCQkgICAgICAgIC5maWVsZCgiZWxlbWVudHMiLCBbb3IoZGVmKCJFeHByZXNzaW9uIiksIG51bGwpXSk7CgkJICAgIGRlZigiT2JqZWN0RXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJwcm9wZXJ0aWVzIikKCQkgICAgICAgIC5maWVsZCgicHJvcGVydGllcyIsIFtkZWYoIlByb3BlcnR5IildKTsKCQkgICAgLy8gVE9ETyBOb3QgaW4gdGhlIE1vemlsbGEgUGFyc2VyIEFQSSwgYnV0IHVzZWQgYnkgRXNwcmltYS4KCQkgICAgZGVmKCJQcm9wZXJ0eSIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKSAvLyBXYW50IHRvIGJlIGFibGUgdG8gdmlzaXQgUHJvcGVydHkgTm9kZXMuCgkJICAgICAgICAuYnVpbGQoImtpbmQiLCAia2V5IiwgInZhbHVlIikKCQkgICAgICAgIC5maWVsZCgia2luZCIsIG9yKCJpbml0IiwgImdldCIsICJzZXQiKSkKCQkgICAgICAgIC5maWVsZCgia2V5Iiwgb3IoZGVmKCJMaXRlcmFsIiksIGRlZigiSWRlbnRpZmllciIpKSkKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBkZWYoIkV4cHJlc3Npb24iKSk7CgkJICAgIGRlZigiU2VxdWVuY2VFeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoImV4cHJlc3Npb25zIikKCQkgICAgICAgIC5maWVsZCgiZXhwcmVzc2lvbnMiLCBbZGVmKCJFeHByZXNzaW9uIildKTsKCQkgICAgdmFyIFVuYXJ5T3BlcmF0b3IgPSBvcigiLSIsICIrIiwgIiEiLCAifiIsICJ0eXBlb2YiLCAidm9pZCIsICJkZWxldGUiKTsKCQkgICAgZGVmKCJVbmFyeUV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgib3BlcmF0b3IiLCAiYXJndW1lbnQiLCAicHJlZml4IikKCQkgICAgICAgIC5maWVsZCgib3BlcmF0b3IiLCBVbmFyeU9wZXJhdG9yKQoJCSAgICAgICAgLmZpZWxkKCJhcmd1bWVudCIsIGRlZigiRXhwcmVzc2lvbiIpKQoJCSAgICAgICAgLy8gRXNwcmltYSBkb2Vzbid0IGJvdGhlciB3aXRoIHRoaXMgZmllbGQsIHByZXN1bWFibHkgYmVjYXVzZSBpdCdzCgkJICAgICAgICAvLyBhbHdheXMgdHJ1ZSBmb3IgdW5hcnkgb3BlcmF0b3JzLgoJCSAgICAgICAgLmZpZWxkKCJwcmVmaXgiLCBCb29sZWFuLCBkZWZhdWx0c1sidHJ1ZSJdKTsKCQkgICAgdmFyIEJpbmFyeU9wZXJhdG9yID0gb3IuYXBwbHkodm9pZCAwLCBjb3JlX29wZXJhdG9yc18xLkJpbmFyeU9wZXJhdG9ycyk7CgkJICAgIGRlZigiQmluYXJ5RXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJvcGVyYXRvciIsICJsZWZ0IiwgInJpZ2h0IikKCQkgICAgICAgIC5maWVsZCgib3BlcmF0b3IiLCBCaW5hcnlPcGVyYXRvcikKCQkgICAgICAgIC5maWVsZCgibGVmdCIsIGRlZigiRXhwcmVzc2lvbiIpKQoJCSAgICAgICAgLmZpZWxkKCJyaWdodCIsIGRlZigiRXhwcmVzc2lvbiIpKTsKCQkgICAgdmFyIEFzc2lnbm1lbnRPcGVyYXRvciA9IG9yLmFwcGx5KHZvaWQgMCwgY29yZV9vcGVyYXRvcnNfMS5Bc3NpZ25tZW50T3BlcmF0b3JzKTsKCQkgICAgZGVmKCJBc3NpZ25tZW50RXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJvcGVyYXRvciIsICJsZWZ0IiwgInJpZ2h0IikKCQkgICAgICAgIC5maWVsZCgib3BlcmF0b3IiLCBBc3NpZ25tZW50T3BlcmF0b3IpCgkJICAgICAgICAuZmllbGQoImxlZnQiLCBvcihkZWYoIlBhdHRlcm4iKSwgZGVmKCJNZW1iZXJFeHByZXNzaW9uIikpKQoJCSAgICAgICAgLmZpZWxkKCJyaWdodCIsIGRlZigiRXhwcmVzc2lvbiIpKTsKCQkgICAgdmFyIFVwZGF0ZU9wZXJhdG9yID0gb3IoIisrIiwgIi0tIik7CgkJICAgIGRlZigiVXBkYXRlRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJvcGVyYXRvciIsICJhcmd1bWVudCIsICJwcmVmaXgiKQoJCSAgICAgICAgLmZpZWxkKCJvcGVyYXRvciIsIFVwZGF0ZU9wZXJhdG9yKQoJCSAgICAgICAgLmZpZWxkKCJhcmd1bWVudCIsIGRlZigiRXhwcmVzc2lvbiIpKQoJCSAgICAgICAgLmZpZWxkKCJwcmVmaXgiLCBCb29sZWFuKTsKCQkgICAgdmFyIExvZ2ljYWxPcGVyYXRvciA9IG9yLmFwcGx5KHZvaWQgMCwgY29yZV9vcGVyYXRvcnNfMS5Mb2dpY2FsT3BlcmF0b3JzKTsKCQkgICAgZGVmKCJMb2dpY2FsRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJvcGVyYXRvciIsICJsZWZ0IiwgInJpZ2h0IikKCQkgICAgICAgIC5maWVsZCgib3BlcmF0b3IiLCBMb2dpY2FsT3BlcmF0b3IpCgkJICAgICAgICAuZmllbGQoImxlZnQiLCBkZWYoIkV4cHJlc3Npb24iKSkKCQkgICAgICAgIC5maWVsZCgicmlnaHQiLCBkZWYoIkV4cHJlc3Npb24iKSk7CgkJICAgIGRlZigiQ29uZGl0aW9uYWxFeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoInRlc3QiLCAiY29uc2VxdWVudCIsICJhbHRlcm5hdGUiKQoJCSAgICAgICAgLmZpZWxkKCJ0ZXN0IiwgZGVmKCJFeHByZXNzaW9uIikpCgkJICAgICAgICAuZmllbGQoImNvbnNlcXVlbnQiLCBkZWYoIkV4cHJlc3Npb24iKSkKCQkgICAgICAgIC5maWVsZCgiYWx0ZXJuYXRlIiwgZGVmKCJFeHByZXNzaW9uIikpOwoJCSAgICBkZWYoIk5ld0V4cHJlc3Npb24iKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgiY2FsbGVlIiwgImFyZ3VtZW50cyIpCgkJICAgICAgICAuZmllbGQoImNhbGxlZSIsIGRlZigiRXhwcmVzc2lvbiIpKQoJCSAgICAgICAgLy8gVGhlIE1vemlsbGEgUGFyc2VyIEFQSSBnaXZlcyB0aGlzIHR5cGUgYXMgW29yKGRlZigiRXhwcmVzc2lvbiIpLAoJCSAgICAgICAgLy8gbnVsbCldLCBidXQgbnVsbCB2YWx1ZXMgZG9uJ3QgcmVhbGx5IG1ha2Ugc2Vuc2UgYXQgdGhlIGNhbGwgc2l0ZS4KCQkgICAgICAgIC8vIFRPRE8gUmVwb3J0IHRoaXMgbm9uc2Vuc2UuCgkJICAgICAgICAuZmllbGQoImFyZ3VtZW50cyIsIFtkZWYoIkV4cHJlc3Npb24iKV0pOwoJCSAgICBkZWYoIkNhbGxFeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoImNhbGxlZSIsICJhcmd1bWVudHMiKQoJCSAgICAgICAgLmZpZWxkKCJjYWxsZWUiLCBkZWYoIkV4cHJlc3Npb24iKSkKCQkgICAgICAgIC8vIFNlZSBjb21tZW50IGZvciBOZXdFeHByZXNzaW9uIGFib3ZlLgoJCSAgICAgICAgLmZpZWxkKCJhcmd1bWVudHMiLCBbZGVmKCJFeHByZXNzaW9uIildKTsKCQkgICAgZGVmKCJNZW1iZXJFeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoIm9iamVjdCIsICJwcm9wZXJ0eSIsICJjb21wdXRlZCIpCgkJICAgICAgICAuZmllbGQoIm9iamVjdCIsIGRlZigiRXhwcmVzc2lvbiIpKQoJCSAgICAgICAgLmZpZWxkKCJwcm9wZXJ0eSIsIG9yKGRlZigiSWRlbnRpZmllciIpLCBkZWYoIkV4cHJlc3Npb24iKSkpCgkJICAgICAgICAuZmllbGQoImNvbXB1dGVkIiwgQm9vbGVhbiwgZnVuY3Rpb24gKCkgewoJCSAgICAgICAgdmFyIHR5cGUgPSB0aGlzLnByb3BlcnR5LnR5cGU7CgkJICAgICAgICBpZiAodHlwZSA9PT0gJ0xpdGVyYWwnIHx8CgkJICAgICAgICAgICAgdHlwZSA9PT0gJ01lbWJlckV4cHJlc3Npb24nIHx8CgkJICAgICAgICAgICAgdHlwZSA9PT0gJ0JpbmFyeUV4cHJlc3Npb24nKSB7CgkJICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkJICAgICAgICB9CgkJICAgICAgICByZXR1cm4gZmFsc2U7CgkJICAgIH0pOwoJCSAgICBkZWYoIlBhdHRlcm4iKS5iYXNlcygiTm9kZSIpOwoJCSAgICBkZWYoIlN3aXRjaENhc2UiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgidGVzdCIsICJjb25zZXF1ZW50IikKCQkgICAgICAgIC5maWVsZCgidGVzdCIsIG9yKGRlZigiRXhwcmVzc2lvbiIpLCBudWxsKSkKCQkgICAgICAgIC5maWVsZCgiY29uc2VxdWVudCIsIFtkZWYoIlN0YXRlbWVudCIpXSk7CgkJICAgIGRlZigiSWRlbnRpZmllciIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iLCAiUGF0dGVybiIpCgkJICAgICAgICAuYnVpbGQoIm5hbWUiKQoJCSAgICAgICAgLmZpZWxkKCJuYW1lIiwgU3RyaW5nKQoJCSAgICAgICAgLmZpZWxkKCJvcHRpb25hbCIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKTsKCQkgICAgZGVmKCJMaXRlcmFsIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoInZhbHVlIikKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBvcihTdHJpbmcsIEJvb2xlYW4sIG51bGwsIE51bWJlciwgUmVnRXhwKSkKCQkgICAgICAgIC5maWVsZCgicmVnZXgiLCBvcih7CgkJICAgICAgICBwYXR0ZXJuOiBTdHJpbmcsCgkJICAgICAgICBmbGFnczogU3RyaW5nCgkJICAgIH0sIG51bGwpLCBmdW5jdGlvbiAoKSB7CgkJICAgICAgICBpZiAodGhpcy52YWx1ZSBpbnN0YW5jZW9mIFJlZ0V4cCkgewoJCSAgICAgICAgICAgIHZhciBmbGFncyA9ICIiOwoJCSAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlLmlnbm9yZUNhc2UpCgkJICAgICAgICAgICAgICAgIGZsYWdzICs9ICJpIjsKCQkgICAgICAgICAgICBpZiAodGhpcy52YWx1ZS5tdWx0aWxpbmUpCgkJICAgICAgICAgICAgICAgIGZsYWdzICs9ICJtIjsKCQkgICAgICAgICAgICBpZiAodGhpcy52YWx1ZS5nbG9iYWwpCgkJICAgICAgICAgICAgICAgIGZsYWdzICs9ICJnIjsKCQkgICAgICAgICAgICByZXR1cm4gewoJCSAgICAgICAgICAgICAgICBwYXR0ZXJuOiB0aGlzLnZhbHVlLnNvdXJjZSwKCQkgICAgICAgICAgICAgICAgZmxhZ3M6IGZsYWdzCgkJICAgICAgICAgICAgfTsKCQkgICAgICAgIH0KCQkgICAgICAgIHJldHVybiBudWxsOwoJCSAgICB9KTsKCQkgICAgLy8gQWJzdHJhY3QgKG5vbi1idWlsZGFibGUpIGNvbW1lbnQgc3VwZXJ0eXBlLiBOb3QgYSBOb2RlLgoJCSAgICBkZWYoIkNvbW1lbnQiKQoJCSAgICAgICAgLmJhc2VzKCJQcmludGFibGUiKQoJCSAgICAgICAgLmZpZWxkKCJ2YWx1ZSIsIFN0cmluZykKCQkgICAgICAgIC8vIEEgLmxlYWRpbmcgY29tbWVudCBjb21lcyBiZWZvcmUgdGhlIG5vZGUsIHdoZXJlYXMgYSAudHJhaWxpbmcKCQkgICAgICAgIC8vIGNvbW1lbnQgY29tZXMgYWZ0ZXIgaXQuIFRoZXNlIHR3byBmaWVsZHMgc2hvdWxkIG5vdCBib3RoIGJlIHRydWUsCgkJICAgICAgICAvLyBidXQgdGhleSBtaWdodCBib3RoIGJlIGZhbHNlIHdoZW4gdGhlIGNvbW1lbnQgZmFsbHMgaW5zaWRlIGEgbm9kZQoJCSAgICAgICAgLy8gYW5kIHRoZSBub2RlIGhhcyBubyBjaGlsZHJlbiBmb3IgdGhlIGNvbW1lbnQgdG8gbGVhZCBvciB0cmFpbCwKCQkgICAgICAgIC8vIGUuZy4geyAvKmRhbmdsaW5nKi8gfS4KCQkgICAgICAgIC5maWVsZCgibGVhZGluZyIsIEJvb2xlYW4sIGRlZmF1bHRzWyJ0cnVlIl0pCgkJICAgICAgICAuZmllbGQoInRyYWlsaW5nIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pOwoJCX0KCQlleHBvcnRzLmRlZmF1bHQgPSBkZWZhdWx0XzE7CgkJbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07IAoJfSAoY29yZSwgY29yZS5leHBvcnRzKSk7CglyZXR1cm4gY29yZS5leHBvcnRzOwp9Cgp2YXIgZXM2ID0ge2V4cG9ydHM6IHt9fTsKCnZhciBoYXNSZXF1aXJlZEVzNjsKCmZ1bmN0aW9uIHJlcXVpcmVFczYgKCkgewoJaWYgKGhhc1JlcXVpcmVkRXM2KSByZXR1cm4gZXM2LmV4cG9ydHM7CgloYXNSZXF1aXJlZEVzNiA9IDE7CgkoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkJdmFyIHRzbGliXzEgPSByZXF1aXJlJCQwOwoJCXZhciBjb3JlXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlQ29yZSgpKTsKCQl2YXIgdHlwZXNfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVUeXBlcygpKTsKCQl2YXIgc2hhcmVkXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlU2hhcmVkKCkpOwoJCWZ1bmN0aW9uIGRlZmF1bHRfMShmb3JrKSB7CgkJICAgIGZvcmsudXNlKGNvcmVfMS5kZWZhdWx0KTsKCQkgICAgdmFyIHR5cGVzID0gZm9yay51c2UodHlwZXNfMS5kZWZhdWx0KTsKCQkgICAgdmFyIGRlZiA9IHR5cGVzLlR5cGUuZGVmOwoJCSAgICB2YXIgb3IgPSB0eXBlcy5UeXBlLm9yOwoJCSAgICB2YXIgZGVmYXVsdHMgPSBmb3JrLnVzZShzaGFyZWRfMS5kZWZhdWx0KS5kZWZhdWx0czsKCQkgICAgZGVmKCJGdW5jdGlvbiIpCgkJICAgICAgICAuZmllbGQoImdlbmVyYXRvciIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJleHByZXNzaW9uIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pCgkJICAgICAgICAuZmllbGQoImRlZmF1bHRzIiwgW29yKGRlZigiRXhwcmVzc2lvbiIpLCBudWxsKV0sIGRlZmF1bHRzLmVtcHR5QXJyYXkpCgkJICAgICAgICAvLyBMZWdhY3kKCQkgICAgICAgIC5maWVsZCgicmVzdCIsIG9yKGRlZigiSWRlbnRpZmllciIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIC8vIFRoZSBFU1RyZWUgd2F5IG9mIHJlcHJlc2VudGluZyBhIC4uLnJlc3QgcGFyYW1ldGVyLgoJCSAgICBkZWYoIlJlc3RFbGVtZW50IikKCQkgICAgICAgIC5iYXNlcygiUGF0dGVybiIpCgkJICAgICAgICAuYnVpbGQoImFyZ3VtZW50IikKCQkgICAgICAgIC5maWVsZCgiYXJndW1lbnQiLCBkZWYoIlBhdHRlcm4iKSkKCQkgICAgICAgIC5maWVsZCgidHlwZUFubm90YXRpb24iLCAvLyBmb3IgQmFieWxvbi4gRmxvdyBwYXJzZXIgcHV0cyBpdCBvbiB0aGUgaWRlbnRpZmllcgoJCSAgICBvcihkZWYoIlR5cGVBbm5vdGF0aW9uIiksIGRlZigiVFNUeXBlQW5ub3RhdGlvbiIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiU3ByZWFkRWxlbWVudFBhdHRlcm4iKQoJCSAgICAgICAgLmJhc2VzKCJQYXR0ZXJuIikKCQkgICAgICAgIC5idWlsZCgiYXJndW1lbnQiKQoJCSAgICAgICAgLmZpZWxkKCJhcmd1bWVudCIsIGRlZigiUGF0dGVybiIpKTsKCQkgICAgZGVmKCJGdW5jdGlvbkRlY2xhcmF0aW9uIikKCQkgICAgICAgIC5idWlsZCgiaWQiLCAicGFyYW1zIiwgImJvZHkiLCAiZ2VuZXJhdG9yIiwgImV4cHJlc3Npb24iKQoJCSAgICAgICAgLy8gTWF5IGJlIGBudWxsYCBpbiB0aGUgY29udGV4dCBvZiBgZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gKCkge31gCgkJICAgICAgICAuZmllbGQoImlkIiwgb3IoZGVmKCJJZGVudGlmaWVyIiksIG51bGwpKTsKCQkgICAgZGVmKCJGdW5jdGlvbkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIsICJwYXJhbXMiLCAiYm9keSIsICJnZW5lcmF0b3IiLCAiZXhwcmVzc2lvbiIpOwoJCSAgICBkZWYoIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRnVuY3Rpb24iLCAiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoInBhcmFtcyIsICJib2R5IiwgImV4cHJlc3Npb24iKQoJCSAgICAgICAgLy8gVGhlIGZvcmNlZCBudWxsIHZhbHVlIGhlcmUgaXMgY29tcGF0aWJsZSB3aXRoIHRoZSBvdmVycmlkZGVuCgkJICAgICAgICAvLyBkZWZpbml0aW9uIG9mIHRoZSAiaWQiIGZpZWxkIGluIHRoZSBGdW5jdGlvbiBpbnRlcmZhY2UuCgkJICAgICAgICAuZmllbGQoImlkIiwgbnVsbCwgZGVmYXVsdHNbIm51bGwiXSkKCQkgICAgICAgIC8vIEFycm93IGZ1bmN0aW9uIGJvZGllcyBhcmUgYWxsb3dlZCB0byBiZSBleHByZXNzaW9ucy4KCQkgICAgICAgIC5maWVsZCgiYm9keSIsIG9yKGRlZigiQmxvY2tTdGF0ZW1lbnQiKSwgZGVmKCJFeHByZXNzaW9uIikpKQoJCSAgICAgICAgLy8gVGhlIGN1cnJlbnQgc3BlYyBmb3JiaWRzIGFycm93IGdlbmVyYXRvcnMsIHNvIEkgaGF2ZSB0YWtlbiB0aGUKCQkgICAgICAgIC8vIGxpYmVydHkgb2YgZW5mb3JjaW5nIHRoYXQuIFRPRE8gUmVwb3J0IHRoaXMuCgkJICAgICAgICAuZmllbGQoImdlbmVyYXRvciIsIGZhbHNlLCBkZWZhdWx0c1siZmFsc2UiXSk7CgkJICAgIGRlZigiRm9yT2ZTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJhc2VzKCJTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJ1aWxkKCJsZWZ0IiwgInJpZ2h0IiwgImJvZHkiKQoJCSAgICAgICAgLmZpZWxkKCJsZWZ0Iiwgb3IoZGVmKCJWYXJpYWJsZURlY2xhcmF0aW9uIiksIGRlZigiUGF0dGVybiIpKSkKCQkgICAgICAgIC5maWVsZCgicmlnaHQiLCBkZWYoIkV4cHJlc3Npb24iKSkKCQkgICAgICAgIC5maWVsZCgiYm9keSIsIGRlZigiU3RhdGVtZW50IikpOwoJCSAgICBkZWYoIllpZWxkRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJhcmd1bWVudCIsICJkZWxlZ2F0ZSIpCgkJICAgICAgICAuZmllbGQoImFyZ3VtZW50Iiwgb3IoZGVmKCJFeHByZXNzaW9uIiksIG51bGwpKQoJCSAgICAgICAgLmZpZWxkKCJkZWxlZ2F0ZSIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKTsKCQkgICAgZGVmKCJHZW5lcmF0b3JFeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoImJvZHkiLCAiYmxvY2tzIiwgImZpbHRlciIpCgkJICAgICAgICAuZmllbGQoImJvZHkiLCBkZWYoIkV4cHJlc3Npb24iKSkKCQkgICAgICAgIC5maWVsZCgiYmxvY2tzIiwgW2RlZigiQ29tcHJlaGVuc2lvbkJsb2NrIildKQoJCSAgICAgICAgLmZpZWxkKCJmaWx0ZXIiLCBvcihkZWYoIkV4cHJlc3Npb24iKSwgbnVsbCkpOwoJCSAgICBkZWYoIkNvbXByZWhlbnNpb25FeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoImJvZHkiLCAiYmxvY2tzIiwgImZpbHRlciIpCgkJICAgICAgICAuZmllbGQoImJvZHkiLCBkZWYoIkV4cHJlc3Npb24iKSkKCQkgICAgICAgIC5maWVsZCgiYmxvY2tzIiwgW2RlZigiQ29tcHJlaGVuc2lvbkJsb2NrIildKQoJCSAgICAgICAgLmZpZWxkKCJmaWx0ZXIiLCBvcihkZWYoIkV4cHJlc3Npb24iKSwgbnVsbCkpOwoJCSAgICBkZWYoIkNvbXByZWhlbnNpb25CbG9jayIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCJsZWZ0IiwgInJpZ2h0IiwgImVhY2giKQoJCSAgICAgICAgLmZpZWxkKCJsZWZ0IiwgZGVmKCJQYXR0ZXJuIikpCgkJICAgICAgICAuZmllbGQoInJpZ2h0IiwgZGVmKCJFeHByZXNzaW9uIikpCgkJICAgICAgICAuZmllbGQoImVhY2giLCBCb29sZWFuKTsKCQkgICAgZGVmKCJQcm9wZXJ0eSIpCgkJICAgICAgICAuZmllbGQoImtleSIsIG9yKGRlZigiTGl0ZXJhbCIpLCBkZWYoIklkZW50aWZpZXIiKSwgZGVmKCJFeHByZXNzaW9uIikpKQoJCSAgICAgICAgLmZpZWxkKCJ2YWx1ZSIsIG9yKGRlZigiRXhwcmVzc2lvbiIpLCBkZWYoIlBhdHRlcm4iKSkpCgkJICAgICAgICAuZmllbGQoIm1ldGhvZCIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJzaG9ydGhhbmQiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgiY29tcHV0ZWQiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSk7CgkJICAgIGRlZigiT2JqZWN0UHJvcGVydHkiKQoJCSAgICAgICAgLmZpZWxkKCJzaG9ydGhhbmQiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSk7CgkJICAgIGRlZigiUHJvcGVydHlQYXR0ZXJuIikKCQkgICAgICAgIC5iYXNlcygiUGF0dGVybiIpCgkJICAgICAgICAuYnVpbGQoImtleSIsICJwYXR0ZXJuIikKCQkgICAgICAgIC5maWVsZCgia2V5Iiwgb3IoZGVmKCJMaXRlcmFsIiksIGRlZigiSWRlbnRpZmllciIpLCBkZWYoIkV4cHJlc3Npb24iKSkpCgkJICAgICAgICAuZmllbGQoInBhdHRlcm4iLCBkZWYoIlBhdHRlcm4iKSkKCQkgICAgICAgIC5maWVsZCgiY29tcHV0ZWQiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSk7CgkJICAgIGRlZigiT2JqZWN0UGF0dGVybiIpCgkJICAgICAgICAuYmFzZXMoIlBhdHRlcm4iKQoJCSAgICAgICAgLmJ1aWxkKCJwcm9wZXJ0aWVzIikKCQkgICAgICAgIC5maWVsZCgicHJvcGVydGllcyIsIFtvcihkZWYoIlByb3BlcnR5UGF0dGVybiIpLCBkZWYoIlByb3BlcnR5IikpXSk7CgkJICAgIGRlZigiQXJyYXlQYXR0ZXJuIikKCQkgICAgICAgIC5iYXNlcygiUGF0dGVybiIpCgkJICAgICAgICAuYnVpbGQoImVsZW1lbnRzIikKCQkgICAgICAgIC5maWVsZCgiZWxlbWVudHMiLCBbb3IoZGVmKCJQYXR0ZXJuIiksIG51bGwpXSk7CgkJICAgIGRlZigiU3ByZWFkRWxlbWVudCIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCJhcmd1bWVudCIpCgkJICAgICAgICAuZmllbGQoImFyZ3VtZW50IiwgZGVmKCJFeHByZXNzaW9uIikpOwoJCSAgICBkZWYoIkFycmF5RXhwcmVzc2lvbiIpCgkJICAgICAgICAuZmllbGQoImVsZW1lbnRzIiwgW29yKGRlZigiRXhwcmVzc2lvbiIpLCBkZWYoIlNwcmVhZEVsZW1lbnQiKSwgZGVmKCJSZXN0RWxlbWVudCIpLCBudWxsKV0pOwoJCSAgICBkZWYoIk5ld0V4cHJlc3Npb24iKQoJCSAgICAgICAgLmZpZWxkKCJhcmd1bWVudHMiLCBbb3IoZGVmKCJFeHByZXNzaW9uIiksIGRlZigiU3ByZWFkRWxlbWVudCIpKV0pOwoJCSAgICBkZWYoIkNhbGxFeHByZXNzaW9uIikKCQkgICAgICAgIC5maWVsZCgiYXJndW1lbnRzIiwgW29yKGRlZigiRXhwcmVzc2lvbiIpLCBkZWYoIlNwcmVhZEVsZW1lbnQiKSldKTsKCQkgICAgLy8gTm90ZTogdGhpcyBub2RlIHR5cGUgaXMgKm5vdCogYW4gQXNzaWdubWVudEV4cHJlc3Npb24gd2l0aCBhIFBhdHRlcm4gb24KCQkgICAgLy8gdGhlIGxlZnQtaGFuZCBzaWRlISBUaGUgZXhpc3RpbmcgQXNzaWdubWVudEV4cHJlc3Npb24gdHlwZSBhbHJlYWR5CgkJICAgIC8vIHN1cHBvcnRzIGRlc3RydWN0dXJpbmcgYXNzaWdubWVudHMuIEFzc2lnbm1lbnRQYXR0ZXJuIG5vZGVzIG1heSBhcHBlYXIKCQkgICAgLy8gd2hlcmV2ZXIgYSBQYXR0ZXJuIGlzIGFsbG93ZWQsIGFuZCB0aGUgcmlnaHQtaGFuZCBzaWRlIHJlcHJlc2VudHMgYQoJCSAgICAvLyBkZWZhdWx0IHZhbHVlIHRvIGJlIGRlc3RydWN0dXJlZCBhZ2FpbnN0IHRoZSBsZWZ0LWhhbmQgc2lkZSwgaWYgbm8KCQkgICAgLy8gdmFsdWUgaXMgb3RoZXJ3aXNlIHByb3ZpZGVkLiBGb3IgZXhhbXBsZTogZGVmYXVsdCBwYXJhbWV0ZXIgdmFsdWVzLgoJCSAgICBkZWYoIkFzc2lnbm1lbnRQYXR0ZXJuIikKCQkgICAgICAgIC5iYXNlcygiUGF0dGVybiIpCgkJICAgICAgICAuYnVpbGQoImxlZnQiLCAicmlnaHQiKQoJCSAgICAgICAgLmZpZWxkKCJsZWZ0IiwgZGVmKCJQYXR0ZXJuIikpCgkJICAgICAgICAuZmllbGQoInJpZ2h0IiwgZGVmKCJFeHByZXNzaW9uIikpOwoJCSAgICBkZWYoIk1ldGhvZERlZmluaXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImtpbmQiLCAia2V5IiwgInZhbHVlIiwgInN0YXRpYyIpCgkJICAgICAgICAuZmllbGQoImtpbmQiLCBvcigiY29uc3RydWN0b3IiLCAibWV0aG9kIiwgImdldCIsICJzZXQiKSkKCQkgICAgICAgIC5maWVsZCgia2V5IiwgZGVmKCJFeHByZXNzaW9uIikpCgkJICAgICAgICAuZmllbGQoInZhbHVlIiwgZGVmKCJGdW5jdGlvbiIpKQoJCSAgICAgICAgLmZpZWxkKCJjb21wdXRlZCIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJzdGF0aWMiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSk7CgkJICAgIHZhciBDbGFzc0JvZHlFbGVtZW50ID0gb3IoZGVmKCJNZXRob2REZWZpbml0aW9uIiksIGRlZigiVmFyaWFibGVEZWNsYXJhdG9yIiksIGRlZigiQ2xhc3NQcm9wZXJ0eURlZmluaXRpb24iKSwgZGVmKCJDbGFzc1Byb3BlcnR5IikpOwoJCSAgICBkZWYoIkNsYXNzUHJvcGVydHkiKQoJCSAgICAgICAgLmJhc2VzKCJEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImtleSIpCgkJICAgICAgICAuZmllbGQoImtleSIsIG9yKGRlZigiTGl0ZXJhbCIpLCBkZWYoIklkZW50aWZpZXIiKSwgZGVmKCJFeHByZXNzaW9uIikpKQoJCSAgICAgICAgLmZpZWxkKCJjb21wdXRlZCIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKTsKCQkgICAgZGVmKCJDbGFzc1Byb3BlcnR5RGVmaW5pdGlvbiIpIC8vIHN0YXRpYyBwcm9wZXJ0eQoJCSAgICAgICAgLmJhc2VzKCJEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImRlZmluaXRpb24iKQoJCSAgICAgICAgLy8gWWVzLCBWaXJnaW5pYSwgY2lyY3VsYXIgZGVmaW5pdGlvbnMgYXJlIHBlcm1pdHRlZC4KCQkgICAgICAgIC5maWVsZCgiZGVmaW5pdGlvbiIsIENsYXNzQm9keUVsZW1lbnQpOwoJCSAgICBkZWYoIkNsYXNzQm9keSIpCgkJICAgICAgICAuYmFzZXMoIkRlY2xhcmF0aW9uIikKCQkgICAgICAgIC5idWlsZCgiYm9keSIpCgkJICAgICAgICAuZmllbGQoImJvZHkiLCBbQ2xhc3NCb2R5RWxlbWVudF0pOwoJCSAgICBkZWYoIkNsYXNzRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImlkIiwgImJvZHkiLCAic3VwZXJDbGFzcyIpCgkJICAgICAgICAuZmllbGQoImlkIiwgb3IoZGVmKCJJZGVudGlmaWVyIiksIG51bGwpKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgZGVmKCJDbGFzc0JvZHkiKSkKCQkgICAgICAgIC5maWVsZCgic3VwZXJDbGFzcyIsIG9yKGRlZigiRXhwcmVzc2lvbiIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiQ2xhc3NFeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoImlkIiwgImJvZHkiLCAic3VwZXJDbGFzcyIpCgkJICAgICAgICAuZmllbGQoImlkIiwgb3IoZGVmKCJJZGVudGlmaWVyIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgZGVmKCJDbGFzc0JvZHkiKSkKCQkgICAgICAgIC5maWVsZCgic3VwZXJDbGFzcyIsIG9yKGRlZigiRXhwcmVzc2lvbiIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiU3VwZXIiKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgpOwoJCSAgICAvLyBTcGVjaWZpZXIgYW5kIE1vZHVsZVNwZWNpZmllciBhcmUgYWJzdHJhY3Qgbm9uLXN0YW5kYXJkIHR5cGVzCgkJICAgIC8vIGludHJvZHVjZWQgZm9yIGRlZmluaXRpb25hbCBjb252ZW5pZW5jZS4KCQkgICAgZGVmKCJTcGVjaWZpZXIiKS5iYXNlcygiTm9kZSIpOwoJCSAgICAvLyBUaGlzIHN1cGVydHlwZSBpcyBzaGFyZWQvYWJ1c2VkIGJ5IGJvdGggZGVmL2JhYmVsLmpzIGFuZAoJCSAgICAvLyBkZWYvZXNwcmltYS5qcy4gSW4gdGhlIGZ1dHVyZSwgaXQgd2lsbCBiZSBwb3NzaWJsZSB0byBsb2FkIG9ubHkgb25lIHNldAoJCSAgICAvLyBvZiBkZWZpbml0aW9ucyBhcHByb3ByaWF0ZSBmb3IgYSBnaXZlbiBwYXJzZXIsIGJ1dCB1bnRpbCB0aGVuIHdlIG11c3QKCQkgICAgLy8gcmVseSBvbiBkZWZhdWx0IGZ1bmN0aW9ucyB0byByZWNvbmNpbGUgdGhlIGNvbmZsaWN0aW5nIEFTVCBmb3JtYXRzLgoJCSAgICBkZWYoIk1vZHVsZVNwZWNpZmllciIpCgkJICAgICAgICAuYmFzZXMoIlNwZWNpZmllciIpCgkJICAgICAgICAvLyBUaGlzIGxvY2FsIGZpZWxkIGlzIHVzZWQgYnkgQmFiZWwvQWNvcm4uIEl0IHNob3VsZCBub3QgdGVjaG5pY2FsbHkKCQkgICAgICAgIC8vIGJlIG9wdGlvbmFsIGluIHRoZSBCYWJlbC9BY29ybiBBU1QgZm9ybWF0LCBidXQgaXQgbXVzdCBiZSBvcHRpb25hbAoJCSAgICAgICAgLy8gaW4gdGhlIEVzcHJpbWEgQVNUIGZvcm1hdC4KCQkgICAgICAgIC5maWVsZCgibG9jYWwiLCBvcihkZWYoIklkZW50aWZpZXIiKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pCgkJICAgICAgICAvLyBUaGUgaWQgYW5kIG5hbWUgZmllbGRzIGFyZSB1c2VkIGJ5IEVzcHJpbWEuIFRoZSBpZCBmaWVsZCBzaG91bGQgbm90CgkJICAgICAgICAvLyB0ZWNobmljYWxseSBiZSBvcHRpb25hbCBpbiB0aGUgRXNwcmltYSBBU1QgZm9ybWF0LCBidXQgaXQgbXVzdCBiZQoJCSAgICAgICAgLy8gb3B0aW9uYWwgaW4gdGhlIEJhYmVsL0Fjb3JuIEFTVCBmb3JtYXQuCgkJICAgICAgICAuZmllbGQoImlkIiwgb3IoZGVmKCJJZGVudGlmaWVyIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKQoJCSAgICAgICAgLmZpZWxkKCJuYW1lIiwgb3IoZGVmKCJJZGVudGlmaWVyIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgLy8gaW1wb3J0IHs8aWQgW2FzIG5hbWVdPn0gZnJvbSAuLi47CgkJICAgIGRlZigiSW1wb3J0U3BlY2lmaWVyIikKCQkgICAgICAgIC5iYXNlcygiTW9kdWxlU3BlY2lmaWVyIikKCQkgICAgICAgIC5idWlsZCgiaW1wb3J0ZWQiLCAibG9jYWwiKQoJCSAgICAgICAgLmZpZWxkKCJpbXBvcnRlZCIsIGRlZigiSWRlbnRpZmllciIpKTsKCQkgICAgLy8gaW1wb3J0IDxpZD4gZnJvbSAuLi47CgkJICAgIGRlZigiSW1wb3J0RGVmYXVsdFNwZWNpZmllciIpCgkJICAgICAgICAuYmFzZXMoIk1vZHVsZVNwZWNpZmllciIpCgkJICAgICAgICAuYnVpbGQoImxvY2FsIik7CgkJICAgIC8vIGltcG9ydCA8KiBhcyBpZD4gZnJvbSAuLi47CgkJICAgIGRlZigiSW1wb3J0TmFtZXNwYWNlU3BlY2lmaWVyIikKCQkgICAgICAgIC5iYXNlcygiTW9kdWxlU3BlY2lmaWVyIikKCQkgICAgICAgIC5idWlsZCgibG9jYWwiKTsKCQkgICAgZGVmKCJJbXBvcnREZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkRlY2xhcmF0aW9uIikKCQkgICAgICAgIC5idWlsZCgic3BlY2lmaWVycyIsICJzb3VyY2UiLCAiaW1wb3J0S2luZCIpCgkJICAgICAgICAuZmllbGQoInNwZWNpZmllcnMiLCBbb3IoZGVmKCJJbXBvcnRTcGVjaWZpZXIiKSwgZGVmKCJJbXBvcnROYW1lc3BhY2VTcGVjaWZpZXIiKSwgZGVmKCJJbXBvcnREZWZhdWx0U3BlY2lmaWVyIikpXSwgZGVmYXVsdHMuZW1wdHlBcnJheSkKCQkgICAgICAgIC5maWVsZCgic291cmNlIiwgZGVmKCJMaXRlcmFsIikpCgkJICAgICAgICAuZmllbGQoImltcG9ydEtpbmQiLCBvcigidmFsdWUiLCAidHlwZSIpLCBmdW5jdGlvbiAoKSB7CgkJICAgICAgICByZXR1cm4gInZhbHVlIjsKCQkgICAgfSk7CgkJICAgIGRlZigiRXhwb3J0TmFtZWREZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkRlY2xhcmF0aW9uIikKCQkgICAgICAgIC5idWlsZCgiZGVjbGFyYXRpb24iLCAic3BlY2lmaWVycyIsICJzb3VyY2UiKQoJCSAgICAgICAgLmZpZWxkKCJkZWNsYXJhdGlvbiIsIG9yKGRlZigiRGVjbGFyYXRpb24iKSwgbnVsbCkpCgkJICAgICAgICAuZmllbGQoInNwZWNpZmllcnMiLCBbZGVmKCJFeHBvcnRTcGVjaWZpZXIiKV0sIGRlZmF1bHRzLmVtcHR5QXJyYXkpCgkJICAgICAgICAuZmllbGQoInNvdXJjZSIsIG9yKGRlZigiTGl0ZXJhbCIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiRXhwb3J0U3BlY2lmaWVyIikKCQkgICAgICAgIC5iYXNlcygiTW9kdWxlU3BlY2lmaWVyIikKCQkgICAgICAgIC5idWlsZCgibG9jYWwiLCAiZXhwb3J0ZWQiKQoJCSAgICAgICAgLmZpZWxkKCJleHBvcnRlZCIsIGRlZigiSWRlbnRpZmllciIpKTsKCQkgICAgZGVmKCJFeHBvcnREZWZhdWx0RGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImRlY2xhcmF0aW9uIikKCQkgICAgICAgIC5maWVsZCgiZGVjbGFyYXRpb24iLCBvcihkZWYoIkRlY2xhcmF0aW9uIiksIGRlZigiRXhwcmVzc2lvbiIpKSk7CgkJICAgIGRlZigiRXhwb3J0QWxsRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoInNvdXJjZSIpCgkJICAgICAgICAuZmllbGQoInNvdXJjZSIsIGRlZigiTGl0ZXJhbCIpKTsKCQkgICAgZGVmKCJUYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgidGFnIiwgInF1YXNpIikKCQkgICAgICAgIC5maWVsZCgidGFnIiwgZGVmKCJFeHByZXNzaW9uIikpCgkJICAgICAgICAuZmllbGQoInF1YXNpIiwgZGVmKCJUZW1wbGF0ZUxpdGVyYWwiKSk7CgkJICAgIGRlZigiVGVtcGxhdGVMaXRlcmFsIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoInF1YXNpcyIsICJleHByZXNzaW9ucyIpCgkJICAgICAgICAuZmllbGQoInF1YXNpcyIsIFtkZWYoIlRlbXBsYXRlRWxlbWVudCIpXSkKCQkgICAgICAgIC5maWVsZCgiZXhwcmVzc2lvbnMiLCBbZGVmKCJFeHByZXNzaW9uIildKTsKCQkgICAgZGVmKCJUZW1wbGF0ZUVsZW1lbnQiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgidmFsdWUiLCAidGFpbCIpCgkJICAgICAgICAuZmllbGQoInZhbHVlIiwgeyAiY29va2VkIjogU3RyaW5nLCAicmF3IjogU3RyaW5nIH0pCgkJICAgICAgICAuZmllbGQoInRhaWwiLCBCb29sZWFuKTsKCQkgICAgZGVmKCJNZXRhUHJvcGVydHkiKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgibWV0YSIsICJwcm9wZXJ0eSIpCgkJICAgICAgICAuZmllbGQoIm1ldGEiLCBkZWYoIklkZW50aWZpZXIiKSkKCQkgICAgICAgIC5maWVsZCgicHJvcGVydHkiLCBkZWYoIklkZW50aWZpZXIiKSk7CgkJfQoJCWV4cG9ydHMuZGVmYXVsdCA9IGRlZmF1bHRfMTsKCQltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbImRlZmF1bHQiXTsgCgl9IChlczYsIGVzNi5leHBvcnRzKSk7CglyZXR1cm4gZXM2LmV4cG9ydHM7Cn0KCnZhciBlczIwMTYgPSB7ZXhwb3J0czoge319OwoKdmFyIGhhc1JlcXVpcmVkRXMyMDE2OwoKZnVuY3Rpb24gcmVxdWlyZUVzMjAxNiAoKSB7CglpZiAoaGFzUmVxdWlyZWRFczIwMTYpIHJldHVybiBlczIwMTYuZXhwb3J0czsKCWhhc1JlcXVpcmVkRXMyMDE2ID0gMTsKCShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCQl2YXIgdHNsaWJfMSA9IHJlcXVpcmUkJDA7CgkJdmFyIGNvcmVfb3BlcmF0b3JzXzEgPSByZXF1aXJlQ29yZU9wZXJhdG9ycygpOwoJCXZhciBlczZfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVFczYoKSk7CgkJdmFyIHR5cGVzXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlVHlwZXMoKSk7CgkJZnVuY3Rpb24gZGVmYXVsdF8xKGZvcmspIHsKCQkgICAgZm9yay51c2UoZXM2XzEuZGVmYXVsdCk7CgkJICAgIHZhciB0eXBlcyA9IGZvcmsudXNlKHR5cGVzXzEuZGVmYXVsdCk7CgkJICAgIHZhciBkZWYgPSB0eXBlcy5UeXBlLmRlZjsKCQkgICAgdmFyIG9yID0gdHlwZXMuVHlwZS5vcjsKCQkgICAgdmFyIEJpbmFyeU9wZXJhdG9yID0gb3IuYXBwbHkodm9pZCAwLCB0c2xpYl8xLl9fc3ByZWFkQXJyYXlzKGNvcmVfb3BlcmF0b3JzXzEuQmluYXJ5T3BlcmF0b3JzLCBbIioqIl0pKTsKCQkgICAgZGVmKCJCaW5hcnlFeHByZXNzaW9uIikKCQkgICAgICAgIC5maWVsZCgib3BlcmF0b3IiLCBCaW5hcnlPcGVyYXRvcik7CgkJICAgIHZhciBBc3NpZ25tZW50T3BlcmF0b3IgPSBvci5hcHBseSh2b2lkIDAsIHRzbGliXzEuX19zcHJlYWRBcnJheXMoY29yZV9vcGVyYXRvcnNfMS5Bc3NpZ25tZW50T3BlcmF0b3JzLCBbIioqPSJdKSk7CgkJICAgIGRlZigiQXNzaWdubWVudEV4cHJlc3Npb24iKQoJCSAgICAgICAgLmZpZWxkKCJvcGVyYXRvciIsIEFzc2lnbm1lbnRPcGVyYXRvcik7CgkJfQoJCWV4cG9ydHMuZGVmYXVsdCA9IGRlZmF1bHRfMTsKCQltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbImRlZmF1bHQiXTsgCgl9IChlczIwMTYsIGVzMjAxNi5leHBvcnRzKSk7CglyZXR1cm4gZXMyMDE2LmV4cG9ydHM7Cn0KCnZhciBlczIwMTcgPSB7ZXhwb3J0czoge319OwoKdmFyIGhhc1JlcXVpcmVkRXMyMDE3OwoKZnVuY3Rpb24gcmVxdWlyZUVzMjAxNyAoKSB7CglpZiAoaGFzUmVxdWlyZWRFczIwMTcpIHJldHVybiBlczIwMTcuZXhwb3J0czsKCWhhc1JlcXVpcmVkRXMyMDE3ID0gMTsKCShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCQl2YXIgdHNsaWJfMSA9IHJlcXVpcmUkJDA7CgkJdmFyIGVzMjAxNl8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZUVzMjAxNigpKTsKCQl2YXIgdHlwZXNfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVUeXBlcygpKTsKCQl2YXIgc2hhcmVkXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlU2hhcmVkKCkpOwoJCWZ1bmN0aW9uIGRlZmF1bHRfMShmb3JrKSB7CgkJICAgIGZvcmsudXNlKGVzMjAxNl8xLmRlZmF1bHQpOwoJCSAgICB2YXIgdHlwZXMgPSBmb3JrLnVzZSh0eXBlc18xLmRlZmF1bHQpOwoJCSAgICB2YXIgZGVmID0gdHlwZXMuVHlwZS5kZWY7CgkJICAgIHZhciBkZWZhdWx0cyA9IGZvcmsudXNlKHNoYXJlZF8xLmRlZmF1bHQpLmRlZmF1bHRzOwoJCSAgICBkZWYoIkZ1bmN0aW9uIikKCQkgICAgICAgIC5maWVsZCgiYXN5bmMiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSk7CgkJICAgIGRlZigiQXdhaXRFeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoImFyZ3VtZW50IikKCQkgICAgICAgIC5maWVsZCgiYXJndW1lbnQiLCBkZWYoIkV4cHJlc3Npb24iKSk7CgkJfQoJCWV4cG9ydHMuZGVmYXVsdCA9IGRlZmF1bHRfMTsKCQltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbImRlZmF1bHQiXTsgCgl9IChlczIwMTcsIGVzMjAxNy5leHBvcnRzKSk7CglyZXR1cm4gZXMyMDE3LmV4cG9ydHM7Cn0KCnZhciBlczIwMTggPSB7ZXhwb3J0czoge319OwoKdmFyIGhhc1JlcXVpcmVkRXMyMDE4OwoKZnVuY3Rpb24gcmVxdWlyZUVzMjAxOCAoKSB7CglpZiAoaGFzUmVxdWlyZWRFczIwMTgpIHJldHVybiBlczIwMTguZXhwb3J0czsKCWhhc1JlcXVpcmVkRXMyMDE4ID0gMTsKCShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCQl2YXIgdHNsaWJfMSA9IHJlcXVpcmUkJDA7CgkJdmFyIGVzMjAxN18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZUVzMjAxNygpKTsKCQl2YXIgdHlwZXNfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVUeXBlcygpKTsKCQl2YXIgc2hhcmVkXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlU2hhcmVkKCkpOwoJCWZ1bmN0aW9uIGRlZmF1bHRfMShmb3JrKSB7CgkJICAgIGZvcmsudXNlKGVzMjAxN18xLmRlZmF1bHQpOwoJCSAgICB2YXIgdHlwZXMgPSBmb3JrLnVzZSh0eXBlc18xLmRlZmF1bHQpOwoJCSAgICB2YXIgZGVmID0gdHlwZXMuVHlwZS5kZWY7CgkJICAgIHZhciBvciA9IHR5cGVzLlR5cGUub3I7CgkJICAgIHZhciBkZWZhdWx0cyA9IGZvcmsudXNlKHNoYXJlZF8xLmRlZmF1bHQpLmRlZmF1bHRzOwoJCSAgICBkZWYoIkZvck9mU3RhdGVtZW50IikKCQkgICAgICAgIC5maWVsZCgiYXdhaXQiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSk7CgkJICAgIC8vIExlZ2FjeQoJCSAgICBkZWYoIlNwcmVhZFByb3BlcnR5IikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoImFyZ3VtZW50IikKCQkgICAgICAgIC5maWVsZCgiYXJndW1lbnQiLCBkZWYoIkV4cHJlc3Npb24iKSk7CgkJICAgIGRlZigiT2JqZWN0RXhwcmVzc2lvbiIpCgkJICAgICAgICAuZmllbGQoInByb3BlcnRpZXMiLCBbb3IoZGVmKCJQcm9wZXJ0eSIpLCBkZWYoIlNwcmVhZFByb3BlcnR5IiksIC8vIExlZ2FjeQoJCSAgICAgICAgZGVmKCJTcHJlYWRFbGVtZW50IikpXSk7CgkJICAgIGRlZigiVGVtcGxhdGVFbGVtZW50IikKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCB7ICJjb29rZWQiOiBvcihTdHJpbmcsIG51bGwpLCAicmF3IjogU3RyaW5nIH0pOwoJCSAgICAvLyBMZWdhY3kKCQkgICAgZGVmKCJTcHJlYWRQcm9wZXJ0eVBhdHRlcm4iKQoJCSAgICAgICAgLmJhc2VzKCJQYXR0ZXJuIikKCQkgICAgICAgIC5idWlsZCgiYXJndW1lbnQiKQoJCSAgICAgICAgLmZpZWxkKCJhcmd1bWVudCIsIGRlZigiUGF0dGVybiIpKTsKCQkgICAgZGVmKCJPYmplY3RQYXR0ZXJuIikKCQkgICAgICAgIC5maWVsZCgicHJvcGVydGllcyIsIFtvcihkZWYoIlByb3BlcnR5UGF0dGVybiIpLCBkZWYoIlByb3BlcnR5IiksIGRlZigiUmVzdEVsZW1lbnQiKSwgZGVmKCJTcHJlYWRQcm9wZXJ0eVBhdHRlcm4iKSldKTsKCQl9CgkJZXhwb3J0cy5kZWZhdWx0ID0gZGVmYXVsdF8xOwoJCW1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1siZGVmYXVsdCJdOyAKCX0gKGVzMjAxOCwgZXMyMDE4LmV4cG9ydHMpKTsKCXJldHVybiBlczIwMTguZXhwb3J0czsKfQoKdmFyIGVzMjAxOSA9IHtleHBvcnRzOiB7fX07Cgp2YXIgaGFzUmVxdWlyZWRFczIwMTk7CgpmdW5jdGlvbiByZXF1aXJlRXMyMDE5ICgpIHsKCWlmIChoYXNSZXF1aXJlZEVzMjAxOSkgcmV0dXJuIGVzMjAxOS5leHBvcnRzOwoJaGFzUmVxdWlyZWRFczIwMTkgPSAxOwoJKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJCXZhciB0c2xpYl8xID0gcmVxdWlyZSQkMDsKCQl2YXIgZXMyMDE4XzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlRXMyMDE4KCkpOwoJCXZhciB0eXBlc18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVR5cGVzKCkpOwoJCXZhciBzaGFyZWRfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVTaGFyZWQoKSk7CgkJZnVuY3Rpb24gZGVmYXVsdF8xKGZvcmspIHsKCQkgICAgZm9yay51c2UoZXMyMDE4XzEuZGVmYXVsdCk7CgkJICAgIHZhciB0eXBlcyA9IGZvcmsudXNlKHR5cGVzXzEuZGVmYXVsdCk7CgkJICAgIHZhciBkZWYgPSB0eXBlcy5UeXBlLmRlZjsKCQkgICAgdmFyIG9yID0gdHlwZXMuVHlwZS5vcjsKCQkgICAgdmFyIGRlZmF1bHRzID0gZm9yay51c2Uoc2hhcmVkXzEuZGVmYXVsdCkuZGVmYXVsdHM7CgkJICAgIGRlZigiQ2F0Y2hDbGF1c2UiKQoJCSAgICAgICAgLmZpZWxkKCJwYXJhbSIsIG9yKGRlZigiUGF0dGVybiIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJfQoJCWV4cG9ydHMuZGVmYXVsdCA9IGRlZmF1bHRfMTsKCQltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbImRlZmF1bHQiXTsgCgl9IChlczIwMTksIGVzMjAxOS5leHBvcnRzKSk7CglyZXR1cm4gZXMyMDE5LmV4cG9ydHM7Cn0KCnZhciBlczIwMjAgPSB7ZXhwb3J0czoge319OwoKdmFyIGhhc1JlcXVpcmVkRXMyMDIwOwoKZnVuY3Rpb24gcmVxdWlyZUVzMjAyMCAoKSB7CglpZiAoaGFzUmVxdWlyZWRFczIwMjApIHJldHVybiBlczIwMjAuZXhwb3J0czsKCWhhc1JlcXVpcmVkRXMyMDIwID0gMTsKCShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCQl2YXIgdHNsaWJfMSA9IHJlcXVpcmUkJDA7CgkJdmFyIGNvcmVfb3BlcmF0b3JzXzEgPSByZXF1aXJlQ29yZU9wZXJhdG9ycygpOwoJCXZhciBlczIwMTlfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVFczIwMTkoKSk7CgkJdmFyIHR5cGVzXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlVHlwZXMoKSk7CgkJdmFyIHNoYXJlZF8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVNoYXJlZCgpKTsKCQlmdW5jdGlvbiBkZWZhdWx0XzEoZm9yaykgewoJCSAgICBmb3JrLnVzZShlczIwMTlfMS5kZWZhdWx0KTsKCQkgICAgdmFyIHR5cGVzID0gZm9yay51c2UodHlwZXNfMS5kZWZhdWx0KTsKCQkgICAgdmFyIGRlZiA9IHR5cGVzLlR5cGUuZGVmOwoJCSAgICB2YXIgb3IgPSB0eXBlcy5UeXBlLm9yOwoJCSAgICB2YXIgc2hhcmVkID0gZm9yay51c2Uoc2hhcmVkXzEuZGVmYXVsdCk7CgkJICAgIHZhciBkZWZhdWx0cyA9IHNoYXJlZC5kZWZhdWx0czsKCQkgICAgZGVmKCJJbXBvcnRFeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoInNvdXJjZSIpCgkJICAgICAgICAuZmllbGQoInNvdXJjZSIsIGRlZigiRXhwcmVzc2lvbiIpKTsKCQkgICAgZGVmKCJFeHBvcnRBbGxEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoInNvdXJjZSIsICJleHBvcnRlZCIpCgkJICAgICAgICAuZmllbGQoInNvdXJjZSIsIGRlZigiTGl0ZXJhbCIpKQoJCSAgICAgICAgLmZpZWxkKCJleHBvcnRlZCIsIG9yKGRlZigiSWRlbnRpZmllciIpLCBudWxsKSk7CgkJICAgIC8vIE9wdGlvbmFsIGNoYWluaW5nCgkJICAgIGRlZigiQ2hhaW5FbGVtZW50IikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuZmllbGQoIm9wdGlvbmFsIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pOwoJCSAgICBkZWYoIkNhbGxFeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIsICJDaGFpbkVsZW1lbnQiKTsKCQkgICAgZGVmKCJNZW1iZXJFeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIsICJDaGFpbkVsZW1lbnQiKTsKCQkgICAgZGVmKCJDaGFpbkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgiZXhwcmVzc2lvbiIpCgkJICAgICAgICAuZmllbGQoImV4cHJlc3Npb24iLCBkZWYoIkNoYWluRWxlbWVudCIpKTsKCQkgICAgZGVmKCJPcHRpb25hbENhbGxFeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiQ2FsbEV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJjYWxsZWUiLCAiYXJndW1lbnRzIiwgIm9wdGlvbmFsIikKCQkgICAgICAgIC5maWVsZCgib3B0aW9uYWwiLCBCb29sZWFuLCBkZWZhdWx0c1sidHJ1ZSJdKTsKCQkgICAgLy8gRGVwcmVjYXRlZCBvcHRpb25hbCBjaGFpbmluZyB0eXBlLCBkb2Vzbid0IHdvcmsgd2l0aCBiYWJlbFBhcnNlckA3LjExLjAgb3IgbmV3ZXIKCQkgICAgZGVmKCJPcHRpb25hbE1lbWJlckV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJhc2VzKCJNZW1iZXJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgib2JqZWN0IiwgInByb3BlcnR5IiwgImNvbXB1dGVkIiwgIm9wdGlvbmFsIikKCQkgICAgICAgIC5maWVsZCgib3B0aW9uYWwiLCBCb29sZWFuLCBkZWZhdWx0c1sidHJ1ZSJdKTsKCQkgICAgLy8gTnVsbGlzaCBjb2FsZXNjaW5nCgkJICAgIHZhciBMb2dpY2FsT3BlcmF0b3IgPSBvci5hcHBseSh2b2lkIDAsIHRzbGliXzEuX19zcHJlYWRBcnJheXMoY29yZV9vcGVyYXRvcnNfMS5Mb2dpY2FsT3BlcmF0b3JzLCBbIj8/Il0pKTsKCQkgICAgZGVmKCJMb2dpY2FsRXhwcmVzc2lvbiIpCgkJICAgICAgICAuZmllbGQoIm9wZXJhdG9yIiwgTG9naWNhbE9wZXJhdG9yKTsKCQl9CgkJZXhwb3J0cy5kZWZhdWx0ID0gZGVmYXVsdF8xOwoJCW1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1siZGVmYXVsdCJdOyAKCX0gKGVzMjAyMCwgZXMyMDIwLmV4cG9ydHMpKTsKCXJldHVybiBlczIwMjAuZXhwb3J0czsKfQoKdmFyIGpzeCA9IHtleHBvcnRzOiB7fX07Cgp2YXIgaGFzUmVxdWlyZWRKc3g7CgpmdW5jdGlvbiByZXF1aXJlSnN4ICgpIHsKCWlmIChoYXNSZXF1aXJlZEpzeCkgcmV0dXJuIGpzeC5leHBvcnRzOwoJaGFzUmVxdWlyZWRKc3ggPSAxOwoJKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJCXZhciB0c2xpYl8xID0gcmVxdWlyZSQkMDsKCQl2YXIgZXMyMDIwXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlRXMyMDIwKCkpOwoJCXZhciB0eXBlc18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVR5cGVzKCkpOwoJCXZhciBzaGFyZWRfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVTaGFyZWQoKSk7CgkJZnVuY3Rpb24gZGVmYXVsdF8xKGZvcmspIHsKCQkgICAgZm9yay51c2UoZXMyMDIwXzEuZGVmYXVsdCk7CgkJICAgIHZhciB0eXBlcyA9IGZvcmsudXNlKHR5cGVzXzEuZGVmYXVsdCk7CgkJICAgIHZhciBkZWYgPSB0eXBlcy5UeXBlLmRlZjsKCQkgICAgdmFyIG9yID0gdHlwZXMuVHlwZS5vcjsKCQkgICAgdmFyIGRlZmF1bHRzID0gZm9yay51c2Uoc2hhcmVkXzEuZGVmYXVsdCkuZGVmYXVsdHM7CgkJICAgIGRlZigiSlNYQXR0cmlidXRlIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoIm5hbWUiLCAidmFsdWUiKQoJCSAgICAgICAgLmZpZWxkKCJuYW1lIiwgb3IoZGVmKCJKU1hJZGVudGlmaWVyIiksIGRlZigiSlNYTmFtZXNwYWNlZE5hbWUiKSkpCgkJICAgICAgICAuZmllbGQoInZhbHVlIiwgb3IoZGVmKCJMaXRlcmFsIiksIC8vIGF0dHI9InZhbHVlIgoJCSAgICBkZWYoIkpTWEV4cHJlc3Npb25Db250YWluZXIiKSwgLy8gYXR0cj17dmFsdWV9CgkJICAgIGRlZigiSlNYRWxlbWVudCIpLCAvLyBhdHRyPTxkaXYgLz4KCQkgICAgZGVmKCJKU1hGcmFnbWVudCIpLCAvLyBhdHRyPTw+PC8+CgkJICAgIG51bGwgLy8gYXR0cj0gb3IganVzdCBhdHRyCgkJICAgICksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIkpTWElkZW50aWZpZXIiKQoJCSAgICAgICAgLmJhc2VzKCJJZGVudGlmaWVyIikKCQkgICAgICAgIC5idWlsZCgibmFtZSIpCgkJICAgICAgICAuZmllbGQoIm5hbWUiLCBTdHJpbmcpOwoJCSAgICBkZWYoIkpTWE5hbWVzcGFjZWROYW1lIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoIm5hbWVzcGFjZSIsICJuYW1lIikKCQkgICAgICAgIC5maWVsZCgibmFtZXNwYWNlIiwgZGVmKCJKU1hJZGVudGlmaWVyIikpCgkJICAgICAgICAuZmllbGQoIm5hbWUiLCBkZWYoIkpTWElkZW50aWZpZXIiKSk7CgkJICAgIGRlZigiSlNYTWVtYmVyRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIk1lbWJlckV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJvYmplY3QiLCAicHJvcGVydHkiKQoJCSAgICAgICAgLmZpZWxkKCJvYmplY3QiLCBvcihkZWYoIkpTWElkZW50aWZpZXIiKSwgZGVmKCJKU1hNZW1iZXJFeHByZXNzaW9uIikpKQoJCSAgICAgICAgLmZpZWxkKCJwcm9wZXJ0eSIsIGRlZigiSlNYSWRlbnRpZmllciIpKQoJCSAgICAgICAgLmZpZWxkKCJjb21wdXRlZCIsIEJvb2xlYW4sIGRlZmF1bHRzLmZhbHNlKTsKCQkgICAgdmFyIEpTWEVsZW1lbnROYW1lID0gb3IoZGVmKCJKU1hJZGVudGlmaWVyIiksIGRlZigiSlNYTmFtZXNwYWNlZE5hbWUiKSwgZGVmKCJKU1hNZW1iZXJFeHByZXNzaW9uIikpOwoJCSAgICBkZWYoIkpTWFNwcmVhZEF0dHJpYnV0ZSIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCJhcmd1bWVudCIpCgkJICAgICAgICAuZmllbGQoImFyZ3VtZW50IiwgZGVmKCJFeHByZXNzaW9uIikpOwoJCSAgICB2YXIgSlNYQXR0cmlidXRlcyA9IFtvcihkZWYoIkpTWEF0dHJpYnV0ZSIpLCBkZWYoIkpTWFNwcmVhZEF0dHJpYnV0ZSIpKV07CgkJICAgIGRlZigiSlNYRXhwcmVzc2lvbkNvbnRhaW5lciIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJleHByZXNzaW9uIikKCQkgICAgICAgIC5maWVsZCgiZXhwcmVzc2lvbiIsIG9yKGRlZigiRXhwcmVzc2lvbiIpLCBkZWYoIkpTWEVtcHR5RXhwcmVzc2lvbiIpKSk7CgkJICAgIHZhciBKU1hDaGlsZHJlbiA9IFtvcihkZWYoIkpTWFRleHQiKSwgZGVmKCJKU1hFeHByZXNzaW9uQ29udGFpbmVyIiksIGRlZigiSlNYU3ByZWFkQ2hpbGQiKSwgZGVmKCJKU1hFbGVtZW50IiksIGRlZigiSlNYRnJhZ21lbnQiKSwgZGVmKCJMaXRlcmFsIikgLy8gTGVnYWN5OiBFc3ByaW1hIHNob3VsZCByZXR1cm4gSlNYVGV4dCBpbnN0ZWFkLgoJCSAgICAgICAgKV07CgkJICAgIGRlZigiSlNYRWxlbWVudCIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJvcGVuaW5nRWxlbWVudCIsICJjbG9zaW5nRWxlbWVudCIsICJjaGlsZHJlbiIpCgkJICAgICAgICAuZmllbGQoIm9wZW5pbmdFbGVtZW50IiwgZGVmKCJKU1hPcGVuaW5nRWxlbWVudCIpKQoJCSAgICAgICAgLmZpZWxkKCJjbG9zaW5nRWxlbWVudCIsIG9yKGRlZigiSlNYQ2xvc2luZ0VsZW1lbnQiKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pCgkJICAgICAgICAuZmllbGQoImNoaWxkcmVuIiwgSlNYQ2hpbGRyZW4sIGRlZmF1bHRzLmVtcHR5QXJyYXkpCgkJICAgICAgICAuZmllbGQoIm5hbWUiLCBKU1hFbGVtZW50TmFtZSwgZnVuY3Rpb24gKCkgewoJCSAgICAgICAgLy8gTGl0dGxlLWtub3duIGZhY3Q6IHRoZSBgdGhpc2Agb2JqZWN0IGluc2lkZSBhIGRlZmF1bHQgZnVuY3Rpb24KCQkgICAgICAgIC8vIGlzIG5vbmUgb3RoZXIgdGhhbiB0aGUgcGFydGlhbGx5LWJ1aWx0IG9iamVjdCBpdHNlbGYsIGFuZCBhbnkKCQkgICAgICAgIC8vIGZpZWxkcyBpbml0aWFsaXplZCBkaXJlY3RseSBmcm9tIGJ1aWxkZXIgZnVuY3Rpb24gYXJndW1lbnRzCgkJICAgICAgICAvLyAobGlrZSBvcGVuaW5nRWxlbWVudCwgY2xvc2luZ0VsZW1lbnQsIGFuZCBjaGlsZHJlbikgYXJlCgkJICAgICAgICAvLyBndWFyYW50ZWVkIHRvIGJlIGF2YWlsYWJsZS4KCQkgICAgICAgIHJldHVybiB0aGlzLm9wZW5pbmdFbGVtZW50Lm5hbWU7CgkJICAgIH0sIHRydWUpIC8vIGhpZGRlbiBmcm9tIHRyYXZlcnNhbAoJCSAgICAgICAgLmZpZWxkKCJzZWxmQ2xvc2luZyIsIEJvb2xlYW4sIGZ1bmN0aW9uICgpIHsKCQkgICAgICAgIHJldHVybiB0aGlzLm9wZW5pbmdFbGVtZW50LnNlbGZDbG9zaW5nOwoJCSAgICB9LCB0cnVlKSAvLyBoaWRkZW4gZnJvbSB0cmF2ZXJzYWwKCQkgICAgICAgIC5maWVsZCgiYXR0cmlidXRlcyIsIEpTWEF0dHJpYnV0ZXMsIGZ1bmN0aW9uICgpIHsKCQkgICAgICAgIHJldHVybiB0aGlzLm9wZW5pbmdFbGVtZW50LmF0dHJpYnV0ZXM7CgkJICAgIH0sIHRydWUpOyAvLyBoaWRkZW4gZnJvbSB0cmF2ZXJzYWwKCQkgICAgZGVmKCJKU1hPcGVuaW5nRWxlbWVudCIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCJuYW1lIiwgImF0dHJpYnV0ZXMiLCAic2VsZkNsb3NpbmciKQoJCSAgICAgICAgLmZpZWxkKCJuYW1lIiwgSlNYRWxlbWVudE5hbWUpCgkJICAgICAgICAuZmllbGQoImF0dHJpYnV0ZXMiLCBKU1hBdHRyaWJ1dGVzLCBkZWZhdWx0cy5lbXB0eUFycmF5KQoJCSAgICAgICAgLmZpZWxkKCJzZWxmQ2xvc2luZyIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKTsKCQkgICAgZGVmKCJKU1hDbG9zaW5nRWxlbWVudCIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCJuYW1lIikKCQkgICAgICAgIC5maWVsZCgibmFtZSIsIEpTWEVsZW1lbnROYW1lKTsKCQkgICAgZGVmKCJKU1hGcmFnbWVudCIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJvcGVuaW5nRnJhZ21lbnQiLCAiY2xvc2luZ0ZyYWdtZW50IiwgImNoaWxkcmVuIikKCQkgICAgICAgIC5maWVsZCgib3BlbmluZ0ZyYWdtZW50IiwgZGVmKCJKU1hPcGVuaW5nRnJhZ21lbnQiKSkKCQkgICAgICAgIC5maWVsZCgiY2xvc2luZ0ZyYWdtZW50IiwgZGVmKCJKU1hDbG9zaW5nRnJhZ21lbnQiKSkKCQkgICAgICAgIC5maWVsZCgiY2hpbGRyZW4iLCBKU1hDaGlsZHJlbiwgZGVmYXVsdHMuZW1wdHlBcnJheSk7CgkJICAgIGRlZigiSlNYT3BlbmluZ0ZyYWdtZW50IikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoKTsKCQkgICAgZGVmKCJKU1hDbG9zaW5nRnJhZ21lbnQiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgpOwoJCSAgICBkZWYoIkpTWFRleHQiKQoJCSAgICAgICAgLmJhc2VzKCJMaXRlcmFsIikKCQkgICAgICAgIC5idWlsZCgidmFsdWUiLCAicmF3IikKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBTdHJpbmcpCgkJICAgICAgICAuZmllbGQoInJhdyIsIFN0cmluZywgZnVuY3Rpb24gKCkgewoJCSAgICAgICAgcmV0dXJuIHRoaXMudmFsdWU7CgkJICAgIH0pOwoJCSAgICBkZWYoIkpTWEVtcHR5RXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCk7CgkJICAgIGRlZigiSlNYU3ByZWFkQ2hpbGQiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgiZXhwcmVzc2lvbiIpCgkJICAgICAgICAuZmllbGQoImV4cHJlc3Npb24iLCBkZWYoIkV4cHJlc3Npb24iKSk7CgkJfQoJCWV4cG9ydHMuZGVmYXVsdCA9IGRlZmF1bHRfMTsKCQltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbImRlZmF1bHQiXTsgCgl9IChqc3gsIGpzeC5leHBvcnRzKSk7CglyZXR1cm4ganN4LmV4cG9ydHM7Cn0KCnZhciBmbG93ID0ge2V4cG9ydHM6IHt9fTsKCnZhciBlc1Byb3Bvc2FscyA9IHtleHBvcnRzOiB7fX07Cgp2YXIgaGFzUmVxdWlyZWRFc1Byb3Bvc2FsczsKCmZ1bmN0aW9uIHJlcXVpcmVFc1Byb3Bvc2FscyAoKSB7CglpZiAoaGFzUmVxdWlyZWRFc1Byb3Bvc2FscykgcmV0dXJuIGVzUHJvcG9zYWxzLmV4cG9ydHM7CgloYXNSZXF1aXJlZEVzUHJvcG9zYWxzID0gMTsKCShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCQl2YXIgdHNsaWJfMSA9IHJlcXVpcmUkJDA7CgkJdmFyIHR5cGVzXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlVHlwZXMoKSk7CgkJdmFyIHNoYXJlZF8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVNoYXJlZCgpKTsKCQl2YXIgZXMyMDIwXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlRXMyMDIwKCkpOwoJCWZ1bmN0aW9uIGRlZmF1bHRfMShmb3JrKSB7CgkJICAgIGZvcmsudXNlKGVzMjAyMF8xLmRlZmF1bHQpOwoJCSAgICB2YXIgdHlwZXMgPSBmb3JrLnVzZSh0eXBlc18xLmRlZmF1bHQpOwoJCSAgICB2YXIgVHlwZSA9IHR5cGVzLlR5cGU7CgkJICAgIHZhciBkZWYgPSB0eXBlcy5UeXBlLmRlZjsKCQkgICAgdmFyIG9yID0gVHlwZS5vcjsKCQkgICAgdmFyIHNoYXJlZCA9IGZvcmsudXNlKHNoYXJlZF8xLmRlZmF1bHQpOwoJCSAgICB2YXIgZGVmYXVsdHMgPSBzaGFyZWQuZGVmYXVsdHM7CgkJICAgIGRlZigiQXdhaXRFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgiYXJndW1lbnQiLCAiYWxsIikKCQkgICAgICAgIC5maWVsZCgiYXJndW1lbnQiLCBvcihkZWYoIkV4cHJlc3Npb24iKSwgbnVsbCkpCgkJICAgICAgICAuZmllbGQoImFsbCIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKTsKCQkgICAgLy8gRGVjb3JhdG9ycwoJCSAgICBkZWYoIkRlY29yYXRvciIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCJleHByZXNzaW9uIikKCQkgICAgICAgIC5maWVsZCgiZXhwcmVzc2lvbiIsIGRlZigiRXhwcmVzc2lvbiIpKTsKCQkgICAgZGVmKCJQcm9wZXJ0eSIpCgkJICAgICAgICAuZmllbGQoImRlY29yYXRvcnMiLCBvcihbZGVmKCJEZWNvcmF0b3IiKV0sIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgZGVmKCJNZXRob2REZWZpbml0aW9uIikKCQkgICAgICAgIC5maWVsZCgiZGVjb3JhdG9ycyIsIG9yKFtkZWYoIkRlY29yYXRvciIpXSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICAvLyBQcml2YXRlIG5hbWVzCgkJICAgIGRlZigiUHJpdmF0ZU5hbWUiKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIiwgIlBhdHRlcm4iKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIpCgkJICAgICAgICAuZmllbGQoImlkIiwgZGVmKCJJZGVudGlmaWVyIikpOwoJCSAgICBkZWYoIkNsYXNzUHJpdmF0ZVByb3BlcnR5IikKCQkgICAgICAgIC5iYXNlcygiQ2xhc3NQcm9wZXJ0eSIpCgkJICAgICAgICAuYnVpbGQoImtleSIsICJ2YWx1ZSIpCgkJICAgICAgICAuZmllbGQoImtleSIsIGRlZigiUHJpdmF0ZU5hbWUiKSkKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBvcihkZWYoIkV4cHJlc3Npb24iKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCX0KCQlleHBvcnRzLmRlZmF1bHQgPSBkZWZhdWx0XzE7CgkJbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07IAoJfSAoZXNQcm9wb3NhbHMsIGVzUHJvcG9zYWxzLmV4cG9ydHMpKTsKCXJldHVybiBlc1Byb3Bvc2Fscy5leHBvcnRzOwp9Cgp2YXIgdHlwZUFubm90YXRpb25zID0ge2V4cG9ydHM6IHt9fTsKCnZhciBoYXNSZXF1aXJlZFR5cGVBbm5vdGF0aW9uczsKCmZ1bmN0aW9uIHJlcXVpcmVUeXBlQW5ub3RhdGlvbnMgKCkgewoJaWYgKGhhc1JlcXVpcmVkVHlwZUFubm90YXRpb25zKSByZXR1cm4gdHlwZUFubm90YXRpb25zLmV4cG9ydHM7CgloYXNSZXF1aXJlZFR5cGVBbm5vdGF0aW9ucyA9IDE7CgkoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoJCS8qKgoJCSAqIFR5cGUgYW5ub3RhdGlvbiBkZWZzIHNoYXJlZCBiZXR3ZWVuIEZsb3cgYW5kIFR5cGVTY3JpcHQuCgkJICogVGhlc2UgZGVmcyBjb3VsZCBub3QgYmUgZGVmaW5lZCBpbiAuL2Zsb3cudHMgb3IgLi90eXBlc2NyaXB0LnRzIGRpcmVjdGx5CgkJICogYmVjYXVzZSB0aGV5IHVzZSB0aGUgc2FtZSBuYW1lLgoJCSAqLwoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkJdmFyIHRzbGliXzEgPSByZXF1aXJlJCQwOwoJCXZhciB0eXBlc18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVR5cGVzKCkpOwoJCXZhciBzaGFyZWRfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVTaGFyZWQoKSk7CgkJZnVuY3Rpb24gZGVmYXVsdF8xKGZvcmspIHsKCQkgICAgdmFyIHR5cGVzID0gZm9yay51c2UodHlwZXNfMS5kZWZhdWx0KTsKCQkgICAgdmFyIGRlZiA9IHR5cGVzLlR5cGUuZGVmOwoJCSAgICB2YXIgb3IgPSB0eXBlcy5UeXBlLm9yOwoJCSAgICB2YXIgZGVmYXVsdHMgPSBmb3JrLnVzZShzaGFyZWRfMS5kZWZhdWx0KS5kZWZhdWx0czsKCQkgICAgdmFyIFR5cGVBbm5vdGF0aW9uID0gb3IoZGVmKCJUeXBlQW5ub3RhdGlvbiIpLCBkZWYoIlRTVHlwZUFubm90YXRpb24iKSwgbnVsbCk7CgkJICAgIHZhciBUeXBlUGFyYW1EZWNsID0gb3IoZGVmKCJUeXBlUGFyYW1ldGVyRGVjbGFyYXRpb24iKSwgZGVmKCJUU1R5cGVQYXJhbWV0ZXJEZWNsYXJhdGlvbiIpLCBudWxsKTsKCQkgICAgZGVmKCJJZGVudGlmaWVyIikKCQkgICAgICAgIC5maWVsZCgidHlwZUFubm90YXRpb24iLCBUeXBlQW5ub3RhdGlvbiwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiT2JqZWN0UGF0dGVybiIpCgkJICAgICAgICAuZmllbGQoInR5cGVBbm5vdGF0aW9uIiwgVHlwZUFubm90YXRpb24sIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIkZ1bmN0aW9uIikKCQkgICAgICAgIC5maWVsZCgicmV0dXJuVHlwZSIsIFR5cGVBbm5vdGF0aW9uLCBkZWZhdWx0c1sibnVsbCJdKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlUGFyYW1ldGVycyIsIFR5cGVQYXJhbURlY2wsIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIkNsYXNzUHJvcGVydHkiKQoJCSAgICAgICAgLmJ1aWxkKCJrZXkiLCAidmFsdWUiLCAidHlwZUFubm90YXRpb24iLCAic3RhdGljIikKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBvcihkZWYoIkV4cHJlc3Npb24iKSwgbnVsbCkpCgkJICAgICAgICAuZmllbGQoInN0YXRpYyIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlQW5ub3RhdGlvbiIsIFR5cGVBbm5vdGF0aW9uLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgWyJDbGFzc0RlY2xhcmF0aW9uIiwKCQkgICAgICAgICJDbGFzc0V4cHJlc3Npb24iLAoJCSAgICBdLmZvckVhY2goZnVuY3Rpb24gKHR5cGVOYW1lKSB7CgkJICAgICAgICBkZWYodHlwZU5hbWUpCgkJICAgICAgICAgICAgLmZpZWxkKCJ0eXBlUGFyYW1ldGVycyIsIFR5cGVQYXJhbURlY2wsIGRlZmF1bHRzWyJudWxsIl0pCgkJICAgICAgICAgICAgLmZpZWxkKCJzdXBlclR5cGVQYXJhbWV0ZXJzIiwgb3IoZGVmKCJUeXBlUGFyYW1ldGVySW5zdGFudGlhdGlvbiIpLCBkZWYoIlRTVHlwZVBhcmFtZXRlckluc3RhbnRpYXRpb24iKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pCgkJICAgICAgICAgICAgLmZpZWxkKCJpbXBsZW1lbnRzIiwgb3IoW2RlZigiQ2xhc3NJbXBsZW1lbnRzIildLCBbZGVmKCJUU0V4cHJlc3Npb25XaXRoVHlwZUFyZ3VtZW50cyIpXSksIGRlZmF1bHRzLmVtcHR5QXJyYXkpOwoJCSAgICB9KTsKCQl9CgkJZXhwb3J0cy5kZWZhdWx0ID0gZGVmYXVsdF8xOwoJCW1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1siZGVmYXVsdCJdOyAKCX0gKHR5cGVBbm5vdGF0aW9ucywgdHlwZUFubm90YXRpb25zLmV4cG9ydHMpKTsKCXJldHVybiB0eXBlQW5ub3RhdGlvbnMuZXhwb3J0czsKfQoKdmFyIGhhc1JlcXVpcmVkRmxvdzsKCmZ1bmN0aW9uIHJlcXVpcmVGbG93ICgpIHsKCWlmIChoYXNSZXF1aXJlZEZsb3cpIHJldHVybiBmbG93LmV4cG9ydHM7CgloYXNSZXF1aXJlZEZsb3cgPSAxOwoJKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJCXZhciB0c2xpYl8xID0gcmVxdWlyZSQkMDsKCQl2YXIgZXNfcHJvcG9zYWxzXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlRXNQcm9wb3NhbHMoKSk7CgkJdmFyIHR5cGVfYW5ub3RhdGlvbnNfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVUeXBlQW5ub3RhdGlvbnMoKSk7CgkJdmFyIHR5cGVzXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlVHlwZXMoKSk7CgkJdmFyIHNoYXJlZF8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVNoYXJlZCgpKTsKCQlmdW5jdGlvbiBkZWZhdWx0XzEoZm9yaykgewoJCSAgICBmb3JrLnVzZShlc19wcm9wb3NhbHNfMS5kZWZhdWx0KTsKCQkgICAgZm9yay51c2UodHlwZV9hbm5vdGF0aW9uc18xLmRlZmF1bHQpOwoJCSAgICB2YXIgdHlwZXMgPSBmb3JrLnVzZSh0eXBlc18xLmRlZmF1bHQpOwoJCSAgICB2YXIgZGVmID0gdHlwZXMuVHlwZS5kZWY7CgkJICAgIHZhciBvciA9IHR5cGVzLlR5cGUub3I7CgkJICAgIHZhciBkZWZhdWx0cyA9IGZvcmsudXNlKHNoYXJlZF8xLmRlZmF1bHQpLmRlZmF1bHRzOwoJCSAgICAvLyBCYXNlIHR5cGVzCgkJICAgIGRlZigiRmxvdyIpLmJhc2VzKCJOb2RlIik7CgkJICAgIGRlZigiRmxvd1R5cGUiKS5iYXNlcygiRmxvdyIpOwoJCSAgICAvLyBUeXBlIGFubm90YXRpb25zCgkJICAgIGRlZigiQW55VHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoKTsKCQkgICAgZGVmKCJFbXB0eVR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCk7CgkJICAgIGRlZigiTWl4ZWRUeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkZsb3dUeXBlIikKCQkgICAgICAgIC5idWlsZCgpOwoJCSAgICBkZWYoIlZvaWRUeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkZsb3dUeXBlIikKCQkgICAgICAgIC5idWlsZCgpOwoJCSAgICBkZWYoIlN5bWJvbFR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCk7CgkJICAgIGRlZigiTnVtYmVyVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoKTsKCQkgICAgZGVmKCJCaWdJbnRUeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkZsb3dUeXBlIikKCQkgICAgICAgIC5idWlsZCgpOwoJCSAgICBkZWYoIk51bWJlckxpdGVyYWxUeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkZsb3dUeXBlIikKCQkgICAgICAgIC5idWlsZCgidmFsdWUiLCAicmF3IikKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBOdW1iZXIpCgkJICAgICAgICAuZmllbGQoInJhdyIsIFN0cmluZyk7CgkJICAgIC8vIEJhYnlsb24gNiBkaWZmZXJzIGluIEFTVCBmcm9tIEZsb3cKCQkgICAgLy8gc2FtZSBhcyBOdW1iZXJMaXRlcmFsVHlwZUFubm90YXRpb24KCQkgICAgZGVmKCJOdW1lcmljTGl0ZXJhbFR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCJ2YWx1ZSIsICJyYXciKQoJCSAgICAgICAgLmZpZWxkKCJ2YWx1ZSIsIE51bWJlcikKCQkgICAgICAgIC5maWVsZCgicmF3IiwgU3RyaW5nKTsKCQkgICAgZGVmKCJCaWdJbnRMaXRlcmFsVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoInZhbHVlIiwgInJhdyIpCgkJICAgICAgICAuZmllbGQoInZhbHVlIiwgbnVsbCkKCQkgICAgICAgIC5maWVsZCgicmF3IiwgU3RyaW5nKTsKCQkgICAgZGVmKCJTdHJpbmdUeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkZsb3dUeXBlIikKCQkgICAgICAgIC5idWlsZCgpOwoJCSAgICBkZWYoIlN0cmluZ0xpdGVyYWxUeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkZsb3dUeXBlIikKCQkgICAgICAgIC5idWlsZCgidmFsdWUiLCAicmF3IikKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBTdHJpbmcpCgkJICAgICAgICAuZmllbGQoInJhdyIsIFN0cmluZyk7CgkJICAgIGRlZigiQm9vbGVhblR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCk7CgkJICAgIGRlZigiQm9vbGVhbkxpdGVyYWxUeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkZsb3dUeXBlIikKCQkgICAgICAgIC5idWlsZCgidmFsdWUiLCAicmF3IikKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBCb29sZWFuKQoJCSAgICAgICAgLmZpZWxkKCJyYXciLCBTdHJpbmcpOwoJCSAgICBkZWYoIlR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoInR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5maWVsZCgidHlwZUFubm90YXRpb24iLCBkZWYoIkZsb3dUeXBlIikpOwoJCSAgICBkZWYoIk51bGxhYmxlVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoInR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5maWVsZCgidHlwZUFubm90YXRpb24iLCBkZWYoIkZsb3dUeXBlIikpOwoJCSAgICBkZWYoIk51bGxMaXRlcmFsVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoKTsKCQkgICAgZGVmKCJOdWxsVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoKTsKCQkgICAgZGVmKCJUaGlzVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoKTsKCQkgICAgZGVmKCJFeGlzdHNUeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkZsb3dUeXBlIikKCQkgICAgICAgIC5idWlsZCgpOwoJCSAgICBkZWYoIkV4aXN0ZW50aWFsVHlwZVBhcmFtIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCk7CgkJICAgIGRlZigiRnVuY3Rpb25UeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkZsb3dUeXBlIikKCQkgICAgICAgIC5idWlsZCgicGFyYW1zIiwgInJldHVyblR5cGUiLCAicmVzdCIsICJ0eXBlUGFyYW1ldGVycyIpCgkJICAgICAgICAuZmllbGQoInBhcmFtcyIsIFtkZWYoIkZ1bmN0aW9uVHlwZVBhcmFtIildKQoJCSAgICAgICAgLmZpZWxkKCJyZXR1cm5UeXBlIiwgZGVmKCJGbG93VHlwZSIpKQoJCSAgICAgICAgLmZpZWxkKCJyZXN0Iiwgb3IoZGVmKCJGdW5jdGlvblR5cGVQYXJhbSIpLCBudWxsKSkKCQkgICAgICAgIC5maWVsZCgidHlwZVBhcmFtZXRlcnMiLCBvcihkZWYoIlR5cGVQYXJhbWV0ZXJEZWNsYXJhdGlvbiIpLCBudWxsKSk7CgkJICAgIGRlZigiRnVuY3Rpb25UeXBlUGFyYW0iKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgibmFtZSIsICJ0eXBlQW5ub3RhdGlvbiIsICJvcHRpb25hbCIpCgkJICAgICAgICAuZmllbGQoIm5hbWUiLCBvcihkZWYoIklkZW50aWZpZXIiKSwgbnVsbCkpCgkJICAgICAgICAuZmllbGQoInR5cGVBbm5vdGF0aW9uIiwgZGVmKCJGbG93VHlwZSIpKQoJCSAgICAgICAgLmZpZWxkKCJvcHRpb25hbCIsIEJvb2xlYW4pOwoJCSAgICBkZWYoIkFycmF5VHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoImVsZW1lbnRUeXBlIikKCQkgICAgICAgIC5maWVsZCgiZWxlbWVudFR5cGUiLCBkZWYoIkZsb3dUeXBlIikpOwoJCSAgICBkZWYoIk9iamVjdFR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCJwcm9wZXJ0aWVzIiwgImluZGV4ZXJzIiwgImNhbGxQcm9wZXJ0aWVzIikKCQkgICAgICAgIC5maWVsZCgicHJvcGVydGllcyIsIFsKCQkgICAgICAgIG9yKGRlZigiT2JqZWN0VHlwZVByb3BlcnR5IiksIGRlZigiT2JqZWN0VHlwZVNwcmVhZFByb3BlcnR5IikpCgkJICAgIF0pCgkJICAgICAgICAuZmllbGQoImluZGV4ZXJzIiwgW2RlZigiT2JqZWN0VHlwZUluZGV4ZXIiKV0sIGRlZmF1bHRzLmVtcHR5QXJyYXkpCgkJICAgICAgICAuZmllbGQoImNhbGxQcm9wZXJ0aWVzIiwgW2RlZigiT2JqZWN0VHlwZUNhbGxQcm9wZXJ0eSIpXSwgZGVmYXVsdHMuZW1wdHlBcnJheSkKCQkgICAgICAgIC5maWVsZCgiaW5leGFjdCIsIG9yKEJvb2xlYW4sIHZvaWQgMCksIGRlZmF1bHRzWyJ1bmRlZmluZWQiXSkKCQkgICAgICAgIC5maWVsZCgiZXhhY3QiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgiaW50ZXJuYWxTbG90cyIsIFtkZWYoIk9iamVjdFR5cGVJbnRlcm5hbFNsb3QiKV0sIGRlZmF1bHRzLmVtcHR5QXJyYXkpOwoJCSAgICBkZWYoIlZhcmlhbmNlIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoImtpbmQiKQoJCSAgICAgICAgLmZpZWxkKCJraW5kIiwgb3IoInBsdXMiLCAibWludXMiKSk7CgkJICAgIHZhciBMZWdhY3lWYXJpYW5jZSA9IG9yKGRlZigiVmFyaWFuY2UiKSwgInBsdXMiLCAibWludXMiLCBudWxsKTsKCQkgICAgZGVmKCJPYmplY3RUeXBlUHJvcGVydHkiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgia2V5IiwgInZhbHVlIiwgIm9wdGlvbmFsIikKCQkgICAgICAgIC5maWVsZCgia2V5Iiwgb3IoZGVmKCJMaXRlcmFsIiksIGRlZigiSWRlbnRpZmllciIpKSkKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBkZWYoIkZsb3dUeXBlIikpCgkJICAgICAgICAuZmllbGQoIm9wdGlvbmFsIiwgQm9vbGVhbikKCQkgICAgICAgIC5maWVsZCgidmFyaWFuY2UiLCBMZWdhY3lWYXJpYW5jZSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiT2JqZWN0VHlwZUluZGV4ZXIiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgiaWQiLCAia2V5IiwgInZhbHVlIikKCQkgICAgICAgIC5maWVsZCgiaWQiLCBkZWYoIklkZW50aWZpZXIiKSkKCQkgICAgICAgIC5maWVsZCgia2V5IiwgZGVmKCJGbG93VHlwZSIpKQoJCSAgICAgICAgLmZpZWxkKCJ2YWx1ZSIsIGRlZigiRmxvd1R5cGUiKSkKCQkgICAgICAgIC5maWVsZCgidmFyaWFuY2UiLCBMZWdhY3lWYXJpYW5jZSwgZGVmYXVsdHNbIm51bGwiXSkKCQkgICAgICAgIC5maWVsZCgic3RhdGljIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pOwoJCSAgICBkZWYoIk9iamVjdFR5cGVDYWxsUHJvcGVydHkiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgidmFsdWUiKQoJCSAgICAgICAgLmZpZWxkKCJ2YWx1ZSIsIGRlZigiRnVuY3Rpb25UeXBlQW5ub3RhdGlvbiIpKQoJCSAgICAgICAgLmZpZWxkKCJzdGF0aWMiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSk7CgkJICAgIGRlZigiUXVhbGlmaWVkVHlwZUlkZW50aWZpZXIiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgicXVhbGlmaWNhdGlvbiIsICJpZCIpCgkJICAgICAgICAuZmllbGQoInF1YWxpZmljYXRpb24iLCBvcihkZWYoIklkZW50aWZpZXIiKSwgZGVmKCJRdWFsaWZpZWRUeXBlSWRlbnRpZmllciIpKSkKCQkgICAgICAgIC5maWVsZCgiaWQiLCBkZWYoIklkZW50aWZpZXIiKSk7CgkJICAgIGRlZigiR2VuZXJpY1R5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIsICJ0eXBlUGFyYW1ldGVycyIpCgkJICAgICAgICAuZmllbGQoImlkIiwgb3IoZGVmKCJJZGVudGlmaWVyIiksIGRlZigiUXVhbGlmaWVkVHlwZUlkZW50aWZpZXIiKSkpCgkJICAgICAgICAuZmllbGQoInR5cGVQYXJhbWV0ZXJzIiwgb3IoZGVmKCJUeXBlUGFyYW1ldGVySW5zdGFudGlhdGlvbiIpLCBudWxsKSk7CgkJICAgIGRlZigiTWVtYmVyVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoIm9iamVjdCIsICJwcm9wZXJ0eSIpCgkJICAgICAgICAuZmllbGQoIm9iamVjdCIsIGRlZigiSWRlbnRpZmllciIpKQoJCSAgICAgICAgLmZpZWxkKCJwcm9wZXJ0eSIsIG9yKGRlZigiTWVtYmVyVHlwZUFubm90YXRpb24iKSwgZGVmKCJHZW5lcmljVHlwZUFubm90YXRpb24iKSkpOwoJCSAgICBkZWYoIlVuaW9uVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoInR5cGVzIikKCQkgICAgICAgIC5maWVsZCgidHlwZXMiLCBbZGVmKCJGbG93VHlwZSIpXSk7CgkJICAgIGRlZigiSW50ZXJzZWN0aW9uVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoInR5cGVzIikKCQkgICAgICAgIC5maWVsZCgidHlwZXMiLCBbZGVmKCJGbG93VHlwZSIpXSk7CgkJICAgIGRlZigiVHlwZW9mVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoImFyZ3VtZW50IikKCQkgICAgICAgIC5maWVsZCgiYXJndW1lbnQiLCBkZWYoIkZsb3dUeXBlIikpOwoJCSAgICBkZWYoIk9iamVjdFR5cGVTcHJlYWRQcm9wZXJ0eSIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCJhcmd1bWVudCIpCgkJICAgICAgICAuZmllbGQoImFyZ3VtZW50IiwgZGVmKCJGbG93VHlwZSIpKTsKCQkgICAgZGVmKCJPYmplY3RUeXBlSW50ZXJuYWxTbG90IikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoImlkIiwgInZhbHVlIiwgIm9wdGlvbmFsIiwgInN0YXRpYyIsICJtZXRob2QiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIGRlZigiSWRlbnRpZmllciIpKQoJCSAgICAgICAgLmZpZWxkKCJ2YWx1ZSIsIGRlZigiRmxvd1R5cGUiKSkKCQkgICAgICAgIC5maWVsZCgib3B0aW9uYWwiLCBCb29sZWFuKQoJCSAgICAgICAgLmZpZWxkKCJzdGF0aWMiLCBCb29sZWFuKQoJCSAgICAgICAgLmZpZWxkKCJtZXRob2QiLCBCb29sZWFuKTsKCQkgICAgZGVmKCJUeXBlUGFyYW1ldGVyRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgicGFyYW1zIikKCQkgICAgICAgIC5maWVsZCgicGFyYW1zIiwgW2RlZigiVHlwZVBhcmFtZXRlciIpXSk7CgkJICAgIGRlZigiVHlwZVBhcmFtZXRlckluc3RhbnRpYXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgicGFyYW1zIikKCQkgICAgICAgIC5maWVsZCgicGFyYW1zIiwgW2RlZigiRmxvd1R5cGUiKV0pOwoJCSAgICBkZWYoIlR5cGVQYXJhbWV0ZXIiKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoIm5hbWUiLCAidmFyaWFuY2UiLCAiYm91bmQiLCAiZGVmYXVsdCIpCgkJICAgICAgICAuZmllbGQoIm5hbWUiLCBTdHJpbmcpCgkJICAgICAgICAuZmllbGQoInZhcmlhbmNlIiwgTGVnYWN5VmFyaWFuY2UsIGRlZmF1bHRzWyJudWxsIl0pCgkJICAgICAgICAuZmllbGQoImJvdW5kIiwgb3IoZGVmKCJUeXBlQW5ub3RhdGlvbiIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSkKCQkgICAgICAgIC5maWVsZCgiZGVmYXVsdCIsIG9yKGRlZigiRmxvd1R5cGUiKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIkNsYXNzUHJvcGVydHkiKQoJCSAgICAgICAgLmZpZWxkKCJ2YXJpYW5jZSIsIExlZ2FjeVZhcmlhbmNlLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgZGVmKCJDbGFzc0ltcGxlbWVudHMiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgiaWQiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIGRlZigiSWRlbnRpZmllciIpKQoJCSAgICAgICAgLmZpZWxkKCJzdXBlckNsYXNzIiwgb3IoZGVmKCJFeHByZXNzaW9uIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlUGFyYW1ldGVycyIsIG9yKGRlZigiVHlwZVBhcmFtZXRlckluc3RhbnRpYXRpb24iKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIkludGVyZmFjZVR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRmxvd1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCJib2R5IiwgImV4dGVuZHMiKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgZGVmKCJPYmplY3RUeXBlQW5ub3RhdGlvbiIpKQoJCSAgICAgICAgLmZpZWxkKCJleHRlbmRzIiwgb3IoW2RlZigiSW50ZXJmYWNlRXh0ZW5kcyIpXSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIkludGVyZmFjZURlY2xhcmF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIsICJib2R5IiwgImV4dGVuZHMiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIGRlZigiSWRlbnRpZmllciIpKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlUGFyYW1ldGVycyIsIG9yKGRlZigiVHlwZVBhcmFtZXRlckRlY2xhcmF0aW9uIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgZGVmKCJPYmplY3RUeXBlQW5ub3RhdGlvbiIpKQoJCSAgICAgICAgLmZpZWxkKCJleHRlbmRzIiwgW2RlZigiSW50ZXJmYWNlRXh0ZW5kcyIpXSk7CgkJICAgIGRlZigiRGVjbGFyZUludGVyZmFjZSIpCgkJICAgICAgICAuYmFzZXMoIkludGVyZmFjZURlY2xhcmF0aW9uIikKCQkgICAgICAgIC5idWlsZCgiaWQiLCAiYm9keSIsICJleHRlbmRzIik7CgkJICAgIGRlZigiSW50ZXJmYWNlRXh0ZW5kcyIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIpCgkJICAgICAgICAuZmllbGQoImlkIiwgZGVmKCJJZGVudGlmaWVyIikpCgkJICAgICAgICAuZmllbGQoInR5cGVQYXJhbWV0ZXJzIiwgb3IoZGVmKCJUeXBlUGFyYW1ldGVySW5zdGFudGlhdGlvbiIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiVHlwZUFsaWFzIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIsICJ0eXBlUGFyYW1ldGVycyIsICJyaWdodCIpCgkJICAgICAgICAuZmllbGQoImlkIiwgZGVmKCJJZGVudGlmaWVyIikpCgkJICAgICAgICAuZmllbGQoInR5cGVQYXJhbWV0ZXJzIiwgb3IoZGVmKCJUeXBlUGFyYW1ldGVyRGVjbGFyYXRpb24iKSwgbnVsbCkpCgkJICAgICAgICAuZmllbGQoInJpZ2h0IiwgZGVmKCJGbG93VHlwZSIpKTsKCQkgICAgZGVmKCJEZWNsYXJlVHlwZUFsaWFzIikKCQkgICAgICAgIC5iYXNlcygiVHlwZUFsaWFzIikKCQkgICAgICAgIC5idWlsZCgiaWQiLCAidHlwZVBhcmFtZXRlcnMiLCAicmlnaHQiKTsKCQkgICAgZGVmKCJPcGFxdWVUeXBlIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIsICJ0eXBlUGFyYW1ldGVycyIsICJpbXBsdHlwZSIsICJzdXBlcnR5cGUiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIGRlZigiSWRlbnRpZmllciIpKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlUGFyYW1ldGVycyIsIG9yKGRlZigiVHlwZVBhcmFtZXRlckRlY2xhcmF0aW9uIiksIG51bGwpKQoJCSAgICAgICAgLmZpZWxkKCJpbXBsdHlwZSIsIGRlZigiRmxvd1R5cGUiKSkKCQkgICAgICAgIC5maWVsZCgic3VwZXJ0eXBlIiwgb3IoZGVmKCJGbG93VHlwZSIpLCBudWxsKSk7CgkJICAgIGRlZigiRGVjbGFyZU9wYXF1ZVR5cGUiKQoJCSAgICAgICAgLmJhc2VzKCJPcGFxdWVUeXBlIikKCQkgICAgICAgIC5idWlsZCgiaWQiLCAidHlwZVBhcmFtZXRlcnMiLCAic3VwZXJ0eXBlIikKCQkgICAgICAgIC5maWVsZCgiaW1wbHR5cGUiLCBvcihkZWYoIkZsb3dUeXBlIiksIG51bGwpKTsKCQkgICAgZGVmKCJUeXBlQ2FzdEV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgiZXhwcmVzc2lvbiIsICJ0eXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuZmllbGQoImV4cHJlc3Npb24iLCBkZWYoIkV4cHJlc3Npb24iKSkKCQkgICAgICAgIC5maWVsZCgidHlwZUFubm90YXRpb24iLCBkZWYoIlR5cGVBbm5vdGF0aW9uIikpOwoJCSAgICBkZWYoIlR1cGxlVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJGbG93VHlwZSIpCgkJICAgICAgICAuYnVpbGQoInR5cGVzIikKCQkgICAgICAgIC5maWVsZCgidHlwZXMiLCBbZGVmKCJGbG93VHlwZSIpXSk7CgkJICAgIGRlZigiRGVjbGFyZVZhcmlhYmxlIikKCQkgICAgICAgIC5iYXNlcygiU3RhdGVtZW50IikKCQkgICAgICAgIC5idWlsZCgiaWQiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIGRlZigiSWRlbnRpZmllciIpKTsKCQkgICAgZGVmKCJEZWNsYXJlRnVuY3Rpb24iKQoJCSAgICAgICAgLmJhc2VzKCJTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIpCgkJICAgICAgICAuZmllbGQoImlkIiwgZGVmKCJJZGVudGlmaWVyIikpCgkJICAgICAgICAuZmllbGQoInByZWRpY2F0ZSIsIG9yKGRlZigiRmxvd1ByZWRpY2F0ZSIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiRGVjbGFyZUNsYXNzIikKCQkgICAgICAgIC5iYXNlcygiSW50ZXJmYWNlRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIpOwoJCSAgICBkZWYoIkRlY2xhcmVNb2R1bGUiKQoJCSAgICAgICAgLmJhc2VzKCJTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIsICJib2R5IikKCQkgICAgICAgIC5maWVsZCgiaWQiLCBvcihkZWYoIklkZW50aWZpZXIiKSwgZGVmKCJMaXRlcmFsIikpKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgZGVmKCJCbG9ja1N0YXRlbWVudCIpKTsKCQkgICAgZGVmKCJEZWNsYXJlTW9kdWxlRXhwb3J0cyIpCgkJICAgICAgICAuYmFzZXMoIlN0YXRlbWVudCIpCgkJICAgICAgICAuYnVpbGQoInR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5maWVsZCgidHlwZUFubm90YXRpb24iLCBkZWYoIlR5cGVBbm5vdGF0aW9uIikpOwoJCSAgICBkZWYoIkRlY2xhcmVFeHBvcnREZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkRlY2xhcmF0aW9uIikKCQkgICAgICAgIC5idWlsZCgiZGVmYXVsdCIsICJkZWNsYXJhdGlvbiIsICJzcGVjaWZpZXJzIiwgInNvdXJjZSIpCgkJICAgICAgICAuZmllbGQoImRlZmF1bHQiLCBCb29sZWFuKQoJCSAgICAgICAgLmZpZWxkKCJkZWNsYXJhdGlvbiIsIG9yKGRlZigiRGVjbGFyZVZhcmlhYmxlIiksIGRlZigiRGVjbGFyZUZ1bmN0aW9uIiksIGRlZigiRGVjbGFyZUNsYXNzIiksIGRlZigiRmxvd1R5cGUiKSwgLy8gSW1wbGllcyBkZWZhdWx0LgoJCSAgICBkZWYoIlR5cGVBbGlhcyIpLCAvLyBJbXBsaWVzIG5hbWVkIHR5cGUKCQkgICAgZGVmKCJEZWNsYXJlT3BhcXVlVHlwZSIpLCAvLyBJbXBsaWVzIG5hbWVkIG9wYXF1ZSB0eXBlCgkJICAgIGRlZigiSW50ZXJmYWNlRGVjbGFyYXRpb24iKSwgbnVsbCkpCgkJICAgICAgICAuZmllbGQoInNwZWNpZmllcnMiLCBbb3IoZGVmKCJFeHBvcnRTcGVjaWZpZXIiKSwgZGVmKCJFeHBvcnRCYXRjaFNwZWNpZmllciIpKV0sIGRlZmF1bHRzLmVtcHR5QXJyYXkpCgkJICAgICAgICAuZmllbGQoInNvdXJjZSIsIG9yKGRlZigiTGl0ZXJhbCIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiRGVjbGFyZUV4cG9ydEFsbERlY2xhcmF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJzb3VyY2UiKQoJCSAgICAgICAgLmZpZWxkKCJzb3VyY2UiLCBvcihkZWYoIkxpdGVyYWwiKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIkltcG9ydERlY2xhcmF0aW9uIikKCQkgICAgICAgIC5maWVsZCgiaW1wb3J0S2luZCIsIG9yKCJ2YWx1ZSIsICJ0eXBlIiwgInR5cGVvZiIpLCBmdW5jdGlvbiAoKSB7IHJldHVybiAidmFsdWUiOyB9KTsKCQkgICAgZGVmKCJGbG93UHJlZGljYXRlIikuYmFzZXMoIkZsb3ciKTsKCQkgICAgZGVmKCJJbmZlcnJlZFByZWRpY2F0ZSIpCgkJICAgICAgICAuYmFzZXMoIkZsb3dQcmVkaWNhdGUiKQoJCSAgICAgICAgLmJ1aWxkKCk7CgkJICAgIGRlZigiRGVjbGFyZWRQcmVkaWNhdGUiKQoJCSAgICAgICAgLmJhc2VzKCJGbG93UHJlZGljYXRlIikKCQkgICAgICAgIC5idWlsZCgidmFsdWUiKQoJCSAgICAgICAgLmZpZWxkKCJ2YWx1ZSIsIGRlZigiRXhwcmVzc2lvbiIpKTsKCQkgICAgZGVmKCJGdW5jdGlvbiIpCgkJICAgICAgICAuZmllbGQoInByZWRpY2F0ZSIsIG9yKGRlZigiRmxvd1ByZWRpY2F0ZSIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiQ2FsbEV4cHJlc3Npb24iKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlQXJndW1lbnRzIiwgb3IobnVsbCwgZGVmKCJUeXBlUGFyYW1ldGVySW5zdGFudGlhdGlvbiIpKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiTmV3RXhwcmVzc2lvbiIpCgkJICAgICAgICAuZmllbGQoInR5cGVBcmd1bWVudHMiLCBvcihudWxsLCBkZWYoIlR5cGVQYXJhbWV0ZXJJbnN0YW50aWF0aW9uIikpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgLy8gRW51bXMKCQkgICAgZGVmKCJFbnVtRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImlkIiwgImJvZHkiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIGRlZigiSWRlbnRpZmllciIpKQoJCSAgICAgICAgLmZpZWxkKCJib2R5Iiwgb3IoZGVmKCJFbnVtQm9vbGVhbkJvZHkiKSwgZGVmKCJFbnVtTnVtYmVyQm9keSIpLCBkZWYoIkVudW1TdHJpbmdCb2R5IiksIGRlZigiRW51bVN5bWJvbEJvZHkiKSkpOwoJCSAgICBkZWYoIkVudW1Cb29sZWFuQm9keSIpCgkJICAgICAgICAuYnVpbGQoIm1lbWJlcnMiLCAiZXhwbGljaXRUeXBlIikKCQkgICAgICAgIC5maWVsZCgibWVtYmVycyIsIFtkZWYoIkVudW1Cb29sZWFuTWVtYmVyIildKQoJCSAgICAgICAgLmZpZWxkKCJleHBsaWNpdFR5cGUiLCBCb29sZWFuKTsKCQkgICAgZGVmKCJFbnVtTnVtYmVyQm9keSIpCgkJICAgICAgICAuYnVpbGQoIm1lbWJlcnMiLCAiZXhwbGljaXRUeXBlIikKCQkgICAgICAgIC5maWVsZCgibWVtYmVycyIsIFtkZWYoIkVudW1OdW1iZXJNZW1iZXIiKV0pCgkJICAgICAgICAuZmllbGQoImV4cGxpY2l0VHlwZSIsIEJvb2xlYW4pOwoJCSAgICBkZWYoIkVudW1TdHJpbmdCb2R5IikKCQkgICAgICAgIC5idWlsZCgibWVtYmVycyIsICJleHBsaWNpdFR5cGUiKQoJCSAgICAgICAgLmZpZWxkKCJtZW1iZXJzIiwgb3IoW2RlZigiRW51bVN0cmluZ01lbWJlciIpXSwgW2RlZigiRW51bURlZmF1bHRlZE1lbWJlciIpXSkpCgkJICAgICAgICAuZmllbGQoImV4cGxpY2l0VHlwZSIsIEJvb2xlYW4pOwoJCSAgICBkZWYoIkVudW1TeW1ib2xCb2R5IikKCQkgICAgICAgIC5idWlsZCgibWVtYmVycyIpCgkJICAgICAgICAuZmllbGQoIm1lbWJlcnMiLCBbZGVmKCJFbnVtRGVmYXVsdGVkTWVtYmVyIildKTsKCQkgICAgZGVmKCJFbnVtQm9vbGVhbk1lbWJlciIpCgkJICAgICAgICAuYnVpbGQoImlkIiwgImluaXQiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIGRlZigiSWRlbnRpZmllciIpKQoJCSAgICAgICAgLmZpZWxkKCJpbml0Iiwgb3IoZGVmKCJMaXRlcmFsIiksIEJvb2xlYW4pKTsKCQkgICAgZGVmKCJFbnVtTnVtYmVyTWVtYmVyIikKCQkgICAgICAgIC5idWlsZCgiaWQiLCAiaW5pdCIpCgkJICAgICAgICAuZmllbGQoImlkIiwgZGVmKCJJZGVudGlmaWVyIikpCgkJICAgICAgICAuZmllbGQoImluaXQiLCBkZWYoIkxpdGVyYWwiKSk7CgkJICAgIGRlZigiRW51bVN0cmluZ01lbWJlciIpCgkJICAgICAgICAuYnVpbGQoImlkIiwgImluaXQiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIGRlZigiSWRlbnRpZmllciIpKQoJCSAgICAgICAgLmZpZWxkKCJpbml0IiwgZGVmKCJMaXRlcmFsIikpOwoJCSAgICBkZWYoIkVudW1EZWZhdWx0ZWRNZW1iZXIiKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIpCgkJICAgICAgICAuZmllbGQoImlkIiwgZGVmKCJJZGVudGlmaWVyIikpOwoJCX0KCQlleHBvcnRzLmRlZmF1bHQgPSBkZWZhdWx0XzE7CgkJbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07IAoJfSAoZmxvdywgZmxvdy5leHBvcnRzKSk7CglyZXR1cm4gZmxvdy5leHBvcnRzOwp9Cgp2YXIgZXNwcmltYSA9IHtleHBvcnRzOiB7fX07Cgp2YXIgaGFzUmVxdWlyZWRFc3ByaW1hOwoKZnVuY3Rpb24gcmVxdWlyZUVzcHJpbWEgKCkgewoJaWYgKGhhc1JlcXVpcmVkRXNwcmltYSkgcmV0dXJuIGVzcHJpbWEuZXhwb3J0czsKCWhhc1JlcXVpcmVkRXNwcmltYSA9IDE7CgkoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkJdmFyIHRzbGliXzEgPSByZXF1aXJlJCQwOwoJCXZhciBlczIwMjBfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVFczIwMjAoKSk7CgkJdmFyIHR5cGVzXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlVHlwZXMoKSk7CgkJdmFyIHNoYXJlZF8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVNoYXJlZCgpKTsKCQlmdW5jdGlvbiBkZWZhdWx0XzEoZm9yaykgewoJCSAgICBmb3JrLnVzZShlczIwMjBfMS5kZWZhdWx0KTsKCQkgICAgdmFyIHR5cGVzID0gZm9yay51c2UodHlwZXNfMS5kZWZhdWx0KTsKCQkgICAgdmFyIGRlZmF1bHRzID0gZm9yay51c2Uoc2hhcmVkXzEuZGVmYXVsdCkuZGVmYXVsdHM7CgkJICAgIHZhciBkZWYgPSB0eXBlcy5UeXBlLmRlZjsKCQkgICAgdmFyIG9yID0gdHlwZXMuVHlwZS5vcjsKCQkgICAgZGVmKCJWYXJpYWJsZURlY2xhcmF0aW9uIikKCQkgICAgICAgIC5maWVsZCgiZGVjbGFyYXRpb25zIiwgW29yKGRlZigiVmFyaWFibGVEZWNsYXJhdG9yIiksIGRlZigiSWRlbnRpZmllciIpIC8vIEVzcHJpbWEgZGV2aWF0aW9uLgoJCSAgICAgICAgKV0pOwoJCSAgICBkZWYoIlByb3BlcnR5IikKCQkgICAgICAgIC5maWVsZCgidmFsdWUiLCBvcihkZWYoIkV4cHJlc3Npb24iKSwgZGVmKCJQYXR0ZXJuIikgLy8gRXNwcmltYSBkZXZpYXRpb24uCgkJICAgICkpOwoJCSAgICBkZWYoIkFycmF5UGF0dGVybiIpCgkJICAgICAgICAuZmllbGQoImVsZW1lbnRzIiwgW29yKGRlZigiUGF0dGVybiIpLCBkZWYoIlNwcmVhZEVsZW1lbnQiKSwgbnVsbCldKTsKCQkgICAgZGVmKCJPYmplY3RQYXR0ZXJuIikKCQkgICAgICAgIC5maWVsZCgicHJvcGVydGllcyIsIFtvcihkZWYoIlByb3BlcnR5IiksIGRlZigiUHJvcGVydHlQYXR0ZXJuIiksIGRlZigiU3ByZWFkUHJvcGVydHlQYXR0ZXJuIiksIGRlZigiU3ByZWFkUHJvcGVydHkiKSAvLyBVc2VkIGJ5IEVzcHJpbWEuCgkJICAgICAgICApXSk7CgkJICAgIC8vIExpa2UgTW9kdWxlU3BlY2lmaWVyLCBleGNlcHQgdHlwZToiRXhwb3J0U3BlY2lmaWVyIiBhbmQgYnVpbGRhYmxlLgoJCSAgICAvLyBleHBvcnQgezxpZCBbYXMgbmFtZV0+fSBbZnJvbSAuLi5dOwoJCSAgICBkZWYoIkV4cG9ydFNwZWNpZmllciIpCgkJICAgICAgICAuYmFzZXMoIk1vZHVsZVNwZWNpZmllciIpCgkJICAgICAgICAuYnVpbGQoImlkIiwgIm5hbWUiKTsKCQkgICAgLy8gZXhwb3J0IDwqPiBmcm9tIC4uLjsKCQkgICAgZGVmKCJFeHBvcnRCYXRjaFNwZWNpZmllciIpCgkJICAgICAgICAuYmFzZXMoIlNwZWNpZmllciIpCgkJICAgICAgICAuYnVpbGQoKTsKCQkgICAgZGVmKCJFeHBvcnREZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkRlY2xhcmF0aW9uIikKCQkgICAgICAgIC5idWlsZCgiZGVmYXVsdCIsICJkZWNsYXJhdGlvbiIsICJzcGVjaWZpZXJzIiwgInNvdXJjZSIpCgkJICAgICAgICAuZmllbGQoImRlZmF1bHQiLCBCb29sZWFuKQoJCSAgICAgICAgLmZpZWxkKCJkZWNsYXJhdGlvbiIsIG9yKGRlZigiRGVjbGFyYXRpb24iKSwgZGVmKCJFeHByZXNzaW9uIiksIC8vIEltcGxpZXMgZGVmYXVsdC4KCQkgICAgbnVsbCkpCgkJICAgICAgICAuZmllbGQoInNwZWNpZmllcnMiLCBbb3IoZGVmKCJFeHBvcnRTcGVjaWZpZXIiKSwgZGVmKCJFeHBvcnRCYXRjaFNwZWNpZmllciIpKV0sIGRlZmF1bHRzLmVtcHR5QXJyYXkpCgkJICAgICAgICAuZmllbGQoInNvdXJjZSIsIG9yKGRlZigiTGl0ZXJhbCIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiQmxvY2siKQoJCSAgICAgICAgLmJhc2VzKCJDb21tZW50IikKCQkgICAgICAgIC5idWlsZCgidmFsdWUiLCAvKm9wdGlvbmFsOiovICJsZWFkaW5nIiwgInRyYWlsaW5nIik7CgkJICAgIGRlZigiTGluZSIpCgkJICAgICAgICAuYmFzZXMoIkNvbW1lbnQiKQoJCSAgICAgICAgLmJ1aWxkKCJ2YWx1ZSIsIC8qb3B0aW9uYWw6Ki8gImxlYWRpbmciLCAidHJhaWxpbmciKTsKCQl9CgkJZXhwb3J0cy5kZWZhdWx0ID0gZGVmYXVsdF8xOwoJCW1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1siZGVmYXVsdCJdOyAKCX0gKGVzcHJpbWEsIGVzcHJpbWEuZXhwb3J0cykpOwoJcmV0dXJuIGVzcHJpbWEuZXhwb3J0czsKfQoKdmFyIGJhYmVsID0ge2V4cG9ydHM6IHt9fTsKCnZhciBiYWJlbENvcmUgPSB7ZXhwb3J0czoge319OwoKdmFyIGhhc1JlcXVpcmVkQmFiZWxDb3JlOwoKZnVuY3Rpb24gcmVxdWlyZUJhYmVsQ29yZSAoKSB7CglpZiAoaGFzUmVxdWlyZWRCYWJlbENvcmUpIHJldHVybiBiYWJlbENvcmUuZXhwb3J0czsKCWhhc1JlcXVpcmVkQmFiZWxDb3JlID0gMTsKCShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCQl2YXIgdHNsaWJfMSA9IHJlcXVpcmUkJDA7CgkJdmFyIGVzX3Byb3Bvc2Fsc18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZUVzUHJvcG9zYWxzKCkpOwoJCXZhciB0eXBlc18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVR5cGVzKCkpOwoJCXZhciBzaGFyZWRfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVTaGFyZWQoKSk7CgkJZnVuY3Rpb24gZGVmYXVsdF8xKGZvcmspIHsKCQkgICAgZm9yay51c2UoZXNfcHJvcG9zYWxzXzEuZGVmYXVsdCk7CgkJICAgIHZhciB0eXBlcyA9IGZvcmsudXNlKHR5cGVzXzEuZGVmYXVsdCk7CgkJICAgIHZhciBkZWZhdWx0cyA9IGZvcmsudXNlKHNoYXJlZF8xLmRlZmF1bHQpLmRlZmF1bHRzOwoJCSAgICB2YXIgZGVmID0gdHlwZXMuVHlwZS5kZWY7CgkJICAgIHZhciBvciA9IHR5cGVzLlR5cGUub3I7CgkJICAgIGRlZigiTm9vcCIpCgkJICAgICAgICAuYmFzZXMoIlN0YXRlbWVudCIpCgkJICAgICAgICAuYnVpbGQoKTsKCQkgICAgZGVmKCJEb0V4cHJlc3Npb24iKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgiYm9keSIpCgkJICAgICAgICAuZmllbGQoImJvZHkiLCBbZGVmKCJTdGF0ZW1lbnQiKV0pOwoJCSAgICBkZWYoIkJpbmRFeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoIm9iamVjdCIsICJjYWxsZWUiKQoJCSAgICAgICAgLmZpZWxkKCJvYmplY3QiLCBvcihkZWYoIkV4cHJlc3Npb24iKSwgbnVsbCkpCgkJICAgICAgICAuZmllbGQoImNhbGxlZSIsIGRlZigiRXhwcmVzc2lvbiIpKTsKCQkgICAgZGVmKCJQYXJlbnRoZXNpemVkRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCJleHByZXNzaW9uIikKCQkgICAgICAgIC5maWVsZCgiZXhwcmVzc2lvbiIsIGRlZigiRXhwcmVzc2lvbiIpKTsKCQkgICAgZGVmKCJFeHBvcnROYW1lc3BhY2VTcGVjaWZpZXIiKQoJCSAgICAgICAgLmJhc2VzKCJTcGVjaWZpZXIiKQoJCSAgICAgICAgLmJ1aWxkKCJleHBvcnRlZCIpCgkJICAgICAgICAuZmllbGQoImV4cG9ydGVkIiwgZGVmKCJJZGVudGlmaWVyIikpOwoJCSAgICBkZWYoIkV4cG9ydERlZmF1bHRTcGVjaWZpZXIiKQoJCSAgICAgICAgLmJhc2VzKCJTcGVjaWZpZXIiKQoJCSAgICAgICAgLmJ1aWxkKCJleHBvcnRlZCIpCgkJICAgICAgICAuZmllbGQoImV4cG9ydGVkIiwgZGVmKCJJZGVudGlmaWVyIikpOwoJCSAgICBkZWYoIkNvbW1lbnRCbG9jayIpCgkJICAgICAgICAuYmFzZXMoIkNvbW1lbnQiKQoJCSAgICAgICAgLmJ1aWxkKCJ2YWx1ZSIsIC8qb3B0aW9uYWw6Ki8gImxlYWRpbmciLCAidHJhaWxpbmciKTsKCQkgICAgZGVmKCJDb21tZW50TGluZSIpCgkJICAgICAgICAuYmFzZXMoIkNvbW1lbnQiKQoJCSAgICAgICAgLmJ1aWxkKCJ2YWx1ZSIsIC8qb3B0aW9uYWw6Ki8gImxlYWRpbmciLCAidHJhaWxpbmciKTsKCQkgICAgZGVmKCJEaXJlY3RpdmUiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgidmFsdWUiKQoJCSAgICAgICAgLmZpZWxkKCJ2YWx1ZSIsIGRlZigiRGlyZWN0aXZlTGl0ZXJhbCIpKTsKCQkgICAgZGVmKCJEaXJlY3RpdmVMaXRlcmFsIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIsICJFeHByZXNzaW9uIikKCQkgICAgICAgIC5idWlsZCgidmFsdWUiKQoJCSAgICAgICAgLmZpZWxkKCJ2YWx1ZSIsIFN0cmluZywgZGVmYXVsdHNbInVzZSBzdHJpY3QiXSk7CgkJICAgIGRlZigiSW50ZXJwcmV0ZXJEaXJlY3RpdmUiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgidmFsdWUiKQoJCSAgICAgICAgLmZpZWxkKCJ2YWx1ZSIsIFN0cmluZyk7CgkJICAgIGRlZigiQmxvY2tTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJhc2VzKCJTdGF0ZW1lbnQiKQoJCSAgICAgICAgLmJ1aWxkKCJib2R5IikKCQkgICAgICAgIC5maWVsZCgiYm9keSIsIFtkZWYoIlN0YXRlbWVudCIpXSkKCQkgICAgICAgIC5maWVsZCgiZGlyZWN0aXZlcyIsIFtkZWYoIkRpcmVjdGl2ZSIpXSwgZGVmYXVsdHMuZW1wdHlBcnJheSk7CgkJICAgIGRlZigiUHJvZ3JhbSIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCJib2R5IikKCQkgICAgICAgIC5maWVsZCgiYm9keSIsIFtkZWYoIlN0YXRlbWVudCIpXSkKCQkgICAgICAgIC5maWVsZCgiZGlyZWN0aXZlcyIsIFtkZWYoIkRpcmVjdGl2ZSIpXSwgZGVmYXVsdHMuZW1wdHlBcnJheSkKCQkgICAgICAgIC5maWVsZCgiaW50ZXJwcmV0ZXIiLCBvcihkZWYoIkludGVycHJldGVyRGlyZWN0aXZlIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgLy8gU3BsaXQgTGl0ZXJhbAoJCSAgICBkZWYoIlN0cmluZ0xpdGVyYWwiKQoJCSAgICAgICAgLmJhc2VzKCJMaXRlcmFsIikKCQkgICAgICAgIC5idWlsZCgidmFsdWUiKQoJCSAgICAgICAgLmZpZWxkKCJ2YWx1ZSIsIFN0cmluZyk7CgkJICAgIGRlZigiTnVtZXJpY0xpdGVyYWwiKQoJCSAgICAgICAgLmJhc2VzKCJMaXRlcmFsIikKCQkgICAgICAgIC5idWlsZCgidmFsdWUiKQoJCSAgICAgICAgLmZpZWxkKCJ2YWx1ZSIsIE51bWJlcikKCQkgICAgICAgIC5maWVsZCgicmF3Iiwgb3IoU3RyaW5nLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSkKCQkgICAgICAgIC5maWVsZCgiZXh0cmEiLCB7CgkJICAgICAgICByYXdWYWx1ZTogTnVtYmVyLAoJCSAgICAgICAgcmF3OiBTdHJpbmcKCQkgICAgfSwgZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsKCQkgICAgICAgIHJldHVybiB7CgkJICAgICAgICAgICAgcmF3VmFsdWU6IHRoaXMudmFsdWUsCgkJICAgICAgICAgICAgcmF3OiB0aGlzLnZhbHVlICsgIiIKCQkgICAgICAgIH07CgkJICAgIH0pOwoJCSAgICBkZWYoIkJpZ0ludExpdGVyYWwiKQoJCSAgICAgICAgLmJhc2VzKCJMaXRlcmFsIikKCQkgICAgICAgIC5idWlsZCgidmFsdWUiKQoJCSAgICAgICAgLy8gT25seSBTdHJpbmcgcmVhbGx5IHNlZW1zIGFwcHJvcHJpYXRlIGhlcmUsIHNpbmNlIEJpZ0ludCB2YWx1ZXMKCQkgICAgICAgIC8vIG9mdGVuIGV4Y2VlZCB0aGUgbGltaXRzIG9mIEpTIG51bWJlcnMuCgkJICAgICAgICAuZmllbGQoInZhbHVlIiwgb3IoU3RyaW5nLCBOdW1iZXIpKQoJCSAgICAgICAgLmZpZWxkKCJleHRyYSIsIHsKCQkgICAgICAgIHJhd1ZhbHVlOiBTdHJpbmcsCgkJICAgICAgICByYXc6IFN0cmluZwoJCSAgICB9LCBmdW5jdGlvbiBnZXREZWZhdWx0KCkgewoJCSAgICAgICAgcmV0dXJuIHsKCQkgICAgICAgICAgICByYXdWYWx1ZTogU3RyaW5nKHRoaXMudmFsdWUpLAoJCSAgICAgICAgICAgIHJhdzogdGhpcy52YWx1ZSArICJuIgoJCSAgICAgICAgfTsKCQkgICAgfSk7CgkJICAgIGRlZigiTnVsbExpdGVyYWwiKQoJCSAgICAgICAgLmJhc2VzKCJMaXRlcmFsIikKCQkgICAgICAgIC5idWlsZCgpCgkJICAgICAgICAuZmllbGQoInZhbHVlIiwgbnVsbCwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiQm9vbGVhbkxpdGVyYWwiKQoJCSAgICAgICAgLmJhc2VzKCJMaXRlcmFsIikKCQkgICAgICAgIC5idWlsZCgidmFsdWUiKQoJCSAgICAgICAgLmZpZWxkKCJ2YWx1ZSIsIEJvb2xlYW4pOwoJCSAgICBkZWYoIlJlZ0V4cExpdGVyYWwiKQoJCSAgICAgICAgLmJhc2VzKCJMaXRlcmFsIikKCQkgICAgICAgIC5idWlsZCgicGF0dGVybiIsICJmbGFncyIpCgkJICAgICAgICAuZmllbGQoInBhdHRlcm4iLCBTdHJpbmcpCgkJICAgICAgICAuZmllbGQoImZsYWdzIiwgU3RyaW5nKQoJCSAgICAgICAgLmZpZWxkKCJ2YWx1ZSIsIFJlZ0V4cCwgZnVuY3Rpb24gKCkgewoJCSAgICAgICAgcmV0dXJuIG5ldyBSZWdFeHAodGhpcy5wYXR0ZXJuLCB0aGlzLmZsYWdzKTsKCQkgICAgfSk7CgkJICAgIHZhciBPYmplY3RFeHByZXNzaW9uUHJvcGVydHkgPSBvcihkZWYoIlByb3BlcnR5IiksIGRlZigiT2JqZWN0TWV0aG9kIiksIGRlZigiT2JqZWN0UHJvcGVydHkiKSwgZGVmKCJTcHJlYWRQcm9wZXJ0eSIpLCBkZWYoIlNwcmVhZEVsZW1lbnQiKSk7CgkJICAgIC8vIFNwbGl0IFByb3BlcnR5IC0+IE9iamVjdFByb3BlcnR5IGFuZCBPYmplY3RNZXRob2QKCQkgICAgZGVmKCJPYmplY3RFeHByZXNzaW9uIikKCQkgICAgICAgIC5iYXNlcygiRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYnVpbGQoInByb3BlcnRpZXMiKQoJCSAgICAgICAgLmZpZWxkKCJwcm9wZXJ0aWVzIiwgW09iamVjdEV4cHJlc3Npb25Qcm9wZXJ0eV0pOwoJCSAgICAvLyBPYmplY3RNZXRob2QgaG9pc3QgLnZhbHVlIHByb3BlcnRpZXMgdG8gb3duIHByb3BlcnRpZXMKCQkgICAgZGVmKCJPYmplY3RNZXRob2QiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIiwgIkZ1bmN0aW9uIikKCQkgICAgICAgIC5idWlsZCgia2luZCIsICJrZXkiLCAicGFyYW1zIiwgImJvZHkiLCAiY29tcHV0ZWQiKQoJCSAgICAgICAgLmZpZWxkKCJraW5kIiwgb3IoIm1ldGhvZCIsICJnZXQiLCAic2V0IikpCgkJICAgICAgICAuZmllbGQoImtleSIsIG9yKGRlZigiTGl0ZXJhbCIpLCBkZWYoIklkZW50aWZpZXIiKSwgZGVmKCJFeHByZXNzaW9uIikpKQoJCSAgICAgICAgLmZpZWxkKCJwYXJhbXMiLCBbZGVmKCJQYXR0ZXJuIildKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgZGVmKCJCbG9ja1N0YXRlbWVudCIpKQoJCSAgICAgICAgLmZpZWxkKCJjb21wdXRlZCIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJnZW5lcmF0b3IiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgiYXN5bmMiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgiYWNjZXNzaWJpbGl0eSIsIC8vIFR5cGVTY3JpcHQKCQkgICAgb3IoZGVmKCJMaXRlcmFsIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKQoJCSAgICAgICAgLmZpZWxkKCJkZWNvcmF0b3JzIiwgb3IoW2RlZigiRGVjb3JhdG9yIildLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiT2JqZWN0UHJvcGVydHkiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgia2V5IiwgInZhbHVlIikKCQkgICAgICAgIC5maWVsZCgia2V5Iiwgb3IoZGVmKCJMaXRlcmFsIiksIGRlZigiSWRlbnRpZmllciIpLCBkZWYoIkV4cHJlc3Npb24iKSkpCgkJICAgICAgICAuZmllbGQoInZhbHVlIiwgb3IoZGVmKCJFeHByZXNzaW9uIiksIGRlZigiUGF0dGVybiIpKSkKCQkgICAgICAgIC5maWVsZCgiYWNjZXNzaWJpbGl0eSIsIC8vIFR5cGVTY3JpcHQKCQkgICAgb3IoZGVmKCJMaXRlcmFsIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKQoJCSAgICAgICAgLmZpZWxkKCJjb21wdXRlZCIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKTsKCQkgICAgdmFyIENsYXNzQm9keUVsZW1lbnQgPSBvcihkZWYoIk1ldGhvZERlZmluaXRpb24iKSwgZGVmKCJWYXJpYWJsZURlY2xhcmF0b3IiKSwgZGVmKCJDbGFzc1Byb3BlcnR5RGVmaW5pdGlvbiIpLCBkZWYoIkNsYXNzUHJvcGVydHkiKSwgZGVmKCJDbGFzc1ByaXZhdGVQcm9wZXJ0eSIpLCBkZWYoIkNsYXNzTWV0aG9kIiksIGRlZigiQ2xhc3NQcml2YXRlTWV0aG9kIikpOwoJCSAgICAvLyBNZXRob2REZWZpbml0aW9uIC0+IENsYXNzTWV0aG9kCgkJICAgIGRlZigiQ2xhc3NCb2R5IikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJib2R5IikKCQkgICAgICAgIC5maWVsZCgiYm9keSIsIFtDbGFzc0JvZHlFbGVtZW50XSk7CgkJICAgIGRlZigiQ2xhc3NNZXRob2QiKQoJCSAgICAgICAgLmJhc2VzKCJEZWNsYXJhdGlvbiIsICJGdW5jdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImtpbmQiLCAia2V5IiwgInBhcmFtcyIsICJib2R5IiwgImNvbXB1dGVkIiwgInN0YXRpYyIpCgkJICAgICAgICAuZmllbGQoImtleSIsIG9yKGRlZigiTGl0ZXJhbCIpLCBkZWYoIklkZW50aWZpZXIiKSwgZGVmKCJFeHByZXNzaW9uIikpKTsKCQkgICAgZGVmKCJDbGFzc1ByaXZhdGVNZXRob2QiKQoJCSAgICAgICAgLmJhc2VzKCJEZWNsYXJhdGlvbiIsICJGdW5jdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImtleSIsICJwYXJhbXMiLCAiYm9keSIsICJraW5kIiwgImNvbXB1dGVkIiwgInN0YXRpYyIpCgkJICAgICAgICAuZmllbGQoImtleSIsIGRlZigiUHJpdmF0ZU5hbWUiKSk7CgkJICAgIFsiQ2xhc3NNZXRob2QiLAoJCSAgICAgICAgIkNsYXNzUHJpdmF0ZU1ldGhvZCIsCgkJICAgIF0uZm9yRWFjaChmdW5jdGlvbiAodHlwZU5hbWUpIHsKCQkgICAgICAgIGRlZih0eXBlTmFtZSkKCQkgICAgICAgICAgICAuZmllbGQoImtpbmQiLCBvcigiZ2V0IiwgInNldCIsICJtZXRob2QiLCAiY29uc3RydWN0b3IiKSwgZnVuY3Rpb24gKCkgeyByZXR1cm4gIm1ldGhvZCI7IH0pCgkJICAgICAgICAgICAgLmZpZWxkKCJib2R5IiwgZGVmKCJCbG9ja1N0YXRlbWVudCIpKQoJCSAgICAgICAgICAgIC5maWVsZCgiY29tcHV0ZWQiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgICAgICAuZmllbGQoInN0YXRpYyIsIG9yKEJvb2xlYW4sIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKQoJCSAgICAgICAgICAgIC5maWVsZCgiYWJzdHJhY3QiLCBvcihCb29sZWFuLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSkKCQkgICAgICAgICAgICAuZmllbGQoImFjY2VzcyIsIG9yKCJwdWJsaWMiLCAicHJpdmF0ZSIsICJwcm90ZWN0ZWQiLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSkKCQkgICAgICAgICAgICAuZmllbGQoImFjY2Vzc2liaWxpdHkiLCBvcigicHVibGljIiwgInByaXZhdGUiLCAicHJvdGVjdGVkIiwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pCgkJICAgICAgICAgICAgLmZpZWxkKCJkZWNvcmF0b3JzIiwgb3IoW2RlZigiRGVjb3JhdG9yIildLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSkKCQkgICAgICAgICAgICAuZmllbGQoIm9wdGlvbmFsIiwgb3IoQm9vbGVhbiwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICB9KTsKCQkgICAgdmFyIE9iamVjdFBhdHRlcm5Qcm9wZXJ0eSA9IG9yKGRlZigiUHJvcGVydHkiKSwgZGVmKCJQcm9wZXJ0eVBhdHRlcm4iKSwgZGVmKCJTcHJlYWRQcm9wZXJ0eVBhdHRlcm4iKSwgZGVmKCJTcHJlYWRQcm9wZXJ0eSIpLCAvLyBVc2VkIGJ5IEVzcHJpbWEKCQkgICAgZGVmKCJPYmplY3RQcm9wZXJ0eSIpLCAvLyBCYWJlbCA2CgkJICAgIGRlZigiUmVzdFByb3BlcnR5IikgLy8gQmFiZWwgNgoJCSAgICApOwoJCSAgICAvLyBTcGxpdCBpbnRvIFJlc3RQcm9wZXJ0eSBhbmQgU3ByZWFkUHJvcGVydHkKCQkgICAgZGVmKCJPYmplY3RQYXR0ZXJuIikKCQkgICAgICAgIC5iYXNlcygiUGF0dGVybiIpCgkJICAgICAgICAuYnVpbGQoInByb3BlcnRpZXMiKQoJCSAgICAgICAgLmZpZWxkKCJwcm9wZXJ0aWVzIiwgW09iamVjdFBhdHRlcm5Qcm9wZXJ0eV0pCgkJICAgICAgICAuZmllbGQoImRlY29yYXRvcnMiLCBvcihbZGVmKCJEZWNvcmF0b3IiKV0sIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgZGVmKCJTcHJlYWRQcm9wZXJ0eSIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCJhcmd1bWVudCIpCgkJICAgICAgICAuZmllbGQoImFyZ3VtZW50IiwgZGVmKCJFeHByZXNzaW9uIikpOwoJCSAgICBkZWYoIlJlc3RQcm9wZXJ0eSIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCJhcmd1bWVudCIpCgkJICAgICAgICAuZmllbGQoImFyZ3VtZW50IiwgZGVmKCJFeHByZXNzaW9uIikpOwoJCSAgICBkZWYoIkZvckF3YWl0U3RhdGVtZW50IikKCQkgICAgICAgIC5iYXNlcygiU3RhdGVtZW50IikKCQkgICAgICAgIC5idWlsZCgibGVmdCIsICJyaWdodCIsICJib2R5IikKCQkgICAgICAgIC5maWVsZCgibGVmdCIsIG9yKGRlZigiVmFyaWFibGVEZWNsYXJhdGlvbiIpLCBkZWYoIkV4cHJlc3Npb24iKSkpCgkJICAgICAgICAuZmllbGQoInJpZ2h0IiwgZGVmKCJFeHByZXNzaW9uIikpCgkJICAgICAgICAuZmllbGQoImJvZHkiLCBkZWYoIlN0YXRlbWVudCIpKTsKCQkgICAgLy8gVGhlIGNhbGxlZSBub2RlIG9mIGEgZHluYW1pYyBpbXBvcnQoLi4uKSBleHByZXNzaW9uLgoJCSAgICBkZWYoIkltcG9ydCIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJ1aWxkKCk7CgkJfQoJCWV4cG9ydHMuZGVmYXVsdCA9IGRlZmF1bHRfMTsKCQltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbImRlZmF1bHQiXTsgCgl9IChiYWJlbENvcmUsIGJhYmVsQ29yZS5leHBvcnRzKSk7CglyZXR1cm4gYmFiZWxDb3JlLmV4cG9ydHM7Cn0KCnZhciBoYXNSZXF1aXJlZEJhYmVsOwoKZnVuY3Rpb24gcmVxdWlyZUJhYmVsICgpIHsKCWlmIChoYXNSZXF1aXJlZEJhYmVsKSByZXR1cm4gYmFiZWwuZXhwb3J0czsKCWhhc1JlcXVpcmVkQmFiZWwgPSAxOwoJKGZ1bmN0aW9uIChtb2R1bGUsIGV4cG9ydHMpIHsKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJCXZhciB0c2xpYl8xID0gcmVxdWlyZSQkMDsKCQl2YXIgYmFiZWxfY29yZV8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZUJhYmVsQ29yZSgpKTsKCQl2YXIgZmxvd18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZUZsb3coKSk7CgkJZnVuY3Rpb24gZGVmYXVsdF8xKGZvcmspIHsKCQkgICAgZm9yay51c2UoYmFiZWxfY29yZV8xLmRlZmF1bHQpOwoJCSAgICBmb3JrLnVzZShmbG93XzEuZGVmYXVsdCk7CgkJfQoJCWV4cG9ydHMuZGVmYXVsdCA9IGRlZmF1bHRfMTsKCQltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbImRlZmF1bHQiXTsgCgl9IChiYWJlbCwgYmFiZWwuZXhwb3J0cykpOwoJcmV0dXJuIGJhYmVsLmV4cG9ydHM7Cn0KCnZhciB0eXBlc2NyaXB0ID0ge2V4cG9ydHM6IHt9fTsKCnZhciBoYXNSZXF1aXJlZFR5cGVzY3JpcHQ7CgpmdW5jdGlvbiByZXF1aXJlVHlwZXNjcmlwdCAoKSB7CglpZiAoaGFzUmVxdWlyZWRUeXBlc2NyaXB0KSByZXR1cm4gdHlwZXNjcmlwdC5leHBvcnRzOwoJaGFzUmVxdWlyZWRUeXBlc2NyaXB0ID0gMTsKCShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCQl2YXIgdHNsaWJfMSA9IHJlcXVpcmUkJDA7CgkJdmFyIGJhYmVsX2NvcmVfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVCYWJlbENvcmUoKSk7CgkJdmFyIHR5cGVfYW5ub3RhdGlvbnNfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVUeXBlQW5ub3RhdGlvbnMoKSk7CgkJdmFyIHR5cGVzXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlVHlwZXMoKSk7CgkJdmFyIHNoYXJlZF8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZVNoYXJlZCgpKTsKCQlmdW5jdGlvbiBkZWZhdWx0XzEoZm9yaykgewoJCSAgICAvLyBTaW5jZSBUeXBlU2NyaXB0IGlzIHBhcnNlZCBieSBCYWJ5bG9uLCBpbmNsdWRlIHRoZSBjb3JlIEJhYnlsb24gdHlwZXMKCQkgICAgLy8gYnV0IG9taXQgdGhlIEZsb3ctcmVsYXRlZCB0eXBlcy4KCQkgICAgZm9yay51c2UoYmFiZWxfY29yZV8xLmRlZmF1bHQpOwoJCSAgICBmb3JrLnVzZSh0eXBlX2Fubm90YXRpb25zXzEuZGVmYXVsdCk7CgkJICAgIHZhciB0eXBlcyA9IGZvcmsudXNlKHR5cGVzXzEuZGVmYXVsdCk7CgkJICAgIHZhciBuID0gdHlwZXMubmFtZWRUeXBlczsKCQkgICAgdmFyIGRlZiA9IHR5cGVzLlR5cGUuZGVmOwoJCSAgICB2YXIgb3IgPSB0eXBlcy5UeXBlLm9yOwoJCSAgICB2YXIgZGVmYXVsdHMgPSBmb3JrLnVzZShzaGFyZWRfMS5kZWZhdWx0KS5kZWZhdWx0czsKCQkgICAgdmFyIFN0cmluZ0xpdGVyYWwgPSB0eXBlcy5UeXBlLmZyb20oZnVuY3Rpb24gKHZhbHVlLCBkZWVwKSB7CgkJICAgICAgICBpZiAobi5TdHJpbmdMaXRlcmFsICYmCgkJICAgICAgICAgICAgbi5TdHJpbmdMaXRlcmFsLmNoZWNrKHZhbHVlLCBkZWVwKSkgewoJCSAgICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAgICAgICAgfQoJCSAgICAgICAgaWYgKG4uTGl0ZXJhbCAmJgoJCSAgICAgICAgICAgIG4uTGl0ZXJhbC5jaGVjayh2YWx1ZSwgZGVlcCkgJiYKCQkgICAgICAgICAgICB0eXBlb2YgdmFsdWUudmFsdWUgPT09ICJzdHJpbmciKSB7CgkJICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkJICAgICAgICB9CgkJICAgICAgICByZXR1cm4gZmFsc2U7CgkJICAgIH0sICJTdHJpbmdMaXRlcmFsIik7CgkJICAgIGRlZigiVFNUeXBlIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpOwoJCSAgICB2YXIgVFNFbnRpdHlOYW1lID0gb3IoZGVmKCJJZGVudGlmaWVyIiksIGRlZigiVFNRdWFsaWZpZWROYW1lIikpOwoJCSAgICBkZWYoIlRTVHlwZVJlZmVyZW5jZSIpCgkJICAgICAgICAuYmFzZXMoIlRTVHlwZSIsICJUU0hhc09wdGlvbmFsVHlwZVBhcmFtZXRlckluc3RhbnRpYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJ0eXBlTmFtZSIsICJ0eXBlUGFyYW1ldGVycyIpCgkJICAgICAgICAuZmllbGQoInR5cGVOYW1lIiwgVFNFbnRpdHlOYW1lKTsKCQkgICAgLy8gQW4gYWJzdHJhY3QgKG5vbi1idWlsZGFibGUpIGJhc2UgdHlwZSB0aGF0IHByb3ZpZGUgYSBjb21tb25seS1uZWVkZWQKCQkgICAgLy8gb3B0aW9uYWwgLnR5cGVQYXJhbWV0ZXJzIGZpZWxkLgoJCSAgICBkZWYoIlRTSGFzT3B0aW9uYWxUeXBlUGFyYW1ldGVySW5zdGFudGlhdGlvbiIpCgkJICAgICAgICAuZmllbGQoInR5cGVQYXJhbWV0ZXJzIiwgb3IoZGVmKCJUU1R5cGVQYXJhbWV0ZXJJbnN0YW50aWF0aW9uIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgLy8gQW4gYWJzdHJhY3QgKG5vbi1idWlsZGFibGUpIGJhc2UgdHlwZSB0aGF0IHByb3ZpZGUgYSBjb21tb25seS1uZWVkZWQKCQkgICAgLy8gb3B0aW9uYWwgLnR5cGVQYXJhbWV0ZXJzIGZpZWxkLgoJCSAgICBkZWYoIlRTSGFzT3B0aW9uYWxUeXBlUGFyYW1ldGVycyIpCgkJICAgICAgICAuZmllbGQoInR5cGVQYXJhbWV0ZXJzIiwgb3IoZGVmKCJUU1R5cGVQYXJhbWV0ZXJEZWNsYXJhdGlvbiIpLCBudWxsLCB2b2lkIDApLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgLy8gQW4gYWJzdHJhY3QgKG5vbi1idWlsZGFibGUpIGJhc2UgdHlwZSB0aGF0IHByb3ZpZGUgYSBjb21tb25seS1uZWVkZWQKCQkgICAgLy8gb3B0aW9uYWwgLnR5cGVBbm5vdGF0aW9uIGZpZWxkLgoJCSAgICBkZWYoIlRTSGFzT3B0aW9uYWxUeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuZmllbGQoInR5cGVBbm5vdGF0aW9uIiwgb3IoZGVmKCJUU1R5cGVBbm5vdGF0aW9uIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgZGVmKCJUU1F1YWxpZmllZE5hbWUiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgibGVmdCIsICJyaWdodCIpCgkJICAgICAgICAuZmllbGQoImxlZnQiLCBUU0VudGl0eU5hbWUpCgkJICAgICAgICAuZmllbGQoInJpZ2h0IiwgVFNFbnRpdHlOYW1lKTsKCQkgICAgZGVmKCJUU0FzRXhwcmVzc2lvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iLCAiUGF0dGVybiIpCgkJICAgICAgICAuYnVpbGQoImV4cHJlc3Npb24iLCAidHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmZpZWxkKCJleHByZXNzaW9uIiwgZGVmKCJFeHByZXNzaW9uIikpCgkJICAgICAgICAuZmllbGQoInR5cGVBbm5vdGF0aW9uIiwgZGVmKCJUU1R5cGUiKSkKCQkgICAgICAgIC5maWVsZCgiZXh0cmEiLCBvcih7IHBhcmVudGhlc2l6ZWQ6IEJvb2xlYW4gfSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIlRTTm9uTnVsbEV4cHJlc3Npb24iKQoJCSAgICAgICAgLmJhc2VzKCJFeHByZXNzaW9uIiwgIlBhdHRlcm4iKQoJCSAgICAgICAgLmJ1aWxkKCJleHByZXNzaW9uIikKCQkgICAgICAgIC5maWVsZCgiZXhwcmVzc2lvbiIsIGRlZigiRXhwcmVzc2lvbiIpKTsKCQkgICAgWwoJCSAgICAgICAgIlRTQW55S2V5d29yZCIsCgkJICAgICAgICAiVFNCaWdJbnRLZXl3b3JkIiwKCQkgICAgICAgICJUU0Jvb2xlYW5LZXl3b3JkIiwKCQkgICAgICAgICJUU05ldmVyS2V5d29yZCIsCgkJICAgICAgICAiVFNOdWxsS2V5d29yZCIsCgkJICAgICAgICAiVFNOdW1iZXJLZXl3b3JkIiwKCQkgICAgICAgICJUU09iamVjdEtleXdvcmQiLAoJCSAgICAgICAgIlRTU3RyaW5nS2V5d29yZCIsCgkJICAgICAgICAiVFNTeW1ib2xLZXl3b3JkIiwKCQkgICAgICAgICJUU1VuZGVmaW5lZEtleXdvcmQiLAoJCSAgICAgICAgIlRTVW5rbm93bktleXdvcmQiLAoJCSAgICAgICAgIlRTVm9pZEtleXdvcmQiLAoJCSAgICAgICAgIlRTVGhpc1R5cGUiLAoJCSAgICBdLmZvckVhY2goZnVuY3Rpb24gKGtleXdvcmRUeXBlKSB7CgkJICAgICAgICBkZWYoa2V5d29yZFR5cGUpCgkJICAgICAgICAgICAgLmJhc2VzKCJUU1R5cGUiKQoJCSAgICAgICAgICAgIC5idWlsZCgpOwoJCSAgICB9KTsKCQkgICAgZGVmKCJUU0FycmF5VHlwZSIpCgkJICAgICAgICAuYmFzZXMoIlRTVHlwZSIpCgkJICAgICAgICAuYnVpbGQoImVsZW1lbnRUeXBlIikKCQkgICAgICAgIC5maWVsZCgiZWxlbWVudFR5cGUiLCBkZWYoIlRTVHlwZSIpKTsKCQkgICAgZGVmKCJUU0xpdGVyYWxUeXBlIikKCQkgICAgICAgIC5iYXNlcygiVFNUeXBlIikKCQkgICAgICAgIC5idWlsZCgibGl0ZXJhbCIpCgkJICAgICAgICAuZmllbGQoImxpdGVyYWwiLCBvcihkZWYoIk51bWVyaWNMaXRlcmFsIiksIGRlZigiU3RyaW5nTGl0ZXJhbCIpLCBkZWYoIkJvb2xlYW5MaXRlcmFsIiksIGRlZigiVGVtcGxhdGVMaXRlcmFsIiksIGRlZigiVW5hcnlFeHByZXNzaW9uIikpKTsKCQkgICAgWyJUU1VuaW9uVHlwZSIsCgkJICAgICAgICAiVFNJbnRlcnNlY3Rpb25UeXBlIiwKCQkgICAgXS5mb3JFYWNoKGZ1bmN0aW9uICh0eXBlTmFtZSkgewoJCSAgICAgICAgZGVmKHR5cGVOYW1lKQoJCSAgICAgICAgICAgIC5iYXNlcygiVFNUeXBlIikKCQkgICAgICAgICAgICAuYnVpbGQoInR5cGVzIikKCQkgICAgICAgICAgICAuZmllbGQoInR5cGVzIiwgW2RlZigiVFNUeXBlIildKTsKCQkgICAgfSk7CgkJICAgIGRlZigiVFNDb25kaXRpb25hbFR5cGUiKQoJCSAgICAgICAgLmJhc2VzKCJUU1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCJjaGVja1R5cGUiLCAiZXh0ZW5kc1R5cGUiLCAidHJ1ZVR5cGUiLCAiZmFsc2VUeXBlIikKCQkgICAgICAgIC5maWVsZCgiY2hlY2tUeXBlIiwgZGVmKCJUU1R5cGUiKSkKCQkgICAgICAgIC5maWVsZCgiZXh0ZW5kc1R5cGUiLCBkZWYoIlRTVHlwZSIpKQoJCSAgICAgICAgLmZpZWxkKCJ0cnVlVHlwZSIsIGRlZigiVFNUeXBlIikpCgkJICAgICAgICAuZmllbGQoImZhbHNlVHlwZSIsIGRlZigiVFNUeXBlIikpOwoJCSAgICBkZWYoIlRTSW5mZXJUeXBlIikKCQkgICAgICAgIC5iYXNlcygiVFNUeXBlIikKCQkgICAgICAgIC5idWlsZCgidHlwZVBhcmFtZXRlciIpCgkJICAgICAgICAuZmllbGQoInR5cGVQYXJhbWV0ZXIiLCBkZWYoIlRTVHlwZVBhcmFtZXRlciIpKTsKCQkgICAgZGVmKCJUU1BhcmVudGhlc2l6ZWRUeXBlIikKCQkgICAgICAgIC5iYXNlcygiVFNUeXBlIikKCQkgICAgICAgIC5idWlsZCgidHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlQW5ub3RhdGlvbiIsIGRlZigiVFNUeXBlIikpOwoJCSAgICB2YXIgUGFyYW1ldGVyc1R5cGUgPSBbb3IoZGVmKCJJZGVudGlmaWVyIiksIGRlZigiUmVzdEVsZW1lbnQiKSwgZGVmKCJBcnJheVBhdHRlcm4iKSwgZGVmKCJPYmplY3RQYXR0ZXJuIikpXTsKCQkgICAgWyJUU0Z1bmN0aW9uVHlwZSIsCgkJICAgICAgICAiVFNDb25zdHJ1Y3RvclR5cGUiLAoJCSAgICBdLmZvckVhY2goZnVuY3Rpb24gKHR5cGVOYW1lKSB7CgkJICAgICAgICBkZWYodHlwZU5hbWUpCgkJICAgICAgICAgICAgLmJhc2VzKCJUU1R5cGUiLCAiVFNIYXNPcHRpb25hbFR5cGVQYXJhbWV0ZXJzIiwgIlRTSGFzT3B0aW9uYWxUeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAgICAgLmJ1aWxkKCJwYXJhbWV0ZXJzIikKCQkgICAgICAgICAgICAuZmllbGQoInBhcmFtZXRlcnMiLCBQYXJhbWV0ZXJzVHlwZSk7CgkJICAgIH0pOwoJCSAgICBkZWYoIlRTRGVjbGFyZUZ1bmN0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iLCAiVFNIYXNPcHRpb25hbFR5cGVQYXJhbWV0ZXJzIikKCQkgICAgICAgIC5idWlsZCgiaWQiLCAicGFyYW1zIiwgInJldHVyblR5cGUiKQoJCSAgICAgICAgLmZpZWxkKCJkZWNsYXJlIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pCgkJICAgICAgICAuZmllbGQoImFzeW5jIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pCgkJICAgICAgICAuZmllbGQoImdlbmVyYXRvciIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIG9yKGRlZigiSWRlbnRpZmllciIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSkKCQkgICAgICAgIC5maWVsZCgicGFyYW1zIiwgW2RlZigiUGF0dGVybiIpXSkKCQkgICAgICAgIC8vIHRTRnVuY3Rpb25UeXBlQW5ub3RhdGlvbkNvbW1vbgoJCSAgICAgICAgLmZpZWxkKCJyZXR1cm5UeXBlIiwgb3IoZGVmKCJUU1R5cGVBbm5vdGF0aW9uIiksIGRlZigiTm9vcCIpLCAvLyBTdGlsbCB1c2VkPwoJCSAgICBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiVFNEZWNsYXJlTWV0aG9kIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iLCAiVFNIYXNPcHRpb25hbFR5cGVQYXJhbWV0ZXJzIikKCQkgICAgICAgIC5idWlsZCgia2V5IiwgInBhcmFtcyIsICJyZXR1cm5UeXBlIikKCQkgICAgICAgIC5maWVsZCgiYXN5bmMiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgiZ2VuZXJhdG9yIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pCgkJICAgICAgICAuZmllbGQoInBhcmFtcyIsIFtkZWYoIlBhdHRlcm4iKV0pCgkJICAgICAgICAvLyBjbGFzc01ldGhvZE9yUHJvcGVydHlDb21tb24KCQkgICAgICAgIC5maWVsZCgiYWJzdHJhY3QiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgiYWNjZXNzaWJpbGl0eSIsIG9yKCJwdWJsaWMiLCAicHJpdmF0ZSIsICJwcm90ZWN0ZWQiLCB2b2lkIDApLCBkZWZhdWx0c1sidW5kZWZpbmVkIl0pCgkJICAgICAgICAuZmllbGQoInN0YXRpYyIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJjb21wdXRlZCIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJvcHRpb25hbCIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJrZXkiLCBvcihkZWYoIklkZW50aWZpZXIiKSwgZGVmKCJTdHJpbmdMaXRlcmFsIiksIGRlZigiTnVtZXJpY0xpdGVyYWwiKSwgCgkJICAgIC8vIE9ubHkgYWxsb3dlZCBpZiAuY29tcHV0ZWQgaXMgdHJ1ZS4KCQkgICAgZGVmKCJFeHByZXNzaW9uIikpKQoJCSAgICAgICAgLy8gY2xhc3NNZXRob2RPckRlY2xhcmVNZXRob2RDb21tb24KCQkgICAgICAgIC5maWVsZCgia2luZCIsIG9yKCJnZXQiLCAic2V0IiwgIm1ldGhvZCIsICJjb25zdHJ1Y3RvciIpLCBmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gIm1ldGhvZCI7IH0pCgkJICAgICAgICAuZmllbGQoImFjY2VzcyIsIC8vIE5vdCAiYWNjZXNzaWJpbGl0eSI/CgkJICAgIG9yKCJwdWJsaWMiLCAicHJpdmF0ZSIsICJwcm90ZWN0ZWQiLCB2b2lkIDApLCBkZWZhdWx0c1sidW5kZWZpbmVkIl0pCgkJICAgICAgICAuZmllbGQoImRlY29yYXRvcnMiLCBvcihbZGVmKCJEZWNvcmF0b3IiKV0sIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKQoJCSAgICAgICAgLy8gdFNGdW5jdGlvblR5cGVBbm5vdGF0aW9uQ29tbW9uCgkJICAgICAgICAuZmllbGQoInJldHVyblR5cGUiLCBvcihkZWYoIlRTVHlwZUFubm90YXRpb24iKSwgZGVmKCJOb29wIiksIC8vIFN0aWxsIHVzZWQ/CgkJICAgIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgZGVmKCJUU01hcHBlZFR5cGUiKQoJCSAgICAgICAgLmJhc2VzKCJUU1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCJ0eXBlUGFyYW1ldGVyIiwgInR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5maWVsZCgicmVhZG9ubHkiLCBvcihCb29sZWFuLCAiKyIsICItIiksIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlUGFyYW1ldGVyIiwgZGVmKCJUU1R5cGVQYXJhbWV0ZXIiKSkKCQkgICAgICAgIC5maWVsZCgib3B0aW9uYWwiLCBvcihCb29sZWFuLCAiKyIsICItIiksIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlQW5ub3RhdGlvbiIsIG9yKGRlZigiVFNUeXBlIiksIG51bGwpLCBkZWZhdWx0c1sibnVsbCJdKTsKCQkgICAgZGVmKCJUU1R1cGxlVHlwZSIpCgkJICAgICAgICAuYmFzZXMoIlRTVHlwZSIpCgkJICAgICAgICAuYnVpbGQoImVsZW1lbnRUeXBlcyIpCgkJICAgICAgICAuZmllbGQoImVsZW1lbnRUeXBlcyIsIFtvcihkZWYoIlRTVHlwZSIpLCBkZWYoIlRTTmFtZWRUdXBsZU1lbWJlciIpKV0pOwoJCSAgICBkZWYoIlRTTmFtZWRUdXBsZU1lbWJlciIpCgkJICAgICAgICAuYmFzZXMoIlRTVHlwZSIpCgkJICAgICAgICAuYnVpbGQoImxhYmVsIiwgImVsZW1lbnRUeXBlIiwgIm9wdGlvbmFsIikKCQkgICAgICAgIC5maWVsZCgibGFiZWwiLCBkZWYoIklkZW50aWZpZXIiKSkKCQkgICAgICAgIC5maWVsZCgib3B0aW9uYWwiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgiZWxlbWVudFR5cGUiLCBkZWYoIlRTVHlwZSIpKTsKCQkgICAgZGVmKCJUU1Jlc3RUeXBlIikKCQkgICAgICAgIC5iYXNlcygiVFNUeXBlIikKCQkgICAgICAgIC5idWlsZCgidHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlQW5ub3RhdGlvbiIsIGRlZigiVFNUeXBlIikpOwoJCSAgICBkZWYoIlRTT3B0aW9uYWxUeXBlIikKCQkgICAgICAgIC5iYXNlcygiVFNUeXBlIikKCQkgICAgICAgIC5idWlsZCgidHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlQW5ub3RhdGlvbiIsIGRlZigiVFNUeXBlIikpOwoJCSAgICBkZWYoIlRTSW5kZXhlZEFjY2Vzc1R5cGUiKQoJCSAgICAgICAgLmJhc2VzKCJUU1R5cGUiKQoJCSAgICAgICAgLmJ1aWxkKCJvYmplY3RUeXBlIiwgImluZGV4VHlwZSIpCgkJICAgICAgICAuZmllbGQoIm9iamVjdFR5cGUiLCBkZWYoIlRTVHlwZSIpKQoJCSAgICAgICAgLmZpZWxkKCJpbmRleFR5cGUiLCBkZWYoIlRTVHlwZSIpKTsKCQkgICAgZGVmKCJUU1R5cGVPcGVyYXRvciIpCgkJICAgICAgICAuYmFzZXMoIlRTVHlwZSIpCgkJICAgICAgICAuYnVpbGQoIm9wZXJhdG9yIikKCQkgICAgICAgIC5maWVsZCgib3BlcmF0b3IiLCBTdHJpbmcpCgkJICAgICAgICAuZmllbGQoInR5cGVBbm5vdGF0aW9uIiwgZGVmKCJUU1R5cGUiKSk7CgkJICAgIGRlZigiVFNUeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIk5vZGUiKQoJCSAgICAgICAgLmJ1aWxkKCJ0eXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuZmllbGQoInR5cGVBbm5vdGF0aW9uIiwgb3IoZGVmKCJUU1R5cGUiKSwgZGVmKCJUU1R5cGVBbm5vdGF0aW9uIikpKTsKCQkgICAgZGVmKCJUU0luZGV4U2lnbmF0dXJlIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iLCAiVFNIYXNPcHRpb25hbFR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5idWlsZCgicGFyYW1ldGVycyIsICJ0eXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuZmllbGQoInBhcmFtZXRlcnMiLCBbZGVmKCJJZGVudGlmaWVyIildKSAvLyBMZW5ndGggPT09IDEKCQkgICAgICAgIC5maWVsZCgicmVhZG9ubHkiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSk7CgkJICAgIGRlZigiVFNQcm9wZXJ0eVNpZ25hdHVyZSIpCgkJICAgICAgICAuYmFzZXMoIkRlY2xhcmF0aW9uIiwgIlRTSGFzT3B0aW9uYWxUeXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImtleSIsICJ0eXBlQW5ub3RhdGlvbiIsICJvcHRpb25hbCIpCgkJICAgICAgICAuZmllbGQoImtleSIsIGRlZigiRXhwcmVzc2lvbiIpKQoJCSAgICAgICAgLmZpZWxkKCJjb21wdXRlZCIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJyZWFkb25seSIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJvcHRpb25hbCIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJpbml0aWFsaXplciIsIG9yKGRlZigiRXhwcmVzc2lvbiIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiVFNNZXRob2RTaWduYXR1cmUiKQoJCSAgICAgICAgLmJhc2VzKCJEZWNsYXJhdGlvbiIsICJUU0hhc09wdGlvbmFsVHlwZVBhcmFtZXRlcnMiLCAiVFNIYXNPcHRpb25hbFR5cGVBbm5vdGF0aW9uIikKCQkgICAgICAgIC5idWlsZCgia2V5IiwgInBhcmFtZXRlcnMiLCAidHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgLmZpZWxkKCJrZXkiLCBkZWYoIkV4cHJlc3Npb24iKSkKCQkgICAgICAgIC5maWVsZCgiY29tcHV0ZWQiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgib3B0aW9uYWwiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgicGFyYW1ldGVycyIsIFBhcmFtZXRlcnNUeXBlKTsKCQkgICAgZGVmKCJUU1R5cGVQcmVkaWNhdGUiKQoJCSAgICAgICAgLmJhc2VzKCJUU1R5cGVBbm5vdGF0aW9uIiwgIlRTVHlwZSIpCgkJICAgICAgICAuYnVpbGQoInBhcmFtZXRlck5hbWUiLCAidHlwZUFubm90YXRpb24iLCAiYXNzZXJ0cyIpCgkJICAgICAgICAuZmllbGQoInBhcmFtZXRlck5hbWUiLCBvcihkZWYoIklkZW50aWZpZXIiKSwgZGVmKCJUU1RoaXNUeXBlIikpKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlQW5ub3RhdGlvbiIsIG9yKGRlZigiVFNUeXBlQW5ub3RhdGlvbiIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSkKCQkgICAgICAgIC5maWVsZCgiYXNzZXJ0cyIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKTsKCQkgICAgWyJUU0NhbGxTaWduYXR1cmVEZWNsYXJhdGlvbiIsCgkJICAgICAgICAiVFNDb25zdHJ1Y3RTaWduYXR1cmVEZWNsYXJhdGlvbiIsCgkJICAgIF0uZm9yRWFjaChmdW5jdGlvbiAodHlwZU5hbWUpIHsKCQkgICAgICAgIGRlZih0eXBlTmFtZSkKCQkgICAgICAgICAgICAuYmFzZXMoIkRlY2xhcmF0aW9uIiwgIlRTSGFzT3B0aW9uYWxUeXBlUGFyYW1ldGVycyIsICJUU0hhc09wdGlvbmFsVHlwZUFubm90YXRpb24iKQoJCSAgICAgICAgICAgIC5idWlsZCgicGFyYW1ldGVycyIsICJ0eXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAgICAgLmZpZWxkKCJwYXJhbWV0ZXJzIiwgUGFyYW1ldGVyc1R5cGUpOwoJCSAgICB9KTsKCQkgICAgZGVmKCJUU0VudW1NZW1iZXIiKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgiaWQiLCAiaW5pdGlhbGl6ZXIiKQoJCSAgICAgICAgLmZpZWxkKCJpZCIsIG9yKGRlZigiSWRlbnRpZmllciIpLCBTdHJpbmdMaXRlcmFsKSkKCQkgICAgICAgIC5maWVsZCgiaW5pdGlhbGl6ZXIiLCBvcihkZWYoIkV4cHJlc3Npb24iKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIlRTVHlwZVF1ZXJ5IikKCQkgICAgICAgIC5iYXNlcygiVFNUeXBlIikKCQkgICAgICAgIC5idWlsZCgiZXhwck5hbWUiKQoJCSAgICAgICAgLmZpZWxkKCJleHByTmFtZSIsIG9yKFRTRW50aXR5TmFtZSwgZGVmKCJUU0ltcG9ydFR5cGUiKSkpOwoJCSAgICAvLyBJbmZlcnJlZCBmcm9tIEJhYnlsb24ncyB0c1BhcnNlVHlwZU1lbWJlciBtZXRob2QuCgkJICAgIHZhciBUU1R5cGVNZW1iZXIgPSBvcihkZWYoIlRTQ2FsbFNpZ25hdHVyZURlY2xhcmF0aW9uIiksIGRlZigiVFNDb25zdHJ1Y3RTaWduYXR1cmVEZWNsYXJhdGlvbiIpLCBkZWYoIlRTSW5kZXhTaWduYXR1cmUiKSwgZGVmKCJUU01ldGhvZFNpZ25hdHVyZSIpLCBkZWYoIlRTUHJvcGVydHlTaWduYXR1cmUiKSk7CgkJICAgIGRlZigiVFNUeXBlTGl0ZXJhbCIpCgkJICAgICAgICAuYmFzZXMoIlRTVHlwZSIpCgkJICAgICAgICAuYnVpbGQoIm1lbWJlcnMiKQoJCSAgICAgICAgLmZpZWxkKCJtZW1iZXJzIiwgW1RTVHlwZU1lbWJlcl0pOwoJCSAgICBkZWYoIlRTVHlwZVBhcmFtZXRlciIpCgkJICAgICAgICAuYmFzZXMoIklkZW50aWZpZXIiKQoJCSAgICAgICAgLmJ1aWxkKCJuYW1lIiwgImNvbnN0cmFpbnQiLCAiZGVmYXVsdCIpCgkJICAgICAgICAuZmllbGQoIm5hbWUiLCBTdHJpbmcpCgkJICAgICAgICAuZmllbGQoImNvbnN0cmFpbnQiLCBvcihkZWYoIlRTVHlwZSIpLCB2b2lkIDApLCBkZWZhdWx0c1sidW5kZWZpbmVkIl0pCgkJICAgICAgICAuZmllbGQoImRlZmF1bHQiLCBvcihkZWYoIlRTVHlwZSIpLCB2b2lkIDApLCBkZWZhdWx0c1sidW5kZWZpbmVkIl0pOwoJCSAgICBkZWYoIlRTVHlwZUFzc2VydGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkV4cHJlc3Npb24iLCAiUGF0dGVybiIpCgkJICAgICAgICAuYnVpbGQoInR5cGVBbm5vdGF0aW9uIiwgImV4cHJlc3Npb24iKQoJCSAgICAgICAgLmZpZWxkKCJ0eXBlQW5ub3RhdGlvbiIsIGRlZigiVFNUeXBlIikpCgkJICAgICAgICAuZmllbGQoImV4cHJlc3Npb24iLCBkZWYoIkV4cHJlc3Npb24iKSkKCQkgICAgICAgIC5maWVsZCgiZXh0cmEiLCBvcih7IHBhcmVudGhlc2l6ZWQ6IEJvb2xlYW4gfSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIlRTVHlwZVBhcmFtZXRlckRlY2xhcmF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJwYXJhbXMiKQoJCSAgICAgICAgLmZpZWxkKCJwYXJhbXMiLCBbZGVmKCJUU1R5cGVQYXJhbWV0ZXIiKV0pOwoJCSAgICBkZWYoIlRTVHlwZVBhcmFtZXRlckluc3RhbnRpYXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJOb2RlIikKCQkgICAgICAgIC5idWlsZCgicGFyYW1zIikKCQkgICAgICAgIC5maWVsZCgicGFyYW1zIiwgW2RlZigiVFNUeXBlIildKTsKCQkgICAgZGVmKCJUU0VudW1EZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYmFzZXMoIkRlY2xhcmF0aW9uIikKCQkgICAgICAgIC5idWlsZCgiaWQiLCAibWVtYmVycyIpCgkJICAgICAgICAuZmllbGQoImlkIiwgZGVmKCJJZGVudGlmaWVyIikpCgkJICAgICAgICAuZmllbGQoImNvbnN0IiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pCgkJICAgICAgICAuZmllbGQoImRlY2xhcmUiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgibWVtYmVycyIsIFtkZWYoIlRTRW51bU1lbWJlciIpXSkKCQkgICAgICAgIC5maWVsZCgiaW5pdGlhbGl6ZXIiLCBvcihkZWYoIkV4cHJlc3Npb24iKSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pOwoJCSAgICBkZWYoIlRTVHlwZUFsaWFzRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJEZWNsYXJhdGlvbiIsICJUU0hhc09wdGlvbmFsVHlwZVBhcmFtZXRlcnMiKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIsICJ0eXBlQW5ub3RhdGlvbiIpCgkJICAgICAgICAuZmllbGQoImlkIiwgZGVmKCJJZGVudGlmaWVyIikpCgkJICAgICAgICAuZmllbGQoImRlY2xhcmUiLCBCb29sZWFuLCBkZWZhdWx0c1siZmFsc2UiXSkKCQkgICAgICAgIC5maWVsZCgidHlwZUFubm90YXRpb24iLCBkZWYoIlRTVHlwZSIpKTsKCQkgICAgZGVmKCJUU01vZHVsZUJsb2NrIikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoImJvZHkiKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgW2RlZigiU3RhdGVtZW50IildKTsKCQkgICAgZGVmKCJUU01vZHVsZURlY2xhcmF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJpZCIsICJib2R5IikKCQkgICAgICAgIC5maWVsZCgiaWQiLCBvcihTdHJpbmdMaXRlcmFsLCBUU0VudGl0eU5hbWUpKQoJCSAgICAgICAgLmZpZWxkKCJkZWNsYXJlIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pCgkJICAgICAgICAuZmllbGQoImdsb2JhbCIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJib2R5Iiwgb3IoZGVmKCJUU01vZHVsZUJsb2NrIiksIGRlZigiVFNNb2R1bGVEZWNsYXJhdGlvbiIpLCBudWxsKSwgZGVmYXVsdHNbIm51bGwiXSk7CgkJICAgIGRlZigiVFNJbXBvcnRUeXBlIikKCQkgICAgICAgIC5iYXNlcygiVFNUeXBlIiwgIlRTSGFzT3B0aW9uYWxUeXBlUGFyYW1ldGVySW5zdGFudGlhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImFyZ3VtZW50IiwgInF1YWxpZmllciIsICJ0eXBlUGFyYW1ldGVycyIpCgkJICAgICAgICAuZmllbGQoImFyZ3VtZW50IiwgU3RyaW5nTGl0ZXJhbCkKCQkgICAgICAgIC5maWVsZCgicXVhbGlmaWVyIiwgb3IoVFNFbnRpdHlOYW1lLCB2b2lkIDApLCBkZWZhdWx0c1sidW5kZWZpbmVkIl0pOwoJCSAgICBkZWYoIlRTSW1wb3J0RXF1YWxzRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImlkIiwgIm1vZHVsZVJlZmVyZW5jZSIpCgkJICAgICAgICAuZmllbGQoImlkIiwgZGVmKCJJZGVudGlmaWVyIikpCgkJICAgICAgICAuZmllbGQoImlzRXhwb3J0IiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pCgkJICAgICAgICAuZmllbGQoIm1vZHVsZVJlZmVyZW5jZSIsIG9yKFRTRW50aXR5TmFtZSwgZGVmKCJUU0V4dGVybmFsTW9kdWxlUmVmZXJlbmNlIikpKTsKCQkgICAgZGVmKCJUU0V4dGVybmFsTW9kdWxlUmVmZXJlbmNlIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJ1aWxkKCJleHByZXNzaW9uIikKCQkgICAgICAgIC5maWVsZCgiZXhwcmVzc2lvbiIsIFN0cmluZ0xpdGVyYWwpOwoJCSAgICBkZWYoIlRTRXhwb3J0QXNzaWdubWVudCIpCgkJICAgICAgICAuYmFzZXMoIlN0YXRlbWVudCIpCgkJICAgICAgICAuYnVpbGQoImV4cHJlc3Npb24iKQoJCSAgICAgICAgLmZpZWxkKCJleHByZXNzaW9uIiwgZGVmKCJFeHByZXNzaW9uIikpOwoJCSAgICBkZWYoIlRTTmFtZXNwYWNlRXhwb3J0RGVjbGFyYXRpb24iKQoJCSAgICAgICAgLmJhc2VzKCJEZWNsYXJhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImlkIikKCQkgICAgICAgIC5maWVsZCgiaWQiLCBkZWYoIklkZW50aWZpZXIiKSk7CgkJICAgIGRlZigiVFNJbnRlcmZhY2VCb2R5IikKCQkgICAgICAgIC5iYXNlcygiTm9kZSIpCgkJICAgICAgICAuYnVpbGQoImJvZHkiKQoJCSAgICAgICAgLmZpZWxkKCJib2R5IiwgW1RTVHlwZU1lbWJlcl0pOwoJCSAgICBkZWYoIlRTRXhwcmVzc2lvbldpdGhUeXBlQXJndW1lbnRzIikKCQkgICAgICAgIC5iYXNlcygiVFNUeXBlIiwgIlRTSGFzT3B0aW9uYWxUeXBlUGFyYW1ldGVySW5zdGFudGlhdGlvbiIpCgkJICAgICAgICAuYnVpbGQoImV4cHJlc3Npb24iLCAidHlwZVBhcmFtZXRlcnMiKQoJCSAgICAgICAgLmZpZWxkKCJleHByZXNzaW9uIiwgVFNFbnRpdHlOYW1lKTsKCQkgICAgZGVmKCJUU0ludGVyZmFjZURlY2xhcmF0aW9uIikKCQkgICAgICAgIC5iYXNlcygiRGVjbGFyYXRpb24iLCAiVFNIYXNPcHRpb25hbFR5cGVQYXJhbWV0ZXJzIikKCQkgICAgICAgIC5idWlsZCgiaWQiLCAiYm9keSIpCgkJICAgICAgICAuZmllbGQoImlkIiwgVFNFbnRpdHlOYW1lKQoJCSAgICAgICAgLmZpZWxkKCJkZWNsYXJlIiwgQm9vbGVhbiwgZGVmYXVsdHNbImZhbHNlIl0pCgkJICAgICAgICAuZmllbGQoImV4dGVuZHMiLCBvcihbZGVmKCJUU0V4cHJlc3Npb25XaXRoVHlwZUFyZ3VtZW50cyIpXSwgbnVsbCksIGRlZmF1bHRzWyJudWxsIl0pCgkJICAgICAgICAuZmllbGQoImJvZHkiLCBkZWYoIlRTSW50ZXJmYWNlQm9keSIpKTsKCQkgICAgZGVmKCJUU1BhcmFtZXRlclByb3BlcnR5IikKCQkgICAgICAgIC5iYXNlcygiUGF0dGVybiIpCgkJICAgICAgICAuYnVpbGQoInBhcmFtZXRlciIpCgkJICAgICAgICAuZmllbGQoImFjY2Vzc2liaWxpdHkiLCBvcigicHVibGljIiwgInByaXZhdGUiLCAicHJvdGVjdGVkIiwgdm9pZCAwKSwgZGVmYXVsdHNbInVuZGVmaW5lZCJdKQoJCSAgICAgICAgLmZpZWxkKCJyZWFkb25seSIsIEJvb2xlYW4sIGRlZmF1bHRzWyJmYWxzZSJdKQoJCSAgICAgICAgLmZpZWxkKCJwYXJhbWV0ZXIiLCBvcihkZWYoIklkZW50aWZpZXIiKSwgZGVmKCJBc3NpZ25tZW50UGF0dGVybiIpKSk7CgkJICAgIGRlZigiQ2xhc3NQcm9wZXJ0eSIpCgkJICAgICAgICAuZmllbGQoImFjY2VzcyIsIC8vIE5vdCAiYWNjZXNzaWJpbGl0eSI/CgkJICAgIG9yKCJwdWJsaWMiLCAicHJpdmF0ZSIsICJwcm90ZWN0ZWQiLCB2b2lkIDApLCBkZWZhdWx0c1sidW5kZWZpbmVkIl0pOwoJCSAgICAvLyBEZWZpbmVkIGFscmVhZHkgaW4gZXM2IGFuZCBiYWJlbC1jb3JlLgoJCSAgICBkZWYoIkNsYXNzQm9keSIpCgkJICAgICAgICAuZmllbGQoImJvZHkiLCBbb3IoZGVmKCJNZXRob2REZWZpbml0aW9uIiksIGRlZigiVmFyaWFibGVEZWNsYXJhdG9yIiksIGRlZigiQ2xhc3NQcm9wZXJ0eURlZmluaXRpb24iKSwgZGVmKCJDbGFzc1Byb3BlcnR5IiksIGRlZigiQ2xhc3NQcml2YXRlUHJvcGVydHkiKSwgZGVmKCJDbGFzc01ldGhvZCIpLCBkZWYoIkNsYXNzUHJpdmF0ZU1ldGhvZCIpLCAKCQkgICAgICAgIC8vIEp1c3QgbmVlZCB0byBhZGQgdGhlc2UgdHlwZXM6CgkJICAgICAgICBkZWYoIlRTRGVjbGFyZU1ldGhvZCIpLCBUU1R5cGVNZW1iZXIpXSk7CgkJfQoJCWV4cG9ydHMuZGVmYXVsdCA9IGRlZmF1bHRfMTsKCQltb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbImRlZmF1bHQiXTsgCgl9ICh0eXBlc2NyaXB0LCB0eXBlc2NyaXB0LmV4cG9ydHMpKTsKCXJldHVybiB0eXBlc2NyaXB0LmV4cG9ydHM7Cn0KCnZhciBuYW1lZFR5cGVzID0ge307Cgp2YXIgaGFzUmVxdWlyZWROYW1lZFR5cGVzOwoKZnVuY3Rpb24gcmVxdWlyZU5hbWVkVHlwZXMgKCkgewoJaWYgKGhhc1JlcXVpcmVkTmFtZWRUeXBlcykgcmV0dXJuIG5hbWVkVHlwZXM7CgloYXNSZXF1aXJlZE5hbWVkVHlwZXMgPSAxOwoJKGZ1bmN0aW9uIChleHBvcnRzKSB7CgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCQlleHBvcnRzLm5hbWVkVHlwZXMgPSB2b2lkIDA7CgkJKGZ1bmN0aW9uIChuYW1lZFR5cGVzKSB7CgkJfSkoZXhwb3J0cy5uYW1lZFR5cGVzIHx8IChleHBvcnRzLm5hbWVkVHlwZXMgPSB7fSkpOyAKCX0gKG5hbWVkVHlwZXMpKTsKCXJldHVybiBuYW1lZFR5cGVzOwp9CgooZnVuY3Rpb24gKGV4cG9ydHMpIHsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CglleHBvcnRzLnZpc2l0ID0gZXhwb3J0cy51c2UgPSBleHBvcnRzLlR5cGUgPSBleHBvcnRzLnNvbWVGaWVsZCA9IGV4cG9ydHMuUGF0aFZpc2l0b3IgPSBleHBvcnRzLlBhdGggPSBleHBvcnRzLk5vZGVQYXRoID0gZXhwb3J0cy5uYW1lZFR5cGVzID0gZXhwb3J0cy5nZXRTdXBlcnR5cGVOYW1lcyA9IGV4cG9ydHMuZ2V0RmllbGRWYWx1ZSA9IGV4cG9ydHMuZ2V0RmllbGROYW1lcyA9IGV4cG9ydHMuZ2V0QnVpbGRlck5hbWUgPSBleHBvcnRzLmZpbmFsaXplID0gZXhwb3J0cy5lYWNoRmllbGQgPSBleHBvcnRzLmRlZmluZU1ldGhvZCA9IGV4cG9ydHMuYnVpbHRJblR5cGVzID0gZXhwb3J0cy5idWlsZGVycyA9IGV4cG9ydHMuYXN0Tm9kZXNBcmVFcXVpdmFsZW50ID0gdm9pZCAwOwoJdmFyIHRzbGliXzEgPSByZXF1aXJlJCQwOwoJdmFyIGZvcmtfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVGb3JrKCkpOwoJdmFyIGNvcmVfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVDb3JlKCkpOwoJdmFyIGVzNl8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZUVzNigpKTsKCXZhciBlczIwMTZfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVFczIwMTYoKSk7Cgl2YXIgZXMyMDE3XzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlRXMyMDE3KCkpOwoJdmFyIGVzMjAxOF8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZUVzMjAxOCgpKTsKCXZhciBlczIwMTlfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVFczIwMTkoKSk7Cgl2YXIgZXMyMDIwXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlRXMyMDIwKCkpOwoJdmFyIGpzeF8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZUpzeCgpKTsKCXZhciBmbG93XzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlRmxvdygpKTsKCXZhciBlc3ByaW1hXzEgPSB0c2xpYl8xLl9faW1wb3J0RGVmYXVsdChyZXF1aXJlRXNwcmltYSgpKTsKCXZhciBiYWJlbF8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZUJhYmVsKCkpOwoJdmFyIHR5cGVzY3JpcHRfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmVUeXBlc2NyaXB0KCkpOwoJdmFyIGVzX3Byb3Bvc2Fsc18xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZUVzUHJvcG9zYWxzKCkpOwoJdmFyIG5hbWVkVHlwZXNfMSA9IHJlcXVpcmVOYW1lZFR5cGVzKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIm5hbWVkVHlwZXMiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gbmFtZWRUeXBlc18xLm5hbWVkVHlwZXM7IH0gfSk7Cgl2YXIgX2EgPSBmb3JrXzEuZGVmYXVsdChbCgkgICAgLy8gVGhpcyBjb3JlIG1vZHVsZSBvZiBBU1QgdHlwZXMgY2FwdHVyZXMgRVM1IGFzIGl0IGlzIHBhcnNlZCB0b2RheSBieQoJICAgIC8vIGdpdDovL2dpdGh1Yi5jb20vYXJpeWEvZXNwcmltYS5naXQjbWFzdGVyLgoJICAgIGNvcmVfMS5kZWZhdWx0LAoJICAgIC8vIEZlZWwgZnJlZSB0byBhZGQgdG8gb3IgcmVtb3ZlIGZyb20gdGhpcyBsaXN0IG9mIGV4dGVuc2lvbiBtb2R1bGVzIHRvCgkgICAgLy8gY29uZmlndXJlIHRoZSBwcmVjaXNlIHR5cGUgaGllcmFyY2h5IHRoYXQgeW91IG5lZWQuCgkgICAgZXM2XzEuZGVmYXVsdCwKCSAgICBlczIwMTZfMS5kZWZhdWx0LAoJICAgIGVzMjAxN18xLmRlZmF1bHQsCgkgICAgZXMyMDE4XzEuZGVmYXVsdCwKCSAgICBlczIwMTlfMS5kZWZhdWx0LAoJICAgIGVzMjAyMF8xLmRlZmF1bHQsCgkgICAganN4XzEuZGVmYXVsdCwKCSAgICBmbG93XzEuZGVmYXVsdCwKCSAgICBlc3ByaW1hXzEuZGVmYXVsdCwKCSAgICBiYWJlbF8xLmRlZmF1bHQsCgkgICAgdHlwZXNjcmlwdF8xLmRlZmF1bHQsCgkgICAgZXNfcHJvcG9zYWxzXzEuZGVmYXVsdCwKCV0pLCBhc3ROb2Rlc0FyZUVxdWl2YWxlbnQgPSBfYS5hc3ROb2Rlc0FyZUVxdWl2YWxlbnQsIGJ1aWxkZXJzID0gX2EuYnVpbGRlcnMsIGJ1aWx0SW5UeXBlcyA9IF9hLmJ1aWx0SW5UeXBlcywgZGVmaW5lTWV0aG9kID0gX2EuZGVmaW5lTWV0aG9kLCBlYWNoRmllbGQgPSBfYS5lYWNoRmllbGQsIGZpbmFsaXplID0gX2EuZmluYWxpemUsIGdldEJ1aWxkZXJOYW1lID0gX2EuZ2V0QnVpbGRlck5hbWUsIGdldEZpZWxkTmFtZXMgPSBfYS5nZXRGaWVsZE5hbWVzLCBnZXRGaWVsZFZhbHVlID0gX2EuZ2V0RmllbGRWYWx1ZSwgZ2V0U3VwZXJ0eXBlTmFtZXMgPSBfYS5nZXRTdXBlcnR5cGVOYW1lcywgbiA9IF9hLm5hbWVkVHlwZXMsIE5vZGVQYXRoID0gX2EuTm9kZVBhdGgsIFBhdGggPSBfYS5QYXRoLCBQYXRoVmlzaXRvciA9IF9hLlBhdGhWaXNpdG9yLCBzb21lRmllbGQgPSBfYS5zb21lRmllbGQsIFR5cGUgPSBfYS5UeXBlLCB1c2UgPSBfYS51c2UsIHZpc2l0ID0gX2EudmlzaXQ7CglleHBvcnRzLmFzdE5vZGVzQXJlRXF1aXZhbGVudCA9IGFzdE5vZGVzQXJlRXF1aXZhbGVudDsKCWV4cG9ydHMuYnVpbGRlcnMgPSBidWlsZGVyczsKCWV4cG9ydHMuYnVpbHRJblR5cGVzID0gYnVpbHRJblR5cGVzOwoJZXhwb3J0cy5kZWZpbmVNZXRob2QgPSBkZWZpbmVNZXRob2Q7CglleHBvcnRzLmVhY2hGaWVsZCA9IGVhY2hGaWVsZDsKCWV4cG9ydHMuZmluYWxpemUgPSBmaW5hbGl6ZTsKCWV4cG9ydHMuZ2V0QnVpbGRlck5hbWUgPSBnZXRCdWlsZGVyTmFtZTsKCWV4cG9ydHMuZ2V0RmllbGROYW1lcyA9IGdldEZpZWxkTmFtZXM7CglleHBvcnRzLmdldEZpZWxkVmFsdWUgPSBnZXRGaWVsZFZhbHVlOwoJZXhwb3J0cy5nZXRTdXBlcnR5cGVOYW1lcyA9IGdldFN1cGVydHlwZU5hbWVzOwoJZXhwb3J0cy5Ob2RlUGF0aCA9IE5vZGVQYXRoOwoJZXhwb3J0cy5QYXRoID0gUGF0aDsKCWV4cG9ydHMuUGF0aFZpc2l0b3IgPSBQYXRoVmlzaXRvcjsKCWV4cG9ydHMuc29tZUZpZWxkID0gc29tZUZpZWxkOwoJZXhwb3J0cy5UeXBlID0gVHlwZTsKCWV4cG9ydHMudXNlID0gdXNlOwoJZXhwb3J0cy52aXNpdCA9IHZpc2l0OwoJLy8gUG9wdWxhdGUgdGhlIGV4cG9ydGVkIGZpZWxkcyBvZiB0aGUgbmFtZWRUeXBlcyBuYW1lc3BhY2UsIHdoaWxlIHN0aWxsCgkvLyByZXRhaW5pbmcgaXRzIG1lbWJlciB0eXBlcy4KCU9iamVjdC5hc3NpZ24obmFtZWRUeXBlc18xLm5hbWVkVHlwZXMsIG4pOyAKfSAobWFpbiQxKSk7Cgp2YXIgZXNjb2RlZ2VuID0ge307Cgp2YXIgZXN0cmF2ZXJzZSA9IHt9OwoKLyoKICBDb3B5cmlnaHQgKEMpIDIwMTItMjAxMyBZdXN1a2UgU3V6dWtpIDx1dGF0YW5lLnRlYUBnbWFpbC5jb20+CiAgQ29weXJpZ2h0IChDKSAyMDEyIEFyaXlhIEhpZGF5YXQgPGFyaXlhLmhpZGF5YXRAZ21haWwuY29tPgoKICBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQKICBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDoKCiAgICAqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0CiAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KICAgICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQKICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZQogICAgICBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLgoKICBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIKICBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFCiAgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UKICBBUkUgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgPENPUFlSSUdIVCBIT0xERVI+IEJFIExJQUJMRSBGT1IgQU5ZCiAgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMKICAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7CiAgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5ECiAgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQKICAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YKICBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgoqLwoKKGZ1bmN0aW9uIChleHBvcnRzKSB7CgkvKmpzbGludCB2YXJzOmZhbHNlLCBiaXR3aXNlOnRydWUqLwoJLypqc2hpbnQgaW5kZW50OjQqLwoJLypnbG9iYWwgZXhwb3J0czp0cnVlKi8KCShmdW5jdGlvbiBjbG9uZShleHBvcnRzKSB7CgoJICAgIHZhciBTeW50YXgsCgkgICAgICAgIFZpc2l0b3JPcHRpb24sCgkgICAgICAgIFZpc2l0b3JLZXlzLAoJICAgICAgICBCUkVBSywKCSAgICAgICAgU0tJUCwKCSAgICAgICAgUkVNT1ZFOwoKCSAgICBmdW5jdGlvbiBkZWVwQ29weShvYmopIHsKCSAgICAgICAgdmFyIHJldCA9IHt9LCBrZXksIHZhbDsKCSAgICAgICAgZm9yIChrZXkgaW4gb2JqKSB7CgkgICAgICAgICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KGtleSkpIHsKCSAgICAgICAgICAgICAgICB2YWwgPSBvYmpba2V5XTsKCSAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gJ29iamVjdCcgJiYgdmFsICE9PSBudWxsKSB7CgkgICAgICAgICAgICAgICAgICAgIHJldFtrZXldID0gZGVlcENvcHkodmFsKTsKCSAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICByZXRba2V5XSA9IHZhbDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJldDsKCSAgICB9CgoJICAgIC8vIGJhc2VkIG9uIExMVk0gbGliYysrIHVwcGVyX2JvdW5kIC8gbG93ZXJfYm91bmQKCSAgICAvLyBNSVQgTGljZW5zZQoKCSAgICBmdW5jdGlvbiB1cHBlckJvdW5kKGFycmF5LCBmdW5jKSB7CgkgICAgICAgIHZhciBkaWZmLCBsZW4sIGksIGN1cnJlbnQ7CgoJICAgICAgICBsZW4gPSBhcnJheS5sZW5ndGg7CgkgICAgICAgIGkgPSAwOwoKCSAgICAgICAgd2hpbGUgKGxlbikgewoJICAgICAgICAgICAgZGlmZiA9IGxlbiA+Pj4gMTsKCSAgICAgICAgICAgIGN1cnJlbnQgPSBpICsgZGlmZjsKCSAgICAgICAgICAgIGlmIChmdW5jKGFycmF5W2N1cnJlbnRdKSkgewoJICAgICAgICAgICAgICAgIGxlbiA9IGRpZmY7CgkgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgIGkgPSBjdXJyZW50ICsgMTsKCSAgICAgICAgICAgICAgICBsZW4gLT0gZGlmZiArIDE7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGk7CgkgICAgfQoKCSAgICBTeW50YXggPSB7CgkgICAgICAgIEFzc2lnbm1lbnRFeHByZXNzaW9uOiAnQXNzaWdubWVudEV4cHJlc3Npb24nLAoJICAgICAgICBBc3NpZ25tZW50UGF0dGVybjogJ0Fzc2lnbm1lbnRQYXR0ZXJuJywKCSAgICAgICAgQXJyYXlFeHByZXNzaW9uOiAnQXJyYXlFeHByZXNzaW9uJywKCSAgICAgICAgQXJyYXlQYXR0ZXJuOiAnQXJyYXlQYXR0ZXJuJywKCSAgICAgICAgQXJyb3dGdW5jdGlvbkV4cHJlc3Npb246ICdBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbicsCgkgICAgICAgIEF3YWl0RXhwcmVzc2lvbjogJ0F3YWl0RXhwcmVzc2lvbicsIC8vIENBVVRJT046IEl0J3MgZGVmZXJyZWQgdG8gRVM3LgoJICAgICAgICBCbG9ja1N0YXRlbWVudDogJ0Jsb2NrU3RhdGVtZW50JywKCSAgICAgICAgQmluYXJ5RXhwcmVzc2lvbjogJ0JpbmFyeUV4cHJlc3Npb24nLAoJICAgICAgICBCcmVha1N0YXRlbWVudDogJ0JyZWFrU3RhdGVtZW50JywKCSAgICAgICAgQ2FsbEV4cHJlc3Npb246ICdDYWxsRXhwcmVzc2lvbicsCgkgICAgICAgIENhdGNoQ2xhdXNlOiAnQ2F0Y2hDbGF1c2UnLAoJICAgICAgICBDaGFpbkV4cHJlc3Npb246ICdDaGFpbkV4cHJlc3Npb24nLAoJICAgICAgICBDbGFzc0JvZHk6ICdDbGFzc0JvZHknLAoJICAgICAgICBDbGFzc0RlY2xhcmF0aW9uOiAnQ2xhc3NEZWNsYXJhdGlvbicsCgkgICAgICAgIENsYXNzRXhwcmVzc2lvbjogJ0NsYXNzRXhwcmVzc2lvbicsCgkgICAgICAgIENvbXByZWhlbnNpb25CbG9jazogJ0NvbXByZWhlbnNpb25CbG9jaycsICAvLyBDQVVUSU9OOiBJdCdzIGRlZmVycmVkIHRvIEVTNy4KCSAgICAgICAgQ29tcHJlaGVuc2lvbkV4cHJlc3Npb246ICdDb21wcmVoZW5zaW9uRXhwcmVzc2lvbicsICAvLyBDQVVUSU9OOiBJdCdzIGRlZmVycmVkIHRvIEVTNy4KCSAgICAgICAgQ29uZGl0aW9uYWxFeHByZXNzaW9uOiAnQ29uZGl0aW9uYWxFeHByZXNzaW9uJywKCSAgICAgICAgQ29udGludWVTdGF0ZW1lbnQ6ICdDb250aW51ZVN0YXRlbWVudCcsCgkgICAgICAgIERlYnVnZ2VyU3RhdGVtZW50OiAnRGVidWdnZXJTdGF0ZW1lbnQnLAoJICAgICAgICBEaXJlY3RpdmVTdGF0ZW1lbnQ6ICdEaXJlY3RpdmVTdGF0ZW1lbnQnLAoJICAgICAgICBEb1doaWxlU3RhdGVtZW50OiAnRG9XaGlsZVN0YXRlbWVudCcsCgkgICAgICAgIEVtcHR5U3RhdGVtZW50OiAnRW1wdHlTdGF0ZW1lbnQnLAoJICAgICAgICBFeHBvcnRBbGxEZWNsYXJhdGlvbjogJ0V4cG9ydEFsbERlY2xhcmF0aW9uJywKCSAgICAgICAgRXhwb3J0RGVmYXVsdERlY2xhcmF0aW9uOiAnRXhwb3J0RGVmYXVsdERlY2xhcmF0aW9uJywKCSAgICAgICAgRXhwb3J0TmFtZWREZWNsYXJhdGlvbjogJ0V4cG9ydE5hbWVkRGVjbGFyYXRpb24nLAoJICAgICAgICBFeHBvcnRTcGVjaWZpZXI6ICdFeHBvcnRTcGVjaWZpZXInLAoJICAgICAgICBFeHByZXNzaW9uU3RhdGVtZW50OiAnRXhwcmVzc2lvblN0YXRlbWVudCcsCgkgICAgICAgIEZvclN0YXRlbWVudDogJ0ZvclN0YXRlbWVudCcsCgkgICAgICAgIEZvckluU3RhdGVtZW50OiAnRm9ySW5TdGF0ZW1lbnQnLAoJICAgICAgICBGb3JPZlN0YXRlbWVudDogJ0Zvck9mU3RhdGVtZW50JywKCSAgICAgICAgRnVuY3Rpb25EZWNsYXJhdGlvbjogJ0Z1bmN0aW9uRGVjbGFyYXRpb24nLAoJICAgICAgICBGdW5jdGlvbkV4cHJlc3Npb246ICdGdW5jdGlvbkV4cHJlc3Npb24nLAoJICAgICAgICBHZW5lcmF0b3JFeHByZXNzaW9uOiAnR2VuZXJhdG9yRXhwcmVzc2lvbicsICAvLyBDQVVUSU9OOiBJdCdzIGRlZmVycmVkIHRvIEVTNy4KCSAgICAgICAgSWRlbnRpZmllcjogJ0lkZW50aWZpZXInLAoJICAgICAgICBJZlN0YXRlbWVudDogJ0lmU3RhdGVtZW50JywKCSAgICAgICAgSW1wb3J0RXhwcmVzc2lvbjogJ0ltcG9ydEV4cHJlc3Npb24nLAoJICAgICAgICBJbXBvcnREZWNsYXJhdGlvbjogJ0ltcG9ydERlY2xhcmF0aW9uJywKCSAgICAgICAgSW1wb3J0RGVmYXVsdFNwZWNpZmllcjogJ0ltcG9ydERlZmF1bHRTcGVjaWZpZXInLAoJICAgICAgICBJbXBvcnROYW1lc3BhY2VTcGVjaWZpZXI6ICdJbXBvcnROYW1lc3BhY2VTcGVjaWZpZXInLAoJICAgICAgICBJbXBvcnRTcGVjaWZpZXI6ICdJbXBvcnRTcGVjaWZpZXInLAoJICAgICAgICBMaXRlcmFsOiAnTGl0ZXJhbCcsCgkgICAgICAgIExhYmVsZWRTdGF0ZW1lbnQ6ICdMYWJlbGVkU3RhdGVtZW50JywKCSAgICAgICAgTG9naWNhbEV4cHJlc3Npb246ICdMb2dpY2FsRXhwcmVzc2lvbicsCgkgICAgICAgIE1lbWJlckV4cHJlc3Npb246ICdNZW1iZXJFeHByZXNzaW9uJywKCSAgICAgICAgTWV0YVByb3BlcnR5OiAnTWV0YVByb3BlcnR5JywKCSAgICAgICAgTWV0aG9kRGVmaW5pdGlvbjogJ01ldGhvZERlZmluaXRpb24nLAoJICAgICAgICBNb2R1bGVTcGVjaWZpZXI6ICdNb2R1bGVTcGVjaWZpZXInLAoJICAgICAgICBOZXdFeHByZXNzaW9uOiAnTmV3RXhwcmVzc2lvbicsCgkgICAgICAgIE9iamVjdEV4cHJlc3Npb246ICdPYmplY3RFeHByZXNzaW9uJywKCSAgICAgICAgT2JqZWN0UGF0dGVybjogJ09iamVjdFBhdHRlcm4nLAoJICAgICAgICBQcml2YXRlSWRlbnRpZmllcjogJ1ByaXZhdGVJZGVudGlmaWVyJywKCSAgICAgICAgUHJvZ3JhbTogJ1Byb2dyYW0nLAoJICAgICAgICBQcm9wZXJ0eTogJ1Byb3BlcnR5JywKCSAgICAgICAgUHJvcGVydHlEZWZpbml0aW9uOiAnUHJvcGVydHlEZWZpbml0aW9uJywKCSAgICAgICAgUmVzdEVsZW1lbnQ6ICdSZXN0RWxlbWVudCcsCgkgICAgICAgIFJldHVyblN0YXRlbWVudDogJ1JldHVyblN0YXRlbWVudCcsCgkgICAgICAgIFNlcXVlbmNlRXhwcmVzc2lvbjogJ1NlcXVlbmNlRXhwcmVzc2lvbicsCgkgICAgICAgIFNwcmVhZEVsZW1lbnQ6ICdTcHJlYWRFbGVtZW50JywKCSAgICAgICAgU3VwZXI6ICdTdXBlcicsCgkgICAgICAgIFN3aXRjaFN0YXRlbWVudDogJ1N3aXRjaFN0YXRlbWVudCcsCgkgICAgICAgIFN3aXRjaENhc2U6ICdTd2l0Y2hDYXNlJywKCSAgICAgICAgVGFnZ2VkVGVtcGxhdGVFeHByZXNzaW9uOiAnVGFnZ2VkVGVtcGxhdGVFeHByZXNzaW9uJywKCSAgICAgICAgVGVtcGxhdGVFbGVtZW50OiAnVGVtcGxhdGVFbGVtZW50JywKCSAgICAgICAgVGVtcGxhdGVMaXRlcmFsOiAnVGVtcGxhdGVMaXRlcmFsJywKCSAgICAgICAgVGhpc0V4cHJlc3Npb246ICdUaGlzRXhwcmVzc2lvbicsCgkgICAgICAgIFRocm93U3RhdGVtZW50OiAnVGhyb3dTdGF0ZW1lbnQnLAoJICAgICAgICBUcnlTdGF0ZW1lbnQ6ICdUcnlTdGF0ZW1lbnQnLAoJICAgICAgICBVbmFyeUV4cHJlc3Npb246ICdVbmFyeUV4cHJlc3Npb24nLAoJICAgICAgICBVcGRhdGVFeHByZXNzaW9uOiAnVXBkYXRlRXhwcmVzc2lvbicsCgkgICAgICAgIFZhcmlhYmxlRGVjbGFyYXRpb246ICdWYXJpYWJsZURlY2xhcmF0aW9uJywKCSAgICAgICAgVmFyaWFibGVEZWNsYXJhdG9yOiAnVmFyaWFibGVEZWNsYXJhdG9yJywKCSAgICAgICAgV2hpbGVTdGF0ZW1lbnQ6ICdXaGlsZVN0YXRlbWVudCcsCgkgICAgICAgIFdpdGhTdGF0ZW1lbnQ6ICdXaXRoU3RhdGVtZW50JywKCSAgICAgICAgWWllbGRFeHByZXNzaW9uOiAnWWllbGRFeHByZXNzaW9uJwoJICAgIH07CgoJICAgIFZpc2l0b3JLZXlzID0gewoJICAgICAgICBBc3NpZ25tZW50RXhwcmVzc2lvbjogWydsZWZ0JywgJ3JpZ2h0J10sCgkgICAgICAgIEFzc2lnbm1lbnRQYXR0ZXJuOiBbJ2xlZnQnLCAncmlnaHQnXSwKCSAgICAgICAgQXJyYXlFeHByZXNzaW9uOiBbJ2VsZW1lbnRzJ10sCgkgICAgICAgIEFycmF5UGF0dGVybjogWydlbGVtZW50cyddLAoJICAgICAgICBBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbjogWydwYXJhbXMnLCAnYm9keSddLAoJICAgICAgICBBd2FpdEV4cHJlc3Npb246IFsnYXJndW1lbnQnXSwgLy8gQ0FVVElPTjogSXQncyBkZWZlcnJlZCB0byBFUzcuCgkgICAgICAgIEJsb2NrU3RhdGVtZW50OiBbJ2JvZHknXSwKCSAgICAgICAgQmluYXJ5RXhwcmVzc2lvbjogWydsZWZ0JywgJ3JpZ2h0J10sCgkgICAgICAgIEJyZWFrU3RhdGVtZW50OiBbJ2xhYmVsJ10sCgkgICAgICAgIENhbGxFeHByZXNzaW9uOiBbJ2NhbGxlZScsICdhcmd1bWVudHMnXSwKCSAgICAgICAgQ2F0Y2hDbGF1c2U6IFsncGFyYW0nLCAnYm9keSddLAoJICAgICAgICBDaGFpbkV4cHJlc3Npb246IFsnZXhwcmVzc2lvbiddLAoJICAgICAgICBDbGFzc0JvZHk6IFsnYm9keSddLAoJICAgICAgICBDbGFzc0RlY2xhcmF0aW9uOiBbJ2lkJywgJ3N1cGVyQ2xhc3MnLCAnYm9keSddLAoJICAgICAgICBDbGFzc0V4cHJlc3Npb246IFsnaWQnLCAnc3VwZXJDbGFzcycsICdib2R5J10sCgkgICAgICAgIENvbXByZWhlbnNpb25CbG9jazogWydsZWZ0JywgJ3JpZ2h0J10sICAvLyBDQVVUSU9OOiBJdCdzIGRlZmVycmVkIHRvIEVTNy4KCSAgICAgICAgQ29tcHJlaGVuc2lvbkV4cHJlc3Npb246IFsnYmxvY2tzJywgJ2ZpbHRlcicsICdib2R5J10sICAvLyBDQVVUSU9OOiBJdCdzIGRlZmVycmVkIHRvIEVTNy4KCSAgICAgICAgQ29uZGl0aW9uYWxFeHByZXNzaW9uOiBbJ3Rlc3QnLCAnY29uc2VxdWVudCcsICdhbHRlcm5hdGUnXSwKCSAgICAgICAgQ29udGludWVTdGF0ZW1lbnQ6IFsnbGFiZWwnXSwKCSAgICAgICAgRGVidWdnZXJTdGF0ZW1lbnQ6IFtdLAoJICAgICAgICBEaXJlY3RpdmVTdGF0ZW1lbnQ6IFtdLAoJICAgICAgICBEb1doaWxlU3RhdGVtZW50OiBbJ2JvZHknLCAndGVzdCddLAoJICAgICAgICBFbXB0eVN0YXRlbWVudDogW10sCgkgICAgICAgIEV4cG9ydEFsbERlY2xhcmF0aW9uOiBbJ3NvdXJjZSddLAoJICAgICAgICBFeHBvcnREZWZhdWx0RGVjbGFyYXRpb246IFsnZGVjbGFyYXRpb24nXSwKCSAgICAgICAgRXhwb3J0TmFtZWREZWNsYXJhdGlvbjogWydkZWNsYXJhdGlvbicsICdzcGVjaWZpZXJzJywgJ3NvdXJjZSddLAoJICAgICAgICBFeHBvcnRTcGVjaWZpZXI6IFsnZXhwb3J0ZWQnLCAnbG9jYWwnXSwKCSAgICAgICAgRXhwcmVzc2lvblN0YXRlbWVudDogWydleHByZXNzaW9uJ10sCgkgICAgICAgIEZvclN0YXRlbWVudDogWydpbml0JywgJ3Rlc3QnLCAndXBkYXRlJywgJ2JvZHknXSwKCSAgICAgICAgRm9ySW5TdGF0ZW1lbnQ6IFsnbGVmdCcsICdyaWdodCcsICdib2R5J10sCgkgICAgICAgIEZvck9mU3RhdGVtZW50OiBbJ2xlZnQnLCAncmlnaHQnLCAnYm9keSddLAoJICAgICAgICBGdW5jdGlvbkRlY2xhcmF0aW9uOiBbJ2lkJywgJ3BhcmFtcycsICdib2R5J10sCgkgICAgICAgIEZ1bmN0aW9uRXhwcmVzc2lvbjogWydpZCcsICdwYXJhbXMnLCAnYm9keSddLAoJICAgICAgICBHZW5lcmF0b3JFeHByZXNzaW9uOiBbJ2Jsb2NrcycsICdmaWx0ZXInLCAnYm9keSddLCAgLy8gQ0FVVElPTjogSXQncyBkZWZlcnJlZCB0byBFUzcuCgkgICAgICAgIElkZW50aWZpZXI6IFtdLAoJICAgICAgICBJZlN0YXRlbWVudDogWyd0ZXN0JywgJ2NvbnNlcXVlbnQnLCAnYWx0ZXJuYXRlJ10sCgkgICAgICAgIEltcG9ydEV4cHJlc3Npb246IFsnc291cmNlJ10sCgkgICAgICAgIEltcG9ydERlY2xhcmF0aW9uOiBbJ3NwZWNpZmllcnMnLCAnc291cmNlJ10sCgkgICAgICAgIEltcG9ydERlZmF1bHRTcGVjaWZpZXI6IFsnbG9jYWwnXSwKCSAgICAgICAgSW1wb3J0TmFtZXNwYWNlU3BlY2lmaWVyOiBbJ2xvY2FsJ10sCgkgICAgICAgIEltcG9ydFNwZWNpZmllcjogWydpbXBvcnRlZCcsICdsb2NhbCddLAoJICAgICAgICBMaXRlcmFsOiBbXSwKCSAgICAgICAgTGFiZWxlZFN0YXRlbWVudDogWydsYWJlbCcsICdib2R5J10sCgkgICAgICAgIExvZ2ljYWxFeHByZXNzaW9uOiBbJ2xlZnQnLCAncmlnaHQnXSwKCSAgICAgICAgTWVtYmVyRXhwcmVzc2lvbjogWydvYmplY3QnLCAncHJvcGVydHknXSwKCSAgICAgICAgTWV0YVByb3BlcnR5OiBbJ21ldGEnLCAncHJvcGVydHknXSwKCSAgICAgICAgTWV0aG9kRGVmaW5pdGlvbjogWydrZXknLCAndmFsdWUnXSwKCSAgICAgICAgTW9kdWxlU3BlY2lmaWVyOiBbXSwKCSAgICAgICAgTmV3RXhwcmVzc2lvbjogWydjYWxsZWUnLCAnYXJndW1lbnRzJ10sCgkgICAgICAgIE9iamVjdEV4cHJlc3Npb246IFsncHJvcGVydGllcyddLAoJICAgICAgICBPYmplY3RQYXR0ZXJuOiBbJ3Byb3BlcnRpZXMnXSwKCSAgICAgICAgUHJpdmF0ZUlkZW50aWZpZXI6IFtdLAoJICAgICAgICBQcm9ncmFtOiBbJ2JvZHknXSwKCSAgICAgICAgUHJvcGVydHk6IFsna2V5JywgJ3ZhbHVlJ10sCgkgICAgICAgIFByb3BlcnR5RGVmaW5pdGlvbjogWydrZXknLCAndmFsdWUnXSwKCSAgICAgICAgUmVzdEVsZW1lbnQ6IFsgJ2FyZ3VtZW50JyBdLAoJICAgICAgICBSZXR1cm5TdGF0ZW1lbnQ6IFsnYXJndW1lbnQnXSwKCSAgICAgICAgU2VxdWVuY2VFeHByZXNzaW9uOiBbJ2V4cHJlc3Npb25zJ10sCgkgICAgICAgIFNwcmVhZEVsZW1lbnQ6IFsnYXJndW1lbnQnXSwKCSAgICAgICAgU3VwZXI6IFtdLAoJICAgICAgICBTd2l0Y2hTdGF0ZW1lbnQ6IFsnZGlzY3JpbWluYW50JywgJ2Nhc2VzJ10sCgkgICAgICAgIFN3aXRjaENhc2U6IFsndGVzdCcsICdjb25zZXF1ZW50J10sCgkgICAgICAgIFRhZ2dlZFRlbXBsYXRlRXhwcmVzc2lvbjogWyd0YWcnLCAncXVhc2knXSwKCSAgICAgICAgVGVtcGxhdGVFbGVtZW50OiBbXSwKCSAgICAgICAgVGVtcGxhdGVMaXRlcmFsOiBbJ3F1YXNpcycsICdleHByZXNzaW9ucyddLAoJICAgICAgICBUaGlzRXhwcmVzc2lvbjogW10sCgkgICAgICAgIFRocm93U3RhdGVtZW50OiBbJ2FyZ3VtZW50J10sCgkgICAgICAgIFRyeVN0YXRlbWVudDogWydibG9jaycsICdoYW5kbGVyJywgJ2ZpbmFsaXplciddLAoJICAgICAgICBVbmFyeUV4cHJlc3Npb246IFsnYXJndW1lbnQnXSwKCSAgICAgICAgVXBkYXRlRXhwcmVzc2lvbjogWydhcmd1bWVudCddLAoJICAgICAgICBWYXJpYWJsZURlY2xhcmF0aW9uOiBbJ2RlY2xhcmF0aW9ucyddLAoJICAgICAgICBWYXJpYWJsZURlY2xhcmF0b3I6IFsnaWQnLCAnaW5pdCddLAoJICAgICAgICBXaGlsZVN0YXRlbWVudDogWyd0ZXN0JywgJ2JvZHknXSwKCSAgICAgICAgV2l0aFN0YXRlbWVudDogWydvYmplY3QnLCAnYm9keSddLAoJICAgICAgICBZaWVsZEV4cHJlc3Npb246IFsnYXJndW1lbnQnXQoJICAgIH07CgoJICAgIC8vIHVuaXF1ZSBpZAoJICAgIEJSRUFLID0ge307CgkgICAgU0tJUCA9IHt9OwoJICAgIFJFTU9WRSA9IHt9OwoKCSAgICBWaXNpdG9yT3B0aW9uID0gewoJICAgICAgICBCcmVhazogQlJFQUssCgkgICAgICAgIFNraXA6IFNLSVAsCgkgICAgICAgIFJlbW92ZTogUkVNT1ZFCgkgICAgfTsKCgkgICAgZnVuY3Rpb24gUmVmZXJlbmNlKHBhcmVudCwga2V5KSB7CgkgICAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50OwoJICAgICAgICB0aGlzLmtleSA9IGtleTsKCSAgICB9CgoJICAgIFJlZmVyZW5jZS5wcm90b3R5cGUucmVwbGFjZSA9IGZ1bmN0aW9uIHJlcGxhY2Uobm9kZSkgewoJICAgICAgICB0aGlzLnBhcmVudFt0aGlzLmtleV0gPSBub2RlOwoJICAgIH07CgoJICAgIFJlZmVyZW5jZS5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gcmVtb3ZlKCkgewoJICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLnBhcmVudCkpIHsKCSAgICAgICAgICAgIHRoaXMucGFyZW50LnNwbGljZSh0aGlzLmtleSwgMSk7CgkgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCSAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgIHRoaXMucmVwbGFjZShudWxsKTsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgIH07CgoJICAgIGZ1bmN0aW9uIEVsZW1lbnQobm9kZSwgcGF0aCwgd3JhcCwgcmVmKSB7CgkgICAgICAgIHRoaXMubm9kZSA9IG5vZGU7CgkgICAgICAgIHRoaXMucGF0aCA9IHBhdGg7CgkgICAgICAgIHRoaXMud3JhcCA9IHdyYXA7CgkgICAgICAgIHRoaXMucmVmID0gcmVmOwoJICAgIH0KCgkgICAgZnVuY3Rpb24gQ29udHJvbGxlcigpIHsgfQoKCSAgICAvLyBBUEk6CgkgICAgLy8gcmV0dXJuIHByb3BlcnR5IHBhdGggYXJyYXkgZnJvbSByb290IHRvIGN1cnJlbnQgbm9kZQoJICAgIENvbnRyb2xsZXIucHJvdG90eXBlLnBhdGggPSBmdW5jdGlvbiBwYXRoKCkgewoJICAgICAgICB2YXIgaSwgaXosIGosIGp6LCByZXN1bHQsIGVsZW1lbnQ7CgoJICAgICAgICBmdW5jdGlvbiBhZGRUb1BhdGgocmVzdWx0LCBwYXRoKSB7CgkgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShwYXRoKSkgewoJICAgICAgICAgICAgICAgIGZvciAoaiA9IDAsIGp6ID0gcGF0aC5sZW5ndGg7IGogPCBqejsgKytqKSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHBhdGhbal0pOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gocGF0aCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCgkgICAgICAgIC8vIHJvb3Qgbm9kZQoJICAgICAgICBpZiAoIXRoaXMuX19jdXJyZW50LnBhdGgpIHsKCSAgICAgICAgICAgIHJldHVybiBudWxsOwoJICAgICAgICB9CgoJICAgICAgICAvLyBmaXJzdCBub2RlIGlzIHNlbnRpbmVsLCBzZWNvbmQgbm9kZSBpcyByb290IGVsZW1lbnQKCSAgICAgICAgcmVzdWx0ID0gW107CgkgICAgICAgIGZvciAoaSA9IDIsIGl6ID0gdGhpcy5fX2xlYXZlbGlzdC5sZW5ndGg7IGkgPCBpejsgKytpKSB7CgkgICAgICAgICAgICBlbGVtZW50ID0gdGhpcy5fX2xlYXZlbGlzdFtpXTsKCSAgICAgICAgICAgIGFkZFRvUGF0aChyZXN1bHQsIGVsZW1lbnQucGF0aCk7CgkgICAgICAgIH0KCSAgICAgICAgYWRkVG9QYXRoKHJlc3VsdCwgdGhpcy5fX2N1cnJlbnQucGF0aCk7CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCgkgICAgLy8gQVBJOgoJICAgIC8vIHJldHVybiB0eXBlIG9mIGN1cnJlbnQgbm9kZQoJICAgIENvbnRyb2xsZXIucHJvdG90eXBlLnR5cGUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBub2RlID0gdGhpcy5jdXJyZW50KCk7CgkgICAgICAgIHJldHVybiBub2RlLnR5cGUgfHwgdGhpcy5fX2N1cnJlbnQud3JhcDsKCSAgICB9OwoKCSAgICAvLyBBUEk6CgkgICAgLy8gcmV0dXJuIGFycmF5IG9mIHBhcmVudCBlbGVtZW50cwoJICAgIENvbnRyb2xsZXIucHJvdG90eXBlLnBhcmVudHMgPSBmdW5jdGlvbiBwYXJlbnRzKCkgewoJICAgICAgICB2YXIgaSwgaXosIHJlc3VsdDsKCgkgICAgICAgIC8vIGZpcnN0IG5vZGUgaXMgc2VudGluZWwKCSAgICAgICAgcmVzdWx0ID0gW107CgkgICAgICAgIGZvciAoaSA9IDEsIGl6ID0gdGhpcy5fX2xlYXZlbGlzdC5sZW5ndGg7IGkgPCBpejsgKytpKSB7CgkgICAgICAgICAgICByZXN1bHQucHVzaCh0aGlzLl9fbGVhdmVsaXN0W2ldLm5vZGUpOwoJICAgICAgICB9CgoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgoJICAgIC8vIEFQSToKCSAgICAvLyByZXR1cm4gY3VycmVudCBub2RlCgkgICAgQ29udHJvbGxlci5wcm90b3R5cGUuY3VycmVudCA9IGZ1bmN0aW9uIGN1cnJlbnQoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLl9fY3VycmVudC5ub2RlOwoJICAgIH07CgoJICAgIENvbnRyb2xsZXIucHJvdG90eXBlLl9fZXhlY3V0ZSA9IGZ1bmN0aW9uIF9fZXhlY3V0ZShjYWxsYmFjaywgZWxlbWVudCkgewoJICAgICAgICB2YXIgcHJldmlvdXMsIHJlc3VsdDsKCgkgICAgICAgIHJlc3VsdCA9IHVuZGVmaW5lZDsKCgkgICAgICAgIHByZXZpb3VzICA9IHRoaXMuX19jdXJyZW50OwoJICAgICAgICB0aGlzLl9fY3VycmVudCA9IGVsZW1lbnQ7CgkgICAgICAgIHRoaXMuX19zdGF0ZSA9IG51bGw7CgkgICAgICAgIGlmIChjYWxsYmFjaykgewoJICAgICAgICAgICAgcmVzdWx0ID0gY2FsbGJhY2suY2FsbCh0aGlzLCBlbGVtZW50Lm5vZGUsIHRoaXMuX19sZWF2ZWxpc3RbdGhpcy5fX2xlYXZlbGlzdC5sZW5ndGggLSAxXS5ub2RlKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLl9fY3VycmVudCA9IHByZXZpb3VzOwoKCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoKCSAgICAvLyBBUEk6CgkgICAgLy8gbm90aWZ5IGNvbnRyb2wgc2tpcCAvIGJyZWFrCgkgICAgQ29udHJvbGxlci5wcm90b3R5cGUubm90aWZ5ID0gZnVuY3Rpb24gbm90aWZ5KGZsYWcpIHsKCSAgICAgICAgdGhpcy5fX3N0YXRlID0gZmxhZzsKCSAgICB9OwoKCSAgICAvLyBBUEk6CgkgICAgLy8gc2tpcCBjaGlsZCBub2RlcyBvZiBjdXJyZW50IG5vZGUKCSAgICBDb250cm9sbGVyLnByb3RvdHlwZS5za2lwID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB0aGlzLm5vdGlmeShTS0lQKTsKCSAgICB9OwoKCSAgICAvLyBBUEk6CgkgICAgLy8gYnJlYWsgdHJhdmVyc2FscwoJICAgIENvbnRyb2xsZXIucHJvdG90eXBlWydicmVhayddID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB0aGlzLm5vdGlmeShCUkVBSyk7CgkgICAgfTsKCgkgICAgLy8gQVBJOgoJICAgIC8vIHJlbW92ZSBub2RlCgkgICAgQ29udHJvbGxlci5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB0aGlzLm5vdGlmeShSRU1PVkUpOwoJICAgIH07CgoJICAgIENvbnRyb2xsZXIucHJvdG90eXBlLl9faW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKHJvb3QsIHZpc2l0b3IpIHsKCSAgICAgICAgdGhpcy52aXNpdG9yID0gdmlzaXRvcjsKCSAgICAgICAgdGhpcy5yb290ID0gcm9vdDsKCSAgICAgICAgdGhpcy5fX3dvcmtsaXN0ID0gW107CgkgICAgICAgIHRoaXMuX19sZWF2ZWxpc3QgPSBbXTsKCSAgICAgICAgdGhpcy5fX2N1cnJlbnQgPSBudWxsOwoJICAgICAgICB0aGlzLl9fc3RhdGUgPSBudWxsOwoJICAgICAgICB0aGlzLl9fZmFsbGJhY2sgPSBudWxsOwoJICAgICAgICBpZiAodmlzaXRvci5mYWxsYmFjayA9PT0gJ2l0ZXJhdGlvbicpIHsKCSAgICAgICAgICAgIHRoaXMuX19mYWxsYmFjayA9IE9iamVjdC5rZXlzOwoJICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB2aXNpdG9yLmZhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7CgkgICAgICAgICAgICB0aGlzLl9fZmFsbGJhY2sgPSB2aXNpdG9yLmZhbGxiYWNrOwoJICAgICAgICB9CgoJICAgICAgICB0aGlzLl9fa2V5cyA9IFZpc2l0b3JLZXlzOwoJICAgICAgICBpZiAodmlzaXRvci5rZXlzKSB7CgkgICAgICAgICAgICB0aGlzLl9fa2V5cyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmNyZWF0ZSh0aGlzLl9fa2V5cyksIHZpc2l0b3Iua2V5cyk7CgkgICAgICAgIH0KCSAgICB9OwoKCSAgICBmdW5jdGlvbiBpc05vZGUobm9kZSkgewoJICAgICAgICBpZiAobm9kZSA9PSBudWxsKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHR5cGVvZiBub2RlID09PSAnb2JqZWN0JyAmJiB0eXBlb2Ygbm9kZS50eXBlID09PSAnc3RyaW5nJzsKCSAgICB9CgoJICAgIGZ1bmN0aW9uIGlzUHJvcGVydHkobm9kZVR5cGUsIGtleSkgewoJICAgICAgICByZXR1cm4gKG5vZGVUeXBlID09PSBTeW50YXguT2JqZWN0RXhwcmVzc2lvbiB8fCBub2RlVHlwZSA9PT0gU3ludGF4Lk9iamVjdFBhdHRlcm4pICYmICdwcm9wZXJ0aWVzJyA9PT0ga2V5OwoJICAgIH0KCSAgCgkgICAgZnVuY3Rpb24gY2FuZGlkYXRlRXhpc3RzSW5MZWF2ZUxpc3QobGVhdmVsaXN0LCBjYW5kaWRhdGUpIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IGxlYXZlbGlzdC5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgewoJICAgICAgICAgICAgaWYgKGxlYXZlbGlzdFtpXS5ub2RlID09PSBjYW5kaWRhdGUpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgfQoKCSAgICBDb250cm9sbGVyLnByb3RvdHlwZS50cmF2ZXJzZSA9IGZ1bmN0aW9uIHRyYXZlcnNlKHJvb3QsIHZpc2l0b3IpIHsKCSAgICAgICAgdmFyIHdvcmtsaXN0LAoJICAgICAgICAgICAgbGVhdmVsaXN0LAoJICAgICAgICAgICAgZWxlbWVudCwKCSAgICAgICAgICAgIG5vZGUsCgkgICAgICAgICAgICBub2RlVHlwZSwKCSAgICAgICAgICAgIHJldCwKCSAgICAgICAgICAgIGtleSwKCSAgICAgICAgICAgIGN1cnJlbnQsCgkgICAgICAgICAgICBjdXJyZW50MiwKCSAgICAgICAgICAgIGNhbmRpZGF0ZXMsCgkgICAgICAgICAgICBjYW5kaWRhdGUsCgkgICAgICAgICAgICBzZW50aW5lbDsKCgkgICAgICAgIHRoaXMuX19pbml0aWFsaXplKHJvb3QsIHZpc2l0b3IpOwoKCSAgICAgICAgc2VudGluZWwgPSB7fTsKCgkgICAgICAgIC8vIHJlZmVyZW5jZQoJICAgICAgICB3b3JrbGlzdCA9IHRoaXMuX193b3JrbGlzdDsKCSAgICAgICAgbGVhdmVsaXN0ID0gdGhpcy5fX2xlYXZlbGlzdDsKCgkgICAgICAgIC8vIGluaXRpYWxpemUKCSAgICAgICAgd29ya2xpc3QucHVzaChuZXcgRWxlbWVudChyb290LCBudWxsLCBudWxsLCBudWxsKSk7CgkgICAgICAgIGxlYXZlbGlzdC5wdXNoKG5ldyBFbGVtZW50KG51bGwsIG51bGwsIG51bGwsIG51bGwpKTsKCgkgICAgICAgIHdoaWxlICh3b3JrbGlzdC5sZW5ndGgpIHsKCSAgICAgICAgICAgIGVsZW1lbnQgPSB3b3JrbGlzdC5wb3AoKTsKCgkgICAgICAgICAgICBpZiAoZWxlbWVudCA9PT0gc2VudGluZWwpIHsKCSAgICAgICAgICAgICAgICBlbGVtZW50ID0gbGVhdmVsaXN0LnBvcCgpOwoKCSAgICAgICAgICAgICAgICByZXQgPSB0aGlzLl9fZXhlY3V0ZSh2aXNpdG9yLmxlYXZlLCBlbGVtZW50KTsKCgkgICAgICAgICAgICAgICAgaWYgKHRoaXMuX19zdGF0ZSA9PT0gQlJFQUsgfHwgcmV0ID09PSBCUkVBSykgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm47CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIGlmIChlbGVtZW50Lm5vZGUpIHsKCgkgICAgICAgICAgICAgICAgcmV0ID0gdGhpcy5fX2V4ZWN1dGUodmlzaXRvci5lbnRlciwgZWxlbWVudCk7CgoJICAgICAgICAgICAgICAgIGlmICh0aGlzLl9fc3RhdGUgPT09IEJSRUFLIHx8IHJldCA9PT0gQlJFQUspIHsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgd29ya2xpc3QucHVzaChzZW50aW5lbCk7CgkgICAgICAgICAgICAgICAgbGVhdmVsaXN0LnB1c2goZWxlbWVudCk7CgoJICAgICAgICAgICAgICAgIGlmICh0aGlzLl9fc3RhdGUgPT09IFNLSVAgfHwgcmV0ID09PSBTS0lQKSB7CgkgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgbm9kZSA9IGVsZW1lbnQubm9kZTsKCSAgICAgICAgICAgICAgICBub2RlVHlwZSA9IG5vZGUudHlwZSB8fCBlbGVtZW50LndyYXA7CgkgICAgICAgICAgICAgICAgY2FuZGlkYXRlcyA9IHRoaXMuX19rZXlzW25vZGVUeXBlXTsKCSAgICAgICAgICAgICAgICBpZiAoIWNhbmRpZGF0ZXMpIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX19mYWxsYmFjaykgewoJICAgICAgICAgICAgICAgICAgICAgICAgY2FuZGlkYXRlcyA9IHRoaXMuX19mYWxsYmFjayhub2RlKTsKCSAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5rbm93biBub2RlIHR5cGUgJyArIG5vZGVUeXBlICsgJy4nKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgY3VycmVudCA9IGNhbmRpZGF0ZXMubGVuZ3RoOwoJICAgICAgICAgICAgICAgIHdoaWxlICgoY3VycmVudCAtPSAxKSA+PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgIGtleSA9IGNhbmRpZGF0ZXNbY3VycmVudF07CgkgICAgICAgICAgICAgICAgICAgIGNhbmRpZGF0ZSA9IG5vZGVba2V5XTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCFjYW5kaWRhdGUpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoJICAgICAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjYW5kaWRhdGUpKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50MiA9IGNhbmRpZGF0ZS5sZW5ndGg7CgkgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoKGN1cnJlbnQyIC09IDEpID49IDApIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNhbmRpZGF0ZVtjdXJyZW50Ml0pIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FuZGlkYXRlRXhpc3RzSW5MZWF2ZUxpc3QobGVhdmVsaXN0LCBjYW5kaWRhdGVbY3VycmVudDJdKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNQcm9wZXJ0eShub2RlVHlwZSwgY2FuZGlkYXRlc1tjdXJyZW50XSkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudCA9IG5ldyBFbGVtZW50KGNhbmRpZGF0ZVtjdXJyZW50Ml0sIFtrZXksIGN1cnJlbnQyXSwgJ1Byb3BlcnR5JywgbnVsbCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc05vZGUoY2FuZGlkYXRlW2N1cnJlbnQyXSkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudCA9IG5ldyBFbGVtZW50KGNhbmRpZGF0ZVtjdXJyZW50Ml0sIFtrZXksIGN1cnJlbnQyXSwgbnVsbCwgbnVsbCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtsaXN0LnB1c2goZWxlbWVudCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNOb2RlKGNhbmRpZGF0ZSkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYW5kaWRhdGVFeGlzdHNJbkxlYXZlTGlzdChsZWF2ZWxpc3QsIGNhbmRpZGF0ZSkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgICAgICAgICAgd29ya2xpc3QucHVzaChuZXcgRWxlbWVudChjYW5kaWRhdGUsIGtleSwgbnVsbCwgbnVsbCkpOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCgkgICAgQ29udHJvbGxlci5wcm90b3R5cGUucmVwbGFjZSA9IGZ1bmN0aW9uIHJlcGxhY2Uocm9vdCwgdmlzaXRvcikgewoJICAgICAgICB2YXIgd29ya2xpc3QsCgkgICAgICAgICAgICBsZWF2ZWxpc3QsCgkgICAgICAgICAgICBub2RlLAoJICAgICAgICAgICAgbm9kZVR5cGUsCgkgICAgICAgICAgICB0YXJnZXQsCgkgICAgICAgICAgICBlbGVtZW50LAoJICAgICAgICAgICAgY3VycmVudCwKCSAgICAgICAgICAgIGN1cnJlbnQyLAoJICAgICAgICAgICAgY2FuZGlkYXRlcywKCSAgICAgICAgICAgIGNhbmRpZGF0ZSwKCSAgICAgICAgICAgIHNlbnRpbmVsLAoJICAgICAgICAgICAgb3V0ZXIsCgkgICAgICAgICAgICBrZXk7CgoJICAgICAgICBmdW5jdGlvbiByZW1vdmVFbGVtKGVsZW1lbnQpIHsKCSAgICAgICAgICAgIHZhciBpLAoJICAgICAgICAgICAgICAgIGtleSwKCSAgICAgICAgICAgICAgICBuZXh0RWxlbSwKCSAgICAgICAgICAgICAgICBwYXJlbnQ7CgoJICAgICAgICAgICAgaWYgKGVsZW1lbnQucmVmLnJlbW92ZSgpKSB7CgkgICAgICAgICAgICAgICAgLy8gV2hlbiB0aGUgcmVmZXJlbmNlIGlzIGFuIGVsZW1lbnQgb2YgYW4gYXJyYXkuCgkgICAgICAgICAgICAgICAga2V5ID0gZWxlbWVudC5yZWYua2V5OwoJICAgICAgICAgICAgICAgIHBhcmVudCA9IGVsZW1lbnQucmVmLnBhcmVudDsKCgkgICAgICAgICAgICAgICAgLy8gSWYgcmVtb3ZlZCBmcm9tIGFycmF5LCB0aGVuIGRlY3JlYXNlIGZvbGxvd2luZyBpdGVtcycga2V5cy4KCSAgICAgICAgICAgICAgICBpID0gd29ya2xpc3QubGVuZ3RoOwoJICAgICAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKCSAgICAgICAgICAgICAgICAgICAgbmV4dEVsZW0gPSB3b3JrbGlzdFtpXTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKG5leHRFbGVtLnJlZiAmJiBuZXh0RWxlbS5yZWYucGFyZW50ID09PSBwYXJlbnQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmICAobmV4dEVsZW0ucmVmLmtleSA8IGtleSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgLS1uZXh0RWxlbS5yZWYua2V5OwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgoJICAgICAgICB0aGlzLl9faW5pdGlhbGl6ZShyb290LCB2aXNpdG9yKTsKCgkgICAgICAgIHNlbnRpbmVsID0ge307CgoJICAgICAgICAvLyByZWZlcmVuY2UKCSAgICAgICAgd29ya2xpc3QgPSB0aGlzLl9fd29ya2xpc3Q7CgkgICAgICAgIGxlYXZlbGlzdCA9IHRoaXMuX19sZWF2ZWxpc3Q7CgoJICAgICAgICAvLyBpbml0aWFsaXplCgkgICAgICAgIG91dGVyID0gewoJICAgICAgICAgICAgcm9vdDogcm9vdAoJICAgICAgICB9OwoJICAgICAgICBlbGVtZW50ID0gbmV3IEVsZW1lbnQocm9vdCwgbnVsbCwgbnVsbCwgbmV3IFJlZmVyZW5jZShvdXRlciwgJ3Jvb3QnKSk7CgkgICAgICAgIHdvcmtsaXN0LnB1c2goZWxlbWVudCk7CgkgICAgICAgIGxlYXZlbGlzdC5wdXNoKGVsZW1lbnQpOwoKCSAgICAgICAgd2hpbGUgKHdvcmtsaXN0Lmxlbmd0aCkgewoJICAgICAgICAgICAgZWxlbWVudCA9IHdvcmtsaXN0LnBvcCgpOwoKCSAgICAgICAgICAgIGlmIChlbGVtZW50ID09PSBzZW50aW5lbCkgewoJICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBsZWF2ZWxpc3QucG9wKCk7CgoJICAgICAgICAgICAgICAgIHRhcmdldCA9IHRoaXMuX19leGVjdXRlKHZpc2l0b3IubGVhdmUsIGVsZW1lbnQpOwoKCSAgICAgICAgICAgICAgICAvLyBub2RlIG1heSBiZSByZXBsYWNlZCB3aXRoIG51bGwsCgkgICAgICAgICAgICAgICAgLy8gc28gZGlzdGluZ3Vpc2ggYmV0d2VlbiB1bmRlZmluZWQgYW5kIG51bGwgaW4gdGhpcyBwbGFjZQoJICAgICAgICAgICAgICAgIGlmICh0YXJnZXQgIT09IHVuZGVmaW5lZCAmJiB0YXJnZXQgIT09IEJSRUFLICYmIHRhcmdldCAhPT0gU0tJUCAmJiB0YXJnZXQgIT09IFJFTU9WRSkgewoJICAgICAgICAgICAgICAgICAgICAvLyByZXBsYWNlCgkgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucmVmLnJlcGxhY2UodGFyZ2V0KTsKCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIGlmICh0aGlzLl9fc3RhdGUgPT09IFJFTU9WRSB8fCB0YXJnZXQgPT09IFJFTU9WRSkgewoJICAgICAgICAgICAgICAgICAgICByZW1vdmVFbGVtKGVsZW1lbnQpOwoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgaWYgKHRoaXMuX19zdGF0ZSA9PT0gQlJFQUsgfHwgdGFyZ2V0ID09PSBCUkVBSykgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3V0ZXIucm9vdDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgdGFyZ2V0ID0gdGhpcy5fX2V4ZWN1dGUodmlzaXRvci5lbnRlciwgZWxlbWVudCk7CgoJICAgICAgICAgICAgLy8gbm9kZSBtYXkgYmUgcmVwbGFjZWQgd2l0aCBudWxsLAoJICAgICAgICAgICAgLy8gc28gZGlzdGluZ3Vpc2ggYmV0d2VlbiB1bmRlZmluZWQgYW5kIG51bGwgaW4gdGhpcyBwbGFjZQoJICAgICAgICAgICAgaWYgKHRhcmdldCAhPT0gdW5kZWZpbmVkICYmIHRhcmdldCAhPT0gQlJFQUsgJiYgdGFyZ2V0ICE9PSBTS0lQICYmIHRhcmdldCAhPT0gUkVNT1ZFKSB7CgkgICAgICAgICAgICAgICAgLy8gcmVwbGFjZQoJICAgICAgICAgICAgICAgIGVsZW1lbnQucmVmLnJlcGxhY2UodGFyZ2V0KTsKCSAgICAgICAgICAgICAgICBlbGVtZW50Lm5vZGUgPSB0YXJnZXQ7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgaWYgKHRoaXMuX19zdGF0ZSA9PT0gUkVNT1ZFIHx8IHRhcmdldCA9PT0gUkVNT1ZFKSB7CgkgICAgICAgICAgICAgICAgcmVtb3ZlRWxlbShlbGVtZW50KTsKCSAgICAgICAgICAgICAgICBlbGVtZW50Lm5vZGUgPSBudWxsOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIGlmICh0aGlzLl9fc3RhdGUgPT09IEJSRUFLIHx8IHRhcmdldCA9PT0gQlJFQUspIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gb3V0ZXIucm9vdDsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAvLyBub2RlIG1heSBiZSBudWxsCgkgICAgICAgICAgICBub2RlID0gZWxlbWVudC5ub2RlOwoJICAgICAgICAgICAgaWYgKCFub2RlKSB7CgkgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgd29ya2xpc3QucHVzaChzZW50aW5lbCk7CgkgICAgICAgICAgICBsZWF2ZWxpc3QucHVzaChlbGVtZW50KTsKCgkgICAgICAgICAgICBpZiAodGhpcy5fX3N0YXRlID09PSBTS0lQIHx8IHRhcmdldCA9PT0gU0tJUCkgewoJICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIG5vZGVUeXBlID0gbm9kZS50eXBlIHx8IGVsZW1lbnQud3JhcDsKCSAgICAgICAgICAgIGNhbmRpZGF0ZXMgPSB0aGlzLl9fa2V5c1tub2RlVHlwZV07CgkgICAgICAgICAgICBpZiAoIWNhbmRpZGF0ZXMpIHsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5fX2ZhbGxiYWNrKSB7CgkgICAgICAgICAgICAgICAgICAgIGNhbmRpZGF0ZXMgPSB0aGlzLl9fZmFsbGJhY2sobm9kZSk7CgkgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIG5vZGUgdHlwZSAnICsgbm9kZVR5cGUgKyAnLicpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICBjdXJyZW50ID0gY2FuZGlkYXRlcy5sZW5ndGg7CgkgICAgICAgICAgICB3aGlsZSAoKGN1cnJlbnQgLT0gMSkgPj0gMCkgewoJICAgICAgICAgICAgICAgIGtleSA9IGNhbmRpZGF0ZXNbY3VycmVudF07CgkgICAgICAgICAgICAgICAgY2FuZGlkYXRlID0gbm9kZVtrZXldOwoJICAgICAgICAgICAgICAgIGlmICghY2FuZGlkYXRlKSB7CgkgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY2FuZGlkYXRlKSkgewoJICAgICAgICAgICAgICAgICAgICBjdXJyZW50MiA9IGNhbmRpZGF0ZS5sZW5ndGg7CgkgICAgICAgICAgICAgICAgICAgIHdoaWxlICgoY3VycmVudDIgLT0gMSkgPj0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjYW5kaWRhdGVbY3VycmVudDJdKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNQcm9wZXJ0eShub2RlVHlwZSwgY2FuZGlkYXRlc1tjdXJyZW50XSkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50ID0gbmV3IEVsZW1lbnQoY2FuZGlkYXRlW2N1cnJlbnQyXSwgW2tleSwgY3VycmVudDJdLCAnUHJvcGVydHknLCBuZXcgUmVmZXJlbmNlKGNhbmRpZGF0ZSwgY3VycmVudDIpKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNOb2RlKGNhbmRpZGF0ZVtjdXJyZW50Ml0pKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudCA9IG5ldyBFbGVtZW50KGNhbmRpZGF0ZVtjdXJyZW50Ml0sIFtrZXksIGN1cnJlbnQyXSwgbnVsbCwgbmV3IFJlZmVyZW5jZShjYW5kaWRhdGUsIGN1cnJlbnQyKSk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgd29ya2xpc3QucHVzaChlbGVtZW50KTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNOb2RlKGNhbmRpZGF0ZSkpIHsKCSAgICAgICAgICAgICAgICAgICAgd29ya2xpc3QucHVzaChuZXcgRWxlbWVudChjYW5kaWRhdGUsIGtleSwgbnVsbCwgbmV3IFJlZmVyZW5jZShub2RlLCBrZXkpKSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgoJICAgICAgICByZXR1cm4gb3V0ZXIucm9vdDsKCSAgICB9OwoKCSAgICBmdW5jdGlvbiB0cmF2ZXJzZShyb290LCB2aXNpdG9yKSB7CgkgICAgICAgIHZhciBjb250cm9sbGVyID0gbmV3IENvbnRyb2xsZXIoKTsKCSAgICAgICAgcmV0dXJuIGNvbnRyb2xsZXIudHJhdmVyc2Uocm9vdCwgdmlzaXRvcik7CgkgICAgfQoKCSAgICBmdW5jdGlvbiByZXBsYWNlKHJvb3QsIHZpc2l0b3IpIHsKCSAgICAgICAgdmFyIGNvbnRyb2xsZXIgPSBuZXcgQ29udHJvbGxlcigpOwoJICAgICAgICByZXR1cm4gY29udHJvbGxlci5yZXBsYWNlKHJvb3QsIHZpc2l0b3IpOwoJICAgIH0KCgkgICAgZnVuY3Rpb24gZXh0ZW5kQ29tbWVudFJhbmdlKGNvbW1lbnQsIHRva2VucykgewoJICAgICAgICB2YXIgdGFyZ2V0OwoKCSAgICAgICAgdGFyZ2V0ID0gdXBwZXJCb3VuZCh0b2tlbnMsIGZ1bmN0aW9uIHNlYXJjaCh0b2tlbikgewoJICAgICAgICAgICAgcmV0dXJuIHRva2VuLnJhbmdlWzBdID4gY29tbWVudC5yYW5nZVswXTsKCSAgICAgICAgfSk7CgoJICAgICAgICBjb21tZW50LmV4dGVuZGVkUmFuZ2UgPSBbY29tbWVudC5yYW5nZVswXSwgY29tbWVudC5yYW5nZVsxXV07CgoJICAgICAgICBpZiAodGFyZ2V0ICE9PSB0b2tlbnMubGVuZ3RoKSB7CgkgICAgICAgICAgICBjb21tZW50LmV4dGVuZGVkUmFuZ2VbMV0gPSB0b2tlbnNbdGFyZ2V0XS5yYW5nZVswXTsKCSAgICAgICAgfQoKCSAgICAgICAgdGFyZ2V0IC09IDE7CgkgICAgICAgIGlmICh0YXJnZXQgPj0gMCkgewoJICAgICAgICAgICAgY29tbWVudC5leHRlbmRlZFJhbmdlWzBdID0gdG9rZW5zW3RhcmdldF0ucmFuZ2VbMV07CgkgICAgICAgIH0KCgkgICAgICAgIHJldHVybiBjb21tZW50OwoJICAgIH0KCgkgICAgZnVuY3Rpb24gYXR0YWNoQ29tbWVudHModHJlZSwgcHJvdmlkZWRDb21tZW50cywgdG9rZW5zKSB7CgkgICAgICAgIC8vIEF0IGZpcnN0LCB3ZSBzaG91bGQgY2FsY3VsYXRlIGV4dGVuZGVkIGNvbW1lbnQgcmFuZ2VzLgoJICAgICAgICB2YXIgY29tbWVudHMgPSBbXSwgY29tbWVudCwgbGVuLCBpLCBjdXJzb3I7CgoJICAgICAgICBpZiAoIXRyZWUucmFuZ2UpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignYXR0YWNoQ29tbWVudHMgbmVlZHMgcmFuZ2UgaW5mb3JtYXRpb24nKTsKCSAgICAgICAgfQoKCSAgICAgICAgLy8gdG9rZW5zIGFycmF5IGlzIGVtcHR5LCB3ZSBhdHRhY2ggY29tbWVudHMgdG8gdHJlZSBhcyAnbGVhZGluZ0NvbW1lbnRzJwoJICAgICAgICBpZiAoIXRva2Vucy5sZW5ndGgpIHsKCSAgICAgICAgICAgIGlmIChwcm92aWRlZENvbW1lbnRzLmxlbmd0aCkgewoJICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IHByb3ZpZGVkQ29tbWVudHMubGVuZ3RoOyBpIDwgbGVuOyBpICs9IDEpIHsKCSAgICAgICAgICAgICAgICAgICAgY29tbWVudCA9IGRlZXBDb3B5KHByb3ZpZGVkQ29tbWVudHNbaV0pOwoJICAgICAgICAgICAgICAgICAgICBjb21tZW50LmV4dGVuZGVkUmFuZ2UgPSBbMCwgdHJlZS5yYW5nZVswXV07CgkgICAgICAgICAgICAgICAgICAgIGNvbW1lbnRzLnB1c2goY29tbWVudCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHRyZWUubGVhZGluZ0NvbW1lbnRzID0gY29tbWVudHM7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gdHJlZTsKCSAgICAgICAgfQoKCSAgICAgICAgZm9yIChpID0gMCwgbGVuID0gcHJvdmlkZWRDb21tZW50cy5sZW5ndGg7IGkgPCBsZW47IGkgKz0gMSkgewoJICAgICAgICAgICAgY29tbWVudHMucHVzaChleHRlbmRDb21tZW50UmFuZ2UoZGVlcENvcHkocHJvdmlkZWRDb21tZW50c1tpXSksIHRva2VucykpOwoJICAgICAgICB9CgoJICAgICAgICAvLyBUaGlzIGlzIGJhc2VkIG9uIEpvaG4gRnJlZW1hbidzIGltcGxlbWVudGF0aW9uLgoJICAgICAgICBjdXJzb3IgPSAwOwoJICAgICAgICB0cmF2ZXJzZSh0cmVlLCB7CgkgICAgICAgICAgICBlbnRlcjogZnVuY3Rpb24gKG5vZGUpIHsKCSAgICAgICAgICAgICAgICB2YXIgY29tbWVudDsKCgkgICAgICAgICAgICAgICAgd2hpbGUgKGN1cnNvciA8IGNvbW1lbnRzLmxlbmd0aCkgewoJICAgICAgICAgICAgICAgICAgICBjb21tZW50ID0gY29tbWVudHNbY3Vyc29yXTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKGNvbW1lbnQuZXh0ZW5kZWRSYW5nZVsxXSA+IG5vZGUucmFuZ2VbMF0pIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgICAgICBpZiAoY29tbWVudC5leHRlbmRlZFJhbmdlWzFdID09PSBub2RlLnJhbmdlWzBdKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW5vZGUubGVhZGluZ0NvbW1lbnRzKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5sZWFkaW5nQ29tbWVudHMgPSBbXTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUubGVhZGluZ0NvbW1lbnRzLnB1c2goY29tbWVudCk7CgkgICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50cy5zcGxpY2UoY3Vyc29yLCAxKTsKCSAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnNvciArPSAxOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICAvLyBhbHJlYWR5IG91dCBvZiBvd25lZCBub2RlCgkgICAgICAgICAgICAgICAgaWYgKGN1cnNvciA9PT0gY29tbWVudHMubGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBWaXNpdG9yT3B0aW9uLkJyZWFrOwoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgaWYgKGNvbW1lbnRzW2N1cnNvcl0uZXh0ZW5kZWRSYW5nZVswXSA+IG5vZGUucmFuZ2VbMV0pIHsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFZpc2l0b3JPcHRpb24uU2tpcDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0pOwoKCSAgICAgICAgY3Vyc29yID0gMDsKCSAgICAgICAgdHJhdmVyc2UodHJlZSwgewoJICAgICAgICAgICAgbGVhdmU6IGZ1bmN0aW9uIChub2RlKSB7CgkgICAgICAgICAgICAgICAgdmFyIGNvbW1lbnQ7CgoJICAgICAgICAgICAgICAgIHdoaWxlIChjdXJzb3IgPCBjb21tZW50cy5sZW5ndGgpIHsKCSAgICAgICAgICAgICAgICAgICAgY29tbWVudCA9IGNvbW1lbnRzW2N1cnNvcl07CgkgICAgICAgICAgICAgICAgICAgIGlmIChub2RlLnJhbmdlWzFdIDwgY29tbWVudC5leHRlbmRlZFJhbmdlWzBdKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUucmFuZ2VbMV0gPT09IGNvbW1lbnQuZXh0ZW5kZWRSYW5nZVswXSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFub2RlLnRyYWlsaW5nQ29tbWVudHMpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLnRyYWlsaW5nQ29tbWVudHMgPSBbXTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUudHJhaWxpbmdDb21tZW50cy5wdXNoKGNvbW1lbnQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgY29tbWVudHMuc3BsaWNlKGN1cnNvciwgMSk7CgkgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3IgKz0gMTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgLy8gYWxyZWFkeSBvdXQgb2Ygb3duZWQgbm9kZQoJICAgICAgICAgICAgICAgIGlmIChjdXJzb3IgPT09IGNvbW1lbnRzLmxlbmd0aCkgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gVmlzaXRvck9wdGlvbi5CcmVhazsKCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIGlmIChjb21tZW50c1tjdXJzb3JdLmV4dGVuZGVkUmFuZ2VbMF0gPiBub2RlLnJhbmdlWzFdKSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBWaXNpdG9yT3B0aW9uLlNraXA7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9KTsKCgkgICAgICAgIHJldHVybiB0cmVlOwoJICAgIH0KCgkgICAgZXhwb3J0cy5TeW50YXggPSBTeW50YXg7CgkgICAgZXhwb3J0cy50cmF2ZXJzZSA9IHRyYXZlcnNlOwoJICAgIGV4cG9ydHMucmVwbGFjZSA9IHJlcGxhY2U7CgkgICAgZXhwb3J0cy5hdHRhY2hDb21tZW50cyA9IGF0dGFjaENvbW1lbnRzOwoJICAgIGV4cG9ydHMuVmlzaXRvcktleXMgPSBWaXNpdG9yS2V5czsKCSAgICBleHBvcnRzLlZpc2l0b3JPcHRpb24gPSBWaXNpdG9yT3B0aW9uOwoJICAgIGV4cG9ydHMuQ29udHJvbGxlciA9IENvbnRyb2xsZXI7CgkgICAgZXhwb3J0cy5jbG9uZUVudmlyb25tZW50ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gY2xvbmUoe30pOyB9OwoKCSAgICByZXR1cm4gZXhwb3J0czsKCX0oZXhwb3J0cykpOwoJLyogdmltOiBzZXQgc3c9NCB0cz00IGV0IHR3PTgwIDogKi8gCn0gKGVzdHJhdmVyc2UpKTsKCnZhciB1dGlscyA9IHt9OwoKdmFyIGFzdCA9IHtleHBvcnRzOiB7fX07CgovKgogIENvcHlyaWdodCAoQykgMjAxMyBZdXN1a2UgU3V6dWtpIDx1dGF0YW5lLnRlYUBnbWFpbC5jb20+CgogIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dAogIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OgoKICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQKICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLgogICAgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodAogICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlCiAgICAgIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uCgogIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgJ0FTIElTJwogIEFORCBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUKICBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRQogIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCA8Q09QWVJJR0hUIEhPTERFUj4gQkUgTElBQkxFIEZPUiBBTlkKICBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUwogIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsKICBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQKICBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVAogIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRgogIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCiovCgooZnVuY3Rpb24gKCkgewoKICAgIGZ1bmN0aW9uIGlzRXhwcmVzc2lvbihub2RlKSB7CiAgICAgICAgaWYgKG5vZGUgPT0gbnVsbCkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBzd2l0Y2ggKG5vZGUudHlwZSkgewogICAgICAgICAgICBjYXNlICdBcnJheUV4cHJlc3Npb24nOgogICAgICAgICAgICBjYXNlICdBc3NpZ25tZW50RXhwcmVzc2lvbic6CiAgICAgICAgICAgIGNhc2UgJ0JpbmFyeUV4cHJlc3Npb24nOgogICAgICAgICAgICBjYXNlICdDYWxsRXhwcmVzc2lvbic6CiAgICAgICAgICAgIGNhc2UgJ0NvbmRpdGlvbmFsRXhwcmVzc2lvbic6CiAgICAgICAgICAgIGNhc2UgJ0Z1bmN0aW9uRXhwcmVzc2lvbic6CiAgICAgICAgICAgIGNhc2UgJ0lkZW50aWZpZXInOgogICAgICAgICAgICBjYXNlICdMaXRlcmFsJzoKICAgICAgICAgICAgY2FzZSAnTG9naWNhbEV4cHJlc3Npb24nOgogICAgICAgICAgICBjYXNlICdNZW1iZXJFeHByZXNzaW9uJzoKICAgICAgICAgICAgY2FzZSAnTmV3RXhwcmVzc2lvbic6CiAgICAgICAgICAgIGNhc2UgJ09iamVjdEV4cHJlc3Npb24nOgogICAgICAgICAgICBjYXNlICdTZXF1ZW5jZUV4cHJlc3Npb24nOgogICAgICAgICAgICBjYXNlICdUaGlzRXhwcmVzc2lvbic6CiAgICAgICAgICAgIGNhc2UgJ1VuYXJ5RXhwcmVzc2lvbic6CiAgICAgICAgICAgIGNhc2UgJ1VwZGF0ZUV4cHJlc3Npb24nOgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0l0ZXJhdGlvblN0YXRlbWVudChub2RlKSB7CiAgICAgICAgaWYgKG5vZGUgPT0gbnVsbCkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBzd2l0Y2ggKG5vZGUudHlwZSkgewogICAgICAgICAgICBjYXNlICdEb1doaWxlU3RhdGVtZW50JzoKICAgICAgICAgICAgY2FzZSAnRm9ySW5TdGF0ZW1lbnQnOgogICAgICAgICAgICBjYXNlICdGb3JTdGF0ZW1lbnQnOgogICAgICAgICAgICBjYXNlICdXaGlsZVN0YXRlbWVudCc6CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzU3RhdGVtZW50KG5vZGUpIHsKICAgICAgICBpZiAobm9kZSA9PSBudWxsKSB7IHJldHVybiBmYWxzZTsgfQogICAgICAgIHN3aXRjaCAobm9kZS50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgJ0Jsb2NrU3RhdGVtZW50JzoKICAgICAgICAgICAgY2FzZSAnQnJlYWtTdGF0ZW1lbnQnOgogICAgICAgICAgICBjYXNlICdDb250aW51ZVN0YXRlbWVudCc6CiAgICAgICAgICAgIGNhc2UgJ0RlYnVnZ2VyU3RhdGVtZW50JzoKICAgICAgICAgICAgY2FzZSAnRG9XaGlsZVN0YXRlbWVudCc6CiAgICAgICAgICAgIGNhc2UgJ0VtcHR5U3RhdGVtZW50JzoKICAgICAgICAgICAgY2FzZSAnRXhwcmVzc2lvblN0YXRlbWVudCc6CiAgICAgICAgICAgIGNhc2UgJ0ZvckluU3RhdGVtZW50JzoKICAgICAgICAgICAgY2FzZSAnRm9yU3RhdGVtZW50JzoKICAgICAgICAgICAgY2FzZSAnSWZTdGF0ZW1lbnQnOgogICAgICAgICAgICBjYXNlICdMYWJlbGVkU3RhdGVtZW50JzoKICAgICAgICAgICAgY2FzZSAnUmV0dXJuU3RhdGVtZW50JzoKICAgICAgICAgICAgY2FzZSAnU3dpdGNoU3RhdGVtZW50JzoKICAgICAgICAgICAgY2FzZSAnVGhyb3dTdGF0ZW1lbnQnOgogICAgICAgICAgICBjYXNlICdUcnlTdGF0ZW1lbnQnOgogICAgICAgICAgICBjYXNlICdWYXJpYWJsZURlY2xhcmF0aW9uJzoKICAgICAgICAgICAgY2FzZSAnV2hpbGVTdGF0ZW1lbnQnOgogICAgICAgICAgICBjYXNlICdXaXRoU3RhdGVtZW50JzoKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gaXNTb3VyY2VFbGVtZW50KG5vZGUpIHsKICAgICAgcmV0dXJuIGlzU3RhdGVtZW50KG5vZGUpIHx8IG5vZGUgIT0gbnVsbCAmJiBub2RlLnR5cGUgPT09ICdGdW5jdGlvbkRlY2xhcmF0aW9uJzsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFpbGluZ1N0YXRlbWVudChub2RlKSB7CiAgICAgICAgc3dpdGNoIChub2RlLnR5cGUpIHsKICAgICAgICBjYXNlICdJZlN0YXRlbWVudCc6CiAgICAgICAgICAgIGlmIChub2RlLmFsdGVybmF0ZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbm9kZS5hbHRlcm5hdGU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5vZGUuY29uc2VxdWVudDsKCiAgICAgICAgY2FzZSAnTGFiZWxlZFN0YXRlbWVudCc6CiAgICAgICAgY2FzZSAnRm9yU3RhdGVtZW50JzoKICAgICAgICBjYXNlICdGb3JJblN0YXRlbWVudCc6CiAgICAgICAgY2FzZSAnV2hpbGVTdGF0ZW1lbnQnOgogICAgICAgIGNhc2UgJ1dpdGhTdGF0ZW1lbnQnOgogICAgICAgICAgICByZXR1cm4gbm9kZS5ib2R5OwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBmdW5jdGlvbiBpc1Byb2JsZW1hdGljSWZTdGF0ZW1lbnQobm9kZSkgewogICAgICAgIHZhciBjdXJyZW50OwoKICAgICAgICBpZiAobm9kZS50eXBlICE9PSAnSWZTdGF0ZW1lbnQnKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKG5vZGUuYWx0ZXJuYXRlID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBjdXJyZW50ID0gbm9kZS5jb25zZXF1ZW50OwogICAgICAgIGRvIHsKICAgICAgICAgICAgaWYgKGN1cnJlbnQudHlwZSA9PT0gJ0lmU3RhdGVtZW50JykgewogICAgICAgICAgICAgICAgaWYgKGN1cnJlbnQuYWx0ZXJuYXRlID09IG51bGwpICB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY3VycmVudCA9IHRyYWlsaW5nU3RhdGVtZW50KGN1cnJlbnQpOwogICAgICAgIH0gd2hpbGUgKGN1cnJlbnQpOwoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgYXN0LmV4cG9ydHMgPSB7CiAgICAgICAgaXNFeHByZXNzaW9uOiBpc0V4cHJlc3Npb24sCiAgICAgICAgaXNTdGF0ZW1lbnQ6IGlzU3RhdGVtZW50LAogICAgICAgIGlzSXRlcmF0aW9uU3RhdGVtZW50OiBpc0l0ZXJhdGlvblN0YXRlbWVudCwKICAgICAgICBpc1NvdXJjZUVsZW1lbnQ6IGlzU291cmNlRWxlbWVudCwKICAgICAgICBpc1Byb2JsZW1hdGljSWZTdGF0ZW1lbnQ6IGlzUHJvYmxlbWF0aWNJZlN0YXRlbWVudCwKCiAgICAgICAgdHJhaWxpbmdTdGF0ZW1lbnQ6IHRyYWlsaW5nU3RhdGVtZW50CiAgICB9Owp9KCkpOwovKiB2aW06IHNldCBzdz00IHRzPTQgZXQgdHc9ODAgOiAqLwoKdmFyIGFzdEV4cG9ydHMgPSBhc3QuZXhwb3J0czsKCnZhciBjb2RlJDEgPSB7ZXhwb3J0czoge319OwoKLyoKICBDb3B5cmlnaHQgKEMpIDIwMTMtMjAxNCBZdXN1a2UgU3V6dWtpIDx1dGF0YW5lLnRlYUBnbWFpbC5jb20+CiAgQ29weXJpZ2h0IChDKSAyMDE0IEl2YW4gTmlrdWxpbiA8aWZhYWFuQGdtYWlsLmNvbT4KCiAgUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0CiAgbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6CgogICAgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodAogICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuCiAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0CiAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUKICAgICAgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4KCiAgVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyAiQVMgSVMiCiAgQU5EIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRQogIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFCiAgQVJFIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIDxDT1BZUklHSFQgSE9MREVSPiBCRSBMSUFCTEUgRk9SIEFOWQogIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTCiAgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOwogIExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORAogIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUCiAgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GCiAgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4KKi8KCihmdW5jdGlvbiAoKSB7CgogICAgdmFyIEVTNlJlZ2V4LCBFUzVSZWdleCwgTk9OX0FTQ0lJX1dISVRFU1BBQ0VTLCBJREVOVElGSUVSX1NUQVJULCBJREVOVElGSUVSX1BBUlQsIGNoOwoKICAgIC8vIFNlZSBgdG9vbHMvZ2VuZXJhdGUtaWRlbnRpZmllci1yZWdleC5qc2AuCiAgICBFUzVSZWdleCA9IHsKICAgICAgICAvLyBFQ01BU2NyaXB0IDUuMS9Vbmljb2RlIHY5LjAuMCBOb25Bc2NpaUlkZW50aWZpZXJTdGFydDoKICAgICAgICBOb25Bc2NpaUlkZW50aWZpZXJTdGFydDogL1tceEFBXHhCNVx4QkFceEMwLVx4RDZceEQ4LVx4RjZceEY4LVx1MDJDMVx1MDJDNi1cdTAyRDFcdTAyRTAtXHUwMkU0XHUwMkVDXHUwMkVFXHUwMzcwLVx1MDM3NFx1MDM3Nlx1MDM3N1x1MDM3QS1cdTAzN0RcdTAzN0ZcdTAzODZcdTAzODgtXHUwMzhBXHUwMzhDXHUwMzhFLVx1MDNBMVx1MDNBMy1cdTAzRjVcdTAzRjctXHUwNDgxXHUwNDhBLVx1MDUyRlx1MDUzMS1cdTA1NTZcdTA1NTlcdTA1NjEtXHUwNTg3XHUwNUQwLVx1MDVFQVx1MDVGMC1cdTA1RjJcdTA2MjAtXHUwNjRBXHUwNjZFXHUwNjZGXHUwNjcxLVx1MDZEM1x1MDZENVx1MDZFNVx1MDZFNlx1MDZFRVx1MDZFRlx1MDZGQS1cdTA2RkNcdTA2RkZcdTA3MTBcdTA3MTItXHUwNzJGXHUwNzRELVx1MDdBNVx1MDdCMVx1MDdDQS1cdTA3RUFcdTA3RjRcdTA3RjVcdTA3RkFcdTA4MDAtXHUwODE1XHUwODFBXHUwODI0XHUwODI4XHUwODQwLVx1MDg1OFx1MDhBMC1cdTA4QjRcdTA4QjYtXHUwOEJEXHUwOTA0LVx1MDkzOVx1MDkzRFx1MDk1MFx1MDk1OC1cdTA5NjFcdTA5NzEtXHUwOTgwXHUwOTg1LVx1MDk4Q1x1MDk4Rlx1MDk5MFx1MDk5My1cdTA5QThcdTA5QUEtXHUwOUIwXHUwOUIyXHUwOUI2LVx1MDlCOVx1MDlCRFx1MDlDRVx1MDlEQ1x1MDlERFx1MDlERi1cdTA5RTFcdTA5RjBcdTA5RjFcdTBBMDUtXHUwQTBBXHUwQTBGXHUwQTEwXHUwQTEzLVx1MEEyOFx1MEEyQS1cdTBBMzBcdTBBMzJcdTBBMzNcdTBBMzVcdTBBMzZcdTBBMzhcdTBBMzlcdTBBNTktXHUwQTVDXHUwQTVFXHUwQTcyLVx1MEE3NFx1MEE4NS1cdTBBOERcdTBBOEYtXHUwQTkxXHUwQTkzLVx1MEFBOFx1MEFBQS1cdTBBQjBcdTBBQjJcdTBBQjNcdTBBQjUtXHUwQUI5XHUwQUJEXHUwQUQwXHUwQUUwXHUwQUUxXHUwQUY5XHUwQjA1LVx1MEIwQ1x1MEIwRlx1MEIxMFx1MEIxMy1cdTBCMjhcdTBCMkEtXHUwQjMwXHUwQjMyXHUwQjMzXHUwQjM1LVx1MEIzOVx1MEIzRFx1MEI1Q1x1MEI1RFx1MEI1Ri1cdTBCNjFcdTBCNzFcdTBCODNcdTBCODUtXHUwQjhBXHUwQjhFLVx1MEI5MFx1MEI5Mi1cdTBCOTVcdTBCOTlcdTBCOUFcdTBCOUNcdTBCOUVcdTBCOUZcdTBCQTNcdTBCQTRcdTBCQTgtXHUwQkFBXHUwQkFFLVx1MEJCOVx1MEJEMFx1MEMwNS1cdTBDMENcdTBDMEUtXHUwQzEwXHUwQzEyLVx1MEMyOFx1MEMyQS1cdTBDMzlcdTBDM0RcdTBDNTgtXHUwQzVBXHUwQzYwXHUwQzYxXHUwQzgwXHUwQzg1LVx1MEM4Q1x1MEM4RS1cdTBDOTBcdTBDOTItXHUwQ0E4XHUwQ0FBLVx1MENCM1x1MENCNS1cdTBDQjlcdTBDQkRcdTBDREVcdTBDRTBcdTBDRTFcdTBDRjFcdTBDRjJcdTBEMDUtXHUwRDBDXHUwRDBFLVx1MEQxMFx1MEQxMi1cdTBEM0FcdTBEM0RcdTBENEVcdTBENTQtXHUwRDU2XHUwRDVGLVx1MEQ2MVx1MEQ3QS1cdTBEN0ZcdTBEODUtXHUwRDk2XHUwRDlBLVx1MERCMVx1MERCMy1cdTBEQkJcdTBEQkRcdTBEQzAtXHUwREM2XHUwRTAxLVx1MEUzMFx1MEUzMlx1MEUzM1x1MEU0MC1cdTBFNDZcdTBFODFcdTBFODJcdTBFODRcdTBFODdcdTBFODhcdTBFOEFcdTBFOERcdTBFOTQtXHUwRTk3XHUwRTk5LVx1MEU5Rlx1MEVBMS1cdTBFQTNcdTBFQTVcdTBFQTdcdTBFQUFcdTBFQUJcdTBFQUQtXHUwRUIwXHUwRUIyXHUwRUIzXHUwRUJEXHUwRUMwLVx1MEVDNFx1MEVDNlx1MEVEQy1cdTBFREZcdTBGMDBcdTBGNDAtXHUwRjQ3XHUwRjQ5LVx1MEY2Q1x1MEY4OC1cdTBGOENcdTEwMDAtXHUxMDJBXHUxMDNGXHUxMDUwLVx1MTA1NVx1MTA1QS1cdTEwNURcdTEwNjFcdTEwNjVcdTEwNjZcdTEwNkUtXHUxMDcwXHUxMDc1LVx1MTA4MVx1MTA4RVx1MTBBMC1cdTEwQzVcdTEwQzdcdTEwQ0RcdTEwRDAtXHUxMEZBXHUxMEZDLVx1MTI0OFx1MTI0QS1cdTEyNERcdTEyNTAtXHUxMjU2XHUxMjU4XHUxMjVBLVx1MTI1RFx1MTI2MC1cdTEyODhcdTEyOEEtXHUxMjhEXHUxMjkwLVx1MTJCMFx1MTJCMi1cdTEyQjVcdTEyQjgtXHUxMkJFXHUxMkMwXHUxMkMyLVx1MTJDNVx1MTJDOC1cdTEyRDZcdTEyRDgtXHUxMzEwXHUxMzEyLVx1MTMxNVx1MTMxOC1cdTEzNUFcdTEzODAtXHUxMzhGXHUxM0EwLVx1MTNGNVx1MTNGOC1cdTEzRkRcdTE0MDEtXHUxNjZDXHUxNjZGLVx1MTY3Rlx1MTY4MS1cdTE2OUFcdTE2QTAtXHUxNkVBXHUxNkVFLVx1MTZGOFx1MTcwMC1cdTE3MENcdTE3MEUtXHUxNzExXHUxNzIwLVx1MTczMVx1MTc0MC1cdTE3NTFcdTE3NjAtXHUxNzZDXHUxNzZFLVx1MTc3MFx1MTc4MC1cdTE3QjNcdTE3RDdcdTE3RENcdTE4MjAtXHUxODc3XHUxODgwLVx1MTg4NFx1MTg4Ny1cdTE4QThcdTE4QUFcdTE4QjAtXHUxOEY1XHUxOTAwLVx1MTkxRVx1MTk1MC1cdTE5NkRcdTE5NzAtXHUxOTc0XHUxOTgwLVx1MTlBQlx1MTlCMC1cdTE5QzlcdTFBMDAtXHUxQTE2XHUxQTIwLVx1MUE1NFx1MUFBN1x1MUIwNS1cdTFCMzNcdTFCNDUtXHUxQjRCXHUxQjgzLVx1MUJBMFx1MUJBRVx1MUJBRlx1MUJCQS1cdTFCRTVcdTFDMDAtXHUxQzIzXHUxQzRELVx1MUM0Rlx1MUM1QS1cdTFDN0RcdTFDODAtXHUxQzg4XHUxQ0U5LVx1MUNFQ1x1MUNFRS1cdTFDRjFcdTFDRjVcdTFDRjZcdTFEMDAtXHUxREJGXHUxRTAwLVx1MUYxNVx1MUYxOC1cdTFGMURcdTFGMjAtXHUxRjQ1XHUxRjQ4LVx1MUY0RFx1MUY1MC1cdTFGNTdcdTFGNTlcdTFGNUJcdTFGNURcdTFGNUYtXHUxRjdEXHUxRjgwLVx1MUZCNFx1MUZCNi1cdTFGQkNcdTFGQkVcdTFGQzItXHUxRkM0XHUxRkM2LVx1MUZDQ1x1MUZEMC1cdTFGRDNcdTFGRDYtXHUxRkRCXHUxRkUwLVx1MUZFQ1x1MUZGMi1cdTFGRjRcdTFGRjYtXHUxRkZDXHUyMDcxXHUyMDdGXHUyMDkwLVx1MjA5Q1x1MjEwMlx1MjEwN1x1MjEwQS1cdTIxMTNcdTIxMTVcdTIxMTktXHUyMTFEXHUyMTI0XHUyMTI2XHUyMTI4XHUyMTJBLVx1MjEyRFx1MjEyRi1cdTIxMzlcdTIxM0MtXHUyMTNGXHUyMTQ1LVx1MjE0OVx1MjE0RVx1MjE2MC1cdTIxODhcdTJDMDAtXHUyQzJFXHUyQzMwLVx1MkM1RVx1MkM2MC1cdTJDRTRcdTJDRUItXHUyQ0VFXHUyQ0YyXHUyQ0YzXHUyRDAwLVx1MkQyNVx1MkQyN1x1MkQyRFx1MkQzMC1cdTJENjdcdTJENkZcdTJEODAtXHUyRDk2XHUyREEwLVx1MkRBNlx1MkRBOC1cdTJEQUVcdTJEQjAtXHUyREI2XHUyREI4LVx1MkRCRVx1MkRDMC1cdTJEQzZcdTJEQzgtXHUyRENFXHUyREQwLVx1MkRENlx1MkREOC1cdTJEREVcdTJFMkZcdTMwMDUtXHUzMDA3XHUzMDIxLVx1MzAyOVx1MzAzMS1cdTMwMzVcdTMwMzgtXHUzMDNDXHUzMDQxLVx1MzA5Nlx1MzA5RC1cdTMwOUZcdTMwQTEtXHUzMEZBXHUzMEZDLVx1MzBGRlx1MzEwNS1cdTMxMkRcdTMxMzEtXHUzMThFXHUzMUEwLVx1MzFCQVx1MzFGMC1cdTMxRkZcdTM0MDAtXHU0REI1XHU0RTAwLVx1OUZENVx1QTAwMC1cdUE0OENcdUE0RDAtXHVBNEZEXHVBNTAwLVx1QTYwQ1x1QTYxMC1cdUE2MUZcdUE2MkFcdUE2MkJcdUE2NDAtXHVBNjZFXHVBNjdGLVx1QTY5RFx1QTZBMC1cdUE2RUZcdUE3MTctXHVBNzFGXHVBNzIyLVx1QTc4OFx1QTc4Qi1cdUE3QUVcdUE3QjAtXHVBN0I3XHVBN0Y3LVx1QTgwMVx1QTgwMy1cdUE4MDVcdUE4MDctXHVBODBBXHVBODBDLVx1QTgyMlx1QTg0MC1cdUE4NzNcdUE4ODItXHVBOEIzXHVBOEYyLVx1QThGN1x1QThGQlx1QThGRFx1QTkwQS1cdUE5MjVcdUE5MzAtXHVBOTQ2XHVBOTYwLVx1QTk3Q1x1QTk4NC1cdUE5QjJcdUE5Q0ZcdUE5RTAtXHVBOUU0XHVBOUU2LVx1QTlFRlx1QTlGQS1cdUE5RkVcdUFBMDAtXHVBQTI4XHVBQTQwLVx1QUE0Mlx1QUE0NC1cdUFBNEJcdUFBNjAtXHVBQTc2XHVBQTdBXHVBQTdFLVx1QUFBRlx1QUFCMVx1QUFCNVx1QUFCNlx1QUFCOS1cdUFBQkRcdUFBQzBcdUFBQzJcdUFBREItXHVBQUREXHVBQUUwLVx1QUFFQVx1QUFGMi1cdUFBRjRcdUFCMDEtXHVBQjA2XHVBQjA5LVx1QUIwRVx1QUIxMS1cdUFCMTZcdUFCMjAtXHVBQjI2XHVBQjI4LVx1QUIyRVx1QUIzMC1cdUFCNUFcdUFCNUMtXHVBQjY1XHVBQjcwLVx1QUJFMlx1QUMwMC1cdUQ3QTNcdUQ3QjAtXHVEN0M2XHVEN0NCLVx1RDdGQlx1RjkwMC1cdUZBNkRcdUZBNzAtXHVGQUQ5XHVGQjAwLVx1RkIwNlx1RkIxMy1cdUZCMTdcdUZCMURcdUZCMUYtXHVGQjI4XHVGQjJBLVx1RkIzNlx1RkIzOC1cdUZCM0NcdUZCM0VcdUZCNDBcdUZCNDFcdUZCNDNcdUZCNDRcdUZCNDYtXHVGQkIxXHVGQkQzLVx1RkQzRFx1RkQ1MC1cdUZEOEZcdUZEOTItXHVGREM3XHVGREYwLVx1RkRGQlx1RkU3MC1cdUZFNzRcdUZFNzYtXHVGRUZDXHVGRjIxLVx1RkYzQVx1RkY0MS1cdUZGNUFcdUZGNjYtXHVGRkJFXHVGRkMyLVx1RkZDN1x1RkZDQS1cdUZGQ0ZcdUZGRDItXHVGRkQ3XHVGRkRBLVx1RkZEQ10vLAogICAgICAgIC8vIEVDTUFTY3JpcHQgNS4xL1VuaWNvZGUgdjkuMC4wIE5vbkFzY2lpSWRlbnRpZmllclBhcnQ6CiAgICAgICAgTm9uQXNjaWlJZGVudGlmaWVyUGFydDogL1tceEFBXHhCNVx4QkFceEMwLVx4RDZceEQ4LVx4RjZceEY4LVx1MDJDMVx1MDJDNi1cdTAyRDFcdTAyRTAtXHUwMkU0XHUwMkVDXHUwMkVFXHUwMzAwLVx1MDM3NFx1MDM3Nlx1MDM3N1x1MDM3QS1cdTAzN0RcdTAzN0ZcdTAzODZcdTAzODgtXHUwMzhBXHUwMzhDXHUwMzhFLVx1MDNBMVx1MDNBMy1cdTAzRjVcdTAzRjctXHUwNDgxXHUwNDgzLVx1MDQ4N1x1MDQ4QS1cdTA1MkZcdTA1MzEtXHUwNTU2XHUwNTU5XHUwNTYxLVx1MDU4N1x1MDU5MS1cdTA1QkRcdTA1QkZcdTA1QzFcdTA1QzJcdTA1QzRcdTA1QzVcdTA1QzdcdTA1RDAtXHUwNUVBXHUwNUYwLVx1MDVGMlx1MDYxMC1cdTA2MUFcdTA2MjAtXHUwNjY5XHUwNjZFLVx1MDZEM1x1MDZENS1cdTA2RENcdTA2REYtXHUwNkU4XHUwNkVBLVx1MDZGQ1x1MDZGRlx1MDcxMC1cdTA3NEFcdTA3NEQtXHUwN0IxXHUwN0MwLVx1MDdGNVx1MDdGQVx1MDgwMC1cdTA4MkRcdTA4NDAtXHUwODVCXHUwOEEwLVx1MDhCNFx1MDhCNi1cdTA4QkRcdTA4RDQtXHUwOEUxXHUwOEUzLVx1MDk2M1x1MDk2Ni1cdTA5NkZcdTA5NzEtXHUwOTgzXHUwOTg1LVx1MDk4Q1x1MDk4Rlx1MDk5MFx1MDk5My1cdTA5QThcdTA5QUEtXHUwOUIwXHUwOUIyXHUwOUI2LVx1MDlCOVx1MDlCQy1cdTA5QzRcdTA5QzdcdTA5QzhcdTA5Q0ItXHUwOUNFXHUwOUQ3XHUwOURDXHUwOUREXHUwOURGLVx1MDlFM1x1MDlFNi1cdTA5RjFcdTBBMDEtXHUwQTAzXHUwQTA1LVx1MEEwQVx1MEEwRlx1MEExMFx1MEExMy1cdTBBMjhcdTBBMkEtXHUwQTMwXHUwQTMyXHUwQTMzXHUwQTM1XHUwQTM2XHUwQTM4XHUwQTM5XHUwQTNDXHUwQTNFLVx1MEE0Mlx1MEE0N1x1MEE0OFx1MEE0Qi1cdTBBNERcdTBBNTFcdTBBNTktXHUwQTVDXHUwQTVFXHUwQTY2LVx1MEE3NVx1MEE4MS1cdTBBODNcdTBBODUtXHUwQThEXHUwQThGLVx1MEE5MVx1MEE5My1cdTBBQThcdTBBQUEtXHUwQUIwXHUwQUIyXHUwQUIzXHUwQUI1LVx1MEFCOVx1MEFCQy1cdTBBQzVcdTBBQzctXHUwQUM5XHUwQUNCLVx1MEFDRFx1MEFEMFx1MEFFMC1cdTBBRTNcdTBBRTYtXHUwQUVGXHUwQUY5XHUwQjAxLVx1MEIwM1x1MEIwNS1cdTBCMENcdTBCMEZcdTBCMTBcdTBCMTMtXHUwQjI4XHUwQjJBLVx1MEIzMFx1MEIzMlx1MEIzM1x1MEIzNS1cdTBCMzlcdTBCM0MtXHUwQjQ0XHUwQjQ3XHUwQjQ4XHUwQjRCLVx1MEI0RFx1MEI1Nlx1MEI1N1x1MEI1Q1x1MEI1RFx1MEI1Ri1cdTBCNjNcdTBCNjYtXHUwQjZGXHUwQjcxXHUwQjgyXHUwQjgzXHUwQjg1LVx1MEI4QVx1MEI4RS1cdTBCOTBcdTBCOTItXHUwQjk1XHUwQjk5XHUwQjlBXHUwQjlDXHUwQjlFXHUwQjlGXHUwQkEzXHUwQkE0XHUwQkE4LVx1MEJBQVx1MEJBRS1cdTBCQjlcdTBCQkUtXHUwQkMyXHUwQkM2LVx1MEJDOFx1MEJDQS1cdTBCQ0RcdTBCRDBcdTBCRDdcdTBCRTYtXHUwQkVGXHUwQzAwLVx1MEMwM1x1MEMwNS1cdTBDMENcdTBDMEUtXHUwQzEwXHUwQzEyLVx1MEMyOFx1MEMyQS1cdTBDMzlcdTBDM0QtXHUwQzQ0XHUwQzQ2LVx1MEM0OFx1MEM0QS1cdTBDNERcdTBDNTVcdTBDNTZcdTBDNTgtXHUwQzVBXHUwQzYwLVx1MEM2M1x1MEM2Ni1cdTBDNkZcdTBDODAtXHUwQzgzXHUwQzg1LVx1MEM4Q1x1MEM4RS1cdTBDOTBcdTBDOTItXHUwQ0E4XHUwQ0FBLVx1MENCM1x1MENCNS1cdTBDQjlcdTBDQkMtXHUwQ0M0XHUwQ0M2LVx1MENDOFx1MENDQS1cdTBDQ0RcdTBDRDVcdTBDRDZcdTBDREVcdTBDRTAtXHUwQ0UzXHUwQ0U2LVx1MENFRlx1MENGMVx1MENGMlx1MEQwMS1cdTBEMDNcdTBEMDUtXHUwRDBDXHUwRDBFLVx1MEQxMFx1MEQxMi1cdTBEM0FcdTBEM0QtXHUwRDQ0XHUwRDQ2LVx1MEQ0OFx1MEQ0QS1cdTBENEVcdTBENTQtXHUwRDU3XHUwRDVGLVx1MEQ2M1x1MEQ2Ni1cdTBENkZcdTBEN0EtXHUwRDdGXHUwRDgyXHUwRDgzXHUwRDg1LVx1MEQ5Nlx1MEQ5QS1cdTBEQjFcdTBEQjMtXHUwREJCXHUwREJEXHUwREMwLVx1MERDNlx1MERDQVx1MERDRi1cdTBERDRcdTBERDZcdTBERDgtXHUwRERGXHUwREU2LVx1MERFRlx1MERGMlx1MERGM1x1MEUwMS1cdTBFM0FcdTBFNDAtXHUwRTRFXHUwRTUwLVx1MEU1OVx1MEU4MVx1MEU4Mlx1MEU4NFx1MEU4N1x1MEU4OFx1MEU4QVx1MEU4RFx1MEU5NC1cdTBFOTdcdTBFOTktXHUwRTlGXHUwRUExLVx1MEVBM1x1MEVBNVx1MEVBN1x1MEVBQVx1MEVBQlx1MEVBRC1cdTBFQjlcdTBFQkItXHUwRUJEXHUwRUMwLVx1MEVDNFx1MEVDNlx1MEVDOC1cdTBFQ0RcdTBFRDAtXHUwRUQ5XHUwRURDLVx1MEVERlx1MEYwMFx1MEYxOFx1MEYxOVx1MEYyMC1cdTBGMjlcdTBGMzVcdTBGMzdcdTBGMzlcdTBGM0UtXHUwRjQ3XHUwRjQ5LVx1MEY2Q1x1MEY3MS1cdTBGODRcdTBGODYtXHUwRjk3XHUwRjk5LVx1MEZCQ1x1MEZDNlx1MTAwMC1cdTEwNDlcdTEwNTAtXHUxMDlEXHUxMEEwLVx1MTBDNVx1MTBDN1x1MTBDRFx1MTBEMC1cdTEwRkFcdTEwRkMtXHUxMjQ4XHUxMjRBLVx1MTI0RFx1MTI1MC1cdTEyNTZcdTEyNThcdTEyNUEtXHUxMjVEXHUxMjYwLVx1MTI4OFx1MTI4QS1cdTEyOERcdTEyOTAtXHUxMkIwXHUxMkIyLVx1MTJCNVx1MTJCOC1cdTEyQkVcdTEyQzBcdTEyQzItXHUxMkM1XHUxMkM4LVx1MTJENlx1MTJEOC1cdTEzMTBcdTEzMTItXHUxMzE1XHUxMzE4LVx1MTM1QVx1MTM1RC1cdTEzNUZcdTEzODAtXHUxMzhGXHUxM0EwLVx1MTNGNVx1MTNGOC1cdTEzRkRcdTE0MDEtXHUxNjZDXHUxNjZGLVx1MTY3Rlx1MTY4MS1cdTE2OUFcdTE2QTAtXHUxNkVBXHUxNkVFLVx1MTZGOFx1MTcwMC1cdTE3MENcdTE3MEUtXHUxNzE0XHUxNzIwLVx1MTczNFx1MTc0MC1cdTE3NTNcdTE3NjAtXHUxNzZDXHUxNzZFLVx1MTc3MFx1MTc3Mlx1MTc3M1x1MTc4MC1cdTE3RDNcdTE3RDdcdTE3RENcdTE3RERcdTE3RTAtXHUxN0U5XHUxODBCLVx1MTgwRFx1MTgxMC1cdTE4MTlcdTE4MjAtXHUxODc3XHUxODgwLVx1MThBQVx1MThCMC1cdTE4RjVcdTE5MDAtXHUxOTFFXHUxOTIwLVx1MTkyQlx1MTkzMC1cdTE5M0JcdTE5NDYtXHUxOTZEXHUxOTcwLVx1MTk3NFx1MTk4MC1cdTE5QUJcdTE5QjAtXHUxOUM5XHUxOUQwLVx1MTlEOVx1MUEwMC1cdTFBMUJcdTFBMjAtXHUxQTVFXHUxQTYwLVx1MUE3Q1x1MUE3Ri1cdTFBODlcdTFBOTAtXHUxQTk5XHUxQUE3XHUxQUIwLVx1MUFCRFx1MUIwMC1cdTFCNEJcdTFCNTAtXHUxQjU5XHUxQjZCLVx1MUI3M1x1MUI4MC1cdTFCRjNcdTFDMDAtXHUxQzM3XHUxQzQwLVx1MUM0OVx1MUM0RC1cdTFDN0RcdTFDODAtXHUxQzg4XHUxQ0QwLVx1MUNEMlx1MUNENC1cdTFDRjZcdTFDRjhcdTFDRjlcdTFEMDAtXHUxREY1XHUxREZCLVx1MUYxNVx1MUYxOC1cdTFGMURcdTFGMjAtXHUxRjQ1XHUxRjQ4LVx1MUY0RFx1MUY1MC1cdTFGNTdcdTFGNTlcdTFGNUJcdTFGNURcdTFGNUYtXHUxRjdEXHUxRjgwLVx1MUZCNFx1MUZCNi1cdTFGQkNcdTFGQkVcdTFGQzItXHUxRkM0XHUxRkM2LVx1MUZDQ1x1MUZEMC1cdTFGRDNcdTFGRDYtXHUxRkRCXHUxRkUwLVx1MUZFQ1x1MUZGMi1cdTFGRjRcdTFGRjYtXHUxRkZDXHUyMDBDXHUyMDBEXHUyMDNGXHUyMDQwXHUyMDU0XHUyMDcxXHUyMDdGXHUyMDkwLVx1MjA5Q1x1MjBEMC1cdTIwRENcdTIwRTFcdTIwRTUtXHUyMEYwXHUyMTAyXHUyMTA3XHUyMTBBLVx1MjExM1x1MjExNVx1MjExOS1cdTIxMURcdTIxMjRcdTIxMjZcdTIxMjhcdTIxMkEtXHUyMTJEXHUyMTJGLVx1MjEzOVx1MjEzQy1cdTIxM0ZcdTIxNDUtXHUyMTQ5XHUyMTRFXHUyMTYwLVx1MjE4OFx1MkMwMC1cdTJDMkVcdTJDMzAtXHUyQzVFXHUyQzYwLVx1MkNFNFx1MkNFQi1cdTJDRjNcdTJEMDAtXHUyRDI1XHUyRDI3XHUyRDJEXHUyRDMwLVx1MkQ2N1x1MkQ2Rlx1MkQ3Ri1cdTJEOTZcdTJEQTAtXHUyREE2XHUyREE4LVx1MkRBRVx1MkRCMC1cdTJEQjZcdTJEQjgtXHUyREJFXHUyREMwLVx1MkRDNlx1MkRDOC1cdTJEQ0VcdTJERDAtXHUyREQ2XHUyREQ4LVx1MkRERVx1MkRFMC1cdTJERkZcdTJFMkZcdTMwMDUtXHUzMDA3XHUzMDIxLVx1MzAyRlx1MzAzMS1cdTMwMzVcdTMwMzgtXHUzMDNDXHUzMDQxLVx1MzA5Nlx1MzA5OVx1MzA5QVx1MzA5RC1cdTMwOUZcdTMwQTEtXHUzMEZBXHUzMEZDLVx1MzBGRlx1MzEwNS1cdTMxMkRcdTMxMzEtXHUzMThFXHUzMUEwLVx1MzFCQVx1MzFGMC1cdTMxRkZcdTM0MDAtXHU0REI1XHU0RTAwLVx1OUZENVx1QTAwMC1cdUE0OENcdUE0RDAtXHVBNEZEXHVBNTAwLVx1QTYwQ1x1QTYxMC1cdUE2MkJcdUE2NDAtXHVBNjZGXHVBNjc0LVx1QTY3RFx1QTY3Ri1cdUE2RjFcdUE3MTctXHVBNzFGXHVBNzIyLVx1QTc4OFx1QTc4Qi1cdUE3QUVcdUE3QjAtXHVBN0I3XHVBN0Y3LVx1QTgyN1x1QTg0MC1cdUE4NzNcdUE4ODAtXHVBOEM1XHVBOEQwLVx1QThEOVx1QThFMC1cdUE4RjdcdUE4RkJcdUE4RkRcdUE5MDAtXHVBOTJEXHVBOTMwLVx1QTk1M1x1QTk2MC1cdUE5N0NcdUE5ODAtXHVBOUMwXHVBOUNGLVx1QTlEOVx1QTlFMC1cdUE5RkVcdUFBMDAtXHVBQTM2XHVBQTQwLVx1QUE0RFx1QUE1MC1cdUFBNTlcdUFBNjAtXHVBQTc2XHVBQTdBLVx1QUFDMlx1QUFEQi1cdUFBRERcdUFBRTAtXHVBQUVGXHVBQUYyLVx1QUFGNlx1QUIwMS1cdUFCMDZcdUFCMDktXHVBQjBFXHVBQjExLVx1QUIxNlx1QUIyMC1cdUFCMjZcdUFCMjgtXHVBQjJFXHVBQjMwLVx1QUI1QVx1QUI1Qy1cdUFCNjVcdUFCNzAtXHVBQkVBXHVBQkVDXHVBQkVEXHVBQkYwLVx1QUJGOVx1QUMwMC1cdUQ3QTNcdUQ3QjAtXHVEN0M2XHVEN0NCLVx1RDdGQlx1RjkwMC1cdUZBNkRcdUZBNzAtXHVGQUQ5XHVGQjAwLVx1RkIwNlx1RkIxMy1cdUZCMTdcdUZCMUQtXHVGQjI4XHVGQjJBLVx1RkIzNlx1RkIzOC1cdUZCM0NcdUZCM0VcdUZCNDBcdUZCNDFcdUZCNDNcdUZCNDRcdUZCNDYtXHVGQkIxXHVGQkQzLVx1RkQzRFx1RkQ1MC1cdUZEOEZcdUZEOTItXHVGREM3XHVGREYwLVx1RkRGQlx1RkUwMC1cdUZFMEZcdUZFMjAtXHVGRTJGXHVGRTMzXHVGRTM0XHVGRTRELVx1RkU0Rlx1RkU3MC1cdUZFNzRcdUZFNzYtXHVGRUZDXHVGRjEwLVx1RkYxOVx1RkYyMS1cdUZGM0FcdUZGM0ZcdUZGNDEtXHVGRjVBXHVGRjY2LVx1RkZCRVx1RkZDMi1cdUZGQzdcdUZGQ0EtXHVGRkNGXHVGRkQyLVx1RkZEN1x1RkZEQS1cdUZGRENdLwogICAgfTsKCiAgICBFUzZSZWdleCA9IHsKICAgICAgICAvLyBFQ01BU2NyaXB0IDYvVW5pY29kZSB2OS4wLjAgTm9uQXNjaWlJZGVudGlmaWVyU3RhcnQ6CiAgICAgICAgTm9uQXNjaWlJZGVudGlmaWVyU3RhcnQ6IC9bXHhBQVx4QjVceEJBXHhDMC1ceEQ2XHhEOC1ceEY2XHhGOC1cdTAyQzFcdTAyQzYtXHUwMkQxXHUwMkUwLVx1MDJFNFx1MDJFQ1x1MDJFRVx1MDM3MC1cdTAzNzRcdTAzNzZcdTAzNzdcdTAzN0EtXHUwMzdEXHUwMzdGXHUwMzg2XHUwMzg4LVx1MDM4QVx1MDM4Q1x1MDM4RS1cdTAzQTFcdTAzQTMtXHUwM0Y1XHUwM0Y3LVx1MDQ4MVx1MDQ4QS1cdTA1MkZcdTA1MzEtXHUwNTU2XHUwNTU5XHUwNTYxLVx1MDU4N1x1MDVEMC1cdTA1RUFcdTA1RjAtXHUwNUYyXHUwNjIwLVx1MDY0QVx1MDY2RVx1MDY2Rlx1MDY3MS1cdTA2RDNcdTA2RDVcdTA2RTVcdTA2RTZcdTA2RUVcdTA2RUZcdTA2RkEtXHUwNkZDXHUwNkZGXHUwNzEwXHUwNzEyLVx1MDcyRlx1MDc0RC1cdTA3QTVcdTA3QjFcdTA3Q0EtXHUwN0VBXHUwN0Y0XHUwN0Y1XHUwN0ZBXHUwODAwLVx1MDgxNVx1MDgxQVx1MDgyNFx1MDgyOFx1MDg0MC1cdTA4NThcdTA4QTAtXHUwOEI0XHUwOEI2LVx1MDhCRFx1MDkwNC1cdTA5MzlcdTA5M0RcdTA5NTBcdTA5NTgtXHUwOTYxXHUwOTcxLVx1MDk4MFx1MDk4NS1cdTA5OENcdTA5OEZcdTA5OTBcdTA5OTMtXHUwOUE4XHUwOUFBLVx1MDlCMFx1MDlCMlx1MDlCNi1cdTA5QjlcdTA5QkRcdTA5Q0VcdTA5RENcdTA5RERcdTA5REYtXHUwOUUxXHUwOUYwXHUwOUYxXHUwQTA1LVx1MEEwQVx1MEEwRlx1MEExMFx1MEExMy1cdTBBMjhcdTBBMkEtXHUwQTMwXHUwQTMyXHUwQTMzXHUwQTM1XHUwQTM2XHUwQTM4XHUwQTM5XHUwQTU5LVx1MEE1Q1x1MEE1RVx1MEE3Mi1cdTBBNzRcdTBBODUtXHUwQThEXHUwQThGLVx1MEE5MVx1MEE5My1cdTBBQThcdTBBQUEtXHUwQUIwXHUwQUIyXHUwQUIzXHUwQUI1LVx1MEFCOVx1MEFCRFx1MEFEMFx1MEFFMFx1MEFFMVx1MEFGOVx1MEIwNS1cdTBCMENcdTBCMEZcdTBCMTBcdTBCMTMtXHUwQjI4XHUwQjJBLVx1MEIzMFx1MEIzMlx1MEIzM1x1MEIzNS1cdTBCMzlcdTBCM0RcdTBCNUNcdTBCNURcdTBCNUYtXHUwQjYxXHUwQjcxXHUwQjgzXHUwQjg1LVx1MEI4QVx1MEI4RS1cdTBCOTBcdTBCOTItXHUwQjk1XHUwQjk5XHUwQjlBXHUwQjlDXHUwQjlFXHUwQjlGXHUwQkEzXHUwQkE0XHUwQkE4LVx1MEJBQVx1MEJBRS1cdTBCQjlcdTBCRDBcdTBDMDUtXHUwQzBDXHUwQzBFLVx1MEMxMFx1MEMxMi1cdTBDMjhcdTBDMkEtXHUwQzM5XHUwQzNEXHUwQzU4LVx1MEM1QVx1MEM2MFx1MEM2MVx1MEM4MFx1MEM4NS1cdTBDOENcdTBDOEUtXHUwQzkwXHUwQzkyLVx1MENBOFx1MENBQS1cdTBDQjNcdTBDQjUtXHUwQ0I5XHUwQ0JEXHUwQ0RFXHUwQ0UwXHUwQ0UxXHUwQ0YxXHUwQ0YyXHUwRDA1LVx1MEQwQ1x1MEQwRS1cdTBEMTBcdTBEMTItXHUwRDNBXHUwRDNEXHUwRDRFXHUwRDU0LVx1MEQ1Nlx1MEQ1Ri1cdTBENjFcdTBEN0EtXHUwRDdGXHUwRDg1LVx1MEQ5Nlx1MEQ5QS1cdTBEQjFcdTBEQjMtXHUwREJCXHUwREJEXHUwREMwLVx1MERDNlx1MEUwMS1cdTBFMzBcdTBFMzJcdTBFMzNcdTBFNDAtXHUwRTQ2XHUwRTgxXHUwRTgyXHUwRTg0XHUwRTg3XHUwRTg4XHUwRThBXHUwRThEXHUwRTk0LVx1MEU5N1x1MEU5OS1cdTBFOUZcdTBFQTEtXHUwRUEzXHUwRUE1XHUwRUE3XHUwRUFBXHUwRUFCXHUwRUFELVx1MEVCMFx1MEVCMlx1MEVCM1x1MEVCRFx1MEVDMC1cdTBFQzRcdTBFQzZcdTBFREMtXHUwRURGXHUwRjAwXHUwRjQwLVx1MEY0N1x1MEY0OS1cdTBGNkNcdTBGODgtXHUwRjhDXHUxMDAwLVx1MTAyQVx1MTAzRlx1MTA1MC1cdTEwNTVcdTEwNUEtXHUxMDVEXHUxMDYxXHUxMDY1XHUxMDY2XHUxMDZFLVx1MTA3MFx1MTA3NS1cdTEwODFcdTEwOEVcdTEwQTAtXHUxMEM1XHUxMEM3XHUxMENEXHUxMEQwLVx1MTBGQVx1MTBGQy1cdTEyNDhcdTEyNEEtXHUxMjREXHUxMjUwLVx1MTI1Nlx1MTI1OFx1MTI1QS1cdTEyNURcdTEyNjAtXHUxMjg4XHUxMjhBLVx1MTI4RFx1MTI5MC1cdTEyQjBcdTEyQjItXHUxMkI1XHUxMkI4LVx1MTJCRVx1MTJDMFx1MTJDMi1cdTEyQzVcdTEyQzgtXHUxMkQ2XHUxMkQ4LVx1MTMxMFx1MTMxMi1cdTEzMTVcdTEzMTgtXHUxMzVBXHUxMzgwLVx1MTM4Rlx1MTNBMC1cdTEzRjVcdTEzRjgtXHUxM0ZEXHUxNDAxLVx1MTY2Q1x1MTY2Ri1cdTE2N0ZcdTE2ODEtXHUxNjlBXHUxNkEwLVx1MTZFQVx1MTZFRS1cdTE2RjhcdTE3MDAtXHUxNzBDXHUxNzBFLVx1MTcxMVx1MTcyMC1cdTE3MzFcdTE3NDAtXHUxNzUxXHUxNzYwLVx1MTc2Q1x1MTc2RS1cdTE3NzBcdTE3ODAtXHUxN0IzXHUxN0Q3XHUxN0RDXHUxODIwLVx1MTg3N1x1MTg4MC1cdTE4QThcdTE4QUFcdTE4QjAtXHUxOEY1XHUxOTAwLVx1MTkxRVx1MTk1MC1cdTE5NkRcdTE5NzAtXHUxOTc0XHUxOTgwLVx1MTlBQlx1MTlCMC1cdTE5QzlcdTFBMDAtXHUxQTE2XHUxQTIwLVx1MUE1NFx1MUFBN1x1MUIwNS1cdTFCMzNcdTFCNDUtXHUxQjRCXHUxQjgzLVx1MUJBMFx1MUJBRVx1MUJBRlx1MUJCQS1cdTFCRTVcdTFDMDAtXHUxQzIzXHUxQzRELVx1MUM0Rlx1MUM1QS1cdTFDN0RcdTFDODAtXHUxQzg4XHUxQ0U5LVx1MUNFQ1x1MUNFRS1cdTFDRjFcdTFDRjVcdTFDRjZcdTFEMDAtXHUxREJGXHUxRTAwLVx1MUYxNVx1MUYxOC1cdTFGMURcdTFGMjAtXHUxRjQ1XHUxRjQ4LVx1MUY0RFx1MUY1MC1cdTFGNTdcdTFGNTlcdTFGNUJcdTFGNURcdTFGNUYtXHUxRjdEXHUxRjgwLVx1MUZCNFx1MUZCNi1cdTFGQkNcdTFGQkVcdTFGQzItXHUxRkM0XHUxRkM2LVx1MUZDQ1x1MUZEMC1cdTFGRDNcdTFGRDYtXHUxRkRCXHUxRkUwLVx1MUZFQ1x1MUZGMi1cdTFGRjRcdTFGRjYtXHUxRkZDXHUyMDcxXHUyMDdGXHUyMDkwLVx1MjA5Q1x1MjEwMlx1MjEwN1x1MjEwQS1cdTIxMTNcdTIxMTVcdTIxMTgtXHUyMTFEXHUyMTI0XHUyMTI2XHUyMTI4XHUyMTJBLVx1MjEzOVx1MjEzQy1cdTIxM0ZcdTIxNDUtXHUyMTQ5XHUyMTRFXHUyMTYwLVx1MjE4OFx1MkMwMC1cdTJDMkVcdTJDMzAtXHUyQzVFXHUyQzYwLVx1MkNFNFx1MkNFQi1cdTJDRUVcdTJDRjJcdTJDRjNcdTJEMDAtXHUyRDI1XHUyRDI3XHUyRDJEXHUyRDMwLVx1MkQ2N1x1MkQ2Rlx1MkQ4MC1cdTJEOTZcdTJEQTAtXHUyREE2XHUyREE4LVx1MkRBRVx1MkRCMC1cdTJEQjZcdTJEQjgtXHUyREJFXHUyREMwLVx1MkRDNlx1MkRDOC1cdTJEQ0VcdTJERDAtXHUyREQ2XHUyREQ4LVx1MkRERVx1MzAwNS1cdTMwMDdcdTMwMjEtXHUzMDI5XHUzMDMxLVx1MzAzNVx1MzAzOC1cdTMwM0NcdTMwNDEtXHUzMDk2XHUzMDlCLVx1MzA5Rlx1MzBBMS1cdTMwRkFcdTMwRkMtXHUzMEZGXHUzMTA1LVx1MzEyRFx1MzEzMS1cdTMxOEVcdTMxQTAtXHUzMUJBXHUzMUYwLVx1MzFGRlx1MzQwMC1cdTREQjVcdTRFMDAtXHU5RkQ1XHVBMDAwLVx1QTQ4Q1x1QTREMC1cdUE0RkRcdUE1MDAtXHVBNjBDXHVBNjEwLVx1QTYxRlx1QTYyQVx1QTYyQlx1QTY0MC1cdUE2NkVcdUE2N0YtXHVBNjlEXHVBNkEwLVx1QTZFRlx1QTcxNy1cdUE3MUZcdUE3MjItXHVBNzg4XHVBNzhCLVx1QTdBRVx1QTdCMC1cdUE3QjdcdUE3RjctXHVBODAxXHVBODAzLVx1QTgwNVx1QTgwNy1cdUE4MEFcdUE4MEMtXHVBODIyXHVBODQwLVx1QTg3M1x1QTg4Mi1cdUE4QjNcdUE4RjItXHVBOEY3XHVBOEZCXHVBOEZEXHVBOTBBLVx1QTkyNVx1QTkzMC1cdUE5NDZcdUE5NjAtXHVBOTdDXHVBOTg0LVx1QTlCMlx1QTlDRlx1QTlFMC1cdUE5RTRcdUE5RTYtXHVBOUVGXHVBOUZBLVx1QTlGRVx1QUEwMC1cdUFBMjhcdUFBNDAtXHVBQTQyXHVBQTQ0LVx1QUE0Qlx1QUE2MC1cdUFBNzZcdUFBN0FcdUFBN0UtXHVBQUFGXHVBQUIxXHVBQUI1XHVBQUI2XHVBQUI5LVx1QUFCRFx1QUFDMFx1QUFDMlx1QUFEQi1cdUFBRERcdUFBRTAtXHVBQUVBXHVBQUYyLVx1QUFGNFx1QUIwMS1cdUFCMDZcdUFCMDktXHVBQjBFXHVBQjExLVx1QUIxNlx1QUIyMC1cdUFCMjZcdUFCMjgtXHVBQjJFXHVBQjMwLVx1QUI1QVx1QUI1Qy1cdUFCNjVcdUFCNzAtXHVBQkUyXHVBQzAwLVx1RDdBM1x1RDdCMC1cdUQ3QzZcdUQ3Q0ItXHVEN0ZCXHVGOTAwLVx1RkE2RFx1RkE3MC1cdUZBRDlcdUZCMDAtXHVGQjA2XHVGQjEzLVx1RkIxN1x1RkIxRFx1RkIxRi1cdUZCMjhcdUZCMkEtXHVGQjM2XHVGQjM4LVx1RkIzQ1x1RkIzRVx1RkI0MFx1RkI0MVx1RkI0M1x1RkI0NFx1RkI0Ni1cdUZCQjFcdUZCRDMtXHVGRDNEXHVGRDUwLVx1RkQ4Rlx1RkQ5Mi1cdUZEQzdcdUZERjAtXHVGREZCXHVGRTcwLVx1RkU3NFx1RkU3Ni1cdUZFRkNcdUZGMjEtXHVGRjNBXHVGRjQxLVx1RkY1QVx1RkY2Ni1cdUZGQkVcdUZGQzItXHVGRkM3XHVGRkNBLVx1RkZDRlx1RkZEMi1cdUZGRDdcdUZGREEtXHVGRkRDXXxcdUQ4MDBbXHVEQzAwLVx1REMwQlx1REMwRC1cdURDMjZcdURDMjgtXHVEQzNBXHVEQzNDXHVEQzNEXHVEQzNGLVx1REM0RFx1REM1MC1cdURDNURcdURDODAtXHVEQ0ZBXHVERDQwLVx1REQ3NFx1REU4MC1cdURFOUNcdURFQTAtXHVERUQwXHVERjAwLVx1REYxRlx1REYzMC1cdURGNEFcdURGNTAtXHVERjc1XHVERjgwLVx1REY5RFx1REZBMC1cdURGQzNcdURGQzgtXHVERkNGXHVERkQxLVx1REZENV18XHVEODAxW1x1REMwMC1cdURDOURcdURDQjAtXHVEQ0QzXHVEQ0Q4LVx1RENGQlx1REQwMC1cdUREMjdcdUREMzAtXHVERDYzXHVERTAwLVx1REYzNlx1REY0MC1cdURGNTVcdURGNjAtXHVERjY3XXxcdUQ4MDJbXHVEQzAwLVx1REMwNVx1REMwOFx1REMwQS1cdURDMzVcdURDMzdcdURDMzhcdURDM0NcdURDM0YtXHVEQzU1XHVEQzYwLVx1REM3Nlx1REM4MC1cdURDOUVcdURDRTAtXHVEQ0YyXHVEQ0Y0XHVEQ0Y1XHVERDAwLVx1REQxNVx1REQyMC1cdUREMzlcdUREODAtXHVEREI3XHVEREJFXHVEREJGXHVERTAwXHVERTEwLVx1REUxM1x1REUxNS1cdURFMTdcdURFMTktXHVERTMzXHVERTYwLVx1REU3Q1x1REU4MC1cdURFOUNcdURFQzAtXHVERUM3XHVERUM5LVx1REVFNFx1REYwMC1cdURGMzVcdURGNDAtXHVERjU1XHVERjYwLVx1REY3Mlx1REY4MC1cdURGOTFdfFx1RDgwM1tcdURDMDAtXHVEQzQ4XHVEQzgwLVx1RENCMlx1RENDMC1cdURDRjJdfFx1RDgwNFtcdURDMDMtXHVEQzM3XHVEQzgzLVx1RENBRlx1RENEMC1cdURDRThcdUREMDMtXHVERDI2XHVERDUwLVx1REQ3Mlx1REQ3Nlx1REQ4My1cdUREQjJcdUREQzEtXHVEREM0XHVERERBXHVERERDXHVERTAwLVx1REUxMVx1REUxMy1cdURFMkJcdURFODAtXHVERTg2XHVERTg4XHVERThBLVx1REU4RFx1REU4Ri1cdURFOURcdURFOUYtXHVERUE4XHVERUIwLVx1REVERVx1REYwNS1cdURGMENcdURGMEZcdURGMTBcdURGMTMtXHVERjI4XHVERjJBLVx1REYzMFx1REYzMlx1REYzM1x1REYzNS1cdURGMzlcdURGM0RcdURGNTBcdURGNUQtXHVERjYxXXxcdUQ4MDVbXHVEQzAwLVx1REMzNFx1REM0Ny1cdURDNEFcdURDODAtXHVEQ0FGXHVEQ0M0XHVEQ0M1XHVEQ0M3XHVERDgwLVx1RERBRVx1REREOC1cdUREREJcdURFMDAtXHVERTJGXHVERTQ0XHVERTgwLVx1REVBQVx1REYwMC1cdURGMTldfFx1RDgwNltcdURDQTAtXHVEQ0RGXHVEQ0ZGXHVERUMwLVx1REVGOF18XHVEODA3W1x1REMwMC1cdURDMDhcdURDMEEtXHVEQzJFXHVEQzQwXHVEQzcyLVx1REM4Rl18XHVEODA4W1x1REMwMC1cdURGOTldfFx1RDgwOVtcdURDMDAtXHVEQzZFXHVEQzgwLVx1REQ0M118W1x1RDgwQ1x1RDgxQy1cdUQ4MjBcdUQ4NDAtXHVEODY4XHVEODZBLVx1RDg2Q1x1RDg2Ri1cdUQ4NzJdW1x1REMwMC1cdURGRkZdfFx1RDgwRFtcdURDMDAtXHVEQzJFXXxcdUQ4MTFbXHVEQzAwLVx1REU0Nl18XHVEODFBW1x1REMwMC1cdURFMzhcdURFNDAtXHVERTVFXHVERUQwLVx1REVFRFx1REYwMC1cdURGMkZcdURGNDAtXHVERjQzXHVERjYzLVx1REY3N1x1REY3RC1cdURGOEZdfFx1RDgxQltcdURGMDAtXHVERjQ0XHVERjUwXHVERjkzLVx1REY5Rlx1REZFMF18XHVEODIxW1x1REMwMC1cdURGRUNdfFx1RDgyMltcdURDMDAtXHVERUYyXXxcdUQ4MkNbXHVEQzAwXHVEQzAxXXxcdUQ4MkZbXHVEQzAwLVx1REM2QVx1REM3MC1cdURDN0NcdURDODAtXHVEQzg4XHVEQzkwLVx1REM5OV18XHVEODM1W1x1REMwMC1cdURDNTRcdURDNTYtXHVEQzlDXHVEQzlFXHVEQzlGXHVEQ0EyXHVEQ0E1XHVEQ0E2XHVEQ0E5LVx1RENBQ1x1RENBRS1cdURDQjlcdURDQkJcdURDQkQtXHVEQ0MzXHVEQ0M1LVx1REQwNVx1REQwNy1cdUREMEFcdUREMEQtXHVERDE0XHVERDE2LVx1REQxQ1x1REQxRS1cdUREMzlcdUREM0ItXHVERDNFXHVERDQwLVx1REQ0NFx1REQ0Nlx1REQ0QS1cdURENTBcdURENTItXHVERUE1XHVERUE4LVx1REVDMFx1REVDMi1cdURFREFcdURFREMtXHVERUZBXHVERUZDLVx1REYxNFx1REYxNi1cdURGMzRcdURGMzYtXHVERjRFXHVERjUwLVx1REY2RVx1REY3MC1cdURGODhcdURGOEEtXHVERkE4XHVERkFBLVx1REZDMlx1REZDNC1cdURGQ0JdfFx1RDgzQVtcdURDMDAtXHVEQ0M0XHVERDAwLVx1REQ0M118XHVEODNCW1x1REUwMC1cdURFMDNcdURFMDUtXHVERTFGXHVERTIxXHVERTIyXHVERTI0XHVERTI3XHVERTI5LVx1REUzMlx1REUzNC1cdURFMzdcdURFMzlcdURFM0JcdURFNDJcdURFNDdcdURFNDlcdURFNEJcdURFNEQtXHVERTRGXHVERTUxXHVERTUyXHVERTU0XHVERTU3XHVERTU5XHVERTVCXHVERTVEXHVERTVGXHVERTYxXHVERTYyXHVERTY0XHVERTY3LVx1REU2QVx1REU2Qy1cdURFNzJcdURFNzQtXHVERTc3XHVERTc5LVx1REU3Q1x1REU3RVx1REU4MC1cdURFODlcdURFOEItXHVERTlCXHVERUExLVx1REVBM1x1REVBNS1cdURFQTlcdURFQUItXHVERUJCXXxcdUQ4NjlbXHVEQzAwLVx1REVENlx1REYwMC1cdURGRkZdfFx1RDg2RFtcdURDMDAtXHVERjM0XHVERjQwLVx1REZGRl18XHVEODZFW1x1REMwMC1cdURDMURcdURDMjAtXHVERkZGXXxcdUQ4NzNbXHVEQzAwLVx1REVBMV18XHVEODdFW1x1REMwMC1cdURFMURdLywKICAgICAgICAvLyBFQ01BU2NyaXB0IDYvVW5pY29kZSB2OS4wLjAgTm9uQXNjaWlJZGVudGlmaWVyUGFydDoKICAgICAgICBOb25Bc2NpaUlkZW50aWZpZXJQYXJ0OiAvW1x4QUFceEI1XHhCN1x4QkFceEMwLVx4RDZceEQ4LVx4RjZceEY4LVx1MDJDMVx1MDJDNi1cdTAyRDFcdTAyRTAtXHUwMkU0XHUwMkVDXHUwMkVFXHUwMzAwLVx1MDM3NFx1MDM3Nlx1MDM3N1x1MDM3QS1cdTAzN0RcdTAzN0ZcdTAzODYtXHUwMzhBXHUwMzhDXHUwMzhFLVx1MDNBMVx1MDNBMy1cdTAzRjVcdTAzRjctXHUwNDgxXHUwNDgzLVx1MDQ4N1x1MDQ4QS1cdTA1MkZcdTA1MzEtXHUwNTU2XHUwNTU5XHUwNTYxLVx1MDU4N1x1MDU5MS1cdTA1QkRcdTA1QkZcdTA1QzFcdTA1QzJcdTA1QzRcdTA1QzVcdTA1QzdcdTA1RDAtXHUwNUVBXHUwNUYwLVx1MDVGMlx1MDYxMC1cdTA2MUFcdTA2MjAtXHUwNjY5XHUwNjZFLVx1MDZEM1x1MDZENS1cdTA2RENcdTA2REYtXHUwNkU4XHUwNkVBLVx1MDZGQ1x1MDZGRlx1MDcxMC1cdTA3NEFcdTA3NEQtXHUwN0IxXHUwN0MwLVx1MDdGNVx1MDdGQVx1MDgwMC1cdTA4MkRcdTA4NDAtXHUwODVCXHUwOEEwLVx1MDhCNFx1MDhCNi1cdTA4QkRcdTA4RDQtXHUwOEUxXHUwOEUzLVx1MDk2M1x1MDk2Ni1cdTA5NkZcdTA5NzEtXHUwOTgzXHUwOTg1LVx1MDk4Q1x1MDk4Rlx1MDk5MFx1MDk5My1cdTA5QThcdTA5QUEtXHUwOUIwXHUwOUIyXHUwOUI2LVx1MDlCOVx1MDlCQy1cdTA5QzRcdTA5QzdcdTA5QzhcdTA5Q0ItXHUwOUNFXHUwOUQ3XHUwOURDXHUwOUREXHUwOURGLVx1MDlFM1x1MDlFNi1cdTA5RjFcdTBBMDEtXHUwQTAzXHUwQTA1LVx1MEEwQVx1MEEwRlx1MEExMFx1MEExMy1cdTBBMjhcdTBBMkEtXHUwQTMwXHUwQTMyXHUwQTMzXHUwQTM1XHUwQTM2XHUwQTM4XHUwQTM5XHUwQTNDXHUwQTNFLVx1MEE0Mlx1MEE0N1x1MEE0OFx1MEE0Qi1cdTBBNERcdTBBNTFcdTBBNTktXHUwQTVDXHUwQTVFXHUwQTY2LVx1MEE3NVx1MEE4MS1cdTBBODNcdTBBODUtXHUwQThEXHUwQThGLVx1MEE5MVx1MEE5My1cdTBBQThcdTBBQUEtXHUwQUIwXHUwQUIyXHUwQUIzXHUwQUI1LVx1MEFCOVx1MEFCQy1cdTBBQzVcdTBBQzctXHUwQUM5XHUwQUNCLVx1MEFDRFx1MEFEMFx1MEFFMC1cdTBBRTNcdTBBRTYtXHUwQUVGXHUwQUY5XHUwQjAxLVx1MEIwM1x1MEIwNS1cdTBCMENcdTBCMEZcdTBCMTBcdTBCMTMtXHUwQjI4XHUwQjJBLVx1MEIzMFx1MEIzMlx1MEIzM1x1MEIzNS1cdTBCMzlcdTBCM0MtXHUwQjQ0XHUwQjQ3XHUwQjQ4XHUwQjRCLVx1MEI0RFx1MEI1Nlx1MEI1N1x1MEI1Q1x1MEI1RFx1MEI1Ri1cdTBCNjNcdTBCNjYtXHUwQjZGXHUwQjcxXHUwQjgyXHUwQjgzXHUwQjg1LVx1MEI4QVx1MEI4RS1cdTBCOTBcdTBCOTItXHUwQjk1XHUwQjk5XHUwQjlBXHUwQjlDXHUwQjlFXHUwQjlGXHUwQkEzXHUwQkE0XHUwQkE4LVx1MEJBQVx1MEJBRS1cdTBCQjlcdTBCQkUtXHUwQkMyXHUwQkM2LVx1MEJDOFx1MEJDQS1cdTBCQ0RcdTBCRDBcdTBCRDdcdTBCRTYtXHUwQkVGXHUwQzAwLVx1MEMwM1x1MEMwNS1cdTBDMENcdTBDMEUtXHUwQzEwXHUwQzEyLVx1MEMyOFx1MEMyQS1cdTBDMzlcdTBDM0QtXHUwQzQ0XHUwQzQ2LVx1MEM0OFx1MEM0QS1cdTBDNERcdTBDNTVcdTBDNTZcdTBDNTgtXHUwQzVBXHUwQzYwLVx1MEM2M1x1MEM2Ni1cdTBDNkZcdTBDODAtXHUwQzgzXHUwQzg1LVx1MEM4Q1x1MEM4RS1cdTBDOTBcdTBDOTItXHUwQ0E4XHUwQ0FBLVx1MENCM1x1MENCNS1cdTBDQjlcdTBDQkMtXHUwQ0M0XHUwQ0M2LVx1MENDOFx1MENDQS1cdTBDQ0RcdTBDRDVcdTBDRDZcdTBDREVcdTBDRTAtXHUwQ0UzXHUwQ0U2LVx1MENFRlx1MENGMVx1MENGMlx1MEQwMS1cdTBEMDNcdTBEMDUtXHUwRDBDXHUwRDBFLVx1MEQxMFx1MEQxMi1cdTBEM0FcdTBEM0QtXHUwRDQ0XHUwRDQ2LVx1MEQ0OFx1MEQ0QS1cdTBENEVcdTBENTQtXHUwRDU3XHUwRDVGLVx1MEQ2M1x1MEQ2Ni1cdTBENkZcdTBEN0EtXHUwRDdGXHUwRDgyXHUwRDgzXHUwRDg1LVx1MEQ5Nlx1MEQ5QS1cdTBEQjFcdTBEQjMtXHUwREJCXHUwREJEXHUwREMwLVx1MERDNlx1MERDQVx1MERDRi1cdTBERDRcdTBERDZcdTBERDgtXHUwRERGXHUwREU2LVx1MERFRlx1MERGMlx1MERGM1x1MEUwMS1cdTBFM0FcdTBFNDAtXHUwRTRFXHUwRTUwLVx1MEU1OVx1MEU4MVx1MEU4Mlx1MEU4NFx1MEU4N1x1MEU4OFx1MEU4QVx1MEU4RFx1MEU5NC1cdTBFOTdcdTBFOTktXHUwRTlGXHUwRUExLVx1MEVBM1x1MEVBNVx1MEVBN1x1MEVBQVx1MEVBQlx1MEVBRC1cdTBFQjlcdTBFQkItXHUwRUJEXHUwRUMwLVx1MEVDNFx1MEVDNlx1MEVDOC1cdTBFQ0RcdTBFRDAtXHUwRUQ5XHUwRURDLVx1MEVERlx1MEYwMFx1MEYxOFx1MEYxOVx1MEYyMC1cdTBGMjlcdTBGMzVcdTBGMzdcdTBGMzlcdTBGM0UtXHUwRjQ3XHUwRjQ5LVx1MEY2Q1x1MEY3MS1cdTBGODRcdTBGODYtXHUwRjk3XHUwRjk5LVx1MEZCQ1x1MEZDNlx1MTAwMC1cdTEwNDlcdTEwNTAtXHUxMDlEXHUxMEEwLVx1MTBDNVx1MTBDN1x1MTBDRFx1MTBEMC1cdTEwRkFcdTEwRkMtXHUxMjQ4XHUxMjRBLVx1MTI0RFx1MTI1MC1cdTEyNTZcdTEyNThcdTEyNUEtXHUxMjVEXHUxMjYwLVx1MTI4OFx1MTI4QS1cdTEyOERcdTEyOTAtXHUxMkIwXHUxMkIyLVx1MTJCNVx1MTJCOC1cdTEyQkVcdTEyQzBcdTEyQzItXHUxMkM1XHUxMkM4LVx1MTJENlx1MTJEOC1cdTEzMTBcdTEzMTItXHUxMzE1XHUxMzE4LVx1MTM1QVx1MTM1RC1cdTEzNUZcdTEzNjktXHUxMzcxXHUxMzgwLVx1MTM4Rlx1MTNBMC1cdTEzRjVcdTEzRjgtXHUxM0ZEXHUxNDAxLVx1MTY2Q1x1MTY2Ri1cdTE2N0ZcdTE2ODEtXHUxNjlBXHUxNkEwLVx1MTZFQVx1MTZFRS1cdTE2RjhcdTE3MDAtXHUxNzBDXHUxNzBFLVx1MTcxNFx1MTcyMC1cdTE3MzRcdTE3NDAtXHUxNzUzXHUxNzYwLVx1MTc2Q1x1MTc2RS1cdTE3NzBcdTE3NzJcdTE3NzNcdTE3ODAtXHUxN0QzXHUxN0Q3XHUxN0RDXHUxN0REXHUxN0UwLVx1MTdFOVx1MTgwQi1cdTE4MERcdTE4MTAtXHUxODE5XHUxODIwLVx1MTg3N1x1MTg4MC1cdTE4QUFcdTE4QjAtXHUxOEY1XHUxOTAwLVx1MTkxRVx1MTkyMC1cdTE5MkJcdTE5MzAtXHUxOTNCXHUxOTQ2LVx1MTk2RFx1MTk3MC1cdTE5NzRcdTE5ODAtXHUxOUFCXHUxOUIwLVx1MTlDOVx1MTlEMC1cdTE5REFcdTFBMDAtXHUxQTFCXHUxQTIwLVx1MUE1RVx1MUE2MC1cdTFBN0NcdTFBN0YtXHUxQTg5XHUxQTkwLVx1MUE5OVx1MUFBN1x1MUFCMC1cdTFBQkRcdTFCMDAtXHUxQjRCXHUxQjUwLVx1MUI1OVx1MUI2Qi1cdTFCNzNcdTFCODAtXHUxQkYzXHUxQzAwLVx1MUMzN1x1MUM0MC1cdTFDNDlcdTFDNEQtXHUxQzdEXHUxQzgwLVx1MUM4OFx1MUNEMC1cdTFDRDJcdTFDRDQtXHUxQ0Y2XHUxQ0Y4XHUxQ0Y5XHUxRDAwLVx1MURGNVx1MURGQi1cdTFGMTVcdTFGMTgtXHUxRjFEXHUxRjIwLVx1MUY0NVx1MUY0OC1cdTFGNERcdTFGNTAtXHUxRjU3XHUxRjU5XHUxRjVCXHUxRjVEXHUxRjVGLVx1MUY3RFx1MUY4MC1cdTFGQjRcdTFGQjYtXHUxRkJDXHUxRkJFXHUxRkMyLVx1MUZDNFx1MUZDNi1cdTFGQ0NcdTFGRDAtXHUxRkQzXHUxRkQ2LVx1MUZEQlx1MUZFMC1cdTFGRUNcdTFGRjItXHUxRkY0XHUxRkY2LVx1MUZGQ1x1MjAwQ1x1MjAwRFx1MjAzRlx1MjA0MFx1MjA1NFx1MjA3MVx1MjA3Rlx1MjA5MC1cdTIwOUNcdTIwRDAtXHUyMERDXHUyMEUxXHUyMEU1LVx1MjBGMFx1MjEwMlx1MjEwN1x1MjEwQS1cdTIxMTNcdTIxMTVcdTIxMTgtXHUyMTFEXHUyMTI0XHUyMTI2XHUyMTI4XHUyMTJBLVx1MjEzOVx1MjEzQy1cdTIxM0ZcdTIxNDUtXHUyMTQ5XHUyMTRFXHUyMTYwLVx1MjE4OFx1MkMwMC1cdTJDMkVcdTJDMzAtXHUyQzVFXHUyQzYwLVx1MkNFNFx1MkNFQi1cdTJDRjNcdTJEMDAtXHUyRDI1XHUyRDI3XHUyRDJEXHUyRDMwLVx1MkQ2N1x1MkQ2Rlx1MkQ3Ri1cdTJEOTZcdTJEQTAtXHUyREE2XHUyREE4LVx1MkRBRVx1MkRCMC1cdTJEQjZcdTJEQjgtXHUyREJFXHUyREMwLVx1MkRDNlx1MkRDOC1cdTJEQ0VcdTJERDAtXHUyREQ2XHUyREQ4LVx1MkRERVx1MkRFMC1cdTJERkZcdTMwMDUtXHUzMDA3XHUzMDIxLVx1MzAyRlx1MzAzMS1cdTMwMzVcdTMwMzgtXHUzMDNDXHUzMDQxLVx1MzA5Nlx1MzA5OS1cdTMwOUZcdTMwQTEtXHUzMEZBXHUzMEZDLVx1MzBGRlx1MzEwNS1cdTMxMkRcdTMxMzEtXHUzMThFXHUzMUEwLVx1MzFCQVx1MzFGMC1cdTMxRkZcdTM0MDAtXHU0REI1XHU0RTAwLVx1OUZENVx1QTAwMC1cdUE0OENcdUE0RDAtXHVBNEZEXHVBNTAwLVx1QTYwQ1x1QTYxMC1cdUE2MkJcdUE2NDAtXHVBNjZGXHVBNjc0LVx1QTY3RFx1QTY3Ri1cdUE2RjFcdUE3MTctXHVBNzFGXHVBNzIyLVx1QTc4OFx1QTc4Qi1cdUE3QUVcdUE3QjAtXHVBN0I3XHVBN0Y3LVx1QTgyN1x1QTg0MC1cdUE4NzNcdUE4ODAtXHVBOEM1XHVBOEQwLVx1QThEOVx1QThFMC1cdUE4RjdcdUE4RkJcdUE4RkRcdUE5MDAtXHVBOTJEXHVBOTMwLVx1QTk1M1x1QTk2MC1cdUE5N0NcdUE5ODAtXHVBOUMwXHVBOUNGLVx1QTlEOVx1QTlFMC1cdUE5RkVcdUFBMDAtXHVBQTM2XHVBQTQwLVx1QUE0RFx1QUE1MC1cdUFBNTlcdUFBNjAtXHVBQTc2XHVBQTdBLVx1QUFDMlx1QUFEQi1cdUFBRERcdUFBRTAtXHVBQUVGXHVBQUYyLVx1QUFGNlx1QUIwMS1cdUFCMDZcdUFCMDktXHVBQjBFXHVBQjExLVx1QUIxNlx1QUIyMC1cdUFCMjZcdUFCMjgtXHVBQjJFXHVBQjMwLVx1QUI1QVx1QUI1Qy1cdUFCNjVcdUFCNzAtXHVBQkVBXHVBQkVDXHVBQkVEXHVBQkYwLVx1QUJGOVx1QUMwMC1cdUQ3QTNcdUQ3QjAtXHVEN0M2XHVEN0NCLVx1RDdGQlx1RjkwMC1cdUZBNkRcdUZBNzAtXHVGQUQ5XHVGQjAwLVx1RkIwNlx1RkIxMy1cdUZCMTdcdUZCMUQtXHVGQjI4XHVGQjJBLVx1RkIzNlx1RkIzOC1cdUZCM0NcdUZCM0VcdUZCNDBcdUZCNDFcdUZCNDNcdUZCNDRcdUZCNDYtXHVGQkIxXHVGQkQzLVx1RkQzRFx1RkQ1MC1cdUZEOEZcdUZEOTItXHVGREM3XHVGREYwLVx1RkRGQlx1RkUwMC1cdUZFMEZcdUZFMjAtXHVGRTJGXHVGRTMzXHVGRTM0XHVGRTRELVx1RkU0Rlx1RkU3MC1cdUZFNzRcdUZFNzYtXHVGRUZDXHVGRjEwLVx1RkYxOVx1RkYyMS1cdUZGM0FcdUZGM0ZcdUZGNDEtXHVGRjVBXHVGRjY2LVx1RkZCRVx1RkZDMi1cdUZGQzdcdUZGQ0EtXHVGRkNGXHVGRkQyLVx1RkZEN1x1RkZEQS1cdUZGRENdfFx1RDgwMFtcdURDMDAtXHVEQzBCXHVEQzBELVx1REMyNlx1REMyOC1cdURDM0FcdURDM0NcdURDM0RcdURDM0YtXHVEQzREXHVEQzUwLVx1REM1RFx1REM4MC1cdURDRkFcdURENDAtXHVERDc0XHVEREZEXHVERTgwLVx1REU5Q1x1REVBMC1cdURFRDBcdURFRTBcdURGMDAtXHVERjFGXHVERjMwLVx1REY0QVx1REY1MC1cdURGN0FcdURGODAtXHVERjlEXHVERkEwLVx1REZDM1x1REZDOC1cdURGQ0ZcdURGRDEtXHVERkQ1XXxcdUQ4MDFbXHVEQzAwLVx1REM5RFx1RENBMC1cdURDQTlcdURDQjAtXHVEQ0QzXHVEQ0Q4LVx1RENGQlx1REQwMC1cdUREMjdcdUREMzAtXHVERDYzXHVERTAwLVx1REYzNlx1REY0MC1cdURGNTVcdURGNjAtXHVERjY3XXxcdUQ4MDJbXHVEQzAwLVx1REMwNVx1REMwOFx1REMwQS1cdURDMzVcdURDMzdcdURDMzhcdURDM0NcdURDM0YtXHVEQzU1XHVEQzYwLVx1REM3Nlx1REM4MC1cdURDOUVcdURDRTAtXHVEQ0YyXHVEQ0Y0XHVEQ0Y1XHVERDAwLVx1REQxNVx1REQyMC1cdUREMzlcdUREODAtXHVEREI3XHVEREJFXHVEREJGXHVERTAwLVx1REUwM1x1REUwNVx1REUwNlx1REUwQy1cdURFMTNcdURFMTUtXHVERTE3XHVERTE5LVx1REUzM1x1REUzOC1cdURFM0FcdURFM0ZcdURFNjAtXHVERTdDXHVERTgwLVx1REU5Q1x1REVDMC1cdURFQzdcdURFQzktXHVERUU2XHVERjAwLVx1REYzNVx1REY0MC1cdURGNTVcdURGNjAtXHVERjcyXHVERjgwLVx1REY5MV18XHVEODAzW1x1REMwMC1cdURDNDhcdURDODAtXHVEQ0IyXHVEQ0MwLVx1RENGMl18XHVEODA0W1x1REMwMC1cdURDNDZcdURDNjYtXHVEQzZGXHVEQzdGLVx1RENCQVx1RENEMC1cdURDRThcdURDRjAtXHVEQ0Y5XHVERDAwLVx1REQzNFx1REQzNi1cdUREM0ZcdURENTAtXHVERDczXHVERDc2XHVERDgwLVx1RERDNFx1RERDQS1cdUREQ0NcdURERDAtXHVERERBXHVERERDXHVERTAwLVx1REUxMVx1REUxMy1cdURFMzdcdURFM0VcdURFODAtXHVERTg2XHVERTg4XHVERThBLVx1REU4RFx1REU4Ri1cdURFOURcdURFOUYtXHVERUE4XHVERUIwLVx1REVFQVx1REVGMC1cdURFRjlcdURGMDAtXHVERjAzXHVERjA1LVx1REYwQ1x1REYwRlx1REYxMFx1REYxMy1cdURGMjhcdURGMkEtXHVERjMwXHVERjMyXHVERjMzXHVERjM1LVx1REYzOVx1REYzQy1cdURGNDRcdURGNDdcdURGNDhcdURGNEItXHVERjREXHVERjUwXHVERjU3XHVERjVELVx1REY2M1x1REY2Ni1cdURGNkNcdURGNzAtXHVERjc0XXxcdUQ4MDVbXHVEQzAwLVx1REM0QVx1REM1MC1cdURDNTlcdURDODAtXHVEQ0M1XHVEQ0M3XHVEQ0QwLVx1RENEOVx1REQ4MC1cdUREQjVcdUREQjgtXHVEREMwXHVEREQ4LVx1RERERFx1REUwMC1cdURFNDBcdURFNDRcdURFNTAtXHVERTU5XHVERTgwLVx1REVCN1x1REVDMC1cdURFQzlcdURGMDAtXHVERjE5XHVERjFELVx1REYyQlx1REYzMC1cdURGMzldfFx1RDgwNltcdURDQTAtXHVEQ0U5XHVEQ0ZGXHVERUMwLVx1REVGOF18XHVEODA3W1x1REMwMC1cdURDMDhcdURDMEEtXHVEQzM2XHVEQzM4LVx1REM0MFx1REM1MC1cdURDNTlcdURDNzItXHVEQzhGXHVEQzkyLVx1RENBN1x1RENBOS1cdURDQjZdfFx1RDgwOFtcdURDMDAtXHVERjk5XXxcdUQ4MDlbXHVEQzAwLVx1REM2RVx1REM4MC1cdURENDNdfFtcdUQ4MENcdUQ4MUMtXHVEODIwXHVEODQwLVx1RDg2OFx1RDg2QS1cdUQ4NkNcdUQ4NkYtXHVEODcyXVtcdURDMDAtXHVERkZGXXxcdUQ4MERbXHVEQzAwLVx1REMyRV18XHVEODExW1x1REMwMC1cdURFNDZdfFx1RDgxQVtcdURDMDAtXHVERTM4XHVERTQwLVx1REU1RVx1REU2MC1cdURFNjlcdURFRDAtXHVERUVEXHVERUYwLVx1REVGNFx1REYwMC1cdURGMzZcdURGNDAtXHVERjQzXHVERjUwLVx1REY1OVx1REY2My1cdURGNzdcdURGN0QtXHVERjhGXXxcdUQ4MUJbXHVERjAwLVx1REY0NFx1REY1MC1cdURGN0VcdURGOEYtXHVERjlGXHVERkUwXXxcdUQ4MjFbXHVEQzAwLVx1REZFQ118XHVEODIyW1x1REMwMC1cdURFRjJdfFx1RDgyQ1tcdURDMDBcdURDMDFdfFx1RDgyRltcdURDMDAtXHVEQzZBXHVEQzcwLVx1REM3Q1x1REM4MC1cdURDODhcdURDOTAtXHVEQzk5XHVEQzlEXHVEQzlFXXxcdUQ4MzRbXHVERDY1LVx1REQ2OVx1REQ2RC1cdURENzJcdUREN0ItXHVERDgyXHVERDg1LVx1REQ4Qlx1RERBQS1cdUREQURcdURFNDItXHVERTQ0XXxcdUQ4MzVbXHVEQzAwLVx1REM1NFx1REM1Ni1cdURDOUNcdURDOUVcdURDOUZcdURDQTJcdURDQTVcdURDQTZcdURDQTktXHVEQ0FDXHVEQ0FFLVx1RENCOVx1RENCQlx1RENCRC1cdURDQzNcdURDQzUtXHVERDA1XHVERDA3LVx1REQwQVx1REQwRC1cdUREMTRcdUREMTYtXHVERDFDXHVERDFFLVx1REQzOVx1REQzQi1cdUREM0VcdURENDAtXHVERDQ0XHVERDQ2XHVERDRBLVx1REQ1MFx1REQ1Mi1cdURFQTVcdURFQTgtXHVERUMwXHVERUMyLVx1REVEQVx1REVEQy1cdURFRkFcdURFRkMtXHVERjE0XHVERjE2LVx1REYzNFx1REYzNi1cdURGNEVcdURGNTAtXHVERjZFXHVERjcwLVx1REY4OFx1REY4QS1cdURGQThcdURGQUEtXHVERkMyXHVERkM0LVx1REZDQlx1REZDRS1cdURGRkZdfFx1RDgzNltcdURFMDAtXHVERTM2XHVERTNCLVx1REU2Q1x1REU3NVx1REU4NFx1REU5Qi1cdURFOUZcdURFQTEtXHVERUFGXXxcdUQ4MzhbXHVEQzAwLVx1REMwNlx1REMwOC1cdURDMThcdURDMUItXHVEQzIxXHVEQzIzXHVEQzI0XHVEQzI2LVx1REMyQV18XHVEODNBW1x1REMwMC1cdURDQzRcdURDRDAtXHVEQ0Q2XHVERDAwLVx1REQ0QVx1REQ1MC1cdURENTldfFx1RDgzQltcdURFMDAtXHVERTAzXHVERTA1LVx1REUxRlx1REUyMVx1REUyMlx1REUyNFx1REUyN1x1REUyOS1cdURFMzJcdURFMzQtXHVERTM3XHVERTM5XHVERTNCXHVERTQyXHVERTQ3XHVERTQ5XHVERTRCXHVERTRELVx1REU0Rlx1REU1MVx1REU1Mlx1REU1NFx1REU1N1x1REU1OVx1REU1Qlx1REU1RFx1REU1Rlx1REU2MVx1REU2Mlx1REU2NFx1REU2Ny1cdURFNkFcdURFNkMtXHVERTcyXHVERTc0LVx1REU3N1x1REU3OS1cdURFN0NcdURFN0VcdURFODAtXHVERTg5XHVERThCLVx1REU5Qlx1REVBMS1cdURFQTNcdURFQTUtXHVERUE5XHVERUFCLVx1REVCQl18XHVEODY5W1x1REMwMC1cdURFRDZcdURGMDAtXHVERkZGXXxcdUQ4NkRbXHVEQzAwLVx1REYzNFx1REY0MC1cdURGRkZdfFx1RDg2RVtcdURDMDAtXHVEQzFEXHVEQzIwLVx1REZGRl18XHVEODczW1x1REMwMC1cdURFQTFdfFx1RDg3RVtcdURDMDAtXHVERTFEXXxcdURCNDBbXHVERDAwLVx1RERFRl0vCiAgICB9OwoKICAgIGZ1bmN0aW9uIGlzRGVjaW1hbERpZ2l0KGNoKSB7CiAgICAgICAgcmV0dXJuIDB4MzAgPD0gY2ggJiYgY2ggPD0gMHgzOTsgIC8vIDAuLjkKICAgIH0KCiAgICBmdW5jdGlvbiBpc0hleERpZ2l0KGNoKSB7CiAgICAgICAgcmV0dXJuIDB4MzAgPD0gY2ggJiYgY2ggPD0gMHgzOSB8fCAgLy8gMC4uOQogICAgICAgICAgICAweDYxIDw9IGNoICYmIGNoIDw9IDB4NjYgfHwgICAgIC8vIGEuLmYKICAgICAgICAgICAgMHg0MSA8PSBjaCAmJiBjaCA8PSAweDQ2OyAgICAgICAvLyBBLi5GCiAgICB9CgogICAgZnVuY3Rpb24gaXNPY3RhbERpZ2l0KGNoKSB7CiAgICAgICAgcmV0dXJuIGNoID49IDB4MzAgJiYgY2ggPD0gMHgzNzsgIC8vIDAuLjcKICAgIH0KCiAgICAvLyA3LjIgV2hpdGUgU3BhY2UKCiAgICBOT05fQVNDSUlfV0hJVEVTUEFDRVMgPSBbCiAgICAgICAgMHgxNjgwLAogICAgICAgIDB4MjAwMCwgMHgyMDAxLCAweDIwMDIsIDB4MjAwMywgMHgyMDA0LCAweDIwMDUsIDB4MjAwNiwgMHgyMDA3LCAweDIwMDgsIDB4MjAwOSwgMHgyMDBBLAogICAgICAgIDB4MjAyRiwgMHgyMDVGLAogICAgICAgIDB4MzAwMCwKICAgICAgICAweEZFRkYKICAgIF07CgogICAgZnVuY3Rpb24gaXNXaGl0ZVNwYWNlKGNoKSB7CiAgICAgICAgcmV0dXJuIGNoID09PSAweDIwIHx8IGNoID09PSAweDA5IHx8IGNoID09PSAweDBCIHx8IGNoID09PSAweDBDIHx8IGNoID09PSAweEEwIHx8CiAgICAgICAgICAgIGNoID49IDB4MTY4MCAmJiBOT05fQVNDSUlfV0hJVEVTUEFDRVMuaW5kZXhPZihjaCkgPj0gMDsKICAgIH0KCiAgICAvLyA3LjMgTGluZSBUZXJtaW5hdG9ycwoKICAgIGZ1bmN0aW9uIGlzTGluZVRlcm1pbmF0b3IoY2gpIHsKICAgICAgICByZXR1cm4gY2ggPT09IDB4MEEgfHwgY2ggPT09IDB4MEQgfHwgY2ggPT09IDB4MjAyOCB8fCBjaCA9PT0gMHgyMDI5OwogICAgfQoKICAgIC8vIDcuNiBJZGVudGlmaWVyIE5hbWVzIGFuZCBJZGVudGlmaWVycwoKICAgIGZ1bmN0aW9uIGZyb21Db2RlUG9pbnQoY3ApIHsKICAgICAgICBpZiAoY3AgPD0gMHhGRkZGKSB7IHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGNwKTsgfQogICAgICAgIHZhciBjdTEgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKE1hdGguZmxvb3IoKGNwIC0gMHgxMDAwMCkgLyAweDQwMCkgKyAweEQ4MDApOwogICAgICAgIHZhciBjdTIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoY3AgLSAweDEwMDAwKSAlIDB4NDAwKSArIDB4REMwMCk7CiAgICAgICAgcmV0dXJuIGN1MSArIGN1MjsKICAgIH0KCiAgICBJREVOVElGSUVSX1NUQVJUID0gbmV3IEFycmF5KDB4ODApOwogICAgZm9yKGNoID0gMDsgY2ggPCAweDgwOyArK2NoKSB7CiAgICAgICAgSURFTlRJRklFUl9TVEFSVFtjaF0gPQogICAgICAgICAgICBjaCA+PSAweDYxICYmIGNoIDw9IDB4N0EgfHwgIC8vIGEuLnoKICAgICAgICAgICAgY2ggPj0gMHg0MSAmJiBjaCA8PSAweDVBIHx8ICAvLyBBLi5aCiAgICAgICAgICAgIGNoID09PSAweDI0IHx8IGNoID09PSAweDVGOyAgLy8gJCAoZG9sbGFyKSBhbmQgXyAodW5kZXJzY29yZSkKICAgIH0KCiAgICBJREVOVElGSUVSX1BBUlQgPSBuZXcgQXJyYXkoMHg4MCk7CiAgICBmb3IoY2ggPSAwOyBjaCA8IDB4ODA7ICsrY2gpIHsKICAgICAgICBJREVOVElGSUVSX1BBUlRbY2hdID0KICAgICAgICAgICAgY2ggPj0gMHg2MSAmJiBjaCA8PSAweDdBIHx8ICAvLyBhLi56CiAgICAgICAgICAgIGNoID49IDB4NDEgJiYgY2ggPD0gMHg1QSB8fCAgLy8gQS4uWgogICAgICAgICAgICBjaCA+PSAweDMwICYmIGNoIDw9IDB4MzkgfHwgIC8vIDAuLjkKICAgICAgICAgICAgY2ggPT09IDB4MjQgfHwgY2ggPT09IDB4NUY7ICAvLyAkIChkb2xsYXIpIGFuZCBfICh1bmRlcnNjb3JlKQogICAgfQoKICAgIGZ1bmN0aW9uIGlzSWRlbnRpZmllclN0YXJ0RVM1KGNoKSB7CiAgICAgICAgcmV0dXJuIGNoIDwgMHg4MCA/IElERU5USUZJRVJfU1RBUlRbY2hdIDogRVM1UmVnZXguTm9uQXNjaWlJZGVudGlmaWVyU3RhcnQudGVzdChmcm9tQ29kZVBvaW50KGNoKSk7CiAgICB9CgogICAgZnVuY3Rpb24gaXNJZGVudGlmaWVyUGFydEVTNShjaCkgewogICAgICAgIHJldHVybiBjaCA8IDB4ODAgPyBJREVOVElGSUVSX1BBUlRbY2hdIDogRVM1UmVnZXguTm9uQXNjaWlJZGVudGlmaWVyUGFydC50ZXN0KGZyb21Db2RlUG9pbnQoY2gpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0lkZW50aWZpZXJTdGFydEVTNihjaCkgewogICAgICAgIHJldHVybiBjaCA8IDB4ODAgPyBJREVOVElGSUVSX1NUQVJUW2NoXSA6IEVTNlJlZ2V4Lk5vbkFzY2lpSWRlbnRpZmllclN0YXJ0LnRlc3QoZnJvbUNvZGVQb2ludChjaCkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzSWRlbnRpZmllclBhcnRFUzYoY2gpIHsKICAgICAgICByZXR1cm4gY2ggPCAweDgwID8gSURFTlRJRklFUl9QQVJUW2NoXSA6IEVTNlJlZ2V4Lk5vbkFzY2lpSWRlbnRpZmllclBhcnQudGVzdChmcm9tQ29kZVBvaW50KGNoKSk7CiAgICB9CgogICAgY29kZSQxLmV4cG9ydHMgPSB7CiAgICAgICAgaXNEZWNpbWFsRGlnaXQ6IGlzRGVjaW1hbERpZ2l0LAogICAgICAgIGlzSGV4RGlnaXQ6IGlzSGV4RGlnaXQsCiAgICAgICAgaXNPY3RhbERpZ2l0OiBpc09jdGFsRGlnaXQsCiAgICAgICAgaXNXaGl0ZVNwYWNlOiBpc1doaXRlU3BhY2UsCiAgICAgICAgaXNMaW5lVGVybWluYXRvcjogaXNMaW5lVGVybWluYXRvciwKICAgICAgICBpc0lkZW50aWZpZXJTdGFydEVTNTogaXNJZGVudGlmaWVyU3RhcnRFUzUsCiAgICAgICAgaXNJZGVudGlmaWVyUGFydEVTNTogaXNJZGVudGlmaWVyUGFydEVTNSwKICAgICAgICBpc0lkZW50aWZpZXJTdGFydEVTNjogaXNJZGVudGlmaWVyU3RhcnRFUzYsCiAgICAgICAgaXNJZGVudGlmaWVyUGFydEVTNjogaXNJZGVudGlmaWVyUGFydEVTNgogICAgfTsKfSgpKTsKLyogdmltOiBzZXQgc3c9NCB0cz00IGV0IHR3PTgwIDogKi8KCnZhciBjb2RlRXhwb3J0cyA9IGNvZGUkMS5leHBvcnRzOwoKdmFyIGtleXdvcmQkMSA9IHtleHBvcnRzOiB7fX07CgovKgogIENvcHlyaWdodCAoQykgMjAxMyBZdXN1a2UgU3V6dWtpIDx1dGF0YW5lLnRlYUBnbWFpbC5jb20+CgogIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dAogIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OgoKICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQKICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLgogICAgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodAogICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlCiAgICAgIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uCgogIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgIkFTIElTIgogIEFORCBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUKICBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRQogIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCA8Q09QWVJJR0hUIEhPTERFUj4gQkUgTElBQkxFIEZPUiBBTlkKICBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUwogIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsKICBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQKICBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVAogIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRgogIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCiovCgooZnVuY3Rpb24gKCkgewoKICAgIHZhciBjb2RlID0gY29kZUV4cG9ydHM7CgogICAgZnVuY3Rpb24gaXNTdHJpY3RNb2RlUmVzZXJ2ZWRXb3JkRVM2KGlkKSB7CiAgICAgICAgc3dpdGNoIChpZCkgewogICAgICAgIGNhc2UgJ2ltcGxlbWVudHMnOgogICAgICAgIGNhc2UgJ2ludGVyZmFjZSc6CiAgICAgICAgY2FzZSAncGFja2FnZSc6CiAgICAgICAgY2FzZSAncHJpdmF0ZSc6CiAgICAgICAgY2FzZSAncHJvdGVjdGVkJzoKICAgICAgICBjYXNlICdwdWJsaWMnOgogICAgICAgIGNhc2UgJ3N0YXRpYyc6CiAgICAgICAgY2FzZSAnbGV0JzoKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBpc0tleXdvcmRFUzUoaWQsIHN0cmljdCkgewogICAgICAgIC8vIHlpZWxkIHNob3VsZCBub3QgYmUgdHJlYXRlZCBhcyBrZXl3b3JkIHVuZGVyIG5vbi1zdHJpY3QgbW9kZS4KICAgICAgICBpZiAoIXN0cmljdCAmJiBpZCA9PT0gJ3lpZWxkJykgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpc0tleXdvcmRFUzYoaWQsIHN0cmljdCk7CiAgICB9CgogICAgZnVuY3Rpb24gaXNLZXl3b3JkRVM2KGlkLCBzdHJpY3QpIHsKICAgICAgICBpZiAoc3RyaWN0ICYmIGlzU3RyaWN0TW9kZVJlc2VydmVkV29yZEVTNihpZCkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBzd2l0Y2ggKGlkLmxlbmd0aCkgewogICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgcmV0dXJuIChpZCA9PT0gJ2lmJykgfHwgKGlkID09PSAnaW4nKSB8fCAoaWQgPT09ICdkbycpOwogICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgcmV0dXJuIChpZCA9PT0gJ3ZhcicpIHx8IChpZCA9PT0gJ2ZvcicpIHx8IChpZCA9PT0gJ25ldycpIHx8IChpZCA9PT0gJ3RyeScpOwogICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgcmV0dXJuIChpZCA9PT0gJ3RoaXMnKSB8fCAoaWQgPT09ICdlbHNlJykgfHwgKGlkID09PSAnY2FzZScpIHx8CiAgICAgICAgICAgICAgICAoaWQgPT09ICd2b2lkJykgfHwgKGlkID09PSAnd2l0aCcpIHx8IChpZCA9PT0gJ2VudW0nKTsKICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgIHJldHVybiAoaWQgPT09ICd3aGlsZScpIHx8IChpZCA9PT0gJ2JyZWFrJykgfHwgKGlkID09PSAnY2F0Y2gnKSB8fAogICAgICAgICAgICAgICAgKGlkID09PSAndGhyb3cnKSB8fCAoaWQgPT09ICdjb25zdCcpIHx8IChpZCA9PT0gJ3lpZWxkJykgfHwKICAgICAgICAgICAgICAgIChpZCA9PT0gJ2NsYXNzJykgfHwgKGlkID09PSAnc3VwZXInKTsKICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgIHJldHVybiAoaWQgPT09ICdyZXR1cm4nKSB8fCAoaWQgPT09ICd0eXBlb2YnKSB8fCAoaWQgPT09ICdkZWxldGUnKSB8fAogICAgICAgICAgICAgICAgKGlkID09PSAnc3dpdGNoJykgfHwgKGlkID09PSAnZXhwb3J0JykgfHwgKGlkID09PSAnaW1wb3J0Jyk7CiAgICAgICAgY2FzZSA3OgogICAgICAgICAgICByZXR1cm4gKGlkID09PSAnZGVmYXVsdCcpIHx8IChpZCA9PT0gJ2ZpbmFsbHknKSB8fCAoaWQgPT09ICdleHRlbmRzJyk7CiAgICAgICAgY2FzZSA4OgogICAgICAgICAgICByZXR1cm4gKGlkID09PSAnZnVuY3Rpb24nKSB8fCAoaWQgPT09ICdjb250aW51ZScpIHx8IChpZCA9PT0gJ2RlYnVnZ2VyJyk7CiAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgcmV0dXJuIChpZCA9PT0gJ2luc3RhbmNlb2YnKTsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGlzUmVzZXJ2ZWRXb3JkRVM1KGlkLCBzdHJpY3QpIHsKICAgICAgICByZXR1cm4gaWQgPT09ICdudWxsJyB8fCBpZCA9PT0gJ3RydWUnIHx8IGlkID09PSAnZmFsc2UnIHx8IGlzS2V5d29yZEVTNShpZCwgc3RyaWN0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc1Jlc2VydmVkV29yZEVTNihpZCwgc3RyaWN0KSB7CiAgICAgICAgcmV0dXJuIGlkID09PSAnbnVsbCcgfHwgaWQgPT09ICd0cnVlJyB8fCBpZCA9PT0gJ2ZhbHNlJyB8fCBpc0tleXdvcmRFUzYoaWQsIHN0cmljdCk7CiAgICB9CgogICAgZnVuY3Rpb24gaXNSZXN0cmljdGVkV29yZChpZCkgewogICAgICAgIHJldHVybiBpZCA9PT0gJ2V2YWwnIHx8IGlkID09PSAnYXJndW1lbnRzJzsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0lkZW50aWZpZXJOYW1lRVM1KGlkKSB7CiAgICAgICAgdmFyIGksIGl6LCBjaDsKCiAgICAgICAgaWYgKGlkLmxlbmd0aCA9PT0gMCkgeyByZXR1cm4gZmFsc2U7IH0KCiAgICAgICAgY2ggPSBpZC5jaGFyQ29kZUF0KDApOwogICAgICAgIGlmICghY29kZS5pc0lkZW50aWZpZXJTdGFydEVTNShjaCkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgZm9yIChpID0gMSwgaXogPSBpZC5sZW5ndGg7IGkgPCBpejsgKytpKSB7CiAgICAgICAgICAgIGNoID0gaWQuY2hhckNvZGVBdChpKTsKICAgICAgICAgICAgaWYgKCFjb2RlLmlzSWRlbnRpZmllclBhcnRFUzUoY2gpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gZGVjb2RlVXRmMTYobGVhZCwgdHJhaWwpIHsKICAgICAgICByZXR1cm4gKGxlYWQgLSAweEQ4MDApICogMHg0MDAgKyAodHJhaWwgLSAweERDMDApICsgMHgxMDAwMDsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0lkZW50aWZpZXJOYW1lRVM2KGlkKSB7CiAgICAgICAgdmFyIGksIGl6LCBjaCwgbG93Q2gsIGNoZWNrOwoKICAgICAgICBpZiAoaWQubGVuZ3RoID09PSAwKSB7IHJldHVybiBmYWxzZTsgfQoKICAgICAgICBjaGVjayA9IGNvZGUuaXNJZGVudGlmaWVyU3RhcnRFUzY7CiAgICAgICAgZm9yIChpID0gMCwgaXogPSBpZC5sZW5ndGg7IGkgPCBpejsgKytpKSB7CiAgICAgICAgICAgIGNoID0gaWQuY2hhckNvZGVBdChpKTsKICAgICAgICAgICAgaWYgKDB4RDgwMCA8PSBjaCAmJiBjaCA8PSAweERCRkYpIHsKICAgICAgICAgICAgICAgICsraTsKICAgICAgICAgICAgICAgIGlmIChpID49IGl6KSB7IHJldHVybiBmYWxzZTsgfQogICAgICAgICAgICAgICAgbG93Q2ggPSBpZC5jaGFyQ29kZUF0KGkpOwogICAgICAgICAgICAgICAgaWYgKCEoMHhEQzAwIDw9IGxvd0NoICYmIGxvd0NoIDw9IDB4REZGRikpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjaCA9IGRlY29kZVV0ZjE2KGNoLCBsb3dDaCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFjaGVjayhjaCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjaGVjayA9IGNvZGUuaXNJZGVudGlmaWVyUGFydEVTNjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gaXNJZGVudGlmaWVyRVM1KGlkLCBzdHJpY3QpIHsKICAgICAgICByZXR1cm4gaXNJZGVudGlmaWVyTmFtZUVTNShpZCkgJiYgIWlzUmVzZXJ2ZWRXb3JkRVM1KGlkLCBzdHJpY3QpOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzSWRlbnRpZmllckVTNihpZCwgc3RyaWN0KSB7CiAgICAgICAgcmV0dXJuIGlzSWRlbnRpZmllck5hbWVFUzYoaWQpICYmICFpc1Jlc2VydmVkV29yZEVTNihpZCwgc3RyaWN0KTsKICAgIH0KCiAgICBrZXl3b3JkJDEuZXhwb3J0cyA9IHsKICAgICAgICBpc0tleXdvcmRFUzU6IGlzS2V5d29yZEVTNSwKICAgICAgICBpc0tleXdvcmRFUzY6IGlzS2V5d29yZEVTNiwKICAgICAgICBpc1Jlc2VydmVkV29yZEVTNTogaXNSZXNlcnZlZFdvcmRFUzUsCiAgICAgICAgaXNSZXNlcnZlZFdvcmRFUzY6IGlzUmVzZXJ2ZWRXb3JkRVM2LAogICAgICAgIGlzUmVzdHJpY3RlZFdvcmQ6IGlzUmVzdHJpY3RlZFdvcmQsCiAgICAgICAgaXNJZGVudGlmaWVyTmFtZUVTNTogaXNJZGVudGlmaWVyTmFtZUVTNSwKICAgICAgICBpc0lkZW50aWZpZXJOYW1lRVM2OiBpc0lkZW50aWZpZXJOYW1lRVM2LAogICAgICAgIGlzSWRlbnRpZmllckVTNTogaXNJZGVudGlmaWVyRVM1LAogICAgICAgIGlzSWRlbnRpZmllckVTNjogaXNJZGVudGlmaWVyRVM2CiAgICB9Owp9KCkpOwovKiB2aW06IHNldCBzdz00IHRzPTQgZXQgdHc9ODAgOiAqLwoKdmFyIGtleXdvcmRFeHBvcnRzID0ga2V5d29yZCQxLmV4cG9ydHM7CgovKgogIENvcHlyaWdodCAoQykgMjAxMyBZdXN1a2UgU3V6dWtpIDx1dGF0YW5lLnRlYUBnbWFpbC5jb20+CgogIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dAogIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OgoKICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQKICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLgogICAgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodAogICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlCiAgICAgIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uCgogIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgIkFTIElTIgogIEFORCBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUKICBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRQogIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCA8Q09QWVJJR0hUIEhPTERFUj4gQkUgTElBQkxFIEZPUiBBTlkKICBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUwogIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsKICBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQKICBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVAogIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRgogIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCiovCihmdW5jdGlvbiAoKSB7CgogICAgdXRpbHMuYXN0ID0gYXN0RXhwb3J0czsKICAgIHV0aWxzLmNvZGUgPSBjb2RlRXhwb3J0czsKICAgIHV0aWxzLmtleXdvcmQgPSBrZXl3b3JkRXhwb3J0czsKfSgpKTsKCnZhciBzb3VyY2VNYXAgPSB7fTsKCnZhciBzb3VyY2VNYXBHZW5lcmF0b3IgPSB7fTsKCnZhciBiYXNlNjRWbHEkMSA9IHt9OwoKdmFyIGJhc2U2NCQyID0ge307CgovKiAtKi0gTW9kZToganM7IGpzLWluZGVudC1sZXZlbDogMjsgLSotICovCgp2YXIgaGFzUmVxdWlyZWRCYXNlNjQ7CgpmdW5jdGlvbiByZXF1aXJlQmFzZTY0ICgpIHsKCWlmIChoYXNSZXF1aXJlZEJhc2U2NCkgcmV0dXJuIGJhc2U2NCQyOwoJaGFzUmVxdWlyZWRCYXNlNjQgPSAxOwoJLyoKCSAqIENvcHlyaWdodCAyMDExIE1vemlsbGEgRm91bmRhdGlvbiBhbmQgY29udHJpYnV0b3JzCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgTmV3IEJTRCBsaWNlbnNlLiBTZWUgTElDRU5TRSBvcjoKCSAqIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9CU0QtMy1DbGF1c2UKCSAqLwoKCXZhciBpbnRUb0NoYXJNYXAgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLycuc3BsaXQoJycpOwoKCS8qKgoJICogRW5jb2RlIGFuIGludGVnZXIgaW4gdGhlIHJhbmdlIG9mIDAgdG8gNjMgdG8gYSBzaW5nbGUgYmFzZSA2NCBkaWdpdC4KCSAqLwoJYmFzZTY0JDIuZW5jb2RlID0gZnVuY3Rpb24gKG51bWJlcikgewoJICBpZiAoMCA8PSBudW1iZXIgJiYgbnVtYmVyIDwgaW50VG9DaGFyTWFwLmxlbmd0aCkgewoJICAgIHJldHVybiBpbnRUb0NoYXJNYXBbbnVtYmVyXTsKCSAgfQoJICB0aHJvdyBuZXcgVHlwZUVycm9yKCJNdXN0IGJlIGJldHdlZW4gMCBhbmQgNjM6ICIgKyBudW1iZXIpOwoJfTsKCgkvKioKCSAqIERlY29kZSBhIHNpbmdsZSBiYXNlIDY0IGNoYXJhY3RlciBjb2RlIGRpZ2l0IHRvIGFuIGludGVnZXIuIFJldHVybnMgLTEgb24KCSAqIGZhaWx1cmUuCgkgKi8KCWJhc2U2NCQyLmRlY29kZSA9IGZ1bmN0aW9uIChjaGFyQ29kZSkgewoJICB2YXIgYmlnQSA9IDY1OyAgICAgLy8gJ0EnCgkgIHZhciBiaWdaID0gOTA7ICAgICAvLyAnWicKCgkgIHZhciBsaXR0bGVBID0gOTc7ICAvLyAnYScKCSAgdmFyIGxpdHRsZVogPSAxMjI7IC8vICd6JwoKCSAgdmFyIHplcm8gPSA0ODsgICAgIC8vICcwJwoJICB2YXIgbmluZSA9IDU3OyAgICAgLy8gJzknCgoJICB2YXIgcGx1cyA9IDQzOyAgICAgLy8gJysnCgkgIHZhciBzbGFzaCA9IDQ3OyAgICAvLyAnLycKCgkgIHZhciBsaXR0bGVPZmZzZXQgPSAyNjsKCSAgdmFyIG51bWJlck9mZnNldCA9IDUyOwoKCSAgLy8gMCAtIDI1OiBBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWgoJICBpZiAoYmlnQSA8PSBjaGFyQ29kZSAmJiBjaGFyQ29kZSA8PSBiaWdaKSB7CgkgICAgcmV0dXJuIChjaGFyQ29kZSAtIGJpZ0EpOwoJICB9CgoJICAvLyAyNiAtIDUxOiBhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5egoJICBpZiAobGl0dGxlQSA8PSBjaGFyQ29kZSAmJiBjaGFyQ29kZSA8PSBsaXR0bGVaKSB7CgkgICAgcmV0dXJuIChjaGFyQ29kZSAtIGxpdHRsZUEgKyBsaXR0bGVPZmZzZXQpOwoJICB9CgoJICAvLyA1MiAtIDYxOiAwMTIzNDU2Nzg5CgkgIGlmICh6ZXJvIDw9IGNoYXJDb2RlICYmIGNoYXJDb2RlIDw9IG5pbmUpIHsKCSAgICByZXR1cm4gKGNoYXJDb2RlIC0gemVybyArIG51bWJlck9mZnNldCk7CgkgIH0KCgkgIC8vIDYyOiArCgkgIGlmIChjaGFyQ29kZSA9PSBwbHVzKSB7CgkgICAgcmV0dXJuIDYyOwoJICB9CgoJICAvLyA2MzogLwoJICBpZiAoY2hhckNvZGUgPT0gc2xhc2gpIHsKCSAgICByZXR1cm4gNjM7CgkgIH0KCgkgIC8vIEludmFsaWQgYmFzZTY0IGRpZ2l0LgoJICByZXR1cm4gLTE7Cgl9OwoJcmV0dXJuIGJhc2U2NCQyOwp9CgovKiAtKi0gTW9kZToganM7IGpzLWluZGVudC1sZXZlbDogMjsgLSotICovCgp2YXIgaGFzUmVxdWlyZWRCYXNlNjRWbHE7CgpmdW5jdGlvbiByZXF1aXJlQmFzZTY0VmxxICgpIHsKCWlmIChoYXNSZXF1aXJlZEJhc2U2NFZscSkgcmV0dXJuIGJhc2U2NFZscSQxOwoJaGFzUmVxdWlyZWRCYXNlNjRWbHEgPSAxOwoJLyoKCSAqIENvcHlyaWdodCAyMDExIE1vemlsbGEgRm91bmRhdGlvbiBhbmQgY29udHJpYnV0b3JzCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgTmV3IEJTRCBsaWNlbnNlLiBTZWUgTElDRU5TRSBvcjoKCSAqIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9CU0QtMy1DbGF1c2UKCSAqCgkgKiBCYXNlZCBvbiB0aGUgQmFzZSA2NCBWTFEgaW1wbGVtZW50YXRpb24gaW4gQ2xvc3VyZSBDb21waWxlcjoKCSAqIGh0dHBzOi8vY29kZS5nb29nbGUuY29tL3AvY2xvc3VyZS1jb21waWxlci9zb3VyY2UvYnJvd3NlL3RydW5rL3NyYy9jb20vZ29vZ2xlL2RlYnVnZ2luZy9zb3VyY2VtYXAvQmFzZTY0VkxRLmphdmEKCSAqCgkgKiBDb3B5cmlnaHQgMjAxMSBUaGUgQ2xvc3VyZSBDb21waWxlciBBdXRob3JzLiBBbGwgcmlnaHRzIHJlc2VydmVkLgoJICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0CgkgKiBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlCgkgKiBtZXQ6CgkgKgoJICogICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQKCSAqICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KCSAqICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUKCSAqICAgIGNvcHlyaWdodCBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nCgkgKiAgICBkaXNjbGFpbWVyIGluIHRoZSBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQKCSAqICAgIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4KCSAqICAqIE5laXRoZXIgdGhlIG5hbWUgb2YgR29vZ2xlIEluYy4gbm9yIHRoZSBuYW1lcyBvZiBpdHMKCSAqICAgIGNvbnRyaWJ1dG9ycyBtYXkgYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHMgZGVyaXZlZAoJICogICAgZnJvbSB0aGlzIHNvZnR3YXJlIHdpdGhvdXQgc3BlY2lmaWMgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uLgoJICoKCSAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMKCSAqICJBUyBJUyIgQU5EIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UCgkgKiBMSU1JVEVEIFRPLCBUSEUgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IKCSAqIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUCgkgKiBPV05FUiBPUiBDT05UUklCVVRPUlMgQkUgTElBQkxFIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwKCSAqIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QKCSAqIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7IExPU1MgT0YgVVNFLAoJICogREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZCgkgKiBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUCgkgKiAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UKCSAqIE9GIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCgkgKi8KCgl2YXIgYmFzZTY0ID0gcmVxdWlyZUJhc2U2NCgpOwoKCS8vIEEgc2luZ2xlIGJhc2UgNjQgZGlnaXQgY2FuIGNvbnRhaW4gNiBiaXRzIG9mIGRhdGEuIEZvciB0aGUgYmFzZSA2NCB2YXJpYWJsZQoJLy8gbGVuZ3RoIHF1YW50aXRpZXMgd2UgdXNlIGluIHRoZSBzb3VyY2UgbWFwIHNwZWMsIHRoZSBmaXJzdCBiaXQgaXMgdGhlIHNpZ24sCgkvLyB0aGUgbmV4dCBmb3VyIGJpdHMgYXJlIHRoZSBhY3R1YWwgdmFsdWUsIGFuZCB0aGUgNnRoIGJpdCBpcyB0aGUKCS8vIGNvbnRpbnVhdGlvbiBiaXQuIFRoZSBjb250aW51YXRpb24gYml0IHRlbGxzIHVzIHdoZXRoZXIgdGhlcmUgYXJlIG1vcmUKCS8vIGRpZ2l0cyBpbiB0aGlzIHZhbHVlIGZvbGxvd2luZyB0aGlzIGRpZ2l0LgoJLy8KCS8vICAgQ29udGludWF0aW9uCgkvLyAgIHwgICAgU2lnbgoJLy8gICB8ICAgIHwKCS8vICAgViAgICBWCgkvLyAgIDEwMTAxMQoKCXZhciBWTFFfQkFTRV9TSElGVCA9IDU7CgoJLy8gYmluYXJ5OiAxMDAwMDAKCXZhciBWTFFfQkFTRSA9IDEgPDwgVkxRX0JBU0VfU0hJRlQ7CgoJLy8gYmluYXJ5OiAwMTExMTEKCXZhciBWTFFfQkFTRV9NQVNLID0gVkxRX0JBU0UgLSAxOwoKCS8vIGJpbmFyeTogMTAwMDAwCgl2YXIgVkxRX0NPTlRJTlVBVElPTl9CSVQgPSBWTFFfQkFTRTsKCgkvKioKCSAqIENvbnZlcnRzIGZyb20gYSB0d28tY29tcGxlbWVudCB2YWx1ZSB0byBhIHZhbHVlIHdoZXJlIHRoZSBzaWduIGJpdCBpcwoJICogcGxhY2VkIGluIHRoZSBsZWFzdCBzaWduaWZpY2FudCBiaXQuICBGb3IgZXhhbXBsZSwgYXMgZGVjaW1hbHM6CgkgKiAgIDEgYmVjb21lcyAyICgxMCBiaW5hcnkpLCAtMSBiZWNvbWVzIDMgKDExIGJpbmFyeSkKCSAqICAgMiBiZWNvbWVzIDQgKDEwMCBiaW5hcnkpLCAtMiBiZWNvbWVzIDUgKDEwMSBiaW5hcnkpCgkgKi8KCWZ1bmN0aW9uIHRvVkxRU2lnbmVkKGFWYWx1ZSkgewoJICByZXR1cm4gYVZhbHVlIDwgMAoJICAgID8gKCgtYVZhbHVlKSA8PCAxKSArIDEKCSAgICA6IChhVmFsdWUgPDwgMSkgKyAwOwoJfQoKCS8qKgoJICogQ29udmVydHMgdG8gYSB0d28tY29tcGxlbWVudCB2YWx1ZSBmcm9tIGEgdmFsdWUgd2hlcmUgdGhlIHNpZ24gYml0IGlzCgkgKiBwbGFjZWQgaW4gdGhlIGxlYXN0IHNpZ25pZmljYW50IGJpdC4gIEZvciBleGFtcGxlLCBhcyBkZWNpbWFsczoKCSAqICAgMiAoMTAgYmluYXJ5KSBiZWNvbWVzIDEsIDMgKDExIGJpbmFyeSkgYmVjb21lcyAtMQoJICogICA0ICgxMDAgYmluYXJ5KSBiZWNvbWVzIDIsIDUgKDEwMSBiaW5hcnkpIGJlY29tZXMgLTIKCSAqLwoJZnVuY3Rpb24gZnJvbVZMUVNpZ25lZChhVmFsdWUpIHsKCSAgdmFyIGlzTmVnYXRpdmUgPSAoYVZhbHVlICYgMSkgPT09IDE7CgkgIHZhciBzaGlmdGVkID0gYVZhbHVlID4+IDE7CgkgIHJldHVybiBpc05lZ2F0aXZlCgkgICAgPyAtc2hpZnRlZAoJICAgIDogc2hpZnRlZDsKCX0KCgkvKioKCSAqIFJldHVybnMgdGhlIGJhc2UgNjQgVkxRIGVuY29kZWQgdmFsdWUuCgkgKi8KCWJhc2U2NFZscSQxLmVuY29kZSA9IGZ1bmN0aW9uIGJhc2U2NFZMUV9lbmNvZGUoYVZhbHVlKSB7CgkgIHZhciBlbmNvZGVkID0gIiI7CgkgIHZhciBkaWdpdDsKCgkgIHZhciB2bHEgPSB0b1ZMUVNpZ25lZChhVmFsdWUpOwoKCSAgZG8gewoJICAgIGRpZ2l0ID0gdmxxICYgVkxRX0JBU0VfTUFTSzsKCSAgICB2bHEgPj4+PSBWTFFfQkFTRV9TSElGVDsKCSAgICBpZiAodmxxID4gMCkgewoJICAgICAgLy8gVGhlcmUgYXJlIHN0aWxsIG1vcmUgZGlnaXRzIGluIHRoaXMgdmFsdWUsIHNvIHdlIG11c3QgbWFrZSBzdXJlIHRoZQoJICAgICAgLy8gY29udGludWF0aW9uIGJpdCBpcyBtYXJrZWQuCgkgICAgICBkaWdpdCB8PSBWTFFfQ09OVElOVUFUSU9OX0JJVDsKCSAgICB9CgkgICAgZW5jb2RlZCArPSBiYXNlNjQuZW5jb2RlKGRpZ2l0KTsKCSAgfSB3aGlsZSAodmxxID4gMCk7CgoJICByZXR1cm4gZW5jb2RlZDsKCX07CgoJLyoqCgkgKiBEZWNvZGVzIHRoZSBuZXh0IGJhc2UgNjQgVkxRIHZhbHVlIGZyb20gdGhlIGdpdmVuIHN0cmluZyBhbmQgcmV0dXJucyB0aGUKCSAqIHZhbHVlIGFuZCB0aGUgcmVzdCBvZiB0aGUgc3RyaW5nIHZpYSB0aGUgb3V0IHBhcmFtZXRlci4KCSAqLwoJYmFzZTY0VmxxJDEuZGVjb2RlID0gZnVuY3Rpb24gYmFzZTY0VkxRX2RlY29kZShhU3RyLCBhSW5kZXgsIGFPdXRQYXJhbSkgewoJICB2YXIgc3RyTGVuID0gYVN0ci5sZW5ndGg7CgkgIHZhciByZXN1bHQgPSAwOwoJICB2YXIgc2hpZnQgPSAwOwoJICB2YXIgY29udGludWF0aW9uLCBkaWdpdDsKCgkgIGRvIHsKCSAgICBpZiAoYUluZGV4ID49IHN0ckxlbikgewoJICAgICAgdGhyb3cgbmV3IEVycm9yKCJFeHBlY3RlZCBtb3JlIGRpZ2l0cyBpbiBiYXNlIDY0IFZMUSB2YWx1ZS4iKTsKCSAgICB9CgoJICAgIGRpZ2l0ID0gYmFzZTY0LmRlY29kZShhU3RyLmNoYXJDb2RlQXQoYUluZGV4KyspKTsKCSAgICBpZiAoZGlnaXQgPT09IC0xKSB7CgkgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgYmFzZTY0IGRpZ2l0OiAiICsgYVN0ci5jaGFyQXQoYUluZGV4IC0gMSkpOwoJICAgIH0KCgkgICAgY29udGludWF0aW9uID0gISEoZGlnaXQgJiBWTFFfQ09OVElOVUFUSU9OX0JJVCk7CgkgICAgZGlnaXQgJj0gVkxRX0JBU0VfTUFTSzsKCSAgICByZXN1bHQgPSByZXN1bHQgKyAoZGlnaXQgPDwgc2hpZnQpOwoJICAgIHNoaWZ0ICs9IFZMUV9CQVNFX1NISUZUOwoJICB9IHdoaWxlIChjb250aW51YXRpb24pOwoKCSAgYU91dFBhcmFtLnZhbHVlID0gZnJvbVZMUVNpZ25lZChyZXN1bHQpOwoJICBhT3V0UGFyYW0ucmVzdCA9IGFJbmRleDsKCX07CglyZXR1cm4gYmFzZTY0VmxxJDE7Cn0KCnZhciB1dGlsJDQgPSB7fTsKCi8qIC0qLSBNb2RlOiBqczsganMtaW5kZW50LWxldmVsOiAyOyAtKi0gKi8KCnZhciBoYXNSZXF1aXJlZFV0aWw7CgpmdW5jdGlvbiByZXF1aXJlVXRpbCAoKSB7CglpZiAoaGFzUmVxdWlyZWRVdGlsKSByZXR1cm4gdXRpbCQ0OwoJaGFzUmVxdWlyZWRVdGlsID0gMTsKCShmdW5jdGlvbiAoZXhwb3J0cykgewoJCS8qCgkJICogQ29weXJpZ2h0IDIwMTEgTW96aWxsYSBGb3VuZGF0aW9uIGFuZCBjb250cmlidXRvcnMKCQkgKiBMaWNlbnNlZCB1bmRlciB0aGUgTmV3IEJTRCBsaWNlbnNlLiBTZWUgTElDRU5TRSBvcjoKCQkgKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvQlNELTMtQ2xhdXNlCgkJICovCgoJCS8qKgoJCSAqIFRoaXMgaXMgYSBoZWxwZXIgZnVuY3Rpb24gZm9yIGdldHRpbmcgdmFsdWVzIGZyb20gcGFyYW1ldGVyL29wdGlvbnMKCQkgKiBvYmplY3RzLgoJCSAqCgkJICogQHBhcmFtIGFyZ3MgVGhlIG9iamVjdCB3ZSBhcmUgZXh0cmFjdGluZyB2YWx1ZXMgZnJvbQoJCSAqIEBwYXJhbSBuYW1lIFRoZSBuYW1lIG9mIHRoZSBwcm9wZXJ0eSB3ZSBhcmUgZ2V0dGluZy4KCQkgKiBAcGFyYW0gZGVmYXVsdFZhbHVlIEFuIG9wdGlvbmFsIHZhbHVlIHRvIHJldHVybiBpZiB0aGUgcHJvcGVydHkgaXMgbWlzc2luZwoJCSAqIGZyb20gdGhlIG9iamVjdC4gSWYgdGhpcyBpcyBub3Qgc3BlY2lmaWVkIGFuZCB0aGUgcHJvcGVydHkgaXMgbWlzc2luZywgYW4KCQkgKiBlcnJvciB3aWxsIGJlIHRocm93bi4KCQkgKi8KCQlmdW5jdGlvbiBnZXRBcmcoYUFyZ3MsIGFOYW1lLCBhRGVmYXVsdFZhbHVlKSB7CgkJICBpZiAoYU5hbWUgaW4gYUFyZ3MpIHsKCQkgICAgcmV0dXJuIGFBcmdzW2FOYW1lXTsKCQkgIH0gZWxzZSBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMykgewoJCSAgICByZXR1cm4gYURlZmF1bHRWYWx1ZTsKCQkgIH0gZWxzZSB7CgkJICAgIHRocm93IG5ldyBFcnJvcignIicgKyBhTmFtZSArICciIGlzIGEgcmVxdWlyZWQgYXJndW1lbnQuJyk7CgkJICB9CgkJfQoJCWV4cG9ydHMuZ2V0QXJnID0gZ2V0QXJnOwoKCQl2YXIgdXJsUmVnZXhwID0gL14oPzooW1x3K1wtLl0rKTopP1wvXC8oPzooXHcrOlx3KylAKT8oW1x3Li1dKikoPzo6KFxkKykpPyguKikkLzsKCQl2YXIgZGF0YVVybFJlZ2V4cCA9IC9eZGF0YTouK1wsLiskLzsKCgkJZnVuY3Rpb24gdXJsUGFyc2UoYVVybCkgewoJCSAgdmFyIG1hdGNoID0gYVVybC5tYXRjaCh1cmxSZWdleHApOwoJCSAgaWYgKCFtYXRjaCkgewoJCSAgICByZXR1cm4gbnVsbDsKCQkgIH0KCQkgIHJldHVybiB7CgkJICAgIHNjaGVtZTogbWF0Y2hbMV0sCgkJICAgIGF1dGg6IG1hdGNoWzJdLAoJCSAgICBob3N0OiBtYXRjaFszXSwKCQkgICAgcG9ydDogbWF0Y2hbNF0sCgkJICAgIHBhdGg6IG1hdGNoWzVdCgkJICB9OwoJCX0KCQlleHBvcnRzLnVybFBhcnNlID0gdXJsUGFyc2U7CgoJCWZ1bmN0aW9uIHVybEdlbmVyYXRlKGFQYXJzZWRVcmwpIHsKCQkgIHZhciB1cmwgPSAnJzsKCQkgIGlmIChhUGFyc2VkVXJsLnNjaGVtZSkgewoJCSAgICB1cmwgKz0gYVBhcnNlZFVybC5zY2hlbWUgKyAnOic7CgkJICB9CgkJICB1cmwgKz0gJy8vJzsKCQkgIGlmIChhUGFyc2VkVXJsLmF1dGgpIHsKCQkgICAgdXJsICs9IGFQYXJzZWRVcmwuYXV0aCArICdAJzsKCQkgIH0KCQkgIGlmIChhUGFyc2VkVXJsLmhvc3QpIHsKCQkgICAgdXJsICs9IGFQYXJzZWRVcmwuaG9zdDsKCQkgIH0KCQkgIGlmIChhUGFyc2VkVXJsLnBvcnQpIHsKCQkgICAgdXJsICs9ICI6IiArIGFQYXJzZWRVcmwucG9ydDsKCQkgIH0KCQkgIGlmIChhUGFyc2VkVXJsLnBhdGgpIHsKCQkgICAgdXJsICs9IGFQYXJzZWRVcmwucGF0aDsKCQkgIH0KCQkgIHJldHVybiB1cmw7CgkJfQoJCWV4cG9ydHMudXJsR2VuZXJhdGUgPSB1cmxHZW5lcmF0ZTsKCgkJLyoqCgkJICogTm9ybWFsaXplcyBhIHBhdGgsIG9yIHRoZSBwYXRoIHBvcnRpb24gb2YgYSBVUkw6CgkJICoKCQkgKiAtIFJlcGxhY2VzIGNvbnNlY3V0aXZlIHNsYXNoZXMgd2l0aCBvbmUgc2xhc2guCgkJICogLSBSZW1vdmVzIHVubmVjZXNzYXJ5ICcuJyBwYXJ0cy4KCQkgKiAtIFJlbW92ZXMgdW5uZWNlc3NhcnkgJzxkaXI+Ly4uJyBwYXJ0cy4KCQkgKgoJCSAqIEJhc2VkIG9uIGNvZGUgaW4gdGhlIE5vZGUuanMgJ3BhdGgnIGNvcmUgbW9kdWxlLgoJCSAqCgkJICogQHBhcmFtIGFQYXRoIFRoZSBwYXRoIG9yIHVybCB0byBub3JtYWxpemUuCgkJICovCgkJZnVuY3Rpb24gbm9ybWFsaXplKGFQYXRoKSB7CgkJICB2YXIgcGF0aCA9IGFQYXRoOwoJCSAgdmFyIHVybCA9IHVybFBhcnNlKGFQYXRoKTsKCQkgIGlmICh1cmwpIHsKCQkgICAgaWYgKCF1cmwucGF0aCkgewoJCSAgICAgIHJldHVybiBhUGF0aDsKCQkgICAgfQoJCSAgICBwYXRoID0gdXJsLnBhdGg7CgkJICB9CgkJICB2YXIgaXNBYnNvbHV0ZSA9IGV4cG9ydHMuaXNBYnNvbHV0ZShwYXRoKTsKCgkJICB2YXIgcGFydHMgPSBwYXRoLnNwbGl0KC9cLysvKTsKCQkgIGZvciAodmFyIHBhcnQsIHVwID0gMCwgaSA9IHBhcnRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CgkJICAgIHBhcnQgPSBwYXJ0c1tpXTsKCQkgICAgaWYgKHBhcnQgPT09ICcuJykgewoJCSAgICAgIHBhcnRzLnNwbGljZShpLCAxKTsKCQkgICAgfSBlbHNlIGlmIChwYXJ0ID09PSAnLi4nKSB7CgkJICAgICAgdXArKzsKCQkgICAgfSBlbHNlIGlmICh1cCA+IDApIHsKCQkgICAgICBpZiAocGFydCA9PT0gJycpIHsKCQkgICAgICAgIC8vIFRoZSBmaXJzdCBwYXJ0IGlzIGJsYW5rIGlmIHRoZSBwYXRoIGlzIGFic29sdXRlLiBUcnlpbmcgdG8gZ28KCQkgICAgICAgIC8vIGFib3ZlIHRoZSByb290IGlzIGEgbm8tb3AuIFRoZXJlZm9yZSB3ZSBjYW4gcmVtb3ZlIGFsbCAnLi4nIHBhcnRzCgkJICAgICAgICAvLyBkaXJlY3RseSBhZnRlciB0aGUgcm9vdC4KCQkgICAgICAgIHBhcnRzLnNwbGljZShpICsgMSwgdXApOwoJCSAgICAgICAgdXAgPSAwOwoJCSAgICAgIH0gZWxzZSB7CgkJICAgICAgICBwYXJ0cy5zcGxpY2UoaSwgMik7CgkJICAgICAgICB1cC0tOwoJCSAgICAgIH0KCQkgICAgfQoJCSAgfQoJCSAgcGF0aCA9IHBhcnRzLmpvaW4oJy8nKTsKCgkJICBpZiAocGF0aCA9PT0gJycpIHsKCQkgICAgcGF0aCA9IGlzQWJzb2x1dGUgPyAnLycgOiAnLic7CgkJICB9CgoJCSAgaWYgKHVybCkgewoJCSAgICB1cmwucGF0aCA9IHBhdGg7CgkJICAgIHJldHVybiB1cmxHZW5lcmF0ZSh1cmwpOwoJCSAgfQoJCSAgcmV0dXJuIHBhdGg7CgkJfQoJCWV4cG9ydHMubm9ybWFsaXplID0gbm9ybWFsaXplOwoKCQkvKioKCQkgKiBKb2lucyB0d28gcGF0aHMvVVJMcy4KCQkgKgoJCSAqIEBwYXJhbSBhUm9vdCBUaGUgcm9vdCBwYXRoIG9yIFVSTC4KCQkgKiBAcGFyYW0gYVBhdGggVGhlIHBhdGggb3IgVVJMIHRvIGJlIGpvaW5lZCB3aXRoIHRoZSByb290LgoJCSAqCgkJICogLSBJZiBhUGF0aCBpcyBhIFVSTCBvciBhIGRhdGEgVVJJLCBhUGF0aCBpcyByZXR1cm5lZCwgdW5sZXNzIGFQYXRoIGlzIGEKCQkgKiAgIHNjaGVtZS1yZWxhdGl2ZSBVUkw6IFRoZW4gdGhlIHNjaGVtZSBvZiBhUm9vdCwgaWYgYW55LCBpcyBwcmVwZW5kZWQKCQkgKiAgIGZpcnN0LgoJCSAqIC0gT3RoZXJ3aXNlIGFQYXRoIGlzIGEgcGF0aC4gSWYgYVJvb3QgaXMgYSBVUkwsIHRoZW4gaXRzIHBhdGggcG9ydGlvbgoJCSAqICAgaXMgdXBkYXRlZCB3aXRoIHRoZSByZXN1bHQgYW5kIGFSb290IGlzIHJldHVybmVkLiBPdGhlcndpc2UgdGhlIHJlc3VsdAoJCSAqICAgaXMgcmV0dXJuZWQuCgkJICogICAtIElmIGFQYXRoIGlzIGFic29sdXRlLCB0aGUgcmVzdWx0IGlzIGFQYXRoLgoJCSAqICAgLSBPdGhlcndpc2UgdGhlIHR3byBwYXRocyBhcmUgam9pbmVkIHdpdGggYSBzbGFzaC4KCQkgKiAtIEpvaW5pbmcgZm9yIGV4YW1wbGUgJ2h0dHA6Ly8nIGFuZCAnd3d3LmV4YW1wbGUuY29tJyBpcyBhbHNvIHN1cHBvcnRlZC4KCQkgKi8KCQlmdW5jdGlvbiBqb2luKGFSb290LCBhUGF0aCkgewoJCSAgaWYgKGFSb290ID09PSAiIikgewoJCSAgICBhUm9vdCA9ICIuIjsKCQkgIH0KCQkgIGlmIChhUGF0aCA9PT0gIiIpIHsKCQkgICAgYVBhdGggPSAiLiI7CgkJICB9CgkJICB2YXIgYVBhdGhVcmwgPSB1cmxQYXJzZShhUGF0aCk7CgkJICB2YXIgYVJvb3RVcmwgPSB1cmxQYXJzZShhUm9vdCk7CgkJICBpZiAoYVJvb3RVcmwpIHsKCQkgICAgYVJvb3QgPSBhUm9vdFVybC5wYXRoIHx8ICcvJzsKCQkgIH0KCgkJICAvLyBgam9pbihmb28sICcvL3d3dy5leGFtcGxlLm9yZycpYAoJCSAgaWYgKGFQYXRoVXJsICYmICFhUGF0aFVybC5zY2hlbWUpIHsKCQkgICAgaWYgKGFSb290VXJsKSB7CgkJICAgICAgYVBhdGhVcmwuc2NoZW1lID0gYVJvb3RVcmwuc2NoZW1lOwoJCSAgICB9CgkJICAgIHJldHVybiB1cmxHZW5lcmF0ZShhUGF0aFVybCk7CgkJICB9CgoJCSAgaWYgKGFQYXRoVXJsIHx8IGFQYXRoLm1hdGNoKGRhdGFVcmxSZWdleHApKSB7CgkJICAgIHJldHVybiBhUGF0aDsKCQkgIH0KCgkJICAvLyBgam9pbignaHR0cDovLycsICd3d3cuZXhhbXBsZS5jb20nKWAKCQkgIGlmIChhUm9vdFVybCAmJiAhYVJvb3RVcmwuaG9zdCAmJiAhYVJvb3RVcmwucGF0aCkgewoJCSAgICBhUm9vdFVybC5ob3N0ID0gYVBhdGg7CgkJICAgIHJldHVybiB1cmxHZW5lcmF0ZShhUm9vdFVybCk7CgkJICB9CgoJCSAgdmFyIGpvaW5lZCA9IGFQYXRoLmNoYXJBdCgwKSA9PT0gJy8nCgkJICAgID8gYVBhdGgKCQkgICAgOiBub3JtYWxpemUoYVJvb3QucmVwbGFjZSgvXC8rJC8sICcnKSArICcvJyArIGFQYXRoKTsKCgkJICBpZiAoYVJvb3RVcmwpIHsKCQkgICAgYVJvb3RVcmwucGF0aCA9IGpvaW5lZDsKCQkgICAgcmV0dXJuIHVybEdlbmVyYXRlKGFSb290VXJsKTsKCQkgIH0KCQkgIHJldHVybiBqb2luZWQ7CgkJfQoJCWV4cG9ydHMuam9pbiA9IGpvaW47CgoJCWV4cG9ydHMuaXNBYnNvbHV0ZSA9IGZ1bmN0aW9uIChhUGF0aCkgewoJCSAgcmV0dXJuIGFQYXRoLmNoYXJBdCgwKSA9PT0gJy8nIHx8IHVybFJlZ2V4cC50ZXN0KGFQYXRoKTsKCQl9OwoKCQkvKioKCQkgKiBNYWtlIGEgcGF0aCByZWxhdGl2ZSB0byBhIFVSTCBvciBhbm90aGVyIHBhdGguCgkJICoKCQkgKiBAcGFyYW0gYVJvb3QgVGhlIHJvb3QgcGF0aCBvciBVUkwuCgkJICogQHBhcmFtIGFQYXRoIFRoZSBwYXRoIG9yIFVSTCB0byBiZSBtYWRlIHJlbGF0aXZlIHRvIGFSb290LgoJCSAqLwoJCWZ1bmN0aW9uIHJlbGF0aXZlKGFSb290LCBhUGF0aCkgewoJCSAgaWYgKGFSb290ID09PSAiIikgewoJCSAgICBhUm9vdCA9ICIuIjsKCQkgIH0KCgkJICBhUm9vdCA9IGFSb290LnJlcGxhY2UoL1wvJC8sICcnKTsKCgkJICAvLyBJdCBpcyBwb3NzaWJsZSBmb3IgdGhlIHBhdGggdG8gYmUgYWJvdmUgdGhlIHJvb3QuIEluIHRoaXMgY2FzZSwgc2ltcGx5CgkJICAvLyBjaGVja2luZyB3aGV0aGVyIHRoZSByb290IGlzIGEgcHJlZml4IG9mIHRoZSBwYXRoIHdvbid0IHdvcmsuIEluc3RlYWQsIHdlCgkJICAvLyBuZWVkIHRvIHJlbW92ZSBjb21wb25lbnRzIGZyb20gdGhlIHJvb3Qgb25lIGJ5IG9uZSwgdW50aWwgZWl0aGVyIHdlIGZpbmQKCQkgIC8vIGEgcHJlZml4IHRoYXQgZml0cywgb3Igd2UgcnVuIG91dCBvZiBjb21wb25lbnRzIHRvIHJlbW92ZS4KCQkgIHZhciBsZXZlbCA9IDA7CgkJICB3aGlsZSAoYVBhdGguaW5kZXhPZihhUm9vdCArICcvJykgIT09IDApIHsKCQkgICAgdmFyIGluZGV4ID0gYVJvb3QubGFzdEluZGV4T2YoIi8iKTsKCQkgICAgaWYgKGluZGV4IDwgMCkgewoJCSAgICAgIHJldHVybiBhUGF0aDsKCQkgICAgfQoKCQkgICAgLy8gSWYgdGhlIG9ubHkgcGFydCBvZiB0aGUgcm9vdCB0aGF0IGlzIGxlZnQgaXMgdGhlIHNjaGVtZSAoaS5lLiBodHRwOi8vLAoJCSAgICAvLyBmaWxlOi8vLywgZXRjLiksIG9uZSBvciBtb3JlIHNsYXNoZXMgKC8pLCBvciBzaW1wbHkgbm90aGluZyBhdCBhbGwsIHdlCgkJICAgIC8vIGhhdmUgZXhoYXVzdGVkIGFsbCBjb21wb25lbnRzLCBzbyB0aGUgcGF0aCBpcyBub3QgcmVsYXRpdmUgdG8gdGhlIHJvb3QuCgkJICAgIGFSb290ID0gYVJvb3Quc2xpY2UoMCwgaW5kZXgpOwoJCSAgICBpZiAoYVJvb3QubWF0Y2goL14oW15cL10rOlwvKT9cLyokLykpIHsKCQkgICAgICByZXR1cm4gYVBhdGg7CgkJICAgIH0KCgkJICAgICsrbGV2ZWw7CgkJICB9CgoJCSAgLy8gTWFrZSBzdXJlIHdlIGFkZCBhICIuLi8iIGZvciBlYWNoIGNvbXBvbmVudCB3ZSByZW1vdmVkIGZyb20gdGhlIHJvb3QuCgkJICByZXR1cm4gQXJyYXkobGV2ZWwgKyAxKS5qb2luKCIuLi8iKSArIGFQYXRoLnN1YnN0cihhUm9vdC5sZW5ndGggKyAxKTsKCQl9CgkJZXhwb3J0cy5yZWxhdGl2ZSA9IHJlbGF0aXZlOwoKCQl2YXIgc3VwcG9ydHNOdWxsUHJvdG8gPSAoZnVuY3Rpb24gKCkgewoJCSAgdmFyIG9iaiA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgkJICByZXR1cm4gISgnX19wcm90b19fJyBpbiBvYmopOwoJCX0oKSk7CgoJCWZ1bmN0aW9uIGlkZW50aXR5IChzKSB7CgkJICByZXR1cm4gczsKCQl9CgoJCS8qKgoJCSAqIEJlY2F1c2UgYmVoYXZpb3IgZ29lcyB3YWNreSB3aGVuIHlvdSBzZXQgYF9fcHJvdG9fX2Agb24gb2JqZWN0cywgd2UKCQkgKiBoYXZlIHRvIHByZWZpeCBhbGwgdGhlIHN0cmluZ3MgaW4gb3VyIHNldCB3aXRoIGFuIGFyYml0cmFyeSBjaGFyYWN0ZXIuCgkJICoKCQkgKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL21vemlsbGEvc291cmNlLW1hcC9wdWxsLzMxIGFuZAoJCSAqIGh0dHBzOi8vZ2l0aHViLmNvbS9tb3ppbGxhL3NvdXJjZS1tYXAvaXNzdWVzLzMwCgkJICoKCQkgKiBAcGFyYW0gU3RyaW5nIGFTdHIKCQkgKi8KCQlmdW5jdGlvbiB0b1NldFN0cmluZyhhU3RyKSB7CgkJICBpZiAoaXNQcm90b1N0cmluZyhhU3RyKSkgewoJCSAgICByZXR1cm4gJyQnICsgYVN0cjsKCQkgIH0KCgkJICByZXR1cm4gYVN0cjsKCQl9CgkJZXhwb3J0cy50b1NldFN0cmluZyA9IHN1cHBvcnRzTnVsbFByb3RvID8gaWRlbnRpdHkgOiB0b1NldFN0cmluZzsKCgkJZnVuY3Rpb24gZnJvbVNldFN0cmluZyhhU3RyKSB7CgkJICBpZiAoaXNQcm90b1N0cmluZyhhU3RyKSkgewoJCSAgICByZXR1cm4gYVN0ci5zbGljZSgxKTsKCQkgIH0KCgkJICByZXR1cm4gYVN0cjsKCQl9CgkJZXhwb3J0cy5mcm9tU2V0U3RyaW5nID0gc3VwcG9ydHNOdWxsUHJvdG8gPyBpZGVudGl0eSA6IGZyb21TZXRTdHJpbmc7CgoJCWZ1bmN0aW9uIGlzUHJvdG9TdHJpbmcocykgewoJCSAgaWYgKCFzKSB7CgkJICAgIHJldHVybiBmYWxzZTsKCQkgIH0KCgkJICB2YXIgbGVuZ3RoID0gcy5sZW5ndGg7CgoJCSAgaWYgKGxlbmd0aCA8IDkgLyogIl9fcHJvdG9fXyIubGVuZ3RoICovKSB7CgkJICAgIHJldHVybiBmYWxzZTsKCQkgIH0KCgkJICBpZiAocy5jaGFyQ29kZUF0KGxlbmd0aCAtIDEpICE9PSA5NSAgLyogJ18nICovIHx8CgkJICAgICAgcy5jaGFyQ29kZUF0KGxlbmd0aCAtIDIpICE9PSA5NSAgLyogJ18nICovIHx8CgkJICAgICAgcy5jaGFyQ29kZUF0KGxlbmd0aCAtIDMpICE9PSAxMTEgLyogJ28nICovIHx8CgkJICAgICAgcy5jaGFyQ29kZUF0KGxlbmd0aCAtIDQpICE9PSAxMTYgLyogJ3QnICovIHx8CgkJICAgICAgcy5jaGFyQ29kZUF0KGxlbmd0aCAtIDUpICE9PSAxMTEgLyogJ28nICovIHx8CgkJICAgICAgcy5jaGFyQ29kZUF0KGxlbmd0aCAtIDYpICE9PSAxMTQgLyogJ3InICovIHx8CgkJICAgICAgcy5jaGFyQ29kZUF0KGxlbmd0aCAtIDcpICE9PSAxMTIgLyogJ3AnICovIHx8CgkJICAgICAgcy5jaGFyQ29kZUF0KGxlbmd0aCAtIDgpICE9PSA5NSAgLyogJ18nICovIHx8CgkJICAgICAgcy5jaGFyQ29kZUF0KGxlbmd0aCAtIDkpICE9PSA5NSAgLyogJ18nICovKSB7CgkJICAgIHJldHVybiBmYWxzZTsKCQkgIH0KCgkJICBmb3IgKHZhciBpID0gbGVuZ3RoIC0gMTA7IGkgPj0gMDsgaS0tKSB7CgkJICAgIGlmIChzLmNoYXJDb2RlQXQoaSkgIT09IDM2IC8qICckJyAqLykgewoJCSAgICAgIHJldHVybiBmYWxzZTsKCQkgICAgfQoJCSAgfQoKCQkgIHJldHVybiB0cnVlOwoJCX0KCgkJLyoqCgkJICogQ29tcGFyYXRvciBiZXR3ZWVuIHR3byBtYXBwaW5ncyB3aGVyZSB0aGUgb3JpZ2luYWwgcG9zaXRpb25zIGFyZSBjb21wYXJlZC4KCQkgKgoJCSAqIE9wdGlvbmFsbHkgcGFzcyBpbiBgdHJ1ZWAgYXMgYG9ubHlDb21wYXJlR2VuZXJhdGVkYCB0byBjb25zaWRlciB0d28KCQkgKiBtYXBwaW5ncyB3aXRoIHRoZSBzYW1lIG9yaWdpbmFsIHNvdXJjZS9saW5lL2NvbHVtbiwgYnV0IGRpZmZlcmVudCBnZW5lcmF0ZWQKCQkgKiBsaW5lIGFuZCBjb2x1bW4gdGhlIHNhbWUuIFVzZWZ1bCB3aGVuIHNlYXJjaGluZyBmb3IgYSBtYXBwaW5nIHdpdGggYQoJCSAqIHN0dWJiZWQgb3V0IG1hcHBpbmcuCgkJICovCgkJZnVuY3Rpb24gY29tcGFyZUJ5T3JpZ2luYWxQb3NpdGlvbnMobWFwcGluZ0EsIG1hcHBpbmdCLCBvbmx5Q29tcGFyZU9yaWdpbmFsKSB7CgkJICB2YXIgY21wID0gc3RyY21wKG1hcHBpbmdBLnNvdXJjZSwgbWFwcGluZ0Iuc291cmNlKTsKCQkgIGlmIChjbXAgIT09IDApIHsKCQkgICAgcmV0dXJuIGNtcDsKCQkgIH0KCgkJICBjbXAgPSBtYXBwaW5nQS5vcmlnaW5hbExpbmUgLSBtYXBwaW5nQi5vcmlnaW5hbExpbmU7CgkJICBpZiAoY21wICE9PSAwKSB7CgkJICAgIHJldHVybiBjbXA7CgkJICB9CgoJCSAgY21wID0gbWFwcGluZ0Eub3JpZ2luYWxDb2x1bW4gLSBtYXBwaW5nQi5vcmlnaW5hbENvbHVtbjsKCQkgIGlmIChjbXAgIT09IDAgfHwgb25seUNvbXBhcmVPcmlnaW5hbCkgewoJCSAgICByZXR1cm4gY21wOwoJCSAgfQoKCQkgIGNtcCA9IG1hcHBpbmdBLmdlbmVyYXRlZENvbHVtbiAtIG1hcHBpbmdCLmdlbmVyYXRlZENvbHVtbjsKCQkgIGlmIChjbXAgIT09IDApIHsKCQkgICAgcmV0dXJuIGNtcDsKCQkgIH0KCgkJICBjbXAgPSBtYXBwaW5nQS5nZW5lcmF0ZWRMaW5lIC0gbWFwcGluZ0IuZ2VuZXJhdGVkTGluZTsKCQkgIGlmIChjbXAgIT09IDApIHsKCQkgICAgcmV0dXJuIGNtcDsKCQkgIH0KCgkJICByZXR1cm4gc3RyY21wKG1hcHBpbmdBLm5hbWUsIG1hcHBpbmdCLm5hbWUpOwoJCX0KCQlleHBvcnRzLmNvbXBhcmVCeU9yaWdpbmFsUG9zaXRpb25zID0gY29tcGFyZUJ5T3JpZ2luYWxQb3NpdGlvbnM7CgoJCS8qKgoJCSAqIENvbXBhcmF0b3IgYmV0d2VlbiB0d28gbWFwcGluZ3Mgd2l0aCBkZWZsYXRlZCBzb3VyY2UgYW5kIG5hbWUgaW5kaWNlcyB3aGVyZQoJCSAqIHRoZSBnZW5lcmF0ZWQgcG9zaXRpb25zIGFyZSBjb21wYXJlZC4KCQkgKgoJCSAqIE9wdGlvbmFsbHkgcGFzcyBpbiBgdHJ1ZWAgYXMgYG9ubHlDb21wYXJlR2VuZXJhdGVkYCB0byBjb25zaWRlciB0d28KCQkgKiBtYXBwaW5ncyB3aXRoIHRoZSBzYW1lIGdlbmVyYXRlZCBsaW5lIGFuZCBjb2x1bW4sIGJ1dCBkaWZmZXJlbnQKCQkgKiBzb3VyY2UvbmFtZS9vcmlnaW5hbCBsaW5lIGFuZCBjb2x1bW4gdGhlIHNhbWUuIFVzZWZ1bCB3aGVuIHNlYXJjaGluZyBmb3IgYQoJCSAqIG1hcHBpbmcgd2l0aCBhIHN0dWJiZWQgb3V0IG1hcHBpbmcuCgkJICovCgkJZnVuY3Rpb24gY29tcGFyZUJ5R2VuZXJhdGVkUG9zaXRpb25zRGVmbGF0ZWQobWFwcGluZ0EsIG1hcHBpbmdCLCBvbmx5Q29tcGFyZUdlbmVyYXRlZCkgewoJCSAgdmFyIGNtcCA9IG1hcHBpbmdBLmdlbmVyYXRlZExpbmUgLSBtYXBwaW5nQi5nZW5lcmF0ZWRMaW5lOwoJCSAgaWYgKGNtcCAhPT0gMCkgewoJCSAgICByZXR1cm4gY21wOwoJCSAgfQoKCQkgIGNtcCA9IG1hcHBpbmdBLmdlbmVyYXRlZENvbHVtbiAtIG1hcHBpbmdCLmdlbmVyYXRlZENvbHVtbjsKCQkgIGlmIChjbXAgIT09IDAgfHwgb25seUNvbXBhcmVHZW5lcmF0ZWQpIHsKCQkgICAgcmV0dXJuIGNtcDsKCQkgIH0KCgkJICBjbXAgPSBzdHJjbXAobWFwcGluZ0Euc291cmNlLCBtYXBwaW5nQi5zb3VyY2UpOwoJCSAgaWYgKGNtcCAhPT0gMCkgewoJCSAgICByZXR1cm4gY21wOwoJCSAgfQoKCQkgIGNtcCA9IG1hcHBpbmdBLm9yaWdpbmFsTGluZSAtIG1hcHBpbmdCLm9yaWdpbmFsTGluZTsKCQkgIGlmIChjbXAgIT09IDApIHsKCQkgICAgcmV0dXJuIGNtcDsKCQkgIH0KCgkJICBjbXAgPSBtYXBwaW5nQS5vcmlnaW5hbENvbHVtbiAtIG1hcHBpbmdCLm9yaWdpbmFsQ29sdW1uOwoJCSAgaWYgKGNtcCAhPT0gMCkgewoJCSAgICByZXR1cm4gY21wOwoJCSAgfQoKCQkgIHJldHVybiBzdHJjbXAobWFwcGluZ0EubmFtZSwgbWFwcGluZ0IubmFtZSk7CgkJfQoJCWV4cG9ydHMuY29tcGFyZUJ5R2VuZXJhdGVkUG9zaXRpb25zRGVmbGF0ZWQgPSBjb21wYXJlQnlHZW5lcmF0ZWRQb3NpdGlvbnNEZWZsYXRlZDsKCgkJZnVuY3Rpb24gc3RyY21wKGFTdHIxLCBhU3RyMikgewoJCSAgaWYgKGFTdHIxID09PSBhU3RyMikgewoJCSAgICByZXR1cm4gMDsKCQkgIH0KCgkJICBpZiAoYVN0cjEgPT09IG51bGwpIHsKCQkgICAgcmV0dXJuIDE7IC8vIGFTdHIyICE9PSBudWxsCgkJICB9CgoJCSAgaWYgKGFTdHIyID09PSBudWxsKSB7CgkJICAgIHJldHVybiAtMTsgLy8gYVN0cjEgIT09IG51bGwKCQkgIH0KCgkJICBpZiAoYVN0cjEgPiBhU3RyMikgewoJCSAgICByZXR1cm4gMTsKCQkgIH0KCgkJICByZXR1cm4gLTE7CgkJfQoKCQkvKioKCQkgKiBDb21wYXJhdG9yIGJldHdlZW4gdHdvIG1hcHBpbmdzIHdpdGggaW5mbGF0ZWQgc291cmNlIGFuZCBuYW1lIHN0cmluZ3Mgd2hlcmUKCQkgKiB0aGUgZ2VuZXJhdGVkIHBvc2l0aW9ucyBhcmUgY29tcGFyZWQuCgkJICovCgkJZnVuY3Rpb24gY29tcGFyZUJ5R2VuZXJhdGVkUG9zaXRpb25zSW5mbGF0ZWQobWFwcGluZ0EsIG1hcHBpbmdCKSB7CgkJICB2YXIgY21wID0gbWFwcGluZ0EuZ2VuZXJhdGVkTGluZSAtIG1hcHBpbmdCLmdlbmVyYXRlZExpbmU7CgkJICBpZiAoY21wICE9PSAwKSB7CgkJICAgIHJldHVybiBjbXA7CgkJICB9CgoJCSAgY21wID0gbWFwcGluZ0EuZ2VuZXJhdGVkQ29sdW1uIC0gbWFwcGluZ0IuZ2VuZXJhdGVkQ29sdW1uOwoJCSAgaWYgKGNtcCAhPT0gMCkgewoJCSAgICByZXR1cm4gY21wOwoJCSAgfQoKCQkgIGNtcCA9IHN0cmNtcChtYXBwaW5nQS5zb3VyY2UsIG1hcHBpbmdCLnNvdXJjZSk7CgkJICBpZiAoY21wICE9PSAwKSB7CgkJICAgIHJldHVybiBjbXA7CgkJICB9CgoJCSAgY21wID0gbWFwcGluZ0Eub3JpZ2luYWxMaW5lIC0gbWFwcGluZ0Iub3JpZ2luYWxMaW5lOwoJCSAgaWYgKGNtcCAhPT0gMCkgewoJCSAgICByZXR1cm4gY21wOwoJCSAgfQoKCQkgIGNtcCA9IG1hcHBpbmdBLm9yaWdpbmFsQ29sdW1uIC0gbWFwcGluZ0Iub3JpZ2luYWxDb2x1bW47CgkJICBpZiAoY21wICE9PSAwKSB7CgkJICAgIHJldHVybiBjbXA7CgkJICB9CgoJCSAgcmV0dXJuIHN0cmNtcChtYXBwaW5nQS5uYW1lLCBtYXBwaW5nQi5uYW1lKTsKCQl9CgkJZXhwb3J0cy5jb21wYXJlQnlHZW5lcmF0ZWRQb3NpdGlvbnNJbmZsYXRlZCA9IGNvbXBhcmVCeUdlbmVyYXRlZFBvc2l0aW9uc0luZmxhdGVkOwoKCQkvKioKCQkgKiBTdHJpcCBhbnkgSlNPTiBYU1NJIGF2b2lkYW5jZSBwcmVmaXggZnJvbSB0aGUgc3RyaW5nIChhcyBkb2N1bWVudGVkCgkJICogaW4gdGhlIHNvdXJjZSBtYXBzIHNwZWNpZmljYXRpb24pLCBhbmQgdGhlbiBwYXJzZSB0aGUgc3RyaW5nIGFzCgkJICogSlNPTi4KCQkgKi8KCQlmdW5jdGlvbiBwYXJzZVNvdXJjZU1hcElucHV0KHN0cikgewoJCSAgcmV0dXJuIEpTT04ucGFyc2Uoc3RyLnJlcGxhY2UoL15cKV19J1teXG5dKlxuLywgJycpKTsKCQl9CgkJZXhwb3J0cy5wYXJzZVNvdXJjZU1hcElucHV0ID0gcGFyc2VTb3VyY2VNYXBJbnB1dDsKCgkJLyoqCgkJICogQ29tcHV0ZSB0aGUgVVJMIG9mIGEgc291cmNlIGdpdmVuIHRoZSB0aGUgc291cmNlIHJvb3QsIHRoZSBzb3VyY2UncwoJCSAqIFVSTCwgYW5kIHRoZSBzb3VyY2UgbWFwJ3MgVVJMLgoJCSAqLwoJCWZ1bmN0aW9uIGNvbXB1dGVTb3VyY2VVUkwoc291cmNlUm9vdCwgc291cmNlVVJMLCBzb3VyY2VNYXBVUkwpIHsKCQkgIHNvdXJjZVVSTCA9IHNvdXJjZVVSTCB8fCAnJzsKCgkJICBpZiAoc291cmNlUm9vdCkgewoJCSAgICAvLyBUaGlzIGZvbGxvd3Mgd2hhdCBDaHJvbWUgZG9lcy4KCQkgICAgaWYgKHNvdXJjZVJvb3Rbc291cmNlUm9vdC5sZW5ndGggLSAxXSAhPT0gJy8nICYmIHNvdXJjZVVSTFswXSAhPT0gJy8nKSB7CgkJICAgICAgc291cmNlUm9vdCArPSAnLyc7CgkJICAgIH0KCQkgICAgLy8gVGhlIHNwZWMgc2F5czoKCQkgICAgLy8gICBMaW5lIDQ6IEFuIG9wdGlvbmFsIHNvdXJjZSByb290LCB1c2VmdWwgZm9yIHJlbG9jYXRpbmcgc291cmNlCgkJICAgIC8vICAgZmlsZXMgb24gYSBzZXJ2ZXIgb3IgcmVtb3ZpbmcgcmVwZWF0ZWQgdmFsdWVzIGluIHRoZQoJCSAgICAvLyAgIOKAnHNvdXJjZXPigJ0gZW50cnkuICBUaGlzIHZhbHVlIGlzIHByZXBlbmRlZCB0byB0aGUgaW5kaXZpZHVhbAoJCSAgICAvLyAgIGVudHJpZXMgaW4gdGhlIOKAnHNvdXJjZeKAnSBmaWVsZC4KCQkgICAgc291cmNlVVJMID0gc291cmNlUm9vdCArIHNvdXJjZVVSTDsKCQkgIH0KCgkJICAvLyBIaXN0b3JpY2FsbHksIFNvdXJjZU1hcENvbnN1bWVyIGRpZCBub3QgdGFrZSB0aGUgc291cmNlTWFwVVJMIGFzCgkJICAvLyBhIHBhcmFtZXRlci4gIFRoaXMgbW9kZSBpcyBzdGlsbCBzb21ld2hhdCBzdXBwb3J0ZWQsIHdoaWNoIGlzIHdoeQoJCSAgLy8gdGhpcyBjb2RlIGJsb2NrIGlzIGNvbmRpdGlvbmFsLiAgSG93ZXZlciwgaXQncyBwcmVmZXJhYmxlIHRvIHBhc3MKCQkgIC8vIHRoZSBzb3VyY2UgbWFwIFVSTCB0byBTb3VyY2VNYXBDb25zdW1lciwgc28gdGhhdCB0aGlzIGZ1bmN0aW9uCgkJICAvLyBjYW4gaW1wbGVtZW50IHRoZSBzb3VyY2UgVVJMIHJlc29sdXRpb24gYWxnb3JpdGhtIGFzIG91dGxpbmVkIGluCgkJICAvLyB0aGUgc3BlYy4gIFRoaXMgYmxvY2sgaXMgYmFzaWNhbGx5IHRoZSBlcXVpdmFsZW50IG9mOgoJCSAgLy8gICAgbmV3IFVSTChzb3VyY2VVUkwsIHNvdXJjZU1hcFVSTCkudG9TdHJpbmcoKQoJCSAgLy8gLi4uIGV4Y2VwdCBpdCBhdm9pZHMgdXNpbmcgVVJMLCB3aGljaCB3YXNuJ3QgYXZhaWxhYmxlIGluIHRoZQoJCSAgLy8gb2xkZXIgcmVsZWFzZXMgb2Ygbm9kZSBzdGlsbCBzdXBwb3J0ZWQgYnkgdGhpcyBsaWJyYXJ5LgoJCSAgLy8KCQkgIC8vIFRoZSBzcGVjIHNheXM6CgkJICAvLyAgIElmIHRoZSBzb3VyY2VzIGFyZSBub3QgYWJzb2x1dGUgVVJMcyBhZnRlciBwcmVwZW5kaW5nIG9mIHRoZQoJCSAgLy8gICDigJxzb3VyY2VSb2904oCdLCB0aGUgc291cmNlcyBhcmUgcmVzb2x2ZWQgcmVsYXRpdmUgdG8gdGhlCgkJICAvLyAgIFNvdXJjZU1hcCAobGlrZSByZXNvbHZpbmcgc2NyaXB0IHNyYyBpbiBhIGh0bWwgZG9jdW1lbnQpLgoJCSAgaWYgKHNvdXJjZU1hcFVSTCkgewoJCSAgICB2YXIgcGFyc2VkID0gdXJsUGFyc2Uoc291cmNlTWFwVVJMKTsKCQkgICAgaWYgKCFwYXJzZWQpIHsKCQkgICAgICB0aHJvdyBuZXcgRXJyb3IoInNvdXJjZU1hcFVSTCBjb3VsZCBub3QgYmUgcGFyc2VkIik7CgkJICAgIH0KCQkgICAgaWYgKHBhcnNlZC5wYXRoKSB7CgkJICAgICAgLy8gU3RyaXAgdGhlIGxhc3QgcGF0aCBjb21wb25lbnQsIGJ1dCBrZWVwIHRoZSAiLyIuCgkJICAgICAgdmFyIGluZGV4ID0gcGFyc2VkLnBhdGgubGFzdEluZGV4T2YoJy8nKTsKCQkgICAgICBpZiAoaW5kZXggPj0gMCkgewoJCSAgICAgICAgcGFyc2VkLnBhdGggPSBwYXJzZWQucGF0aC5zdWJzdHJpbmcoMCwgaW5kZXggKyAxKTsKCQkgICAgICB9CgkJICAgIH0KCQkgICAgc291cmNlVVJMID0gam9pbih1cmxHZW5lcmF0ZShwYXJzZWQpLCBzb3VyY2VVUkwpOwoJCSAgfQoKCQkgIHJldHVybiBub3JtYWxpemUoc291cmNlVVJMKTsKCQl9CgkJZXhwb3J0cy5jb21wdXRlU291cmNlVVJMID0gY29tcHV0ZVNvdXJjZVVSTDsgCgl9ICh1dGlsJDQpKTsKCXJldHVybiB1dGlsJDQ7Cn0KCnZhciBhcnJheVNldCQxID0ge307CgovKiAtKi0gTW9kZToganM7IGpzLWluZGVudC1sZXZlbDogMjsgLSotICovCgp2YXIgaGFzUmVxdWlyZWRBcnJheVNldDsKCmZ1bmN0aW9uIHJlcXVpcmVBcnJheVNldCAoKSB7CglpZiAoaGFzUmVxdWlyZWRBcnJheVNldCkgcmV0dXJuIGFycmF5U2V0JDE7CgloYXNSZXF1aXJlZEFycmF5U2V0ID0gMTsKCS8qCgkgKiBDb3B5cmlnaHQgMjAxMSBNb3ppbGxhIEZvdW5kYXRpb24gYW5kIGNvbnRyaWJ1dG9ycwoJICogTGljZW5zZWQgdW5kZXIgdGhlIE5ldyBCU0QgbGljZW5zZS4gU2VlIExJQ0VOU0Ugb3I6CgkgKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvQlNELTMtQ2xhdXNlCgkgKi8KCgl2YXIgdXRpbCA9IHJlcXVpcmVVdGlsKCk7Cgl2YXIgaGFzID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKCXZhciBoYXNOYXRpdmVNYXAgPSB0eXBlb2YgTWFwICE9PSAidW5kZWZpbmVkIjsKCgkvKioKCSAqIEEgZGF0YSBzdHJ1Y3R1cmUgd2hpY2ggaXMgYSBjb21iaW5hdGlvbiBvZiBhbiBhcnJheSBhbmQgYSBzZXQuIEFkZGluZyBhIG5ldwoJICogbWVtYmVyIGlzIE8oMSksIHRlc3RpbmcgZm9yIG1lbWJlcnNoaXAgaXMgTygxKSwgYW5kIGZpbmRpbmcgdGhlIGluZGV4IG9mIGFuCgkgKiBlbGVtZW50IGlzIE8oMSkuIFJlbW92aW5nIGVsZW1lbnRzIGZyb20gdGhlIHNldCBpcyBub3Qgc3VwcG9ydGVkLiBPbmx5CgkgKiBzdHJpbmdzIGFyZSBzdXBwb3J0ZWQgZm9yIG1lbWJlcnNoaXAuCgkgKi8KCWZ1bmN0aW9uIEFycmF5U2V0KCkgewoJICB0aGlzLl9hcnJheSA9IFtdOwoJICB0aGlzLl9zZXQgPSBoYXNOYXRpdmVNYXAgPyBuZXcgTWFwKCkgOiBPYmplY3QuY3JlYXRlKG51bGwpOwoJfQoKCS8qKgoJICogU3RhdGljIG1ldGhvZCBmb3IgY3JlYXRpbmcgQXJyYXlTZXQgaW5zdGFuY2VzIGZyb20gYW4gZXhpc3RpbmcgYXJyYXkuCgkgKi8KCUFycmF5U2V0LmZyb21BcnJheSA9IGZ1bmN0aW9uIEFycmF5U2V0X2Zyb21BcnJheShhQXJyYXksIGFBbGxvd0R1cGxpY2F0ZXMpIHsKCSAgdmFyIHNldCA9IG5ldyBBcnJheVNldCgpOwoJICBmb3IgKHZhciBpID0gMCwgbGVuID0gYUFycmF5Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CgkgICAgc2V0LmFkZChhQXJyYXlbaV0sIGFBbGxvd0R1cGxpY2F0ZXMpOwoJICB9CgkgIHJldHVybiBzZXQ7Cgl9OwoKCS8qKgoJICogUmV0dXJuIGhvdyBtYW55IHVuaXF1ZSBpdGVtcyBhcmUgaW4gdGhpcyBBcnJheVNldC4gSWYgZHVwbGljYXRlcyBoYXZlIGJlZW4KCSAqIGFkZGVkLCB0aGFuIHRob3NlIGRvIG5vdCBjb3VudCB0b3dhcmRzIHRoZSBzaXplLgoJICoKCSAqIEByZXR1cm5zIE51bWJlcgoJICovCglBcnJheVNldC5wcm90b3R5cGUuc2l6ZSA9IGZ1bmN0aW9uIEFycmF5U2V0X3NpemUoKSB7CgkgIHJldHVybiBoYXNOYXRpdmVNYXAgPyB0aGlzLl9zZXQuc2l6ZSA6IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRoaXMuX3NldCkubGVuZ3RoOwoJfTsKCgkvKioKCSAqIEFkZCB0aGUgZ2l2ZW4gc3RyaW5nIHRvIHRoaXMgc2V0LgoJICoKCSAqIEBwYXJhbSBTdHJpbmcgYVN0cgoJICovCglBcnJheVNldC5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gQXJyYXlTZXRfYWRkKGFTdHIsIGFBbGxvd0R1cGxpY2F0ZXMpIHsKCSAgdmFyIHNTdHIgPSBoYXNOYXRpdmVNYXAgPyBhU3RyIDogdXRpbC50b1NldFN0cmluZyhhU3RyKTsKCSAgdmFyIGlzRHVwbGljYXRlID0gaGFzTmF0aXZlTWFwID8gdGhpcy5oYXMoYVN0cikgOiBoYXMuY2FsbCh0aGlzLl9zZXQsIHNTdHIpOwoJICB2YXIgaWR4ID0gdGhpcy5fYXJyYXkubGVuZ3RoOwoJICBpZiAoIWlzRHVwbGljYXRlIHx8IGFBbGxvd0R1cGxpY2F0ZXMpIHsKCSAgICB0aGlzLl9hcnJheS5wdXNoKGFTdHIpOwoJICB9CgkgIGlmICghaXNEdXBsaWNhdGUpIHsKCSAgICBpZiAoaGFzTmF0aXZlTWFwKSB7CgkgICAgICB0aGlzLl9zZXQuc2V0KGFTdHIsIGlkeCk7CgkgICAgfSBlbHNlIHsKCSAgICAgIHRoaXMuX3NldFtzU3RyXSA9IGlkeDsKCSAgICB9CgkgIH0KCX07CgoJLyoqCgkgKiBJcyB0aGUgZ2l2ZW4gc3RyaW5nIGEgbWVtYmVyIG9mIHRoaXMgc2V0PwoJICoKCSAqIEBwYXJhbSBTdHJpbmcgYVN0cgoJICovCglBcnJheVNldC5wcm90b3R5cGUuaGFzID0gZnVuY3Rpb24gQXJyYXlTZXRfaGFzKGFTdHIpIHsKCSAgaWYgKGhhc05hdGl2ZU1hcCkgewoJICAgIHJldHVybiB0aGlzLl9zZXQuaGFzKGFTdHIpOwoJICB9IGVsc2UgewoJICAgIHZhciBzU3RyID0gdXRpbC50b1NldFN0cmluZyhhU3RyKTsKCSAgICByZXR1cm4gaGFzLmNhbGwodGhpcy5fc2V0LCBzU3RyKTsKCSAgfQoJfTsKCgkvKioKCSAqIFdoYXQgaXMgdGhlIGluZGV4IG9mIHRoZSBnaXZlbiBzdHJpbmcgaW4gdGhlIGFycmF5PwoJICoKCSAqIEBwYXJhbSBTdHJpbmcgYVN0cgoJICovCglBcnJheVNldC5wcm90b3R5cGUuaW5kZXhPZiA9IGZ1bmN0aW9uIEFycmF5U2V0X2luZGV4T2YoYVN0cikgewoJICBpZiAoaGFzTmF0aXZlTWFwKSB7CgkgICAgdmFyIGlkeCA9IHRoaXMuX3NldC5nZXQoYVN0cik7CgkgICAgaWYgKGlkeCA+PSAwKSB7CgkgICAgICAgIHJldHVybiBpZHg7CgkgICAgfQoJICB9IGVsc2UgewoJICAgIHZhciBzU3RyID0gdXRpbC50b1NldFN0cmluZyhhU3RyKTsKCSAgICBpZiAoaGFzLmNhbGwodGhpcy5fc2V0LCBzU3RyKSkgewoJICAgICAgcmV0dXJuIHRoaXMuX3NldFtzU3RyXTsKCSAgICB9CgkgIH0KCgkgIHRocm93IG5ldyBFcnJvcignIicgKyBhU3RyICsgJyIgaXMgbm90IGluIHRoZSBzZXQuJyk7Cgl9OwoKCS8qKgoJICogV2hhdCBpcyB0aGUgZWxlbWVudCBhdCB0aGUgZ2l2ZW4gaW5kZXg/CgkgKgoJICogQHBhcmFtIE51bWJlciBhSWR4CgkgKi8KCUFycmF5U2V0LnByb3RvdHlwZS5hdCA9IGZ1bmN0aW9uIEFycmF5U2V0X2F0KGFJZHgpIHsKCSAgaWYgKGFJZHggPj0gMCAmJiBhSWR4IDwgdGhpcy5fYXJyYXkubGVuZ3RoKSB7CgkgICAgcmV0dXJuIHRoaXMuX2FycmF5W2FJZHhdOwoJICB9CgkgIHRocm93IG5ldyBFcnJvcignTm8gZWxlbWVudCBpbmRleGVkIGJ5ICcgKyBhSWR4KTsKCX07CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBhcnJheSByZXByZXNlbnRhdGlvbiBvZiB0aGlzIHNldCAod2hpY2ggaGFzIHRoZSBwcm9wZXIgaW5kaWNlcwoJICogaW5kaWNhdGVkIGJ5IGluZGV4T2YpLiBOb3RlIHRoYXQgdGhpcyBpcyBhIGNvcHkgb2YgdGhlIGludGVybmFsIGFycmF5IHVzZWQKCSAqIGZvciBzdG9yaW5nIHRoZSBtZW1iZXJzIHNvIHRoYXQgbm8gb25lIGNhbiBtZXNzIHdpdGggaW50ZXJuYWwgc3RhdGUuCgkgKi8KCUFycmF5U2V0LnByb3RvdHlwZS50b0FycmF5ID0gZnVuY3Rpb24gQXJyYXlTZXRfdG9BcnJheSgpIHsKCSAgcmV0dXJuIHRoaXMuX2FycmF5LnNsaWNlKCk7Cgl9OwoKCWFycmF5U2V0JDEuQXJyYXlTZXQgPSBBcnJheVNldDsKCXJldHVybiBhcnJheVNldCQxOwp9Cgp2YXIgbWFwcGluZ0xpc3QkMSA9IHt9OwoKLyogLSotIE1vZGU6IGpzOyBqcy1pbmRlbnQtbGV2ZWw6IDI7IC0qLSAqLwoKdmFyIGhhc1JlcXVpcmVkTWFwcGluZ0xpc3Q7CgpmdW5jdGlvbiByZXF1aXJlTWFwcGluZ0xpc3QgKCkgewoJaWYgKGhhc1JlcXVpcmVkTWFwcGluZ0xpc3QpIHJldHVybiBtYXBwaW5nTGlzdCQxOwoJaGFzUmVxdWlyZWRNYXBwaW5nTGlzdCA9IDE7CgkvKgoJICogQ29weXJpZ2h0IDIwMTQgTW96aWxsYSBGb3VuZGF0aW9uIGFuZCBjb250cmlidXRvcnMKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBOZXcgQlNEIGxpY2Vuc2UuIFNlZSBMSUNFTlNFIG9yOgoJICogaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL0JTRC0zLUNsYXVzZQoJICovCgoJdmFyIHV0aWwgPSByZXF1aXJlVXRpbCgpOwoKCS8qKgoJICogRGV0ZXJtaW5lIHdoZXRoZXIgbWFwcGluZ0IgaXMgYWZ0ZXIgbWFwcGluZ0Egd2l0aCByZXNwZWN0IHRvIGdlbmVyYXRlZAoJICogcG9zaXRpb24uCgkgKi8KCWZ1bmN0aW9uIGdlbmVyYXRlZFBvc2l0aW9uQWZ0ZXIobWFwcGluZ0EsIG1hcHBpbmdCKSB7CgkgIC8vIE9wdGltaXplZCBmb3IgbW9zdCBjb21tb24gY2FzZQoJICB2YXIgbGluZUEgPSBtYXBwaW5nQS5nZW5lcmF0ZWRMaW5lOwoJICB2YXIgbGluZUIgPSBtYXBwaW5nQi5nZW5lcmF0ZWRMaW5lOwoJICB2YXIgY29sdW1uQSA9IG1hcHBpbmdBLmdlbmVyYXRlZENvbHVtbjsKCSAgdmFyIGNvbHVtbkIgPSBtYXBwaW5nQi5nZW5lcmF0ZWRDb2x1bW47CgkgIHJldHVybiBsaW5lQiA+IGxpbmVBIHx8IGxpbmVCID09IGxpbmVBICYmIGNvbHVtbkIgPj0gY29sdW1uQSB8fAoJICAgICAgICAgdXRpbC5jb21wYXJlQnlHZW5lcmF0ZWRQb3NpdGlvbnNJbmZsYXRlZChtYXBwaW5nQSwgbWFwcGluZ0IpIDw9IDA7Cgl9CgoJLyoqCgkgKiBBIGRhdGEgc3RydWN0dXJlIHRvIHByb3ZpZGUgYSBzb3J0ZWQgdmlldyBvZiBhY2N1bXVsYXRlZCBtYXBwaW5ncyBpbiBhCgkgKiBwZXJmb3JtYW5jZSBjb25zY2lvdXMgbWFubmVyLiBJdCB0cmFkZXMgYSBuZWdsaWJhYmxlIG92ZXJoZWFkIGluIGdlbmVyYWwKCSAqIGNhc2UgZm9yIGEgbGFyZ2Ugc3BlZWR1cCBpbiBjYXNlIG9mIG1hcHBpbmdzIGJlaW5nIGFkZGVkIGluIG9yZGVyLgoJICovCglmdW5jdGlvbiBNYXBwaW5nTGlzdCgpIHsKCSAgdGhpcy5fYXJyYXkgPSBbXTsKCSAgdGhpcy5fc29ydGVkID0gdHJ1ZTsKCSAgLy8gU2VydmVzIGFzIGluZmltdW0KCSAgdGhpcy5fbGFzdCA9IHtnZW5lcmF0ZWRMaW5lOiAtMSwgZ2VuZXJhdGVkQ29sdW1uOiAwfTsKCX0KCgkvKioKCSAqIEl0ZXJhdGUgdGhyb3VnaCBpbnRlcm5hbCBpdGVtcy4gVGhpcyBtZXRob2QgdGFrZXMgdGhlIHNhbWUgYXJndW1lbnRzIHRoYXQKCSAqIGBBcnJheS5wcm90b3R5cGUuZm9yRWFjaGAgdGFrZXMuCgkgKgoJICogTk9URTogVGhlIG9yZGVyIG9mIHRoZSBtYXBwaW5ncyBpcyBOT1QgZ3VhcmFudGVlZC4KCSAqLwoJTWFwcGluZ0xpc3QucHJvdG90eXBlLnVuc29ydGVkRm9yRWFjaCA9CgkgIGZ1bmN0aW9uIE1hcHBpbmdMaXN0X2ZvckVhY2goYUNhbGxiYWNrLCBhVGhpc0FyZykgewoJICAgIHRoaXMuX2FycmF5LmZvckVhY2goYUNhbGxiYWNrLCBhVGhpc0FyZyk7CgkgIH07CgoJLyoqCgkgKiBBZGQgdGhlIGdpdmVuIHNvdXJjZSBtYXBwaW5nLgoJICoKCSAqIEBwYXJhbSBPYmplY3QgYU1hcHBpbmcKCSAqLwoJTWFwcGluZ0xpc3QucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIE1hcHBpbmdMaXN0X2FkZChhTWFwcGluZykgewoJICBpZiAoZ2VuZXJhdGVkUG9zaXRpb25BZnRlcih0aGlzLl9sYXN0LCBhTWFwcGluZykpIHsKCSAgICB0aGlzLl9sYXN0ID0gYU1hcHBpbmc7CgkgICAgdGhpcy5fYXJyYXkucHVzaChhTWFwcGluZyk7CgkgIH0gZWxzZSB7CgkgICAgdGhpcy5fc29ydGVkID0gZmFsc2U7CgkgICAgdGhpcy5fYXJyYXkucHVzaChhTWFwcGluZyk7CgkgIH0KCX07CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBmbGF0LCBzb3J0ZWQgYXJyYXkgb2YgbWFwcGluZ3MuIFRoZSBtYXBwaW5ncyBhcmUgc29ydGVkIGJ5CgkgKiBnZW5lcmF0ZWQgcG9zaXRpb24uCgkgKgoJICogV0FSTklORzogVGhpcyBtZXRob2QgcmV0dXJucyBpbnRlcm5hbCBkYXRhIHdpdGhvdXQgY29weWluZywgZm9yCgkgKiBwZXJmb3JtYW5jZS4gVGhlIHJldHVybiB2YWx1ZSBtdXN0IE5PVCBiZSBtdXRhdGVkLCBhbmQgc2hvdWxkIGJlIHRyZWF0ZWQgYXMKCSAqIGFuIGltbXV0YWJsZSBib3Jyb3cuIElmIHlvdSB3YW50IHRvIHRha2Ugb3duZXJzaGlwLCB5b3UgbXVzdCBtYWtlIHlvdXIgb3duCgkgKiBjb3B5LgoJICovCglNYXBwaW5nTGlzdC5wcm90b3R5cGUudG9BcnJheSA9IGZ1bmN0aW9uIE1hcHBpbmdMaXN0X3RvQXJyYXkoKSB7CgkgIGlmICghdGhpcy5fc29ydGVkKSB7CgkgICAgdGhpcy5fYXJyYXkuc29ydCh1dGlsLmNvbXBhcmVCeUdlbmVyYXRlZFBvc2l0aW9uc0luZmxhdGVkKTsKCSAgICB0aGlzLl9zb3J0ZWQgPSB0cnVlOwoJICB9CgkgIHJldHVybiB0aGlzLl9hcnJheTsKCX07CgoJbWFwcGluZ0xpc3QkMS5NYXBwaW5nTGlzdCA9IE1hcHBpbmdMaXN0OwoJcmV0dXJuIG1hcHBpbmdMaXN0JDE7Cn0KCi8qIC0qLSBNb2RlOiBqczsganMtaW5kZW50LWxldmVsOiAyOyAtKi0gKi8KCnZhciBoYXNSZXF1aXJlZFNvdXJjZU1hcEdlbmVyYXRvcjsKCmZ1bmN0aW9uIHJlcXVpcmVTb3VyY2VNYXBHZW5lcmF0b3IgKCkgewoJaWYgKGhhc1JlcXVpcmVkU291cmNlTWFwR2VuZXJhdG9yKSByZXR1cm4gc291cmNlTWFwR2VuZXJhdG9yOwoJaGFzUmVxdWlyZWRTb3VyY2VNYXBHZW5lcmF0b3IgPSAxOwoJLyoKCSAqIENvcHlyaWdodCAyMDExIE1vemlsbGEgRm91bmRhdGlvbiBhbmQgY29udHJpYnV0b3JzCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgTmV3IEJTRCBsaWNlbnNlLiBTZWUgTElDRU5TRSBvcjoKCSAqIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9CU0QtMy1DbGF1c2UKCSAqLwoKCXZhciBiYXNlNjRWTFEgPSByZXF1aXJlQmFzZTY0VmxxKCk7Cgl2YXIgdXRpbCA9IHJlcXVpcmVVdGlsKCk7Cgl2YXIgQXJyYXlTZXQgPSByZXF1aXJlQXJyYXlTZXQoKS5BcnJheVNldDsKCXZhciBNYXBwaW5nTGlzdCA9IHJlcXVpcmVNYXBwaW5nTGlzdCgpLk1hcHBpbmdMaXN0OwoKCS8qKgoJICogQW4gaW5zdGFuY2Ugb2YgdGhlIFNvdXJjZU1hcEdlbmVyYXRvciByZXByZXNlbnRzIGEgc291cmNlIG1hcCB3aGljaCBpcwoJICogYmVpbmcgYnVpbHQgaW5jcmVtZW50YWxseS4gWW91IG1heSBwYXNzIGFuIG9iamVjdCB3aXRoIHRoZSBmb2xsb3dpbmcKCSAqIHByb3BlcnRpZXM6CgkgKgoJICogICAtIGZpbGU6IFRoZSBmaWxlbmFtZSBvZiB0aGUgZ2VuZXJhdGVkIHNvdXJjZS4KCSAqICAgLSBzb3VyY2VSb290OiBBIHJvb3QgZm9yIGFsbCByZWxhdGl2ZSBVUkxzIGluIHRoaXMgc291cmNlIG1hcC4KCSAqLwoJZnVuY3Rpb24gU291cmNlTWFwR2VuZXJhdG9yKGFBcmdzKSB7CgkgIGlmICghYUFyZ3MpIHsKCSAgICBhQXJncyA9IHt9OwoJICB9CgkgIHRoaXMuX2ZpbGUgPSB1dGlsLmdldEFyZyhhQXJncywgJ2ZpbGUnLCBudWxsKTsKCSAgdGhpcy5fc291cmNlUm9vdCA9IHV0aWwuZ2V0QXJnKGFBcmdzLCAnc291cmNlUm9vdCcsIG51bGwpOwoJICB0aGlzLl9za2lwVmFsaWRhdGlvbiA9IHV0aWwuZ2V0QXJnKGFBcmdzLCAnc2tpcFZhbGlkYXRpb24nLCBmYWxzZSk7CgkgIHRoaXMuX3NvdXJjZXMgPSBuZXcgQXJyYXlTZXQoKTsKCSAgdGhpcy5fbmFtZXMgPSBuZXcgQXJyYXlTZXQoKTsKCSAgdGhpcy5fbWFwcGluZ3MgPSBuZXcgTWFwcGluZ0xpc3QoKTsKCSAgdGhpcy5fc291cmNlc0NvbnRlbnRzID0gbnVsbDsKCX0KCglTb3VyY2VNYXBHZW5lcmF0b3IucHJvdG90eXBlLl92ZXJzaW9uID0gMzsKCgkvKioKCSAqIENyZWF0ZXMgYSBuZXcgU291cmNlTWFwR2VuZXJhdG9yIGJhc2VkIG9uIGEgU291cmNlTWFwQ29uc3VtZXIKCSAqCgkgKiBAcGFyYW0gYVNvdXJjZU1hcENvbnN1bWVyIFRoZSBTb3VyY2VNYXAuCgkgKi8KCVNvdXJjZU1hcEdlbmVyYXRvci5mcm9tU291cmNlTWFwID0KCSAgZnVuY3Rpb24gU291cmNlTWFwR2VuZXJhdG9yX2Zyb21Tb3VyY2VNYXAoYVNvdXJjZU1hcENvbnN1bWVyKSB7CgkgICAgdmFyIHNvdXJjZVJvb3QgPSBhU291cmNlTWFwQ29uc3VtZXIuc291cmNlUm9vdDsKCSAgICB2YXIgZ2VuZXJhdG9yID0gbmV3IFNvdXJjZU1hcEdlbmVyYXRvcih7CgkgICAgICBmaWxlOiBhU291cmNlTWFwQ29uc3VtZXIuZmlsZSwKCSAgICAgIHNvdXJjZVJvb3Q6IHNvdXJjZVJvb3QKCSAgICB9KTsKCSAgICBhU291cmNlTWFwQ29uc3VtZXIuZWFjaE1hcHBpbmcoZnVuY3Rpb24gKG1hcHBpbmcpIHsKCSAgICAgIHZhciBuZXdNYXBwaW5nID0gewoJICAgICAgICBnZW5lcmF0ZWQ6IHsKCSAgICAgICAgICBsaW5lOiBtYXBwaW5nLmdlbmVyYXRlZExpbmUsCgkgICAgICAgICAgY29sdW1uOiBtYXBwaW5nLmdlbmVyYXRlZENvbHVtbgoJICAgICAgICB9CgkgICAgICB9OwoKCSAgICAgIGlmIChtYXBwaW5nLnNvdXJjZSAhPSBudWxsKSB7CgkgICAgICAgIG5ld01hcHBpbmcuc291cmNlID0gbWFwcGluZy5zb3VyY2U7CgkgICAgICAgIGlmIChzb3VyY2VSb290ICE9IG51bGwpIHsKCSAgICAgICAgICBuZXdNYXBwaW5nLnNvdXJjZSA9IHV0aWwucmVsYXRpdmUoc291cmNlUm9vdCwgbmV3TWFwcGluZy5zb3VyY2UpOwoJICAgICAgICB9CgoJICAgICAgICBuZXdNYXBwaW5nLm9yaWdpbmFsID0gewoJICAgICAgICAgIGxpbmU6IG1hcHBpbmcub3JpZ2luYWxMaW5lLAoJICAgICAgICAgIGNvbHVtbjogbWFwcGluZy5vcmlnaW5hbENvbHVtbgoJICAgICAgICB9OwoKCSAgICAgICAgaWYgKG1hcHBpbmcubmFtZSAhPSBudWxsKSB7CgkgICAgICAgICAgbmV3TWFwcGluZy5uYW1lID0gbWFwcGluZy5uYW1lOwoJICAgICAgICB9CgkgICAgICB9CgoJICAgICAgZ2VuZXJhdG9yLmFkZE1hcHBpbmcobmV3TWFwcGluZyk7CgkgICAgfSk7CgkgICAgYVNvdXJjZU1hcENvbnN1bWVyLnNvdXJjZXMuZm9yRWFjaChmdW5jdGlvbiAoc291cmNlRmlsZSkgewoJICAgICAgdmFyIHNvdXJjZVJlbGF0aXZlID0gc291cmNlRmlsZTsKCSAgICAgIGlmIChzb3VyY2VSb290ICE9PSBudWxsKSB7CgkgICAgICAgIHNvdXJjZVJlbGF0aXZlID0gdXRpbC5yZWxhdGl2ZShzb3VyY2VSb290LCBzb3VyY2VGaWxlKTsKCSAgICAgIH0KCgkgICAgICBpZiAoIWdlbmVyYXRvci5fc291cmNlcy5oYXMoc291cmNlUmVsYXRpdmUpKSB7CgkgICAgICAgIGdlbmVyYXRvci5fc291cmNlcy5hZGQoc291cmNlUmVsYXRpdmUpOwoJICAgICAgfQoKCSAgICAgIHZhciBjb250ZW50ID0gYVNvdXJjZU1hcENvbnN1bWVyLnNvdXJjZUNvbnRlbnRGb3Ioc291cmNlRmlsZSk7CgkgICAgICBpZiAoY29udGVudCAhPSBudWxsKSB7CgkgICAgICAgIGdlbmVyYXRvci5zZXRTb3VyY2VDb250ZW50KHNvdXJjZUZpbGUsIGNvbnRlbnQpOwoJICAgICAgfQoJICAgIH0pOwoJICAgIHJldHVybiBnZW5lcmF0b3I7CgkgIH07CgoJLyoqCgkgKiBBZGQgYSBzaW5nbGUgbWFwcGluZyBmcm9tIG9yaWdpbmFsIHNvdXJjZSBsaW5lIGFuZCBjb2x1bW4gdG8gdGhlIGdlbmVyYXRlZAoJICogc291cmNlJ3MgbGluZSBhbmQgY29sdW1uIGZvciB0aGlzIHNvdXJjZSBtYXAgYmVpbmcgY3JlYXRlZC4gVGhlIG1hcHBpbmcKCSAqIG9iamVjdCBzaG91bGQgaGF2ZSB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6CgkgKgoJICogICAtIGdlbmVyYXRlZDogQW4gb2JqZWN0IHdpdGggdGhlIGdlbmVyYXRlZCBsaW5lIGFuZCBjb2x1bW4gcG9zaXRpb25zLgoJICogICAtIG9yaWdpbmFsOiBBbiBvYmplY3Qgd2l0aCB0aGUgb3JpZ2luYWwgbGluZSBhbmQgY29sdW1uIHBvc2l0aW9ucy4KCSAqICAgLSBzb3VyY2U6IFRoZSBvcmlnaW5hbCBzb3VyY2UgZmlsZSAocmVsYXRpdmUgdG8gdGhlIHNvdXJjZVJvb3QpLgoJICogICAtIG5hbWU6IEFuIG9wdGlvbmFsIG9yaWdpbmFsIHRva2VuIG5hbWUgZm9yIHRoaXMgbWFwcGluZy4KCSAqLwoJU291cmNlTWFwR2VuZXJhdG9yLnByb3RvdHlwZS5hZGRNYXBwaW5nID0KCSAgZnVuY3Rpb24gU291cmNlTWFwR2VuZXJhdG9yX2FkZE1hcHBpbmcoYUFyZ3MpIHsKCSAgICB2YXIgZ2VuZXJhdGVkID0gdXRpbC5nZXRBcmcoYUFyZ3MsICdnZW5lcmF0ZWQnKTsKCSAgICB2YXIgb3JpZ2luYWwgPSB1dGlsLmdldEFyZyhhQXJncywgJ29yaWdpbmFsJywgbnVsbCk7CgkgICAgdmFyIHNvdXJjZSA9IHV0aWwuZ2V0QXJnKGFBcmdzLCAnc291cmNlJywgbnVsbCk7CgkgICAgdmFyIG5hbWUgPSB1dGlsLmdldEFyZyhhQXJncywgJ25hbWUnLCBudWxsKTsKCgkgICAgaWYgKCF0aGlzLl9za2lwVmFsaWRhdGlvbikgewoJICAgICAgdGhpcy5fdmFsaWRhdGVNYXBwaW5nKGdlbmVyYXRlZCwgb3JpZ2luYWwsIHNvdXJjZSwgbmFtZSk7CgkgICAgfQoKCSAgICBpZiAoc291cmNlICE9IG51bGwpIHsKCSAgICAgIHNvdXJjZSA9IFN0cmluZyhzb3VyY2UpOwoJICAgICAgaWYgKCF0aGlzLl9zb3VyY2VzLmhhcyhzb3VyY2UpKSB7CgkgICAgICAgIHRoaXMuX3NvdXJjZXMuYWRkKHNvdXJjZSk7CgkgICAgICB9CgkgICAgfQoKCSAgICBpZiAobmFtZSAhPSBudWxsKSB7CgkgICAgICBuYW1lID0gU3RyaW5nKG5hbWUpOwoJICAgICAgaWYgKCF0aGlzLl9uYW1lcy5oYXMobmFtZSkpIHsKCSAgICAgICAgdGhpcy5fbmFtZXMuYWRkKG5hbWUpOwoJICAgICAgfQoJICAgIH0KCgkgICAgdGhpcy5fbWFwcGluZ3MuYWRkKHsKCSAgICAgIGdlbmVyYXRlZExpbmU6IGdlbmVyYXRlZC5saW5lLAoJICAgICAgZ2VuZXJhdGVkQ29sdW1uOiBnZW5lcmF0ZWQuY29sdW1uLAoJICAgICAgb3JpZ2luYWxMaW5lOiBvcmlnaW5hbCAhPSBudWxsICYmIG9yaWdpbmFsLmxpbmUsCgkgICAgICBvcmlnaW5hbENvbHVtbjogb3JpZ2luYWwgIT0gbnVsbCAmJiBvcmlnaW5hbC5jb2x1bW4sCgkgICAgICBzb3VyY2U6IHNvdXJjZSwKCSAgICAgIG5hbWU6IG5hbWUKCSAgICB9KTsKCSAgfTsKCgkvKioKCSAqIFNldCB0aGUgc291cmNlIGNvbnRlbnQgZm9yIGEgc291cmNlIGZpbGUuCgkgKi8KCVNvdXJjZU1hcEdlbmVyYXRvci5wcm90b3R5cGUuc2V0U291cmNlQ29udGVudCA9CgkgIGZ1bmN0aW9uIFNvdXJjZU1hcEdlbmVyYXRvcl9zZXRTb3VyY2VDb250ZW50KGFTb3VyY2VGaWxlLCBhU291cmNlQ29udGVudCkgewoJICAgIHZhciBzb3VyY2UgPSBhU291cmNlRmlsZTsKCSAgICBpZiAodGhpcy5fc291cmNlUm9vdCAhPSBudWxsKSB7CgkgICAgICBzb3VyY2UgPSB1dGlsLnJlbGF0aXZlKHRoaXMuX3NvdXJjZVJvb3QsIHNvdXJjZSk7CgkgICAgfQoKCSAgICBpZiAoYVNvdXJjZUNvbnRlbnQgIT0gbnVsbCkgewoJICAgICAgLy8gQWRkIHRoZSBzb3VyY2UgY29udGVudCB0byB0aGUgX3NvdXJjZXNDb250ZW50cyBtYXAuCgkgICAgICAvLyBDcmVhdGUgYSBuZXcgX3NvdXJjZXNDb250ZW50cyBtYXAgaWYgdGhlIHByb3BlcnR5IGlzIG51bGwuCgkgICAgICBpZiAoIXRoaXMuX3NvdXJjZXNDb250ZW50cykgewoJICAgICAgICB0aGlzLl9zb3VyY2VzQ29udGVudHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwoJICAgICAgfQoJICAgICAgdGhpcy5fc291cmNlc0NvbnRlbnRzW3V0aWwudG9TZXRTdHJpbmcoc291cmNlKV0gPSBhU291cmNlQ29udGVudDsKCSAgICB9IGVsc2UgaWYgKHRoaXMuX3NvdXJjZXNDb250ZW50cykgewoJICAgICAgLy8gUmVtb3ZlIHRoZSBzb3VyY2UgZmlsZSBmcm9tIHRoZSBfc291cmNlc0NvbnRlbnRzIG1hcC4KCSAgICAgIC8vIElmIHRoZSBfc291cmNlc0NvbnRlbnRzIG1hcCBpcyBlbXB0eSwgc2V0IHRoZSBwcm9wZXJ0eSB0byBudWxsLgoJICAgICAgZGVsZXRlIHRoaXMuX3NvdXJjZXNDb250ZW50c1t1dGlsLnRvU2V0U3RyaW5nKHNvdXJjZSldOwoJICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuX3NvdXJjZXNDb250ZW50cykubGVuZ3RoID09PSAwKSB7CgkgICAgICAgIHRoaXMuX3NvdXJjZXNDb250ZW50cyA9IG51bGw7CgkgICAgICB9CgkgICAgfQoJICB9OwoKCS8qKgoJICogQXBwbGllcyB0aGUgbWFwcGluZ3Mgb2YgYSBzdWItc291cmNlLW1hcCBmb3IgYSBzcGVjaWZpYyBzb3VyY2UgZmlsZSB0byB0aGUKCSAqIHNvdXJjZSBtYXAgYmVpbmcgZ2VuZXJhdGVkLiBFYWNoIG1hcHBpbmcgdG8gdGhlIHN1cHBsaWVkIHNvdXJjZSBmaWxlIGlzCgkgKiByZXdyaXR0ZW4gdXNpbmcgdGhlIHN1cHBsaWVkIHNvdXJjZSBtYXAuIE5vdGU6IFRoZSByZXNvbHV0aW9uIGZvciB0aGUKCSAqIHJlc3VsdGluZyBtYXBwaW5ncyBpcyB0aGUgbWluaW1pdW0gb2YgdGhpcyBtYXAgYW5kIHRoZSBzdXBwbGllZCBtYXAuCgkgKgoJICogQHBhcmFtIGFTb3VyY2VNYXBDb25zdW1lciBUaGUgc291cmNlIG1hcCB0byBiZSBhcHBsaWVkLgoJICogQHBhcmFtIGFTb3VyY2VGaWxlIE9wdGlvbmFsLiBUaGUgZmlsZW5hbWUgb2YgdGhlIHNvdXJjZSBmaWxlLgoJICogICAgICAgIElmIG9taXR0ZWQsIFNvdXJjZU1hcENvbnN1bWVyJ3MgZmlsZSBwcm9wZXJ0eSB3aWxsIGJlIHVzZWQuCgkgKiBAcGFyYW0gYVNvdXJjZU1hcFBhdGggT3B0aW9uYWwuIFRoZSBkaXJuYW1lIG9mIHRoZSBwYXRoIHRvIHRoZSBzb3VyY2UgbWFwCgkgKiAgICAgICAgdG8gYmUgYXBwbGllZC4gSWYgcmVsYXRpdmUsIGl0IGlzIHJlbGF0aXZlIHRvIHRoZSBTb3VyY2VNYXBDb25zdW1lci4KCSAqICAgICAgICBUaGlzIHBhcmFtZXRlciBpcyBuZWVkZWQgd2hlbiB0aGUgdHdvIHNvdXJjZSBtYXBzIGFyZW4ndCBpbiB0aGUgc2FtZQoJICogICAgICAgIGRpcmVjdG9yeSwgYW5kIHRoZSBzb3VyY2UgbWFwIHRvIGJlIGFwcGxpZWQgY29udGFpbnMgcmVsYXRpdmUgc291cmNlCgkgKiAgICAgICAgcGF0aHMuIElmIHNvLCB0aG9zZSByZWxhdGl2ZSBzb3VyY2UgcGF0aHMgbmVlZCB0byBiZSByZXdyaXR0ZW4KCSAqICAgICAgICByZWxhdGl2ZSB0byB0aGUgU291cmNlTWFwR2VuZXJhdG9yLgoJICovCglTb3VyY2VNYXBHZW5lcmF0b3IucHJvdG90eXBlLmFwcGx5U291cmNlTWFwID0KCSAgZnVuY3Rpb24gU291cmNlTWFwR2VuZXJhdG9yX2FwcGx5U291cmNlTWFwKGFTb3VyY2VNYXBDb25zdW1lciwgYVNvdXJjZUZpbGUsIGFTb3VyY2VNYXBQYXRoKSB7CgkgICAgdmFyIHNvdXJjZUZpbGUgPSBhU291cmNlRmlsZTsKCSAgICAvLyBJZiBhU291cmNlRmlsZSBpcyBvbWl0dGVkLCB3ZSB3aWxsIHVzZSB0aGUgZmlsZSBwcm9wZXJ0eSBvZiB0aGUgU291cmNlTWFwCgkgICAgaWYgKGFTb3VyY2VGaWxlID09IG51bGwpIHsKCSAgICAgIGlmIChhU291cmNlTWFwQ29uc3VtZXIuZmlsZSA9PSBudWxsKSB7CgkgICAgICAgIHRocm93IG5ldyBFcnJvcigKCSAgICAgICAgICAnU291cmNlTWFwR2VuZXJhdG9yLnByb3RvdHlwZS5hcHBseVNvdXJjZU1hcCByZXF1aXJlcyBlaXRoZXIgYW4gZXhwbGljaXQgc291cmNlIGZpbGUsICcgKwoJICAgICAgICAgICdvciB0aGUgc291cmNlIG1hcFwncyAiZmlsZSIgcHJvcGVydHkuIEJvdGggd2VyZSBvbWl0dGVkLicKCSAgICAgICAgKTsKCSAgICAgIH0KCSAgICAgIHNvdXJjZUZpbGUgPSBhU291cmNlTWFwQ29uc3VtZXIuZmlsZTsKCSAgICB9CgkgICAgdmFyIHNvdXJjZVJvb3QgPSB0aGlzLl9zb3VyY2VSb290OwoJICAgIC8vIE1ha2UgInNvdXJjZUZpbGUiIHJlbGF0aXZlIGlmIGFuIGFic29sdXRlIFVybCBpcyBwYXNzZWQuCgkgICAgaWYgKHNvdXJjZVJvb3QgIT0gbnVsbCkgewoJICAgICAgc291cmNlRmlsZSA9IHV0aWwucmVsYXRpdmUoc291cmNlUm9vdCwgc291cmNlRmlsZSk7CgkgICAgfQoJICAgIC8vIEFwcGx5aW5nIHRoZSBTb3VyY2VNYXAgY2FuIGFkZCBhbmQgcmVtb3ZlIGl0ZW1zIGZyb20gdGhlIHNvdXJjZXMgYW5kCgkgICAgLy8gdGhlIG5hbWVzIGFycmF5LgoJICAgIHZhciBuZXdTb3VyY2VzID0gbmV3IEFycmF5U2V0KCk7CgkgICAgdmFyIG5ld05hbWVzID0gbmV3IEFycmF5U2V0KCk7CgoJICAgIC8vIEZpbmQgbWFwcGluZ3MgZm9yIHRoZSAic291cmNlRmlsZSIKCSAgICB0aGlzLl9tYXBwaW5ncy51bnNvcnRlZEZvckVhY2goZnVuY3Rpb24gKG1hcHBpbmcpIHsKCSAgICAgIGlmIChtYXBwaW5nLnNvdXJjZSA9PT0gc291cmNlRmlsZSAmJiBtYXBwaW5nLm9yaWdpbmFsTGluZSAhPSBudWxsKSB7CgkgICAgICAgIC8vIENoZWNrIGlmIGl0IGNhbiBiZSBtYXBwZWQgYnkgdGhlIHNvdXJjZSBtYXAsIHRoZW4gdXBkYXRlIHRoZSBtYXBwaW5nLgoJICAgICAgICB2YXIgb3JpZ2luYWwgPSBhU291cmNlTWFwQ29uc3VtZXIub3JpZ2luYWxQb3NpdGlvbkZvcih7CgkgICAgICAgICAgbGluZTogbWFwcGluZy5vcmlnaW5hbExpbmUsCgkgICAgICAgICAgY29sdW1uOiBtYXBwaW5nLm9yaWdpbmFsQ29sdW1uCgkgICAgICAgIH0pOwoJICAgICAgICBpZiAob3JpZ2luYWwuc291cmNlICE9IG51bGwpIHsKCSAgICAgICAgICAvLyBDb3B5IG1hcHBpbmcKCSAgICAgICAgICBtYXBwaW5nLnNvdXJjZSA9IG9yaWdpbmFsLnNvdXJjZTsKCSAgICAgICAgICBpZiAoYVNvdXJjZU1hcFBhdGggIT0gbnVsbCkgewoJICAgICAgICAgICAgbWFwcGluZy5zb3VyY2UgPSB1dGlsLmpvaW4oYVNvdXJjZU1hcFBhdGgsIG1hcHBpbmcuc291cmNlKTsKCSAgICAgICAgICB9CgkgICAgICAgICAgaWYgKHNvdXJjZVJvb3QgIT0gbnVsbCkgewoJICAgICAgICAgICAgbWFwcGluZy5zb3VyY2UgPSB1dGlsLnJlbGF0aXZlKHNvdXJjZVJvb3QsIG1hcHBpbmcuc291cmNlKTsKCSAgICAgICAgICB9CgkgICAgICAgICAgbWFwcGluZy5vcmlnaW5hbExpbmUgPSBvcmlnaW5hbC5saW5lOwoJICAgICAgICAgIG1hcHBpbmcub3JpZ2luYWxDb2x1bW4gPSBvcmlnaW5hbC5jb2x1bW47CgkgICAgICAgICAgaWYgKG9yaWdpbmFsLm5hbWUgIT0gbnVsbCkgewoJICAgICAgICAgICAgbWFwcGluZy5uYW1lID0gb3JpZ2luYWwubmFtZTsKCSAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgIH0KCgkgICAgICB2YXIgc291cmNlID0gbWFwcGluZy5zb3VyY2U7CgkgICAgICBpZiAoc291cmNlICE9IG51bGwgJiYgIW5ld1NvdXJjZXMuaGFzKHNvdXJjZSkpIHsKCSAgICAgICAgbmV3U291cmNlcy5hZGQoc291cmNlKTsKCSAgICAgIH0KCgkgICAgICB2YXIgbmFtZSA9IG1hcHBpbmcubmFtZTsKCSAgICAgIGlmIChuYW1lICE9IG51bGwgJiYgIW5ld05hbWVzLmhhcyhuYW1lKSkgewoJICAgICAgICBuZXdOYW1lcy5hZGQobmFtZSk7CgkgICAgICB9CgoJICAgIH0sIHRoaXMpOwoJICAgIHRoaXMuX3NvdXJjZXMgPSBuZXdTb3VyY2VzOwoJICAgIHRoaXMuX25hbWVzID0gbmV3TmFtZXM7CgoJICAgIC8vIENvcHkgc291cmNlc0NvbnRlbnRzIG9mIGFwcGxpZWQgbWFwLgoJICAgIGFTb3VyY2VNYXBDb25zdW1lci5zb3VyY2VzLmZvckVhY2goZnVuY3Rpb24gKHNvdXJjZUZpbGUpIHsKCSAgICAgIHZhciBjb250ZW50ID0gYVNvdXJjZU1hcENvbnN1bWVyLnNvdXJjZUNvbnRlbnRGb3Ioc291cmNlRmlsZSk7CgkgICAgICBpZiAoY29udGVudCAhPSBudWxsKSB7CgkgICAgICAgIGlmIChhU291cmNlTWFwUGF0aCAhPSBudWxsKSB7CgkgICAgICAgICAgc291cmNlRmlsZSA9IHV0aWwuam9pbihhU291cmNlTWFwUGF0aCwgc291cmNlRmlsZSk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHNvdXJjZVJvb3QgIT0gbnVsbCkgewoJICAgICAgICAgIHNvdXJjZUZpbGUgPSB1dGlsLnJlbGF0aXZlKHNvdXJjZVJvb3QsIHNvdXJjZUZpbGUpOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuc2V0U291cmNlQ29udGVudChzb3VyY2VGaWxlLCBjb250ZW50KTsKCSAgICAgIH0KCSAgICB9LCB0aGlzKTsKCSAgfTsKCgkvKioKCSAqIEEgbWFwcGluZyBjYW4gaGF2ZSBvbmUgb2YgdGhlIHRocmVlIGxldmVscyBvZiBkYXRhOgoJICoKCSAqICAgMS4gSnVzdCB0aGUgZ2VuZXJhdGVkIHBvc2l0aW9uLgoJICogICAyLiBUaGUgR2VuZXJhdGVkIHBvc2l0aW9uLCBvcmlnaW5hbCBwb3NpdGlvbiwgYW5kIG9yaWdpbmFsIHNvdXJjZS4KCSAqICAgMy4gR2VuZXJhdGVkIGFuZCBvcmlnaW5hbCBwb3NpdGlvbiwgb3JpZ2luYWwgc291cmNlLCBhcyB3ZWxsIGFzIGEgbmFtZQoJICogICAgICB0b2tlbi4KCSAqCgkgKiBUbyBtYWludGFpbiBjb25zaXN0ZW5jeSwgd2UgdmFsaWRhdGUgdGhhdCBhbnkgbmV3IG1hcHBpbmcgYmVpbmcgYWRkZWQgZmFsbHMKCSAqIGluIHRvIG9uZSBvZiB0aGVzZSBjYXRlZ29yaWVzLgoJICovCglTb3VyY2VNYXBHZW5lcmF0b3IucHJvdG90eXBlLl92YWxpZGF0ZU1hcHBpbmcgPQoJICBmdW5jdGlvbiBTb3VyY2VNYXBHZW5lcmF0b3JfdmFsaWRhdGVNYXBwaW5nKGFHZW5lcmF0ZWQsIGFPcmlnaW5hbCwgYVNvdXJjZSwKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhTmFtZSkgewoJICAgIC8vIFdoZW4gYU9yaWdpbmFsIGlzIHRydXRoeSBidXQgaGFzIGVtcHR5IHZhbHVlcyBmb3IgLmxpbmUgYW5kIC5jb2x1bW4sCgkgICAgLy8gaXQgaXMgbW9zdCBsaWtlbHkgYSBwcm9ncmFtbWVyIGVycm9yLiBJbiB0aGlzIGNhc2Ugd2UgdGhyb3cgYSB2ZXJ5CgkgICAgLy8gc3BlY2lmaWMgZXJyb3IgbWVzc2FnZSB0byB0cnkgdG8gZ3VpZGUgdGhlbSB0aGUgcmlnaHQgd2F5LgoJICAgIC8vIEZvciBleGFtcGxlOiBodHRwczovL2dpdGh1Yi5jb20vUG9seW1lci9wb2x5bWVyLWJ1bmRsZXIvcHVsbC81MTkKCSAgICBpZiAoYU9yaWdpbmFsICYmIHR5cGVvZiBhT3JpZ2luYWwubGluZSAhPT0gJ251bWJlcicgJiYgdHlwZW9mIGFPcmlnaW5hbC5jb2x1bW4gIT09ICdudW1iZXInKSB7CgkgICAgICAgIHRocm93IG5ldyBFcnJvcigKCSAgICAgICAgICAgICdvcmlnaW5hbC5saW5lIGFuZCBvcmlnaW5hbC5jb2x1bW4gYXJlIG5vdCBudW1iZXJzIC0tIHlvdSBwcm9iYWJseSBtZWFudCB0byBvbWl0ICcgKwoJICAgICAgICAgICAgJ3RoZSBvcmlnaW5hbCBtYXBwaW5nIGVudGlyZWx5IGFuZCBvbmx5IG1hcCB0aGUgZ2VuZXJhdGVkIHBvc2l0aW9uLiBJZiBzbywgcGFzcyAnICsKCSAgICAgICAgICAgICdudWxsIGZvciB0aGUgb3JpZ2luYWwgbWFwcGluZyBpbnN0ZWFkIG9mIGFuIG9iamVjdCB3aXRoIGVtcHR5IG9yIG51bGwgdmFsdWVzLicKCSAgICAgICAgKTsKCSAgICB9CgoJICAgIGlmIChhR2VuZXJhdGVkICYmICdsaW5lJyBpbiBhR2VuZXJhdGVkICYmICdjb2x1bW4nIGluIGFHZW5lcmF0ZWQKCSAgICAgICAgJiYgYUdlbmVyYXRlZC5saW5lID4gMCAmJiBhR2VuZXJhdGVkLmNvbHVtbiA+PSAwCgkgICAgICAgICYmICFhT3JpZ2luYWwgJiYgIWFTb3VyY2UgJiYgIWFOYW1lKSB7CgkgICAgICAvLyBDYXNlIDEuCgkgICAgICByZXR1cm47CgkgICAgfQoJICAgIGVsc2UgaWYgKGFHZW5lcmF0ZWQgJiYgJ2xpbmUnIGluIGFHZW5lcmF0ZWQgJiYgJ2NvbHVtbicgaW4gYUdlbmVyYXRlZAoJICAgICAgICAgICAgICYmIGFPcmlnaW5hbCAmJiAnbGluZScgaW4gYU9yaWdpbmFsICYmICdjb2x1bW4nIGluIGFPcmlnaW5hbAoJICAgICAgICAgICAgICYmIGFHZW5lcmF0ZWQubGluZSA+IDAgJiYgYUdlbmVyYXRlZC5jb2x1bW4gPj0gMAoJICAgICAgICAgICAgICYmIGFPcmlnaW5hbC5saW5lID4gMCAmJiBhT3JpZ2luYWwuY29sdW1uID49IDAKCSAgICAgICAgICAgICAmJiBhU291cmNlKSB7CgkgICAgICAvLyBDYXNlcyAyIGFuZCAzLgoJICAgICAgcmV0dXJuOwoJICAgIH0KCSAgICBlbHNlIHsKCSAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBtYXBwaW5nOiAnICsgSlNPTi5zdHJpbmdpZnkoewoJICAgICAgICBnZW5lcmF0ZWQ6IGFHZW5lcmF0ZWQsCgkgICAgICAgIHNvdXJjZTogYVNvdXJjZSwKCSAgICAgICAgb3JpZ2luYWw6IGFPcmlnaW5hbCwKCSAgICAgICAgbmFtZTogYU5hbWUKCSAgICAgIH0pKTsKCSAgICB9CgkgIH07CgoJLyoqCgkgKiBTZXJpYWxpemUgdGhlIGFjY3VtdWxhdGVkIG1hcHBpbmdzIGluIHRvIHRoZSBzdHJlYW0gb2YgYmFzZSA2NCBWTFFzCgkgKiBzcGVjaWZpZWQgYnkgdGhlIHNvdXJjZSBtYXAgZm9ybWF0LgoJICovCglTb3VyY2VNYXBHZW5lcmF0b3IucHJvdG90eXBlLl9zZXJpYWxpemVNYXBwaW5ncyA9CgkgIGZ1bmN0aW9uIFNvdXJjZU1hcEdlbmVyYXRvcl9zZXJpYWxpemVNYXBwaW5ncygpIHsKCSAgICB2YXIgcHJldmlvdXNHZW5lcmF0ZWRDb2x1bW4gPSAwOwoJICAgIHZhciBwcmV2aW91c0dlbmVyYXRlZExpbmUgPSAxOwoJICAgIHZhciBwcmV2aW91c09yaWdpbmFsQ29sdW1uID0gMDsKCSAgICB2YXIgcHJldmlvdXNPcmlnaW5hbExpbmUgPSAwOwoJICAgIHZhciBwcmV2aW91c05hbWUgPSAwOwoJICAgIHZhciBwcmV2aW91c1NvdXJjZSA9IDA7CgkgICAgdmFyIHJlc3VsdCA9ICcnOwoJICAgIHZhciBuZXh0OwoJICAgIHZhciBtYXBwaW5nOwoJICAgIHZhciBuYW1lSWR4OwoJICAgIHZhciBzb3VyY2VJZHg7CgoJICAgIHZhciBtYXBwaW5ncyA9IHRoaXMuX21hcHBpbmdzLnRvQXJyYXkoKTsKCSAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gbWFwcGluZ3MubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKCSAgICAgIG1hcHBpbmcgPSBtYXBwaW5nc1tpXTsKCSAgICAgIG5leHQgPSAnJzsKCgkgICAgICBpZiAobWFwcGluZy5nZW5lcmF0ZWRMaW5lICE9PSBwcmV2aW91c0dlbmVyYXRlZExpbmUpIHsKCSAgICAgICAgcHJldmlvdXNHZW5lcmF0ZWRDb2x1bW4gPSAwOwoJICAgICAgICB3aGlsZSAobWFwcGluZy5nZW5lcmF0ZWRMaW5lICE9PSBwcmV2aW91c0dlbmVyYXRlZExpbmUpIHsKCSAgICAgICAgICBuZXh0ICs9ICc7JzsKCSAgICAgICAgICBwcmV2aW91c0dlbmVyYXRlZExpbmUrKzsKCSAgICAgICAgfQoJICAgICAgfQoJICAgICAgZWxzZSB7CgkgICAgICAgIGlmIChpID4gMCkgewoJICAgICAgICAgIGlmICghdXRpbC5jb21wYXJlQnlHZW5lcmF0ZWRQb3NpdGlvbnNJbmZsYXRlZChtYXBwaW5nLCBtYXBwaW5nc1tpIC0gMV0pKSB7CgkgICAgICAgICAgICBjb250aW51ZTsKCSAgICAgICAgICB9CgkgICAgICAgICAgbmV4dCArPSAnLCc7CgkgICAgICAgIH0KCSAgICAgIH0KCgkgICAgICBuZXh0ICs9IGJhc2U2NFZMUS5lbmNvZGUobWFwcGluZy5nZW5lcmF0ZWRDb2x1bW4KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0gcHJldmlvdXNHZW5lcmF0ZWRDb2x1bW4pOwoJICAgICAgcHJldmlvdXNHZW5lcmF0ZWRDb2x1bW4gPSBtYXBwaW5nLmdlbmVyYXRlZENvbHVtbjsKCgkgICAgICBpZiAobWFwcGluZy5zb3VyY2UgIT0gbnVsbCkgewoJICAgICAgICBzb3VyY2VJZHggPSB0aGlzLl9zb3VyY2VzLmluZGV4T2YobWFwcGluZy5zb3VyY2UpOwoJICAgICAgICBuZXh0ICs9IGJhc2U2NFZMUS5lbmNvZGUoc291cmNlSWR4IC0gcHJldmlvdXNTb3VyY2UpOwoJICAgICAgICBwcmV2aW91c1NvdXJjZSA9IHNvdXJjZUlkeDsKCgkgICAgICAgIC8vIGxpbmVzIGFyZSBzdG9yZWQgMC1iYXNlZCBpbiBTb3VyY2VNYXAgc3BlYyB2ZXJzaW9uIDMKCSAgICAgICAgbmV4dCArPSBiYXNlNjRWTFEuZW5jb2RlKG1hcHBpbmcub3JpZ2luYWxMaW5lIC0gMQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtIHByZXZpb3VzT3JpZ2luYWxMaW5lKTsKCSAgICAgICAgcHJldmlvdXNPcmlnaW5hbExpbmUgPSBtYXBwaW5nLm9yaWdpbmFsTGluZSAtIDE7CgoJICAgICAgICBuZXh0ICs9IGJhc2U2NFZMUS5lbmNvZGUobWFwcGluZy5vcmlnaW5hbENvbHVtbgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtIHByZXZpb3VzT3JpZ2luYWxDb2x1bW4pOwoJICAgICAgICBwcmV2aW91c09yaWdpbmFsQ29sdW1uID0gbWFwcGluZy5vcmlnaW5hbENvbHVtbjsKCgkgICAgICAgIGlmIChtYXBwaW5nLm5hbWUgIT0gbnVsbCkgewoJICAgICAgICAgIG5hbWVJZHggPSB0aGlzLl9uYW1lcy5pbmRleE9mKG1hcHBpbmcubmFtZSk7CgkgICAgICAgICAgbmV4dCArPSBiYXNlNjRWTFEuZW5jb2RlKG5hbWVJZHggLSBwcmV2aW91c05hbWUpOwoJICAgICAgICAgIHByZXZpb3VzTmFtZSA9IG5hbWVJZHg7CgkgICAgICAgIH0KCSAgICAgIH0KCgkgICAgICByZXN1bHQgKz0gbmV4dDsKCSAgICB9CgoJICAgIHJldHVybiByZXN1bHQ7CgkgIH07CgoJU291cmNlTWFwR2VuZXJhdG9yLnByb3RvdHlwZS5fZ2VuZXJhdGVTb3VyY2VzQ29udGVudCA9CgkgIGZ1bmN0aW9uIFNvdXJjZU1hcEdlbmVyYXRvcl9nZW5lcmF0ZVNvdXJjZXNDb250ZW50KGFTb3VyY2VzLCBhU291cmNlUm9vdCkgewoJICAgIHJldHVybiBhU291cmNlcy5tYXAoZnVuY3Rpb24gKHNvdXJjZSkgewoJICAgICAgaWYgKCF0aGlzLl9zb3VyY2VzQ29udGVudHMpIHsKCSAgICAgICAgcmV0dXJuIG51bGw7CgkgICAgICB9CgkgICAgICBpZiAoYVNvdXJjZVJvb3QgIT0gbnVsbCkgewoJICAgICAgICBzb3VyY2UgPSB1dGlsLnJlbGF0aXZlKGFTb3VyY2VSb290LCBzb3VyY2UpOwoJICAgICAgfQoJICAgICAgdmFyIGtleSA9IHV0aWwudG9TZXRTdHJpbmcoc291cmNlKTsKCSAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodGhpcy5fc291cmNlc0NvbnRlbnRzLCBrZXkpCgkgICAgICAgID8gdGhpcy5fc291cmNlc0NvbnRlbnRzW2tleV0KCSAgICAgICAgOiBudWxsOwoJICAgIH0sIHRoaXMpOwoJICB9OwoKCS8qKgoJICogRXh0ZXJuYWxpemUgdGhlIHNvdXJjZSBtYXAuCgkgKi8KCVNvdXJjZU1hcEdlbmVyYXRvci5wcm90b3R5cGUudG9KU09OID0KCSAgZnVuY3Rpb24gU291cmNlTWFwR2VuZXJhdG9yX3RvSlNPTigpIHsKCSAgICB2YXIgbWFwID0gewoJICAgICAgdmVyc2lvbjogdGhpcy5fdmVyc2lvbiwKCSAgICAgIHNvdXJjZXM6IHRoaXMuX3NvdXJjZXMudG9BcnJheSgpLAoJICAgICAgbmFtZXM6IHRoaXMuX25hbWVzLnRvQXJyYXkoKSwKCSAgICAgIG1hcHBpbmdzOiB0aGlzLl9zZXJpYWxpemVNYXBwaW5ncygpCgkgICAgfTsKCSAgICBpZiAodGhpcy5fZmlsZSAhPSBudWxsKSB7CgkgICAgICBtYXAuZmlsZSA9IHRoaXMuX2ZpbGU7CgkgICAgfQoJICAgIGlmICh0aGlzLl9zb3VyY2VSb290ICE9IG51bGwpIHsKCSAgICAgIG1hcC5zb3VyY2VSb290ID0gdGhpcy5fc291cmNlUm9vdDsKCSAgICB9CgkgICAgaWYgKHRoaXMuX3NvdXJjZXNDb250ZW50cykgewoJICAgICAgbWFwLnNvdXJjZXNDb250ZW50ID0gdGhpcy5fZ2VuZXJhdGVTb3VyY2VzQ29udGVudChtYXAuc291cmNlcywgbWFwLnNvdXJjZVJvb3QpOwoJICAgIH0KCgkgICAgcmV0dXJuIG1hcDsKCSAgfTsKCgkvKioKCSAqIFJlbmRlciB0aGUgc291cmNlIG1hcCBiZWluZyBnZW5lcmF0ZWQgdG8gYSBzdHJpbmcuCgkgKi8KCVNvdXJjZU1hcEdlbmVyYXRvci5wcm90b3R5cGUudG9TdHJpbmcgPQoJICBmdW5jdGlvbiBTb3VyY2VNYXBHZW5lcmF0b3JfdG9TdHJpbmcoKSB7CgkgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMudG9KU09OKCkpOwoJICB9OwoKCXNvdXJjZU1hcEdlbmVyYXRvci5Tb3VyY2VNYXBHZW5lcmF0b3IgPSBTb3VyY2VNYXBHZW5lcmF0b3I7CglyZXR1cm4gc291cmNlTWFwR2VuZXJhdG9yOwp9Cgp2YXIgc291cmNlTWFwQ29uc3VtZXIgPSB7fTsKCnZhciBiaW5hcnlTZWFyY2ggPSB7fTsKCi8qIC0qLSBNb2RlOiBqczsganMtaW5kZW50LWxldmVsOiAyOyAtKi0gKi8KCnZhciBoYXNSZXF1aXJlZEJpbmFyeVNlYXJjaDsKCmZ1bmN0aW9uIHJlcXVpcmVCaW5hcnlTZWFyY2ggKCkgewoJaWYgKGhhc1JlcXVpcmVkQmluYXJ5U2VhcmNoKSByZXR1cm4gYmluYXJ5U2VhcmNoOwoJaGFzUmVxdWlyZWRCaW5hcnlTZWFyY2ggPSAxOwoJKGZ1bmN0aW9uIChleHBvcnRzKSB7CgkJLyoKCQkgKiBDb3B5cmlnaHQgMjAxMSBNb3ppbGxhIEZvdW5kYXRpb24gYW5kIGNvbnRyaWJ1dG9ycwoJCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBOZXcgQlNEIGxpY2Vuc2UuIFNlZSBMSUNFTlNFIG9yOgoJCSAqIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9CU0QtMy1DbGF1c2UKCQkgKi8KCgkJZXhwb3J0cy5HUkVBVEVTVF9MT1dFUl9CT1VORCA9IDE7CgkJZXhwb3J0cy5MRUFTVF9VUFBFUl9CT1VORCA9IDI7CgoJCS8qKgoJCSAqIFJlY3Vyc2l2ZSBpbXBsZW1lbnRhdGlvbiBvZiBiaW5hcnkgc2VhcmNoLgoJCSAqCgkJICogQHBhcmFtIGFMb3cgSW5kaWNlcyBoZXJlIGFuZCBsb3dlciBkbyBub3QgY29udGFpbiB0aGUgbmVlZGxlLgoJCSAqIEBwYXJhbSBhSGlnaCBJbmRpY2VzIGhlcmUgYW5kIGhpZ2hlciBkbyBub3QgY29udGFpbiB0aGUgbmVlZGxlLgoJCSAqIEBwYXJhbSBhTmVlZGxlIFRoZSBlbGVtZW50IGJlaW5nIHNlYXJjaGVkIGZvci4KCQkgKiBAcGFyYW0gYUhheXN0YWNrIFRoZSBub24tZW1wdHkgYXJyYXkgYmVpbmcgc2VhcmNoZWQuCgkJICogQHBhcmFtIGFDb21wYXJlIEZ1bmN0aW9uIHdoaWNoIHRha2VzIHR3byBlbGVtZW50cyBhbmQgcmV0dXJucyAtMSwgMCwgb3IgMS4KCQkgKiBAcGFyYW0gYUJpYXMgRWl0aGVyICdiaW5hcnlTZWFyY2guR1JFQVRFU1RfTE9XRVJfQk9VTkQnIG9yCgkJICogICAgICdiaW5hcnlTZWFyY2guTEVBU1RfVVBQRVJfQk9VTkQnLiBTcGVjaWZpZXMgd2hldGhlciB0byByZXR1cm4gdGhlCgkJICogICAgIGNsb3Nlc3QgZWxlbWVudCB0aGF0IGlzIHNtYWxsZXIgdGhhbiBvciBncmVhdGVyIHRoYW4gdGhlIG9uZSB3ZSBhcmUKCQkgKiAgICAgc2VhcmNoaW5nIGZvciwgcmVzcGVjdGl2ZWx5LCBpZiB0aGUgZXhhY3QgZWxlbWVudCBjYW5ub3QgYmUgZm91bmQuCgkJICovCgkJZnVuY3Rpb24gcmVjdXJzaXZlU2VhcmNoKGFMb3csIGFIaWdoLCBhTmVlZGxlLCBhSGF5c3RhY2ssIGFDb21wYXJlLCBhQmlhcykgewoJCSAgLy8gVGhpcyBmdW5jdGlvbiB0ZXJtaW5hdGVzIHdoZW4gb25lIG9mIHRoZSBmb2xsb3dpbmcgaXMgdHJ1ZToKCQkgIC8vCgkJICAvLyAgIDEuIFdlIGZpbmQgdGhlIGV4YWN0IGVsZW1lbnQgd2UgYXJlIGxvb2tpbmcgZm9yLgoJCSAgLy8KCQkgIC8vICAgMi4gV2UgZGlkIG5vdCBmaW5kIHRoZSBleGFjdCBlbGVtZW50LCBidXQgd2UgY2FuIHJldHVybiB0aGUgaW5kZXggb2YKCQkgIC8vICAgICAgdGhlIG5leHQtY2xvc2VzdCBlbGVtZW50LgoJCSAgLy8KCQkgIC8vICAgMy4gV2UgZGlkIG5vdCBmaW5kIHRoZSBleGFjdCBlbGVtZW50LCBhbmQgdGhlcmUgaXMgbm8gbmV4dC1jbG9zZXN0CgkJICAvLyAgICAgIGVsZW1lbnQgdGhhbiB0aGUgb25lIHdlIGFyZSBzZWFyY2hpbmcgZm9yLCBzbyB3ZSByZXR1cm4gLTEuCgkJICB2YXIgbWlkID0gTWF0aC5mbG9vcigoYUhpZ2ggLSBhTG93KSAvIDIpICsgYUxvdzsKCQkgIHZhciBjbXAgPSBhQ29tcGFyZShhTmVlZGxlLCBhSGF5c3RhY2tbbWlkXSwgdHJ1ZSk7CgkJICBpZiAoY21wID09PSAwKSB7CgkJICAgIC8vIEZvdW5kIHRoZSBlbGVtZW50IHdlIGFyZSBsb29raW5nIGZvci4KCQkgICAgcmV0dXJuIG1pZDsKCQkgIH0KCQkgIGVsc2UgaWYgKGNtcCA+IDApIHsKCQkgICAgLy8gT3VyIG5lZWRsZSBpcyBncmVhdGVyIHRoYW4gYUhheXN0YWNrW21pZF0uCgkJICAgIGlmIChhSGlnaCAtIG1pZCA+IDEpIHsKCQkgICAgICAvLyBUaGUgZWxlbWVudCBpcyBpbiB0aGUgdXBwZXIgaGFsZi4KCQkgICAgICByZXR1cm4gcmVjdXJzaXZlU2VhcmNoKG1pZCwgYUhpZ2gsIGFOZWVkbGUsIGFIYXlzdGFjaywgYUNvbXBhcmUsIGFCaWFzKTsKCQkgICAgfQoKCQkgICAgLy8gVGhlIGV4YWN0IG5lZWRsZSBlbGVtZW50IHdhcyBub3QgZm91bmQgaW4gdGhpcyBoYXlzdGFjay4gRGV0ZXJtaW5lIGlmCgkJICAgIC8vIHdlIGFyZSBpbiB0ZXJtaW5hdGlvbiBjYXNlICgzKSBvciAoMikgYW5kIHJldHVybiB0aGUgYXBwcm9wcmlhdGUgdGhpbmcuCgkJICAgIGlmIChhQmlhcyA9PSBleHBvcnRzLkxFQVNUX1VQUEVSX0JPVU5EKSB7CgkJICAgICAgcmV0dXJuIGFIaWdoIDwgYUhheXN0YWNrLmxlbmd0aCA/IGFIaWdoIDogLTE7CgkJICAgIH0gZWxzZSB7CgkJICAgICAgcmV0dXJuIG1pZDsKCQkgICAgfQoJCSAgfQoJCSAgZWxzZSB7CgkJICAgIC8vIE91ciBuZWVkbGUgaXMgbGVzcyB0aGFuIGFIYXlzdGFja1ttaWRdLgoJCSAgICBpZiAobWlkIC0gYUxvdyA+IDEpIHsKCQkgICAgICAvLyBUaGUgZWxlbWVudCBpcyBpbiB0aGUgbG93ZXIgaGFsZi4KCQkgICAgICByZXR1cm4gcmVjdXJzaXZlU2VhcmNoKGFMb3csIG1pZCwgYU5lZWRsZSwgYUhheXN0YWNrLCBhQ29tcGFyZSwgYUJpYXMpOwoJCSAgICB9CgoJCSAgICAvLyB3ZSBhcmUgaW4gdGVybWluYXRpb24gY2FzZSAoMykgb3IgKDIpIGFuZCByZXR1cm4gdGhlIGFwcHJvcHJpYXRlIHRoaW5nLgoJCSAgICBpZiAoYUJpYXMgPT0gZXhwb3J0cy5MRUFTVF9VUFBFUl9CT1VORCkgewoJCSAgICAgIHJldHVybiBtaWQ7CgkJICAgIH0gZWxzZSB7CgkJICAgICAgcmV0dXJuIGFMb3cgPCAwID8gLTEgOiBhTG93OwoJCSAgICB9CgkJICB9CgkJfQoKCQkvKioKCQkgKiBUaGlzIGlzIGFuIGltcGxlbWVudGF0aW9uIG9mIGJpbmFyeSBzZWFyY2ggd2hpY2ggd2lsbCBhbHdheXMgdHJ5IGFuZCByZXR1cm4KCQkgKiB0aGUgaW5kZXggb2YgdGhlIGNsb3Nlc3QgZWxlbWVudCBpZiB0aGVyZSBpcyBubyBleGFjdCBoaXQuIFRoaXMgaXMgYmVjYXVzZQoJCSAqIG1hcHBpbmdzIGJldHdlZW4gb3JpZ2luYWwgYW5kIGdlbmVyYXRlZCBsaW5lL2NvbCBwYWlycyBhcmUgc2luZ2xlIHBvaW50cywKCQkgKiBhbmQgdGhlcmUgaXMgYW4gaW1wbGljaXQgcmVnaW9uIGJldHdlZW4gZWFjaCBvZiB0aGVtLCBzbyBhIG1pc3MganVzdCBtZWFucwoJCSAqIHRoYXQgeW91IGFyZW4ndCBvbiB0aGUgdmVyeSBzdGFydCBvZiBhIHJlZ2lvbi4KCQkgKgoJCSAqIEBwYXJhbSBhTmVlZGxlIFRoZSBlbGVtZW50IHlvdSBhcmUgbG9va2luZyBmb3IuCgkJICogQHBhcmFtIGFIYXlzdGFjayBUaGUgYXJyYXkgdGhhdCBpcyBiZWluZyBzZWFyY2hlZC4KCQkgKiBAcGFyYW0gYUNvbXBhcmUgQSBmdW5jdGlvbiB3aGljaCB0YWtlcyB0aGUgbmVlZGxlIGFuZCBhbiBlbGVtZW50IGluIHRoZQoJCSAqICAgICBhcnJheSBhbmQgcmV0dXJucyAtMSwgMCwgb3IgMSBkZXBlbmRpbmcgb24gd2hldGhlciB0aGUgbmVlZGxlIGlzIGxlc3MKCQkgKiAgICAgdGhhbiwgZXF1YWwgdG8sIG9yIGdyZWF0ZXIgdGhhbiB0aGUgZWxlbWVudCwgcmVzcGVjdGl2ZWx5LgoJCSAqIEBwYXJhbSBhQmlhcyBFaXRoZXIgJ2JpbmFyeVNlYXJjaC5HUkVBVEVTVF9MT1dFUl9CT1VORCcgb3IKCQkgKiAgICAgJ2JpbmFyeVNlYXJjaC5MRUFTVF9VUFBFUl9CT1VORCcuIFNwZWNpZmllcyB3aGV0aGVyIHRvIHJldHVybiB0aGUKCQkgKiAgICAgY2xvc2VzdCBlbGVtZW50IHRoYXQgaXMgc21hbGxlciB0aGFuIG9yIGdyZWF0ZXIgdGhhbiB0aGUgb25lIHdlIGFyZQoJCSAqICAgICBzZWFyY2hpbmcgZm9yLCByZXNwZWN0aXZlbHksIGlmIHRoZSBleGFjdCBlbGVtZW50IGNhbm5vdCBiZSBmb3VuZC4KCQkgKiAgICAgRGVmYXVsdHMgdG8gJ2JpbmFyeVNlYXJjaC5HUkVBVEVTVF9MT1dFUl9CT1VORCcuCgkJICovCgkJZXhwb3J0cy5zZWFyY2ggPSBmdW5jdGlvbiBzZWFyY2goYU5lZWRsZSwgYUhheXN0YWNrLCBhQ29tcGFyZSwgYUJpYXMpIHsKCQkgIGlmIChhSGF5c3RhY2subGVuZ3RoID09PSAwKSB7CgkJICAgIHJldHVybiAtMTsKCQkgIH0KCgkJICB2YXIgaW5kZXggPSByZWN1cnNpdmVTZWFyY2goLTEsIGFIYXlzdGFjay5sZW5ndGgsIGFOZWVkbGUsIGFIYXlzdGFjaywKCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhQ29tcGFyZSwgYUJpYXMgfHwgZXhwb3J0cy5HUkVBVEVTVF9MT1dFUl9CT1VORCk7CgkJICBpZiAoaW5kZXggPCAwKSB7CgkJICAgIHJldHVybiAtMTsKCQkgIH0KCgkJICAvLyBXZSBoYXZlIGZvdW5kIGVpdGhlciB0aGUgZXhhY3QgZWxlbWVudCwgb3IgdGhlIG5leHQtY2xvc2VzdCBlbGVtZW50IHRoYW4KCQkgIC8vIHRoZSBvbmUgd2UgYXJlIHNlYXJjaGluZyBmb3IuIEhvd2V2ZXIsIHRoZXJlIG1heSBiZSBtb3JlIHRoYW4gb25lIHN1Y2gKCQkgIC8vIGVsZW1lbnQuIE1ha2Ugc3VyZSB3ZSBhbHdheXMgcmV0dXJuIHRoZSBzbWFsbGVzdCBvZiB0aGVzZS4KCQkgIHdoaWxlIChpbmRleCAtIDEgPj0gMCkgewoJCSAgICBpZiAoYUNvbXBhcmUoYUhheXN0YWNrW2luZGV4XSwgYUhheXN0YWNrW2luZGV4IC0gMV0sIHRydWUpICE9PSAwKSB7CgkJICAgICAgYnJlYWs7CgkJICAgIH0KCQkgICAgLS1pbmRleDsKCQkgIH0KCgkJICByZXR1cm4gaW5kZXg7CgkJfTsgCgl9IChiaW5hcnlTZWFyY2gpKTsKCXJldHVybiBiaW5hcnlTZWFyY2g7Cn0KCnZhciBxdWlja1NvcnQgPSB7fTsKCi8qIC0qLSBNb2RlOiBqczsganMtaW5kZW50LWxldmVsOiAyOyAtKi0gKi8KCnZhciBoYXNSZXF1aXJlZFF1aWNrU29ydDsKCmZ1bmN0aW9uIHJlcXVpcmVRdWlja1NvcnQgKCkgewoJaWYgKGhhc1JlcXVpcmVkUXVpY2tTb3J0KSByZXR1cm4gcXVpY2tTb3J0OwoJaGFzUmVxdWlyZWRRdWlja1NvcnQgPSAxOwoJLyoKCSAqIENvcHlyaWdodCAyMDExIE1vemlsbGEgRm91bmRhdGlvbiBhbmQgY29udHJpYnV0b3JzCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgTmV3IEJTRCBsaWNlbnNlLiBTZWUgTElDRU5TRSBvcjoKCSAqIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9CU0QtMy1DbGF1c2UKCSAqLwoKCS8vIEl0IHR1cm5zIG91dCB0aGF0IHNvbWUgKG1vc3Q/KSBKYXZhU2NyaXB0IGVuZ2luZXMgZG9uJ3Qgc2VsZi1ob3N0CgkvLyBgQXJyYXkucHJvdG90eXBlLnNvcnRgLiBUaGlzIG1ha2VzIHNlbnNlIGJlY2F1c2UgQysrIHdpbGwgbGlrZWx5IHJlbWFpbgoJLy8gZmFzdGVyIHRoYW4gSlMgd2hlbiBkb2luZyByYXcgQ1BVLWludGVuc2l2ZSBzb3J0aW5nLiBIb3dldmVyLCB3aGVuIHVzaW5nIGEKCS8vIGN1c3RvbSBjb21wYXJhdG9yIGZ1bmN0aW9uLCBjYWxsaW5nIGJhY2sgYW5kIGZvcnRoIGJldHdlZW4gdGhlIFZNJ3MgQysrIGFuZAoJLy8gSklUJ2QgSlMgaXMgcmF0aGVyIHNsb3cgKmFuZCogbG9zZXMgSklUIHR5cGUgaW5mb3JtYXRpb24sIHJlc3VsdGluZyBpbgoJLy8gd29yc2UgZ2VuZXJhdGVkIGNvZGUgZm9yIHRoZSBjb21wYXJhdG9yIGZ1bmN0aW9uIHRoYW4gd291bGQgYmUgb3B0aW1hbC4gSW4KCS8vIGZhY3QsIHdoZW4gc29ydGluZyB3aXRoIGEgY29tcGFyYXRvciwgdGhlc2UgY29zdHMgb3V0d2VpZ2ggdGhlIGJlbmVmaXRzIG9mCgkvLyBzb3J0aW5nIGluIEMrKy4gQnkgdXNpbmcgb3VyIG93biBKUy1pbXBsZW1lbnRlZCBRdWljayBTb3J0IChiZWxvdyksIHdlIGdldAoJLy8gYSB+MzUwMG1zIG1lYW4gc3BlZWQtdXAgaW4gYGJlbmNoL2JlbmNoLmh0bWxgLgoKCS8qKgoJICogU3dhcCB0aGUgZWxlbWVudHMgaW5kZXhlZCBieSBgeGAgYW5kIGB5YCBpbiB0aGUgYXJyYXkgYGFyeWAuCgkgKgoJICogQHBhcmFtIHtBcnJheX0gYXJ5CgkgKiAgICAgICAgVGhlIGFycmF5LgoJICogQHBhcmFtIHtOdW1iZXJ9IHgKCSAqICAgICAgICBUaGUgaW5kZXggb2YgdGhlIGZpcnN0IGl0ZW0uCgkgKiBAcGFyYW0ge051bWJlcn0geQoJICogICAgICAgIFRoZSBpbmRleCBvZiB0aGUgc2Vjb25kIGl0ZW0uCgkgKi8KCWZ1bmN0aW9uIHN3YXAoYXJ5LCB4LCB5KSB7CgkgIHZhciB0ZW1wID0gYXJ5W3hdOwoJICBhcnlbeF0gPSBhcnlbeV07CgkgIGFyeVt5XSA9IHRlbXA7Cgl9CgoJLyoqCgkgKiBSZXR1cm5zIGEgcmFuZG9tIGludGVnZXIgd2l0aGluIHRoZSByYW5nZSBgbG93IC4uIGhpZ2hgIGluY2x1c2l2ZS4KCSAqCgkgKiBAcGFyYW0ge051bWJlcn0gbG93CgkgKiAgICAgICAgVGhlIGxvd2VyIGJvdW5kIG9uIHRoZSByYW5nZS4KCSAqIEBwYXJhbSB7TnVtYmVyfSBoaWdoCgkgKiAgICAgICAgVGhlIHVwcGVyIGJvdW5kIG9uIHRoZSByYW5nZS4KCSAqLwoJZnVuY3Rpb24gcmFuZG9tSW50SW5SYW5nZShsb3csIGhpZ2gpIHsKCSAgcmV0dXJuIE1hdGgucm91bmQobG93ICsgKE1hdGgucmFuZG9tKCkgKiAoaGlnaCAtIGxvdykpKTsKCX0KCgkvKioKCSAqIFRoZSBRdWljayBTb3J0IGFsZ29yaXRobS4KCSAqCgkgKiBAcGFyYW0ge0FycmF5fSBhcnkKCSAqICAgICAgICBBbiBhcnJheSB0byBzb3J0LgoJICogQHBhcmFtIHtmdW5jdGlvbn0gY29tcGFyYXRvcgoJICogICAgICAgIEZ1bmN0aW9uIHRvIHVzZSB0byBjb21wYXJlIHR3byBpdGVtcy4KCSAqIEBwYXJhbSB7TnVtYmVyfSBwCgkgKiAgICAgICAgU3RhcnQgaW5kZXggb2YgdGhlIGFycmF5CgkgKiBAcGFyYW0ge051bWJlcn0gcgoJICogICAgICAgIEVuZCBpbmRleCBvZiB0aGUgYXJyYXkKCSAqLwoJZnVuY3Rpb24gZG9RdWlja1NvcnQoYXJ5LCBjb21wYXJhdG9yLCBwLCByKSB7CgkgIC8vIElmIG91ciBsb3dlciBib3VuZCBpcyBsZXNzIHRoYW4gb3VyIHVwcGVyIGJvdW5kLCB3ZSAoMSkgcGFydGl0aW9uIHRoZQoJICAvLyBhcnJheSBpbnRvIHR3byBwaWVjZXMgYW5kICgyKSByZWN1cnNlIG9uIGVhY2ggaGFsZi4gSWYgaXQgaXMgbm90LCB0aGlzIGlzCgkgIC8vIHRoZSBlbXB0eSBhcnJheSBhbmQgb3VyIGJhc2UgY2FzZS4KCgkgIGlmIChwIDwgcikgewoJICAgIC8vICgxKSBQYXJ0aXRpb25pbmcuCgkgICAgLy8KCSAgICAvLyBUaGUgcGFydGl0aW9uaW5nIGNob29zZXMgYSBwaXZvdCBiZXR3ZWVuIGBwYCBhbmQgYHJgIGFuZCBtb3ZlcyBhbGwKCSAgICAvLyBlbGVtZW50cyB0aGF0IGFyZSBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gdGhlIHBpdm90IHRvIHRoZSBiZWZvcmUgaXQsIGFuZAoJICAgIC8vIGFsbCB0aGUgZWxlbWVudHMgdGhhdCBhcmUgZ3JlYXRlciB0aGFuIGl0IGFmdGVyIGl0LiBUaGUgZWZmZWN0IGlzIHRoYXQKCSAgICAvLyBvbmNlIHBhcnRpdGlvbiBpcyBkb25lLCB0aGUgcGl2b3QgaXMgaW4gdGhlIGV4YWN0IHBsYWNlIGl0IHdpbGwgYmUgd2hlbgoJICAgIC8vIHRoZSBhcnJheSBpcyBwdXQgaW4gc29ydGVkIG9yZGVyLCBhbmQgaXQgd2lsbCBub3QgbmVlZCB0byBiZSBtb3ZlZAoJICAgIC8vIGFnYWluLiBUaGlzIHJ1bnMgaW4gTyhuKSB0aW1lLgoKCSAgICAvLyBBbHdheXMgY2hvb3NlIGEgcmFuZG9tIHBpdm90IHNvIHRoYXQgYW4gaW5wdXQgYXJyYXkgd2hpY2ggaXMgcmV2ZXJzZQoJICAgIC8vIHNvcnRlZCBkb2VzIG5vdCBjYXVzZSBPKG5eMikgcnVubmluZyB0aW1lLgoJICAgIHZhciBwaXZvdEluZGV4ID0gcmFuZG9tSW50SW5SYW5nZShwLCByKTsKCSAgICB2YXIgaSA9IHAgLSAxOwoKCSAgICBzd2FwKGFyeSwgcGl2b3RJbmRleCwgcik7CgkgICAgdmFyIHBpdm90ID0gYXJ5W3JdOwoKCSAgICAvLyBJbW1lZGlhdGVseSBhZnRlciBgamAgaXMgaW5jcmVtZW50ZWQgaW4gdGhpcyBsb29wLCB0aGUgZm9sbG93aW5nIGhvbGQKCSAgICAvLyB0cnVlOgoJICAgIC8vCgkgICAgLy8gICAqIEV2ZXJ5IGVsZW1lbnQgaW4gYGFyeVtwIC4uIGldYCBpcyBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gdGhlIHBpdm90LgoJICAgIC8vCgkgICAgLy8gICAqIEV2ZXJ5IGVsZW1lbnQgaW4gYGFyeVtpKzEgLi4gai0xXWAgaXMgZ3JlYXRlciB0aGFuIHRoZSBwaXZvdC4KCSAgICBmb3IgKHZhciBqID0gcDsgaiA8IHI7IGorKykgewoJICAgICAgaWYgKGNvbXBhcmF0b3IoYXJ5W2pdLCBwaXZvdCkgPD0gMCkgewoJICAgICAgICBpICs9IDE7CgkgICAgICAgIHN3YXAoYXJ5LCBpLCBqKTsKCSAgICAgIH0KCSAgICB9CgoJICAgIHN3YXAoYXJ5LCBpICsgMSwgaik7CgkgICAgdmFyIHEgPSBpICsgMTsKCgkgICAgLy8gKDIpIFJlY3Vyc2Ugb24gZWFjaCBoYWxmLgoKCSAgICBkb1F1aWNrU29ydChhcnksIGNvbXBhcmF0b3IsIHAsIHEgLSAxKTsKCSAgICBkb1F1aWNrU29ydChhcnksIGNvbXBhcmF0b3IsIHEgKyAxLCByKTsKCSAgfQoJfQoKCS8qKgoJICogU29ydCB0aGUgZ2l2ZW4gYXJyYXkgaW4tcGxhY2Ugd2l0aCB0aGUgZ2l2ZW4gY29tcGFyYXRvciBmdW5jdGlvbi4KCSAqCgkgKiBAcGFyYW0ge0FycmF5fSBhcnkKCSAqICAgICAgICBBbiBhcnJheSB0byBzb3J0LgoJICogQHBhcmFtIHtmdW5jdGlvbn0gY29tcGFyYXRvcgoJICogICAgICAgIEZ1bmN0aW9uIHRvIHVzZSB0byBjb21wYXJlIHR3byBpdGVtcy4KCSAqLwoJcXVpY2tTb3J0LnF1aWNrU29ydCA9IGZ1bmN0aW9uIChhcnksIGNvbXBhcmF0b3IpIHsKCSAgZG9RdWlja1NvcnQoYXJ5LCBjb21wYXJhdG9yLCAwLCBhcnkubGVuZ3RoIC0gMSk7Cgl9OwoJcmV0dXJuIHF1aWNrU29ydDsKfQoKLyogLSotIE1vZGU6IGpzOyBqcy1pbmRlbnQtbGV2ZWw6IDI7IC0qLSAqLwoKdmFyIGhhc1JlcXVpcmVkU291cmNlTWFwQ29uc3VtZXI7CgpmdW5jdGlvbiByZXF1aXJlU291cmNlTWFwQ29uc3VtZXIgKCkgewoJaWYgKGhhc1JlcXVpcmVkU291cmNlTWFwQ29uc3VtZXIpIHJldHVybiBzb3VyY2VNYXBDb25zdW1lcjsKCWhhc1JlcXVpcmVkU291cmNlTWFwQ29uc3VtZXIgPSAxOwoJLyoKCSAqIENvcHlyaWdodCAyMDExIE1vemlsbGEgRm91bmRhdGlvbiBhbmQgY29udHJpYnV0b3JzCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgTmV3IEJTRCBsaWNlbnNlLiBTZWUgTElDRU5TRSBvcjoKCSAqIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9CU0QtMy1DbGF1c2UKCSAqLwoKCXZhciB1dGlsID0gcmVxdWlyZVV0aWwoKTsKCXZhciBiaW5hcnlTZWFyY2ggPSByZXF1aXJlQmluYXJ5U2VhcmNoKCk7Cgl2YXIgQXJyYXlTZXQgPSByZXF1aXJlQXJyYXlTZXQoKS5BcnJheVNldDsKCXZhciBiYXNlNjRWTFEgPSByZXF1aXJlQmFzZTY0VmxxKCk7Cgl2YXIgcXVpY2tTb3J0ID0gcmVxdWlyZVF1aWNrU29ydCgpLnF1aWNrU29ydDsKCglmdW5jdGlvbiBTb3VyY2VNYXBDb25zdW1lcihhU291cmNlTWFwLCBhU291cmNlTWFwVVJMKSB7CgkgIHZhciBzb3VyY2VNYXAgPSBhU291cmNlTWFwOwoJICBpZiAodHlwZW9mIGFTb3VyY2VNYXAgPT09ICdzdHJpbmcnKSB7CgkgICAgc291cmNlTWFwID0gdXRpbC5wYXJzZVNvdXJjZU1hcElucHV0KGFTb3VyY2VNYXApOwoJICB9CgoJICByZXR1cm4gc291cmNlTWFwLnNlY3Rpb25zICE9IG51bGwKCSAgICA/IG5ldyBJbmRleGVkU291cmNlTWFwQ29uc3VtZXIoc291cmNlTWFwLCBhU291cmNlTWFwVVJMKQoJICAgIDogbmV3IEJhc2ljU291cmNlTWFwQ29uc3VtZXIoc291cmNlTWFwLCBhU291cmNlTWFwVVJMKTsKCX0KCglTb3VyY2VNYXBDb25zdW1lci5mcm9tU291cmNlTWFwID0gZnVuY3Rpb24oYVNvdXJjZU1hcCwgYVNvdXJjZU1hcFVSTCkgewoJICByZXR1cm4gQmFzaWNTb3VyY2VNYXBDb25zdW1lci5mcm9tU291cmNlTWFwKGFTb3VyY2VNYXAsIGFTb3VyY2VNYXBVUkwpOwoJfTsKCgkvKioKCSAqIFRoZSB2ZXJzaW9uIG9mIHRoZSBzb3VyY2UgbWFwcGluZyBzcGVjIHRoYXQgd2UgYXJlIGNvbnN1bWluZy4KCSAqLwoJU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLl92ZXJzaW9uID0gMzsKCgkvLyBgX19nZW5lcmF0ZWRNYXBwaW5nc2AgYW5kIGBfX29yaWdpbmFsTWFwcGluZ3NgIGFyZSBhcnJheXMgdGhhdCBob2xkIHRoZQoJLy8gcGFyc2VkIG1hcHBpbmcgY29vcmRpbmF0ZXMgZnJvbSB0aGUgc291cmNlIG1hcCdzICJtYXBwaW5ncyIgYXR0cmlidXRlLiBUaGV5CgkvLyBhcmUgbGF6aWx5IGluc3RhbnRpYXRlZCwgYWNjZXNzZWQgdmlhIHRoZSBgX2dlbmVyYXRlZE1hcHBpbmdzYCBhbmQKCS8vIGBfb3JpZ2luYWxNYXBwaW5nc2AgZ2V0dGVycyByZXNwZWN0aXZlbHksIGFuZCB3ZSBvbmx5IHBhcnNlIHRoZSBtYXBwaW5ncwoJLy8gYW5kIGNyZWF0ZSB0aGVzZSBhcnJheXMgb25jZSBxdWVyaWVkIGZvciBhIHNvdXJjZSBsb2NhdGlvbi4gV2UganVtcCB0aHJvdWdoCgkvLyB0aGVzZSBob29wcyBiZWNhdXNlIHRoZXJlIGNhbiBiZSBtYW55IHRob3VzYW5kcyBvZiBtYXBwaW5ncywgYW5kIHBhcnNpbmcKCS8vIHRoZW0gaXMgZXhwZW5zaXZlLCBzbyB3ZSBvbmx5IHdhbnQgdG8gZG8gaXQgaWYgd2UgbXVzdC4KCS8vCgkvLyBFYWNoIG9iamVjdCBpbiB0aGUgYXJyYXlzIGlzIG9mIHRoZSBmb3JtOgoJLy8KCS8vICAgICB7CgkvLyAgICAgICBnZW5lcmF0ZWRMaW5lOiBUaGUgbGluZSBudW1iZXIgaW4gdGhlIGdlbmVyYXRlZCBjb2RlLAoJLy8gICAgICAgZ2VuZXJhdGVkQ29sdW1uOiBUaGUgY29sdW1uIG51bWJlciBpbiB0aGUgZ2VuZXJhdGVkIGNvZGUsCgkvLyAgICAgICBzb3VyY2U6IFRoZSBwYXRoIHRvIHRoZSBvcmlnaW5hbCBzb3VyY2UgZmlsZSB0aGF0IGdlbmVyYXRlZCB0aGlzCgkvLyAgICAgICAgICAgICAgIGNodW5rIG9mIGNvZGUsCgkvLyAgICAgICBvcmlnaW5hbExpbmU6IFRoZSBsaW5lIG51bWJlciBpbiB0aGUgb3JpZ2luYWwgc291cmNlIHRoYXQKCS8vICAgICAgICAgICAgICAgICAgICAgY29ycmVzcG9uZHMgdG8gdGhpcyBjaHVuayBvZiBnZW5lcmF0ZWQgY29kZSwKCS8vICAgICAgIG9yaWdpbmFsQ29sdW1uOiBUaGUgY29sdW1uIG51bWJlciBpbiB0aGUgb3JpZ2luYWwgc291cmNlIHRoYXQKCS8vICAgICAgICAgICAgICAgICAgICAgICBjb3JyZXNwb25kcyB0byB0aGlzIGNodW5rIG9mIGdlbmVyYXRlZCBjb2RlLAoJLy8gICAgICAgbmFtZTogVGhlIG5hbWUgb2YgdGhlIG9yaWdpbmFsIHN5bWJvbCB3aGljaCBnZW5lcmF0ZWQgdGhpcyBjaHVuayBvZgoJLy8gICAgICAgICAgICAgY29kZS4KCS8vICAgICB9CgkvLwoJLy8gQWxsIHByb3BlcnRpZXMgZXhjZXB0IGZvciBgZ2VuZXJhdGVkTGluZWAgYW5kIGBnZW5lcmF0ZWRDb2x1bW5gIGNhbiBiZQoJLy8gYG51bGxgLgoJLy8KCS8vIGBfZ2VuZXJhdGVkTWFwcGluZ3NgIGlzIG9yZGVyZWQgYnkgdGhlIGdlbmVyYXRlZCBwb3NpdGlvbnMuCgkvLwoJLy8gYF9vcmlnaW5hbE1hcHBpbmdzYCBpcyBvcmRlcmVkIGJ5IHRoZSBvcmlnaW5hbCBwb3NpdGlvbnMuCgoJU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLl9fZ2VuZXJhdGVkTWFwcGluZ3MgPSBudWxsOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFNvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZSwgJ19nZW5lcmF0ZWRNYXBwaW5ncycsIHsKCSAgY29uZmlndXJhYmxlOiB0cnVlLAoJICBlbnVtZXJhYmxlOiB0cnVlLAoJICBnZXQ6IGZ1bmN0aW9uICgpIHsKCSAgICBpZiAoIXRoaXMuX19nZW5lcmF0ZWRNYXBwaW5ncykgewoJICAgICAgdGhpcy5fcGFyc2VNYXBwaW5ncyh0aGlzLl9tYXBwaW5ncywgdGhpcy5zb3VyY2VSb290KTsKCSAgICB9CgoJICAgIHJldHVybiB0aGlzLl9fZ2VuZXJhdGVkTWFwcGluZ3M7CgkgIH0KCX0pOwoKCVNvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZS5fX29yaWdpbmFsTWFwcGluZ3MgPSBudWxsOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFNvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZSwgJ19vcmlnaW5hbE1hcHBpbmdzJywgewoJICBjb25maWd1cmFibGU6IHRydWUsCgkgIGVudW1lcmFibGU6IHRydWUsCgkgIGdldDogZnVuY3Rpb24gKCkgewoJICAgIGlmICghdGhpcy5fX29yaWdpbmFsTWFwcGluZ3MpIHsKCSAgICAgIHRoaXMuX3BhcnNlTWFwcGluZ3ModGhpcy5fbWFwcGluZ3MsIHRoaXMuc291cmNlUm9vdCk7CgkgICAgfQoKCSAgICByZXR1cm4gdGhpcy5fX29yaWdpbmFsTWFwcGluZ3M7CgkgIH0KCX0pOwoKCVNvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZS5fY2hhcklzTWFwcGluZ1NlcGFyYXRvciA9CgkgIGZ1bmN0aW9uIFNvdXJjZU1hcENvbnN1bWVyX2NoYXJJc01hcHBpbmdTZXBhcmF0b3IoYVN0ciwgaW5kZXgpIHsKCSAgICB2YXIgYyA9IGFTdHIuY2hhckF0KGluZGV4KTsKCSAgICByZXR1cm4gYyA9PT0gIjsiIHx8IGMgPT09ICIsIjsKCSAgfTsKCgkvKioKCSAqIFBhcnNlIHRoZSBtYXBwaW5ncyBpbiBhIHN0cmluZyBpbiB0byBhIGRhdGEgc3RydWN0dXJlIHdoaWNoIHdlIGNhbiBlYXNpbHkKCSAqIHF1ZXJ5ICh0aGUgb3JkZXJlZCBhcnJheXMgaW4gdGhlIGB0aGlzLl9fZ2VuZXJhdGVkTWFwcGluZ3NgIGFuZAoJICogYHRoaXMuX19vcmlnaW5hbE1hcHBpbmdzYCBwcm9wZXJ0aWVzKS4KCSAqLwoJU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLl9wYXJzZU1hcHBpbmdzID0KCSAgZnVuY3Rpb24gU291cmNlTWFwQ29uc3VtZXJfcGFyc2VNYXBwaW5ncyhhU3RyLCBhU291cmNlUm9vdCkgewoJICAgIHRocm93IG5ldyBFcnJvcigiU3ViY2xhc3NlcyBtdXN0IGltcGxlbWVudCBfcGFyc2VNYXBwaW5ncyIpOwoJICB9OwoKCVNvdXJjZU1hcENvbnN1bWVyLkdFTkVSQVRFRF9PUkRFUiA9IDE7CglTb3VyY2VNYXBDb25zdW1lci5PUklHSU5BTF9PUkRFUiA9IDI7CgoJU291cmNlTWFwQ29uc3VtZXIuR1JFQVRFU1RfTE9XRVJfQk9VTkQgPSAxOwoJU291cmNlTWFwQ29uc3VtZXIuTEVBU1RfVVBQRVJfQk9VTkQgPSAyOwoKCS8qKgoJICogSXRlcmF0ZSBvdmVyIGVhY2ggbWFwcGluZyBiZXR3ZWVuIGFuIG9yaWdpbmFsIHNvdXJjZS9saW5lL2NvbHVtbiBhbmQgYQoJICogZ2VuZXJhdGVkIGxpbmUvY29sdW1uIGluIHRoaXMgc291cmNlIG1hcC4KCSAqCgkgKiBAcGFyYW0gRnVuY3Rpb24gYUNhbGxiYWNrCgkgKiAgICAgICAgVGhlIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdpdGggZWFjaCBtYXBwaW5nLgoJICogQHBhcmFtIE9iamVjdCBhQ29udGV4dAoJICogICAgICAgIE9wdGlvbmFsLiBJZiBzcGVjaWZpZWQsIHRoaXMgb2JqZWN0IHdpbGwgYmUgdGhlIHZhbHVlIG9mIGB0aGlzYCBldmVyeQoJICogICAgICAgIHRpbWUgdGhhdCBgYUNhbGxiYWNrYCBpcyBjYWxsZWQuCgkgKiBAcGFyYW0gYU9yZGVyCgkgKiAgICAgICAgRWl0aGVyIGBTb3VyY2VNYXBDb25zdW1lci5HRU5FUkFURURfT1JERVJgIG9yCgkgKiAgICAgICAgYFNvdXJjZU1hcENvbnN1bWVyLk9SSUdJTkFMX09SREVSYC4gU3BlY2lmaWVzIHdoZXRoZXIgeW91IHdhbnQgdG8KCSAqICAgICAgICBpdGVyYXRlIG92ZXIgdGhlIG1hcHBpbmdzIHNvcnRlZCBieSB0aGUgZ2VuZXJhdGVkIGZpbGUncyBsaW5lL2NvbHVtbgoJICogICAgICAgIG9yZGVyIG9yIHRoZSBvcmlnaW5hbCdzIHNvdXJjZS9saW5lL2NvbHVtbiBvcmRlciwgcmVzcGVjdGl2ZWx5LiBEZWZhdWx0cyB0bwoJICogICAgICAgIGBTb3VyY2VNYXBDb25zdW1lci5HRU5FUkFURURfT1JERVJgLgoJICovCglTb3VyY2VNYXBDb25zdW1lci5wcm90b3R5cGUuZWFjaE1hcHBpbmcgPQoJICBmdW5jdGlvbiBTb3VyY2VNYXBDb25zdW1lcl9lYWNoTWFwcGluZyhhQ2FsbGJhY2ssIGFDb250ZXh0LCBhT3JkZXIpIHsKCSAgICB2YXIgY29udGV4dCA9IGFDb250ZXh0IHx8IG51bGw7CgkgICAgdmFyIG9yZGVyID0gYU9yZGVyIHx8IFNvdXJjZU1hcENvbnN1bWVyLkdFTkVSQVRFRF9PUkRFUjsKCgkgICAgdmFyIG1hcHBpbmdzOwoJICAgIHN3aXRjaCAob3JkZXIpIHsKCSAgICBjYXNlIFNvdXJjZU1hcENvbnN1bWVyLkdFTkVSQVRFRF9PUkRFUjoKCSAgICAgIG1hcHBpbmdzID0gdGhpcy5fZ2VuZXJhdGVkTWFwcGluZ3M7CgkgICAgICBicmVhazsKCSAgICBjYXNlIFNvdXJjZU1hcENvbnN1bWVyLk9SSUdJTkFMX09SREVSOgoJICAgICAgbWFwcGluZ3MgPSB0aGlzLl9vcmlnaW5hbE1hcHBpbmdzOwoJICAgICAgYnJlYWs7CgkgICAgZGVmYXVsdDoKCSAgICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBvcmRlciBvZiBpdGVyYXRpb24uIik7CgkgICAgfQoKCSAgICB2YXIgc291cmNlUm9vdCA9IHRoaXMuc291cmNlUm9vdDsKCSAgICBtYXBwaW5ncy5tYXAoZnVuY3Rpb24gKG1hcHBpbmcpIHsKCSAgICAgIHZhciBzb3VyY2UgPSBtYXBwaW5nLnNvdXJjZSA9PT0gbnVsbCA/IG51bGwgOiB0aGlzLl9zb3VyY2VzLmF0KG1hcHBpbmcuc291cmNlKTsKCSAgICAgIHNvdXJjZSA9IHV0aWwuY29tcHV0ZVNvdXJjZVVSTChzb3VyY2VSb290LCBzb3VyY2UsIHRoaXMuX3NvdXJjZU1hcFVSTCk7CgkgICAgICByZXR1cm4gewoJICAgICAgICBzb3VyY2U6IHNvdXJjZSwKCSAgICAgICAgZ2VuZXJhdGVkTGluZTogbWFwcGluZy5nZW5lcmF0ZWRMaW5lLAoJICAgICAgICBnZW5lcmF0ZWRDb2x1bW46IG1hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uLAoJICAgICAgICBvcmlnaW5hbExpbmU6IG1hcHBpbmcub3JpZ2luYWxMaW5lLAoJICAgICAgICBvcmlnaW5hbENvbHVtbjogbWFwcGluZy5vcmlnaW5hbENvbHVtbiwKCSAgICAgICAgbmFtZTogbWFwcGluZy5uYW1lID09PSBudWxsID8gbnVsbCA6IHRoaXMuX25hbWVzLmF0KG1hcHBpbmcubmFtZSkKCSAgICAgIH07CgkgICAgfSwgdGhpcykuZm9yRWFjaChhQ2FsbGJhY2ssIGNvbnRleHQpOwoJICB9OwoKCS8qKgoJICogUmV0dXJucyBhbGwgZ2VuZXJhdGVkIGxpbmUgYW5kIGNvbHVtbiBpbmZvcm1hdGlvbiBmb3IgdGhlIG9yaWdpbmFsIHNvdXJjZSwKCSAqIGxpbmUsIGFuZCBjb2x1bW4gcHJvdmlkZWQuIElmIG5vIGNvbHVtbiBpcyBwcm92aWRlZCwgcmV0dXJucyBhbGwgbWFwcGluZ3MKCSAqIGNvcnJlc3BvbmRpbmcgdG8gYSBlaXRoZXIgdGhlIGxpbmUgd2UgYXJlIHNlYXJjaGluZyBmb3Igb3IgdGhlIG5leHQKCSAqIGNsb3Nlc3QgbGluZSB0aGF0IGhhcyBhbnkgbWFwcGluZ3MuIE90aGVyd2lzZSwgcmV0dXJucyBhbGwgbWFwcGluZ3MKCSAqIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGdpdmVuIGxpbmUgYW5kIGVpdGhlciB0aGUgY29sdW1uIHdlIGFyZSBzZWFyY2hpbmcgZm9yCgkgKiBvciB0aGUgbmV4dCBjbG9zZXN0IGNvbHVtbiB0aGF0IGhhcyBhbnkgb2Zmc2V0cy4KCSAqCgkgKiBUaGUgb25seSBhcmd1bWVudCBpcyBhbiBvYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6CgkgKgoJICogICAtIHNvdXJjZTogVGhlIGZpbGVuYW1lIG9mIHRoZSBvcmlnaW5hbCBzb3VyY2UuCgkgKiAgIC0gbGluZTogVGhlIGxpbmUgbnVtYmVyIGluIHRoZSBvcmlnaW5hbCBzb3VyY2UuICBUaGUgbGluZSBudW1iZXIgaXMgMS1iYXNlZC4KCSAqICAgLSBjb2x1bW46IE9wdGlvbmFsLiB0aGUgY29sdW1uIG51bWJlciBpbiB0aGUgb3JpZ2luYWwgc291cmNlLgoJICogICAgVGhlIGNvbHVtbiBudW1iZXIgaXMgMC1iYXNlZC4KCSAqCgkgKiBhbmQgYW4gYXJyYXkgb2Ygb2JqZWN0cyBpcyByZXR1cm5lZCwgZWFjaCB3aXRoIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczoKCSAqCgkgKiAgIC0gbGluZTogVGhlIGxpbmUgbnVtYmVyIGluIHRoZSBnZW5lcmF0ZWQgc291cmNlLCBvciBudWxsLiAgVGhlCgkgKiAgICBsaW5lIG51bWJlciBpcyAxLWJhc2VkLgoJICogICAtIGNvbHVtbjogVGhlIGNvbHVtbiBudW1iZXIgaW4gdGhlIGdlbmVyYXRlZCBzb3VyY2UsIG9yIG51bGwuCgkgKiAgICBUaGUgY29sdW1uIG51bWJlciBpcyAwLWJhc2VkLgoJICovCglTb3VyY2VNYXBDb25zdW1lci5wcm90b3R5cGUuYWxsR2VuZXJhdGVkUG9zaXRpb25zRm9yID0KCSAgZnVuY3Rpb24gU291cmNlTWFwQ29uc3VtZXJfYWxsR2VuZXJhdGVkUG9zaXRpb25zRm9yKGFBcmdzKSB7CgkgICAgdmFyIGxpbmUgPSB1dGlsLmdldEFyZyhhQXJncywgJ2xpbmUnKTsKCgkgICAgLy8gV2hlbiB0aGVyZSBpcyBubyBleGFjdCBtYXRjaCwgQmFzaWNTb3VyY2VNYXBDb25zdW1lci5wcm90b3R5cGUuX2ZpbmRNYXBwaW5nCgkgICAgLy8gcmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIGNsb3Nlc3QgbWFwcGluZyBsZXNzIHRoYW4gdGhlIG5lZWRsZS4gQnkKCSAgICAvLyBzZXR0aW5nIG5lZWRsZS5vcmlnaW5hbENvbHVtbiB0byAwLCB3ZSB0aHVzIGZpbmQgdGhlIGxhc3QgbWFwcGluZyBmb3IKCSAgICAvLyB0aGUgZ2l2ZW4gbGluZSwgcHJvdmlkZWQgc3VjaCBhIG1hcHBpbmcgZXhpc3RzLgoJICAgIHZhciBuZWVkbGUgPSB7CgkgICAgICBzb3VyY2U6IHV0aWwuZ2V0QXJnKGFBcmdzLCAnc291cmNlJyksCgkgICAgICBvcmlnaW5hbExpbmU6IGxpbmUsCgkgICAgICBvcmlnaW5hbENvbHVtbjogdXRpbC5nZXRBcmcoYUFyZ3MsICdjb2x1bW4nLCAwKQoJICAgIH07CgoJICAgIG5lZWRsZS5zb3VyY2UgPSB0aGlzLl9maW5kU291cmNlSW5kZXgobmVlZGxlLnNvdXJjZSk7CgkgICAgaWYgKG5lZWRsZS5zb3VyY2UgPCAwKSB7CgkgICAgICByZXR1cm4gW107CgkgICAgfQoKCSAgICB2YXIgbWFwcGluZ3MgPSBbXTsKCgkgICAgdmFyIGluZGV4ID0gdGhpcy5fZmluZE1hcHBpbmcobmVlZGxlLAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX29yaWdpbmFsTWFwcGluZ3MsCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm9yaWdpbmFsTGluZSIsCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm9yaWdpbmFsQ29sdW1uIiwKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGlsLmNvbXBhcmVCeU9yaWdpbmFsUG9zaXRpb25zLAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpbmFyeVNlYXJjaC5MRUFTVF9VUFBFUl9CT1VORCk7CgkgICAgaWYgKGluZGV4ID49IDApIHsKCSAgICAgIHZhciBtYXBwaW5nID0gdGhpcy5fb3JpZ2luYWxNYXBwaW5nc1tpbmRleF07CgoJICAgICAgaWYgKGFBcmdzLmNvbHVtbiA9PT0gdW5kZWZpbmVkKSB7CgkgICAgICAgIHZhciBvcmlnaW5hbExpbmUgPSBtYXBwaW5nLm9yaWdpbmFsTGluZTsKCgkgICAgICAgIC8vIEl0ZXJhdGUgdW50aWwgZWl0aGVyIHdlIHJ1biBvdXQgb2YgbWFwcGluZ3MsIG9yIHdlIHJ1biBpbnRvCgkgICAgICAgIC8vIGEgbWFwcGluZyBmb3IgYSBkaWZmZXJlbnQgbGluZSB0aGFuIHRoZSBvbmUgd2UgZm91bmQuIFNpbmNlCgkgICAgICAgIC8vIG1hcHBpbmdzIGFyZSBzb3J0ZWQsIHRoaXMgaXMgZ3VhcmFudGVlZCB0byBmaW5kIGFsbCBtYXBwaW5ncyBmb3IKCSAgICAgICAgLy8gdGhlIGxpbmUgd2UgZm91bmQuCgkgICAgICAgIHdoaWxlIChtYXBwaW5nICYmIG1hcHBpbmcub3JpZ2luYWxMaW5lID09PSBvcmlnaW5hbExpbmUpIHsKCSAgICAgICAgICBtYXBwaW5ncy5wdXNoKHsKCSAgICAgICAgICAgIGxpbmU6IHV0aWwuZ2V0QXJnKG1hcHBpbmcsICdnZW5lcmF0ZWRMaW5lJywgbnVsbCksCgkgICAgICAgICAgICBjb2x1bW46IHV0aWwuZ2V0QXJnKG1hcHBpbmcsICdnZW5lcmF0ZWRDb2x1bW4nLCBudWxsKSwKCSAgICAgICAgICAgIGxhc3RDb2x1bW46IHV0aWwuZ2V0QXJnKG1hcHBpbmcsICdsYXN0R2VuZXJhdGVkQ29sdW1uJywgbnVsbCkKCSAgICAgICAgICB9KTsKCgkgICAgICAgICAgbWFwcGluZyA9IHRoaXMuX29yaWdpbmFsTWFwcGluZ3NbKytpbmRleF07CgkgICAgICAgIH0KCSAgICAgIH0gZWxzZSB7CgkgICAgICAgIHZhciBvcmlnaW5hbENvbHVtbiA9IG1hcHBpbmcub3JpZ2luYWxDb2x1bW47CgoJICAgICAgICAvLyBJdGVyYXRlIHVudGlsIGVpdGhlciB3ZSBydW4gb3V0IG9mIG1hcHBpbmdzLCBvciB3ZSBydW4gaW50bwoJICAgICAgICAvLyBhIG1hcHBpbmcgZm9yIGEgZGlmZmVyZW50IGxpbmUgdGhhbiB0aGUgb25lIHdlIHdlcmUgc2VhcmNoaW5nIGZvci4KCSAgICAgICAgLy8gU2luY2UgbWFwcGluZ3MgYXJlIHNvcnRlZCwgdGhpcyBpcyBndWFyYW50ZWVkIHRvIGZpbmQgYWxsIG1hcHBpbmdzIGZvcgoJICAgICAgICAvLyB0aGUgbGluZSB3ZSBhcmUgc2VhcmNoaW5nIGZvci4KCSAgICAgICAgd2hpbGUgKG1hcHBpbmcgJiYKCSAgICAgICAgICAgICAgIG1hcHBpbmcub3JpZ2luYWxMaW5lID09PSBsaW5lICYmCgkgICAgICAgICAgICAgICBtYXBwaW5nLm9yaWdpbmFsQ29sdW1uID09IG9yaWdpbmFsQ29sdW1uKSB7CgkgICAgICAgICAgbWFwcGluZ3MucHVzaCh7CgkgICAgICAgICAgICBsaW5lOiB1dGlsLmdldEFyZyhtYXBwaW5nLCAnZ2VuZXJhdGVkTGluZScsIG51bGwpLAoJICAgICAgICAgICAgY29sdW1uOiB1dGlsLmdldEFyZyhtYXBwaW5nLCAnZ2VuZXJhdGVkQ29sdW1uJywgbnVsbCksCgkgICAgICAgICAgICBsYXN0Q29sdW1uOiB1dGlsLmdldEFyZyhtYXBwaW5nLCAnbGFzdEdlbmVyYXRlZENvbHVtbicsIG51bGwpCgkgICAgICAgICAgfSk7CgoJICAgICAgICAgIG1hcHBpbmcgPSB0aGlzLl9vcmlnaW5hbE1hcHBpbmdzWysraW5kZXhdOwoJICAgICAgICB9CgkgICAgICB9CgkgICAgfQoKCSAgICByZXR1cm4gbWFwcGluZ3M7CgkgIH07CgoJc291cmNlTWFwQ29uc3VtZXIuU291cmNlTWFwQ29uc3VtZXIgPSBTb3VyY2VNYXBDb25zdW1lcjsKCgkvKioKCSAqIEEgQmFzaWNTb3VyY2VNYXBDb25zdW1lciBpbnN0YW5jZSByZXByZXNlbnRzIGEgcGFyc2VkIHNvdXJjZSBtYXAgd2hpY2ggd2UgY2FuCgkgKiBxdWVyeSBmb3IgaW5mb3JtYXRpb24gYWJvdXQgdGhlIG9yaWdpbmFsIGZpbGUgcG9zaXRpb25zIGJ5IGdpdmluZyBpdCBhIGZpbGUKCSAqIHBvc2l0aW9uIGluIHRoZSBnZW5lcmF0ZWQgc291cmNlLgoJICoKCSAqIFRoZSBmaXJzdCBwYXJhbWV0ZXIgaXMgdGhlIHJhdyBzb3VyY2UgbWFwIChlaXRoZXIgYXMgYSBKU09OIHN0cmluZywgb3IKCSAqIGFscmVhZHkgcGFyc2VkIHRvIGFuIG9iamVjdCkuIEFjY29yZGluZyB0byB0aGUgc3BlYywgc291cmNlIG1hcHMgaGF2ZSB0aGUKCSAqIGZvbGxvd2luZyBhdHRyaWJ1dGVzOgoJICoKCSAqICAgLSB2ZXJzaW9uOiBXaGljaCB2ZXJzaW9uIG9mIHRoZSBzb3VyY2UgbWFwIHNwZWMgdGhpcyBtYXAgaXMgZm9sbG93aW5nLgoJICogICAtIHNvdXJjZXM6IEFuIGFycmF5IG9mIFVSTHMgdG8gdGhlIG9yaWdpbmFsIHNvdXJjZSBmaWxlcy4KCSAqICAgLSBuYW1lczogQW4gYXJyYXkgb2YgaWRlbnRpZmllcnMgd2hpY2ggY2FuIGJlIHJlZmVycmVuY2VkIGJ5IGluZGl2aWR1YWwgbWFwcGluZ3MuCgkgKiAgIC0gc291cmNlUm9vdDogT3B0aW9uYWwuIFRoZSBVUkwgcm9vdCBmcm9tIHdoaWNoIGFsbCBzb3VyY2VzIGFyZSByZWxhdGl2ZS4KCSAqICAgLSBzb3VyY2VzQ29udGVudDogT3B0aW9uYWwuIEFuIGFycmF5IG9mIGNvbnRlbnRzIG9mIHRoZSBvcmlnaW5hbCBzb3VyY2UgZmlsZXMuCgkgKiAgIC0gbWFwcGluZ3M6IEEgc3RyaW5nIG9mIGJhc2U2NCBWTFFzIHdoaWNoIGNvbnRhaW4gdGhlIGFjdHVhbCBtYXBwaW5ncy4KCSAqICAgLSBmaWxlOiBPcHRpb25hbC4gVGhlIGdlbmVyYXRlZCBmaWxlIHRoaXMgc291cmNlIG1hcCBpcyBhc3NvY2lhdGVkIHdpdGguCgkgKgoJICogSGVyZSBpcyBhbiBleGFtcGxlIHNvdXJjZSBtYXAsIHRha2VuIGZyb20gdGhlIHNvdXJjZSBtYXAgc3BlY1swXToKCSAqCgkgKiAgICAgewoJICogICAgICAgdmVyc2lvbiA6IDMsCgkgKiAgICAgICBmaWxlOiAib3V0LmpzIiwKCSAqICAgICAgIHNvdXJjZVJvb3QgOiAiIiwKCSAqICAgICAgIHNvdXJjZXM6IFsiZm9vLmpzIiwgImJhci5qcyJdLAoJICogICAgICAgbmFtZXM6IFsic3JjIiwgIm1hcHMiLCAiYXJlIiwgImZ1biJdLAoJICogICAgICAgbWFwcGluZ3M6ICJBQSxBQjs7QUJDREU7IgoJICogICAgIH0KCSAqCgkgKiBUaGUgc2Vjb25kIHBhcmFtZXRlciwgaWYgZ2l2ZW4sIGlzIGEgc3RyaW5nIHdob3NlIHZhbHVlIGlzIHRoZSBVUkwKCSAqIGF0IHdoaWNoIHRoZSBzb3VyY2UgbWFwIHdhcyBmb3VuZC4gIFRoaXMgVVJMIGlzIHVzZWQgdG8gY29tcHV0ZSB0aGUKCSAqIHNvdXJjZXMgYXJyYXkuCgkgKgoJICogWzBdOiBodHRwczovL2RvY3MuZ29vZ2xlLmNvbS9kb2N1bWVudC9kLzFVMVJHQWVoUXdSeXBVVG92RjFLUmxwaU9GemUwYi1fMmdjNmZBSDBLWTBrL2VkaXQ/cGxpPTEjCgkgKi8KCWZ1bmN0aW9uIEJhc2ljU291cmNlTWFwQ29uc3VtZXIoYVNvdXJjZU1hcCwgYVNvdXJjZU1hcFVSTCkgewoJICB2YXIgc291cmNlTWFwID0gYVNvdXJjZU1hcDsKCSAgaWYgKHR5cGVvZiBhU291cmNlTWFwID09PSAnc3RyaW5nJykgewoJICAgIHNvdXJjZU1hcCA9IHV0aWwucGFyc2VTb3VyY2VNYXBJbnB1dChhU291cmNlTWFwKTsKCSAgfQoKCSAgdmFyIHZlcnNpb24gPSB1dGlsLmdldEFyZyhzb3VyY2VNYXAsICd2ZXJzaW9uJyk7CgkgIHZhciBzb3VyY2VzID0gdXRpbC5nZXRBcmcoc291cmNlTWFwLCAnc291cmNlcycpOwoJICAvLyBTYXNzIDMuMyBsZWF2ZXMgb3V0IHRoZSAnbmFtZXMnIGFycmF5LCBzbyB3ZSBkZXZpYXRlIGZyb20gdGhlIHNwZWMgKHdoaWNoCgkgIC8vIHJlcXVpcmVzIHRoZSBhcnJheSkgdG8gcGxheSBuaWNlIGhlcmUuCgkgIHZhciBuYW1lcyA9IHV0aWwuZ2V0QXJnKHNvdXJjZU1hcCwgJ25hbWVzJywgW10pOwoJICB2YXIgc291cmNlUm9vdCA9IHV0aWwuZ2V0QXJnKHNvdXJjZU1hcCwgJ3NvdXJjZVJvb3QnLCBudWxsKTsKCSAgdmFyIHNvdXJjZXNDb250ZW50ID0gdXRpbC5nZXRBcmcoc291cmNlTWFwLCAnc291cmNlc0NvbnRlbnQnLCBudWxsKTsKCSAgdmFyIG1hcHBpbmdzID0gdXRpbC5nZXRBcmcoc291cmNlTWFwLCAnbWFwcGluZ3MnKTsKCSAgdmFyIGZpbGUgPSB1dGlsLmdldEFyZyhzb3VyY2VNYXAsICdmaWxlJywgbnVsbCk7CgoJICAvLyBPbmNlIGFnYWluLCBTYXNzIGRldmlhdGVzIGZyb20gdGhlIHNwZWMgYW5kIHN1cHBsaWVzIHRoZSB2ZXJzaW9uIGFzIGEKCSAgLy8gc3RyaW5nIHJhdGhlciB0aGFuIGEgbnVtYmVyLCBzbyB3ZSB1c2UgbG9vc2UgZXF1YWxpdHkgY2hlY2tpbmcgaGVyZS4KCSAgaWYgKHZlcnNpb24gIT0gdGhpcy5fdmVyc2lvbikgewoJICAgIHRocm93IG5ldyBFcnJvcignVW5zdXBwb3J0ZWQgdmVyc2lvbjogJyArIHZlcnNpb24pOwoJICB9CgoJICBpZiAoc291cmNlUm9vdCkgewoJICAgIHNvdXJjZVJvb3QgPSB1dGlsLm5vcm1hbGl6ZShzb3VyY2VSb290KTsKCSAgfQoKCSAgc291cmNlcyA9IHNvdXJjZXMKCSAgICAubWFwKFN0cmluZykKCSAgICAvLyBTb21lIHNvdXJjZSBtYXBzIHByb2R1Y2UgcmVsYXRpdmUgc291cmNlIHBhdGhzIGxpa2UgIi4vZm9vLmpzIiBpbnN0ZWFkIG9mCgkgICAgLy8gImZvby5qcyIuICBOb3JtYWxpemUgdGhlc2UgZmlyc3Qgc28gdGhhdCBmdXR1cmUgY29tcGFyaXNvbnMgd2lsbCBzdWNjZWVkLgoJICAgIC8vIFNlZSBidWd6aWwubGEvMTA5MDc2OC4KCSAgICAubWFwKHV0aWwubm9ybWFsaXplKQoJICAgIC8vIEFsd2F5cyBlbnN1cmUgdGhhdCBhYnNvbHV0ZSBzb3VyY2VzIGFyZSBpbnRlcm5hbGx5IHN0b3JlZCByZWxhdGl2ZSB0bwoJICAgIC8vIHRoZSBzb3VyY2Ugcm9vdCwgaWYgdGhlIHNvdXJjZSByb290IGlzIGFic29sdXRlLiBOb3QgZG9pbmcgdGhpcyB3b3VsZAoJICAgIC8vIGJlIHBhcnRpY3VsYXJseSBwcm9ibGVtYXRpYyB3aGVuIHRoZSBzb3VyY2Ugcm9vdCBpcyBhIHByZWZpeCBvZiB0aGUKCSAgICAvLyBzb3VyY2UgKHZhbGlkLCBidXQgd2h5Pz8pLiBTZWUgZ2l0aHViIGlzc3VlICMxOTkgYW5kIGJ1Z3ppbC5sYS8xMTg4OTgyLgoJICAgIC5tYXAoZnVuY3Rpb24gKHNvdXJjZSkgewoJICAgICAgcmV0dXJuIHNvdXJjZVJvb3QgJiYgdXRpbC5pc0Fic29sdXRlKHNvdXJjZVJvb3QpICYmIHV0aWwuaXNBYnNvbHV0ZShzb3VyY2UpCgkgICAgICAgID8gdXRpbC5yZWxhdGl2ZShzb3VyY2VSb290LCBzb3VyY2UpCgkgICAgICAgIDogc291cmNlOwoJICAgIH0pOwoKCSAgLy8gUGFzcyBgdHJ1ZWAgYmVsb3cgdG8gYWxsb3cgZHVwbGljYXRlIG5hbWVzIGFuZCBzb3VyY2VzLiBXaGlsZSBzb3VyY2UgbWFwcwoJICAvLyBhcmUgaW50ZW5kZWQgdG8gYmUgY29tcHJlc3NlZCBhbmQgZGVkdXBsaWNhdGVkLCB0aGUgVHlwZVNjcmlwdCBjb21waWxlcgoJICAvLyBzb21ldGltZXMgZ2VuZXJhdGVzIHNvdXJjZSBtYXBzIHdpdGggZHVwbGljYXRlcyBpbiB0aGVtLiBTZWUgR2l0aHViIGlzc3VlCgkgIC8vICM3MiBhbmQgYnVnemlsLmxhLzg4OTQ5Mi4KCSAgdGhpcy5fbmFtZXMgPSBBcnJheVNldC5mcm9tQXJyYXkobmFtZXMubWFwKFN0cmluZyksIHRydWUpOwoJICB0aGlzLl9zb3VyY2VzID0gQXJyYXlTZXQuZnJvbUFycmF5KHNvdXJjZXMsIHRydWUpOwoKCSAgdGhpcy5fYWJzb2x1dGVTb3VyY2VzID0gdGhpcy5fc291cmNlcy50b0FycmF5KCkubWFwKGZ1bmN0aW9uIChzKSB7CgkgICAgcmV0dXJuIHV0aWwuY29tcHV0ZVNvdXJjZVVSTChzb3VyY2VSb290LCBzLCBhU291cmNlTWFwVVJMKTsKCSAgfSk7CgoJICB0aGlzLnNvdXJjZVJvb3QgPSBzb3VyY2VSb290OwoJICB0aGlzLnNvdXJjZXNDb250ZW50ID0gc291cmNlc0NvbnRlbnQ7CgkgIHRoaXMuX21hcHBpbmdzID0gbWFwcGluZ3M7CgkgIHRoaXMuX3NvdXJjZU1hcFVSTCA9IGFTb3VyY2VNYXBVUkw7CgkgIHRoaXMuZmlsZSA9IGZpbGU7Cgl9CgoJQmFzaWNTb3VyY2VNYXBDb25zdW1lci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFNvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZSk7CglCYXNpY1NvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZS5jb25zdW1lciA9IFNvdXJjZU1hcENvbnN1bWVyOwoKCS8qKgoJICogVXRpbGl0eSBmdW5jdGlvbiB0byBmaW5kIHRoZSBpbmRleCBvZiBhIHNvdXJjZS4gIFJldHVybnMgLTEgaWYgbm90CgkgKiBmb3VuZC4KCSAqLwoJQmFzaWNTb3VyY2VNYXBDb25zdW1lci5wcm90b3R5cGUuX2ZpbmRTb3VyY2VJbmRleCA9IGZ1bmN0aW9uKGFTb3VyY2UpIHsKCSAgdmFyIHJlbGF0aXZlU291cmNlID0gYVNvdXJjZTsKCSAgaWYgKHRoaXMuc291cmNlUm9vdCAhPSBudWxsKSB7CgkgICAgcmVsYXRpdmVTb3VyY2UgPSB1dGlsLnJlbGF0aXZlKHRoaXMuc291cmNlUm9vdCwgcmVsYXRpdmVTb3VyY2UpOwoJICB9CgoJICBpZiAodGhpcy5fc291cmNlcy5oYXMocmVsYXRpdmVTb3VyY2UpKSB7CgkgICAgcmV0dXJuIHRoaXMuX3NvdXJjZXMuaW5kZXhPZihyZWxhdGl2ZVNvdXJjZSk7CgkgIH0KCgkgIC8vIE1heWJlIGFTb3VyY2UgaXMgYW4gYWJzb2x1dGUgVVJMIGFzIHJldHVybmVkIGJ5IHxzb3VyY2VzfC4gIEluCgkgIC8vIHRoaXMgY2FzZSB3ZSBjYW4ndCBzaW1wbHkgdW5kbyB0aGUgdHJhbnNmb3JtLgoJICB2YXIgaTsKCSAgZm9yIChpID0gMDsgaSA8IHRoaXMuX2Fic29sdXRlU291cmNlcy5sZW5ndGg7ICsraSkgewoJICAgIGlmICh0aGlzLl9hYnNvbHV0ZVNvdXJjZXNbaV0gPT0gYVNvdXJjZSkgewoJICAgICAgcmV0dXJuIGk7CgkgICAgfQoJICB9CgoJICByZXR1cm4gLTE7Cgl9OwoKCS8qKgoJICogQ3JlYXRlIGEgQmFzaWNTb3VyY2VNYXBDb25zdW1lciBmcm9tIGEgU291cmNlTWFwR2VuZXJhdG9yLgoJICoKCSAqIEBwYXJhbSBTb3VyY2VNYXBHZW5lcmF0b3IgYVNvdXJjZU1hcAoJICogICAgICAgIFRoZSBzb3VyY2UgbWFwIHRoYXQgd2lsbCBiZSBjb25zdW1lZC4KCSAqIEBwYXJhbSBTdHJpbmcgYVNvdXJjZU1hcFVSTAoJICogICAgICAgIFRoZSBVUkwgYXQgd2hpY2ggdGhlIHNvdXJjZSBtYXAgY2FuIGJlIGZvdW5kIChvcHRpb25hbCkKCSAqIEByZXR1cm5zIEJhc2ljU291cmNlTWFwQ29uc3VtZXIKCSAqLwoJQmFzaWNTb3VyY2VNYXBDb25zdW1lci5mcm9tU291cmNlTWFwID0KCSAgZnVuY3Rpb24gU291cmNlTWFwQ29uc3VtZXJfZnJvbVNvdXJjZU1hcChhU291cmNlTWFwLCBhU291cmNlTWFwVVJMKSB7CgkgICAgdmFyIHNtYyA9IE9iamVjdC5jcmVhdGUoQmFzaWNTb3VyY2VNYXBDb25zdW1lci5wcm90b3R5cGUpOwoKCSAgICB2YXIgbmFtZXMgPSBzbWMuX25hbWVzID0gQXJyYXlTZXQuZnJvbUFycmF5KGFTb3VyY2VNYXAuX25hbWVzLnRvQXJyYXkoKSwgdHJ1ZSk7CgkgICAgdmFyIHNvdXJjZXMgPSBzbWMuX3NvdXJjZXMgPSBBcnJheVNldC5mcm9tQXJyYXkoYVNvdXJjZU1hcC5fc291cmNlcy50b0FycmF5KCksIHRydWUpOwoJICAgIHNtYy5zb3VyY2VSb290ID0gYVNvdXJjZU1hcC5fc291cmNlUm9vdDsKCSAgICBzbWMuc291cmNlc0NvbnRlbnQgPSBhU291cmNlTWFwLl9nZW5lcmF0ZVNvdXJjZXNDb250ZW50KHNtYy5fc291cmNlcy50b0FycmF5KCksCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbWMuc291cmNlUm9vdCk7CgkgICAgc21jLmZpbGUgPSBhU291cmNlTWFwLl9maWxlOwoJICAgIHNtYy5fc291cmNlTWFwVVJMID0gYVNvdXJjZU1hcFVSTDsKCSAgICBzbWMuX2Fic29sdXRlU291cmNlcyA9IHNtYy5fc291cmNlcy50b0FycmF5KCkubWFwKGZ1bmN0aW9uIChzKSB7CgkgICAgICByZXR1cm4gdXRpbC5jb21wdXRlU291cmNlVVJMKHNtYy5zb3VyY2VSb290LCBzLCBhU291cmNlTWFwVVJMKTsKCSAgICB9KTsKCgkgICAgLy8gQmVjYXVzZSB3ZSBhcmUgbW9kaWZ5aW5nIHRoZSBlbnRyaWVzIChieSBjb252ZXJ0aW5nIHN0cmluZyBzb3VyY2VzIGFuZAoJICAgIC8vIG5hbWVzIHRvIGluZGljZXMgaW50byB0aGUgc291cmNlcyBhbmQgbmFtZXMgQXJyYXlTZXRzKSwgd2UgaGF2ZSB0byBtYWtlCgkgICAgLy8gYSBjb3B5IG9mIHRoZSBlbnRyeSBvciBlbHNlIGJhZCB0aGluZ3MgaGFwcGVuLiBTaGFyZWQgbXV0YWJsZSBzdGF0ZQoJICAgIC8vIHN0cmlrZXMgYWdhaW4hIFNlZSBnaXRodWIgaXNzdWUgIzE5MS4KCgkgICAgdmFyIGdlbmVyYXRlZE1hcHBpbmdzID0gYVNvdXJjZU1hcC5fbWFwcGluZ3MudG9BcnJheSgpLnNsaWNlKCk7CgkgICAgdmFyIGRlc3RHZW5lcmF0ZWRNYXBwaW5ncyA9IHNtYy5fX2dlbmVyYXRlZE1hcHBpbmdzID0gW107CgkgICAgdmFyIGRlc3RPcmlnaW5hbE1hcHBpbmdzID0gc21jLl9fb3JpZ2luYWxNYXBwaW5ncyA9IFtdOwoKCSAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gZ2VuZXJhdGVkTWFwcGluZ3MubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKCSAgICAgIHZhciBzcmNNYXBwaW5nID0gZ2VuZXJhdGVkTWFwcGluZ3NbaV07CgkgICAgICB2YXIgZGVzdE1hcHBpbmcgPSBuZXcgTWFwcGluZzsKCSAgICAgIGRlc3RNYXBwaW5nLmdlbmVyYXRlZExpbmUgPSBzcmNNYXBwaW5nLmdlbmVyYXRlZExpbmU7CgkgICAgICBkZXN0TWFwcGluZy5nZW5lcmF0ZWRDb2x1bW4gPSBzcmNNYXBwaW5nLmdlbmVyYXRlZENvbHVtbjsKCgkgICAgICBpZiAoc3JjTWFwcGluZy5zb3VyY2UpIHsKCSAgICAgICAgZGVzdE1hcHBpbmcuc291cmNlID0gc291cmNlcy5pbmRleE9mKHNyY01hcHBpbmcuc291cmNlKTsKCSAgICAgICAgZGVzdE1hcHBpbmcub3JpZ2luYWxMaW5lID0gc3JjTWFwcGluZy5vcmlnaW5hbExpbmU7CgkgICAgICAgIGRlc3RNYXBwaW5nLm9yaWdpbmFsQ29sdW1uID0gc3JjTWFwcGluZy5vcmlnaW5hbENvbHVtbjsKCgkgICAgICAgIGlmIChzcmNNYXBwaW5nLm5hbWUpIHsKCSAgICAgICAgICBkZXN0TWFwcGluZy5uYW1lID0gbmFtZXMuaW5kZXhPZihzcmNNYXBwaW5nLm5hbWUpOwoJICAgICAgICB9CgoJICAgICAgICBkZXN0T3JpZ2luYWxNYXBwaW5ncy5wdXNoKGRlc3RNYXBwaW5nKTsKCSAgICAgIH0KCgkgICAgICBkZXN0R2VuZXJhdGVkTWFwcGluZ3MucHVzaChkZXN0TWFwcGluZyk7CgkgICAgfQoKCSAgICBxdWlja1NvcnQoc21jLl9fb3JpZ2luYWxNYXBwaW5ncywgdXRpbC5jb21wYXJlQnlPcmlnaW5hbFBvc2l0aW9ucyk7CgoJICAgIHJldHVybiBzbWM7CgkgIH07CgoJLyoqCgkgKiBUaGUgdmVyc2lvbiBvZiB0aGUgc291cmNlIG1hcHBpbmcgc3BlYyB0aGF0IHdlIGFyZSBjb25zdW1pbmcuCgkgKi8KCUJhc2ljU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLl92ZXJzaW9uID0gMzsKCgkvKioKCSAqIFRoZSBsaXN0IG9mIG9yaWdpbmFsIHNvdXJjZXMuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShCYXNpY1NvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZSwgJ3NvdXJjZXMnLCB7CgkgIGdldDogZnVuY3Rpb24gKCkgewoJICAgIHJldHVybiB0aGlzLl9hYnNvbHV0ZVNvdXJjZXMuc2xpY2UoKTsKCSAgfQoJfSk7CgoJLyoqCgkgKiBQcm92aWRlIHRoZSBKSVQgd2l0aCBhIG5pY2Ugc2hhcGUgLyBoaWRkZW4gY2xhc3MuCgkgKi8KCWZ1bmN0aW9uIE1hcHBpbmcoKSB7CgkgIHRoaXMuZ2VuZXJhdGVkTGluZSA9IDA7CgkgIHRoaXMuZ2VuZXJhdGVkQ29sdW1uID0gMDsKCSAgdGhpcy5zb3VyY2UgPSBudWxsOwoJICB0aGlzLm9yaWdpbmFsTGluZSA9IG51bGw7CgkgIHRoaXMub3JpZ2luYWxDb2x1bW4gPSBudWxsOwoJICB0aGlzLm5hbWUgPSBudWxsOwoJfQoKCS8qKgoJICogUGFyc2UgdGhlIG1hcHBpbmdzIGluIGEgc3RyaW5nIGluIHRvIGEgZGF0YSBzdHJ1Y3R1cmUgd2hpY2ggd2UgY2FuIGVhc2lseQoJICogcXVlcnkgKHRoZSBvcmRlcmVkIGFycmF5cyBpbiB0aGUgYHRoaXMuX19nZW5lcmF0ZWRNYXBwaW5nc2AgYW5kCgkgKiBgdGhpcy5fX29yaWdpbmFsTWFwcGluZ3NgIHByb3BlcnRpZXMpLgoJICovCglCYXNpY1NvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZS5fcGFyc2VNYXBwaW5ncyA9CgkgIGZ1bmN0aW9uIFNvdXJjZU1hcENvbnN1bWVyX3BhcnNlTWFwcGluZ3MoYVN0ciwgYVNvdXJjZVJvb3QpIHsKCSAgICB2YXIgZ2VuZXJhdGVkTGluZSA9IDE7CgkgICAgdmFyIHByZXZpb3VzR2VuZXJhdGVkQ29sdW1uID0gMDsKCSAgICB2YXIgcHJldmlvdXNPcmlnaW5hbExpbmUgPSAwOwoJICAgIHZhciBwcmV2aW91c09yaWdpbmFsQ29sdW1uID0gMDsKCSAgICB2YXIgcHJldmlvdXNTb3VyY2UgPSAwOwoJICAgIHZhciBwcmV2aW91c05hbWUgPSAwOwoJICAgIHZhciBsZW5ndGggPSBhU3RyLmxlbmd0aDsKCSAgICB2YXIgaW5kZXggPSAwOwoJICAgIHZhciBjYWNoZWRTZWdtZW50cyA9IHt9OwoJICAgIHZhciB0ZW1wID0ge307CgkgICAgdmFyIG9yaWdpbmFsTWFwcGluZ3MgPSBbXTsKCSAgICB2YXIgZ2VuZXJhdGVkTWFwcGluZ3MgPSBbXTsKCSAgICB2YXIgbWFwcGluZywgc3RyLCBzZWdtZW50LCBlbmQsIHZhbHVlOwoKCSAgICB3aGlsZSAoaW5kZXggPCBsZW5ndGgpIHsKCSAgICAgIGlmIChhU3RyLmNoYXJBdChpbmRleCkgPT09ICc7JykgewoJICAgICAgICBnZW5lcmF0ZWRMaW5lKys7CgkgICAgICAgIGluZGV4Kys7CgkgICAgICAgIHByZXZpb3VzR2VuZXJhdGVkQ29sdW1uID0gMDsKCSAgICAgIH0KCSAgICAgIGVsc2UgaWYgKGFTdHIuY2hhckF0KGluZGV4KSA9PT0gJywnKSB7CgkgICAgICAgIGluZGV4Kys7CgkgICAgICB9CgkgICAgICBlbHNlIHsKCSAgICAgICAgbWFwcGluZyA9IG5ldyBNYXBwaW5nKCk7CgkgICAgICAgIG1hcHBpbmcuZ2VuZXJhdGVkTGluZSA9IGdlbmVyYXRlZExpbmU7CgoJICAgICAgICAvLyBCZWNhdXNlIGVhY2ggb2Zmc2V0IGlzIGVuY29kZWQgcmVsYXRpdmUgdG8gdGhlIHByZXZpb3VzIG9uZSwKCSAgICAgICAgLy8gbWFueSBzZWdtZW50cyBvZnRlbiBoYXZlIHRoZSBzYW1lIGVuY29kaW5nLiBXZSBjYW4gZXhwbG9pdCB0aGlzCgkgICAgICAgIC8vIGZhY3QgYnkgY2FjaGluZyB0aGUgcGFyc2VkIHZhcmlhYmxlIGxlbmd0aCBmaWVsZHMgb2YgZWFjaCBzZWdtZW50LAoJICAgICAgICAvLyBhbGxvd2luZyB1cyB0byBhdm9pZCBhIHNlY29uZCBwYXJzZSBpZiB3ZSBlbmNvdW50ZXIgdGhlIHNhbWUKCSAgICAgICAgLy8gc2VnbWVudCBhZ2Fpbi4KCSAgICAgICAgZm9yIChlbmQgPSBpbmRleDsgZW5kIDwgbGVuZ3RoOyBlbmQrKykgewoJICAgICAgICAgIGlmICh0aGlzLl9jaGFySXNNYXBwaW5nU2VwYXJhdG9yKGFTdHIsIGVuZCkpIHsKCSAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBzdHIgPSBhU3RyLnNsaWNlKGluZGV4LCBlbmQpOwoKCSAgICAgICAgc2VnbWVudCA9IGNhY2hlZFNlZ21lbnRzW3N0cl07CgkgICAgICAgIGlmIChzZWdtZW50KSB7CgkgICAgICAgICAgaW5kZXggKz0gc3RyLmxlbmd0aDsKCSAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICBzZWdtZW50ID0gW107CgkgICAgICAgICAgd2hpbGUgKGluZGV4IDwgZW5kKSB7CgkgICAgICAgICAgICBiYXNlNjRWTFEuZGVjb2RlKGFTdHIsIGluZGV4LCB0ZW1wKTsKCSAgICAgICAgICAgIHZhbHVlID0gdGVtcC52YWx1ZTsKCSAgICAgICAgICAgIGluZGV4ID0gdGVtcC5yZXN0OwoJICAgICAgICAgICAgc2VnbWVudC5wdXNoKHZhbHVlKTsKCSAgICAgICAgICB9CgoJICAgICAgICAgIGlmIChzZWdtZW50Lmxlbmd0aCA9PT0gMikgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGb3VuZCBhIHNvdXJjZSwgYnV0IG5vIGxpbmUgYW5kIGNvbHVtbicpOwoJICAgICAgICAgIH0KCgkgICAgICAgICAgaWYgKHNlZ21lbnQubGVuZ3RoID09PSAzKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZvdW5kIGEgc291cmNlIGFuZCBsaW5lLCBidXQgbm8gY29sdW1uJyk7CgkgICAgICAgICAgfQoKCSAgICAgICAgICBjYWNoZWRTZWdtZW50c1tzdHJdID0gc2VnbWVudDsKCSAgICAgICAgfQoKCSAgICAgICAgLy8gR2VuZXJhdGVkIGNvbHVtbi4KCSAgICAgICAgbWFwcGluZy5nZW5lcmF0ZWRDb2x1bW4gPSBwcmV2aW91c0dlbmVyYXRlZENvbHVtbiArIHNlZ21lbnRbMF07CgkgICAgICAgIHByZXZpb3VzR2VuZXJhdGVkQ29sdW1uID0gbWFwcGluZy5nZW5lcmF0ZWRDb2x1bW47CgoJICAgICAgICBpZiAoc2VnbWVudC5sZW5ndGggPiAxKSB7CgkgICAgICAgICAgLy8gT3JpZ2luYWwgc291cmNlLgoJICAgICAgICAgIG1hcHBpbmcuc291cmNlID0gcHJldmlvdXNTb3VyY2UgKyBzZWdtZW50WzFdOwoJICAgICAgICAgIHByZXZpb3VzU291cmNlICs9IHNlZ21lbnRbMV07CgoJICAgICAgICAgIC8vIE9yaWdpbmFsIGxpbmUuCgkgICAgICAgICAgbWFwcGluZy5vcmlnaW5hbExpbmUgPSBwcmV2aW91c09yaWdpbmFsTGluZSArIHNlZ21lbnRbMl07CgkgICAgICAgICAgcHJldmlvdXNPcmlnaW5hbExpbmUgPSBtYXBwaW5nLm9yaWdpbmFsTGluZTsKCSAgICAgICAgICAvLyBMaW5lcyBhcmUgc3RvcmVkIDAtYmFzZWQKCSAgICAgICAgICBtYXBwaW5nLm9yaWdpbmFsTGluZSArPSAxOwoKCSAgICAgICAgICAvLyBPcmlnaW5hbCBjb2x1bW4uCgkgICAgICAgICAgbWFwcGluZy5vcmlnaW5hbENvbHVtbiA9IHByZXZpb3VzT3JpZ2luYWxDb2x1bW4gKyBzZWdtZW50WzNdOwoJICAgICAgICAgIHByZXZpb3VzT3JpZ2luYWxDb2x1bW4gPSBtYXBwaW5nLm9yaWdpbmFsQ29sdW1uOwoKCSAgICAgICAgICBpZiAoc2VnbWVudC5sZW5ndGggPiA0KSB7CgkgICAgICAgICAgICAvLyBPcmlnaW5hbCBuYW1lLgoJICAgICAgICAgICAgbWFwcGluZy5uYW1lID0gcHJldmlvdXNOYW1lICsgc2VnbWVudFs0XTsKCSAgICAgICAgICAgIHByZXZpb3VzTmFtZSArPSBzZWdtZW50WzRdOwoJICAgICAgICAgIH0KCSAgICAgICAgfQoKCSAgICAgICAgZ2VuZXJhdGVkTWFwcGluZ3MucHVzaChtYXBwaW5nKTsKCSAgICAgICAgaWYgKHR5cGVvZiBtYXBwaW5nLm9yaWdpbmFsTGluZSA9PT0gJ251bWJlcicpIHsKCSAgICAgICAgICBvcmlnaW5hbE1hcHBpbmdzLnB1c2gobWFwcGluZyk7CgkgICAgICAgIH0KCSAgICAgIH0KCSAgICB9CgoJICAgIHF1aWNrU29ydChnZW5lcmF0ZWRNYXBwaW5ncywgdXRpbC5jb21wYXJlQnlHZW5lcmF0ZWRQb3NpdGlvbnNEZWZsYXRlZCk7CgkgICAgdGhpcy5fX2dlbmVyYXRlZE1hcHBpbmdzID0gZ2VuZXJhdGVkTWFwcGluZ3M7CgoJICAgIHF1aWNrU29ydChvcmlnaW5hbE1hcHBpbmdzLCB1dGlsLmNvbXBhcmVCeU9yaWdpbmFsUG9zaXRpb25zKTsKCSAgICB0aGlzLl9fb3JpZ2luYWxNYXBwaW5ncyA9IG9yaWdpbmFsTWFwcGluZ3M7CgkgIH07CgoJLyoqCgkgKiBGaW5kIHRoZSBtYXBwaW5nIHRoYXQgYmVzdCBtYXRjaGVzIHRoZSBoeXBvdGhldGljYWwgIm5lZWRsZSIgbWFwcGluZyB0aGF0CgkgKiB3ZSBhcmUgc2VhcmNoaW5nIGZvciBpbiB0aGUgZ2l2ZW4gImhheXN0YWNrIiBvZiBtYXBwaW5ncy4KCSAqLwoJQmFzaWNTb3VyY2VNYXBDb25zdW1lci5wcm90b3R5cGUuX2ZpbmRNYXBwaW5nID0KCSAgZnVuY3Rpb24gU291cmNlTWFwQ29uc3VtZXJfZmluZE1hcHBpbmcoYU5lZWRsZSwgYU1hcHBpbmdzLCBhTGluZU5hbWUsCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFDb2x1bW5OYW1lLCBhQ29tcGFyYXRvciwgYUJpYXMpIHsKCSAgICAvLyBUbyByZXR1cm4gdGhlIHBvc2l0aW9uIHdlIGFyZSBzZWFyY2hpbmcgZm9yLCB3ZSBtdXN0IGZpcnN0IGZpbmQgdGhlCgkgICAgLy8gbWFwcGluZyBmb3IgdGhlIGdpdmVuIHBvc2l0aW9uIGFuZCB0aGVuIHJldHVybiB0aGUgb3Bwb3NpdGUgcG9zaXRpb24gaXQKCSAgICAvLyBwb2ludHMgdG8uIEJlY2F1c2UgdGhlIG1hcHBpbmdzIGFyZSBzb3J0ZWQsIHdlIGNhbiB1c2UgYmluYXJ5IHNlYXJjaCB0bwoJICAgIC8vIGZpbmQgdGhlIGJlc3QgbWFwcGluZy4KCgkgICAgaWYgKGFOZWVkbGVbYUxpbmVOYW1lXSA8PSAwKSB7CgkgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdMaW5lIG11c3QgYmUgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIDEsIGdvdCAnCgkgICAgICAgICAgICAgICAgICAgICAgICAgICsgYU5lZWRsZVthTGluZU5hbWVdKTsKCSAgICB9CgkgICAgaWYgKGFOZWVkbGVbYUNvbHVtbk5hbWVdIDwgMCkgewoJICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignQ29sdW1uIG11c3QgYmUgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIDAsIGdvdCAnCgkgICAgICAgICAgICAgICAgICAgICAgICAgICsgYU5lZWRsZVthQ29sdW1uTmFtZV0pOwoJICAgIH0KCgkgICAgcmV0dXJuIGJpbmFyeVNlYXJjaC5zZWFyY2goYU5lZWRsZSwgYU1hcHBpbmdzLCBhQ29tcGFyYXRvciwgYUJpYXMpOwoJICB9OwoKCS8qKgoJICogQ29tcHV0ZSB0aGUgbGFzdCBjb2x1bW4gZm9yIGVhY2ggZ2VuZXJhdGVkIG1hcHBpbmcuIFRoZSBsYXN0IGNvbHVtbiBpcwoJICogaW5jbHVzaXZlLgoJICovCglCYXNpY1NvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZS5jb21wdXRlQ29sdW1uU3BhbnMgPQoJICBmdW5jdGlvbiBTb3VyY2VNYXBDb25zdW1lcl9jb21wdXRlQ29sdW1uU3BhbnMoKSB7CgkgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMuX2dlbmVyYXRlZE1hcHBpbmdzLmxlbmd0aDsgKytpbmRleCkgewoJICAgICAgdmFyIG1hcHBpbmcgPSB0aGlzLl9nZW5lcmF0ZWRNYXBwaW5nc1tpbmRleF07CgoJICAgICAgLy8gTWFwcGluZ3MgZG8gbm90IGNvbnRhaW4gYSBmaWVsZCBmb3IgdGhlIGxhc3QgZ2VuZXJhdGVkIGNvbHVtbnQuIFdlCgkgICAgICAvLyBjYW4gY29tZSB1cCB3aXRoIGFuIG9wdGltaXN0aWMgZXN0aW1hdGUsIGhvd2V2ZXIsIGJ5IGFzc3VtaW5nIHRoYXQKCSAgICAgIC8vIG1hcHBpbmdzIGFyZSBjb250aWd1b3VzIChpLmUuIGdpdmVuIHR3byBjb25zZWN1dGl2ZSBtYXBwaW5ncywgdGhlCgkgICAgICAvLyBmaXJzdCBtYXBwaW5nIGVuZHMgd2hlcmUgdGhlIHNlY29uZCBvbmUgc3RhcnRzKS4KCSAgICAgIGlmIChpbmRleCArIDEgPCB0aGlzLl9nZW5lcmF0ZWRNYXBwaW5ncy5sZW5ndGgpIHsKCSAgICAgICAgdmFyIG5leHRNYXBwaW5nID0gdGhpcy5fZ2VuZXJhdGVkTWFwcGluZ3NbaW5kZXggKyAxXTsKCgkgICAgICAgIGlmIChtYXBwaW5nLmdlbmVyYXRlZExpbmUgPT09IG5leHRNYXBwaW5nLmdlbmVyYXRlZExpbmUpIHsKCSAgICAgICAgICBtYXBwaW5nLmxhc3RHZW5lcmF0ZWRDb2x1bW4gPSBuZXh0TWFwcGluZy5nZW5lcmF0ZWRDb2x1bW4gLSAxOwoJICAgICAgICAgIGNvbnRpbnVlOwoJICAgICAgICB9CgkgICAgICB9CgoJICAgICAgLy8gVGhlIGxhc3QgbWFwcGluZyBmb3IgZWFjaCBsaW5lIHNwYW5zIHRoZSBlbnRpcmUgbGluZS4KCSAgICAgIG1hcHBpbmcubGFzdEdlbmVyYXRlZENvbHVtbiA9IEluZmluaXR5OwoJICAgIH0KCSAgfTsKCgkvKioKCSAqIFJldHVybnMgdGhlIG9yaWdpbmFsIHNvdXJjZSwgbGluZSwgYW5kIGNvbHVtbiBpbmZvcm1hdGlvbiBmb3IgdGhlIGdlbmVyYXRlZAoJICogc291cmNlJ3MgbGluZSBhbmQgY29sdW1uIHBvc2l0aW9ucyBwcm92aWRlZC4gVGhlIG9ubHkgYXJndW1lbnQgaXMgYW4gb2JqZWN0CgkgKiB3aXRoIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczoKCSAqCgkgKiAgIC0gbGluZTogVGhlIGxpbmUgbnVtYmVyIGluIHRoZSBnZW5lcmF0ZWQgc291cmNlLiAgVGhlIGxpbmUgbnVtYmVyCgkgKiAgICAgaXMgMS1iYXNlZC4KCSAqICAgLSBjb2x1bW46IFRoZSBjb2x1bW4gbnVtYmVyIGluIHRoZSBnZW5lcmF0ZWQgc291cmNlLiAgVGhlIGNvbHVtbgoJICogICAgIG51bWJlciBpcyAwLWJhc2VkLgoJICogICAtIGJpYXM6IEVpdGhlciAnU291cmNlTWFwQ29uc3VtZXIuR1JFQVRFU1RfTE9XRVJfQk9VTkQnIG9yCgkgKiAgICAgJ1NvdXJjZU1hcENvbnN1bWVyLkxFQVNUX1VQUEVSX0JPVU5EJy4gU3BlY2lmaWVzIHdoZXRoZXIgdG8gcmV0dXJuIHRoZQoJICogICAgIGNsb3Nlc3QgZWxlbWVudCB0aGF0IGlzIHNtYWxsZXIgdGhhbiBvciBncmVhdGVyIHRoYW4gdGhlIG9uZSB3ZSBhcmUKCSAqICAgICBzZWFyY2hpbmcgZm9yLCByZXNwZWN0aXZlbHksIGlmIHRoZSBleGFjdCBlbGVtZW50IGNhbm5vdCBiZSBmb3VuZC4KCSAqICAgICBEZWZhdWx0cyB0byAnU291cmNlTWFwQ29uc3VtZXIuR1JFQVRFU1RfTE9XRVJfQk9VTkQnLgoJICoKCSAqIGFuZCBhbiBvYmplY3QgaXMgcmV0dXJuZWQgd2l0aCB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6CgkgKgoJICogICAtIHNvdXJjZTogVGhlIG9yaWdpbmFsIHNvdXJjZSBmaWxlLCBvciBudWxsLgoJICogICAtIGxpbmU6IFRoZSBsaW5lIG51bWJlciBpbiB0aGUgb3JpZ2luYWwgc291cmNlLCBvciBudWxsLiAgVGhlCgkgKiAgICAgbGluZSBudW1iZXIgaXMgMS1iYXNlZC4KCSAqICAgLSBjb2x1bW46IFRoZSBjb2x1bW4gbnVtYmVyIGluIHRoZSBvcmlnaW5hbCBzb3VyY2UsIG9yIG51bGwuICBUaGUKCSAqICAgICBjb2x1bW4gbnVtYmVyIGlzIDAtYmFzZWQuCgkgKiAgIC0gbmFtZTogVGhlIG9yaWdpbmFsIGlkZW50aWZpZXIsIG9yIG51bGwuCgkgKi8KCUJhc2ljU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLm9yaWdpbmFsUG9zaXRpb25Gb3IgPQoJICBmdW5jdGlvbiBTb3VyY2VNYXBDb25zdW1lcl9vcmlnaW5hbFBvc2l0aW9uRm9yKGFBcmdzKSB7CgkgICAgdmFyIG5lZWRsZSA9IHsKCSAgICAgIGdlbmVyYXRlZExpbmU6IHV0aWwuZ2V0QXJnKGFBcmdzLCAnbGluZScpLAoJICAgICAgZ2VuZXJhdGVkQ29sdW1uOiB1dGlsLmdldEFyZyhhQXJncywgJ2NvbHVtbicpCgkgICAgfTsKCgkgICAgdmFyIGluZGV4ID0gdGhpcy5fZmluZE1hcHBpbmcoCgkgICAgICBuZWVkbGUsCgkgICAgICB0aGlzLl9nZW5lcmF0ZWRNYXBwaW5ncywKCSAgICAgICJnZW5lcmF0ZWRMaW5lIiwKCSAgICAgICJnZW5lcmF0ZWRDb2x1bW4iLAoJICAgICAgdXRpbC5jb21wYXJlQnlHZW5lcmF0ZWRQb3NpdGlvbnNEZWZsYXRlZCwKCSAgICAgIHV0aWwuZ2V0QXJnKGFBcmdzLCAnYmlhcycsIFNvdXJjZU1hcENvbnN1bWVyLkdSRUFURVNUX0xPV0VSX0JPVU5EKQoJICAgICk7CgoJICAgIGlmIChpbmRleCA+PSAwKSB7CgkgICAgICB2YXIgbWFwcGluZyA9IHRoaXMuX2dlbmVyYXRlZE1hcHBpbmdzW2luZGV4XTsKCgkgICAgICBpZiAobWFwcGluZy5nZW5lcmF0ZWRMaW5lID09PSBuZWVkbGUuZ2VuZXJhdGVkTGluZSkgewoJICAgICAgICB2YXIgc291cmNlID0gdXRpbC5nZXRBcmcobWFwcGluZywgJ3NvdXJjZScsIG51bGwpOwoJICAgICAgICBpZiAoc291cmNlICE9PSBudWxsKSB7CgkgICAgICAgICAgc291cmNlID0gdGhpcy5fc291cmNlcy5hdChzb3VyY2UpOwoJICAgICAgICAgIHNvdXJjZSA9IHV0aWwuY29tcHV0ZVNvdXJjZVVSTCh0aGlzLnNvdXJjZVJvb3QsIHNvdXJjZSwgdGhpcy5fc291cmNlTWFwVVJMKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgbmFtZSA9IHV0aWwuZ2V0QXJnKG1hcHBpbmcsICduYW1lJywgbnVsbCk7CgkgICAgICAgIGlmIChuYW1lICE9PSBudWxsKSB7CgkgICAgICAgICAgbmFtZSA9IHRoaXMuX25hbWVzLmF0KG5hbWUpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB7CgkgICAgICAgICAgc291cmNlOiBzb3VyY2UsCgkgICAgICAgICAgbGluZTogdXRpbC5nZXRBcmcobWFwcGluZywgJ29yaWdpbmFsTGluZScsIG51bGwpLAoJICAgICAgICAgIGNvbHVtbjogdXRpbC5nZXRBcmcobWFwcGluZywgJ29yaWdpbmFsQ29sdW1uJywgbnVsbCksCgkgICAgICAgICAgbmFtZTogbmFtZQoJICAgICAgICB9OwoJICAgICAgfQoJICAgIH0KCgkgICAgcmV0dXJuIHsKCSAgICAgIHNvdXJjZTogbnVsbCwKCSAgICAgIGxpbmU6IG51bGwsCgkgICAgICBjb2x1bW46IG51bGwsCgkgICAgICBuYW1lOiBudWxsCgkgICAgfTsKCSAgfTsKCgkvKioKCSAqIFJldHVybiB0cnVlIGlmIHdlIGhhdmUgdGhlIHNvdXJjZSBjb250ZW50IGZvciBldmVyeSBzb3VyY2UgaW4gdGhlIHNvdXJjZQoJICogbWFwLCBmYWxzZSBvdGhlcndpc2UuCgkgKi8KCUJhc2ljU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLmhhc0NvbnRlbnRzT2ZBbGxTb3VyY2VzID0KCSAgZnVuY3Rpb24gQmFzaWNTb3VyY2VNYXBDb25zdW1lcl9oYXNDb250ZW50c09mQWxsU291cmNlcygpIHsKCSAgICBpZiAoIXRoaXMuc291cmNlc0NvbnRlbnQpIHsKCSAgICAgIHJldHVybiBmYWxzZTsKCSAgICB9CgkgICAgcmV0dXJuIHRoaXMuc291cmNlc0NvbnRlbnQubGVuZ3RoID49IHRoaXMuX3NvdXJjZXMuc2l6ZSgpICYmCgkgICAgICAhdGhpcy5zb3VyY2VzQ29udGVudC5zb21lKGZ1bmN0aW9uIChzYykgeyByZXR1cm4gc2MgPT0gbnVsbDsgfSk7CgkgIH07CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBvcmlnaW5hbCBzb3VyY2UgY29udGVudC4gVGhlIG9ubHkgYXJndW1lbnQgaXMgdGhlIHVybCBvZiB0aGUKCSAqIG9yaWdpbmFsIHNvdXJjZSBmaWxlLiBSZXR1cm5zIG51bGwgaWYgbm8gb3JpZ2luYWwgc291cmNlIGNvbnRlbnQgaXMKCSAqIGF2YWlsYWJsZS4KCSAqLwoJQmFzaWNTb3VyY2VNYXBDb25zdW1lci5wcm90b3R5cGUuc291cmNlQ29udGVudEZvciA9CgkgIGZ1bmN0aW9uIFNvdXJjZU1hcENvbnN1bWVyX3NvdXJjZUNvbnRlbnRGb3IoYVNvdXJjZSwgbnVsbE9uTWlzc2luZykgewoJICAgIGlmICghdGhpcy5zb3VyY2VzQ29udGVudCkgewoJICAgICAgcmV0dXJuIG51bGw7CgkgICAgfQoKCSAgICB2YXIgaW5kZXggPSB0aGlzLl9maW5kU291cmNlSW5kZXgoYVNvdXJjZSk7CgkgICAgaWYgKGluZGV4ID49IDApIHsKCSAgICAgIHJldHVybiB0aGlzLnNvdXJjZXNDb250ZW50W2luZGV4XTsKCSAgICB9CgoJICAgIHZhciByZWxhdGl2ZVNvdXJjZSA9IGFTb3VyY2U7CgkgICAgaWYgKHRoaXMuc291cmNlUm9vdCAhPSBudWxsKSB7CgkgICAgICByZWxhdGl2ZVNvdXJjZSA9IHV0aWwucmVsYXRpdmUodGhpcy5zb3VyY2VSb290LCByZWxhdGl2ZVNvdXJjZSk7CgkgICAgfQoKCSAgICB2YXIgdXJsOwoJICAgIGlmICh0aGlzLnNvdXJjZVJvb3QgIT0gbnVsbAoJICAgICAgICAmJiAodXJsID0gdXRpbC51cmxQYXJzZSh0aGlzLnNvdXJjZVJvb3QpKSkgewoJICAgICAgLy8gWFhYOiBmaWxlOi8vIFVSSXMgYW5kIGFic29sdXRlIHBhdGhzIGxlYWQgdG8gdW5leHBlY3RlZCBiZWhhdmlvciBmb3IKCSAgICAgIC8vIG1hbnkgdXNlcnMuIFdlIGNhbiBoZWxwIHRoZW0gb3V0IHdoZW4gdGhleSBleHBlY3QgZmlsZTovLyBVUklzIHRvCgkgICAgICAvLyBiZWhhdmUgbGlrZSBpdCB3b3VsZCBpZiB0aGV5IHdlcmUgcnVubmluZyBhIGxvY2FsIEhUVFAgc2VydmVyLiBTZWUKCSAgICAgIC8vIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTg4NTU5Ny4KCSAgICAgIHZhciBmaWxlVXJpQWJzUGF0aCA9IHJlbGF0aXZlU291cmNlLnJlcGxhY2UoL15maWxlOlwvXC8vLCAiIik7CgkgICAgICBpZiAodXJsLnNjaGVtZSA9PSAiZmlsZSIKCSAgICAgICAgICAmJiB0aGlzLl9zb3VyY2VzLmhhcyhmaWxlVXJpQWJzUGF0aCkpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlc0NvbnRlbnRbdGhpcy5fc291cmNlcy5pbmRleE9mKGZpbGVVcmlBYnNQYXRoKV0KCSAgICAgIH0KCgkgICAgICBpZiAoKCF1cmwucGF0aCB8fCB1cmwucGF0aCA9PSAiLyIpCgkgICAgICAgICAgJiYgdGhpcy5fc291cmNlcy5oYXMoIi8iICsgcmVsYXRpdmVTb3VyY2UpKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnNvdXJjZXNDb250ZW50W3RoaXMuX3NvdXJjZXMuaW5kZXhPZigiLyIgKyByZWxhdGl2ZVNvdXJjZSldOwoJICAgICAgfQoJICAgIH0KCgkgICAgLy8gVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHJlY3Vyc2l2ZWx5IGZyb20KCSAgICAvLyBJbmRleGVkU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLnNvdXJjZUNvbnRlbnRGb3IuIEluIHRoYXQgY2FzZSwgd2UKCSAgICAvLyBkb24ndCB3YW50IHRvIHRocm93IGlmIHdlIGNhbid0IGZpbmQgdGhlIHNvdXJjZSAtIHdlIGp1c3Qgd2FudCB0bwoJICAgIC8vIHJldHVybiBudWxsLCBzbyB3ZSBwcm92aWRlIGEgZmxhZyB0byBleGl0IGdyYWNlZnVsbHkuCgkgICAgaWYgKG51bGxPbk1pc3NpbmcpIHsKCSAgICAgIHJldHVybiBudWxsOwoJICAgIH0KCSAgICBlbHNlIHsKCSAgICAgIHRocm93IG5ldyBFcnJvcignIicgKyByZWxhdGl2ZVNvdXJjZSArICciIGlzIG5vdCBpbiB0aGUgU291cmNlTWFwLicpOwoJICAgIH0KCSAgfTsKCgkvKioKCSAqIFJldHVybnMgdGhlIGdlbmVyYXRlZCBsaW5lIGFuZCBjb2x1bW4gaW5mb3JtYXRpb24gZm9yIHRoZSBvcmlnaW5hbCBzb3VyY2UsCgkgKiBsaW5lLCBhbmQgY29sdW1uIHBvc2l0aW9ucyBwcm92aWRlZC4gVGhlIG9ubHkgYXJndW1lbnQgaXMgYW4gb2JqZWN0IHdpdGgKCSAqIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczoKCSAqCgkgKiAgIC0gc291cmNlOiBUaGUgZmlsZW5hbWUgb2YgdGhlIG9yaWdpbmFsIHNvdXJjZS4KCSAqICAgLSBsaW5lOiBUaGUgbGluZSBudW1iZXIgaW4gdGhlIG9yaWdpbmFsIHNvdXJjZS4gIFRoZSBsaW5lIG51bWJlcgoJICogICAgIGlzIDEtYmFzZWQuCgkgKiAgIC0gY29sdW1uOiBUaGUgY29sdW1uIG51bWJlciBpbiB0aGUgb3JpZ2luYWwgc291cmNlLiAgVGhlIGNvbHVtbgoJICogICAgIG51bWJlciBpcyAwLWJhc2VkLgoJICogICAtIGJpYXM6IEVpdGhlciAnU291cmNlTWFwQ29uc3VtZXIuR1JFQVRFU1RfTE9XRVJfQk9VTkQnIG9yCgkgKiAgICAgJ1NvdXJjZU1hcENvbnN1bWVyLkxFQVNUX1VQUEVSX0JPVU5EJy4gU3BlY2lmaWVzIHdoZXRoZXIgdG8gcmV0dXJuIHRoZQoJICogICAgIGNsb3Nlc3QgZWxlbWVudCB0aGF0IGlzIHNtYWxsZXIgdGhhbiBvciBncmVhdGVyIHRoYW4gdGhlIG9uZSB3ZSBhcmUKCSAqICAgICBzZWFyY2hpbmcgZm9yLCByZXNwZWN0aXZlbHksIGlmIHRoZSBleGFjdCBlbGVtZW50IGNhbm5vdCBiZSBmb3VuZC4KCSAqICAgICBEZWZhdWx0cyB0byAnU291cmNlTWFwQ29uc3VtZXIuR1JFQVRFU1RfTE9XRVJfQk9VTkQnLgoJICoKCSAqIGFuZCBhbiBvYmplY3QgaXMgcmV0dXJuZWQgd2l0aCB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6CgkgKgoJICogICAtIGxpbmU6IFRoZSBsaW5lIG51bWJlciBpbiB0aGUgZ2VuZXJhdGVkIHNvdXJjZSwgb3IgbnVsbC4gIFRoZQoJICogICAgIGxpbmUgbnVtYmVyIGlzIDEtYmFzZWQuCgkgKiAgIC0gY29sdW1uOiBUaGUgY29sdW1uIG51bWJlciBpbiB0aGUgZ2VuZXJhdGVkIHNvdXJjZSwgb3IgbnVsbC4KCSAqICAgICBUaGUgY29sdW1uIG51bWJlciBpcyAwLWJhc2VkLgoJICovCglCYXNpY1NvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZS5nZW5lcmF0ZWRQb3NpdGlvbkZvciA9CgkgIGZ1bmN0aW9uIFNvdXJjZU1hcENvbnN1bWVyX2dlbmVyYXRlZFBvc2l0aW9uRm9yKGFBcmdzKSB7CgkgICAgdmFyIHNvdXJjZSA9IHV0aWwuZ2V0QXJnKGFBcmdzLCAnc291cmNlJyk7CgkgICAgc291cmNlID0gdGhpcy5fZmluZFNvdXJjZUluZGV4KHNvdXJjZSk7CgkgICAgaWYgKHNvdXJjZSA8IDApIHsKCSAgICAgIHJldHVybiB7CgkgICAgICAgIGxpbmU6IG51bGwsCgkgICAgICAgIGNvbHVtbjogbnVsbCwKCSAgICAgICAgbGFzdENvbHVtbjogbnVsbAoJICAgICAgfTsKCSAgICB9CgoJICAgIHZhciBuZWVkbGUgPSB7CgkgICAgICBzb3VyY2U6IHNvdXJjZSwKCSAgICAgIG9yaWdpbmFsTGluZTogdXRpbC5nZXRBcmcoYUFyZ3MsICdsaW5lJyksCgkgICAgICBvcmlnaW5hbENvbHVtbjogdXRpbC5nZXRBcmcoYUFyZ3MsICdjb2x1bW4nKQoJICAgIH07CgoJICAgIHZhciBpbmRleCA9IHRoaXMuX2ZpbmRNYXBwaW5nKAoJICAgICAgbmVlZGxlLAoJICAgICAgdGhpcy5fb3JpZ2luYWxNYXBwaW5ncywKCSAgICAgICJvcmlnaW5hbExpbmUiLAoJICAgICAgIm9yaWdpbmFsQ29sdW1uIiwKCSAgICAgIHV0aWwuY29tcGFyZUJ5T3JpZ2luYWxQb3NpdGlvbnMsCgkgICAgICB1dGlsLmdldEFyZyhhQXJncywgJ2JpYXMnLCBTb3VyY2VNYXBDb25zdW1lci5HUkVBVEVTVF9MT1dFUl9CT1VORCkKCSAgICApOwoKCSAgICBpZiAoaW5kZXggPj0gMCkgewoJICAgICAgdmFyIG1hcHBpbmcgPSB0aGlzLl9vcmlnaW5hbE1hcHBpbmdzW2luZGV4XTsKCgkgICAgICBpZiAobWFwcGluZy5zb3VyY2UgPT09IG5lZWRsZS5zb3VyY2UpIHsKCSAgICAgICAgcmV0dXJuIHsKCSAgICAgICAgICBsaW5lOiB1dGlsLmdldEFyZyhtYXBwaW5nLCAnZ2VuZXJhdGVkTGluZScsIG51bGwpLAoJICAgICAgICAgIGNvbHVtbjogdXRpbC5nZXRBcmcobWFwcGluZywgJ2dlbmVyYXRlZENvbHVtbicsIG51bGwpLAoJICAgICAgICAgIGxhc3RDb2x1bW46IHV0aWwuZ2V0QXJnKG1hcHBpbmcsICdsYXN0R2VuZXJhdGVkQ29sdW1uJywgbnVsbCkKCSAgICAgICAgfTsKCSAgICAgIH0KCSAgICB9CgoJICAgIHJldHVybiB7CgkgICAgICBsaW5lOiBudWxsLAoJICAgICAgY29sdW1uOiBudWxsLAoJICAgICAgbGFzdENvbHVtbjogbnVsbAoJICAgIH07CgkgIH07CgoJc291cmNlTWFwQ29uc3VtZXIuQmFzaWNTb3VyY2VNYXBDb25zdW1lciA9IEJhc2ljU291cmNlTWFwQ29uc3VtZXI7CgoJLyoqCgkgKiBBbiBJbmRleGVkU291cmNlTWFwQ29uc3VtZXIgaW5zdGFuY2UgcmVwcmVzZW50cyBhIHBhcnNlZCBzb3VyY2UgbWFwIHdoaWNoCgkgKiB3ZSBjYW4gcXVlcnkgZm9yIGluZm9ybWF0aW9uLiBJdCBkaWZmZXJzIGZyb20gQmFzaWNTb3VyY2VNYXBDb25zdW1lciBpbgoJICogdGhhdCBpdCB0YWtlcyAiaW5kZXhlZCIgc291cmNlIG1hcHMgKGkuZS4gb25lcyB3aXRoIGEgInNlY3Rpb25zIiBmaWVsZCkgYXMKCSAqIGlucHV0LgoJICoKCSAqIFRoZSBmaXJzdCBwYXJhbWV0ZXIgaXMgYSByYXcgc291cmNlIG1hcCAoZWl0aGVyIGFzIGEgSlNPTiBzdHJpbmcsIG9yIGFscmVhZHkKCSAqIHBhcnNlZCB0byBhbiBvYmplY3QpLiBBY2NvcmRpbmcgdG8gdGhlIHNwZWMgZm9yIGluZGV4ZWQgc291cmNlIG1hcHMsIHRoZXkKCSAqIGhhdmUgdGhlIGZvbGxvd2luZyBhdHRyaWJ1dGVzOgoJICoKCSAqICAgLSB2ZXJzaW9uOiBXaGljaCB2ZXJzaW9uIG9mIHRoZSBzb3VyY2UgbWFwIHNwZWMgdGhpcyBtYXAgaXMgZm9sbG93aW5nLgoJICogICAtIGZpbGU6IE9wdGlvbmFsLiBUaGUgZ2VuZXJhdGVkIGZpbGUgdGhpcyBzb3VyY2UgbWFwIGlzIGFzc29jaWF0ZWQgd2l0aC4KCSAqICAgLSBzZWN0aW9uczogQSBsaXN0IG9mIHNlY3Rpb24gZGVmaW5pdGlvbnMuCgkgKgoJICogRWFjaCB2YWx1ZSB1bmRlciB0aGUgInNlY3Rpb25zIiBmaWVsZCBoYXMgdHdvIGZpZWxkczoKCSAqICAgLSBvZmZzZXQ6IFRoZSBvZmZzZXQgaW50byB0aGUgb3JpZ2luYWwgc3BlY2lmaWVkIGF0IHdoaWNoIHRoaXMgc2VjdGlvbgoJICogICAgICAgYmVnaW5zIHRvIGFwcGx5LCBkZWZpbmVkIGFzIGFuIG9iamVjdCB3aXRoIGEgImxpbmUiIGFuZCAiY29sdW1uIgoJICogICAgICAgZmllbGQuCgkgKiAgIC0gbWFwOiBBIHNvdXJjZSBtYXAgZGVmaW5pdGlvbi4gVGhpcyBzb3VyY2UgbWFwIGNvdWxkIGFsc28gYmUgaW5kZXhlZCwKCSAqICAgICAgIGJ1dCBkb2Vzbid0IGhhdmUgdG8gYmUuCgkgKgoJICogSW5zdGVhZCBvZiB0aGUgIm1hcCIgZmllbGQsIGl0J3MgYWxzbyBwb3NzaWJsZSB0byBoYXZlIGEgInVybCIgZmllbGQKCSAqIHNwZWNpZnlpbmcgYSBVUkwgdG8gcmV0cmlldmUgYSBzb3VyY2UgbWFwIGZyb20sIGJ1dCB0aGF0J3MgY3VycmVudGx5CgkgKiB1bnN1cHBvcnRlZC4KCSAqCgkgKiBIZXJlJ3MgYW4gZXhhbXBsZSBzb3VyY2UgbWFwLCB0YWtlbiBmcm9tIHRoZSBzb3VyY2UgbWFwIHNwZWNbMF0sIGJ1dAoJICogbW9kaWZpZWQgdG8gb21pdCBhIHNlY3Rpb24gd2hpY2ggdXNlcyB0aGUgInVybCIgZmllbGQuCgkgKgoJICogIHsKCSAqICAgIHZlcnNpb24gOiAzLAoJICogICAgZmlsZTogImFwcC5qcyIsCgkgKiAgICBzZWN0aW9uczogW3sKCSAqICAgICAgb2Zmc2V0OiB7bGluZToxMDAsIGNvbHVtbjoxMH0sCgkgKiAgICAgIG1hcDogewoJICogICAgICAgIHZlcnNpb24gOiAzLAoJICogICAgICAgIGZpbGU6ICJzZWN0aW9uLmpzIiwKCSAqICAgICAgICBzb3VyY2VzOiBbImZvby5qcyIsICJiYXIuanMiXSwKCSAqICAgICAgICBuYW1lczogWyJzcmMiLCAibWFwcyIsICJhcmUiLCAiZnVuIl0sCgkgKiAgICAgICAgbWFwcGluZ3M6ICJBQUFBLEU7O0FCQ0RFOyIKCSAqICAgICAgfQoJICogICAgfV0sCgkgKiAgfQoJICoKCSAqIFRoZSBzZWNvbmQgcGFyYW1ldGVyLCBpZiBnaXZlbiwgaXMgYSBzdHJpbmcgd2hvc2UgdmFsdWUgaXMgdGhlIFVSTAoJICogYXQgd2hpY2ggdGhlIHNvdXJjZSBtYXAgd2FzIGZvdW5kLiAgVGhpcyBVUkwgaXMgdXNlZCB0byBjb21wdXRlIHRoZQoJICogc291cmNlcyBhcnJheS4KCSAqCgkgKiBbMF06IGh0dHBzOi8vZG9jcy5nb29nbGUuY29tL2RvY3VtZW50L2QvMVUxUkdBZWhRd1J5cFVUb3ZGMUtSbHBpT0Z6ZTBiLV8yZ2M2ZkFIMEtZMGsvZWRpdCNoZWFkaW5nPWguNTM1ZXMzeGVwcmd0CgkgKi8KCWZ1bmN0aW9uIEluZGV4ZWRTb3VyY2VNYXBDb25zdW1lcihhU291cmNlTWFwLCBhU291cmNlTWFwVVJMKSB7CgkgIHZhciBzb3VyY2VNYXAgPSBhU291cmNlTWFwOwoJICBpZiAodHlwZW9mIGFTb3VyY2VNYXAgPT09ICdzdHJpbmcnKSB7CgkgICAgc291cmNlTWFwID0gdXRpbC5wYXJzZVNvdXJjZU1hcElucHV0KGFTb3VyY2VNYXApOwoJICB9CgoJICB2YXIgdmVyc2lvbiA9IHV0aWwuZ2V0QXJnKHNvdXJjZU1hcCwgJ3ZlcnNpb24nKTsKCSAgdmFyIHNlY3Rpb25zID0gdXRpbC5nZXRBcmcoc291cmNlTWFwLCAnc2VjdGlvbnMnKTsKCgkgIGlmICh2ZXJzaW9uICE9IHRoaXMuX3ZlcnNpb24pIHsKCSAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vuc3VwcG9ydGVkIHZlcnNpb246ICcgKyB2ZXJzaW9uKTsKCSAgfQoKCSAgdGhpcy5fc291cmNlcyA9IG5ldyBBcnJheVNldCgpOwoJICB0aGlzLl9uYW1lcyA9IG5ldyBBcnJheVNldCgpOwoKCSAgdmFyIGxhc3RPZmZzZXQgPSB7CgkgICAgbGluZTogLTEsCgkgICAgY29sdW1uOiAwCgkgIH07CgkgIHRoaXMuX3NlY3Rpb25zID0gc2VjdGlvbnMubWFwKGZ1bmN0aW9uIChzKSB7CgkgICAgaWYgKHMudXJsKSB7CgkgICAgICAvLyBUaGUgdXJsIGZpZWxkIHdpbGwgcmVxdWlyZSBzdXBwb3J0IGZvciBhc3luY2hyb25pY2l0eS4KCSAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vbW96aWxsYS9zb3VyY2UtbWFwL2lzc3Vlcy8xNgoJICAgICAgdGhyb3cgbmV3IEVycm9yKCdTdXBwb3J0IGZvciB1cmwgZmllbGQgaW4gc2VjdGlvbnMgbm90IGltcGxlbWVudGVkLicpOwoJICAgIH0KCSAgICB2YXIgb2Zmc2V0ID0gdXRpbC5nZXRBcmcocywgJ29mZnNldCcpOwoJICAgIHZhciBvZmZzZXRMaW5lID0gdXRpbC5nZXRBcmcob2Zmc2V0LCAnbGluZScpOwoJICAgIHZhciBvZmZzZXRDb2x1bW4gPSB1dGlsLmdldEFyZyhvZmZzZXQsICdjb2x1bW4nKTsKCgkgICAgaWYgKG9mZnNldExpbmUgPCBsYXN0T2Zmc2V0LmxpbmUgfHwKCSAgICAgICAgKG9mZnNldExpbmUgPT09IGxhc3RPZmZzZXQubGluZSAmJiBvZmZzZXRDb2x1bW4gPCBsYXN0T2Zmc2V0LmNvbHVtbikpIHsKCSAgICAgIHRocm93IG5ldyBFcnJvcignU2VjdGlvbiBvZmZzZXRzIG11c3QgYmUgb3JkZXJlZCBhbmQgbm9uLW92ZXJsYXBwaW5nLicpOwoJICAgIH0KCSAgICBsYXN0T2Zmc2V0ID0gb2Zmc2V0OwoKCSAgICByZXR1cm4gewoJICAgICAgZ2VuZXJhdGVkT2Zmc2V0OiB7CgkgICAgICAgIC8vIFRoZSBvZmZzZXQgZmllbGRzIGFyZSAwLWJhc2VkLCBidXQgd2UgdXNlIDEtYmFzZWQgaW5kaWNlcyB3aGVuCgkgICAgICAgIC8vIGVuY29kaW5nL2RlY29kaW5nIGZyb20gVkxRLgoJICAgICAgICBnZW5lcmF0ZWRMaW5lOiBvZmZzZXRMaW5lICsgMSwKCSAgICAgICAgZ2VuZXJhdGVkQ29sdW1uOiBvZmZzZXRDb2x1bW4gKyAxCgkgICAgICB9LAoJICAgICAgY29uc3VtZXI6IG5ldyBTb3VyY2VNYXBDb25zdW1lcih1dGlsLmdldEFyZyhzLCAnbWFwJyksIGFTb3VyY2VNYXBVUkwpCgkgICAgfQoJICB9KTsKCX0KCglJbmRleGVkU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTb3VyY2VNYXBDb25zdW1lci5wcm90b3R5cGUpOwoJSW5kZXhlZFNvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFNvdXJjZU1hcENvbnN1bWVyOwoKCS8qKgoJICogVGhlIHZlcnNpb24gb2YgdGhlIHNvdXJjZSBtYXBwaW5nIHNwZWMgdGhhdCB3ZSBhcmUgY29uc3VtaW5nLgoJICovCglJbmRleGVkU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLl92ZXJzaW9uID0gMzsKCgkvKioKCSAqIFRoZSBsaXN0IG9mIG9yaWdpbmFsIHNvdXJjZXMuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbmRleGVkU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLCAnc291cmNlcycsIHsKCSAgZ2V0OiBmdW5jdGlvbiAoKSB7CgkgICAgdmFyIHNvdXJjZXMgPSBbXTsKCSAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX3NlY3Rpb25zLmxlbmd0aDsgaSsrKSB7CgkgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMuX3NlY3Rpb25zW2ldLmNvbnN1bWVyLnNvdXJjZXMubGVuZ3RoOyBqKyspIHsKCSAgICAgICAgc291cmNlcy5wdXNoKHRoaXMuX3NlY3Rpb25zW2ldLmNvbnN1bWVyLnNvdXJjZXNbal0pOwoJICAgICAgfQoJICAgIH0KCSAgICByZXR1cm4gc291cmNlczsKCSAgfQoJfSk7CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBvcmlnaW5hbCBzb3VyY2UsIGxpbmUsIGFuZCBjb2x1bW4gaW5mb3JtYXRpb24gZm9yIHRoZSBnZW5lcmF0ZWQKCSAqIHNvdXJjZSdzIGxpbmUgYW5kIGNvbHVtbiBwb3NpdGlvbnMgcHJvdmlkZWQuIFRoZSBvbmx5IGFyZ3VtZW50IGlzIGFuIG9iamVjdAoJICogd2l0aCB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6CgkgKgoJICogICAtIGxpbmU6IFRoZSBsaW5lIG51bWJlciBpbiB0aGUgZ2VuZXJhdGVkIHNvdXJjZS4gIFRoZSBsaW5lIG51bWJlcgoJICogICAgIGlzIDEtYmFzZWQuCgkgKiAgIC0gY29sdW1uOiBUaGUgY29sdW1uIG51bWJlciBpbiB0aGUgZ2VuZXJhdGVkIHNvdXJjZS4gIFRoZSBjb2x1bW4KCSAqICAgICBudW1iZXIgaXMgMC1iYXNlZC4KCSAqCgkgKiBhbmQgYW4gb2JqZWN0IGlzIHJldHVybmVkIHdpdGggdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgoJICoKCSAqICAgLSBzb3VyY2U6IFRoZSBvcmlnaW5hbCBzb3VyY2UgZmlsZSwgb3IgbnVsbC4KCSAqICAgLSBsaW5lOiBUaGUgbGluZSBudW1iZXIgaW4gdGhlIG9yaWdpbmFsIHNvdXJjZSwgb3IgbnVsbC4gIFRoZQoJICogICAgIGxpbmUgbnVtYmVyIGlzIDEtYmFzZWQuCgkgKiAgIC0gY29sdW1uOiBUaGUgY29sdW1uIG51bWJlciBpbiB0aGUgb3JpZ2luYWwgc291cmNlLCBvciBudWxsLiAgVGhlCgkgKiAgICAgY29sdW1uIG51bWJlciBpcyAwLWJhc2VkLgoJICogICAtIG5hbWU6IFRoZSBvcmlnaW5hbCBpZGVudGlmaWVyLCBvciBudWxsLgoJICovCglJbmRleGVkU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLm9yaWdpbmFsUG9zaXRpb25Gb3IgPQoJICBmdW5jdGlvbiBJbmRleGVkU291cmNlTWFwQ29uc3VtZXJfb3JpZ2luYWxQb3NpdGlvbkZvcihhQXJncykgewoJICAgIHZhciBuZWVkbGUgPSB7CgkgICAgICBnZW5lcmF0ZWRMaW5lOiB1dGlsLmdldEFyZyhhQXJncywgJ2xpbmUnKSwKCSAgICAgIGdlbmVyYXRlZENvbHVtbjogdXRpbC5nZXRBcmcoYUFyZ3MsICdjb2x1bW4nKQoJICAgIH07CgoJICAgIC8vIEZpbmQgdGhlIHNlY3Rpb24gY29udGFpbmluZyB0aGUgZ2VuZXJhdGVkIHBvc2l0aW9uIHdlJ3JlIHRyeWluZyB0byBtYXAKCSAgICAvLyB0byBhbiBvcmlnaW5hbCBwb3NpdGlvbi4KCSAgICB2YXIgc2VjdGlvbkluZGV4ID0gYmluYXJ5U2VhcmNoLnNlYXJjaChuZWVkbGUsIHRoaXMuX3NlY3Rpb25zLAoJICAgICAgZnVuY3Rpb24obmVlZGxlLCBzZWN0aW9uKSB7CgkgICAgICAgIHZhciBjbXAgPSBuZWVkbGUuZ2VuZXJhdGVkTGluZSAtIHNlY3Rpb24uZ2VuZXJhdGVkT2Zmc2V0LmdlbmVyYXRlZExpbmU7CgkgICAgICAgIGlmIChjbXApIHsKCSAgICAgICAgICByZXR1cm4gY21wOwoJICAgICAgICB9CgoJICAgICAgICByZXR1cm4gKG5lZWRsZS5nZW5lcmF0ZWRDb2x1bW4gLQoJICAgICAgICAgICAgICAgIHNlY3Rpb24uZ2VuZXJhdGVkT2Zmc2V0LmdlbmVyYXRlZENvbHVtbik7CgkgICAgICB9KTsKCSAgICB2YXIgc2VjdGlvbiA9IHRoaXMuX3NlY3Rpb25zW3NlY3Rpb25JbmRleF07CgoJICAgIGlmICghc2VjdGlvbikgewoJICAgICAgcmV0dXJuIHsKCSAgICAgICAgc291cmNlOiBudWxsLAoJICAgICAgICBsaW5lOiBudWxsLAoJICAgICAgICBjb2x1bW46IG51bGwsCgkgICAgICAgIG5hbWU6IG51bGwKCSAgICAgIH07CgkgICAgfQoKCSAgICByZXR1cm4gc2VjdGlvbi5jb25zdW1lci5vcmlnaW5hbFBvc2l0aW9uRm9yKHsKCSAgICAgIGxpbmU6IG5lZWRsZS5nZW5lcmF0ZWRMaW5lIC0KCSAgICAgICAgKHNlY3Rpb24uZ2VuZXJhdGVkT2Zmc2V0LmdlbmVyYXRlZExpbmUgLSAxKSwKCSAgICAgIGNvbHVtbjogbmVlZGxlLmdlbmVyYXRlZENvbHVtbiAtCgkgICAgICAgIChzZWN0aW9uLmdlbmVyYXRlZE9mZnNldC5nZW5lcmF0ZWRMaW5lID09PSBuZWVkbGUuZ2VuZXJhdGVkTGluZQoJICAgICAgICAgPyBzZWN0aW9uLmdlbmVyYXRlZE9mZnNldC5nZW5lcmF0ZWRDb2x1bW4gLSAxCgkgICAgICAgICA6IDApLAoJICAgICAgYmlhczogYUFyZ3MuYmlhcwoJICAgIH0pOwoJICB9OwoKCS8qKgoJICogUmV0dXJuIHRydWUgaWYgd2UgaGF2ZSB0aGUgc291cmNlIGNvbnRlbnQgZm9yIGV2ZXJ5IHNvdXJjZSBpbiB0aGUgc291cmNlCgkgKiBtYXAsIGZhbHNlIG90aGVyd2lzZS4KCSAqLwoJSW5kZXhlZFNvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZS5oYXNDb250ZW50c09mQWxsU291cmNlcyA9CgkgIGZ1bmN0aW9uIEluZGV4ZWRTb3VyY2VNYXBDb25zdW1lcl9oYXNDb250ZW50c09mQWxsU291cmNlcygpIHsKCSAgICByZXR1cm4gdGhpcy5fc2VjdGlvbnMuZXZlcnkoZnVuY3Rpb24gKHMpIHsKCSAgICAgIHJldHVybiBzLmNvbnN1bWVyLmhhc0NvbnRlbnRzT2ZBbGxTb3VyY2VzKCk7CgkgICAgfSk7CgkgIH07CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBvcmlnaW5hbCBzb3VyY2UgY29udGVudC4gVGhlIG9ubHkgYXJndW1lbnQgaXMgdGhlIHVybCBvZiB0aGUKCSAqIG9yaWdpbmFsIHNvdXJjZSBmaWxlLiBSZXR1cm5zIG51bGwgaWYgbm8gb3JpZ2luYWwgc291cmNlIGNvbnRlbnQgaXMKCSAqIGF2YWlsYWJsZS4KCSAqLwoJSW5kZXhlZFNvdXJjZU1hcENvbnN1bWVyLnByb3RvdHlwZS5zb3VyY2VDb250ZW50Rm9yID0KCSAgZnVuY3Rpb24gSW5kZXhlZFNvdXJjZU1hcENvbnN1bWVyX3NvdXJjZUNvbnRlbnRGb3IoYVNvdXJjZSwgbnVsbE9uTWlzc2luZykgewoJICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5fc2VjdGlvbnMubGVuZ3RoOyBpKyspIHsKCSAgICAgIHZhciBzZWN0aW9uID0gdGhpcy5fc2VjdGlvbnNbaV07CgoJICAgICAgdmFyIGNvbnRlbnQgPSBzZWN0aW9uLmNvbnN1bWVyLnNvdXJjZUNvbnRlbnRGb3IoYVNvdXJjZSwgdHJ1ZSk7CgkgICAgICBpZiAoY29udGVudCkgewoJICAgICAgICByZXR1cm4gY29udGVudDsKCSAgICAgIH0KCSAgICB9CgkgICAgaWYgKG51bGxPbk1pc3NpbmcpIHsKCSAgICAgIHJldHVybiBudWxsOwoJICAgIH0KCSAgICBlbHNlIHsKCSAgICAgIHRocm93IG5ldyBFcnJvcignIicgKyBhU291cmNlICsgJyIgaXMgbm90IGluIHRoZSBTb3VyY2VNYXAuJyk7CgkgICAgfQoJICB9OwoKCS8qKgoJICogUmV0dXJucyB0aGUgZ2VuZXJhdGVkIGxpbmUgYW5kIGNvbHVtbiBpbmZvcm1hdGlvbiBmb3IgdGhlIG9yaWdpbmFsIHNvdXJjZSwKCSAqIGxpbmUsIGFuZCBjb2x1bW4gcG9zaXRpb25zIHByb3ZpZGVkLiBUaGUgb25seSBhcmd1bWVudCBpcyBhbiBvYmplY3Qgd2l0aAoJICogdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgoJICoKCSAqICAgLSBzb3VyY2U6IFRoZSBmaWxlbmFtZSBvZiB0aGUgb3JpZ2luYWwgc291cmNlLgoJICogICAtIGxpbmU6IFRoZSBsaW5lIG51bWJlciBpbiB0aGUgb3JpZ2luYWwgc291cmNlLiAgVGhlIGxpbmUgbnVtYmVyCgkgKiAgICAgaXMgMS1iYXNlZC4KCSAqICAgLSBjb2x1bW46IFRoZSBjb2x1bW4gbnVtYmVyIGluIHRoZSBvcmlnaW5hbCBzb3VyY2UuICBUaGUgY29sdW1uCgkgKiAgICAgbnVtYmVyIGlzIDAtYmFzZWQuCgkgKgoJICogYW5kIGFuIG9iamVjdCBpcyByZXR1cm5lZCB3aXRoIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczoKCSAqCgkgKiAgIC0gbGluZTogVGhlIGxpbmUgbnVtYmVyIGluIHRoZSBnZW5lcmF0ZWQgc291cmNlLCBvciBudWxsLiAgVGhlCgkgKiAgICAgbGluZSBudW1iZXIgaXMgMS1iYXNlZC4gCgkgKiAgIC0gY29sdW1uOiBUaGUgY29sdW1uIG51bWJlciBpbiB0aGUgZ2VuZXJhdGVkIHNvdXJjZSwgb3IgbnVsbC4KCSAqICAgICBUaGUgY29sdW1uIG51bWJlciBpcyAwLWJhc2VkLgoJICovCglJbmRleGVkU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLmdlbmVyYXRlZFBvc2l0aW9uRm9yID0KCSAgZnVuY3Rpb24gSW5kZXhlZFNvdXJjZU1hcENvbnN1bWVyX2dlbmVyYXRlZFBvc2l0aW9uRm9yKGFBcmdzKSB7CgkgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLl9zZWN0aW9ucy5sZW5ndGg7IGkrKykgewoJICAgICAgdmFyIHNlY3Rpb24gPSB0aGlzLl9zZWN0aW9uc1tpXTsKCgkgICAgICAvLyBPbmx5IGNvbnNpZGVyIHRoaXMgc2VjdGlvbiBpZiB0aGUgcmVxdWVzdGVkIHNvdXJjZSBpcyBpbiB0aGUgbGlzdCBvZgoJICAgICAgLy8gc291cmNlcyBvZiB0aGUgY29uc3VtZXIuCgkgICAgICBpZiAoc2VjdGlvbi5jb25zdW1lci5fZmluZFNvdXJjZUluZGV4KHV0aWwuZ2V0QXJnKGFBcmdzLCAnc291cmNlJykpID09PSAtMSkgewoJICAgICAgICBjb250aW51ZTsKCSAgICAgIH0KCSAgICAgIHZhciBnZW5lcmF0ZWRQb3NpdGlvbiA9IHNlY3Rpb24uY29uc3VtZXIuZ2VuZXJhdGVkUG9zaXRpb25Gb3IoYUFyZ3MpOwoJICAgICAgaWYgKGdlbmVyYXRlZFBvc2l0aW9uKSB7CgkgICAgICAgIHZhciByZXQgPSB7CgkgICAgICAgICAgbGluZTogZ2VuZXJhdGVkUG9zaXRpb24ubGluZSArCgkgICAgICAgICAgICAoc2VjdGlvbi5nZW5lcmF0ZWRPZmZzZXQuZ2VuZXJhdGVkTGluZSAtIDEpLAoJICAgICAgICAgIGNvbHVtbjogZ2VuZXJhdGVkUG9zaXRpb24uY29sdW1uICsKCSAgICAgICAgICAgIChzZWN0aW9uLmdlbmVyYXRlZE9mZnNldC5nZW5lcmF0ZWRMaW5lID09PSBnZW5lcmF0ZWRQb3NpdGlvbi5saW5lCgkgICAgICAgICAgICAgPyBzZWN0aW9uLmdlbmVyYXRlZE9mZnNldC5nZW5lcmF0ZWRDb2x1bW4gLSAxCgkgICAgICAgICAgICAgOiAwKQoJICAgICAgICB9OwoJICAgICAgICByZXR1cm4gcmV0OwoJICAgICAgfQoJICAgIH0KCgkgICAgcmV0dXJuIHsKCSAgICAgIGxpbmU6IG51bGwsCgkgICAgICBjb2x1bW46IG51bGwKCSAgICB9OwoJICB9OwoKCS8qKgoJICogUGFyc2UgdGhlIG1hcHBpbmdzIGluIGEgc3RyaW5nIGluIHRvIGEgZGF0YSBzdHJ1Y3R1cmUgd2hpY2ggd2UgY2FuIGVhc2lseQoJICogcXVlcnkgKHRoZSBvcmRlcmVkIGFycmF5cyBpbiB0aGUgYHRoaXMuX19nZW5lcmF0ZWRNYXBwaW5nc2AgYW5kCgkgKiBgdGhpcy5fX29yaWdpbmFsTWFwcGluZ3NgIHByb3BlcnRpZXMpLgoJICovCglJbmRleGVkU291cmNlTWFwQ29uc3VtZXIucHJvdG90eXBlLl9wYXJzZU1hcHBpbmdzID0KCSAgZnVuY3Rpb24gSW5kZXhlZFNvdXJjZU1hcENvbnN1bWVyX3BhcnNlTWFwcGluZ3MoYVN0ciwgYVNvdXJjZVJvb3QpIHsKCSAgICB0aGlzLl9fZ2VuZXJhdGVkTWFwcGluZ3MgPSBbXTsKCSAgICB0aGlzLl9fb3JpZ2luYWxNYXBwaW5ncyA9IFtdOwoJICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5fc2VjdGlvbnMubGVuZ3RoOyBpKyspIHsKCSAgICAgIHZhciBzZWN0aW9uID0gdGhpcy5fc2VjdGlvbnNbaV07CgkgICAgICB2YXIgc2VjdGlvbk1hcHBpbmdzID0gc2VjdGlvbi5jb25zdW1lci5fZ2VuZXJhdGVkTWFwcGluZ3M7CgkgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlY3Rpb25NYXBwaW5ncy5sZW5ndGg7IGorKykgewoJICAgICAgICB2YXIgbWFwcGluZyA9IHNlY3Rpb25NYXBwaW5nc1tqXTsKCgkgICAgICAgIHZhciBzb3VyY2UgPSBzZWN0aW9uLmNvbnN1bWVyLl9zb3VyY2VzLmF0KG1hcHBpbmcuc291cmNlKTsKCSAgICAgICAgc291cmNlID0gdXRpbC5jb21wdXRlU291cmNlVVJMKHNlY3Rpb24uY29uc3VtZXIuc291cmNlUm9vdCwgc291cmNlLCB0aGlzLl9zb3VyY2VNYXBVUkwpOwoJICAgICAgICB0aGlzLl9zb3VyY2VzLmFkZChzb3VyY2UpOwoJICAgICAgICBzb3VyY2UgPSB0aGlzLl9zb3VyY2VzLmluZGV4T2Yoc291cmNlKTsKCgkgICAgICAgIHZhciBuYW1lID0gbnVsbDsKCSAgICAgICAgaWYgKG1hcHBpbmcubmFtZSkgewoJICAgICAgICAgIG5hbWUgPSBzZWN0aW9uLmNvbnN1bWVyLl9uYW1lcy5hdChtYXBwaW5nLm5hbWUpOwoJICAgICAgICAgIHRoaXMuX25hbWVzLmFkZChuYW1lKTsKCSAgICAgICAgICBuYW1lID0gdGhpcy5fbmFtZXMuaW5kZXhPZihuYW1lKTsKCSAgICAgICAgfQoKCSAgICAgICAgLy8gVGhlIG1hcHBpbmdzIGNvbWluZyBmcm9tIHRoZSBjb25zdW1lciBmb3IgdGhlIHNlY3Rpb24gaGF2ZQoJICAgICAgICAvLyBnZW5lcmF0ZWQgcG9zaXRpb25zIHJlbGF0aXZlIHRvIHRoZSBzdGFydCBvZiB0aGUgc2VjdGlvbiwgc28gd2UKCSAgICAgICAgLy8gbmVlZCB0byBvZmZzZXQgdGhlbSB0byBiZSByZWxhdGl2ZSB0byB0aGUgc3RhcnQgb2YgdGhlIGNvbmNhdGVuYXRlZAoJICAgICAgICAvLyBnZW5lcmF0ZWQgZmlsZS4KCSAgICAgICAgdmFyIGFkanVzdGVkTWFwcGluZyA9IHsKCSAgICAgICAgICBzb3VyY2U6IHNvdXJjZSwKCSAgICAgICAgICBnZW5lcmF0ZWRMaW5lOiBtYXBwaW5nLmdlbmVyYXRlZExpbmUgKwoJICAgICAgICAgICAgKHNlY3Rpb24uZ2VuZXJhdGVkT2Zmc2V0LmdlbmVyYXRlZExpbmUgLSAxKSwKCSAgICAgICAgICBnZW5lcmF0ZWRDb2x1bW46IG1hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uICsKCSAgICAgICAgICAgIChzZWN0aW9uLmdlbmVyYXRlZE9mZnNldC5nZW5lcmF0ZWRMaW5lID09PSBtYXBwaW5nLmdlbmVyYXRlZExpbmUKCSAgICAgICAgICAgID8gc2VjdGlvbi5nZW5lcmF0ZWRPZmZzZXQuZ2VuZXJhdGVkQ29sdW1uIC0gMQoJICAgICAgICAgICAgOiAwKSwKCSAgICAgICAgICBvcmlnaW5hbExpbmU6IG1hcHBpbmcub3JpZ2luYWxMaW5lLAoJICAgICAgICAgIG9yaWdpbmFsQ29sdW1uOiBtYXBwaW5nLm9yaWdpbmFsQ29sdW1uLAoJICAgICAgICAgIG5hbWU6IG5hbWUKCSAgICAgICAgfTsKCgkgICAgICAgIHRoaXMuX19nZW5lcmF0ZWRNYXBwaW5ncy5wdXNoKGFkanVzdGVkTWFwcGluZyk7CgkgICAgICAgIGlmICh0eXBlb2YgYWRqdXN0ZWRNYXBwaW5nLm9yaWdpbmFsTGluZSA9PT0gJ251bWJlcicpIHsKCSAgICAgICAgICB0aGlzLl9fb3JpZ2luYWxNYXBwaW5ncy5wdXNoKGFkanVzdGVkTWFwcGluZyk7CgkgICAgICAgIH0KCSAgICAgIH0KCSAgICB9CgoJICAgIHF1aWNrU29ydCh0aGlzLl9fZ2VuZXJhdGVkTWFwcGluZ3MsIHV0aWwuY29tcGFyZUJ5R2VuZXJhdGVkUG9zaXRpb25zRGVmbGF0ZWQpOwoJICAgIHF1aWNrU29ydCh0aGlzLl9fb3JpZ2luYWxNYXBwaW5ncywgdXRpbC5jb21wYXJlQnlPcmlnaW5hbFBvc2l0aW9ucyk7CgkgIH07CgoJc291cmNlTWFwQ29uc3VtZXIuSW5kZXhlZFNvdXJjZU1hcENvbnN1bWVyID0gSW5kZXhlZFNvdXJjZU1hcENvbnN1bWVyOwoJcmV0dXJuIHNvdXJjZU1hcENvbnN1bWVyOwp9Cgp2YXIgc291cmNlTm9kZSA9IHt9OwoKLyogLSotIE1vZGU6IGpzOyBqcy1pbmRlbnQtbGV2ZWw6IDI7IC0qLSAqLwoKdmFyIGhhc1JlcXVpcmVkU291cmNlTm9kZTsKCmZ1bmN0aW9uIHJlcXVpcmVTb3VyY2VOb2RlICgpIHsKCWlmIChoYXNSZXF1aXJlZFNvdXJjZU5vZGUpIHJldHVybiBzb3VyY2VOb2RlOwoJaGFzUmVxdWlyZWRTb3VyY2VOb2RlID0gMTsKCS8qCgkgKiBDb3B5cmlnaHQgMjAxMSBNb3ppbGxhIEZvdW5kYXRpb24gYW5kIGNvbnRyaWJ1dG9ycwoJICogTGljZW5zZWQgdW5kZXIgdGhlIE5ldyBCU0QgbGljZW5zZS4gU2VlIExJQ0VOU0Ugb3I6CgkgKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvQlNELTMtQ2xhdXNlCgkgKi8KCgl2YXIgU291cmNlTWFwR2VuZXJhdG9yID0gcmVxdWlyZVNvdXJjZU1hcEdlbmVyYXRvcigpLlNvdXJjZU1hcEdlbmVyYXRvcjsKCXZhciB1dGlsID0gcmVxdWlyZVV0aWwoKTsKCgkvLyBNYXRjaGVzIGEgV2luZG93cy1zdHlsZSBgXHJcbmAgbmV3bGluZSBvciBhIGBcbmAgbmV3bGluZSB1c2VkIGJ5IGFsbCBvdGhlcgoJLy8gb3BlcmF0aW5nIHN5c3RlbXMgdGhlc2UgZGF5cyAoY2FwdHVyaW5nIHRoZSByZXN1bHQpLgoJdmFyIFJFR0VYX05FV0xJTkUgPSAvKFxyP1xuKS87CgoJLy8gTmV3bGluZSBjaGFyYWN0ZXIgY29kZSBmb3IgY2hhckNvZGVBdCgpIGNvbXBhcmlzb25zCgl2YXIgTkVXTElORV9DT0RFID0gMTA7CgoJLy8gUHJpdmF0ZSBzeW1ib2wgZm9yIGlkZW50aWZ5aW5nIGBTb3VyY2VOb2RlYHMgd2hlbiBtdWx0aXBsZSB2ZXJzaW9ucyBvZgoJLy8gdGhlIHNvdXJjZS1tYXAgbGlicmFyeSBhcmUgbG9hZGVkLiBUaGlzIE1VU1QgTk9UIENIQU5HRSBhY3Jvc3MKCS8vIHZlcnNpb25zIQoJdmFyIGlzU291cmNlTm9kZSA9ICIkJCRpc1NvdXJjZU5vZGUkJCQiOwoKCS8qKgoJICogU291cmNlTm9kZXMgcHJvdmlkZSBhIHdheSB0byBhYnN0cmFjdCBvdmVyIGludGVycG9sYXRpbmcvY29uY2F0ZW5hdGluZwoJICogc25pcHBldHMgb2YgZ2VuZXJhdGVkIEphdmFTY3JpcHQgc291cmNlIGNvZGUgd2hpbGUgbWFpbnRhaW5pbmcgdGhlIGxpbmUgYW5kCgkgKiBjb2x1bW4gaW5mb3JtYXRpb24gYXNzb2NpYXRlZCB3aXRoIHRoZSBvcmlnaW5hbCBzb3VyY2UgY29kZS4KCSAqCgkgKiBAcGFyYW0gYUxpbmUgVGhlIG9yaWdpbmFsIGxpbmUgbnVtYmVyLgoJICogQHBhcmFtIGFDb2x1bW4gVGhlIG9yaWdpbmFsIGNvbHVtbiBudW1iZXIuCgkgKiBAcGFyYW0gYVNvdXJjZSBUaGUgb3JpZ2luYWwgc291cmNlJ3MgZmlsZW5hbWUuCgkgKiBAcGFyYW0gYUNodW5rcyBPcHRpb25hbC4gQW4gYXJyYXkgb2Ygc3RyaW5ncyB3aGljaCBhcmUgc25pcHBldHMgb2YKCSAqICAgICAgICBnZW5lcmF0ZWQgSlMsIG9yIG90aGVyIFNvdXJjZU5vZGVzLgoJICogQHBhcmFtIGFOYW1lIFRoZSBvcmlnaW5hbCBpZGVudGlmaWVyLgoJICovCglmdW5jdGlvbiBTb3VyY2VOb2RlKGFMaW5lLCBhQ29sdW1uLCBhU291cmNlLCBhQ2h1bmtzLCBhTmFtZSkgewoJICB0aGlzLmNoaWxkcmVuID0gW107CgkgIHRoaXMuc291cmNlQ29udGVudHMgPSB7fTsKCSAgdGhpcy5saW5lID0gYUxpbmUgPT0gbnVsbCA/IG51bGwgOiBhTGluZTsKCSAgdGhpcy5jb2x1bW4gPSBhQ29sdW1uID09IG51bGwgPyBudWxsIDogYUNvbHVtbjsKCSAgdGhpcy5zb3VyY2UgPSBhU291cmNlID09IG51bGwgPyBudWxsIDogYVNvdXJjZTsKCSAgdGhpcy5uYW1lID0gYU5hbWUgPT0gbnVsbCA/IG51bGwgOiBhTmFtZTsKCSAgdGhpc1tpc1NvdXJjZU5vZGVdID0gdHJ1ZTsKCSAgaWYgKGFDaHVua3MgIT0gbnVsbCkgdGhpcy5hZGQoYUNodW5rcyk7Cgl9CgoJLyoqCgkgKiBDcmVhdGVzIGEgU291cmNlTm9kZSBmcm9tIGdlbmVyYXRlZCBjb2RlIGFuZCBhIFNvdXJjZU1hcENvbnN1bWVyLgoJICoKCSAqIEBwYXJhbSBhR2VuZXJhdGVkQ29kZSBUaGUgZ2VuZXJhdGVkIGNvZGUKCSAqIEBwYXJhbSBhU291cmNlTWFwQ29uc3VtZXIgVGhlIFNvdXJjZU1hcCBmb3IgdGhlIGdlbmVyYXRlZCBjb2RlCgkgKiBAcGFyYW0gYVJlbGF0aXZlUGF0aCBPcHRpb25hbC4gVGhlIHBhdGggdGhhdCByZWxhdGl2ZSBzb3VyY2VzIGluIHRoZQoJICogICAgICAgIFNvdXJjZU1hcENvbnN1bWVyIHNob3VsZCBiZSByZWxhdGl2ZSB0by4KCSAqLwoJU291cmNlTm9kZS5mcm9tU3RyaW5nV2l0aFNvdXJjZU1hcCA9CgkgIGZ1bmN0aW9uIFNvdXJjZU5vZGVfZnJvbVN0cmluZ1dpdGhTb3VyY2VNYXAoYUdlbmVyYXRlZENvZGUsIGFTb3VyY2VNYXBDb25zdW1lciwgYVJlbGF0aXZlUGF0aCkgewoJICAgIC8vIFRoZSBTb3VyY2VOb2RlIHdlIHdhbnQgdG8gZmlsbCB3aXRoIHRoZSBnZW5lcmF0ZWQgY29kZQoJICAgIC8vIGFuZCB0aGUgU291cmNlTWFwCgkgICAgdmFyIG5vZGUgPSBuZXcgU291cmNlTm9kZSgpOwoKCSAgICAvLyBBbGwgZXZlbiBpbmRpY2VzIG9mIHRoaXMgYXJyYXkgYXJlIG9uZSBsaW5lIG9mIHRoZSBnZW5lcmF0ZWQgY29kZSwKCSAgICAvLyB3aGlsZSBhbGwgb2RkIGluZGljZXMgYXJlIHRoZSBuZXdsaW5lcyBiZXR3ZWVuIHR3byBhZGphY2VudCBsaW5lcwoJICAgIC8vIChzaW5jZSBgUkVHRVhfTkVXTElORWAgY2FwdHVyZXMgaXRzIG1hdGNoKS4KCSAgICAvLyBQcm9jZXNzZWQgZnJhZ21lbnRzIGFyZSBhY2Nlc3NlZCBieSBjYWxsaW5nIGBzaGlmdE5leHRMaW5lYC4KCSAgICB2YXIgcmVtYWluaW5nTGluZXMgPSBhR2VuZXJhdGVkQ29kZS5zcGxpdChSRUdFWF9ORVdMSU5FKTsKCSAgICB2YXIgcmVtYWluaW5nTGluZXNJbmRleCA9IDA7CgkgICAgdmFyIHNoaWZ0TmV4dExpbmUgPSBmdW5jdGlvbigpIHsKCSAgICAgIHZhciBsaW5lQ29udGVudHMgPSBnZXROZXh0TGluZSgpOwoJICAgICAgLy8gVGhlIGxhc3QgbGluZSBvZiBhIGZpbGUgbWlnaHQgbm90IGhhdmUgYSBuZXdsaW5lLgoJICAgICAgdmFyIG5ld0xpbmUgPSBnZXROZXh0TGluZSgpIHx8ICIiOwoJICAgICAgcmV0dXJuIGxpbmVDb250ZW50cyArIG5ld0xpbmU7CgoJICAgICAgZnVuY3Rpb24gZ2V0TmV4dExpbmUoKSB7CgkgICAgICAgIHJldHVybiByZW1haW5pbmdMaW5lc0luZGV4IDwgcmVtYWluaW5nTGluZXMubGVuZ3RoID8KCSAgICAgICAgICAgIHJlbWFpbmluZ0xpbmVzW3JlbWFpbmluZ0xpbmVzSW5kZXgrK10gOiB1bmRlZmluZWQ7CgkgICAgICB9CgkgICAgfTsKCgkgICAgLy8gV2UgbmVlZCB0byByZW1lbWJlciB0aGUgcG9zaXRpb24gb2YgInJlbWFpbmluZ0xpbmVzIgoJICAgIHZhciBsYXN0R2VuZXJhdGVkTGluZSA9IDEsIGxhc3RHZW5lcmF0ZWRDb2x1bW4gPSAwOwoKCSAgICAvLyBUaGUgZ2VuZXJhdGUgU291cmNlTm9kZXMgd2UgbmVlZCBhIGNvZGUgcmFuZ2UuCgkgICAgLy8gVG8gZXh0cmFjdCBpdCBjdXJyZW50IGFuZCBsYXN0IG1hcHBpbmcgaXMgdXNlZC4KCSAgICAvLyBIZXJlIHdlIHN0b3JlIHRoZSBsYXN0IG1hcHBpbmcuCgkgICAgdmFyIGxhc3RNYXBwaW5nID0gbnVsbDsKCgkgICAgYVNvdXJjZU1hcENvbnN1bWVyLmVhY2hNYXBwaW5nKGZ1bmN0aW9uIChtYXBwaW5nKSB7CgkgICAgICBpZiAobGFzdE1hcHBpbmcgIT09IG51bGwpIHsKCSAgICAgICAgLy8gV2UgYWRkIHRoZSBjb2RlIGZyb20gImxhc3RNYXBwaW5nIiB0byAibWFwcGluZyI6CgkgICAgICAgIC8vIEZpcnN0IGNoZWNrIGlmIHRoZXJlIGlzIGEgbmV3IGxpbmUgaW4gYmV0d2Vlbi4KCSAgICAgICAgaWYgKGxhc3RHZW5lcmF0ZWRMaW5lIDwgbWFwcGluZy5nZW5lcmF0ZWRMaW5lKSB7CgkgICAgICAgICAgLy8gQXNzb2NpYXRlIGZpcnN0IGxpbmUgd2l0aCAibGFzdE1hcHBpbmciCgkgICAgICAgICAgYWRkTWFwcGluZ1dpdGhDb2RlKGxhc3RNYXBwaW5nLCBzaGlmdE5leHRMaW5lKCkpOwoJICAgICAgICAgIGxhc3RHZW5lcmF0ZWRMaW5lKys7CgkgICAgICAgICAgbGFzdEdlbmVyYXRlZENvbHVtbiA9IDA7CgkgICAgICAgICAgLy8gVGhlIHJlbWFpbmluZyBjb2RlIGlzIGFkZGVkIHdpdGhvdXQgbWFwcGluZwoJICAgICAgICB9IGVsc2UgewoJICAgICAgICAgIC8vIFRoZXJlIGlzIG5vIG5ldyBsaW5lIGluIGJldHdlZW4uCgkgICAgICAgICAgLy8gQXNzb2NpYXRlIHRoZSBjb2RlIGJldHdlZW4gImxhc3RHZW5lcmF0ZWRDb2x1bW4iIGFuZAoJICAgICAgICAgIC8vICJtYXBwaW5nLmdlbmVyYXRlZENvbHVtbiIgd2l0aCAibGFzdE1hcHBpbmciCgkgICAgICAgICAgdmFyIG5leHRMaW5lID0gcmVtYWluaW5nTGluZXNbcmVtYWluaW5nTGluZXNJbmRleF0gfHwgJyc7CgkgICAgICAgICAgdmFyIGNvZGUgPSBuZXh0TGluZS5zdWJzdHIoMCwgbWFwcGluZy5nZW5lcmF0ZWRDb2x1bW4gLQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RHZW5lcmF0ZWRDb2x1bW4pOwoJICAgICAgICAgIHJlbWFpbmluZ0xpbmVzW3JlbWFpbmluZ0xpbmVzSW5kZXhdID0gbmV4dExpbmUuc3Vic3RyKG1hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uIC0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0R2VuZXJhdGVkQ29sdW1uKTsKCSAgICAgICAgICBsYXN0R2VuZXJhdGVkQ29sdW1uID0gbWFwcGluZy5nZW5lcmF0ZWRDb2x1bW47CgkgICAgICAgICAgYWRkTWFwcGluZ1dpdGhDb2RlKGxhc3RNYXBwaW5nLCBjb2RlKTsKCSAgICAgICAgICAvLyBObyBtb3JlIHJlbWFpbmluZyBjb2RlLCBjb250aW51ZQoJICAgICAgICAgIGxhc3RNYXBwaW5nID0gbWFwcGluZzsKCSAgICAgICAgICByZXR1cm47CgkgICAgICAgIH0KCSAgICAgIH0KCSAgICAgIC8vIFdlIGFkZCB0aGUgZ2VuZXJhdGVkIGNvZGUgdW50aWwgdGhlIGZpcnN0IG1hcHBpbmcKCSAgICAgIC8vIHRvIHRoZSBTb3VyY2VOb2RlIHdpdGhvdXQgYW55IG1hcHBpbmcuCgkgICAgICAvLyBFYWNoIGxpbmUgaXMgYWRkZWQgYXMgc2VwYXJhdGUgc3RyaW5nLgoJICAgICAgd2hpbGUgKGxhc3RHZW5lcmF0ZWRMaW5lIDwgbWFwcGluZy5nZW5lcmF0ZWRMaW5lKSB7CgkgICAgICAgIG5vZGUuYWRkKHNoaWZ0TmV4dExpbmUoKSk7CgkgICAgICAgIGxhc3RHZW5lcmF0ZWRMaW5lKys7CgkgICAgICB9CgkgICAgICBpZiAobGFzdEdlbmVyYXRlZENvbHVtbiA8IG1hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uKSB7CgkgICAgICAgIHZhciBuZXh0TGluZSA9IHJlbWFpbmluZ0xpbmVzW3JlbWFpbmluZ0xpbmVzSW5kZXhdIHx8ICcnOwoJICAgICAgICBub2RlLmFkZChuZXh0TGluZS5zdWJzdHIoMCwgbWFwcGluZy5nZW5lcmF0ZWRDb2x1bW4pKTsKCSAgICAgICAgcmVtYWluaW5nTGluZXNbcmVtYWluaW5nTGluZXNJbmRleF0gPSBuZXh0TGluZS5zdWJzdHIobWFwcGluZy5nZW5lcmF0ZWRDb2x1bW4pOwoJICAgICAgICBsYXN0R2VuZXJhdGVkQ29sdW1uID0gbWFwcGluZy5nZW5lcmF0ZWRDb2x1bW47CgkgICAgICB9CgkgICAgICBsYXN0TWFwcGluZyA9IG1hcHBpbmc7CgkgICAgfSwgdGhpcyk7CgkgICAgLy8gV2UgaGF2ZSBwcm9jZXNzZWQgYWxsIG1hcHBpbmdzLgoJICAgIGlmIChyZW1haW5pbmdMaW5lc0luZGV4IDwgcmVtYWluaW5nTGluZXMubGVuZ3RoKSB7CgkgICAgICBpZiAobGFzdE1hcHBpbmcpIHsKCSAgICAgICAgLy8gQXNzb2NpYXRlIHRoZSByZW1haW5pbmcgY29kZSBpbiB0aGUgY3VycmVudCBsaW5lIHdpdGggImxhc3RNYXBwaW5nIgoJICAgICAgICBhZGRNYXBwaW5nV2l0aENvZGUobGFzdE1hcHBpbmcsIHNoaWZ0TmV4dExpbmUoKSk7CgkgICAgICB9CgkgICAgICAvLyBhbmQgYWRkIHRoZSByZW1haW5pbmcgbGluZXMgd2l0aG91dCBhbnkgbWFwcGluZwoJICAgICAgbm9kZS5hZGQocmVtYWluaW5nTGluZXMuc3BsaWNlKHJlbWFpbmluZ0xpbmVzSW5kZXgpLmpvaW4oIiIpKTsKCSAgICB9CgoJICAgIC8vIENvcHkgc291cmNlc0NvbnRlbnQgaW50byBTb3VyY2VOb2RlCgkgICAgYVNvdXJjZU1hcENvbnN1bWVyLnNvdXJjZXMuZm9yRWFjaChmdW5jdGlvbiAoc291cmNlRmlsZSkgewoJICAgICAgdmFyIGNvbnRlbnQgPSBhU291cmNlTWFwQ29uc3VtZXIuc291cmNlQ29udGVudEZvcihzb3VyY2VGaWxlKTsKCSAgICAgIGlmIChjb250ZW50ICE9IG51bGwpIHsKCSAgICAgICAgaWYgKGFSZWxhdGl2ZVBhdGggIT0gbnVsbCkgewoJICAgICAgICAgIHNvdXJjZUZpbGUgPSB1dGlsLmpvaW4oYVJlbGF0aXZlUGF0aCwgc291cmNlRmlsZSk7CgkgICAgICAgIH0KCSAgICAgICAgbm9kZS5zZXRTb3VyY2VDb250ZW50KHNvdXJjZUZpbGUsIGNvbnRlbnQpOwoJICAgICAgfQoJICAgIH0pOwoKCSAgICByZXR1cm4gbm9kZTsKCgkgICAgZnVuY3Rpb24gYWRkTWFwcGluZ1dpdGhDb2RlKG1hcHBpbmcsIGNvZGUpIHsKCSAgICAgIGlmIChtYXBwaW5nID09PSBudWxsIHx8IG1hcHBpbmcuc291cmNlID09PSB1bmRlZmluZWQpIHsKCSAgICAgICAgbm9kZS5hZGQoY29kZSk7CgkgICAgICB9IGVsc2UgewoJICAgICAgICB2YXIgc291cmNlID0gYVJlbGF0aXZlUGF0aAoJICAgICAgICAgID8gdXRpbC5qb2luKGFSZWxhdGl2ZVBhdGgsIG1hcHBpbmcuc291cmNlKQoJICAgICAgICAgIDogbWFwcGluZy5zb3VyY2U7CgkgICAgICAgIG5vZGUuYWRkKG5ldyBTb3VyY2VOb2RlKG1hcHBpbmcub3JpZ2luYWxMaW5lLAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXBwaW5nLm9yaWdpbmFsQ29sdW1uLAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2UsCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGUsCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBpbmcubmFtZSkpOwoJICAgICAgfQoJICAgIH0KCSAgfTsKCgkvKioKCSAqIEFkZCBhIGNodW5rIG9mIGdlbmVyYXRlZCBKUyB0byB0aGlzIHNvdXJjZSBub2RlLgoJICoKCSAqIEBwYXJhbSBhQ2h1bmsgQSBzdHJpbmcgc25pcHBldCBvZiBnZW5lcmF0ZWQgSlMgY29kZSwgYW5vdGhlciBpbnN0YW5jZSBvZgoJICogICAgICAgIFNvdXJjZU5vZGUsIG9yIGFuIGFycmF5IHdoZXJlIGVhY2ggbWVtYmVyIGlzIG9uZSBvZiB0aG9zZSB0aGluZ3MuCgkgKi8KCVNvdXJjZU5vZGUucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIFNvdXJjZU5vZGVfYWRkKGFDaHVuaykgewoJICBpZiAoQXJyYXkuaXNBcnJheShhQ2h1bmspKSB7CgkgICAgYUNodW5rLmZvckVhY2goZnVuY3Rpb24gKGNodW5rKSB7CgkgICAgICB0aGlzLmFkZChjaHVuayk7CgkgICAgfSwgdGhpcyk7CgkgIH0KCSAgZWxzZSBpZiAoYUNodW5rW2lzU291cmNlTm9kZV0gfHwgdHlwZW9mIGFDaHVuayA9PT0gInN0cmluZyIpIHsKCSAgICBpZiAoYUNodW5rKSB7CgkgICAgICB0aGlzLmNoaWxkcmVuLnB1c2goYUNodW5rKTsKCSAgICB9CgkgIH0KCSAgZWxzZSB7CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigKCSAgICAgICJFeHBlY3RlZCBhIFNvdXJjZU5vZGUsIHN0cmluZywgb3IgYW4gYXJyYXkgb2YgU291cmNlTm9kZXMgYW5kIHN0cmluZ3MuIEdvdCAiICsgYUNodW5rCgkgICAgKTsKCSAgfQoJICByZXR1cm4gdGhpczsKCX07CgoJLyoqCgkgKiBBZGQgYSBjaHVuayBvZiBnZW5lcmF0ZWQgSlMgdG8gdGhlIGJlZ2lubmluZyBvZiB0aGlzIHNvdXJjZSBub2RlLgoJICoKCSAqIEBwYXJhbSBhQ2h1bmsgQSBzdHJpbmcgc25pcHBldCBvZiBnZW5lcmF0ZWQgSlMgY29kZSwgYW5vdGhlciBpbnN0YW5jZSBvZgoJICogICAgICAgIFNvdXJjZU5vZGUsIG9yIGFuIGFycmF5IHdoZXJlIGVhY2ggbWVtYmVyIGlzIG9uZSBvZiB0aG9zZSB0aGluZ3MuCgkgKi8KCVNvdXJjZU5vZGUucHJvdG90eXBlLnByZXBlbmQgPSBmdW5jdGlvbiBTb3VyY2VOb2RlX3ByZXBlbmQoYUNodW5rKSB7CgkgIGlmIChBcnJheS5pc0FycmF5KGFDaHVuaykpIHsKCSAgICBmb3IgKHZhciBpID0gYUNodW5rLmxlbmd0aC0xOyBpID49IDA7IGktLSkgewoJICAgICAgdGhpcy5wcmVwZW5kKGFDaHVua1tpXSk7CgkgICAgfQoJICB9CgkgIGVsc2UgaWYgKGFDaHVua1tpc1NvdXJjZU5vZGVdIHx8IHR5cGVvZiBhQ2h1bmsgPT09ICJzdHJpbmciKSB7CgkgICAgdGhpcy5jaGlsZHJlbi51bnNoaWZ0KGFDaHVuayk7CgkgIH0KCSAgZWxzZSB7CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigKCSAgICAgICJFeHBlY3RlZCBhIFNvdXJjZU5vZGUsIHN0cmluZywgb3IgYW4gYXJyYXkgb2YgU291cmNlTm9kZXMgYW5kIHN0cmluZ3MuIEdvdCAiICsgYUNodW5rCgkgICAgKTsKCSAgfQoJICByZXR1cm4gdGhpczsKCX07CgoJLyoqCgkgKiBXYWxrIG92ZXIgdGhlIHRyZWUgb2YgSlMgc25pcHBldHMgaW4gdGhpcyBub2RlIGFuZCBpdHMgY2hpbGRyZW4uIFRoZQoJICogd2Fsa2luZyBmdW5jdGlvbiBpcyBjYWxsZWQgb25jZSBmb3IgZWFjaCBzbmlwcGV0IG9mIEpTIGFuZCBpcyBwYXNzZWQgdGhhdAoJICogc25pcHBldCBhbmQgdGhlIGl0cyBvcmlnaW5hbCBhc3NvY2lhdGVkIHNvdXJjZSdzIGxpbmUvY29sdW1uIGxvY2F0aW9uLgoJICoKCSAqIEBwYXJhbSBhRm4gVGhlIHRyYXZlcnNhbCBmdW5jdGlvbi4KCSAqLwoJU291cmNlTm9kZS5wcm90b3R5cGUud2FsayA9IGZ1bmN0aW9uIFNvdXJjZU5vZGVfd2FsayhhRm4pIHsKCSAgdmFyIGNodW5rOwoJICBmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5jaGlsZHJlbi5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJICAgIGNodW5rID0gdGhpcy5jaGlsZHJlbltpXTsKCSAgICBpZiAoY2h1bmtbaXNTb3VyY2VOb2RlXSkgewoJICAgICAgY2h1bmsud2FsayhhRm4pOwoJICAgIH0KCSAgICBlbHNlIHsKCSAgICAgIGlmIChjaHVuayAhPT0gJycpIHsKCSAgICAgICAgYUZuKGNodW5rLCB7IHNvdXJjZTogdGhpcy5zb3VyY2UsCgkgICAgICAgICAgICAgICAgICAgICBsaW5lOiB0aGlzLmxpbmUsCgkgICAgICAgICAgICAgICAgICAgICBjb2x1bW46IHRoaXMuY29sdW1uLAoJICAgICAgICAgICAgICAgICAgICAgbmFtZTogdGhpcy5uYW1lIH0pOwoJICAgICAgfQoJICAgIH0KCSAgfQoJfTsKCgkvKioKCSAqIExpa2UgYFN0cmluZy5wcm90b3R5cGUuam9pbmAgZXhjZXB0IGZvciBTb3VyY2VOb2Rlcy4gSW5zZXJ0cyBgYVN0cmAgYmV0d2VlbgoJICogZWFjaCBvZiBgdGhpcy5jaGlsZHJlbmAuCgkgKgoJICogQHBhcmFtIGFTZXAgVGhlIHNlcGFyYXRvci4KCSAqLwoJU291cmNlTm9kZS5wcm90b3R5cGUuam9pbiA9IGZ1bmN0aW9uIFNvdXJjZU5vZGVfam9pbihhU2VwKSB7CgkgIHZhciBuZXdDaGlsZHJlbjsKCSAgdmFyIGk7CgkgIHZhciBsZW4gPSB0aGlzLmNoaWxkcmVuLmxlbmd0aDsKCSAgaWYgKGxlbiA+IDApIHsKCSAgICBuZXdDaGlsZHJlbiA9IFtdOwoJICAgIGZvciAoaSA9IDA7IGkgPCBsZW4tMTsgaSsrKSB7CgkgICAgICBuZXdDaGlsZHJlbi5wdXNoKHRoaXMuY2hpbGRyZW5baV0pOwoJICAgICAgbmV3Q2hpbGRyZW4ucHVzaChhU2VwKTsKCSAgICB9CgkgICAgbmV3Q2hpbGRyZW4ucHVzaCh0aGlzLmNoaWxkcmVuW2ldKTsKCSAgICB0aGlzLmNoaWxkcmVuID0gbmV3Q2hpbGRyZW47CgkgIH0KCSAgcmV0dXJuIHRoaXM7Cgl9OwoKCS8qKgoJICogQ2FsbCBTdHJpbmcucHJvdG90eXBlLnJlcGxhY2Ugb24gdGhlIHZlcnkgcmlnaHQtbW9zdCBzb3VyY2Ugc25pcHBldC4gVXNlZnVsCgkgKiBmb3IgdHJpbW1pbmcgd2hpdGVzcGFjZSBmcm9tIHRoZSBlbmQgb2YgYSBzb3VyY2Ugbm9kZSwgZXRjLgoJICoKCSAqIEBwYXJhbSBhUGF0dGVybiBUaGUgcGF0dGVybiB0byByZXBsYWNlLgoJICogQHBhcmFtIGFSZXBsYWNlbWVudCBUaGUgdGhpbmcgdG8gcmVwbGFjZSB0aGUgcGF0dGVybiB3aXRoLgoJICovCglTb3VyY2VOb2RlLnByb3RvdHlwZS5yZXBsYWNlUmlnaHQgPSBmdW5jdGlvbiBTb3VyY2VOb2RlX3JlcGxhY2VSaWdodChhUGF0dGVybiwgYVJlcGxhY2VtZW50KSB7CgkgIHZhciBsYXN0Q2hpbGQgPSB0aGlzLmNoaWxkcmVuW3RoaXMuY2hpbGRyZW4ubGVuZ3RoIC0gMV07CgkgIGlmIChsYXN0Q2hpbGRbaXNTb3VyY2VOb2RlXSkgewoJICAgIGxhc3RDaGlsZC5yZXBsYWNlUmlnaHQoYVBhdHRlcm4sIGFSZXBsYWNlbWVudCk7CgkgIH0KCSAgZWxzZSBpZiAodHlwZW9mIGxhc3RDaGlsZCA9PT0gJ3N0cmluZycpIHsKCSAgICB0aGlzLmNoaWxkcmVuW3RoaXMuY2hpbGRyZW4ubGVuZ3RoIC0gMV0gPSBsYXN0Q2hpbGQucmVwbGFjZShhUGF0dGVybiwgYVJlcGxhY2VtZW50KTsKCSAgfQoJICBlbHNlIHsKCSAgICB0aGlzLmNoaWxkcmVuLnB1c2goJycucmVwbGFjZShhUGF0dGVybiwgYVJlcGxhY2VtZW50KSk7CgkgIH0KCSAgcmV0dXJuIHRoaXM7Cgl9OwoKCS8qKgoJICogU2V0IHRoZSBzb3VyY2UgY29udGVudCBmb3IgYSBzb3VyY2UgZmlsZS4gVGhpcyB3aWxsIGJlIGFkZGVkIHRvIHRoZSBTb3VyY2VNYXBHZW5lcmF0b3IKCSAqIGluIHRoZSBzb3VyY2VzQ29udGVudCBmaWVsZC4KCSAqCgkgKiBAcGFyYW0gYVNvdXJjZUZpbGUgVGhlIGZpbGVuYW1lIG9mIHRoZSBzb3VyY2UgZmlsZQoJICogQHBhcmFtIGFTb3VyY2VDb250ZW50IFRoZSBjb250ZW50IG9mIHRoZSBzb3VyY2UgZmlsZQoJICovCglTb3VyY2VOb2RlLnByb3RvdHlwZS5zZXRTb3VyY2VDb250ZW50ID0KCSAgZnVuY3Rpb24gU291cmNlTm9kZV9zZXRTb3VyY2VDb250ZW50KGFTb3VyY2VGaWxlLCBhU291cmNlQ29udGVudCkgewoJICAgIHRoaXMuc291cmNlQ29udGVudHNbdXRpbC50b1NldFN0cmluZyhhU291cmNlRmlsZSldID0gYVNvdXJjZUNvbnRlbnQ7CgkgIH07CgoJLyoqCgkgKiBXYWxrIG92ZXIgdGhlIHRyZWUgb2YgU291cmNlTm9kZXMuIFRoZSB3YWxraW5nIGZ1bmN0aW9uIGlzIGNhbGxlZCBmb3IgZWFjaAoJICogc291cmNlIGZpbGUgY29udGVudCBhbmQgaXMgcGFzc2VkIHRoZSBmaWxlbmFtZSBhbmQgc291cmNlIGNvbnRlbnQuCgkgKgoJICogQHBhcmFtIGFGbiBUaGUgdHJhdmVyc2FsIGZ1bmN0aW9uLgoJICovCglTb3VyY2VOb2RlLnByb3RvdHlwZS53YWxrU291cmNlQ29udGVudHMgPQoJICBmdW5jdGlvbiBTb3VyY2VOb2RlX3dhbGtTb3VyY2VDb250ZW50cyhhRm4pIHsKCSAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5jaGlsZHJlbi5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJICAgICAgaWYgKHRoaXMuY2hpbGRyZW5baV1baXNTb3VyY2VOb2RlXSkgewoJICAgICAgICB0aGlzLmNoaWxkcmVuW2ldLndhbGtTb3VyY2VDb250ZW50cyhhRm4pOwoJICAgICAgfQoJICAgIH0KCgkgICAgdmFyIHNvdXJjZXMgPSBPYmplY3Qua2V5cyh0aGlzLnNvdXJjZUNvbnRlbnRzKTsKCSAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gc291cmNlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewoJICAgICAgYUZuKHV0aWwuZnJvbVNldFN0cmluZyhzb3VyY2VzW2ldKSwgdGhpcy5zb3VyY2VDb250ZW50c1tzb3VyY2VzW2ldXSk7CgkgICAgfQoJICB9OwoKCS8qKgoJICogUmV0dXJuIHRoZSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBzb3VyY2Ugbm9kZS4gV2Fsa3Mgb3ZlciB0aGUgdHJlZQoJICogYW5kIGNvbmNhdGVuYXRlcyBhbGwgdGhlIHZhcmlvdXMgc25pcHBldHMgdG9nZXRoZXIgdG8gb25lIHN0cmluZy4KCSAqLwoJU291cmNlTm9kZS5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiBTb3VyY2VOb2RlX3RvU3RyaW5nKCkgewoJICB2YXIgc3RyID0gIiI7CgkgIHRoaXMud2FsayhmdW5jdGlvbiAoY2h1bmspIHsKCSAgICBzdHIgKz0gY2h1bms7CgkgIH0pOwoJICByZXR1cm4gc3RyOwoJfTsKCgkvKioKCSAqIFJldHVybnMgdGhlIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGlzIHNvdXJjZSBub2RlIGFsb25nIHdpdGggYSBzb3VyY2UKCSAqIG1hcC4KCSAqLwoJU291cmNlTm9kZS5wcm90b3R5cGUudG9TdHJpbmdXaXRoU291cmNlTWFwID0gZnVuY3Rpb24gU291cmNlTm9kZV90b1N0cmluZ1dpdGhTb3VyY2VNYXAoYUFyZ3MpIHsKCSAgdmFyIGdlbmVyYXRlZCA9IHsKCSAgICBjb2RlOiAiIiwKCSAgICBsaW5lOiAxLAoJICAgIGNvbHVtbjogMAoJICB9OwoJICB2YXIgbWFwID0gbmV3IFNvdXJjZU1hcEdlbmVyYXRvcihhQXJncyk7CgkgIHZhciBzb3VyY2VNYXBwaW5nQWN0aXZlID0gZmFsc2U7CgkgIHZhciBsYXN0T3JpZ2luYWxTb3VyY2UgPSBudWxsOwoJICB2YXIgbGFzdE9yaWdpbmFsTGluZSA9IG51bGw7CgkgIHZhciBsYXN0T3JpZ2luYWxDb2x1bW4gPSBudWxsOwoJICB2YXIgbGFzdE9yaWdpbmFsTmFtZSA9IG51bGw7CgkgIHRoaXMud2FsayhmdW5jdGlvbiAoY2h1bmssIG9yaWdpbmFsKSB7CgkgICAgZ2VuZXJhdGVkLmNvZGUgKz0gY2h1bms7CgkgICAgaWYgKG9yaWdpbmFsLnNvdXJjZSAhPT0gbnVsbAoJICAgICAgICAmJiBvcmlnaW5hbC5saW5lICE9PSBudWxsCgkgICAgICAgICYmIG9yaWdpbmFsLmNvbHVtbiAhPT0gbnVsbCkgewoJICAgICAgaWYobGFzdE9yaWdpbmFsU291cmNlICE9PSBvcmlnaW5hbC5zb3VyY2UKCSAgICAgICAgIHx8IGxhc3RPcmlnaW5hbExpbmUgIT09IG9yaWdpbmFsLmxpbmUKCSAgICAgICAgIHx8IGxhc3RPcmlnaW5hbENvbHVtbiAhPT0gb3JpZ2luYWwuY29sdW1uCgkgICAgICAgICB8fCBsYXN0T3JpZ2luYWxOYW1lICE9PSBvcmlnaW5hbC5uYW1lKSB7CgkgICAgICAgIG1hcC5hZGRNYXBwaW5nKHsKCSAgICAgICAgICBzb3VyY2U6IG9yaWdpbmFsLnNvdXJjZSwKCSAgICAgICAgICBvcmlnaW5hbDogewoJICAgICAgICAgICAgbGluZTogb3JpZ2luYWwubGluZSwKCSAgICAgICAgICAgIGNvbHVtbjogb3JpZ2luYWwuY29sdW1uCgkgICAgICAgICAgfSwKCSAgICAgICAgICBnZW5lcmF0ZWQ6IHsKCSAgICAgICAgICAgIGxpbmU6IGdlbmVyYXRlZC5saW5lLAoJICAgICAgICAgICAgY29sdW1uOiBnZW5lcmF0ZWQuY29sdW1uCgkgICAgICAgICAgfSwKCSAgICAgICAgICBuYW1lOiBvcmlnaW5hbC5uYW1lCgkgICAgICAgIH0pOwoJICAgICAgfQoJICAgICAgbGFzdE9yaWdpbmFsU291cmNlID0gb3JpZ2luYWwuc291cmNlOwoJICAgICAgbGFzdE9yaWdpbmFsTGluZSA9IG9yaWdpbmFsLmxpbmU7CgkgICAgICBsYXN0T3JpZ2luYWxDb2x1bW4gPSBvcmlnaW5hbC5jb2x1bW47CgkgICAgICBsYXN0T3JpZ2luYWxOYW1lID0gb3JpZ2luYWwubmFtZTsKCSAgICAgIHNvdXJjZU1hcHBpbmdBY3RpdmUgPSB0cnVlOwoJICAgIH0gZWxzZSBpZiAoc291cmNlTWFwcGluZ0FjdGl2ZSkgewoJICAgICAgbWFwLmFkZE1hcHBpbmcoewoJICAgICAgICBnZW5lcmF0ZWQ6IHsKCSAgICAgICAgICBsaW5lOiBnZW5lcmF0ZWQubGluZSwKCSAgICAgICAgICBjb2x1bW46IGdlbmVyYXRlZC5jb2x1bW4KCSAgICAgICAgfQoJICAgICAgfSk7CgkgICAgICBsYXN0T3JpZ2luYWxTb3VyY2UgPSBudWxsOwoJICAgICAgc291cmNlTWFwcGluZ0FjdGl2ZSA9IGZhbHNlOwoJICAgIH0KCSAgICBmb3IgKHZhciBpZHggPSAwLCBsZW5ndGggPSBjaHVuay5sZW5ndGg7IGlkeCA8IGxlbmd0aDsgaWR4KyspIHsKCSAgICAgIGlmIChjaHVuay5jaGFyQ29kZUF0KGlkeCkgPT09IE5FV0xJTkVfQ09ERSkgewoJICAgICAgICBnZW5lcmF0ZWQubGluZSsrOwoJICAgICAgICBnZW5lcmF0ZWQuY29sdW1uID0gMDsKCSAgICAgICAgLy8gTWFwcGluZ3MgZW5kIGF0IGVvbAoJICAgICAgICBpZiAoaWR4ICsgMSA9PT0gbGVuZ3RoKSB7CgkgICAgICAgICAgbGFzdE9yaWdpbmFsU291cmNlID0gbnVsbDsKCSAgICAgICAgICBzb3VyY2VNYXBwaW5nQWN0aXZlID0gZmFsc2U7CgkgICAgICAgIH0gZWxzZSBpZiAoc291cmNlTWFwcGluZ0FjdGl2ZSkgewoJICAgICAgICAgIG1hcC5hZGRNYXBwaW5nKHsKCSAgICAgICAgICAgIHNvdXJjZTogb3JpZ2luYWwuc291cmNlLAoJICAgICAgICAgICAgb3JpZ2luYWw6IHsKCSAgICAgICAgICAgICAgbGluZTogb3JpZ2luYWwubGluZSwKCSAgICAgICAgICAgICAgY29sdW1uOiBvcmlnaW5hbC5jb2x1bW4KCSAgICAgICAgICAgIH0sCgkgICAgICAgICAgICBnZW5lcmF0ZWQ6IHsKCSAgICAgICAgICAgICAgbGluZTogZ2VuZXJhdGVkLmxpbmUsCgkgICAgICAgICAgICAgIGNvbHVtbjogZ2VuZXJhdGVkLmNvbHVtbgoJICAgICAgICAgICAgfSwKCSAgICAgICAgICAgIG5hbWU6IG9yaWdpbmFsLm5hbWUKCSAgICAgICAgICB9KTsKCSAgICAgICAgfQoJICAgICAgfSBlbHNlIHsKCSAgICAgICAgZ2VuZXJhdGVkLmNvbHVtbisrOwoJICAgICAgfQoJICAgIH0KCSAgfSk7CgkgIHRoaXMud2Fsa1NvdXJjZUNvbnRlbnRzKGZ1bmN0aW9uIChzb3VyY2VGaWxlLCBzb3VyY2VDb250ZW50KSB7CgkgICAgbWFwLnNldFNvdXJjZUNvbnRlbnQoc291cmNlRmlsZSwgc291cmNlQ29udGVudCk7CgkgIH0pOwoKCSAgcmV0dXJuIHsgY29kZTogZ2VuZXJhdGVkLmNvZGUsIG1hcDogbWFwIH07Cgl9OwoKCXNvdXJjZU5vZGUuU291cmNlTm9kZSA9IFNvdXJjZU5vZGU7CglyZXR1cm4gc291cmNlTm9kZTsKfQoKLyoKICogQ29weXJpZ2h0IDIwMDktMjAxMSBNb3ppbGxhIEZvdW5kYXRpb24gYW5kIGNvbnRyaWJ1dG9ycwogKiBMaWNlbnNlZCB1bmRlciB0aGUgTmV3IEJTRCBsaWNlbnNlLiBTZWUgTElDRU5TRS50eHQgb3I6CiAqIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9CU0QtMy1DbGF1c2UKICovCgp2YXIgaGFzUmVxdWlyZWRTb3VyY2VNYXA7CgpmdW5jdGlvbiByZXF1aXJlU291cmNlTWFwICgpIHsKCWlmIChoYXNSZXF1aXJlZFNvdXJjZU1hcCkgcmV0dXJuIHNvdXJjZU1hcDsKCWhhc1JlcXVpcmVkU291cmNlTWFwID0gMTsKCXNvdXJjZU1hcC5Tb3VyY2VNYXBHZW5lcmF0b3IgPSByZXF1aXJlU291cmNlTWFwR2VuZXJhdG9yKCkuU291cmNlTWFwR2VuZXJhdG9yOwoJc291cmNlTWFwLlNvdXJjZU1hcENvbnN1bWVyID0gcmVxdWlyZVNvdXJjZU1hcENvbnN1bWVyKCkuU291cmNlTWFwQ29uc3VtZXI7Cglzb3VyY2VNYXAuU291cmNlTm9kZSA9IHJlcXVpcmVTb3VyY2VOb2RlKCkuU291cmNlTm9kZTsKCXJldHVybiBzb3VyY2VNYXA7Cn0KCmNvbnN0IG5hbWUkRyA9ICJlc2NvZGVnZW4iOwpjb25zdCBkZXNjcmlwdGlvbiA9ICJFQ01BU2NyaXB0IGNvZGUgZ2VuZXJhdG9yIjsKY29uc3QgaG9tZXBhZ2UgPSAiaHR0cDovL2dpdGh1Yi5jb20vZXN0b29scy9lc2NvZGVnZW4iOwpjb25zdCBtYWluID0gImVzY29kZWdlbi5qcyI7CmNvbnN0IGJpbiA9IHsKCWVzZ2VuZXJhdGU6ICIuL2Jpbi9lc2dlbmVyYXRlLmpzIiwKCWVzY29kZWdlbjogIi4vYmluL2VzY29kZWdlbi5qcyIKfTsKY29uc3QgZmlsZXMgPSBbCgkiTElDRU5TRS5CU0QiLAoJIlJFQURNRS5tZCIsCgkiYmluIiwKCSJlc2NvZGVnZW4uanMiLAoJInBhY2thZ2UuanNvbiIKXTsKY29uc3QgdmVyc2lvbiQxID0gIjIuMS4wIjsKY29uc3QgZW5naW5lcyA9IHsKCW5vZGU6ICI+PTYuMCIKfTsKY29uc3QgbWFpbnRhaW5lcnMgPSBbCgl7CgkJbmFtZTogIll1c3VrZSBTdXp1a2kiLAoJCWVtYWlsOiAidXRhdGFuZS50ZWFAZ21haWwuY29tIiwKCQl3ZWI6ICJodHRwOi8vZ2l0aHViLmNvbS9Db25zdGVsbGF0aW9uIgoJfQpdOwpjb25zdCByZXBvc2l0b3J5ID0gewoJdHlwZTogImdpdCIsCgl1cmw6ICJodHRwOi8vZ2l0aHViLmNvbS9lc3Rvb2xzL2VzY29kZWdlbi5naXQiCn07CmNvbnN0IGRlcGVuZGVuY2llcyA9IHsKCWVzdHJhdmVyc2U6ICJeNS4yLjAiLAoJZXN1dGlsczogIl4yLjAuMiIsCgllc3ByaW1hOiAiXjQuMC4xIgp9Owpjb25zdCBvcHRpb25hbERlcGVuZGVuY2llcyA9IHsKCSJzb3VyY2UtbWFwIjogIn4wLjYuMSIKfTsKY29uc3QgZGV2RGVwZW5kZW5jaWVzID0gewoJYWNvcm46ICJeOC4wLjQiLAoJYmx1ZWJpcmQ6ICJeMy40LjciLAoJImJvd2VyLXJlZ2lzdHJ5LWNsaWVudCI6ICJeMS4wLjAiLAoJY2hhaTogIl40LjIuMCIsCgkiY2hhaS1leGNsdWRlIjogIl4yLjAuMiIsCgkiY29tbW9uanMtZXZlcnl3aGVyZSI6ICJeMC45LjciLAoJZ3VscDogIl40LjAuMiIsCgkiZ3VscC1lc2xpbnQiOiAiXjYuMC4wIiwKCSJndWxwLW1vY2hhIjogIl43LjAuMiIsCgltaW5pbWlzdDogIl4xLjIuNSIsCglvcHRpb25hdG9yOiAiXjAuOS4xIiwKCXNlbXZlcjogIl43LjMuNCIKfTsKY29uc3QgbGljZW5zZSA9ICJCU0QtMi1DbGF1c2UiOwpjb25zdCBzY3JpcHRzID0gewoJdGVzdDogImd1bHAgdHJhdmlzIiwKCSJ1bml0LXRlc3QiOiAiZ3VscCB0ZXN0IiwKCWxpbnQ6ICJndWxwIGxpbnQiLAoJcmVsZWFzZTogIm5vZGUgdG9vbHMvcmVsZWFzZS5qcyIsCgkiYnVpbGQtbWluIjogIi4vbm9kZV9tb2R1bGVzLy5iaW4vY2pzaWZ5IC1tYSBwYXRoOiB0b29scy9lbnRyeS1wb2ludC5qcyA+IGVzY29kZWdlbi5icm93c2VyLm1pbi5qcyIsCglidWlsZDogIi4vbm9kZV9tb2R1bGVzLy5iaW4vY2pzaWZ5IC1hIHBhdGg6IHRvb2xzL2VudHJ5LXBvaW50LmpzID4gZXNjb2RlZ2VuLmJyb3dzZXIuanMiCn07CmNvbnN0IHJlcXVpcmUkJDMgPSB7CgluYW1lOiBuYW1lJEcsCglkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24sCglob21lcGFnZTogaG9tZXBhZ2UsCgltYWluOiBtYWluLAoJYmluOiBiaW4sCglmaWxlczogZmlsZXMsCgl2ZXJzaW9uOiB2ZXJzaW9uJDEsCgllbmdpbmVzOiBlbmdpbmVzLAoJbWFpbnRhaW5lcnM6IG1haW50YWluZXJzLAoJcmVwb3NpdG9yeTogcmVwb3NpdG9yeSwKCWRlcGVuZGVuY2llczogZGVwZW5kZW5jaWVzLAoJb3B0aW9uYWxEZXBlbmRlbmNpZXM6IG9wdGlvbmFsRGVwZW5kZW5jaWVzLAoJZGV2RGVwZW5kZW5jaWVzOiBkZXZEZXBlbmRlbmNpZXMsCglsaWNlbnNlOiBsaWNlbnNlLAoJc2NyaXB0czogc2NyaXB0cwp9OwoKLyoKICBDb3B5cmlnaHQgKEMpIDIwMTItMjAxNCBZdXN1a2UgU3V6dWtpIDx1dGF0YW5lLnRlYUBnbWFpbC5jb20+CiAgQ29weXJpZ2h0IChDKSAyMDE1IEluZ3ZhciBTdGVwYW55YW4gPG1lQHJyZXZlcnNlci5jb20+CiAgQ29weXJpZ2h0IChDKSAyMDE0IEl2YW4gTmlrdWxpbiA8aWZhYWFuQGdtYWlsLmNvbT4KICBDb3B5cmlnaHQgKEMpIDIwMTItMjAxMyBNaWNoYWVsIEZpY2FycmEgPGVzY29kZWdlbi5jb3B5cmlnaHRAbWljaGFlbC5maWNhcnJhLm1lPgogIENvcHlyaWdodCAoQykgMjAxMi0yMDEzIE1hdGhpYXMgQnluZW5zIDxtYXRoaWFzQHFpd2kuYmU+CiAgQ29weXJpZ2h0IChDKSAyMDEzIElyYWtsaSBHb3phbGlzaHZpbGkgPHJmb2JpY0BnbWFpbC5jb20+CiAgQ29weXJpZ2h0IChDKSAyMDEyIFJvYmVydCBHdXN0LUJhcmRvbiA8ZG9uYXRlQHJvYmVydC5ndXN0LWJhcmRvbi5vcmc+CiAgQ29weXJpZ2h0IChDKSAyMDEyIEpvaG4gRnJlZW1hbiA8amZyZWVtYW4wOEBnbWFpbC5jb20+CiAgQ29weXJpZ2h0IChDKSAyMDExLTIwMTIgQXJpeWEgSGlkYXlhdCA8YXJpeWEuaGlkYXlhdEBnbWFpbC5jb20+CiAgQ29weXJpZ2h0IChDKSAyMDEyIEpvb3N0LVdpbSBCb2VrZXN0ZWlqbiA8am9vc3Qtd2ltQGJvZWtlc3RlaWpuLm5sPgogIENvcHlyaWdodCAoQykgMjAxMiBLcmlzIEtvd2FsIDxrcmlzLmtvd2FsQGNpeGFyLmNvbT4KICBDb3B5cmlnaHQgKEMpIDIwMTIgQXJwYWQgQm9yc29zIDxhcnBhZC5ib3Jzb3NAZ29vZ2xlbWFpbC5jb20+CiAgQ29weXJpZ2h0IChDKSAyMDIwIEFwcGxlIEluYy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KCiAgUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0CiAgbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6CgogICAgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodAogICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuCiAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0CiAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUKICAgICAgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4KCiAgVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyAiQVMgSVMiCiAgQU5EIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRQogIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFCiAgQVJFIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIDxDT1BZUklHSFQgSE9MREVSPiBCRSBMSUFCTEUgRk9SIEFOWQogIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTCiAgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOwogIExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORAogIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUCiAgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GCiAgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4KKi8KCihmdW5jdGlvbiAoZXhwb3J0cykgewoJLypnbG9iYWwgZXhwb3J0czp0cnVlLCByZXF1aXJlOnRydWUsIGdsb2JhbDp0cnVlKi8KCShmdW5jdGlvbiAoKSB7CgoJICAgIHZhciBTeW50YXgsCgkgICAgICAgIFByZWNlZGVuY2UsCgkgICAgICAgIEJpbmFyeVByZWNlZGVuY2UsCgkgICAgICAgIFNvdXJjZU5vZGUsCgkgICAgICAgIGVzdHJhdmVyc2UkMSwKCSAgICAgICAgZXN1dGlscywKCSAgICAgICAgYmFzZSwKCSAgICAgICAgaW5kZW50LAoJICAgICAgICBqc29uLAoJICAgICAgICByZW51bWJlciwKCSAgICAgICAgaGV4YWRlY2ltYWwsCgkgICAgICAgIHF1b3RlcywKCSAgICAgICAgZXNjYXBlbGVzcywKCSAgICAgICAgbmV3bGluZSwKCSAgICAgICAgc3BhY2UsCgkgICAgICAgIHBhcmVudGhlc2VzLAoJICAgICAgICBzZW1pY29sb25zLAoJICAgICAgICBzYWZlQ29uY2F0ZW5hdGlvbiwKCSAgICAgICAgZGlyZWN0aXZlLAoJICAgICAgICBleHRyYSwKCSAgICAgICAgcGFyc2UsCgkgICAgICAgIHNvdXJjZU1hcCwKCSAgICAgICAgc291cmNlQ29kZSwKCSAgICAgICAgcHJlc2VydmVCbGFua0xpbmVzLAoJICAgICAgICBGT1JNQVRfTUlOSUZZLAoJICAgICAgICBGT1JNQVRfREVGQVVMVFM7CgoJICAgIGVzdHJhdmVyc2UkMSA9IGVzdHJhdmVyc2U7CgkgICAgZXN1dGlscyA9IHV0aWxzOwoKCSAgICBTeW50YXggPSBlc3RyYXZlcnNlJDEuU3ludGF4OwoKCSAgICAvLyBHZW5lcmF0aW9uIGlzIGRvbmUgYnkgZ2VuZXJhdGVFeHByZXNzaW9uLgoJICAgIGZ1bmN0aW9uIGlzRXhwcmVzc2lvbihub2RlKSB7CgkgICAgICAgIHJldHVybiBDb2RlR2VuZXJhdG9yLkV4cHJlc3Npb24uaGFzT3duUHJvcGVydHkobm9kZS50eXBlKTsKCSAgICB9CgoJICAgIC8vIEdlbmVyYXRpb24gaXMgZG9uZSBieSBnZW5lcmF0ZVN0YXRlbWVudC4KCSAgICBmdW5jdGlvbiBpc1N0YXRlbWVudChub2RlKSB7CgkgICAgICAgIHJldHVybiBDb2RlR2VuZXJhdG9yLlN0YXRlbWVudC5oYXNPd25Qcm9wZXJ0eShub2RlLnR5cGUpOwoJICAgIH0KCgkgICAgUHJlY2VkZW5jZSA9IHsKCSAgICAgICAgU2VxdWVuY2U6IDAsCgkgICAgICAgIFlpZWxkOiAxLAoJICAgICAgICBBc3NpZ25tZW50OiAxLAoJICAgICAgICBDb25kaXRpb25hbDogMiwKCSAgICAgICAgQXJyb3dGdW5jdGlvbjogMiwKCSAgICAgICAgQ29hbGVzY2U6IDMsCgkgICAgICAgIExvZ2ljYWxPUjogNCwKCSAgICAgICAgTG9naWNhbEFORDogNSwKCSAgICAgICAgQml0d2lzZU9SOiA2LAoJICAgICAgICBCaXR3aXNlWE9SOiA3LAoJICAgICAgICBCaXR3aXNlQU5EOiA4LAoJICAgICAgICBFcXVhbGl0eTogOSwKCSAgICAgICAgUmVsYXRpb25hbDogMTAsCgkgICAgICAgIEJpdHdpc2VTSElGVDogMTEsCgkgICAgICAgIEFkZGl0aXZlOiAxMiwKCSAgICAgICAgTXVsdGlwbGljYXRpdmU6IDEzLAoJICAgICAgICBFeHBvbmVudGlhdGlvbjogMTQsCgkgICAgICAgIEF3YWl0OiAxNSwKCSAgICAgICAgVW5hcnk6IDE1LAoJICAgICAgICBQb3N0Zml4OiAxNiwKCSAgICAgICAgT3B0aW9uYWxDaGFpbmluZzogMTcsCgkgICAgICAgIENhbGw6IDE4LAoJICAgICAgICBOZXc6IDE5LAoJICAgICAgICBUYWdnZWRUZW1wbGF0ZTogMjAsCgkgICAgICAgIE1lbWJlcjogMjEsCgkgICAgICAgIFByaW1hcnk6IDIyCgkgICAgfTsKCgkgICAgQmluYXJ5UHJlY2VkZW5jZSA9IHsKCSAgICAgICAgJz8/JzogUHJlY2VkZW5jZS5Db2FsZXNjZSwKCSAgICAgICAgJ3x8JzogUHJlY2VkZW5jZS5Mb2dpY2FsT1IsCgkgICAgICAgICcmJic6IFByZWNlZGVuY2UuTG9naWNhbEFORCwKCSAgICAgICAgJ3wnOiBQcmVjZWRlbmNlLkJpdHdpc2VPUiwKCSAgICAgICAgJ14nOiBQcmVjZWRlbmNlLkJpdHdpc2VYT1IsCgkgICAgICAgICcmJzogUHJlY2VkZW5jZS5CaXR3aXNlQU5ELAoJICAgICAgICAnPT0nOiBQcmVjZWRlbmNlLkVxdWFsaXR5LAoJICAgICAgICAnIT0nOiBQcmVjZWRlbmNlLkVxdWFsaXR5LAoJICAgICAgICAnPT09JzogUHJlY2VkZW5jZS5FcXVhbGl0eSwKCSAgICAgICAgJyE9PSc6IFByZWNlZGVuY2UuRXF1YWxpdHksCgkgICAgICAgICdpcyc6IFByZWNlZGVuY2UuRXF1YWxpdHksCgkgICAgICAgICdpc250JzogUHJlY2VkZW5jZS5FcXVhbGl0eSwKCSAgICAgICAgJzwnOiBQcmVjZWRlbmNlLlJlbGF0aW9uYWwsCgkgICAgICAgICc+JzogUHJlY2VkZW5jZS5SZWxhdGlvbmFsLAoJICAgICAgICAnPD0nOiBQcmVjZWRlbmNlLlJlbGF0aW9uYWwsCgkgICAgICAgICc+PSc6IFByZWNlZGVuY2UuUmVsYXRpb25hbCwKCSAgICAgICAgJ2luJzogUHJlY2VkZW5jZS5SZWxhdGlvbmFsLAoJICAgICAgICAnaW5zdGFuY2VvZic6IFByZWNlZGVuY2UuUmVsYXRpb25hbCwKCSAgICAgICAgJzw8JzogUHJlY2VkZW5jZS5CaXR3aXNlU0hJRlQsCgkgICAgICAgICc+Pic6IFByZWNlZGVuY2UuQml0d2lzZVNISUZULAoJICAgICAgICAnPj4+JzogUHJlY2VkZW5jZS5CaXR3aXNlU0hJRlQsCgkgICAgICAgICcrJzogUHJlY2VkZW5jZS5BZGRpdGl2ZSwKCSAgICAgICAgJy0nOiBQcmVjZWRlbmNlLkFkZGl0aXZlLAoJICAgICAgICAnKic6IFByZWNlZGVuY2UuTXVsdGlwbGljYXRpdmUsCgkgICAgICAgICclJzogUHJlY2VkZW5jZS5NdWx0aXBsaWNhdGl2ZSwKCSAgICAgICAgJy8nOiBQcmVjZWRlbmNlLk11bHRpcGxpY2F0aXZlLAoJICAgICAgICAnKionOiBQcmVjZWRlbmNlLkV4cG9uZW50aWF0aW9uCgkgICAgfTsKCgkgICAgLy9GbGFncwoJICAgIHZhciBGX0FMTE9XX0lOID0gMSwKCSAgICAgICAgRl9BTExPV19DQUxMID0gMSA8PCAxLAoJICAgICAgICBGX0FMTE9XX1VOUEFSQVRIX05FVyA9IDEgPDwgMiwKCSAgICAgICAgRl9GVU5DX0JPRFkgPSAxIDw8IDMsCgkgICAgICAgIEZfRElSRUNUSVZFX0NUWCA9IDEgPDwgNCwKCSAgICAgICAgRl9TRU1JQ09MT05fT1BUID0gMSA8PCA1LAoJICAgICAgICBGX0ZPVU5EX0NPQUxFU0NFID0gMSA8PCA2OwoKCSAgICAvL0V4cHJlc3Npb24gZmxhZyBzZXRzCgkgICAgLy9OT1RFOiBGbGFnIG9yZGVyOgoJICAgIC8vIEZfQUxMT1dfSU4KCSAgICAvLyBGX0FMTE9XX0NBTEwKCSAgICAvLyBGX0FMTE9XX1VOUEFSQVRIX05FVwoJICAgIHZhciBFX0ZUVCA9IEZfQUxMT1dfQ0FMTCB8IEZfQUxMT1dfVU5QQVJBVEhfTkVXLAoJICAgICAgICBFX1RURiA9IEZfQUxMT1dfSU4gfCBGX0FMTE9XX0NBTEwsCgkgICAgICAgIEVfVFRUID0gRl9BTExPV19JTiB8IEZfQUxMT1dfQ0FMTCB8IEZfQUxMT1dfVU5QQVJBVEhfTkVXLAoJICAgICAgICBFX1RGRiA9IEZfQUxMT1dfSU4sCgkgICAgICAgIEVfRkZUID0gRl9BTExPV19VTlBBUkFUSF9ORVcsCgkgICAgICAgIEVfVEZUID0gRl9BTExPV19JTiB8IEZfQUxMT1dfVU5QQVJBVEhfTkVXOwoKCSAgICAvL1N0YXRlbWVudCBmbGFnIHNldHMKCSAgICAvL05PVEU6IEZsYWcgb3JkZXI6CgkgICAgLy8gRl9BTExPV19JTgoJICAgIC8vIEZfRlVOQ19CT0RZCgkgICAgLy8gRl9ESVJFQ1RJVkVfQ1RYCgkgICAgLy8gRl9TRU1JQ09MT05fT1BUCgkgICAgdmFyIFNfVEZGRiA9IEZfQUxMT1dfSU4sCgkgICAgICAgIFNfVEZGVCA9IEZfQUxMT1dfSU4gfCBGX1NFTUlDT0xPTl9PUFQsCgkgICAgICAgIFNfRkZGRiA9IDB4MDAsCgkgICAgICAgIFNfVEZURiA9IEZfQUxMT1dfSU4gfCBGX0RJUkVDVElWRV9DVFgsCgkgICAgICAgIFNfVFRGRiA9IEZfQUxMT1dfSU4gfCBGX0ZVTkNfQk9EWTsKCgkgICAgZnVuY3Rpb24gZ2V0RGVmYXVsdE9wdGlvbnMoKSB7CgkgICAgICAgIC8vIGRlZmF1bHQgb3B0aW9ucwoJICAgICAgICByZXR1cm4gewoJICAgICAgICAgICAgaW5kZW50OiBudWxsLAoJICAgICAgICAgICAgYmFzZTogbnVsbCwKCSAgICAgICAgICAgIHBhcnNlOiBudWxsLAoJICAgICAgICAgICAgY29tbWVudDogZmFsc2UsCgkgICAgICAgICAgICBmb3JtYXQ6IHsKCSAgICAgICAgICAgICAgICBpbmRlbnQ6IHsKCSAgICAgICAgICAgICAgICAgICAgc3R5bGU6ICcgICAgJywKCSAgICAgICAgICAgICAgICAgICAgYmFzZTogMCwKCSAgICAgICAgICAgICAgICAgICAgYWRqdXN0TXVsdGlsaW5lQ29tbWVudDogZmFsc2UKCSAgICAgICAgICAgICAgICB9LAoJICAgICAgICAgICAgICAgIG5ld2xpbmU6ICdcbicsCgkgICAgICAgICAgICAgICAgc3BhY2U6ICcgJywKCSAgICAgICAgICAgICAgICBqc29uOiBmYWxzZSwKCSAgICAgICAgICAgICAgICByZW51bWJlcjogZmFsc2UsCgkgICAgICAgICAgICAgICAgaGV4YWRlY2ltYWw6IGZhbHNlLAoJICAgICAgICAgICAgICAgIHF1b3RlczogJ3NpbmdsZScsCgkgICAgICAgICAgICAgICAgZXNjYXBlbGVzczogZmFsc2UsCgkgICAgICAgICAgICAgICAgY29tcGFjdDogZmFsc2UsCgkgICAgICAgICAgICAgICAgcGFyZW50aGVzZXM6IHRydWUsCgkgICAgICAgICAgICAgICAgc2VtaWNvbG9uczogdHJ1ZSwKCSAgICAgICAgICAgICAgICBzYWZlQ29uY2F0ZW5hdGlvbjogZmFsc2UsCgkgICAgICAgICAgICAgICAgcHJlc2VydmVCbGFua0xpbmVzOiBmYWxzZQoJICAgICAgICAgICAgfSwKCSAgICAgICAgICAgIG1vejogewoJICAgICAgICAgICAgICAgIGNvbXByZWhlbnNpb25FeHByZXNzaW9uU3RhcnRzV2l0aEFzc2lnbm1lbnQ6IGZhbHNlLAoJICAgICAgICAgICAgICAgIHN0YXJsZXNzR2VuZXJhdG9yOiBmYWxzZQoJICAgICAgICAgICAgfSwKCSAgICAgICAgICAgIHNvdXJjZU1hcDogbnVsbCwKCSAgICAgICAgICAgIHNvdXJjZU1hcFJvb3Q6IG51bGwsCgkgICAgICAgICAgICBzb3VyY2VNYXBXaXRoQ29kZTogZmFsc2UsCgkgICAgICAgICAgICBkaXJlY3RpdmU6IGZhbHNlLAoJICAgICAgICAgICAgcmF3OiB0cnVlLAoJICAgICAgICAgICAgdmVyYmF0aW06IG51bGwsCgkgICAgICAgICAgICBzb3VyY2VDb2RlOiBudWxsCgkgICAgICAgIH07CgkgICAgfQoKCSAgICBmdW5jdGlvbiBzdHJpbmdSZXBlYXQoc3RyLCBudW0pIHsKCSAgICAgICAgdmFyIHJlc3VsdCA9ICcnOwoKCSAgICAgICAgZm9yIChudW0gfD0gMDsgbnVtID4gMDsgbnVtID4+Pj0gMSwgc3RyICs9IHN0cikgewoJICAgICAgICAgICAgaWYgKG51bSAmIDEpIHsKCSAgICAgICAgICAgICAgICByZXN1bHQgKz0gc3RyOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH0KCgkgICAgZnVuY3Rpb24gaGFzTGluZVRlcm1pbmF0b3Ioc3RyKSB7CgkgICAgICAgIHJldHVybiAoL1tcclxuXS9nKS50ZXN0KHN0cik7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBlbmRzV2l0aExpbmVUZXJtaW5hdG9yKHN0cikgewoJICAgICAgICB2YXIgbGVuID0gc3RyLmxlbmd0aDsKCSAgICAgICAgcmV0dXJuIGxlbiAmJiBlc3V0aWxzLmNvZGUuaXNMaW5lVGVybWluYXRvcihzdHIuY2hhckNvZGVBdChsZW4gLSAxKSk7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBtZXJnZSh0YXJnZXQsIG92ZXJyaWRlKSB7CgkgICAgICAgIHZhciBrZXk7CgkgICAgICAgIGZvciAoa2V5IGluIG92ZXJyaWRlKSB7CgkgICAgICAgICAgICBpZiAob3ZlcnJpZGUuaGFzT3duUHJvcGVydHkoa2V5KSkgewoJICAgICAgICAgICAgICAgIHRhcmdldFtrZXldID0gb3ZlcnJpZGVba2V5XTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGFyZ2V0OwoJICAgIH0KCgkgICAgZnVuY3Rpb24gdXBkYXRlRGVlcGx5KHRhcmdldCwgb3ZlcnJpZGUpIHsKCSAgICAgICAgdmFyIGtleSwgdmFsOwoKCSAgICAgICAgZnVuY3Rpb24gaXNIYXNoT2JqZWN0KHRhcmdldCkgewoJICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiB0YXJnZXQgPT09ICdvYmplY3QnICYmIHRhcmdldCBpbnN0YW5jZW9mIE9iamVjdCAmJiAhKHRhcmdldCBpbnN0YW5jZW9mIFJlZ0V4cCk7CgkgICAgICAgIH0KCgkgICAgICAgIGZvciAoa2V5IGluIG92ZXJyaWRlKSB7CgkgICAgICAgICAgICBpZiAob3ZlcnJpZGUuaGFzT3duUHJvcGVydHkoa2V5KSkgewoJICAgICAgICAgICAgICAgIHZhbCA9IG92ZXJyaWRlW2tleV07CgkgICAgICAgICAgICAgICAgaWYgKGlzSGFzaE9iamVjdCh2YWwpKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChpc0hhc2hPYmplY3QodGFyZ2V0W2tleV0pKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVEZWVwbHkodGFyZ2V0W2tleV0sIHZhbCk7CgkgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRba2V5XSA9IHVwZGF0ZURlZXBseSh7fSwgdmFsKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIHRhcmdldFtrZXldID0gdmFsOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGFyZ2V0OwoJICAgIH0KCgkgICAgZnVuY3Rpb24gZ2VuZXJhdGVOdW1iZXIodmFsdWUpIHsKCSAgICAgICAgdmFyIHJlc3VsdCwgcG9pbnQsIHRlbXAsIGV4cG9uZW50LCBwb3M7CgoJICAgICAgICBpZiAodmFsdWUgIT09IHZhbHVlKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ051bWVyaWMgbGl0ZXJhbCB3aG9zZSB2YWx1ZSBpcyBOYU4nKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAodmFsdWUgPCAwIHx8ICh2YWx1ZSA9PT0gMCAmJiAxIC8gdmFsdWUgPCAwKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdOdW1lcmljIGxpdGVyYWwgd2hvc2UgdmFsdWUgaXMgbmVnYXRpdmUnKTsKCSAgICAgICAgfQoKCSAgICAgICAgaWYgKHZhbHVlID09PSAxIC8gMCkgewoJICAgICAgICAgICAgcmV0dXJuIGpzb24gPyAnbnVsbCcgOiByZW51bWJlciA/ICcxZTQwMCcgOiAnMWUrNDAwJzsKCSAgICAgICAgfQoKCSAgICAgICAgcmVzdWx0ID0gJycgKyB2YWx1ZTsKCSAgICAgICAgaWYgKCFyZW51bWJlciB8fCByZXN1bHQubGVuZ3RoIDwgMykgewoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfQoKCSAgICAgICAgcG9pbnQgPSByZXN1bHQuaW5kZXhPZignLicpOwoJICAgICAgICBpZiAoIWpzb24gJiYgcmVzdWx0LmNoYXJDb2RlQXQoMCkgPT09IDB4MzAgIC8qIDAgKi8gJiYgcG9pbnQgPT09IDEpIHsKCSAgICAgICAgICAgIHBvaW50ID0gMDsKCSAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5zbGljZSgxKTsKCSAgICAgICAgfQoJICAgICAgICB0ZW1wID0gcmVzdWx0OwoJICAgICAgICByZXN1bHQgPSByZXN1bHQucmVwbGFjZSgnZSsnLCAnZScpOwoJICAgICAgICBleHBvbmVudCA9IDA7CgkgICAgICAgIGlmICgocG9zID0gdGVtcC5pbmRleE9mKCdlJykpID4gMCkgewoJICAgICAgICAgICAgZXhwb25lbnQgPSArdGVtcC5zbGljZShwb3MgKyAxKTsKCSAgICAgICAgICAgIHRlbXAgPSB0ZW1wLnNsaWNlKDAsIHBvcyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHBvaW50ID49IDApIHsKCSAgICAgICAgICAgIGV4cG9uZW50IC09IHRlbXAubGVuZ3RoIC0gcG9pbnQgLSAxOwoJICAgICAgICAgICAgdGVtcCA9ICsodGVtcC5zbGljZSgwLCBwb2ludCkgKyB0ZW1wLnNsaWNlKHBvaW50ICsgMSkpICsgJyc7CgkgICAgICAgIH0KCSAgICAgICAgcG9zID0gMDsKCSAgICAgICAgd2hpbGUgKHRlbXAuY2hhckNvZGVBdCh0ZW1wLmxlbmd0aCArIHBvcyAtIDEpID09PSAweDMwICAvKiAwICovKSB7CgkgICAgICAgICAgICAtLXBvczsKCSAgICAgICAgfQoJICAgICAgICBpZiAocG9zICE9PSAwKSB7CgkgICAgICAgICAgICBleHBvbmVudCAtPSBwb3M7CgkgICAgICAgICAgICB0ZW1wID0gdGVtcC5zbGljZSgwLCBwb3MpOwoJICAgICAgICB9CgkgICAgICAgIGlmIChleHBvbmVudCAhPT0gMCkgewoJICAgICAgICAgICAgdGVtcCArPSAnZScgKyBleHBvbmVudDsKCSAgICAgICAgfQoJICAgICAgICBpZiAoKHRlbXAubGVuZ3RoIDwgcmVzdWx0Lmxlbmd0aCB8fAoJICAgICAgICAgICAgICAgICAgICAoaGV4YWRlY2ltYWwgJiYgdmFsdWUgPiAxZTEyICYmIE1hdGguZmxvb3IodmFsdWUpID09PSB2YWx1ZSAmJiAodGVtcCA9ICcweCcgKyB2YWx1ZS50b1N0cmluZygxNikpLmxlbmd0aCA8IHJlc3VsdC5sZW5ndGgpKSAmJgoJICAgICAgICAgICAgICAgICt0ZW1wID09PSB2YWx1ZSkgewoJICAgICAgICAgICAgcmVzdWx0ID0gdGVtcDsKCSAgICAgICAgfQoKCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9CgoJICAgIC8vIEdlbmVyYXRlIHZhbGlkIFJlZ0V4cCBleHByZXNzaW9uLgoJICAgIC8vIFRoaXMgZnVuY3Rpb24gaXMgYmFzZWQgb24gaHR0cHM6Ly9naXRodWIuY29tL0NvbnN0ZWxsYXRpb24vaXYgRW5naW5lCgoJICAgIGZ1bmN0aW9uIGVzY2FwZVJlZ0V4cENoYXJhY3RlcihjaCwgcHJldmlvdXNJc0JhY2tzbGFzaCkgewoJICAgICAgICAvLyBub3QgaGFuZGxpbmcgJ1wnIGFuZCBoYW5kbGluZyBcdTIwMjggb3IgXHUyMDI5IHRvIHVuaWNvZGUgZXNjYXBlIHNlcXVlbmNlCgkgICAgICAgIGlmICgoY2ggJiB+MSkgPT09IDB4MjAyOCkgewoJICAgICAgICAgICAgcmV0dXJuIChwcmV2aW91c0lzQmFja3NsYXNoID8gJ3UnIDogJ1xcdScpICsgKChjaCA9PT0gMHgyMDI4KSA/ICcyMDI4JyA6ICcyMDI5Jyk7CgkgICAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDEwIHx8IGNoID09PSAxMykgeyAgLy8gXG4sIFxyCgkgICAgICAgICAgICByZXR1cm4gKHByZXZpb3VzSXNCYWNrc2xhc2ggPyAnJyA6ICdcXCcpICsgKChjaCA9PT0gMTApID8gJ24nIDogJ3InKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShjaCk7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBnZW5lcmF0ZVJlZ0V4cChyZWcpIHsKCSAgICAgICAgdmFyIG1hdGNoLCByZXN1bHQsIGZsYWdzLCBpLCBpeiwgY2gsIGNoYXJhY3RlckluQnJhY2ssIHByZXZpb3VzSXNCYWNrc2xhc2g7CgoJICAgICAgICByZXN1bHQgPSByZWcudG9TdHJpbmcoKTsKCgkgICAgICAgIGlmIChyZWcuc291cmNlKSB7CgkgICAgICAgICAgICAvLyBleHRyYWN0IGZsYWcgZnJvbSB0b1N0cmluZyByZXN1bHQKCSAgICAgICAgICAgIG1hdGNoID0gcmVzdWx0Lm1hdGNoKC9cLyhbXi9dKikkLyk7CgkgICAgICAgICAgICBpZiAoIW1hdGNoKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICBmbGFncyA9IG1hdGNoWzFdOwoJICAgICAgICAgICAgcmVzdWx0ID0gJyc7CgoJICAgICAgICAgICAgY2hhcmFjdGVySW5CcmFjayA9IGZhbHNlOwoJICAgICAgICAgICAgcHJldmlvdXNJc0JhY2tzbGFzaCA9IGZhbHNlOwoJICAgICAgICAgICAgZm9yIChpID0gMCwgaXogPSByZWcuc291cmNlLmxlbmd0aDsgaSA8IGl6OyArK2kpIHsKCSAgICAgICAgICAgICAgICBjaCA9IHJlZy5zb3VyY2UuY2hhckNvZGVBdChpKTsKCgkgICAgICAgICAgICAgICAgaWYgKCFwcmV2aW91c0lzQmFja3NsYXNoKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChjaGFyYWN0ZXJJbkJyYWNrKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2ggPT09IDkzKSB7ICAvLyBdCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhcmFjdGVySW5CcmFjayA9IGZhbHNlOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoID09PSA0NykgeyAgLy8gLwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnXFwnOwoJICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjaCA9PT0gOTEpIHsgIC8vIFsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFyYWN0ZXJJbkJyYWNrID0gdHJ1ZTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gZXNjYXBlUmVnRXhwQ2hhcmFjdGVyKGNoLCBwcmV2aW91c0lzQmFja3NsYXNoKTsKCSAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNJc0JhY2tzbGFzaCA9IGNoID09PSA5MjsgIC8vIFwKCSAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAvLyBpZiBuZXcgUmVnRXhwKCJcXFxuJykgaXMgcHJvdmlkZWQsIGNyZWF0ZSAvXG4vCgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBlc2NhcGVSZWdFeHBDaGFyYWN0ZXIoY2gsIHByZXZpb3VzSXNCYWNrc2xhc2gpOwoJICAgICAgICAgICAgICAgICAgICAvLyBwcmV2ZW50IGxpa2UgL1xcWy9dLwoJICAgICAgICAgICAgICAgICAgICBwcmV2aW91c0lzQmFja3NsYXNoID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIHJldHVybiAnLycgKyByZXN1bHQgKyAnLycgKyBmbGFnczsKCSAgICAgICAgfQoKCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9CgoJICAgIGZ1bmN0aW9uIGVzY2FwZUFsbG93ZWRDaGFyYWN0ZXIoY29kZSwgbmV4dCkgewoJICAgICAgICB2YXIgaGV4OwoKCSAgICAgICAgaWYgKGNvZGUgPT09IDB4MDggIC8qIFxiICovKSB7CgkgICAgICAgICAgICByZXR1cm4gJ1xcYic7CgkgICAgICAgIH0KCgkgICAgICAgIGlmIChjb2RlID09PSAweDBDICAvKiBcZiAqLykgewoJICAgICAgICAgICAgcmV0dXJuICdcXGYnOwoJICAgICAgICB9CgoJICAgICAgICBpZiAoY29kZSA9PT0gMHgwOSAgLyogXHQgKi8pIHsKCSAgICAgICAgICAgIHJldHVybiAnXFx0JzsKCSAgICAgICAgfQoKCSAgICAgICAgaGV4ID0gY29kZS50b1N0cmluZygxNikudG9VcHBlckNhc2UoKTsKCSAgICAgICAgaWYgKGpzb24gfHwgY29kZSA+IDB4RkYpIHsKCSAgICAgICAgICAgIHJldHVybiAnXFx1JyArICcwMDAwJy5zbGljZShoZXgubGVuZ3RoKSArIGhleDsKCSAgICAgICAgfSBlbHNlIGlmIChjb2RlID09PSAweDAwMDAgJiYgIWVzdXRpbHMuY29kZS5pc0RlY2ltYWxEaWdpdChuZXh0KSkgewoJICAgICAgICAgICAgcmV0dXJuICdcXDAnOwoJICAgICAgICB9IGVsc2UgaWYgKGNvZGUgPT09IDB4MDAwQiAgLyogXHYgKi8pIHsgLy8gJ1x2JwoJICAgICAgICAgICAgcmV0dXJuICdcXHgwQic7CgkgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICByZXR1cm4gJ1xceCcgKyAnMDAnLnNsaWNlKGhleC5sZW5ndGgpICsgaGV4OwoJICAgICAgICB9CgkgICAgfQoKCSAgICBmdW5jdGlvbiBlc2NhcGVEaXNhbGxvd2VkQ2hhcmFjdGVyKGNvZGUpIHsKCSAgICAgICAgaWYgKGNvZGUgPT09IDB4NUMgIC8qIFwgKi8pIHsKCSAgICAgICAgICAgIHJldHVybiAnXFxcXCc7CgkgICAgICAgIH0KCgkgICAgICAgIGlmIChjb2RlID09PSAweDBBICAvKiBcbiAqLykgewoJICAgICAgICAgICAgcmV0dXJuICdcXG4nOwoJICAgICAgICB9CgoJICAgICAgICBpZiAoY29kZSA9PT0gMHgwRCAgLyogXHIgKi8pIHsKCSAgICAgICAgICAgIHJldHVybiAnXFxyJzsKCSAgICAgICAgfQoKCSAgICAgICAgaWYgKGNvZGUgPT09IDB4MjAyOCkgewoJICAgICAgICAgICAgcmV0dXJuICdcXHUyMDI4JzsKCSAgICAgICAgfQoKCSAgICAgICAgaWYgKGNvZGUgPT09IDB4MjAyOSkgewoJICAgICAgICAgICAgcmV0dXJuICdcXHUyMDI5JzsKCSAgICAgICAgfQoKCSAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbmNvcnJlY3RseSBjbGFzc2lmaWVkIGNoYXJhY3RlcicpOwoJICAgIH0KCgkgICAgZnVuY3Rpb24gZXNjYXBlRGlyZWN0aXZlKHN0cikgewoJICAgICAgICB2YXIgaSwgaXosIGNvZGUsIHF1b3RlOwoKCSAgICAgICAgcXVvdGUgPSBxdW90ZXMgPT09ICdkb3VibGUnID8gJyInIDogJ1wnJzsKCSAgICAgICAgZm9yIChpID0gMCwgaXogPSBzdHIubGVuZ3RoOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgY29kZSA9IHN0ci5jaGFyQ29kZUF0KGkpOwoJICAgICAgICAgICAgaWYgKGNvZGUgPT09IDB4MjcgIC8qICcgKi8pIHsKCSAgICAgICAgICAgICAgICBxdW90ZSA9ICciJzsKCSAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIH0gZWxzZSBpZiAoY29kZSA9PT0gMHgyMiAgLyogIiAqLykgewoJICAgICAgICAgICAgICAgIHF1b3RlID0gJ1wnJzsKCSAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIH0gZWxzZSBpZiAoY29kZSA9PT0gMHg1QyAgLyogXCAqLykgewoJICAgICAgICAgICAgICAgICsraTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoKCSAgICAgICAgcmV0dXJuIHF1b3RlICsgc3RyICsgcXVvdGU7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBlc2NhcGVTdHJpbmcoc3RyKSB7CgkgICAgICAgIHZhciByZXN1bHQgPSAnJywgaSwgbGVuLCBjb2RlLCBzaW5nbGVRdW90ZXMgPSAwLCBkb3VibGVRdW90ZXMgPSAwLCBzaW5nbGUsIHF1b3RlOwoKCSAgICAgICAgZm9yIChpID0gMCwgbGVuID0gc3RyLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CgkgICAgICAgICAgICBjb2RlID0gc3RyLmNoYXJDb2RlQXQoaSk7CgkgICAgICAgICAgICBpZiAoY29kZSA9PT0gMHgyNyAgLyogJyAqLykgewoJICAgICAgICAgICAgICAgICsrc2luZ2xlUXVvdGVzOwoJICAgICAgICAgICAgfSBlbHNlIGlmIChjb2RlID09PSAweDIyICAvKiAiICovKSB7CgkgICAgICAgICAgICAgICAgKytkb3VibGVRdW90ZXM7CgkgICAgICAgICAgICB9IGVsc2UgaWYgKGNvZGUgPT09IDB4MkYgIC8qIC8gKi8gJiYganNvbikgewoJICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnXFwnOwoJICAgICAgICAgICAgfSBlbHNlIGlmIChlc3V0aWxzLmNvZGUuaXNMaW5lVGVybWluYXRvcihjb2RlKSB8fCBjb2RlID09PSAweDVDICAvKiBcICovKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGVzY2FwZURpc2FsbG93ZWRDaGFyYWN0ZXIoY29kZSk7CgkgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICB9IGVsc2UgaWYgKCFlc3V0aWxzLmNvZGUuaXNJZGVudGlmaWVyUGFydEVTNShjb2RlKSAmJiAoanNvbiAmJiBjb2RlIDwgMHgyMCAgLyogU1AgKi8gfHwgIWpzb24gJiYgIWVzY2FwZWxlc3MgJiYgKGNvZGUgPCAweDIwICAvKiBTUCAqLyB8fCBjb2RlID4gMHg3RSAgLyogfiAqLykpKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGVzY2FwZUFsbG93ZWRDaGFyYWN0ZXIoY29kZSwgc3RyLmNoYXJDb2RlQXQoaSArIDEpKTsKCSAgICAgICAgICAgICAgICBjb250aW51ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGUpOwoJICAgICAgICB9CgoJICAgICAgICBzaW5nbGUgPSAhKHF1b3RlcyA9PT0gJ2RvdWJsZScgfHwgKHF1b3RlcyA9PT0gJ2F1dG8nICYmIGRvdWJsZVF1b3RlcyA8IHNpbmdsZVF1b3RlcykpOwoJICAgICAgICBxdW90ZSA9IHNpbmdsZSA/ICdcJycgOiAnIic7CgoJICAgICAgICBpZiAoIShzaW5nbGUgPyBzaW5nbGVRdW90ZXMgOiBkb3VibGVRdW90ZXMpKSB7CgkgICAgICAgICAgICByZXR1cm4gcXVvdGUgKyByZXN1bHQgKyBxdW90ZTsKCSAgICAgICAgfQoKCSAgICAgICAgc3RyID0gcmVzdWx0OwoJICAgICAgICByZXN1bHQgPSBxdW90ZTsKCgkgICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IHN0ci5sZW5ndGg7IGkgPCBsZW47ICsraSkgewoJICAgICAgICAgICAgY29kZSA9IHN0ci5jaGFyQ29kZUF0KGkpOwoJICAgICAgICAgICAgaWYgKChjb2RlID09PSAweDI3ICAvKiAnICovICYmIHNpbmdsZSkgfHwgKGNvZGUgPT09IDB4MjIgIC8qICIgKi8gJiYgIXNpbmdsZSkpIHsKCSAgICAgICAgICAgICAgICByZXN1bHQgKz0gJ1xcJzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGUpOwoJICAgICAgICB9CgoJICAgICAgICByZXR1cm4gcmVzdWx0ICsgcXVvdGU7CgkgICAgfQoKCSAgICAvKioKCSAgICAgKiBmbGF0dGVuIGFuIGFycmF5IHRvIGEgc3RyaW5nLCB3aGVyZSB0aGUgYXJyYXkgY2FuIGNvbnRhaW4KCSAgICAgKiBlaXRoZXIgc3RyaW5ncyBvciBuZXN0ZWQgYXJyYXlzCgkgICAgICovCgkgICAgZnVuY3Rpb24gZmxhdHRlblRvU3RyaW5nKGFycikgewoJICAgICAgICB2YXIgaSwgaXosIGVsZW0sIHJlc3VsdCA9ICcnOwoJICAgICAgICBmb3IgKGkgPSAwLCBpeiA9IGFyci5sZW5ndGg7IGkgPCBpejsgKytpKSB7CgkgICAgICAgICAgICBlbGVtID0gYXJyW2ldOwoJICAgICAgICAgICAgcmVzdWx0ICs9IEFycmF5LmlzQXJyYXkoZWxlbSkgPyBmbGF0dGVuVG9TdHJpbmcoZWxlbSkgOiBlbGVtOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfQoKCSAgICAvKioKCSAgICAgKiBjb252ZXJ0IGdlbmVyYXRlZCB0byBhIFNvdXJjZU5vZGUgd2hlbiBzb3VyY2UgbWFwcyBhcmUgZW5hYmxlZC4KCSAgICAgKi8KCSAgICBmdW5jdGlvbiB0b1NvdXJjZU5vZGVXaGVuTmVlZGVkKGdlbmVyYXRlZCwgbm9kZSkgewoJICAgICAgICBpZiAoIXNvdXJjZU1hcCkgewoJICAgICAgICAgICAgLy8gd2l0aCBubyBzb3VyY2UgbWFwcywgZ2VuZXJhdGVkIGlzIGVpdGhlciBhbgoJICAgICAgICAgICAgLy8gYXJyYXkgb3IgYSBzdHJpbmcuICBpZiBhbiBhcnJheSwgZmxhdHRlbiBpdC4KCSAgICAgICAgICAgIC8vIGlmIGEgc3RyaW5nLCBqdXN0IHJldHVybiBpdAoJICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZ2VuZXJhdGVkKSkgewoJICAgICAgICAgICAgICAgIHJldHVybiBmbGF0dGVuVG9TdHJpbmcoZ2VuZXJhdGVkKTsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGdlbmVyYXRlZDsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBpZiAobm9kZSA9PSBudWxsKSB7CgkgICAgICAgICAgICBpZiAoZ2VuZXJhdGVkIGluc3RhbmNlb2YgU291cmNlTm9kZSkgewoJICAgICAgICAgICAgICAgIHJldHVybiBnZW5lcmF0ZWQ7CgkgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgIG5vZGUgPSB7fTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBpZiAobm9kZS5sb2MgPT0gbnVsbCkgewoJICAgICAgICAgICAgcmV0dXJuIG5ldyBTb3VyY2VOb2RlKG51bGwsIG51bGwsIHNvdXJjZU1hcCwgZ2VuZXJhdGVkLCBub2RlLm5hbWUgfHwgbnVsbCk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG5ldyBTb3VyY2VOb2RlKG5vZGUubG9jLnN0YXJ0LmxpbmUsIG5vZGUubG9jLnN0YXJ0LmNvbHVtbiwgKHNvdXJjZU1hcCA9PT0gdHJ1ZSA/IG5vZGUubG9jLnNvdXJjZSB8fCBudWxsIDogc291cmNlTWFwKSwgZ2VuZXJhdGVkLCBub2RlLm5hbWUgfHwgbnVsbCk7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBub0VtcHR5U3BhY2UoKSB7CgkgICAgICAgIHJldHVybiAoc3BhY2UpID8gc3BhY2UgOiAnICc7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBqb2luKGxlZnQsIHJpZ2h0KSB7CgkgICAgICAgIHZhciBsZWZ0U291cmNlLAoJICAgICAgICAgICAgcmlnaHRTb3VyY2UsCgkgICAgICAgICAgICBsZWZ0Q2hhckNvZGUsCgkgICAgICAgICAgICByaWdodENoYXJDb2RlOwoKCSAgICAgICAgbGVmdFNvdXJjZSA9IHRvU291cmNlTm9kZVdoZW5OZWVkZWQobGVmdCkudG9TdHJpbmcoKTsKCSAgICAgICAgaWYgKGxlZnRTb3VyY2UubGVuZ3RoID09PSAwKSB7CgkgICAgICAgICAgICByZXR1cm4gW3JpZ2h0XTsKCSAgICAgICAgfQoKCSAgICAgICAgcmlnaHRTb3VyY2UgPSB0b1NvdXJjZU5vZGVXaGVuTmVlZGVkKHJpZ2h0KS50b1N0cmluZygpOwoJICAgICAgICBpZiAocmlnaHRTb3VyY2UubGVuZ3RoID09PSAwKSB7CgkgICAgICAgICAgICByZXR1cm4gW2xlZnRdOwoJICAgICAgICB9CgoJICAgICAgICBsZWZ0Q2hhckNvZGUgPSBsZWZ0U291cmNlLmNoYXJDb2RlQXQobGVmdFNvdXJjZS5sZW5ndGggLSAxKTsKCSAgICAgICAgcmlnaHRDaGFyQ29kZSA9IHJpZ2h0U291cmNlLmNoYXJDb2RlQXQoMCk7CgoJICAgICAgICBpZiAoKGxlZnRDaGFyQ29kZSA9PT0gMHgyQiAgLyogKyAqLyB8fCBsZWZ0Q2hhckNvZGUgPT09IDB4MkQgIC8qIC0gKi8pICYmIGxlZnRDaGFyQ29kZSA9PT0gcmlnaHRDaGFyQ29kZSB8fAoJICAgICAgICAgICAgZXN1dGlscy5jb2RlLmlzSWRlbnRpZmllclBhcnRFUzUobGVmdENoYXJDb2RlKSAmJiBlc3V0aWxzLmNvZGUuaXNJZGVudGlmaWVyUGFydEVTNShyaWdodENoYXJDb2RlKSB8fAoJICAgICAgICAgICAgbGVmdENoYXJDb2RlID09PSAweDJGICAvKiAvICovICYmIHJpZ2h0Q2hhckNvZGUgPT09IDB4NjkgIC8qIGkgKi8pIHsgLy8gaW5maXggd29yZCBvcGVyYXRvcnMgYWxsIHN0YXJ0IHdpdGggYGlgCgkgICAgICAgICAgICByZXR1cm4gW2xlZnQsIG5vRW1wdHlTcGFjZSgpLCByaWdodF07CgkgICAgICAgIH0gZWxzZSBpZiAoZXN1dGlscy5jb2RlLmlzV2hpdGVTcGFjZShsZWZ0Q2hhckNvZGUpIHx8IGVzdXRpbHMuY29kZS5pc0xpbmVUZXJtaW5hdG9yKGxlZnRDaGFyQ29kZSkgfHwKCSAgICAgICAgICAgICAgICBlc3V0aWxzLmNvZGUuaXNXaGl0ZVNwYWNlKHJpZ2h0Q2hhckNvZGUpIHx8IGVzdXRpbHMuY29kZS5pc0xpbmVUZXJtaW5hdG9yKHJpZ2h0Q2hhckNvZGUpKSB7CgkgICAgICAgICAgICByZXR1cm4gW2xlZnQsIHJpZ2h0XTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gW2xlZnQsIHNwYWNlLCByaWdodF07CgkgICAgfQoKCSAgICBmdW5jdGlvbiBhZGRJbmRlbnQoc3RtdCkgewoJICAgICAgICByZXR1cm4gW2Jhc2UsIHN0bXRdOwoJICAgIH0KCgkgICAgZnVuY3Rpb24gd2l0aEluZGVudChmbikgewoJICAgICAgICB2YXIgcHJldmlvdXNCYXNlOwoJICAgICAgICBwcmV2aW91c0Jhc2UgPSBiYXNlOwoJICAgICAgICBiYXNlICs9IGluZGVudDsKCSAgICAgICAgZm4oYmFzZSk7CgkgICAgICAgIGJhc2UgPSBwcmV2aW91c0Jhc2U7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBjYWxjdWxhdGVTcGFjZXMoc3RyKSB7CgkgICAgICAgIHZhciBpOwoJICAgICAgICBmb3IgKGkgPSBzdHIubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsKCSAgICAgICAgICAgIGlmIChlc3V0aWxzLmNvZGUuaXNMaW5lVGVybWluYXRvcihzdHIuY2hhckNvZGVBdChpKSkpIHsKCSAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gKHN0ci5sZW5ndGggLSAxKSAtIGk7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBhZGp1c3RNdWx0aWxpbmVDb21tZW50KHZhbHVlLCBzcGVjaWFsQmFzZSkgewoJICAgICAgICB2YXIgYXJyYXksIGksIGxlbiwgbGluZSwgaiwgc3BhY2VzLCBwcmV2aW91c0Jhc2UsIHNuOwoKCSAgICAgICAgYXJyYXkgPSB2YWx1ZS5zcGxpdCgvXHJcbnxbXHJcbl0vKTsKCSAgICAgICAgc3BhY2VzID0gTnVtYmVyLk1BWF9WQUxVRTsKCgkgICAgICAgIC8vIGZpcnN0IGxpbmUgZG9lc24ndCBoYXZlIGluZGVudGF0aW9uCgkgICAgICAgIGZvciAoaSA9IDEsIGxlbiA9IGFycmF5Lmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CgkgICAgICAgICAgICBsaW5lID0gYXJyYXlbaV07CgkgICAgICAgICAgICBqID0gMDsKCSAgICAgICAgICAgIHdoaWxlIChqIDwgbGluZS5sZW5ndGggJiYgZXN1dGlscy5jb2RlLmlzV2hpdGVTcGFjZShsaW5lLmNoYXJDb2RlQXQoaikpKSB7CgkgICAgICAgICAgICAgICAgKytqOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgaWYgKHNwYWNlcyA+IGopIHsKCSAgICAgICAgICAgICAgICBzcGFjZXMgPSBqOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgoJICAgICAgICBpZiAodHlwZW9mIHNwZWNpYWxCYXNlICE9PSAndW5kZWZpbmVkJykgewoJICAgICAgICAgICAgLy8gcGF0dGVybiBsaWtlCgkgICAgICAgICAgICAvLyB7CgkgICAgICAgICAgICAvLyAgIHZhciB0ID0gMjA7ICAvKgoJICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICogdGhpcyBpcyBjb21tZW50CgkgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgKi8KCSAgICAgICAgICAgIC8vIH0KCSAgICAgICAgICAgIHByZXZpb3VzQmFzZSA9IGJhc2U7CgkgICAgICAgICAgICBpZiAoYXJyYXlbMV1bc3BhY2VzXSA9PT0gJyonKSB7CgkgICAgICAgICAgICAgICAgc3BlY2lhbEJhc2UgKz0gJyAnOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgYmFzZSA9IHNwZWNpYWxCYXNlOwoJICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgaWYgKHNwYWNlcyAmIDEpIHsKCSAgICAgICAgICAgICAgICAvLyAvKgoJICAgICAgICAgICAgICAgIC8vICAqCgkgICAgICAgICAgICAgICAgLy8gICovCgkgICAgICAgICAgICAgICAgLy8gSWYgc3BhY2VzIGFyZSBvZGQgbnVtYmVyLCBhYm92ZSBwYXR0ZXJuIGlzIGNvbnNpZGVyZWQuCgkgICAgICAgICAgICAgICAgLy8gV2Ugd2FzdGUgMSBzcGFjZS4KCSAgICAgICAgICAgICAgICAtLXNwYWNlczsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHByZXZpb3VzQmFzZSA9IGJhc2U7CgkgICAgICAgIH0KCgkgICAgICAgIGZvciAoaSA9IDEsIGxlbiA9IGFycmF5Lmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CgkgICAgICAgICAgICBzbiA9IHRvU291cmNlTm9kZVdoZW5OZWVkZWQoYWRkSW5kZW50KGFycmF5W2ldLnNsaWNlKHNwYWNlcykpKTsKCSAgICAgICAgICAgIGFycmF5W2ldID0gc291cmNlTWFwID8gc24uam9pbignJykgOiBzbjsKCSAgICAgICAgfQoKCSAgICAgICAgYmFzZSA9IHByZXZpb3VzQmFzZTsKCgkgICAgICAgIHJldHVybiBhcnJheS5qb2luKCdcbicpOwoJICAgIH0KCgkgICAgZnVuY3Rpb24gZ2VuZXJhdGVDb21tZW50KGNvbW1lbnQsIHNwZWNpYWxCYXNlKSB7CgkgICAgICAgIGlmIChjb21tZW50LnR5cGUgPT09ICdMaW5lJykgewoJICAgICAgICAgICAgaWYgKGVuZHNXaXRoTGluZVRlcm1pbmF0b3IoY29tbWVudC52YWx1ZSkpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gJy8vJyArIGNvbW1lbnQudmFsdWU7CgkgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgIC8vIEFsd2F5cyB1c2UgTGluZVRlcm1pbmF0b3IKCSAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gJy8vJyArIGNvbW1lbnQudmFsdWU7CgkgICAgICAgICAgICAgICAgaWYgKCFwcmVzZXJ2ZUJsYW5rTGluZXMpIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICdcbic7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGV4dHJhLmZvcm1hdC5pbmRlbnQuYWRqdXN0TXVsdGlsaW5lQ29tbWVudCAmJiAvW1xuXHJdLy50ZXN0KGNvbW1lbnQudmFsdWUpKSB7CgkgICAgICAgICAgICByZXR1cm4gYWRqdXN0TXVsdGlsaW5lQ29tbWVudCgnLyonICsgY29tbWVudC52YWx1ZSArICcqLycsIHNwZWNpYWxCYXNlKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gJy8qJyArIGNvbW1lbnQudmFsdWUgKyAnKi8nOwoJICAgIH0KCgkgICAgZnVuY3Rpb24gYWRkQ29tbWVudHMoc3RtdCwgcmVzdWx0KSB7CgkgICAgICAgIHZhciBpLCBsZW4sIGNvbW1lbnQsIHNhdmUsIHRhaWxpbmdUb1N0YXRlbWVudCwgc3BlY2lhbEJhc2UsIGZyYWdtZW50LAoJICAgICAgICAgICAgZXh0UmFuZ2UsIHJhbmdlLCBwcmV2UmFuZ2UsIHByZWZpeCwgaW5maXgsIHN1ZmZpeCwgY291bnQ7CgoJICAgICAgICBpZiAoc3RtdC5sZWFkaW5nQ29tbWVudHMgJiYgc3RtdC5sZWFkaW5nQ29tbWVudHMubGVuZ3RoID4gMCkgewoJICAgICAgICAgICAgc2F2ZSA9IHJlc3VsdDsKCgkgICAgICAgICAgICBpZiAocHJlc2VydmVCbGFua0xpbmVzKSB7CgkgICAgICAgICAgICAgICAgY29tbWVudCA9IHN0bXQubGVhZGluZ0NvbW1lbnRzWzBdOwoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IFtdOwoKCSAgICAgICAgICAgICAgICBleHRSYW5nZSA9IGNvbW1lbnQuZXh0ZW5kZWRSYW5nZTsKCSAgICAgICAgICAgICAgICByYW5nZSA9IGNvbW1lbnQucmFuZ2U7CgoJICAgICAgICAgICAgICAgIHByZWZpeCA9IHNvdXJjZUNvZGUuc3Vic3RyaW5nKGV4dFJhbmdlWzBdLCByYW5nZVswXSk7CgkgICAgICAgICAgICAgICAgY291bnQgPSAocHJlZml4Lm1hdGNoKC9cbi9nKSB8fCBbXSkubGVuZ3RoOwoJICAgICAgICAgICAgICAgIGlmIChjb3VudCA+IDApIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goc3RyaW5nUmVwZWF0KCdcbicsIGNvdW50KSk7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGFkZEluZGVudChnZW5lcmF0ZUNvbW1lbnQoY29tbWVudCkpKTsKCSAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChwcmVmaXgpOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChnZW5lcmF0ZUNvbW1lbnQoY29tbWVudCkpOwoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgcHJldlJhbmdlID0gcmFuZ2U7CgoJICAgICAgICAgICAgICAgIGZvciAoaSA9IDEsIGxlbiA9IHN0bXQubGVhZGluZ0NvbW1lbnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CgkgICAgICAgICAgICAgICAgICAgIGNvbW1lbnQgPSBzdG10LmxlYWRpbmdDb21tZW50c1tpXTsKCSAgICAgICAgICAgICAgICAgICAgcmFuZ2UgPSBjb21tZW50LnJhbmdlOwoKCSAgICAgICAgICAgICAgICAgICAgaW5maXggPSBzb3VyY2VDb2RlLnN1YnN0cmluZyhwcmV2UmFuZ2VbMV0sIHJhbmdlWzBdKTsKCSAgICAgICAgICAgICAgICAgICAgY291bnQgPSAoaW5maXgubWF0Y2goL1xuL2cpIHx8IFtdKS5sZW5ndGg7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHN0cmluZ1JlcGVhdCgnXG4nLCBjb3VudCkpOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChhZGRJbmRlbnQoZ2VuZXJhdGVDb21tZW50KGNvbW1lbnQpKSk7CgoJICAgICAgICAgICAgICAgICAgICBwcmV2UmFuZ2UgPSByYW5nZTsKCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIHN1ZmZpeCA9IHNvdXJjZUNvZGUuc3Vic3RyaW5nKHJhbmdlWzFdLCBleHRSYW5nZVsxXSk7CgkgICAgICAgICAgICAgICAgY291bnQgPSAoc3VmZml4Lm1hdGNoKC9cbi9nKSB8fCBbXSkubGVuZ3RoOwoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHN0cmluZ1JlcGVhdCgnXG4nLCBjb3VudCkpOwoJICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICBjb21tZW50ID0gc3RtdC5sZWFkaW5nQ29tbWVudHNbMF07CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gW107CgkgICAgICAgICAgICAgICAgaWYgKHNhZmVDb25jYXRlbmF0aW9uICYmIHN0bXQudHlwZSA9PT0gU3ludGF4LlByb2dyYW0gJiYgc3RtdC5ib2R5Lmxlbmd0aCA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnXG4nKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goZ2VuZXJhdGVDb21tZW50KGNvbW1lbnQpKTsKCSAgICAgICAgICAgICAgICBpZiAoIWVuZHNXaXRoTGluZVRlcm1pbmF0b3IodG9Tb3VyY2VOb2RlV2hlbk5lZWRlZChyZXN1bHQpLnRvU3RyaW5nKCkpKSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCdcbicpOwoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgZm9yIChpID0gMSwgbGVuID0gc3RtdC5sZWFkaW5nQ29tbWVudHMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKCSAgICAgICAgICAgICAgICAgICAgY29tbWVudCA9IHN0bXQubGVhZGluZ0NvbW1lbnRzW2ldOwoJICAgICAgICAgICAgICAgICAgICBmcmFnbWVudCA9IFtnZW5lcmF0ZUNvbW1lbnQoY29tbWVudCldOwoJICAgICAgICAgICAgICAgICAgICBpZiAoIWVuZHNXaXRoTGluZVRlcm1pbmF0b3IodG9Tb3VyY2VOb2RlV2hlbk5lZWRlZChmcmFnbWVudCkudG9TdHJpbmcoKSkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGZyYWdtZW50LnB1c2goJ1xuJyk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goYWRkSW5kZW50KGZyYWdtZW50KSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKGFkZEluZGVudChzYXZlKSk7CgkgICAgICAgIH0KCgkgICAgICAgIGlmIChzdG10LnRyYWlsaW5nQ29tbWVudHMpIHsKCgkgICAgICAgICAgICBpZiAocHJlc2VydmVCbGFua0xpbmVzKSB7CgkgICAgICAgICAgICAgICAgY29tbWVudCA9IHN0bXQudHJhaWxpbmdDb21tZW50c1swXTsKCSAgICAgICAgICAgICAgICBleHRSYW5nZSA9IGNvbW1lbnQuZXh0ZW5kZWRSYW5nZTsKCSAgICAgICAgICAgICAgICByYW5nZSA9IGNvbW1lbnQucmFuZ2U7CgoJICAgICAgICAgICAgICAgIHByZWZpeCA9IHNvdXJjZUNvZGUuc3Vic3RyaW5nKGV4dFJhbmdlWzBdLCByYW5nZVswXSk7CgkgICAgICAgICAgICAgICAgY291bnQgPSAocHJlZml4Lm1hdGNoKC9cbi9nKSB8fCBbXSkubGVuZ3RoOwoKCSAgICAgICAgICAgICAgICBpZiAoY291bnQgPiAwKSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHN0cmluZ1JlcGVhdCgnXG4nLCBjb3VudCkpOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChhZGRJbmRlbnQoZ2VuZXJhdGVDb21tZW50KGNvbW1lbnQpKSk7CgkgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gocHJlZml4KTsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goZ2VuZXJhdGVDb21tZW50KGNvbW1lbnQpKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgIHRhaWxpbmdUb1N0YXRlbWVudCA9ICFlbmRzV2l0aExpbmVUZXJtaW5hdG9yKHRvU291cmNlTm9kZVdoZW5OZWVkZWQocmVzdWx0KS50b1N0cmluZygpKTsKCSAgICAgICAgICAgICAgICBzcGVjaWFsQmFzZSA9IHN0cmluZ1JlcGVhdCgnICcsIGNhbGN1bGF0ZVNwYWNlcyh0b1NvdXJjZU5vZGVXaGVuTmVlZGVkKFtiYXNlLCByZXN1bHQsIGluZGVudF0pLnRvU3RyaW5nKCkpKTsKCSAgICAgICAgICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSBzdG10LnRyYWlsaW5nQ29tbWVudHMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKCSAgICAgICAgICAgICAgICAgICAgY29tbWVudCA9IHN0bXQudHJhaWxpbmdDb21tZW50c1tpXTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHRhaWxpbmdUb1N0YXRlbWVudCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2UgYXNzdW1lIHRhcmdldCBsaWtlIGZvbGxvd2luZyBzY3JpcHQKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyB2YXIgdCA9IDIwOyAgLyoqCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICogVGhpcyBpcyBjb21tZW50IG9mIHQKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgKi8KCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmlyc3QgY2FzZQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IFtyZXN1bHQsIGluZGVudF07CgkgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IFtyZXN1bHQsIHNwZWNpYWxCYXNlXTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGdlbmVyYXRlQ29tbWVudChjb21tZW50LCBzcGVjaWFsQmFzZSkpOwoJICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gW3Jlc3VsdCwgYWRkSW5kZW50KGdlbmVyYXRlQ29tbWVudChjb21tZW50KSldOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGlmIChpICE9PSBsZW4gLSAxICYmICFlbmRzV2l0aExpbmVUZXJtaW5hdG9yKHRvU291cmNlTm9kZVdoZW5OZWVkZWQocmVzdWx0KS50b1N0cmluZygpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gW3Jlc3VsdCwgJ1xuJ107CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBnZW5lcmF0ZUJsYW5rTGluZXMoc3RhcnQsIGVuZCwgcmVzdWx0KSB7CgkgICAgICAgIHZhciBqLCBuZXdsaW5lQ291bnQgPSAwOwoKCSAgICAgICAgZm9yIChqID0gc3RhcnQ7IGogPCBlbmQ7IGorKykgewoJICAgICAgICAgICAgaWYgKHNvdXJjZUNvZGVbal0gPT09ICdcbicpIHsKCSAgICAgICAgICAgICAgICBuZXdsaW5lQ291bnQrKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoKCSAgICAgICAgZm9yIChqID0gMTsgaiA8IG5ld2xpbmVDb3VudDsgaisrKSB7CgkgICAgICAgICAgICByZXN1bHQucHVzaChuZXdsaW5lKTsKCSAgICAgICAgfQoJICAgIH0KCgkgICAgZnVuY3Rpb24gcGFyZW50aGVzaXplKHRleHQsIGN1cnJlbnQsIHNob3VsZCkgewoJICAgICAgICBpZiAoY3VycmVudCA8IHNob3VsZCkgewoJICAgICAgICAgICAgcmV0dXJuIFsnKCcsIHRleHQsICcpJ107CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRleHQ7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBnZW5lcmF0ZVZlcmJhdGltU3RyaW5nKHN0cmluZykgewoJICAgICAgICB2YXIgaSwgaXosIHJlc3VsdDsKCSAgICAgICAgcmVzdWx0ID0gc3RyaW5nLnNwbGl0KC9cclxufFxuLyk7CgkgICAgICAgIGZvciAoaSA9IDEsIGl6ID0gcmVzdWx0Lmxlbmd0aDsgaSA8IGl6OyBpKyspIHsKCSAgICAgICAgICAgIHJlc3VsdFtpXSA9IG5ld2xpbmUgKyBiYXNlICsgcmVzdWx0W2ldOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBnZW5lcmF0ZVZlcmJhdGltKGV4cHIsIHByZWNlZGVuY2UpIHsKCSAgICAgICAgdmFyIHZlcmJhdGltLCByZXN1bHQsIHByZWM7CgkgICAgICAgIHZlcmJhdGltID0gZXhwcltleHRyYS52ZXJiYXRpbV07CgoJICAgICAgICBpZiAodHlwZW9mIHZlcmJhdGltID09PSAnc3RyaW5nJykgewoJICAgICAgICAgICAgcmVzdWx0ID0gcGFyZW50aGVzaXplKGdlbmVyYXRlVmVyYmF0aW1TdHJpbmcodmVyYmF0aW0pLCBQcmVjZWRlbmNlLlNlcXVlbmNlLCBwcmVjZWRlbmNlKTsKCSAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgIC8vIHZlcmJhdGltIGlzIG9iamVjdAoJICAgICAgICAgICAgcmVzdWx0ID0gZ2VuZXJhdGVWZXJiYXRpbVN0cmluZyh2ZXJiYXRpbS5jb250ZW50KTsKCSAgICAgICAgICAgIHByZWMgPSAodmVyYmF0aW0ucHJlY2VkZW5jZSAhPSBudWxsKSA/IHZlcmJhdGltLnByZWNlZGVuY2UgOiBQcmVjZWRlbmNlLlNlcXVlbmNlOwoJICAgICAgICAgICAgcmVzdWx0ID0gcGFyZW50aGVzaXplKHJlc3VsdCwgcHJlYywgcHJlY2VkZW5jZSk7CgkgICAgICAgIH0KCgkgICAgICAgIHJldHVybiB0b1NvdXJjZU5vZGVXaGVuTmVlZGVkKHJlc3VsdCwgZXhwcik7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBDb2RlR2VuZXJhdG9yKCkgewoJICAgIH0KCgkgICAgLy8gSGVscGVycy4KCgkgICAgQ29kZUdlbmVyYXRvci5wcm90b3R5cGUubWF5YmVCbG9jayA9IGZ1bmN0aW9uKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgIHZhciByZXN1bHQsIG5vTGVhZGluZ0NvbW1lbnQsIHRoYXQgPSB0aGlzOwoKCSAgICAgICAgbm9MZWFkaW5nQ29tbWVudCA9ICFleHRyYS5jb21tZW50IHx8ICFzdG10LmxlYWRpbmdDb21tZW50czsKCgkgICAgICAgIGlmIChzdG10LnR5cGUgPT09IFN5bnRheC5CbG9ja1N0YXRlbWVudCAmJiBub0xlYWRpbmdDb21tZW50KSB7CgkgICAgICAgICAgICByZXR1cm4gW3NwYWNlLCB0aGlzLmdlbmVyYXRlU3RhdGVtZW50KHN0bXQsIGZsYWdzKV07CgkgICAgICAgIH0KCgkgICAgICAgIGlmIChzdG10LnR5cGUgPT09IFN5bnRheC5FbXB0eVN0YXRlbWVudCAmJiBub0xlYWRpbmdDb21tZW50KSB7CgkgICAgICAgICAgICByZXR1cm4gJzsnOwoJICAgICAgICB9CgoJICAgICAgICB3aXRoSW5kZW50KGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIHJlc3VsdCA9IFsKCSAgICAgICAgICAgICAgICBuZXdsaW5lLAoJICAgICAgICAgICAgICAgIGFkZEluZGVudCh0aGF0LmdlbmVyYXRlU3RhdGVtZW50KHN0bXQsIGZsYWdzKSkKCSAgICAgICAgICAgIF07CgkgICAgICAgIH0pOwoKCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoKCSAgICBDb2RlR2VuZXJhdG9yLnByb3RvdHlwZS5tYXliZUJsb2NrU3VmZml4ID0gZnVuY3Rpb24gKHN0bXQsIHJlc3VsdCkgewoJICAgICAgICB2YXIgZW5kcyA9IGVuZHNXaXRoTGluZVRlcm1pbmF0b3IodG9Tb3VyY2VOb2RlV2hlbk5lZWRlZChyZXN1bHQpLnRvU3RyaW5nKCkpOwoJICAgICAgICBpZiAoc3RtdC50eXBlID09PSBTeW50YXguQmxvY2tTdGF0ZW1lbnQgJiYgKCFleHRyYS5jb21tZW50IHx8ICFzdG10LmxlYWRpbmdDb21tZW50cykgJiYgIWVuZHMpIHsKCSAgICAgICAgICAgIHJldHVybiBbcmVzdWx0LCBzcGFjZV07CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGVuZHMpIHsKCSAgICAgICAgICAgIHJldHVybiBbcmVzdWx0LCBiYXNlXTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gW3Jlc3VsdCwgbmV3bGluZSwgYmFzZV07CgkgICAgfTsKCgkgICAgZnVuY3Rpb24gZ2VuZXJhdGVJZGVudGlmaWVyKG5vZGUpIHsKCSAgICAgICAgcmV0dXJuIHRvU291cmNlTm9kZVdoZW5OZWVkZWQobm9kZS5uYW1lLCBub2RlKTsKCSAgICB9CgoJICAgIGZ1bmN0aW9uIGdlbmVyYXRlQXN5bmNQcmVmaXgobm9kZSwgc3BhY2VSZXF1aXJlZCkgewoJICAgICAgICByZXR1cm4gbm9kZS5hc3luYyA/ICdhc3luYycgKyAoc3BhY2VSZXF1aXJlZCA/IG5vRW1wdHlTcGFjZSgpIDogc3BhY2UpIDogJyc7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBnZW5lcmF0ZVN0YXJTdWZmaXgobm9kZSkgewoJICAgICAgICB2YXIgaXNHZW5lcmF0b3IgPSBub2RlLmdlbmVyYXRvciAmJiAhZXh0cmEubW96LnN0YXJsZXNzR2VuZXJhdG9yOwoJICAgICAgICByZXR1cm4gaXNHZW5lcmF0b3IgPyAnKicgKyBzcGFjZSA6ICcnOwoJICAgIH0KCgkgICAgZnVuY3Rpb24gZ2VuZXJhdGVNZXRob2RQcmVmaXgocHJvcCkgewoJICAgICAgICB2YXIgZnVuYyA9IHByb3AudmFsdWUsIHByZWZpeCA9ICcnOwoJICAgICAgICBpZiAoZnVuYy5hc3luYykgewoJICAgICAgICAgICAgcHJlZml4ICs9IGdlbmVyYXRlQXN5bmNQcmVmaXgoZnVuYywgIXByb3AuY29tcHV0ZWQpOwoJICAgICAgICB9CgkgICAgICAgIGlmIChmdW5jLmdlbmVyYXRvcikgewoJICAgICAgICAgICAgLy8gYXZvaWQgc3BhY2UgYmVmb3JlIG1ldGhvZCBuYW1lCgkgICAgICAgICAgICBwcmVmaXggKz0gZ2VuZXJhdGVTdGFyU3VmZml4KGZ1bmMpID8gJyonIDogJyc7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHByZWZpeDsKCSAgICB9CgoJICAgIENvZGVHZW5lcmF0b3IucHJvdG90eXBlLmdlbmVyYXRlUGF0dGVybiA9IGZ1bmN0aW9uIChub2RlLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICBpZiAobm9kZS50eXBlID09PSBTeW50YXguSWRlbnRpZmllcikgewoJICAgICAgICAgICAgcmV0dXJuIGdlbmVyYXRlSWRlbnRpZmllcihub2RlKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24obm9kZSwgcHJlY2VkZW5jZSwgZmxhZ3MpOwoJICAgIH07CgoJICAgIENvZGVHZW5lcmF0b3IucHJvdG90eXBlLmdlbmVyYXRlRnVuY3Rpb25QYXJhbXMgPSBmdW5jdGlvbiAobm9kZSkgewoJICAgICAgICB2YXIgaSwgaXosIHJlc3VsdCwgaGFzRGVmYXVsdDsKCgkgICAgICAgIGhhc0RlZmF1bHQgPSBmYWxzZTsKCgkgICAgICAgIGlmIChub2RlLnR5cGUgPT09IFN5bnRheC5BcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbiAmJgoJICAgICAgICAgICAgICAgICFub2RlLnJlc3QgJiYgKCFub2RlLmRlZmF1bHRzIHx8IG5vZGUuZGVmYXVsdHMubGVuZ3RoID09PSAwKSAmJgoJICAgICAgICAgICAgICAgIG5vZGUucGFyYW1zLmxlbmd0aCA9PT0gMSAmJiBub2RlLnBhcmFtc1swXS50eXBlID09PSBTeW50YXguSWRlbnRpZmllcikgewoJICAgICAgICAgICAgLy8gYXJnID0+IHsgfSBjYXNlCgkgICAgICAgICAgICByZXN1bHQgPSBbZ2VuZXJhdGVBc3luY1ByZWZpeChub2RlLCB0cnVlKSwgZ2VuZXJhdGVJZGVudGlmaWVyKG5vZGUucGFyYW1zWzBdKV07CgkgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICByZXN1bHQgPSBub2RlLnR5cGUgPT09IFN5bnRheC5BcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbiA/IFtnZW5lcmF0ZUFzeW5jUHJlZml4KG5vZGUsIGZhbHNlKV0gOiBbXTsKCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKCcoJyk7CgkgICAgICAgICAgICBpZiAobm9kZS5kZWZhdWx0cykgewoJICAgICAgICAgICAgICAgIGhhc0RlZmF1bHQgPSB0cnVlOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZm9yIChpID0gMCwgaXogPSBub2RlLnBhcmFtcy5sZW5ndGg7IGkgPCBpejsgKytpKSB7CgkgICAgICAgICAgICAgICAgaWYgKGhhc0RlZmF1bHQgJiYgbm9kZS5kZWZhdWx0c1tpXSkgewoJICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgZGVmYXVsdCB2YWx1ZXMuCgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoaXMuZ2VuZXJhdGVBc3NpZ25tZW50KG5vZGUucGFyYW1zW2ldLCBub2RlLmRlZmF1bHRzW2ldLCAnPScsIFByZWNlZGVuY2UuQXNzaWdubWVudCwgRV9UVFQpKTsKCSAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh0aGlzLmdlbmVyYXRlUGF0dGVybihub2RlLnBhcmFtc1tpXSwgUHJlY2VkZW5jZS5Bc3NpZ25tZW50LCBFX1RUVCkpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBpZiAoaSArIDEgPCBpeikgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnLCcgKyBzcGFjZSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIGlmIChub2RlLnJlc3QpIHsKCSAgICAgICAgICAgICAgICBpZiAobm9kZS5wYXJhbXMubGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCcsJyArIHNwYWNlKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goJy4uLicpOwoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGdlbmVyYXRlSWRlbnRpZmllcihub2RlLnJlc3QpKTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICByZXN1bHQucHVzaCgnKScpOwoJICAgICAgICB9CgoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgoJICAgIENvZGVHZW5lcmF0b3IucHJvdG90eXBlLmdlbmVyYXRlRnVuY3Rpb25Cb2R5ID0gZnVuY3Rpb24gKG5vZGUpIHsKCSAgICAgICAgdmFyIHJlc3VsdCwgZXhwcjsKCgkgICAgICAgIHJlc3VsdCA9IHRoaXMuZ2VuZXJhdGVGdW5jdGlvblBhcmFtcyhub2RlKTsKCgkgICAgICAgIGlmIChub2RlLnR5cGUgPT09IFN5bnRheC5BcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbikgewoJICAgICAgICAgICAgcmVzdWx0LnB1c2goc3BhY2UpOwoJICAgICAgICAgICAgcmVzdWx0LnB1c2goJz0+Jyk7CgkgICAgICAgIH0KCgkgICAgICAgIGlmIChub2RlLmV4cHJlc3Npb24pIHsKCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKHNwYWNlKTsKCSAgICAgICAgICAgIGV4cHIgPSB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihub2RlLmJvZHksIFByZWNlZGVuY2UuQXNzaWdubWVudCwgRV9UVFQpOwoJICAgICAgICAgICAgaWYgKGV4cHIudG9TdHJpbmcoKS5jaGFyQXQoMCkgPT09ICd7JykgewoJICAgICAgICAgICAgICAgIGV4cHIgPSBbJygnLCBleHByLCAnKSddOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LnB1c2goZXhwcik7CgkgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICByZXN1bHQucHVzaCh0aGlzLm1heWJlQmxvY2sobm9kZS5ib2R5LCBTX1RURkYpKTsKCSAgICAgICAgfQoKCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoKCSAgICBDb2RlR2VuZXJhdG9yLnByb3RvdHlwZS5nZW5lcmF0ZUl0ZXJhdGlvbkZvclN0YXRlbWVudCA9IGZ1bmN0aW9uIChvcGVyYXRvciwgc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgdmFyIHJlc3VsdCA9IFsnZm9yJyArIChzdG10LmF3YWl0ID8gbm9FbXB0eVNwYWNlKCkgKyAnYXdhaXQnIDogJycpICsgc3BhY2UgKyAnKCddLCB0aGF0ID0gdGhpczsKCSAgICAgICAgd2l0aEluZGVudChmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAoc3RtdC5sZWZ0LnR5cGUgPT09IFN5bnRheC5WYXJpYWJsZURlY2xhcmF0aW9uKSB7CgkgICAgICAgICAgICAgICAgd2l0aEluZGVudChmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHN0bXQubGVmdC5raW5kICsgbm9FbXB0eVNwYWNlKCkpOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh0aGF0LmdlbmVyYXRlU3RhdGVtZW50KHN0bXQubGVmdC5kZWNsYXJhdGlvbnNbMF0sIFNfRkZGRikpOwoJICAgICAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh0aGF0LmdlbmVyYXRlRXhwcmVzc2lvbihzdG10LmxlZnQsIFByZWNlZGVuY2UuQ2FsbCwgRV9UVFQpKTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICByZXN1bHQgPSBqb2luKHJlc3VsdCwgb3BlcmF0b3IpOwoJICAgICAgICAgICAgcmVzdWx0ID0gW2pvaW4oCgkgICAgICAgICAgICAgICAgcmVzdWx0LAoJICAgICAgICAgICAgICAgIHRoYXQuZ2VuZXJhdGVFeHByZXNzaW9uKHN0bXQucmlnaHQsIFByZWNlZGVuY2UuQXNzaWdubWVudCwgRV9UVFQpCgkgICAgICAgICAgICApLCAnKSddOwoJICAgICAgICB9KTsKCSAgICAgICAgcmVzdWx0LnB1c2godGhpcy5tYXliZUJsb2NrKHN0bXQuYm9keSwgZmxhZ3MpKTsKCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoKCSAgICBDb2RlR2VuZXJhdG9yLnByb3RvdHlwZS5nZW5lcmF0ZVByb3BlcnR5S2V5ID0gZnVuY3Rpb24gKGV4cHIsIGNvbXB1dGVkKSB7CgkgICAgICAgIHZhciByZXN1bHQgPSBbXTsKCgkgICAgICAgIGlmIChjb21wdXRlZCkgewoJICAgICAgICAgICAgcmVzdWx0LnB1c2goJ1snKTsKCSAgICAgICAgfQoKCSAgICAgICAgcmVzdWx0LnB1c2godGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwciwgUHJlY2VkZW5jZS5Bc3NpZ25tZW50LCBFX1RUVCkpOwoKCSAgICAgICAgaWYgKGNvbXB1dGVkKSB7CgkgICAgICAgICAgICByZXN1bHQucHVzaCgnXScpOwoJICAgICAgICB9CgoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgoJICAgIENvZGVHZW5lcmF0b3IucHJvdG90eXBlLmdlbmVyYXRlQXNzaWdubWVudCA9IGZ1bmN0aW9uIChsZWZ0LCByaWdodCwgb3BlcmF0b3IsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgIGlmIChQcmVjZWRlbmNlLkFzc2lnbm1lbnQgPCBwcmVjZWRlbmNlKSB7CgkgICAgICAgICAgICBmbGFncyB8PSBGX0FMTE9XX0lOOwoJICAgICAgICB9CgoJICAgICAgICByZXR1cm4gcGFyZW50aGVzaXplKAoJICAgICAgICAgICAgWwoJICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGxlZnQsIFByZWNlZGVuY2UuQ2FsbCwgZmxhZ3MpLAoJICAgICAgICAgICAgICAgIHNwYWNlICsgb3BlcmF0b3IgKyBzcGFjZSwKCSAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihyaWdodCwgUHJlY2VkZW5jZS5Bc3NpZ25tZW50LCBmbGFncykKCSAgICAgICAgICAgIF0sCgkgICAgICAgICAgICBQcmVjZWRlbmNlLkFzc2lnbm1lbnQsCgkgICAgICAgICAgICBwcmVjZWRlbmNlCgkgICAgICAgICk7CgkgICAgfTsKCgkgICAgQ29kZUdlbmVyYXRvci5wcm90b3R5cGUuc2VtaWNvbG9uID0gZnVuY3Rpb24gKGZsYWdzKSB7CgkgICAgICAgIGlmICghc2VtaWNvbG9ucyAmJiBmbGFncyAmIEZfU0VNSUNPTE9OX09QVCkgewoJICAgICAgICAgICAgcmV0dXJuICcnOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiAnOyc7CgkgICAgfTsKCgkgICAgLy8gU3RhdGVtZW50cy4KCgkgICAgQ29kZUdlbmVyYXRvci5TdGF0ZW1lbnQgPSB7CgoJICAgICAgICBCbG9ja1N0YXRlbWVudDogZnVuY3Rpb24gKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmFuZ2UsIGNvbnRlbnQsIHJlc3VsdCA9IFsneycsIG5ld2xpbmVdLCB0aGF0ID0gdGhpczsKCgkgICAgICAgICAgICB3aXRoSW5kZW50KGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgICAgICAvLyBoYW5kbGUgZnVuY3Rpb25zIHdpdGhvdXQgYW55IGNvZGUKCSAgICAgICAgICAgICAgICBpZiAoc3RtdC5ib2R5Lmxlbmd0aCA9PT0gMCAmJiBwcmVzZXJ2ZUJsYW5rTGluZXMpIHsKCSAgICAgICAgICAgICAgICAgICAgcmFuZ2UgPSBzdG10LnJhbmdlOwoJICAgICAgICAgICAgICAgICAgICBpZiAocmFuZ2VbMV0gLSByYW5nZVswXSA+IDIpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBzb3VyY2VDb2RlLnN1YnN0cmluZyhyYW5nZVswXSArIDEsIHJhbmdlWzFdIC0gMSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udGVudFswXSA9PT0gJ1xuJykgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IFsneyddOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goY29udGVudCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIHZhciBpLCBpeiwgZnJhZ21lbnQsIGJvZHlGbGFnczsKCSAgICAgICAgICAgICAgICBib2R5RmxhZ3MgPSBTX1RGRkY7CgkgICAgICAgICAgICAgICAgaWYgKGZsYWdzICYgRl9GVU5DX0JPRFkpIHsKCSAgICAgICAgICAgICAgICAgICAgYm9keUZsYWdzIHw9IEZfRElSRUNUSVZFX0NUWDsKCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGl6ID0gc3RtdC5ib2R5Lmxlbmd0aDsgaSA8IGl6OyArK2kpIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHByZXNlcnZlQmxhbmtMaW5lcykgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gaGFuZGxlIHNwYWNlcyBiZWZvcmUgdGhlIGZpcnN0IGxpbmUKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0bXQuYm9keVswXS5sZWFkaW5nQ29tbWVudHMpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZ2UgPSBzdG10LmJvZHlbMF0ubGVhZGluZ0NvbW1lbnRzWzBdLmV4dGVuZGVkUmFuZ2U7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBzb3VyY2VDb2RlLnN1YnN0cmluZyhyYW5nZVswXSwgcmFuZ2VbMV0pOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udGVudFswXSA9PT0gJ1xuJykgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gWyd7J107CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdG10LmJvZHlbMF0ubGVhZGluZ0NvbW1lbnRzKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlQmxhbmtMaW5lcyhzdG10LnJhbmdlWzBdLCBzdG10LmJvZHlbMF0ucmFuZ2VbMF0sIHJlc3VsdCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhhbmRsZSBzcGFjZXMgYmV0d2VlbiBsaW5lcwoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPiAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdG10LmJvZHlbaSAtIDFdLnRyYWlsaW5nQ29tbWVudHMgICYmICFzdG10LmJvZHlbaV0ubGVhZGluZ0NvbW1lbnRzKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlQmxhbmtMaW5lcyhzdG10LmJvZHlbaSAtIDFdLnJhbmdlWzFdLCBzdG10LmJvZHlbaV0ucmFuZ2VbMF0sIHJlc3VsdCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PT0gaXogLSAxKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBib2R5RmxhZ3MgfD0gRl9TRU1JQ09MT05fT1BUOwoJICAgICAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgICAgICBpZiAoc3RtdC5ib2R5W2ldLmxlYWRpbmdDb21tZW50cyAmJiBwcmVzZXJ2ZUJsYW5rTGluZXMpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGZyYWdtZW50ID0gdGhhdC5nZW5lcmF0ZVN0YXRlbWVudChzdG10LmJvZHlbaV0sIGJvZHlGbGFncyk7CgkgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBmcmFnbWVudCA9IGFkZEluZGVudCh0aGF0LmdlbmVyYXRlU3RhdGVtZW50KHN0bXQuYm9keVtpXSwgYm9keUZsYWdzKSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGZyYWdtZW50KTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCFlbmRzV2l0aExpbmVUZXJtaW5hdG9yKHRvU291cmNlTm9kZVdoZW5OZWVkZWQoZnJhZ21lbnQpLnRvU3RyaW5nKCkpKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJlc2VydmVCbGFua0xpbmVzICYmIGkgPCBpeiAtIDEpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBkb24ndCBhZGQgYSBuZXcgbGluZSBpZiB0aGVyZSBhcmUgbGVhZGluZyBjb21lbnRzCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW4gdGhlIG5leHQgc3RhdGVtZW50CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdG10LmJvZHlbaSArIDFdLmxlYWRpbmdDb21tZW50cykgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChuZXdsaW5lKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ld2xpbmUpOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgICAgICBpZiAocHJlc2VydmVCbGFua0xpbmVzKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgc3BhY2VzIGFmdGVyIHRoZSBsYXN0IGxpbmUKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID09PSBpeiAtIDEpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN0bXQuYm9keVtpXS50cmFpbGluZ0NvbW1lbnRzKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlQmxhbmtMaW5lcyhzdG10LmJvZHlbaV0ucmFuZ2VbMV0sIHN0bXQucmFuZ2VbMV0sIHJlc3VsdCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSk7CgoJICAgICAgICAgICAgcmVzdWx0LnB1c2goYWRkSW5kZW50KCd9JykpOwoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfSwKCgkgICAgICAgIEJyZWFrU3RhdGVtZW50OiBmdW5jdGlvbiAoc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgICAgIGlmIChzdG10LmxhYmVsKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuICdicmVhayAnICsgc3RtdC5sYWJlbC5uYW1lICsgdGhpcy5zZW1pY29sb24oZmxhZ3MpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuICdicmVhaycgKyB0aGlzLnNlbWljb2xvbihmbGFncyk7CgkgICAgICAgIH0sCgoJICAgICAgICBDb250aW51ZVN0YXRlbWVudDogZnVuY3Rpb24gKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgICAgICBpZiAoc3RtdC5sYWJlbCkgewoJICAgICAgICAgICAgICAgIHJldHVybiAnY29udGludWUgJyArIHN0bXQubGFiZWwubmFtZSArIHRoaXMuc2VtaWNvbG9uKGZsYWdzKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiAnY29udGludWUnICsgdGhpcy5zZW1pY29sb24oZmxhZ3MpOwoJICAgICAgICB9LAoKCSAgICAgICAgQ2xhc3NCb2R5OiBmdW5jdGlvbiAoc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciByZXN1bHQgPSBbICd7JywgbmV3bGluZV0sIHRoYXQgPSB0aGlzOwoKCSAgICAgICAgICAgIHdpdGhJbmRlbnQoZnVuY3Rpb24gKGluZGVudCkgewoJICAgICAgICAgICAgICAgIHZhciBpLCBpejsKCgkgICAgICAgICAgICAgICAgZm9yIChpID0gMCwgaXogPSBzdG10LmJvZHkubGVuZ3RoOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChpbmRlbnQpOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh0aGF0LmdlbmVyYXRlRXhwcmVzc2lvbihzdG10LmJvZHlbaV0sIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKSk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChpICsgMSA8IGl6KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChuZXdsaW5lKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0pOwoKCSAgICAgICAgICAgIGlmICghZW5kc1dpdGhMaW5lVGVybWluYXRvcih0b1NvdXJjZU5vZGVXaGVuTmVlZGVkKHJlc3VsdCkudG9TdHJpbmcoKSkpIHsKCSAgICAgICAgICAgICAgICByZXN1bHQucHVzaChuZXdsaW5lKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKGJhc2UpOwoJICAgICAgICAgICAgcmVzdWx0LnB1c2goJ30nKTsKCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0sCgoJICAgICAgICBDbGFzc0RlY2xhcmF0aW9uOiBmdW5jdGlvbiAoc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciByZXN1bHQsIGZyYWdtZW50OwoJICAgICAgICAgICAgcmVzdWx0ICA9IFsnY2xhc3MnXTsKCSAgICAgICAgICAgIGlmIChzdG10LmlkKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gam9pbihyZXN1bHQsIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKHN0bXQuaWQsIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAoc3RtdC5zdXBlckNsYXNzKSB7CgkgICAgICAgICAgICAgICAgZnJhZ21lbnQgPSBqb2luKCdleHRlbmRzJywgdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oc3RtdC5zdXBlckNsYXNzLCBQcmVjZWRlbmNlLlVuYXJ5LCBFX1RUVCkpOwoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IGpvaW4ocmVzdWx0LCBmcmFnbWVudCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQucHVzaChzcGFjZSk7CgkgICAgICAgICAgICByZXN1bHQucHVzaCh0aGlzLmdlbmVyYXRlU3RhdGVtZW50KHN0bXQuYm9keSwgU19URkZUKSk7CgkgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICB9LAoKCSAgICAgICAgRGlyZWN0aXZlU3RhdGVtZW50OiBmdW5jdGlvbiAoc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgICAgIGlmIChleHRyYS5yYXcgJiYgc3RtdC5yYXcpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gc3RtdC5yYXcgKyB0aGlzLnNlbWljb2xvbihmbGFncyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gZXNjYXBlRGlyZWN0aXZlKHN0bXQuZGlyZWN0aXZlKSArIHRoaXMuc2VtaWNvbG9uKGZsYWdzKTsKCSAgICAgICAgfSwKCgkgICAgICAgIERvV2hpbGVTdGF0ZW1lbnQ6IGZ1bmN0aW9uIChzdG10LCBmbGFncykgewoJICAgICAgICAgICAgLy8gQmVjYXVzZSBgZG8gNDIgd2hpbGUgKGNvbmQpYCBpcyBTeW50YXggRXJyb3IuIFdlIG5lZWQgc2VtaWNvbG9uLgoJICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGpvaW4oJ2RvJywgdGhpcy5tYXliZUJsb2NrKHN0bXQuYm9keSwgU19URkZGKSk7CgkgICAgICAgICAgICByZXN1bHQgPSB0aGlzLm1heWJlQmxvY2tTdWZmaXgoc3RtdC5ib2R5LCByZXN1bHQpOwoJICAgICAgICAgICAgcmV0dXJuIGpvaW4ocmVzdWx0LCBbCgkgICAgICAgICAgICAgICAgJ3doaWxlJyArIHNwYWNlICsgJygnLAoJICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKHN0bXQudGVzdCwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpLAoJICAgICAgICAgICAgICAgICcpJyArIHRoaXMuc2VtaWNvbG9uKGZsYWdzKQoJICAgICAgICAgICAgXSk7CgkgICAgICAgIH0sCgoJICAgICAgICBDYXRjaENsYXVzZTogZnVuY3Rpb24gKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmVzdWx0LCB0aGF0ID0gdGhpczsKCSAgICAgICAgICAgIHdpdGhJbmRlbnQoZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgICAgIHZhciBndWFyZDsKCgkgICAgICAgICAgICAgICAgaWYgKHN0bXQucGFyYW0pIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gWwoJICAgICAgICAgICAgICAgICAgICAgICAgJ2NhdGNoJyArIHNwYWNlICsgJygnLAoJICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5nZW5lcmF0ZUV4cHJlc3Npb24oc3RtdC5wYXJhbSwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpLAoJICAgICAgICAgICAgICAgICAgICAgICAgJyknCgkgICAgICAgICAgICAgICAgICAgIF07CgoJICAgICAgICAgICAgICAgICAgICBpZiAoc3RtdC5ndWFyZCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgZ3VhcmQgPSB0aGF0LmdlbmVyYXRlRXhwcmVzc2lvbihzdG10Lmd1YXJkLCBQcmVjZWRlbmNlLlNlcXVlbmNlLCBFX1RUVCk7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuc3BsaWNlKDIsIDAsICcgaWYgJywgZ3VhcmQpOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gWydjYXRjaCddOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgcmVzdWx0LnB1c2godGhpcy5tYXliZUJsb2NrKHN0bXQuYm9keSwgU19URkZGKSk7CgkgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICB9LAoKCSAgICAgICAgRGVidWdnZXJTdGF0ZW1lbnQ6IGZ1bmN0aW9uIChzdG10LCBmbGFncykgewoJICAgICAgICAgICAgcmV0dXJuICdkZWJ1Z2dlcicgKyB0aGlzLnNlbWljb2xvbihmbGFncyk7CgkgICAgICAgIH0sCgoJICAgICAgICBFbXB0eVN0YXRlbWVudDogZnVuY3Rpb24gKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgICAgICByZXR1cm4gJzsnOwoJICAgICAgICB9LAoKCSAgICAgICAgRXhwb3J0RGVmYXVsdERlY2xhcmF0aW9uOiBmdW5jdGlvbiAoc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciByZXN1bHQgPSBbICdleHBvcnQnIF0sIGJvZHlGbGFnczsKCgkgICAgICAgICAgICBib2R5RmxhZ3MgPSAoZmxhZ3MgJiBGX1NFTUlDT0xPTl9PUFQpID8gU19URkZUIDogU19URkZGOwoKCSAgICAgICAgICAgIC8vIGV4cG9ydCBkZWZhdWx0IEhvaXN0YWJsZURlY2xhcmF0aW9uW0RlZmF1bHRdCgkgICAgICAgICAgICAvLyBleHBvcnQgZGVmYXVsdCBBc3NpZ25tZW50RXhwcmVzc2lvbltJbl0gOwoJICAgICAgICAgICAgcmVzdWx0ID0gam9pbihyZXN1bHQsICdkZWZhdWx0Jyk7CgkgICAgICAgICAgICBpZiAoaXNTdGF0ZW1lbnQoc3RtdC5kZWNsYXJhdGlvbikpIHsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSBqb2luKHJlc3VsdCwgdGhpcy5nZW5lcmF0ZVN0YXRlbWVudChzdG10LmRlY2xhcmF0aW9uLCBib2R5RmxhZ3MpKTsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gam9pbihyZXN1bHQsIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKHN0bXQuZGVjbGFyYXRpb24sIFByZWNlZGVuY2UuQXNzaWdubWVudCwgRV9UVFQpICsgdGhpcy5zZW1pY29sb24oZmxhZ3MpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0sCgoJICAgICAgICBFeHBvcnROYW1lZERlY2xhcmF0aW9uOiBmdW5jdGlvbiAoc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciByZXN1bHQgPSBbICdleHBvcnQnIF0sIGJvZHlGbGFncywgdGhhdCA9IHRoaXM7CgoJICAgICAgICAgICAgYm9keUZsYWdzID0gKGZsYWdzICYgRl9TRU1JQ09MT05fT1BUKSA/IFNfVEZGVCA6IFNfVEZGRjsKCgkgICAgICAgICAgICAvLyBleHBvcnQgVmFyaWFibGVTdGF0ZW1lbnQKCSAgICAgICAgICAgIC8vIGV4cG9ydCBEZWNsYXJhdGlvbltEZWZhdWx0XQoJICAgICAgICAgICAgaWYgKHN0bXQuZGVjbGFyYXRpb24pIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gam9pbihyZXN1bHQsIHRoaXMuZ2VuZXJhdGVTdGF0ZW1lbnQoc3RtdC5kZWNsYXJhdGlvbiwgYm9keUZsYWdzKSk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgLy8gZXhwb3J0IEV4cG9ydENsYXVzZVtOb1JlZmVyZW5jZV0gRnJvbUNsYXVzZSA7CgkgICAgICAgICAgICAvLyBleHBvcnQgRXhwb3J0Q2xhdXNlIDsKCSAgICAgICAgICAgIGlmIChzdG10LnNwZWNpZmllcnMpIHsKCSAgICAgICAgICAgICAgICBpZiAoc3RtdC5zcGVjaWZpZXJzLmxlbmd0aCA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBqb2luKHJlc3VsdCwgJ3snICsgc3BhY2UgKyAnfScpOwoJICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RtdC5zcGVjaWZpZXJzWzBdLnR5cGUgPT09IFN5bnRheC5FeHBvcnRCYXRjaFNwZWNpZmllcikgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBqb2luKHJlc3VsdCwgdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oc3RtdC5zcGVjaWZpZXJzWzBdLCBQcmVjZWRlbmNlLlNlcXVlbmNlLCBFX1RUVCkpOwoJICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGpvaW4ocmVzdWx0LCAneycpOwoJICAgICAgICAgICAgICAgICAgICB3aXRoSW5kZW50KGZ1bmN0aW9uIChpbmRlbnQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpLCBpejsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ld2xpbmUpOwoJICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMCwgaXogPSBzdG10LnNwZWNpZmllcnMubGVuZ3RoOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGluZGVudCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGhhdC5nZW5lcmF0ZUV4cHJlc3Npb24oc3RtdC5zcGVjaWZpZXJzW2ldLCBQcmVjZWRlbmNlLlNlcXVlbmNlLCBFX1RUVCkpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpICsgMSA8IGl6KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCcsJyArIG5ld2xpbmUpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgfSk7CgkgICAgICAgICAgICAgICAgICAgIGlmICghZW5kc1dpdGhMaW5lVGVybWluYXRvcih0b1NvdXJjZU5vZGVXaGVuTmVlZGVkKHJlc3VsdCkudG9TdHJpbmcoKSkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ld2xpbmUpOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGJhc2UgKyAnfScpOwoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgaWYgKHN0bXQuc291cmNlKSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGpvaW4ocmVzdWx0LCBbCgkgICAgICAgICAgICAgICAgICAgICAgICAnZnJvbScgKyBzcGFjZSwKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1vZHVsZVNwZWNpZmllcgoJICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oc3RtdC5zb3VyY2UsIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKSwKCSAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VtaWNvbG9uKGZsYWdzKQoJICAgICAgICAgICAgICAgICAgICBdKTsKCSAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh0aGlzLnNlbWljb2xvbihmbGFncykpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0sCgoJICAgICAgICBFeHBvcnRBbGxEZWNsYXJhdGlvbjogZnVuY3Rpb24gKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgICAgICAvLyBleHBvcnQgKiBGcm9tQ2xhdXNlIDsKCSAgICAgICAgICAgIHJldHVybiBbCgkgICAgICAgICAgICAgICAgJ2V4cG9ydCcgKyBzcGFjZSwKCSAgICAgICAgICAgICAgICAnKicgKyBzcGFjZSwKCSAgICAgICAgICAgICAgICAnZnJvbScgKyBzcGFjZSwKCSAgICAgICAgICAgICAgICAvLyBNb2R1bGVTcGVjaWZpZXIKCSAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihzdG10LnNvdXJjZSwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpLAoJICAgICAgICAgICAgICAgIHRoaXMuc2VtaWNvbG9uKGZsYWdzKQoJICAgICAgICAgICAgXTsKCSAgICAgICAgfSwKCgkgICAgICAgIEV4cHJlc3Npb25TdGF0ZW1lbnQ6IGZ1bmN0aW9uIChzdG10LCBmbGFncykgewoJICAgICAgICAgICAgdmFyIHJlc3VsdCwgZnJhZ21lbnQ7CgoJICAgICAgICAgICAgZnVuY3Rpb24gaXNDbGFzc1ByZWZpeGVkKGZyYWdtZW50KSB7CgkgICAgICAgICAgICAgICAgdmFyIGNvZGU7CgkgICAgICAgICAgICAgICAgaWYgKGZyYWdtZW50LnNsaWNlKDAsIDUpICE9PSAnY2xhc3MnKSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgY29kZSA9IGZyYWdtZW50LmNoYXJDb2RlQXQoNSk7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGNvZGUgPT09IDB4N0IgIC8qICd7JyAqLyB8fCBlc3V0aWxzLmNvZGUuaXNXaGl0ZVNwYWNlKGNvZGUpIHx8IGVzdXRpbHMuY29kZS5pc0xpbmVUZXJtaW5hdG9yKGNvZGUpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIGZ1bmN0aW9uIGlzRnVuY3Rpb25QcmVmaXhlZChmcmFnbWVudCkgewoJICAgICAgICAgICAgICAgIHZhciBjb2RlOwoJICAgICAgICAgICAgICAgIGlmIChmcmFnbWVudC5zbGljZSgwLCA4KSAhPT0gJ2Z1bmN0aW9uJykgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGNvZGUgPSBmcmFnbWVudC5jaGFyQ29kZUF0KDgpOwoJICAgICAgICAgICAgICAgIHJldHVybiBjb2RlID09PSAweDI4IC8qICcoJyAqLyB8fCBlc3V0aWxzLmNvZGUuaXNXaGl0ZVNwYWNlKGNvZGUpIHx8IGNvZGUgPT09IDB4MkEgIC8qICcqJyAqLyB8fCBlc3V0aWxzLmNvZGUuaXNMaW5lVGVybWluYXRvcihjb2RlKTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICBmdW5jdGlvbiBpc0FzeW5jUHJlZml4ZWQoZnJhZ21lbnQpIHsKCSAgICAgICAgICAgICAgICB2YXIgY29kZSwgaSwgaXo7CgkgICAgICAgICAgICAgICAgaWYgKGZyYWdtZW50LnNsaWNlKDAsIDUpICE9PSAnYXN5bmMnKSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKCFlc3V0aWxzLmNvZGUuaXNXaGl0ZVNwYWNlKGZyYWdtZW50LmNoYXJDb2RlQXQoNSkpKSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZm9yIChpID0gNiwgaXogPSBmcmFnbWVudC5sZW5ndGg7IGkgPCBpejsgKytpKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmICghZXN1dGlscy5jb2RlLmlzV2hpdGVTcGFjZShmcmFnbWVudC5jaGFyQ29kZUF0KGkpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKGkgPT09IGl6KSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKGZyYWdtZW50LnNsaWNlKGksIGkgKyA4KSAhPT0gJ2Z1bmN0aW9uJykgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGNvZGUgPSBmcmFnbWVudC5jaGFyQ29kZUF0KGkgKyA4KTsKCSAgICAgICAgICAgICAgICByZXR1cm4gY29kZSA9PT0gMHgyOCAvKiAnKCcgKi8gfHwgZXN1dGlscy5jb2RlLmlzV2hpdGVTcGFjZShjb2RlKSB8fCBjb2RlID09PSAweDJBICAvKiAnKicgKi8gfHwgZXN1dGlscy5jb2RlLmlzTGluZVRlcm1pbmF0b3IoY29kZSk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgcmVzdWx0ID0gW3RoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKHN0bXQuZXhwcmVzc2lvbiwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpXTsKCSAgICAgICAgICAgIC8vIDEyLjQgJ3snLCAnZnVuY3Rpb24nLCAnY2xhc3MnIGlzIG5vdCBhbGxvd2VkIGluIHRoaXMgcG9zaXRpb24uCgkgICAgICAgICAgICAvLyB3cmFwIGV4cHJlc3Npb24gd2l0aCBwYXJlbnRoZXNlcwoJICAgICAgICAgICAgZnJhZ21lbnQgPSB0b1NvdXJjZU5vZGVXaGVuTmVlZGVkKHJlc3VsdCkudG9TdHJpbmcoKTsKCSAgICAgICAgICAgIGlmIChmcmFnbWVudC5jaGFyQ29kZUF0KDApID09PSAweDdCICAvKiAneycgKi8gfHwgIC8vIE9iamVjdEV4cHJlc3Npb24KCSAgICAgICAgICAgICAgICAgICAgaXNDbGFzc1ByZWZpeGVkKGZyYWdtZW50KSB8fAoJICAgICAgICAgICAgICAgICAgICBpc0Z1bmN0aW9uUHJlZml4ZWQoZnJhZ21lbnQpIHx8CgkgICAgICAgICAgICAgICAgICAgIGlzQXN5bmNQcmVmaXhlZChmcmFnbWVudCkgfHwKCSAgICAgICAgICAgICAgICAgICAgKGRpcmVjdGl2ZSAmJiAoZmxhZ3MgJiBGX0RJUkVDVElWRV9DVFgpICYmIHN0bXQuZXhwcmVzc2lvbi50eXBlID09PSBTeW50YXguTGl0ZXJhbCAmJiB0eXBlb2Ygc3RtdC5leHByZXNzaW9uLnZhbHVlID09PSAnc3RyaW5nJykpIHsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSBbJygnLCByZXN1bHQsICcpJyArIHRoaXMuc2VtaWNvbG9uKGZsYWdzKV07CgkgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoaXMuc2VtaWNvbG9uKGZsYWdzKSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICB9LAoKCSAgICAgICAgSW1wb3J0RGVjbGFyYXRpb246IGZ1bmN0aW9uIChzdG10LCBmbGFncykgewoJICAgICAgICAgICAgLy8gRVM2OiAxNS4yLjEgdmFsaWQgaW1wb3J0IGRlY2xhcmF0aW9uczoKCSAgICAgICAgICAgIC8vICAgICAtIGltcG9ydCBJbXBvcnRDbGF1c2UgRnJvbUNsYXVzZSA7CgkgICAgICAgICAgICAvLyAgICAgLSBpbXBvcnQgTW9kdWxlU3BlY2lmaWVyIDsKCSAgICAgICAgICAgIHZhciByZXN1bHQsIGN1cnNvciwgdGhhdCA9IHRoaXM7CgoJICAgICAgICAgICAgLy8gSWYgbm8gSW1wb3J0Q2xhdXNlIGlzIHByZXNlbnQsCgkgICAgICAgICAgICAvLyB0aGlzIHNob3VsZCBiZSBgaW1wb3J0IE1vZHVsZVNwZWNpZmllcmAgc28gc2tpcCBgZnJvbWAKCSAgICAgICAgICAgIC8vIE1vZHVsZVNwZWNpZmllciBpcyBTdHJpbmdMaXRlcmFsLgoJICAgICAgICAgICAgaWYgKHN0bXQuc3BlY2lmaWVycy5sZW5ndGggPT09IDApIHsKCSAgICAgICAgICAgICAgICAvLyBpbXBvcnQgTW9kdWxlU3BlY2lmaWVyIDsKCSAgICAgICAgICAgICAgICByZXR1cm4gWwoJICAgICAgICAgICAgICAgICAgICAnaW1wb3J0JywKCSAgICAgICAgICAgICAgICAgICAgc3BhY2UsCgkgICAgICAgICAgICAgICAgICAgIC8vIE1vZHVsZVNwZWNpZmllcgoJICAgICAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihzdG10LnNvdXJjZSwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpLAoJICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbWljb2xvbihmbGFncykKCSAgICAgICAgICAgICAgICBdOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIC8vIGltcG9ydCBJbXBvcnRDbGF1c2UgRnJvbUNsYXVzZSA7CgkgICAgICAgICAgICByZXN1bHQgPSBbCgkgICAgICAgICAgICAgICAgJ2ltcG9ydCcKCSAgICAgICAgICAgIF07CgkgICAgICAgICAgICBjdXJzb3IgPSAwOwoKCSAgICAgICAgICAgIC8vIEltcG9ydGVkQmluZGluZwoJICAgICAgICAgICAgaWYgKHN0bXQuc3BlY2lmaWVyc1tjdXJzb3JdLnR5cGUgPT09IFN5bnRheC5JbXBvcnREZWZhdWx0U3BlY2lmaWVyKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gam9pbihyZXN1bHQsIFsKCSAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKHN0bXQuc3BlY2lmaWVyc1tjdXJzb3JdLCBQcmVjZWRlbmNlLlNlcXVlbmNlLCBFX1RUVCkKCSAgICAgICAgICAgICAgICBdKTsKCSAgICAgICAgICAgICAgICArK2N1cnNvcjsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICBpZiAoc3RtdC5zcGVjaWZpZXJzW2N1cnNvcl0pIHsKCSAgICAgICAgICAgICAgICBpZiAoY3Vyc29yICE9PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCcsJyk7CgkgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICBpZiAoc3RtdC5zcGVjaWZpZXJzW2N1cnNvcl0udHlwZSA9PT0gU3ludGF4LkltcG9ydE5hbWVzcGFjZVNwZWNpZmllcikgewoJICAgICAgICAgICAgICAgICAgICAvLyBOYW1lU3BhY2VJbXBvcnQKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gam9pbihyZXN1bHQsIFsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGFjZSwKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihzdG10LnNwZWNpZmllcnNbY3Vyc29yXSwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpCgkgICAgICAgICAgICAgICAgICAgIF0pOwoJICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIE5hbWVkSW1wb3J0cwoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChzcGFjZSArICd7Jyk7CgoJICAgICAgICAgICAgICAgICAgICBpZiAoKHN0bXQuc3BlY2lmaWVycy5sZW5ndGggLSBjdXJzb3IpID09PSAxKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBpbXBvcnQgeyAuLi4gfSBmcm9tICIuLi4iOwoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goc3BhY2UpOwoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oc3RtdC5zcGVjaWZpZXJzW2N1cnNvcl0sIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKSk7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChzcGFjZSArICd9JyArIHNwYWNlKTsKCSAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGltcG9ydCB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAuLi4sCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAuLi4sCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyB9IGZyb20gIi4uLiI7CgkgICAgICAgICAgICAgICAgICAgICAgICB3aXRoSW5kZW50KGZ1bmN0aW9uIChpbmRlbnQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSwgaXo7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3bGluZSk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gY3Vyc29yLCBpeiA9IHN0bXQuc3BlY2lmaWVycy5sZW5ndGg7IGkgPCBpejsgKytpKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGluZGVudCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoYXQuZ2VuZXJhdGVFeHByZXNzaW9uKHN0bXQuc3BlY2lmaWVyc1tpXSwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgKyAxIDwgaXopIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCcsJyArIG5ld2xpbmUpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVuZHNXaXRoTGluZVRlcm1pbmF0b3IodG9Tb3VyY2VOb2RlV2hlbk5lZWRlZChyZXN1bHQpLnRvU3RyaW5nKCkpKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3bGluZSk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChiYXNlICsgJ30nICsgc3BhY2UpOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIHJlc3VsdCA9IGpvaW4ocmVzdWx0LCBbCgkgICAgICAgICAgICAgICAgJ2Zyb20nICsgc3BhY2UsCgkgICAgICAgICAgICAgICAgLy8gTW9kdWxlU3BlY2lmaWVyCgkgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oc3RtdC5zb3VyY2UsIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKSwKCSAgICAgICAgICAgICAgICB0aGlzLnNlbWljb2xvbihmbGFncykKCSAgICAgICAgICAgIF0pOwoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfSwKCgkgICAgICAgIFZhcmlhYmxlRGVjbGFyYXRvcjogZnVuY3Rpb24gKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgaXRlbUZsYWdzID0gKGZsYWdzICYgRl9BTExPV19JTikgPyBFX1RUVCA6IEVfRlRUOwoJICAgICAgICAgICAgaWYgKHN0bXQuaW5pdCkgewoJICAgICAgICAgICAgICAgIHJldHVybiBbCgkgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKHN0bXQuaWQsIFByZWNlZGVuY2UuQXNzaWdubWVudCwgaXRlbUZsYWdzKSwKCSAgICAgICAgICAgICAgICAgICAgc3BhY2UsCgkgICAgICAgICAgICAgICAgICAgICc9JywKCSAgICAgICAgICAgICAgICAgICAgc3BhY2UsCgkgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKHN0bXQuaW5pdCwgUHJlY2VkZW5jZS5Bc3NpZ25tZW50LCBpdGVtRmxhZ3MpCgkgICAgICAgICAgICAgICAgXTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlUGF0dGVybihzdG10LmlkLCBQcmVjZWRlbmNlLkFzc2lnbm1lbnQsIGl0ZW1GbGFncyk7CgkgICAgICAgIH0sCgoJICAgICAgICBWYXJpYWJsZURlY2xhcmF0aW9uOiBmdW5jdGlvbiAoc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgICAgIC8vIFZhcmlhYmxlRGVjbGFyYXRvciBpcyB0eXBlZCBhcyBTdGF0ZW1lbnQsCgkgICAgICAgICAgICAvLyBidXQgam9pbmVkIHdpdGggY29tbWEgKG5vdCBMaW5lVGVybWluYXRvcikuCgkgICAgICAgICAgICAvLyBTbyBpZiBjb21tZW50IGlzIGF0dGFjaGVkIHRvIHRhcmdldCBub2RlLCB3ZSBzaG91bGQgc3BlY2lhbGl6ZS4KCSAgICAgICAgICAgIHZhciByZXN1bHQsIGksIGl6LCBub2RlLCBib2R5RmxhZ3MsIHRoYXQgPSB0aGlzOwoKCSAgICAgICAgICAgIHJlc3VsdCA9IFsgc3RtdC5raW5kIF07CgoJICAgICAgICAgICAgYm9keUZsYWdzID0gKGZsYWdzICYgRl9BTExPV19JTikgPyBTX1RGRkYgOiBTX0ZGRkY7CgoJICAgICAgICAgICAgZnVuY3Rpb24gYmxvY2soKSB7CgkgICAgICAgICAgICAgICAgbm9kZSA9IHN0bXQuZGVjbGFyYXRpb25zWzBdOwoJICAgICAgICAgICAgICAgIGlmIChleHRyYS5jb21tZW50ICYmIG5vZGUubGVhZGluZ0NvbW1lbnRzKSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCdcbicpOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChhZGRJbmRlbnQodGhhdC5nZW5lcmF0ZVN0YXRlbWVudChub2RlLCBib2R5RmxhZ3MpKSk7CgkgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobm9FbXB0eVNwYWNlKCkpOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh0aGF0LmdlbmVyYXRlU3RhdGVtZW50KG5vZGUsIGJvZHlGbGFncykpOwoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgZm9yIChpID0gMSwgaXogPSBzdG10LmRlY2xhcmF0aW9ucy5sZW5ndGg7IGkgPCBpejsgKytpKSB7CgkgICAgICAgICAgICAgICAgICAgIG5vZGUgPSBzdG10LmRlY2xhcmF0aW9uc1tpXTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKGV4dHJhLmNvbW1lbnQgJiYgbm9kZS5sZWFkaW5nQ29tbWVudHMpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCcsJyArIG5ld2xpbmUpOwoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goYWRkSW5kZW50KHRoYXQuZ2VuZXJhdGVTdGF0ZW1lbnQobm9kZSwgYm9keUZsYWdzKSkpOwoJICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goJywnICsgc3BhY2UpOwoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGhhdC5nZW5lcmF0ZVN0YXRlbWVudChub2RlLCBib2R5RmxhZ3MpKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICBpZiAoc3RtdC5kZWNsYXJhdGlvbnMubGVuZ3RoID4gMSkgewoJICAgICAgICAgICAgICAgIHdpdGhJbmRlbnQoYmxvY2spOwoJICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICBibG9jaygpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoaXMuc2VtaWNvbG9uKGZsYWdzKSk7CgoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfSwKCgkgICAgICAgIFRocm93U3RhdGVtZW50OiBmdW5jdGlvbiAoc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHJldHVybiBbam9pbigKCSAgICAgICAgICAgICAgICAndGhyb3cnLAoJICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKHN0bXQuYXJndW1lbnQsIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKQoJICAgICAgICAgICAgKSwgdGhpcy5zZW1pY29sb24oZmxhZ3MpXTsKCSAgICAgICAgfSwKCgkgICAgICAgIFRyeVN0YXRlbWVudDogZnVuY3Rpb24gKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmVzdWx0LCBpLCBpeiwgZ3VhcmRlZEhhbmRsZXJzOwoKCSAgICAgICAgICAgIHJlc3VsdCA9IFsndHJ5JywgdGhpcy5tYXliZUJsb2NrKHN0bXQuYmxvY2ssIFNfVEZGRildOwoJICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5tYXliZUJsb2NrU3VmZml4KHN0bXQuYmxvY2ssIHJlc3VsdCk7CgoJICAgICAgICAgICAgaWYgKHN0bXQuaGFuZGxlcnMpIHsKCSAgICAgICAgICAgICAgICAvLyBvbGQgaW50ZXJmYWNlCgkgICAgICAgICAgICAgICAgZm9yIChpID0gMCwgaXogPSBzdG10LmhhbmRsZXJzLmxlbmd0aDsgaSA8IGl6OyArK2kpIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gam9pbihyZXN1bHQsIHRoaXMuZ2VuZXJhdGVTdGF0ZW1lbnQoc3RtdC5oYW5kbGVyc1tpXSwgU19URkZGKSk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChzdG10LmZpbmFsaXplciB8fCBpICsgMSAhPT0gaXopIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMubWF5YmVCbG9ja1N1ZmZpeChzdG10LmhhbmRsZXJzW2ldLmJvZHksIHJlc3VsdCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgIGd1YXJkZWRIYW5kbGVycyA9IHN0bXQuZ3VhcmRlZEhhbmRsZXJzIHx8IFtdOwoKCSAgICAgICAgICAgICAgICBmb3IgKGkgPSAwLCBpeiA9IGd1YXJkZWRIYW5kbGVycy5sZW5ndGg7IGkgPCBpejsgKytpKSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGpvaW4ocmVzdWx0LCB0aGlzLmdlbmVyYXRlU3RhdGVtZW50KGd1YXJkZWRIYW5kbGVyc1tpXSwgU19URkZGKSk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChzdG10LmZpbmFsaXplciB8fCBpICsgMSAhPT0gaXopIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMubWF5YmVCbG9ja1N1ZmZpeChndWFyZGVkSGFuZGxlcnNbaV0uYm9keSwgcmVzdWx0KTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgLy8gbmV3IGludGVyZmFjZQoJICAgICAgICAgICAgICAgIGlmIChzdG10LmhhbmRsZXIpIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc3RtdC5oYW5kbGVyKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMCwgaXogPSBzdG10LmhhbmRsZXIubGVuZ3RoOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGpvaW4ocmVzdWx0LCB0aGlzLmdlbmVyYXRlU3RhdGVtZW50KHN0bXQuaGFuZGxlcltpXSwgU19URkZGKSk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0bXQuZmluYWxpemVyIHx8IGkgKyAxICE9PSBpeikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLm1heWJlQmxvY2tTdWZmaXgoc3RtdC5oYW5kbGVyW2ldLmJvZHksIHJlc3VsdCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gam9pbihyZXN1bHQsIHRoaXMuZ2VuZXJhdGVTdGF0ZW1lbnQoc3RtdC5oYW5kbGVyLCBTX1RGRkYpKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdG10LmZpbmFsaXplcikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMubWF5YmVCbG9ja1N1ZmZpeChzdG10LmhhbmRsZXIuYm9keSwgcmVzdWx0KTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChzdG10LmZpbmFsaXplcikgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IGpvaW4ocmVzdWx0LCBbJ2ZpbmFsbHknLCB0aGlzLm1heWJlQmxvY2soc3RtdC5maW5hbGl6ZXIsIFNfVEZGRildKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0sCgoJICAgICAgICBTd2l0Y2hTdGF0ZW1lbnQ6IGZ1bmN0aW9uIChzdG10LCBmbGFncykgewoJICAgICAgICAgICAgdmFyIHJlc3VsdCwgZnJhZ21lbnQsIGksIGl6LCBib2R5RmxhZ3MsIHRoYXQgPSB0aGlzOwoJICAgICAgICAgICAgd2l0aEluZGVudChmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gWwoJICAgICAgICAgICAgICAgICAgICAnc3dpdGNoJyArIHNwYWNlICsgJygnLAoJICAgICAgICAgICAgICAgICAgICB0aGF0LmdlbmVyYXRlRXhwcmVzc2lvbihzdG10LmRpc2NyaW1pbmFudCwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpLAoJICAgICAgICAgICAgICAgICAgICAnKScgKyBzcGFjZSArICd7JyArIG5ld2xpbmUKCSAgICAgICAgICAgICAgICBdOwoJICAgICAgICAgICAgfSk7CgkgICAgICAgICAgICBpZiAoc3RtdC5jYXNlcykgewoJICAgICAgICAgICAgICAgIGJvZHlGbGFncyA9IFNfVEZGRjsKCSAgICAgICAgICAgICAgICBmb3IgKGkgPSAwLCBpeiA9IHN0bXQuY2FzZXMubGVuZ3RoOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PT0gaXogLSAxKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBib2R5RmxhZ3MgfD0gRl9TRU1JQ09MT05fT1BUOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGZyYWdtZW50ID0gYWRkSW5kZW50KHRoaXMuZ2VuZXJhdGVTdGF0ZW1lbnQoc3RtdC5jYXNlc1tpXSwgYm9keUZsYWdzKSk7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGZyYWdtZW50KTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCFlbmRzV2l0aExpbmVUZXJtaW5hdG9yKHRvU291cmNlTm9kZVdoZW5OZWVkZWQoZnJhZ21lbnQpLnRvU3RyaW5nKCkpKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChuZXdsaW5lKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKGFkZEluZGVudCgnfScpKTsKCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0sCgoJICAgICAgICBTd2l0Y2hDYXNlOiBmdW5jdGlvbiAoc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciByZXN1bHQsIGZyYWdtZW50LCBpLCBpeiwgYm9keUZsYWdzLCB0aGF0ID0gdGhpczsKCSAgICAgICAgICAgIHdpdGhJbmRlbnQoZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgICAgIGlmIChzdG10LnRlc3QpIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gWwoJICAgICAgICAgICAgICAgICAgICAgICAgam9pbignY2FzZScsIHRoYXQuZ2VuZXJhdGVFeHByZXNzaW9uKHN0bXQudGVzdCwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpKSwKCSAgICAgICAgICAgICAgICAgICAgICAgICc6JwoJICAgICAgICAgICAgICAgICAgICBdOwoJICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IFsnZGVmYXVsdDonXTsKCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIGkgPSAwOwoJICAgICAgICAgICAgICAgIGl6ID0gc3RtdC5jb25zZXF1ZW50Lmxlbmd0aDsKCSAgICAgICAgICAgICAgICBpZiAoaXogJiYgc3RtdC5jb25zZXF1ZW50WzBdLnR5cGUgPT09IFN5bnRheC5CbG9ja1N0YXRlbWVudCkgewoJICAgICAgICAgICAgICAgICAgICBmcmFnbWVudCA9IHRoYXQubWF5YmVCbG9jayhzdG10LmNvbnNlcXVlbnRbMF0sIFNfVEZGRik7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGZyYWdtZW50KTsKCSAgICAgICAgICAgICAgICAgICAgaSA9IDE7CgkgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICBpZiAoaSAhPT0gaXogJiYgIWVuZHNXaXRoTGluZVRlcm1pbmF0b3IodG9Tb3VyY2VOb2RlV2hlbk5lZWRlZChyZXN1bHQpLnRvU3RyaW5nKCkpKSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ld2xpbmUpOwoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgYm9keUZsYWdzID0gU19URkZGOwoJICAgICAgICAgICAgICAgIGZvciAoOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PT0gaXogLSAxICYmIGZsYWdzICYgRl9TRU1JQ09MT05fT1BUKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBib2R5RmxhZ3MgfD0gRl9TRU1JQ09MT05fT1BUOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGZyYWdtZW50ID0gYWRkSW5kZW50KHRoYXQuZ2VuZXJhdGVTdGF0ZW1lbnQoc3RtdC5jb25zZXF1ZW50W2ldLCBib2R5RmxhZ3MpKTsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goZnJhZ21lbnQpOwoJICAgICAgICAgICAgICAgICAgICBpZiAoaSArIDEgIT09IGl6ICYmICFlbmRzV2l0aExpbmVUZXJtaW5hdG9yKHRvU291cmNlTm9kZVdoZW5OZWVkZWQoZnJhZ21lbnQpLnRvU3RyaW5nKCkpKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChuZXdsaW5lKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfSwKCgkgICAgICAgIElmU3RhdGVtZW50OiBmdW5jdGlvbiAoc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciByZXN1bHQsIGJvZHlGbGFncywgc2VtaWNvbG9uT3B0aW9uYWwsIHRoYXQgPSB0aGlzOwoJICAgICAgICAgICAgd2l0aEluZGVudChmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gWwoJICAgICAgICAgICAgICAgICAgICAnaWYnICsgc3BhY2UgKyAnKCcsCgkgICAgICAgICAgICAgICAgICAgIHRoYXQuZ2VuZXJhdGVFeHByZXNzaW9uKHN0bXQudGVzdCwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpLAoJICAgICAgICAgICAgICAgICAgICAnKScKCSAgICAgICAgICAgICAgICBdOwoJICAgICAgICAgICAgfSk7CgkgICAgICAgICAgICBzZW1pY29sb25PcHRpb25hbCA9IGZsYWdzICYgRl9TRU1JQ09MT05fT1BUOwoJICAgICAgICAgICAgYm9keUZsYWdzID0gU19URkZGOwoJICAgICAgICAgICAgaWYgKHNlbWljb2xvbk9wdGlvbmFsKSB7CgkgICAgICAgICAgICAgICAgYm9keUZsYWdzIHw9IEZfU0VNSUNPTE9OX09QVDsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChzdG10LmFsdGVybmF0ZSkgewoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoaXMubWF5YmVCbG9jayhzdG10LmNvbnNlcXVlbnQsIFNfVEZGRikpOwoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMubWF5YmVCbG9ja1N1ZmZpeChzdG10LmNvbnNlcXVlbnQsIHJlc3VsdCk7CgkgICAgICAgICAgICAgICAgaWYgKHN0bXQuYWx0ZXJuYXRlLnR5cGUgPT09IFN5bnRheC5JZlN0YXRlbWVudCkgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBqb2luKHJlc3VsdCwgWydlbHNlICcsIHRoaXMuZ2VuZXJhdGVTdGF0ZW1lbnQoc3RtdC5hbHRlcm5hdGUsIGJvZHlGbGFncyldKTsKCSAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBqb2luKHJlc3VsdCwgam9pbignZWxzZScsIHRoaXMubWF5YmVCbG9jayhzdG10LmFsdGVybmF0ZSwgYm9keUZsYWdzKSkpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGhpcy5tYXliZUJsb2NrKHN0bXQuY29uc2VxdWVudCwgYm9keUZsYWdzKSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICB9LAoKCSAgICAgICAgRm9yU3RhdGVtZW50OiBmdW5jdGlvbiAoc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciByZXN1bHQsIHRoYXQgPSB0aGlzOwoJICAgICAgICAgICAgd2l0aEluZGVudChmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gWydmb3InICsgc3BhY2UgKyAnKCddOwoJICAgICAgICAgICAgICAgIGlmIChzdG10LmluaXQpIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHN0bXQuaW5pdC50eXBlID09PSBTeW50YXguVmFyaWFibGVEZWNsYXJhdGlvbikgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGhhdC5nZW5lcmF0ZVN0YXRlbWVudChzdG10LmluaXQsIFNfRkZGRikpOwoJICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gRl9BTExPV19JTiBiZWNvbWVzIGZhbHNlLgoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGhhdC5nZW5lcmF0ZUV4cHJlc3Npb24oc3RtdC5pbml0LCBQcmVjZWRlbmNlLlNlcXVlbmNlLCBFX0ZUVCkpOwoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goJzsnKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCc7Jyk7CgkgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICBpZiAoc3RtdC50ZXN0KSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHNwYWNlKTsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGhhdC5nZW5lcmF0ZUV4cHJlc3Npb24oc3RtdC50ZXN0LCBQcmVjZWRlbmNlLlNlcXVlbmNlLCBFX1RUVCkpOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnOycpOwoJICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCc7Jyk7CgkgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICBpZiAoc3RtdC51cGRhdGUpIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goc3BhY2UpOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh0aGF0LmdlbmVyYXRlRXhwcmVzc2lvbihzdG10LnVwZGF0ZSwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpKTsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goJyknKTsKCSAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnKScpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0pOwoKCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoaXMubWF5YmVCbG9jayhzdG10LmJvZHksIGZsYWdzICYgRl9TRU1JQ09MT05fT1BUID8gU19URkZUIDogU19URkZGKSk7CgkgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICB9LAoKCSAgICAgICAgRm9ySW5TdGF0ZW1lbnQ6IGZ1bmN0aW9uIChzdG10LCBmbGFncykgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVJdGVyYXRpb25Gb3JTdGF0ZW1lbnQoJ2luJywgc3RtdCwgZmxhZ3MgJiBGX1NFTUlDT0xPTl9PUFQgPyBTX1RGRlQgOiBTX1RGRkYpOwoJICAgICAgICB9LAoKCSAgICAgICAgRm9yT2ZTdGF0ZW1lbnQ6IGZ1bmN0aW9uIChzdG10LCBmbGFncykgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVJdGVyYXRpb25Gb3JTdGF0ZW1lbnQoJ29mJywgc3RtdCwgZmxhZ3MgJiBGX1NFTUlDT0xPTl9PUFQgPyBTX1RGRlQgOiBTX1RGRkYpOwoJICAgICAgICB9LAoKCSAgICAgICAgTGFiZWxlZFN0YXRlbWVudDogZnVuY3Rpb24gKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgICAgICByZXR1cm4gW3N0bXQubGFiZWwubmFtZSArICc6JywgdGhpcy5tYXliZUJsb2NrKHN0bXQuYm9keSwgZmxhZ3MgJiBGX1NFTUlDT0xPTl9PUFQgPyBTX1RGRlQgOiBTX1RGRkYpXTsKCSAgICAgICAgfSwKCgkgICAgICAgIFByb2dyYW06IGZ1bmN0aW9uIChzdG10LCBmbGFncykgewoJICAgICAgICAgICAgdmFyIHJlc3VsdCwgZnJhZ21lbnQsIGksIGl6LCBib2R5RmxhZ3M7CgkgICAgICAgICAgICBpeiA9IHN0bXQuYm9keS5sZW5ndGg7CgkgICAgICAgICAgICByZXN1bHQgPSBbc2FmZUNvbmNhdGVuYXRpb24gJiYgaXogPiAwID8gJ1xuJyA6ICcnXTsKCSAgICAgICAgICAgIGJvZHlGbGFncyA9IFNfVEZURjsKCSAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBpejsgKytpKSB7CgkgICAgICAgICAgICAgICAgaWYgKCFzYWZlQ29uY2F0ZW5hdGlvbiAmJiBpID09PSBpeiAtIDEpIHsKCSAgICAgICAgICAgICAgICAgICAgYm9keUZsYWdzIHw9IEZfU0VNSUNPTE9OX09QVDsKCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIGlmIChwcmVzZXJ2ZUJsYW5rTGluZXMpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gaGFuZGxlIHNwYWNlcyBiZWZvcmUgdGhlIGZpcnN0IGxpbmUKCSAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT09IDApIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc3RtdC5ib2R5WzBdLmxlYWRpbmdDb21tZW50cykgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlQmxhbmtMaW5lcyhzdG10LnJhbmdlWzBdLCBzdG10LmJvZHlbaV0ucmFuZ2VbMF0sIHJlc3VsdCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgICAgIC8vIGhhbmRsZSBzcGFjZXMgYmV0d2VlbiBsaW5lcwoJICAgICAgICAgICAgICAgICAgICBpZiAoaSA+IDApIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc3RtdC5ib2R5W2kgLSAxXS50cmFpbGluZ0NvbW1lbnRzICYmICFzdG10LmJvZHlbaV0ubGVhZGluZ0NvbW1lbnRzKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVCbGFua0xpbmVzKHN0bXQuYm9keVtpIC0gMV0ucmFuZ2VbMV0sIHN0bXQuYm9keVtpXS5yYW5nZVswXSwgcmVzdWx0KTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgZnJhZ21lbnQgPSBhZGRJbmRlbnQodGhpcy5nZW5lcmF0ZVN0YXRlbWVudChzdG10LmJvZHlbaV0sIGJvZHlGbGFncykpOwoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGZyYWdtZW50KTsKCSAgICAgICAgICAgICAgICBpZiAoaSArIDEgPCBpeiAmJiAhZW5kc1dpdGhMaW5lVGVybWluYXRvcih0b1NvdXJjZU5vZGVXaGVuTmVlZGVkKGZyYWdtZW50KS50b1N0cmluZygpKSkgewoJICAgICAgICAgICAgICAgICAgICBpZiAocHJlc2VydmVCbGFua0xpbmVzKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN0bXQuYm9keVtpICsgMV0ubGVhZGluZ0NvbW1lbnRzKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3bGluZSk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChuZXdsaW5lKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgaWYgKHByZXNlcnZlQmxhbmtMaW5lcykgewoJICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgc3BhY2VzIGFmdGVyIHRoZSBsYXN0IGxpbmUKCSAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT09IGl6IC0gMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdG10LmJvZHlbaV0udHJhaWxpbmdDb21tZW50cykgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdlbmVyYXRlQmxhbmtMaW5lcyhzdG10LmJvZHlbaV0ucmFuZ2VbMV0sIHN0bXQucmFuZ2VbMV0sIHJlc3VsdCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICB9LAoKCSAgICAgICAgRnVuY3Rpb25EZWNsYXJhdGlvbjogZnVuY3Rpb24gKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgICAgICByZXR1cm4gWwoJICAgICAgICAgICAgICAgIGdlbmVyYXRlQXN5bmNQcmVmaXgoc3RtdCwgdHJ1ZSksCgkgICAgICAgICAgICAgICAgJ2Z1bmN0aW9uJywKCSAgICAgICAgICAgICAgICBnZW5lcmF0ZVN0YXJTdWZmaXgoc3RtdCkgfHwgbm9FbXB0eVNwYWNlKCksCgkgICAgICAgICAgICAgICAgc3RtdC5pZCA/IGdlbmVyYXRlSWRlbnRpZmllcihzdG10LmlkKSA6ICcnLAoJICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVGdW5jdGlvbkJvZHkoc3RtdCkKCSAgICAgICAgICAgIF07CgkgICAgICAgIH0sCgoJICAgICAgICBSZXR1cm5TdGF0ZW1lbnQ6IGZ1bmN0aW9uIChzdG10LCBmbGFncykgewoJICAgICAgICAgICAgaWYgKHN0bXQuYXJndW1lbnQpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gW2pvaW4oCgkgICAgICAgICAgICAgICAgICAgICdyZXR1cm4nLAoJICAgICAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihzdG10LmFyZ3VtZW50LCBQcmVjZWRlbmNlLlNlcXVlbmNlLCBFX1RUVCkKCSAgICAgICAgICAgICAgICApLCB0aGlzLnNlbWljb2xvbihmbGFncyldOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIFsncmV0dXJuJyArIHRoaXMuc2VtaWNvbG9uKGZsYWdzKV07CgkgICAgICAgIH0sCgoJICAgICAgICBXaGlsZVN0YXRlbWVudDogZnVuY3Rpb24gKHN0bXQsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmVzdWx0LCB0aGF0ID0gdGhpczsKCSAgICAgICAgICAgIHdpdGhJbmRlbnQoZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IFsKCSAgICAgICAgICAgICAgICAgICAgJ3doaWxlJyArIHNwYWNlICsgJygnLAoJICAgICAgICAgICAgICAgICAgICB0aGF0LmdlbmVyYXRlRXhwcmVzc2lvbihzdG10LnRlc3QsIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKSwKCSAgICAgICAgICAgICAgICAgICAgJyknCgkgICAgICAgICAgICAgICAgXTsKCSAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgcmVzdWx0LnB1c2godGhpcy5tYXliZUJsb2NrKHN0bXQuYm9keSwgZmxhZ3MgJiBGX1NFTUlDT0xPTl9PUFQgPyBTX1RGRlQgOiBTX1RGRkYpKTsKCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0sCgoJICAgICAgICBXaXRoU3RhdGVtZW50OiBmdW5jdGlvbiAoc3RtdCwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciByZXN1bHQsIHRoYXQgPSB0aGlzOwoJICAgICAgICAgICAgd2l0aEluZGVudChmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gWwoJICAgICAgICAgICAgICAgICAgICAnd2l0aCcgKyBzcGFjZSArICcoJywKCSAgICAgICAgICAgICAgICAgICAgdGhhdC5nZW5lcmF0ZUV4cHJlc3Npb24oc3RtdC5vYmplY3QsIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKSwKCSAgICAgICAgICAgICAgICAgICAgJyknCgkgICAgICAgICAgICAgICAgXTsKCSAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgcmVzdWx0LnB1c2godGhpcy5tYXliZUJsb2NrKHN0bXQuYm9keSwgZmxhZ3MgJiBGX1NFTUlDT0xPTl9PUFQgPyBTX1RGRlQgOiBTX1RGRkYpKTsKCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0KCgkgICAgfTsKCgkgICAgbWVyZ2UoQ29kZUdlbmVyYXRvci5wcm90b3R5cGUsIENvZGVHZW5lcmF0b3IuU3RhdGVtZW50KTsKCgkgICAgLy8gRXhwcmVzc2lvbnMuCgoJICAgIENvZGVHZW5lcmF0b3IuRXhwcmVzc2lvbiA9IHsKCgkgICAgICAgIFNlcXVlbmNlRXhwcmVzc2lvbjogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmVzdWx0LCBpLCBpejsKCSAgICAgICAgICAgIGlmIChQcmVjZWRlbmNlLlNlcXVlbmNlIDwgcHJlY2VkZW5jZSkgewoJICAgICAgICAgICAgICAgIGZsYWdzIHw9IEZfQUxMT1dfSU47CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQgPSBbXTsKCSAgICAgICAgICAgIGZvciAoaSA9IDAsIGl6ID0gZXhwci5leHByZXNzaW9ucy5sZW5ndGg7IGkgPCBpejsgKytpKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci5leHByZXNzaW9uc1tpXSwgUHJlY2VkZW5jZS5Bc3NpZ25tZW50LCBmbGFncykpOwoJICAgICAgICAgICAgICAgIGlmIChpICsgMSA8IGl6KSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCcsJyArIHNwYWNlKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gcGFyZW50aGVzaXplKHJlc3VsdCwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgcHJlY2VkZW5jZSk7CgkgICAgICAgIH0sCgoJICAgICAgICBBc3NpZ25tZW50RXhwcmVzc2lvbjogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZUFzc2lnbm1lbnQoZXhwci5sZWZ0LCBleHByLnJpZ2h0LCBleHByLm9wZXJhdG9yLCBwcmVjZWRlbmNlLCBmbGFncyk7CgkgICAgICAgIH0sCgoJICAgICAgICBBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbjogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICByZXR1cm4gcGFyZW50aGVzaXplKHRoaXMuZ2VuZXJhdGVGdW5jdGlvbkJvZHkoZXhwciksIFByZWNlZGVuY2UuQXJyb3dGdW5jdGlvbiwgcHJlY2VkZW5jZSk7CgkgICAgICAgIH0sCgoJICAgICAgICBDb25kaXRpb25hbEV4cHJlc3Npb246IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgaWYgKFByZWNlZGVuY2UuQ29uZGl0aW9uYWwgPCBwcmVjZWRlbmNlKSB7CgkgICAgICAgICAgICAgICAgZmxhZ3MgfD0gRl9BTExPV19JTjsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiBwYXJlbnRoZXNpemUoCgkgICAgICAgICAgICAgICAgWwoJICAgICAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihleHByLnRlc3QsIFByZWNlZGVuY2UuQ29hbGVzY2UsIGZsYWdzKSwKCSAgICAgICAgICAgICAgICAgICAgc3BhY2UgKyAnPycgKyBzcGFjZSwKCSAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci5jb25zZXF1ZW50LCBQcmVjZWRlbmNlLkFzc2lnbm1lbnQsIGZsYWdzKSwKCSAgICAgICAgICAgICAgICAgICAgc3BhY2UgKyAnOicgKyBzcGFjZSwKCSAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci5hbHRlcm5hdGUsIFByZWNlZGVuY2UuQXNzaWdubWVudCwgZmxhZ3MpCgkgICAgICAgICAgICAgICAgXSwKCSAgICAgICAgICAgICAgICBQcmVjZWRlbmNlLkNvbmRpdGlvbmFsLAoJICAgICAgICAgICAgICAgIHByZWNlZGVuY2UKCSAgICAgICAgICAgICk7CgkgICAgICAgIH0sCgoJICAgICAgICBMb2dpY2FsRXhwcmVzc2lvbjogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICBpZiAoZXhwci5vcGVyYXRvciA9PT0gJz8/JykgewoJICAgICAgICAgICAgICAgIGZsYWdzIHw9IEZfRk9VTkRfQ09BTEVTQ0U7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5CaW5hcnlFeHByZXNzaW9uKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKTsKCSAgICAgICAgfSwKCgkgICAgICAgIEJpbmFyeUV4cHJlc3Npb246IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgdmFyIHJlc3VsdCwgbGVmdFByZWNlZGVuY2UsIHJpZ2h0UHJlY2VkZW5jZSwgY3VycmVudFByZWNlZGVuY2UsIGZyYWdtZW50LCBsZWZ0U291cmNlOwoJICAgICAgICAgICAgY3VycmVudFByZWNlZGVuY2UgPSBCaW5hcnlQcmVjZWRlbmNlW2V4cHIub3BlcmF0b3JdOwoJICAgICAgICAgICAgbGVmdFByZWNlZGVuY2UgPSBleHByLm9wZXJhdG9yID09PSAnKionID8gUHJlY2VkZW5jZS5Qb3N0Zml4IDogY3VycmVudFByZWNlZGVuY2U7CgkgICAgICAgICAgICByaWdodFByZWNlZGVuY2UgPSBleHByLm9wZXJhdG9yID09PSAnKionID8gY3VycmVudFByZWNlZGVuY2UgOiBjdXJyZW50UHJlY2VkZW5jZSArIDE7CgoJICAgICAgICAgICAgaWYgKGN1cnJlbnRQcmVjZWRlbmNlIDwgcHJlY2VkZW5jZSkgewoJICAgICAgICAgICAgICAgIGZsYWdzIHw9IEZfQUxMT1dfSU47CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgZnJhZ21lbnQgPSB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihleHByLmxlZnQsIGxlZnRQcmVjZWRlbmNlLCBmbGFncyk7CgoJICAgICAgICAgICAgbGVmdFNvdXJjZSA9IGZyYWdtZW50LnRvU3RyaW5nKCk7CgoJICAgICAgICAgICAgaWYgKGxlZnRTb3VyY2UuY2hhckNvZGVBdChsZWZ0U291cmNlLmxlbmd0aCAtIDEpID09PSAweDJGIC8qIC8gKi8gJiYgZXN1dGlscy5jb2RlLmlzSWRlbnRpZmllclBhcnRFUzUoZXhwci5vcGVyYXRvci5jaGFyQ29kZUF0KDApKSkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IFtmcmFnbWVudCwgbm9FbXB0eVNwYWNlKCksIGV4cHIub3BlcmF0b3JdOwoJICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSBqb2luKGZyYWdtZW50LCBleHByLm9wZXJhdG9yKTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICBmcmFnbWVudCA9IHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIucmlnaHQsIHJpZ2h0UHJlY2VkZW5jZSwgZmxhZ3MpOwoKCSAgICAgICAgICAgIGlmIChleHByLm9wZXJhdG9yID09PSAnLycgJiYgZnJhZ21lbnQudG9TdHJpbmcoKS5jaGFyQXQoMCkgPT09ICcvJyB8fAoJICAgICAgICAgICAgZXhwci5vcGVyYXRvci5zbGljZSgtMSkgPT09ICc8JyAmJiBmcmFnbWVudC50b1N0cmluZygpLnNsaWNlKDAsIDMpID09PSAnIS0tJykgewoJICAgICAgICAgICAgICAgIC8vIElmICcvJyBjb25jYXRzIHdpdGggJy8nIG9yIGA8YCBjb25jYXRzIHdpdGggYCEtLWAsIGl0IGlzIGludGVycHJldGVkIGFzIGNvbW1lbnQgc3RhcnQKCSAgICAgICAgICAgICAgICByZXN1bHQucHVzaChub0VtcHR5U3BhY2UoKSk7CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goZnJhZ21lbnQpOwoJICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSBqb2luKHJlc3VsdCwgZnJhZ21lbnQpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIGlmIChleHByLm9wZXJhdG9yID09PSAnaW4nICYmICEoZmxhZ3MgJiBGX0FMTE9XX0lOKSkgewoJICAgICAgICAgICAgICAgIHJldHVybiBbJygnLCByZXN1bHQsICcpJ107CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAoKGV4cHIub3BlcmF0b3IgPT09ICd8fCcgfHwgZXhwci5vcGVyYXRvciA9PT0gJyYmJykgJiYgKGZsYWdzICYgRl9GT1VORF9DT0FMRVNDRSkpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gWycoJywgcmVzdWx0LCAnKSddOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIHBhcmVudGhlc2l6ZShyZXN1bHQsIGN1cnJlbnRQcmVjZWRlbmNlLCBwcmVjZWRlbmNlKTsKCSAgICAgICAgfSwKCgkgICAgICAgIENhbGxFeHByZXNzaW9uOiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciByZXN1bHQsIGksIGl6OwoKCSAgICAgICAgICAgIC8vIEZfQUxMT1dfVU5QQVJBVEhfTkVXIGJlY29tZXMgZmFsc2UuCgkgICAgICAgICAgICByZXN1bHQgPSBbdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci5jYWxsZWUsIFByZWNlZGVuY2UuQ2FsbCwgRV9UVEYpXTsKCgkgICAgICAgICAgICBpZiAoZXhwci5vcHRpb25hbCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCc/LicpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKCcoJyk7CgkgICAgICAgICAgICBmb3IgKGkgPSAwLCBpeiA9IGV4cHJbJ2FyZ3VtZW50cyddLmxlbmd0aDsgaSA8IGl6OyArK2kpIHsKCSAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihleHByWydhcmd1bWVudHMnXVtpXSwgUHJlY2VkZW5jZS5Bc3NpZ25tZW50LCBFX1RUVCkpOwoJICAgICAgICAgICAgICAgIGlmIChpICsgMSA8IGl6KSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCcsJyArIHNwYWNlKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQucHVzaCgnKScpOwoKCSAgICAgICAgICAgIGlmICghKGZsYWdzICYgRl9BTExPV19DQUxMKSkgewoJICAgICAgICAgICAgICAgIHJldHVybiBbJygnLCByZXN1bHQsICcpJ107CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgcmV0dXJuIHBhcmVudGhlc2l6ZShyZXN1bHQsIFByZWNlZGVuY2UuQ2FsbCwgcHJlY2VkZW5jZSk7CgkgICAgICAgIH0sCgoJICAgICAgICBDaGFpbkV4cHJlc3Npb246IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgaWYgKFByZWNlZGVuY2UuT3B0aW9uYWxDaGFpbmluZyA8IHByZWNlZGVuY2UpIHsKCSAgICAgICAgICAgICAgICBmbGFncyB8PSBGX0FMTE9XX0NBTEw7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIuZXhwcmVzc2lvbiwgUHJlY2VkZW5jZS5PcHRpb25hbENoYWluaW5nLCBmbGFncyk7CgoJICAgICAgICAgICAgcmV0dXJuIHBhcmVudGhlc2l6ZShyZXN1bHQsIFByZWNlZGVuY2UuT3B0aW9uYWxDaGFpbmluZywgcHJlY2VkZW5jZSk7CgkgICAgICAgIH0sCgoJICAgICAgICBOZXdFeHByZXNzaW9uOiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciByZXN1bHQsIGxlbmd0aCwgaSwgaXosIGl0ZW1GbGFnczsKCSAgICAgICAgICAgIGxlbmd0aCA9IGV4cHJbJ2FyZ3VtZW50cyddLmxlbmd0aDsKCgkgICAgICAgICAgICAvLyBGX0FMTE9XX0NBTEwgYmVjb21lcyBmYWxzZS4KCSAgICAgICAgICAgIC8vIEZfQUxMT1dfVU5QQVJBVEhfTkVXIG1heSBiZWNvbWUgZmFsc2UuCgkgICAgICAgICAgICBpdGVtRmxhZ3MgPSAoZmxhZ3MgJiBGX0FMTE9XX1VOUEFSQVRIX05FVyAmJiAhcGFyZW50aGVzZXMgJiYgbGVuZ3RoID09PSAwKSA/IEVfVEZUIDogRV9URkY7CgoJICAgICAgICAgICAgcmVzdWx0ID0gam9pbigKCSAgICAgICAgICAgICAgICAnbmV3JywKCSAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihleHByLmNhbGxlZSwgUHJlY2VkZW5jZS5OZXcsIGl0ZW1GbGFncykKCSAgICAgICAgICAgICk7CgoJICAgICAgICAgICAgaWYgKCEoZmxhZ3MgJiBGX0FMTE9XX1VOUEFSQVRIX05FVykgfHwgcGFyZW50aGVzZXMgfHwgbGVuZ3RoID4gMCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCcoJyk7CgkgICAgICAgICAgICAgICAgZm9yIChpID0gMCwgaXogPSBsZW5ndGg7IGkgPCBpejsgKytpKSB7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHJbJ2FyZ3VtZW50cyddW2ldLCBQcmVjZWRlbmNlLkFzc2lnbm1lbnQsIEVfVFRUKSk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChpICsgMSA8IGl6KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnLCcgKyBzcGFjZSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goJyknKTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICByZXR1cm4gcGFyZW50aGVzaXplKHJlc3VsdCwgUHJlY2VkZW5jZS5OZXcsIHByZWNlZGVuY2UpOwoJICAgICAgICB9LAoKCSAgICAgICAgTWVtYmVyRXhwcmVzc2lvbjogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmVzdWx0LCBmcmFnbWVudDsKCgkgICAgICAgICAgICAvLyBGX0FMTE9XX1VOUEFSQVRIX05FVyBiZWNvbWVzIGZhbHNlLgoJICAgICAgICAgICAgcmVzdWx0ID0gW3RoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIub2JqZWN0LCBQcmVjZWRlbmNlLkNhbGwsIChmbGFncyAmIEZfQUxMT1dfQ0FMTCkgPyBFX1RURiA6IEVfVEZGKV07CgoJICAgICAgICAgICAgaWYgKGV4cHIuY29tcHV0ZWQpIHsKCSAgICAgICAgICAgICAgICBpZiAoZXhwci5vcHRpb25hbCkgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnPy4nKTsKCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCdbJyk7CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci5wcm9wZXJ0eSwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgZmxhZ3MgJiBGX0FMTE9XX0NBTEwgPyBFX1RUVCA6IEVfVEZUKSk7CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goJ10nKTsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgaWYgKCFleHByLm9wdGlvbmFsICYmIGV4cHIub2JqZWN0LnR5cGUgPT09IFN5bnRheC5MaXRlcmFsICYmIHR5cGVvZiBleHByLm9iamVjdC52YWx1ZSA9PT0gJ251bWJlcicpIHsKCSAgICAgICAgICAgICAgICAgICAgZnJhZ21lbnQgPSB0b1NvdXJjZU5vZGVXaGVuTmVlZGVkKHJlc3VsdCkudG9TdHJpbmcoKTsKCSAgICAgICAgICAgICAgICAgICAgLy8gV2hlbiB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIGFsbCB0cnVlLAoJICAgICAgICAgICAgICAgICAgICAvLyAgIDEuIE5vIGZsb2F0aW5nIHBvaW50CgkgICAgICAgICAgICAgICAgICAgIC8vICAgMi4gRG9uJ3QgaGF2ZSBleHBvbmVudHMKCSAgICAgICAgICAgICAgICAgICAgLy8gICAzLiBUaGUgbGFzdCBjaGFyYWN0ZXIgaXMgYSBkZWNpbWFsIGRpZ2l0CgkgICAgICAgICAgICAgICAgICAgIC8vICAgNC4gTm90IGhleGFkZWNpbWFsIE9SIG9jdGFsIG51bWJlciBsaXRlcmFsCgkgICAgICAgICAgICAgICAgICAgIC8vIHdlIHNob3VsZCBhZGQgYSBmbG9hdGluZyBwb2ludC4KCSAgICAgICAgICAgICAgICAgICAgaWYgKAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyYWdtZW50LmluZGV4T2YoJy4nKSA8IDAgJiYKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAhL1tlRXhYXS8udGVzdChmcmFnbWVudCkgJiYKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBlc3V0aWxzLmNvZGUuaXNEZWNpbWFsRGlnaXQoZnJhZ21lbnQuY2hhckNvZGVBdChmcmFnbWVudC5sZW5ndGggLSAxKSkgJiYKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAhKGZyYWdtZW50Lmxlbmd0aCA+PSAyICYmIGZyYWdtZW50LmNoYXJDb2RlQXQoMCkgPT09IDQ4KSAgLy8gJzAnCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnICcpOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGV4cHIub3B0aW9uYWwgPyAnPy4nIDogJy4nKTsKCSAgICAgICAgICAgICAgICByZXN1bHQucHVzaChnZW5lcmF0ZUlkZW50aWZpZXIoZXhwci5wcm9wZXJ0eSkpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIHJldHVybiBwYXJlbnRoZXNpemUocmVzdWx0LCBQcmVjZWRlbmNlLk1lbWJlciwgcHJlY2VkZW5jZSk7CgkgICAgICAgIH0sCgoJICAgICAgICBNZXRhUHJvcGVydHk6IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgdmFyIHJlc3VsdDsKCSAgICAgICAgICAgIHJlc3VsdCA9IFtdOwoJICAgICAgICAgICAgcmVzdWx0LnB1c2godHlwZW9mIGV4cHIubWV0YSA9PT0gInN0cmluZyIgPyBleHByLm1ldGEgOiBnZW5lcmF0ZUlkZW50aWZpZXIoZXhwci5tZXRhKSk7CgkgICAgICAgICAgICByZXN1bHQucHVzaCgnLicpOwoJICAgICAgICAgICAgcmVzdWx0LnB1c2godHlwZW9mIGV4cHIucHJvcGVydHkgPT09ICJzdHJpbmciID8gZXhwci5wcm9wZXJ0eSA6IGdlbmVyYXRlSWRlbnRpZmllcihleHByLnByb3BlcnR5KSk7CgkgICAgICAgICAgICByZXR1cm4gcGFyZW50aGVzaXplKHJlc3VsdCwgUHJlY2VkZW5jZS5NZW1iZXIsIHByZWNlZGVuY2UpOwoJICAgICAgICB9LAoKCSAgICAgICAgVW5hcnlFeHByZXNzaW9uOiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciByZXN1bHQsIGZyYWdtZW50LCByaWdodENoYXJDb2RlLCBsZWZ0U291cmNlLCBsZWZ0Q2hhckNvZGU7CgkgICAgICAgICAgICBmcmFnbWVudCA9IHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIuYXJndW1lbnQsIFByZWNlZGVuY2UuVW5hcnksIEVfVFRUKTsKCgkgICAgICAgICAgICBpZiAoc3BhY2UgPT09ICcnKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gam9pbihleHByLm9wZXJhdG9yLCBmcmFnbWVudCk7CgkgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IFtleHByLm9wZXJhdG9yXTsKCSAgICAgICAgICAgICAgICBpZiAoZXhwci5vcGVyYXRvci5sZW5ndGggPiAyKSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSwgdm9pZCwgdHlwZW9mCgkgICAgICAgICAgICAgICAgICAgIC8vIGdldCBgdHlwZW9mIFtdYCwgbm90IGB0eXBlb2ZbXWAKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gam9pbihyZXN1bHQsIGZyYWdtZW50KTsKCSAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAvLyBQcmV2ZW50IGluc2VydGluZyBzcGFjZXMgYmV0d2VlbiBvcGVyYXRvciBhbmQgYXJndW1lbnQgaWYgaXQgaXMgdW5uZWNlc3NhcnkKCSAgICAgICAgICAgICAgICAgICAgLy8gbGlrZSwgYCFjb25kYAoJICAgICAgICAgICAgICAgICAgICBsZWZ0U291cmNlID0gdG9Tb3VyY2VOb2RlV2hlbk5lZWRlZChyZXN1bHQpLnRvU3RyaW5nKCk7CgkgICAgICAgICAgICAgICAgICAgIGxlZnRDaGFyQ29kZSA9IGxlZnRTb3VyY2UuY2hhckNvZGVBdChsZWZ0U291cmNlLmxlbmd0aCAtIDEpOwoJICAgICAgICAgICAgICAgICAgICByaWdodENoYXJDb2RlID0gZnJhZ21lbnQudG9TdHJpbmcoKS5jaGFyQ29kZUF0KDApOwoKCSAgICAgICAgICAgICAgICAgICAgaWYgKCgobGVmdENoYXJDb2RlID09PSAweDJCICAvKiArICovIHx8IGxlZnRDaGFyQ29kZSA9PT0gMHgyRCAgLyogLSAqLykgJiYgbGVmdENoYXJDb2RlID09PSByaWdodENoYXJDb2RlKSB8fAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIChlc3V0aWxzLmNvZGUuaXNJZGVudGlmaWVyUGFydEVTNShsZWZ0Q2hhckNvZGUpICYmIGVzdXRpbHMuY29kZS5pc0lkZW50aWZpZXJQYXJ0RVM1KHJpZ2h0Q2hhckNvZGUpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobm9FbXB0eVNwYWNlKCkpOwoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goZnJhZ21lbnQpOwoJICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goZnJhZ21lbnQpOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIHBhcmVudGhlc2l6ZShyZXN1bHQsIFByZWNlZGVuY2UuVW5hcnksIHByZWNlZGVuY2UpOwoJICAgICAgICB9LAoKCSAgICAgICAgWWllbGRFeHByZXNzaW9uOiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciByZXN1bHQ7CgkgICAgICAgICAgICBpZiAoZXhwci5kZWxlZ2F0ZSkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9ICd5aWVsZConOwoJICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSAneWllbGQnOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgaWYgKGV4cHIuYXJndW1lbnQpIHsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSBqb2luKAoJICAgICAgICAgICAgICAgICAgICByZXN1bHQsCgkgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIuYXJndW1lbnQsIFByZWNlZGVuY2UuWWllbGQsIEVfVFRUKQoJICAgICAgICAgICAgICAgICk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gcGFyZW50aGVzaXplKHJlc3VsdCwgUHJlY2VkZW5jZS5ZaWVsZCwgcHJlY2VkZW5jZSk7CgkgICAgICAgIH0sCgoJICAgICAgICBBd2FpdEV4cHJlc3Npb246IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGpvaW4oCgkgICAgICAgICAgICAgICAgZXhwci5hbGwgPyAnYXdhaXQqJyA6ICdhd2FpdCcsCgkgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci5hcmd1bWVudCwgUHJlY2VkZW5jZS5Bd2FpdCwgRV9UVFQpCgkgICAgICAgICAgICApOwoJICAgICAgICAgICAgcmV0dXJuIHBhcmVudGhlc2l6ZShyZXN1bHQsIFByZWNlZGVuY2UuQXdhaXQsIHByZWNlZGVuY2UpOwoJICAgICAgICB9LAoKCSAgICAgICAgVXBkYXRlRXhwcmVzc2lvbjogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICBpZiAoZXhwci5wcmVmaXgpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50aGVzaXplKAoJICAgICAgICAgICAgICAgICAgICBbCgkgICAgICAgICAgICAgICAgICAgICAgICBleHByLm9wZXJhdG9yLAoJICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci5hcmd1bWVudCwgUHJlY2VkZW5jZS5VbmFyeSwgRV9UVFQpCgkgICAgICAgICAgICAgICAgICAgIF0sCgkgICAgICAgICAgICAgICAgICAgIFByZWNlZGVuY2UuVW5hcnksCgkgICAgICAgICAgICAgICAgICAgIHByZWNlZGVuY2UKCSAgICAgICAgICAgICAgICApOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIHBhcmVudGhlc2l6ZSgKCSAgICAgICAgICAgICAgICBbCgkgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIuYXJndW1lbnQsIFByZWNlZGVuY2UuUG9zdGZpeCwgRV9UVFQpLAoJICAgICAgICAgICAgICAgICAgICBleHByLm9wZXJhdG9yCgkgICAgICAgICAgICAgICAgXSwKCSAgICAgICAgICAgICAgICBQcmVjZWRlbmNlLlBvc3RmaXgsCgkgICAgICAgICAgICAgICAgcHJlY2VkZW5jZQoJICAgICAgICAgICAgKTsKCSAgICAgICAgfSwKCgkgICAgICAgIEZ1bmN0aW9uRXhwcmVzc2lvbjogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmVzdWx0ID0gWwoJICAgICAgICAgICAgICAgIGdlbmVyYXRlQXN5bmNQcmVmaXgoZXhwciwgdHJ1ZSksCgkgICAgICAgICAgICAgICAgJ2Z1bmN0aW9uJwoJICAgICAgICAgICAgXTsKCSAgICAgICAgICAgIGlmIChleHByLmlkKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goZ2VuZXJhdGVTdGFyU3VmZml4KGV4cHIpIHx8IG5vRW1wdHlTcGFjZSgpKTsKCSAgICAgICAgICAgICAgICByZXN1bHQucHVzaChnZW5lcmF0ZUlkZW50aWZpZXIoZXhwci5pZCkpOwoJICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICByZXN1bHQucHVzaChnZW5lcmF0ZVN0YXJTdWZmaXgoZXhwcikgfHwgc3BhY2UpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LnB1c2godGhpcy5nZW5lcmF0ZUZ1bmN0aW9uQm9keShleHByKSk7CgkgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICB9LAoKCSAgICAgICAgQXJyYXlQYXR0ZXJuOiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLkFycmF5RXhwcmVzc2lvbihleHByLCBwcmVjZWRlbmNlLCBmbGFncywgdHJ1ZSk7CgkgICAgICAgIH0sCgoJICAgICAgICBBcnJheUV4cHJlc3Npb246IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncywgaXNQYXR0ZXJuKSB7CgkgICAgICAgICAgICB2YXIgcmVzdWx0LCBtdWx0aWxpbmUsIHRoYXQgPSB0aGlzOwoJICAgICAgICAgICAgaWYgKCFleHByLmVsZW1lbnRzLmxlbmd0aCkgewoJICAgICAgICAgICAgICAgIHJldHVybiAnW10nOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgbXVsdGlsaW5lID0gaXNQYXR0ZXJuID8gZmFsc2UgOiBleHByLmVsZW1lbnRzLmxlbmd0aCA+IDE7CgkgICAgICAgICAgICByZXN1bHQgPSBbJ1snLCBtdWx0aWxpbmUgPyBuZXdsaW5lIDogJyddOwoJICAgICAgICAgICAgd2l0aEluZGVudChmdW5jdGlvbiAoaW5kZW50KSB7CgkgICAgICAgICAgICAgICAgdmFyIGksIGl6OwoJICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGl6ID0gZXhwci5lbGVtZW50cy5sZW5ndGg7IGkgPCBpejsgKytpKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmICghZXhwci5lbGVtZW50c1tpXSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG11bHRpbGluZSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGluZGVudCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSArIDEgPT09IGl6KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goJywnKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG11bHRpbGluZSA/IGluZGVudCA6ICcnKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoYXQuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIuZWxlbWVudHNbaV0sIFByZWNlZGVuY2UuQXNzaWdubWVudCwgRV9UVFQpKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBpZiAoaSArIDEgPCBpeikgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goJywnICsgKG11bHRpbGluZSA/IG5ld2xpbmUgOiBzcGFjZSkpOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSk7CgkgICAgICAgICAgICBpZiAobXVsdGlsaW5lICYmICFlbmRzV2l0aExpbmVUZXJtaW5hdG9yKHRvU291cmNlTm9kZVdoZW5OZWVkZWQocmVzdWx0KS50b1N0cmluZygpKSkgewoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5ld2xpbmUpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LnB1c2gobXVsdGlsaW5lID8gYmFzZSA6ICcnKTsKCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKCddJyk7CgkgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICB9LAoKCSAgICAgICAgUmVzdEVsZW1lbnQ6IGZ1bmN0aW9uKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICByZXR1cm4gJy4uLicgKyB0aGlzLmdlbmVyYXRlUGF0dGVybihleHByLmFyZ3VtZW50KTsKCSAgICAgICAgfSwKCgkgICAgICAgIENsYXNzRXhwcmVzc2lvbjogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmVzdWx0LCBmcmFnbWVudDsKCSAgICAgICAgICAgIHJlc3VsdCA9IFsnY2xhc3MnXTsKCSAgICAgICAgICAgIGlmIChleHByLmlkKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gam9pbihyZXN1bHQsIHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIuaWQsIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAoZXhwci5zdXBlckNsYXNzKSB7CgkgICAgICAgICAgICAgICAgZnJhZ21lbnQgPSBqb2luKCdleHRlbmRzJywgdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci5zdXBlckNsYXNzLCBQcmVjZWRlbmNlLlVuYXJ5LCBFX1RUVCkpOwoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IGpvaW4ocmVzdWx0LCBmcmFnbWVudCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQucHVzaChzcGFjZSk7CgkgICAgICAgICAgICByZXN1bHQucHVzaCh0aGlzLmdlbmVyYXRlU3RhdGVtZW50KGV4cHIuYm9keSwgU19URkZUKSk7CgkgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICB9LAoKCSAgICAgICAgTWV0aG9kRGVmaW5pdGlvbjogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmVzdWx0LCBmcmFnbWVudDsKCSAgICAgICAgICAgIGlmIChleHByWydzdGF0aWMnXSkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IFsnc3RhdGljJyArIHNwYWNlXTsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gW107CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAoZXhwci5raW5kID09PSAnZ2V0JyB8fCBleHByLmtpbmQgPT09ICdzZXQnKSB7CgkgICAgICAgICAgICAgICAgZnJhZ21lbnQgPSBbCgkgICAgICAgICAgICAgICAgICAgIGpvaW4oZXhwci5raW5kLCB0aGlzLmdlbmVyYXRlUHJvcGVydHlLZXkoZXhwci5rZXksIGV4cHIuY29tcHV0ZWQpKSwKCSAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUZ1bmN0aW9uQm9keShleHByLnZhbHVlKQoJICAgICAgICAgICAgICAgIF07CgkgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgIGZyYWdtZW50ID0gWwoJICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZU1ldGhvZFByZWZpeChleHByKSwKCSAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZVByb3BlcnR5S2V5KGV4cHIua2V5LCBleHByLmNvbXB1dGVkKSwKCSAgICAgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUZ1bmN0aW9uQm9keShleHByLnZhbHVlKQoJICAgICAgICAgICAgICAgIF07CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gam9pbihyZXN1bHQsIGZyYWdtZW50KTsKCSAgICAgICAgfSwKCgkgICAgICAgIFByb3BlcnR5OiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIGlmIChleHByLmtpbmQgPT09ICdnZXQnIHx8IGV4cHIua2luZCA9PT0gJ3NldCcpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gWwoJICAgICAgICAgICAgICAgICAgICBleHByLmtpbmQsIG5vRW1wdHlTcGFjZSgpLAoJICAgICAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlUHJvcGVydHlLZXkoZXhwci5rZXksIGV4cHIuY29tcHV0ZWQpLAoJICAgICAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlRnVuY3Rpb25Cb2R5KGV4cHIudmFsdWUpCgkgICAgICAgICAgICAgICAgXTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICBpZiAoZXhwci5zaG9ydGhhbmQpIHsKCSAgICAgICAgICAgICAgICBpZiAoZXhwci52YWx1ZS50eXBlID09PSAiQXNzaWdubWVudFBhdHRlcm4iKSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkFzc2lnbm1lbnRQYXR0ZXJuKGV4cHIudmFsdWUsIFByZWNlZGVuY2UuU2VxdWVuY2UsIEVfVFRUKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVQcm9wZXJ0eUtleShleHByLmtleSwgZXhwci5jb21wdXRlZCk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgaWYgKGV4cHIubWV0aG9kKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIFsKCSAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVNZXRob2RQcmVmaXgoZXhwciksCgkgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVQcm9wZXJ0eUtleShleHByLmtleSwgZXhwci5jb21wdXRlZCksCgkgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVGdW5jdGlvbkJvZHkoZXhwci52YWx1ZSkKCSAgICAgICAgICAgICAgICBdOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIHJldHVybiBbCgkgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZVByb3BlcnR5S2V5KGV4cHIua2V5LCBleHByLmNvbXB1dGVkKSwKCSAgICAgICAgICAgICAgICAnOicgKyBzcGFjZSwKCSAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihleHByLnZhbHVlLCBQcmVjZWRlbmNlLkFzc2lnbm1lbnQsIEVfVFRUKQoJICAgICAgICAgICAgXTsKCSAgICAgICAgfSwKCgkgICAgICAgIE9iamVjdEV4cHJlc3Npb246IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgdmFyIG11bHRpbGluZSwgcmVzdWx0LCBmcmFnbWVudCwgdGhhdCA9IHRoaXM7CgoJICAgICAgICAgICAgaWYgKCFleHByLnByb3BlcnRpZXMubGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuICd7fSc7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBtdWx0aWxpbmUgPSBleHByLnByb3BlcnRpZXMubGVuZ3RoID4gMTsKCgkgICAgICAgICAgICB3aXRoSW5kZW50KGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgICAgICBmcmFnbWVudCA9IHRoYXQuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIucHJvcGVydGllc1swXSwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpOwoJICAgICAgICAgICAgfSk7CgoJICAgICAgICAgICAgaWYgKCFtdWx0aWxpbmUpIHsKCSAgICAgICAgICAgICAgICAvLyBpc3N1ZXMgNAoJICAgICAgICAgICAgICAgIC8vIERvIG5vdCB0cmFuc2Zvcm0gZnJvbQoJICAgICAgICAgICAgICAgIC8vICAgZGVqYXZ1LkNsYXNzLmRlY2xhcmUoewoJICAgICAgICAgICAgICAgIC8vICAgICAgIG1ldGhvZDI6IGZ1bmN0aW9uICgpIHt9CgkgICAgICAgICAgICAgICAgLy8gICB9KTsKCSAgICAgICAgICAgICAgICAvLyB0bwoJICAgICAgICAgICAgICAgIC8vICAgZGVqYXZ1LkNsYXNzLmRlY2xhcmUoe21ldGhvZDI6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgICAgICAvLyAgICAgICB9fSk7CgkgICAgICAgICAgICAgICAgaWYgKCFoYXNMaW5lVGVybWluYXRvcih0b1NvdXJjZU5vZGVXaGVuTmVlZGVkKGZyYWdtZW50KS50b1N0cmluZygpKSkgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gWyAneycsIHNwYWNlLCBmcmFnbWVudCwgc3BhY2UsICd9JyBdOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICB3aXRoSW5kZW50KGZ1bmN0aW9uIChpbmRlbnQpIHsKCSAgICAgICAgICAgICAgICB2YXIgaSwgaXo7CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gWyAneycsIG5ld2xpbmUsIGluZGVudCwgZnJhZ21lbnQgXTsKCgkgICAgICAgICAgICAgICAgaWYgKG11bHRpbGluZSkgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnLCcgKyBuZXdsaW5lKTsKCSAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMSwgaXogPSBleHByLnByb3BlcnRpZXMubGVuZ3RoOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goaW5kZW50KTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoYXQuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIucHJvcGVydGllc1tpXSwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpICsgMSA8IGl6KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goJywnICsgbmV3bGluZSk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9KTsKCgkgICAgICAgICAgICBpZiAoIWVuZHNXaXRoTGluZVRlcm1pbmF0b3IodG9Tb3VyY2VOb2RlV2hlbk5lZWRlZChyZXN1bHQpLnRvU3RyaW5nKCkpKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3bGluZSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQucHVzaChiYXNlKTsKCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKCd9Jyk7CgkgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICB9LAoKCSAgICAgICAgQXNzaWdubWVudFBhdHRlcm46IGZ1bmN0aW9uKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZUFzc2lnbm1lbnQoZXhwci5sZWZ0LCBleHByLnJpZ2h0LCAnPScsIHByZWNlZGVuY2UsIGZsYWdzKTsKCSAgICAgICAgfSwKCgkgICAgICAgIE9iamVjdFBhdHRlcm46IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgdmFyIHJlc3VsdCwgaSwgaXosIG11bHRpbGluZSwgcHJvcGVydHksIHRoYXQgPSB0aGlzOwoJICAgICAgICAgICAgaWYgKCFleHByLnByb3BlcnRpZXMubGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuICd7fSc7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgbXVsdGlsaW5lID0gZmFsc2U7CgkgICAgICAgICAgICBpZiAoZXhwci5wcm9wZXJ0aWVzLmxlbmd0aCA9PT0gMSkgewoJICAgICAgICAgICAgICAgIHByb3BlcnR5ID0gZXhwci5wcm9wZXJ0aWVzWzBdOwoJICAgICAgICAgICAgICAgIGlmICgKCSAgICAgICAgICAgICAgICAgICAgcHJvcGVydHkudHlwZSA9PT0gU3ludGF4LlByb3BlcnR5CgkgICAgICAgICAgICAgICAgICAgICYmIHByb3BlcnR5LnZhbHVlLnR5cGUgIT09IFN5bnRheC5JZGVudGlmaWVyCgkgICAgICAgICAgICAgICAgKSB7CgkgICAgICAgICAgICAgICAgICAgIG11bHRpbGluZSA9IHRydWU7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICBmb3IgKGkgPSAwLCBpeiA9IGV4cHIucHJvcGVydGllcy5sZW5ndGg7IGkgPCBpejsgKytpKSB7CgkgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5ID0gZXhwci5wcm9wZXJ0aWVzW2ldOwoJICAgICAgICAgICAgICAgICAgICBpZiAoCgkgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eS50eXBlID09PSBTeW50YXguUHJvcGVydHkKCSAgICAgICAgICAgICAgICAgICAgICAgICYmICFwcm9wZXJ0eS5zaG9ydGhhbmQKCSAgICAgICAgICAgICAgICAgICAgKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBtdWx0aWxpbmUgPSB0cnVlOwoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQgPSBbJ3snLCBtdWx0aWxpbmUgPyBuZXdsaW5lIDogJycgXTsKCgkgICAgICAgICAgICB3aXRoSW5kZW50KGZ1bmN0aW9uIChpbmRlbnQpIHsKCSAgICAgICAgICAgICAgICB2YXIgaSwgaXo7CgkgICAgICAgICAgICAgICAgZm9yIChpID0gMCwgaXogPSBleHByLnByb3BlcnRpZXMubGVuZ3RoOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChtdWx0aWxpbmUgPyBpbmRlbnQgOiAnJyk7CgkgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoYXQuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIucHJvcGVydGllc1tpXSwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpKTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKGkgKyAxIDwgaXopIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKCcsJyArIChtdWx0aWxpbmUgPyBuZXdsaW5lIDogc3BhY2UpKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0pOwoKCSAgICAgICAgICAgIGlmIChtdWx0aWxpbmUgJiYgIWVuZHNXaXRoTGluZVRlcm1pbmF0b3IodG9Tb3VyY2VOb2RlV2hlbk5lZWRlZChyZXN1bHQpLnRvU3RyaW5nKCkpKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3bGluZSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQucHVzaChtdWx0aWxpbmUgPyBiYXNlIDogJycpOwoJICAgICAgICAgICAgcmVzdWx0LnB1c2goJ30nKTsKCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0sCgoJICAgICAgICBUaGlzRXhwcmVzc2lvbjogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICByZXR1cm4gJ3RoaXMnOwoJICAgICAgICB9LAoKCSAgICAgICAgU3VwZXI6IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgcmV0dXJuICdzdXBlcic7CgkgICAgICAgIH0sCgoJICAgICAgICBJZGVudGlmaWVyOiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHJldHVybiBnZW5lcmF0ZUlkZW50aWZpZXIoZXhwcik7CgkgICAgICAgIH0sCgoJICAgICAgICBJbXBvcnREZWZhdWx0U3BlY2lmaWVyOiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHJldHVybiBnZW5lcmF0ZUlkZW50aWZpZXIoZXhwci5pZCB8fCBleHByLmxvY2FsKTsKCSAgICAgICAgfSwKCgkgICAgICAgIEltcG9ydE5hbWVzcGFjZVNwZWNpZmllcjogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmVzdWx0ID0gWycqJ107CgkgICAgICAgICAgICB2YXIgaWQgPSBleHByLmlkIHx8IGV4cHIubG9jYWw7CgkgICAgICAgICAgICBpZiAoaWQpIHsKCSAgICAgICAgICAgICAgICByZXN1bHQucHVzaChzcGFjZSArICdhcycgKyBub0VtcHR5U3BhY2UoKSArIGdlbmVyYXRlSWRlbnRpZmllcihpZCkpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfSwKCgkgICAgICAgIEltcG9ydFNwZWNpZmllcjogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgaW1wb3J0ZWQgPSBleHByLmltcG9ydGVkOwoJICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFsgaW1wb3J0ZWQubmFtZSBdOwoJICAgICAgICAgICAgdmFyIGxvY2FsID0gZXhwci5sb2NhbDsKCSAgICAgICAgICAgIGlmIChsb2NhbCAmJiBsb2NhbC5uYW1lICE9PSBpbXBvcnRlZC5uYW1lKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobm9FbXB0eVNwYWNlKCkgKyAnYXMnICsgbm9FbXB0eVNwYWNlKCkgKyBnZW5lcmF0ZUlkZW50aWZpZXIobG9jYWwpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0sCgoJICAgICAgICBFeHBvcnRTcGVjaWZpZXI6IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgdmFyIGxvY2FsID0gZXhwci5sb2NhbDsKCSAgICAgICAgICAgIHZhciByZXN1bHQgPSBbIGxvY2FsLm5hbWUgXTsKCSAgICAgICAgICAgIHZhciBleHBvcnRlZCA9IGV4cHIuZXhwb3J0ZWQ7CgkgICAgICAgICAgICBpZiAoZXhwb3J0ZWQgJiYgZXhwb3J0ZWQubmFtZSAhPT0gbG9jYWwubmFtZSkgewoJICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG5vRW1wdHlTcGFjZSgpICsgJ2FzJyArIG5vRW1wdHlTcGFjZSgpICsgZ2VuZXJhdGVJZGVudGlmaWVyKGV4cG9ydGVkKSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICB9LAoKCSAgICAgICAgTGl0ZXJhbDogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgcmF3OwoJICAgICAgICAgICAgaWYgKGV4cHIuaGFzT3duUHJvcGVydHkoJ3JhdycpICYmIHBhcnNlICYmIGV4dHJhLnJhdykgewoJICAgICAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgICAgIHJhdyA9IHBhcnNlKGV4cHIucmF3KS5ib2R5WzBdLmV4cHJlc3Npb247CgkgICAgICAgICAgICAgICAgICAgIGlmIChyYXcudHlwZSA9PT0gU3ludGF4LkxpdGVyYWwpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyYXcudmFsdWUgPT09IGV4cHIudmFsdWUpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXhwci5yYXc7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIG5vdCB1c2UgcmF3IHByb3BlcnR5CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIGlmIChleHByLnJlZ2V4KSB7CgkgICAgICAgICAgICAgIHJldHVybiAnLycgKyBleHByLnJlZ2V4LnBhdHRlcm4gKyAnLycgKyBleHByLnJlZ2V4LmZsYWdzOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIGlmICh0eXBlb2YgZXhwci52YWx1ZSA9PT0gJ2JpZ2ludCcpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZXhwci52YWx1ZS50b1N0cmluZygpICsgJ24nOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIC8vIGBleHByLnZhbHVlYCBjYW4gYmUgbnVsbCBpZiBgZXhwci5iaWdpbnRgIGV4aXN0cy4gV2UgbmVlZCB0byBjaGVjawoJICAgICAgICAgICAgLy8gYGV4cHIuYmlnaW50YCBmaXJzdC4KCSAgICAgICAgICAgIGlmIChleHByLmJpZ2ludCkgewoJICAgICAgICAgICAgICAgIHJldHVybiBleHByLmJpZ2ludCArICduJzsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICBpZiAoZXhwci52YWx1ZSA9PT0gbnVsbCkgewoJICAgICAgICAgICAgICAgIHJldHVybiAnbnVsbCc7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgaWYgKHR5cGVvZiBleHByLnZhbHVlID09PSAnc3RyaW5nJykgewoJICAgICAgICAgICAgICAgIHJldHVybiBlc2NhcGVTdHJpbmcoZXhwci52YWx1ZSk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgaWYgKHR5cGVvZiBleHByLnZhbHVlID09PSAnbnVtYmVyJykgewoJICAgICAgICAgICAgICAgIHJldHVybiBnZW5lcmF0ZU51bWJlcihleHByLnZhbHVlKTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICBpZiAodHlwZW9mIGV4cHIudmFsdWUgPT09ICdib29sZWFuJykgewoJICAgICAgICAgICAgICAgIHJldHVybiBleHByLnZhbHVlID8gJ3RydWUnIDogJ2ZhbHNlJzsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICByZXR1cm4gZ2VuZXJhdGVSZWdFeHAoZXhwci52YWx1ZSk7CgkgICAgICAgIH0sCgoJICAgICAgICBHZW5lcmF0b3JFeHByZXNzaW9uOiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLkNvbXByZWhlbnNpb25FeHByZXNzaW9uKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKTsKCSAgICAgICAgfSwKCgkgICAgICAgIENvbXByZWhlbnNpb25FeHByZXNzaW9uOiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIC8vIEdlbmVyYXRvckV4cHJlc3Npb24gc2hvdWxkIGJlIHBhcmVudGhlc2l6ZWQgd2l0aCAoLi4uKSwgQ29tcHJlaGVuc2lvbkV4cHJlc3Npb24gd2l0aCBbLi4uXQoJICAgICAgICAgICAgLy8gRHVlIHRvIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTg4MzQ2OCBwb3NpdGlvbiBvZiBleHByLmJvZHkgY2FuIGRpZmZlciBpbiBTcGlkZXJtb25rZXkgYW5kIEVTNgoKCSAgICAgICAgICAgIHZhciByZXN1bHQsIGksIGl6LCBmcmFnbWVudCwgdGhhdCA9IHRoaXM7CgkgICAgICAgICAgICByZXN1bHQgPSAoZXhwci50eXBlID09PSBTeW50YXguR2VuZXJhdG9yRXhwcmVzc2lvbikgPyBbJygnXSA6IFsnWyddOwoKCSAgICAgICAgICAgIGlmIChleHRyYS5tb3ouY29tcHJlaGVuc2lvbkV4cHJlc3Npb25TdGFydHNXaXRoQXNzaWdubWVudCkgewoJICAgICAgICAgICAgICAgIGZyYWdtZW50ID0gdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci5ib2R5LCBQcmVjZWRlbmNlLkFzc2lnbm1lbnQsIEVfVFRUKTsKCSAgICAgICAgICAgICAgICByZXN1bHQucHVzaChmcmFnbWVudCk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgaWYgKGV4cHIuYmxvY2tzKSB7CgkgICAgICAgICAgICAgICAgd2l0aEluZGVudChmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGl6ID0gZXhwci5ibG9ja3MubGVuZ3RoOyBpIDwgaXo7ICsraSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgZnJhZ21lbnQgPSB0aGF0LmdlbmVyYXRlRXhwcmVzc2lvbihleHByLmJsb2Nrc1tpXSwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPiAwIHx8IGV4dHJhLm1vei5jb21wcmVoZW5zaW9uRXhwcmVzc2lvblN0YXJ0c1dpdGhBc3NpZ25tZW50KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gam9pbihyZXN1bHQsIGZyYWdtZW50KTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goZnJhZ21lbnQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfSk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgaWYgKGV4cHIuZmlsdGVyKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gam9pbihyZXN1bHQsICdpZicgKyBzcGFjZSk7CgkgICAgICAgICAgICAgICAgZnJhZ21lbnQgPSB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihleHByLmZpbHRlciwgUHJlY2VkZW5jZS5TZXF1ZW5jZSwgRV9UVFQpOwoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IGpvaW4ocmVzdWx0LCBbICcoJywgZnJhZ21lbnQsICcpJyBdKTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICBpZiAoIWV4dHJhLm1vei5jb21wcmVoZW5zaW9uRXhwcmVzc2lvblN0YXJ0c1dpdGhBc3NpZ25tZW50KSB7CgkgICAgICAgICAgICAgICAgZnJhZ21lbnQgPSB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihleHByLmJvZHksIFByZWNlZGVuY2UuQXNzaWdubWVudCwgRV9UVFQpOwoKCSAgICAgICAgICAgICAgICByZXN1bHQgPSBqb2luKHJlc3VsdCwgZnJhZ21lbnQpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIHJlc3VsdC5wdXNoKChleHByLnR5cGUgPT09IFN5bnRheC5HZW5lcmF0b3JFeHByZXNzaW9uKSA/ICcpJyA6ICddJyk7CgkgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgICAgICB9LAoKCSAgICAgICAgQ29tcHJlaGVuc2lvbkJsb2NrOiBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgICAgIHZhciBmcmFnbWVudDsKCSAgICAgICAgICAgIGlmIChleHByLmxlZnQudHlwZSA9PT0gU3ludGF4LlZhcmlhYmxlRGVjbGFyYXRpb24pIHsKCSAgICAgICAgICAgICAgICBmcmFnbWVudCA9IFsKCSAgICAgICAgICAgICAgICAgICAgZXhwci5sZWZ0LmtpbmQsIG5vRW1wdHlTcGFjZSgpLAoJICAgICAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlU3RhdGVtZW50KGV4cHIubGVmdC5kZWNsYXJhdGlvbnNbMF0sIFNfRkZGRikKCSAgICAgICAgICAgICAgICBdOwoJICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICBmcmFnbWVudCA9IHRoaXMuZ2VuZXJhdGVFeHByZXNzaW9uKGV4cHIubGVmdCwgUHJlY2VkZW5jZS5DYWxsLCBFX1RUVCk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgZnJhZ21lbnQgPSBqb2luKGZyYWdtZW50LCBleHByLm9mID8gJ29mJyA6ICdpbicpOwoJICAgICAgICAgICAgZnJhZ21lbnQgPSBqb2luKGZyYWdtZW50LCB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihleHByLnJpZ2h0LCBQcmVjZWRlbmNlLlNlcXVlbmNlLCBFX1RUVCkpOwoKCSAgICAgICAgICAgIHJldHVybiBbICdmb3InICsgc3BhY2UgKyAnKCcsIGZyYWdtZW50LCAnKScgXTsKCSAgICAgICAgfSwKCgkgICAgICAgIFNwcmVhZEVsZW1lbnQ6IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgcmV0dXJuIFsKCSAgICAgICAgICAgICAgICAnLi4uJywKCSAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihleHByLmFyZ3VtZW50LCBQcmVjZWRlbmNlLkFzc2lnbm1lbnQsIEVfVFRUKQoJICAgICAgICAgICAgXTsKCSAgICAgICAgfSwKCgkgICAgICAgIFRhZ2dlZFRlbXBsYXRlRXhwcmVzc2lvbjogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICB2YXIgaXRlbUZsYWdzID0gRV9UVEY7CgkgICAgICAgICAgICBpZiAoIShmbGFncyAmIEZfQUxMT1dfQ0FMTCkpIHsKCSAgICAgICAgICAgICAgICBpdGVtRmxhZ3MgPSBFX1RGRjsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhciByZXN1bHQgPSBbCgkgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci50YWcsIFByZWNlZGVuY2UuQ2FsbCwgaXRlbUZsYWdzKSwKCSAgICAgICAgICAgICAgICB0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihleHByLnF1YXNpLCBQcmVjZWRlbmNlLlByaW1hcnksIEVfRkZUKQoJICAgICAgICAgICAgXTsKCSAgICAgICAgICAgIHJldHVybiBwYXJlbnRoZXNpemUocmVzdWx0LCBQcmVjZWRlbmNlLlRhZ2dlZFRlbXBsYXRlLCBwcmVjZWRlbmNlKTsKCSAgICAgICAgfSwKCgkgICAgICAgIFRlbXBsYXRlRWxlbWVudDogZnVuY3Rpb24gKGV4cHIsIHByZWNlZGVuY2UsIGZsYWdzKSB7CgkgICAgICAgICAgICAvLyBEb24ndCB1c2UgImNvb2tlZCIuIFNpbmNlIHRhZ2dlZCB0ZW1wbGF0ZSBjYW4gdXNlIHJhdyB0ZW1wbGF0ZQoJICAgICAgICAgICAgLy8gcmVwcmVzZW50YXRpb24uIFNvIGlmIHdlIGRvIHNvLCBpdCBicmVha3MgdGhlIHNjcmlwdCBzZW1hbnRpY3MuCgkgICAgICAgICAgICByZXR1cm4gZXhwci52YWx1ZS5yYXc7CgkgICAgICAgIH0sCgoJICAgICAgICBUZW1wbGF0ZUxpdGVyYWw6IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgdmFyIHJlc3VsdCwgaSwgaXo7CgkgICAgICAgICAgICByZXN1bHQgPSBbICdgJyBdOwoJICAgICAgICAgICAgZm9yIChpID0gMCwgaXogPSBleHByLnF1YXNpcy5sZW5ndGg7IGkgPCBpejsgKytpKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2godGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci5xdWFzaXNbaV0sIFByZWNlZGVuY2UuUHJpbWFyeSwgRV9UVFQpKTsKCSAgICAgICAgICAgICAgICBpZiAoaSArIDEgPCBpeikgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnJHsnICsgc3BhY2UpOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh0aGlzLmdlbmVyYXRlRXhwcmVzc2lvbihleHByLmV4cHJlc3Npb25zW2ldLCBQcmVjZWRlbmNlLlNlcXVlbmNlLCBFX1RUVCkpOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChzcGFjZSArICd9Jyk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LnB1c2goJ2AnKTsKCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0sCgoJICAgICAgICBNb2R1bGVTcGVjaWZpZXI6IGZ1bmN0aW9uIChleHByLCBwcmVjZWRlbmNlLCBmbGFncykgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuTGl0ZXJhbChleHByLCBwcmVjZWRlbmNlLCBmbGFncyk7CgkgICAgICAgIH0sCgoJICAgICAgICBJbXBvcnRFeHByZXNzaW9uOiBmdW5jdGlvbihleHByLCBwcmVjZWRlbmNlLCBmbGFnKSB7CgkgICAgICAgICAgICByZXR1cm4gcGFyZW50aGVzaXplKFsKCSAgICAgICAgICAgICAgICAnaW1wb3J0KCcsCgkgICAgICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZUV4cHJlc3Npb24oZXhwci5zb3VyY2UsIFByZWNlZGVuY2UuQXNzaWdubWVudCwgRV9UVFQpLAoJICAgICAgICAgICAgICAgICcpJwoJICAgICAgICAgICAgXSwgUHJlY2VkZW5jZS5DYWxsLCBwcmVjZWRlbmNlKTsKCSAgICAgICAgfQoJICAgIH07CgoJICAgIG1lcmdlKENvZGVHZW5lcmF0b3IucHJvdG90eXBlLCBDb2RlR2VuZXJhdG9yLkV4cHJlc3Npb24pOwoKCSAgICBDb2RlR2VuZXJhdG9yLnByb3RvdHlwZS5nZW5lcmF0ZUV4cHJlc3Npb24gPSBmdW5jdGlvbiAoZXhwciwgcHJlY2VkZW5jZSwgZmxhZ3MpIHsKCSAgICAgICAgdmFyIHJlc3VsdCwgdHlwZTsKCgkgICAgICAgIHR5cGUgPSBleHByLnR5cGUgfHwgU3ludGF4LlByb3BlcnR5OwoKCSAgICAgICAgaWYgKGV4dHJhLnZlcmJhdGltICYmIGV4cHIuaGFzT3duUHJvcGVydHkoZXh0cmEudmVyYmF0aW0pKSB7CgkgICAgICAgICAgICByZXR1cm4gZ2VuZXJhdGVWZXJiYXRpbShleHByLCBwcmVjZWRlbmNlKTsKCSAgICAgICAgfQoKCSAgICAgICAgcmVzdWx0ID0gdGhpc1t0eXBlXShleHByLCBwcmVjZWRlbmNlLCBmbGFncyk7CgoKCSAgICAgICAgaWYgKGV4dHJhLmNvbW1lbnQpIHsKCSAgICAgICAgICAgIHJlc3VsdCA9IGFkZENvbW1lbnRzKGV4cHIsIHJlc3VsdCk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRvU291cmNlTm9kZVdoZW5OZWVkZWQocmVzdWx0LCBleHByKTsKCSAgICB9OwoKCSAgICBDb2RlR2VuZXJhdG9yLnByb3RvdHlwZS5nZW5lcmF0ZVN0YXRlbWVudCA9IGZ1bmN0aW9uIChzdG10LCBmbGFncykgewoJICAgICAgICB2YXIgcmVzdWx0LAoJICAgICAgICAgICAgZnJhZ21lbnQ7CgoJICAgICAgICByZXN1bHQgPSB0aGlzW3N0bXQudHlwZV0oc3RtdCwgZmxhZ3MpOwoKCSAgICAgICAgLy8gQXR0YWNoIGNvbW1lbnRzCgoJICAgICAgICBpZiAoZXh0cmEuY29tbWVudCkgewoJICAgICAgICAgICAgcmVzdWx0ID0gYWRkQ29tbWVudHMoc3RtdCwgcmVzdWx0KTsKCSAgICAgICAgfQoKCSAgICAgICAgZnJhZ21lbnQgPSB0b1NvdXJjZU5vZGVXaGVuTmVlZGVkKHJlc3VsdCkudG9TdHJpbmcoKTsKCSAgICAgICAgaWYgKHN0bXQudHlwZSA9PT0gU3ludGF4LlByb2dyYW0gJiYgIXNhZmVDb25jYXRlbmF0aW9uICYmIG5ld2xpbmUgPT09ICcnICYmICBmcmFnbWVudC5jaGFyQXQoZnJhZ21lbnQubGVuZ3RoIC0gMSkgPT09ICdcbicpIHsKCSAgICAgICAgICAgIHJlc3VsdCA9IHNvdXJjZU1hcCA/IHRvU291cmNlTm9kZVdoZW5OZWVkZWQocmVzdWx0KS5yZXBsYWNlUmlnaHQoL1xzKyQvLCAnJykgOiBmcmFnbWVudC5yZXBsYWNlKC9ccyskLywgJycpOwoJICAgICAgICB9CgoJICAgICAgICByZXR1cm4gdG9Tb3VyY2VOb2RlV2hlbk5lZWRlZChyZXN1bHQsIHN0bXQpOwoJICAgIH07CgoJICAgIGZ1bmN0aW9uIGdlbmVyYXRlSW50ZXJuYWwobm9kZSkgewoJICAgICAgICB2YXIgY29kZWdlbjsKCgkgICAgICAgIGNvZGVnZW4gPSBuZXcgQ29kZUdlbmVyYXRvcigpOwoJICAgICAgICBpZiAoaXNTdGF0ZW1lbnQobm9kZSkpIHsKCSAgICAgICAgICAgIHJldHVybiBjb2RlZ2VuLmdlbmVyYXRlU3RhdGVtZW50KG5vZGUsIFNfVEZGRik7CgkgICAgICAgIH0KCgkgICAgICAgIGlmIChpc0V4cHJlc3Npb24obm9kZSkpIHsKCSAgICAgICAgICAgIHJldHVybiBjb2RlZ2VuLmdlbmVyYXRlRXhwcmVzc2lvbihub2RlLCBQcmVjZWRlbmNlLlNlcXVlbmNlLCBFX1RUVCk7CgkgICAgICAgIH0KCgkgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5rbm93biBub2RlIHR5cGU6ICcgKyBub2RlLnR5cGUpOwoJICAgIH0KCgkgICAgZnVuY3Rpb24gZ2VuZXJhdGUobm9kZSwgb3B0aW9ucykgewoJICAgICAgICB2YXIgZGVmYXVsdE9wdGlvbnMgPSBnZXREZWZhdWx0T3B0aW9ucygpLCByZXN1bHQsIHBhaXI7CgoJICAgICAgICBpZiAob3B0aW9ucyAhPSBudWxsKSB7CgkgICAgICAgICAgICAvLyBPYnNvbGV0ZSBvcHRpb25zCgkgICAgICAgICAgICAvLwoJICAgICAgICAgICAgLy8gICBgb3B0aW9ucy5pbmRlbnRgCgkgICAgICAgICAgICAvLyAgIGBvcHRpb25zLmJhc2VgCgkgICAgICAgICAgICAvLwoJICAgICAgICAgICAgLy8gSW5zdGVhZCBvZiB0aGVtLCB3ZSBjYW4gdXNlIGBvcHRpb24uZm9ybWF0LmluZGVudGAuCgkgICAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMuaW5kZW50ID09PSAnc3RyaW5nJykgewoJICAgICAgICAgICAgICAgIGRlZmF1bHRPcHRpb25zLmZvcm1hdC5pbmRlbnQuc3R5bGUgPSBvcHRpb25zLmluZGVudDsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5iYXNlID09PSAnbnVtYmVyJykgewoJICAgICAgICAgICAgICAgIGRlZmF1bHRPcHRpb25zLmZvcm1hdC5pbmRlbnQuYmFzZSA9IG9wdGlvbnMuYmFzZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIG9wdGlvbnMgPSB1cGRhdGVEZWVwbHkoZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpOwoJICAgICAgICAgICAgaW5kZW50ID0gb3B0aW9ucy5mb3JtYXQuaW5kZW50LnN0eWxlOwoJICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLmJhc2UgPT09ICdzdHJpbmcnKSB7CgkgICAgICAgICAgICAgICAgYmFzZSA9IG9wdGlvbnMuYmFzZTsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgYmFzZSA9IHN0cmluZ1JlcGVhdChpbmRlbnQsIG9wdGlvbnMuZm9ybWF0LmluZGVudC5iYXNlKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgIG9wdGlvbnMgPSBkZWZhdWx0T3B0aW9uczsKCSAgICAgICAgICAgIGluZGVudCA9IG9wdGlvbnMuZm9ybWF0LmluZGVudC5zdHlsZTsKCSAgICAgICAgICAgIGJhc2UgPSBzdHJpbmdSZXBlYXQoaW5kZW50LCBvcHRpb25zLmZvcm1hdC5pbmRlbnQuYmFzZSk7CgkgICAgICAgIH0KCSAgICAgICAganNvbiA9IG9wdGlvbnMuZm9ybWF0Lmpzb247CgkgICAgICAgIHJlbnVtYmVyID0gb3B0aW9ucy5mb3JtYXQucmVudW1iZXI7CgkgICAgICAgIGhleGFkZWNpbWFsID0ganNvbiA/IGZhbHNlIDogb3B0aW9ucy5mb3JtYXQuaGV4YWRlY2ltYWw7CgkgICAgICAgIHF1b3RlcyA9IGpzb24gPyAnZG91YmxlJyA6IG9wdGlvbnMuZm9ybWF0LnF1b3RlczsKCSAgICAgICAgZXNjYXBlbGVzcyA9IG9wdGlvbnMuZm9ybWF0LmVzY2FwZWxlc3M7CgkgICAgICAgIG5ld2xpbmUgPSBvcHRpb25zLmZvcm1hdC5uZXdsaW5lOwoJICAgICAgICBzcGFjZSA9IG9wdGlvbnMuZm9ybWF0LnNwYWNlOwoJICAgICAgICBpZiAob3B0aW9ucy5mb3JtYXQuY29tcGFjdCkgewoJICAgICAgICAgICAgbmV3bGluZSA9IHNwYWNlID0gaW5kZW50ID0gYmFzZSA9ICcnOwoJICAgICAgICB9CgkgICAgICAgIHBhcmVudGhlc2VzID0gb3B0aW9ucy5mb3JtYXQucGFyZW50aGVzZXM7CgkgICAgICAgIHNlbWljb2xvbnMgPSBvcHRpb25zLmZvcm1hdC5zZW1pY29sb25zOwoJICAgICAgICBzYWZlQ29uY2F0ZW5hdGlvbiA9IG9wdGlvbnMuZm9ybWF0LnNhZmVDb25jYXRlbmF0aW9uOwoJICAgICAgICBkaXJlY3RpdmUgPSBvcHRpb25zLmRpcmVjdGl2ZTsKCSAgICAgICAgcGFyc2UgPSBqc29uID8gbnVsbCA6IG9wdGlvbnMucGFyc2U7CgkgICAgICAgIHNvdXJjZU1hcCA9IG9wdGlvbnMuc291cmNlTWFwOwoJICAgICAgICBzb3VyY2VDb2RlID0gb3B0aW9ucy5zb3VyY2VDb2RlOwoJICAgICAgICBwcmVzZXJ2ZUJsYW5rTGluZXMgPSBvcHRpb25zLmZvcm1hdC5wcmVzZXJ2ZUJsYW5rTGluZXMgJiYgc291cmNlQ29kZSAhPT0gbnVsbDsKCSAgICAgICAgZXh0cmEgPSBvcHRpb25zOwoKCSAgICAgICAgaWYgKHNvdXJjZU1hcCkgewoJICAgICAgICAgICAgaWYgKCFleHBvcnRzLmJyb3dzZXIpIHsKCSAgICAgICAgICAgICAgICAvLyBXZSBhc3N1bWUgZW52aXJvbm1lbnQgaXMgbm9kZS5qcwoJICAgICAgICAgICAgICAgIC8vIEFuZCBwcmV2ZW50IGZyb20gaW5jbHVkaW5nIHNvdXJjZS1tYXAgYnkgYnJvd3NlcmlmeQoJICAgICAgICAgICAgICAgIFNvdXJjZU5vZGUgPSByZXF1aXJlU291cmNlTWFwKCkuU291cmNlTm9kZTsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgU291cmNlTm9kZSA9IGNvbW1vbmpzR2xvYmFsLnNvdXJjZU1hcC5Tb3VyY2VOb2RlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgoJICAgICAgICByZXN1bHQgPSBnZW5lcmF0ZUludGVybmFsKG5vZGUpOwoKCSAgICAgICAgaWYgKCFzb3VyY2VNYXApIHsKCSAgICAgICAgICAgIHBhaXIgPSB7Y29kZTogcmVzdWx0LnRvU3RyaW5nKCksIG1hcDogbnVsbH07CgkgICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5zb3VyY2VNYXBXaXRoQ29kZSA/IHBhaXIgOiBwYWlyLmNvZGU7CgkgICAgICAgIH0KCgoJICAgICAgICBwYWlyID0gcmVzdWx0LnRvU3RyaW5nV2l0aFNvdXJjZU1hcCh7CgkgICAgICAgICAgICBmaWxlOiBvcHRpb25zLmZpbGUsCgkgICAgICAgICAgICBzb3VyY2VSb290OiBvcHRpb25zLnNvdXJjZU1hcFJvb3QKCSAgICAgICAgfSk7CgoJICAgICAgICBpZiAob3B0aW9ucy5zb3VyY2VDb250ZW50KSB7CgkgICAgICAgICAgICBwYWlyLm1hcC5zZXRTb3VyY2VDb250ZW50KG9wdGlvbnMuc291cmNlTWFwLAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnNvdXJjZUNvbnRlbnQpOwoJICAgICAgICB9CgoJICAgICAgICBpZiAob3B0aW9ucy5zb3VyY2VNYXBXaXRoQ29kZSkgewoJICAgICAgICAgICAgcmV0dXJuIHBhaXI7CgkgICAgICAgIH0KCgkgICAgICAgIHJldHVybiBwYWlyLm1hcC50b1N0cmluZygpOwoJICAgIH0KCgkgICAgRk9STUFUX01JTklGWSA9IHsKCSAgICAgICAgaW5kZW50OiB7CgkgICAgICAgICAgICBzdHlsZTogJycsCgkgICAgICAgICAgICBiYXNlOiAwCgkgICAgICAgIH0sCgkgICAgICAgIHJlbnVtYmVyOiB0cnVlLAoJICAgICAgICBoZXhhZGVjaW1hbDogdHJ1ZSwKCSAgICAgICAgcXVvdGVzOiAnYXV0bycsCgkgICAgICAgIGVzY2FwZWxlc3M6IHRydWUsCgkgICAgICAgIGNvbXBhY3Q6IHRydWUsCgkgICAgICAgIHBhcmVudGhlc2VzOiBmYWxzZSwKCSAgICAgICAgc2VtaWNvbG9uczogZmFsc2UKCSAgICB9OwoKCSAgICBGT1JNQVRfREVGQVVMVFMgPSBnZXREZWZhdWx0T3B0aW9ucygpLmZvcm1hdDsKCgkgICAgZXhwb3J0cy52ZXJzaW9uID0gcmVxdWlyZSQkMy52ZXJzaW9uOwoJICAgIGV4cG9ydHMuZ2VuZXJhdGUgPSBnZW5lcmF0ZTsKCSAgICBleHBvcnRzLmF0dGFjaENvbW1lbnRzID0gZXN0cmF2ZXJzZSQxLmF0dGFjaENvbW1lbnRzOwoJICAgIGV4cG9ydHMuUHJlY2VkZW5jZSA9IHVwZGF0ZURlZXBseSh7fSwgUHJlY2VkZW5jZSk7CgkgICAgZXhwb3J0cy5icm93c2VyID0gZmFsc2U7CgkgICAgZXhwb3J0cy5GT1JNQVRfTUlOSUZZID0gRk9STUFUX01JTklGWTsKCSAgICBleHBvcnRzLkZPUk1BVF9ERUZBVUxUUyA9IEZPUk1BVF9ERUZBVUxUUzsKCX0oKSk7CgkvKiB2aW06IHNldCBzdz00IHRzPTQgZXQgdHc9ODAgOiAqLyAKfSAoZXNjb2RlZ2VuKSk7Cgpjb25zdCBBQ0NFU1NfS0VZID0gYF9fY29yaXVtLmFjY2Vzc29yYDsKY29uc3QgR0xPQkFMX1BST1hZID0gIl9fY29yaXVtLmdsb2JhbF9wcm94eSI7CmNvbnN0IEdMT0JBTF9OQU1FID0gIl9fY29yaXVtLmdsb2JhbF9uYW1lIjsKY29uc3QgVU5ERUZJTkFCTEUgPSBbImV2YWwiLCAibG9jYXRpb24iLCAidG9wIl07CmNvbnN0IGNUYXJnZXQgPSAidCR0IjsKY29uc3QgY1Byb3AgPSAidCRwIjsKY29uc3QgY1ZhbHVlID0gInQkdiI7CmZ1bmN0aW9uIHJld3JpdGUoanMpIHsKICB0cnkgewogICAgY29uc3QgdHJlZSA9IHBhcnNlU2NyaXB0KGpzLCB7CiAgICAgIHJhbmdlczogdHJ1ZSwKICAgICAgbW9kdWxlOiBmYWxzZSwKICAgICAgZ2xvYmFsUmV0dXJuOiB0cnVlCiAgICB9KTsKICAgIGZvciAoY29uc3QgY3R4IG9mIG5ldyBBY29ybkl0ZXJhdG9yKHRyZWUpKSB7CiAgICAgIHR5cGVMb29wOgogICAgICAgIHN3aXRjaCAoY3R4Lm5vZGVbInR5cGUiXSkgewogICAgICAgICAgY2FzZSAiQ2FsbEV4cHJlc3Npb24iOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29uc3QgeyBjYWxsZWUgfSA9IGN0eC5ub2RlOwogICAgICAgICAgICAgIGlmIChjYWxsZWUudHlwZSA9PT0gIklkZW50aWZpZXIiICYmIGNhbGxlZS5uYW1lID09PSAiZXZhbCIgJiYgY3R4Lm5vZGUuYXJndW1lbnRzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgY3R4LnJlcGxhY2VXaXRoKAogICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuY29uZGl0aW9uYWxFeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5iaW5hcnlFeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgICAgIj09PSIsCiAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcigiZXZhbCIpLAogICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLm1lbWJlckV4cHJlc3Npb24oCiAgICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5pZGVudGlmaWVyKEFDQ0VTU19LRVkpLAogICAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcigiZXZhbFNuYXBzaG90IikKICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5jYWxsRXhwcmVzc2lvbihtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcigiZXZhbCIpLCBbCiAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuY2FsbEV4cHJlc3Npb24oCiAgICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5tZW1iZXJFeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5pZGVudGlmaWVyKEFDQ0VTU19LRVkpLAogICAgICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5pZGVudGlmaWVyKCJldmFsU2NvcGUiKQogICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICAgICBjdHgubm9kZS5hcmd1bWVudHMubWFwKChhcmcpID0+IHJlc3VsdChhcmcpKQogICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIF0pLAogICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5jYWxsRXhwcmVzc2lvbigKICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5pZGVudGlmaWVyKCJldmFsIiksCiAgICAgICAgICAgICAgICAgICAgICBjdHgubm9kZS5hcmd1bWVudHMubWFwKChhcmcpID0+IHJlc3VsdChhcmcpKQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJJZGVudGlmaWVyIjoKICAgICAgICAgICAgewogICAgICAgICAgICAgIHN3aXRjaCAoY3R4LnBhcmVudD8ubm9kZS50eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICJBcnJheVBhdHRlcm4iOgogICAgICAgICAgICAgICAgY2FzZSAiT2JqZWN0UGF0dGVybiI6CiAgICAgICAgICAgICAgICBjYXNlICJMYWJlbGVkU3RhdGVtZW50IjoKICAgICAgICAgICAgICAgIGNhc2UgIk1ldGhvZERlZmluaXRpb24iOgogICAgICAgICAgICAgICAgY2FzZSAiQ2xhc3NEZWNsYXJhdGlvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJSZXN0RWxlbWVudCI6CiAgICAgICAgICAgICAgICBjYXNlICJFeHBvcnRTcGVjaWZpZXIiOgogICAgICAgICAgICAgICAgY2FzZSAiSW1wb3J0U3BlY2lmaWVyIjoKICAgICAgICAgICAgICAgICAgYnJlYWsgdHlwZUxvb3A7CiAgICAgICAgICAgICAgICBjYXNlICJNZW1iZXJFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgaWYgKGN0eC5wYXJlbnRLZXkgPT09ICJwcm9wZXJ0eSIpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsgdHlwZUxvb3A7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiVmFyaWFibGVEZWNsYXJhdG9yIjoKICAgICAgICAgICAgICAgICAgaWYgKGN0eC5wYXJlbnRLZXkgPT09ICJpZCIpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsgdHlwZUxvb3A7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiUHJvcGVydHkiOgogICAgICAgICAgICAgICAgICBpZiAoY3R4LnBhcmVudEtleSA9PT0gImtleSIpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsgdHlwZUxvb3A7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiRnVuY3Rpb25EZWNsYXJhdGlvbiI6CiAgICAgICAgICAgICAgICBjYXNlICJGdW5jdGlvbkV4cHJlc3Npb24iOgogICAgICAgICAgICAgICAgICBpZiAoY3R4LnBhcmVudEtleSA9PT0gImlkIikKICAgICAgICAgICAgICAgICAgICBicmVhayB0eXBlTG9vcDsKICAgICAgICAgICAgICAgIGNhc2UgIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgaWYgKGN0eC5wYXJlbnRLZXkgPT09ICJwYXJhbXMiKQogICAgICAgICAgICAgICAgICAgIGJyZWFrIHR5cGVMb29wOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgIkFzc2lnbm1lbnRQYXR0ZXJuIjoKICAgICAgICAgICAgICAgICAgaWYgKGN0eC5wYXJlbnRLZXkgPT09ICJsZWZ0IikKICAgICAgICAgICAgICAgICAgICBicmVhayB0eXBlTG9vcDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICghVU5ERUZJTkFCTEUuaW5jbHVkZXMoY3R4Lm5vZGUubmFtZSkpCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBpZiAoY3R4LnBhcmVudD8ubm9kZS50eXBlID09PSAiVXBkYXRlRXhwcmVzc2lvbiIgfHwgY3R4LnBhcmVudD8ubm9kZS50eXBlID09PSAiQXNzaWdubWVudEV4cHJlc3Npb24iICYmIGN0eC5wYXJlbnRLZXkgPT09ICJsZWZ0IikgewogICAgICAgICAgICAgICAgY3R4LnBhcmVudC5yZXBsYWNlV2l0aCgKICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmNhbGxFeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5tZW1iZXJFeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoQUNDRVNTX0tFWSksCiAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcigic2V0MSIpCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgICBjdHgubm9kZSwKICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5saXRlcmFsKGN0eC5ub2RlLm5hbWUpLAogICAgICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuIHdoYXQgdGhlIGludGVuZGVkIHZhbHVlIGlzCiAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuYXJyb3dGdW5jdGlvbkV4cHJlc3Npb24oCiAgICAgICAgICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcihjVGFyZ2V0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcihjUHJvcCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoY1ZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAgICAgICBjdHgucGFyZW50Lm5vZGUudHlwZSA9PT0gIlVwZGF0ZUV4cHJlc3Npb24iID8gbWFpbiQxLmJ1aWxkZXJzLnVwZGF0ZUV4cHJlc3Npb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnBhcmVudC5ub2RlLm9wZXJhdG9yLAogICAgICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5tZW1iZXJFeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoY1RhcmdldCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcihjUHJvcCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgucGFyZW50Lm5vZGUucHJlZml4CiAgICAgICAgICAgICAgICAgICAgICAgICkgOiBtYWluJDEuYnVpbGRlcnMuYXNzaWdubWVudEV4cHJlc3Npb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnBhcmVudC5ub2RlLm9wZXJhdG9yLAogICAgICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5tZW1iZXJFeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoY1RhcmdldCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcihjUHJvcCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcihjVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICAvLyBzZXQKICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5hcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbigKICAgICAgICAgICAgICAgICAgICAgICAgW21haW4kMS5idWlsZGVycy5pZGVudGlmaWVyKGNWYWx1ZSldLAogICAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuYXNzaWdubWVudEV4cHJlc3Npb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAgIj0iLAogICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5ub2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5pZGVudGlmaWVyKGNWYWx1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgIGN0eC5wYXJlbnQubm9kZS50eXBlID09PSAiVXBkYXRlRXhwcmVzc2lvbiIgPyBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcigidW5kZWZpbmVkIikgOiBjdHgucGFyZW50Lm5vZGUucmlnaHQsCiAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMubGl0ZXJhbChnZW5lcmF0ZVBhcnRpYWwoanMsIGN0eC5wYXJlbnQpKQogICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LnJlcGxhY2VXaXRoKAogICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuY2FsbEV4cHJlc3Npb24oCiAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLm1lbWJlckV4cHJlc3Npb24oCiAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcihBQ0NFU1NfS0VZKSwKICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5pZGVudGlmaWVyKCJnZXQiKQogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgW2N0eC5ub2RlLCBtYWluJDEuYnVpbGRlcnMubGl0ZXJhbChjdHgubm9kZS5uYW1lKV0KICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJNZW1iZXJFeHByZXNzaW9uIjoKICAgICAgICAgICAgewogICAgICAgICAgICAgIHN3aXRjaCAoY3R4LnBhcmVudD8ubm9kZS50eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICJBcnJheVBhdHRlcm4iOgogICAgICAgICAgICAgICAgY2FzZSAiT2JqZWN0UGF0dGVybiI6CiAgICAgICAgICAgICAgICAgIGJyZWFrIHR5cGVMb29wOwogICAgICAgICAgICAgICAgY2FzZSAiVW5hcnlFeHByZXNzaW9uIjoKICAgICAgICAgICAgICAgICAgaWYgKGN0eC5wYXJlbnQ/Lm5vZGUub3BlcmF0b3IgPT09ICJkZWxldGUiKQogICAgICAgICAgICAgICAgICAgIGJyZWFrIHR5cGVMb29wOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGN0eC5ub2RlLmNvbXB1dGVkKSB7CiAgICAgICAgICAgICAgICBpZiAoY3R4Lm5vZGUub2JqZWN0LnR5cGUgPT09ICJTdXBlciIpIHsKICAgICAgICAgICAgICAgICAgYnJlYWsgdHlwZUxvb3A7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoY3R4Lm5vZGUucHJvcGVydHkudHlwZSA9PT0gIkxpdGVyYWwiKSB7CiAgICAgICAgICAgICAgICAgIGlmICghVU5ERUZJTkFCTEUuaW5jbHVkZXMoY3R4Lm5vZGUucHJvcGVydHkudmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsgdHlwZUxvb3A7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIHN3aXRjaCAoY3R4Lm5vZGUucHJvcGVydHkudHlwZSkgewogICAgICAgICAgICAgICAgICBjYXNlICJJZGVudGlmaWVyIjoKICAgICAgICAgICAgICAgICAgICBpZiAoIVVOREVGSU5BQkxFLmluY2x1ZGVzKGN0eC5ub2RlLnByb3BlcnR5Lm5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICBicmVhayB0eXBlTG9vcDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIGNhc2UgIkxpdGVyYWwiOgogICAgICAgICAgICAgICAgICAgIGlmICghVU5ERUZJTkFCTEUuaW5jbHVkZXMoY3R4Lm5vZGUucHJvcGVydHkudmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICBicmVhayB0eXBlTG9vcDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbGV0IHByb3BlcnR5QXJndW1lbnQ7CiAgICAgICAgICAgICAgaWYgKGN0eC5ub2RlLmNvbXB1dGVkKSB7CiAgICAgICAgICAgICAgICBwcm9wZXJ0eUFyZ3VtZW50ID0gcmVzdWx0KGN0eC5ub2RlLnByb3BlcnR5KTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGN0eC5ub2RlLnByb3BlcnR5LnR5cGUgPT09ICJJZGVudGlmaWVyIikgewogICAgICAgICAgICAgICAgcHJvcGVydHlBcmd1bWVudCA9IG1haW4kMS5idWlsZGVycy5saXRlcmFsKGN0eC5ub2RlLnByb3BlcnR5Lm5hbWUpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGN0eC5wYXJlbnQ/Lm5vZGUudHlwZSA9PT0gIk5ld0V4cHJlc3Npb24iICYmIGN0eC5wYXJlbnRLZXkgPT09ICJjYWxsZWUiKSB7CiAgICAgICAgICAgICAgICBjdHgucGFyZW50LnJlcGxhY2VXaXRoKAogICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuY2FsbEV4cHJlc3Npb24oCiAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLm1lbWJlckV4cHJlc3Npb24oCiAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcihBQ0NFU1NfS0VZKSwKICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5pZGVudGlmaWVyKCJuZXcyIikKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdChjdHgubm9kZS5vYmplY3QpLAogICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlBcmd1bWVudCwKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdChtYWluJDEuYnVpbGRlcnMuYXJyYXlFeHByZXNzaW9uKGN0eC5wYXJlbnQubm9kZS5hcmd1bWVudHMpKSwKICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5saXRlcmFsKGdlbmVyYXRlUGFydGlhbChqcywgY3R4LnBhcmVudCkpCiAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoY3R4LnBhcmVudD8ubm9kZS50eXBlID09PSAiQ2FsbEV4cHJlc3Npb24iICYmIGN0eC5wYXJlbnRLZXkgPT09ICJjYWxsZWUiKSB7CiAgICAgICAgICAgICAgICBjdHgucGFyZW50LnJlcGxhY2VXaXRoKAogICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuY2FsbEV4cHJlc3Npb24oCiAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLm1lbWJlckV4cHJlc3Npb24oCiAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcihBQ0NFU1NfS0VZKSwKICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5pZGVudGlmaWVyKCJjYWxsMiIpCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgICByZXN1bHQoY3R4Lm5vZGUub2JqZWN0KSwKICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5QXJndW1lbnQsCiAgICAgICAgICAgICAgICAgICAgICByZXN1bHQobWFpbiQxLmJ1aWxkZXJzLmFycmF5RXhwcmVzc2lvbihjdHgucGFyZW50Lm5vZGUuYXJndW1lbnRzKSksCiAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMubGl0ZXJhbChnZW5lcmF0ZVBhcnRpYWwoanMsIGN0eC5wYXJlbnQpKQogICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGN0eC5wYXJlbnQ/Lm5vZGUudHlwZSA9PT0gIlVwZGF0ZUV4cHJlc3Npb24iIHx8IGN0eC5wYXJlbnQ/Lm5vZGUudHlwZSA9PT0gIkFzc2lnbm1lbnRFeHByZXNzaW9uIiAmJiBjdHgucGFyZW50S2V5ID09PSAibGVmdCIpIHsKICAgICAgICAgICAgICAgIGN0eC5wYXJlbnQucmVwbGFjZVdpdGgoCiAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5jYWxsRXhwcmVzc2lvbigKICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMubWVtYmVyRXhwcmVzc2lvbigKICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5pZGVudGlmaWVyKEFDQ0VTU19LRVkpLAogICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoInNldDIiKQogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgICAgY3R4Lm5vZGUub2JqZWN0LAogICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlBcmd1bWVudCwKICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5hcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbigKICAgICAgICAgICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5pZGVudGlmaWVyKGNUYXJnZXQpLAogICAgICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5pZGVudGlmaWVyKGNQcm9wKSwKICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcihjVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5wYXJlbnQ/Lm5vZGUudHlwZSA9PT0gIlVwZGF0ZUV4cHJlc3Npb24iID8gbWFpbiQxLmJ1aWxkZXJzLnVwZGF0ZUV4cHJlc3Npb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnBhcmVudC5ub2RlLm9wZXJhdG9yLAogICAgICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5tZW1iZXJFeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoY1RhcmdldCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcihjUHJvcCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgucGFyZW50Lm5vZGUucHJlZml4CiAgICAgICAgICAgICAgICAgICAgICAgICkgOiBtYWluJDEuYnVpbGRlcnMuYXNzaWdubWVudEV4cHJlc3Npb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnBhcmVudC5ub2RlLm9wZXJhdG9yLAogICAgICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5tZW1iZXJFeHByZXNzaW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoY1RhcmdldCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcihjUHJvcCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMuaWRlbnRpZmllcihjVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICBjdHgucGFyZW50Py5ub2RlLnR5cGUgPT09ICJVcGRhdGVFeHByZXNzaW9uIiA/IG1haW4kMS5idWlsZGVycy5pZGVudGlmaWVyKCJ1bmRlZmluZWQiKSA6IGN0eC5wYXJlbnQubm9kZS5yaWdodCwKICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5saXRlcmFsKGdlbmVyYXRlUGFydGlhbChqcywgY3R4LnBhcmVudCkpCiAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHgucmVwbGFjZVdpdGgoCiAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5jYWxsRXhwcmVzc2lvbigKICAgICAgICAgICAgICAgICAgICBtYWluJDEuYnVpbGRlcnMubWVtYmVyRXhwcmVzc2lvbigKICAgICAgICAgICAgICAgICAgICAgIG1haW4kMS5idWlsZGVycy5pZGVudGlmaWVyKEFDQ0VTU19LRVkpLAogICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmlkZW50aWZpZXIoImdldDIiKQogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0KGN0eC5ub2RlLm9iamVjdCksCiAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eUFyZ3VtZW50LAogICAgICAgICAgICAgICAgICAgICAgbWFpbiQxLmJ1aWxkZXJzLmxpdGVyYWwoZ2VuZXJhdGVQYXJ0aWFsKGpzLCBjdHgpKQogICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIGVzY29kZWdlbi5nZW5lcmF0ZSh0cmVlKTsKICB9IGNhdGNoIChlKSB7CiAgICBjb25zb2xlLmVycm9yKGUpOwogICAgY29uc29sZS5lcnJvcigicGFyc2luZyBlcnJvciIpOwogICAgcmV0dXJuICIiOwogIH0KfQp3aW5kb3dbImIiXSA9IG1haW4kMS5idWlsZGVyczsKd2luZG93WyJqc3IiXSA9IHJld3JpdGU7CmZ1bmN0aW9uIGdlbmVyYXRlUGFydGlhbChzY3JpcHQsIGN0eCkgewogIGxldCByZXN1bHQyID0gY3R4Lm5vZGUucmFuZ2UgPyBzY3JpcHQuc2xpY2UoY3R4Lm5vZGUucmFuZ2VbMF0sIGN0eC5ub2RlLnJhbmdlWzFdKSA6IGVzY29kZWdlbi5nZW5lcmF0ZShjdHgubm9kZSk7CiAgaWYgKGN0eC5ub2RlLnR5cGUuaW5jbHVkZXMoIkV4cHJlc3Npb24iKSAmJiBjdHgucGFyZW50Py5ub2RlLnR5cGUuaW5jbHVkZXMoIkV4cHJlc3Npb24iKSkgewogICAgcmVzdWx0MiA9IGAoJHtyZXN1bHQyfSlgOwogIH0KICByZXR1cm4gcmVzdWx0MjsKfQoKZnVuY3Rpb24gYWNjZXNzKGFwZ2xvYmFsKSB7CiAgY29uc3QgbW9kID0gewogICAgZ2V0MjogKHRhcmdldCwga2V5KSA9PiB7CiAgICAgIHJldHVybiBtb2QuZ2V0KHRhcmdldFtrZXldLCBrZXkpOwogICAgfSwKICAgIGdldDogKG9iamVjdCwga2V5KSA9PiB7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKHR5cGVvZiBrZXkgPT09ICJzdHJpbmciICYmIFVOREVGSU5BQkxFLmluY2x1ZGVzKGtleSkgJiYgKHR5cGVvZiBvYmplY3QgPT09ICJvYmplY3QiICYmIG9iamVjdCAhPT0gbnVsbCB8fCB0eXBlb2Ygb2JqZWN0ID09PSAiZnVuY3Rpb24iKSAmJiBHTE9CQUxfUFJPWFkgaW4gb2JqZWN0KSB7CiAgICAgICAgICByZXR1cm4gb2JqZWN0W0dMT0JBTF9QUk9YWV07CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICB9CiAgICAgIHJldHVybiBvYmplY3Q7CiAgICB9LAogICAgc2V0MjogKHRhcmdldCwga2V5LCBvcGVyYXRlLCByaWdodGhhbmQpID0+IHsKICAgICAgaWYgKHR5cGVvZiBrZXkgPT09ICJzdHJpbmciKSB7CiAgICAgICAgaWYgKHRhcmdldCA9PT0gZ2xvYmFsKSB7CiAgICAgICAgICBpZiAoa2V5ID09PSAibG9jYXRpb24iKSB7CiAgICAgICAgICAgIHRhcmdldCA9IGxvY2F0aW9uW0dMT0JBTF9QUk9YWV07CiAgICAgICAgICAgIGtleSA9ICJocmVmIjsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKCh0eXBlb2YgdGFyZ2V0ID09PSAib2JqZWN0IiAmJiB0YXJnZXQgIT09IG51bGwgfHwgdHlwZW9mIHRhcmdldCA9PT0gImZ1bmN0aW9uIikgJiYgQUNDRVNTX0tFWSBpbiB0YXJnZXQgJiYgdGFyZ2V0W0FDQ0VTU19LRVldLnNldDIgIT09IG1vZC5zZXQyKSB7CiAgICAgICAgICByZXR1cm4gdGFyZ2V0W0FDQ0VTU19LRVldLnNldDIodGFyZ2V0LCBrZXksIG9wZXJhdGUpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gb3BlcmF0ZShtb2QuZ2V0KHRhcmdldCwga2V5KSwga2V5LCByaWdodGhhbmQpOwogICAgfSwKICAgIHNldDE6ICh0YXJnZXQsIG5hbWUsIG9wZXJhdGUsIHNldCwgcmlnaHRoYW5kKSA9PiB7CiAgICAgIGNvbnNvbGUubG9nKHRhcmdldCwgbmFtZSwgb3BlcmF0ZSwgc2V0LCByaWdodGhhbmQpOwogICAgICBjb25zdCBwcm94eSA9IG1vZC5nZXQodGFyZ2V0LCBuYW1lKTsKICAgICAgY29uc3QgcHJvcGVydHkgPSBTeW1ib2woKTsKICAgICAgY29uc3Qgb2JqZWN0ID0gewogICAgICAgIFtwcm9wZXJ0eV06IHByb3h5CiAgICAgIH07CiAgICAgIGNvbnN0IHJlc3VsdCA9IG9wZXJhdGUob2JqZWN0LCBwcm9wZXJ0eSwgcmlnaHRoYW5kKTsKICAgICAgY29uc3QgdmFsdWUgPSBvYmplY3RbcHJvcGVydHldOwogICAgICBpZiAodHlwZW9mIHRhcmdldCA9PT0gIm9iamVjdCIgJiYgdGFyZ2V0ICE9PSBudWxsICYmIHRhcmdldFtHTE9CQUxfTkFNRV0gPT09ICJsb2NhdGlvbiIpIHsKICAgICAgICBjb25zb2xlLmxvZygid2lsbCBzZXQgbG9jYXRpb24gdG8gIiArIHZhbHVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZXQodmFsdWUpOwogICAgICB9CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9LAogICAgbmV3MjogKHRhcmdldCwga2V5LCBhcmdzKSA9PiB7CiAgICAgIHJldHVybiBSZWZsZWN0LmNvbnN0cnVjdChtb2QuZ2V0KHRhcmdldFtrZXldLCBrZXkpLCBhcmdzKTsKICAgIH0sCiAgICBjYWxsMjogKHRhcmdldCwga2V5LCBhcmdzKSA9PiB7CiAgICAgIHJldHVybiBSZWZsZWN0LmFwcGx5KG1vZC5nZXQodGFyZ2V0W2tleV0sIGtleSksIHRhcmdldCwgYXJncyk7CiAgICB9LAogICAgZXZhbFNjb3BlOiAoY29kZSkgPT4gewogICAgICByZXR1cm4gYXBnbG9iYWwuanNSZXdyaXRlKGNvZGUpOwogICAgfQogICAgLy8gaW1wb3J0OiAoYmFzZVVSTDogc3RyaW5nIHwgdW5kZWZpbmVkLCB1cmw6IHN0cmluZyk6IFByb21pc2U8dW5rbm93bj4gPT4gewogICAgLy8gICAvLyBAdHMtaWdub3JlCiAgICAvLyAgIHJldHVybiBpbXBvcnQoCiAgICAvLyAgICAgLyogd2VicGFja0lnbm9yZTogdHJ1ZSAqLwogICAgLy8gICAgIHJvdXRlSlMoCiAgICAvLyAgICAgICBuZXcgU3RvbXBVUkwoCiAgICAvLyAgICAgICAgIG5ldyBVUkwodXJsLCBiYXNlVVJMIHx8IHRoaXMuY2xpZW50LnVybC50b1N0cmluZygpKSwKICAgIC8vICAgICAgICAgdGhpcy5jbGllbnQudXJsCiAgICAvLyAgICAgICApLAogICAgLy8gICAgICAgdGhpcy5jbGllbnQudXJsLAogICAgLy8gICAgICAgdGhpcy5jbGllbnQuY29uZmlnLAogICAgLy8gICAgICAgJ2dlbmVyaWNNb2R1bGUnCiAgICAvLyAgICAgKQogICAgLy8gICApOwogICAgLy8gfSwKICB9OwogIHJldHVybiBtb2Q7Cn0KCmZ1bmN0aW9uIGhvb2sod2luKSB7CiAgY29uc3QgYXBpID0gewogICAgaG9vaywKICAgIGpzUmV3cml0ZTogcmV3cml0ZQogIH07CiAgYXBpWyJhY2Nlc3NvciJdID0gYWNjZXNzKGFwaSk7CiAgd2luWyJfX2Nvcml1bSJdID0gYXBpOwp9CgovKgogIEBsaWNlbnNlCglSb2xsdXAuanMgdjMuMjguMAoJV2VkLCAwOSBBdWcgMjAyMyAwNTozNDowMyBHTVQgLSBjb21taXQgZTNiNjE0YzlkNDU1NTI0OGNhYTQzZDA2MmY0MDAzODU5YjM4ODQzNAoKCWh0dHBzOi8vZ2l0aHViLmNvbS9yb2xsdXAvcm9sbHVwCgoJUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLgoqLwp2YXIgZT0iMy4yOC4wIjtmdW5jdGlvbiB0KGUpe3JldHVybiBlJiZlLl9fZXNNb2R1bGUmJk9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCJkZWZhdWx0Iik/ZS5kZWZhdWx0OmV9dmFyIHM9e2V4cG9ydHM6e319OyFmdW5jdGlvbihlKXtjb25zdCB0PSIsIi5jaGFyQ29kZUF0KDApLHM9IjsiLmNoYXJDb2RlQXQoMCksaT0iQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyIsbj1uZXcgVWludDhBcnJheSg2NCkscj1uZXcgVWludDhBcnJheSgxMjgpO2ZvcihsZXQgZT0wO2U8aS5sZW5ndGg7ZSsrKXtjb25zdCB0PWkuY2hhckNvZGVBdChlKTtuW2VdPXQsclt0XT1lO31jb25zdCBvPSJ1bmRlZmluZWQiIT10eXBlb2YgVGV4dERlY29kZXI/bmV3IFRleHREZWNvZGVyOiJ1bmRlZmluZWQiIT10eXBlb2YgQnVmZmVyP3tkZWNvZGU6ZT0+QnVmZmVyLmZyb20oZS5idWZmZXIsZS5ieXRlT2Zmc2V0LGUuYnl0ZUxlbmd0aCkudG9TdHJpbmcoKX06e2RlY29kZShlKXtsZXQgdD0iIjtmb3IobGV0IHM9MDtzPGUubGVuZ3RoO3MrKyl0Kz1TdHJpbmcuZnJvbUNoYXJDb2RlKGVbc10pO3JldHVybiB0fX07ZnVuY3Rpb24gYShlKXtjb25zdCB0PW5ldyBJbnQzMkFycmF5KDUpLHM9W107bGV0IGk9MDtkb3tjb25zdCBuPWwoZSxpKSxyPVtdO2xldCBvPSEwLGE9MDt0WzBdPTA7Zm9yKGxldCBzPWk7czxuO3MrKyl7bGV0IGk7cz1jKGUscyx0LDApO2NvbnN0IGw9dFswXTtsPGEmJihvPSExKSxhPWwsaChlLHMsbik/KHM9YyhlLHMsdCwxKSxzPWMoZSxzLHQsMikscz1jKGUscyx0LDMpLGgoZSxzLG4pPyhzPWMoZSxzLHQsNCksaT1bbCx0WzFdLHRbMl0sdFszXSx0WzRdXSk6aT1bbCx0WzFdLHRbMl0sdFszXV0pOmk9W2xdLHIucHVzaChpKTt9b3x8dShyKSxzLnB1c2gociksaT1uKzE7fXdoaWxlKGk8PWUubGVuZ3RoKTtyZXR1cm4gc31mdW5jdGlvbiBsKGUsdCl7Y29uc3Qgcz1lLmluZGV4T2YoIjsiLHQpO3JldHVybiAtMT09PXM/ZS5sZW5ndGg6c31mdW5jdGlvbiBjKGUsdCxzLGkpe2xldCBuPTAsbz0wLGE9MDtkb3tjb25zdCBzPWUuY2hhckNvZGVBdCh0KyspO2E9cltzXSxufD0oMzEmYSk8PG8sbys9NTt9d2hpbGUoMzImYSk7Y29uc3QgbD0xJm47cmV0dXJuIG4+Pj49MSxsJiYobj0tMjE0NzQ4MzY0OHwtbiksc1tpXSs9bix0fWZ1bmN0aW9uIGgoZSxzLGkpe3JldHVybiAhKHM+PWkpJiZlLmNoYXJDb2RlQXQocykhPT10fWZ1bmN0aW9uIHUoZSl7ZS5zb3J0KGQpO31mdW5jdGlvbiBkKGUsdCl7cmV0dXJuIGVbMF0tdFswXX1mdW5jdGlvbiBwKGUpe2NvbnN0IGk9bmV3IEludDMyQXJyYXkoNSksbj0xNjM4NCxyPW4tMzYsYT1uZXcgVWludDhBcnJheShuKSxsPWEuc3ViYXJyYXkoMCxyKTtsZXQgYz0wLGg9IiI7Zm9yKGxldCB1PTA7dTxlLmxlbmd0aDt1Kyspe2NvbnN0IGQ9ZVt1XTtpZih1PjAmJihjPT09biYmKGgrPW8uZGVjb2RlKGEpLGM9MCksYVtjKytdPXMpLDAhPT1kLmxlbmd0aCl7aVswXT0wO2ZvcihsZXQgZT0wO2U8ZC5sZW5ndGg7ZSsrKXtjb25zdCBzPWRbZV07Yz5yJiYoaCs9by5kZWNvZGUobCksYS5jb3B5V2l0aGluKDAscixjKSxjLT1yKSxlPjAmJihhW2MrK109dCksYz1mKGEsYyxpLHMsMCksMSE9PXMubGVuZ3RoJiYoYz1mKGEsYyxpLHMsMSksYz1mKGEsYyxpLHMsMiksYz1mKGEsYyxpLHMsMyksNCE9PXMubGVuZ3RoJiYoYz1mKGEsYyxpLHMsNCkpKTt9fX1yZXR1cm4gaCtvLmRlY29kZShhLnN1YmFycmF5KDAsYykpfWZ1bmN0aW9uIGYoZSx0LHMsaSxyKXtjb25zdCBvPWlbcl07bGV0IGE9by1zW3JdO3Nbcl09byxhPWE8MD8tYTw8MXwxOmE8PDE7ZG97bGV0IHM9MzEmYTthPj4+PTUsYT4wJiYoc3w9MzIpLGVbdCsrXT1uW3NdO313aGlsZShhPjApO3JldHVybiB0fWUuZGVjb2RlPWEsZS5lbmNvZGU9cCxPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7fShzLmV4cG9ydHMpO3ZhciBpPXMuZXhwb3J0cztjbGFzcyBue2NvbnN0cnVjdG9yKGUpe3RoaXMuYml0cz1lIGluc3RhbmNlb2Ygbj9lLmJpdHMuc2xpY2UoKTpbXTt9YWRkKGUpe3RoaXMuYml0c1tlPj41XXw9MTw8KDMxJmUpO31oYXMoZSl7cmV0dXJuICEhKHRoaXMuYml0c1tlPj41XSYxPDwoMzEmZSkpfX1sZXQgcj1jbGFzcyBle2NvbnN0cnVjdG9yKGUsdCxzKXt0aGlzLnN0YXJ0PWUsdGhpcy5lbmQ9dCx0aGlzLm9yaWdpbmFsPXMsdGhpcy5pbnRybz0iIix0aGlzLm91dHJvPSIiLHRoaXMuY29udGVudD1zLHRoaXMuc3RvcmVOYW1lPSExLHRoaXMuZWRpdGVkPSExLHRoaXMucHJldmlvdXM9bnVsbCx0aGlzLm5leHQ9bnVsbDt9YXBwZW5kTGVmdChlKXt0aGlzLm91dHJvKz1lO31hcHBlbmRSaWdodChlKXt0aGlzLmludHJvPXRoaXMuaW50cm8rZTt9Y2xvbmUoKXtjb25zdCB0PW5ldyBlKHRoaXMuc3RhcnQsdGhpcy5lbmQsdGhpcy5vcmlnaW5hbCk7cmV0dXJuIHQuaW50cm89dGhpcy5pbnRybyx0Lm91dHJvPXRoaXMub3V0cm8sdC5jb250ZW50PXRoaXMuY29udGVudCx0LnN0b3JlTmFtZT10aGlzLnN0b3JlTmFtZSx0LmVkaXRlZD10aGlzLmVkaXRlZCx0fWNvbnRhaW5zKGUpe3JldHVybiB0aGlzLnN0YXJ0PGUmJmU8dGhpcy5lbmR9ZWFjaE5leHQoZSl7bGV0IHQ9dGhpcztmb3IoO3Q7KWUodCksdD10Lm5leHQ7fWVhY2hQcmV2aW91cyhlKXtsZXQgdD10aGlzO2Zvcig7dDspZSh0KSx0PXQucHJldmlvdXM7fWVkaXQoZSx0LHMpe3JldHVybiB0aGlzLmNvbnRlbnQ9ZSxzfHwodGhpcy5pbnRybz0iIix0aGlzLm91dHJvPSIiKSx0aGlzLnN0b3JlTmFtZT10LHRoaXMuZWRpdGVkPSEwLHRoaXN9cHJlcGVuZExlZnQoZSl7dGhpcy5vdXRybz1lK3RoaXMub3V0cm87fXByZXBlbmRSaWdodChlKXt0aGlzLmludHJvPWUrdGhpcy5pbnRybzt9c3BsaXQodCl7Y29uc3Qgcz10LXRoaXMuc3RhcnQsaT10aGlzLm9yaWdpbmFsLnNsaWNlKDAscyksbj10aGlzLm9yaWdpbmFsLnNsaWNlKHMpO3RoaXMub3JpZ2luYWw9aTtjb25zdCByPW5ldyBlKHQsdGhpcy5lbmQsbik7cmV0dXJuIHIub3V0cm89dGhpcy5vdXRybyx0aGlzLm91dHJvPSIiLHRoaXMuZW5kPXQsdGhpcy5lZGl0ZWQ/KHIuZWRpdCgiIiwhMSksdGhpcy5jb250ZW50PSIiKTp0aGlzLmNvbnRlbnQ9aSxyLm5leHQ9dGhpcy5uZXh0LHIubmV4dCYmKHIubmV4dC5wcmV2aW91cz1yKSxyLnByZXZpb3VzPXRoaXMsdGhpcy5uZXh0PXIscn10b1N0cmluZygpe3JldHVybiB0aGlzLmludHJvK3RoaXMuY29udGVudCt0aGlzLm91dHJvfXRyaW1FbmQoZSl7aWYodGhpcy5vdXRybz10aGlzLm91dHJvLnJlcGxhY2UoZSwiIiksdGhpcy5vdXRyby5sZW5ndGgpcmV0dXJuICEwO2NvbnN0IHQ9dGhpcy5jb250ZW50LnJlcGxhY2UoZSwiIik7cmV0dXJuIHQubGVuZ3RoPyh0IT09dGhpcy5jb250ZW50JiZ0aGlzLnNwbGl0KHRoaXMuc3RhcnQrdC5sZW5ndGgpLmVkaXQoIiIsdm9pZCAwLCEwKSwhMCk6KHRoaXMuZWRpdCgiIix2b2lkIDAsITApLHRoaXMuaW50cm89dGhpcy5pbnRyby5yZXBsYWNlKGUsIiIpLCEhdGhpcy5pbnRyby5sZW5ndGh8fHZvaWQgMCl9dHJpbVN0YXJ0KGUpe2lmKHRoaXMuaW50cm89dGhpcy5pbnRyby5yZXBsYWNlKGUsIiIpLHRoaXMuaW50cm8ubGVuZ3RoKXJldHVybiAhMDtjb25zdCB0PXRoaXMuY29udGVudC5yZXBsYWNlKGUsIiIpO3JldHVybiB0Lmxlbmd0aD8odCE9PXRoaXMuY29udGVudCYmKHRoaXMuc3BsaXQodGhpcy5lbmQtdC5sZW5ndGgpLHRoaXMuZWRpdCgiIix2b2lkIDAsITApKSwhMCk6KHRoaXMuZWRpdCgiIix2b2lkIDAsITApLHRoaXMub3V0cm89dGhpcy5vdXRyby5yZXBsYWNlKGUsIiIpLCEhdGhpcy5vdXRyby5sZW5ndGh8fHZvaWQgMCl9fTtmdW5jdGlvbiBvKCl7cmV0dXJuICJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93JiYiZnVuY3Rpb24iPT10eXBlb2Ygd2luZG93LmJ0b2E/ZT0+d2luZG93LmJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KGUpKSk6ImZ1bmN0aW9uIj09dHlwZW9mIEJ1ZmZlcj9lPT5CdWZmZXIuZnJvbShlLCJ1dGYtOCIpLnRvU3RyaW5nKCJiYXNlNjQiKTooKT0+e3Rocm93IG5ldyBFcnJvcigiVW5zdXBwb3J0ZWQgZW52aXJvbm1lbnQ6IGB3aW5kb3cuYnRvYWAgb3IgYEJ1ZmZlcmAgc2hvdWxkIGJlIHN1cHBvcnRlZC4iKX19Y29uc3QgYT1vKCk7Y2xhc3MgbHtjb25zdHJ1Y3RvcihlKXt0aGlzLnZlcnNpb249Myx0aGlzLmZpbGU9ZS5maWxlLHRoaXMuc291cmNlcz1lLnNvdXJjZXMsdGhpcy5zb3VyY2VzQ29udGVudD1lLnNvdXJjZXNDb250ZW50LHRoaXMubmFtZXM9ZS5uYW1lcyx0aGlzLm1hcHBpbmdzPWkuZW5jb2RlKGUubWFwcGluZ3MpLHZvaWQgMCE9PWUueF9nb29nbGVfaWdub3JlTGlzdCYmKHRoaXMueF9nb29nbGVfaWdub3JlTGlzdD1lLnhfZ29vZ2xlX2lnbm9yZUxpc3QpO310b1N0cmluZygpe3JldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzKX10b1VybCgpe3JldHVybiAiZGF0YTphcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTg7YmFzZTY0LCIrYSh0aGlzLnRvU3RyaW5nKCkpfX1mdW5jdGlvbiBjKGUsdCl7Y29uc3Qgcz1lLnNwbGl0KC9bL1xcXS8pLGk9dC5zcGxpdCgvWy9cXF0vKTtmb3Iocy5wb3AoKTtzWzBdPT09aVswXTspcy5zaGlmdCgpLGkuc2hpZnQoKTtpZihzLmxlbmd0aCl7bGV0IGU9cy5sZW5ndGg7Zm9yKDtlLS07KXNbZV09Ii4uIjt9cmV0dXJuIHMuY29uY2F0KGkpLmpvaW4oIi8iKX1jb25zdCBoPU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7ZnVuY3Rpb24gdShlKXtyZXR1cm4gIltvYmplY3QgT2JqZWN0XSI9PT1oLmNhbGwoZSl9ZnVuY3Rpb24gZChlKXtjb25zdCB0PWUuc3BsaXQoIlxuIikscz1bXTtmb3IobGV0IGU9MCxpPTA7ZTx0Lmxlbmd0aDtlKyspcy5wdXNoKGkpLGkrPXRbZV0ubGVuZ3RoKzE7cmV0dXJuIGZ1bmN0aW9uKGUpe2xldCB0PTAsaT1zLmxlbmd0aDtmb3IoO3Q8aTspe2NvbnN0IG49dCtpPj4xO2U8c1tuXT9pPW46dD1uKzE7fWNvbnN0IG49dC0xO3JldHVybiB7bGluZTpuLGNvbHVtbjplLXNbbl19fX1jbGFzcyBwe2NvbnN0cnVjdG9yKGUpe3RoaXMuaGlyZXM9ZSx0aGlzLmdlbmVyYXRlZENvZGVMaW5lPTAsdGhpcy5nZW5lcmF0ZWRDb2RlQ29sdW1uPTAsdGhpcy5yYXc9W10sdGhpcy5yYXdTZWdtZW50cz10aGlzLnJhd1t0aGlzLmdlbmVyYXRlZENvZGVMaW5lXT1bXSx0aGlzLnBlbmRpbmc9bnVsbDt9YWRkRWRpdChlLHQscyxpKXtpZih0Lmxlbmd0aCl7Y29uc3QgdD1bdGhpcy5nZW5lcmF0ZWRDb2RlQ29sdW1uLGUscy5saW5lLHMuY29sdW1uXTtpPj0wJiZ0LnB1c2goaSksdGhpcy5yYXdTZWdtZW50cy5wdXNoKHQpO31lbHNlIHRoaXMucGVuZGluZyYmdGhpcy5yYXdTZWdtZW50cy5wdXNoKHRoaXMucGVuZGluZyk7dGhpcy5hZHZhbmNlKHQpLHRoaXMucGVuZGluZz1udWxsO31hZGRVbmVkaXRlZENodW5rKGUsdCxzLGksbil7bGV0IHI9dC5zdGFydCxvPSEwO2Zvcig7cjx0LmVuZDspKHRoaXMuaGlyZXN8fG98fG4uaGFzKHIpKSYmdGhpcy5yYXdTZWdtZW50cy5wdXNoKFt0aGlzLmdlbmVyYXRlZENvZGVDb2x1bW4sZSxpLmxpbmUsaS5jb2x1bW5dKSwiXG4iPT09c1tyXT8oaS5saW5lKz0xLGkuY29sdW1uPTAsdGhpcy5nZW5lcmF0ZWRDb2RlTGluZSs9MSx0aGlzLnJhd1t0aGlzLmdlbmVyYXRlZENvZGVMaW5lXT10aGlzLnJhd1NlZ21lbnRzPVtdLHRoaXMuZ2VuZXJhdGVkQ29kZUNvbHVtbj0wLG89ITApOihpLmNvbHVtbis9MSx0aGlzLmdlbmVyYXRlZENvZGVDb2x1bW4rPTEsbz0hMSkscis9MTt0aGlzLnBlbmRpbmc9bnVsbDt9YWR2YW5jZShlKXtpZighZSlyZXR1cm47Y29uc3QgdD1lLnNwbGl0KCJcbiIpO2lmKHQubGVuZ3RoPjEpe2ZvcihsZXQgZT0wO2U8dC5sZW5ndGgtMTtlKyspdGhpcy5nZW5lcmF0ZWRDb2RlTGluZSsrLHRoaXMucmF3W3RoaXMuZ2VuZXJhdGVkQ29kZUxpbmVdPXRoaXMucmF3U2VnbWVudHM9W107dGhpcy5nZW5lcmF0ZWRDb2RlQ29sdW1uPTA7fXRoaXMuZ2VuZXJhdGVkQ29kZUNvbHVtbis9dFt0Lmxlbmd0aC0xXS5sZW5ndGg7fX1jb25zdCBmPSJcbiIsbT17aW5zZXJ0TGVmdDohMSxpbnNlcnRSaWdodDohMSxzdG9yZU5hbWU6ITF9O2NsYXNzIGd7Y29uc3RydWN0b3IoZSx0PXt9KXtjb25zdCBzPW5ldyByKDAsZS5sZW5ndGgsZSk7T2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcyx7b3JpZ2luYWw6e3dyaXRhYmxlOiEwLHZhbHVlOmV9LG91dHJvOnt3cml0YWJsZTohMCx2YWx1ZToiIn0saW50cm86e3dyaXRhYmxlOiEwLHZhbHVlOiIifSxmaXJzdENodW5rOnt3cml0YWJsZTohMCx2YWx1ZTpzfSxsYXN0Q2h1bms6e3dyaXRhYmxlOiEwLHZhbHVlOnN9LGxhc3RTZWFyY2hlZENodW5rOnt3cml0YWJsZTohMCx2YWx1ZTpzfSxieVN0YXJ0Ont3cml0YWJsZTohMCx2YWx1ZTp7fX0sYnlFbmQ6e3dyaXRhYmxlOiEwLHZhbHVlOnt9fSxmaWxlbmFtZTp7d3JpdGFibGU6ITAsdmFsdWU6dC5maWxlbmFtZX0saW5kZW50RXhjbHVzaW9uUmFuZ2VzOnt3cml0YWJsZTohMCx2YWx1ZTp0LmluZGVudEV4Y2x1c2lvblJhbmdlc30sc291cmNlbWFwTG9jYXRpb25zOnt3cml0YWJsZTohMCx2YWx1ZTpuZXcgbn0sc3RvcmVkTmFtZXM6e3dyaXRhYmxlOiEwLHZhbHVlOnt9fSxpbmRlbnRTdHI6e3dyaXRhYmxlOiEwLHZhbHVlOnZvaWQgMH0saWdub3JlTGlzdDp7d3JpdGFibGU6ITAsdmFsdWU6dC5pZ25vcmVMaXN0fX0pLHRoaXMuYnlTdGFydFswXT1zLHRoaXMuYnlFbmRbZS5sZW5ndGhdPXM7fWFkZFNvdXJjZW1hcExvY2F0aW9uKGUpe3RoaXMuc291cmNlbWFwTG9jYXRpb25zLmFkZChlKTt9YXBwZW5kKGUpe2lmKCJzdHJpbmciIT10eXBlb2YgZSl0aHJvdyBuZXcgVHlwZUVycm9yKCJvdXRybyBjb250ZW50IG11c3QgYmUgYSBzdHJpbmciKTtyZXR1cm4gdGhpcy5vdXRybys9ZSx0aGlzfWFwcGVuZExlZnQoZSx0KXtpZigic3RyaW5nIiE9dHlwZW9mIHQpdGhyb3cgbmV3IFR5cGVFcnJvcigiaW5zZXJ0ZWQgY29udGVudCBtdXN0IGJlIGEgc3RyaW5nIik7dGhpcy5fc3BsaXQoZSk7Y29uc3Qgcz10aGlzLmJ5RW5kW2VdO3JldHVybiBzP3MuYXBwZW5kTGVmdCh0KTp0aGlzLmludHJvKz10LHRoaXN9YXBwZW5kUmlnaHQoZSx0KXtpZigic3RyaW5nIiE9dHlwZW9mIHQpdGhyb3cgbmV3IFR5cGVFcnJvcigiaW5zZXJ0ZWQgY29udGVudCBtdXN0IGJlIGEgc3RyaW5nIik7dGhpcy5fc3BsaXQoZSk7Y29uc3Qgcz10aGlzLmJ5U3RhcnRbZV07cmV0dXJuIHM/cy5hcHBlbmRSaWdodCh0KTp0aGlzLm91dHJvKz10LHRoaXN9Y2xvbmUoKXtjb25zdCBlPW5ldyBnKHRoaXMub3JpZ2luYWwse2ZpbGVuYW1lOnRoaXMuZmlsZW5hbWV9KTtsZXQgdD10aGlzLmZpcnN0Q2h1bmsscz1lLmZpcnN0Q2h1bms9ZS5sYXN0U2VhcmNoZWRDaHVuaz10LmNsb25lKCk7Zm9yKDt0Oyl7ZS5ieVN0YXJ0W3Muc3RhcnRdPXMsZS5ieUVuZFtzLmVuZF09cztjb25zdCBpPXQubmV4dCxuPWkmJmkuY2xvbmUoKTtuJiYocy5uZXh0PW4sbi5wcmV2aW91cz1zLHM9biksdD1pO31yZXR1cm4gZS5sYXN0Q2h1bms9cyx0aGlzLmluZGVudEV4Y2x1c2lvblJhbmdlcyYmKGUuaW5kZW50RXhjbHVzaW9uUmFuZ2VzPXRoaXMuaW5kZW50RXhjbHVzaW9uUmFuZ2VzLnNsaWNlKCkpLGUuc291cmNlbWFwTG9jYXRpb25zPW5ldyBuKHRoaXMuc291cmNlbWFwTG9jYXRpb25zKSxlLmludHJvPXRoaXMuaW50cm8sZS5vdXRybz10aGlzLm91dHJvLGV9Z2VuZXJhdGVEZWNvZGVkTWFwKGUpe2U9ZXx8e307Y29uc3QgdD1PYmplY3Qua2V5cyh0aGlzLnN0b3JlZE5hbWVzKSxzPW5ldyBwKGUuaGlyZXMpLGk9ZCh0aGlzLm9yaWdpbmFsKTtyZXR1cm4gdGhpcy5pbnRybyYmcy5hZHZhbmNlKHRoaXMuaW50cm8pLHRoaXMuZmlyc3RDaHVuay5lYWNoTmV4dCgoZT0+e2NvbnN0IG49aShlLnN0YXJ0KTtlLmludHJvLmxlbmd0aCYmcy5hZHZhbmNlKGUuaW50cm8pLGUuZWRpdGVkP3MuYWRkRWRpdCgwLGUuY29udGVudCxuLGUuc3RvcmVOYW1lP3QuaW5kZXhPZihlLm9yaWdpbmFsKTotMSk6cy5hZGRVbmVkaXRlZENodW5rKDAsZSx0aGlzLm9yaWdpbmFsLG4sdGhpcy5zb3VyY2VtYXBMb2NhdGlvbnMpLGUub3V0cm8ubGVuZ3RoJiZzLmFkdmFuY2UoZS5vdXRybyk7fSkpLHtmaWxlOmUuZmlsZT9lLmZpbGUuc3BsaXQoL1svXFxdLykucG9wKCk6dm9pZCAwLHNvdXJjZXM6W2Uuc291cmNlP2MoZS5maWxlfHwiIixlLnNvdXJjZSk6ZS5maWxlfHwiIl0sc291cmNlc0NvbnRlbnQ6ZS5pbmNsdWRlQ29udGVudD9bdGhpcy5vcmlnaW5hbF06dm9pZCAwLG5hbWVzOnQsbWFwcGluZ3M6cy5yYXcseF9nb29nbGVfaWdub3JlTGlzdDp0aGlzLmlnbm9yZUxpc3Q/WzBdOnZvaWQgMH19Z2VuZXJhdGVNYXAoZSl7cmV0dXJuIG5ldyBsKHRoaXMuZ2VuZXJhdGVEZWNvZGVkTWFwKGUpKX1fZW5zdXJlaW5kZW50U3RyKCl7dm9pZCAwPT09dGhpcy5pbmRlbnRTdHImJih0aGlzLmluZGVudFN0cj1mdW5jdGlvbihlKXtjb25zdCB0PWUuc3BsaXQoIlxuIikscz10LmZpbHRlcigoZT0+L15cdCsvLnRlc3QoZSkpKSxpPXQuZmlsdGVyKChlPT4vXiB7Mix9Ly50ZXN0KGUpKSk7aWYoMD09PXMubGVuZ3RoJiYwPT09aS5sZW5ndGgpcmV0dXJuIG51bGw7aWYocy5sZW5ndGg+PWkubGVuZ3RoKXJldHVybiAiXHQiO2NvbnN0IG49aS5yZWR1Y2UoKChlLHQpPT57Y29uc3Qgcz0vXiArLy5leGVjKHQpWzBdLmxlbmd0aDtyZXR1cm4gTWF0aC5taW4ocyxlKX0pLDEvMCk7cmV0dXJuIG5ldyBBcnJheShuKzEpLmpvaW4oIiAiKX0odGhpcy5vcmlnaW5hbCkpO31fZ2V0UmF3SW5kZW50U3RyaW5nKCl7cmV0dXJuIHRoaXMuX2Vuc3VyZWluZGVudFN0cigpLHRoaXMuaW5kZW50U3RyfWdldEluZGVudFN0cmluZygpe3JldHVybiB0aGlzLl9lbnN1cmVpbmRlbnRTdHIoKSxudWxsPT09dGhpcy5pbmRlbnRTdHI/Ilx0Ijp0aGlzLmluZGVudFN0cn1pbmRlbnQoZSx0KXtjb25zdCBzPS9eW15cclxuXS9nbTtpZih1KGUpJiYodD1lLGU9dm9pZCAwKSx2b2lkIDA9PT1lJiYodGhpcy5fZW5zdXJlaW5kZW50U3RyKCksZT10aGlzLmluZGVudFN0cnx8Ilx0IiksIiI9PT1lKXJldHVybiB0aGlzO2NvbnN0IGk9e307aWYoKHQ9dHx8e30pLmV4Y2x1ZGUpeygibnVtYmVyIj09dHlwZW9mIHQuZXhjbHVkZVswXT9bdC5leGNsdWRlXTp0LmV4Y2x1ZGUpLmZvckVhY2goKGU9Pntmb3IobGV0IHQ9ZVswXTt0PGVbMV07dCs9MSlpW3RdPSEwO30pKTt9bGV0IG49ITEhPT10LmluZGVudFN0YXJ0O2NvbnN0IHI9dD0+bj9gJHtlfSR7dH1gOihuPSEwLHQpO3RoaXMuaW50cm89dGhpcy5pbnRyby5yZXBsYWNlKHMscik7bGV0IG89MCxhPXRoaXMuZmlyc3RDaHVuaztmb3IoO2E7KXtjb25zdCB0PWEuZW5kO2lmKGEuZWRpdGVkKWlbb118fChhLmNvbnRlbnQ9YS5jb250ZW50LnJlcGxhY2UocyxyKSxhLmNvbnRlbnQubGVuZ3RoJiYobj0iXG4iPT09YS5jb250ZW50W2EuY29udGVudC5sZW5ndGgtMV0pKTtlbHNlIGZvcihvPWEuc3RhcnQ7bzx0Oyl7aWYoIWlbb10pe2NvbnN0IHQ9dGhpcy5vcmlnaW5hbFtvXTsiXG4iPT09dD9uPSEwOiJcciIhPT10JiZuJiYobj0hMSxvPT09YS5zdGFydHx8KHRoaXMuX3NwbGl0Q2h1bmsoYSxvKSxhPWEubmV4dCksYS5wcmVwZW5kUmlnaHQoZSkpO31vKz0xO31vPWEuZW5kLGE9YS5uZXh0O31yZXR1cm4gdGhpcy5vdXRybz10aGlzLm91dHJvLnJlcGxhY2UocyxyKSx0aGlzfWluc2VydCgpe3Rocm93IG5ldyBFcnJvcigibWFnaWNTdHJpbmcuaW5zZXJ0KC4uLikgaXMgZGVwcmVjYXRlZC4gVXNlIHByZXBlbmRSaWdodCguLi4pIG9yIGFwcGVuZExlZnQoLi4uKSIpfWluc2VydExlZnQoZSx0KXtyZXR1cm4gbS5pbnNlcnRMZWZ0fHwoY29uc29sZS53YXJuKCJtYWdpY1N0cmluZy5pbnNlcnRMZWZ0KC4uLikgaXMgZGVwcmVjYXRlZC4gVXNlIG1hZ2ljU3RyaW5nLmFwcGVuZExlZnQoLi4uKSBpbnN0ZWFkIiksbS5pbnNlcnRMZWZ0PSEwKSx0aGlzLmFwcGVuZExlZnQoZSx0KX1pbnNlcnRSaWdodChlLHQpe3JldHVybiBtLmluc2VydFJpZ2h0fHwoY29uc29sZS53YXJuKCJtYWdpY1N0cmluZy5pbnNlcnRSaWdodCguLi4pIGlzIGRlcHJlY2F0ZWQuIFVzZSBtYWdpY1N0cmluZy5wcmVwZW5kUmlnaHQoLi4uKSBpbnN0ZWFkIiksbS5pbnNlcnRSaWdodD0hMCksdGhpcy5wcmVwZW5kUmlnaHQoZSx0KX1tb3ZlKGUsdCxzKXtpZihzPj1lJiZzPD10KXRocm93IG5ldyBFcnJvcigiQ2Fubm90IG1vdmUgYSBzZWxlY3Rpb24gaW5zaWRlIGl0c2VsZiIpO3RoaXMuX3NwbGl0KGUpLHRoaXMuX3NwbGl0KHQpLHRoaXMuX3NwbGl0KHMpO2NvbnN0IGk9dGhpcy5ieVN0YXJ0W2VdLG49dGhpcy5ieUVuZFt0XSxyPWkucHJldmlvdXMsbz1uLm5leHQsYT10aGlzLmJ5U3RhcnRbc107aWYoIWEmJm49PT10aGlzLmxhc3RDaHVuaylyZXR1cm4gdGhpcztjb25zdCBsPWE/YS5wcmV2aW91czp0aGlzLmxhc3RDaHVuaztyZXR1cm4gciYmKHIubmV4dD1vKSxvJiYoby5wcmV2aW91cz1yKSxsJiYobC5uZXh0PWkpLGEmJihhLnByZXZpb3VzPW4pLGkucHJldmlvdXN8fCh0aGlzLmZpcnN0Q2h1bms9bi5uZXh0KSxuLm5leHR8fCh0aGlzLmxhc3RDaHVuaz1pLnByZXZpb3VzLHRoaXMubGFzdENodW5rLm5leHQ9bnVsbCksaS5wcmV2aW91cz1sLG4ubmV4dD1hfHxudWxsLGx8fCh0aGlzLmZpcnN0Q2h1bms9aSksYXx8KHRoaXMubGFzdENodW5rPW4pLHRoaXN9b3ZlcndyaXRlKGUsdCxzLGkpe3JldHVybiBpPWl8fHt9LHRoaXMudXBkYXRlKGUsdCxzLHsuLi5pLG92ZXJ3cml0ZTohaS5jb250ZW50T25seX0pfXVwZGF0ZShlLHQscyxpKXtpZigic3RyaW5nIiE9dHlwZW9mIHMpdGhyb3cgbmV3IFR5cGVFcnJvcigicmVwbGFjZW1lbnQgY29udGVudCBtdXN0IGJlIGEgc3RyaW5nIik7Zm9yKDtlPDA7KWUrPXRoaXMub3JpZ2luYWwubGVuZ3RoO2Zvcig7dDwwOyl0Kz10aGlzLm9yaWdpbmFsLmxlbmd0aDtpZih0PnRoaXMub3JpZ2luYWwubGVuZ3RoKXRocm93IG5ldyBFcnJvcigiZW5kIGlzIG91dCBvZiBib3VuZHMiKTtpZihlPT09dCl0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBvdmVyd3JpdGUgYSB6ZXJvLWxlbmd0aCByYW5nZSDigJMgdXNlIGFwcGVuZExlZnQgb3IgcHJlcGVuZFJpZ2h0IGluc3RlYWQiKTt0aGlzLl9zcGxpdChlKSx0aGlzLl9zcGxpdCh0KSwhMD09PWkmJihtLnN0b3JlTmFtZXx8KGNvbnNvbGUud2FybigiVGhlIGZpbmFsIGFyZ3VtZW50IHRvIG1hZ2ljU3RyaW5nLm92ZXJ3cml0ZSguLi4pIHNob3VsZCBiZSBhbiBvcHRpb25zIG9iamVjdC4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9yaWNoLWhhcnJpcy9tYWdpYy1zdHJpbmciKSxtLnN0b3JlTmFtZT0hMCksaT17c3RvcmVOYW1lOiEwfSk7Y29uc3Qgbj12b2lkIDAhPT1pJiZpLnN0b3JlTmFtZSxvPXZvaWQgMCE9PWkmJmkub3ZlcndyaXRlO2lmKG4pe2NvbnN0IHM9dGhpcy5vcmlnaW5hbC5zbGljZShlLHQpO09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLnN0b3JlZE5hbWVzLHMse3dyaXRhYmxlOiEwLHZhbHVlOiEwLGVudW1lcmFibGU6ITB9KTt9Y29uc3QgYT10aGlzLmJ5U3RhcnRbZV0sbD10aGlzLmJ5RW5kW3RdO2lmKGEpe2xldCBlPWE7Zm9yKDtlIT09bDspe2lmKGUubmV4dCE9PXRoaXMuYnlTdGFydFtlLmVuZF0pdGhyb3cgbmV3IEVycm9yKCJDYW5ub3Qgb3ZlcndyaXRlIGFjcm9zcyBhIHNwbGl0IHBvaW50Iik7ZT1lLm5leHQsZS5lZGl0KCIiLCExKTt9YS5lZGl0KHMsbiwhbyk7fWVsc2Uge2NvbnN0IGk9bmV3IHIoZSx0LCIiKS5lZGl0KHMsbik7bC5uZXh0PWksaS5wcmV2aW91cz1sO31yZXR1cm4gdGhpc31wcmVwZW5kKGUpe2lmKCJzdHJpbmciIT10eXBlb2YgZSl0aHJvdyBuZXcgVHlwZUVycm9yKCJvdXRybyBjb250ZW50IG11c3QgYmUgYSBzdHJpbmciKTtyZXR1cm4gdGhpcy5pbnRybz1lK3RoaXMuaW50cm8sdGhpc31wcmVwZW5kTGVmdChlLHQpe2lmKCJzdHJpbmciIT10eXBlb2YgdCl0aHJvdyBuZXcgVHlwZUVycm9yKCJpbnNlcnRlZCBjb250ZW50IG11c3QgYmUgYSBzdHJpbmciKTt0aGlzLl9zcGxpdChlKTtjb25zdCBzPXRoaXMuYnlFbmRbZV07cmV0dXJuIHM/cy5wcmVwZW5kTGVmdCh0KTp0aGlzLmludHJvPXQrdGhpcy5pbnRybyx0aGlzfXByZXBlbmRSaWdodChlLHQpe2lmKCJzdHJpbmciIT10eXBlb2YgdCl0aHJvdyBuZXcgVHlwZUVycm9yKCJpbnNlcnRlZCBjb250ZW50IG11c3QgYmUgYSBzdHJpbmciKTt0aGlzLl9zcGxpdChlKTtjb25zdCBzPXRoaXMuYnlTdGFydFtlXTtyZXR1cm4gcz9zLnByZXBlbmRSaWdodCh0KTp0aGlzLm91dHJvPXQrdGhpcy5vdXRybyx0aGlzfXJlbW92ZShlLHQpe2Zvcig7ZTwwOyllKz10aGlzLm9yaWdpbmFsLmxlbmd0aDtmb3IoO3Q8MDspdCs9dGhpcy5vcmlnaW5hbC5sZW5ndGg7aWYoZT09PXQpcmV0dXJuIHRoaXM7aWYoZTwwfHx0PnRoaXMub3JpZ2luYWwubGVuZ3RoKXRocm93IG5ldyBFcnJvcigiQ2hhcmFjdGVyIGlzIG91dCBvZiBib3VuZHMiKTtpZihlPnQpdGhyb3cgbmV3IEVycm9yKCJlbmQgbXVzdCBiZSBncmVhdGVyIHRoYW4gc3RhcnQiKTt0aGlzLl9zcGxpdChlKSx0aGlzLl9zcGxpdCh0KTtsZXQgcz10aGlzLmJ5U3RhcnRbZV07Zm9yKDtzOylzLmludHJvPSIiLHMub3V0cm89IiIscy5lZGl0KCIiKSxzPXQ+cy5lbmQ/dGhpcy5ieVN0YXJ0W3MuZW5kXTpudWxsO3JldHVybiB0aGlzfWxhc3RDaGFyKCl7aWYodGhpcy5vdXRyby5sZW5ndGgpcmV0dXJuIHRoaXMub3V0cm9bdGhpcy5vdXRyby5sZW5ndGgtMV07bGV0IGU9dGhpcy5sYXN0Q2h1bms7ZG97aWYoZS5vdXRyby5sZW5ndGgpcmV0dXJuIGUub3V0cm9bZS5vdXRyby5sZW5ndGgtMV07aWYoZS5jb250ZW50Lmxlbmd0aClyZXR1cm4gZS5jb250ZW50W2UuY29udGVudC5sZW5ndGgtMV07aWYoZS5pbnRyby5sZW5ndGgpcmV0dXJuIGUuaW50cm9bZS5pbnRyby5sZW5ndGgtMV19d2hpbGUoZT1lLnByZXZpb3VzKTtyZXR1cm4gdGhpcy5pbnRyby5sZW5ndGg/dGhpcy5pbnRyb1t0aGlzLmludHJvLmxlbmd0aC0xXToiIn1sYXN0TGluZSgpe2xldCBlPXRoaXMub3V0cm8ubGFzdEluZGV4T2YoZik7aWYoLTEhPT1lKXJldHVybiB0aGlzLm91dHJvLnN1YnN0cihlKzEpO2xldCB0PXRoaXMub3V0cm8scz10aGlzLmxhc3RDaHVuaztkb3tpZihzLm91dHJvLmxlbmd0aD4wKXtpZihlPXMub3V0cm8ubGFzdEluZGV4T2YoZiksLTEhPT1lKXJldHVybiBzLm91dHJvLnN1YnN0cihlKzEpK3Q7dD1zLm91dHJvK3Q7fWlmKHMuY29udGVudC5sZW5ndGg+MCl7aWYoZT1zLmNvbnRlbnQubGFzdEluZGV4T2YoZiksLTEhPT1lKXJldHVybiBzLmNvbnRlbnQuc3Vic3RyKGUrMSkrdDt0PXMuY29udGVudCt0O31pZihzLmludHJvLmxlbmd0aD4wKXtpZihlPXMuaW50cm8ubGFzdEluZGV4T2YoZiksLTEhPT1lKXJldHVybiBzLmludHJvLnN1YnN0cihlKzEpK3Q7dD1zLmludHJvK3Q7fX13aGlsZShzPXMucHJldmlvdXMpO3JldHVybiBlPXRoaXMuaW50cm8ubGFzdEluZGV4T2YoZiksLTEhPT1lP3RoaXMuaW50cm8uc3Vic3RyKGUrMSkrdDp0aGlzLmludHJvK3R9c2xpY2UoZT0wLHQ9dGhpcy5vcmlnaW5hbC5sZW5ndGgpe2Zvcig7ZTwwOyllKz10aGlzLm9yaWdpbmFsLmxlbmd0aDtmb3IoO3Q8MDspdCs9dGhpcy5vcmlnaW5hbC5sZW5ndGg7bGV0IHM9IiIsaT10aGlzLmZpcnN0Q2h1bms7Zm9yKDtpJiYoaS5zdGFydD5lfHxpLmVuZDw9ZSk7KXtpZihpLnN0YXJ0PHQmJmkuZW5kPj10KXJldHVybiBzO2k9aS5uZXh0O31pZihpJiZpLmVkaXRlZCYmaS5zdGFydCE9PWUpdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgdXNlIHJlcGxhY2VkIGNoYXJhY3RlciAke2V9IGFzIHNsaWNlIHN0YXJ0IGFuY2hvci5gKTtjb25zdCBuPWk7Zm9yKDtpOyl7IWkuaW50cm98fG49PT1pJiZpLnN0YXJ0IT09ZXx8KHMrPWkuaW50cm8pO2NvbnN0IHI9aS5zdGFydDx0JiZpLmVuZD49dDtpZihyJiZpLmVkaXRlZCYmaS5lbmQhPT10KXRocm93IG5ldyBFcnJvcihgQ2Fubm90IHVzZSByZXBsYWNlZCBjaGFyYWN0ZXIgJHt0fSBhcyBzbGljZSBlbmQgYW5jaG9yLmApO2NvbnN0IG89bj09PWk/ZS1pLnN0YXJ0OjAsYT1yP2kuY29udGVudC5sZW5ndGgrdC1pLmVuZDppLmNvbnRlbnQubGVuZ3RoO2lmKHMrPWkuY29udGVudC5zbGljZShvLGEpLCFpLm91dHJvfHxyJiZpLmVuZCE9PXR8fChzKz1pLm91dHJvKSxyKWJyZWFrO2k9aS5uZXh0O31yZXR1cm4gc31zbmlwKGUsdCl7Y29uc3Qgcz10aGlzLmNsb25lKCk7cmV0dXJuIHMucmVtb3ZlKDAsZSkscy5yZW1vdmUodCxzLm9yaWdpbmFsLmxlbmd0aCksc31fc3BsaXQoZSl7aWYodGhpcy5ieVN0YXJ0W2VdfHx0aGlzLmJ5RW5kW2VdKXJldHVybjtsZXQgdD10aGlzLmxhc3RTZWFyY2hlZENodW5rO2NvbnN0IHM9ZT50LmVuZDtmb3IoO3Q7KXtpZih0LmNvbnRhaW5zKGUpKXJldHVybiB0aGlzLl9zcGxpdENodW5rKHQsZSk7dD1zP3RoaXMuYnlTdGFydFt0LmVuZF06dGhpcy5ieUVuZFt0LnN0YXJ0XTt9fV9zcGxpdENodW5rKGUsdCl7aWYoZS5lZGl0ZWQmJmUuY29udGVudC5sZW5ndGgpe2NvbnN0IHM9ZCh0aGlzLm9yaWdpbmFsKSh0KTt0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBzcGxpdCBhIGNodW5rIHRoYXQgaGFzIGFscmVhZHkgYmVlbiBlZGl0ZWQgKCR7cy5saW5lfToke3MuY29sdW1ufSDigJMgIiR7ZS5vcmlnaW5hbH0iKWApfWNvbnN0IHM9ZS5zcGxpdCh0KTtyZXR1cm4gdGhpcy5ieUVuZFt0XT1lLHRoaXMuYnlTdGFydFt0XT1zLHRoaXMuYnlFbmRbcy5lbmRdPXMsZT09PXRoaXMubGFzdENodW5rJiYodGhpcy5sYXN0Q2h1bms9cyksdGhpcy5sYXN0U2VhcmNoZWRDaHVuaz1lLCEwfXRvU3RyaW5nKCl7bGV0IGU9dGhpcy5pbnRybyx0PXRoaXMuZmlyc3RDaHVuaztmb3IoO3Q7KWUrPXQudG9TdHJpbmcoKSx0PXQubmV4dDtyZXR1cm4gZSt0aGlzLm91dHJvfWlzRW1wdHkoKXtsZXQgZT10aGlzLmZpcnN0Q2h1bms7ZG97aWYoZS5pbnRyby5sZW5ndGgmJmUuaW50cm8udHJpbSgpfHxlLmNvbnRlbnQubGVuZ3RoJiZlLmNvbnRlbnQudHJpbSgpfHxlLm91dHJvLmxlbmd0aCYmZS5vdXRyby50cmltKCkpcmV0dXJuICExfXdoaWxlKGU9ZS5uZXh0KTtyZXR1cm4gITB9bGVuZ3RoKCl7bGV0IGU9dGhpcy5maXJzdENodW5rLHQ9MDtkb3t0Kz1lLmludHJvLmxlbmd0aCtlLmNvbnRlbnQubGVuZ3RoK2Uub3V0cm8ubGVuZ3RoO313aGlsZShlPWUubmV4dCk7cmV0dXJuIHR9dHJpbUxpbmVzKCl7cmV0dXJuIHRoaXMudHJpbSgiW1xcclxcbl0iKX10cmltKGUpe3JldHVybiB0aGlzLnRyaW1TdGFydChlKS50cmltRW5kKGUpfXRyaW1FbmRBYm9ydGVkKGUpe2NvbnN0IHQ9bmV3IFJlZ0V4cCgoZXx8IlxccyIpKyIrJCIpO2lmKHRoaXMub3V0cm89dGhpcy5vdXRyby5yZXBsYWNlKHQsIiIpLHRoaXMub3V0cm8ubGVuZ3RoKXJldHVybiAhMDtsZXQgcz10aGlzLmxhc3RDaHVuaztkb3tjb25zdCBlPXMuZW5kLGk9cy50cmltRW5kKHQpO2lmKHMuZW5kIT09ZSYmKHRoaXMubGFzdENodW5rPT09cyYmKHRoaXMubGFzdENodW5rPXMubmV4dCksdGhpcy5ieUVuZFtzLmVuZF09cyx0aGlzLmJ5U3RhcnRbcy5uZXh0LnN0YXJ0XT1zLm5leHQsdGhpcy5ieUVuZFtzLm5leHQuZW5kXT1zLm5leHQpLGkpcmV0dXJuICEwO3M9cy5wcmV2aW91czt9d2hpbGUocyk7cmV0dXJuICExfXRyaW1FbmQoZSl7cmV0dXJuIHRoaXMudHJpbUVuZEFib3J0ZWQoZSksdGhpc310cmltU3RhcnRBYm9ydGVkKGUpe2NvbnN0IHQ9bmV3IFJlZ0V4cCgiXiIrKGV8fCJcXHMiKSsiKyIpO2lmKHRoaXMuaW50cm89dGhpcy5pbnRyby5yZXBsYWNlKHQsIiIpLHRoaXMuaW50cm8ubGVuZ3RoKXJldHVybiAhMDtsZXQgcz10aGlzLmZpcnN0Q2h1bms7ZG97Y29uc3QgZT1zLmVuZCxpPXMudHJpbVN0YXJ0KHQpO2lmKHMuZW5kIT09ZSYmKHM9PT10aGlzLmxhc3RDaHVuayYmKHRoaXMubGFzdENodW5rPXMubmV4dCksdGhpcy5ieUVuZFtzLmVuZF09cyx0aGlzLmJ5U3RhcnRbcy5uZXh0LnN0YXJ0XT1zLm5leHQsdGhpcy5ieUVuZFtzLm5leHQuZW5kXT1zLm5leHQpLGkpcmV0dXJuICEwO3M9cy5uZXh0O313aGlsZShzKTtyZXR1cm4gITF9dHJpbVN0YXJ0KGUpe3JldHVybiB0aGlzLnRyaW1TdGFydEFib3J0ZWQoZSksdGhpc31oYXNDaGFuZ2VkKCl7cmV0dXJuIHRoaXMub3JpZ2luYWwhPT10aGlzLnRvU3RyaW5nKCl9X3JlcGxhY2VSZWdleHAoZSx0KXtmdW5jdGlvbiBzKGUscyl7cmV0dXJuICJzdHJpbmciPT10eXBlb2YgdD90LnJlcGxhY2UoL1wkKFwkfCZ8XGQrKS9nLCgodCxzKT0+e2lmKCIkIj09PXMpcmV0dXJuICIkIjtpZigiJiI9PT1zKXJldHVybiBlWzBdO3JldHVybiArczxlLmxlbmd0aD9lWytzXTpgJCR7c31gfSkpOnQoLi4uZSxlLmluZGV4LHMsZS5ncm91cHMpfWlmKGUuZ2xvYmFsKXsoZnVuY3Rpb24oZSx0KXtsZXQgcztjb25zdCBpPVtdO2Zvcig7cz1lLmV4ZWModCk7KWkucHVzaChzKTtyZXR1cm4gaX0pKGUsdGhpcy5vcmlnaW5hbCkuZm9yRWFjaCgoZT0+e251bGwhPWUuaW5kZXgmJnRoaXMub3ZlcndyaXRlKGUuaW5kZXgsZS5pbmRleCtlWzBdLmxlbmd0aCxzKGUsdGhpcy5vcmlnaW5hbCkpO30pKTt9ZWxzZSB7Y29uc3QgdD10aGlzLm9yaWdpbmFsLm1hdGNoKGUpO3QmJm51bGwhPXQuaW5kZXgmJnRoaXMub3ZlcndyaXRlKHQuaW5kZXgsdC5pbmRleCt0WzBdLmxlbmd0aCxzKHQsdGhpcy5vcmlnaW5hbCkpO31yZXR1cm4gdGhpc31fcmVwbGFjZVN0cmluZyhlLHQpe2NvbnN0e29yaWdpbmFsOnN9PXRoaXMsaT1zLmluZGV4T2YoZSk7cmV0dXJuIC0xIT09aSYmdGhpcy5vdmVyd3JpdGUoaSxpK2UubGVuZ3RoLHQpLHRoaXN9cmVwbGFjZShlLHQpe3JldHVybiAic3RyaW5nIj09dHlwZW9mIGU/dGhpcy5fcmVwbGFjZVN0cmluZyhlLHQpOnRoaXMuX3JlcGxhY2VSZWdleHAoZSx0KX1fcmVwbGFjZUFsbFN0cmluZyhlLHQpe2NvbnN0e29yaWdpbmFsOnN9PXRoaXMsaT1lLmxlbmd0aDtmb3IobGV0IG49cy5pbmRleE9mKGUpOy0xIT09bjtuPXMuaW5kZXhPZihlLG4raSkpdGhpcy5vdmVyd3JpdGUobixuK2ksdCk7cmV0dXJuIHRoaXN9cmVwbGFjZUFsbChlLHQpe2lmKCJzdHJpbmciPT10eXBlb2YgZSlyZXR1cm4gdGhpcy5fcmVwbGFjZUFsbFN0cmluZyhlLHQpO2lmKCFlLmdsb2JhbCl0aHJvdyBuZXcgVHlwZUVycm9yKCJNYWdpY1N0cmluZy5wcm90b3R5cGUucmVwbGFjZUFsbCBjYWxsZWQgd2l0aCBhIG5vbi1nbG9iYWwgUmVnRXhwIGFyZ3VtZW50Iik7cmV0dXJuIHRoaXMuX3JlcGxhY2VSZWdleHAoZSx0KX19Y29uc3QgeT1PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5O2NvbnN0IHg9L14oPzpcL3woPzpbQS1aYS16XTopP1svXFx8XSkvLEU9L15cLj9cLlwvLyxiPS9cXC9nLHY9L1svXFxdLyxTPS9cLlteLl0rJC87ZnVuY3Rpb24gQShlKXtyZXR1cm4geC50ZXN0KGUpfWZ1bmN0aW9uIGsoZSl7cmV0dXJuIEUudGVzdChlKX1mdW5jdGlvbiBJKGUpe3JldHVybiBlLnJlcGxhY2UoYiwiLyIpfWZ1bmN0aW9uIHcoZSl7cmV0dXJuIGUuc3BsaXQodikucG9wKCl8fCIifWZ1bmN0aW9uIFAoZSl7Y29uc3QgdD0vWy9cXF1bXi9cXF0qJC8uZXhlYyhlKTtpZighdClyZXR1cm4gIi4iO3JldHVybiBlLnNsaWNlKDAsLXRbMF0ubGVuZ3RoKXx8Ii8ifWZ1bmN0aW9uIEMoZSl7Y29uc3QgdD1TLmV4ZWModyhlKSk7cmV0dXJuIHQ/dFswXToiIn1mdW5jdGlvbiAkKGUsdCl7Y29uc3Qgcz1lLnNwbGl0KHYpLmZpbHRlcihCb29sZWFuKSxpPXQuc3BsaXQodikuZmlsdGVyKEJvb2xlYW4pO2ZvcigiLiI9PT1zWzBdJiZzLnNoaWZ0KCksIi4iPT09aVswXSYmaS5zaGlmdCgpO3NbMF0mJmlbMF0mJnNbMF09PT1pWzBdOylzLnNoaWZ0KCksaS5zaGlmdCgpO2Zvcig7Ii4uIj09PWlbMF0mJnMubGVuZ3RoPjA7KWkuc2hpZnQoKSxzLnBvcCgpO2Zvcig7cy5wb3AoKTspaS51bnNoaWZ0KCIuLiIpO3JldHVybiBpLmpvaW4oIi8iKX1mdW5jdGlvbiBOJDUoLi4uZSl7Y29uc3QgdD1lLnNoaWZ0KCk7aWYoIXQpcmV0dXJuICIvIjtsZXQgcz10LnNwbGl0KHYpO2Zvcihjb25zdCB0IG9mIGUpaWYoQSh0KSlzPXQuc3BsaXQodik7ZWxzZSB7Y29uc3QgZT10LnNwbGl0KHYpO2Zvcig7Ii4iPT09ZVswXXx8Ii4uIj09PWVbMF07KXsiLi4iPT09ZS5zaGlmdCgpJiZzLnBvcCgpO31zLnB1c2goLi4uZSk7fXJldHVybiBzLmpvaW4oIi8iKX1jb25zdCBfPS9bXG5ccidcXFx1MjAyOFx1MjAyOV0vLFIkMz0vKFtcblxyJ1x1MjAyOFx1MjAyOV0pL2csTT0vXFwvZztmdW5jdGlvbiBPKGUpe3JldHVybiBfLnRlc3QoZSk/ZS5yZXBsYWNlKE0sIlxcXFwiKS5yZXBsYWNlKFIkMywiXFwkMSIpOmV9ZnVuY3Rpb24gRChlKXtjb25zdCB0PXcoZSk7cmV0dXJuIHQuc2xpY2UoMCxNYXRoLm1heCgwLHQubGVuZ3RoLUMoZSkubGVuZ3RoKSl9ZnVuY3Rpb24gTChlKXtyZXR1cm4gQShlKT8kKE4kNSgpLGUpOmV9ZnVuY3Rpb24gVChlKXtyZXR1cm4gIi8iPT09ZVswXXx8Ii4iPT09ZVswXSYmKCIvIj09PWVbMV18fCIuIj09PWVbMV0pfHxBKGUpfWNvbnN0IFY9L14oXC5cLlwvKSpcLlwuJC87ZnVuY3Rpb24gQihlLHQscyxpKXtsZXQgbj1JKCQoUChlKSx0KSk7aWYocyYmbi5lbmRzV2l0aCgiLmpzIikmJihuPW4uc2xpY2UoMCwtMykpLGkpe2lmKCIiPT09bilyZXR1cm4gIi4uLyIrdyh0KTtpZihWLnRlc3QobikpcmV0dXJuIFsuLi5uLnNwbGl0KCIvIiksIi4uIix3KHQpXS5qb2luKCIvIil9cmV0dXJuIG4/bi5zdGFydHNXaXRoKCIuLiIpP246Ii4vIituOiIuIn1jbGFzcyB6e2NvbnN0cnVjdG9yKGUsdCxzKXt0aGlzLm9wdGlvbnM9dCx0aGlzLmlucHV0QmFzZT1zLHRoaXMuZGVmYXVsdFZhcmlhYmxlTmFtZT0iIix0aGlzLm5hbWVzcGFjZVZhcmlhYmxlTmFtZT0iIix0aGlzLnZhcmlhYmxlTmFtZT0iIix0aGlzLmZpbGVOYW1lPW51bGwsdGhpcy5pbXBvcnRBc3NlcnRpb25zPW51bGwsdGhpcy5pZD1lLmlkLHRoaXMubW9kdWxlSW5mbz1lLmluZm8sdGhpcy5yZW5vcm1hbGl6ZVJlbmRlclBhdGg9ZS5yZW5vcm1hbGl6ZVJlbmRlclBhdGgsdGhpcy5zdWdnZXN0ZWRWYXJpYWJsZU5hbWU9ZS5zdWdnZXN0ZWRWYXJpYWJsZU5hbWU7fWdldEZpbGVOYW1lKCl7aWYodGhpcy5maWxlTmFtZSlyZXR1cm4gdGhpcy5maWxlTmFtZTtjb25zdHtwYXRoczplfT10aGlzLm9wdGlvbnM7cmV0dXJuIHRoaXMuZmlsZU5hbWU9KCJmdW5jdGlvbiI9PXR5cGVvZiBlP2UodGhpcy5pZCk6ZVt0aGlzLmlkXSl8fCh0aGlzLnJlbm9ybWFsaXplUmVuZGVyUGF0aD9JKCQodGhpcy5pbnB1dEJhc2UsdGhpcy5pZCkpOnRoaXMuaWQpfWdldEltcG9ydEFzc2VydGlvbnMoZSl7cmV0dXJuIHRoaXMuaW1wb3J0QXNzZXJ0aW9uc3x8KHRoaXMuaW1wb3J0QXNzZXJ0aW9ucz1mdW5jdGlvbihlLHtnZXRPYmplY3Q6dH0pe2lmKCFlKXJldHVybiBudWxsO2NvbnN0IHM9T2JqZWN0LmVudHJpZXMoZSkubWFwKCgoW2UsdF0pPT5bZSxgJyR7dH0nYF0pKTtpZihzLmxlbmd0aD4wKXJldHVybiB0KHMse2xpbmVCcmVha0luZGVudDpudWxsfSk7cmV0dXJuIG51bGx9KCJlcyI9PT10aGlzLm9wdGlvbnMuZm9ybWF0JiZ0aGlzLm9wdGlvbnMuZXh0ZXJuYWxJbXBvcnRBc3NlcnRpb25zJiZ0aGlzLm1vZHVsZUluZm8uYXNzZXJ0aW9ucyxlKSl9Z2V0SW1wb3J0UGF0aChlKXtyZXR1cm4gTyh0aGlzLnJlbm9ybWFsaXplUmVuZGVyUGF0aD9CKGUsdGhpcy5nZXRGaWxlTmFtZSgpLCJhbWQiPT09dGhpcy5vcHRpb25zLmZvcm1hdCwhMSk6dGhpcy5nZXRGaWxlTmFtZSgpKX19ZnVuY3Rpb24gRiQzKGUsdCxzKXtjb25zdCBpPWUuZ2V0KHQpO2lmKHZvaWQgMCE9PWkpcmV0dXJuIGk7Y29uc3Qgbj1zKCk7cmV0dXJuIGUuc2V0KHQsbiksbn1mdW5jdGlvbiBqKCl7cmV0dXJuIG5ldyBTZXR9ZnVuY3Rpb24gVSQyKCl7cmV0dXJuIFtdfWNvbnN0IEc9U3ltYm9sKCJVbmtub3duIEtleSIpLFc9U3ltYm9sKCJVbmtub3duIE5vbi1BY2Nlc3NvciBLZXkiKSxxPVN5bWJvbCgiVW5rbm93biBJbnRlZ2VyIiksSD1TeW1ib2woIlN5bWJvbC50b1N0cmluZ1RhZyIpLEs9W10sWT1bR10sWD1bV10sUT1bcV0sWj1TeW1ib2woIkVudGl0aWVzIik7Y2xhc3MgSntjb25zdHJ1Y3Rvcigpe3RoaXMuZW50aXR5UGF0aHM9T2JqZWN0LmNyZWF0ZShudWxsLHtbWl06e3ZhbHVlOm5ldyBTZXR9fSk7fXRyYWNrRW50aXR5QXRQYXRoQW5kR2V0SWZUcmFja2VkKGUsdCl7Y29uc3Qgcz10aGlzLmdldEVudGl0aWVzKGUpO3JldHVybiAhIXMuaGFzKHQpfHwocy5hZGQodCksITEpfXdpdGhUcmFja2VkRW50aXR5QXRQYXRoKGUsdCxzLGkpe2NvbnN0IG49dGhpcy5nZXRFbnRpdGllcyhlKTtpZihuLmhhcyh0KSlyZXR1cm4gaTtuLmFkZCh0KTtjb25zdCByPXMoKTtyZXR1cm4gbi5kZWxldGUodCkscn1nZXRFbnRpdGllcyhlKXtsZXQgdD10aGlzLmVudGl0eVBhdGhzO2Zvcihjb25zdCBzIG9mIGUpdD10W3NdPXRbc118fE9iamVjdC5jcmVhdGUobnVsbCx7W1pdOnt2YWx1ZTpuZXcgU2V0fX0pO3JldHVybiB0W1pdfX1jb25zdCBlZT1uZXcgSjtjbGFzcyB0ZXtjb25zdHJ1Y3Rvcigpe3RoaXMuZW50aXR5UGF0aHM9T2JqZWN0LmNyZWF0ZShudWxsLHtbWl06e3ZhbHVlOm5ldyBNYXB9fSk7fXRyYWNrRW50aXR5QXRQYXRoQW5kR2V0SWZUcmFja2VkKGUsdCxzKXtsZXQgaT10aGlzLmVudGl0eVBhdGhzO2Zvcihjb25zdCB0IG9mIGUpaT1pW3RdPWlbdF18fE9iamVjdC5jcmVhdGUobnVsbCx7W1pdOnt2YWx1ZTpuZXcgTWFwfX0pO2NvbnN0IG49RiQzKGlbWl0sdCxqKTtyZXR1cm4gISFuLmhhcyhzKXx8KG4uYWRkKHMpLCExKX19Y29uc3Qgc2U9U3ltYm9sKCJVbmtub3duIFZhbHVlIiksaWU9U3ltYm9sKCJVbmtub3duIFRydXRoeSBWYWx1ZSIpO2NsYXNzIG5le2NvbnN0cnVjdG9yKCl7dGhpcy5pbmNsdWRlZD0hMTt9ZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe2FlKGUpO31kZW9wdGltaXplUGF0aChlKXt9Z2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUsdCxzKXtyZXR1cm4gc2V9Z2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSl7cmV0dXJuIG9lfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtyZXR1cm4gITB9aW5jbHVkZShlLHQscyl7dGhpcy5pbmNsdWRlZD0hMDt9aW5jbHVkZUNhbGxBcmd1bWVudHMoZSx0KXtmb3IoY29uc3QgcyBvZiB0KXMuaW5jbHVkZShlLCExKTt9c2hvdWxkQmVJbmNsdWRlZChlKXtyZXR1cm4gITB9fWNvbnN0IHJlPW5ldyBjbGFzcyBleHRlbmRzIG5le30sb2U9W3JlLCExXSxhZT1lPT57Zm9yKGNvbnN0IHQgb2YgZS5hcmdzKXQ/LmRlb3B0aW1pemVQYXRoKFkpO30sbGU9e2FyZ3M6W251bGxdLHR5cGU6MH0sY2U9e2FyZ3M6W251bGwscmVdLHR5cGU6MX0saGU9e2FyZ3M6W251bGxdLHR5cGU6Mix3aXRoTmV3OiExfTtjbGFzcyB1ZSBleHRlbmRzIG5le2NvbnN0cnVjdG9yKGUpe3N1cGVyKCksdGhpcy5uYW1lPWUsdGhpcy5hbHdheXNSZW5kZXJlZD0hMSx0aGlzLmZvcmJpZGRlbk5hbWVzPW51bGwsdGhpcy5pbml0UmVhY2hlZD0hMSx0aGlzLmlzSWQ9ITEsdGhpcy5pc1JlYXNzaWduZWQ9ITEsdGhpcy5raW5kPW51bGwsdGhpcy5yZW5kZXJCYXNlTmFtZT1udWxsLHRoaXMucmVuZGVyTmFtZT1udWxsO31hZGRSZWZlcmVuY2UoZSl7fWZvcmJpZE5hbWUoZSl7KHRoaXMuZm9yYmlkZGVuTmFtZXN8fCh0aGlzLmZvcmJpZGRlbk5hbWVzPW5ldyBTZXQpKS5hZGQoZSk7fWdldEJhc2VWYXJpYWJsZU5hbWUoKXtyZXR1cm4gdGhpcy5yZW5kZXJCYXNlTmFtZXx8dGhpcy5yZW5kZXJOYW1lfHx0aGlzLm5hbWV9Z2V0TmFtZShlLHQpe2lmKHQ/Lih0aGlzKSlyZXR1cm4gdGhpcy5uYW1lO2NvbnN0IHM9dGhpcy5yZW5kZXJOYW1lfHx0aGlzLm5hbWU7cmV0dXJuIHRoaXMucmVuZGVyQmFzZU5hbWU/YCR7dGhpcy5yZW5kZXJCYXNlTmFtZX0ke2Uocyl9YDpzfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUse3R5cGU6dH0scyl7cmV0dXJuIDAhPT10fHxlLmxlbmd0aD4wfWluY2x1ZGUoKXt0aGlzLmluY2x1ZGVkPSEwO31tYXJrQ2FsbGVkRnJvbVRyeVN0YXRlbWVudCgpe31zZXRSZW5kZXJOYW1lcyhlLHQpe3RoaXMucmVuZGVyQmFzZU5hbWU9ZSx0aGlzLnJlbmRlck5hbWU9dDt9fWNsYXNzIGRlIGV4dGVuZHMgdWV7Y29uc3RydWN0b3IoZSx0KXtzdXBlcih0KSx0aGlzLnJlZmVyZW5jZWQ9ITEsdGhpcy5tb2R1bGU9ZSx0aGlzLmlzTmFtZXNwYWNlPSIqIj09PXQ7fWFkZFJlZmVyZW5jZShlKXt0aGlzLnJlZmVyZW5jZWQ9ITAsImRlZmF1bHQiIT09dGhpcy5uYW1lJiYiKiIhPT10aGlzLm5hbWV8fHRoaXMubW9kdWxlLnN1Z2dlc3ROYW1lKGUubmFtZSk7fWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUse3R5cGU6dH0pe3JldHVybiAwIT09dHx8ZS5sZW5ndGg+KHRoaXMuaXNOYW1lc3BhY2U/MTowKX1pbmNsdWRlKCl7dGhpcy5pbmNsdWRlZHx8KHRoaXMuaW5jbHVkZWQ9ITAsdGhpcy5tb2R1bGUudXNlZD0hMCk7fX1jb25zdCBwZT1PYmplY3QuZnJlZXplKE9iamVjdC5jcmVhdGUobnVsbCkpLGZlPU9iamVjdC5mcmVlemUoe30pLG1lPU9iamVjdC5mcmVlemUoW10pLGdlPU9iamVjdC5mcmVlemUobmV3IGNsYXNzIGV4dGVuZHMgU2V0e2FkZCgpe3Rocm93IG5ldyBFcnJvcigiQ2Fubm90IGFkZCB0byBlbXB0eSBzZXQiKX19KTt2YXIgeWU9bmV3IFNldChbImF3YWl0IiwiYnJlYWsiLCJjYXNlIiwiY2F0Y2giLCJjbGFzcyIsImNvbnN0IiwiY29udGludWUiLCJkZWJ1Z2dlciIsImRlZmF1bHQiLCJkZWxldGUiLCJkbyIsImVsc2UiLCJlbnVtIiwiZXZhbCIsImV4cG9ydCIsImV4dGVuZHMiLCJmYWxzZSIsImZpbmFsbHkiLCJmb3IiLCJmdW5jdGlvbiIsImlmIiwiaW1wbGVtZW50cyIsImltcG9ydCIsImluIiwiaW5zdGFuY2VvZiIsImludGVyZmFjZSIsImxldCIsIk5hTiIsIm5ldyIsIm51bGwiLCJwYWNrYWdlIiwicHJpdmF0ZSIsInByb3RlY3RlZCIsInB1YmxpYyIsInJldHVybiIsInN0YXRpYyIsInN1cGVyIiwic3dpdGNoIiwidGhpcyIsInRocm93IiwidHJ1ZSIsInRyeSIsInR5cGVvZiIsInVuZGVmaW5lZCIsInZhciIsInZvaWQiLCJ3aGlsZSIsIndpdGgiLCJ5aWVsZCJdKTtjb25zdCB4ZT0vW15cdyRdL2csRWU9ZT0+KGU9Pi9cZC8udGVzdChlWzBdKSkoZSl8fHllLmhhcyhlKXx8ImFyZ3VtZW50cyI9PT1lO2Z1bmN0aW9uIGJlKGUpe3JldHVybiBlPWUucmVwbGFjZSgvLShcdykvZywoKGUsdCk9PnQudG9VcHBlckNhc2UoKSkpLnJlcGxhY2UoeGUsIl8iKSxFZShlKSYmKGU9YF8ke2V9YCksZXx8Il8ifWNvbnN0IHZlPSJ3YXJuIixTZT0iaW5mbyIsQWU9ImRlYnVnIixrZT17W0FlXTowLFtTZV06MSxzaWxlbnQ6MyxbdmVdOjJ9O2Z1bmN0aW9uIEllKGUsdCl7cmV0dXJuIGUuc3RhcnQ8PXQmJnQ8ZS5lbmR9ZnVuY3Rpb24gd2UoZSx0LHMpe3JldHVybiBmdW5jdGlvbihlLHQ9e30pe2NvbnN0e29mZnNldExpbmU6cz0wLG9mZnNldENvbHVtbjppPTB9PXQ7bGV0IG49MDtjb25zdCByPWUuc3BsaXQoIlxuIikubWFwKCgoZSx0KT0+e2NvbnN0IHM9bitlLmxlbmd0aCsxLGk9e3N0YXJ0Om4sZW5kOnMsbGluZTp0fTtyZXR1cm4gbj1zLGl9KSk7bGV0IG89MDtyZXR1cm4gZnVuY3Rpb24odCxuKXtpZigic3RyaW5nIj09dHlwZW9mIHQmJih0PWUuaW5kZXhPZih0LG4/PzApKSwtMT09PXQpcmV0dXJuO2xldCBhPXJbb107Y29uc3QgbD10Pj1hLmVuZD8xOi0xO2Zvcig7YTspe2lmKEllKGEsdCkpcmV0dXJuIHtsaW5lOnMrYS5saW5lLGNvbHVtbjppK3QtYS5zdGFydCxjaGFyYWN0ZXI6dH07bys9bCxhPXJbb107fX19KGUscykodCxzJiZzLnN0YXJ0SW5kZXgpfWZ1bmN0aW9uIFBlKGUpe3JldHVybiBlLnJlcGxhY2UoL15cdCsvLChlPT5lLnNwbGl0KCJcdCIpLmpvaW4oIiAgIikpKX1jb25zdCBDZT0xMjAsJGU9MTAsTmU9Ii4uLiI7ZnVuY3Rpb24gX2UoZSx0LHMpe2xldCBpPWUuc3BsaXQoIlxuIik7aWYodD5pLmxlbmd0aClyZXR1cm4gIiI7Y29uc3Qgbj1NYXRoLm1heChQZShpW3QtMV0uc2xpY2UoMCxzKSkubGVuZ3RoKyRlK05lLmxlbmd0aCxDZSkscj1NYXRoLm1heCgwLHQtMyk7bGV0IG89TWF0aC5taW4odCsyLGkubGVuZ3RoKTtmb3IoaT1pLnNsaWNlKHIsbyk7IS9cUy8udGVzdChpW2kubGVuZ3RoLTFdKTspaS5wb3AoKSxvLT0xO2NvbnN0IGE9U3RyaW5nKG8pLmxlbmd0aDtyZXR1cm4gaS5tYXAoKChlLGkpPT57Y29uc3Qgbz1yK2krMT09PXQ7bGV0IGw9U3RyaW5nKGkrcisxKTtmb3IoO2wubGVuZ3RoPGE7KWw9YCAke2x9YDtsZXQgYz1QZShlKTtpZihjLmxlbmd0aD5uJiYoYz1gJHtjLnNsaWNlKDAsbi1OZS5sZW5ndGgpfSR7TmV9YCksbyl7Y29uc3QgdD1mdW5jdGlvbihlKXtsZXQgdD0iIjtmb3IoO2UtLTspdCs9IiAiO3JldHVybiB0fShhKzIrUGUoZS5zbGljZSgwLHMpKS5sZW5ndGgpKyJeIjtyZXR1cm4gYCR7bH06ICR7Y31cbiR7dH1gfXJldHVybiBgJHtsfTogJHtjfWB9KSkuam9pbigiXG4iKX1mdW5jdGlvbiBSZShlLHQpe2NvbnN0IHM9ZS5sZW5ndGg8PTEsaT1lLm1hcCgoZT0+YCIke2V9ImApKTtsZXQgbj1zP2lbMF06YCR7aS5zbGljZSgwLC0xKS5qb2luKCIsICIpfSBhbmQgJHtpLnNsaWNlKC0xKVswXX1gO3JldHVybiB0JiYobis9YCAke3M/dFswXTp0WzFdfWApLG59ZnVuY3Rpb24gTWUoZSl7cmV0dXJuIGBodHRwczovL3JvbGx1cGpzLm9yZy8ke2V9YH1jb25zdCBPZT0idHJvdWJsZXNob290aW5nLyNlcnJvci1uYW1lLWlzLW5vdC1leHBvcnRlZC1ieS1tb2R1bGUiLERlPSJ0cm91Ymxlc2hvb3RpbmcvI3dhcm5pbmctc291cmNlbWFwLWlzLWxpa2VseS10by1iZS1pbmNvcnJlY3QiLExlPSJjb25maWd1cmF0aW9uLW9wdGlvbnMvI291dHB1dC1hbWQtaWQiLFRlPSJjb25maWd1cmF0aW9uLW9wdGlvbnMvI291dHB1dC1kaXIiLFZlPSJjb25maWd1cmF0aW9uLW9wdGlvbnMvI291dHB1dC1leHBvcnRzIixCZT0iY29uZmlndXJhdGlvbi1vcHRpb25zLyNvdXRwdXQtZXh0ZW5kIix6ZT0iY29uZmlndXJhdGlvbi1vcHRpb25zLyNvdXRwdXQtZm9ybWF0IixGZT0iY29uZmlndXJhdGlvbi1vcHRpb25zLyNvdXRwdXQtZXhwZXJpbWVudGFsZGVlcGR5bmFtaWNjaHVua29wdGltaXphdGlvbiIsamU9ImNvbmZpZ3VyYXRpb24tb3B0aW9ucy8jb3V0cHV0LWdsb2JhbHMiLFVlPSJjb25maWd1cmF0aW9uLW9wdGlvbnMvI291dHB1dC1pbmxpbmVkeW5hbWljaW1wb3J0cyIsR2U9ImNvbmZpZ3VyYXRpb24tb3B0aW9ucy8jb3V0cHV0LWludGVyb3AiLFdlPSJjb25maWd1cmF0aW9uLW9wdGlvbnMvI291dHB1dC1tYW51YWxjaHVua3MiLHFlPSJjb25maWd1cmF0aW9uLW9wdGlvbnMvI291dHB1dC1uYW1lIixIZT0iY29uZmlndXJhdGlvbi1vcHRpb25zLyNvdXRwdXQtc291cmNlbWFwZmlsZSIsS2U9InBsdWdpbi1kZXZlbG9wbWVudC8jdGhpcy1nZXRtb2R1bGVpbmZvIjtmdW5jdGlvbiBZZShlKXt0aHJvdyBlIGluc3RhbmNlb2YgRXJyb3J8fChlPU9iamVjdC5hc3NpZ24obmV3IEVycm9yKGUubWVzc2FnZSksZSksT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIm5hbWUiLHt2YWx1ZToiUm9sbHVwRXJyb3IifSkpLGV9ZnVuY3Rpb24gWGUoZSx0LHMsaSl7aWYoIm9iamVjdCI9PXR5cGVvZiB0KXtjb25zdHtsaW5lOnMsY29sdW1uOm59PXQ7ZS5sb2M9e2NvbHVtbjpuLGZpbGU6aSxsaW5lOnN9O31lbHNlIHtlLnBvcz10O2NvbnN0e2xpbmU6bixjb2x1bW46cn09d2Uocyx0LHtvZmZzZXRMaW5lOjF9KTtlLmxvYz17Y29sdW1uOnIsZmlsZTppLGxpbmU6bn07fWlmKHZvaWQgMD09PWUuZnJhbWUpe2NvbnN0e2xpbmU6dCxjb2x1bW46aX09ZS5sb2M7ZS5mcmFtZT1fZShzLHQsaSk7fX1jb25zdCBRZT0iQURET05fRVJST1IiLFplPSJBTFJFQURZX0NMT1NFRCIsSmU9IkFOT05ZTU9VU19QTFVHSU5fQ0FDSEUiLGV0PSJBU1NFVF9OT1RfRklOQUxJU0VEIix0dD0iQ0FOTk9UX0VNSVRfRlJPTV9PUFRJT05TX0hPT0siLHN0PSJDSFVOS19OT1RfR0VORVJBVEVEIixpdD0iQ0lSQ1VMQVJfUkVFWFBPUlQiLG50PSJERVBSRUNBVEVEX0ZFQVRVUkUiLHJ0PSJEVVBMSUNBVEVfUExVR0lOX05BTUUiLG90PSJGSUxFX05BTUVfQ09ORkxJQ1QiLGF0PSJJTExFR0FMX0lERU5USUZJRVJfQVNfTkFNRSIsbHQ9IklOVkFMSURfQ0hVTksiLGN0PSJJTlZBTElEX0VYUE9SVF9PUFRJT04iLGh0PSJJTlZBTElEX0xPR19QT1NJVElPTiIsdXQ9IklOVkFMSURfT1BUSU9OIixkdD0iSU5WQUxJRF9QTFVHSU5fSE9PSyIscHQ9IklOVkFMSURfUk9MTFVQX1BIQVNFIixmdD0iSU5WQUxJRF9TRVRBU1NFVFNPVVJDRSIsbXQ9Ik1JU1NJTkdfRVhQT1JUIixndD0iTUlTU0lOR19HTE9CQUxfTkFNRSIseXQ9Ik1JU1NJTkdfSU1QTElDSVRfREVQRU5EQU5UIix4dD0iTUlTU0lOR19OQU1FX09QVElPTl9GT1JfSUlGRV9FWFBPUlQiLEV0PSJNSVNTSU5HX05PREVfQlVJTFRJTlMiLGJ0PSJNSVNTSU5HX09QVElPTiIsdnQ9Ik1JWEVEX0VYUE9SVFMiLFN0PSJOT19UUkFOU0ZPUk1fTUFQX09SX0FTVF9XSVRIT1VUX0NPREUiLEF0PSJPUFRJTUlaRV9DSFVOS19TVEFUVVMiLGt0PSJQTFVHSU5fRVJST1IiLEl0PSJTT1VSQ0VNQVBfQlJPS0VOIix3dD0iVU5FWFBFQ1RFRF9OQU1FRF9JTVBPUlQiLFB0PSJVTktOT1dOX09QVElPTiIsQ3Q9IlVOUkVTT0xWRURfRU5UUlkiLCR0PSJVTlJFU09MVkVEX0lNUE9SVCIsTnQ9IlZBTElEQVRJT05fRVJST1IiO2Z1bmN0aW9uIF90KCl7cmV0dXJuIHtjb2RlOlplLG1lc3NhZ2U6J0J1bmRsZSBpcyBhbHJlYWR5IGNsb3NlZCwgbm8gbW9yZSBjYWxscyB0byAiZ2VuZXJhdGUiIG9yICJ3cml0ZSIgYXJlIGFsbG93ZWQuJ319ZnVuY3Rpb24gUnQoZSl7cmV0dXJuIHtjb2RlOiJDQU5OT1RfQ0FMTF9OQU1FU1BBQ0UiLG1lc3NhZ2U6YENhbm5vdCBjYWxsIGEgbmFtZXNwYWNlICgiJHtlfSIpLmB9fWZ1bmN0aW9uIE10KHtmaWxlTmFtZTplLGNvZGU6dH0scyl7Y29uc3QgaT17Y29kZToiQ0hVTktfSU5WQUxJRCIsbWVzc2FnZTpgQ2h1bmsgIiR7ZX0iIGlzIG5vdCB2YWxpZCBKYXZhU2NyaXB0OiAke3MubWVzc2FnZX0uYH07cmV0dXJuIFhlKGkscy5sb2MsdCxlKSxpfWZ1bmN0aW9uIE90KGUpe3JldHVybiB7Y29kZToiQ0lSQ1VMQVJfREVQRU5ERU5DWSIsaWRzOmUsbWVzc2FnZTpgQ2lyY3VsYXIgZGVwZW5kZW5jeTogJHtlLm1hcChMKS5qb2luKCIgLT4gIil9YH19ZnVuY3Rpb24gRHQoZSx0LHtsaW5lOnMsY29sdW1uOml9KXtyZXR1cm4ge2NvZGU6IkZJUlNUX1NJREVfRUZGRUNUIixtZXNzYWdlOmBGaXJzdCBzaWRlIGVmZmVjdCBpbiAke0wodCl9IGlzIGF0ICgke3N9OiR7aX0pXG4ke19lKGUscyxpKX1gfX1mdW5jdGlvbiBMdChlLHQpe3JldHVybiB7Y29kZToiSUxMRUdBTF9SRUFTU0lHTk1FTlQiLG1lc3NhZ2U6YElsbGVnYWwgcmVhc3NpZ25tZW50IG9mIGltcG9ydCAiJHtlfSIgaW4gIiR7TCh0KX0iLmB9fWZ1bmN0aW9uIFR0KGUsdCxzLGkpe3JldHVybiB7Y29kZToiSU5DT05TSVNURU5UX0lNUE9SVF9BU1NFUlRJT05TIixtZXNzYWdlOmBNb2R1bGUgIiR7TChpKX0iIHRyaWVkIHRvIGltcG9ydCAiJHtMKHMpfSIgd2l0aCAke1Z0KHQpfSBhc3NlcnRpb25zLCBidXQgaXQgd2FzIGFscmVhZHkgaW1wb3J0ZWQgZWxzZXdoZXJlIHdpdGggJHtWdChlKX0gYXNzZXJ0aW9ucy4gUGxlYXNlIGVuc3VyZSB0aGF0IGltcG9ydCBhc3NlcnRpb25zIGZvciB0aGUgc2FtZSBtb2R1bGUgYXJlIGFsd2F5cyBjb25zaXN0ZW50LmB9fWNvbnN0IFZ0PWU9Pntjb25zdCB0PU9iamVjdC5lbnRyaWVzKGUpO3JldHVybiAwPT09dC5sZW5ndGg/Im5vIjp0Lm1hcCgoKFtlLHRdKT0+YCIke2V9IjogIiR7dH0iYCkpLmpvaW4oIiwgIil9O2Z1bmN0aW9uIEJ0KGUsdCxzKXtyZXR1cm4ge2NvZGU6Y3QsbWVzc2FnZTpgIiR7ZX0iIHdhcyBzcGVjaWZpZWQgZm9yICJvdXRwdXQuZXhwb3J0cyIsIGJ1dCBlbnRyeSBtb2R1bGUgIiR7TChzKX0iIGhhcyB0aGUgZm9sbG93aW5nIGV4cG9ydHM6ICR7UmUodCl9YCx1cmw6TWUoVmUpfX1mdW5jdGlvbiB6dChlLHQscyxpKXtyZXR1cm4ge2NvZGU6dXQsbWVzc2FnZTpgSW52YWxpZCB2YWx1ZSAke3ZvaWQgMD09PWk/IiI6YCR7SlNPTi5zdHJpbmdpZnkoaSl9IGB9Zm9yIG9wdGlvbiAiJHtlfSIgLSAke3N9LmAsdXJsOk1lKHQpfX1mdW5jdGlvbiBGdChlLHQscyl7Y29uc3QgaT0iLmpzb24iPT09QyhzKTtyZXR1cm4ge2JpbmRpbmc6ZSxjb2RlOm10LGV4cG9ydGVyOnMsaWQ6dCxtZXNzYWdlOmAiJHtlfSIgaXMgbm90IGV4cG9ydGVkIGJ5ICIke0wocyl9IiwgaW1wb3J0ZWQgYnkgIiR7TCh0KX0iLiR7aT8iIChOb3RlIHRoYXQgeW91IG5lZWQgQHJvbGx1cC9wbHVnaW4tanNvbiB0byBpbXBvcnQgSlNPTiBmaWxlcykiOiIifWAsdXJsOk1lKE9lKX19ZnVuY3Rpb24ganQoZSl7Y29uc3QgdD1bLi4uZS5pbXBsaWNpdGx5TG9hZGVkQmVmb3JlXS5tYXAoKGU9PkwoZS5pZCkpKS5zb3J0KCk7cmV0dXJuIHtjb2RlOnl0LG1lc3NhZ2U6YE1vZHVsZSAiJHtMKGUuaWQpfSIgdGhhdCBzaG91bGQgYmUgaW1wbGljaXRseSBsb2FkZWQgYmVmb3JlICR7UmUodCl9IGlzIG5vdCBpbmNsdWRlZCBpbiB0aGUgbW9kdWxlIGdyYXBoLiBFaXRoZXIgaXQgd2FzIG5vdCBpbXBvcnRlZCBieSBhbiBpbmNsdWRlZCBtb2R1bGUgb3Igb25seSB2aWEgYSB0cmVlLXNoYWtlbiBkeW5hbWljIGltcG9ydCwgb3Igbm8gaW1wb3J0ZWQgYmluZGluZ3Mgd2VyZSB1c2VkIGFuZCBpdCBoYWQgb3RoZXJ3aXNlIG5vIHNpZGUtZWZmZWN0cy5gfX1mdW5jdGlvbiBVdChlLHQscyl7cmV0dXJuIHtjb2RlOkF0LG1lc3NhZ2U6YCR7c30sIHRoZXJlIGFyZVxuJHtlfSBjaHVua3MsIG9mIHdoaWNoXG4ke3R9IGFyZSBiZWxvdyBtaW5DaHVua1NpemUuYH19ZnVuY3Rpb24gR3QoZSx0LHtob29rOnMsaWQ6aX09e30pe2NvbnN0IG49ZS5jb2RlO3JldHVybiBlLnBsdWdpbkNvZGV8fG51bGw9PW58fCJzdHJpbmciPT10eXBlb2YgbiYmKCJzdHJpbmciIT10eXBlb2Ygbnx8bi5zdGFydHNXaXRoKCJQTFVHSU5fIikpfHwoZS5wbHVnaW5Db2RlPW4pLGUuY29kZT1rdCxlLnBsdWdpbj10LHMmJihlLmhvb2s9cyksaSYmKGUuaWQ9aSksZX1mdW5jdGlvbiBXdChlKXtyZXR1cm4ge2NvZGU6SXQsbWVzc2FnZTpgTXVsdGlwbGUgY29uZmxpY3RpbmcgY29udGVudHMgZm9yIHNvdXJjZW1hcCBzb3VyY2UgJHtlfWB9fWZ1bmN0aW9uIHF0KGUsdCxzKXtjb25zdCBpPXM/InJlZXhwb3J0IjoiaW1wb3J0IjtyZXR1cm4ge2NvZGU6d3QsZXhwb3J0ZXI6ZSxtZXNzYWdlOmBUaGUgbmFtZWQgZXhwb3J0ICIke3R9IiB3YXMgJHtpfWVkIGZyb20gdGhlIGV4dGVybmFsIG1vZHVsZSAiJHtMKGUpfSIgZXZlbiB0aG91Z2ggaXRzIGludGVyb3AgdHlwZSBpcyAiZGVmYXVsdE9ubHkiLiBFaXRoZXIgcmVtb3ZlIG9yIGNoYW5nZSB0aGlzICR7aX0gb3IgY2hhbmdlIHRoZSB2YWx1ZSBvZiB0aGUgIm91dHB1dC5pbnRlcm9wIiBvcHRpb24uYCx1cmw6TWUoR2UpfX1mdW5jdGlvbiBIdChlKXtyZXR1cm4ge2NvZGU6d3QsZXhwb3J0ZXI6ZSxtZXNzYWdlOmBUaGVyZSB3YXMgYSBuYW1lc3BhY2UgIioiIHJlZXhwb3J0IGZyb20gdGhlIGV4dGVybmFsIG1vZHVsZSAiJHtMKGUpfSIgZXZlbiB0aG91Z2ggaXRzIGludGVyb3AgdHlwZSBpcyAiZGVmYXVsdE9ubHkiLiBUaGlzIHdpbGwgYmUgaWdub3JlZCBhcyBuYW1lc3BhY2UgcmVleHBvcnRzIG9ubHkgcmVleHBvcnQgbmFtZWQgZXhwb3J0cy4gSWYgdGhpcyBpcyBub3QgaW50ZW5kZWQsIGVpdGhlciByZW1vdmUgb3IgY2hhbmdlIHRoaXMgcmVleHBvcnQgb3IgY2hhbmdlIHRoZSB2YWx1ZSBvZiB0aGUgIm91dHB1dC5pbnRlcm9wIiBvcHRpb24uYCx1cmw6TWUoR2UpfX1mdW5jdGlvbiBLdChlKXtyZXR1cm4ge2NvZGU6TnQsbWVzc2FnZTplfX1mdW5jdGlvbiBZdChlLHQscyxpLG4pe1h0KGUsdCxzLGkub25Mb2csaS5zdHJpY3REZXByZWNhdGlvbnMsbik7fWZ1bmN0aW9uIFh0KGUsdCxzLGksbixyKXtpZihzfHxuKXtjb25zdCBzPWZ1bmN0aW9uKGUsdCxzKXtyZXR1cm4ge2NvZGU6bnQsbWVzc2FnZTplLHVybDpNZSh0KSwuLi5zP3twbHVnaW46c306e319fShlLHQscik7aWYobilyZXR1cm4gWWUocyk7aSh2ZSxzKTt9fWNsYXNzIFF0e2NvbnN0cnVjdG9yKGUsdCxzLGksbixyKXt0aGlzLm9wdGlvbnM9ZSx0aGlzLmlkPXQsdGhpcy5yZW5vcm1hbGl6ZVJlbmRlclBhdGg9bix0aGlzLmR5bmFtaWNJbXBvcnRlcnM9W10sdGhpcy5leGVjSW5kZXg9MS8wLHRoaXMuZXhwb3J0ZWRWYXJpYWJsZXM9bmV3IE1hcCx0aGlzLmltcG9ydGVycz1bXSx0aGlzLnJlZXhwb3J0ZWQ9ITEsdGhpcy51c2VkPSExLHRoaXMuZGVjbGFyYXRpb25zPW5ldyBNYXAsdGhpcy5tb3N0Q29tbW9uU3VnZ2VzdGlvbj0wLHRoaXMubmFtZVN1Z2dlc3Rpb25zPW5ldyBNYXAsdGhpcy5zdWdnZXN0ZWRWYXJpYWJsZU5hbWU9YmUodC5zcGxpdCgvWy9cXF0vKS5wb3AoKSk7Y29uc3R7aW1wb3J0ZXJzOm8sZHluYW1pY0ltcG9ydGVyczphfT10aGlzLGw9dGhpcy5pbmZvPXthc3NlcnRpb25zOnIsYXN0Om51bGwsY29kZTpudWxsLGR5bmFtaWNhbGx5SW1wb3J0ZWRJZFJlc29sdXRpb25zOm1lLGR5bmFtaWNhbGx5SW1wb3J0ZWRJZHM6bWUsZ2V0IGR5bmFtaWNJbXBvcnRlcnMoKXtyZXR1cm4gYS5zb3J0KCl9LGV4cG9ydGVkQmluZGluZ3M6bnVsbCxleHBvcnRzOm51bGwsaGFzRGVmYXVsdEV4cG9ydDpudWxsLGdldCBoYXNNb2R1bGVTaWRlRWZmZWN0cygpe3JldHVybiBZdCgiQWNjZXNzaW5nIE1vZHVsZUluZm8uaGFzTW9kdWxlU2lkZUVmZmVjdHMgZnJvbSBwbHVnaW5zIGlzIGRlcHJlY2F0ZWQuIFBsZWFzZSB1c2UgTW9kdWxlSW5mby5tb2R1bGVTaWRlRWZmZWN0cyBpbnN0ZWFkLiIsS2UsITAsZSksbC5tb2R1bGVTaWRlRWZmZWN0c30saWQ6dCxpbXBsaWNpdGx5TG9hZGVkQWZ0ZXJPbmVPZjptZSxpbXBsaWNpdGx5TG9hZGVkQmVmb3JlOm1lLGltcG9ydGVkSWRSZXNvbHV0aW9uczptZSxpbXBvcnRlZElkczptZSxnZXQgaW1wb3J0ZXJzKCl7cmV0dXJuIG8uc29ydCgpfSxpc0VudHJ5OiExLGlzRXh0ZXJuYWw6ITAsaXNJbmNsdWRlZDpudWxsLG1ldGE6aSxtb2R1bGVTaWRlRWZmZWN0czpzLHN5bnRoZXRpY05hbWVkRXhwb3J0czohMX07T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMuaW5mbywiaGFzTW9kdWxlU2lkZUVmZmVjdHMiLHtlbnVtZXJhYmxlOiExfSk7fWdldFZhcmlhYmxlRm9yRXhwb3J0TmFtZShlKXtjb25zdCB0PXRoaXMuZGVjbGFyYXRpb25zLmdldChlKTtpZih0KXJldHVybiBbdF07Y29uc3Qgcz1uZXcgZGUodGhpcyxlKTtyZXR1cm4gdGhpcy5kZWNsYXJhdGlvbnMuc2V0KGUscyksdGhpcy5leHBvcnRlZFZhcmlhYmxlcy5zZXQocyxlKSxbc119c3VnZ2VzdE5hbWUoZSl7Y29uc3QgdD0odGhpcy5uYW1lU3VnZ2VzdGlvbnMuZ2V0KGUpPz8wKSsxO3RoaXMubmFtZVN1Z2dlc3Rpb25zLnNldChlLHQpLHQ+dGhpcy5tb3N0Q29tbW9uU3VnZ2VzdGlvbiYmKHRoaXMubW9zdENvbW1vblN1Z2dlc3Rpb249dCx0aGlzLnN1Z2dlc3RlZFZhcmlhYmxlTmFtZT1lKTt9d2FyblVudXNlZEltcG9ydHMoKXtjb25zdCBlPVsuLi50aGlzLmRlY2xhcmF0aW9uc10uZmlsdGVyKCgoW2UsdF0pPT4iKiIhPT1lJiYhdC5pbmNsdWRlZCYmIXRoaXMucmVleHBvcnRlZCYmIXQucmVmZXJlbmNlZCkpLm1hcCgoKFtlXSk9PmUpKTtpZigwPT09ZS5sZW5ndGgpcmV0dXJuO2NvbnN0IHQ9bmV3IFNldDtmb3IoY29uc3QgcyBvZiBlKWZvcihjb25zdCBlIG9mIHRoaXMuZGVjbGFyYXRpb25zLmdldChzKS5tb2R1bGUuaW1wb3J0ZXJzKXQuYWRkKGUpO2NvbnN0IHM9Wy4uLnRdO3ZhciBpLG4scjt0aGlzLm9wdGlvbnMub25Mb2codmUse2NvZGU6IlVOVVNFRF9FWFRFUk5BTF9JTVBPUlQiLGV4cG9ydGVyOmk9dGhpcy5pZCxpZHM6cj1zLG1lc3NhZ2U6YCR7UmUobj1lLFsiaXMiLCJhcmUiXSl9IGltcG9ydGVkIGZyb20gZXh0ZXJuYWwgbW9kdWxlICIke2l9IiBidXQgbmV2ZXIgdXNlZCBpbiAke1JlKHIubWFwKChlPT5MKGUpKSkpfS5gLG5hbWVzOm59KTt9fWNvbnN0IFp0PXtBcnJheVBhdHRlcm4oZSx0KXtmb3IoY29uc3QgcyBvZiB0LmVsZW1lbnRzKXMmJlp0W3MudHlwZV0oZSxzKTt9LEFzc2lnbm1lbnRQYXR0ZXJuKGUsdCl7WnRbdC5sZWZ0LnR5cGVdKGUsdC5sZWZ0KTt9LElkZW50aWZpZXIoZSx0KXtlLnB1c2godC5uYW1lKTt9LE1lbWJlckV4cHJlc3Npb24oKXt9LE9iamVjdFBhdHRlcm4oZSx0KXtmb3IoY29uc3QgcyBvZiB0LnByb3BlcnRpZXMpIlJlc3RFbGVtZW50Ij09PXMudHlwZT9adC5SZXN0RWxlbWVudChlLHMpOlp0W3MudmFsdWUudHlwZV0oZSxzLnZhbHVlKTt9LFJlc3RFbGVtZW50KGUsdCl7WnRbdC5hcmd1bWVudC50eXBlXShlLHQuYXJndW1lbnQpO319LEp0PWZ1bmN0aW9uKGUpe2NvbnN0IHQ9W107cmV0dXJuIFp0W2UudHlwZV0odCxlKSx0fTtmdW5jdGlvbiBlcygpe3JldHVybiB7YnJva2VuRmxvdzohMSxoYXNCcmVhazohMSxoYXNDb250aW51ZTohMSxpbmNsdWRlZENhbGxBcmd1bWVudHM6bmV3IFNldCxpbmNsdWRlZExhYmVsczpuZXcgU2V0fX1mdW5jdGlvbiB0cygpe3JldHVybiB7YWNjZXNzZWQ6bmV3IEosYXNzaWduZWQ6bmV3IEosYnJva2VuRmxvdzohMSxjYWxsZWQ6bmV3IHRlLGhhc0JyZWFrOiExLGhhc0NvbnRpbnVlOiExLGlnbm9yZTp7YnJlYWtzOiExLGNvbnRpbnVlczohMSxsYWJlbHM6bmV3IFNldCxyZXR1cm5ZaWVsZDohMSx0aGlzOiExfSxpbmNsdWRlZExhYmVsczpuZXcgU2V0LGluc3RhbnRpYXRlZDpuZXcgdGUscmVwbGFjZWRWYXJpYWJsZUluaXRzOm5ldyBNYXB9fWZ1bmN0aW9uIHNzKGUsdD1udWxsKXtyZXR1cm4gT2JqZWN0LmNyZWF0ZSh0LGUpfW5ldyBTZXQoImJyZWFrIGNhc2UgY2xhc3MgY2F0Y2ggY29uc3QgY29udGludWUgZGVidWdnZXIgZGVmYXVsdCBkZWxldGUgZG8gZWxzZSBleHBvcnQgZXh0ZW5kcyBmaW5hbGx5IGZvciBmdW5jdGlvbiBpZiBpbXBvcnQgaW4gaW5zdGFuY2VvZiBsZXQgbmV3IHJldHVybiBzdXBlciBzd2l0Y2ggdGhpcyB0aHJvdyB0cnkgdHlwZW9mIHZhciB2b2lkIHdoaWxlIHdpdGggeWllbGQgZW51bSBhd2FpdCBpbXBsZW1lbnRzIHBhY2thZ2UgcHJvdGVjdGVkIHN0YXRpYyBpbnRlcmZhY2UgcHJpdmF0ZSBwdWJsaWMgYXJndW1lbnRzIEluZmluaXR5IE5hTiB1bmRlZmluZWQgbnVsbCB0cnVlIGZhbHNlIGV2YWwgdW5ldmFsIGlzRmluaXRlIGlzTmFOIHBhcnNlRmxvYXQgcGFyc2VJbnQgZGVjb2RlVVJJIGRlY29kZVVSSUNvbXBvbmVudCBlbmNvZGVVUkkgZW5jb2RlVVJJQ29tcG9uZW50IGVzY2FwZSB1bmVzY2FwZSBPYmplY3QgRnVuY3Rpb24gQm9vbGVhbiBTeW1ib2wgRXJyb3IgRXZhbEVycm9yIEludGVybmFsRXJyb3IgUmFuZ2VFcnJvciBSZWZlcmVuY2VFcnJvciBTeW50YXhFcnJvciBUeXBlRXJyb3IgVVJJRXJyb3IgTnVtYmVyIE1hdGggRGF0ZSBTdHJpbmcgUmVnRXhwIEFycmF5IEludDhBcnJheSBVaW50OEFycmF5IFVpbnQ4Q2xhbXBlZEFycmF5IEludDE2QXJyYXkgVWludDE2QXJyYXkgSW50MzJBcnJheSBVaW50MzJBcnJheSBGbG9hdDMyQXJyYXkgRmxvYXQ2NEFycmF5IE1hcCBTZXQgV2Vha01hcCBXZWFrU2V0IFNJTUQgQXJyYXlCdWZmZXIgRGF0YVZpZXcgSlNPTiBQcm9taXNlIEdlbmVyYXRvciBHZW5lcmF0b3JGdW5jdGlvbiBSZWZsZWN0IFByb3h5IEludGwiLnNwbGl0KCIgIikpLmFkZCgiIik7Y29uc3QgaXM9bmV3IGNsYXNzIGV4dGVuZHMgbmV7Z2V0TGl0ZXJhbFZhbHVlQXRQYXRoKCl7fX0sbnM9e3ZhbHVlOntoYXNFZmZlY3RzV2hlbkNhbGxlZDpudWxsLHJldHVybnM6cmV9fSxycz1uZXcgY2xhc3MgZXh0ZW5kcyBuZXtnZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChlKXtyZXR1cm4gMT09PWUubGVuZ3RoP3hzKHBzLGVbMF0pOm9lfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtyZXR1cm4gMD09PXQudHlwZT9lLmxlbmd0aD4xOjIhPT10LnR5cGV8fDEhPT1lLmxlbmd0aHx8eXMocHMsZVswXSx0LHMpfX0sb3M9e3ZhbHVlOntoYXNFZmZlY3RzV2hlbkNhbGxlZDpudWxsLHJldHVybnM6cnN9fSxhcz1uZXcgY2xhc3MgZXh0ZW5kcyBuZXtnZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChlKXtyZXR1cm4gMT09PWUubGVuZ3RoP3hzKGZzLGVbMF0pOm9lfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtyZXR1cm4gMD09PXQudHlwZT9lLmxlbmd0aD4xOjIhPT10LnR5cGV8fDEhPT1lLmxlbmd0aHx8eXMoZnMsZVswXSx0LHMpfX0sbHM9e3ZhbHVlOntoYXNFZmZlY3RzV2hlbkNhbGxlZDpudWxsLHJldHVybnM6YXN9fSxjcz1uZXcgY2xhc3MgZXh0ZW5kcyBuZXtnZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChlKXtyZXR1cm4gMT09PWUubGVuZ3RoP3hzKGdzLGVbMF0pOm9lfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtyZXR1cm4gMD09PXQudHlwZT9lLmxlbmd0aD4xOjIhPT10LnR5cGV8fDEhPT1lLmxlbmd0aHx8eXMoZ3MsZVswXSx0LHMpfX0saHM9e3ZhbHVlOntoYXNFZmZlY3RzV2hlbkNhbGxlZDpudWxsLHJldHVybnM6Y3N9fSx1cz17dmFsdWU6e2hhc0VmZmVjdHNXaGVuQ2FsbGVkKHthcmdzOmV9LHQpe2NvbnN0IHM9ZVsyXTtyZXR1cm4gZS5sZW5ndGg8M3x8InN5bWJvbCI9PXR5cGVvZiBzLmdldExpdGVyYWxWYWx1ZUF0UGF0aChLLGVlLHtkZW9wdGltaXplQ2FjaGUoKXt9fSkmJnMuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoSyxoZSx0KX0scmV0dXJuczpjc319LGRzPXNzKHtoYXNPd25Qcm9wZXJ0eTpvcyxpc1Byb3RvdHlwZU9mOm9zLHByb3BlcnR5SXNFbnVtZXJhYmxlOm9zLHRvTG9jYWxlU3RyaW5nOmhzLHRvU3RyaW5nOmhzLHZhbHVlT2Y6bnN9KSxwcz1zcyh7dmFsdWVPZjpvc30sZHMpLGZzPXNzKHt0b0V4cG9uZW50aWFsOmhzLHRvRml4ZWQ6aHMsdG9Mb2NhbGVTdHJpbmc6aHMsdG9QcmVjaXNpb246aHMsdmFsdWVPZjpsc30sZHMpLG1zPXNzKHtleGVjOm5zLHRlc3Q6b3N9LGRzKSxncz1zcyh7YW5jaG9yOmhzLGF0Om5zLGJpZzpocyxibGluazpocyxib2xkOmhzLGNoYXJBdDpocyxjaGFyQ29kZUF0OmxzLGNvZGVQb2ludEF0Om5zLGNvbmNhdDpocyxlbmRzV2l0aDpvcyxmaXhlZDpocyxmb250Y29sb3I6aHMsZm9udHNpemU6aHMsaW5jbHVkZXM6b3MsaW5kZXhPZjpscyxpdGFsaWNzOmhzLGxhc3RJbmRleE9mOmxzLGxpbms6aHMsbG9jYWxlQ29tcGFyZTpscyxtYXRjaDpucyxtYXRjaEFsbDpucyxub3JtYWxpemU6aHMscGFkRW5kOmhzLHBhZFN0YXJ0OmhzLHJlcGVhdDpocyxyZXBsYWNlOnVzLHJlcGxhY2VBbGw6dXMsc2VhcmNoOmxzLHNsaWNlOmhzLHNtYWxsOmhzLHNwbGl0Om5zLHN0YXJ0c1dpdGg6b3Msc3RyaWtlOmhzLHN1YjpocyxzdWJzdHI6aHMsc3Vic3RyaW5nOmhzLHN1cDpocyx0b0xvY2FsZUxvd2VyQ2FzZTpocyx0b0xvY2FsZVVwcGVyQ2FzZTpocyx0b0xvd2VyQ2FzZTpocyx0b1N0cmluZzpocyx0b1VwcGVyQ2FzZTpocyx0cmltOmhzLHRyaW1FbmQ6aHMsdHJpbUxlZnQ6aHMsdHJpbVJpZ2h0OmhzLHRyaW1TdGFydDpocyx2YWx1ZU9mOmhzfSxkcyk7ZnVuY3Rpb24geXMoZSx0LHMsaSl7cmV0dXJuICJzdHJpbmciIT10eXBlb2YgdHx8IWVbdF18fChlW3RdLmhhc0VmZmVjdHNXaGVuQ2FsbGVkPy4ocyxpKXx8ITEpfWZ1bmN0aW9uIHhzKGUsdCl7cmV0dXJuICJzdHJpbmciPT10eXBlb2YgdCYmZVt0XT9bZVt0XS5yZXR1cm5zLCExXTpvZX1mdW5jdGlvbiBFcyhlLHQscyl7cyhlLHQpO31mdW5jdGlvbiBicyhlLHQscyl7fXZhciB2cz17fTt2cy5Qcm9ncmFtPXZzLkJsb2NrU3RhdGVtZW50PXZzLlN0YXRpY0Jsb2NrPWZ1bmN0aW9uKGUsdCxzKXtmb3IodmFyIGk9MCxuPWUuYm9keTtpPG4ubGVuZ3RoO2krPTEpe3MobltpXSx0LCJTdGF0ZW1lbnQiKTt9fSx2cy5TdGF0ZW1lbnQ9RXMsdnMuRW1wdHlTdGF0ZW1lbnQ9YnMsdnMuRXhwcmVzc2lvblN0YXRlbWVudD12cy5QYXJlbnRoZXNpemVkRXhwcmVzc2lvbj12cy5DaGFpbkV4cHJlc3Npb249ZnVuY3Rpb24oZSx0LHMpe3JldHVybiBzKGUuZXhwcmVzc2lvbix0LCJFeHByZXNzaW9uIil9LHZzLklmU3RhdGVtZW50PWZ1bmN0aW9uKGUsdCxzKXtzKGUudGVzdCx0LCJFeHByZXNzaW9uIikscyhlLmNvbnNlcXVlbnQsdCwiU3RhdGVtZW50IiksZS5hbHRlcm5hdGUmJnMoZS5hbHRlcm5hdGUsdCwiU3RhdGVtZW50Iik7fSx2cy5MYWJlbGVkU3RhdGVtZW50PWZ1bmN0aW9uKGUsdCxzKXtyZXR1cm4gcyhlLmJvZHksdCwiU3RhdGVtZW50Iil9LHZzLkJyZWFrU3RhdGVtZW50PXZzLkNvbnRpbnVlU3RhdGVtZW50PWJzLHZzLldpdGhTdGF0ZW1lbnQ9ZnVuY3Rpb24oZSx0LHMpe3MoZS5vYmplY3QsdCwiRXhwcmVzc2lvbiIpLHMoZS5ib2R5LHQsIlN0YXRlbWVudCIpO30sdnMuU3dpdGNoU3RhdGVtZW50PWZ1bmN0aW9uKGUsdCxzKXtzKGUuZGlzY3JpbWluYW50LHQsIkV4cHJlc3Npb24iKTtmb3IodmFyIGk9MCxuPWUuY2FzZXM7aTxuLmxlbmd0aDtpKz0xKXt2YXIgcj1uW2ldO3IudGVzdCYmcyhyLnRlc3QsdCwiRXhwcmVzc2lvbiIpO2Zvcih2YXIgbz0wLGE9ci5jb25zZXF1ZW50O288YS5sZW5ndGg7bys9MSl7cyhhW29dLHQsIlN0YXRlbWVudCIpO319fSx2cy5Td2l0Y2hDYXNlPWZ1bmN0aW9uKGUsdCxzKXtlLnRlc3QmJnMoZS50ZXN0LHQsIkV4cHJlc3Npb24iKTtmb3IodmFyIGk9MCxuPWUuY29uc2VxdWVudDtpPG4ubGVuZ3RoO2krPTEpe3MobltpXSx0LCJTdGF0ZW1lbnQiKTt9fSx2cy5SZXR1cm5TdGF0ZW1lbnQ9dnMuWWllbGRFeHByZXNzaW9uPXZzLkF3YWl0RXhwcmVzc2lvbj1mdW5jdGlvbihlLHQscyl7ZS5hcmd1bWVudCYmcyhlLmFyZ3VtZW50LHQsIkV4cHJlc3Npb24iKTt9LHZzLlRocm93U3RhdGVtZW50PXZzLlNwcmVhZEVsZW1lbnQ9ZnVuY3Rpb24oZSx0LHMpe3JldHVybiBzKGUuYXJndW1lbnQsdCwiRXhwcmVzc2lvbiIpfSx2cy5UcnlTdGF0ZW1lbnQ9ZnVuY3Rpb24oZSx0LHMpe3MoZS5ibG9jayx0LCJTdGF0ZW1lbnQiKSxlLmhhbmRsZXImJnMoZS5oYW5kbGVyLHQpLGUuZmluYWxpemVyJiZzKGUuZmluYWxpemVyLHQsIlN0YXRlbWVudCIpO30sdnMuQ2F0Y2hDbGF1c2U9ZnVuY3Rpb24oZSx0LHMpe2UucGFyYW0mJnMoZS5wYXJhbSx0LCJQYXR0ZXJuIikscyhlLmJvZHksdCwiU3RhdGVtZW50Iik7fSx2cy5XaGlsZVN0YXRlbWVudD12cy5Eb1doaWxlU3RhdGVtZW50PWZ1bmN0aW9uKGUsdCxzKXtzKGUudGVzdCx0LCJFeHByZXNzaW9uIikscyhlLmJvZHksdCwiU3RhdGVtZW50Iik7fSx2cy5Gb3JTdGF0ZW1lbnQ9ZnVuY3Rpb24oZSx0LHMpe2UuaW5pdCYmcyhlLmluaXQsdCwiRm9ySW5pdCIpLGUudGVzdCYmcyhlLnRlc3QsdCwiRXhwcmVzc2lvbiIpLGUudXBkYXRlJiZzKGUudXBkYXRlLHQsIkV4cHJlc3Npb24iKSxzKGUuYm9keSx0LCJTdGF0ZW1lbnQiKTt9LHZzLkZvckluU3RhdGVtZW50PXZzLkZvck9mU3RhdGVtZW50PWZ1bmN0aW9uKGUsdCxzKXtzKGUubGVmdCx0LCJGb3JJbml0IikscyhlLnJpZ2h0LHQsIkV4cHJlc3Npb24iKSxzKGUuYm9keSx0LCJTdGF0ZW1lbnQiKTt9LHZzLkZvckluaXQ9ZnVuY3Rpb24oZSx0LHMpeyJWYXJpYWJsZURlY2xhcmF0aW9uIj09PWUudHlwZT9zKGUsdCk6cyhlLHQsIkV4cHJlc3Npb24iKTt9LHZzLkRlYnVnZ2VyU3RhdGVtZW50PWJzLHZzLkZ1bmN0aW9uRGVjbGFyYXRpb249ZnVuY3Rpb24oZSx0LHMpe3JldHVybiBzKGUsdCwiRnVuY3Rpb24iKX0sdnMuVmFyaWFibGVEZWNsYXJhdGlvbj1mdW5jdGlvbihlLHQscyl7Zm9yKHZhciBpPTAsbj1lLmRlY2xhcmF0aW9ucztpPG4ubGVuZ3RoO2krPTEpe3MobltpXSx0KTt9fSx2cy5WYXJpYWJsZURlY2xhcmF0b3I9ZnVuY3Rpb24oZSx0LHMpe3MoZS5pZCx0LCJQYXR0ZXJuIiksZS5pbml0JiZzKGUuaW5pdCx0LCJFeHByZXNzaW9uIik7fSx2cy5GdW5jdGlvbj1mdW5jdGlvbihlLHQscyl7ZS5pZCYmcyhlLmlkLHQsIlBhdHRlcm4iKTtmb3IodmFyIGk9MCxuPWUucGFyYW1zO2k8bi5sZW5ndGg7aSs9MSl7cyhuW2ldLHQsIlBhdHRlcm4iKTt9cyhlLmJvZHksdCxlLmV4cHJlc3Npb24/IkV4cHJlc3Npb24iOiJTdGF0ZW1lbnQiKTt9LHZzLlBhdHRlcm49ZnVuY3Rpb24oZSx0LHMpeyJJZGVudGlmaWVyIj09PWUudHlwZT9zKGUsdCwiVmFyaWFibGVQYXR0ZXJuIik6Ik1lbWJlckV4cHJlc3Npb24iPT09ZS50eXBlP3MoZSx0LCJNZW1iZXJQYXR0ZXJuIik6cyhlLHQpO30sdnMuVmFyaWFibGVQYXR0ZXJuPWJzLHZzLk1lbWJlclBhdHRlcm49RXMsdnMuUmVzdEVsZW1lbnQ9ZnVuY3Rpb24oZSx0LHMpe3JldHVybiBzKGUuYXJndW1lbnQsdCwiUGF0dGVybiIpfSx2cy5BcnJheVBhdHRlcm49ZnVuY3Rpb24oZSx0LHMpe2Zvcih2YXIgaT0wLG49ZS5lbGVtZW50cztpPG4ubGVuZ3RoO2krPTEpe3ZhciByPW5baV07ciYmcyhyLHQsIlBhdHRlcm4iKTt9fSx2cy5PYmplY3RQYXR0ZXJuPWZ1bmN0aW9uKGUsdCxzKXtmb3IodmFyIGk9MCxuPWUucHJvcGVydGllcztpPG4ubGVuZ3RoO2krPTEpe3ZhciByPW5baV07IlByb3BlcnR5Ij09PXIudHlwZT8oci5jb21wdXRlZCYmcyhyLmtleSx0LCJFeHByZXNzaW9uIikscyhyLnZhbHVlLHQsIlBhdHRlcm4iKSk6IlJlc3RFbGVtZW50Ij09PXIudHlwZSYmcyhyLmFyZ3VtZW50LHQsIlBhdHRlcm4iKTt9fSx2cy5FeHByZXNzaW9uPUVzLHZzLlRoaXNFeHByZXNzaW9uPXZzLlN1cGVyPXZzLk1ldGFQcm9wZXJ0eT1icyx2cy5BcnJheUV4cHJlc3Npb249ZnVuY3Rpb24oZSx0LHMpe2Zvcih2YXIgaT0wLG49ZS5lbGVtZW50cztpPG4ubGVuZ3RoO2krPTEpe3ZhciByPW5baV07ciYmcyhyLHQsIkV4cHJlc3Npb24iKTt9fSx2cy5PYmplY3RFeHByZXNzaW9uPWZ1bmN0aW9uKGUsdCxzKXtmb3IodmFyIGk9MCxuPWUucHJvcGVydGllcztpPG4ubGVuZ3RoO2krPTEpe3MobltpXSx0KTt9fSx2cy5GdW5jdGlvbkV4cHJlc3Npb249dnMuQXJyb3dGdW5jdGlvbkV4cHJlc3Npb249dnMuRnVuY3Rpb25EZWNsYXJhdGlvbix2cy5TZXF1ZW5jZUV4cHJlc3Npb249ZnVuY3Rpb24oZSx0LHMpe2Zvcih2YXIgaT0wLG49ZS5leHByZXNzaW9ucztpPG4ubGVuZ3RoO2krPTEpe3MobltpXSx0LCJFeHByZXNzaW9uIik7fX0sdnMuVGVtcGxhdGVMaXRlcmFsPWZ1bmN0aW9uKGUsdCxzKXtmb3IodmFyIGk9MCxuPWUucXVhc2lzO2k8bi5sZW5ndGg7aSs9MSl7cyhuW2ldLHQpO31mb3IodmFyIHI9MCxvPWUuZXhwcmVzc2lvbnM7cjxvLmxlbmd0aDtyKz0xKXtzKG9bcl0sdCwiRXhwcmVzc2lvbiIpO319LHZzLlRlbXBsYXRlRWxlbWVudD1icyx2cy5VbmFyeUV4cHJlc3Npb249dnMuVXBkYXRlRXhwcmVzc2lvbj1mdW5jdGlvbihlLHQscyl7cyhlLmFyZ3VtZW50LHQsIkV4cHJlc3Npb24iKTt9LHZzLkJpbmFyeUV4cHJlc3Npb249dnMuTG9naWNhbEV4cHJlc3Npb249ZnVuY3Rpb24oZSx0LHMpe3MoZS5sZWZ0LHQsIkV4cHJlc3Npb24iKSxzKGUucmlnaHQsdCwiRXhwcmVzc2lvbiIpO30sdnMuQXNzaWdubWVudEV4cHJlc3Npb249dnMuQXNzaWdubWVudFBhdHRlcm49ZnVuY3Rpb24oZSx0LHMpe3MoZS5sZWZ0LHQsIlBhdHRlcm4iKSxzKGUucmlnaHQsdCwiRXhwcmVzc2lvbiIpO30sdnMuQ29uZGl0aW9uYWxFeHByZXNzaW9uPWZ1bmN0aW9uKGUsdCxzKXtzKGUudGVzdCx0LCJFeHByZXNzaW9uIikscyhlLmNvbnNlcXVlbnQsdCwiRXhwcmVzc2lvbiIpLHMoZS5hbHRlcm5hdGUsdCwiRXhwcmVzc2lvbiIpO30sdnMuTmV3RXhwcmVzc2lvbj12cy5DYWxsRXhwcmVzc2lvbj1mdW5jdGlvbihlLHQscyl7aWYocyhlLmNhbGxlZSx0LCJFeHByZXNzaW9uIiksZS5hcmd1bWVudHMpZm9yKHZhciBpPTAsbj1lLmFyZ3VtZW50cztpPG4ubGVuZ3RoO2krPTEpe3MobltpXSx0LCJFeHByZXNzaW9uIik7fX0sdnMuTWVtYmVyRXhwcmVzc2lvbj1mdW5jdGlvbihlLHQscyl7cyhlLm9iamVjdCx0LCJFeHByZXNzaW9uIiksZS5jb21wdXRlZCYmcyhlLnByb3BlcnR5LHQsIkV4cHJlc3Npb24iKTt9LHZzLkV4cG9ydE5hbWVkRGVjbGFyYXRpb249dnMuRXhwb3J0RGVmYXVsdERlY2xhcmF0aW9uPWZ1bmN0aW9uKGUsdCxzKXtlLmRlY2xhcmF0aW9uJiZzKGUuZGVjbGFyYXRpb24sdCwiRXhwb3J0TmFtZWREZWNsYXJhdGlvbiI9PT1lLnR5cGV8fGUuZGVjbGFyYXRpb24uaWQ/IlN0YXRlbWVudCI6IkV4cHJlc3Npb24iKSxlLnNvdXJjZSYmcyhlLnNvdXJjZSx0LCJFeHByZXNzaW9uIik7fSx2cy5FeHBvcnRBbGxEZWNsYXJhdGlvbj1mdW5jdGlvbihlLHQscyl7ZS5leHBvcnRlZCYmcyhlLmV4cG9ydGVkLHQpLHMoZS5zb3VyY2UsdCwiRXhwcmVzc2lvbiIpO30sdnMuSW1wb3J0RGVjbGFyYXRpb249ZnVuY3Rpb24oZSx0LHMpe2Zvcih2YXIgaT0wLG49ZS5zcGVjaWZpZXJzO2k8bi5sZW5ndGg7aSs9MSl7cyhuW2ldLHQpO31zKGUuc291cmNlLHQsIkV4cHJlc3Npb24iKTt9LHZzLkltcG9ydEV4cHJlc3Npb249ZnVuY3Rpb24oZSx0LHMpe3MoZS5zb3VyY2UsdCwiRXhwcmVzc2lvbiIpO30sdnMuSW1wb3J0U3BlY2lmaWVyPXZzLkltcG9ydERlZmF1bHRTcGVjaWZpZXI9dnMuSW1wb3J0TmFtZXNwYWNlU3BlY2lmaWVyPXZzLklkZW50aWZpZXI9dnMuUHJpdmF0ZUlkZW50aWZpZXI9dnMuTGl0ZXJhbD1icyx2cy5UYWdnZWRUZW1wbGF0ZUV4cHJlc3Npb249ZnVuY3Rpb24oZSx0LHMpe3MoZS50YWcsdCwiRXhwcmVzc2lvbiIpLHMoZS5xdWFzaSx0LCJFeHByZXNzaW9uIik7fSx2cy5DbGFzc0RlY2xhcmF0aW9uPXZzLkNsYXNzRXhwcmVzc2lvbj1mdW5jdGlvbihlLHQscyl7cmV0dXJuIHMoZSx0LCJDbGFzcyIpfSx2cy5DbGFzcz1mdW5jdGlvbihlLHQscyl7ZS5pZCYmcyhlLmlkLHQsIlBhdHRlcm4iKSxlLnN1cGVyQ2xhc3MmJnMoZS5zdXBlckNsYXNzLHQsIkV4cHJlc3Npb24iKSxzKGUuYm9keSx0KTt9LHZzLkNsYXNzQm9keT1mdW5jdGlvbihlLHQscyl7Zm9yKHZhciBpPTAsbj1lLmJvZHk7aTxuLmxlbmd0aDtpKz0xKXtzKG5baV0sdCk7fX0sdnMuTWV0aG9kRGVmaW5pdGlvbj12cy5Qcm9wZXJ0eURlZmluaXRpb249dnMuUHJvcGVydHk9ZnVuY3Rpb24oZSx0LHMpe2UuY29tcHV0ZWQmJnMoZS5rZXksdCwiRXhwcmVzc2lvbiIpLGUudmFsdWUmJnMoZS52YWx1ZSx0LCJFeHByZXNzaW9uIik7fTtjb25zdCBTcz0iQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24iLEFzPSJCaW5hcnlFeHByZXNzaW9uIixrcz0iQmxvY2tTdGF0ZW1lbnQiLElzPSJDYWxsRXhwcmVzc2lvbiIsd3M9IkNoYWluRXhwcmVzc2lvbiIsUHM9IkNvbmRpdGlvbmFsRXhwcmVzc2lvbiIsQ3M9IkV4cG9ydERlZmF1bHREZWNsYXJhdGlvbiIsJHM9IkV4cG9ydE5hbWVkRGVjbGFyYXRpb24iLE5zPSJFeHByZXNzaW9uU3RhdGVtZW50Iixfcz0iRnVuY3Rpb25EZWNsYXJhdGlvbiIsUnM9IklkZW50aWZpZXIiLE1zPSJMb2dpY2FsRXhwcmVzc2lvbiIsT3M9Ik5ld0V4cHJlc3Npb24iLERzPSJQcm9ncmFtIixMcz0iU2VxdWVuY2VFeHByZXNzaW9uIixUcz0iVmFyaWFibGVEZWNsYXJhdG9yIixWcz0iVmFyaWFibGVEZWNsYXJhdGlvbiI7bGV0IEJzPSJzb3VyY2VNYSI7QnMrPSJwcGluZ1VSTCI7Y29uc3QgenM9bmV3IFJlZ0V4cChgXiNbIFxcZlxcclxcdFxcdlxcdTAwYTBcXHUxNjgwXFx1MjAwMC1cXHUyMDBhXFx1MjAyOFxcdTIwMjlcXHUyMDJmXFx1MjA1ZlxcdTMwMDBcXHVmZWZmXSske0JzfT0uK2ApLEZzPSJfcm9sbHVwQW5ub3RhdGlvbnMiLGpzPSJfcm9sbHVwUmVtb3ZlZCI7ZnVuY3Rpb24gVXMoZSx0LHM9ZS50eXBlKXtjb25zdHthbm5vdGF0aW9uczppLGNvZGU6bn09dDtsZXQgcj1pW3QuYW5ub3RhdGlvbkluZGV4XTtmb3IoO3ImJmUuc3RhcnQ+PXIuZW5kOylxcyhlLHIsbikscj1pWysrdC5hbm5vdGF0aW9uSW5kZXhdO2lmKHImJnIuZW5kPD1lLmVuZClmb3IodnNbc10oZSx0LFVzKTsocj1pW3QuYW5ub3RhdGlvbkluZGV4XSkmJnIuZW5kPD1lLmVuZDspKyt0LmFubm90YXRpb25JbmRleCxZcyhlLHIsITEpO31jb25zdCBHcz0vW15ccyhdL2csV3M9L1xTL2c7ZnVuY3Rpb24gcXMoZSx0LHMpe2NvbnN0IGk9W107bGV0IG47aWYoSHMocy5zbGljZSh0LmVuZCxlLnN0YXJ0KSxHcykpe2NvbnN0IHQ9ZS5zdGFydDtmb3IoOzspe3N3aXRjaChpLnB1c2goZSksZS50eXBlKXtjYXNlIE5zOmNhc2Ugd3M6ZT1lLmV4cHJlc3Npb247Y29udGludWU7Y2FzZSBMczppZihIcyhzLnNsaWNlKHQsZS5zdGFydCksV3MpKXtlPWUuZXhwcmVzc2lvbnNbMF07Y29udGludWV9bj0hMDticmVhaztjYXNlIFBzOmlmKEhzKHMuc2xpY2UodCxlLnN0YXJ0KSxXcykpe2U9ZS50ZXN0O2NvbnRpbnVlfW49ITA7YnJlYWs7Y2FzZSBNczpjYXNlIEFzOmlmKEhzKHMuc2xpY2UodCxlLnN0YXJ0KSxXcykpe2U9ZS5sZWZ0O2NvbnRpbnVlfW49ITA7YnJlYWs7Y2FzZSAkczpjYXNlIENzOmU9ZS5kZWNsYXJhdGlvbjtjb250aW51ZTtjYXNlIFZzOntjb25zdCB0PWU7aWYoImNvbnN0Ij09PXQua2luZCl7ZT10LmRlY2xhcmF0aW9uc1swXS5pbml0O2NvbnRpbnVlfW49ITA7YnJlYWt9Y2FzZSBUczplPWUuaW5pdDtjb250aW51ZTtjYXNlIF9zOmNhc2UgU3M6Y2FzZSBJczpjYXNlIE9zOmJyZWFrO2RlZmF1bHQ6bj0hMDt9YnJlYWt9fWVsc2Ugbj0hMDtpZihuKVlzKGUsdCwhMSk7ZWxzZSBmb3IoY29uc3QgZSBvZiBpKVlzKGUsdCwhMCk7fWZ1bmN0aW9uIEhzKGUsdCl7bGV0IHM7Zm9yKDtudWxsIT09KHM9dC5leGVjKGUpKTspe2lmKCIvIj09PXNbMF0pe2NvbnN0IHM9ZS5jaGFyQ29kZUF0KHQubGFzdEluZGV4KTtpZig0Mj09PXMpe3QubGFzdEluZGV4PWUuaW5kZXhPZigiKi8iLHQubGFzdEluZGV4KzEpKzI7Y29udGludWV9aWYoNDc9PT1zKXt0Lmxhc3RJbmRleD1lLmluZGV4T2YoIlxuIix0Lmxhc3RJbmRleCsxKSsxO2NvbnRpbnVlfX1yZXR1cm4gdC5sYXN0SW5kZXg9MCwhMX1yZXR1cm4gITB9Y29uc3QgS3M9W1sicHVyZSIsL1sjQF1fX1BVUkVfXy9dLFsibm9TaWRlRWZmZWN0cyIsL1sjQF1fX05PX1NJREVfRUZGRUNUU19fL11dO2Z1bmN0aW9uIFlzKGUsdCxzKXtjb25zdCBpPXM/RnM6anMsbj1lW2ldO24/bi5wdXNoKHQpOmVbaV09W3RdO31jb25zdCBYcz17SW1wb3J0RXhwcmVzc2lvbjpbImFyZ3VtZW50cyJdLExpdGVyYWw6W10sUHJvZ3JhbTpbImJvZHkiXX07Y29uc3QgUXM9InZhcmlhYmxlcyI7Y2xhc3MgWnMgZXh0ZW5kcyBuZXtjb25zdHJ1Y3RvcihlLHQscyxpPSExKXtzdXBlcigpLHRoaXMuZGVvcHRpbWl6ZWQ9ITEsdGhpcy5lc1RyZWVOb2RlPWk/ZTpudWxsLHRoaXMua2V5cz1Yc1tlLnR5cGVdfHxmdW5jdGlvbihlKXtyZXR1cm4gWHNbZS50eXBlXT1PYmplY3Qua2V5cyhlKS5maWx0ZXIoKHQ9PiJvYmplY3QiPT10eXBlb2YgZVt0XSYmOTUhPT10LmNoYXJDb2RlQXQoMCkpKSxYc1tlLnR5cGVdfShlKSx0aGlzLnBhcmVudD10LHRoaXMuY29udGV4dD10LmNvbnRleHQsdGhpcy5jcmVhdGVTY29wZShzKSx0aGlzLnBhcnNlTm9kZShlKSx0aGlzLmluaXRpYWxpc2UoKSx0aGlzLmNvbnRleHQubWFnaWNTdHJpbmcuYWRkU291cmNlbWFwTG9jYXRpb24odGhpcy5zdGFydCksdGhpcy5jb250ZXh0Lm1hZ2ljU3RyaW5nLmFkZFNvdXJjZW1hcExvY2F0aW9uKHRoaXMuZW5kKTt9YWRkRXhwb3J0ZWRWYXJpYWJsZXMoZSx0KXt9YmluZCgpe2Zvcihjb25zdCBlIG9mIHRoaXMua2V5cyl7Y29uc3QgdD10aGlzW2VdO2lmKEFycmF5LmlzQXJyYXkodCkpZm9yKGNvbnN0IGUgb2YgdCllPy5iaW5kKCk7ZWxzZSB0JiZ0LmJpbmQoKTt9fWNyZWF0ZVNjb3BlKGUpe3RoaXMuc2NvcGU9ZTt9aGFzRWZmZWN0cyhlKXt0aGlzLmRlb3B0aW1pemVkfHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCk7Zm9yKGNvbnN0IHQgb2YgdGhpcy5rZXlzKXtjb25zdCBzPXRoaXNbdF07aWYobnVsbCE9PXMpaWYoQXJyYXkuaXNBcnJheShzKSl7Zm9yKGNvbnN0IHQgb2YgcylpZih0Py5oYXNFZmZlY3RzKGUpKXJldHVybiAhMH1lbHNlIGlmKHMuaGFzRWZmZWN0cyhlKSlyZXR1cm4gITB9cmV0dXJuICExfWhhc0VmZmVjdHNBc0Fzc2lnbm1lbnRUYXJnZXQoZSx0KXtyZXR1cm4gdGhpcy5oYXNFZmZlY3RzKGUpfHx0aGlzLmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKEssdGhpcy5hc3NpZ25tZW50SW50ZXJhY3Rpb24sZSl9aW5jbHVkZShlLHQscyl7dGhpcy5kZW9wdGltaXplZHx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLHRoaXMuaW5jbHVkZWQ9ITA7Zm9yKGNvbnN0IHMgb2YgdGhpcy5rZXlzKXtjb25zdCBpPXRoaXNbc107aWYobnVsbCE9PWkpaWYoQXJyYXkuaXNBcnJheShpKSlmb3IoY29uc3QgcyBvZiBpKXM/LmluY2x1ZGUoZSx0KTtlbHNlIGkuaW5jbHVkZShlLHQpO319aW5jbHVkZUFzQXNzaWdubWVudFRhcmdldChlLHQscyl7dGhpcy5pbmNsdWRlKGUsdCk7fWluaXRpYWxpc2UoKXt9aW5zZXJ0U2VtaWNvbG9uKGUpeyI7IiE9PWUub3JpZ2luYWxbdGhpcy5lbmQtMV0mJmUuYXBwZW5kTGVmdCh0aGlzLmVuZCwiOyIpO31wYXJzZU5vZGUoZSx0KXtmb3IoY29uc3RbcyxpXW9mIE9iamVjdC5lbnRyaWVzKGUpKWlmKCF0aGlzLmhhc093blByb3BlcnR5KHMpKWlmKDk1PT09cy5jaGFyQ29kZUF0KDApKXtpZihzPT09RnMpe2NvbnN0IGU9aTt0aGlzLmFubm90YXRpb25zPWUsdGhpcy5jb250ZXh0Lm9wdGlvbnMudHJlZXNoYWtlLmFubm90YXRpb25zJiYodGhpcy5hbm5vdGF0aW9uTm9TaWRlRWZmZWN0cz1lLnNvbWUoKGU9PiJub1NpZGVFZmZlY3RzIj09PWUuYW5ub3RhdGlvblR5cGUpKSx0aGlzLmFubm90YXRpb25QdXJlPWUuc29tZSgoZT0+InB1cmUiPT09ZS5hbm5vdGF0aW9uVHlwZSkpKTt9ZWxzZSBpZihzPT09anMpZm9yKGNvbnN0e3N0YXJ0OmUsZW5kOnR9b2YgaSl0aGlzLmNvbnRleHQubWFnaWNTdHJpbmcucmVtb3ZlKGUsdCk7fWVsc2UgaWYoIm9iamVjdCIhPXR5cGVvZiBpfHxudWxsPT09aSl0aGlzW3NdPWk7ZWxzZSBpZihBcnJheS5pc0FycmF5KGkpKXt0aGlzW3NdPVtdO2Zvcihjb25zdCBlIG9mIGkpdGhpc1tzXS5wdXNoKG51bGw9PT1lP251bGw6bmV3KHRoaXMuY29udGV4dC5nZXROb2RlQ29uc3RydWN0b3IoZS50eXBlKSkoZSx0aGlzLHRoaXMuc2NvcGUsdD8uaW5jbHVkZXMocykpKTt9ZWxzZSB0aGlzW3NdPW5ldyh0aGlzLmNvbnRleHQuZ2V0Tm9kZUNvbnN0cnVjdG9yKGkudHlwZSkpKGksdGhpcyx0aGlzLnNjb3BlLHQ/LmluY2x1ZGVzKHMpKTt9cmVuZGVyKGUsdCl7Zm9yKGNvbnN0IHMgb2YgdGhpcy5rZXlzKXtjb25zdCBpPXRoaXNbc107aWYobnVsbCE9PWkpaWYoQXJyYXkuaXNBcnJheShpKSlmb3IoY29uc3QgcyBvZiBpKXM/LnJlbmRlcihlLHQpO2Vsc2UgaS5yZW5kZXIoZSx0KTt9fXNldEFzc2lnbmVkVmFsdWUoZSl7dGhpcy5hc3NpZ25tZW50SW50ZXJhY3Rpb249e2FyZ3M6W251bGwsZV0sdHlwZToxfTt9c2hvdWxkQmVJbmNsdWRlZChlKXtyZXR1cm4gdGhpcy5pbmNsdWRlZHx8IWUuYnJva2VuRmxvdyYmdGhpcy5oYXNFZmZlY3RzKHRzKCkpfWFwcGx5RGVvcHRpbWl6YXRpb25zKCl7dGhpcy5kZW9wdGltaXplZD0hMDtmb3IoY29uc3QgZSBvZiB0aGlzLmtleXMpe2NvbnN0IHQ9dGhpc1tlXTtpZihudWxsIT09dClpZihBcnJheS5pc0FycmF5KHQpKWZvcihjb25zdCBlIG9mIHQpZT8uZGVvcHRpbWl6ZVBhdGgoWSk7ZWxzZSB0LmRlb3B0aW1pemVQYXRoKFkpO310aGlzLmNvbnRleHQucmVxdWVzdFRyZWVzaGFraW5nUGFzcygpO319Y2xhc3MgSnMgZXh0ZW5kcyBac3tkZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7dC5sZW5ndGg+MCYmdGhpcy5hcmd1bWVudC5kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLFtHLC4uLnRdLHMpO31oYXNFZmZlY3RzKGUpe3RoaXMuZGVvcHRpbWl6ZWR8fHRoaXMuYXBwbHlEZW9wdGltaXphdGlvbnMoKTtjb25zdHtwcm9wZXJ0eVJlYWRTaWRlRWZmZWN0czp0fT10aGlzLmNvbnRleHQub3B0aW9ucy50cmVlc2hha2U7cmV0dXJuIHRoaXMuYXJndW1lbnQuaGFzRWZmZWN0cyhlKXx8dCYmKCJhbHdheXMiPT09dHx8dGhpcy5hcmd1bWVudC5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChZLGxlLGUpKX1hcHBseURlb3B0aW1pemF0aW9ucygpe3RoaXMuZGVvcHRpbWl6ZWQ9ITAsdGhpcy5hcmd1bWVudC5kZW9wdGltaXplUGF0aChbRyxHXSksdGhpcy5jb250ZXh0LnJlcXVlc3RUcmVlc2hha2luZ1Bhc3MoKTt9fWNsYXNzIGVpIGV4dGVuZHMgbmV7Y29uc3RydWN0b3IoZSl7c3VwZXIoKSx0aGlzLmRlc2NyaXB0aW9uPWU7fWRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKHthcmdzOmUsdHlwZTp0fSxzKXsyPT09dCYmMD09PXMubGVuZ3RoJiZ0aGlzLmRlc2NyaXB0aW9uLm11dGF0ZXNTZWxmQXNBcnJheSYmZVswXT8uZGVvcHRpbWl6ZVBhdGgoUSk7fWdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUse2FyZ3M6dH0pe3JldHVybiBlLmxlbmd0aD4wP29lOlt0aGlzLmRlc2NyaXB0aW9uLnJldHVybnNQcmltaXRpdmV8fCgic2VsZiI9PT10aGlzLmRlc2NyaXB0aW9uLnJldHVybnM/dFswXXx8cmU6dGhpcy5kZXNjcmlwdGlvbi5yZXR1cm5zKCkpLCExXX1oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7Y29uc3R7dHlwZTppfT10O2lmKGUubGVuZ3RoPigwPT09aT8xOjApKXJldHVybiAhMDtpZigyPT09aSl7Y29uc3R7YXJnczplfT10O2lmKCEwPT09dGhpcy5kZXNjcmlwdGlvbi5tdXRhdGVzU2VsZkFzQXJyYXkmJmVbMF0/Lmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKFEsY2UscykpcmV0dXJuICEwO2lmKHRoaXMuZGVzY3JpcHRpb24uY2FsbHNBcmdzKWZvcihjb25zdCB0IG9mIHRoaXMuZGVzY3JpcHRpb24uY2FsbHNBcmdzKWlmKGVbdCsxXT8uaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoSyxoZSxzKSlyZXR1cm4gITB9cmV0dXJuICExfX1jb25zdCB0aT1bbmV3IGVpKHtjYWxsc0FyZ3M6bnVsbCxtdXRhdGVzU2VsZkFzQXJyYXk6ITEscmV0dXJuczpudWxsLHJldHVybnNQcmltaXRpdmU6cnN9KV0sc2k9W25ldyBlaSh7Y2FsbHNBcmdzOm51bGwsbXV0YXRlc1NlbGZBc0FycmF5OiExLHJldHVybnM6bnVsbCxyZXR1cm5zUHJpbWl0aXZlOmNzfSldLGlpPVtuZXcgZWkoe2NhbGxzQXJnczpudWxsLG11dGF0ZXNTZWxmQXNBcnJheTohMSxyZXR1cm5zOm51bGwscmV0dXJuc1ByaW1pdGl2ZTphc30pXSxuaT1bbmV3IGVpKHtjYWxsc0FyZ3M6bnVsbCxtdXRhdGVzU2VsZkFzQXJyYXk6ITEscmV0dXJuczpudWxsLHJldHVybnNQcmltaXRpdmU6cmV9KV0scmk9L15cZCskLztjbGFzcyBvaSBleHRlbmRzIG5le2NvbnN0cnVjdG9yKGUsdCxzPSExKXtpZihzdXBlcigpLHRoaXMucHJvdG90eXBlRXhwcmVzc2lvbj10LHRoaXMuaW1tdXRhYmxlPXMsdGhpcy5hZGRpdGlvbmFsRXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQ9bmV3IFNldCx0aGlzLmFsbFByb3BlcnRpZXM9W10sdGhpcy5kZW9wdGltaXplZFBhdGhzPU9iamVjdC5jcmVhdGUobnVsbCksdGhpcy5leHByZXNzaW9uc1RvQmVEZW9wdGltaXplZEJ5S2V5PU9iamVjdC5jcmVhdGUobnVsbCksdGhpcy5nZXR0ZXJzQnlLZXk9T2JqZWN0LmNyZWF0ZShudWxsKSx0aGlzLmhhc0xvc3RUcmFjaz0hMSx0aGlzLmhhc1Vua25vd25EZW9wdGltaXplZEludGVnZXI9ITEsdGhpcy5oYXNVbmtub3duRGVvcHRpbWl6ZWRQcm9wZXJ0eT0hMSx0aGlzLnByb3BlcnRpZXNBbmRHZXR0ZXJzQnlLZXk9T2JqZWN0LmNyZWF0ZShudWxsKSx0aGlzLnByb3BlcnRpZXNBbmRTZXR0ZXJzQnlLZXk9T2JqZWN0LmNyZWF0ZShudWxsKSx0aGlzLnNldHRlcnNCeUtleT1PYmplY3QuY3JlYXRlKG51bGwpLHRoaXMudW5rbm93bkludGVnZXJQcm9wcz1bXSx0aGlzLnVubWF0Y2hhYmxlR2V0dGVycz1bXSx0aGlzLnVubWF0Y2hhYmxlUHJvcGVydGllc0FuZEdldHRlcnM9W10sdGhpcy51bm1hdGNoYWJsZVNldHRlcnM9W10sQXJyYXkuaXNBcnJheShlKSl0aGlzLmJ1aWxkUHJvcGVydHlNYXBzKGUpO2Vsc2Uge3RoaXMucHJvcGVydGllc0FuZEdldHRlcnNCeUtleT10aGlzLnByb3BlcnRpZXNBbmRTZXR0ZXJzQnlLZXk9ZTtmb3IoY29uc3QgdCBvZiBPYmplY3QudmFsdWVzKGUpKXRoaXMuYWxsUHJvcGVydGllcy5wdXNoKC4uLnQpO319ZGVvcHRpbWl6ZUFsbFByb3BlcnRpZXMoZSl7Y29uc3QgdD10aGlzLmhhc0xvc3RUcmFja3x8dGhpcy5oYXNVbmtub3duRGVvcHRpbWl6ZWRQcm9wZXJ0eTtpZihlP3RoaXMuaGFzVW5rbm93bkRlb3B0aW1pemVkUHJvcGVydHk9ITA6dGhpcy5oYXNMb3N0VHJhY2s9ITAsIXQpe2Zvcihjb25zdCBlIG9mIFsuLi5PYmplY3QudmFsdWVzKHRoaXMucHJvcGVydGllc0FuZEdldHRlcnNCeUtleSksLi4uT2JqZWN0LnZhbHVlcyh0aGlzLnNldHRlcnNCeUtleSldKWZvcihjb25zdCB0IG9mIGUpdC5kZW9wdGltaXplUGF0aChZKTt0aGlzLnByb3RvdHlwZUV4cHJlc3Npb24/LmRlb3B0aW1pemVQYXRoKFtHLEddKSx0aGlzLmRlb3B0aW1pemVDYWNoZWRFbnRpdGllcygpO319ZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe2NvbnN0W2ksLi4ubl09dCx7YXJnczpyLHR5cGU6b309ZTtpZih0aGlzLmhhc0xvc3RUcmFja3x8KDI9PT1vfHx0Lmxlbmd0aD4xKSYmKHRoaXMuaGFzVW5rbm93bkRlb3B0aW1pemVkUHJvcGVydHl8fCJzdHJpbmciPT10eXBlb2YgaSYmdGhpcy5kZW9wdGltaXplZFBhdGhzW2ldKSlyZXR1cm4gdm9pZCBhZShlKTtjb25zdFthLGwsY109Mj09PW98fHQubGVuZ3RoPjE/W3RoaXMucHJvcGVydGllc0FuZEdldHRlcnNCeUtleSx0aGlzLnByb3BlcnRpZXNBbmRHZXR0ZXJzQnlLZXksdGhpcy51bm1hdGNoYWJsZVByb3BlcnRpZXNBbmRHZXR0ZXJzXTowPT09bz9bdGhpcy5wcm9wZXJ0aWVzQW5kR2V0dGVyc0J5S2V5LHRoaXMuZ2V0dGVyc0J5S2V5LHRoaXMudW5tYXRjaGFibGVHZXR0ZXJzXTpbdGhpcy5wcm9wZXJ0aWVzQW5kU2V0dGVyc0J5S2V5LHRoaXMuc2V0dGVyc0J5S2V5LHRoaXMudW5tYXRjaGFibGVTZXR0ZXJzXTtpZigic3RyaW5nIj09dHlwZW9mIGkpe2lmKGFbaV0pe2NvbnN0IHQ9bFtpXTtpZih0KWZvcihjb25zdCBpIG9mIHQpaS5kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLG4scyk7aWYoIXRoaXMuaW1tdXRhYmxlKWZvcihjb25zdCBlIG9mIHIpZSYmdGhpcy5hZGRpdGlvbmFsRXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQuYWRkKGUpO3JldHVybn1mb3IoY29uc3QgdCBvZiBjKXQuZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSxuLHMpO2lmKHJpLnRlc3QoaSkpZm9yKGNvbnN0IHQgb2YgdGhpcy51bmtub3duSW50ZWdlclByb3BzKXQuZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSxuLHMpO31lbHNlIHtmb3IoY29uc3QgdCBvZiBbLi4uT2JqZWN0LnZhbHVlcyhsKSxjXSlmb3IoY29uc3QgaSBvZiB0KWkuZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSxuLHMpO2Zvcihjb25zdCB0IG9mIHRoaXMudW5rbm93bkludGVnZXJQcm9wcyl0LmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsbixzKTt9aWYoIXRoaXMuaW1tdXRhYmxlKWZvcihjb25zdCBlIG9mIHIpZSYmdGhpcy5hZGRpdGlvbmFsRXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQuYWRkKGUpO3RoaXMucHJvdG90eXBlRXhwcmVzc2lvbj8uZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpO31kZW9wdGltaXplSW50ZWdlclByb3BlcnRpZXMoKXtpZighKHRoaXMuaGFzTG9zdFRyYWNrfHx0aGlzLmhhc1Vua25vd25EZW9wdGltaXplZFByb3BlcnR5fHx0aGlzLmhhc1Vua25vd25EZW9wdGltaXplZEludGVnZXIpKXt0aGlzLmhhc1Vua25vd25EZW9wdGltaXplZEludGVnZXI9ITA7Zm9yKGNvbnN0W2UsdF1vZiBPYmplY3QuZW50cmllcyh0aGlzLnByb3BlcnRpZXNBbmRHZXR0ZXJzQnlLZXkpKWlmKHJpLnRlc3QoZSkpZm9yKGNvbnN0IGUgb2YgdCllLmRlb3B0aW1pemVQYXRoKFkpO3RoaXMuZGVvcHRpbWl6ZUNhY2hlZEludGVnZXJFbnRpdGllcygpO319ZGVvcHRpbWl6ZVBhdGgoZSl7aWYodGhpcy5oYXNMb3N0VHJhY2t8fHRoaXMuaW1tdXRhYmxlKXJldHVybjtjb25zdCB0PWVbMF07aWYoMT09PWUubGVuZ3RoKXtpZigic3RyaW5nIiE9dHlwZW9mIHQpcmV0dXJuIHQ9PT1xP3RoaXMuZGVvcHRpbWl6ZUludGVnZXJQcm9wZXJ0aWVzKCk6dGhpcy5kZW9wdGltaXplQWxsUHJvcGVydGllcyh0PT09Vyk7aWYoIXRoaXMuZGVvcHRpbWl6ZWRQYXRoc1t0XSl7dGhpcy5kZW9wdGltaXplZFBhdGhzW3RdPSEwO2NvbnN0IGU9dGhpcy5leHByZXNzaW9uc1RvQmVEZW9wdGltaXplZEJ5S2V5W3RdO2lmKGUpZm9yKGNvbnN0IHQgb2YgZSl0LmRlb3B0aW1pemVDYWNoZSgpO319Y29uc3Qgcz0xPT09ZS5sZW5ndGg/WTplLnNsaWNlKDEpO2Zvcihjb25zdCBlIG9mICJzdHJpbmciPT10eXBlb2YgdD9bLi4udGhpcy5wcm9wZXJ0aWVzQW5kR2V0dGVyc0J5S2V5W3RdfHx0aGlzLnVubWF0Y2hhYmxlUHJvcGVydGllc0FuZEdldHRlcnMsLi4udGhpcy5zZXR0ZXJzQnlLZXlbdF18fHRoaXMudW5tYXRjaGFibGVTZXR0ZXJzXTp0aGlzLmFsbFByb3BlcnRpZXMpZS5kZW9wdGltaXplUGF0aChzKTt0aGlzLnByb3RvdHlwZUV4cHJlc3Npb24/LmRlb3B0aW1pemVQYXRoKDE9PT1lLmxlbmd0aD9bLi4uZSxHXTplKTt9Z2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUsdCxzKXtpZigwPT09ZS5sZW5ndGgpcmV0dXJuIGllO2NvbnN0IGk9ZVswXSxuPXRoaXMuZ2V0TWVtYmVyRXhwcmVzc2lvbkFuZFRyYWNrRGVvcHQoaSxzKTtyZXR1cm4gbj9uLmdldExpdGVyYWxWYWx1ZUF0UGF0aChlLnNsaWNlKDEpLHQscyk6dGhpcy5wcm90b3R5cGVFeHByZXNzaW9uP3RoaXMucHJvdG90eXBlRXhwcmVzc2lvbi5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpOjEhPT1lLmxlbmd0aD9zZTp2b2lkIDB9Z2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSl7aWYoMD09PWUubGVuZ3RoKXJldHVybiBvZTtjb25zdFtuLC4uLnJdPWUsbz10aGlzLmdldE1lbWJlckV4cHJlc3Npb25BbmRUcmFja0Rlb3B0KG4saSk7cmV0dXJuIG8/by5nZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChyLHQscyxpKTp0aGlzLnByb3RvdHlwZUV4cHJlc3Npb24/dGhpcy5wcm90b3R5cGVFeHByZXNzaW9uLmdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUsdCxzLGkpOm9lfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtjb25zdFtpLC4uLm5dPWU7aWYobi5sZW5ndGg+MHx8Mj09PXQudHlwZSl7Y29uc3Qgcj10aGlzLmdldE1lbWJlckV4cHJlc3Npb24oaSk7cmV0dXJuIHI/ci5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChuLHQscyk6IXRoaXMucHJvdG90eXBlRXhwcmVzc2lvbnx8dGhpcy5wcm90b3R5cGVFeHByZXNzaW9uLmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKX1pZihpPT09VylyZXR1cm4gITE7aWYodGhpcy5oYXNMb3N0VHJhY2spcmV0dXJuICEwO2NvbnN0W3IsbyxhXT0wPT09dC50eXBlP1t0aGlzLnByb3BlcnRpZXNBbmRHZXR0ZXJzQnlLZXksdGhpcy5nZXR0ZXJzQnlLZXksdGhpcy51bm1hdGNoYWJsZUdldHRlcnNdOlt0aGlzLnByb3BlcnRpZXNBbmRTZXR0ZXJzQnlLZXksdGhpcy5zZXR0ZXJzQnlLZXksdGhpcy51bm1hdGNoYWJsZVNldHRlcnNdO2lmKCJzdHJpbmciPT10eXBlb2YgaSl7aWYocltpXSl7Y29uc3QgZT1vW2ldO2lmKGUpZm9yKGNvbnN0IGkgb2YgZSlpZihpLmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKG4sdCxzKSlyZXR1cm4gITA7cmV0dXJuICExfWZvcihjb25zdCBlIG9mIGEpaWYoZS5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChuLHQscykpcmV0dXJuICEwfWVsc2UgZm9yKGNvbnN0IGUgb2YgWy4uLk9iamVjdC52YWx1ZXMobyksYV0pZm9yKGNvbnN0IGkgb2YgZSlpZihpLmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKG4sdCxzKSlyZXR1cm4gITA7cmV0dXJuICEhdGhpcy5wcm90b3R5cGVFeHByZXNzaW9uJiZ0aGlzLnByb3RvdHlwZUV4cHJlc3Npb24uaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpfWJ1aWxkUHJvcGVydHlNYXBzKGUpe2NvbnN0e2FsbFByb3BlcnRpZXM6dCxwcm9wZXJ0aWVzQW5kR2V0dGVyc0J5S2V5OnMscHJvcGVydGllc0FuZFNldHRlcnNCeUtleTppLHNldHRlcnNCeUtleTpuLGdldHRlcnNCeUtleTpyLHVua25vd25JbnRlZ2VyUHJvcHM6byx1bm1hdGNoYWJsZVByb3BlcnRpZXNBbmRHZXR0ZXJzOmEsdW5tYXRjaGFibGVHZXR0ZXJzOmwsdW5tYXRjaGFibGVTZXR0ZXJzOmN9PXRoaXMsaD1bXTtmb3IobGV0IHU9ZS5sZW5ndGgtMTt1Pj0wO3UtLSl7Y29uc3R7a2V5OmQsa2luZDpwLHByb3BlcnR5OmZ9PWVbdV07aWYodC5wdXNoKGYpLCJzdHJpbmciPT10eXBlb2YgZCkic2V0Ij09PXA/aVtkXXx8KGlbZF09W2YsLi4uaF0sbltkXT1bZiwuLi5jXSk6ImdldCI9PT1wP3NbZF18fChzW2RdPVtmLC4uLmFdLHJbZF09W2YsLi4ubF0pOihpW2RdfHwoaVtkXT1bZiwuLi5oXSksc1tkXXx8KHNbZF09W2YsLi4uYV0pKTtlbHNlIHtpZihkPT09cSl7by5wdXNoKGYpO2NvbnRpbnVlfSJzZXQiPT09cCYmYy5wdXNoKGYpLCJnZXQiPT09cCYmbC5wdXNoKGYpLCJnZXQiIT09cCYmaC5wdXNoKGYpLCJzZXQiIT09cCYmYS5wdXNoKGYpO319fWRlb3B0aW1pemVDYWNoZWRFbnRpdGllcygpe2Zvcihjb25zdCBlIG9mIE9iamVjdC52YWx1ZXModGhpcy5leHByZXNzaW9uc1RvQmVEZW9wdGltaXplZEJ5S2V5KSlmb3IoY29uc3QgdCBvZiBlKXQuZGVvcHRpbWl6ZUNhY2hlKCk7Zm9yKGNvbnN0IGUgb2YgdGhpcy5hZGRpdGlvbmFsRXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQpZS5kZW9wdGltaXplUGF0aChZKTt9ZGVvcHRpbWl6ZUNhY2hlZEludGVnZXJFbnRpdGllcygpe2Zvcihjb25zdFtlLHRdb2YgT2JqZWN0LmVudHJpZXModGhpcy5leHByZXNzaW9uc1RvQmVEZW9wdGltaXplZEJ5S2V5KSlpZihyaS50ZXN0KGUpKWZvcihjb25zdCBlIG9mIHQpZS5kZW9wdGltaXplQ2FjaGUoKTtmb3IoY29uc3QgZSBvZiB0aGlzLmFkZGl0aW9uYWxFeHByZXNzaW9uc1RvQmVEZW9wdGltaXplZCllLmRlb3B0aW1pemVQYXRoKFEpO31nZXRNZW1iZXJFeHByZXNzaW9uKGUpe2lmKHRoaXMuaGFzTG9zdFRyYWNrfHx0aGlzLmhhc1Vua25vd25EZW9wdGltaXplZFByb3BlcnR5fHwic3RyaW5nIiE9dHlwZW9mIGV8fHRoaXMuaGFzVW5rbm93bkRlb3B0aW1pemVkSW50ZWdlciYmcmkudGVzdChlKXx8dGhpcy5kZW9wdGltaXplZFBhdGhzW2VdKXJldHVybiByZTtjb25zdCB0PXRoaXMucHJvcGVydGllc0FuZEdldHRlcnNCeUtleVtlXTtyZXR1cm4gMT09PXQ/Lmxlbmd0aD90WzBdOnR8fHRoaXMudW5tYXRjaGFibGVQcm9wZXJ0aWVzQW5kR2V0dGVycy5sZW5ndGg+MHx8dGhpcy51bmtub3duSW50ZWdlclByb3BzLmxlbmd0aD4wJiZyaS50ZXN0KGUpP3JlOm51bGx9Z2V0TWVtYmVyRXhwcmVzc2lvbkFuZFRyYWNrRGVvcHQoZSx0KXtpZigic3RyaW5nIiE9dHlwZW9mIGUpcmV0dXJuIHJlO2NvbnN0IHM9dGhpcy5nZXRNZW1iZXJFeHByZXNzaW9uKGUpO2lmKHMhPT1yZSYmIXRoaXMuaW1tdXRhYmxlKXsodGhpcy5leHByZXNzaW9uc1RvQmVEZW9wdGltaXplZEJ5S2V5W2VdPXRoaXMuZXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWRCeUtleVtlXXx8W10pLnB1c2godCk7fXJldHVybiBzfX1jb25zdCBhaT1lPT4ic3RyaW5nIj09dHlwZW9mIGUmJi9eXGQrJC8udGVzdChlKSxsaT1uZXcgY2xhc3MgZXh0ZW5kcyBuZXtkZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQpezIhPT1lLnR5cGV8fDEhPT10Lmxlbmd0aHx8YWkodFswXSl8fGFlKGUpO31nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSl7cmV0dXJuIDE9PT1lLmxlbmd0aCYmYWkoZVswXSk/dm9pZCAwOnNlfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUse3R5cGU6dH0pe3JldHVybiBlLmxlbmd0aD4xfHwyPT09dH19LGNpPW5ldyBvaSh7X19wcm90b19fOm51bGwsaGFzT3duUHJvcGVydHk6dGksaXNQcm90b3R5cGVPZjp0aSxwcm9wZXJ0eUlzRW51bWVyYWJsZTp0aSx0b0xvY2FsZVN0cmluZzpzaSx0b1N0cmluZzpzaSx2YWx1ZU9mOm5pfSxsaSwhMCksaGk9W3trZXk6cSxraW5kOiJpbml0Iixwcm9wZXJ0eTpyZX0se2tleToibGVuZ3RoIixraW5kOiJpbml0Iixwcm9wZXJ0eTphc31dLHVpPVtuZXcgZWkoe2NhbGxzQXJnczpbMF0sbXV0YXRlc1NlbGZBc0FycmF5OiJkZW9wdC1vbmx5IixyZXR1cm5zOm51bGwscmV0dXJuc1ByaW1pdGl2ZTpyc30pXSxkaT1bbmV3IGVpKHtjYWxsc0FyZ3M6WzBdLG11dGF0ZXNTZWxmQXNBcnJheToiZGVvcHQtb25seSIscmV0dXJuczpudWxsLHJldHVybnNQcmltaXRpdmU6YXN9KV0scGk9W25ldyBlaSh7Y2FsbHNBcmdzOm51bGwsbXV0YXRlc1NlbGZBc0FycmF5OiEwLHJldHVybnM6KCk9Pm5ldyBvaShoaSxTaSkscmV0dXJuc1ByaW1pdGl2ZTpudWxsfSldLGZpPVtuZXcgZWkoe2NhbGxzQXJnczpudWxsLG11dGF0ZXNTZWxmQXNBcnJheToiZGVvcHQtb25seSIscmV0dXJuczooKT0+bmV3IG9pKGhpLFNpKSxyZXR1cm5zUHJpbWl0aXZlOm51bGx9KV0sbWk9W25ldyBlaSh7Y2FsbHNBcmdzOlswXSxtdXRhdGVzU2VsZkFzQXJyYXk6ImRlb3B0LW9ubHkiLHJldHVybnM6KCk9Pm5ldyBvaShoaSxTaSkscmV0dXJuc1ByaW1pdGl2ZTpudWxsfSldLGdpPVtuZXcgZWkoe2NhbGxzQXJnczpudWxsLG11dGF0ZXNTZWxmQXNBcnJheTohMCxyZXR1cm5zOm51bGwscmV0dXJuc1ByaW1pdGl2ZTphc30pXSx5aT1bbmV3IGVpKHtjYWxsc0FyZ3M6bnVsbCxtdXRhdGVzU2VsZkFzQXJyYXk6ITAscmV0dXJuczpudWxsLHJldHVybnNQcmltaXRpdmU6cmV9KV0seGk9W25ldyBlaSh7Y2FsbHNBcmdzOm51bGwsbXV0YXRlc1NlbGZBc0FycmF5OiJkZW9wdC1vbmx5IixyZXR1cm5zOm51bGwscmV0dXJuc1ByaW1pdGl2ZTpyZX0pXSxFaT1bbmV3IGVpKHtjYWxsc0FyZ3M6WzBdLG11dGF0ZXNTZWxmQXNBcnJheToiZGVvcHQtb25seSIscmV0dXJuczpudWxsLHJldHVybnNQcmltaXRpdmU6cmV9KV0sYmk9W25ldyBlaSh7Y2FsbHNBcmdzOm51bGwsbXV0YXRlc1NlbGZBc0FycmF5OiEwLHJldHVybnM6InNlbGYiLHJldHVybnNQcmltaXRpdmU6bnVsbH0pXSx2aT1bbmV3IGVpKHtjYWxsc0FyZ3M6WzBdLG11dGF0ZXNTZWxmQXNBcnJheTohMCxyZXR1cm5zOiJzZWxmIixyZXR1cm5zUHJpbWl0aXZlOm51bGx9KV0sU2k9bmV3IG9pKHtfX3Byb3RvX186bnVsbCxhdDp4aSxjb25jYXQ6ZmksY29weVdpdGhpbjpiaSxlbnRyaWVzOmZpLGV2ZXJ5OnVpLGZpbGw6YmksZmlsdGVyOm1pLGZpbmQ6RWksZmluZEluZGV4OmRpLGZpbmRMYXN0OkVpLGZpbmRMYXN0SW5kZXg6ZGksZmxhdDpmaSxmbGF0TWFwOm1pLGZvckVhY2g6RWksaW5jbHVkZXM6dGksaW5kZXhPZjppaSxqb2luOnNpLGtleXM6bmksbGFzdEluZGV4T2Y6aWksbWFwOm1pLHBvcDp5aSxwdXNoOmdpLHJlZHVjZTpFaSxyZWR1Y2VSaWdodDpFaSxyZXZlcnNlOmJpLHNoaWZ0OnlpLHNsaWNlOmZpLHNvbWU6dWksc29ydDp2aSxzcGxpY2U6cGksdG9Mb2NhbGVTdHJpbmc6c2ksdG9TdHJpbmc6c2ksdW5zaGlmdDpnaSx2YWx1ZXM6eGl9LGNpLCEwKTtjbGFzcyBBaSBleHRlbmRzIFpze2NvbnN0cnVjdG9yKCl7c3VwZXIoLi4uYXJndW1lbnRzKSx0aGlzLm9iamVjdEVudGl0eT1udWxsO31kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7dGhpcy5nZXRPYmplY3RFbnRpdHkoKS5kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyk7fWRlb3B0aW1pemVQYXRoKGUpe3RoaXMuZ2V0T2JqZWN0RW50aXR5KCkuZGVvcHRpbWl6ZVBhdGgoZSk7fWdldExpdGVyYWxWYWx1ZUF0UGF0aChlLHQscyl7cmV0dXJuIHRoaXMuZ2V0T2JqZWN0RW50aXR5KCkuZ2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUsdCxzKX1nZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChlLHQscyxpKXtyZXR1cm4gdGhpcy5nZXRPYmplY3RFbnRpdHkoKS5nZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChlLHQscyxpKX1oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7cmV0dXJuIHRoaXMuZ2V0T2JqZWN0RW50aXR5KCkuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpfWFwcGx5RGVvcHRpbWl6YXRpb25zKCl7dGhpcy5kZW9wdGltaXplZD0hMDtsZXQgZT0hMTtmb3IobGV0IHQ9MDt0PHRoaXMuZWxlbWVudHMubGVuZ3RoO3QrKyl7Y29uc3Qgcz10aGlzLmVsZW1lbnRzW3RdO3MmJihlfHxzIGluc3RhbmNlb2YgSnMpJiYoZT0hMCxzLmRlb3B0aW1pemVQYXRoKFkpKTt9dGhpcy5jb250ZXh0LnJlcXVlc3RUcmVlc2hha2luZ1Bhc3MoKTt9Z2V0T2JqZWN0RW50aXR5KCl7aWYobnVsbCE9PXRoaXMub2JqZWN0RW50aXR5KXJldHVybiB0aGlzLm9iamVjdEVudGl0eTtjb25zdCBlPVt7a2V5OiJsZW5ndGgiLGtpbmQ6ImluaXQiLHByb3BlcnR5OmFzfV07bGV0IHQ9ITE7Zm9yKGxldCBzPTA7czx0aGlzLmVsZW1lbnRzLmxlbmd0aDtzKyspe2NvbnN0IGk9dGhpcy5lbGVtZW50c1tzXTt0fHxpIGluc3RhbmNlb2YgSnM/aSYmKHQ9ITAsZS51bnNoaWZ0KHtrZXk6cSxraW5kOiJpbml0Iixwcm9wZXJ0eTppfSkpOmk/ZS5wdXNoKHtrZXk6U3RyaW5nKHMpLGtpbmQ6ImluaXQiLHByb3BlcnR5Oml9KTplLnB1c2goe2tleTpTdHJpbmcocyksa2luZDoiaW5pdCIscHJvcGVydHk6aXN9KTt9cmV0dXJuIHRoaXMub2JqZWN0RW50aXR5PW5ldyBvaShlLFNpKX19Y2xhc3Mga2kgZXh0ZW5kcyBac3thZGRFeHBvcnRlZFZhcmlhYmxlcyhlLHQpe2Zvcihjb25zdCBzIG9mIHRoaXMuZWxlbWVudHMpcz8uYWRkRXhwb3J0ZWRWYXJpYWJsZXMoZSx0KTt9ZGVjbGFyZShlKXtjb25zdCB0PVtdO2Zvcihjb25zdCBzIG9mIHRoaXMuZWxlbWVudHMpbnVsbCE9PXMmJnQucHVzaCguLi5zLmRlY2xhcmUoZSxyZSkpO3JldHVybiB0fWRlb3B0aW1pemVQYXRoKCl7Zm9yKGNvbnN0IGUgb2YgdGhpcy5lbGVtZW50cyllPy5kZW9wdGltaXplUGF0aChLKTt9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe2Zvcihjb25zdCBlIG9mIHRoaXMuZWxlbWVudHMpaWYoZT8uaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoSyx0LHMpKXJldHVybiAhMDtyZXR1cm4gITF9bWFya0RlY2xhcmF0aW9uUmVhY2hlZCgpe2Zvcihjb25zdCBlIG9mIHRoaXMuZWxlbWVudHMpZT8ubWFya0RlY2xhcmF0aW9uUmVhY2hlZCgpO319Y2xhc3MgSWkgZXh0ZW5kcyB1ZXtjb25zdHJ1Y3RvcihlLHQscyxpKXtzdXBlcihlKSx0aGlzLmluaXQ9cyx0aGlzLmNhbGxlZEZyb21UcnlTdGF0ZW1lbnQ9ITEsdGhpcy5hZGRpdGlvbmFsSW5pdGlhbGl6ZXJzPW51bGwsdGhpcy5leHByZXNzaW9uc1RvQmVEZW9wdGltaXplZD1bXSx0aGlzLmRlY2xhcmF0aW9ucz10P1t0XTpbXSx0aGlzLmRlb3B0aW1pemF0aW9uVHJhY2tlcj1pLmRlb3B0aW1pemF0aW9uVHJhY2tlcix0aGlzLm1vZHVsZT1pLm1vZHVsZTt9YWRkRGVjbGFyYXRpb24oZSx0KXt0aGlzLmRlY2xhcmF0aW9ucy5wdXNoKGUpLHRoaXMubWFya0luaXRpYWxpemVyc0ZvckRlb3B0aW1pemF0aW9uKCkucHVzaCh0KTt9Y29uc29saWRhdGVJbml0aWFsaXplcnMoKXtpZih0aGlzLmFkZGl0aW9uYWxJbml0aWFsaXplcnMpe2Zvcihjb25zdCBlIG9mIHRoaXMuYWRkaXRpb25hbEluaXRpYWxpemVycyllLmRlb3B0aW1pemVQYXRoKFkpO3RoaXMuYWRkaXRpb25hbEluaXRpYWxpemVycz1udWxsO319ZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3RoaXMuaXNSZWFzc2lnbmVkP2FlKGUpOnMud2l0aFRyYWNrZWRFbnRpdHlBdFBhdGgodCx0aGlzLmluaXQsKCgpPT50aGlzLmluaXQuZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpKSx2b2lkIDApO31kZW9wdGltaXplUGF0aChlKXtpZighdGhpcy5pc1JlYXNzaWduZWQmJiF0aGlzLmRlb3B0aW1pemF0aW9uVHJhY2tlci50cmFja0VudGl0eUF0UGF0aEFuZEdldElmVHJhY2tlZChlLHRoaXMpKWlmKDA9PT1lLmxlbmd0aCl7aWYoIXRoaXMuaXNSZWFzc2lnbmVkKXt0aGlzLmlzUmVhc3NpZ25lZD0hMDtjb25zdCBlPXRoaXMuZXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQ7dGhpcy5leHByZXNzaW9uc1RvQmVEZW9wdGltaXplZD1tZTtmb3IoY29uc3QgdCBvZiBlKXQuZGVvcHRpbWl6ZUNhY2hlKCk7dGhpcy5pbml0LmRlb3B0aW1pemVQYXRoKFkpO319ZWxzZSB0aGlzLmluaXQuZGVvcHRpbWl6ZVBhdGgoZSk7fWdldExpdGVyYWxWYWx1ZUF0UGF0aChlLHQscyl7cmV0dXJuIHRoaXMuaXNSZWFzc2lnbmVkP3NlOnQud2l0aFRyYWNrZWRFbnRpdHlBdFBhdGgoZSx0aGlzLmluaXQsKCgpPT4odGhpcy5leHByZXNzaW9uc1RvQmVEZW9wdGltaXplZC5wdXNoKHMpLHRoaXMuaW5pdC5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpKSksc2UpfWdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUsdCxzLGkpe3JldHVybiB0aGlzLmlzUmVhc3NpZ25lZD9vZTpzLndpdGhUcmFja2VkRW50aXR5QXRQYXRoKGUsdGhpcy5pbml0LCgoKT0+KHRoaXMuZXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQucHVzaChpKSx0aGlzLmluaXQuZ2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSkpKSxvZSl9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3N3aXRjaCh0LnR5cGUpe2Nhc2UgMDpyZXR1cm4gISF0aGlzLmlzUmVhc3NpZ25lZHx8IXMuYWNjZXNzZWQudHJhY2tFbnRpdHlBdFBhdGhBbmRHZXRJZlRyYWNrZWQoZSx0aGlzKSYmdGhpcy5pbml0Lmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKTtjYXNlIDE6cmV0dXJuICEhdGhpcy5pbmNsdWRlZHx8MCE9PWUubGVuZ3RoJiYoISF0aGlzLmlzUmVhc3NpZ25lZHx8IXMuYXNzaWduZWQudHJhY2tFbnRpdHlBdFBhdGhBbmRHZXRJZlRyYWNrZWQoZSx0aGlzKSYmdGhpcy5pbml0Lmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKSk7Y2FzZSAyOnJldHVybiAhIXRoaXMuaXNSZWFzc2lnbmVkfHwhKHQud2l0aE5ldz9zLmluc3RhbnRpYXRlZDpzLmNhbGxlZCkudHJhY2tFbnRpdHlBdFBhdGhBbmRHZXRJZlRyYWNrZWQoZSx0LmFyZ3MsdGhpcykmJnRoaXMuaW5pdC5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl9fWluY2x1ZGUoKXtpZighdGhpcy5pbmNsdWRlZCl7dGhpcy5pbmNsdWRlZD0hMDtmb3IoY29uc3QgZSBvZiB0aGlzLmRlY2xhcmF0aW9ucyl7ZS5pbmNsdWRlZHx8ZS5pbmNsdWRlKGVzKCksITEpO2xldCB0PWUucGFyZW50O2Zvcig7IXQuaW5jbHVkZWQmJih0LmluY2x1ZGVkPSEwLHQudHlwZSE9PURzKTspdD10LnBhcmVudDt9fX1pbmNsdWRlQ2FsbEFyZ3VtZW50cyhlLHQpe2lmKHRoaXMuaXNSZWFzc2lnbmVkfHxlLmluY2x1ZGVkQ2FsbEFyZ3VtZW50cy5oYXModGhpcy5pbml0KSlmb3IoY29uc3QgcyBvZiB0KXMuaW5jbHVkZShlLCExKTtlbHNlIGUuaW5jbHVkZWRDYWxsQXJndW1lbnRzLmFkZCh0aGlzLmluaXQpLHRoaXMuaW5pdC5pbmNsdWRlQ2FsbEFyZ3VtZW50cyhlLHQpLGUuaW5jbHVkZWRDYWxsQXJndW1lbnRzLmRlbGV0ZSh0aGlzLmluaXQpO31tYXJrQ2FsbGVkRnJvbVRyeVN0YXRlbWVudCgpe3RoaXMuY2FsbGVkRnJvbVRyeVN0YXRlbWVudD0hMDt9bWFya0luaXRpYWxpemVyc0ZvckRlb3B0aW1pemF0aW9uKCl7cmV0dXJuIG51bGw9PT10aGlzLmFkZGl0aW9uYWxJbml0aWFsaXplcnMmJih0aGlzLmFkZGl0aW9uYWxJbml0aWFsaXplcnM9W3RoaXMuaW5pdF0sdGhpcy5pbml0PXJlLHRoaXMuaXNSZWFzc2lnbmVkPSEwKSx0aGlzLmFkZGl0aW9uYWxJbml0aWFsaXplcnN9bWVyZ2VEZWNsYXJhdGlvbnMoZSl7Y29uc3R7ZGVjbGFyYXRpb25zOnR9PXRoaXM7Zm9yKGNvbnN0IHMgb2YgZS5kZWNsYXJhdGlvbnMpdC5wdXNoKHMpO2NvbnN0IHM9dGhpcy5tYXJrSW5pdGlhbGl6ZXJzRm9yRGVvcHRpbWl6YXRpb24oKTtpZihzLnB1c2goZS5pbml0KSxlLmFkZGl0aW9uYWxJbml0aWFsaXplcnMpZm9yKGNvbnN0IHQgb2YgZS5hZGRpdGlvbmFsSW5pdGlhbGl6ZXJzKXMucHVzaCh0KTt9fWNvbnN0IHdpPW1lLFBpPW5ldyBTZXQoW0ddKSxDaT1uZXcgSiwkaT1uZXcgU2V0KFtyZV0pO2NsYXNzIE5pIGV4dGVuZHMgSWl7Y29uc3RydWN0b3IoZSx0LHMpe3N1cGVyKGUsdCxyZSxzKSx0aGlzLmRlb3B0aW1pemF0aW9uSW50ZXJhY3Rpb25zPVtdLHRoaXMuZGVvcHRpbWl6YXRpb25zPW5ldyBKLHRoaXMuZGVvcHRpbWl6ZWRGaWVsZHM9bmV3IFNldCx0aGlzLmVudGl0aWVzVG9CZURlb3B0aW1pemVkPW5ldyBTZXQ7fWFkZEVudGl0eVRvQmVEZW9wdGltaXplZChlKXtpZihlPT09cmUpe2lmKCF0aGlzLmVudGl0aWVzVG9CZURlb3B0aW1pemVkLmhhcyhyZSkpe3RoaXMuZW50aXRpZXNUb0JlRGVvcHRpbWl6ZWQuYWRkKHJlKTtmb3IoY29uc3R7aW50ZXJhY3Rpb246ZX1vZiB0aGlzLmRlb3B0aW1pemF0aW9uSW50ZXJhY3Rpb25zKWFlKGUpO3RoaXMuZGVvcHRpbWl6YXRpb25JbnRlcmFjdGlvbnM9d2k7fX1lbHNlIGlmKHRoaXMuZGVvcHRpbWl6ZWRGaWVsZHMuaGFzKEcpKWUuZGVvcHRpbWl6ZVBhdGgoWSk7ZWxzZSBpZighdGhpcy5lbnRpdGllc1RvQmVEZW9wdGltaXplZC5oYXMoZSkpe3RoaXMuZW50aXRpZXNUb0JlRGVvcHRpbWl6ZWQuYWRkKGUpO2Zvcihjb25zdCB0IG9mIHRoaXMuZGVvcHRpbWl6ZWRGaWVsZHMpZS5kZW9wdGltaXplUGF0aChbdF0pO2Zvcihjb25zdHtpbnRlcmFjdGlvbjp0LHBhdGg6c31vZiB0aGlzLmRlb3B0aW1pemF0aW9uSW50ZXJhY3Rpb25zKWUuZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgodCxzLGVlKTt9fWRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCl7aWYodC5sZW5ndGg+PTJ8fHRoaXMuZW50aXRpZXNUb0JlRGVvcHRpbWl6ZWQuaGFzKHJlKXx8dGhpcy5kZW9wdGltaXphdGlvbkludGVyYWN0aW9ucy5sZW5ndGg+PTIwfHwxPT09dC5sZW5ndGgmJih0aGlzLmRlb3B0aW1pemVkRmllbGRzLmhhcyhHKXx8Mj09PWUudHlwZSYmdGhpcy5kZW9wdGltaXplZEZpZWxkcy5oYXModFswXSkpKWFlKGUpO2Vsc2UgaWYoIXRoaXMuZGVvcHRpbWl6YXRpb25zLnRyYWNrRW50aXR5QXRQYXRoQW5kR2V0SWZUcmFja2VkKHQsZS5hcmdzKSl7Zm9yKGNvbnN0IHMgb2YgdGhpcy5lbnRpdGllc1RvQmVEZW9wdGltaXplZClzLmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxlZSk7dGhpcy5lbnRpdGllc1RvQmVEZW9wdGltaXplZC5oYXMocmUpfHx0aGlzLmRlb3B0aW1pemF0aW9uSW50ZXJhY3Rpb25zLnB1c2goe2ludGVyYWN0aW9uOmUscGF0aDp0fSk7fX1kZW9wdGltaXplUGF0aChlKXtpZigwPT09ZS5sZW5ndGh8fHRoaXMuZGVvcHRpbWl6ZWRGaWVsZHMuaGFzKEcpKXJldHVybjtjb25zdCB0PWVbMF07aWYoIXRoaXMuZGVvcHRpbWl6ZWRGaWVsZHMuaGFzKHQpKXt0aGlzLmRlb3B0aW1pemVkRmllbGRzLmFkZCh0KTtmb3IoY29uc3QgdCBvZiB0aGlzLmVudGl0aWVzVG9CZURlb3B0aW1pemVkKXQuZGVvcHRpbWl6ZVBhdGgoZSk7dD09PUcmJih0aGlzLmRlb3B0aW1pemF0aW9uSW50ZXJhY3Rpb25zPXdpLHRoaXMuZGVvcHRpbWl6YXRpb25zPUNpLHRoaXMuZGVvcHRpbWl6ZWRGaWVsZHM9UGksdGhpcy5lbnRpdGllc1RvQmVEZW9wdGltaXplZD0kaSk7fX1nZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChlKXtyZXR1cm4gMD09PWUubGVuZ3RoP3RoaXMuZGVvcHRpbWl6ZVBhdGgoWSk6dGhpcy5kZW9wdGltaXplZEZpZWxkcy5oYXMoZVswXSl8fHRoaXMuZGVvcHRpbWl6ZVBhdGgoW2VbMF1dKSxvZX19Y29uc3QgX2k9IjAxMjM0NTY3ODlhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ekFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaXyQiLFJpPTY0O2Z1bmN0aW9uIE1pKGUpe2xldCB0PSIiO2Rve2NvbnN0IHM9ZSVSaTtlPWUvUml8MCx0PV9pW3NdK3Q7fXdoaWxlKDAhPT1lKTtyZXR1cm4gdH1mdW5jdGlvbiBPaShlLHQscyl7bGV0IGk9ZSxuPTE7Zm9yKDt0LmhhcyhpKXx8eWUuaGFzKGkpfHxzPy5oYXMoaSk7KWk9YCR7ZX0kJHtNaShuKyspfWA7cmV0dXJuIHQuYWRkKGkpLGl9bGV0IERpPWNsYXNze2NvbnN0cnVjdG9yKCl7dGhpcy5jaGlsZHJlbj1bXSx0aGlzLnZhcmlhYmxlcz1uZXcgTWFwO31hZGREZWNsYXJhdGlvbihlLHQscyxpKXtjb25zdCBuPWUubmFtZTtsZXQgcj10aGlzLnZhcmlhYmxlcy5nZXQobik7cmV0dXJuIHI/ci5hZGREZWNsYXJhdGlvbihlLHMpOihyPW5ldyBJaShlLm5hbWUsZSxzfHxpcyx0KSx0aGlzLnZhcmlhYmxlcy5zZXQobixyKSkscn1jb250YWlucyhlKXtyZXR1cm4gdGhpcy52YXJpYWJsZXMuaGFzKGUpfWZpbmRWYXJpYWJsZShlKXt0aHJvdyBuZXcgRXJyb3IoIkludGVybmFsIEVycm9yOiBmaW5kVmFyaWFibGUgbmVlZHMgdG8gYmUgaW1wbGVtZW50ZWQgYnkgYSBzdWJjbGFzcyIpfX07Y2xhc3MgTGkgZXh0ZW5kcyBEaXtjb25zdHJ1Y3RvcihlKXtzdXBlcigpLHRoaXMuYWNjZXNzZWRPdXRzaWRlVmFyaWFibGVzPW5ldyBNYXAsdGhpcy5wYXJlbnQ9ZSxlLmNoaWxkcmVuLnB1c2godGhpcyk7fWFkZEFjY2Vzc2VkRHluYW1pY0ltcG9ydChlKXsodGhpcy5hY2Nlc3NlZER5bmFtaWNJbXBvcnRzfHwodGhpcy5hY2Nlc3NlZER5bmFtaWNJbXBvcnRzPW5ldyBTZXQpKS5hZGQoZSksdGhpcy5wYXJlbnQgaW5zdGFuY2VvZiBMaSYmdGhpcy5wYXJlbnQuYWRkQWNjZXNzZWREeW5hbWljSW1wb3J0KGUpO31hZGRBY2Nlc3NlZEdsb2JhbHMoZSx0KXtjb25zdCBzPXQuZ2V0KHRoaXMpfHxuZXcgU2V0O2Zvcihjb25zdCB0IG9mIGUpcy5hZGQodCk7dC5zZXQodGhpcyxzKSx0aGlzLnBhcmVudCBpbnN0YW5jZW9mIExpJiZ0aGlzLnBhcmVudC5hZGRBY2Nlc3NlZEdsb2JhbHMoZSx0KTt9YWRkTmFtZXNwYWNlTWVtYmVyQWNjZXNzKGUsdCl7dGhpcy5hY2Nlc3NlZE91dHNpZGVWYXJpYWJsZXMuc2V0KGUsdCksdGhpcy5wYXJlbnQuYWRkTmFtZXNwYWNlTWVtYmVyQWNjZXNzKGUsdCk7fWFkZFJldHVybkV4cHJlc3Npb24oZSl7dGhpcy5wYXJlbnQgaW5zdGFuY2VvZiBMaSYmdGhpcy5wYXJlbnQuYWRkUmV0dXJuRXhwcmVzc2lvbihlKTt9YWRkVXNlZE91dHNpZGVOYW1lcyhlLHQscyxpKXtmb3IoY29uc3QgaSBvZiB0aGlzLmFjY2Vzc2VkT3V0c2lkZVZhcmlhYmxlcy52YWx1ZXMoKSlpLmluY2x1ZGVkJiYoZS5hZGQoaS5nZXRCYXNlVmFyaWFibGVOYW1lKCkpLCJzeXN0ZW0iPT09dCYmcy5oYXMoaSkmJmUuYWRkKCJleHBvcnRzIikpO2NvbnN0IG49aS5nZXQodGhpcyk7aWYobilmb3IoY29uc3QgdCBvZiBuKWUuYWRkKHQpO31jb250YWlucyhlKXtyZXR1cm4gdGhpcy52YXJpYWJsZXMuaGFzKGUpfHx0aGlzLnBhcmVudC5jb250YWlucyhlKX1kZWNvbmZsaWN0KGUsdCxzKXtjb25zdCBpPW5ldyBTZXQ7aWYodGhpcy5hZGRVc2VkT3V0c2lkZU5hbWVzKGksZSx0LHMpLHRoaXMuYWNjZXNzZWREeW5hbWljSW1wb3J0cylmb3IoY29uc3QgZSBvZiB0aGlzLmFjY2Vzc2VkRHluYW1pY0ltcG9ydHMpZS5pbmxpbmVOYW1lc3BhY2UmJmkuYWRkKGUuaW5saW5lTmFtZXNwYWNlLmdldEJhc2VWYXJpYWJsZU5hbWUoKSk7Zm9yKGNvbnN0W2UsdF1vZiB0aGlzLnZhcmlhYmxlcykodC5pbmNsdWRlZHx8dC5hbHdheXNSZW5kZXJlZCkmJnQuc2V0UmVuZGVyTmFtZXMobnVsbCxPaShlLGksdC5mb3JiaWRkZW5OYW1lcykpO2Zvcihjb25zdCBpIG9mIHRoaXMuY2hpbGRyZW4paS5kZWNvbmZsaWN0KGUsdCxzKTt9ZmluZExleGljYWxCb3VuZGFyeSgpe3JldHVybiB0aGlzLnBhcmVudC5maW5kTGV4aWNhbEJvdW5kYXJ5KCl9ZmluZFZhcmlhYmxlKGUpe2NvbnN0IHQ9dGhpcy52YXJpYWJsZXMuZ2V0KGUpfHx0aGlzLmFjY2Vzc2VkT3V0c2lkZVZhcmlhYmxlcy5nZXQoZSk7aWYodClyZXR1cm4gdDtjb25zdCBzPXRoaXMucGFyZW50LmZpbmRWYXJpYWJsZShlKTtyZXR1cm4gdGhpcy5hY2Nlc3NlZE91dHNpZGVWYXJpYWJsZXMuc2V0KGUscyksc319Y2xhc3MgVGkgZXh0ZW5kcyBMaXtjb25zdHJ1Y3RvcihlLHQpe3N1cGVyKGUpLHRoaXMucGFyYW1ldGVycz1bXSx0aGlzLmhhc1Jlc3Q9ITEsdGhpcy5jb250ZXh0PXQsdGhpcy5ob2lzdGVkQm9keVZhclNjb3BlPW5ldyBMaSh0aGlzKTt9YWRkUGFyYW1ldGVyRGVjbGFyYXRpb24oZSl7Y29uc3R7bmFtZTp0fT1lLHM9bmV3IE5pKHQsZSx0aGlzLmNvbnRleHQpLGk9dGhpcy5ob2lzdGVkQm9keVZhclNjb3BlLnZhcmlhYmxlcy5nZXQodCk7cmV0dXJuIGkmJih0aGlzLmhvaXN0ZWRCb2R5VmFyU2NvcGUudmFyaWFibGVzLnNldCh0LHMpLHMubWVyZ2VEZWNsYXJhdGlvbnMoaSkpLHRoaXMudmFyaWFibGVzLnNldCh0LHMpLHN9YWRkUGFyYW1ldGVyVmFyaWFibGVzKGUsdCl7dGhpcy5wYXJhbWV0ZXJzPWU7Zm9yKGNvbnN0IHQgb2YgZSlmb3IoY29uc3QgZSBvZiB0KWUuYWx3YXlzUmVuZGVyZWQ9ITA7dGhpcy5oYXNSZXN0PXQ7fWluY2x1ZGVDYWxsQXJndW1lbnRzKGUsdCl7bGV0IHM9ITEsaT0hMTtjb25zdCBuPXRoaXMuaGFzUmVzdCYmdGhpcy5wYXJhbWV0ZXJzW3RoaXMucGFyYW1ldGVycy5sZW5ndGgtMV07Zm9yKGNvbnN0IHMgb2YgdClpZihzIGluc3RhbmNlb2YgSnMpe2Zvcihjb25zdCBzIG9mIHQpcy5pbmNsdWRlKGUsITEpO2JyZWFrfWZvcihsZXQgcj10Lmxlbmd0aC0xO3I+PTA7ci0tKXtjb25zdCBvPXRoaXMucGFyYW1ldGVyc1tyXXx8bixhPXRbcl07aWYobylpZihzPSExLDA9PT1vLmxlbmd0aClpPSEwO2Vsc2UgZm9yKGNvbnN0IGUgb2YgbyllLmluY2x1ZGVkJiYoaT0hMCksZS5jYWxsZWRGcm9tVHJ5U3RhdGVtZW50JiYocz0hMCk7IWkmJmEuc2hvdWxkQmVJbmNsdWRlZChlKSYmKGk9ITApLGkmJmEuaW5jbHVkZShlLHMpO319fWNsYXNzIFZpIGV4dGVuZHMgVGl7Y29uc3RydWN0b3IoKXtzdXBlciguLi5hcmd1bWVudHMpLHRoaXMucmV0dXJuRXhwcmVzc2lvbj1udWxsLHRoaXMucmV0dXJuRXhwcmVzc2lvbnM9W107fWFkZFJldHVybkV4cHJlc3Npb24oZSl7dGhpcy5yZXR1cm5FeHByZXNzaW9ucy5wdXNoKGUpO31nZXRSZXR1cm5FeHByZXNzaW9uKCl7cmV0dXJuIG51bGw9PT10aGlzLnJldHVybkV4cHJlc3Npb24mJnRoaXMudXBkYXRlUmV0dXJuRXhwcmVzc2lvbigpLHRoaXMucmV0dXJuRXhwcmVzc2lvbn11cGRhdGVSZXR1cm5FeHByZXNzaW9uKCl7aWYoMT09PXRoaXMucmV0dXJuRXhwcmVzc2lvbnMubGVuZ3RoKXRoaXMucmV0dXJuRXhwcmVzc2lvbj10aGlzLnJldHVybkV4cHJlc3Npb25zWzBdO2Vsc2Uge3RoaXMucmV0dXJuRXhwcmVzc2lvbj1yZTtmb3IoY29uc3QgZSBvZiB0aGlzLnJldHVybkV4cHJlc3Npb25zKWUuZGVvcHRpbWl6ZVBhdGgoWSk7fX19ZnVuY3Rpb24gQmkoZSx0KXtpZigiTWVtYmVyRXhwcmVzc2lvbiI9PT1lLnR5cGUpcmV0dXJuICFlLmNvbXB1dGVkJiZCaShlLm9iamVjdCxlKTtpZigiSWRlbnRpZmllciI9PT1lLnR5cGUpe2lmKCF0KXJldHVybiAhMDtzd2l0Y2godC50eXBlKXtjYXNlIk1lbWJlckV4cHJlc3Npb24iOnJldHVybiB0LmNvbXB1dGVkfHxlPT09dC5vYmplY3Q7Y2FzZSJNZXRob2REZWZpbml0aW9uIjpyZXR1cm4gdC5jb21wdXRlZDtjYXNlIlByb3BlcnR5RGVmaW5pdGlvbiI6Y2FzZSJQcm9wZXJ0eSI6cmV0dXJuIHQuY29tcHV0ZWR8fGU9PT10LnZhbHVlO2Nhc2UiRXhwb3J0U3BlY2lmaWVyIjpjYXNlIkltcG9ydFNwZWNpZmllciI6cmV0dXJuIGU9PT10LmxvY2FsO2Nhc2UiTGFiZWxlZFN0YXRlbWVudCI6Y2FzZSJCcmVha1N0YXRlbWVudCI6Y2FzZSJDb250aW51ZVN0YXRlbWVudCI6cmV0dXJuICExO2RlZmF1bHQ6cmV0dXJuICEwfX1yZXR1cm4gITF9Y29uc3Qgemk9U3ltYm9sKCJQdXJlRnVuY3Rpb24iKSxGaT0oKT0+e30samk9U3ltYm9sKCJWYWx1ZSBQcm9wZXJ0aWVzIiksVWk9KCk9PmllLEdpPSgpPT4hMCxXaT17ZGVvcHRpbWl6ZUFyZ3VtZW50c09uQ2FsbDpGaSxnZXRMaXRlcmFsVmFsdWU6VWksaGFzRWZmZWN0c1doZW5DYWxsZWQ6KCk9PiExfSxxaT17ZGVvcHRpbWl6ZUFyZ3VtZW50c09uQ2FsbDpGaSxnZXRMaXRlcmFsVmFsdWU6VWksaGFzRWZmZWN0c1doZW5DYWxsZWQ6R2l9LEhpPXtfX3Byb3RvX186bnVsbCxbamldOnFpfSxLaT17X19wcm90b19fOm51bGwsW2ppXTpXaX0sWWk9e19fcHJvdG9fXzpudWxsLFtqaV06e2Rlb3B0aW1pemVBcmd1bWVudHNPbkNhbGw6RmksZ2V0TGl0ZXJhbFZhbHVlOlVpLGhhc0VmZmVjdHNXaGVuQ2FsbGVkKHthcmdzOmV9LHQpe2NvbnN0W3MsaV09ZTtyZXR1cm4gIShpIGluc3RhbmNlb2YgbmUpfHxpLmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKFksbGUsdCl9fX0sWGk9e19fcHJvdG9fXzpudWxsLFtqaV06e2Rlb3B0aW1pemVBcmd1bWVudHNPbkNhbGwoe2FyZ3M6WyxlXX0pe2U/LmRlb3B0aW1pemVQYXRoKFkpO30sZ2V0TGl0ZXJhbFZhbHVlOlVpLGhhc0VmZmVjdHNXaGVuQ2FsbGVkOih7YXJnczplfSx0KT0+ZS5sZW5ndGg8PTF8fGVbMV0uaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoWCxjZSx0KX19LFFpPXtfX3Byb3RvX186bnVsbCxbamldOnFpLHByb3RvdHlwZTpIaX0sWmk9e19fcHJvdG9fXzpudWxsLFtqaV06V2kscHJvdG90eXBlOkhpfSxKaT17X19wcm90b19fOm51bGwsW2ppXTp7ZGVvcHRpbWl6ZUFyZ3VtZW50c09uQ2FsbDpGaSxnZXRMaXRlcmFsVmFsdWU6VWksaGFzRWZmZWN0c1doZW5DYWxsZWQ6KHthcmdzOmV9KT0+ZS5sZW5ndGg+MSYmIShlWzFdaW5zdGFuY2VvZiBBaSl9LHByb3RvdHlwZTpIaX0sZW49e19fcHJvdG9fXzpudWxsLFtqaV06V2ksZnJvbTpIaSxvZjpLaSxwcm90b3R5cGU6SGl9LHRuPXtfX3Byb3RvX186bnVsbCxbamldOldpLHN1cHBvcnRlZExvY2FsZXNPZjpaaX0sc249e2dsb2JhbDpIaSxnbG9iYWxUaGlzOkhpLHNlbGY6SGksd2luZG93OkhpLF9fcHJvdG9fXzpudWxsLFtqaV06cWksQXJyYXk6e19fcHJvdG9fXzpudWxsLFtqaV06cWksZnJvbTpIaSxpc0FycmF5OktpLG9mOktpLHByb3RvdHlwZTpIaX0sQXJyYXlCdWZmZXI6e19fcHJvdG9fXzpudWxsLFtqaV06V2ksaXNWaWV3OktpLHByb3RvdHlwZTpIaX0sQXRvbWljczpIaSxCaWdJbnQ6UWksQmlnSW50NjRBcnJheTpRaSxCaWdVaW50NjRBcnJheTpRaSxCb29sZWFuOlppLGNvbnN0cnVjdG9yOlFpLERhdGFWaWV3OlppLERhdGU6e19fcHJvdG9fXzpudWxsLFtqaV06V2ksbm93OktpLHBhcnNlOktpLHByb3RvdHlwZTpIaSxVVEM6S2l9LGRlY29kZVVSSTpLaSxkZWNvZGVVUklDb21wb25lbnQ6S2ksZW5jb2RlVVJJOktpLGVuY29kZVVSSUNvbXBvbmVudDpLaSxFcnJvcjpaaSxlc2NhcGU6S2ksZXZhbDpIaSxFdmFsRXJyb3I6WmksRmxvYXQzMkFycmF5OmVuLEZsb2F0NjRBcnJheTplbixGdW5jdGlvbjpRaSxoYXNPd25Qcm9wZXJ0eTpIaSxJbmZpbml0eTpIaSxJbnQxNkFycmF5OmVuLEludDMyQXJyYXk6ZW4sSW50OEFycmF5OmVuLGlzRmluaXRlOktpLGlzTmFOOktpLGlzUHJvdG90eXBlT2Y6SGksSlNPTjpIaSxNYXA6SmksTWF0aDp7X19wcm90b19fOm51bGwsW2ppXTpxaSxhYnM6S2ksYWNvczpLaSxhY29zaDpLaSxhc2luOktpLGFzaW5oOktpLGF0YW46S2ksYXRhbjI6S2ksYXRhbmg6S2ksY2JydDpLaSxjZWlsOktpLGNsejMyOktpLGNvczpLaSxjb3NoOktpLGV4cDpLaSxleHBtMTpLaSxmbG9vcjpLaSxmcm91bmQ6S2ksaHlwb3Q6S2ksaW11bDpLaSxsb2c6S2ksbG9nMTA6S2ksbG9nMXA6S2ksbG9nMjpLaSxtYXg6S2ksbWluOktpLHBvdzpLaSxyYW5kb206S2kscm91bmQ6S2ksc2lnbjpLaSxzaW46S2ksc2luaDpLaSxzcXJ0OktpLHRhbjpLaSx0YW5oOktpLHRydW5jOktpfSxOYU46SGksTnVtYmVyOntfX3Byb3RvX186bnVsbCxbamldOldpLGlzRmluaXRlOktpLGlzSW50ZWdlcjpLaSxpc05hTjpLaSxpc1NhZmVJbnRlZ2VyOktpLHBhcnNlRmxvYXQ6S2kscGFyc2VJbnQ6S2kscHJvdG90eXBlOkhpfSxPYmplY3Q6e19fcHJvdG9fXzpudWxsLFtqaV06V2ksY3JlYXRlOktpLGRlZmluZVByb3BlcnR5OlhpLGRlZmluZVByb3BlcnRpZXM6WGksZnJlZXplOlhpLGdldE93blByb3BlcnR5RGVzY3JpcHRvcjpLaSxnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzOktpLGdldE93blByb3BlcnR5TmFtZXM6S2ksZ2V0T3duUHJvcGVydHlTeW1ib2xzOktpLGdldFByb3RvdHlwZU9mOktpLGhhc093bjpLaSxpczpLaSxpc0V4dGVuc2libGU6S2ksaXNGcm96ZW46S2ksaXNTZWFsZWQ6S2ksa2V5czpLaSxmcm9tRW50cmllczpIaSxlbnRyaWVzOllpLHZhbHVlczpZaSxwcm90b3R5cGU6SGl9LHBhcnNlRmxvYXQ6S2kscGFyc2VJbnQ6S2ksUHJvbWlzZTp7X19wcm90b19fOm51bGwsW2ppXTpxaSxhbGw6SGksYWxsU2V0dGxlZDpIaSxhbnk6SGkscHJvdG90eXBlOkhpLHJhY2U6SGkscmVqZWN0OkhpLHJlc29sdmU6SGl9LHByb3BlcnR5SXNFbnVtZXJhYmxlOkhpLFByb3h5OkhpLFJhbmdlRXJyb3I6WmksUmVmZXJlbmNlRXJyb3I6WmksUmVmbGVjdDpIaSxSZWdFeHA6WmksU2V0OkppLFNoYXJlZEFycmF5QnVmZmVyOlFpLFN0cmluZzp7X19wcm90b19fOm51bGwsW2ppXTpXaSxmcm9tQ2hhckNvZGU6S2ksZnJvbUNvZGVQb2ludDpLaSxwcm90b3R5cGU6SGkscmF3OktpfSxTeW1ib2w6e19fcHJvdG9fXzpudWxsLFtqaV06V2ksZm9yOktpLGtleUZvcjpLaSxwcm90b3R5cGU6SGksdG9TdHJpbmdUYWc6e19fcHJvdG9fXzpudWxsLFtqaV06e2Rlb3B0aW1pemVBcmd1bWVudHNPbkNhbGw6RmksZ2V0TGl0ZXJhbFZhbHVlOigpPT5ILGhhc0VmZmVjdHNXaGVuQ2FsbGVkOkdpfX19LFN5bnRheEVycm9yOlppLHRvTG9jYWxlU3RyaW5nOkhpLHRvU3RyaW5nOkhpLFR5cGVFcnJvcjpaaSxVaW50MTZBcnJheTplbixVaW50MzJBcnJheTplbixVaW50OEFycmF5OmVuLFVpbnQ4Q2xhbXBlZEFycmF5OmVuLHVuZXNjYXBlOktpLFVSSUVycm9yOlppLHZhbHVlT2Y6SGksV2Vha01hcDpKaSxXZWFrU2V0OkppLGNsZWFySW50ZXJ2YWw6UWksY2xlYXJUaW1lb3V0OlFpLGNvbnNvbGU6e19fcHJvdG9fXzpudWxsLFtqaV06cWksYXNzZXJ0OlFpLGNsZWFyOlFpLGNvdW50OlFpLGNvdW50UmVzZXQ6UWksZGVidWc6UWksZGlyOlFpLGRpcnhtbDpRaSxlcnJvcjpRaSxleGNlcHRpb246UWksZ3JvdXA6UWksZ3JvdXBDb2xsYXBzZWQ6UWksZ3JvdXBFbmQ6UWksaW5mbzpRaSxsb2c6UWksdGFibGU6UWksdGltZTpRaSx0aW1lRW5kOlFpLHRpbWVMb2c6UWksdHJhY2U6UWksd2FybjpRaX0sSW50bDp7X19wcm90b19fOm51bGwsW2ppXTpxaSxDb2xsYXRvcjp0bixEYXRlVGltZUZvcm1hdDp0bixEaXNwbGF5TmFtZXM6dG4sTGlzdEZvcm1hdDp0bixMb2NhbGU6dG4sTnVtYmVyRm9ybWF0OnRuLFBsdXJhbFJ1bGVzOnRuLFJlbGF0aXZlVGltZUZvcm1hdDp0bixTZWdtZW50ZXI6dG59LHNldEludGVydmFsOlFpLHNldFRpbWVvdXQ6UWksVGV4dERlY29kZXI6UWksVGV4dEVuY29kZXI6UWksVVJMOntfX3Byb3RvX186bnVsbCxbamldOnFpLHByb3RvdHlwZTpIaSxjYW5QYXJzZTpLaX0sVVJMU2VhcmNoUGFyYW1zOlFpLEFib3J0Q29udHJvbGxlcjpRaSxBYm9ydFNpZ25hbDpRaSxhZGRFdmVudExpc3RlbmVyOkhpLGFsZXJ0OkhpLEFuYWx5c2VyTm9kZTpRaSxBbmltYXRpb246UWksQW5pbWF0aW9uRXZlbnQ6UWksYXBwbGljYXRpb25DYWNoZTpIaSxBcHBsaWNhdGlvbkNhY2hlOlFpLEFwcGxpY2F0aW9uQ2FjaGVFcnJvckV2ZW50OlFpLGF0b2I6SGksQXR0cjpRaSxBdWRpbzpRaSxBdWRpb0J1ZmZlcjpRaSxBdWRpb0J1ZmZlclNvdXJjZU5vZGU6UWksQXVkaW9Db250ZXh0OlFpLEF1ZGlvRGVzdGluYXRpb25Ob2RlOlFpLEF1ZGlvTGlzdGVuZXI6UWksQXVkaW9Ob2RlOlFpLEF1ZGlvUGFyYW06UWksQXVkaW9Qcm9jZXNzaW5nRXZlbnQ6UWksQXVkaW9TY2hlZHVsZWRTb3VyY2VOb2RlOlFpLEF1ZGlvV29ya2xldE5vZGU6UWksQmFyUHJvcDpRaSxCYXNlQXVkaW9Db250ZXh0OlFpLEJhdHRlcnlNYW5hZ2VyOlFpLEJlZm9yZVVubG9hZEV2ZW50OlFpLEJpcXVhZEZpbHRlck5vZGU6UWksQmxvYjpRaSxCbG9iRXZlbnQ6UWksYmx1cjpIaSxCcm9hZGNhc3RDaGFubmVsOlFpLGJ0b2E6SGksQnl0ZUxlbmd0aFF1ZXVpbmdTdHJhdGVneTpRaSxDYWNoZTpRaSxjYWNoZXM6SGksQ2FjaGVTdG9yYWdlOlFpLGNhbmNlbEFuaW1hdGlvbkZyYW1lOkhpLGNhbmNlbElkbGVDYWxsYmFjazpIaSxDYW52YXNDYXB0dXJlTWVkaWFTdHJlYW1UcmFjazpRaSxDYW52YXNHcmFkaWVudDpRaSxDYW52YXNQYXR0ZXJuOlFpLENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRDpRaSxDaGFubmVsTWVyZ2VyTm9kZTpRaSxDaGFubmVsU3BsaXR0ZXJOb2RlOlFpLENoYXJhY3RlckRhdGE6UWksY2xpZW50SW5mb3JtYXRpb246SGksQ2xpcGJvYXJkRXZlbnQ6UWksY2xvc2U6SGksY2xvc2VkOkhpLENsb3NlRXZlbnQ6UWksQ29tbWVudDpRaSxDb21wb3NpdGlvbkV2ZW50OlFpLGNvbmZpcm06SGksQ29uc3RhbnRTb3VyY2VOb2RlOlFpLENvbnZvbHZlck5vZGU6UWksQ291bnRRdWV1aW5nU3RyYXRlZ3k6UWksY3JlYXRlSW1hZ2VCaXRtYXA6SGksQ3JlZGVudGlhbDpRaSxDcmVkZW50aWFsc0NvbnRhaW5lcjpRaSxjcnlwdG86SGksQ3J5cHRvOlFpLENyeXB0b0tleTpRaSxDU1M6UWksQ1NTQ29uZGl0aW9uUnVsZTpRaSxDU1NGb250RmFjZVJ1bGU6UWksQ1NTR3JvdXBpbmdSdWxlOlFpLENTU0ltcG9ydFJ1bGU6UWksQ1NTS2V5ZnJhbWVSdWxlOlFpLENTU0tleWZyYW1lc1J1bGU6UWksQ1NTTWVkaWFSdWxlOlFpLENTU05hbWVzcGFjZVJ1bGU6UWksQ1NTUGFnZVJ1bGU6UWksQ1NTUnVsZTpRaSxDU1NSdWxlTGlzdDpRaSxDU1NTdHlsZURlY2xhcmF0aW9uOlFpLENTU1N0eWxlUnVsZTpRaSxDU1NTdHlsZVNoZWV0OlFpLENTU1N1cHBvcnRzUnVsZTpRaSxDdXN0b21FbGVtZW50UmVnaXN0cnk6UWksY3VzdG9tRWxlbWVudHM6SGksQ3VzdG9tRXZlbnQ6UWksRGF0YVRyYW5zZmVyOlFpLERhdGFUcmFuc2Zlckl0ZW06UWksRGF0YVRyYW5zZmVySXRlbUxpc3Q6UWksZGVmYXVsdHN0YXR1czpIaSxkZWZhdWx0U3RhdHVzOkhpLERlbGF5Tm9kZTpRaSxEZXZpY2VNb3Rpb25FdmVudDpRaSxEZXZpY2VPcmllbnRhdGlvbkV2ZW50OlFpLGRldmljZVBpeGVsUmF0aW86SGksZGlzcGF0Y2hFdmVudDpIaSxkb2N1bWVudDpIaSxEb2N1bWVudDpRaSxEb2N1bWVudEZyYWdtZW50OlFpLERvY3VtZW50VHlwZTpRaSxET01FcnJvcjpRaSxET01FeGNlcHRpb246UWksRE9NSW1wbGVtZW50YXRpb246UWksRE9NTWF0cml4OlFpLERPTU1hdHJpeFJlYWRPbmx5OlFpLERPTVBhcnNlcjpRaSxET01Qb2ludDpRaSxET01Qb2ludFJlYWRPbmx5OlFpLERPTVF1YWQ6UWksRE9NUmVjdDpRaSxET01SZWN0UmVhZE9ubHk6UWksRE9NU3RyaW5nTGlzdDpRaSxET01TdHJpbmdNYXA6UWksRE9NVG9rZW5MaXN0OlFpLERyYWdFdmVudDpRaSxEeW5hbWljc0NvbXByZXNzb3JOb2RlOlFpLEVsZW1lbnQ6UWksRXJyb3JFdmVudDpRaSxFdmVudDpRaSxFdmVudFNvdXJjZTpRaSxFdmVudFRhcmdldDpRaSxleHRlcm5hbDpIaSxmZXRjaDpIaSxGaWxlOlFpLEZpbGVMaXN0OlFpLEZpbGVSZWFkZXI6UWksZmluZDpIaSxmb2N1czpIaSxGb2N1c0V2ZW50OlFpLEZvbnRGYWNlOlFpLEZvbnRGYWNlU2V0TG9hZEV2ZW50OlFpLEZvcm1EYXRhOlFpLGZyYW1lczpIaSxHYWluTm9kZTpRaSxHYW1lcGFkOlFpLEdhbWVwYWRCdXR0b246UWksR2FtZXBhZEV2ZW50OlFpLGdldENvbXB1dGVkU3R5bGU6SGksZ2V0U2VsZWN0aW9uOkhpLEhhc2hDaGFuZ2VFdmVudDpRaSxIZWFkZXJzOlFpLGhpc3Rvcnk6SGksSGlzdG9yeTpRaSxIVE1MQWxsQ29sbGVjdGlvbjpRaSxIVE1MQW5jaG9yRWxlbWVudDpRaSxIVE1MQXJlYUVsZW1lbnQ6UWksSFRNTEF1ZGlvRWxlbWVudDpRaSxIVE1MQmFzZUVsZW1lbnQ6UWksSFRNTEJvZHlFbGVtZW50OlFpLEhUTUxCUkVsZW1lbnQ6UWksSFRNTEJ1dHRvbkVsZW1lbnQ6UWksSFRNTENhbnZhc0VsZW1lbnQ6UWksSFRNTENvbGxlY3Rpb246UWksSFRNTENvbnRlbnRFbGVtZW50OlFpLEhUTUxEYXRhRWxlbWVudDpRaSxIVE1MRGF0YUxpc3RFbGVtZW50OlFpLEhUTUxEZXRhaWxzRWxlbWVudDpRaSxIVE1MRGlhbG9nRWxlbWVudDpRaSxIVE1MRGlyZWN0b3J5RWxlbWVudDpRaSxIVE1MRGl2RWxlbWVudDpRaSxIVE1MRExpc3RFbGVtZW50OlFpLEhUTUxEb2N1bWVudDpRaSxIVE1MRWxlbWVudDpRaSxIVE1MRW1iZWRFbGVtZW50OlFpLEhUTUxGaWVsZFNldEVsZW1lbnQ6UWksSFRNTEZvbnRFbGVtZW50OlFpLEhUTUxGb3JtQ29udHJvbHNDb2xsZWN0aW9uOlFpLEhUTUxGb3JtRWxlbWVudDpRaSxIVE1MRnJhbWVFbGVtZW50OlFpLEhUTUxGcmFtZVNldEVsZW1lbnQ6UWksSFRNTEhlYWRFbGVtZW50OlFpLEhUTUxIZWFkaW5nRWxlbWVudDpRaSxIVE1MSFJFbGVtZW50OlFpLEhUTUxIdG1sRWxlbWVudDpRaSxIVE1MSUZyYW1lRWxlbWVudDpRaSxIVE1MSW1hZ2VFbGVtZW50OlFpLEhUTUxJbnB1dEVsZW1lbnQ6UWksSFRNTExhYmVsRWxlbWVudDpRaSxIVE1MTGVnZW5kRWxlbWVudDpRaSxIVE1MTElFbGVtZW50OlFpLEhUTUxMaW5rRWxlbWVudDpRaSxIVE1MTWFwRWxlbWVudDpRaSxIVE1MTWFycXVlZUVsZW1lbnQ6UWksSFRNTE1lZGlhRWxlbWVudDpRaSxIVE1MTWVudUVsZW1lbnQ6UWksSFRNTE1ldGFFbGVtZW50OlFpLEhUTUxNZXRlckVsZW1lbnQ6UWksSFRNTE1vZEVsZW1lbnQ6UWksSFRNTE9iamVjdEVsZW1lbnQ6UWksSFRNTE9MaXN0RWxlbWVudDpRaSxIVE1MT3B0R3JvdXBFbGVtZW50OlFpLEhUTUxPcHRpb25FbGVtZW50OlFpLEhUTUxPcHRpb25zQ29sbGVjdGlvbjpRaSxIVE1MT3V0cHV0RWxlbWVudDpRaSxIVE1MUGFyYWdyYXBoRWxlbWVudDpRaSxIVE1MUGFyYW1FbGVtZW50OlFpLEhUTUxQaWN0dXJlRWxlbWVudDpRaSxIVE1MUHJlRWxlbWVudDpRaSxIVE1MUHJvZ3Jlc3NFbGVtZW50OlFpLEhUTUxRdW90ZUVsZW1lbnQ6UWksSFRNTFNjcmlwdEVsZW1lbnQ6UWksSFRNTFNlbGVjdEVsZW1lbnQ6UWksSFRNTFNoYWRvd0VsZW1lbnQ6UWksSFRNTFNsb3RFbGVtZW50OlFpLEhUTUxTb3VyY2VFbGVtZW50OlFpLEhUTUxTcGFuRWxlbWVudDpRaSxIVE1MU3R5bGVFbGVtZW50OlFpLEhUTUxUYWJsZUNhcHRpb25FbGVtZW50OlFpLEhUTUxUYWJsZUNlbGxFbGVtZW50OlFpLEhUTUxUYWJsZUNvbEVsZW1lbnQ6UWksSFRNTFRhYmxlRWxlbWVudDpRaSxIVE1MVGFibGVSb3dFbGVtZW50OlFpLEhUTUxUYWJsZVNlY3Rpb25FbGVtZW50OlFpLEhUTUxUZW1wbGF0ZUVsZW1lbnQ6UWksSFRNTFRleHRBcmVhRWxlbWVudDpRaSxIVE1MVGltZUVsZW1lbnQ6UWksSFRNTFRpdGxlRWxlbWVudDpRaSxIVE1MVHJhY2tFbGVtZW50OlFpLEhUTUxVTGlzdEVsZW1lbnQ6UWksSFRNTFVua25vd25FbGVtZW50OlFpLEhUTUxWaWRlb0VsZW1lbnQ6UWksSURCQ3Vyc29yOlFpLElEQkN1cnNvcldpdGhWYWx1ZTpRaSxJREJEYXRhYmFzZTpRaSxJREJGYWN0b3J5OlFpLElEQkluZGV4OlFpLElEQktleVJhbmdlOlFpLElEQk9iamVjdFN0b3JlOlFpLElEQk9wZW5EQlJlcXVlc3Q6UWksSURCUmVxdWVzdDpRaSxJREJUcmFuc2FjdGlvbjpRaSxJREJWZXJzaW9uQ2hhbmdlRXZlbnQ6UWksSWRsZURlYWRsaW5lOlFpLElJUkZpbHRlck5vZGU6UWksSW1hZ2U6UWksSW1hZ2VCaXRtYXA6UWksSW1hZ2VCaXRtYXBSZW5kZXJpbmdDb250ZXh0OlFpLEltYWdlQ2FwdHVyZTpRaSxJbWFnZURhdGE6UWksaW5kZXhlZERCOkhpLGlubmVySGVpZ2h0OkhpLGlubmVyV2lkdGg6SGksSW5wdXRFdmVudDpRaSxJbnRlcnNlY3Rpb25PYnNlcnZlcjpRaSxJbnRlcnNlY3Rpb25PYnNlcnZlckVudHJ5OlFpLGlzU2VjdXJlQ29udGV4dDpIaSxLZXlib2FyZEV2ZW50OlFpLEtleWZyYW1lRWZmZWN0OlFpLGxlbmd0aDpIaSxsb2NhbFN0b3JhZ2U6SGksbG9jYXRpb246SGksTG9jYXRpb246UWksbG9jYXRpb25iYXI6SGksbWF0Y2hNZWRpYTpIaSxNZWRpYURldmljZUluZm86UWksTWVkaWFEZXZpY2VzOlFpLE1lZGlhRWxlbWVudEF1ZGlvU291cmNlTm9kZTpRaSxNZWRpYUVuY3J5cHRlZEV2ZW50OlFpLE1lZGlhRXJyb3I6UWksTWVkaWFLZXlNZXNzYWdlRXZlbnQ6UWksTWVkaWFLZXlTZXNzaW9uOlFpLE1lZGlhS2V5U3RhdHVzTWFwOlFpLE1lZGlhS2V5U3lzdGVtQWNjZXNzOlFpLE1lZGlhTGlzdDpRaSxNZWRpYVF1ZXJ5TGlzdDpRaSxNZWRpYVF1ZXJ5TGlzdEV2ZW50OlFpLE1lZGlhUmVjb3JkZXI6UWksTWVkaWFTZXR0aW5nc1JhbmdlOlFpLE1lZGlhU291cmNlOlFpLE1lZGlhU3RyZWFtOlFpLE1lZGlhU3RyZWFtQXVkaW9EZXN0aW5hdGlvbk5vZGU6UWksTWVkaWFTdHJlYW1BdWRpb1NvdXJjZU5vZGU6UWksTWVkaWFTdHJlYW1FdmVudDpRaSxNZWRpYVN0cmVhbVRyYWNrOlFpLE1lZGlhU3RyZWFtVHJhY2tFdmVudDpRaSxtZW51YmFyOkhpLE1lc3NhZ2VDaGFubmVsOlFpLE1lc3NhZ2VFdmVudDpRaSxNZXNzYWdlUG9ydDpRaSxNSURJQWNjZXNzOlFpLE1JRElDb25uZWN0aW9uRXZlbnQ6UWksTUlESUlucHV0OlFpLE1JRElJbnB1dE1hcDpRaSxNSURJTWVzc2FnZUV2ZW50OlFpLE1JRElPdXRwdXQ6UWksTUlESU91dHB1dE1hcDpRaSxNSURJUG9ydDpRaSxNaW1lVHlwZTpRaSxNaW1lVHlwZUFycmF5OlFpLE1vdXNlRXZlbnQ6UWksbW92ZUJ5OkhpLG1vdmVUbzpIaSxNdXRhdGlvbkV2ZW50OlFpLE11dGF0aW9uT2JzZXJ2ZXI6UWksTXV0YXRpb25SZWNvcmQ6UWksbmFtZTpIaSxOYW1lZE5vZGVNYXA6UWksTmF2aWdhdGlvblByZWxvYWRNYW5hZ2VyOlFpLG5hdmlnYXRvcjpIaSxOYXZpZ2F0b3I6UWksTmV0d29ya0luZm9ybWF0aW9uOlFpLE5vZGU6UWksTm9kZUZpbHRlcjpIaSxOb2RlSXRlcmF0b3I6UWksTm9kZUxpc3Q6UWksTm90aWZpY2F0aW9uOlFpLE9mZmxpbmVBdWRpb0NvbXBsZXRpb25FdmVudDpRaSxPZmZsaW5lQXVkaW9Db250ZXh0OlFpLG9mZnNjcmVlbkJ1ZmZlcmluZzpIaSxPZmZzY3JlZW5DYW52YXM6UWksb3BlbjpIaSxvcGVuRGF0YWJhc2U6SGksT3B0aW9uOlFpLG9yaWdpbjpIaSxPc2NpbGxhdG9yTm9kZTpRaSxvdXRlckhlaWdodDpIaSxvdXRlcldpZHRoOkhpLFBhZ2VUcmFuc2l0aW9uRXZlbnQ6UWkscGFnZVhPZmZzZXQ6SGkscGFnZVlPZmZzZXQ6SGksUGFubmVyTm9kZTpRaSxwYXJlbnQ6SGksUGF0aDJEOlFpLFBheW1lbnRBZGRyZXNzOlFpLFBheW1lbnRSZXF1ZXN0OlFpLFBheW1lbnRSZXF1ZXN0VXBkYXRlRXZlbnQ6UWksUGF5bWVudFJlc3BvbnNlOlFpLHBlcmZvcm1hbmNlOkhpLFBlcmZvcm1hbmNlOlFpLFBlcmZvcm1hbmNlRW50cnk6UWksUGVyZm9ybWFuY2VMb25nVGFza1RpbWluZzpRaSxQZXJmb3JtYW5jZU1hcms6UWksUGVyZm9ybWFuY2VNZWFzdXJlOlFpLFBlcmZvcm1hbmNlTmF2aWdhdGlvbjpRaSxQZXJmb3JtYW5jZU5hdmlnYXRpb25UaW1pbmc6UWksUGVyZm9ybWFuY2VPYnNlcnZlcjpRaSxQZXJmb3JtYW5jZU9ic2VydmVyRW50cnlMaXN0OlFpLFBlcmZvcm1hbmNlUGFpbnRUaW1pbmc6UWksUGVyZm9ybWFuY2VSZXNvdXJjZVRpbWluZzpRaSxQZXJmb3JtYW5jZVRpbWluZzpRaSxQZXJpb2RpY1dhdmU6UWksUGVybWlzc2lvbnM6UWksUGVybWlzc2lvblN0YXR1czpRaSxwZXJzb25hbGJhcjpIaSxQaG90b0NhcGFiaWxpdGllczpRaSxQbHVnaW46UWksUGx1Z2luQXJyYXk6UWksUG9pbnRlckV2ZW50OlFpLFBvcFN0YXRlRXZlbnQ6UWkscG9zdE1lc3NhZ2U6SGksUHJlc2VudGF0aW9uOlFpLFByZXNlbnRhdGlvbkF2YWlsYWJpbGl0eTpRaSxQcmVzZW50YXRpb25Db25uZWN0aW9uOlFpLFByZXNlbnRhdGlvbkNvbm5lY3Rpb25BdmFpbGFibGVFdmVudDpRaSxQcmVzZW50YXRpb25Db25uZWN0aW9uQ2xvc2VFdmVudDpRaSxQcmVzZW50YXRpb25Db25uZWN0aW9uTGlzdDpRaSxQcmVzZW50YXRpb25SZWNlaXZlcjpRaSxQcmVzZW50YXRpb25SZXF1ZXN0OlFpLHByaW50OkhpLFByb2Nlc3NpbmdJbnN0cnVjdGlvbjpRaSxQcm9ncmVzc0V2ZW50OlFpLFByb21pc2VSZWplY3Rpb25FdmVudDpRaSxwcm9tcHQ6SGksUHVzaE1hbmFnZXI6UWksUHVzaFN1YnNjcmlwdGlvbjpRaSxQdXNoU3Vic2NyaXB0aW9uT3B0aW9uczpRaSxxdWV1ZU1pY3JvdGFzazpIaSxSYWRpb05vZGVMaXN0OlFpLFJhbmdlOlFpLFJlYWRhYmxlU3RyZWFtOlFpLFJlbW90ZVBsYXliYWNrOlFpLHJlbW92ZUV2ZW50TGlzdGVuZXI6SGksUmVxdWVzdDpRaSxyZXF1ZXN0QW5pbWF0aW9uRnJhbWU6SGkscmVxdWVzdElkbGVDYWxsYmFjazpIaSxyZXNpemVCeTpIaSxSZXNpemVPYnNlcnZlcjpRaSxSZXNpemVPYnNlcnZlckVudHJ5OlFpLHJlc2l6ZVRvOkhpLFJlc3BvbnNlOlFpLFJUQ0NlcnRpZmljYXRlOlFpLFJUQ0RhdGFDaGFubmVsOlFpLFJUQ0RhdGFDaGFubmVsRXZlbnQ6UWksUlRDRHRsc1RyYW5zcG9ydDpRaSxSVENJY2VDYW5kaWRhdGU6UWksUlRDSWNlVHJhbnNwb3J0OlFpLFJUQ1BlZXJDb25uZWN0aW9uOlFpLFJUQ1BlZXJDb25uZWN0aW9uSWNlRXZlbnQ6UWksUlRDUnRwUmVjZWl2ZXI6UWksUlRDUnRwU2VuZGVyOlFpLFJUQ1NjdHBUcmFuc3BvcnQ6UWksUlRDU2Vzc2lvbkRlc2NyaXB0aW9uOlFpLFJUQ1N0YXRzUmVwb3J0OlFpLFJUQ1RyYWNrRXZlbnQ6UWksc2NyZWVuOkhpLFNjcmVlbjpRaSxzY3JlZW5MZWZ0OkhpLFNjcmVlbk9yaWVudGF0aW9uOlFpLHNjcmVlblRvcDpIaSxzY3JlZW5YOkhpLHNjcmVlblk6SGksU2NyaXB0UHJvY2Vzc29yTm9kZTpRaSxzY3JvbGw6SGksc2Nyb2xsYmFyczpIaSxzY3JvbGxCeTpIaSxzY3JvbGxUbzpIaSxzY3JvbGxYOkhpLHNjcm9sbFk6SGksU2VjdXJpdHlQb2xpY3lWaW9sYXRpb25FdmVudDpRaSxTZWxlY3Rpb246UWksU2VydmljZVdvcmtlcjpRaSxTZXJ2aWNlV29ya2VyQ29udGFpbmVyOlFpLFNlcnZpY2VXb3JrZXJSZWdpc3RyYXRpb246UWksc2Vzc2lvblN0b3JhZ2U6SGksU2hhZG93Um9vdDpRaSxTaGFyZWRXb3JrZXI6UWksU291cmNlQnVmZmVyOlFpLFNvdXJjZUJ1ZmZlckxpc3Q6UWksc3BlZWNoU3ludGhlc2lzOkhpLFNwZWVjaFN5bnRoZXNpc0V2ZW50OlFpLFNwZWVjaFN5bnRoZXNpc1V0dGVyYW5jZTpRaSxTdGF0aWNSYW5nZTpRaSxzdGF0dXM6SGksc3RhdHVzYmFyOkhpLFN0ZXJlb1Bhbm5lck5vZGU6UWksc3RvcDpIaSxTdG9yYWdlOlFpLFN0b3JhZ2VFdmVudDpRaSxTdG9yYWdlTWFuYWdlcjpRaSxzdHlsZU1lZGlhOkhpLFN0eWxlU2hlZXQ6UWksU3R5bGVTaGVldExpc3Q6UWksU3VidGxlQ3J5cHRvOlFpLFNWR0FFbGVtZW50OlFpLFNWR0FuZ2xlOlFpLFNWR0FuaW1hdGVkQW5nbGU6UWksU1ZHQW5pbWF0ZWRCb29sZWFuOlFpLFNWR0FuaW1hdGVkRW51bWVyYXRpb246UWksU1ZHQW5pbWF0ZWRJbnRlZ2VyOlFpLFNWR0FuaW1hdGVkTGVuZ3RoOlFpLFNWR0FuaW1hdGVkTGVuZ3RoTGlzdDpRaSxTVkdBbmltYXRlZE51bWJlcjpRaSxTVkdBbmltYXRlZE51bWJlckxpc3Q6UWksU1ZHQW5pbWF0ZWRQcmVzZXJ2ZUFzcGVjdFJhdGlvOlFpLFNWR0FuaW1hdGVkUmVjdDpRaSxTVkdBbmltYXRlZFN0cmluZzpRaSxTVkdBbmltYXRlZFRyYW5zZm9ybUxpc3Q6UWksU1ZHQW5pbWF0ZUVsZW1lbnQ6UWksU1ZHQW5pbWF0ZU1vdGlvbkVsZW1lbnQ6UWksU1ZHQW5pbWF0ZVRyYW5zZm9ybUVsZW1lbnQ6UWksU1ZHQW5pbWF0aW9uRWxlbWVudDpRaSxTVkdDaXJjbGVFbGVtZW50OlFpLFNWR0NsaXBQYXRoRWxlbWVudDpRaSxTVkdDb21wb25lbnRUcmFuc2ZlckZ1bmN0aW9uRWxlbWVudDpRaSxTVkdEZWZzRWxlbWVudDpRaSxTVkdEZXNjRWxlbWVudDpRaSxTVkdEaXNjYXJkRWxlbWVudDpRaSxTVkdFbGVtZW50OlFpLFNWR0VsbGlwc2VFbGVtZW50OlFpLFNWR0ZFQmxlbmRFbGVtZW50OlFpLFNWR0ZFQ29sb3JNYXRyaXhFbGVtZW50OlFpLFNWR0ZFQ29tcG9uZW50VHJhbnNmZXJFbGVtZW50OlFpLFNWR0ZFQ29tcG9zaXRlRWxlbWVudDpRaSxTVkdGRUNvbnZvbHZlTWF0cml4RWxlbWVudDpRaSxTVkdGRURpZmZ1c2VMaWdodGluZ0VsZW1lbnQ6UWksU1ZHRkVEaXNwbGFjZW1lbnRNYXBFbGVtZW50OlFpLFNWR0ZFRGlzdGFudExpZ2h0RWxlbWVudDpRaSxTVkdGRURyb3BTaGFkb3dFbGVtZW50OlFpLFNWR0ZFRmxvb2RFbGVtZW50OlFpLFNWR0ZFRnVuY0FFbGVtZW50OlFpLFNWR0ZFRnVuY0JFbGVtZW50OlFpLFNWR0ZFRnVuY0dFbGVtZW50OlFpLFNWR0ZFRnVuY1JFbGVtZW50OlFpLFNWR0ZFR2F1c3NpYW5CbHVyRWxlbWVudDpRaSxTVkdGRUltYWdlRWxlbWVudDpRaSxTVkdGRU1lcmdlRWxlbWVudDpRaSxTVkdGRU1lcmdlTm9kZUVsZW1lbnQ6UWksU1ZHRkVNb3JwaG9sb2d5RWxlbWVudDpRaSxTVkdGRU9mZnNldEVsZW1lbnQ6UWksU1ZHRkVQb2ludExpZ2h0RWxlbWVudDpRaSxTVkdGRVNwZWN1bGFyTGlnaHRpbmdFbGVtZW50OlFpLFNWR0ZFU3BvdExpZ2h0RWxlbWVudDpRaSxTVkdGRVRpbGVFbGVtZW50OlFpLFNWR0ZFVHVyYnVsZW5jZUVsZW1lbnQ6UWksU1ZHRmlsdGVyRWxlbWVudDpRaSxTVkdGb3JlaWduT2JqZWN0RWxlbWVudDpRaSxTVkdHRWxlbWVudDpRaSxTVkdHZW9tZXRyeUVsZW1lbnQ6UWksU1ZHR3JhZGllbnRFbGVtZW50OlFpLFNWR0dyYXBoaWNzRWxlbWVudDpRaSxTVkdJbWFnZUVsZW1lbnQ6UWksU1ZHTGVuZ3RoOlFpLFNWR0xlbmd0aExpc3Q6UWksU1ZHTGluZWFyR3JhZGllbnRFbGVtZW50OlFpLFNWR0xpbmVFbGVtZW50OlFpLFNWR01hcmtlckVsZW1lbnQ6UWksU1ZHTWFza0VsZW1lbnQ6UWksU1ZHTWF0cml4OlFpLFNWR01ldGFkYXRhRWxlbWVudDpRaSxTVkdNUGF0aEVsZW1lbnQ6UWksU1ZHTnVtYmVyOlFpLFNWR051bWJlckxpc3Q6UWksU1ZHUGF0aEVsZW1lbnQ6UWksU1ZHUGF0dGVybkVsZW1lbnQ6UWksU1ZHUG9pbnQ6UWksU1ZHUG9pbnRMaXN0OlFpLFNWR1BvbHlnb25FbGVtZW50OlFpLFNWR1BvbHlsaW5lRWxlbWVudDpRaSxTVkdQcmVzZXJ2ZUFzcGVjdFJhdGlvOlFpLFNWR1JhZGlhbEdyYWRpZW50RWxlbWVudDpRaSxTVkdSZWN0OlFpLFNWR1JlY3RFbGVtZW50OlFpLFNWR1NjcmlwdEVsZW1lbnQ6UWksU1ZHU2V0RWxlbWVudDpRaSxTVkdTdG9wRWxlbWVudDpRaSxTVkdTdHJpbmdMaXN0OlFpLFNWR1N0eWxlRWxlbWVudDpRaSxTVkdTVkdFbGVtZW50OlFpLFNWR1N3aXRjaEVsZW1lbnQ6UWksU1ZHU3ltYm9sRWxlbWVudDpRaSxTVkdUZXh0Q29udGVudEVsZW1lbnQ6UWksU1ZHVGV4dEVsZW1lbnQ6UWksU1ZHVGV4dFBhdGhFbGVtZW50OlFpLFNWR1RleHRQb3NpdGlvbmluZ0VsZW1lbnQ6UWksU1ZHVGl0bGVFbGVtZW50OlFpLFNWR1RyYW5zZm9ybTpRaSxTVkdUcmFuc2Zvcm1MaXN0OlFpLFNWR1RTcGFuRWxlbWVudDpRaSxTVkdVbml0VHlwZXM6UWksU1ZHVXNlRWxlbWVudDpRaSxTVkdWaWV3RWxlbWVudDpRaSxUYXNrQXR0cmlidXRpb25UaW1pbmc6UWksVGV4dDpRaSxUZXh0RXZlbnQ6UWksVGV4dE1ldHJpY3M6UWksVGV4dFRyYWNrOlFpLFRleHRUcmFja0N1ZTpRaSxUZXh0VHJhY2tDdWVMaXN0OlFpLFRleHRUcmFja0xpc3Q6UWksVGltZVJhbmdlczpRaSx0b29sYmFyOkhpLHRvcDpIaSxUb3VjaDpRaSxUb3VjaEV2ZW50OlFpLFRvdWNoTGlzdDpRaSxUcmFja0V2ZW50OlFpLFRyYW5zaXRpb25FdmVudDpRaSxUcmVlV2Fsa2VyOlFpLFVJRXZlbnQ6UWksVmFsaWRpdHlTdGF0ZTpRaSx2aXN1YWxWaWV3cG9ydDpIaSxWaXN1YWxWaWV3cG9ydDpRaSxWVFRDdWU6UWksV2F2ZVNoYXBlck5vZGU6UWksV2ViQXNzZW1ibHk6SGksV2ViR0wyUmVuZGVyaW5nQ29udGV4dDpRaSxXZWJHTEFjdGl2ZUluZm86UWksV2ViR0xCdWZmZXI6UWksV2ViR0xDb250ZXh0RXZlbnQ6UWksV2ViR0xGcmFtZWJ1ZmZlcjpRaSxXZWJHTFByb2dyYW06UWksV2ViR0xRdWVyeTpRaSxXZWJHTFJlbmRlcmJ1ZmZlcjpRaSxXZWJHTFJlbmRlcmluZ0NvbnRleHQ6UWksV2ViR0xTYW1wbGVyOlFpLFdlYkdMU2hhZGVyOlFpLFdlYkdMU2hhZGVyUHJlY2lzaW9uRm9ybWF0OlFpLFdlYkdMU3luYzpRaSxXZWJHTFRleHR1cmU6UWksV2ViR0xUcmFuc2Zvcm1GZWVkYmFjazpRaSxXZWJHTFVuaWZvcm1Mb2NhdGlvbjpRaSxXZWJHTFZlcnRleEFycmF5T2JqZWN0OlFpLFdlYlNvY2tldDpRaSxXaGVlbEV2ZW50OlFpLFdpbmRvdzpRaSxXb3JrZXI6UWksV3JpdGFibGVTdHJlYW06UWksWE1MRG9jdW1lbnQ6UWksWE1MSHR0cFJlcXVlc3Q6UWksWE1MSHR0cFJlcXVlc3RFdmVudFRhcmdldDpRaSxYTUxIdHRwUmVxdWVzdFVwbG9hZDpRaSxYTUxTZXJpYWxpemVyOlFpLFhQYXRoRXZhbHVhdG9yOlFpLFhQYXRoRXhwcmVzc2lvbjpRaSxYUGF0aFJlc3VsdDpRaSxYU0xUUHJvY2Vzc29yOlFpfTtmb3IoY29uc3QgZSBvZiBbIndpbmRvdyIsImdsb2JhbCIsInNlbGYiLCJnbG9iYWxUaGlzIl0pc25bZV09c247ZnVuY3Rpb24gbm4oZSl7bGV0IHQ9c247Zm9yKGNvbnN0IHMgb2YgZSl7aWYoInN0cmluZyIhPXR5cGVvZiBzKXJldHVybiBudWxsO2lmKHQ9dFtzXSwhdClyZXR1cm4gbnVsbH1yZXR1cm4gdFtqaV19Y2xhc3Mgcm4gZXh0ZW5kcyB1ZXtjb25zdHJ1Y3Rvcigpe3N1cGVyKC4uLmFyZ3VtZW50cyksdGhpcy5pc1JlYXNzaWduZWQ9ITA7fWRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtzd2l0Y2goZS50eXBlKXtjYXNlIDA6Y2FzZSAxOnJldHVybiB2b2lkKG5uKFt0aGlzLm5hbWUsLi4udF0uc2xpY2UoMCwtMSkpfHxzdXBlci5kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscykpO2Nhc2UgMjp7Y29uc3QgaT1ubihbdGhpcy5uYW1lLC4uLnRdKTtyZXR1cm4gdm9pZChpP2kuZGVvcHRpbWl6ZUFyZ3VtZW50c09uQ2FsbChlKTpzdXBlci5kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscykpfX19Z2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUsdCxzKXtjb25zdCBpPW5uKFt0aGlzLm5hbWUsLi4uZV0pO3JldHVybiBpP2kuZ2V0TGl0ZXJhbFZhbHVlKCk6c2V9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3N3aXRjaCh0LnR5cGUpe2Nhc2UgMDpyZXR1cm4gMD09PWUubGVuZ3RoPyJ1bmRlZmluZWQiIT09dGhpcy5uYW1lJiYhbm4oW3RoaXMubmFtZV0pOiFubihbdGhpcy5uYW1lLC4uLmVdLnNsaWNlKDAsLTEpKTtjYXNlIDE6cmV0dXJuICEwO2Nhc2UgMjp7Y29uc3QgaT1ubihbdGhpcy5uYW1lLC4uLmVdKTtyZXR1cm4gIWl8fGkuaGFzRWZmZWN0c1doZW5DYWxsZWQodCxzKX19fX1jb25zdCBvbj17X19wcm90b19fOm51bGwsY2xhc3M6ITAsY29uc3Q6ITAsbGV0OiEwLHZhcjohMH07Y2xhc3MgYW4gZXh0ZW5kcyBac3tjb25zdHJ1Y3Rvcigpe3N1cGVyKC4uLmFyZ3VtZW50cyksdGhpcy52YXJpYWJsZT1udWxsLHRoaXMuaXNURFpBY2Nlc3M9bnVsbDt9YWRkRXhwb3J0ZWRWYXJpYWJsZXMoZSx0KXt0Lmhhcyh0aGlzLnZhcmlhYmxlKSYmZS5wdXNoKHRoaXMudmFyaWFibGUpO31iaW5kKCl7IXRoaXMudmFyaWFibGUmJkJpKHRoaXMsdGhpcy5wYXJlbnQpJiYodGhpcy52YXJpYWJsZT10aGlzLnNjb3BlLmZpbmRWYXJpYWJsZSh0aGlzLm5hbWUpLHRoaXMudmFyaWFibGUuYWRkUmVmZXJlbmNlKHRoaXMpKTt9ZGVjbGFyZShlLHQpe2xldCBzO2NvbnN0e3RyZWVzaGFrZTppfT10aGlzLmNvbnRleHQub3B0aW9ucztzd2l0Y2goZSl7Y2FzZSJ2YXIiOnM9dGhpcy5zY29wZS5hZGREZWNsYXJhdGlvbih0aGlzLHRoaXMuY29udGV4dCx0LCEwKSxpJiZpLmNvcnJlY3RWYXJWYWx1ZUJlZm9yZURlY2xhcmF0aW9uJiZzLm1hcmtJbml0aWFsaXplcnNGb3JEZW9wdGltaXphdGlvbigpO2JyZWFrO2Nhc2UiZnVuY3Rpb24iOmNhc2UibGV0IjpjYXNlImNvbnN0IjpjYXNlImNsYXNzIjpzPXRoaXMuc2NvcGUuYWRkRGVjbGFyYXRpb24odGhpcyx0aGlzLmNvbnRleHQsdCwhMSk7YnJlYWs7Y2FzZSJwYXJhbWV0ZXIiOnM9dGhpcy5zY29wZS5hZGRQYXJhbWV0ZXJEZWNsYXJhdGlvbih0aGlzKTticmVhaztkZWZhdWx0OnRocm93IG5ldyBFcnJvcihgSW50ZXJuYWwgRXJyb3I6IFVuZXhwZWN0ZWQgaWRlbnRpZmllciBraW5kICR7ZX0uYCl9cmV0dXJuIHMua2luZD1lLFt0aGlzLnZhcmlhYmxlPXNdfWRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXt0aGlzLnZhcmlhYmxlLmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKTt9ZGVvcHRpbWl6ZVBhdGgoZSl7MCE9PWUubGVuZ3RofHx0aGlzLnNjb3BlLmNvbnRhaW5zKHRoaXMubmFtZSl8fHRoaXMuZGlzYWxsb3dJbXBvcnRSZWFzc2lnbm1lbnQoKSx0aGlzLnZhcmlhYmxlPy5kZW9wdGltaXplUGF0aChlKTt9Z2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUsdCxzKXtyZXR1cm4gdGhpcy5nZXRWYXJpYWJsZVJlc3BlY3RpbmdURFooKS5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpfWdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUsdCxzLGkpe2NvbnN0W24scl09dGhpcy5nZXRWYXJpYWJsZVJlc3BlY3RpbmdURFooKS5nZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChlLHQscyxpKTtyZXR1cm4gW24scnx8dGhpcy5pc1B1cmVGdW5jdGlvbihlKV19aGFzRWZmZWN0cyhlKXtyZXR1cm4gdGhpcy5kZW9wdGltaXplZHx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLCEoIXRoaXMuaXNQb3NzaWJsZVREWigpfHwidmFyIj09PXRoaXMudmFyaWFibGUua2luZCl8fHRoaXMuY29udGV4dC5vcHRpb25zLnRyZWVzaGFrZS51bmtub3duR2xvYmFsU2lkZUVmZmVjdHMmJnRoaXMudmFyaWFibGUgaW5zdGFuY2VvZiBybiYmIXRoaXMuaXNQdXJlRnVuY3Rpb24oSykmJnRoaXMudmFyaWFibGUuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoSyxsZSxlKX1oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7c3dpdGNoKHQudHlwZSl7Y2FzZSAwOnJldHVybiBudWxsIT09dGhpcy52YXJpYWJsZSYmIXRoaXMuaXNQdXJlRnVuY3Rpb24oZSkmJnRoaXMuZ2V0VmFyaWFibGVSZXNwZWN0aW5nVERaKCkuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpO2Nhc2UgMTpyZXR1cm4gKGUubGVuZ3RoPjA/dGhpcy5nZXRWYXJpYWJsZVJlc3BlY3RpbmdURFooKTp0aGlzLnZhcmlhYmxlKS5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyk7Y2FzZSAyOnJldHVybiAhdGhpcy5pc1B1cmVGdW5jdGlvbihlKSYmdGhpcy5nZXRWYXJpYWJsZVJlc3BlY3RpbmdURFooKS5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl9fWluY2x1ZGUoKXt0aGlzLmRlb3B0aW1pemVkfHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCksdGhpcy5pbmNsdWRlZHx8KHRoaXMuaW5jbHVkZWQ9ITAsbnVsbCE9PXRoaXMudmFyaWFibGUmJnRoaXMuY29udGV4dC5pbmNsdWRlVmFyaWFibGVJbk1vZHVsZSh0aGlzLnZhcmlhYmxlKSk7fWluY2x1ZGVDYWxsQXJndW1lbnRzKGUsdCl7dGhpcy52YXJpYWJsZS5pbmNsdWRlQ2FsbEFyZ3VtZW50cyhlLHQpO31pc1Bvc3NpYmxlVERaKCl7aWYobnVsbCE9PXRoaXMuaXNURFpBY2Nlc3MpcmV0dXJuIHRoaXMuaXNURFpBY2Nlc3M7aWYoISh0aGlzLnZhcmlhYmxlIGluc3RhbmNlb2YgSWkmJnRoaXMudmFyaWFibGUua2luZCYmdGhpcy52YXJpYWJsZS5raW5kIGluIG9uJiZ0aGlzLnZhcmlhYmxlLm1vZHVsZT09PXRoaXMuY29udGV4dC5tb2R1bGUpKXJldHVybiB0aGlzLmlzVERaQWNjZXNzPSExO2xldCBlO3JldHVybiB0aGlzLnZhcmlhYmxlLmRlY2xhcmF0aW9ucyYmMT09PXRoaXMudmFyaWFibGUuZGVjbGFyYXRpb25zLmxlbmd0aCYmKGU9dGhpcy52YXJpYWJsZS5kZWNsYXJhdGlvbnNbMF0pJiZ0aGlzLnN0YXJ0PGUuc3RhcnQmJmxuKHRoaXMpPT09bG4oZSk/dGhpcy5pc1REWkFjY2Vzcz0hMDp0aGlzLnZhcmlhYmxlLmluaXRSZWFjaGVkP3RoaXMuaXNURFpBY2Nlc3M9ITE6dGhpcy5pc1REWkFjY2Vzcz0hMH1tYXJrRGVjbGFyYXRpb25SZWFjaGVkKCl7dGhpcy52YXJpYWJsZS5pbml0UmVhY2hlZD0hMDt9cmVuZGVyKGUse3NuaXBwZXRzOntnZXRQcm9wZXJ0eUFjY2Vzczp0fSx1c2VPcmlnaW5hbE5hbWU6c30se3JlbmRlcmVkUGFyZW50VHlwZTppLGlzQ2FsbGVlT2ZSZW5kZXJlZFBhcmVudDpuLGlzU2hvcnRoYW5kUHJvcGVydHk6cn09cGUpe2lmKHRoaXMudmFyaWFibGUpe2NvbnN0IG89dGhpcy52YXJpYWJsZS5nZXROYW1lKHQscyk7byE9PXRoaXMubmFtZSYmKGUub3ZlcndyaXRlKHRoaXMuc3RhcnQsdGhpcy5lbmQsbyx7Y29udGVudE9ubHk6ITAsc3RvcmVOYW1lOiEwfSksciYmZS5wcmVwZW5kUmlnaHQodGhpcy5zdGFydCxgJHt0aGlzLm5hbWV9OiBgKSksImV2YWwiPT09byYmaT09PUlzJiZuJiZlLmFwcGVuZFJpZ2h0KHRoaXMuc3RhcnQsIjAsICIpO319YXBwbHlEZW9wdGltaXphdGlvbnMoKXt0aGlzLmRlb3B0aW1pemVkPSEwLHRoaXMudmFyaWFibGUgaW5zdGFuY2VvZiBJaSYmKHRoaXMudmFyaWFibGUuY29uc29saWRhdGVJbml0aWFsaXplcnMoKSx0aGlzLmNvbnRleHQucmVxdWVzdFRyZWVzaGFraW5nUGFzcygpKTt9ZGlzYWxsb3dJbXBvcnRSZWFzc2lnbm1lbnQoKXtyZXR1cm4gdGhpcy5jb250ZXh0LmVycm9yKEx0KHRoaXMubmFtZSx0aGlzLmNvbnRleHQubW9kdWxlLmlkKSx0aGlzLnN0YXJ0KX1nZXRWYXJpYWJsZVJlc3BlY3RpbmdURFooKXtyZXR1cm4gdGhpcy5pc1Bvc3NpYmxlVERaKCk/cmU6dGhpcy52YXJpYWJsZX1pc1B1cmVGdW5jdGlvbihlKXtsZXQgdD10aGlzLmNvbnRleHQubWFudWFsUHVyZUZ1bmN0aW9uc1t0aGlzLm5hbWVdO2Zvcihjb25zdCBzIG9mIGUpe2lmKCF0KXJldHVybiAhMTtpZih0W3ppXSlyZXR1cm4gITA7dD10W3NdO31yZXR1cm4gdD8uW3ppXX19ZnVuY3Rpb24gbG4oZSl7Zm9yKDtlJiYhL15Qcm9ncmFtfEZ1bmN0aW9uLy50ZXN0KGUudHlwZSk7KWU9ZS5wYXJlbnQ7cmV0dXJuIGV9ZnVuY3Rpb24gY24oZSx0LHMsaSl7aWYodC5yZW1vdmUocyxpKSxlLmFubm90YXRpb25zKWZvcihjb25zdCBpIG9mIGUuYW5ub3RhdGlvbnMpe2lmKCEoaS5zdGFydDxzKSlyZXR1cm47dC5yZW1vdmUoaS5zdGFydCxpLmVuZCk7fX1mdW5jdGlvbiBobihlLHQpe2lmKGUuYW5ub3RhdGlvbnN8fGUucGFyZW50LnR5cGUhPT1Oc3x8KGU9ZS5wYXJlbnQpLGUuYW5ub3RhdGlvbnMpZm9yKGNvbnN0IHMgb2YgZS5hbm5vdGF0aW9ucyl0LnJlbW92ZShzLnN0YXJ0LHMuZW5kKTt9Y29uc3QgdW49e2lzTm9TdGF0ZW1lbnQ6ITB9O2Z1bmN0aW9uIGRuKGUsdCxzPTApe2xldCBpLG47Zm9yKGk9ZS5pbmRleE9mKHQscyk7Oyl7aWYoLTE9PT0ocz1lLmluZGV4T2YoIi8iLHMpKXx8cz49aSlyZXR1cm4gaTtuPWUuY2hhckNvZGVBdCgrK3MpLCsrcywocz00Nz09PW4/ZS5pbmRleE9mKCJcbiIscykrMTplLmluZGV4T2YoIiovIixzKSsyKT5pJiYoaT1lLmluZGV4T2YodCxzKSk7fX1jb25zdCBwbj0vXFMvZztmdW5jdGlvbiBmbihlLHQpe3BuLmxhc3RJbmRleD10O3JldHVybiBwbi5leGVjKGUpLmluZGV4fWZ1bmN0aW9uIG1uKGUpe2xldCB0LHMsaT0wO2Zvcih0PWUuaW5kZXhPZigiXG4iLGkpOzspe2lmKGk9ZS5pbmRleE9mKCIvIixpKSwtMT09PWl8fGk+dClyZXR1cm4gW3QsdCsxXTtpZihzPWUuY2hhckNvZGVBdChpKzEpLDQ3PT09cylyZXR1cm4gW2ksdCsxXTtpPWUuaW5kZXhPZigiKi8iLGkrMykrMixpPnQmJih0PWUuaW5kZXhPZigiXG4iLGkpKTt9fWZ1bmN0aW9uIGduKGUsdCxzLGksbil7bGV0IHIsbyxhLGwsYz1lWzBdLGg9IWMuaW5jbHVkZWR8fGMubmVlZHNCb3VuZGFyaWVzO2gmJihsPXMrbW4odC5vcmlnaW5hbC5zbGljZShzLGMuc3RhcnQpKVsxXSk7Zm9yKGxldCBzPTE7czw9ZS5sZW5ndGg7cysrKXI9YyxvPWwsYT1oLGM9ZVtzXSxoPXZvaWQgMCE9PWMmJighYy5pbmNsdWRlZHx8Yy5uZWVkc0JvdW5kYXJpZXMpLGF8fGg/KGw9ci5lbmQrbW4odC5vcmlnaW5hbC5zbGljZShyLmVuZCx2b2lkIDA9PT1jP2k6Yy5zdGFydCkpWzFdLHIuaW5jbHVkZWQ/YT9yLnJlbmRlcih0LG4se2VuZDpsLHN0YXJ0Om99KTpyLnJlbmRlcih0LG4pOmNuKHIsdCxvLGwpKTpyLnJlbmRlcih0LG4pO31mdW5jdGlvbiB5bihlLHQscyxpKXtjb25zdCBuPVtdO2xldCByLG8sYSxsLGM9cy0xO2Zvcihjb25zdCBpIG9mIGUpe2Zvcih2b2lkIDAhPT1yJiYoYz1yLmVuZCtkbih0Lm9yaWdpbmFsLnNsaWNlKHIuZW5kLGkuc3RhcnQpLCIsIikpLG89YT1jKzErbW4odC5vcmlnaW5hbC5zbGljZShjKzEsaS5zdGFydCkpWzFdO2w9dC5vcmlnaW5hbC5jaGFyQ29kZUF0KG8pLDMyPT09bHx8OT09PWx8fDEwPT09bHx8MTM9PT1sOylvKys7dm9pZCAwIT09ciYmbi5wdXNoKHtjb250ZW50RW5kOmEsZW5kOm8sbm9kZTpyLHNlcGFyYXRvcjpjLHN0YXJ0OnN9KSxyPWkscz1vO31yZXR1cm4gbi5wdXNoKHtjb250ZW50RW5kOmksZW5kOmksbm9kZTpyLHNlcGFyYXRvcjpudWxsLHN0YXJ0OnN9KSxufWZ1bmN0aW9uIHhuKGUsdCxzKXtmb3IoOzspe2NvbnN0W2ksbl09bW4oZS5vcmlnaW5hbC5zbGljZSh0LHMpKTtpZigtMT09PWkpYnJlYWs7ZS5yZW1vdmUodCtpLHQrPW4pO319Y2xhc3MgRW4gZXh0ZW5kcyBMaXthZGREZWNsYXJhdGlvbihlLHQscyxpKXtpZihpKXtjb25zdCBuPXRoaXMucGFyZW50LmFkZERlY2xhcmF0aW9uKGUsdCxzLGkpO3JldHVybiBuLm1hcmtJbml0aWFsaXplcnNGb3JEZW9wdGltaXphdGlvbigpLG59cmV0dXJuIHN1cGVyLmFkZERlY2xhcmF0aW9uKGUsdCxzLCExKX19Y2xhc3MgYm4gZXh0ZW5kcyBac3tpbml0aWFsaXNlKCl7dmFyIGUsdDt0aGlzLmRpcmVjdGl2ZSYmInVzZSBzdHJpY3QiIT09dGhpcy5kaXJlY3RpdmUmJnRoaXMucGFyZW50LnR5cGU9PT1EcyYmdGhpcy5jb250ZXh0LmxvZyh2ZSwoZT10aGlzLmRpcmVjdGl2ZSx7Y29kZToiTU9EVUxFX0xFVkVMX0RJUkVDVElWRSIsaWQ6dD10aGlzLmNvbnRleHQubW9kdWxlLmlkLG1lc3NhZ2U6YE1vZHVsZSBsZXZlbCBkaXJlY3RpdmVzIGNhdXNlIGVycm9ycyB3aGVuIGJ1bmRsZWQsICIke2V9IiBpbiAiJHtMKHQpfSIgd2FzIGlnbm9yZWQuYH0pLHRoaXMuc3RhcnQpO31yZW5kZXIoZSx0KXtzdXBlci5yZW5kZXIoZSx0KSx0aGlzLmluY2x1ZGVkJiZ0aGlzLmluc2VydFNlbWljb2xvbihlKTt9c2hvdWxkQmVJbmNsdWRlZChlKXtyZXR1cm4gdGhpcy5kaXJlY3RpdmUmJiJ1c2Ugc3RyaWN0IiE9PXRoaXMuZGlyZWN0aXZlP3RoaXMucGFyZW50LnR5cGUhPT1EczpzdXBlci5zaG91bGRCZUluY2x1ZGVkKGUpfWFwcGx5RGVvcHRpbWl6YXRpb25zKCl7fX1jbGFzcyB2biBleHRlbmRzIFpze2NvbnN0cnVjdG9yKCl7c3VwZXIoLi4uYXJndW1lbnRzKSx0aGlzLmRpcmVjdGx5SW5jbHVkZWQ9ITE7fWFkZEltcGxpY2l0UmV0dXJuRXhwcmVzc2lvblRvU2NvcGUoKXtjb25zdCBlPXRoaXMuYm9keVt0aGlzLmJvZHkubGVuZ3RoLTFdO2UmJiJSZXR1cm5TdGF0ZW1lbnQiPT09ZS50eXBlfHx0aGlzLnNjb3BlLmFkZFJldHVybkV4cHJlc3Npb24ocmUpO31jcmVhdGVTY29wZShlKXt0aGlzLnNjb3BlPXRoaXMucGFyZW50LnByZXZlbnRDaGlsZEJsb2NrU2NvcGU/ZTpuZXcgRW4oZSk7fWhhc0VmZmVjdHMoZSl7aWYodGhpcy5kZW9wdGltaXplQm9keSlyZXR1cm4gITA7Zm9yKGNvbnN0IHQgb2YgdGhpcy5ib2R5KXtpZihlLmJyb2tlbkZsb3cpYnJlYWs7aWYodC5oYXNFZmZlY3RzKGUpKXJldHVybiAhMH1yZXR1cm4gITF9aW5jbHVkZShlLHQpe2lmKCF0aGlzLmRlb3B0aW1pemVCb2R5fHwhdGhpcy5kaXJlY3RseUluY2x1ZGVkKXt0aGlzLmluY2x1ZGVkPSEwLHRoaXMuZGlyZWN0bHlJbmNsdWRlZD0hMCx0aGlzLmRlb3B0aW1pemVCb2R5JiYodD0hMCk7Zm9yKGNvbnN0IHMgb2YgdGhpcy5ib2R5KSh0fHxzLnNob3VsZEJlSW5jbHVkZWQoZSkpJiZzLmluY2x1ZGUoZSx0KTt9fWluaXRpYWxpc2UoKXtjb25zdCBlPXRoaXMuYm9keVswXTt0aGlzLmRlb3B0aW1pemVCb2R5PWUgaW5zdGFuY2VvZiBibiYmInVzZSBhc20iPT09ZS5kaXJlY3RpdmU7fXJlbmRlcihlLHQpe3RoaXMuYm9keS5sZW5ndGg+MD9nbih0aGlzLmJvZHksZSx0aGlzLnN0YXJ0KzEsdGhpcy5lbmQtMSx0KTpzdXBlci5yZW5kZXIoZSx0KTt9fWNsYXNzIFNuIGV4dGVuZHMgWnN7Y29uc3RydWN0b3IoKXtzdXBlciguLi5hcmd1bWVudHMpLHRoaXMuZGVjbGFyYXRpb25Jbml0PW51bGw7fWFkZEV4cG9ydGVkVmFyaWFibGVzKGUsdCl7dGhpcy5hcmd1bWVudC5hZGRFeHBvcnRlZFZhcmlhYmxlcyhlLHQpO31kZWNsYXJlKGUsdCl7cmV0dXJuIHRoaXMuZGVjbGFyYXRpb25Jbml0PXQsdGhpcy5hcmd1bWVudC5kZWNsYXJlKGUscmUpfWRlb3B0aW1pemVQYXRoKGUpezA9PT1lLmxlbmd0aCYmdGhpcy5hcmd1bWVudC5kZW9wdGltaXplUGF0aChLKTt9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3JldHVybiBlLmxlbmd0aD4wfHx0aGlzLmFyZ3VtZW50Lmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKEssdCxzKX1tYXJrRGVjbGFyYXRpb25SZWFjaGVkKCl7dGhpcy5hcmd1bWVudC5tYXJrRGVjbGFyYXRpb25SZWFjaGVkKCk7fWFwcGx5RGVvcHRpbWl6YXRpb25zKCl7dGhpcy5kZW9wdGltaXplZD0hMCxudWxsIT09dGhpcy5kZWNsYXJhdGlvbkluaXQmJih0aGlzLmRlY2xhcmF0aW9uSW5pdC5kZW9wdGltaXplUGF0aChbRyxHXSksdGhpcy5jb250ZXh0LnJlcXVlc3RUcmVlc2hha2luZ1Bhc3MoKSk7fX1jbGFzcyBBbiBleHRlbmRzIFpze2NvbnN0cnVjdG9yKCl7c3VwZXIoLi4uYXJndW1lbnRzKSx0aGlzLm9iamVjdEVudGl0eT1udWxsLHRoaXMuZGVvcHRpbWl6ZWRSZXR1cm49ITE7fWRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtpZigyPT09ZS50eXBlKXtjb25zdHtwYXJhbWV0ZXJzOnR9PXRoaXMuc2NvcGUse2FyZ3M6c309ZTtsZXQgaT0hMTtmb3IobGV0IGU9MDtlPHMubGVuZ3RoLTE7ZSsrKXtjb25zdCBuPXRoaXMucGFyYW1zW2VdLHI9c1tlKzFdO2l8fG4gaW5zdGFuY2VvZiBTbj8oaT0hMCxyLmRlb3B0aW1pemVQYXRoKFkpKTpuIGluc3RhbmNlb2YgYW4/KHRbZV1bMF0uYWRkRW50aXR5VG9CZURlb3B0aW1pemVkKHIpLHRoaXMuYWRkQXJndW1lbnRUb0JlRGVvcHRpbWl6ZWQocikpOm4/ci5kZW9wdGltaXplUGF0aChZKTp0aGlzLmFkZEFyZ3VtZW50VG9CZURlb3B0aW1pemVkKHIpO319ZWxzZSB0aGlzLmdldE9iamVjdEVudGl0eSgpLmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKTt9ZGVvcHRpbWl6ZVBhdGgoZSl7dGhpcy5nZXRPYmplY3RFbnRpdHkoKS5kZW9wdGltaXplUGF0aChlKSwxPT09ZS5sZW5ndGgmJmVbMF09PT1HJiZ0aGlzLnNjb3BlLmdldFJldHVybkV4cHJlc3Npb24oKS5kZW9wdGltaXplUGF0aChZKTt9Z2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUsdCxzKXtyZXR1cm4gdGhpcy5nZXRPYmplY3RFbnRpdHkoKS5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpfWdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUsdCxzLGkpe3JldHVybiBlLmxlbmd0aD4wP3RoaXMuZ2V0T2JqZWN0RW50aXR5KCkuZ2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSk6dGhpcy5hc3luYz8odGhpcy5kZW9wdGltaXplZFJldHVybnx8KHRoaXMuZGVvcHRpbWl6ZWRSZXR1cm49ITAsdGhpcy5zY29wZS5nZXRSZXR1cm5FeHByZXNzaW9uKCkuZGVvcHRpbWl6ZVBhdGgoWSksdGhpcy5jb250ZXh0LnJlcXVlc3RUcmVlc2hha2luZ1Bhc3MoKSksb2UpOlt0aGlzLnNjb3BlLmdldFJldHVybkV4cHJlc3Npb24oKSwhMV19aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe2lmKGUubGVuZ3RoPjB8fDIhPT10LnR5cGUpcmV0dXJuIHRoaXMuZ2V0T2JqZWN0RW50aXR5KCkuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpO2lmKHRoaXMuYW5ub3RhdGlvbk5vU2lkZUVmZmVjdHMpcmV0dXJuICExO2lmKHRoaXMuYXN5bmMpe2NvbnN0e3Byb3BlcnR5UmVhZFNpZGVFZmZlY3RzOmV9PXRoaXMuY29udGV4dC5vcHRpb25zLnRyZWVzaGFrZSx0PXRoaXMuc2NvcGUuZ2V0UmV0dXJuRXhwcmVzc2lvbigpO2lmKHQuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoWyJ0aGVuIl0saGUscyl8fGUmJigiYWx3YXlzIj09PWV8fHQuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoWyJ0aGVuIl0sbGUscykpKXJldHVybiAhMH1mb3IoY29uc3QgZSBvZiB0aGlzLnBhcmFtcylpZihlLmhhc0VmZmVjdHMocykpcmV0dXJuICEwO3JldHVybiAhMX1pbmNsdWRlKGUsdCl7dGhpcy5kZW9wdGltaXplZHx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLHRoaXMuaW5jbHVkZWQ9ITA7Y29uc3R7YnJva2VuRmxvdzpzfT1lO2UuYnJva2VuRmxvdz0hMSx0aGlzLmJvZHkuaW5jbHVkZShlLHQpLGUuYnJva2VuRmxvdz1zO31pbmNsdWRlQ2FsbEFyZ3VtZW50cyhlLHQpe3RoaXMuc2NvcGUuaW5jbHVkZUNhbGxBcmd1bWVudHMoZSx0KTt9aW5pdGlhbGlzZSgpe3RoaXMuc2NvcGUuYWRkUGFyYW1ldGVyVmFyaWFibGVzKHRoaXMucGFyYW1zLm1hcCgoZT0+ZS5kZWNsYXJlKCJwYXJhbWV0ZXIiLHJlKSkpLHRoaXMucGFyYW1zW3RoaXMucGFyYW1zLmxlbmd0aC0xXWluc3RhbmNlb2YgU24pLHRoaXMuYm9keSBpbnN0YW5jZW9mIHZuP3RoaXMuYm9keS5hZGRJbXBsaWNpdFJldHVybkV4cHJlc3Npb25Ub1Njb3BlKCk6dGhpcy5zY29wZS5hZGRSZXR1cm5FeHByZXNzaW9uKHRoaXMuYm9keSk7fXBhcnNlTm9kZShlKXtlLmJvZHkudHlwZT09PWtzJiYodGhpcy5ib2R5PW5ldyB2bihlLmJvZHksdGhpcyx0aGlzLnNjb3BlLmhvaXN0ZWRCb2R5VmFyU2NvcGUpKSxzdXBlci5wYXJzZU5vZGUoZSk7fWFkZEFyZ3VtZW50VG9CZURlb3B0aW1pemVkKGUpe31hcHBseURlb3B0aW1pemF0aW9ucygpe319QW4ucHJvdG90eXBlLnByZXZlbnRDaGlsZEJsb2NrU2NvcGU9ITA7Y2xhc3Mga24gZXh0ZW5kcyBBbntjb25zdHJ1Y3Rvcigpe3N1cGVyKC4uLmFyZ3VtZW50cyksdGhpcy5vYmplY3RFbnRpdHk9bnVsbDt9Y3JlYXRlU2NvcGUoZSl7dGhpcy5zY29wZT1uZXcgVmkoZSx0aGlzLmNvbnRleHQpO31oYXNFZmZlY3RzKCl7cmV0dXJuIHRoaXMuZGVvcHRpbWl6ZWR8fHRoaXMuYXBwbHlEZW9wdGltaXphdGlvbnMoKSwhMX1oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7aWYoc3VwZXIuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpKXJldHVybiAhMDtpZih0aGlzLmFubm90YXRpb25Ob1NpZGVFZmZlY3RzKXJldHVybiAhMTtpZigyPT09dC50eXBlKXtjb25zdHtpZ25vcmU6ZSxicm9rZW5GbG93OnR9PXM7aWYocy5pZ25vcmU9e2JyZWFrczohMSxjb250aW51ZXM6ITEsbGFiZWxzOm5ldyBTZXQscmV0dXJuWWllbGQ6ITAsdGhpczohMX0sdGhpcy5ib2R5Lmhhc0VmZmVjdHMocykpcmV0dXJuICEwO3MuaWdub3JlPWUscy5icm9rZW5GbG93PXQ7fXJldHVybiAhMX1pbmNsdWRlKGUsdCl7c3VwZXIuaW5jbHVkZShlLHQpO2Zvcihjb25zdCBzIG9mIHRoaXMucGFyYW1zKXMgaW5zdGFuY2VvZiBhbnx8cy5pbmNsdWRlKGUsdCk7fWdldE9iamVjdEVudGl0eSgpe3JldHVybiBudWxsIT09dGhpcy5vYmplY3RFbnRpdHk/dGhpcy5vYmplY3RFbnRpdHk6dGhpcy5vYmplY3RFbnRpdHk9bmV3IG9pKFtdLGNpKX19ZnVuY3Rpb24gSW4oZSx7ZXhwb3J0TmFtZXNCeVZhcmlhYmxlOnQsc25pcHBldHM6e186cyxnZXRPYmplY3Q6aSxnZXRQcm9wZXJ0eUFjY2VzczpufX0scj0iIil7aWYoMT09PWUubGVuZ3RoJiYxPT09dC5nZXQoZVswXSkubGVuZ3RoKXtjb25zdCBpPWVbMF07cmV0dXJuIGBleHBvcnRzKCcke3QuZ2V0KGkpfScsJHtzfSR7aS5nZXROYW1lKG4pfSR7cn0pYH17Y29uc3Qgcz1bXTtmb3IoY29uc3QgaSBvZiBlKWZvcihjb25zdCBlIG9mIHQuZ2V0KGkpKXMucHVzaChbZSxpLmdldE5hbWUobikrcl0pO3JldHVybiBgZXhwb3J0cygke2kocyx7bGluZUJyZWFrSW5kZW50Om51bGx9KX0pYH19ZnVuY3Rpb24gd24oZSx0LHMsaSx7ZXhwb3J0TmFtZXNCeVZhcmlhYmxlOm4sc25pcHBldHM6e186cn19KXtpLnByZXBlbmRSaWdodCh0LGBleHBvcnRzKCcke24uZ2V0KGUpfScsJHtyfWApLGkuYXBwZW5kTGVmdChzLCIpIik7fWZ1bmN0aW9uIFBuKGUsdCxzLGksbixyKXtjb25zdHtfOm8sZ2V0UHJvcGVydHlBY2Nlc3M6YX09ci5zbmlwcGV0cztuLmFwcGVuZExlZnQocyxgLCR7b30ke0luKFtlXSxyKX0sJHtvfSR7ZS5nZXROYW1lKGEpfWApLGkmJihuLnByZXBlbmRSaWdodCh0LCIoIiksbi5hcHBlbmRMZWZ0KHMsIikiKSk7fWNsYXNzIENuIGV4dGVuZHMgWnN7YWRkRXhwb3J0ZWRWYXJpYWJsZXMoZSx0KXtmb3IoY29uc3QgcyBvZiB0aGlzLnByb3BlcnRpZXMpIlByb3BlcnR5Ij09PXMudHlwZT9zLnZhbHVlLmFkZEV4cG9ydGVkVmFyaWFibGVzKGUsdCk6cy5hcmd1bWVudC5hZGRFeHBvcnRlZFZhcmlhYmxlcyhlLHQpO31kZWNsYXJlKGUsdCl7Y29uc3Qgcz1bXTtmb3IoY29uc3QgaSBvZiB0aGlzLnByb3BlcnRpZXMpcy5wdXNoKC4uLmkuZGVjbGFyZShlLHQpKTtyZXR1cm4gc31kZW9wdGltaXplUGF0aChlKXtpZigwPT09ZS5sZW5ndGgpZm9yKGNvbnN0IHQgb2YgdGhpcy5wcm9wZXJ0aWVzKXQuZGVvcHRpbWl6ZVBhdGgoZSk7fWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtmb3IoY29uc3QgZSBvZiB0aGlzLnByb3BlcnRpZXMpaWYoZS5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChLLHQscykpcmV0dXJuICEwO3JldHVybiAhMX1tYXJrRGVjbGFyYXRpb25SZWFjaGVkKCl7Zm9yKGNvbnN0IGUgb2YgdGhpcy5wcm9wZXJ0aWVzKWUubWFya0RlY2xhcmF0aW9uUmVhY2hlZCgpO319Y2xhc3MgJG4gZXh0ZW5kcyBJaXtjb25zdHJ1Y3RvcihlKXtzdXBlcigiYXJndW1lbnRzIixudWxsLHJlLGUpLHRoaXMuZGVvcHRpbWl6ZWRBcmd1bWVudHM9W107fWFkZEFyZ3VtZW50VG9CZURlb3B0aW1pemVkKGUpe3RoaXMuaW5jbHVkZWQ/ZS5kZW9wdGltaXplUGF0aChZKTp0aGlzLmRlb3B0aW1pemVkQXJndW1lbnRzLnB1c2goZSk7fWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUse3R5cGU6dH0pe3JldHVybiAwIT09dHx8ZS5sZW5ndGg+MX1pbmNsdWRlKCl7c3VwZXIuaW5jbHVkZSgpO2Zvcihjb25zdCBlIG9mIHRoaXMuZGVvcHRpbWl6ZWRBcmd1bWVudHMpZS5kZW9wdGltaXplUGF0aChZKTt0aGlzLmRlb3B0aW1pemVkQXJndW1lbnRzLmxlbmd0aD0wO319Y2xhc3MgTm4gZXh0ZW5kcyBOaXtjb25zdHJ1Y3RvcihlKXtzdXBlcigidGhpcyIsbnVsbCxlKTt9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3JldHVybiAocy5yZXBsYWNlZFZhcmlhYmxlSW5pdHMuZ2V0KHRoaXMpfHxyZSkuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpfX1jbGFzcyBfbiBleHRlbmRzIFZpe2NvbnN0cnVjdG9yKGUsdCl7c3VwZXIoZSx0KSx0aGlzLnZhcmlhYmxlcy5zZXQoImFyZ3VtZW50cyIsdGhpcy5hcmd1bWVudHNWYXJpYWJsZT1uZXcgJG4odCkpLHRoaXMudmFyaWFibGVzLnNldCgidGhpcyIsdGhpcy50aGlzVmFyaWFibGU9bmV3IE5uKHQpKTt9ZmluZExleGljYWxCb3VuZGFyeSgpe3JldHVybiB0aGlzfWluY2x1ZGVDYWxsQXJndW1lbnRzKGUsdCl7aWYoc3VwZXIuaW5jbHVkZUNhbGxBcmd1bWVudHMoZSx0KSx0aGlzLmFyZ3VtZW50c1ZhcmlhYmxlLmluY2x1ZGVkKWZvcihjb25zdCBzIG9mIHQpcy5pbmNsdWRlZHx8cy5pbmNsdWRlKGUsITEpO319Y2xhc3MgUm4gZXh0ZW5kcyBBbntjb25zdHJ1Y3Rvcigpe3N1cGVyKC4uLmFyZ3VtZW50cyksdGhpcy5vYmplY3RFbnRpdHk9bnVsbDt9Y3JlYXRlU2NvcGUoZSl7dGhpcy5zY29wZT1uZXcgX24oZSx0aGlzLmNvbnRleHQpLHRoaXMuY29uc3RydWN0ZWRFbnRpdHk9bmV3IG9pKE9iamVjdC5jcmVhdGUobnVsbCksY2kpLHRoaXMuc2NvcGUudGhpc1ZhcmlhYmxlLmFkZEVudGl0eVRvQmVEZW9wdGltaXplZCh0aGlzLmNvbnN0cnVjdGVkRW50aXR5KTt9ZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3N1cGVyLmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKSwyPT09ZS50eXBlJiYwPT09dC5sZW5ndGgmJmUuYXJnc1swXSYmdGhpcy5zY29wZS50aGlzVmFyaWFibGUuYWRkRW50aXR5VG9CZURlb3B0aW1pemVkKGUuYXJnc1swXSk7fWhhc0VmZmVjdHMoZSl7cmV0dXJuIHRoaXMuZGVvcHRpbWl6ZWR8fHRoaXMuYXBwbHlEZW9wdGltaXphdGlvbnMoKSwhdGhpcy5hbm5vdGF0aW9uTm9TaWRlRWZmZWN0cyYmISF0aGlzLmlkPy5oYXNFZmZlY3RzKGUpfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtpZihzdXBlci5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscykpcmV0dXJuICEwO2lmKHRoaXMuYW5ub3RhdGlvbk5vU2lkZUVmZmVjdHMpcmV0dXJuICExO2lmKDI9PT10LnR5cGUpe2NvbnN0IGU9cy5yZXBsYWNlZFZhcmlhYmxlSW5pdHMuZ2V0KHRoaXMuc2NvcGUudGhpc1ZhcmlhYmxlKTtzLnJlcGxhY2VkVmFyaWFibGVJbml0cy5zZXQodGhpcy5zY29wZS50aGlzVmFyaWFibGUsdC53aXRoTmV3P3RoaXMuY29uc3RydWN0ZWRFbnRpdHk6cmUpO2NvbnN0e2Jyb2tlbkZsb3c6aSxpZ25vcmU6bixyZXBsYWNlZFZhcmlhYmxlSW5pdHM6cn09cztpZihzLmlnbm9yZT17YnJlYWtzOiExLGNvbnRpbnVlczohMSxsYWJlbHM6bmV3IFNldCxyZXR1cm5ZaWVsZDohMCx0aGlzOnQud2l0aE5ld30sdGhpcy5ib2R5Lmhhc0VmZmVjdHMocykpcmV0dXJuICEwO3MuYnJva2VuRmxvdz1pLGU/ci5zZXQodGhpcy5zY29wZS50aGlzVmFyaWFibGUsZSk6ci5kZWxldGUodGhpcy5zY29wZS50aGlzVmFyaWFibGUpLHMuaWdub3JlPW47fXJldHVybiAhMX1pbmNsdWRlKGUsdCl7c3VwZXIuaW5jbHVkZShlLHQpLHRoaXMuaWQ/LmluY2x1ZGUoKTtjb25zdCBzPXRoaXMuc2NvcGUuYXJndW1lbnRzVmFyaWFibGUuaW5jbHVkZWQ7Zm9yKGNvbnN0IGkgb2YgdGhpcy5wYXJhbXMpaSBpbnN0YW5jZW9mIGFuJiYhc3x8aS5pbmNsdWRlKGUsdCk7fWluaXRpYWxpc2UoKXtzdXBlci5pbml0aWFsaXNlKCksdGhpcy5pZD8uZGVjbGFyZSgiZnVuY3Rpb24iLHRoaXMpO31hZGRBcmd1bWVudFRvQmVEZW9wdGltaXplZChlKXt0aGlzLnNjb3BlLmFyZ3VtZW50c1ZhcmlhYmxlLmFkZEFyZ3VtZW50VG9CZURlb3B0aW1pemVkKGUpO31nZXRPYmplY3RFbnRpdHkoKXtyZXR1cm4gbnVsbCE9PXRoaXMub2JqZWN0RW50aXR5P3RoaXMub2JqZWN0RW50aXR5OnRoaXMub2JqZWN0RW50aXR5PW5ldyBvaShbe2tleToicHJvdG90eXBlIixraW5kOiJpbml0Iixwcm9wZXJ0eTpuZXcgb2koW10sY2kpfV0sY2kpfX1jbGFzcyBNbiBleHRlbmRzIFpze2hhc0VmZmVjdHMoKXtyZXR1cm4gdGhpcy5kZW9wdGltaXplZHx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLCEwfWluY2x1ZGUoZSx0KXtpZih0aGlzLmRlb3B0aW1pemVkfHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCksIXRoaXMuaW5jbHVkZWQpe3RoaXMuaW5jbHVkZWQ9ITA7ZTppZighdGhpcy5jb250ZXh0LnVzZXNUb3BMZXZlbEF3YWl0KXtsZXQgZT10aGlzLnBhcmVudDtkb3tpZihlIGluc3RhbmNlb2YgUm58fGUgaW5zdGFuY2VvZiBrbilicmVhayBlfXdoaWxlKGU9ZS5wYXJlbnQpO3RoaXMuY29udGV4dC51c2VzVG9wTGV2ZWxBd2FpdD0hMDt9fXRoaXMuYXJndW1lbnQuaW5jbHVkZShlLHQpO319Y29uc3QgT249eyIhPSI6KGUsdCk9PmUhPXQsIiE9PSI6KGUsdCk9PmUhPT10LCIlIjooZSx0KT0+ZSV0LCImIjooZSx0KT0+ZSZ0LCIqIjooZSx0KT0+ZSp0LCIqKiI6KGUsdCk9PmUqKnQsIisiOihlLHQpPT5lK3QsIi0iOihlLHQpPT5lLXQsIi8iOihlLHQpPT5lL3QsIjwiOihlLHQpPT5lPHQsIjw8IjooZSx0KT0+ZTw8dCwiPD0iOihlLHQpPT5lPD10LCI9PSI6KGUsdCk9PmU9PXQsIj09PSI6KGUsdCk9PmU9PT10LCI+IjooZSx0KT0+ZT50LCI+PSI6KGUsdCk9PmU+PXQsIj4+IjooZSx0KT0+ZT4+dCwiPj4+IjooZSx0KT0+ZT4+PnQsIl4iOihlLHQpPT5lXnQsInwiOihlLHQpPT5lfHR9O2Z1bmN0aW9uIERuKGUsdCxzKXtpZihzLmFyZ3VtZW50cy5sZW5ndGg+MClpZihzLmFyZ3VtZW50c1tzLmFyZ3VtZW50cy5sZW5ndGgtMV0uaW5jbHVkZWQpZm9yKGNvbnN0IGkgb2Ygcy5hcmd1bWVudHMpaS5yZW5kZXIoZSx0KTtlbHNlIHtsZXQgaT1zLmFyZ3VtZW50cy5sZW5ndGgtMjtmb3IoO2k+PTAmJiFzLmFyZ3VtZW50c1tpXS5pbmNsdWRlZDspaS0tO2lmKGk+PTApe2ZvcihsZXQgbj0wO248PWk7bisrKXMuYXJndW1lbnRzW25dLnJlbmRlcihlLHQpO2UucmVtb3ZlKGRuKGUub3JpZ2luYWwsIiwiLHMuYXJndW1lbnRzW2ldLmVuZCkscy5lbmQtMSk7fWVsc2UgZS5yZW1vdmUoZG4oZS5vcmlnaW5hbCwiKCIscy5jYWxsZWUuZW5kKSsxLHMuZW5kLTEpO319Y2xhc3MgTG4gZXh0ZW5kcyBac3tkZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aCgpe31nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSl7cmV0dXJuIGUubGVuZ3RoPjB8fG51bGw9PT10aGlzLnZhbHVlJiYxMTAhPT10aGlzLmNvbnRleHQuY29kZS5jaGFyQ29kZUF0KHRoaXMuc3RhcnQpfHwiYmlnaW50Ij09dHlwZW9mIHRoaXMudmFsdWV8fDQ3PT09dGhpcy5jb250ZXh0LmNvZGUuY2hhckNvZGVBdCh0aGlzLnN0YXJ0KT9zZTp0aGlzLnZhbHVlfWdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUpe3JldHVybiAxIT09ZS5sZW5ndGg/b2U6eHModGhpcy5tZW1iZXJzLGVbMF0pfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtzd2l0Y2godC50eXBlKXtjYXNlIDA6cmV0dXJuIGUubGVuZ3RoPihudWxsPT09dGhpcy52YWx1ZT8wOjEpO2Nhc2UgMTpyZXR1cm4gITA7Y2FzZSAyOnJldHVybiAhISh0aGlzLmluY2x1ZGVkJiZ0aGlzLnZhbHVlIGluc3RhbmNlb2YgUmVnRXhwJiYodGhpcy52YWx1ZS5nbG9iYWx8fHRoaXMudmFsdWUuc3RpY2t5KSl8fCgxIT09ZS5sZW5ndGh8fHlzKHRoaXMubWVtYmVycyxlWzBdLHQscykpfX1pbml0aWFsaXNlKCl7dGhpcy5tZW1iZXJzPWZ1bmN0aW9uKGUpe2lmKGUgaW5zdGFuY2VvZiBSZWdFeHApcmV0dXJuIG1zO3N3aXRjaCh0eXBlb2YgZSl7Y2FzZSJib29sZWFuIjpyZXR1cm4gcHM7Y2FzZSJudW1iZXIiOnJldHVybiBmcztjYXNlInN0cmluZyI6cmV0dXJuIGdzfXJldHVybiBPYmplY3QuY3JlYXRlKG51bGwpfSh0aGlzLnZhbHVlKTt9cGFyc2VOb2RlKGUpe3RoaXMudmFsdWU9ZS52YWx1ZSx0aGlzLnJlZ2V4PWUucmVnZXgsc3VwZXIucGFyc2VOb2RlKGUpO31yZW5kZXIoZSl7InN0cmluZyI9PXR5cGVvZiB0aGlzLnZhbHVlJiZlLmluZGVudEV4Y2x1c2lvblJhbmdlcy5wdXNoKFt0aGlzLnN0YXJ0KzEsdGhpcy5lbmQtMV0pO319ZnVuY3Rpb24gVG4oZSl7cmV0dXJuIGUuY29tcHV0ZWQ/ZnVuY3Rpb24oZSl7aWYoZSBpbnN0YW5jZW9mIExuKXJldHVybiBTdHJpbmcoZS52YWx1ZSk7cmV0dXJuIG51bGx9KGUucHJvcGVydHkpOmUucHJvcGVydHkubmFtZX1mdW5jdGlvbiBWbihlKXtjb25zdCB0PWUucHJvcGVydHlLZXkscz1lLm9iamVjdDtpZigic3RyaW5nIj09dHlwZW9mIHQpe2lmKHMgaW5zdGFuY2VvZiBhbilyZXR1cm4gW3trZXk6cy5uYW1lLHBvczpzLnN0YXJ0fSx7a2V5OnQscG9zOmUucHJvcGVydHkuc3RhcnR9XTtpZihzIGluc3RhbmNlb2YgQm4pe2NvbnN0IGk9Vm4ocyk7cmV0dXJuIGkmJlsuLi5pLHtrZXk6dCxwb3M6ZS5wcm9wZXJ0eS5zdGFydH1dfX1yZXR1cm4gbnVsbH1jbGFzcyBCbiBleHRlbmRzIFpze2NvbnN0cnVjdG9yKCl7c3VwZXIoLi4uYXJndW1lbnRzKSx0aGlzLnZhcmlhYmxlPW51bGwsdGhpcy5hc3NpZ25tZW50RGVvcHRpbWl6ZWQ9ITEsdGhpcy5ib3VuZD0hMSx0aGlzLmV4cHJlc3Npb25zVG9CZURlb3B0aW1pemVkPVtdLHRoaXMuaXNVbmRlZmluZWQ9ITE7fWJpbmQoKXt0aGlzLmJvdW5kPSEwO2NvbnN0IGU9Vm4odGhpcyksdD1lJiZ0aGlzLnNjb3BlLmZpbmRWYXJpYWJsZShlWzBdLmtleSk7aWYodD8uaXNOYW1lc3BhY2Upe2NvbnN0IHM9em4odCxlLnNsaWNlKDEpLHRoaXMuY29udGV4dCk7cz8idW5kZWZpbmVkIj09PXM/dGhpcy5pc1VuZGVmaW5lZD0hMDoodGhpcy52YXJpYWJsZT1zLHRoaXMuc2NvcGUuYWRkTmFtZXNwYWNlTWVtYmVyQWNjZXNzKGZ1bmN0aW9uKGUpe2xldCB0PWVbMF0ua2V5O2ZvcihsZXQgcz0xO3M8ZS5sZW5ndGg7cysrKXQrPSIuIitlW3NdLmtleTtyZXR1cm4gdH0oZSkscykpOnN1cGVyLmJpbmQoKTt9ZWxzZSBzdXBlci5iaW5kKCk7fWRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXt0aGlzLnZhcmlhYmxlP3RoaXMudmFyaWFibGUuZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpOnRoaXMuaXNVbmRlZmluZWR8fCh0Lmxlbmd0aDw3P3RoaXMub2JqZWN0LmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsW3RoaXMuZ2V0UHJvcGVydHlLZXkoKSwuLi50XSxzKTphZShlKSk7fWRlb3B0aW1pemVDYWNoZSgpe2NvbnN0e2V4cHJlc3Npb25zVG9CZURlb3B0aW1pemVkOmUsb2JqZWN0OnR9PXRoaXM7dGhpcy5leHByZXNzaW9uc1RvQmVEZW9wdGltaXplZD1tZSx0aGlzLnByb3BlcnR5S2V5PUcsdC5kZW9wdGltaXplUGF0aChZKTtmb3IoY29uc3QgdCBvZiBlKXQuZGVvcHRpbWl6ZUNhY2hlKCk7fWRlb3B0aW1pemVQYXRoKGUpe2lmKDA9PT1lLmxlbmd0aCYmdGhpcy5kaXNhbGxvd05hbWVzcGFjZVJlYXNzaWdubWVudCgpLHRoaXMudmFyaWFibGUpdGhpcy52YXJpYWJsZS5kZW9wdGltaXplUGF0aChlKTtlbHNlIGlmKCF0aGlzLmlzVW5kZWZpbmVkJiZlLmxlbmd0aDw3KXtjb25zdCB0PXRoaXMuZ2V0UHJvcGVydHlLZXkoKTt0aGlzLm9iamVjdC5kZW9wdGltaXplUGF0aChbdD09PUc/Vzp0LC4uLmVdKTt9fWdldExpdGVyYWxWYWx1ZUF0UGF0aChlLHQscyl7cmV0dXJuIHRoaXMudmFyaWFibGU/dGhpcy52YXJpYWJsZS5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpOnRoaXMuaXNVbmRlZmluZWQ/dm9pZCAwOnRoaXMucHJvcGVydHlLZXkhPT1HJiZlLmxlbmd0aDw3Pyh0aGlzLmV4cHJlc3Npb25zVG9CZURlb3B0aW1pemVkLnB1c2gocyksdGhpcy5vYmplY3QuZ2V0TGl0ZXJhbFZhbHVlQXRQYXRoKFt0aGlzLmdldFByb3BlcnR5S2V5KCksLi4uZV0sdCxzKSk6c2V9Z2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSl7cmV0dXJuIHRoaXMudmFyaWFibGU/dGhpcy52YXJpYWJsZS5nZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChlLHQscyxpKTp0aGlzLmlzVW5kZWZpbmVkP1tpcywhMV06dGhpcy5wcm9wZXJ0eUtleSE9PUcmJmUubGVuZ3RoPDc/KHRoaXMuZXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQucHVzaChpKSx0aGlzLm9iamVjdC5nZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChbdGhpcy5nZXRQcm9wZXJ0eUtleSgpLC4uLmVdLHQscyxpKSk6b2V9aGFzRWZmZWN0cyhlKXtyZXR1cm4gdGhpcy5kZW9wdGltaXplZHx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLHRoaXMucHJvcGVydHkuaGFzRWZmZWN0cyhlKXx8dGhpcy5vYmplY3QuaGFzRWZmZWN0cyhlKXx8dGhpcy5oYXNBY2Nlc3NFZmZlY3QoZSl9aGFzRWZmZWN0c0FzQXNzaWdubWVudFRhcmdldChlLHQpe3JldHVybiB0JiYhdGhpcy5kZW9wdGltaXplZCYmdGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLHRoaXMuYXNzaWdubWVudERlb3B0aW1pemVkfHx0aGlzLmFwcGx5QXNzaWdubWVudERlb3B0aW1pemF0aW9uKCksdGhpcy5wcm9wZXJ0eS5oYXNFZmZlY3RzKGUpfHx0aGlzLm9iamVjdC5oYXNFZmZlY3RzKGUpfHx0JiZ0aGlzLmhhc0FjY2Vzc0VmZmVjdChlKXx8dGhpcy5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChLLHRoaXMuYXNzaWdubWVudEludGVyYWN0aW9uLGUpfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtyZXR1cm4gdGhpcy52YXJpYWJsZT90aGlzLnZhcmlhYmxlLmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKTohIXRoaXMuaXNVbmRlZmluZWR8fCghKGUubGVuZ3RoPDcpfHx0aGlzLm9iamVjdC5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChbdGhpcy5nZXRQcm9wZXJ0eUtleSgpLC4uLmVdLHQscykpfWluY2x1ZGUoZSx0KXt0aGlzLmRlb3B0aW1pemVkfHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCksdGhpcy5pbmNsdWRlUHJvcGVydGllcyhlLHQpO31pbmNsdWRlQXNBc3NpZ25tZW50VGFyZ2V0KGUsdCxzKXt0aGlzLmFzc2lnbm1lbnREZW9wdGltaXplZHx8dGhpcy5hcHBseUFzc2lnbm1lbnREZW9wdGltaXphdGlvbigpLHM/dGhpcy5pbmNsdWRlKGUsdCk6dGhpcy5pbmNsdWRlUHJvcGVydGllcyhlLHQpO31pbmNsdWRlQ2FsbEFyZ3VtZW50cyhlLHQpe3RoaXMudmFyaWFibGU/dGhpcy52YXJpYWJsZS5pbmNsdWRlQ2FsbEFyZ3VtZW50cyhlLHQpOnN1cGVyLmluY2x1ZGVDYWxsQXJndW1lbnRzKGUsdCk7fWluaXRpYWxpc2UoKXt0aGlzLnByb3BlcnR5S2V5PVRuKHRoaXMpLHRoaXMuYWNjZXNzSW50ZXJhY3Rpb249e2FyZ3M6W3RoaXMub2JqZWN0XSx0eXBlOjB9O31pc1NraXBwZWRBc09wdGlvbmFsKGUpe3JldHVybiAhdGhpcy52YXJpYWJsZSYmIXRoaXMuaXNVbmRlZmluZWQmJih0aGlzLm9iamVjdC5pc1NraXBwZWRBc09wdGlvbmFsPy4oZSl8fHRoaXMub3B0aW9uYWwmJm51bGw9PXRoaXMub2JqZWN0LmdldExpdGVyYWxWYWx1ZUF0UGF0aChLLGVlLGUpKX1yZW5kZXIoZSx0LHtyZW5kZXJlZFBhcmVudFR5cGU6cyxpc0NhbGxlZU9mUmVuZGVyZWRQYXJlbnQ6aSxyZW5kZXJlZFN1cnJvdW5kaW5nRWxlbWVudDpufT1wZSl7aWYodGhpcy52YXJpYWJsZXx8dGhpcy5pc1VuZGVmaW5lZCl7Y29uc3R7c25pcHBldHM6e2dldFByb3BlcnR5QWNjZXNzOm59fT10O2xldCByPXRoaXMudmFyaWFibGU/dGhpcy52YXJpYWJsZS5nZXROYW1lKG4pOiJ1bmRlZmluZWQiO3MmJmkmJihyPSIwLCAiK3IpLGUub3ZlcndyaXRlKHRoaXMuc3RhcnQsdGhpcy5lbmQscix7Y29udGVudE9ubHk6ITAsc3RvcmVOYW1lOiEwfSk7fWVsc2UgcyYmaSYmZS5hcHBlbmRSaWdodCh0aGlzLnN0YXJ0LCIwLCAiKSx0aGlzLm9iamVjdC5yZW5kZXIoZSx0LHtyZW5kZXJlZFN1cnJvdW5kaW5nRWxlbWVudDpufSksdGhpcy5wcm9wZXJ0eS5yZW5kZXIoZSx0KTt9c2V0QXNzaWduZWRWYWx1ZShlKXt0aGlzLmFzc2lnbm1lbnRJbnRlcmFjdGlvbj17YXJnczpbdGhpcy5vYmplY3QsZV0sdHlwZToxfTt9YXBwbHlEZW9wdGltaXphdGlvbnMoKXt0aGlzLmRlb3B0aW1pemVkPSEwO2NvbnN0e3Byb3BlcnR5UmVhZFNpZGVFZmZlY3RzOmV9PXRoaXMuY29udGV4dC5vcHRpb25zLnRyZWVzaGFrZTtpZih0aGlzLmJvdW5kJiZlJiYhdGhpcy52YXJpYWJsZSYmIXRoaXMuaXNVbmRlZmluZWQpe2NvbnN0IGU9dGhpcy5nZXRQcm9wZXJ0eUtleSgpO3RoaXMub2JqZWN0LmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKHRoaXMuYWNjZXNzSW50ZXJhY3Rpb24sW2VdLGVlKSx0aGlzLmNvbnRleHQucmVxdWVzdFRyZWVzaGFraW5nUGFzcygpO319YXBwbHlBc3NpZ25tZW50RGVvcHRpbWl6YXRpb24oKXt0aGlzLmFzc2lnbm1lbnREZW9wdGltaXplZD0hMDtjb25zdHtwcm9wZXJ0eVJlYWRTaWRlRWZmZWN0czplfT10aGlzLmNvbnRleHQub3B0aW9ucy50cmVlc2hha2U7dGhpcy5ib3VuZCYmZSYmIXRoaXMudmFyaWFibGUmJiF0aGlzLmlzVW5kZWZpbmVkJiYodGhpcy5vYmplY3QuZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgodGhpcy5hc3NpZ25tZW50SW50ZXJhY3Rpb24sW3RoaXMuZ2V0UHJvcGVydHlLZXkoKV0sZWUpLHRoaXMuY29udGV4dC5yZXF1ZXN0VHJlZXNoYWtpbmdQYXNzKCkpO31kaXNhbGxvd05hbWVzcGFjZVJlYXNzaWdubWVudCgpe2lmKHRoaXMub2JqZWN0IGluc3RhbmNlb2YgYW4pe3RoaXMuc2NvcGUuZmluZFZhcmlhYmxlKHRoaXMub2JqZWN0Lm5hbWUpLmlzTmFtZXNwYWNlJiYodGhpcy52YXJpYWJsZSYmdGhpcy5jb250ZXh0LmluY2x1ZGVWYXJpYWJsZUluTW9kdWxlKHRoaXMudmFyaWFibGUpLHRoaXMuY29udGV4dC5sb2codmUsTHQodGhpcy5vYmplY3QubmFtZSx0aGlzLmNvbnRleHQubW9kdWxlLmlkKSx0aGlzLnN0YXJ0KSk7fX1nZXRQcm9wZXJ0eUtleSgpe2lmKG51bGw9PT10aGlzLnByb3BlcnR5S2V5KXt0aGlzLnByb3BlcnR5S2V5PUc7Y29uc3QgZT10aGlzLnByb3BlcnR5LmdldExpdGVyYWxWYWx1ZUF0UGF0aChLLGVlLHRoaXMpO3JldHVybiB0aGlzLnByb3BlcnR5S2V5PWU9PT1IP2U6InN5bWJvbCI9PXR5cGVvZiBlP0c6U3RyaW5nKGUpfXJldHVybiB0aGlzLnByb3BlcnR5S2V5fWhhc0FjY2Vzc0VmZmVjdChlKXtjb25zdHtwcm9wZXJ0eVJlYWRTaWRlRWZmZWN0czp0fT10aGlzLmNvbnRleHQub3B0aW9ucy50cmVlc2hha2U7cmV0dXJuICEodGhpcy52YXJpYWJsZXx8dGhpcy5pc1VuZGVmaW5lZCkmJnQmJigiYWx3YXlzIj09PXR8fHRoaXMub2JqZWN0Lmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKFt0aGlzLmdldFByb3BlcnR5S2V5KCldLHRoaXMuYWNjZXNzSW50ZXJhY3Rpb24sZSkpfWluY2x1ZGVQcm9wZXJ0aWVzKGUsdCl7dGhpcy5pbmNsdWRlZHx8KHRoaXMuaW5jbHVkZWQ9ITAsdGhpcy52YXJpYWJsZSYmdGhpcy5jb250ZXh0LmluY2x1ZGVWYXJpYWJsZUluTW9kdWxlKHRoaXMudmFyaWFibGUpKSx0aGlzLm9iamVjdC5pbmNsdWRlKGUsdCksdGhpcy5wcm9wZXJ0eS5pbmNsdWRlKGUsdCk7fX1mdW5jdGlvbiB6bihlLHQscyl7aWYoMD09PXQubGVuZ3RoKXJldHVybiBlO2lmKCFlLmlzTmFtZXNwYWNlfHxlIGluc3RhbmNlb2YgZGUpcmV0dXJuIG51bGw7Y29uc3QgaT10WzBdLmtleSxuPWUuY29udGV4dC50cmFjZUV4cG9ydChpKTtpZighbil7aWYoMT09PXQubGVuZ3RoKXtjb25zdCBuPWUuY29udGV4dC5maWxlTmFtZTtyZXR1cm4gcy5sb2codmUsRnQoaSxzLm1vZHVsZS5pZCxuKSx0WzBdLnBvcyksInVuZGVmaW5lZCJ9cmV0dXJuIG51bGx9cmV0dXJuIHpuKG4sdC5zbGljZSgxKSxzKX1jbGFzcyBGbiBleHRlbmRzIFpze2NvbnN0cnVjdG9yKCl7c3VwZXIoLi4uYXJndW1lbnRzKSx0aGlzLnJldHVybkV4cHJlc3Npb249bnVsbCx0aGlzLmRlb3B0aW1pemFibGVEZXBlbmRlbnRFeHByZXNzaW9ucz1bXSx0aGlzLmV4cHJlc3Npb25zVG9CZURlb3B0aW1pemVkPW5ldyBTZXQ7fWRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtjb25zdHthcmdzOml9PWUsW24scl09dGhpcy5nZXRSZXR1cm5FeHByZXNzaW9uKHMpO2lmKHIpcmV0dXJuO2NvbnN0IG89aS5maWx0ZXIoKGU9PiEhZSYmZSE9PXJlKSk7aWYoMCE9PW8ubGVuZ3RoKWlmKG49PT1yZSlmb3IoY29uc3QgZSBvZiBvKWUuZGVvcHRpbWl6ZVBhdGgoWSk7ZWxzZSBzLndpdGhUcmFja2VkRW50aXR5QXRQYXRoKHQsbiwoKCk9Pntmb3IoY29uc3QgZSBvZiBvKXRoaXMuZXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQuYWRkKGUpO24uZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpO30pLG51bGwpO31kZW9wdGltaXplQ2FjaGUoKXtpZih0aGlzLnJldHVybkV4cHJlc3Npb24/LlswXSE9PXJlKXt0aGlzLnJldHVybkV4cHJlc3Npb249b2U7Y29uc3R7ZGVvcHRpbWl6YWJsZURlcGVuZGVudEV4cHJlc3Npb25zOmUsZXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQ6dH09dGhpczt0aGlzLmV4cHJlc3Npb25zVG9CZURlb3B0aW1pemVkPWdlLHRoaXMuZGVvcHRpbWl6YWJsZURlcGVuZGVudEV4cHJlc3Npb25zPW1lO2Zvcihjb25zdCB0IG9mIGUpdC5kZW9wdGltaXplQ2FjaGUoKTtmb3IoY29uc3QgZSBvZiB0KWUuZGVvcHRpbWl6ZVBhdGgoWSk7fX1kZW9wdGltaXplUGF0aChlKXtpZigwPT09ZS5sZW5ndGh8fHRoaXMuY29udGV4dC5kZW9wdGltaXphdGlvblRyYWNrZXIudHJhY2tFbnRpdHlBdFBhdGhBbmRHZXRJZlRyYWNrZWQoZSx0aGlzKSlyZXR1cm47Y29uc3RbdF09dGhpcy5nZXRSZXR1cm5FeHByZXNzaW9uKCk7dCE9PXJlJiZ0LmRlb3B0aW1pemVQYXRoKGUpO31nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpe2NvbnN0W2ldPXRoaXMuZ2V0UmV0dXJuRXhwcmVzc2lvbih0KTtyZXR1cm4gaT09PXJlP3NlOnQud2l0aFRyYWNrZWRFbnRpdHlBdFBhdGgoZSxpLCgoKT0+KHRoaXMuZGVvcHRpbWl6YWJsZURlcGVuZGVudEV4cHJlc3Npb25zLnB1c2gocyksaS5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpKSksc2UpfWdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUsdCxzLGkpe2NvbnN0IG49dGhpcy5nZXRSZXR1cm5FeHByZXNzaW9uKHMpO3JldHVybiBuWzBdPT09cmU/bjpzLndpdGhUcmFja2VkRW50aXR5QXRQYXRoKGUsbiwoKCk9Pnt0aGlzLmRlb3B0aW1pemFibGVEZXBlbmRlbnRFeHByZXNzaW9ucy5wdXNoKGkpO2NvbnN0W3Isb109blswXS5nZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChlLHQscyxpKTtyZXR1cm4gW3Isb3x8blsxXV19KSxvZSl9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe2NvbnN0e3R5cGU6aX09dDtpZigyPT09aSl7Y29uc3R7YXJnczppLHdpdGhOZXc6bn09dDtpZigobj9zLmluc3RhbnRpYXRlZDpzLmNhbGxlZCkudHJhY2tFbnRpdHlBdFBhdGhBbmRHZXRJZlRyYWNrZWQoZSxpLHRoaXMpKXJldHVybiAhMX1lbHNlIGlmKCgxPT09aT9zLmFzc2lnbmVkOnMuYWNjZXNzZWQpLnRyYWNrRW50aXR5QXRQYXRoQW5kR2V0SWZUcmFja2VkKGUsdGhpcykpcmV0dXJuICExO2NvbnN0W24scl09dGhpcy5nZXRSZXR1cm5FeHByZXNzaW9uKCk7cmV0dXJuICgxPT09aXx8IXIpJiZuLmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKX19Y2xhc3Mgam4gZXh0ZW5kcyBGbntiaW5kKCl7aWYoc3VwZXIuYmluZCgpLHRoaXMuY2FsbGVlIGluc3RhbmNlb2YgYW4pe3RoaXMuc2NvcGUuZmluZFZhcmlhYmxlKHRoaXMuY2FsbGVlLm5hbWUpLmlzTmFtZXNwYWNlJiZ0aGlzLmNvbnRleHQubG9nKHZlLFJ0KHRoaXMuY2FsbGVlLm5hbWUpLHRoaXMuc3RhcnQpLCJldmFsIj09PXRoaXMuY2FsbGVlLm5hbWUmJnRoaXMuY29udGV4dC5sb2codmUse2NvZGU6IkVWQUwiLGlkOmU9dGhpcy5jb250ZXh0Lm1vZHVsZS5pZCxtZXNzYWdlOmBVc2Ugb2YgZXZhbCBpbiAiJHtMKGUpfSIgaXMgc3Ryb25nbHkgZGlzY291cmFnZWQgYXMgaXQgcG9zZXMgc2VjdXJpdHkgcmlza3MgYW5kIG1heSBjYXVzZSBpc3N1ZXMgd2l0aCBtaW5pZmljYXRpb24uYCx1cmw6TWUoInRyb3VibGVzaG9vdGluZy8jYXZvaWRpbmctZXZhbCIpfSx0aGlzLnN0YXJ0KTt9dmFyIGU7dGhpcy5pbnRlcmFjdGlvbj17YXJnczpbdGhpcy5jYWxsZWUgaW5zdGFuY2VvZiBCbiYmIXRoaXMuY2FsbGVlLnZhcmlhYmxlP3RoaXMuY2FsbGVlLm9iamVjdDpudWxsLC4uLnRoaXMuYXJndW1lbnRzXSx0eXBlOjIsd2l0aE5ldzohMX07fWhhc0VmZmVjdHMoZSl7dHJ5e2Zvcihjb25zdCB0IG9mIHRoaXMuYXJndW1lbnRzKWlmKHQuaGFzRWZmZWN0cyhlKSlyZXR1cm4gITA7cmV0dXJuICF0aGlzLmFubm90YXRpb25QdXJlJiYodGhpcy5jYWxsZWUuaGFzRWZmZWN0cyhlKXx8dGhpcy5jYWxsZWUuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoSyx0aGlzLmludGVyYWN0aW9uLGUpKX1maW5hbGx5e3RoaXMuZGVvcHRpbWl6ZWR8fHRoaXMuYXBwbHlEZW9wdGltaXphdGlvbnMoKTt9fWluY2x1ZGUoZSx0KXt0aGlzLmRlb3B0aW1pemVkfHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCksdD8oc3VwZXIuaW5jbHVkZShlLHQpLHQ9PT1RcyYmdGhpcy5jYWxsZWUgaW5zdGFuY2VvZiBhbiYmdGhpcy5jYWxsZWUudmFyaWFibGUmJnRoaXMuY2FsbGVlLnZhcmlhYmxlLm1hcmtDYWxsZWRGcm9tVHJ5U3RhdGVtZW50KCkpOih0aGlzLmluY2x1ZGVkPSEwLHRoaXMuY2FsbGVlLmluY2x1ZGUoZSwhMSkpLHRoaXMuY2FsbGVlLmluY2x1ZGVDYWxsQXJndW1lbnRzKGUsdGhpcy5hcmd1bWVudHMpO31pc1NraXBwZWRBc09wdGlvbmFsKGUpe3JldHVybiB0aGlzLmNhbGxlZS5pc1NraXBwZWRBc09wdGlvbmFsPy4oZSl8fHRoaXMub3B0aW9uYWwmJm51bGw9PXRoaXMuY2FsbGVlLmdldExpdGVyYWxWYWx1ZUF0UGF0aChLLGVlLGUpfXJlbmRlcihlLHQse3JlbmRlcmVkU3Vycm91bmRpbmdFbGVtZW50OnN9PXBlKXt0aGlzLmNhbGxlZS5yZW5kZXIoZSx0LHtpc0NhbGxlZU9mUmVuZGVyZWRQYXJlbnQ6ITAscmVuZGVyZWRTdXJyb3VuZGluZ0VsZW1lbnQ6c30pLERuKGUsdCx0aGlzKTt9YXBwbHlEZW9wdGltaXphdGlvbnMoKXt0aGlzLmRlb3B0aW1pemVkPSEwLHRoaXMuY2FsbGVlLmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKHRoaXMuaW50ZXJhY3Rpb24sSyxlZSksdGhpcy5jb250ZXh0LnJlcXVlc3RUcmVlc2hha2luZ1Bhc3MoKTt9Z2V0UmV0dXJuRXhwcmVzc2lvbihlPWVlKXtyZXR1cm4gbnVsbD09PXRoaXMucmV0dXJuRXhwcmVzc2lvbj8odGhpcy5yZXR1cm5FeHByZXNzaW9uPW9lLHRoaXMucmV0dXJuRXhwcmVzc2lvbj10aGlzLmNhbGxlZS5nZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChLLHRoaXMuaW50ZXJhY3Rpb24sZSx0aGlzKSk6dGhpcy5yZXR1cm5FeHByZXNzaW9ufX1jbGFzcyBVbiBleHRlbmRzIFRpe2FkZERlY2xhcmF0aW9uKGUsdCxzLGkpe2NvbnN0IG49dGhpcy52YXJpYWJsZXMuZ2V0KGUubmFtZSk7cmV0dXJuIG4/KHRoaXMucGFyZW50LmFkZERlY2xhcmF0aW9uKGUsdCxpcyxpKSxuLmFkZERlY2xhcmF0aW9uKGUscyksbik6dGhpcy5wYXJlbnQuYWRkRGVjbGFyYXRpb24oZSx0LHMsaSl9fWNsYXNzIEduIGV4dGVuZHMgTGl7Y29uc3RydWN0b3IoZSx0LHMpe3N1cGVyKGUpLHRoaXMudmFyaWFibGVzLnNldCgidGhpcyIsdGhpcy50aGlzVmFyaWFibGU9bmV3IElpKCJ0aGlzIixudWxsLHQscykpLHRoaXMuaW5zdGFuY2VTY29wZT1uZXcgTGkodGhpcyksdGhpcy5pbnN0YW5jZVNjb3BlLnZhcmlhYmxlcy5zZXQoInRoaXMiLG5ldyBObihzKSk7fWZpbmRMZXhpY2FsQm91bmRhcnkoKXtyZXR1cm4gdGhpc319Y2xhc3MgV24gZXh0ZW5kcyBac3tjb25zdHJ1Y3Rvcigpe3N1cGVyKC4uLmFyZ3VtZW50cyksdGhpcy5hY2Nlc3NlZFZhbHVlPW51bGw7fWRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtyZXR1cm4gMD09PWUudHlwZSYmImdldCI9PT10aGlzLmtpbmQmJjA9PT10Lmxlbmd0aHx8MT09PWUudHlwZSYmInNldCI9PT10aGlzLmtpbmQmJjA9PT10Lmxlbmd0aD90aGlzLnZhbHVlLmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKHthcmdzOmUuYXJncyx0eXBlOjIsd2l0aE5ldzohMX0sSyxzKTp2b2lkIHRoaXMuZ2V0QWNjZXNzZWRWYWx1ZSgpWzBdLmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKX1kZW9wdGltaXplQ2FjaGUoKXt9ZGVvcHRpbWl6ZVBhdGgoZSl7dGhpcy5nZXRBY2Nlc3NlZFZhbHVlKClbMF0uZGVvcHRpbWl6ZVBhdGgoZSk7fWdldExpdGVyYWxWYWx1ZUF0UGF0aChlLHQscyl7cmV0dXJuIHRoaXMuZ2V0QWNjZXNzZWRWYWx1ZSgpWzBdLmdldExpdGVyYWxWYWx1ZUF0UGF0aChlLHQscyl9Z2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSl7cmV0dXJuIHRoaXMuZ2V0QWNjZXNzZWRWYWx1ZSgpWzBdLmdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUsdCxzLGkpfWhhc0VmZmVjdHMoZSl7cmV0dXJuIHRoaXMua2V5Lmhhc0VmZmVjdHMoZSl9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3JldHVybiAiZ2V0Ij09PXRoaXMua2luZCYmMD09PXQudHlwZSYmMD09PWUubGVuZ3RofHwic2V0Ij09PXRoaXMua2luZCYmMT09PXQudHlwZT90aGlzLnZhbHVlLmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKEsse2FyZ3M6dC5hcmdzLHR5cGU6Mix3aXRoTmV3OiExfSxzKTp0aGlzLmdldEFjY2Vzc2VkVmFsdWUoKVswXS5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl9YXBwbHlEZW9wdGltaXphdGlvbnMoKXt9Z2V0QWNjZXNzZWRWYWx1ZSgpe3JldHVybiBudWxsPT09dGhpcy5hY2Nlc3NlZFZhbHVlPyJnZXQiPT09dGhpcy5raW5kPyh0aGlzLmFjY2Vzc2VkVmFsdWU9b2UsdGhpcy5hY2Nlc3NlZFZhbHVlPXRoaXMudmFsdWUuZ2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoSyxoZSxlZSx0aGlzKSk6dGhpcy5hY2Nlc3NlZFZhbHVlPVt0aGlzLnZhbHVlLCExXTp0aGlzLmFjY2Vzc2VkVmFsdWV9fWNsYXNzIHFuIGV4dGVuZHMgV257YXBwbHlEZW9wdGltaXphdGlvbnMoKXt9fWNsYXNzIEhuIGV4dGVuZHMgbmV7Y29uc3RydWN0b3IoZSx0KXtzdXBlcigpLHRoaXMub2JqZWN0PWUsdGhpcy5rZXk9dDt9ZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3RoaXMub2JqZWN0LmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsW3RoaXMua2V5LC4uLnRdLHMpO31kZW9wdGltaXplUGF0aChlKXt0aGlzLm9iamVjdC5kZW9wdGltaXplUGF0aChbdGhpcy5rZXksLi4uZV0pO31nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpe3JldHVybiB0aGlzLm9iamVjdC5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoW3RoaXMua2V5LC4uLmVdLHQscyl9Z2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSl7cmV0dXJuIHRoaXMub2JqZWN0LmdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKFt0aGlzLmtleSwuLi5lXSx0LHMsaSl9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3JldHVybiB0aGlzLm9iamVjdC5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChbdGhpcy5rZXksLi4uZV0sdCxzKX19Y2xhc3MgS24gZXh0ZW5kcyBac3tjb25zdHJ1Y3Rvcigpe3N1cGVyKC4uLmFyZ3VtZW50cyksdGhpcy5vYmplY3RFbnRpdHk9bnVsbDt9Y3JlYXRlU2NvcGUoZSl7dGhpcy5zY29wZT1uZXcgTGkoZSk7fWRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXt0aGlzLmdldE9iamVjdEVudGl0eSgpLmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKTt9ZGVvcHRpbWl6ZUNhY2hlKCl7dGhpcy5nZXRPYmplY3RFbnRpdHkoKS5kZW9wdGltaXplQWxsUHJvcGVydGllcygpO31kZW9wdGltaXplUGF0aChlKXt0aGlzLmdldE9iamVjdEVudGl0eSgpLmRlb3B0aW1pemVQYXRoKGUpO31nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpe3JldHVybiB0aGlzLmdldE9iamVjdEVudGl0eSgpLmdldExpdGVyYWxWYWx1ZUF0UGF0aChlLHQscyl9Z2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSl7cmV0dXJuIHRoaXMuZ2V0T2JqZWN0RW50aXR5KCkuZ2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSl9aGFzRWZmZWN0cyhlKXt0aGlzLmRlb3B0aW1pemVkfHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCk7Y29uc3QgdD10aGlzLnN1cGVyQ2xhc3M/Lmhhc0VmZmVjdHMoZSl8fHRoaXMuYm9keS5oYXNFZmZlY3RzKGUpO3JldHVybiB0aGlzLmlkPy5tYXJrRGVjbGFyYXRpb25SZWFjaGVkKCksdHx8c3VwZXIuaGFzRWZmZWN0cyhlKX1oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7cmV0dXJuIDI9PT10LnR5cGUmJjA9PT1lLmxlbmd0aD8hdC53aXRoTmV3fHwobnVsbD09PXRoaXMuY2xhc3NDb25zdHJ1Y3Rvcj90aGlzLnN1cGVyQ2xhc3M/Lmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKTp0aGlzLmNsYXNzQ29uc3RydWN0b3IuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpKXx8ITE6dGhpcy5nZXRPYmplY3RFbnRpdHkoKS5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl9aW5jbHVkZShlLHQpe3RoaXMuZGVvcHRpbWl6ZWR8fHRoaXMuYXBwbHlEZW9wdGltaXphdGlvbnMoKSx0aGlzLmluY2x1ZGVkPSEwLHRoaXMuc3VwZXJDbGFzcz8uaW5jbHVkZShlLHQpLHRoaXMuYm9keS5pbmNsdWRlKGUsdCksdGhpcy5pZCYmKHRoaXMuaWQubWFya0RlY2xhcmF0aW9uUmVhY2hlZCgpLHRoaXMuaWQuaW5jbHVkZSgpKTt9aW5pdGlhbGlzZSgpe3RoaXMuaWQ/LmRlY2xhcmUoImNsYXNzIix0aGlzKTtmb3IoY29uc3QgZSBvZiB0aGlzLmJvZHkuYm9keSlpZihlIGluc3RhbmNlb2YgcW4mJiJjb25zdHJ1Y3RvciI9PT1lLmtpbmQpcmV0dXJuIHZvaWQodGhpcy5jbGFzc0NvbnN0cnVjdG9yPWUpO3RoaXMuY2xhc3NDb25zdHJ1Y3Rvcj1udWxsO31hcHBseURlb3B0aW1pemF0aW9ucygpe3RoaXMuZGVvcHRpbWl6ZWQ9ITA7Zm9yKGNvbnN0IGUgb2YgdGhpcy5ib2R5LmJvZHkpZS5zdGF0aWN8fGUgaW5zdGFuY2VvZiBxbiYmImNvbnN0cnVjdG9yIj09PWUua2luZHx8ZS5kZW9wdGltaXplUGF0aChZKTt0aGlzLmNvbnRleHQucmVxdWVzdFRyZWVzaGFraW5nUGFzcygpO31nZXRPYmplY3RFbnRpdHkoKXtpZihudWxsIT09dGhpcy5vYmplY3RFbnRpdHkpcmV0dXJuIHRoaXMub2JqZWN0RW50aXR5O2NvbnN0IGU9W10sdD1bXTtmb3IoY29uc3QgcyBvZiB0aGlzLmJvZHkuYm9keSl7Y29uc3QgaT1zLnN0YXRpYz9lOnQsbj1zLmtpbmQ7aWYoaT09PXQmJiFuKWNvbnRpbnVlO2NvbnN0IHI9InNldCI9PT1ufHwiZ2V0Ij09PW4/bjoiaW5pdCI7bGV0IG87aWYocy5jb21wdXRlZCl7Y29uc3QgZT1zLmtleS5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoSyxlZSx0aGlzKTtpZigic3ltYm9sIj09dHlwZW9mIGUpe2kucHVzaCh7a2V5Okcsa2luZDpyLHByb3BlcnR5OnN9KTtjb250aW51ZX1vPVN0cmluZyhlKTt9ZWxzZSBvPXMua2V5IGluc3RhbmNlb2YgYW4/cy5rZXkubmFtZTpTdHJpbmcocy5rZXkudmFsdWUpO2kucHVzaCh7a2V5Om8sa2luZDpyLHByb3BlcnR5OnN9KTt9cmV0dXJuIGUudW5zaGlmdCh7a2V5OiJwcm90b3R5cGUiLGtpbmQ6ImluaXQiLHByb3BlcnR5Om5ldyBvaSh0LHRoaXMuc3VwZXJDbGFzcz9uZXcgSG4odGhpcy5zdXBlckNsYXNzLCJwcm90b3R5cGUiKTpjaSl9KSx0aGlzLm9iamVjdEVudGl0eT1uZXcgb2koZSx0aGlzLnN1cGVyQ2xhc3N8fGNpKX19Y2xhc3MgWW4gZXh0ZW5kcyBLbntpbml0aWFsaXNlKCl7c3VwZXIuaW5pdGlhbGlzZSgpLG51bGwhPT10aGlzLmlkJiYodGhpcy5pZC52YXJpYWJsZS5pc0lkPSEwKTt9cGFyc2VOb2RlKGUpe251bGwhPT1lLmlkJiYodGhpcy5pZD1uZXcgYW4oZS5pZCx0aGlzLHRoaXMuc2NvcGUucGFyZW50KSksc3VwZXIucGFyc2VOb2RlKGUpO31yZW5kZXIoZSx0KXtjb25zdHtleHBvcnROYW1lc0J5VmFyaWFibGU6cyxmb3JtYXQ6aSxzbmlwcGV0czp7XzpuLGdldFByb3BlcnR5QWNjZXNzOnJ9fT10O2lmKHRoaXMuaWQpe2NvbnN0e3ZhcmlhYmxlOm8sbmFtZTphfT10aGlzLmlkOyJzeXN0ZW0iPT09aSYmcy5oYXMobykmJmUuYXBwZW5kTGVmdCh0aGlzLmVuZCxgJHtufSR7SW4oW29dLHQpfTtgKTtjb25zdCBsPW8uZ2V0TmFtZShyKTtpZihsIT09YSlyZXR1cm4gdGhpcy5zdXBlckNsYXNzPy5yZW5kZXIoZSx0KSx0aGlzLmJvZHkucmVuZGVyKGUsey4uLnQsdXNlT3JpZ2luYWxOYW1lOmU9PmU9PT1vfSksZS5wcmVwZW5kUmlnaHQodGhpcy5zdGFydCxgbGV0ICR7bH0ke259PSR7bn1gKSx2b2lkIGUucHJlcGVuZExlZnQodGhpcy5lbmQsIjsiKX1zdXBlci5yZW5kZXIoZSx0KTt9YXBwbHlEZW9wdGltaXphdGlvbnMoKXtzdXBlci5hcHBseURlb3B0aW1pemF0aW9ucygpO2NvbnN0e2lkOmUsc2NvcGU6dH09dGhpcztpZihlKXtjb25zdHtuYW1lOnMsdmFyaWFibGU6aX09ZTtmb3IoY29uc3QgZSBvZiB0LmFjY2Vzc2VkT3V0c2lkZVZhcmlhYmxlcy52YWx1ZXMoKSllIT09aSYmZS5mb3JiaWROYW1lKHMpO319fWNsYXNzIFhuIGV4dGVuZHMgS257cmVuZGVyKGUsdCx7cmVuZGVyZWRTdXJyb3VuZGluZ0VsZW1lbnQ6c309cGUpe3N1cGVyLnJlbmRlcihlLHQpLHM9PT1OcyYmKGUuYXBwZW5kUmlnaHQodGhpcy5zdGFydCwiKCIpLGUucHJlcGVuZExlZnQodGhpcy5lbmQsIikiKSk7fX1jbGFzcyBRbiBleHRlbmRzIG5le2NvbnN0cnVjdG9yKGUpe3N1cGVyKCksdGhpcy5leHByZXNzaW9ucz1lLHRoaXMuaW5jbHVkZWQ9ITE7fWRlb3B0aW1pemVQYXRoKGUpe2Zvcihjb25zdCB0IG9mIHRoaXMuZXhwcmVzc2lvbnMpdC5kZW9wdGltaXplUGF0aChlKTt9Z2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSl7cmV0dXJuIFtuZXcgUW4odGhpcy5leHByZXNzaW9ucy5tYXAoKG49Pm4uZ2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSlbMF0pKSksITFdfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtmb3IoY29uc3QgaSBvZiB0aGlzLmV4cHJlc3Npb25zKWlmKGkuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpKXJldHVybiAhMDtyZXR1cm4gITF9fWZ1bmN0aW9uIFpuKGUsdCl7Y29uc3R7YnJva2VuRmxvdzpzLGhhc0JyZWFrOmksaGFzQ29udGludWU6bixpZ25vcmU6cn09ZSx7YnJlYWtzOm8sY29udGludWVzOmF9PXI7cmV0dXJuIHIuYnJlYWtzPSEwLHIuY29udGludWVzPSEwLGUuaGFzQnJlYWs9ITEsZS5oYXNDb250aW51ZT0hMSwhIXQuaGFzRWZmZWN0cyhlKXx8KHIuYnJlYWtzPW8sci5jb250aW51ZXM9YSxlLmhhc0JyZWFrPWksZS5oYXNDb250aW51ZT1uLGUuYnJva2VuRmxvdz1zLCExKX1mdW5jdGlvbiBKbihlLHQscyl7Y29uc3R7YnJva2VuRmxvdzppLGhhc0JyZWFrOm4saGFzQ29udGludWU6cn09ZTtlLmhhc0JyZWFrPSExLGUuaGFzQ29udGludWU9ITEsdC5pbmNsdWRlKGUscyx7YXNTaW5nbGVTdGF0ZW1lbnQ6ITB9KSxlLmhhc0JyZWFrPW4sZS5oYXNDb250aW51ZT1yLGUuYnJva2VuRmxvdz1pO31jbGFzcyBlciBleHRlbmRzIFpze2hhc0VmZmVjdHMoKXtyZXR1cm4gITF9aW5pdGlhbGlzZSgpe3RoaXMuY29udGV4dC5hZGRFeHBvcnQodGhpcyk7fXJlbmRlcihlLHQscyl7ZS5yZW1vdmUocy5zdGFydCxzLmVuZCk7fWFwcGx5RGVvcHRpbWl6YXRpb25zKCl7fX1lci5wcm90b3R5cGUubmVlZHNCb3VuZGFyaWVzPSEwO2NsYXNzIHRyIGV4dGVuZHMgUm57aW5pdGlhbGlzZSgpe3N1cGVyLmluaXRpYWxpc2UoKSxudWxsIT09dGhpcy5pZCYmKHRoaXMuaWQudmFyaWFibGUuaXNJZD0hMCk7fXBhcnNlTm9kZShlKXtudWxsIT09ZS5pZCYmKHRoaXMuaWQ9bmV3IGFuKGUuaWQsdGhpcyx0aGlzLnNjb3BlLnBhcmVudCkpLHN1cGVyLnBhcnNlTm9kZShlKTt9fWNsYXNzIHNyIGV4dGVuZHMgWnN7aW5jbHVkZShlLHQpe3N1cGVyLmluY2x1ZGUoZSx0KSx0JiZ0aGlzLmNvbnRleHQuaW5jbHVkZVZhcmlhYmxlSW5Nb2R1bGUodGhpcy52YXJpYWJsZSk7fWluaXRpYWxpc2UoKXtjb25zdCBlPXRoaXMuZGVjbGFyYXRpb247dGhpcy5kZWNsYXJhdGlvbk5hbWU9ZS5pZCYmZS5pZC5uYW1lfHx0aGlzLmRlY2xhcmF0aW9uLm5hbWUsdGhpcy52YXJpYWJsZT10aGlzLnNjb3BlLmFkZEV4cG9ydERlZmF1bHREZWNsYXJhdGlvbih0aGlzLmRlY2xhcmF0aW9uTmFtZXx8dGhpcy5jb250ZXh0LmdldE1vZHVsZU5hbWUoKSx0aGlzLHRoaXMuY29udGV4dCksdGhpcy5jb250ZXh0LmFkZEV4cG9ydCh0aGlzKTt9cmVuZGVyKGUsdCxzKXtjb25zdHtzdGFydDppLGVuZDpufT1zLHI9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZm4oZSxkbihlLCJkZWZhdWx0Iix0KSs3KX0oZS5vcmlnaW5hbCx0aGlzLnN0YXJ0KTtpZih0aGlzLmRlY2xhcmF0aW9uIGluc3RhbmNlb2YgdHIpdGhpcy5yZW5kZXJOYW1lZERlY2xhcmF0aW9uKGUscixudWxsPT09dGhpcy5kZWNsYXJhdGlvbi5pZD9mdW5jdGlvbihlLHQpe2NvbnN0IHM9ZG4oZSwiZnVuY3Rpb24iLHQpKzg7ZT1lLnNsaWNlKHMsZG4oZSwiKCIscykpO2NvbnN0IGk9ZG4oZSwiKiIpO3JldHVybiAtMT09PWk/czpzK2krMX0oZS5vcmlnaW5hbCxyKTpudWxsLHQpO2Vsc2UgaWYodGhpcy5kZWNsYXJhdGlvbiBpbnN0YW5jZW9mIFluKXRoaXMucmVuZGVyTmFtZWREZWNsYXJhdGlvbihlLHIsbnVsbD09PXRoaXMuZGVjbGFyYXRpb24uaWQ/ZG4oZS5vcmlnaW5hbCwiY2xhc3MiLGkpKzU6bnVsbCx0KTtlbHNlIHtpZih0aGlzLnZhcmlhYmxlLmdldE9yaWdpbmFsVmFyaWFibGUoKSE9PXRoaXMudmFyaWFibGUpcmV0dXJuIHZvaWQgY24odGhpcyxlLGksbik7aWYoIXRoaXMudmFyaWFibGUuaW5jbHVkZWQpcmV0dXJuIGUucmVtb3ZlKHRoaXMuc3RhcnQsciksdGhpcy5kZWNsYXJhdGlvbi5yZW5kZXIoZSx0LHtyZW5kZXJlZFN1cnJvdW5kaW5nRWxlbWVudDpOc30pLHZvaWQoIjsiIT09ZS5vcmlnaW5hbFt0aGlzLmVuZC0xXSYmZS5hcHBlbmRMZWZ0KHRoaXMuZW5kLCI7IikpO3RoaXMucmVuZGVyVmFyaWFibGVEZWNsYXJhdGlvbihlLHIsdCk7fXRoaXMuZGVjbGFyYXRpb24ucmVuZGVyKGUsdCk7fWFwcGx5RGVvcHRpbWl6YXRpb25zKCl7fXJlbmRlck5hbWVkRGVjbGFyYXRpb24oZSx0LHMsaSl7Y29uc3R7ZXhwb3J0TmFtZXNCeVZhcmlhYmxlOm4sZm9ybWF0OnIsc25pcHBldHM6e2dldFByb3BlcnR5QWNjZXNzOm99fT1pLGE9dGhpcy52YXJpYWJsZS5nZXROYW1lKG8pO2UucmVtb3ZlKHRoaXMuc3RhcnQsdCksbnVsbCE9PXMmJmUuYXBwZW5kTGVmdChzLGAgJHthfWApLCJzeXN0ZW0iPT09ciYmdGhpcy5kZWNsYXJhdGlvbiBpbnN0YW5jZW9mIFluJiZuLmhhcyh0aGlzLnZhcmlhYmxlKSYmZS5hcHBlbmRMZWZ0KHRoaXMuZW5kLGAgJHtJbihbdGhpcy52YXJpYWJsZV0saSl9O2ApO31yZW5kZXJWYXJpYWJsZURlY2xhcmF0aW9uKGUsdCx7Zm9ybWF0OnMsZXhwb3J0TmFtZXNCeVZhcmlhYmxlOmksc25pcHBldHM6e2Nuc3Q6bixnZXRQcm9wZXJ0eUFjY2VzczpyfX0pe2NvbnN0IG89NTk9PT1lLm9yaWdpbmFsLmNoYXJDb2RlQXQodGhpcy5lbmQtMSksYT0ic3lzdGVtIj09PXMmJmkuZ2V0KHRoaXMudmFyaWFibGUpO2E/KGUub3ZlcndyaXRlKHRoaXMuc3RhcnQsdCxgJHtufSAke3RoaXMudmFyaWFibGUuZ2V0TmFtZShyKX0gPSBleHBvcnRzKCcke2FbMF19JywgYCksZS5hcHBlbmRSaWdodChvP3RoaXMuZW5kLTE6dGhpcy5lbmQsIikiKyhvPyIiOiI7IikpKTooZS5vdmVyd3JpdGUodGhpcy5zdGFydCx0LGAke259ICR7dGhpcy52YXJpYWJsZS5nZXROYW1lKHIpfSA9IGApLG98fGUuYXBwZW5kTGVmdCh0aGlzLmVuZCwiOyIpKTt9fXNyLnByb3RvdHlwZS5uZWVkc0JvdW5kYXJpZXM9ITA7Y2xhc3MgaXIgZXh0ZW5kcyBac3tiaW5kKCl7dGhpcy5kZWNsYXJhdGlvbj8uYmluZCgpO31oYXNFZmZlY3RzKGUpe3JldHVybiAhIXRoaXMuZGVjbGFyYXRpb24/Lmhhc0VmZmVjdHMoZSl9aW5pdGlhbGlzZSgpe3RoaXMuY29udGV4dC5hZGRFeHBvcnQodGhpcyk7fXJlbmRlcihlLHQscyl7Y29uc3R7c3RhcnQ6aSxlbmQ6bn09cztudWxsPT09dGhpcy5kZWNsYXJhdGlvbj9lLnJlbW92ZShpLG4pOihlLnJlbW92ZSh0aGlzLnN0YXJ0LHRoaXMuZGVjbGFyYXRpb24uc3RhcnQpLHRoaXMuZGVjbGFyYXRpb24ucmVuZGVyKGUsdCx7ZW5kOm4sc3RhcnQ6aX0pKTt9YXBwbHlEZW9wdGltaXphdGlvbnMoKXt9fWlyLnByb3RvdHlwZS5uZWVkc0JvdW5kYXJpZXM9ITA7Y2xhc3MgbnIgZXh0ZW5kcyBSbntyZW5kZXIoZSx0LHtyZW5kZXJlZFN1cnJvdW5kaW5nRWxlbWVudDpzfT1wZSl7c3VwZXIucmVuZGVyKGUsdCkscz09PU5zJiYoZS5hcHBlbmRSaWdodCh0aGlzLnN0YXJ0LCIoIiksZS5wcmVwZW5kTGVmdCh0aGlzLmVuZCwiKSIpKTt9fWNsYXNzIHJyIGV4dGVuZHMgRW57Y29uc3RydWN0b3IoKXtzdXBlciguLi5hcmd1bWVudHMpLHRoaXMuaG9pc3RlZERlY2xhcmF0aW9ucz1bXTt9YWRkRGVjbGFyYXRpb24oZSx0LHMsaSl7cmV0dXJuIHRoaXMuaG9pc3RlZERlY2xhcmF0aW9ucy5wdXNoKGUpLHN1cGVyLmFkZERlY2xhcmF0aW9uKGUsdCxzLGkpfX1jb25zdCBvcj1TeW1ib2woInVuc2V0Iik7Y2xhc3MgYXIgZXh0ZW5kcyBac3tjb25zdHJ1Y3Rvcigpe3N1cGVyKC4uLmFyZ3VtZW50cyksdGhpcy50ZXN0VmFsdWU9b3I7fWRlb3B0aW1pemVDYWNoZSgpe3RoaXMudGVzdFZhbHVlPXNlO31oYXNFZmZlY3RzKGUpe2lmKHRoaXMudGVzdC5oYXNFZmZlY3RzKGUpKXJldHVybiAhMDtjb25zdCB0PXRoaXMuZ2V0VGVzdFZhbHVlKCk7aWYoInN5bWJvbCI9PXR5cGVvZiB0KXtjb25zdHticm9rZW5GbG93OnR9PWU7aWYodGhpcy5jb25zZXF1ZW50Lmhhc0VmZmVjdHMoZSkpcmV0dXJuICEwO2NvbnN0IHM9ZS5icm9rZW5GbG93O3JldHVybiBlLmJyb2tlbkZsb3c9dCxudWxsPT09dGhpcy5hbHRlcm5hdGU/ITE6ISF0aGlzLmFsdGVybmF0ZS5oYXNFZmZlY3RzKGUpfHwoZS5icm9rZW5GbG93PWUuYnJva2VuRmxvdyYmcywhMSl9cmV0dXJuIHQ/dGhpcy5jb25zZXF1ZW50Lmhhc0VmZmVjdHMoZSk6ISF0aGlzLmFsdGVybmF0ZT8uaGFzRWZmZWN0cyhlKX1pbmNsdWRlKGUsdCl7aWYodGhpcy5pbmNsdWRlZD0hMCx0KXRoaXMuaW5jbHVkZVJlY3Vyc2l2ZWx5KHQsZSk7ZWxzZSB7Y29uc3QgdD10aGlzLmdldFRlc3RWYWx1ZSgpOyJzeW1ib2wiPT10eXBlb2YgdD90aGlzLmluY2x1ZGVVbmtub3duVGVzdChlKTp0aGlzLmluY2x1ZGVLbm93blRlc3QoZSx0KTt9fXBhcnNlTm9kZShlKXt0aGlzLmNvbnNlcXVlbnRTY29wZT1uZXcgcnIodGhpcy5zY29wZSksdGhpcy5jb25zZXF1ZW50PW5ldyh0aGlzLmNvbnRleHQuZ2V0Tm9kZUNvbnN0cnVjdG9yKGUuY29uc2VxdWVudC50eXBlKSkoZS5jb25zZXF1ZW50LHRoaXMsdGhpcy5jb25zZXF1ZW50U2NvcGUpLGUuYWx0ZXJuYXRlJiYodGhpcy5hbHRlcm5hdGVTY29wZT1uZXcgcnIodGhpcy5zY29wZSksdGhpcy5hbHRlcm5hdGU9bmV3KHRoaXMuY29udGV4dC5nZXROb2RlQ29uc3RydWN0b3IoZS5hbHRlcm5hdGUudHlwZSkpKGUuYWx0ZXJuYXRlLHRoaXMsdGhpcy5hbHRlcm5hdGVTY29wZSkpLHN1cGVyLnBhcnNlTm9kZShlKTt9cmVuZGVyKGUsdCl7Y29uc3R7c25pcHBldHM6e2dldFByb3BlcnR5QWNjZXNzOnN9fT10LGk9dGhpcy5nZXRUZXN0VmFsdWUoKSxuPVtdLHI9dGhpcy50ZXN0LmluY2x1ZGVkLG89IXRoaXMuY29udGV4dC5vcHRpb25zLnRyZWVzaGFrZTtyP3RoaXMudGVzdC5yZW5kZXIoZSx0KTplLnJlbW92ZSh0aGlzLnN0YXJ0LHRoaXMuY29uc2VxdWVudC5zdGFydCksdGhpcy5jb25zZXF1ZW50LmluY2x1ZGVkJiYob3x8InN5bWJvbCI9PXR5cGVvZiBpfHxpKT90aGlzLmNvbnNlcXVlbnQucmVuZGVyKGUsdCk6KGUub3ZlcndyaXRlKHRoaXMuY29uc2VxdWVudC5zdGFydCx0aGlzLmNvbnNlcXVlbnQuZW5kLHI/IjsiOiIiKSxuLnB1c2goLi4udGhpcy5jb25zZXF1ZW50U2NvcGUuaG9pc3RlZERlY2xhcmF0aW9ucykpLHRoaXMuYWx0ZXJuYXRlJiYoIXRoaXMuYWx0ZXJuYXRlLmluY2x1ZGVkfHwhbyYmInN5bWJvbCIhPXR5cGVvZiBpJiZpPyhyJiZ0aGlzLnNob3VsZEtlZXBBbHRlcm5hdGVCcmFuY2goKT9lLm92ZXJ3cml0ZSh0aGlzLmFsdGVybmF0ZS5zdGFydCx0aGlzLmVuZCwiOyIpOmUucmVtb3ZlKHRoaXMuY29uc2VxdWVudC5lbmQsdGhpcy5lbmQpLG4ucHVzaCguLi50aGlzLmFsdGVybmF0ZVNjb3BlLmhvaXN0ZWREZWNsYXJhdGlvbnMpKToocj8xMDE9PT1lLm9yaWdpbmFsLmNoYXJDb2RlQXQodGhpcy5hbHRlcm5hdGUuc3RhcnQtMSkmJmUucHJlcGVuZExlZnQodGhpcy5hbHRlcm5hdGUuc3RhcnQsIiAiKTplLnJlbW92ZSh0aGlzLmNvbnNlcXVlbnQuZW5kLHRoaXMuYWx0ZXJuYXRlLnN0YXJ0KSx0aGlzLmFsdGVybmF0ZS5yZW5kZXIoZSx0KSkpLHRoaXMucmVuZGVySG9pc3RlZERlY2xhcmF0aW9ucyhuLGUscyk7fWFwcGx5RGVvcHRpbWl6YXRpb25zKCl7fWdldFRlc3RWYWx1ZSgpe3JldHVybiB0aGlzLnRlc3RWYWx1ZT09PW9yP3RoaXMudGVzdFZhbHVlPXRoaXMudGVzdC5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoSyxlZSx0aGlzKTp0aGlzLnRlc3RWYWx1ZX1pbmNsdWRlS25vd25UZXN0KGUsdCl7dGhpcy50ZXN0LnNob3VsZEJlSW5jbHVkZWQoZSkmJnRoaXMudGVzdC5pbmNsdWRlKGUsITEpLHQmJnRoaXMuY29uc2VxdWVudC5zaG91bGRCZUluY2x1ZGVkKGUpJiZ0aGlzLmNvbnNlcXVlbnQuaW5jbHVkZShlLCExLHthc1NpbmdsZVN0YXRlbWVudDohMH0pLCF0JiZ0aGlzLmFsdGVybmF0ZT8uc2hvdWxkQmVJbmNsdWRlZChlKSYmdGhpcy5hbHRlcm5hdGUuaW5jbHVkZShlLCExLHthc1NpbmdsZVN0YXRlbWVudDohMH0pO31pbmNsdWRlUmVjdXJzaXZlbHkoZSx0KXt0aGlzLnRlc3QuaW5jbHVkZSh0LGUpLHRoaXMuY29uc2VxdWVudC5pbmNsdWRlKHQsZSksdGhpcy5hbHRlcm5hdGU/LmluY2x1ZGUodCxlKTt9aW5jbHVkZVVua25vd25UZXN0KGUpe3RoaXMudGVzdC5pbmNsdWRlKGUsITEpO2NvbnN0e2Jyb2tlbkZsb3c6dH09ZTtsZXQgcz0hMTt0aGlzLmNvbnNlcXVlbnQuc2hvdWxkQmVJbmNsdWRlZChlKSYmKHRoaXMuY29uc2VxdWVudC5pbmNsdWRlKGUsITEse2FzU2luZ2xlU3RhdGVtZW50OiEwfSkscz1lLmJyb2tlbkZsb3csZS5icm9rZW5GbG93PXQpLHRoaXMuYWx0ZXJuYXRlPy5zaG91bGRCZUluY2x1ZGVkKGUpJiYodGhpcy5hbHRlcm5hdGUuaW5jbHVkZShlLCExLHthc1NpbmdsZVN0YXRlbWVudDohMH0pLGUuYnJva2VuRmxvdz1lLmJyb2tlbkZsb3cmJnMpO31yZW5kZXJIb2lzdGVkRGVjbGFyYXRpb25zKGUsdCxzKXtjb25zdCBpPVsuLi5uZXcgU2V0KGUubWFwKChlPT57Y29uc3QgdD1lLnZhcmlhYmxlO3JldHVybiB0LmluY2x1ZGVkP3QuZ2V0TmFtZShzKToiIn0pKSldLmZpbHRlcihCb29sZWFuKS5qb2luKCIsICIpO2lmKGkpe2NvbnN0IGU9dGhpcy5wYXJlbnQudHlwZSxzPWUhPT1EcyYmZSE9PWtzO3QucHJlcGVuZFJpZ2h0KHRoaXMuc3RhcnQsYCR7cz8ieyAiOiIifXZhciAke2l9OyBgKSxzJiZ0LmFwcGVuZExlZnQodGhpcy5lbmQsIiB9Iik7fX1zaG91bGRLZWVwQWx0ZXJuYXRlQnJhbmNoKCl7bGV0IGU9dGhpcy5wYXJlbnQ7ZG97aWYoZSBpbnN0YW5jZW9mIGFyJiZlLmFsdGVybmF0ZSlyZXR1cm4gITA7aWYoZSBpbnN0YW5jZW9mIHZuKXJldHVybiAhMTtlPWUucGFyZW50O313aGlsZShlKTtyZXR1cm4gITF9fWNsYXNzIGxyIGV4dGVuZHMgWnN7YmluZCgpe31oYXNFZmZlY3RzKCl7cmV0dXJuICExfWluaXRpYWxpc2UoKXt0aGlzLmNvbnRleHQuYWRkSW1wb3J0KHRoaXMpO31yZW5kZXIoZSx0LHMpe2UucmVtb3ZlKHMuc3RhcnQscy5lbmQpO31hcHBseURlb3B0aW1pemF0aW9ucygpe319bHIucHJvdG90eXBlLm5lZWRzQm91bmRhcmllcz0hMDtjbGFzcyBjciBleHRlbmRzIFpze2FwcGx5RGVvcHRpbWl6YXRpb25zKCl7fX1jb25zdCBocj0iX2ludGVyb3BEZWZhdWx0Iix1cj0iX2ludGVyb3BEZWZhdWx0Q29tcGF0Iixkcj0iX2ludGVyb3BOYW1lc3BhY2UiLHByPSJfaW50ZXJvcE5hbWVzcGFjZUNvbXBhdCIsZnI9Il9pbnRlcm9wTmFtZXNwYWNlRGVmYXVsdCIsbXI9Il9pbnRlcm9wTmFtZXNwYWNlRGVmYXVsdE9ubHkiLGdyPSJfbWVyZ2VOYW1lc3BhY2VzIix5cj17YXV0bzpocixjb21wYXQ6dXIsZGVmYXVsdDpudWxsLGRlZmF1bHRPbmx5Om51bGwsZXNNb2R1bGU6bnVsbH0seHI9KGUsdCk9PiJlc01vZHVsZSI9PT1lfHx0JiYoImF1dG8iPT09ZXx8ImNvbXBhdCI9PT1lKSxFcj17YXV0bzpkcixjb21wYXQ6cHIsZGVmYXVsdDpmcixkZWZhdWx0T25seTptcixlc01vZHVsZTpudWxsfSxicj0oZSx0KT0+ImVzTW9kdWxlIiE9PWUmJnhyKGUsdCksdnI9KGUsdCxzLGksbixyLG8pPT57Y29uc3QgYT1uZXcgU2V0KGUpO2Zvcihjb25zdCBlIG9mIERyKXQuaGFzKGUpJiZhLmFkZChlKTtyZXR1cm4gRHIubWFwKChlPT5hLmhhcyhlKT9TcltlXShzLGksbixyLG8sYSk6IiIpKS5qb2luKCIiKX0sU3I9e1t1cl0oZSx0LHMpe2NvbnN0e186aSxnZXREaXJlY3RSZXR1cm5GdW5jdGlvbjpuLG46cn09dCxbbyxhXT1uKFsiZSJdLHtmdW5jdGlvblJldHVybjohMCxsaW5lQnJlYWtJbmRlbnQ6bnVsbCxuYW1lOnVyfSk7cmV0dXJuIGAke299JHtJcih0KX0ke2l9PyR7aX0ke3M/QXIodCk6a3IodCl9JHthfSR7cn0ke3J9YH0sW2hyXShlLHQscyl7Y29uc3R7XzppLGdldERpcmVjdFJldHVybkZ1bmN0aW9uOm4sbjpyfT10LFtvLGFdPW4oWyJlIl0se2Z1bmN0aW9uUmV0dXJuOiEwLGxpbmVCcmVha0luZGVudDpudWxsLG5hbWU6aHJ9KTtyZXR1cm4gYCR7b31lJHtpfSYmJHtpfWUuX19lc01vZHVsZSR7aX0/JHtpfSR7cz9Bcih0KTprcih0KX0ke2F9JHtyfSR7cn1gfSxbcHJdKGUsdCxzLGksbixyKXtjb25zdHtfOm8sZ2V0RGlyZWN0UmV0dXJuRnVuY3Rpb246YSxuOmx9PXQ7aWYoci5oYXMoZnIpKXtjb25zdFtlLHNdPWEoWyJlIl0se2Z1bmN0aW9uUmV0dXJuOiEwLGxpbmVCcmVha0luZGVudDpudWxsLG5hbWU6cHJ9KTtyZXR1cm4gYCR7ZX0ke0lyKHQpfSR7b30/JHtvfWUke299OiR7b30ke2ZyfShlKSR7c30ke2x9JHtsfWB9cmV0dXJuIGBmdW5jdGlvbiAke3ByfShlKSR7b317JHtsfSR7ZX1pZiR7b30oJHtJcih0KX0pJHtvfXJldHVybiBlOyR7bH1gK3dyKGUsZSx0LHMsaSxuKStgfSR7bH0ke2x9YH0sW21yXShlLHQscyxpLG4pe2NvbnN0e2dldERpcmVjdFJldHVybkZ1bmN0aW9uOnIsZ2V0T2JqZWN0Om8sbjphfT10LFtsLGNdPXIoWyJlIl0se2Z1bmN0aW9uUmV0dXJuOiEwLGxpbmVCcmVha0luZGVudDpudWxsLG5hbWU6bXJ9KTtyZXR1cm4gYCR7bH0ke01yKGksT3IobixvKFtbIl9fcHJvdG9fXyIsIm51bGwiXSxbImRlZmF1bHQiLCJlIl1dLHtsaW5lQnJlYWtJbmRlbnQ6bnVsbH0pLHQpKX0ke2N9JHthfSR7YX1gfSxbZnJdKGUsdCxzLGksbil7Y29uc3R7XzpyLG46b309dDtyZXR1cm4gYGZ1bmN0aW9uICR7ZnJ9KGUpJHtyfXske299YCt3cihlLGUsdCxzLGksbikrYH0ke299JHtvfWB9LFtkcl0oZSx0LHMsaSxuLHIpe2NvbnN0e186byxnZXREaXJlY3RSZXR1cm5GdW5jdGlvbjphLG46bH09dDtpZihyLmhhcyhmcikpe2NvbnN0W2UsdF09YShbImUiXSx7ZnVuY3Rpb25SZXR1cm46ITAsbGluZUJyZWFrSW5kZW50Om51bGwsbmFtZTpkcn0pO3JldHVybiBgJHtlfWUke299JiYke299ZS5fX2VzTW9kdWxlJHtvfT8ke299ZSR7b306JHtvfSR7ZnJ9KGUpJHt0fSR7bH0ke2x9YH1yZXR1cm4gYGZ1bmN0aW9uICR7ZHJ9KGUpJHtvfXske2x9JHtlfWlmJHtvfShlJHtvfSYmJHtvfWUuX19lc01vZHVsZSkke299cmV0dXJuIGU7JHtsfWArd3IoZSxlLHQscyxpLG4pK2B9JHtsfSR7bH1gfSxbZ3JdKGUsdCxzLGksbil7Y29uc3R7XzpyLGNuc3Q6byxuOmF9PXQsbD0idmFyIj09PW8mJnM7cmV0dXJuIGBmdW5jdGlvbiAke2dyfShuLCBtKSR7cn17JHthfSR7ZX0ke0NyKGB7JHthfSR7ZX0ke2V9JHtlfWlmJHtyfShrJHtyfSE9PSR7cn0nZGVmYXVsdCcke3J9JiYke3J9IShrIGluIG4pKSR7cn17JHthfWArKHM/bD9OcjpfcjpScikoZSxlK2UrZStlLHQpK2Ake2V9JHtlfSR7ZX19JHthfWArYCR7ZX0ke2V9fWAsbCxlLHQpfSR7YX0ke2V9cmV0dXJuICR7TXIoaSxPcihuLCJuIix0KSl9OyR7YX19JHthfSR7YX1gfX0sQXI9KHtfOmUsZ2V0T2JqZWN0OnR9KT0+YGUke2V9OiR7ZX0ke3QoW1siZGVmYXVsdCIsImUiXV0se2xpbmVCcmVha0luZGVudDpudWxsfSl9YCxrcj0oe186ZSxnZXRQcm9wZXJ0eUFjY2Vzczp0fSk9PmBlJHt0KCJkZWZhdWx0Iil9JHtlfToke2V9ZWAsSXI9KHtfOmV9KT0+YGUke2V9JiYke2V9dHlwZW9mIGUke2V9PT09JHtlfSdvYmplY3QnJHtlfSYmJHtlfSdkZWZhdWx0JyR7ZX1pbiBlYCx3cj0oZSx0LHMsaSxuLHIpPT57Y29uc3R7XzpvLGNuc3Q6YSxnZXRPYmplY3Q6bCxnZXRQcm9wZXJ0eUFjY2VzczpjLG46aCxzOnV9PXMsZD1geyR7aH1gKyhpPyRyOlJyKShlLHQrZStlLHMpK2Ake3R9JHtlfX1gO3JldHVybiBgJHt0fSR7YX0gbiR7b309JHtvfU9iamVjdC5jcmVhdGUobnVsbCR7cj9gLCR7b317JHtvfVtTeW1ib2wudG9TdHJpbmdUYWddOiR7b30ke0xyKGwpfSR7b319YDoiIn0pOyR7aH0ke3R9aWYke299KGUpJHtvfXske2h9JHt0fSR7ZX0ke1ByKGQsIWkscyl9JHtofSR7dH19JHtofSR7dH1uJHtjKCJkZWZhdWx0Iil9JHtvfT0ke299ZTske2h9JHt0fXJldHVybiAke01yKG4sIm4iKX0ke3V9JHtofWB9LFByPShlLHQse186cyxjbnN0OmksZ2V0RnVuY3Rpb25JbnRybzpuLHM6cn0pPT4idmFyIiE9PWl8fHQ/YGZvciR7c30oJHtpfSBrIGluIGUpJHtzfSR7ZX1gOmBPYmplY3Qua2V5cyhlKS5mb3JFYWNoKCR7bihbImsiXSx7aXNBc3luYzohMSxuYW1lOm51bGx9KX0ke2V9KSR7cn1gLENyPShlLHQscyx7XzppLGNuc3Q6bixnZXREaXJlY3RSZXR1cm5GdW5jdGlvbjpyLGdldEZ1bmN0aW9uSW50cm86byxuOmF9KT0+e2lmKHQpe2NvbnN0W3Qsbl09cihbImUiXSx7ZnVuY3Rpb25SZXR1cm46ITEsbGluZUJyZWFrSW5kZW50OntiYXNlOnMsdDpzfSxuYW1lOm51bGx9KTtyZXR1cm4gYG0uZm9yRWFjaCgke3R9ZSR7aX0mJiR7aX10eXBlb2YgZSR7aX0hPT0ke2l9J3N0cmluZycke2l9JiYke2l9IUFycmF5LmlzQXJyYXkoZSkke2l9JiYke2l9T2JqZWN0LmtleXMoZSkuZm9yRWFjaCgke28oWyJrIl0se2lzQXN5bmM6ITEsbmFtZTpudWxsfSl9JHtlfSkke259KTtgfXJldHVybiBgZm9yJHtpfSh2YXIgaSR7aX09JHtpfTA7JHtpfWkke2l9PCR7aX1tLmxlbmd0aDske2l9aSsrKSR7aX17JHthfSR7c30ke3N9JHtufSBlJHtpfT0ke2l9bVtpXTske2F9JHtzfSR7c31pZiR7aX0odHlwZW9mIGUke2l9IT09JHtpfSdzdHJpbmcnJHtpfSYmJHtpfSFBcnJheS5pc0FycmF5KGUpKSR7aX17JHtpfWZvciR7aX0oJHtufSBrIGluIGUpJHtpfSR7ZX0ke2l9fSR7YX0ke3N9fWB9LCRyPShlLHQscyk9Pntjb25zdHtfOmksbjpufT1zO3JldHVybiBgJHt0fWlmJHtpfShrJHtpfSE9PSR7aX0nZGVmYXVsdCcpJHtpfXske259YCtOcihlLHQrZSxzKStgJHt0fX0ke259YH0sTnI9KGUsdCx7XzpzLGNuc3Q6aSxnZXREaXJlY3RSZXR1cm5GdW5jdGlvbjpuLG46cn0pPT57Y29uc3RbbyxhXT1uKFtdLHtmdW5jdGlvblJldHVybjohMCxsaW5lQnJlYWtJbmRlbnQ6bnVsbCxuYW1lOm51bGx9KTtyZXR1cm4gYCR7dH0ke2l9IGQke3N9PSR7c31PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGUsJHtzfWspOyR7cn0ke3R9T2JqZWN0LmRlZmluZVByb3BlcnR5KG4sJHtzfWssJHtzfWQuZ2V0JHtzfT8ke3N9ZCR7c306JHtzfXske3J9JHt0fSR7ZX1lbnVtZXJhYmxlOiR7c310cnVlLCR7cn0ke3R9JHtlfWdldDoke3N9JHtvfWVba10ke2F9JHtyfSR7dH19KTske3J9YH0sX3I9KGUsdCx7XzpzLGNuc3Q6aSxnZXREaXJlY3RSZXR1cm5GdW5jdGlvbjpuLG46cn0pPT57Y29uc3RbbyxhXT1uKFtdLHtmdW5jdGlvblJldHVybjohMCxsaW5lQnJlYWtJbmRlbnQ6bnVsbCxuYW1lOm51bGx9KTtyZXR1cm4gYCR7dH0ke2l9IGQke3N9PSR7c31PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGUsJHtzfWspOyR7cn0ke3R9aWYke3N9KGQpJHtzfXske3J9JHt0fSR7ZX1PYmplY3QuZGVmaW5lUHJvcGVydHkobiwke3N9aywke3N9ZC5nZXQke3N9PyR7c31kJHtzfToke3N9eyR7cn0ke3R9JHtlfSR7ZX1lbnVtZXJhYmxlOiR7c310cnVlLCR7cn0ke3R9JHtlfSR7ZX1nZXQ6JHtzfSR7b31lW2tdJHthfSR7cn0ke3R9JHtlfX0pOyR7cn0ke3R9fSR7cn1gfSxScj0oZSx0LHtfOnMsbjppfSk9PmAke3R9bltrXSR7c309JHtzfWVba107JHtpfWAsTXI9KGUsdCk9PmU/YE9iamVjdC5mcmVlemUoJHt0fSlgOnQsT3I9KGUsdCx7XzpzLGdldE9iamVjdDppfSk9PmU/YE9iamVjdC5kZWZpbmVQcm9wZXJ0eSgke3R9LCR7c31TeW1ib2wudG9TdHJpbmdUYWcsJHtzfSR7THIoaSl9KWA6dCxEcj1PYmplY3Qua2V5cyhTcik7ZnVuY3Rpb24gTHIoZSl7cmV0dXJuIGUoW1sidmFsdWUiLCInTW9kdWxlJyJdXSx7bGluZUJyZWFrSW5kZW50Om51bGx9KX1mdW5jdGlvbiBUcihlLHQpe3JldHVybiBudWxsIT09ZS5yZW5kZXJCYXNlTmFtZSYmdC5oYXMoZSkmJmUuaXNSZWFzc2lnbmVkfWNsYXNzIFZyIGV4dGVuZHMgWnN7ZGVjbGFyZURlY2xhcmF0b3IoZSl7dGhpcy5pZC5kZWNsYXJlKGUsdGhpcy5pbml0fHxpcyk7fWRlb3B0aW1pemVQYXRoKGUpe3RoaXMuaWQuZGVvcHRpbWl6ZVBhdGgoZSk7fWhhc0VmZmVjdHMoZSl7dGhpcy5kZW9wdGltaXplZHx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpO2NvbnN0IHQ9dGhpcy5pbml0Py5oYXNFZmZlY3RzKGUpO3JldHVybiB0aGlzLmlkLm1hcmtEZWNsYXJhdGlvblJlYWNoZWQoKSx0fHx0aGlzLmlkLmhhc0VmZmVjdHMoZSl9aW5jbHVkZShlLHQpe2NvbnN0e2Rlb3B0aW1pemVkOnMsaWQ6aSxpbml0Om59PXRoaXM7c3x8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLHRoaXMuaW5jbHVkZWQ9ITAsbj8uaW5jbHVkZShlLHQpLGkubWFya0RlY2xhcmF0aW9uUmVhY2hlZCgpLCh0fHxpLnNob3VsZEJlSW5jbHVkZWQoZSkpJiZpLmluY2x1ZGUoZSx0KTt9cmVuZGVyKGUsdCl7Y29uc3R7ZXhwb3J0TmFtZXNCeVZhcmlhYmxlOnMsc25pcHBldHM6e186aSxnZXRQcm9wZXJ0eUFjY2VzczpufX09dCx7ZW5kOnIsaWQ6byxpbml0OmEsc3RhcnQ6bH09dGhpcyxjPW8uaW5jbHVkZWQ7aWYoYylvLnJlbmRlcihlLHQpO2Vsc2Uge2NvbnN0IHQ9ZG4oZS5vcmlnaW5hbCwiPSIsby5lbmQpO2UucmVtb3ZlKGwsZm4oZS5vcmlnaW5hbCx0KzEpKTt9aWYoYSl7aWYobyBpbnN0YW5jZW9mIGFuJiZhIGluc3RhbmNlb2YgWG4mJiFhLmlkKXtvLnZhcmlhYmxlLmdldE5hbWUobikhPT1vLm5hbWUmJmUuYXBwZW5kTGVmdChhLnN0YXJ0KzUsYCAke28ubmFtZX1gKTt9YS5yZW5kZXIoZSx0LGM/cGU6e3JlbmRlcmVkU3Vycm91bmRpbmdFbGVtZW50Ok5zfSk7fWVsc2UgbyBpbnN0YW5jZW9mIGFuJiZUcihvLnZhcmlhYmxlLHMpJiZlLmFwcGVuZExlZnQocixgJHtpfT0ke2l9dm9pZCAwYCk7fWFwcGx5RGVvcHRpbWl6YXRpb25zKCl7dGhpcy5kZW9wdGltaXplZD0hMDtjb25zdHtpZDplLGluaXQ6dH09dGhpcztpZih0JiZlIGluc3RhbmNlb2YgYW4mJnQgaW5zdGFuY2VvZiBYbiYmIXQuaWQpe2NvbnN0e25hbWU6cyx2YXJpYWJsZTppfT1lO2Zvcihjb25zdCBlIG9mIHQuc2NvcGUuYWNjZXNzZWRPdXRzaWRlVmFyaWFibGVzLnZhbHVlcygpKWUhPT1pJiZlLmZvcmJpZE5hbWUocyk7fX19ZnVuY3Rpb24gQnIoZSx0LHMpe3JldHVybiAiZXh0ZXJuYWwiPT09dD9FcltzKGUgaW5zdGFuY2VvZiBRdD9lLmlkOm51bGwpXToiZGVmYXVsdCI9PT10P21yOm51bGx9Y29uc3QgenI9e2FtZDpbInJlcXVpcmUiXSxjanM6WyJyZXF1aXJlIl0sc3lzdGVtOlsibW9kdWxlIl19O2Z1bmN0aW9uIEZyKGUpe2NvbnN0IHQ9W107Zm9yKGNvbnN0IHMgb2YgZS5wcm9wZXJ0aWVzKXtpZigiUmVzdEVsZW1lbnQiPT09cy50eXBlfHxzLmNvbXB1dGVkfHwiSWRlbnRpZmllciIhPT1zLmtleS50eXBlKXJldHVybjt0LnB1c2gocy5rZXkubmFtZSk7fXJldHVybiB0fWNsYXNzIGpyIGV4dGVuZHMgWnN7YXBwbHlEZW9wdGltaXphdGlvbnMoKXt9fWNvbnN0IFVyPSJST0xMVVBfRklMRV9VUkxfIixHcj0iaW1wb3J0Ijtjb25zdCBXcj17YW1kOlsiZG9jdW1lbnQiLCJtb2R1bGUiLCJVUkwiXSxjanM6WyJkb2N1bWVudCIsInJlcXVpcmUiLCJVUkwiXSxlczpbXSxpaWZlOlsiZG9jdW1lbnQiLCJVUkwiXSxzeXN0ZW06WyJtb2R1bGUiXSx1bWQ6WyJkb2N1bWVudCIsInJlcXVpcmUiLCJVUkwiXX0scXI9e2FtZDpbImRvY3VtZW50IiwicmVxdWlyZSIsIlVSTCJdLGNqczpbImRvY3VtZW50IiwicmVxdWlyZSIsIlVSTCJdLGVzOltdLGlpZmU6WyJkb2N1bWVudCIsIlVSTCJdLHN5c3RlbTpbIm1vZHVsZSIsIlVSTCJdLHVtZDpbImRvY3VtZW50IiwicmVxdWlyZSIsIlVSTCJdfSxIcj0oZSx0PSJVUkwiKT0+YG5ldyAke3R9KCR7ZX0pLmhyZWZgLEtyPShlLHQ9ITEpPT5IcihgJyR7TyhlKX0nLCAke3Q/InR5cGVvZiBkb2N1bWVudCA9PT0gJ3VuZGVmaW5lZCcgPyBsb2NhdGlvbi5ocmVmIDogIjoiIn1kb2N1bWVudC5jdXJyZW50U2NyaXB0ICYmIGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuc3JjIHx8IGRvY3VtZW50LmJhc2VVUklgKSxZcj1lPT4odCx7Y2h1bmtJZDpzfSk9Pntjb25zdCBpPWUocyk7cmV0dXJuIG51bGw9PT10P2AoeyB1cmw6ICR7aX0gfSlgOiJ1cmwiPT09dD9pOiJ1bmRlZmluZWQifSxYcj1lPT5gcmVxdWlyZSgndScgKyAncmwnKS5wYXRoVG9GaWxlVVJMKCR7ZX0pLmhyZWZgLFFyPWU9PlhyKGBfX2Rpcm5hbWUgKyAnLyR7ZX0nYCksWnI9KGUsdD0hMSk9PmAke3Q/InR5cGVvZiBkb2N1bWVudCA9PT0gJ3VuZGVmaW5lZCcgPyBsb2NhdGlvbi5ocmVmIDogIjoiIn0oZG9jdW1lbnQuY3VycmVudFNjcmlwdCAmJiBkb2N1bWVudC5jdXJyZW50U2NyaXB0LnNyYyB8fCBuZXcgVVJMKCcke08oZSl9JywgZG9jdW1lbnQuYmFzZVVSSSkuaHJlZilgLEpyPXthbWQ6ZT0+KCIuIiE9PWVbMF0mJihlPSIuLyIrZSksSHIoYHJlcXVpcmUudG9VcmwoJyR7ZX0nKSwgZG9jdW1lbnQuYmFzZVVSSWApKSxjanM6ZT0+YCh0eXBlb2YgZG9jdW1lbnQgPT09ICd1bmRlZmluZWQnID8gJHtRcihlKX0gOiAke0tyKGUpfSlgLGVzOmU9PkhyKGAnJHtlfScsIGltcG9ydC5tZXRhLnVybGApLGlpZmU6ZT0+S3IoZSksc3lzdGVtOmU9PkhyKGAnJHtlfScsIG1vZHVsZS5tZXRhLnVybGApLHVtZDplPT5gKHR5cGVvZiBkb2N1bWVudCA9PT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIGxvY2F0aW9uID09PSAndW5kZWZpbmVkJyA/ICR7UXIoZSl9IDogJHtLcihlLCEwKX0pYH0sZW89e2FtZDpZcigoKCk9PkhyKCJtb2R1bGUudXJpLCBkb2N1bWVudC5iYXNlVVJJIikpKSxjanM6WXIoKGU9PmAodHlwZW9mIGRvY3VtZW50ID09PSAndW5kZWZpbmVkJyA/ICR7WHIoIl9fZmlsZW5hbWUiKX0gOiAke1pyKGUpfSlgKSksaWlmZTpZcigoZT0+WnIoZSkpKSxzeXN0ZW06KGUse3NuaXBwZXRzOntnZXRQcm9wZXJ0eUFjY2Vzczp0fX0pPT5udWxsPT09ZT8ibW9kdWxlLm1ldGEiOmBtb2R1bGUubWV0YSR7dChlKX1gLHVtZDpZcigoZT0+YCh0eXBlb2YgZG9jdW1lbnQgPT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBsb2NhdGlvbiA9PT0gJ3VuZGVmaW5lZCcgPyAke1hyKCJfX2ZpbGVuYW1lIil9IDogJHtacihlLCEwKX0pYCkpfTtjbGFzcyB0byBleHRlbmRzIFpze2NvbnN0cnVjdG9yKCl7c3VwZXIoLi4uYXJndW1lbnRzKSx0aGlzLmhhc0NhY2hlZEVmZmVjdD1udWxsLHRoaXMuaGFzTG9nZ2VkRWZmZWN0PSExO31oYXNDYWNoZWRFZmZlY3RzKCl7cmV0dXJuICEhdGhpcy5pbmNsdWRlZCYmKG51bGw9PT10aGlzLmhhc0NhY2hlZEVmZmVjdD90aGlzLmhhc0NhY2hlZEVmZmVjdD10aGlzLmhhc0VmZmVjdHModHMoKSk6dGhpcy5oYXNDYWNoZWRFZmZlY3QpfWhhc0VmZmVjdHMoZSl7Zm9yKGNvbnN0IHQgb2YgdGhpcy5ib2R5KWlmKHQuaGFzRWZmZWN0cyhlKSl7aWYodGhpcy5jb250ZXh0Lm9wdGlvbnMuZXhwZXJpbWVudGFsTG9nU2lkZUVmZmVjdHMmJiF0aGlzLmhhc0xvZ2dlZEVmZmVjdCl7dGhpcy5oYXNMb2dnZWRFZmZlY3Q9ITA7Y29uc3R7Y29kZTplLGxvZzpzLG1vZHVsZTppfT10aGlzLmNvbnRleHQ7cyhTZSxEdChlLGkuaWQsd2UoZSx0LnN0YXJ0LHtvZmZzZXRMaW5lOjF9KSksdC5zdGFydCk7fXJldHVybiB0aGlzLmhhc0NhY2hlZEVmZmVjdD0hMH1yZXR1cm4gITF9aW5jbHVkZShlLHQpe3RoaXMuaW5jbHVkZWQ9ITA7Zm9yKGNvbnN0IHMgb2YgdGhpcy5ib2R5KSh0fHxzLnNob3VsZEJlSW5jbHVkZWQoZSkpJiZzLmluY2x1ZGUoZSx0KTt9cmVuZGVyKGUsdCl7bGV0IHM9dGhpcy5zdGFydDtpZihlLm9yaWdpbmFsLnN0YXJ0c1dpdGgoIiMhIikmJihzPU1hdGgubWluKGUub3JpZ2luYWwuaW5kZXhPZigiXG4iKSsxLHRoaXMuZW5kKSxlLnJlbW92ZSgwLHMpKSx0aGlzLmJvZHkubGVuZ3RoPjApe2Zvcig7Ii8iPT09ZS5vcmlnaW5hbFtzXSYmL1sqL10vLnRlc3QoZS5vcmlnaW5hbFtzKzFdKTspe2NvbnN0IHQ9bW4oZS5vcmlnaW5hbC5zbGljZShzLHRoaXMuYm9keVswXS5zdGFydCkpO2lmKC0xPT09dFswXSlicmVhaztzKz10WzFdO31nbih0aGlzLmJvZHksZSxzLHRoaXMuZW5kLHQpO31lbHNlIHN1cGVyLnJlbmRlcihlLHQpO31hcHBseURlb3B0aW1pemF0aW9ucygpe319Y2xhc3Mgc28gZXh0ZW5kcyBac3toYXNFZmZlY3RzKGUpe2lmKHRoaXMudGVzdD8uaGFzRWZmZWN0cyhlKSlyZXR1cm4gITA7Zm9yKGNvbnN0IHQgb2YgdGhpcy5jb25zZXF1ZW50KXtpZihlLmJyb2tlbkZsb3cpYnJlYWs7aWYodC5oYXNFZmZlY3RzKGUpKXJldHVybiAhMH1yZXR1cm4gITF9aW5jbHVkZShlLHQpe3RoaXMuaW5jbHVkZWQ9ITAsdGhpcy50ZXN0Py5pbmNsdWRlKGUsdCk7Zm9yKGNvbnN0IHMgb2YgdGhpcy5jb25zZXF1ZW50KSh0fHxzLnNob3VsZEJlSW5jbHVkZWQoZSkpJiZzLmluY2x1ZGUoZSx0KTt9cmVuZGVyKGUsdCxzKXtpZih0aGlzLmNvbnNlcXVlbnQubGVuZ3RoPjApe3RoaXMudGVzdCYmdGhpcy50ZXN0LnJlbmRlcihlLHQpO2NvbnN0IGk9dGhpcy50ZXN0P3RoaXMudGVzdC5lbmQ6ZG4oZS5vcmlnaW5hbCwiZGVmYXVsdCIsdGhpcy5zdGFydCkrNyxuPWRuKGUub3JpZ2luYWwsIjoiLGkpKzE7Z24odGhpcy5jb25zZXF1ZW50LGUsbixzLmVuZCx0KTt9ZWxzZSBzdXBlci5yZW5kZXIoZSx0KTt9fXNvLnByb3RvdHlwZS5uZWVkc0JvdW5kYXJpZXM9ITA7Y2xhc3MgaW8gZXh0ZW5kcyBac3tkZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aCgpe31nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSl7cmV0dXJuIGUubGVuZ3RoPjB8fDEhPT10aGlzLnF1YXNpcy5sZW5ndGg/c2U6dGhpcy5xdWFzaXNbMF0udmFsdWUuY29va2VkfWdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUpe3JldHVybiAxIT09ZS5sZW5ndGg/b2U6eHMoZ3MsZVswXSl9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3JldHVybiAwPT09dC50eXBlP2UubGVuZ3RoPjE6MiE9PXQudHlwZXx8MSE9PWUubGVuZ3RofHx5cyhncyxlWzBdLHQscyl9cmVuZGVyKGUsdCl7ZS5pbmRlbnRFeGNsdXNpb25SYW5nZXMucHVzaChbdGhpcy5zdGFydCx0aGlzLmVuZF0pLHN1cGVyLnJlbmRlcihlLHQpO319Y2xhc3Mgbm8gZXh0ZW5kcyB1ZXtjb25zdHJ1Y3Rvcigpe3N1cGVyKCJ1bmRlZmluZWQiKTt9Z2V0TGl0ZXJhbFZhbHVlQXRQYXRoKCl7fX1jbGFzcyBybyBleHRlbmRzIElpe2NvbnN0cnVjdG9yKGUsdCxzKXtzdXBlcihlLHQsdC5kZWNsYXJhdGlvbixzKSx0aGlzLmhhc0lkPSExLHRoaXMub3JpZ2luYWxJZD1udWxsLHRoaXMub3JpZ2luYWxWYXJpYWJsZT1udWxsO2NvbnN0IGk9dC5kZWNsYXJhdGlvbjsoaSBpbnN0YW5jZW9mIHRyfHxpIGluc3RhbmNlb2YgWW4pJiZpLmlkPyh0aGlzLmhhc0lkPSEwLHRoaXMub3JpZ2luYWxJZD1pLmlkKTppIGluc3RhbmNlb2YgYW4mJih0aGlzLm9yaWdpbmFsSWQ9aSk7fWFkZFJlZmVyZW5jZShlKXt0aGlzLmhhc0lkfHwodGhpcy5uYW1lPWUubmFtZSk7fWZvcmJpZE5hbWUoZSl7Y29uc3QgdD10aGlzLmdldE9yaWdpbmFsVmFyaWFibGUoKTt0PT09dGhpcz9zdXBlci5mb3JiaWROYW1lKGUpOnQuZm9yYmlkTmFtZShlKTt9Z2V0QXNzaWduZWRWYXJpYWJsZU5hbWUoKXtyZXR1cm4gdGhpcy5vcmlnaW5hbElkJiZ0aGlzLm9yaWdpbmFsSWQubmFtZXx8bnVsbH1nZXRCYXNlVmFyaWFibGVOYW1lKCl7Y29uc3QgZT10aGlzLmdldE9yaWdpbmFsVmFyaWFibGUoKTtyZXR1cm4gZT09PXRoaXM/c3VwZXIuZ2V0QmFzZVZhcmlhYmxlTmFtZSgpOmUuZ2V0QmFzZVZhcmlhYmxlTmFtZSgpfWdldERpcmVjdE9yaWdpbmFsVmFyaWFibGUoKXtyZXR1cm4gIXRoaXMub3JpZ2luYWxJZHx8IXRoaXMuaGFzSWQmJih0aGlzLm9yaWdpbmFsSWQuaXNQb3NzaWJsZVREWigpfHx0aGlzLm9yaWdpbmFsSWQudmFyaWFibGUuaXNSZWFzc2lnbmVkfHx0aGlzLm9yaWdpbmFsSWQudmFyaWFibGUgaW5zdGFuY2VvZiBub3x8InN5bnRoZXRpY05hbWVzcGFjZSJpbiB0aGlzLm9yaWdpbmFsSWQudmFyaWFibGUpP251bGw6dGhpcy5vcmlnaW5hbElkLnZhcmlhYmxlfWdldE5hbWUoZSl7Y29uc3QgdD10aGlzLmdldE9yaWdpbmFsVmFyaWFibGUoKTtyZXR1cm4gdD09PXRoaXM/c3VwZXIuZ2V0TmFtZShlKTp0LmdldE5hbWUoZSl9Z2V0T3JpZ2luYWxWYXJpYWJsZSgpe2lmKHRoaXMub3JpZ2luYWxWYXJpYWJsZSlyZXR1cm4gdGhpcy5vcmlnaW5hbFZhcmlhYmxlO2xldCBlLHQ9dGhpcztjb25zdCBzPW5ldyBTZXQ7ZG97cy5hZGQodCksZT10LHQ9ZS5nZXREaXJlY3RPcmlnaW5hbFZhcmlhYmxlKCk7fXdoaWxlKHQgaW5zdGFuY2VvZiBybyYmIXMuaGFzKHQpKTtyZXR1cm4gdGhpcy5vcmlnaW5hbFZhcmlhYmxlPXR8fGV9fWNsYXNzIG9vIGV4dGVuZHMgTGl7Y29uc3RydWN0b3IoZSx0KXtzdXBlcihlKSx0aGlzLmNvbnRleHQ9dCx0aGlzLnZhcmlhYmxlcy5zZXQoInRoaXMiLG5ldyBJaSgidGhpcyIsbnVsbCxpcyx0KSk7fWFkZEV4cG9ydERlZmF1bHREZWNsYXJhdGlvbihlLHQscyl7Y29uc3QgaT1uZXcgcm8oZSx0LHMpO3JldHVybiB0aGlzLnZhcmlhYmxlcy5zZXQoImRlZmF1bHQiLGkpLGl9YWRkTmFtZXNwYWNlTWVtYmVyQWNjZXNzKCl7fWRlY29uZmxpY3QoZSx0LHMpe2Zvcihjb25zdCBpIG9mIHRoaXMuY2hpbGRyZW4paS5kZWNvbmZsaWN0KGUsdCxzKTt9ZmluZExleGljYWxCb3VuZGFyeSgpe3JldHVybiB0aGlzfWZpbmRWYXJpYWJsZShlKXtjb25zdCB0PXRoaXMudmFyaWFibGVzLmdldChlKXx8dGhpcy5hY2Nlc3NlZE91dHNpZGVWYXJpYWJsZXMuZ2V0KGUpO2lmKHQpcmV0dXJuIHQ7Y29uc3Qgcz10aGlzLmNvbnRleHQudHJhY2VWYXJpYWJsZShlKXx8dGhpcy5wYXJlbnQuZmluZFZhcmlhYmxlKGUpO3JldHVybiBzIGluc3RhbmNlb2Ygcm4mJnRoaXMuYWNjZXNzZWRPdXRzaWRlVmFyaWFibGVzLnNldChlLHMpLHN9fWNvbnN0IGFvPXsiISI6ZT0+IWUsIisiOmU9PitlLCItIjplPT4tZSxkZWxldGU6KCk9PnNlLHR5cGVvZjplPT50eXBlb2YgZSx2b2lkOigpPT57fSwifiI6ZT0+fmV9O2NsYXNzIGxvIGV4dGVuZHMgWnN7ZGVvcHRpbWl6ZVBhdGgoKXtmb3IoY29uc3QgZSBvZiB0aGlzLmRlY2xhcmF0aW9ucyllLmRlb3B0aW1pemVQYXRoKEspO31oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aCgpe3JldHVybiAhMX1pbmNsdWRlKGUsdCx7YXNTaW5nbGVTdGF0ZW1lbnQ6c309cGUpe3RoaXMuaW5jbHVkZWQ9ITA7Zm9yKGNvbnN0IGkgb2YgdGhpcy5kZWNsYXJhdGlvbnMpeyh0fHxpLnNob3VsZEJlSW5jbHVkZWQoZSkpJiZpLmluY2x1ZGUoZSx0KTtjb25zdHtpZDpuLGluaXQ6cn09aTtzJiZuLmluY2x1ZGUoZSx0KSxyJiZuLmluY2x1ZGVkJiYhci5pbmNsdWRlZCYmKG4gaW5zdGFuY2VvZiBDbnx8biBpbnN0YW5jZW9mIGtpKSYmci5pbmNsdWRlKGUsdCk7fX1pbml0aWFsaXNlKCl7Zm9yKGNvbnN0IGUgb2YgdGhpcy5kZWNsYXJhdGlvbnMpZS5kZWNsYXJlRGVjbGFyYXRvcih0aGlzLmtpbmQpO31yZW5kZXIoZSx0LHM9cGUpe2lmKGZ1bmN0aW9uKGUsdCl7Zm9yKGNvbnN0IHMgb2YgZSl7aWYoIXMuaWQuaW5jbHVkZWQpcmV0dXJuICExO2lmKHMuaWQudHlwZT09PVJzKXtpZih0LmhhcyhzLmlkLnZhcmlhYmxlKSlyZXR1cm4gITF9ZWxzZSB7Y29uc3QgZT1bXTtpZihzLmlkLmFkZEV4cG9ydGVkVmFyaWFibGVzKGUsdCksZS5sZW5ndGg+MClyZXR1cm4gITF9fXJldHVybiAhMH0odGhpcy5kZWNsYXJhdGlvbnMsdC5leHBvcnROYW1lc0J5VmFyaWFibGUpKXtmb3IoY29uc3QgcyBvZiB0aGlzLmRlY2xhcmF0aW9ucylzLnJlbmRlcihlLHQpO3MuaXNOb1N0YXRlbWVudHx8NTk9PT1lLm9yaWdpbmFsLmNoYXJDb2RlQXQodGhpcy5lbmQtMSl8fGUuYXBwZW5kTGVmdCh0aGlzLmVuZCwiOyIpO31lbHNlIHRoaXMucmVuZGVyUmVwbGFjZWREZWNsYXJhdGlvbnMoZSx0KTt9YXBwbHlEZW9wdGltaXphdGlvbnMoKXt9cmVuZGVyRGVjbGFyYXRpb25FbmQoZSx0LHMsaSxuLHIsbyl7NTk9PT1lLm9yaWdpbmFsLmNoYXJDb2RlQXQodGhpcy5lbmQtMSkmJmUucmVtb3ZlKHRoaXMuZW5kLTEsdGhpcy5lbmQpLHQrPSI7IixudWxsPT09cz9lLmFwcGVuZExlZnQobix0KTooMTAhPT1lLm9yaWdpbmFsLmNoYXJDb2RlQXQoaS0xKXx8MTAhPT1lLm9yaWdpbmFsLmNoYXJDb2RlQXQodGhpcy5lbmQpJiYxMyE9PWUub3JpZ2luYWwuY2hhckNvZGVBdCh0aGlzLmVuZCl8fChpLS0sMTM9PT1lLm9yaWdpbmFsLmNoYXJDb2RlQXQoaSkmJmktLSksaT09PXMrMT9lLm92ZXJ3cml0ZShzLG4sdCk6KGUub3ZlcndyaXRlKHMscysxLHQpLGUucmVtb3ZlKGksbikpKSxyLmxlbmd0aD4wJiZlLmFwcGVuZExlZnQobixgICR7SW4ocixvKX07YCk7fXJlbmRlclJlcGxhY2VkRGVjbGFyYXRpb25zKGUsdCl7Y29uc3Qgcz15bih0aGlzLmRlY2xhcmF0aW9ucyxlLHRoaXMuc3RhcnQrdGhpcy5raW5kLmxlbmd0aCx0aGlzLmVuZC0oNTk9PT1lLm9yaWdpbmFsLmNoYXJDb2RlQXQodGhpcy5lbmQtMSk/MTowKSk7bGV0IGksbjtuPWZuKGUub3JpZ2luYWwsdGhpcy5zdGFydCt0aGlzLmtpbmQubGVuZ3RoKTtsZXQgcj1uLTE7ZS5yZW1vdmUodGhpcy5zdGFydCxyKTtsZXQgbyxsPSExLGM9ITEsaD0iIjtjb25zdCB1PVtdLGQ9ZnVuY3Rpb24oZSx0LHMpe2xldCBpPW51bGw7aWYoInN5c3RlbSI9PT10LmZvcm1hdCl7Zm9yKGNvbnN0e25vZGU6bn1vZiBlKW4uaWQgaW5zdGFuY2VvZiBhbiYmbi5pbml0JiYwPT09cy5sZW5ndGgmJjE9PT10LmV4cG9ydE5hbWVzQnlWYXJpYWJsZS5nZXQobi5pZC52YXJpYWJsZSk/Lmxlbmd0aD8oaT1uLmlkLnZhcmlhYmxlLHMucHVzaChpKSk6bi5pZC5hZGRFeHBvcnRlZFZhcmlhYmxlcyhzLHQuZXhwb3J0TmFtZXNCeVZhcmlhYmxlKTtzLmxlbmd0aD4xP2k9bnVsbDppJiYocy5sZW5ndGg9MCk7fXJldHVybiBpfShzLHQsdSk7Zm9yKGNvbnN0e25vZGU6dSxzdGFydDpwLHNlcGFyYXRvcjpmLGNvbnRlbnRFbmQ6bSxlbmQ6Z31vZiBzKWlmKHUuaW5jbHVkZWQpe2lmKHUucmVuZGVyKGUsdCksbz0iIiwhdS5pZC5pbmNsdWRlZHx8dS5pZCBpbnN0YW5jZW9mIGFuJiZUcih1LmlkLnZhcmlhYmxlLHQuZXhwb3J0TmFtZXNCeVZhcmlhYmxlKSljJiYoaCs9IjsiKSxsPSExO2Vsc2Uge2lmKGQmJmQ9PT11LmlkLnZhcmlhYmxlKXtjb25zdCBzPWRuKGUub3JpZ2luYWwsIj0iLHUuaWQuZW5kKTt3bihkLGZuKGUub3JpZ2luYWwscysxKSxudWxsPT09Zj9tOmYsZSx0KTt9bD9oKz0iLCI6KGMmJihoKz0iOyIpLG8rPWAke3RoaXMua2luZH0gYCxsPSEwKTt9bj09PXIrMT9lLm92ZXJ3cml0ZShyLG4saCtvKTooZS5vdmVyd3JpdGUocixyKzEsaCksZS5hcHBlbmRMZWZ0KG4sbykpLGk9bSxuPWcsYz0hMCxyPWYsaD0iIjt9ZWxzZSBlLnJlbW92ZShwLGcpO3RoaXMucmVuZGVyRGVjbGFyYXRpb25FbmQoZSxoLHIsaSxuLHUsdCk7fX1jb25zdCBjbz17QXJyYXlFeHByZXNzaW9uOkFpLEFycmF5UGF0dGVybjpraSxBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbjprbixBc3NpZ25tZW50RXhwcmVzc2lvbjpjbGFzcyBleHRlbmRzIFpze2hhc0VmZmVjdHMoZSl7Y29uc3R7ZGVvcHRpbWl6ZWQ6dCxsZWZ0OnMsb3BlcmF0b3I6aSxyaWdodDpufT10aGlzO3JldHVybiB0fHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCksbi5oYXNFZmZlY3RzKGUpfHxzLmhhc0VmZmVjdHNBc0Fzc2lnbm1lbnRUYXJnZXQoZSwiPSIhPT1pKX1oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7cmV0dXJuIHRoaXMucmlnaHQuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpfWluY2x1ZGUoZSx0KXtjb25zdHtkZW9wdGltaXplZDpzLGxlZnQ6aSxyaWdodDpuLG9wZXJhdG9yOnJ9PXRoaXM7c3x8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLHRoaXMuaW5jbHVkZWQ9ITAsKHR8fCI9IiE9PXJ8fGkuaW5jbHVkZWR8fGkuaGFzRWZmZWN0c0FzQXNzaWdubWVudFRhcmdldCh0cygpLCExKSkmJmkuaW5jbHVkZUFzQXNzaWdubWVudFRhcmdldChlLHQsIj0iIT09ciksbi5pbmNsdWRlKGUsdCk7fWluaXRpYWxpc2UoKXt0aGlzLmxlZnQuc2V0QXNzaWduZWRWYWx1ZSh0aGlzLnJpZ2h0KTt9cmVuZGVyKGUsdCx7cHJldmVudEFTSTpzLHJlbmRlcmVkUGFyZW50VHlwZTppLHJlbmRlcmVkU3Vycm91bmRpbmdFbGVtZW50Om59PXBlKXtjb25zdHtsZWZ0OnIscmlnaHQ6byxzdGFydDphLGVuZDpsLHBhcmVudDpjfT10aGlzO2lmKHIuaW5jbHVkZWQpci5yZW5kZXIoZSx0KSxvLnJlbmRlcihlLHQpO2Vsc2Uge2NvbnN0IGw9Zm4oZS5vcmlnaW5hbCxkbihlLm9yaWdpbmFsLCI9IixyLmVuZCkrMSk7ZS5yZW1vdmUoYSxsKSxzJiZ4bihlLGwsby5zdGFydCksby5yZW5kZXIoZSx0LHtyZW5kZXJlZFBhcmVudFR5cGU6aXx8Yy50eXBlLHJlbmRlcmVkU3Vycm91bmRpbmdFbGVtZW50Om58fGMudHlwZX0pO31pZigic3lzdGVtIj09PXQuZm9ybWF0KWlmKHIgaW5zdGFuY2VvZiBhbil7Y29uc3Qgcz1yLnZhcmlhYmxlLGk9dC5leHBvcnROYW1lc0J5VmFyaWFibGUuZ2V0KHMpO2lmKGkpcmV0dXJuIHZvaWQoMT09PWkubGVuZ3RoP3duKHMsYSxsLGUsdCk6UG4ocyxhLGwsYy50eXBlIT09TnMsZSx0KSl9ZWxzZSB7Y29uc3Qgcz1bXTtpZihyLmFkZEV4cG9ydGVkVmFyaWFibGVzKHMsdC5leHBvcnROYW1lc0J5VmFyaWFibGUpLHMubGVuZ3RoPjApcmV0dXJuIHZvaWQgZnVuY3Rpb24oZSx0LHMsaSxuLHIpe2NvbnN0e186byxnZXREaXJlY3RSZXR1cm5JaWZlTGVmdDphfT1yLnNuaXBwZXRzO24ucHJlcGVuZFJpZ2h0KHQsYShbInYiXSxgJHtJbihlLHIpfSwke299dmAse25lZWRzQXJyb3dSZXR1cm5QYXJlbnM6ITAsbmVlZHNXcmFwcGVkRnVuY3Rpb246aX0pKSxuLmFwcGVuZExlZnQocywiKSIpO30ocyxhLGwsbj09PU5zLGUsdCl9ci5pbmNsdWRlZCYmciBpbnN0YW5jZW9mIENuJiYobj09PU5zfHxuPT09U3MpJiYoZS5hcHBlbmRSaWdodChhLCIoIiksZS5wcmVwZW5kTGVmdChsLCIpIikpO31hcHBseURlb3B0aW1pemF0aW9ucygpe3RoaXMuZGVvcHRpbWl6ZWQ9ITAsdGhpcy5sZWZ0LmRlb3B0aW1pemVQYXRoKEspLHRoaXMucmlnaHQuZGVvcHRpbWl6ZVBhdGgoWSksdGhpcy5jb250ZXh0LnJlcXVlc3RUcmVlc2hha2luZ1Bhc3MoKTt9fSxBc3NpZ25tZW50UGF0dGVybjpjbGFzcyBleHRlbmRzIFpze2FkZEV4cG9ydGVkVmFyaWFibGVzKGUsdCl7dGhpcy5sZWZ0LmFkZEV4cG9ydGVkVmFyaWFibGVzKGUsdCk7fWRlY2xhcmUoZSx0KXtyZXR1cm4gdGhpcy5sZWZ0LmRlY2xhcmUoZSx0KX1kZW9wdGltaXplUGF0aChlKXswPT09ZS5sZW5ndGgmJnRoaXMubGVmdC5kZW9wdGltaXplUGF0aChlKTt9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3JldHVybiBlLmxlbmd0aD4wfHx0aGlzLmxlZnQuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoSyx0LHMpfW1hcmtEZWNsYXJhdGlvblJlYWNoZWQoKXt0aGlzLmxlZnQubWFya0RlY2xhcmF0aW9uUmVhY2hlZCgpO31yZW5kZXIoZSx0LHtpc1Nob3J0aGFuZFByb3BlcnR5OnN9PXBlKXt0aGlzLmxlZnQucmVuZGVyKGUsdCx7aXNTaG9ydGhhbmRQcm9wZXJ0eTpzfSksdGhpcy5yaWdodC5yZW5kZXIoZSx0KTt9YXBwbHlEZW9wdGltaXphdGlvbnMoKXt0aGlzLmRlb3B0aW1pemVkPSEwLHRoaXMubGVmdC5kZW9wdGltaXplUGF0aChLKSx0aGlzLnJpZ2h0LmRlb3B0aW1pemVQYXRoKFkpLHRoaXMuY29udGV4dC5yZXF1ZXN0VHJlZXNoYWtpbmdQYXNzKCk7fX0sQXdhaXRFeHByZXNzaW9uOk1uLEJpbmFyeUV4cHJlc3Npb246Y2xhc3MgZXh0ZW5kcyBac3tkZW9wdGltaXplQ2FjaGUoKXt9Z2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUsdCxzKXtpZihlLmxlbmd0aD4wKXJldHVybiBzZTtjb25zdCBpPXRoaXMubGVmdC5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoSyx0LHMpO2lmKCJzeW1ib2wiPT10eXBlb2YgaSlyZXR1cm4gc2U7Y29uc3Qgbj10aGlzLnJpZ2h0LmdldExpdGVyYWxWYWx1ZUF0UGF0aChLLHQscyk7aWYoInN5bWJvbCI9PXR5cGVvZiBuKXJldHVybiBzZTtjb25zdCByPU9uW3RoaXMub3BlcmF0b3JdO3JldHVybiByP3IoaSxuKTpzZX1oYXNFZmZlY3RzKGUpe3JldHVybiAiKyI9PT10aGlzLm9wZXJhdG9yJiZ0aGlzLnBhcmVudCBpbnN0YW5jZW9mIGJuJiYiIj09PXRoaXMubGVmdC5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoSyxlZSx0aGlzKXx8c3VwZXIuaGFzRWZmZWN0cyhlKX1oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHt0eXBlOnR9KXtyZXR1cm4gMCE9PXR8fGUubGVuZ3RoPjF9cmVuZGVyKGUsdCx7cmVuZGVyZWRTdXJyb3VuZGluZ0VsZW1lbnQ6c309cGUpe3RoaXMubGVmdC5yZW5kZXIoZSx0LHtyZW5kZXJlZFN1cnJvdW5kaW5nRWxlbWVudDpzfSksdGhpcy5yaWdodC5yZW5kZXIoZSx0KTt9fSxCbG9ja1N0YXRlbWVudDp2bixCcmVha1N0YXRlbWVudDpjbGFzcyBleHRlbmRzIFpze2hhc0VmZmVjdHMoZSl7aWYodGhpcy5sYWJlbCl7aWYoIWUuaWdub3JlLmxhYmVscy5oYXModGhpcy5sYWJlbC5uYW1lKSlyZXR1cm4gITA7ZS5pbmNsdWRlZExhYmVscy5hZGQodGhpcy5sYWJlbC5uYW1lKTt9ZWxzZSB7aWYoIWUuaWdub3JlLmJyZWFrcylyZXR1cm4gITA7ZS5oYXNCcmVhaz0hMDt9cmV0dXJuIGUuYnJva2VuRmxvdz0hMCwhMX1pbmNsdWRlKGUpe3RoaXMuaW5jbHVkZWQ9ITAsdGhpcy5sYWJlbD8odGhpcy5sYWJlbC5pbmNsdWRlKCksZS5pbmNsdWRlZExhYmVscy5hZGQodGhpcy5sYWJlbC5uYW1lKSk6ZS5oYXNCcmVhaz0hMCxlLmJyb2tlbkZsb3c9ITA7fX0sQ2FsbEV4cHJlc3Npb246am4sQ2F0Y2hDbGF1c2U6Y2xhc3MgZXh0ZW5kcyBac3tjcmVhdGVTY29wZShlKXt0aGlzLnNjb3BlPW5ldyBVbihlLHRoaXMuY29udGV4dCk7fXBhcnNlTm9kZShlKXtjb25zdHtwYXJhbTp0fT1lO3QmJih0aGlzLnBhcmFtPW5ldyh0aGlzLmNvbnRleHQuZ2V0Tm9kZUNvbnN0cnVjdG9yKHQudHlwZSkpKHQsdGhpcyx0aGlzLnNjb3BlKSx0aGlzLnBhcmFtLmRlY2xhcmUoInBhcmFtZXRlciIscmUpKSxzdXBlci5wYXJzZU5vZGUoZSk7fX0sQ2hhaW5FeHByZXNzaW9uOmNsYXNzIGV4dGVuZHMgWnN7ZGVvcHRpbWl6ZUNhY2hlKCl7fWdldExpdGVyYWxWYWx1ZUF0UGF0aChlLHQscyl7aWYoIXRoaXMuZXhwcmVzc2lvbi5pc1NraXBwZWRBc09wdGlvbmFsKHMpKXJldHVybiB0aGlzLmV4cHJlc3Npb24uZ2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUsdCxzKX1oYXNFZmZlY3RzKGUpe3JldHVybiAhdGhpcy5leHByZXNzaW9uLmlzU2tpcHBlZEFzT3B0aW9uYWwodGhpcykmJnRoaXMuZXhwcmVzc2lvbi5oYXNFZmZlY3RzKGUpfX0sQ2xhc3NCb2R5OmNsYXNzIGV4dGVuZHMgWnN7Y3JlYXRlU2NvcGUoZSl7dGhpcy5zY29wZT1uZXcgR24oZSx0aGlzLnBhcmVudCx0aGlzLmNvbnRleHQpO31pbmNsdWRlKGUsdCl7dGhpcy5pbmNsdWRlZD0hMCx0aGlzLmNvbnRleHQuaW5jbHVkZVZhcmlhYmxlSW5Nb2R1bGUodGhpcy5zY29wZS50aGlzVmFyaWFibGUpO2Zvcihjb25zdCBzIG9mIHRoaXMuYm9keSlzLmluY2x1ZGUoZSx0KTt9cGFyc2VOb2RlKGUpe2NvbnN0IHQ9dGhpcy5ib2R5PVtdO2Zvcihjb25zdCBzIG9mIGUuYm9keSl0LnB1c2gobmV3KHRoaXMuY29udGV4dC5nZXROb2RlQ29uc3RydWN0b3Iocy50eXBlKSkocyx0aGlzLHMuc3RhdGljP3RoaXMuc2NvcGU6dGhpcy5zY29wZS5pbnN0YW5jZVNjb3BlKSk7c3VwZXIucGFyc2VOb2RlKGUpO31hcHBseURlb3B0aW1pemF0aW9ucygpe319LENsYXNzRGVjbGFyYXRpb246WW4sQ2xhc3NFeHByZXNzaW9uOlhuLENvbmRpdGlvbmFsRXhwcmVzc2lvbjpjbGFzcyBleHRlbmRzIFpze2NvbnN0cnVjdG9yKCl7c3VwZXIoLi4uYXJndW1lbnRzKSx0aGlzLmV4cHJlc3Npb25zVG9CZURlb3B0aW1pemVkPVtdLHRoaXMuaXNCcmFuY2hSZXNvbHV0aW9uQW5hbHlzZWQ9ITEsdGhpcy51c2VkQnJhbmNoPW51bGw7fWRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXt0aGlzLmNvbnNlcXVlbnQuZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpLHRoaXMuYWx0ZXJuYXRlLmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKTt9ZGVvcHRpbWl6ZUNhY2hlKCl7aWYobnVsbCE9PXRoaXMudXNlZEJyYW5jaCl7Y29uc3QgZT10aGlzLnVzZWRCcmFuY2g9PT10aGlzLmNvbnNlcXVlbnQ/dGhpcy5hbHRlcm5hdGU6dGhpcy5jb25zZXF1ZW50O3RoaXMudXNlZEJyYW5jaD1udWxsLGUuZGVvcHRpbWl6ZVBhdGgoWSk7Y29uc3R7ZXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQ6dH09dGhpczt0aGlzLmV4cHJlc3Npb25zVG9CZURlb3B0aW1pemVkPW1lO2Zvcihjb25zdCBlIG9mIHQpZS5kZW9wdGltaXplQ2FjaGUoKTt9fWRlb3B0aW1pemVQYXRoKGUpe2NvbnN0IHQ9dGhpcy5nZXRVc2VkQnJhbmNoKCk7dD90LmRlb3B0aW1pemVQYXRoKGUpOih0aGlzLmNvbnNlcXVlbnQuZGVvcHRpbWl6ZVBhdGgoZSksdGhpcy5hbHRlcm5hdGUuZGVvcHRpbWl6ZVBhdGgoZSkpO31nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpe2NvbnN0IGk9dGhpcy5nZXRVc2VkQnJhbmNoKCk7cmV0dXJuIGk/KHRoaXMuZXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQucHVzaChzKSxpLmdldExpdGVyYWxWYWx1ZUF0UGF0aChlLHQscykpOnNlfWdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUsdCxzLGkpe2NvbnN0IG49dGhpcy5nZXRVc2VkQnJhbmNoKCk7cmV0dXJuIG4/KHRoaXMuZXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQucHVzaChpKSxuLmdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUsdCxzLGkpKTpbbmV3IFFuKFt0aGlzLmNvbnNlcXVlbnQuZ2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSlbMF0sdGhpcy5hbHRlcm5hdGUuZ2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSlbMF1dKSwhMV19aGFzRWZmZWN0cyhlKXtpZih0aGlzLnRlc3QuaGFzRWZmZWN0cyhlKSlyZXR1cm4gITA7Y29uc3QgdD10aGlzLmdldFVzZWRCcmFuY2goKTtyZXR1cm4gdD90Lmhhc0VmZmVjdHMoZSk6dGhpcy5jb25zZXF1ZW50Lmhhc0VmZmVjdHMoZSl8fHRoaXMuYWx0ZXJuYXRlLmhhc0VmZmVjdHMoZSl9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe2NvbnN0IGk9dGhpcy5nZXRVc2VkQnJhbmNoKCk7cmV0dXJuIGk/aS5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyk6dGhpcy5jb25zZXF1ZW50Lmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXx8dGhpcy5hbHRlcm5hdGUuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpfWluY2x1ZGUoZSx0KXt0aGlzLmluY2x1ZGVkPSEwO2NvbnN0IHM9dGhpcy5nZXRVc2VkQnJhbmNoKCk7dHx8dGhpcy50ZXN0LnNob3VsZEJlSW5jbHVkZWQoZSl8fG51bGw9PT1zPyh0aGlzLnRlc3QuaW5jbHVkZShlLHQpLHRoaXMuY29uc2VxdWVudC5pbmNsdWRlKGUsdCksdGhpcy5hbHRlcm5hdGUuaW5jbHVkZShlLHQpKTpzLmluY2x1ZGUoZSx0KTt9aW5jbHVkZUNhbGxBcmd1bWVudHMoZSx0KXtjb25zdCBzPXRoaXMuZ2V0VXNlZEJyYW5jaCgpO3M/cy5pbmNsdWRlQ2FsbEFyZ3VtZW50cyhlLHQpOih0aGlzLmNvbnNlcXVlbnQuaW5jbHVkZUNhbGxBcmd1bWVudHMoZSx0KSx0aGlzLmFsdGVybmF0ZS5pbmNsdWRlQ2FsbEFyZ3VtZW50cyhlLHQpKTt9cmVuZGVyKGUsdCx7aXNDYWxsZWVPZlJlbmRlcmVkUGFyZW50OnMscHJldmVudEFTSTppLHJlbmRlcmVkUGFyZW50VHlwZTpuLHJlbmRlcmVkU3Vycm91bmRpbmdFbGVtZW50OnJ9PXBlKXtjb25zdCBvPXRoaXMuZ2V0VXNlZEJyYW5jaCgpO2lmKHRoaXMudGVzdC5pbmNsdWRlZCl0aGlzLnRlc3QucmVuZGVyKGUsdCx7cmVuZGVyZWRTdXJyb3VuZGluZ0VsZW1lbnQ6cn0pLHRoaXMuY29uc2VxdWVudC5yZW5kZXIoZSx0KSx0aGlzLmFsdGVybmF0ZS5yZW5kZXIoZSx0KTtlbHNlIHtjb25zdCBhPWRuKGUub3JpZ2luYWwsIjoiLHRoaXMuY29uc2VxdWVudC5lbmQpLGw9Zm4oZS5vcmlnaW5hbCwodGhpcy5jb25zZXF1ZW50LmluY2x1ZGVkP2RuKGUub3JpZ2luYWwsIj8iLHRoaXMudGVzdC5lbmQpOmEpKzEpO2kmJnhuKGUsbCxvLnN0YXJ0KSxlLnJlbW92ZSh0aGlzLnN0YXJ0LGwpLHRoaXMuY29uc2VxdWVudC5pbmNsdWRlZCYmZS5yZW1vdmUoYSx0aGlzLmVuZCksaG4odGhpcyxlKSxvLnJlbmRlcihlLHQse2lzQ2FsbGVlT2ZSZW5kZXJlZFBhcmVudDpzLHByZXZlbnRBU0k6ITAscmVuZGVyZWRQYXJlbnRUeXBlOm58fHRoaXMucGFyZW50LnR5cGUscmVuZGVyZWRTdXJyb3VuZGluZ0VsZW1lbnQ6cnx8dGhpcy5wYXJlbnQudHlwZX0pO319Z2V0VXNlZEJyYW5jaCgpe2lmKHRoaXMuaXNCcmFuY2hSZXNvbHV0aW9uQW5hbHlzZWQpcmV0dXJuIHRoaXMudXNlZEJyYW5jaDt0aGlzLmlzQnJhbmNoUmVzb2x1dGlvbkFuYWx5c2VkPSEwO2NvbnN0IGU9dGhpcy50ZXN0LmdldExpdGVyYWxWYWx1ZUF0UGF0aChLLGVlLHRoaXMpO3JldHVybiAic3ltYm9sIj09dHlwZW9mIGU/bnVsbDp0aGlzLnVzZWRCcmFuY2g9ZT90aGlzLmNvbnNlcXVlbnQ6dGhpcy5hbHRlcm5hdGV9fSxDb250aW51ZVN0YXRlbWVudDpjbGFzcyBleHRlbmRzIFpze2hhc0VmZmVjdHMoZSl7aWYodGhpcy5sYWJlbCl7aWYoIWUuaWdub3JlLmxhYmVscy5oYXModGhpcy5sYWJlbC5uYW1lKSlyZXR1cm4gITA7ZS5pbmNsdWRlZExhYmVscy5hZGQodGhpcy5sYWJlbC5uYW1lKTt9ZWxzZSB7aWYoIWUuaWdub3JlLmNvbnRpbnVlcylyZXR1cm4gITA7ZS5oYXNDb250aW51ZT0hMDt9cmV0dXJuIGUuYnJva2VuRmxvdz0hMCwhMX1pbmNsdWRlKGUpe3RoaXMuaW5jbHVkZWQ9ITAsdGhpcy5sYWJlbD8odGhpcy5sYWJlbC5pbmNsdWRlKCksZS5pbmNsdWRlZExhYmVscy5hZGQodGhpcy5sYWJlbC5uYW1lKSk6ZS5oYXNDb250aW51ZT0hMCxlLmJyb2tlbkZsb3c9ITA7fX0sRG9XaGlsZVN0YXRlbWVudDpjbGFzcyBleHRlbmRzIFpze2hhc0VmZmVjdHMoZSl7cmV0dXJuICEhdGhpcy50ZXN0Lmhhc0VmZmVjdHMoZSl8fFpuKGUsdGhpcy5ib2R5KX1pbmNsdWRlKGUsdCl7dGhpcy5pbmNsdWRlZD0hMCx0aGlzLnRlc3QuaW5jbHVkZShlLHQpLEpuKGUsdGhpcy5ib2R5LHQpO319LEVtcHR5U3RhdGVtZW50OmNsYXNzIGV4dGVuZHMgWnN7aGFzRWZmZWN0cygpe3JldHVybiAhMX19LEV4cG9ydEFsbERlY2xhcmF0aW9uOmVyLEV4cG9ydERlZmF1bHREZWNsYXJhdGlvbjpzcixFeHBvcnROYW1lZERlY2xhcmF0aW9uOmlyLEV4cG9ydFNwZWNpZmllcjpjbGFzcyBleHRlbmRzIFpze2FwcGx5RGVvcHRpbWl6YXRpb25zKCl7fX0sRXhwcmVzc2lvblN0YXRlbWVudDpibixGb3JJblN0YXRlbWVudDpjbGFzcyBleHRlbmRzIFpze2NyZWF0ZVNjb3BlKGUpe3RoaXMuc2NvcGU9bmV3IEVuKGUpO31oYXNFZmZlY3RzKGUpe2NvbnN0e2JvZHk6dCxkZW9wdGltaXplZDpzLGxlZnQ6aSxyaWdodDpufT10aGlzO3JldHVybiBzfHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCksISghaS5oYXNFZmZlY3RzQXNBc3NpZ25tZW50VGFyZ2V0KGUsITEpJiYhbi5oYXNFZmZlY3RzKGUpKXx8Wm4oZSx0KX1pbmNsdWRlKGUsdCl7Y29uc3R7Ym9keTpzLGRlb3B0aW1pemVkOmksbGVmdDpuLHJpZ2h0OnJ9PXRoaXM7aXx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLHRoaXMuaW5jbHVkZWQ9ITAsbi5pbmNsdWRlQXNBc3NpZ25tZW50VGFyZ2V0KGUsdHx8ITAsITEpLHIuaW5jbHVkZShlLHQpLEpuKGUscyx0KTt9aW5pdGlhbGlzZSgpe3RoaXMubGVmdC5zZXRBc3NpZ25lZFZhbHVlKHJlKTt9cmVuZGVyKGUsdCl7dGhpcy5sZWZ0LnJlbmRlcihlLHQsdW4pLHRoaXMucmlnaHQucmVuZGVyKGUsdCx1biksMTEwPT09ZS5vcmlnaW5hbC5jaGFyQ29kZUF0KHRoaXMucmlnaHQuc3RhcnQtMSkmJmUucHJlcGVuZExlZnQodGhpcy5yaWdodC5zdGFydCwiICIpLHRoaXMuYm9keS5yZW5kZXIoZSx0KTt9YXBwbHlEZW9wdGltaXphdGlvbnMoKXt0aGlzLmRlb3B0aW1pemVkPSEwLHRoaXMubGVmdC5kZW9wdGltaXplUGF0aChLKSx0aGlzLmNvbnRleHQucmVxdWVzdFRyZWVzaGFraW5nUGFzcygpO319LEZvck9mU3RhdGVtZW50OmNsYXNzIGV4dGVuZHMgWnN7Y3JlYXRlU2NvcGUoZSl7dGhpcy5zY29wZT1uZXcgRW4oZSk7fWhhc0VmZmVjdHMoKXtyZXR1cm4gdGhpcy5kZW9wdGltaXplZHx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLCEwfWluY2x1ZGUoZSx0KXtjb25zdHtib2R5OnMsZGVvcHRpbWl6ZWQ6aSxsZWZ0Om4scmlnaHQ6cn09dGhpcztpfHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCksdGhpcy5pbmNsdWRlZD0hMCxuLmluY2x1ZGVBc0Fzc2lnbm1lbnRUYXJnZXQoZSx0fHwhMCwhMSksci5pbmNsdWRlKGUsdCksSm4oZSxzLHQpO31pbml0aWFsaXNlKCl7dGhpcy5sZWZ0LnNldEFzc2lnbmVkVmFsdWUocmUpO31yZW5kZXIoZSx0KXt0aGlzLmxlZnQucmVuZGVyKGUsdCx1biksdGhpcy5yaWdodC5yZW5kZXIoZSx0LHVuKSwxMDI9PT1lLm9yaWdpbmFsLmNoYXJDb2RlQXQodGhpcy5yaWdodC5zdGFydC0xKSYmZS5wcmVwZW5kTGVmdCh0aGlzLnJpZ2h0LnN0YXJ0LCIgIiksdGhpcy5ib2R5LnJlbmRlcihlLHQpO31hcHBseURlb3B0aW1pemF0aW9ucygpe3RoaXMuZGVvcHRpbWl6ZWQ9ITAsdGhpcy5sZWZ0LmRlb3B0aW1pemVQYXRoKEspLHRoaXMucmlnaHQuZGVvcHRpbWl6ZVBhdGgoWSksdGhpcy5jb250ZXh0LnJlcXVlc3RUcmVlc2hha2luZ1Bhc3MoKTt9fSxGb3JTdGF0ZW1lbnQ6Y2xhc3MgZXh0ZW5kcyBac3tjcmVhdGVTY29wZShlKXt0aGlzLnNjb3BlPW5ldyBFbihlKTt9aGFzRWZmZWN0cyhlKXtyZXR1cm4gISEodGhpcy5pbml0Py5oYXNFZmZlY3RzKGUpfHx0aGlzLnRlc3Q/Lmhhc0VmZmVjdHMoZSl8fHRoaXMudXBkYXRlPy5oYXNFZmZlY3RzKGUpKXx8Wm4oZSx0aGlzLmJvZHkpfWluY2x1ZGUoZSx0KXt0aGlzLmluY2x1ZGVkPSEwLHRoaXMuaW5pdD8uaW5jbHVkZShlLHQse2FzU2luZ2xlU3RhdGVtZW50OiEwfSksdGhpcy50ZXN0Py5pbmNsdWRlKGUsdCksdGhpcy51cGRhdGU/LmluY2x1ZGUoZSx0KSxKbihlLHRoaXMuYm9keSx0KTt9cmVuZGVyKGUsdCl7dGhpcy5pbml0Py5yZW5kZXIoZSx0LHVuKSx0aGlzLnRlc3Q/LnJlbmRlcihlLHQsdW4pLHRoaXMudXBkYXRlPy5yZW5kZXIoZSx0LHVuKSx0aGlzLmJvZHkucmVuZGVyKGUsdCk7fX0sRnVuY3Rpb25EZWNsYXJhdGlvbjp0cixGdW5jdGlvbkV4cHJlc3Npb246bnIsSWRlbnRpZmllcjphbixJZlN0YXRlbWVudDphcixJbXBvcnRBdHRyaWJ1dGU6Y2xhc3MgZXh0ZW5kcyBac3t9LEltcG9ydERlY2xhcmF0aW9uOmxyLEltcG9ydERlZmF1bHRTcGVjaWZpZXI6Y3IsSW1wb3J0RXhwcmVzc2lvbjpjbGFzcyBleHRlbmRzIFpze2NvbnN0cnVjdG9yKCl7c3VwZXIoLi4uYXJndW1lbnRzKSx0aGlzLmlubGluZU5hbWVzcGFjZT1udWxsLHRoaXMuYXNzZXJ0aW9ucz1udWxsLHRoaXMubWVjaGFuaXNtPW51bGwsdGhpcy5uYW1lc3BhY2VFeHBvcnROYW1lPXZvaWQgMCx0aGlzLnJlc29sdXRpb249bnVsbCx0aGlzLnJlc29sdXRpb25TdHJpbmc9bnVsbDt9YmluZCgpe3RoaXMuc291cmNlLmJpbmQoKTt9Z2V0RGV0ZXJtaW5pc3RpY0ltcG9ydGVkTmFtZXMoKXtjb25zdCBlPXRoaXMucGFyZW50O2lmKGUgaW5zdGFuY2VvZiBibilyZXR1cm4gbWU7aWYoZSBpbnN0YW5jZW9mIE1uKXtjb25zdCB0PWUucGFyZW50O2lmKHQgaW5zdGFuY2VvZiBibilyZXR1cm4gbWU7aWYodCBpbnN0YW5jZW9mIFZyKXtjb25zdCBlPXQuaWQ7cmV0dXJuIGUgaW5zdGFuY2VvZiBDbj9GcihlKTp2b2lkIDB9aWYodCBpbnN0YW5jZW9mIEJuKXtjb25zdCBlPXQucHJvcGVydHk7aWYoIXQuY29tcHV0ZWQmJmUgaW5zdGFuY2VvZiBhbilyZXR1cm4gW2UubmFtZV19fWVsc2UgaWYoZSBpbnN0YW5jZW9mIEJuKXtjb25zdCB0PWUucGFyZW50LHM9ZS5wcm9wZXJ0eTtpZighKHQgaW5zdGFuY2VvZiBqbiYmcyBpbnN0YW5jZW9mIGFuKSlyZXR1cm47Y29uc3QgaT1zLm5hbWU7aWYodC5wYXJlbnQgaW5zdGFuY2VvZiBibiYmWyJjYXRjaCIsImZpbmFsbHkiXS5pbmNsdWRlcyhpKSlyZXR1cm4gbWU7aWYoInRoZW4iIT09aSlyZXR1cm47aWYoMD09PXQuYXJndW1lbnRzLmxlbmd0aClyZXR1cm4gbWU7Y29uc3Qgbj10LmFyZ3VtZW50c1swXTtpZigxIT09dC5hcmd1bWVudHMubGVuZ3RofHwhKG4gaW5zdGFuY2VvZiBrbnx8biBpbnN0YW5jZW9mIG5yKSlyZXR1cm47aWYoMD09PW4ucGFyYW1zLmxlbmd0aClyZXR1cm4gbWU7Y29uc3Qgcj1uLnBhcmFtc1swXTtyZXR1cm4gMT09PW4ucGFyYW1zLmxlbmd0aCYmciBpbnN0YW5jZW9mIENuP0ZyKHIpOnZvaWQgMH19aGFzRWZmZWN0cygpe3JldHVybiAhMH1pbmNsdWRlKGUsdCl7dGhpcy5pbmNsdWRlZHx8KHRoaXMuaW5jbHVkZWQ9ITAsdGhpcy5jb250ZXh0LmluY2x1ZGVEeW5hbWljSW1wb3J0KHRoaXMpLHRoaXMuc2NvcGUuYWRkQWNjZXNzZWREeW5hbWljSW1wb3J0KHRoaXMpKSx0aGlzLnNvdXJjZS5pbmNsdWRlKGUsdCk7fWluaXRpYWxpc2UoKXt0aGlzLmNvbnRleHQuYWRkRHluYW1pY0ltcG9ydCh0aGlzKTt9cGFyc2VOb2RlKGUpe3N1cGVyLnBhcnNlTm9kZShlLFsic291cmNlIl0pO31yZW5kZXIoZSx0KXtjb25zdHtzbmlwcGV0czp7XzpzLGdldERpcmVjdFJldHVybkZ1bmN0aW9uOmksZ2V0T2JqZWN0Om4sZ2V0UHJvcGVydHlBY2Nlc3M6cn19PXQ7aWYodGhpcy5pbmxpbmVOYW1lc3BhY2Upe2NvbnN0W3Qsc109aShbXSx7ZnVuY3Rpb25SZXR1cm46ITAsbGluZUJyZWFrSW5kZW50Om51bGwsbmFtZTpudWxsfSk7ZS5vdmVyd3JpdGUodGhpcy5zdGFydCx0aGlzLmVuZCxgUHJvbWlzZS5yZXNvbHZlKCkudGhlbigke3R9JHt0aGlzLmlubGluZU5hbWVzcGFjZS5nZXROYW1lKHIpfSR7c30pYCk7fWVsc2Uge2lmKHRoaXMubWVjaGFuaXNtJiYoZS5vdmVyd3JpdGUodGhpcy5zdGFydCxkbihlLm9yaWdpbmFsLCIoIix0aGlzLnN0YXJ0KzYpKzEsdGhpcy5tZWNoYW5pc20ubGVmdCksZS5vdmVyd3JpdGUodGhpcy5lbmQtMSx0aGlzLmVuZCx0aGlzLm1lY2hhbmlzbS5yaWdodCkpLHRoaXMucmVzb2x1dGlvblN0cmluZyl7aWYoZS5vdmVyd3JpdGUodGhpcy5zb3VyY2Uuc3RhcnQsdGhpcy5zb3VyY2UuZW5kLHRoaXMucmVzb2x1dGlvblN0cmluZyksdGhpcy5uYW1lc3BhY2VFeHBvcnROYW1lKXtjb25zdFt0LHNdPWkoWyJuIl0se2Z1bmN0aW9uUmV0dXJuOiEwLGxpbmVCcmVha0luZGVudDpudWxsLG5hbWU6bnVsbH0pO2UucHJlcGVuZExlZnQodGhpcy5lbmQsYC50aGVuKCR7dH1uLiR7dGhpcy5uYW1lc3BhY2VFeHBvcnROYW1lfSR7c30pYCk7fX1lbHNlIHRoaXMuc291cmNlLnJlbmRlcihlLHQpOyEwIT09dGhpcy5hc3NlcnRpb25zJiYodGhpcy5hcmd1bWVudHMmJmUub3ZlcndyaXRlKHRoaXMuc291cmNlLmVuZCx0aGlzLmVuZC0xLCIiLHtjb250ZW50T25seTohMH0pLHRoaXMuYXNzZXJ0aW9ucyYmZS5hcHBlbmRMZWZ0KHRoaXMuZW5kLTEsYCwke3N9JHtuKFtbImFzc2VydCIsdGhpcy5hc3NlcnRpb25zXV0se2xpbmVCcmVha0luZGVudDpudWxsfSl9YCkpO319c2V0RXh0ZXJuYWxSZXNvbHV0aW9uKGUsdCxzLGksbixyLG8sYSxsKXtjb25zdHtmb3JtYXQ6Y309czt0aGlzLmlubGluZU5hbWVzcGFjZT1udWxsLHRoaXMucmVzb2x1dGlvbj10LHRoaXMucmVzb2x1dGlvblN0cmluZz1vLHRoaXMubmFtZXNwYWNlRXhwb3J0TmFtZT1hLHRoaXMuYXNzZXJ0aW9ucz1sO2NvbnN0IGg9Wy4uLnpyW2NdfHxbXV07bGV0IHU7KCh7aGVscGVyOnUsbWVjaGFuaXNtOnRoaXMubWVjaGFuaXNtfT10aGlzLmdldER5bmFtaWNJbXBvcnRNZWNoYW5pc21BbmRIZWxwZXIodCxlLHMsaSxuKSkpLHUmJmgucHVzaCh1KSxoLmxlbmd0aD4wJiZ0aGlzLnNjb3BlLmFkZEFjY2Vzc2VkR2xvYmFscyhoLHIpO31zZXRJbnRlcm5hbFJlc29sdXRpb24oZSl7dGhpcy5pbmxpbmVOYW1lc3BhY2U9ZTt9YXBwbHlEZW9wdGltaXphdGlvbnMoKXt9Z2V0RHluYW1pY0ltcG9ydE1lY2hhbmlzbUFuZEhlbHBlcihlLHQse2NvbXBhY3Q6cyxkeW5hbWljSW1wb3J0RnVuY3Rpb246aSxkeW5hbWljSW1wb3J0SW5DanM6bixmb3JtYXQ6cixnZW5lcmF0ZWRDb2RlOnthcnJvd0Z1bmN0aW9uczpvfSxpbnRlcm9wOmF9LHtfOmwsZ2V0RGlyZWN0UmV0dXJuRnVuY3Rpb246YyxnZXREaXJlY3RSZXR1cm5JaWZlTGVmdDpofSx1KXtjb25zdCBkPXUuaG9va0ZpcnN0U3luYygicmVuZGVyRHluYW1pY0ltcG9ydCIsW3tjdXN0b21SZXNvbHV0aW9uOiJzdHJpbmciPT10eXBlb2YgdGhpcy5yZXNvbHV0aW9uP3RoaXMucmVzb2x1dGlvbjpudWxsLGZvcm1hdDpyLG1vZHVsZUlkOnRoaXMuY29udGV4dC5tb2R1bGUuaWQsdGFyZ2V0TW9kdWxlSWQ6dGhpcy5yZXNvbHV0aW9uJiYic3RyaW5nIiE9dHlwZW9mIHRoaXMucmVzb2x1dGlvbj90aGlzLnJlc29sdXRpb24uaWQ6bnVsbH1dKTtpZihkKXJldHVybiB7aGVscGVyOm51bGwsbWVjaGFuaXNtOmR9O2NvbnN0IHA9IXRoaXMucmVzb2x1dGlvbnx8InN0cmluZyI9PXR5cGVvZiB0aGlzLnJlc29sdXRpb247c3dpdGNoKHIpe2Nhc2UiY2pzIjp7aWYobiYmKCFlfHwic3RyaW5nIj09dHlwZW9mIGV8fGUgaW5zdGFuY2VvZiBRdCkpcmV0dXJuIHtoZWxwZXI6bnVsbCxtZWNoYW5pc206bnVsbH07Y29uc3Qgcz1CcihlLHQsYSk7bGV0IGk9InJlcXVpcmUoIixyPSIpIjtzJiYoaT1gLyojX19QVVJFX18qLyR7c30oJHtpfWAscis9IikiKTtjb25zdFtsLHVdPWMoW10se2Z1bmN0aW9uUmV0dXJuOiEwLGxpbmVCcmVha0luZGVudDpudWxsLG5hbWU6bnVsbH0pO3JldHVybiBpPWBQcm9taXNlLnJlc29sdmUoKS50aGVuKCR7bH0ke2l9YCxyKz1gJHt1fSlgLCFvJiZwJiYoaT1oKFsidCJdLGAke2l9dCR7cn1gLHtuZWVkc0Fycm93UmV0dXJuUGFyZW5zOiExLG5lZWRzV3JhcHBlZEZ1bmN0aW9uOiEwfSkscj0iKSIpLHtoZWxwZXI6cyxtZWNoYW5pc206e2xlZnQ6aSxyaWdodDpyfX19Y2FzZSJhbWQiOntjb25zdCBpPXM/ImMiOiJyZXNvbHZlIixuPXM/ImUiOiJyZWplY3QiLHI9QnIoZSx0LGEpLFt1LGRdPWMoWyJtIl0se2Z1bmN0aW9uUmV0dXJuOiExLGxpbmVCcmVha0luZGVudDpudWxsLG5hbWU6bnVsbH0pLGY9cj9gJHt1fSR7aX0oLyojX19QVVJFX18qLyR7cn0obSkpJHtkfWA6aSxbbSxnXT1jKFtpLG5dLHtmdW5jdGlvblJldHVybjohMSxsaW5lQnJlYWtJbmRlbnQ6bnVsbCxuYW1lOm51bGx9KTtsZXQgeT1gbmV3IFByb21pc2UoJHttfXJlcXVpcmUoW2AseD1gXSwke2x9JHtmfSwke2x9JHtufSkke2d9KWA7cmV0dXJuICFvJiZwJiYoeT1oKFsidCJdLGAke3l9dCR7eH1gLHtuZWVkc0Fycm93UmV0dXJuUGFyZW5zOiExLG5lZWRzV3JhcHBlZEZ1bmN0aW9uOiEwfSkseD0iKSIpLHtoZWxwZXI6cixtZWNoYW5pc206e2xlZnQ6eSxyaWdodDp4fX19Y2FzZSJzeXN0ZW0iOnJldHVybiB7aGVscGVyOm51bGwsbWVjaGFuaXNtOntsZWZ0OiJtb2R1bGUuaW1wb3J0KCIscmlnaHQ6IikifX07Y2FzZSJlcyI6aWYoaSlyZXR1cm4ge2hlbHBlcjpudWxsLG1lY2hhbmlzbTp7bGVmdDpgJHtpfShgLHJpZ2h0OiIpIn19fXJldHVybiB7aGVscGVyOm51bGwsbWVjaGFuaXNtOm51bGx9fX0sSW1wb3J0TmFtZXNwYWNlU3BlY2lmaWVyOmpyLEltcG9ydFNwZWNpZmllcjpjbGFzcyBleHRlbmRzIFpze2FwcGx5RGVvcHRpbWl6YXRpb25zKCl7fX0sTGFiZWxlZFN0YXRlbWVudDpjbGFzcyBleHRlbmRzIFpze2hhc0VmZmVjdHMoZSl7Y29uc3QgdD1lLmJyb2tlbkZsb3c7cmV0dXJuIGUuaWdub3JlLmxhYmVscy5hZGQodGhpcy5sYWJlbC5uYW1lKSwhIXRoaXMuYm9keS5oYXNFZmZlY3RzKGUpfHwoZS5pZ25vcmUubGFiZWxzLmRlbGV0ZSh0aGlzLmxhYmVsLm5hbWUpLGUuaW5jbHVkZWRMYWJlbHMuaGFzKHRoaXMubGFiZWwubmFtZSkmJihlLmluY2x1ZGVkTGFiZWxzLmRlbGV0ZSh0aGlzLmxhYmVsLm5hbWUpLGUuYnJva2VuRmxvdz10KSwhMSl9aW5jbHVkZShlLHQpe3RoaXMuaW5jbHVkZWQ9ITA7Y29uc3Qgcz1lLmJyb2tlbkZsb3c7dGhpcy5ib2R5LmluY2x1ZGUoZSx0KSwodHx8ZS5pbmNsdWRlZExhYmVscy5oYXModGhpcy5sYWJlbC5uYW1lKSkmJih0aGlzLmxhYmVsLmluY2x1ZGUoKSxlLmluY2x1ZGVkTGFiZWxzLmRlbGV0ZSh0aGlzLmxhYmVsLm5hbWUpLGUuYnJva2VuRmxvdz1zKTt9cmVuZGVyKGUsdCl7dGhpcy5sYWJlbC5pbmNsdWRlZD90aGlzLmxhYmVsLnJlbmRlcihlLHQpOmUucmVtb3ZlKHRoaXMuc3RhcnQsZm4oZS5vcmlnaW5hbCxkbihlLm9yaWdpbmFsLCI6Iix0aGlzLmxhYmVsLmVuZCkrMSkpLHRoaXMuYm9keS5yZW5kZXIoZSx0KTt9fSxMaXRlcmFsOkxuLExvZ2ljYWxFeHByZXNzaW9uOmNsYXNzIGV4dGVuZHMgWnN7Y29uc3RydWN0b3IoKXtzdXBlciguLi5hcmd1bWVudHMpLHRoaXMuZXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQ9W10sdGhpcy5pc0JyYW5jaFJlc29sdXRpb25BbmFseXNlZD0hMSx0aGlzLnVzZWRCcmFuY2g9bnVsbDt9ZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3RoaXMubGVmdC5kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyksdGhpcy5yaWdodC5kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyk7fWRlb3B0aW1pemVDYWNoZSgpe2lmKHRoaXMudXNlZEJyYW5jaCl7Y29uc3QgZT10aGlzLnVzZWRCcmFuY2g9PT10aGlzLmxlZnQ/dGhpcy5yaWdodDp0aGlzLmxlZnQ7dGhpcy51c2VkQnJhbmNoPW51bGwsZS5kZW9wdGltaXplUGF0aChZKTtjb25zdHtjb250ZXh0OnQsZXhwcmVzc2lvbnNUb0JlRGVvcHRpbWl6ZWQ6c309dGhpczt0aGlzLmV4cHJlc3Npb25zVG9CZURlb3B0aW1pemVkPW1lO2Zvcihjb25zdCBlIG9mIHMpZS5kZW9wdGltaXplQ2FjaGUoKTt0LnJlcXVlc3RUcmVlc2hha2luZ1Bhc3MoKTt9fWRlb3B0aW1pemVQYXRoKGUpe2NvbnN0IHQ9dGhpcy5nZXRVc2VkQnJhbmNoKCk7dD90LmRlb3B0aW1pemVQYXRoKGUpOih0aGlzLmxlZnQuZGVvcHRpbWl6ZVBhdGgoZSksdGhpcy5yaWdodC5kZW9wdGltaXplUGF0aChlKSk7fWdldExpdGVyYWxWYWx1ZUF0UGF0aChlLHQscyl7Y29uc3QgaT10aGlzLmdldFVzZWRCcmFuY2goKTtyZXR1cm4gaT8odGhpcy5leHByZXNzaW9uc1RvQmVEZW9wdGltaXplZC5wdXNoKHMpLGkuZ2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUsdCxzKSk6c2V9Z2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSl7Y29uc3Qgbj10aGlzLmdldFVzZWRCcmFuY2goKTtyZXR1cm4gbj8odGhpcy5leHByZXNzaW9uc1RvQmVEZW9wdGltaXplZC5wdXNoKGkpLG4uZ2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSkpOltuZXcgUW4oW3RoaXMubGVmdC5nZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChlLHQscyxpKVswXSx0aGlzLnJpZ2h0LmdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUsdCxzLGkpWzBdXSksITFdfWhhc0VmZmVjdHMoZSl7cmV0dXJuICEhdGhpcy5sZWZ0Lmhhc0VmZmVjdHMoZSl8fHRoaXMuZ2V0VXNlZEJyYW5jaCgpIT09dGhpcy5sZWZ0JiZ0aGlzLnJpZ2h0Lmhhc0VmZmVjdHMoZSl9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe2NvbnN0IGk9dGhpcy5nZXRVc2VkQnJhbmNoKCk7cmV0dXJuIGk/aS5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyk6dGhpcy5sZWZ0Lmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXx8dGhpcy5yaWdodC5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl9aW5jbHVkZShlLHQpe3RoaXMuaW5jbHVkZWQ9ITA7Y29uc3Qgcz10aGlzLmdldFVzZWRCcmFuY2goKTt0fHxzPT09dGhpcy5yaWdodCYmdGhpcy5sZWZ0LnNob3VsZEJlSW5jbHVkZWQoZSl8fCFzPyh0aGlzLmxlZnQuaW5jbHVkZShlLHQpLHRoaXMucmlnaHQuaW5jbHVkZShlLHQpKTpzLmluY2x1ZGUoZSx0KTt9cmVuZGVyKGUsdCx7aXNDYWxsZWVPZlJlbmRlcmVkUGFyZW50OnMscHJldmVudEFTSTppLHJlbmRlcmVkUGFyZW50VHlwZTpuLHJlbmRlcmVkU3Vycm91bmRpbmdFbGVtZW50OnJ9PXBlKXtpZih0aGlzLmxlZnQuaW5jbHVkZWQmJnRoaXMucmlnaHQuaW5jbHVkZWQpdGhpcy5sZWZ0LnJlbmRlcihlLHQse3ByZXZlbnRBU0k6aSxyZW5kZXJlZFN1cnJvdW5kaW5nRWxlbWVudDpyfSksdGhpcy5yaWdodC5yZW5kZXIoZSx0KTtlbHNlIHtjb25zdCBvPWRuKGUub3JpZ2luYWwsdGhpcy5vcGVyYXRvcix0aGlzLmxlZnQuZW5kKTtpZih0aGlzLnJpZ2h0LmluY2x1ZGVkKXtjb25zdCB0PWZuKGUub3JpZ2luYWwsbysyKTtlLnJlbW92ZSh0aGlzLnN0YXJ0LHQpLGkmJnhuKGUsdCx0aGlzLnJpZ2h0LnN0YXJ0KTt9ZWxzZSBlLnJlbW92ZShvLHRoaXMuZW5kKTtobih0aGlzLGUpLHRoaXMuZ2V0VXNlZEJyYW5jaCgpLnJlbmRlcihlLHQse2lzQ2FsbGVlT2ZSZW5kZXJlZFBhcmVudDpzLHByZXZlbnRBU0k6aSxyZW5kZXJlZFBhcmVudFR5cGU6bnx8dGhpcy5wYXJlbnQudHlwZSxyZW5kZXJlZFN1cnJvdW5kaW5nRWxlbWVudDpyfHx0aGlzLnBhcmVudC50eXBlfSk7fX1nZXRVc2VkQnJhbmNoKCl7aWYoIXRoaXMuaXNCcmFuY2hSZXNvbHV0aW9uQW5hbHlzZWQpe3RoaXMuaXNCcmFuY2hSZXNvbHV0aW9uQW5hbHlzZWQ9ITA7Y29uc3QgZT10aGlzLmxlZnQuZ2V0TGl0ZXJhbFZhbHVlQXRQYXRoKEssZWUsdGhpcyk7aWYoInN5bWJvbCI9PXR5cGVvZiBlKXJldHVybiBudWxsO3RoaXMudXNlZEJyYW5jaD0ifHwiPT09dGhpcy5vcGVyYXRvciYmZXx8IiYmIj09PXRoaXMub3BlcmF0b3ImJiFlfHwiPz8iPT09dGhpcy5vcGVyYXRvciYmbnVsbCE9ZT90aGlzLmxlZnQ6dGhpcy5yaWdodDt9cmV0dXJuIHRoaXMudXNlZEJyYW5jaH19LE1lbWJlckV4cHJlc3Npb246Qm4sTWV0YVByb3BlcnR5OmNsYXNzIGV4dGVuZHMgWnN7Y29uc3RydWN0b3IoKXtzdXBlciguLi5hcmd1bWVudHMpLHRoaXMubWV0YVByb3BlcnR5PW51bGwsdGhpcy5wcmVsaW1pbmFyeUNodW5rSWQ9bnVsbCx0aGlzLnJlZmVyZW5jZUlkPW51bGw7fWdldFJlZmVyZW5jZWRGaWxlTmFtZShlKXtjb25zdHttZXRhOntuYW1lOnR9LG1ldGFQcm9wZXJ0eTpzfT10aGlzO3JldHVybiB0PT09R3ImJnM/LnN0YXJ0c1dpdGgoVXIpP2UuZ2V0RmlsZU5hbWUocy5zbGljZSgxNikpOm51bGx9aGFzRWZmZWN0cygpe3JldHVybiAhMX1oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHt0eXBlOnR9KXtyZXR1cm4gZS5sZW5ndGg+MXx8MCE9PXR9aW5jbHVkZSgpe2lmKCF0aGlzLmluY2x1ZGVkJiYodGhpcy5pbmNsdWRlZD0hMCx0aGlzLm1ldGEubmFtZT09PUdyKSl7dGhpcy5jb250ZXh0LmFkZEltcG9ydE1ldGEodGhpcyk7Y29uc3QgZT10aGlzLnBhcmVudCx0PXRoaXMubWV0YVByb3BlcnR5PWUgaW5zdGFuY2VvZiBCbiYmInN0cmluZyI9PXR5cGVvZiBlLnByb3BlcnR5S2V5P2UucHJvcGVydHlLZXk6bnVsbDt0Py5zdGFydHNXaXRoKFVyKSYmKHRoaXMucmVmZXJlbmNlSWQ9dC5zbGljZSgxNikpO319cmVuZGVyKGUse2Zvcm1hdDp0LHBsdWdpbkRyaXZlcjpzLHNuaXBwZXRzOml9KXtjb25zdHtjb250ZXh0Onttb2R1bGU6e2lkOm59fSxtZXRhOntuYW1lOnJ9LG1ldGFQcm9wZXJ0eTpvLHBhcmVudDphLHByZWxpbWluYXJ5Q2h1bmtJZDpsLHJlZmVyZW5jZUlkOmMsc3RhcnQ6aCxlbmQ6dX09dGhpcztpZihyIT09R3IpcmV0dXJuO2NvbnN0IGQ9bDtpZihjKXtjb25zdCBpPXMuZ2V0RmlsZU5hbWUoYykscj1JKCQoUChkKSxpKSksbz1zLmhvb2tGaXJzdFN5bmMoInJlc29sdmVGaWxlVXJsIixbe2NodW5rSWQ6ZCxmaWxlTmFtZTppLGZvcm1hdDp0LG1vZHVsZUlkOm4scmVmZXJlbmNlSWQ6YyxyZWxhdGl2ZVBhdGg6cn1dKXx8SnJbdF0ocik7cmV0dXJuIHZvaWQgZS5vdmVyd3JpdGUoYS5zdGFydCxhLmVuZCxvLHtjb250ZW50T25seTohMH0pfWNvbnN0IHA9cy5ob29rRmlyc3RTeW5jKCJyZXNvbHZlSW1wb3J0TWV0YSIsW28se2NodW5rSWQ6ZCxmb3JtYXQ6dCxtb2R1bGVJZDpufV0pfHxlb1t0XT8uKG8se2NodW5rSWQ6ZCxzbmlwcGV0czppfSk7InN0cmluZyI9PXR5cGVvZiBwJiYoYSBpbnN0YW5jZW9mIEJuP2Uub3ZlcndyaXRlKGEuc3RhcnQsYS5lbmQscCx7Y29udGVudE9ubHk6ITB9KTplLm92ZXJ3cml0ZShoLHUscCx7Y29udGVudE9ubHk6ITB9KSk7fXNldFJlc29sdXRpb24oZSx0LHMpe3RoaXMucHJlbGltaW5hcnlDaHVua0lkPXM7Y29uc3QgaT0odGhpcy5tZXRhUHJvcGVydHk/LnN0YXJ0c1dpdGgoVXIpP3FyOldyKVtlXTtpLmxlbmd0aD4wJiZ0aGlzLnNjb3BlLmFkZEFjY2Vzc2VkR2xvYmFscyhpLHQpO319LE1ldGhvZERlZmluaXRpb246cW4sTmV3RXhwcmVzc2lvbjpjbGFzcyBleHRlbmRzIFpze2hhc0VmZmVjdHMoZSl7dHJ5e2Zvcihjb25zdCB0IG9mIHRoaXMuYXJndW1lbnRzKWlmKHQuaGFzRWZmZWN0cyhlKSlyZXR1cm4gITA7cmV0dXJuICF0aGlzLmFubm90YXRpb25QdXJlJiYodGhpcy5jYWxsZWUuaGFzRWZmZWN0cyhlKXx8dGhpcy5jYWxsZWUuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoSyx0aGlzLmludGVyYWN0aW9uLGUpKX1maW5hbGx5e3RoaXMuZGVvcHRpbWl6ZWR8fHRoaXMuYXBwbHlEZW9wdGltaXphdGlvbnMoKTt9fWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUse3R5cGU6dH0pe3JldHVybiBlLmxlbmd0aD4wfHwwIT09dH1pbmNsdWRlKGUsdCl7dGhpcy5kZW9wdGltaXplZHx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLHQ/c3VwZXIuaW5jbHVkZShlLHQpOih0aGlzLmluY2x1ZGVkPSEwLHRoaXMuY2FsbGVlLmluY2x1ZGUoZSwhMSkpLHRoaXMuY2FsbGVlLmluY2x1ZGVDYWxsQXJndW1lbnRzKGUsdGhpcy5hcmd1bWVudHMpO31pbml0aWFsaXNlKCl7dGhpcy5pbnRlcmFjdGlvbj17YXJnczpbbnVsbCwuLi50aGlzLmFyZ3VtZW50c10sdHlwZToyLHdpdGhOZXc6ITB9O31yZW5kZXIoZSx0KXt0aGlzLmNhbGxlZS5yZW5kZXIoZSx0KSxEbihlLHQsdGhpcyk7fWFwcGx5RGVvcHRpbWl6YXRpb25zKCl7dGhpcy5kZW9wdGltaXplZD0hMCx0aGlzLmNhbGxlZS5kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aCh0aGlzLmludGVyYWN0aW9uLEssZWUpLHRoaXMuY29udGV4dC5yZXF1ZXN0VHJlZXNoYWtpbmdQYXNzKCk7fX0sT2JqZWN0RXhwcmVzc2lvbjpjbGFzcyBleHRlbmRzIFpze2NvbnN0cnVjdG9yKCl7c3VwZXIoLi4uYXJndW1lbnRzKSx0aGlzLm9iamVjdEVudGl0eT1udWxsO31kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7dGhpcy5nZXRPYmplY3RFbnRpdHkoKS5kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyk7fWRlb3B0aW1pemVDYWNoZSgpe3RoaXMuZ2V0T2JqZWN0RW50aXR5KCkuZGVvcHRpbWl6ZUFsbFByb3BlcnRpZXMoKTt9ZGVvcHRpbWl6ZVBhdGgoZSl7dGhpcy5nZXRPYmplY3RFbnRpdHkoKS5kZW9wdGltaXplUGF0aChlKTt9Z2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUsdCxzKXtyZXR1cm4gdGhpcy5nZXRPYmplY3RFbnRpdHkoKS5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpfWdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUsdCxzLGkpe3JldHVybiB0aGlzLmdldE9iamVjdEVudGl0eSgpLmdldFJldHVybkV4cHJlc3Npb25XaGVuQ2FsbGVkQXRQYXRoKGUsdCxzLGkpfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtyZXR1cm4gdGhpcy5nZXRPYmplY3RFbnRpdHkoKS5oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl9cmVuZGVyKGUsdCx7cmVuZGVyZWRTdXJyb3VuZGluZ0VsZW1lbnQ6c309cGUpe3N1cGVyLnJlbmRlcihlLHQpLHMhPT1OcyYmcyE9PVNzfHwoZS5hcHBlbmRSaWdodCh0aGlzLnN0YXJ0LCIoIiksZS5wcmVwZW5kTGVmdCh0aGlzLmVuZCwiKSIpKTt9YXBwbHlEZW9wdGltaXphdGlvbnMoKXt9Z2V0T2JqZWN0RW50aXR5KCl7aWYobnVsbCE9PXRoaXMub2JqZWN0RW50aXR5KXJldHVybiB0aGlzLm9iamVjdEVudGl0eTtsZXQgZT1jaTtjb25zdCB0PVtdO2Zvcihjb25zdCBzIG9mIHRoaXMucHJvcGVydGllcyl7aWYocyBpbnN0YW5jZW9mIEpzKXt0LnB1c2goe2tleTpHLGtpbmQ6ImluaXQiLHByb3BlcnR5OnN9KTtjb250aW51ZX1sZXQgaTtpZihzLmNvbXB1dGVkKXtjb25zdCBlPXMua2V5LmdldExpdGVyYWxWYWx1ZUF0UGF0aChLLGVlLHRoaXMpO2lmKCJzeW1ib2wiPT10eXBlb2YgZSl7dC5wdXNoKHtrZXk6RyxraW5kOnMua2luZCxwcm9wZXJ0eTpzfSk7Y29udGludWV9aT1TdHJpbmcoZSk7fWVsc2UgaWYoaT1zLmtleSBpbnN0YW5jZW9mIGFuP3Mua2V5Lm5hbWU6U3RyaW5nKHMua2V5LnZhbHVlKSwiX19wcm90b19fIj09PWkmJiJpbml0Ij09PXMua2luZCl7ZT1zLnZhbHVlIGluc3RhbmNlb2YgTG4mJm51bGw9PT1zLnZhbHVlLnZhbHVlP251bGw6cy52YWx1ZTtjb250aW51ZX10LnB1c2goe2tleTppLGtpbmQ6cy5raW5kLHByb3BlcnR5OnN9KTt9cmV0dXJuIHRoaXMub2JqZWN0RW50aXR5PW5ldyBvaSh0LGUpfX0sT2JqZWN0UGF0dGVybjpDbixQcml2YXRlSWRlbnRpZmllcjpjbGFzcyBleHRlbmRzIFpze30sUHJvZ3JhbTp0byxQcm9wZXJ0eTpjbGFzcyBleHRlbmRzIFdue2NvbnN0cnVjdG9yKCl7c3VwZXIoLi4uYXJndW1lbnRzKSx0aGlzLmRlY2xhcmF0aW9uSW5pdD1udWxsO31kZWNsYXJlKGUsdCl7cmV0dXJuIHRoaXMuZGVjbGFyYXRpb25Jbml0PXQsdGhpcy52YWx1ZS5kZWNsYXJlKGUscmUpfWhhc0VmZmVjdHMoZSl7dGhpcy5kZW9wdGltaXplZHx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpO2NvbnN0IHQ9dGhpcy5jb250ZXh0Lm9wdGlvbnMudHJlZXNoYWtlLnByb3BlcnR5UmVhZFNpZGVFZmZlY3RzO3JldHVybiAiT2JqZWN0UGF0dGVybiI9PT10aGlzLnBhcmVudC50eXBlJiYiYWx3YXlzIj09PXR8fHRoaXMua2V5Lmhhc0VmZmVjdHMoZSl8fHRoaXMudmFsdWUuaGFzRWZmZWN0cyhlKX1tYXJrRGVjbGFyYXRpb25SZWFjaGVkKCl7dGhpcy52YWx1ZS5tYXJrRGVjbGFyYXRpb25SZWFjaGVkKCk7fXJlbmRlcihlLHQpe3RoaXMuc2hvcnRoYW5kfHx0aGlzLmtleS5yZW5kZXIoZSx0KSx0aGlzLnZhbHVlLnJlbmRlcihlLHQse2lzU2hvcnRoYW5kUHJvcGVydHk6dGhpcy5zaG9ydGhhbmR9KTt9YXBwbHlEZW9wdGltaXphdGlvbnMoKXt0aGlzLmRlb3B0aW1pemVkPSEwLG51bGwhPT10aGlzLmRlY2xhcmF0aW9uSW5pdCYmKHRoaXMuZGVjbGFyYXRpb25Jbml0LmRlb3B0aW1pemVQYXRoKFtHLEddKSx0aGlzLmNvbnRleHQucmVxdWVzdFRyZWVzaGFraW5nUGFzcygpKTt9fSxQcm9wZXJ0eURlZmluaXRpb246Y2xhc3MgZXh0ZW5kcyBac3tkZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7dGhpcy52YWx1ZT8uZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpO31kZW9wdGltaXplUGF0aChlKXt0aGlzLnZhbHVlPy5kZW9wdGltaXplUGF0aChlKTt9Z2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUsdCxzKXtyZXR1cm4gdGhpcy52YWx1ZT90aGlzLnZhbHVlLmdldExpdGVyYWxWYWx1ZUF0UGF0aChlLHQscyk6c2V9Z2V0UmV0dXJuRXhwcmVzc2lvbldoZW5DYWxsZWRBdFBhdGgoZSx0LHMsaSl7cmV0dXJuIHRoaXMudmFsdWU/dGhpcy52YWx1ZS5nZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChlLHQscyxpKTpvZX1oYXNFZmZlY3RzKGUpe3JldHVybiB0aGlzLmtleS5oYXNFZmZlY3RzKGUpfHx0aGlzLnN0YXRpYyYmISF0aGlzLnZhbHVlPy5oYXNFZmZlY3RzKGUpfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXtyZXR1cm4gIXRoaXMudmFsdWV8fHRoaXMudmFsdWUuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpfWFwcGx5RGVvcHRpbWl6YXRpb25zKCl7fX0sUmVzdEVsZW1lbnQ6U24sUmV0dXJuU3RhdGVtZW50OmNsYXNzIGV4dGVuZHMgWnN7aGFzRWZmZWN0cyhlKXtyZXR1cm4gIShlLmlnbm9yZS5yZXR1cm5ZaWVsZCYmIXRoaXMuYXJndW1lbnQ/Lmhhc0VmZmVjdHMoZSkpfHwoZS5icm9rZW5GbG93PSEwLCExKX1pbmNsdWRlKGUsdCl7dGhpcy5pbmNsdWRlZD0hMCx0aGlzLmFyZ3VtZW50Py5pbmNsdWRlKGUsdCksZS5icm9rZW5GbG93PSEwO31pbml0aWFsaXNlKCl7dGhpcy5zY29wZS5hZGRSZXR1cm5FeHByZXNzaW9uKHRoaXMuYXJndW1lbnR8fHJlKTt9cmVuZGVyKGUsdCl7dGhpcy5hcmd1bWVudCYmKHRoaXMuYXJndW1lbnQucmVuZGVyKGUsdCx7cHJldmVudEFTSTohMH0pLHRoaXMuYXJndW1lbnQuc3RhcnQ9PT10aGlzLnN0YXJ0KzYmJmUucHJlcGVuZExlZnQodGhpcy5zdGFydCs2LCIgIikpO319LFNlcXVlbmNlRXhwcmVzc2lvbjpjbGFzcyBleHRlbmRzIFpze2Rlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXt0aGlzLmV4cHJlc3Npb25zW3RoaXMuZXhwcmVzc2lvbnMubGVuZ3RoLTFdLmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKTt9ZGVvcHRpbWl6ZVBhdGgoZSl7dGhpcy5leHByZXNzaW9uc1t0aGlzLmV4cHJlc3Npb25zLmxlbmd0aC0xXS5kZW9wdGltaXplUGF0aChlKTt9Z2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUsdCxzKXtyZXR1cm4gdGhpcy5leHByZXNzaW9uc1t0aGlzLmV4cHJlc3Npb25zLmxlbmd0aC0xXS5nZXRMaXRlcmFsVmFsdWVBdFBhdGgoZSx0LHMpfWhhc0VmZmVjdHMoZSl7Zm9yKGNvbnN0IHQgb2YgdGhpcy5leHByZXNzaW9ucylpZih0Lmhhc0VmZmVjdHMoZSkpcmV0dXJuICEwO3JldHVybiAhMX1oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7cmV0dXJuIHRoaXMuZXhwcmVzc2lvbnNbdGhpcy5leHByZXNzaW9ucy5sZW5ndGgtMV0uaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpfWluY2x1ZGUoZSx0KXt0aGlzLmluY2x1ZGVkPSEwO2NvbnN0IHM9dGhpcy5leHByZXNzaW9uc1t0aGlzLmV4cHJlc3Npb25zLmxlbmd0aC0xXTtmb3IoY29uc3QgaSBvZiB0aGlzLmV4cHJlc3Npb25zKSh0fHxpPT09cyYmISh0aGlzLnBhcmVudCBpbnN0YW5jZW9mIGJuKXx8aS5zaG91bGRCZUluY2x1ZGVkKGUpKSYmaS5pbmNsdWRlKGUsdCk7fXJlbmRlcihlLHQse3JlbmRlcmVkUGFyZW50VHlwZTpzLGlzQ2FsbGVlT2ZSZW5kZXJlZFBhcmVudDppLHByZXZlbnRBU0k6bn09cGUpe2xldCByPTAsbz1udWxsO2NvbnN0IGE9dGhpcy5leHByZXNzaW9uc1t0aGlzLmV4cHJlc3Npb25zLmxlbmd0aC0xXTtmb3IoY29uc3R7bm9kZTpsLHNlcGFyYXRvcjpjLHN0YXJ0OmgsZW5kOnV9b2YgeW4odGhpcy5leHByZXNzaW9ucyxlLHRoaXMuc3RhcnQsdGhpcy5lbmQpKWlmKGwuaW5jbHVkZWQpaWYocisrLG89YywxPT09ciYmbiYmeG4oZSxoLGwuc3RhcnQpLDE9PT1yKXtjb25zdCBuPXN8fHRoaXMucGFyZW50LnR5cGU7bC5yZW5kZXIoZSx0LHtpc0NhbGxlZU9mUmVuZGVyZWRQYXJlbnQ6aSYmbD09PWEscmVuZGVyZWRQYXJlbnRUeXBlOm4scmVuZGVyZWRTdXJyb3VuZGluZ0VsZW1lbnQ6bn0pO31lbHNlIGwucmVuZGVyKGUsdCk7ZWxzZSBjbihsLGUsaCx1KTtvJiZlLnJlbW92ZShvLHRoaXMuZW5kKTt9fSxTcHJlYWRFbGVtZW50OkpzLFN0YXRpY0Jsb2NrOmNsYXNzIGV4dGVuZHMgWnN7Y3JlYXRlU2NvcGUoZSl7dGhpcy5zY29wZT1uZXcgRW4oZSk7fWhhc0VmZmVjdHMoZSl7Zm9yKGNvbnN0IHQgb2YgdGhpcy5ib2R5KWlmKHQuaGFzRWZmZWN0cyhlKSlyZXR1cm4gITA7cmV0dXJuICExfWluY2x1ZGUoZSx0KXt0aGlzLmluY2x1ZGVkPSEwO2Zvcihjb25zdCBzIG9mIHRoaXMuYm9keSkodHx8cy5zaG91bGRCZUluY2x1ZGVkKGUpKSYmcy5pbmNsdWRlKGUsdCk7fXJlbmRlcihlLHQpe2lmKHRoaXMuYm9keS5sZW5ndGg+MCl7Y29uc3Qgcz1kbihlLm9yaWdpbmFsLnNsaWNlKHRoaXMuc3RhcnQsdGhpcy5lbmQpLCJ7IikrMTtnbih0aGlzLmJvZHksZSx0aGlzLnN0YXJ0K3MsdGhpcy5lbmQtMSx0KTt9ZWxzZSBzdXBlci5yZW5kZXIoZSx0KTt9fSxTdXBlcjpjbGFzcyBleHRlbmRzIFpze2JpbmQoKXt0aGlzLnZhcmlhYmxlPXRoaXMuc2NvcGUuZmluZFZhcmlhYmxlKCJ0aGlzIik7fWRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKXt0aGlzLnZhcmlhYmxlLmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKGUsdCxzKTt9ZGVvcHRpbWl6ZVBhdGgoZSl7dGhpcy52YXJpYWJsZS5kZW9wdGltaXplUGF0aChlKTt9aW5jbHVkZSgpe3RoaXMuaW5jbHVkZWR8fCh0aGlzLmluY2x1ZGVkPSEwLHRoaXMuY29udGV4dC5pbmNsdWRlVmFyaWFibGVJbk1vZHVsZSh0aGlzLnZhcmlhYmxlKSk7fX0sU3dpdGNoQ2FzZTpzbyxTd2l0Y2hTdGF0ZW1lbnQ6Y2xhc3MgZXh0ZW5kcyBac3tjcmVhdGVTY29wZShlKXt0aGlzLnBhcmVudFNjb3BlPWUsdGhpcy5zY29wZT1uZXcgRW4oZSk7fWhhc0VmZmVjdHMoZSl7aWYodGhpcy5kaXNjcmltaW5hbnQuaGFzRWZmZWN0cyhlKSlyZXR1cm4gITA7Y29uc3R7YnJva2VuRmxvdzp0LGhhc0JyZWFrOnMsaWdub3JlOml9PWUse2JyZWFrczpufT1pO2kuYnJlYWtzPSEwLGUuaGFzQnJlYWs9ITE7bGV0IHI9ITA7Zm9yKGNvbnN0IHMgb2YgdGhpcy5jYXNlcyl7aWYocy5oYXNFZmZlY3RzKGUpKXJldHVybiAhMDtyJiYocj1lLmJyb2tlbkZsb3cmJiFlLmhhc0JyZWFrKSxlLmhhc0JyZWFrPSExLGUuYnJva2VuRmxvdz10O31yZXR1cm4gbnVsbCE9PXRoaXMuZGVmYXVsdENhc2UmJihlLmJyb2tlbkZsb3c9ciksaS5icmVha3M9bixlLmhhc0JyZWFrPXMsITF9aW5jbHVkZShlLHQpe3RoaXMuaW5jbHVkZWQ9ITAsdGhpcy5kaXNjcmltaW5hbnQuaW5jbHVkZShlLHQpO2NvbnN0e2Jyb2tlbkZsb3c6cyxoYXNCcmVhazppfT1lO2UuaGFzQnJlYWs9ITE7bGV0IG49ITAscj10fHxudWxsIT09dGhpcy5kZWZhdWx0Q2FzZSYmdGhpcy5kZWZhdWx0Q2FzZTx0aGlzLmNhc2VzLmxlbmd0aC0xO2ZvcihsZXQgaT10aGlzLmNhc2VzLmxlbmd0aC0xO2k+PTA7aS0tKXtjb25zdCBvPXRoaXMuY2FzZXNbaV07aWYoby5pbmNsdWRlZCYmKHI9ITApLCFyKXtjb25zdCBlPXRzKCk7ZS5pZ25vcmUuYnJlYWtzPSEwLHI9by5oYXNFZmZlY3RzKGUpO31yPyhvLmluY2x1ZGUoZSx0KSxuJiYobj1lLmJyb2tlbkZsb3cmJiFlLmhhc0JyZWFrKSxlLmhhc0JyZWFrPSExLGUuYnJva2VuRmxvdz1zKTpuPXM7fXImJm51bGwhPT10aGlzLmRlZmF1bHRDYXNlJiYoZS5icm9rZW5GbG93PW4pLGUuaGFzQnJlYWs9aTt9aW5pdGlhbGlzZSgpe2ZvcihsZXQgZT0wO2U8dGhpcy5jYXNlcy5sZW5ndGg7ZSsrKWlmKG51bGw9PT10aGlzLmNhc2VzW2VdLnRlc3QpcmV0dXJuIHZvaWQodGhpcy5kZWZhdWx0Q2FzZT1lKTt0aGlzLmRlZmF1bHRDYXNlPW51bGw7fXBhcnNlTm9kZShlKXt0aGlzLmRpc2NyaW1pbmFudD1uZXcodGhpcy5jb250ZXh0LmdldE5vZGVDb25zdHJ1Y3RvcihlLmRpc2NyaW1pbmFudC50eXBlKSkoZS5kaXNjcmltaW5hbnQsdGhpcyx0aGlzLnBhcmVudFNjb3BlKSxzdXBlci5wYXJzZU5vZGUoZSk7fXJlbmRlcihlLHQpe3RoaXMuZGlzY3JpbWluYW50LnJlbmRlcihlLHQpLHRoaXMuY2FzZXMubGVuZ3RoPjAmJmduKHRoaXMuY2FzZXMsZSx0aGlzLmNhc2VzWzBdLnN0YXJ0LHRoaXMuZW5kLTEsdCk7fX0sVGFnZ2VkVGVtcGxhdGVFeHByZXNzaW9uOmNsYXNzIGV4dGVuZHMgRm57YmluZCgpe2lmKHN1cGVyLmJpbmQoKSx0aGlzLnRhZy50eXBlPT09UnMpe2NvbnN0IGU9dGhpcy50YWcubmFtZTt0aGlzLnNjb3BlLmZpbmRWYXJpYWJsZShlKS5pc05hbWVzcGFjZSYmdGhpcy5jb250ZXh0LmxvZyh2ZSxSdChlKSx0aGlzLnN0YXJ0KTt9fWhhc0VmZmVjdHMoZSl7dHJ5e2Zvcihjb25zdCB0IG9mIHRoaXMucXVhc2kuZXhwcmVzc2lvbnMpaWYodC5oYXNFZmZlY3RzKGUpKXJldHVybiAhMDtyZXR1cm4gdGhpcy50YWcuaGFzRWZmZWN0cyhlKXx8dGhpcy50YWcuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoSyx0aGlzLmludGVyYWN0aW9uLGUpfWZpbmFsbHl7dGhpcy5kZW9wdGltaXplZHx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpO319aW5jbHVkZShlLHQpe3RoaXMuZGVvcHRpbWl6ZWR8fHRoaXMuYXBwbHlEZW9wdGltaXphdGlvbnMoKSx0P3N1cGVyLmluY2x1ZGUoZSx0KToodGhpcy5pbmNsdWRlZD0hMCx0aGlzLnRhZy5pbmNsdWRlKGUsdCksdGhpcy5xdWFzaS5pbmNsdWRlKGUsdCkpLHRoaXMudGFnLmluY2x1ZGVDYWxsQXJndW1lbnRzKGUsdGhpcy5hcmdzKTtjb25zdFtzXT10aGlzLmdldFJldHVybkV4cHJlc3Npb24oKTtzLmluY2x1ZGVkfHxzLmluY2x1ZGUoZSwhMSk7fWluaXRpYWxpc2UoKXt0aGlzLmFyZ3M9W3JlLC4uLnRoaXMucXVhc2kuZXhwcmVzc2lvbnNdLHRoaXMuaW50ZXJhY3Rpb249e2FyZ3M6W3RoaXMudGFnIGluc3RhbmNlb2YgQm4mJiF0aGlzLnRhZy52YXJpYWJsZT90aGlzLnRhZy5vYmplY3Q6bnVsbCwuLi50aGlzLmFyZ3NdLHR5cGU6Mix3aXRoTmV3OiExfTt9cmVuZGVyKGUsdCl7dGhpcy50YWcucmVuZGVyKGUsdCx7aXNDYWxsZWVPZlJlbmRlcmVkUGFyZW50OiEwfSksdGhpcy5xdWFzaS5yZW5kZXIoZSx0KTt9YXBwbHlEZW9wdGltaXphdGlvbnMoKXt0aGlzLmRlb3B0aW1pemVkPSEwLHRoaXMudGFnLmRlb3B0aW1pemVBcmd1bWVudHNPbkludGVyYWN0aW9uQXRQYXRoKHRoaXMuaW50ZXJhY3Rpb24sSyxlZSksdGhpcy5jb250ZXh0LnJlcXVlc3RUcmVlc2hha2luZ1Bhc3MoKTt9Z2V0UmV0dXJuRXhwcmVzc2lvbihlPWVlKXtyZXR1cm4gbnVsbD09PXRoaXMucmV0dXJuRXhwcmVzc2lvbj8odGhpcy5yZXR1cm5FeHByZXNzaW9uPW9lLHRoaXMucmV0dXJuRXhwcmVzc2lvbj10aGlzLnRhZy5nZXRSZXR1cm5FeHByZXNzaW9uV2hlbkNhbGxlZEF0UGF0aChLLHRoaXMuaW50ZXJhY3Rpb24sZSx0aGlzKSk6dGhpcy5yZXR1cm5FeHByZXNzaW9ufX0sVGVtcGxhdGVFbGVtZW50OmNsYXNzIGV4dGVuZHMgWnN7YmluZCgpe31oYXNFZmZlY3RzKCl7cmV0dXJuICExfWluY2x1ZGUoKXt0aGlzLmluY2x1ZGVkPSEwO31wYXJzZU5vZGUoZSl7dGhpcy52YWx1ZT1lLnZhbHVlLHN1cGVyLnBhcnNlTm9kZShlKTt9cmVuZGVyKCl7fX0sVGVtcGxhdGVMaXRlcmFsOmlvLFRoaXNFeHByZXNzaW9uOmNsYXNzIGV4dGVuZHMgWnN7YmluZCgpe3RoaXMudmFyaWFibGU9dGhpcy5zY29wZS5maW5kVmFyaWFibGUoInRoaXMiKTt9ZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe3RoaXMudmFyaWFibGUuZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpO31kZW9wdGltaXplUGF0aChlKXt0aGlzLnZhcmlhYmxlLmRlb3B0aW1pemVQYXRoKGUpO31oYXNFZmZlY3RzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQscyl7cmV0dXJuIDA9PT1lLmxlbmd0aD8wIT09dC50eXBlOnRoaXMudmFyaWFibGUuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpfWluY2x1ZGUoKXt0aGlzLmluY2x1ZGVkfHwodGhpcy5pbmNsdWRlZD0hMCx0aGlzLmNvbnRleHQuaW5jbHVkZVZhcmlhYmxlSW5Nb2R1bGUodGhpcy52YXJpYWJsZSkpO31pbml0aWFsaXNlKCl7dGhpcy5hbGlhcz10aGlzLnNjb3BlLmZpbmRMZXhpY2FsQm91bmRhcnkoKWluc3RhbmNlb2Ygb28/dGhpcy5jb250ZXh0Lm1vZHVsZUNvbnRleHQ6bnVsbCwidW5kZWZpbmVkIj09PXRoaXMuYWxpYXMmJnRoaXMuY29udGV4dC5sb2codmUse2NvZGU6IlRISVNfSVNfVU5ERUZJTkVEIixtZXNzYWdlOiJUaGUgJ3RoaXMnIGtleXdvcmQgaXMgZXF1aXZhbGVudCB0byAndW5kZWZpbmVkJyBhdCB0aGUgdG9wIGxldmVsIG9mIGFuIEVTIG1vZHVsZSwgYW5kIGhhcyBiZWVuIHJld3JpdHRlbiIsdXJsOk1lKCJ0cm91Ymxlc2hvb3RpbmcvI2Vycm9yLXRoaXMtaXMtdW5kZWZpbmVkIil9LHRoaXMuc3RhcnQpO31yZW5kZXIoZSl7bnVsbCE9PXRoaXMuYWxpYXMmJmUub3ZlcndyaXRlKHRoaXMuc3RhcnQsdGhpcy5lbmQsdGhpcy5hbGlhcyx7Y29udGVudE9ubHk6ITEsc3RvcmVOYW1lOiEwfSk7fX0sVGhyb3dTdGF0ZW1lbnQ6Y2xhc3MgZXh0ZW5kcyBac3toYXNFZmZlY3RzKCl7cmV0dXJuICEwfWluY2x1ZGUoZSx0KXt0aGlzLmluY2x1ZGVkPSEwLHRoaXMuYXJndW1lbnQuaW5jbHVkZShlLHQpLGUuYnJva2VuRmxvdz0hMDt9cmVuZGVyKGUsdCl7dGhpcy5hcmd1bWVudC5yZW5kZXIoZSx0LHtwcmV2ZW50QVNJOiEwfSksdGhpcy5hcmd1bWVudC5zdGFydD09PXRoaXMuc3RhcnQrNSYmZS5wcmVwZW5kTGVmdCh0aGlzLnN0YXJ0KzUsIiAiKTt9fSxUcnlTdGF0ZW1lbnQ6Y2xhc3MgZXh0ZW5kcyBac3tjb25zdHJ1Y3Rvcigpe3N1cGVyKC4uLmFyZ3VtZW50cyksdGhpcy5kaXJlY3RseUluY2x1ZGVkPSExLHRoaXMuaW5jbHVkZWRMYWJlbHNBZnRlckJsb2NrPW51bGw7fWhhc0VmZmVjdHMoZSl7cmV0dXJuICh0aGlzLmNvbnRleHQub3B0aW9ucy50cmVlc2hha2UudHJ5Q2F0Y2hEZW9wdGltaXphdGlvbj90aGlzLmJsb2NrLmJvZHkubGVuZ3RoPjA6dGhpcy5ibG9jay5oYXNFZmZlY3RzKGUpKXx8ISF0aGlzLmZpbmFsaXplcj8uaGFzRWZmZWN0cyhlKX1pbmNsdWRlKGUsdCl7Y29uc3Qgcz10aGlzLmNvbnRleHQub3B0aW9ucy50cmVlc2hha2U/LnRyeUNhdGNoRGVvcHRpbWl6YXRpb24se2Jyb2tlbkZsb3c6aSxpbmNsdWRlZExhYmVsczpufT1lO2lmKHRoaXMuZGlyZWN0bHlJbmNsdWRlZCYmcyl7aWYodGhpcy5pbmNsdWRlZExhYmVsc0FmdGVyQmxvY2spZm9yKGNvbnN0IGUgb2YgdGhpcy5pbmNsdWRlZExhYmVsc0FmdGVyQmxvY2spbi5hZGQoZSk7fWVsc2UgdGhpcy5pbmNsdWRlZD0hMCx0aGlzLmRpcmVjdGx5SW5jbHVkZWQ9ITAsdGhpcy5ibG9jay5pbmNsdWRlKGUscz9Rczp0KSxuLnNpemU+MCYmKHRoaXMuaW5jbHVkZWRMYWJlbHNBZnRlckJsb2NrPVsuLi5uXSksZS5icm9rZW5GbG93PWk7bnVsbCE9PXRoaXMuaGFuZGxlciYmKHRoaXMuaGFuZGxlci5pbmNsdWRlKGUsdCksZS5icm9rZW5GbG93PWkpLHRoaXMuZmluYWxpemVyPy5pbmNsdWRlKGUsdCk7fX0sVW5hcnlFeHByZXNzaW9uOmNsYXNzIGV4dGVuZHMgWnN7Z2V0TGl0ZXJhbFZhbHVlQXRQYXRoKGUsdCxzKXtpZihlLmxlbmd0aD4wKXJldHVybiBzZTtjb25zdCBpPXRoaXMuYXJndW1lbnQuZ2V0TGl0ZXJhbFZhbHVlQXRQYXRoKEssdCxzKTtyZXR1cm4gInN5bWJvbCI9PXR5cGVvZiBpP3NlOmFvW3RoaXMub3BlcmF0b3JdKGkpfWhhc0VmZmVjdHMoZSl7cmV0dXJuIHRoaXMuZGVvcHRpbWl6ZWR8fHRoaXMuYXBwbHlEZW9wdGltaXphdGlvbnMoKSwhKCJ0eXBlb2YiPT09dGhpcy5vcGVyYXRvciYmdGhpcy5hcmd1bWVudCBpbnN0YW5jZW9mIGFuKSYmKHRoaXMuYXJndW1lbnQuaGFzRWZmZWN0cyhlKXx8ImRlbGV0ZSI9PT10aGlzLm9wZXJhdG9yJiZ0aGlzLmFyZ3VtZW50Lmhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKEssY2UsZSkpfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUse3R5cGU6dH0pe3JldHVybiAwIT09dHx8ZS5sZW5ndGg+KCJ2b2lkIj09PXRoaXMub3BlcmF0b3I/MDoxKX1hcHBseURlb3B0aW1pemF0aW9ucygpe3RoaXMuZGVvcHRpbWl6ZWQ9ITAsImRlbGV0ZSI9PT10aGlzLm9wZXJhdG9yJiYodGhpcy5hcmd1bWVudC5kZW9wdGltaXplUGF0aChLKSx0aGlzLmNvbnRleHQucmVxdWVzdFRyZWVzaGFraW5nUGFzcygpKTt9fSxVbmtub3duTm9kZTpjbGFzcyBleHRlbmRzIFpze2hhc0VmZmVjdHMoKXtyZXR1cm4gITB9aW5jbHVkZShlKXtzdXBlci5pbmNsdWRlKGUsITApO319LFVwZGF0ZUV4cHJlc3Npb246Y2xhc3MgZXh0ZW5kcyBac3toYXNFZmZlY3RzKGUpe3JldHVybiB0aGlzLmRlb3B0aW1pemVkfHx0aGlzLmFwcGx5RGVvcHRpbWl6YXRpb25zKCksdGhpcy5hcmd1bWVudC5oYXNFZmZlY3RzQXNBc3NpZ25tZW50VGFyZ2V0KGUsITApfWhhc0VmZmVjdHNPbkludGVyYWN0aW9uQXRQYXRoKGUse3R5cGU6dH0pe3JldHVybiBlLmxlbmd0aD4xfHwwIT09dH1pbmNsdWRlKGUsdCl7dGhpcy5kZW9wdGltaXplZHx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLHRoaXMuaW5jbHVkZWQ9ITAsdGhpcy5hcmd1bWVudC5pbmNsdWRlQXNBc3NpZ25tZW50VGFyZ2V0KGUsdCwhMCk7fWluaXRpYWxpc2UoKXt0aGlzLmFyZ3VtZW50LnNldEFzc2lnbmVkVmFsdWUocmUpO31yZW5kZXIoZSx0KXtjb25zdHtleHBvcnROYW1lc0J5VmFyaWFibGU6cyxmb3JtYXQ6aSxzbmlwcGV0czp7XzpufX09dDtpZih0aGlzLmFyZ3VtZW50LnJlbmRlcihlLHQpLCJzeXN0ZW0iPT09aSl7Y29uc3QgaT10aGlzLmFyZ3VtZW50LnZhcmlhYmxlLHI9cy5nZXQoaSk7aWYocilpZih0aGlzLnByZWZpeCkxPT09ci5sZW5ndGg/d24oaSx0aGlzLnN0YXJ0LHRoaXMuZW5kLGUsdCk6UG4oaSx0aGlzLnN0YXJ0LHRoaXMuZW5kLHRoaXMucGFyZW50LnR5cGUhPT1OcyxlLHQpO2Vsc2Uge2NvbnN0IHM9dGhpcy5vcGVyYXRvclswXTshZnVuY3Rpb24oZSx0LHMsaSxuLHIsbyl7Y29uc3R7XzphfT1yLnNuaXBwZXRzO24ucHJlcGVuZFJpZ2h0KHQsYCR7SW4oW2VdLHIsbyl9LCR7YX1gKSxpJiYobi5wcmVwZW5kUmlnaHQodCwiKCIpLG4uYXBwZW5kTGVmdChzLCIpIikpO30oaSx0aGlzLnN0YXJ0LHRoaXMuZW5kLHRoaXMucGFyZW50LnR5cGUhPT1OcyxlLHQsYCR7bn0ke3N9JHtufTFgKTt9fX1hcHBseURlb3B0aW1pemF0aW9ucygpe2lmKHRoaXMuZGVvcHRpbWl6ZWQ9ITAsdGhpcy5hcmd1bWVudC5kZW9wdGltaXplUGF0aChLKSx0aGlzLmFyZ3VtZW50IGluc3RhbmNlb2YgYW4pe3RoaXMuc2NvcGUuZmluZFZhcmlhYmxlKHRoaXMuYXJndW1lbnQubmFtZSkuaXNSZWFzc2lnbmVkPSEwO310aGlzLmNvbnRleHQucmVxdWVzdFRyZWVzaGFraW5nUGFzcygpO319LFZhcmlhYmxlRGVjbGFyYXRpb246bG8sVmFyaWFibGVEZWNsYXJhdG9yOlZyLFdoaWxlU3RhdGVtZW50OmNsYXNzIGV4dGVuZHMgWnN7aGFzRWZmZWN0cyhlKXtyZXR1cm4gISF0aGlzLnRlc3QuaGFzRWZmZWN0cyhlKXx8Wm4oZSx0aGlzLmJvZHkpfWluY2x1ZGUoZSx0KXt0aGlzLmluY2x1ZGVkPSEwLHRoaXMudGVzdC5pbmNsdWRlKGUsdCksSm4oZSx0aGlzLmJvZHksdCk7fX0sWWllbGRFeHByZXNzaW9uOmNsYXNzIGV4dGVuZHMgWnN7aGFzRWZmZWN0cyhlKXtyZXR1cm4gdGhpcy5kZW9wdGltaXplZHx8dGhpcy5hcHBseURlb3B0aW1pemF0aW9ucygpLCEoZS5pZ25vcmUucmV0dXJuWWllbGQmJiF0aGlzLmFyZ3VtZW50Py5oYXNFZmZlY3RzKGUpKX1yZW5kZXIoZSx0KXt0aGlzLmFyZ3VtZW50JiYodGhpcy5hcmd1bWVudC5yZW5kZXIoZSx0LHtwcmV2ZW50QVNJOiEwfSksdGhpcy5hcmd1bWVudC5zdGFydD09PXRoaXMuc3RhcnQrNSYmZS5wcmVwZW5kTGVmdCh0aGlzLnN0YXJ0KzUsIiAiKSk7fX19LGhvPSJfbWlzc2luZ0V4cG9ydFNoaW0iO2NsYXNzIHVvIGV4dGVuZHMgdWV7Y29uc3RydWN0b3IoZSl7c3VwZXIoaG8pLHRoaXMubW9kdWxlPWU7fWluY2x1ZGUoKXtzdXBlci5pbmNsdWRlKCksdGhpcy5tb2R1bGUubmVlZHNFeHBvcnRTaGltPSEwO319Y2xhc3MgcG8gZXh0ZW5kcyB1ZXtjb25zdHJ1Y3RvcihlKXtzdXBlcihlLmdldE1vZHVsZU5hbWUoKSksdGhpcy5tZW1iZXJWYXJpYWJsZXM9bnVsbCx0aGlzLm1lcmdlZE5hbWVzcGFjZXM9W10sdGhpcy5yZWZlcmVuY2VkRWFybHk9ITEsdGhpcy5yZWZlcmVuY2VzPVtdLHRoaXMuY29udGV4dD1lLHRoaXMubW9kdWxlPWUubW9kdWxlO31hZGRSZWZlcmVuY2UoZSl7dGhpcy5yZWZlcmVuY2VzLnB1c2goZSksdGhpcy5uYW1lPWUubmFtZTt9ZGVvcHRpbWl6ZUFyZ3VtZW50c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe2lmKHQubGVuZ3RoPjF8fDE9PT10Lmxlbmd0aCYmMj09PWUudHlwZSl7Y29uc3QgaT10WzBdOyJzdHJpbmciPT10eXBlb2YgaT90aGlzLmdldE1lbWJlclZhcmlhYmxlcygpW2ldPy5kZW9wdGltaXplQXJndW1lbnRzT25JbnRlcmFjdGlvbkF0UGF0aChlLHQuc2xpY2UoMSkscyk6YWUoZSk7fX1kZW9wdGltaXplUGF0aChlKXtpZihlLmxlbmd0aD4xKXtjb25zdCB0PWVbMF07InN0cmluZyI9PXR5cGVvZiB0JiZ0aGlzLmdldE1lbWJlclZhcmlhYmxlcygpW3RdPy5kZW9wdGltaXplUGF0aChlLnNsaWNlKDEpKTt9fWdldExpdGVyYWxWYWx1ZUF0UGF0aChlKXtyZXR1cm4gZVswXT09PUg/Ik1vZHVsZSI6c2V9Z2V0TWVtYmVyVmFyaWFibGVzKCl7aWYodGhpcy5tZW1iZXJWYXJpYWJsZXMpcmV0dXJuIHRoaXMubWVtYmVyVmFyaWFibGVzO2NvbnN0IGU9T2JqZWN0LmNyZWF0ZShudWxsKSx0PVsuLi50aGlzLmNvbnRleHQuZ2V0RXhwb3J0cygpLC4uLnRoaXMuY29udGV4dC5nZXRSZWV4cG9ydHMoKV0uc29ydCgpO2Zvcihjb25zdCBzIG9mIHQpaWYoIioiIT09c1swXSYmcyE9PXRoaXMubW9kdWxlLmluZm8uc3ludGhldGljTmFtZWRFeHBvcnRzKXtjb25zdCB0PXRoaXMuY29udGV4dC50cmFjZUV4cG9ydChzKTt0JiYoZVtzXT10KTt9cmV0dXJuIHRoaXMubWVtYmVyVmFyaWFibGVzPWV9aGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZSx0LHMpe2NvbnN0e3R5cGU6aX09dDtpZigwPT09ZS5sZW5ndGgpcmV0dXJuICEwO2lmKDE9PT1lLmxlbmd0aCYmMiE9PWkpcmV0dXJuIDE9PT1pO2NvbnN0IG49ZVswXTtpZigic3RyaW5nIiE9dHlwZW9mIG4pcmV0dXJuICEwO2NvbnN0IHI9dGhpcy5nZXRNZW1iZXJWYXJpYWJsZXMoKVtuXTtyZXR1cm4gIXJ8fHIuaGFzRWZmZWN0c09uSW50ZXJhY3Rpb25BdFBhdGgoZS5zbGljZSgxKSx0LHMpfWluY2x1ZGUoKXt0aGlzLmluY2x1ZGVkPSEwLHRoaXMuY29udGV4dC5pbmNsdWRlQWxsRXhwb3J0cygpO31wcmVwYXJlKGUpe3RoaXMubWVyZ2VkTmFtZXNwYWNlcy5sZW5ndGg+MCYmdGhpcy5tb2R1bGUuc2NvcGUuYWRkQWNjZXNzZWRHbG9iYWxzKFtncl0sZSk7fXJlbmRlckJsb2NrKGUpe2NvbnN0e2V4cG9ydE5hbWVzQnlWYXJpYWJsZTp0LGZvcm1hdDpzLGZyZWV6ZTppLGluZGVudDpuLG5hbWVzcGFjZVRvU3RyaW5nVGFnOnIsc25pcHBldHM6e186byxjbnN0OmEsZ2V0T2JqZWN0OmwsZ2V0UHJvcGVydHlBY2Nlc3M6YyxuOmgsczp1fX09ZSxkPXRoaXMuZ2V0TWVtYmVyVmFyaWFibGVzKCkscD1PYmplY3QuZW50cmllcyhkKS5maWx0ZXIoKChbZSx0XSk9PnQuaW5jbHVkZWQpKS5tYXAoKChbZSx0XSk9PnRoaXMucmVmZXJlbmNlZEVhcmx5fHx0LmlzUmVhc3NpZ25lZHx8dD09PXRoaXM/W251bGwsYGdldCAke2V9JHtvfSgpJHtvfXske299cmV0dXJuICR7dC5nZXROYW1lKGMpfSR7dX0ke299fWBdOltlLHQuZ2V0TmFtZShjKV0pKTtwLnVuc2hpZnQoW251bGwsYF9fcHJvdG9fXzoke299bnVsbGBdKTtsZXQgZj1sKHAse2xpbmVCcmVha0luZGVudDp7YmFzZToiIix0Om59fSk7aWYodGhpcy5tZXJnZWROYW1lc3BhY2VzLmxlbmd0aD4wKXtjb25zdCBlPXRoaXMubWVyZ2VkTmFtZXNwYWNlcy5tYXAoKGU9PmUuZ2V0TmFtZShjKSkpO2Y9YC8qI19fUFVSRV9fKi8ke2dyfSgke2Z9LCR7b31bJHtlLmpvaW4oYCwke299YCl9XSlgO31lbHNlIHImJihmPWAvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KCR7Zn0sJHtvfVN5bWJvbC50b1N0cmluZ1RhZywke299JHtMcihsKX0pYCksaSYmKGY9YC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKCR7Zn0pYCk7cmV0dXJuIGY9YCR7YX0gJHt0aGlzLmdldE5hbWUoYyl9JHtvfT0ke299JHtmfTtgLCJzeXN0ZW0iPT09cyYmdC5oYXModGhpcykmJihmKz1gJHtofSR7SW4oW3RoaXNdLGUpfTtgKSxmfXJlbmRlckZpcnN0KCl7cmV0dXJuIHRoaXMucmVmZXJlbmNlZEVhcmx5fXNldE1lcmdlZE5hbWVzcGFjZXMoZSl7dGhpcy5tZXJnZWROYW1lc3BhY2VzPWU7Y29uc3QgdD10aGlzLmNvbnRleHQuZ2V0TW9kdWxlRXhlY0luZGV4KCk7Zm9yKGNvbnN0IGUgb2YgdGhpcy5yZWZlcmVuY2VzKWlmKGUuY29udGV4dC5nZXRNb2R1bGVFeGVjSW5kZXgoKTw9dCl7dGhpcy5yZWZlcmVuY2VkRWFybHk9ITA7YnJlYWt9fX1wby5wcm90b3R5cGUuaXNOYW1lc3BhY2U9ITA7Y2xhc3MgZm8gZXh0ZW5kcyB1ZXtjb25zdHJ1Y3RvcihlLHQscyl7c3VwZXIodCksdGhpcy5iYXNlVmFyaWFibGU9bnVsbCx0aGlzLmNvbnRleHQ9ZSx0aGlzLm1vZHVsZT1lLm1vZHVsZSx0aGlzLnN5bnRoZXRpY05hbWVzcGFjZT1zO31nZXRCYXNlVmFyaWFibGUoKXtpZih0aGlzLmJhc2VWYXJpYWJsZSlyZXR1cm4gdGhpcy5iYXNlVmFyaWFibGU7bGV0IGU9dGhpcy5zeW50aGV0aWNOYW1lc3BhY2U7Zm9yKDtlIGluc3RhbmNlb2Ygcm98fGUgaW5zdGFuY2VvZiBmbzspe2lmKGUgaW5zdGFuY2VvZiBybyl7Y29uc3QgdD1lLmdldE9yaWdpbmFsVmFyaWFibGUoKTtpZih0PT09ZSlicmVhaztlPXQ7fWUgaW5zdGFuY2VvZiBmbyYmKGU9ZS5zeW50aGV0aWNOYW1lc3BhY2UpO31yZXR1cm4gdGhpcy5iYXNlVmFyaWFibGU9ZX1nZXRCYXNlVmFyaWFibGVOYW1lKCl7cmV0dXJuIHRoaXMuc3ludGhldGljTmFtZXNwYWNlLmdldEJhc2VWYXJpYWJsZU5hbWUoKX1nZXROYW1lKGUpe3JldHVybiBgJHt0aGlzLnN5bnRoZXRpY05hbWVzcGFjZS5nZXROYW1lKGUpfSR7ZSh0aGlzLm5hbWUpfWB9aW5jbHVkZSgpe3RoaXMuaW5jbHVkZWQ9ITAsdGhpcy5jb250ZXh0LmluY2x1ZGVWYXJpYWJsZUluTW9kdWxlKHRoaXMuc3ludGhldGljTmFtZXNwYWNlKTt9c2V0UmVuZGVyTmFtZXMoZSx0KXtzdXBlci5zZXRSZW5kZXJOYW1lcyhlLHQpO319dmFyIG1vOyFmdW5jdGlvbihlKXtlW2UuTE9BRF9BTkRfUEFSU0U9MF09IkxPQURfQU5EX1BBUlNFIixlW2UuQU5BTFlTRT0xXT0iQU5BTFlTRSIsZVtlLkdFTkVSQVRFPTJdPSJHRU5FUkFURSI7fShtb3x8KG1vPXt9KSk7Y29uc3QgZ289bmV3IFdlYWtNYXA7ZnVuY3Rpb24geW8oZSx0KXtpZihlKXtjb25zdCB0PWdvLmdldChlKTt0JiZmdW5jdGlvbihlKXt2b2lkIDA9PT1lLmVuY29kZWRNYXBwaW5ncyYmZS5kZWNvZGVkTWFwcGluZ3MmJihlLmVuY29kZWRNYXBwaW5ncz1pLmVuY29kZShlLmRlY29kZWRNYXBwaW5ncykpLGUuZGVjb2RlZE1hcHBpbmdzPXZvaWQgMDt9KHQpO31pZih0KWZvcihjb25zdCBlIG9mIHQpZS5taXNzaW5nfHx5byhlKTt9ZnVuY3Rpb24geG8oZSl7aWYoIWUpcmV0dXJuIG51bGw7aWYoInN0cmluZyI9PXR5cGVvZiBlJiYoZT1KU09OLnBhcnNlKGUpKSwhZS5tYXBwaW5ncylyZXR1cm4ge21hcHBpbmdzOltdLG5hbWVzOltdLHNvdXJjZXM6W10sdmVyc2lvbjozfTtjb25zdCB0PWUubWFwcGluZ3Mscz1BcnJheS5pc0FycmF5KHQpLG49e2RlY29kZWRNYXBwaW5nczpzP3Q6dm9pZCAwLGVuY29kZWRNYXBwaW5nczpzP3ZvaWQgMDp0fSxyPXsuLi5lLGdldCBtYXBwaW5ncygpe3JldHVybiBuLmRlY29kZWRNYXBwaW5nc3x8KG4uZGVjb2RlZE1hcHBpbmdzPW4uZW5jb2RlZE1hcHBpbmdzP2kuZGVjb2RlKG4uZW5jb2RlZE1hcHBpbmdzKTpbXSxuLmVuY29kZWRNYXBwaW5ncz12b2lkIDApLG4uZGVjb2RlZE1hcHBpbmdzfX07cmV0dXJuIGdvLnNldChyLG4pLHJ9ZnVuY3Rpb24gRW8oZSl7cmV0dXJuIGUuaWR9Y29uc3QgYm89ZT0+e2NvbnN0IHQ9ZS5rZXk7cmV0dXJuIHQmJih0Lm5hbWV8fHQudmFsdWUpfTtmdW5jdGlvbiB2byhlLHQpe2NvbnN0IHM9T2JqZWN0LmtleXMoZSk7cmV0dXJuIHMubGVuZ3RoIT09T2JqZWN0LmtleXModCkubGVuZ3RofHxzLnNvbWUoKHM9PmVbc10hPT10W3NdKSl9dmFyIFNvPSJwZXJmb3JtYW5jZSJpbigidW5kZWZpbmVkIj09dHlwZW9mIGdsb2JhbFRoaXM/InVuZGVmaW5lZCI9PXR5cGVvZiB3aW5kb3c/e306d2luZG93Omdsb2JhbFRoaXMpP3BlcmZvcm1hbmNlOntub3c6KCk9PjB9LEFvPXttZW1vcnlVc2FnZTooKT0+KHtoZWFwVXNlZDowfSl9O2xldCBrbz1uZXcgTWFwO2Z1bmN0aW9uIElvKGUsdCl7c3dpdGNoKHQpe2Nhc2UgMTpyZXR1cm4gYCMgJHtlfWA7Y2FzZSAyOnJldHVybiBgIyMgJHtlfWA7Y2FzZSAzOnJldHVybiBlO2RlZmF1bHQ6cmV0dXJuIGAkeyIgICIucmVwZWF0KHQtNCl9LSAke2V9YH19ZnVuY3Rpb24gd28oZSx0PTMpe2U9SW8oZSx0KTtjb25zdCBzPUFvLm1lbW9yeVVzYWdlKCkuaGVhcFVzZWQsaT1Tby5ub3coKSxuPWtvLmdldChlKTt2b2lkIDA9PT1uP2tvLnNldChlLHttZW1vcnk6MCxzdGFydE1lbW9yeTpzLHN0YXJ0VGltZTppLHRpbWU6MCx0b3RhbE1lbW9yeTowfSk6KG4uc3RhcnRNZW1vcnk9cyxuLnN0YXJ0VGltZT1pKTt9ZnVuY3Rpb24gUG8oZSx0PTMpe2U9SW8oZSx0KTtjb25zdCBzPWtvLmdldChlKTtpZih2b2lkIDAhPT1zKXtjb25zdCBlPUFvLm1lbW9yeVVzYWdlKCkuaGVhcFVzZWQ7cy5tZW1vcnkrPWUtcy5zdGFydE1lbW9yeSxzLnRpbWUrPVNvLm5vdygpLXMuc3RhcnRUaW1lLHMudG90YWxNZW1vcnk9TWF0aC5tYXgocy50b3RhbE1lbW9yeSxlKTt9fWZ1bmN0aW9uIENvKCl7Y29uc3QgZT17fTtmb3IoY29uc3RbdCx7bWVtb3J5OnMsdGltZTppLHRvdGFsTWVtb3J5Om59XW9mIGtvKWVbdF09W2kscyxuXTtyZXR1cm4gZX1sZXQgJG89RmksTm89Rmk7Y29uc3QgX289WyJhdWdtZW50Q2h1bmtIYXNoIiwiYnVpbGRFbmQiLCJidWlsZFN0YXJ0IiwiZ2VuZXJhdGVCdW5kbGUiLCJsb2FkIiwibW9kdWxlUGFyc2VkIiwib3B0aW9ucyIsIm91dHB1dE9wdGlvbnMiLCJyZW5kZXJDaHVuayIsInJlbmRlckR5bmFtaWNJbXBvcnQiLCJyZW5kZXJTdGFydCIsInJlc29sdmVEeW5hbWljSW1wb3J0IiwicmVzb2x2ZUZpbGVVcmwiLCJyZXNvbHZlSWQiLCJyZXNvbHZlSW1wb3J0TWV0YSIsInNob3VsZFRyYW5zZm9ybUNhY2hlZE1vZHVsZSIsInRyYW5zZm9ybSIsIndyaXRlQnVuZGxlIl07ZnVuY3Rpb24gUm8oZSx0KXtmb3IoY29uc3QgcyBvZiBfbylpZihzIGluIGUpe2xldCBpPWBwbHVnaW4gJHt0fWA7ZS5uYW1lJiYoaSs9YCAoJHtlLm5hbWV9KWApLGkrPWAgLSAke3N9YDtjb25zdCBuPWZ1bmN0aW9uKC4uLmUpeyRvKGksNCk7Y29uc3QgdD1yLmFwcGx5KHRoaXMsZSk7cmV0dXJuIE5vKGksNCksdH07bGV0IHI7ImZ1bmN0aW9uIj09dHlwZW9mIGVbc10uaGFuZGxlcj8ocj1lW3NdLmhhbmRsZXIsZVtzXS5oYW5kbGVyPW4pOihyPWVbc10sZVtzXT1uKTt9cmV0dXJuIGV9ZnVuY3Rpb24gTW8oZSl7ZS5pc0V4ZWN1dGVkPSEwO2NvbnN0IHQ9W2VdLHM9bmV3IFNldDtmb3IoY29uc3QgZSBvZiB0KWZvcihjb25zdCBpIG9mIFsuLi5lLmRlcGVuZGVuY2llcywuLi5lLmltcGxpY2l0bHlMb2FkZWRCZWZvcmVdKWkgaW5zdGFuY2VvZiBRdHx8aS5pc0V4ZWN1dGVkfHwhaS5pbmZvLm1vZHVsZVNpZGVFZmZlY3RzJiYhZS5pbXBsaWNpdGx5TG9hZGVkQmVmb3JlLmhhcyhpKXx8cy5oYXMoaS5pZCl8fChpLmlzRXhlY3V0ZWQ9ITAscy5hZGQoaS5pZCksdC5wdXNoKGkpKTt9Y29uc3QgT289e2lkZW50aWZpZXI6bnVsbCxsb2NhbE5hbWU6aG99O2Z1bmN0aW9uIERvKGUsdCxzLGksbj1uZXcgTWFwKXtjb25zdCByPW4uZ2V0KHQpO2lmKHIpe2lmKHIuaGFzKGUpKXJldHVybiBpP1tudWxsXTpZZSgobz10LGE9ZS5pZCx7Y29kZTppdCxleHBvcnRlcjphLG1lc3NhZ2U6YCIke299IiBjYW5ub3QgYmUgZXhwb3J0ZWQgZnJvbSAiJHtMKGEpfSIgYXMgaXQgaXMgYSByZWV4cG9ydCB0aGF0IHJlZmVyZW5jZXMgaXRzZWxmLmB9KSk7ci5hZGQoZSk7fWVsc2Ugbi5zZXQodCxuZXcgU2V0KFtlXSkpO3ZhciBvLGE7cmV0dXJuIGUuZ2V0VmFyaWFibGVGb3JFeHBvcnROYW1lKHQse2ltcG9ydGVyRm9yU2lkZUVmZmVjdHM6cyxpc0V4cG9ydEFsbFNlYXJjaDppLHNlYXJjaGVkTmFtZXNBbmRNb2R1bGVzOm59KX1mdW5jdGlvbiBMbyhlLHQpe2NvbnN0IHM9RiQzKHQuc2lkZUVmZmVjdERlcGVuZGVuY2llc0J5VmFyaWFibGUsZSxqKTtsZXQgaT1lO2NvbnN0IG49bmV3IFNldChbaV0pO2Zvcig7Oyl7Y29uc3QgZT1pLm1vZHVsZTtpZihpPWkgaW5zdGFuY2VvZiBybz9pLmdldERpcmVjdE9yaWdpbmFsVmFyaWFibGUoKTppIGluc3RhbmNlb2YgZm8/aS5zeW50aGV0aWNOYW1lc3BhY2U6bnVsbCwhaXx8bi5oYXMoaSkpYnJlYWs7bi5hZGQoaSkscy5hZGQoZSk7Y29uc3QgdD1lLnNpZGVFZmZlY3REZXBlbmRlbmNpZXNCeVZhcmlhYmxlLmdldChpKTtpZih0KWZvcihjb25zdCBlIG9mIHQpcy5hZGQoZSk7fXJldHVybiBzfWNsYXNzIFRve2NvbnN0cnVjdG9yKGUsdCxzLGksbixyLG8sYSl7dGhpcy5ncmFwaD1lLHRoaXMuaWQ9dCx0aGlzLm9wdGlvbnM9cyx0aGlzLmFsdGVybmF0aXZlUmVleHBvcnRNb2R1bGVzPW5ldyBNYXAsdGhpcy5jaHVua0ZpbGVOYW1lcz1uZXcgU2V0LHRoaXMuY2h1bmtOYW1lcz1bXSx0aGlzLmN5Y2xlcz1uZXcgU2V0LHRoaXMuZGVwZW5kZW5jaWVzPW5ldyBTZXQsdGhpcy5keW5hbWljRGVwZW5kZW5jaWVzPW5ldyBTZXQsdGhpcy5keW5hbWljSW1wb3J0ZXJzPVtdLHRoaXMuZHluYW1pY0ltcG9ydHM9W10sdGhpcy5leGVjSW5kZXg9MS8wLHRoaXMuaW1wbGljaXRseUxvYWRlZEFmdGVyPW5ldyBTZXQsdGhpcy5pbXBsaWNpdGx5TG9hZGVkQmVmb3JlPW5ldyBTZXQsdGhpcy5pbXBvcnREZXNjcmlwdGlvbnM9bmV3IE1hcCx0aGlzLmltcG9ydE1ldGFzPVtdLHRoaXMuaW1wb3J0ZWRGcm9tTm90VHJlZXNoYWtlbj0hMSx0aGlzLmltcG9ydGVycz1bXSx0aGlzLmluY2x1ZGVkRHluYW1pY0ltcG9ydGVycz1bXSx0aGlzLmluY2x1ZGVkSW1wb3J0cz1uZXcgU2V0LHRoaXMuaXNFeGVjdXRlZD0hMSx0aGlzLmlzVXNlckRlZmluZWRFbnRyeVBvaW50PSExLHRoaXMubmVlZHNFeHBvcnRTaGltPSExLHRoaXMuc2lkZUVmZmVjdERlcGVuZGVuY2llc0J5VmFyaWFibGU9bmV3IE1hcCx0aGlzLnNvdXJjZXNXaXRoQXNzZXJ0aW9ucz1uZXcgTWFwLHRoaXMuYWxsRXhwb3J0TmFtZXM9bnVsbCx0aGlzLmFzdD1udWxsLHRoaXMuZXhwb3J0QWxsTW9kdWxlcz1bXSx0aGlzLmV4cG9ydEFsbFNvdXJjZXM9bmV3IFNldCx0aGlzLmV4cG9ydE5hbWVzQnlWYXJpYWJsZT1udWxsLHRoaXMuZXhwb3J0U2hpbVZhcmlhYmxlPW5ldyB1byh0aGlzKSx0aGlzLmV4cG9ydHM9bmV3IE1hcCx0aGlzLm5hbWVzcGFjZVJlZXhwb3J0c0J5TmFtZT1uZXcgTWFwLHRoaXMucmVleHBvcnREZXNjcmlwdGlvbnM9bmV3IE1hcCx0aGlzLnJlbGV2YW50RGVwZW5kZW5jaWVzPW51bGwsdGhpcy5zeW50aGV0aWNFeHBvcnRzPW5ldyBNYXAsdGhpcy5zeW50aGV0aWNOYW1lc3BhY2U9bnVsbCx0aGlzLnRyYW5zZm9ybURlcGVuZGVuY2llcz1bXSx0aGlzLnRyYW5zaXRpdmVSZWV4cG9ydHM9bnVsbCx0aGlzLmV4Y2x1ZGVGcm9tU291cmNlbWFwPS9cMC8udGVzdCh0KSx0aGlzLmNvbnRleHQ9cy5tb2R1bGVDb250ZXh0KHQpLHRoaXMucHJlc2VydmVTaWduYXR1cmU9dGhpcy5vcHRpb25zLnByZXNlcnZlRW50cnlTaWduYXR1cmVzO2NvbnN0IGw9dGhpcyx7ZHluYW1pY0ltcG9ydHM6YyxkeW5hbWljSW1wb3J0ZXJzOmgsZXhwb3J0QWxsU291cmNlczp1LGV4cG9ydHM6ZCxpbXBsaWNpdGx5TG9hZGVkQWZ0ZXI6cCxpbXBsaWNpdGx5TG9hZGVkQmVmb3JlOmYsaW1wb3J0ZXJzOm0scmVleHBvcnREZXNjcmlwdGlvbnM6Zyxzb3VyY2VzV2l0aEFzc2VydGlvbnM6eX09dGhpczt0aGlzLmluZm89e2Fzc2VydGlvbnM6YSxhc3Q6bnVsbCxjb2RlOm51bGwsZ2V0IGR5bmFtaWNhbGx5SW1wb3J0ZWRJZFJlc29sdXRpb25zKCl7cmV0dXJuIGMubWFwKCgoe2FyZ3VtZW50OmV9KT0+InN0cmluZyI9PXR5cGVvZiBlJiZsLnJlc29sdmVkSWRzW2VdKSkuZmlsdGVyKEJvb2xlYW4pfSxnZXQgZHluYW1pY2FsbHlJbXBvcnRlZElkcygpe3JldHVybiBjLm1hcCgoKHtpZDplfSk9PmUpKS5maWx0ZXIoKGU9Pm51bGwhPWUpKX0sZ2V0IGR5bmFtaWNJbXBvcnRlcnMoKXtyZXR1cm4gaC5zb3J0KCl9LGdldCBleHBvcnRlZEJpbmRpbmdzKCl7Y29uc3QgZT17Ii4iOlsuLi5kLmtleXMoKV19O2Zvcihjb25zdFt0LHtzb3VyY2U6c31db2YgZykoZVtzXT8/KGVbc109W10pKS5wdXNoKHQpO2Zvcihjb25zdCB0IG9mIHUpKGVbdF0/PyhlW3RdPVtdKSkucHVzaCgiKiIpO3JldHVybiBlfSxnZXQgZXhwb3J0cygpe3JldHVybiBbLi4uZC5rZXlzKCksLi4uZy5rZXlzKCksLi4uWy4uLnVdLm1hcCgoKCk9PiIqIikpXX0sZ2V0IGhhc0RlZmF1bHRFeHBvcnQoKXtyZXR1cm4gbC5hc3Q/bC5leHBvcnRzLmhhcygiZGVmYXVsdCIpfHxnLmhhcygiZGVmYXVsdCIpOm51bGx9LGdldCBoYXNNb2R1bGVTaWRlRWZmZWN0cygpe3JldHVybiBZdCgiQWNjZXNzaW5nIE1vZHVsZUluZm8uaGFzTW9kdWxlU2lkZUVmZmVjdHMgZnJvbSBwbHVnaW5zIGlzIGRlcHJlY2F0ZWQuIFBsZWFzZSB1c2UgTW9kdWxlSW5mby5tb2R1bGVTaWRlRWZmZWN0cyBpbnN0ZWFkLiIsS2UsITAscyksdGhpcy5tb2R1bGVTaWRlRWZmZWN0c30saWQ6dCxnZXQgaW1wbGljaXRseUxvYWRlZEFmdGVyT25lT2YoKXtyZXR1cm4gQXJyYXkuZnJvbShwLEVvKS5zb3J0KCl9LGdldCBpbXBsaWNpdGx5TG9hZGVkQmVmb3JlKCl7cmV0dXJuIEFycmF5LmZyb20oZixFbykuc29ydCgpfSxnZXQgaW1wb3J0ZWRJZFJlc29sdXRpb25zKCl7cmV0dXJuIEFycmF5LmZyb20oeS5rZXlzKCksKGU9PmwucmVzb2x2ZWRJZHNbZV0pKS5maWx0ZXIoQm9vbGVhbil9LGdldCBpbXBvcnRlZElkcygpe3JldHVybiBBcnJheS5mcm9tKHkua2V5cygpLChlPT5sLnJlc29sdmVkSWRzW2VdPy5pZCkpLmZpbHRlcihCb29sZWFuKX0sZ2V0IGltcG9ydGVycygpe3JldHVybiBtLnNvcnQoKX0saXNFbnRyeTppLGlzRXh0ZXJuYWw6ITEsZ2V0IGlzSW5jbHVkZWQoKXtyZXR1cm4gZS5waGFzZSE9PW1vLkdFTkVSQVRFP251bGw6bC5pc0luY2x1ZGVkKCl9LG1ldGE6ey4uLm99LG1vZHVsZVNpZGVFZmZlY3RzOm4sc3ludGhldGljTmFtZWRFeHBvcnRzOnJ9LE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLmluZm8sImhhc01vZHVsZVNpZGVFZmZlY3RzIix7ZW51bWVyYWJsZTohMX0pO31iYXNlbmFtZSgpe2NvbnN0IGU9dyh0aGlzLmlkKSx0PUModGhpcy5pZCk7cmV0dXJuIGJlKHQ/ZS5zbGljZSgwLC10Lmxlbmd0aCk6ZSl9YmluZFJlZmVyZW5jZXMoKXt0aGlzLmFzdC5iaW5kKCk7fWVycm9yKGUsdCl7cmV0dXJuIHRoaXMuYWRkTG9jYXRpb25Ub0xvZ1Byb3BzKGUsdCksWWUoZSl9ZXN0aW1hdGVTaXplKCl7bGV0IGU9MDtmb3IoY29uc3QgdCBvZiB0aGlzLmFzdC5ib2R5KXQuaW5jbHVkZWQmJihlKz10LmVuZC10LnN0YXJ0KTtyZXR1cm4gZX1nZXRBbGxFeHBvcnROYW1lcygpe2lmKHRoaXMuYWxsRXhwb3J0TmFtZXMpcmV0dXJuIHRoaXMuYWxsRXhwb3J0TmFtZXM7dGhpcy5hbGxFeHBvcnROYW1lcz1uZXcgU2V0KFsuLi50aGlzLmV4cG9ydHMua2V5cygpLC4uLnRoaXMucmVleHBvcnREZXNjcmlwdGlvbnMua2V5cygpXSk7Zm9yKGNvbnN0IGUgb2YgdGhpcy5leHBvcnRBbGxNb2R1bGVzKWlmKGUgaW5zdGFuY2VvZiBRdCl0aGlzLmFsbEV4cG9ydE5hbWVzLmFkZChgKiR7ZS5pZH1gKTtlbHNlIGZvcihjb25zdCB0IG9mIGUuZ2V0QWxsRXhwb3J0TmFtZXMoKSkiZGVmYXVsdCIhPT10JiZ0aGlzLmFsbEV4cG9ydE5hbWVzLmFkZCh0KTtyZXR1cm4gInN0cmluZyI9PXR5cGVvZiB0aGlzLmluZm8uc3ludGhldGljTmFtZWRFeHBvcnRzJiZ0aGlzLmFsbEV4cG9ydE5hbWVzLmRlbGV0ZSh0aGlzLmluZm8uc3ludGhldGljTmFtZWRFeHBvcnRzKSx0aGlzLmFsbEV4cG9ydE5hbWVzfWdldERlcGVuZGVuY2llc1RvQmVJbmNsdWRlZCgpe2lmKHRoaXMucmVsZXZhbnREZXBlbmRlbmNpZXMpcmV0dXJuIHRoaXMucmVsZXZhbnREZXBlbmRlbmNpZXM7dGhpcy5yZWxldmFudERlcGVuZGVuY2llcz1uZXcgU2V0O2NvbnN0IGU9bmV3IFNldCx0PW5ldyBTZXQscz1uZXcgU2V0KHRoaXMuaW5jbHVkZWRJbXBvcnRzKTtpZih0aGlzLmluZm8uaXNFbnRyeXx8dGhpcy5pbmNsdWRlZER5bmFtaWNJbXBvcnRlcnMubGVuZ3RoPjB8fHRoaXMubmFtZXNwYWNlLmluY2x1ZGVkfHx0aGlzLmltcGxpY2l0bHlMb2FkZWRBZnRlci5zaXplPjApZm9yKGNvbnN0IGUgb2YgWy4uLnRoaXMuZ2V0UmVleHBvcnRzKCksLi4udGhpcy5nZXRFeHBvcnRzKCldKXtjb25zdFt0XT10aGlzLmdldFZhcmlhYmxlRm9yRXhwb3J0TmFtZShlKTt0Py5pbmNsdWRlZCYmcy5hZGQodCk7fWZvcihsZXQgaSBvZiBzKXtjb25zdCBzPXRoaXMuc2lkZUVmZmVjdERlcGVuZGVuY2llc0J5VmFyaWFibGUuZ2V0KGkpO2lmKHMpZm9yKGNvbnN0IGUgb2Ygcyl0LmFkZChlKTtpIGluc3RhbmNlb2YgZm8/aT1pLmdldEJhc2VWYXJpYWJsZSgpOmkgaW5zdGFuY2VvZiBybyYmKGk9aS5nZXRPcmlnaW5hbFZhcmlhYmxlKCkpLGUuYWRkKGkubW9kdWxlKTt9aWYodGhpcy5vcHRpb25zLnRyZWVzaGFrZSYmIm5vLXRyZWVzaGFrZSIhPT10aGlzLmluZm8ubW9kdWxlU2lkZUVmZmVjdHMpdGhpcy5hZGRSZWxldmFudFNpZGVFZmZlY3REZXBlbmRlbmNpZXModGhpcy5yZWxldmFudERlcGVuZGVuY2llcyxlLHQpO2Vsc2UgZm9yKGNvbnN0IGUgb2YgdGhpcy5kZXBlbmRlbmNpZXMpdGhpcy5yZWxldmFudERlcGVuZGVuY2llcy5hZGQoZSk7Zm9yKGNvbnN0IHQgb2YgZSl0aGlzLnJlbGV2YW50RGVwZW5kZW5jaWVzLmFkZCh0KTtyZXR1cm4gdGhpcy5yZWxldmFudERlcGVuZGVuY2llc31nZXRFeHBvcnROYW1lc0J5VmFyaWFibGUoKXtpZih0aGlzLmV4cG9ydE5hbWVzQnlWYXJpYWJsZSlyZXR1cm4gdGhpcy5leHBvcnROYW1lc0J5VmFyaWFibGU7Y29uc3QgZT1uZXcgTWFwO2Zvcihjb25zdCB0IG9mIHRoaXMuZ2V0QWxsRXhwb3J0TmFtZXMoKSl7bGV0W3NdPXRoaXMuZ2V0VmFyaWFibGVGb3JFeHBvcnROYW1lKHQpO2lmKHMgaW5zdGFuY2VvZiBybyYmKHM9cy5nZXRPcmlnaW5hbFZhcmlhYmxlKCkpLCFzfHwhKHMuaW5jbHVkZWR8fHMgaW5zdGFuY2VvZiBkZSkpY29udGludWU7Y29uc3QgaT1lLmdldChzKTtpP2kucHVzaCh0KTplLnNldChzLFt0XSk7fXJldHVybiB0aGlzLmV4cG9ydE5hbWVzQnlWYXJpYWJsZT1lfWdldEV4cG9ydHMoKXtyZXR1cm4gWy4uLnRoaXMuZXhwb3J0cy5rZXlzKCldfWdldFJlZXhwb3J0cygpe2lmKHRoaXMudHJhbnNpdGl2ZVJlZXhwb3J0cylyZXR1cm4gdGhpcy50cmFuc2l0aXZlUmVleHBvcnRzO3RoaXMudHJhbnNpdGl2ZVJlZXhwb3J0cz1bXTtjb25zdCBlPW5ldyBTZXQodGhpcy5yZWV4cG9ydERlc2NyaXB0aW9ucy5rZXlzKCkpO2Zvcihjb25zdCB0IG9mIHRoaXMuZXhwb3J0QWxsTW9kdWxlcylpZih0IGluc3RhbmNlb2YgUXQpZS5hZGQoYCoke3QuaWR9YCk7ZWxzZSBmb3IoY29uc3QgcyBvZiBbLi4udC5nZXRSZWV4cG9ydHMoKSwuLi50LmdldEV4cG9ydHMoKV0pImRlZmF1bHQiIT09cyYmZS5hZGQocyk7cmV0dXJuIHRoaXMudHJhbnNpdGl2ZVJlZXhwb3J0cz1bLi4uZV19Z2V0UmVuZGVyZWRFeHBvcnRzKCl7Y29uc3QgZT1bXSx0PVtdO2Zvcihjb25zdCBzIG9mIHRoaXMuZXhwb3J0cy5rZXlzKCkpe2NvbnN0W2ldPXRoaXMuZ2V0VmFyaWFibGVGb3JFeHBvcnROYW1lKHMpOyhpJiZpLmluY2x1ZGVkP2U6dCkucHVzaChzKTt9cmV0dXJuIHtyZW1vdmVkRXhwb3J0czp0LHJlbmRlcmVkRXhwb3J0czplfX1nZXRTeW50aGV0aWNOYW1lc3BhY2UoKXtyZXR1cm4gbnVsbD09PXRoaXMuc3ludGhldGljTmFtZXNwYWNlJiYodGhpcy5zeW50aGV0aWNOYW1lc3BhY2U9dm9pZCAwLFt0aGlzLnN5bnRoZXRpY05hbWVzcGFjZV09dGhpcy5nZXRWYXJpYWJsZUZvckV4cG9ydE5hbWUoInN0cmluZyI9PXR5cGVvZiB0aGlzLmluZm8uc3ludGhldGljTmFtZWRFeHBvcnRzP3RoaXMuaW5mby5zeW50aGV0aWNOYW1lZEV4cG9ydHM6ImRlZmF1bHQiLHtvbmx5RXhwbGljaXQ6ITB9KSksdGhpcy5zeW50aGV0aWNOYW1lc3BhY2U/dGhpcy5zeW50aGV0aWNOYW1lc3BhY2U6WWUoKGU9dGhpcy5pZCx0PXRoaXMuaW5mby5zeW50aGV0aWNOYW1lZEV4cG9ydHMse2NvZGU6IlNZTlRIRVRJQ19OQU1FRF9FWFBPUlRTX05FRURfTkFNRVNQQUNFX0VYUE9SVCIsZXhwb3J0ZXI6ZSxtZXNzYWdlOmBNb2R1bGUgIiR7TChlKX0iIHRoYXQgaXMgbWFya2VkIHdpdGggXGBzeW50aGV0aWNOYW1lZEV4cG9ydHM6ICR7SlNPTi5zdHJpbmdpZnkodCl9XGAgbmVlZHMgJHsic3RyaW5nIj09dHlwZW9mIHQmJiJkZWZhdWx0IiE9PXQ/YGFuIGV4cGxpY2l0IGV4cG9ydCBuYW1lZCAiJHt0fSJgOiJhIGRlZmF1bHQgZXhwb3J0In0gdGhhdCBkb2VzIG5vdCByZWV4cG9ydCBhbiB1bnJlc29sdmVkIG5hbWVkIGV4cG9ydCBvZiB0aGUgc2FtZSBtb2R1bGUuYH0pKTt2YXIgZSx0O31nZXRWYXJpYWJsZUZvckV4cG9ydE5hbWUoZSx7aW1wb3J0ZXJGb3JTaWRlRWZmZWN0czp0LGlzRXhwb3J0QWxsU2VhcmNoOnMsb25seUV4cGxpY2l0Omksc2VhcmNoZWROYW1lc0FuZE1vZHVsZXM6bn09ZmUpe2lmKCIqIj09PWVbMF0pe2lmKDE9PT1lLmxlbmd0aClyZXR1cm4gW3RoaXMubmFtZXNwYWNlXTtyZXR1cm4gdGhpcy5ncmFwaC5tb2R1bGVzQnlJZC5nZXQoZS5zbGljZSgxKSkuZ2V0VmFyaWFibGVGb3JFeHBvcnROYW1lKCIqIil9Y29uc3Qgcj10aGlzLnJlZXhwb3J0RGVzY3JpcHRpb25zLmdldChlKTtpZihyKXtjb25zdFtlXT1EbyhyLm1vZHVsZSxyLmxvY2FsTmFtZSx0LCExLG4pO3JldHVybiBlPyh0JiYoVm8oZSx0LHRoaXMpLHRoaXMuaW5mby5tb2R1bGVTaWRlRWZmZWN0cyYmRiQzKHQuc2lkZUVmZmVjdERlcGVuZGVuY2llc0J5VmFyaWFibGUsZSxqKS5hZGQodGhpcykpLFtlXSk6dGhpcy5lcnJvcihGdChyLmxvY2FsTmFtZSx0aGlzLmlkLHIubW9kdWxlLmlkKSxyLnN0YXJ0KX1jb25zdCBvPXRoaXMuZXhwb3J0cy5nZXQoZSk7aWYobyl7aWYobz09PU9vKXJldHVybiBbdGhpcy5leHBvcnRTaGltVmFyaWFibGVdO2NvbnN0IGU9by5sb2NhbE5hbWUscz10aGlzLnRyYWNlVmFyaWFibGUoZSx7aW1wb3J0ZXJGb3JTaWRlRWZmZWN0czp0LHNlYXJjaGVkTmFtZXNBbmRNb2R1bGVzOm59KTtyZXR1cm4gdCYmKFZvKHMsdCx0aGlzKSxGJDModC5zaWRlRWZmZWN0RGVwZW5kZW5jaWVzQnlWYXJpYWJsZSxzLGopLmFkZCh0aGlzKSksW3NdfWlmKGkpcmV0dXJuIFtudWxsXTtpZigiZGVmYXVsdCIhPT1lKXtjb25zdCBzPXRoaXMubmFtZXNwYWNlUmVleHBvcnRzQnlOYW1lLmdldChlKT8/dGhpcy5nZXRWYXJpYWJsZUZyb21OYW1lc3BhY2VSZWV4cG9ydHMoZSx0LG4pO2lmKHRoaXMubmFtZXNwYWNlUmVleHBvcnRzQnlOYW1lLnNldChlLHMpLHNbMF0pcmV0dXJuIHN9cmV0dXJuIHRoaXMuaW5mby5zeW50aGV0aWNOYW1lZEV4cG9ydHM/W0YkMyh0aGlzLnN5bnRoZXRpY0V4cG9ydHMsZSwoKCk9Pm5ldyBmbyh0aGlzLmFzdENvbnRleHQsZSx0aGlzLmdldFN5bnRoZXRpY05hbWVzcGFjZSgpKSkpXTohcyYmdGhpcy5vcHRpb25zLnNoaW1NaXNzaW5nRXhwb3J0cz8odGhpcy5zaGltTWlzc2luZ0V4cG9ydChlKSxbdGhpcy5leHBvcnRTaGltVmFyaWFibGVdKTpbbnVsbF19aGFzRWZmZWN0cygpe3JldHVybiAibm8tdHJlZXNoYWtlIj09PXRoaXMuaW5mby5tb2R1bGVTaWRlRWZmZWN0c3x8dGhpcy5hc3QuaGFzQ2FjaGVkRWZmZWN0cygpfWluY2x1ZGUoKXtjb25zdCBlPWVzKCk7dGhpcy5hc3Quc2hvdWxkQmVJbmNsdWRlZChlKSYmdGhpcy5hc3QuaW5jbHVkZShlLCExKTt9aW5jbHVkZUFsbEV4cG9ydHMoZSl7dGhpcy5pc0V4ZWN1dGVkfHwoTW8odGhpcyksdGhpcy5ncmFwaC5uZWVkc1RyZWVzaGFraW5nUGFzcz0hMCk7Zm9yKGNvbnN0IHQgb2YgdGhpcy5leHBvcnRzLmtleXMoKSlpZihlfHx0IT09dGhpcy5pbmZvLnN5bnRoZXRpY05hbWVkRXhwb3J0cyl7Y29uc3QgZT10aGlzLmdldFZhcmlhYmxlRm9yRXhwb3J0TmFtZSh0KVswXTtlLmRlb3B0aW1pemVQYXRoKFkpLGUuaW5jbHVkZWR8fHRoaXMuaW5jbHVkZVZhcmlhYmxlKGUpO31mb3IoY29uc3QgZSBvZiB0aGlzLmdldFJlZXhwb3J0cygpKXtjb25zdFt0XT10aGlzLmdldFZhcmlhYmxlRm9yRXhwb3J0TmFtZShlKTt0JiYodC5kZW9wdGltaXplUGF0aChZKSx0LmluY2x1ZGVkfHx0aGlzLmluY2x1ZGVWYXJpYWJsZSh0KSx0IGluc3RhbmNlb2YgZGUmJih0Lm1vZHVsZS5yZWV4cG9ydGVkPSEwKSk7fWUmJnRoaXMubmFtZXNwYWNlLnNldE1lcmdlZE5hbWVzcGFjZXModGhpcy5pbmNsdWRlQW5kR2V0QWRkaXRpb25hbE1lcmdlZE5hbWVzcGFjZXMoKSk7fWluY2x1ZGVBbGxJbkJ1bmRsZSgpe3RoaXMuYXN0LmluY2x1ZGUoZXMoKSwhMCksdGhpcy5pbmNsdWRlQWxsRXhwb3J0cyghMSk7fWluY2x1ZGVFeHBvcnRzQnlOYW1lcyhlKXt0aGlzLmlzRXhlY3V0ZWR8fChNbyh0aGlzKSx0aGlzLmdyYXBoLm5lZWRzVHJlZXNoYWtpbmdQYXNzPSEwKTtsZXQgdD0hMTtmb3IoY29uc3QgcyBvZiBlKXtjb25zdCBlPXRoaXMuZ2V0VmFyaWFibGVGb3JFeHBvcnROYW1lKHMpWzBdO2UmJihlLmRlb3B0aW1pemVQYXRoKFkpLGUuaW5jbHVkZWR8fHRoaXMuaW5jbHVkZVZhcmlhYmxlKGUpKSx0aGlzLmV4cG9ydHMuaGFzKHMpfHx0aGlzLnJlZXhwb3J0RGVzY3JpcHRpb25zLmhhcyhzKXx8KHQ9ITApO310JiZ0aGlzLm5hbWVzcGFjZS5zZXRNZXJnZWROYW1lc3BhY2VzKHRoaXMuaW5jbHVkZUFuZEdldEFkZGl0aW9uYWxNZXJnZWROYW1lc3BhY2VzKCkpO31pc0luY2x1ZGVkKCl7cmV0dXJuIHRoaXMuYXN0JiYodGhpcy5hc3QuaW5jbHVkZWR8fHRoaXMubmFtZXNwYWNlLmluY2x1ZGVkfHx0aGlzLmltcG9ydGVkRnJvbU5vdFRyZWVzaGFrZW58fHRoaXMuZXhwb3J0U2hpbVZhcmlhYmxlLmluY2x1ZGVkKX1saW5rSW1wb3J0cygpe3RoaXMuYWRkTW9kdWxlc1RvSW1wb3J0RGVzY3JpcHRpb25zKHRoaXMuaW1wb3J0RGVzY3JpcHRpb25zKSx0aGlzLmFkZE1vZHVsZXNUb0ltcG9ydERlc2NyaXB0aW9ucyh0aGlzLnJlZXhwb3J0RGVzY3JpcHRpb25zKTtjb25zdCBlPVtdO2Zvcihjb25zdCB0IG9mIHRoaXMuZXhwb3J0QWxsU291cmNlcyl7Y29uc3Qgcz10aGlzLmdyYXBoLm1vZHVsZXNCeUlkLmdldCh0aGlzLnJlc29sdmVkSWRzW3RdLmlkKTtzIGluc3RhbmNlb2YgUXQ/ZS5wdXNoKHMpOnRoaXMuZXhwb3J0QWxsTW9kdWxlcy5wdXNoKHMpO310aGlzLmV4cG9ydEFsbE1vZHVsZXMucHVzaCguLi5lKTt9bG9nKGUsdCxzKXt0aGlzLmFkZExvY2F0aW9uVG9Mb2dQcm9wcyh0LHMpLHRoaXMub3B0aW9ucy5vbkxvZyhlLHQpO31yZW5kZXIoZSl7Y29uc3QgdD10aGlzLm1hZ2ljU3RyaW5nLmNsb25lKCk7dGhpcy5hc3QucmVuZGVyKHQsZSksdC50cmltKCk7Y29uc3R7dXNlc1RvcExldmVsQXdhaXQ6c309dGhpcy5hc3RDb250ZXh0O3JldHVybiBzJiYiZXMiIT09ZS5mb3JtYXQmJiJzeXN0ZW0iIT09ZS5mb3JtYXQ/WWUoKGk9dGhpcy5pZCxuPWUuZm9ybWF0LHtjb2RlOiJJTlZBTElEX1RMQV9GT1JNQVQiLGlkOmksbWVzc2FnZTpgTW9kdWxlIGZvcm1hdCAiJHtufSIgZG9lcyBub3Qgc3VwcG9ydCB0b3AtbGV2ZWwgYXdhaXQuIFVzZSB0aGUgImVzIiBvciAic3lzdGVtIiBvdXRwdXQgZm9ybWF0cyByYXRoZXIuYH0pKTp7c291cmNlOnQsdXNlc1RvcExldmVsQXdhaXQ6c307dmFyIGksbjt9c2V0U291cmNlKHthc3Q6ZSxjb2RlOnQsY3VzdG9tVHJhbnNmb3JtQ2FjaGU6cyxvcmlnaW5hbENvZGU6aSxvcmlnaW5hbFNvdXJjZW1hcDpuLHJlc29sdmVkSWRzOnIsc291cmNlbWFwQ2hhaW46byx0cmFuc2Zvcm1EZXBlbmRlbmNpZXM6YSx0cmFuc2Zvcm1GaWxlczpsLC4uLmN9KXskbygiZ2VuZXJhdGUgYXN0IiwzKSx0aGlzLmluZm8uY29kZT10LHRoaXMub3JpZ2luYWxDb2RlPWksdGhpcy5vcmlnaW5hbFNvdXJjZW1hcD14byhuKSx0aGlzLnNvdXJjZW1hcENoYWluPW8ubWFwKChlPT5lLm1pc3Npbmc/ZTp4byhlKSkpLHlvKHRoaXMub3JpZ2luYWxTb3VyY2VtYXAsdGhpcy5zb3VyY2VtYXBDaGFpbiksbCYmKHRoaXMudHJhbnNmb3JtRmlsZXM9bCksdGhpcy50cmFuc2Zvcm1EZXBlbmRlbmNpZXM9YSx0aGlzLmN1c3RvbVRyYW5zZm9ybUNhY2hlPXMsdGhpcy51cGRhdGVPcHRpb25zKGMpO2NvbnN0IGg9ZT8/dGhpcy50cnlQYXJzZSgpO05vKCJnZW5lcmF0ZSBhc3QiLDMpLCRvKCJhbmFseXplIGFzdCIsMyksdGhpcy5yZXNvbHZlZElkcz1yPz9PYmplY3QuY3JlYXRlKG51bGwpO2NvbnN0IHU9dGhpcy5pZDt0aGlzLm1hZ2ljU3RyaW5nPW5ldyBnKHQse2ZpbGVuYW1lOnRoaXMuZXhjbHVkZUZyb21Tb3VyY2VtYXA/bnVsbDp1LGluZGVudEV4Y2x1c2lvblJhbmdlczpbXX0pLHRoaXMuYXN0Q29udGV4dD17YWRkRHluYW1pY0ltcG9ydDp0aGlzLmFkZER5bmFtaWNJbXBvcnQuYmluZCh0aGlzKSxhZGRFeHBvcnQ6dGhpcy5hZGRFeHBvcnQuYmluZCh0aGlzKSxhZGRJbXBvcnQ6dGhpcy5hZGRJbXBvcnQuYmluZCh0aGlzKSxhZGRJbXBvcnRNZXRhOnRoaXMuYWRkSW1wb3J0TWV0YS5iaW5kKHRoaXMpLGNvZGU6dCxkZW9wdGltaXphdGlvblRyYWNrZXI6dGhpcy5ncmFwaC5kZW9wdGltaXphdGlvblRyYWNrZXIsZXJyb3I6dGhpcy5lcnJvci5iaW5kKHRoaXMpLGZpbGVOYW1lOnUsZ2V0RXhwb3J0czp0aGlzLmdldEV4cG9ydHMuYmluZCh0aGlzKSxnZXRNb2R1bGVFeGVjSW5kZXg6KCk9PnRoaXMuZXhlY0luZGV4LGdldE1vZHVsZU5hbWU6dGhpcy5iYXNlbmFtZS5iaW5kKHRoaXMpLGdldE5vZGVDb25zdHJ1Y3RvcjplPT5jb1tlXXx8Y28uVW5rbm93bk5vZGUsZ2V0UmVleHBvcnRzOnRoaXMuZ2V0UmVleHBvcnRzLmJpbmQodGhpcyksaW1wb3J0RGVzY3JpcHRpb25zOnRoaXMuaW1wb3J0RGVzY3JpcHRpb25zLGluY2x1ZGVBbGxFeHBvcnRzOigpPT50aGlzLmluY2x1ZGVBbGxFeHBvcnRzKCEwKSxpbmNsdWRlRHluYW1pY0ltcG9ydDp0aGlzLmluY2x1ZGVEeW5hbWljSW1wb3J0LmJpbmQodGhpcyksaW5jbHVkZVZhcmlhYmxlSW5Nb2R1bGU6dGhpcy5pbmNsdWRlVmFyaWFibGVJbk1vZHVsZS5iaW5kKHRoaXMpLGxvZzp0aGlzLmxvZy5iaW5kKHRoaXMpLG1hZ2ljU3RyaW5nOnRoaXMubWFnaWNTdHJpbmcsbWFudWFsUHVyZUZ1bmN0aW9uczp0aGlzLmdyYXBoLnB1cmVGdW5jdGlvbnMsbW9kdWxlOnRoaXMsbW9kdWxlQ29udGV4dDp0aGlzLmNvbnRleHQsb3B0aW9uczp0aGlzLm9wdGlvbnMscmVxdWVzdFRyZWVzaGFraW5nUGFzczooKT0+dGhpcy5ncmFwaC5uZWVkc1RyZWVzaGFraW5nUGFzcz0hMCx0cmFjZUV4cG9ydDplPT50aGlzLmdldFZhcmlhYmxlRm9yRXhwb3J0TmFtZShlKVswXSx0cmFjZVZhcmlhYmxlOnRoaXMudHJhY2VWYXJpYWJsZS5iaW5kKHRoaXMpLHVzZXNUb3BMZXZlbEF3YWl0OiExfSx0aGlzLnNjb3BlPW5ldyBvbyh0aGlzLmdyYXBoLnNjb3BlLHRoaXMuYXN0Q29udGV4dCksdGhpcy5uYW1lc3BhY2U9bmV3IHBvKHRoaXMuYXN0Q29udGV4dCksdGhpcy5hc3Q9bmV3IHRvKGgse2NvbnRleHQ6dGhpcy5hc3RDb250ZXh0LHR5cGU6Ik1vZHVsZSJ9LHRoaXMuc2NvcGUpLGV8fCExIT09dGhpcy5vcHRpb25zLmNhY2hlP3RoaXMuaW5mby5hc3Q9aDpPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcy5pbmZvLCJhc3QiLHtnZXQ6KCk9PntpZih0aGlzLmdyYXBoLmFzdExydS5oYXModSkpcmV0dXJuIHRoaXMuZ3JhcGguYXN0THJ1LmdldCh1KTt7Y29uc3QgZT10aGlzLnRyeVBhcnNlKCk7cmV0dXJuIHRoaXMuZ3JhcGguYXN0THJ1LnNldCh1LGUpLGV9fX0pLE5vKCJhbmFseXplIGFzdCIsMyk7fXRvSlNPTigpe3JldHVybiB7YXNzZXJ0aW9uczp0aGlzLmluZm8uYXNzZXJ0aW9ucyxhc3Q6dGhpcy5pbmZvLmFzdCxjb2RlOnRoaXMuaW5mby5jb2RlLGN1c3RvbVRyYW5zZm9ybUNhY2hlOnRoaXMuY3VzdG9tVHJhbnNmb3JtQ2FjaGUsZGVwZW5kZW5jaWVzOkFycmF5LmZyb20odGhpcy5kZXBlbmRlbmNpZXMsRW8pLGlkOnRoaXMuaWQsbWV0YTp0aGlzLmluZm8ubWV0YSxtb2R1bGVTaWRlRWZmZWN0czp0aGlzLmluZm8ubW9kdWxlU2lkZUVmZmVjdHMsb3JpZ2luYWxDb2RlOnRoaXMub3JpZ2luYWxDb2RlLG9yaWdpbmFsU291cmNlbWFwOnRoaXMub3JpZ2luYWxTb3VyY2VtYXAscmVzb2x2ZWRJZHM6dGhpcy5yZXNvbHZlZElkcyxzb3VyY2VtYXBDaGFpbjp0aGlzLnNvdXJjZW1hcENoYWluLHN5bnRoZXRpY05hbWVkRXhwb3J0czp0aGlzLmluZm8uc3ludGhldGljTmFtZWRFeHBvcnRzLHRyYW5zZm9ybURlcGVuZGVuY2llczp0aGlzLnRyYW5zZm9ybURlcGVuZGVuY2llcyx0cmFuc2Zvcm1GaWxlczp0aGlzLnRyYW5zZm9ybUZpbGVzfX10cmFjZVZhcmlhYmxlKGUse2ltcG9ydGVyRm9yU2lkZUVmZmVjdHM6dCxpc0V4cG9ydEFsbFNlYXJjaDpzLHNlYXJjaGVkTmFtZXNBbmRNb2R1bGVzOml9PWZlKXtjb25zdCBuPXRoaXMuc2NvcGUudmFyaWFibGVzLmdldChlKTtpZihuKXJldHVybiBuO2NvbnN0IHI9dGhpcy5pbXBvcnREZXNjcmlwdGlvbnMuZ2V0KGUpO2lmKHIpe2NvbnN0IGU9ci5tb2R1bGU7aWYoZSBpbnN0YW5jZW9mIFRvJiYiKiI9PT1yLm5hbWUpcmV0dXJuIGUubmFtZXNwYWNlO2NvbnN0W25dPURvKGUsci5uYW1lLHR8fHRoaXMscyxpKTtyZXR1cm4gbnx8dGhpcy5lcnJvcihGdChyLm5hbWUsdGhpcy5pZCxlLmlkKSxyLnN0YXJ0KX1yZXR1cm4gbnVsbH11cGRhdGVPcHRpb25zKHttZXRhOmUsbW9kdWxlU2lkZUVmZmVjdHM6dCxzeW50aGV0aWNOYW1lZEV4cG9ydHM6c30pe251bGwhPXQmJih0aGlzLmluZm8ubW9kdWxlU2lkZUVmZmVjdHM9dCksbnVsbCE9cyYmKHRoaXMuaW5mby5zeW50aGV0aWNOYW1lZEV4cG9ydHM9cyksbnVsbCE9ZSYmT2JqZWN0LmFzc2lnbih0aGlzLmluZm8ubWV0YSxlKTt9YWRkRHluYW1pY0ltcG9ydChlKXtsZXQgdD1lLnNvdXJjZTt0IGluc3RhbmNlb2YgaW8/MT09PXQucXVhc2lzLmxlbmd0aCYmdC5xdWFzaXNbMF0udmFsdWUuY29va2VkJiYodD10LnF1YXNpc1swXS52YWx1ZS5jb29rZWQpOnQgaW5zdGFuY2VvZiBMbiYmInN0cmluZyI9PXR5cGVvZiB0LnZhbHVlJiYodD10LnZhbHVlKSx0aGlzLmR5bmFtaWNJbXBvcnRzLnB1c2goe2FyZ3VtZW50OnQsaWQ6bnVsbCxub2RlOmUscmVzb2x1dGlvbjpudWxsfSk7fWFkZEV4cG9ydChlKXtpZihlIGluc3RhbmNlb2Ygc3IpdGhpcy5leHBvcnRzLnNldCgiZGVmYXVsdCIse2lkZW50aWZpZXI6ZS52YXJpYWJsZS5nZXRBc3NpZ25lZFZhcmlhYmxlTmFtZSgpLGxvY2FsTmFtZToiZGVmYXVsdCJ9KTtlbHNlIGlmKGUgaW5zdGFuY2VvZiBlcil7Y29uc3QgdD1lLnNvdXJjZS52YWx1ZTtpZih0aGlzLmFkZFNvdXJjZSh0LGUpLGUuZXhwb3J0ZWQpe2NvbnN0IHM9ZS5leHBvcnRlZC5uYW1lO3RoaXMucmVleHBvcnREZXNjcmlwdGlvbnMuc2V0KHMse2xvY2FsTmFtZToiKiIsbW9kdWxlOm51bGwsc291cmNlOnQsc3RhcnQ6ZS5zdGFydH0pO31lbHNlIHRoaXMuZXhwb3J0QWxsU291cmNlcy5hZGQodCk7fWVsc2UgaWYoZS5zb3VyY2UgaW5zdGFuY2VvZiBMbil7Y29uc3QgdD1lLnNvdXJjZS52YWx1ZTt0aGlzLmFkZFNvdXJjZSh0LGUpO2Zvcihjb25zdHtleHBvcnRlZDpzLGxvY2FsOmksc3RhcnQ6bn1vZiBlLnNwZWNpZmllcnMpe2NvbnN0IGU9cyBpbnN0YW5jZW9mIExuP3MudmFsdWU6cy5uYW1lO3RoaXMucmVleHBvcnREZXNjcmlwdGlvbnMuc2V0KGUse2xvY2FsTmFtZTppIGluc3RhbmNlb2YgTG4/aS52YWx1ZTppLm5hbWUsbW9kdWxlOm51bGwsc291cmNlOnQsc3RhcnQ6bn0pO319ZWxzZSBpZihlLmRlY2xhcmF0aW9uKXtjb25zdCB0PWUuZGVjbGFyYXRpb247aWYodCBpbnN0YW5jZW9mIGxvKWZvcihjb25zdCBlIG9mIHQuZGVjbGFyYXRpb25zKWZvcihjb25zdCB0IG9mIEp0KGUuaWQpKXRoaXMuZXhwb3J0cy5zZXQodCx7aWRlbnRpZmllcjpudWxsLGxvY2FsTmFtZTp0fSk7ZWxzZSB7Y29uc3QgZT10LmlkLm5hbWU7dGhpcy5leHBvcnRzLnNldChlLHtpZGVudGlmaWVyOm51bGwsbG9jYWxOYW1lOmV9KTt9fWVsc2UgZm9yKGNvbnN0e2xvY2FsOnQsZXhwb3J0ZWQ6c31vZiBlLnNwZWNpZmllcnMpe2NvbnN0IGU9dC5uYW1lLGk9cyBpbnN0YW5jZW9mIGFuP3MubmFtZTpzLnZhbHVlO3RoaXMuZXhwb3J0cy5zZXQoaSx7aWRlbnRpZmllcjpudWxsLGxvY2FsTmFtZTplfSk7fX1hZGRJbXBvcnQoZSl7Y29uc3QgdD1lLnNvdXJjZS52YWx1ZTt0aGlzLmFkZFNvdXJjZSh0LGUpO2Zvcihjb25zdCBzIG9mIGUuc3BlY2lmaWVycyl7Y29uc3QgZT1zIGluc3RhbmNlb2YgY3I/ImRlZmF1bHQiOnMgaW5zdGFuY2VvZiBqcj8iKiI6cy5pbXBvcnRlZCBpbnN0YW5jZW9mIGFuP3MuaW1wb3J0ZWQubmFtZTpzLmltcG9ydGVkLnZhbHVlO3RoaXMuaW1wb3J0RGVzY3JpcHRpb25zLnNldChzLmxvY2FsLm5hbWUse21vZHVsZTpudWxsLG5hbWU6ZSxzb3VyY2U6dCxzdGFydDpzLnN0YXJ0fSk7fX1hZGRJbXBvcnRNZXRhKGUpe3RoaXMuaW1wb3J0TWV0YXMucHVzaChlKTt9YWRkTG9jYXRpb25Ub0xvZ1Byb3BzKGUsdCl7ZS5pZD10aGlzLmlkLGUucG9zPXQ7bGV0IHM9dGhpcy5pbmZvLmNvZGU7Y29uc3QgaT13ZShzLHQse29mZnNldExpbmU6MX0pO2lmKGkpe2xldHtjb2x1bW46bixsaW5lOnJ9PWk7dHJ5eygoe2NvbHVtbjpuLGxpbmU6cn09ZnVuY3Rpb24oZSx0KXtjb25zdCBzPWUuZmlsdGVyKChlPT4hZS5taXNzaW5nKSk7ZTpmb3IoO3MubGVuZ3RoPjA7KXtjb25zdCBlPXMucG9wKCkubWFwcGluZ3NbdC5saW5lLTFdO2lmKGUpe2NvbnN0IHM9ZS5maWx0ZXIoKGU9PmUubGVuZ3RoPjEpKSxpPXNbcy5sZW5ndGgtMV07Zm9yKGNvbnN0IGUgb2YgcylpZihlWzBdPj10LmNvbHVtbnx8ZT09PWkpe3Q9e2NvbHVtbjplWzNdLGxpbmU6ZVsyXSsxfTtjb250aW51ZSBlfX10aHJvdyBuZXcgRXJyb3IoIkNhbid0IHJlc29sdmUgb3JpZ2luYWwgbG9jYXRpb24gb2YgZXJyb3IuIil9cmV0dXJuIHR9KHRoaXMuc291cmNlbWFwQ2hhaW4se2NvbHVtbjpuLGxpbmU6cn0pKSkscz10aGlzLm9yaWdpbmFsQ29kZTt9Y2F0Y2goZSl7dGhpcy5vcHRpb25zLm9uTG9nKHZlLGZ1bmN0aW9uKGUsdCxzLGksbil7cmV0dXJuIHtjYXVzZTplLGNvZGU6IlNPVVJDRU1BUF9FUlJPUiIsaWQ6dCxsb2M6e2NvbHVtbjpzLGZpbGU6dCxsaW5lOml9LG1lc3NhZ2U6YEVycm9yIHdoZW4gdXNpbmcgc291cmNlbWFwIGZvciByZXBvcnRpbmcgYW4gZXJyb3I6ICR7ZS5tZXNzYWdlfWAscG9zOm59fShlLHRoaXMuaWQsbixyLHQpKTt9WGUoZSx7Y29sdW1uOm4sbGluZTpyfSxzLHRoaXMuaWQpO319YWRkTW9kdWxlc1RvSW1wb3J0RGVzY3JpcHRpb25zKGUpe2Zvcihjb25zdCB0IG9mIGUudmFsdWVzKCkpe2NvbnN0e2lkOmV9PXRoaXMucmVzb2x2ZWRJZHNbdC5zb3VyY2VdO3QubW9kdWxlPXRoaXMuZ3JhcGgubW9kdWxlc0J5SWQuZ2V0KGUpO319YWRkUmVsZXZhbnRTaWRlRWZmZWN0RGVwZW5kZW5jaWVzKGUsdCxzKXtjb25zdCBpPW5ldyBTZXQsbj1yPT57Zm9yKGNvbnN0IG8gb2YgcilpLmhhcyhvKXx8KGkuYWRkKG8pLHQuaGFzKG8pP2UuYWRkKG8pOihvLmluZm8ubW9kdWxlU2lkZUVmZmVjdHN8fHMuaGFzKG8pKSYmKG8gaW5zdGFuY2VvZiBRdHx8by5oYXNFZmZlY3RzKCk/ZS5hZGQobyk6bihvLmRlcGVuZGVuY2llcykpKTt9O24odGhpcy5kZXBlbmRlbmNpZXMpLG4ocyk7fWFkZFNvdXJjZShlLHQpe2NvbnN0IHM9KGk9dC5hc3NlcnRpb25zLGk/Lmxlbmd0aD9PYmplY3QuZnJvbUVudHJpZXMoaS5tYXAoKGU9PltibyhlKSxlLnZhbHVlLnZhbHVlXSkpKTpmZSk7dmFyIGk7Y29uc3Qgbj10aGlzLnNvdXJjZXNXaXRoQXNzZXJ0aW9ucy5nZXQoZSk7bj92byhuLHMpJiZ0aGlzLmxvZyh2ZSxUdChuLHMsZSx0aGlzLmlkKSx0LnN0YXJ0KTp0aGlzLnNvdXJjZXNXaXRoQXNzZXJ0aW9ucy5zZXQoZSxzKTt9Z2V0VmFyaWFibGVGcm9tTmFtZXNwYWNlUmVleHBvcnRzKGUsdCxzKXtsZXQgaT1udWxsO2NvbnN0IG49bmV3IE1hcCxyPW5ldyBTZXQ7Zm9yKGNvbnN0IG8gb2YgdGhpcy5leHBvcnRBbGxNb2R1bGVzKXtpZihvLmluZm8uc3ludGhldGljTmFtZWRFeHBvcnRzPT09ZSljb250aW51ZTtjb25zdFthLGxdPURvKG8sZSx0LCEwLEJvKHMpKTtvIGluc3RhbmNlb2YgUXR8fGw/ci5hZGQoYSk6YSBpbnN0YW5jZW9mIGZvP2l8fChpPWEpOmEmJm4uc2V0KGEsbyk7fWlmKG4uc2l6ZT4wKXtjb25zdCB0PVsuLi5uXSxzPXRbMF1bMF07cmV0dXJuIDE9PT10Lmxlbmd0aD9bc106KHRoaXMub3B0aW9ucy5vbkxvZyh2ZSwobz1lLGE9dGhpcy5pZCxsPXQubWFwKCgoWyxlXSk9PmUuaWQpKSx7YmluZGluZzpvLGNvZGU6Ik5BTUVTUEFDRV9DT05GTElDVCIsaWRzOmwsbWVzc2FnZTpgQ29uZmxpY3RpbmcgbmFtZXNwYWNlczogIiR7TChhKX0iIHJlLWV4cG9ydHMgIiR7b30iIGZyb20gb25lIG9mIHRoZSBtb2R1bGVzICR7UmUobC5tYXAoKGU9PkwoZSkpKSl9ICh3aWxsIGJlIGlnbm9yZWQpLmAscmVleHBvcnRlcjphfSkpLFtudWxsXSl9dmFyIG8sYSxsO2lmKHIuc2l6ZT4wKXtjb25zdCB0PVsuLi5yXSxzPXRbMF07cmV0dXJuIHQubGVuZ3RoPjEmJnRoaXMub3B0aW9ucy5vbkxvZyh2ZSxmdW5jdGlvbihlLHQscyxpKXtyZXR1cm4ge2JpbmRpbmc6ZSxjb2RlOiJBTUJJR1VPVVNfRVhURVJOQUxfTkFNRVNQQUNFUyIsaWRzOmksbWVzc2FnZTpgQW1iaWd1b3VzIGV4dGVybmFsIG5hbWVzcGFjZSByZXNvbHV0aW9uOiAiJHtMKHQpfSIgcmUtZXhwb3J0cyAiJHtlfSIgZnJvbSBvbmUgb2YgdGhlIGV4dGVybmFsIG1vZHVsZXMgJHtSZShpLm1hcCgoZT0+TChlKSkpKX0sIGd1ZXNzaW5nICIke0wocyl9Ii5gLHJlZXhwb3J0ZXI6dH19KGUsdGhpcy5pZCxzLm1vZHVsZS5pZCx0Lm1hcCgoZT0+ZS5tb2R1bGUuaWQpKSkpLFtzLCEwXX1yZXR1cm4gaT9baV06W251bGxdfWluY2x1ZGVBbmRHZXRBZGRpdGlvbmFsTWVyZ2VkTmFtZXNwYWNlcygpe2NvbnN0IGU9bmV3IFNldCx0PW5ldyBTZXQ7Zm9yKGNvbnN0IHMgb2YgW3RoaXMsLi4udGhpcy5leHBvcnRBbGxNb2R1bGVzXSlpZihzIGluc3RhbmNlb2YgUXQpe2NvbnN0W3RdPXMuZ2V0VmFyaWFibGVGb3JFeHBvcnROYW1lKCIqIik7dC5pbmNsdWRlKCksdGhpcy5pbmNsdWRlZEltcG9ydHMuYWRkKHQpLGUuYWRkKHQpO31lbHNlIGlmKHMuaW5mby5zeW50aGV0aWNOYW1lZEV4cG9ydHMpe2NvbnN0IGU9cy5nZXRTeW50aGV0aWNOYW1lc3BhY2UoKTtlLmluY2x1ZGUoKSx0aGlzLmluY2x1ZGVkSW1wb3J0cy5hZGQoZSksdC5hZGQoZSk7fXJldHVybiBbLi4udCwuLi5lXX1pbmNsdWRlRHluYW1pY0ltcG9ydChlKXtjb25zdCB0PXRoaXMuZHluYW1pY0ltcG9ydHMuZmluZCgodD0+dC5ub2RlPT09ZSkpLnJlc29sdXRpb247aWYodCBpbnN0YW5jZW9mIFRvKXt0LmluY2x1ZGVkRHluYW1pY0ltcG9ydGVycy5wdXNoKHRoaXMpO2NvbnN0IHM9dGhpcy5vcHRpb25zLnRyZWVzaGFrZT9lLmdldERldGVybWluaXN0aWNJbXBvcnRlZE5hbWVzKCk6dm9pZCAwO3M/dC5pbmNsdWRlRXhwb3J0c0J5TmFtZXMocyk6dC5pbmNsdWRlQWxsRXhwb3J0cyghMCk7fX1pbmNsdWRlVmFyaWFibGUoZSl7Y29uc3QgdD1lLm1vZHVsZTtpZihlLmluY2x1ZGVkKXQgaW5zdGFuY2VvZiBUbyYmdCE9PXRoaXMmJkxvKGUsdGhpcyk7ZWxzZSBpZihlLmluY2x1ZGUoKSx0aGlzLmdyYXBoLm5lZWRzVHJlZXNoYWtpbmdQYXNzPSEwLHQgaW5zdGFuY2VvZiBUbyYmKHQuaXNFeGVjdXRlZHx8TW8odCksdCE9PXRoaXMpKXtjb25zdCB0PUxvKGUsdGhpcyk7Zm9yKGNvbnN0IGUgb2YgdCllLmlzRXhlY3V0ZWR8fE1vKGUpO319aW5jbHVkZVZhcmlhYmxlSW5Nb2R1bGUoZSl7dGhpcy5pbmNsdWRlVmFyaWFibGUoZSk7Y29uc3QgdD1lLm1vZHVsZTt0JiZ0IT09dGhpcyYmdGhpcy5pbmNsdWRlZEltcG9ydHMuYWRkKGUpO31zaGltTWlzc2luZ0V4cG9ydChlKXt2YXIgdCxzO3RoaXMub3B0aW9ucy5vbkxvZyh2ZSwodD10aGlzLmlkLHtiaW5kaW5nOnM9ZSxjb2RlOiJTSElNTUVEX0VYUE9SVCIsZXhwb3J0ZXI6dCxtZXNzYWdlOmBNaXNzaW5nIGV4cG9ydCAiJHtzfSIgaGFzIGJlZW4gc2hpbW1lZCBpbiBtb2R1bGUgIiR7TCh0KX0iLmB9KSksdGhpcy5leHBvcnRzLnNldChlLE9vKTt9dHJ5UGFyc2UoKXt0cnl7cmV0dXJuIHRoaXMuZ3JhcGguY29udGV4dFBhcnNlKHRoaXMuaW5mby5jb2RlKX1jYXRjaChlKXtyZXR1cm4gdGhpcy5lcnJvcihmdW5jdGlvbihlLHQpe2xldCBzPWUubWVzc2FnZS5yZXBsYWNlKC8gXChcZCs6XGQrXCkkLywiIik7cmV0dXJuIHQuZW5kc1dpdGgoIi5qc29uIik/cys9IiAoTm90ZSB0aGF0IHlvdSBuZWVkIEByb2xsdXAvcGx1Z2luLWpzb24gdG8gaW1wb3J0IEpTT04gZmlsZXMpIjp0LmVuZHNXaXRoKCIuanMiKXx8KHMrPSIgKE5vdGUgdGhhdCB5b3UgbmVlZCBwbHVnaW5zIHRvIGltcG9ydCBmaWxlcyB0aGF0IGFyZSBub3QgSmF2YVNjcmlwdCkiKSx7Y2F1c2U6ZSxjb2RlOiJQQVJTRV9FUlJPUiIsaWQ6dCxtZXNzYWdlOnN9fShlLHRoaXMuaWQpLGUucG9zKX19fWZ1bmN0aW9uIFZvKGUsdCxzKXtpZihlLm1vZHVsZSBpbnN0YW5jZW9mIFRvJiZlLm1vZHVsZSE9PXMpe2NvbnN0IGk9ZS5tb2R1bGUuY3ljbGVzO2lmKGkuc2l6ZT4wKXtjb25zdCBuPXMuY3ljbGVzO2Zvcihjb25zdCByIG9mIG4paWYoaS5oYXMocikpe3QuYWx0ZXJuYXRpdmVSZWV4cG9ydE1vZHVsZXMuc2V0KGUscyk7YnJlYWt9fX19Y29uc3QgQm89ZT0+ZSYmbmV3IE1hcChBcnJheS5mcm9tKGUsKChbZSx0XSk9PltlLG5ldyBTZXQodCldKSkpO2Z1bmN0aW9uIHpvKGUpe3JldHVybiBlLmVuZHNXaXRoKCIuanMiKT9lLnNsaWNlKDAsLTMpOmV9ZnVuY3Rpb24gRm8oZSx0KXtyZXR1cm4gZS5hdXRvSWQ/YCR7ZS5iYXNlUGF0aD9lLmJhc2VQYXRoKyIvIjoiIn0ke3pvKHQpfWA6ZS5pZD8/IiJ9ZnVuY3Rpb24gam8oZSx0LHMsaSxuLHIsbyxhPSJyZXR1cm4gIil7Y29uc3R7XzpsLGdldERpcmVjdFJldHVybkZ1bmN0aW9uOmMsZ2V0RnVuY3Rpb25JbnRybzpoLGdldFByb3BlcnR5QWNjZXNzOnUsbjpkLHM6cH09bjtpZighcylyZXR1cm4gYCR7ZH0ke2R9JHthfSR7ZnVuY3Rpb24oZSx0LHMsaSxuKXtpZihlLmxlbmd0aD4wKXJldHVybiBlWzBdLmxvY2FsO2Zvcihjb25zdHtkZWZhdWx0VmFyaWFibGVOYW1lOmUsaW1wb3J0UGF0aDpyLGlzQ2h1bms6byxuYW1lOmEsbmFtZWRFeHBvcnRzTW9kZTpsLG5hbWVzcGFjZVZhcmlhYmxlTmFtZTpjLHJlZXhwb3J0czpofW9mIHQpaWYoaClyZXR1cm4gVW8oYSxoWzBdLmltcG9ydGVkLGwsbyxlLGMscyxyLGksbil9KGUsdCxpLG8sdSl9O2A7bGV0IGY9IiI7Zm9yKGNvbnN0e2RlZmF1bHRWYXJpYWJsZU5hbWU6ZSxpbXBvcnRQYXRoOm4saXNDaHVuazphLG5hbWU6aCxuYW1lZEV4cG9ydHNNb2RlOnAsbmFtZXNwYWNlVmFyaWFibGVOYW1lOm0scmVleHBvcnRzOmd9b2YgdClpZihnJiZzKWZvcihjb25zdCB0IG9mIGcpaWYoIioiIT09dC5yZWV4cG9ydGVkKXtjb25zdCBzPVVvKGgsdC5pbXBvcnRlZCxwLGEsZSxtLGksbixvLHUpO2lmKGYmJihmKz1kKSwiKiIhPT10LmltcG9ydGVkJiZ0Lm5lZWRzTGl2ZUJpbmRpbmcpe2NvbnN0W2UsaV09YyhbXSx7ZnVuY3Rpb25SZXR1cm46ITAsbGluZUJyZWFrSW5kZW50Om51bGwsbmFtZTpudWxsfSk7Zis9YE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCR7bH0nJHt0LnJlZXhwb3J0ZWR9Jywke2x9eyR7ZH0ke3J9ZW51bWVyYWJsZToke2x9dHJ1ZSwke2R9JHtyfWdldDoke2x9JHtlfSR7c30ke2l9JHtkfX0pO2A7fWVsc2UgZis9YGV4cG9ydHMke3UodC5yZWV4cG9ydGVkKX0ke2x9PSR7bH0ke3N9O2A7fWZvcihjb25zdHtleHBvcnRlZDp0LGxvY2FsOnN9b2YgZSl7Y29uc3QgZT1gZXhwb3J0cyR7dSh0KX1gO2UhPT1zJiYoZiYmKGYrPWQpLGYrPWAke2V9JHtsfT0ke2x9JHtzfTtgKTt9Zm9yKGNvbnN0e25hbWU6ZSxyZWV4cG9ydHM6aX1vZiB0KWlmKGkmJnMpZm9yKGNvbnN0IHQgb2YgaSlpZigiKiI9PT10LnJlZXhwb3J0ZWQpe2YmJihmKz1kKTtjb25zdCBzPWB7JHtkfSR7cn1pZiR7bH0oayR7bH0hPT0ke2x9J2RlZmF1bHQnJHtsfSYmJHtsfSFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZXhwb3J0cywke2x9aykpJHtsfSR7cW8oZSx0Lm5lZWRzTGl2ZUJpbmRpbmcscixuKX0ke3B9JHtkfX1gO2YrPWBPYmplY3Qua2V5cygke2V9KS5mb3JFYWNoKCR7aChbImsiXSx7aXNBc3luYzohMSxuYW1lOm51bGx9KX0ke3N9KTtgO31yZXR1cm4gZj9gJHtkfSR7ZH0ke2Z9YDoiIn1mdW5jdGlvbiBVbyhlLHQscyxpLG4scixvLGEsbCxjKXtpZigiZGVmYXVsdCI9PT10KXtpZighaSl7Y29uc3QgdD1vKGEpLHM9eXJbdF0/bjplO3JldHVybiB4cih0LGwpP2Ake3N9JHtjKCJkZWZhdWx0Iil9YDpzfXJldHVybiBzP2Ake2V9JHtjKCJkZWZhdWx0Iil9YDplfXJldHVybiAiKiI9PT10PyhpPyFzOkVyW28oYSldKT9yOmU6YCR7ZX0ke2ModCl9YH1mdW5jdGlvbiBHbyhlKXtyZXR1cm4gZShbWyJ2YWx1ZSIsInRydWUiXV0se2xpbmVCcmVha0luZGVudDpudWxsfSl9ZnVuY3Rpb24gV28oZSx0LHMse186aSxnZXRPYmplY3Q6bn0pe2lmKGUpe2lmKHQpcmV0dXJuIHM/YE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGV4cG9ydHMsJHtpfSR7bihbWyJfX2VzTW9kdWxlIixHbyhuKV0sW251bGwsYFtTeW1ib2wudG9TdHJpbmdUYWddOiR7aX0ke0xyKG4pfWBdXSx7bGluZUJyZWFrSW5kZW50Om51bGx9KX0pO2A6YE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCR7aX0nX19lc01vZHVsZScsJHtpfSR7R28obil9KTtgO2lmKHMpcmV0dXJuIGBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywke2l9U3ltYm9sLnRvU3RyaW5nVGFnLCR7aX0ke0xyKG4pfSk7YH1yZXR1cm4gIiJ9Y29uc3QgcW89KGUsdCxzLHtfOmksZ2V0RGlyZWN0UmV0dXJuRnVuY3Rpb246bixuOnJ9KT0+e2lmKHQpe2NvbnN0W3Qsb109bihbXSx7ZnVuY3Rpb25SZXR1cm46ITAsbGluZUJyZWFrSW5kZW50Om51bGwsbmFtZTpudWxsfSk7cmV0dXJuIGBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywke2l9aywke2l9eyR7cn0ke3N9JHtzfWVudW1lcmFibGU6JHtpfXRydWUsJHtyfSR7c30ke3N9Z2V0OiR7aX0ke3R9JHtlfVtrXSR7b30ke3J9JHtzfX0pYH1yZXR1cm4gYGV4cG9ydHNba10ke2l9PSR7aX0ke2V9W2tdYH07ZnVuY3Rpb24gSG8oZSx0LHMsaSxuLHIsbyxhKXtjb25zdHtfOmwsY25zdDpjLG46aH09YSx1PW5ldyBTZXQsZD1bXSxwPShlLHQscyk9Pnt1LmFkZCh0KSxkLnB1c2goYCR7Y30gJHtlfSR7bH09JHtsfS8qI19fUFVSRV9fKi8ke3R9KCR7c30pO2ApO307Zm9yKGNvbnN0e2RlZmF1bHRWYXJpYWJsZU5hbWU6cyxpbXBvcnRzOmksaW1wb3J0UGF0aDpuLGlzQ2h1bms6cixuYW1lOm8sbmFtZWRFeHBvcnRzTW9kZTphLG5hbWVzcGFjZVZhcmlhYmxlTmFtZTpsLHJlZXhwb3J0czpjfW9mIGUpaWYocil7Zm9yKGNvbnN0e2ltcG9ydGVkOmUscmVleHBvcnRlZDp0fW9mIFsuLi5pfHxbXSwuLi5jfHxbXV0paWYoIioiPT09ZSYmIioiIT09dCl7YXx8cChsLG1yLG8pO2JyZWFrfX1lbHNlIHtjb25zdCBlPXQobik7bGV0IHI9ITEsYT0hMTtmb3IoY29uc3R7aW1wb3J0ZWQ6dCxyZWV4cG9ydGVkOm59b2YgWy4uLml8fFtdLC4uLmN8fFtdXSl7bGV0IGksYzsiZGVmYXVsdCI9PT10P3J8fChyPSEwLHMhPT1sJiYoYz1zLGk9eXJbZV0pKToiKiIhPT10fHwiKiI9PT1ufHxhfHwoYT0hMCxpPUVyW2VdLGM9bCksaSYmcChjLGksbyk7fX1yZXR1cm4gYCR7dnIodSxyLG8sYSxzLGksbil9JHtkLmxlbmd0aD4wP2Ake2Quam9pbihoKX0ke2h9JHtofWA6IiJ9YH1mdW5jdGlvbiBLbyhlLHQpe3JldHVybiAiLiIhPT1lWzBdP2U6dD8ocz1lKS5lbmRzV2l0aCgiLmpzIik/czpzKyIuanMiOnpvKGUpO3ZhciBzO31jb25zdCBZbz1uZXcgU2V0KFsuLi50KFsiYXNzZXJ0IiwiYXN5bmNfaG9va3MiLCJidWZmZXIiLCJjaGlsZF9wcm9jZXNzIiwiY2x1c3RlciIsImNvbnNvbGUiLCJjb25zdGFudHMiLCJjcnlwdG8iLCJkZ3JhbSIsImRpYWdub3N0aWNzX2NoYW5uZWwiLCJkbnMiLCJkb21haW4iLCJldmVudHMiLCJmcyIsImh0dHAiLCJodHRwMiIsImh0dHBzIiwiaW5zcGVjdG9yIiwibW9kdWxlIiwibmV0Iiwib3MiLCJwYXRoIiwicGVyZl9ob29rcyIsInByb2Nlc3MiLCJwdW55Y29kZSIsInF1ZXJ5c3RyaW5nIiwicmVhZGxpbmUiLCJyZXBsIiwic3RyZWFtIiwic3RyaW5nX2RlY29kZXIiLCJ0aW1lcnMiLCJ0bHMiLCJ0cmFjZV9ldmVudHMiLCJ0dHkiLCJ1cmwiLCJ1dGlsIiwidjgiLCJ2bSIsIndhc2kiLCJ3b3JrZXJfdGhyZWFkcyIsInpsaWIiXSksImFzc2VydC9zdHJpY3QiLCJkbnMvcHJvbWlzZXMiLCJmcy9wcm9taXNlcyIsInBhdGgvcG9zaXgiLCJwYXRoL3dpbjMyIiwicmVhZGxpbmUvcHJvbWlzZXMiLCJzdHJlYW0vY29uc3VtZXJzIiwic3RyZWFtL3Byb21pc2VzIiwic3RyZWFtL3dlYiIsInRpbWVycy9wcm9taXNlcyIsInV0aWwvdHlwZXMiXSk7ZnVuY3Rpb24gWG8oZSx0KXtjb25zdCBzPXQubWFwKCgoe2ltcG9ydFBhdGg6ZX0pPT5lKSkuZmlsdGVyKChlPT5Zby5oYXMoZSl8fGUuc3RhcnRzV2l0aCgibm9kZToiKSkpOzAhPT1zLmxlbmd0aCYmZSh2ZSxmdW5jdGlvbihlKXtyZXR1cm4ge2NvZGU6RXQsaWRzOmUsbWVzc2FnZTpgQ3JlYXRpbmcgYSBicm93c2VyIGJ1bmRsZSB0aGF0IGRlcGVuZHMgb24gTm9kZS5qcyBidWlsdC1pbiBtb2R1bGVzICgke1JlKGUpfSkuIFlvdSBtaWdodCBuZWVkIHRvIGluY2x1ZGUgaHR0cHM6Ly9naXRodWIuY29tL0ZyZWRLU2Nob3R0L3JvbGx1cC1wbHVnaW4tcG9seWZpbGwtbm9kZWB9fShzKSk7fWNvbnN0IFFvPShlLHQpPT5lLnNwbGl0KCIuIikubWFwKHQpLmpvaW4oIiIpO2Z1bmN0aW9uIFpvKGUsdCxzLGkse186bixnZXRQcm9wZXJ0eUFjY2VzczpyfSl7Y29uc3Qgbz1lLnNwbGl0KCIuIik7b1swXT0oImZ1bmN0aW9uIj09dHlwZW9mIHM/cyhvWzBdKTpzW29bMF1dKXx8b1swXTtjb25zdCBhPW8ucG9wKCk7bGV0IGw9dCxjPVsuLi5vLm1hcCgoZT0+KGwrPXIoZSksYCR7bH0ke259PSR7bn0ke2x9JHtufXx8JHtufXt9YCkpKSxgJHtsfSR7cihhKX1gXS5qb2luKGAsJHtufWApK2Ake259PSR7bn0ke2l9YDtyZXR1cm4gby5sZW5ndGg+MCYmKGM9YCgke2N9KWApLGN9ZnVuY3Rpb24gSm8oZSl7bGV0IHQ9ZS5sZW5ndGg7Zm9yKDt0LS07KXtjb25zdHtpbXBvcnRzOnMscmVleHBvcnRzOml9PWVbdF07aWYoc3x8aSlyZXR1cm4gZS5zbGljZSgwLHQrMSl9cmV0dXJuIFtdfWNvbnN0IGVhPSh7ZGVwZW5kZW5jaWVzOmUsZXhwb3J0czp0fSk9Pntjb25zdCBzPW5ldyBTZXQodC5tYXAoKGU9PmUuZXhwb3J0ZWQpKSk7cy5hZGQoImRlZmF1bHQiKTtmb3IoY29uc3R7cmVleHBvcnRzOnR9b2YgZSlpZih0KWZvcihjb25zdCBlIG9mIHQpIioiIT09ZS5yZWV4cG9ydGVkJiZzLmFkZChlLnJlZXhwb3J0ZWQpO3JldHVybiBzfSx0YT0oZSx0LHtfOnMsY25zdDppLGdldE9iamVjdDpuLG46cn0pPT5lP2Ake3J9JHt0fSR7aX0gX3N0YXJFeGNsdWRlcyR7c309JHtzfSR7bihbLi4uZV0ubWFwKChlPT5bZSwiMSJdKSkse2xpbmVCcmVha0luZGVudDp7YmFzZTp0LHQ6dH19KX07YDoiIixzYT0oZSx0LHtfOnMsbjppfSk9PmUubGVuZ3RoPjA/YCR7aX0ke3R9dmFyICR7ZS5qb2luKGAsJHtzfWApfTtgOiIiLGlhPShlLHQscyk9Pm5hKGUuZmlsdGVyKChlPT5lLmhvaXN0ZWQpKS5tYXAoKGU9Pih7bmFtZTplLmV4cG9ydGVkLHZhbHVlOmUubG9jYWx9KSkpLHQscyk7ZnVuY3Rpb24gbmEoZSx0LHtfOnMsbjppfSl7cmV0dXJuIDA9PT1lLmxlbmd0aD8iIjoxPT09ZS5sZW5ndGg/YGV4cG9ydHMoJyR7ZVswXS5uYW1lfScsJHtzfSR7ZVswXS52YWx1ZX0pOyR7aX0ke2l9YDpgZXhwb3J0cyh7JHtpfWArZS5tYXAoKCh7bmFtZTplLHZhbHVlOml9KT0+YCR7dH0ke2V9OiR7c30ke2l9YCkpLmpvaW4oYCwke2l9YCkrYCR7aX19KTske2l9JHtpfWB9Y29uc3QgcmE9KGUsdCxzKT0+bmEoZS5maWx0ZXIoKGU9PmUuZXhwcmVzc2lvbikpLm1hcCgoZT0+KHtuYW1lOmUuZXhwb3J0ZWQsdmFsdWU6ZS5sb2NhbH0pKSksdCxzKSxvYT0oZSx0LHMpPT5uYShlLmZpbHRlcigoZT0+ZS5sb2NhbD09PWhvKSkubWFwKChlPT4oe25hbWU6ZS5leHBvcnRlZCx2YWx1ZTpob30pKSksdCxzKTtmdW5jdGlvbiBhYShlLHQscyl7cmV0dXJuIGU/YCR7dH0ke1FvKGUscyl9YDoibnVsbCJ9dmFyIGxhPXthbWQ6ZnVuY3Rpb24oZSx7YWNjZXNzZWRHbG9iYWxzOnQsZGVwZW5kZW5jaWVzOnMsZXhwb3J0czppLGhhc0RlZmF1bHRFeHBvcnQ6bixoYXNFeHBvcnRzOnIsaWQ6byxpbmRlbnQ6YSxpbnRybzpsLGlzRW50cnlGYWNhZGU6Yyxpc01vZHVsZUZhY2FkZTpoLG5hbWVkRXhwb3J0c01vZGU6dSxsb2c6ZCxvdXRybzpwLHNuaXBwZXRzOmZ9LHthbWQ6bSxlc01vZHVsZTpnLGV4dGVybmFsTGl2ZUJpbmRpbmdzOnksZnJlZXplOngsaW50ZXJvcDpFLG5hbWVzcGFjZVRvU3RyaW5nVGFnOmIsc3RyaWN0OnZ9KXtYbyhkLHMpO2NvbnN0IFM9cy5tYXAoKGU9PmAnJHtLbyhlLmltcG9ydFBhdGgsbS5mb3JjZUpzRXh0ZW5zaW9uRm9ySW1wb3J0cyl9J2ApKSxBPXMubWFwKChlPT5lLm5hbWUpKSx7bjprLGdldE5vbkFycm93RnVuY3Rpb25JbnRybzpJLF86d309Zjt1JiZyJiYoQS51bnNoaWZ0KCJleHBvcnRzIiksUy51bnNoaWZ0KCInZXhwb3J0cyciKSksdC5oYXMoInJlcXVpcmUiKSYmKEEudW5zaGlmdCgicmVxdWlyZSIpLFMudW5zaGlmdCgiJ3JlcXVpcmUnIikpLHQuaGFzKCJtb2R1bGUiKSYmKEEudW5zaGlmdCgibW9kdWxlIiksUy51bnNoaWZ0KCInbW9kdWxlJyIpKTtjb25zdCBQPUZvKG0sbyksQz0oUD9gJyR7UH0nLCR7d31gOiIiKSsoUy5sZW5ndGg+MD9gWyR7Uy5qb2luKGAsJHt3fWApfV0sJHt3fWA6IiIpLCQ9dj9gJHt3fSd1c2Ugc3RyaWN0JztgOiIiO2UucHJlcGVuZChgJHtsfSR7SG8ocyxFLHkseCxiLHQsYSxmKX1gKTtjb25zdCBOPWpvKGkscyx1LEUsZixhLHkpO2xldCBfPVdvKHUmJnIsYyYmKCEwPT09Z3x8ImlmLWRlZmF1bHQtcHJvcCI9PT1nJiZuKSxoJiZiLGYpO18mJihfPWsraytfKSxlLmFwcGVuZChgJHtOfSR7X30ke3B9YCkuaW5kZW50KGEpLnByZXBlbmQoYCR7bS5kZWZpbmV9KCR7Q30oJHtJKEEse2lzQXN5bmM6ITEsbmFtZTpudWxsfSl9eyR7JH0ke2t9JHtrfWApLmFwcGVuZChgJHtrfSR7a319KSk7YCk7fSxjanM6ZnVuY3Rpb24oZSx7YWNjZXNzZWRHbG9iYWxzOnQsZGVwZW5kZW5jaWVzOnMsZXhwb3J0czppLGhhc0RlZmF1bHRFeHBvcnQ6bixoYXNFeHBvcnRzOnIsaW5kZW50Om8saW50cm86YSxpc0VudHJ5RmFjYWRlOmwsaXNNb2R1bGVGYWNhZGU6YyxuYW1lZEV4cG9ydHNNb2RlOmgsb3V0cm86dSxzbmlwcGV0czpkfSx7Y29tcGFjdDpwLGVzTW9kdWxlOmYsZXh0ZXJuYWxMaXZlQmluZGluZ3M6bSxmcmVlemU6ZyxpbnRlcm9wOnksbmFtZXNwYWNlVG9TdHJpbmdUYWc6eCxzdHJpY3Q6RX0pe2NvbnN0e186YixuOnZ9PWQsUz1FP2AndXNlIHN0cmljdCc7JHt2fSR7dn1gOiIiO2xldCBBPVdvKGgmJnIsbCYmKCEwPT09Znx8ImlmLWRlZmF1bHQtcHJvcCI9PT1mJiZuKSxjJiZ4LGQpO0EmJihBKz12K3YpO2NvbnN0IGs9ZnVuY3Rpb24oZSx7Xzp0LGNuc3Q6cyxuOml9LG4pe2xldCByPSIiLG89ITE7Zm9yKGNvbnN0e2ltcG9ydFBhdGg6YSxuYW1lOmwscmVleHBvcnRzOmMsaW1wb3J0czpofW9mIGUpY3x8aD8ocis9biYmbz8iLCI6YCR7cj9gOyR7aX1gOiIifSR7c30gYCxvPSEwLHIrPWAke2x9JHt0fT0ke3R9cmVxdWlyZSgnJHthfScpYCk6KHImJihyKz1uJiYhbz8iLCI6YDske2l9YCksbz0hMSxyKz1gcmVxdWlyZSgnJHthfScpYCk7aWYocilyZXR1cm4gYCR7cn07JHtpfSR7aX1gO3JldHVybiAiIn0ocyxkLHApLEk9SG8ocyx5LG0sZyx4LHQsbyxkKTtlLnByZXBlbmQoYCR7U30ke2F9JHtBfSR7a30ke0l9YCk7Y29uc3Qgdz1qbyhpLHMsaCx5LGQsbyxtLGBtb2R1bGUuZXhwb3J0cyR7Yn09JHtifWApO2UuYXBwZW5kKGAke3d9JHt1fWApO30sZXM6ZnVuY3Rpb24oZSx7YWNjZXNzZWRHbG9iYWxzOnQsaW5kZW50OnMsaW50cm86aSxvdXRybzpuLGRlcGVuZGVuY2llczpyLGV4cG9ydHM6byxzbmlwcGV0czphfSx7ZXh0ZXJuYWxMaXZlQmluZGluZ3M6bCxmcmVlemU6YyxuYW1lc3BhY2VUb1N0cmluZ1RhZzpofSl7Y29uc3R7bjp1fT1hLGQ9ZnVuY3Rpb24oZSx7Xzp0fSl7Y29uc3Qgcz1bXTtmb3IoY29uc3R7aW1wb3J0UGF0aDppLHJlZXhwb3J0czpuLGltcG9ydHM6cixuYW1lOm8sYXNzZXJ0aW9uczphfW9mIGUpe2NvbnN0IGU9YCcke2l9JyR7YT9gJHt0fWFzc2VydCR7dH0ke2F9YDoiIn07YDtpZihufHxyKXtpZihyKXtsZXQgaT1udWxsLG49bnVsbDtjb25zdCBvPVtdO2Zvcihjb25zdCBlIG9mIHIpImRlZmF1bHQiPT09ZS5pbXBvcnRlZD9pPWU6IioiPT09ZS5pbXBvcnRlZD9uPWU6by5wdXNoKGUpO24mJnMucHVzaChgaW1wb3J0JHt0fSoke3R9YXMgJHtuLmxvY2FsfSBmcm9tJHt0fSR7ZX1gKSxpJiYwPT09by5sZW5ndGg/cy5wdXNoKGBpbXBvcnQgJHtpLmxvY2FsfSBmcm9tJHt0fSR7ZX1gKTpvLmxlbmd0aD4wJiZzLnB1c2goYGltcG9ydCAke2k/YCR7aS5sb2NhbH0sJHt0fWA6IiJ9eyR7dH0ke28ubWFwKChlPT5lLmltcG9ydGVkPT09ZS5sb2NhbD9lLmltcG9ydGVkOmAke2UuaW1wb3J0ZWR9IGFzICR7ZS5sb2NhbH1gKSkuam9pbihgLCR7dH1gKX0ke3R9fSR7dH1mcm9tJHt0fSR7ZX1gKTt9aWYobil7bGV0IGk9bnVsbDtjb25zdCBhPVtdLGw9W107Zm9yKGNvbnN0IGUgb2YgbikiKiI9PT1lLnJlZXhwb3J0ZWQ/aT1lOiIqIj09PWUuaW1wb3J0ZWQ/YS5wdXNoKGUpOmwucHVzaChlKTtpZihpJiZzLnB1c2goYGV4cG9ydCR7dH0qJHt0fWZyb20ke3R9JHtlfWApLGEubGVuZ3RoPjApe3ImJnIuc29tZSgoZT0+IioiPT09ZS5pbXBvcnRlZCYmZS5sb2NhbD09PW8pKXx8cy5wdXNoKGBpbXBvcnQke3R9KiR7dH1hcyAke299IGZyb20ke3R9JHtlfWApO2Zvcihjb25zdCBlIG9mIGEpcy5wdXNoKGBleHBvcnQke3R9eyR7dH0ke289PT1lLnJlZXhwb3J0ZWQ/bzpgJHtvfSBhcyAke2UucmVleHBvcnRlZH1gfSB9O2ApO31sLmxlbmd0aD4wJiZzLnB1c2goYGV4cG9ydCR7dH17JHt0fSR7bC5tYXAoKGU9PmUuaW1wb3J0ZWQ9PT1lLnJlZXhwb3J0ZWQ/ZS5pbXBvcnRlZDpgJHtlLmltcG9ydGVkfSBhcyAke2UucmVleHBvcnRlZH1gKSkuam9pbihgLCR7dH1gKX0ke3R9fSR7dH1mcm9tJHt0fSR7ZX1gKTt9fWVsc2Ugcy5wdXNoKGBpbXBvcnQke3R9JHtlfWApO31yZXR1cm4gc30ocixhKTtkLmxlbmd0aD4wJiYoaSs9ZC5qb2luKHUpK3UrdSksKGkrPXZyKG51bGwsdCxzLGEsbCxjLGgpKSYmZS5wcmVwZW5kKGkpO2NvbnN0IHA9ZnVuY3Rpb24oZSx7Xzp0LGNuc3Q6c30pe2NvbnN0IGk9W10sbj1bXTtmb3IoY29uc3QgciBvZiBlKXIuZXhwcmVzc2lvbiYmaS5wdXNoKGAke3N9ICR7ci5sb2NhbH0ke3R9PSR7dH0ke3IuZXhwcmVzc2lvbn07YCksbi5wdXNoKHIuZXhwb3J0ZWQ9PT1yLmxvY2FsP3IubG9jYWw6YCR7ci5sb2NhbH0gYXMgJHtyLmV4cG9ydGVkfWApO24ubGVuZ3RoPjAmJmkucHVzaChgZXhwb3J0JHt0fXske3R9JHtuLmpvaW4oYCwke3R9YCl9JHt0fX07YCk7cmV0dXJuIGl9KG8sYSk7cC5sZW5ndGg+MCYmZS5hcHBlbmQodSt1K3Auam9pbih1KS50cmltKCkpLG4mJmUuYXBwZW5kKG4pLGUudHJpbSgpO30saWlmZTpmdW5jdGlvbihlLHthY2Nlc3NlZEdsb2JhbHM6dCxkZXBlbmRlbmNpZXM6cyxleHBvcnRzOmksaGFzRGVmYXVsdEV4cG9ydDpuLGhhc0V4cG9ydHM6cixpbmRlbnQ6byxpbnRybzphLG5hbWVkRXhwb3J0c01vZGU6bCxsb2c6YyxvdXRybzpoLHNuaXBwZXRzOnV9LHtjb21wYWN0OmQsZXNNb2R1bGU6cCxleHRlbmQ6ZixmcmVlemU6bSxleHRlcm5hbExpdmVCaW5kaW5nczpnLGdsb2JhbHM6eSxpbnRlcm9wOngsbmFtZTpFLG5hbWVzcGFjZVRvU3RyaW5nVGFnOmIsc3RyaWN0OnZ9KXtjb25zdHtfOlMsZ2V0Tm9uQXJyb3dGdW5jdGlvbkludHJvOkEsZ2V0UHJvcGVydHlBY2Nlc3M6ayxuOkl9PXUsdz1FJiZFLmluY2x1ZGVzKCIuIiksUD0hZiYmIXc7aWYoRSYmUCYmKEVlKEM9RSl8fHhlLnRlc3QoQykpKXJldHVybiBZZShmdW5jdGlvbihlKXtyZXR1cm4ge2NvZGU6YXQsbWVzc2FnZTpgR2l2ZW4gbmFtZSAiJHtlfSIgaXMgbm90IGEgbGVnYWwgSlMgaWRlbnRpZmllci4gSWYgeW91IG5lZWQgdGhpcywgeW91IGNhbiB0cnkgIm91dHB1dC5leHRlbmQ6IHRydWUiLmAsdXJsOk1lKEJlKX19KEUpKTt2YXIgQztYbyhjLHMpO2NvbnN0ICQ9Sm8ocyksTj0kLm1hcCgoZT0+ZS5nbG9iYWxOYW1lfHwibnVsbCIpKSxfPSQubWFwKChlPT5lLm5hbWUpKTtyJiYhRSYmYyh2ZSx7Y29kZTp4dCxtZXNzYWdlOidJZiB5b3UgZG8gbm90IHN1cHBseSAib3V0cHV0Lm5hbWUiLCB5b3UgbWF5IG5vdCBiZSBhYmxlIHRvIGFjY2VzcyB0aGUgZXhwb3J0cyBvZiBhbiBJSUZFIGJ1bmRsZS4nLHVybDpNZShxZSl9KSxsJiZyJiYoZj8oTi51bnNoaWZ0KGB0aGlzJHtRbyhFLGspfSR7U309JHtTfXRoaXMke1FvKEUsayl9JHtTfXx8JHtTfXt9YCksXy51bnNoaWZ0KCJleHBvcnRzIikpOihOLnVuc2hpZnQoInt9IiksXy51bnNoaWZ0KCJleHBvcnRzIikpKTtjb25zdCBSPXY/YCR7b30ndXNlIHN0cmljdCc7JHtJfWA6IiIsTT1IbyhzLHgsZyxtLGIsdCxvLHUpO2UucHJlcGVuZChgJHthfSR7TX1gKTtsZXQgTz1gKCR7QShfLHtpc0FzeW5jOiExLG5hbWU6bnVsbH0pfXske0l9JHtSfSR7SX1gO3ImJighRXx8ZiYmbHx8KE89KFA/YHZhciAke0V9YDpgdGhpcyR7UW8oRSxrKX1gKStgJHtTfT0ke1N9JHtPfWApLHcmJihPPWZ1bmN0aW9uKGUsdCxzLHtfOmksZ2V0UHJvcGVydHlBY2Nlc3M6bixzOnJ9LG8pe2NvbnN0IGE9ZS5zcGxpdCgiLiIpO2FbMF09KCJmdW5jdGlvbiI9PXR5cGVvZiBzP3MoYVswXSk6c1thWzBdXSl8fGFbMF0sYS5wb3AoKTtsZXQgbD10O3JldHVybiBhLm1hcCgoZT0+KGwrPW4oZSksYCR7bH0ke2l9PSR7aX0ke2x9JHtpfXx8JHtpfXt9JHtyfWApKSkuam9pbihvPyIsIjoiXG4iKSsobyYmYS5sZW5ndGg+MD8iOyI6IlxuIil9KEUsInRoaXMiLHksdSxkKStPKSk7bGV0IEQ9YCR7SX0ke0l9fSkoJHtOLmpvaW4oYCwke1N9YCl9KTtgO3ImJiFmJiZsJiYoRD1gJHtJfSR7SX0ke299cmV0dXJuIGV4cG9ydHM7JHtEfWApO2NvbnN0IEw9am8oaSxzLGwseCx1LG8sZyk7bGV0IFQ9V28obCYmciwhMD09PXB8fCJpZi1kZWZhdWx0LXByb3AiPT09cCYmbixiLHUpO1QmJihUPUkrSStUKSxlLmFwcGVuZChgJHtMfSR7VH0ke2h9YCkuaW5kZW50KG8pLnByZXBlbmQoTykuYXBwZW5kKEQpO30sc3lzdGVtOmZ1bmN0aW9uKGUse2FjY2Vzc2VkR2xvYmFsczp0LGRlcGVuZGVuY2llczpzLGV4cG9ydHM6aSxoYXNFeHBvcnRzOm4saW5kZW50OnIsaW50cm86byxzbmlwcGV0czphLG91dHJvOmwsdXNlc1RvcExldmVsQXdhaXQ6Y30se2V4dGVybmFsTGl2ZUJpbmRpbmdzOmgsZnJlZXplOnUsbmFtZTpkLG5hbWVzcGFjZVRvU3RyaW5nVGFnOnAsc3RyaWN0OmYsc3lzdGVtTnVsbFNldHRlcnM6bX0pe2NvbnN0e186ZyxnZXRGdW5jdGlvbkludHJvOnksZ2V0Tm9uQXJyb3dGdW5jdGlvbkludHJvOngsbjpFLHM6Yn09YSx7aW1wb3J0QmluZGluZ3M6dixzZXR0ZXJzOlMsc3RhckV4Y2x1ZGVzOkF9PWZ1bmN0aW9uKGUsdCxzLHtfOmksY25zdDpuLGdldE9iamVjdDpyLGdldFByb3BlcnR5QWNjZXNzOm8sbjphfSl7Y29uc3QgbD1bXSxjPVtdO2xldCBoPW51bGw7Zm9yKGNvbnN0e2ltcG9ydHM6dSxyZWV4cG9ydHM6ZH1vZiBlKXtjb25zdCBwPVtdO2lmKHUpZm9yKGNvbnN0IGUgb2YgdSlsLnB1c2goZS5sb2NhbCksIioiPT09ZS5pbXBvcnRlZD9wLnB1c2goYCR7ZS5sb2NhbH0ke2l9PSR7aX1tb2R1bGU7YCk6cC5wdXNoKGAke2UubG9jYWx9JHtpfT0ke2l9bW9kdWxlJHtvKGUuaW1wb3J0ZWQpfTtgKTtpZihkKXtjb25zdCBhPVtdO2xldCBsPSExO2Zvcihjb25zdHtpbXBvcnRlZDplLHJlZXhwb3J0ZWQ6dH1vZiBkKSIqIj09PXQ/bD0hMDphLnB1c2goW3QsIioiPT09ZT8ibW9kdWxlIjpgbW9kdWxlJHtvKGUpfWBdKTtpZihhLmxlbmd0aD4xfHxsKXtjb25zdCBvPXIoYSx7bGluZUJyZWFrSW5kZW50Om51bGx9KTtsPyhofHwoaD1lYSh7ZGVwZW5kZW5jaWVzOmUsZXhwb3J0czp0fSkpLHAucHVzaChgJHtufSBzZXR0ZXIke2l9PSR7aX0ke299O2AsYGZvciR7aX0oJHtufSBuYW1lIGluIG1vZHVsZSkke2l9e2AsYCR7c31pZiR7aX0oIV9zdGFyRXhjbHVkZXNbbmFtZV0pJHtpfXNldHRlcltuYW1lXSR7aX09JHtpfW1vZHVsZVtuYW1lXTtgLCJ9IiwiZXhwb3J0cyhzZXR0ZXIpOyIpKTpwLnB1c2goYGV4cG9ydHMoJHtvfSk7YCk7fWVsc2Uge2NvbnN0W2UsdF09YVswXTtwLnB1c2goYGV4cG9ydHMoJyR7ZX0nLCR7aX0ke3R9KTtgKTt9fWMucHVzaChwLmpvaW4oYCR7YX0ke3N9JHtzfSR7c31gKSk7fXJldHVybiB7aW1wb3J0QmluZGluZ3M6bCxzZXR0ZXJzOmMsc3RhckV4Y2x1ZGVzOmh9fShzLGkscixhKSxrPWQ/YCcke2R9Jywke2d9YDoiIixJPXQuaGFzKCJtb2R1bGUiKT9bImV4cG9ydHMiLCJtb2R1bGUiXTpuP1siZXhwb3J0cyJdOltdO2xldCB3PWBTeXN0ZW0ucmVnaXN0ZXIoJHtrfVtgK3MubWFwKCgoe2ltcG9ydFBhdGg6ZX0pPT5gJyR7ZX0nYCkpLmpvaW4oYCwke2d9YCkrYF0sJHtnfSgke3goSSx7aXNBc3luYzohMSxuYW1lOm51bGx9KX17JHtFfSR7cn0ke2Y/Iid1c2Ugc3RyaWN0JzsiOiIifWArdGEoQSxyLGEpK3NhKHYscixhKStgJHtFfSR7cn1yZXR1cm4ke2d9eyR7Uy5sZW5ndGg+MD9gJHtFfSR7cn0ke3J9c2V0dGVyczoke2d9WyR7Uy5tYXAoKGU9PmU/YCR7eShbIm1vZHVsZSJdLHtpc0FzeW5jOiExLG5hbWU6bnVsbH0pfXske0V9JHtyfSR7cn0ke3J9JHtlfSR7RX0ke3J9JHtyfX1gOm0/Im51bGwiOmAke3koW10se2lzQXN5bmM6ITEsbmFtZTpudWxsfSl9e31gKSkuam9pbihgLCR7Z31gKX1dLGA6IiJ9JHtFfWA7dys9YCR7cn0ke3J9ZXhlY3V0ZToke2d9KCR7eChbXSx7aXNBc3luYzpjLG5hbWU6bnVsbH0pfXske0V9JHtFfWA7Y29uc3QgUD1gJHtyfSR7cn19KSR7RX0ke3J9fSR7Yn0ke0V9fSkpO2A7ZS5wcmVwZW5kKG8rdnIobnVsbCx0LHIsYSxoLHUscCkraWEoaSxyLGEpKS5hcHBlbmQoYCR7bH0ke0V9JHtFfWArcmEoaSxyLGEpK29hKGkscixhKSkuaW5kZW50KGAke3J9JHtyfSR7cn1gKS5hcHBlbmQoUCkucHJlcGVuZCh3KTt9LHVtZDpmdW5jdGlvbihlLHthY2Nlc3NlZEdsb2JhbHM6dCxkZXBlbmRlbmNpZXM6cyxleHBvcnRzOmksaGFzRGVmYXVsdEV4cG9ydDpuLGhhc0V4cG9ydHM6cixpZDpvLGluZGVudDphLGludHJvOmwsbmFtZWRFeHBvcnRzTW9kZTpjLGxvZzpoLG91dHJvOnUsc25pcHBldHM6ZH0se2FtZDpwLGNvbXBhY3Q6Zixlc01vZHVsZTptLGV4dGVuZDpnLGV4dGVybmFsTGl2ZUJpbmRpbmdzOnksZnJlZXplOngsaW50ZXJvcDpFLG5hbWU6YixuYW1lc3BhY2VUb1N0cmluZ1RhZzp2LGdsb2JhbHM6Uyxub0NvbmZsaWN0OkEsc3RyaWN0Omt9KXtjb25zdHtfOkksY25zdDp3LGdldEZ1bmN0aW9uSW50cm86UCxnZXROb25BcnJvd0Z1bmN0aW9uSW50cm86QyxnZXRQcm9wZXJ0eUFjY2VzczokLG46TixzOl99PWQsUj1mPyJmIjoiZmFjdG9yeSIsTT1mPyJnIjoiZ2xvYmFsIjtpZihyJiYhYilyZXR1cm4gWWUoe2NvZGU6eHQsbWVzc2FnZTonWW91IG11c3Qgc3VwcGx5ICJvdXRwdXQubmFtZSIgZm9yIFVNRCBidW5kbGVzIHRoYXQgaGF2ZSBleHBvcnRzIHNvIHRoYXQgdGhlIGV4cG9ydHMgYXJlIGFjY2Vzc2libGUgaW4gZW52aXJvbm1lbnRzIHdpdGhvdXQgYSBtb2R1bGUgbG9hZGVyLicsdXJsOk1lKHFlKX0pO1hvKGgscyk7Y29uc3QgTz1zLm1hcCgoZT0+YCcke0tvKGUuaW1wb3J0UGF0aCxwLmZvcmNlSnNFeHRlbnNpb25Gb3JJbXBvcnRzKX0nYCkpLEQ9cy5tYXAoKGU9PmByZXF1aXJlKCcke2UuaW1wb3J0UGF0aH0nKWApKSxMPUpvKHMpLFQ9TC5tYXAoKGU9PmFhKGUuZ2xvYmFsTmFtZSxNLCQpKSksVj1MLm1hcCgoZT0+ZS5uYW1lKSk7YyYmKHJ8fEEpJiYoTy51bnNoaWZ0KCInZXhwb3J0cyciKSxELnVuc2hpZnQoImV4cG9ydHMiKSxULnVuc2hpZnQoWm8oYixNLFMsKGc/YCR7YWEoYixNLCQpfSR7SX18fCR7SX1gOiIiKSsie30iLGQpKSxWLnVuc2hpZnQoImV4cG9ydHMiKSk7Y29uc3QgQj1GbyhwLG8pLHo9KEI/YCcke0J9Jywke0l9YDoiIikrKE8ubGVuZ3RoPjA/YFske08uam9pbihgLCR7SX1gKX1dLCR7SX1gOiIiKSxGPXAuZGVmaW5lLGo9IWMmJnI/YG1vZHVsZS5leHBvcnRzJHtJfT0ke0l9YDoiIixVPWs/YCR7SX0ndXNlIHN0cmljdCc7JHtOfWA6IiI7bGV0IEc7aWYoQSl7Y29uc3QgZT1mPyJlIjoiZXhwb3J0cyI7bGV0IHQ7aWYoIWMmJnIpdD1gJHt3fSAke2V9JHtJfT0ke0l9JHtabyhiLE0sUyxgJHtSfSgke1Quam9pbihgLCR7SX1gKX0pYCxkKX07YDtlbHNlIHt0PWAke3d9ICR7ZX0ke0l9PSR7SX0ke1Quc2hpZnQoKX07JHtOfSR7YX0ke2F9JHtSfSgke1tlLC4uLlRdLmpvaW4oYCwke0l9YCl9KTtgO31HPWAoJHtQKFtdLHtpc0FzeW5jOiExLG5hbWU6bnVsbH0pfXske059JHthfSR7YX0ke3d9IGN1cnJlbnQke0l9PSR7SX0ke2Z1bmN0aW9uKGUsdCx7XzpzLGdldFByb3BlcnR5QWNjZXNzOml9KXtsZXQgbj10O3JldHVybiBlLnNwbGl0KCIuIikubWFwKChlPT5uKz1pKGUpKSkuam9pbihgJHtzfSYmJHtzfWApfShiLE0sZCl9OyR7Tn0ke2F9JHthfSR7dH0ke059JHthfSR7YX0ke2V9Lm5vQ29uZmxpY3Qke0l9PSR7SX0ke1AoW10se2lzQXN5bmM6ITEsbmFtZTpudWxsfSl9eyR7SX0ke2FhKGIsTSwkKX0ke0l9PSR7SX1jdXJyZW50OyR7SX1yZXR1cm4gJHtlfSR7X30ke0l9fTske059JHthfX0pKClgO31lbHNlIEc9YCR7Un0oJHtULmpvaW4oYCwke0l9YCl9KWAsIWMmJnImJihHPVpvKGIsTSxTLEcsZCkpO2NvbnN0IFc9cnx8QSYmY3x8VC5sZW5ndGg+MCxxPVtSXTtXJiZxLnVuc2hpZnQoTSk7Y29uc3QgSD1XP2B0aGlzLCR7SX1gOiIiLEs9Vz9gKCR7TX0ke0l9PSR7SX10eXBlb2YgZ2xvYmFsVGhpcyR7SX0hPT0ke0l9J3VuZGVmaW5lZCcke0l9PyR7SX1nbG9iYWxUaGlzJHtJfToke0l9JHtNfSR7SX18fCR7SX1zZWxmLCR7SX1gOiIiLFk9Vz8iKSI6IiIsWD1XP2Ake2F9dHlwZW9mIGV4cG9ydHMke0l9PT09JHtJfSdvYmplY3QnJHtJfSYmJHtJfXR5cGVvZiBtb2R1bGUke0l9IT09JHtJfSd1bmRlZmluZWQnJHtJfT8ke0l9JHtqfSR7Un0oJHtELmpvaW4oYCwke0l9YCl9KSR7SX06JHtOfWA6IiIsUT1gKCR7QyhxLHtpc0FzeW5jOiExLG5hbWU6bnVsbH0pfXske059YCtYK2Ake2F9dHlwZW9mICR7Rn0ke0l9PT09JHtJfSdmdW5jdGlvbicke0l9JiYke0l9JHtGfS5hbWQke0l9PyR7SX0ke0Z9KCR7en0ke1J9KSR7SX06JHtOfWArYCR7YX0ke0t9JHtHfSR7WX07JHtOfWArYH0pKCR7SH0oJHtDKFYse2lzQXN5bmM6ITEsbmFtZTpudWxsfSl9eyR7VX0ke059YCxaPU4rTisifSkpOyI7ZS5wcmVwZW5kKGAke2x9JHtIbyhzLEUseSx4LHYsdCxhLGQpfWApO2NvbnN0IEo9am8oaSxzLGMsRSxkLGEseSk7bGV0IGVlPVdvKGMmJnIsITA9PT1tfHwiaWYtZGVmYXVsdC1wcm9wIj09PW0mJm4sdixkKTtlZSYmKGVlPU4rTitlZSksZS5hcHBlbmQoYCR7Sn0ke2VlfSR7dX1gKS50cmltKCkuaW5kZW50KGEpLmFwcGVuZChaKS5wcmVwZW5kKFEpO319O2NvbnN0IGNhPShlLHQpPT50P2Ake2V9XG4ke3R9YDplLGhhPShlLHQpPT50P2Ake2V9XG5cbiR7dH1gOmU7YXN5bmMgZnVuY3Rpb24gdWEoZSx0LHMpe3RyeXtsZXRbaSxuLHIsb109YXdhaXQgUHJvbWlzZS5hbGwoW3QuaG9va1JlZHVjZVZhbHVlKCJiYW5uZXIiLGUuYmFubmVyKHMpLFtzXSxjYSksdC5ob29rUmVkdWNlVmFsdWUoImZvb3RlciIsZS5mb290ZXIocyksW3NdLGNhKSx0Lmhvb2tSZWR1Y2VWYWx1ZSgiaW50cm8iLGUuaW50cm8ocyksW3NdLGhhKSx0Lmhvb2tSZWR1Y2VWYWx1ZSgib3V0cm8iLGUub3V0cm8ocyksW3NdLGhhKV0pO3JldHVybiByJiYocis9IlxuXG4iKSxvJiYobz1gXG5cbiR7b31gKSxpJiYoaSs9IlxuIiksbiYmKG49IlxuIituKSx7YmFubmVyOmksZm9vdGVyOm4saW50cm86cixvdXRybzpvfX1jYXRjaChlKXtyZXR1cm4gWWUoKGk9ZS5tZXNzYWdlLG49ZS5ob29rLHI9ZS5wbHVnaW4se2NvZGU6UWUsbWVzc2FnZTpgQ291bGQgbm90IHJldHJpZXZlICIke259Ii4gQ2hlY2sgY29uZmlndXJhdGlvbiBvZiBwbHVnaW4gIiR7cn0iLlxuXHRFcnJvciBNZXNzYWdlOiAke2l9YH0pKX12YXIgaSxuLHI7fWNvbnN0IGRhPXthbWQ6bWEsY2pzOm1hLGVzOmZhLGlpZmU6bWEsc3lzdGVtOmZhLHVtZDptYX07ZnVuY3Rpb24gcGEoZSx0LHMsaSxuLHIsbyxhLGwsYyxoLHUsZCxwKXtjb25zdCBmPVsuLi5lXS5yZXZlcnNlKCk7Zm9yKGNvbnN0IGUgb2YgZillLnNjb3BlLmFkZFVzZWRPdXRzaWRlTmFtZXMoaSxuLHUsZCk7IWZ1bmN0aW9uKGUsdCxzKXtmb3IoY29uc3QgaSBvZiB0KXtmb3IoY29uc3QgdCBvZiBpLnNjb3BlLnZhcmlhYmxlcy52YWx1ZXMoKSl0LmluY2x1ZGVkJiYhKHQucmVuZGVyQmFzZU5hbWV8fHQgaW5zdGFuY2VvZiBybyYmdC5nZXRPcmlnaW5hbFZhcmlhYmxlKCkhPT10KSYmdC5zZXRSZW5kZXJOYW1lcyhudWxsLE9pKHQubmFtZSxlLHQuZm9yYmlkZGVuTmFtZXMpKTtpZihzLmhhcyhpKSl7Y29uc3QgdD1pLm5hbWVzcGFjZTt0LnNldFJlbmRlck5hbWVzKG51bGwsT2kodC5uYW1lLGUsdC5mb3JiaWRkZW5OYW1lcykpO319fShpLGYscCksZGFbbl0oaSxzLHQscixvLGEsbCxjLGgpO2Zvcihjb25zdCBlIG9mIGYpZS5zY29wZS5kZWNvbmZsaWN0KG4sdSxkKTt9ZnVuY3Rpb24gZmEoZSx0LHMsaSxuLHIsbyxhLGwpe2Zvcihjb25zdCB0IG9mIHMuZGVwZW5kZW5jaWVzKShufHx0IGluc3RhbmNlb2YgeikmJih0LnZhcmlhYmxlTmFtZT1PaSh0LnN1Z2dlc3RlZFZhcmlhYmxlTmFtZSxlLG51bGwpKTtmb3IoY29uc3QgcyBvZiB0KXtjb25zdCB0PXMubW9kdWxlLGk9cy5uYW1lO3MuaXNOYW1lc3BhY2UmJihufHx0IGluc3RhbmNlb2YgUXQpP3Muc2V0UmVuZGVyTmFtZXMobnVsbCwodCBpbnN0YW5jZW9mIFF0P2EuZ2V0KHQpOm8uZ2V0KHQpKS52YXJpYWJsZU5hbWUpOnQgaW5zdGFuY2VvZiBRdCYmImRlZmF1bHQiPT09aT9zLnNldFJlbmRlck5hbWVzKG51bGwsT2koWy4uLnQuZXhwb3J0ZWRWYXJpYWJsZXNdLnNvbWUoKChbZSx0XSk9PiIqIj09PXQmJmUuaW5jbHVkZWQpKT90LnN1Z2dlc3RlZFZhcmlhYmxlTmFtZSsiX19kZWZhdWx0Ijp0LnN1Z2dlc3RlZFZhcmlhYmxlTmFtZSxlLHMuZm9yYmlkZGVuTmFtZXMpKTpzLnNldFJlbmRlck5hbWVzKG51bGwsT2koaSxlLHMuZm9yYmlkZGVuTmFtZXMpKTt9Zm9yKGNvbnN0IHQgb2YgbCl0LnNldFJlbmRlck5hbWVzKG51bGwsT2kodC5uYW1lLGUsdC5mb3JiaWRkZW5OYW1lcykpO31mdW5jdGlvbiBtYShlLHQse2RlY29uZmxpY3RlZERlZmF1bHQ6cyxkZWNvbmZsaWN0ZWROYW1lc3BhY2U6aSxkZXBlbmRlbmNpZXM6bn0scixvLGEsbCxjKXtmb3IoY29uc3QgdCBvZiBuKXQudmFyaWFibGVOYW1lPU9pKHQuc3VnZ2VzdGVkVmFyaWFibGVOYW1lLGUsbnVsbCk7Zm9yKGNvbnN0IHQgb2YgaSl0Lm5hbWVzcGFjZVZhcmlhYmxlTmFtZT1PaShgJHt0LnN1Z2dlc3RlZFZhcmlhYmxlTmFtZX1fX25hbWVzcGFjZWAsZSxudWxsKTtmb3IoY29uc3QgdCBvZiBzKXQuZGVmYXVsdFZhcmlhYmxlTmFtZT1pLmhhcyh0KSYmYnIocih0LmlkKSxhKT90Lm5hbWVzcGFjZVZhcmlhYmxlTmFtZTpPaShgJHt0LnN1Z2dlc3RlZFZhcmlhYmxlTmFtZX1fX2RlZmF1bHRgLGUsbnVsbCk7Zm9yKGNvbnN0IGUgb2YgdCl7Y29uc3QgdD1lLm1vZHVsZTtpZih0IGluc3RhbmNlb2YgUXQpe2NvbnN0IHM9Yy5nZXQodCksaT1lLm5hbWU7aWYoImRlZmF1bHQiPT09aSl7Y29uc3QgaT1yKHQuaWQpLG49eXJbaV0/cy5kZWZhdWx0VmFyaWFibGVOYW1lOnMudmFyaWFibGVOYW1lO3hyKGksYSk/ZS5zZXRSZW5kZXJOYW1lcyhuLCJkZWZhdWx0Iik6ZS5zZXRSZW5kZXJOYW1lcyhudWxsLG4pO31lbHNlICIqIj09PWk/ZS5zZXRSZW5kZXJOYW1lcyhudWxsLEVyW3IodC5pZCldP3MubmFtZXNwYWNlVmFyaWFibGVOYW1lOnMudmFyaWFibGVOYW1lKTplLnNldFJlbmRlck5hbWVzKHMudmFyaWFibGVOYW1lLG51bGwpO31lbHNlIHtjb25zdCBzPWwuZ2V0KHQpO28mJmUuaXNOYW1lc3BhY2U/ZS5zZXRSZW5kZXJOYW1lcyhudWxsLCJkZWZhdWx0Ij09PXMuZXhwb3J0TW9kZT9zLm5hbWVzcGFjZVZhcmlhYmxlTmFtZTpzLnZhcmlhYmxlTmFtZSk6ImRlZmF1bHQiPT09cy5leHBvcnRNb2RlP2Uuc2V0UmVuZGVyTmFtZXMobnVsbCxzLnZhcmlhYmxlTmFtZSk6ZS5zZXRSZW5kZXJOYW1lcyhzLnZhcmlhYmxlTmFtZSxzLmdldFZhcmlhYmxlRXhwb3J0TmFtZShlKSk7fX19ZnVuY3Rpb24gZ2EoZSx7ZXhwb3J0czp0LG5hbWU6cyxmb3JtYXQ6aX0sbixyKXtjb25zdCBvPWUuZ2V0RXhwb3J0TmFtZXMoKTtpZigiZGVmYXVsdCI9PT10KXtpZigxIT09by5sZW5ndGh8fCJkZWZhdWx0IiE9PW9bMF0pcmV0dXJuIFllKEJ0KCJkZWZhdWx0IixvLG4pKX1lbHNlIGlmKCJub25lIj09PXQmJm8ubGVuZ3RoPjApcmV0dXJuIFllKEJ0KCJub25lIixvLG4pKTtyZXR1cm4gImF1dG8iPT09dCYmKDA9PT1vLmxlbmd0aD90PSJub25lIjoxPT09by5sZW5ndGgmJiJkZWZhdWx0Ij09PW9bMF0/dD0iZGVmYXVsdCI6KCJlcyIhPT1pJiYic3lzdGVtIiE9PWkmJm8uaW5jbHVkZXMoImRlZmF1bHQiKSYmcih2ZSxmdW5jdGlvbihlLHQpe3JldHVybiB7Y29kZTp2dCxpZDplLG1lc3NhZ2U6YEVudHJ5IG1vZHVsZSAiJHtMKGUpfSIgaXMgdXNpbmcgbmFtZWQgYW5kIGRlZmF1bHQgZXhwb3J0cyB0b2dldGhlci4gQ29uc3VtZXJzIG9mIHlvdXIgYnVuZGxlIHdpbGwgaGF2ZSB0byB1c2UgXGAke3R8fCJjaHVuayJ9LmRlZmF1bHRcYCB0byBhY2Nlc3MgdGhlIGRlZmF1bHQgZXhwb3J0LCB3aGljaCBtYXkgbm90IGJlIHdoYXQgeW91IHdhbnQuIFVzZSBcYG91dHB1dC5leHBvcnRzOiAibmFtZWQiXGAgdG8gZGlzYWJsZSB0aGlzIHdhcm5pbmcuYCx1cmw6TWUoVmUpfX0obixzKSksdD0ibmFtZWQiKSksdH1mdW5jdGlvbiB5YShlKXtjb25zdCB0PWUuc3BsaXQoIlxuIikscz10LmZpbHRlcigoZT0+L15cdCsvLnRlc3QoZSkpKSxpPXQuZmlsdGVyKChlPT4vXiB7Mix9Ly50ZXN0KGUpKSk7aWYoMD09PXMubGVuZ3RoJiYwPT09aS5sZW5ndGgpcmV0dXJuIG51bGw7aWYocy5sZW5ndGg+PWkubGVuZ3RoKXJldHVybiAiXHQiO2NvbnN0IG49aS5yZWR1Y2UoKChlLHQpPT57Y29uc3Qgcz0vXiArLy5leGVjKHQpWzBdLmxlbmd0aDtyZXR1cm4gTWF0aC5taW4ocyxlKX0pLDEvMCk7cmV0dXJuICIgIi5yZXBlYXQobil9ZnVuY3Rpb24geGEoZSx0LHMsaSxuLHIpe2NvbnN0IG89ZS5nZXREZXBlbmRlbmNpZXNUb0JlSW5jbHVkZWQoKTtmb3IoY29uc3QgZSBvZiBvKXtpZihlIGluc3RhbmNlb2YgUXQpe3QucHVzaChyLmdldChlKSk7Y29udGludWV9Y29uc3Qgbz1uLmdldChlKTtvPT09aT9zLmhhcyhlKXx8KHMuYWRkKGUpLHhhKGUsdCxzLGksbixyKSk6dC5wdXNoKG8pO319Y29uc3QgRWE9IiF+eyIsYmE9In1+Iix2YT1uZXcgUmVnRXhwKGAke0VhfVswLTlhLXpBLVpfJF17MSw1OX0ke2JhfWAsImciKSxTYT0oZSx0KT0+ZS5yZXBsYWNlKHZhLChlPT50LmdldChlKXx8ZSkpLEFhPShlLHQscyk9PmUucmVwbGFjZSh2YSwoZT0+ZT09PXQ/czplKSksa2E9KGUsdCk9Pntjb25zdCBzPW5ldyBTZXQsaT1lLnJlcGxhY2UodmEsKGU9PnQuaGFzKGUpPyhzLmFkZChlKSxgJHtFYX0keyIwIi5yZXBlYXQoZS5sZW5ndGgtNSl9JHtiYX1gKTplKSk7cmV0dXJuIHtjb250YWluZWRQbGFjZWhvbGRlcnM6cyx0cmFuc2Zvcm1lZENvZGU6aX19LElhPVN5bWJvbCgiYnVuZGxlS2V5cyIpLHdhPXt0eXBlOiJwbGFjZWhvbGRlciJ9O2Z1bmN0aW9uIFBhKGUsdCxzKXtyZXR1cm4gVChlKT9ZZShLdChgSW52YWxpZCBwYXR0ZXJuICIke2V9IiBmb3IgIiR7dH0iLCBwYXR0ZXJucyBjYW4gYmUgbmVpdGhlciBhYnNvbHV0ZSBub3IgcmVsYXRpdmUgcGF0aHMuIElmIHlvdSB3YW50IHlvdXIgZmlsZXMgdG8gYmUgc3RvcmVkIGluIGEgc3ViZGlyZWN0b3J5LCB3cml0ZSBpdHMgbmFtZSB3aXRob3V0IGEgbGVhZGluZyBzbGFzaCBsaWtlIHRoaXM6IHN1YmRpcmVjdG9yeS9wYXR0ZXJuLmApKTplLnJlcGxhY2UoL1xbKFx3KykoOlxkKyk/XS9nLCgoZSxpLG4pPT57aWYoIXMuaGFzT3duUHJvcGVydHkoaSl8fG4mJiJoYXNoIiE9PWkpcmV0dXJuIFllKEt0KGAiWyR7aX0ke258fCIifV0iIGlzIG5vdCBhIHZhbGlkIHBsYWNlaG9sZGVyIGluIHRoZSAiJHt0fSIgcGF0dGVybi5gKSk7Y29uc3Qgcj1zW2ldKG4mJk51bWJlci5wYXJzZUludChuLnNsaWNlKDEpKSk7cmV0dXJuIFQocik/WWUoS3QoYEludmFsaWQgc3Vic3RpdHV0aW9uICIke3J9IiBmb3IgcGxhY2Vob2xkZXIgIlske2l9XSIgaW4gIiR7dH0iIHBhdHRlcm4sIGNhbiBiZSBuZWl0aGVyIGFic29sdXRlIG5vciByZWxhdGl2ZSBwYXRoLmApKTpyfSkpfWZ1bmN0aW9uIENhKGUse1tJYV06dH0pe2lmKCF0LmhhcyhlLnRvTG93ZXJDYXNlKCkpKXJldHVybiBlO2NvbnN0IHM9QyhlKTtlPWUuc2xpY2UoMCxNYXRoLm1heCgwLGUubGVuZ3RoLXMubGVuZ3RoKSk7bGV0IGksbj0xO2Zvcig7dC5oYXMoKGk9ZSsgKytuK3MpLnRvTG93ZXJDYXNlKCkpOyk7cmV0dXJuIGl9Y29uc3QgJGE9bmV3IFNldChbIi5qcyIsIi5qc3giLCIudHMiLCIudHN4IiwiLm1qcyIsIi5tdHMiLCIuY2pzIiwiLmN0cyJdKTtmdW5jdGlvbiBOYShlLHQscyxpKXtjb25zdCBuPSJmdW5jdGlvbiI9PXR5cGVvZiB0P3QoZS5pZCk6dFtlLmlkXTtyZXR1cm4gbnx8KHM/KGkodmUsKHI9ZS5pZCxvPWUudmFyaWFibGVOYW1lLHtjb2RlOmd0LGlkOnIsbWVzc2FnZTpgTm8gbmFtZSB3YXMgcHJvdmlkZWQgZm9yIGV4dGVybmFsIG1vZHVsZSAiJHtyfSIgaW4gIm91dHB1dC5nbG9iYWxzIiDigJMgZ3Vlc3NpbmcgIiR7b30iLmAsbmFtZXM6W29dLHVybDpNZShqZSl9KSksZS52YXJpYWJsZU5hbWUpOnZvaWQgMCk7dmFyIHIsbzt9Y2xhc3MgX2F7Y29uc3RydWN0b3IoZSx0LHMsaSxuLHIsbyxhLGwsYyxoLHUsZCxwLGYpe3RoaXMub3JkZXJlZE1vZHVsZXM9ZSx0aGlzLmlucHV0T3B0aW9ucz10LHRoaXMub3V0cHV0T3B0aW9ucz1zLHRoaXMudW5zZXRPcHRpb25zPWksdGhpcy5wbHVnaW5Ecml2ZXI9bix0aGlzLm1vZHVsZXNCeUlkPXIsdGhpcy5jaHVua0J5TW9kdWxlPW8sdGhpcy5leHRlcm5hbENodW5rQnlNb2R1bGU9YSx0aGlzLmZhY2FkZUNodW5rQnlNb2R1bGU9bCx0aGlzLmluY2x1ZGVkTmFtZXNwYWNlcz1jLHRoaXMubWFudWFsQ2h1bmtBbGlhcz1oLHRoaXMuZ2V0UGxhY2Vob2xkZXI9dSx0aGlzLmJ1bmRsZT1kLHRoaXMuaW5wdXRCYXNlPXAsdGhpcy5zbmlwcGV0cz1mLHRoaXMuZW50cnlNb2R1bGVzPVtdLHRoaXMuZXhwb3J0TW9kZT0ibmFtZWQiLHRoaXMuZmFjYWRlTW9kdWxlPW51bGwsdGhpcy5uYW1lc3BhY2VWYXJpYWJsZU5hbWU9IiIsdGhpcy52YXJpYWJsZU5hbWU9IiIsdGhpcy5hY2Nlc3NlZEdsb2JhbHNCeVNjb3BlPW5ldyBNYXAsdGhpcy5kZXBlbmRlbmNpZXM9bmV3IFNldCx0aGlzLmR5bmFtaWNFbnRyeU1vZHVsZXM9W10sdGhpcy5keW5hbWljTmFtZT1udWxsLHRoaXMuZXhwb3J0TmFtZXNCeVZhcmlhYmxlPW5ldyBNYXAsdGhpcy5leHBvcnRzPW5ldyBTZXQsdGhpcy5leHBvcnRzQnlOYW1lPW5ldyBNYXAsdGhpcy5maWxlTmFtZT1udWxsLHRoaXMuaW1wbGljaXRFbnRyeU1vZHVsZXM9W10sdGhpcy5pbXBsaWNpdGx5TG9hZGVkQmVmb3JlPW5ldyBTZXQsdGhpcy5pbXBvcnRzPW5ldyBTZXQsdGhpcy5pbmNsdWRlZER5bmFtaWNJbXBvcnRzPW51bGwsdGhpcy5pbmNsdWRlZFJlZXhwb3J0c0J5TW9kdWxlPW5ldyBNYXAsdGhpcy5pc0VtcHR5PSEwLHRoaXMubmFtZT1udWxsLHRoaXMubmVlZHNFeHBvcnRzU2hpbT0hMSx0aGlzLnByZVJlbmRlcmVkQ2h1bmtJbmZvPW51bGwsdGhpcy5wcmVsaW1pbmFyeUZpbGVOYW1lPW51bGwsdGhpcy5yZW5kZXJlZENodW5rSW5mbz1udWxsLHRoaXMucmVuZGVyZWREZXBlbmRlbmNpZXM9bnVsbCx0aGlzLnJlbmRlcmVkTW9kdWxlcz1PYmplY3QuY3JlYXRlKG51bGwpLHRoaXMuc29ydGVkRXhwb3J0TmFtZXM9bnVsbCx0aGlzLnN0cmljdEZhY2FkZT0hMSx0aGlzLmV4ZWNJbmRleD1lLmxlbmd0aD4wP2VbMF0uZXhlY0luZGV4OjEvMDtjb25zdCBtPW5ldyBTZXQoZSk7Zm9yKGNvbnN0IHQgb2YgZSl7by5zZXQodCx0aGlzKSx0Lm5hbWVzcGFjZS5pbmNsdWRlZCYmIXMucHJlc2VydmVNb2R1bGVzJiZjLmFkZCh0KSx0aGlzLmlzRW1wdHkmJnQuaXNJbmNsdWRlZCgpJiYodGhpcy5pc0VtcHR5PSExKSwodC5pbmZvLmlzRW50cnl8fHMucHJlc2VydmVNb2R1bGVzKSYmdGhpcy5lbnRyeU1vZHVsZXMucHVzaCh0KTtmb3IoY29uc3QgZSBvZiB0LmluY2x1ZGVkRHluYW1pY0ltcG9ydGVycyltLmhhcyhlKXx8KHRoaXMuZHluYW1pY0VudHJ5TW9kdWxlcy5wdXNoKHQpLHQuaW5mby5zeW50aGV0aWNOYW1lZEV4cG9ydHMmJihjLmFkZCh0KSx0aGlzLmV4cG9ydHMuYWRkKHQubmFtZXNwYWNlKSkpO3QuaW1wbGljaXRseUxvYWRlZEFmdGVyLnNpemU+MCYmdGhpcy5pbXBsaWNpdEVudHJ5TW9kdWxlcy5wdXNoKHQpO310aGlzLnN1Z2dlc3RlZFZhcmlhYmxlTmFtZT1iZSh0aGlzLmdlbmVyYXRlVmFyaWFibGVOYW1lKCkpO31zdGF0aWMgZ2VuZXJhdGVGYWNhZGUoZSx0LHMsaSxuLHIsbyxhLGwsYyxoLHUsZCxwLGYpe2NvbnN0IG09bmV3IF9hKFtdLGUsdCxzLGksbixyLG8sYSxsLG51bGwsdSxkLHAsZik7bS5hc3NpZ25GYWNhZGVOYW1lKGgsYyksYS5oYXMoYyl8fGEuc2V0KGMsbSk7Zm9yKGNvbnN0IGUgb2YgYy5nZXREZXBlbmRlbmNpZXNUb0JlSW5jbHVkZWQoKSltLmRlcGVuZGVuY2llcy5hZGQoZSBpbnN0YW5jZW9mIFRvP3IuZ2V0KGUpOm8uZ2V0KGUpKTtyZXR1cm4gIW0uZGVwZW5kZW5jaWVzLmhhcyhyLmdldChjKSkmJmMuaW5mby5tb2R1bGVTaWRlRWZmZWN0cyYmYy5oYXNFZmZlY3RzKCkmJm0uZGVwZW5kZW5jaWVzLmFkZChyLmdldChjKSksbS5lbnN1cmVSZWV4cG9ydHNBcmVBdmFpbGFibGVGb3JNb2R1bGUoYyksbS5mYWNhZGVNb2R1bGU9YyxtLnN0cmljdEZhY2FkZT0hMCxtfWNhbk1vZHVsZUJlRmFjYWRlKGUsdCl7Y29uc3Qgcz1lLmdldEV4cG9ydE5hbWVzQnlWYXJpYWJsZSgpO2Zvcihjb25zdCBlIG9mIHRoaXMuZXhwb3J0cylpZighcy5oYXMoZSkpcmV0dXJuICExO2Zvcihjb25zdCBpIG9mIHQpaWYoIShpLm1vZHVsZT09PWV8fHMuaGFzKGkpfHxpIGluc3RhbmNlb2YgZm8mJnMuaGFzKGkuZ2V0QmFzZVZhcmlhYmxlKCkpKSlyZXR1cm4gITE7cmV0dXJuICEwfWZpbmFsaXplQ2h1bmsoZSx0LHMpe2NvbnN0IGk9dGhpcy5nZXRSZW5kZXJlZENodW5rSW5mbygpLG49ZT0+U2EoZSxzKSxyPWkuZmlsZU5hbWUsbz10aGlzLmZpbGVOYW1lPW4ocik7cmV0dXJuIHsuLi5pLGNvZGU6ZSxkeW5hbWljSW1wb3J0czppLmR5bmFtaWNJbXBvcnRzLm1hcChuKSxmaWxlTmFtZTpvLGltcGxpY2l0bHlMb2FkZWRCZWZvcmU6aS5pbXBsaWNpdGx5TG9hZGVkQmVmb3JlLm1hcChuKSxpbXBvcnRlZEJpbmRpbmdzOk9iamVjdC5mcm9tRW50cmllcyhPYmplY3QuZW50cmllcyhpLmltcG9ydGVkQmluZGluZ3MpLm1hcCgoKFtlLHRdKT0+W24oZSksdF0pKSksaW1wb3J0czppLmltcG9ydHMubWFwKG4pLG1hcDp0LHByZWxpbWluYXJ5RmlsZU5hbWU6cixyZWZlcmVuY2VkRmlsZXM6aS5yZWZlcmVuY2VkRmlsZXMubWFwKG4pfX1nZW5lcmF0ZUV4cG9ydHMoKXt0aGlzLnNvcnRlZEV4cG9ydE5hbWVzPW51bGw7Y29uc3QgZT1uZXcgU2V0KHRoaXMuZXhwb3J0cyk7aWYobnVsbCE9PXRoaXMuZmFjYWRlTW9kdWxlJiYoITEhPT10aGlzLmZhY2FkZU1vZHVsZS5wcmVzZXJ2ZVNpZ25hdHVyZXx8dGhpcy5zdHJpY3RGYWNhZGUpKXtjb25zdCB0PXRoaXMuZmFjYWRlTW9kdWxlLmdldEV4cG9ydE5hbWVzQnlWYXJpYWJsZSgpO2Zvcihjb25zdFtzLGldb2YgdCl7dGhpcy5leHBvcnROYW1lc0J5VmFyaWFibGUuc2V0KHMsWy4uLmldKTtmb3IoY29uc3QgZSBvZiBpKXRoaXMuZXhwb3J0c0J5TmFtZS5zZXQoZSxzKTtlLmRlbGV0ZShzKTt9fXRoaXMub3V0cHV0T3B0aW9ucy5taW5pZnlJbnRlcm5hbEV4cG9ydHM/ZnVuY3Rpb24oZSx0LHMpe2xldCBpPTA7Zm9yKGNvbnN0IG4gb2YgZSl7bGV0W2VdPW4ubmFtZTtpZih0LmhhcyhlKSlkb3tlPU1pKCsraSksNDk9PT1lLmNoYXJDb2RlQXQoMCkmJihpKz05KjY0KiooZS5sZW5ndGgtMSksZT1NaShpKSk7fXdoaWxlKHllLmhhcyhlKXx8dC5oYXMoZSkpO3Quc2V0KGUsbikscy5zZXQobixbZV0pO319KGUsdGhpcy5leHBvcnRzQnlOYW1lLHRoaXMuZXhwb3J0TmFtZXNCeVZhcmlhYmxlKTpmdW5jdGlvbihlLHQscyl7Zm9yKGNvbnN0IGkgb2YgZSl7bGV0IGU9MCxuPWkubmFtZTtmb3IoO3QuaGFzKG4pOyluPWkubmFtZSsiJCIrICsrZTt0LnNldChuLGkpLHMuc2V0KGksW25dKTt9fShlLHRoaXMuZXhwb3J0c0J5TmFtZSx0aGlzLmV4cG9ydE5hbWVzQnlWYXJpYWJsZSksKHRoaXMub3V0cHV0T3B0aW9ucy5wcmVzZXJ2ZU1vZHVsZXN8fHRoaXMuZmFjYWRlTW9kdWxlJiZ0aGlzLmZhY2FkZU1vZHVsZS5pbmZvLmlzRW50cnkpJiYodGhpcy5leHBvcnRNb2RlPWdhKHRoaXMsdGhpcy5vdXRwdXRPcHRpb25zLHRoaXMuZmFjYWRlTW9kdWxlLmlkLHRoaXMuaW5wdXRPcHRpb25zLm9uTG9nKSk7fWdlbmVyYXRlRmFjYWRlcygpe2NvbnN0IGU9W10sdD1uZXcgU2V0KFsuLi50aGlzLmVudHJ5TW9kdWxlcywuLi50aGlzLmltcGxpY2l0RW50cnlNb2R1bGVzXSkscz1uZXcgU2V0KHRoaXMuZHluYW1pY0VudHJ5TW9kdWxlcy5tYXAoKCh7bmFtZXNwYWNlOmV9KT0+ZSkpKTtmb3IoY29uc3QgZSBvZiB0KWlmKGUucHJlc2VydmVTaWduYXR1cmUpZm9yKGNvbnN0IHQgb2YgZS5nZXRFeHBvcnROYW1lc0J5VmFyaWFibGUoKS5rZXlzKCkpdGhpcy5jaHVua0J5TW9kdWxlLmdldCh0Lm1vZHVsZSk9PT10aGlzJiZzLmFkZCh0KTtmb3IoY29uc3QgaSBvZiB0KXtjb25zdCB0PUFycmF5LmZyb20obmV3IFNldChpLmNodW5rTmFtZXMuZmlsdGVyKCgoe2lzVXNlckRlZmluZWQ6ZX0pPT5lKSkubWFwKCgoe25hbWU6ZX0pPT5lKSkpLChlPT4oe25hbWU6ZX0pKSk7aWYoMD09PXQubGVuZ3RoJiZpLmlzVXNlckRlZmluZWRFbnRyeVBvaW50JiZ0LnB1c2goe30pLHQucHVzaCguLi5BcnJheS5mcm9tKGkuY2h1bmtGaWxlTmFtZXMsKGU9Pih7ZmlsZU5hbWU6ZX0pKSkpLDA9PT10Lmxlbmd0aCYmdC5wdXNoKHt9KSwhdGhpcy5mYWNhZGVNb2R1bGUpe2NvbnN0IGU9IXRoaXMub3V0cHV0T3B0aW9ucy5wcmVzZXJ2ZU1vZHVsZXMmJigic3RyaWN0Ij09PWkucHJlc2VydmVTaWduYXR1cmV8fCJleHBvcnRzLW9ubHkiPT09aS5wcmVzZXJ2ZVNpZ25hdHVyZSYmaS5nZXRFeHBvcnROYW1lc0J5VmFyaWFibGUoKS5zaXplPjApO2UmJiF0aGlzLmNhbk1vZHVsZUJlRmFjYWRlKGkscyl8fCh0aGlzLmZhY2FkZU1vZHVsZT1pLHRoaXMuZmFjYWRlQ2h1bmtCeU1vZHVsZS5zZXQoaSx0aGlzKSxpLnByZXNlcnZlU2lnbmF0dXJlJiYodGhpcy5zdHJpY3RGYWNhZGU9ZSksdGhpcy5hc3NpZ25GYWNhZGVOYW1lKHQuc2hpZnQoKSxpLHRoaXMub3V0cHV0T3B0aW9ucy5wcmVzZXJ2ZU1vZHVsZXMpKTt9Zm9yKGNvbnN0IHMgb2YgdCllLnB1c2goX2EuZ2VuZXJhdGVGYWNhZGUodGhpcy5pbnB1dE9wdGlvbnMsdGhpcy5vdXRwdXRPcHRpb25zLHRoaXMudW5zZXRPcHRpb25zLHRoaXMucGx1Z2luRHJpdmVyLHRoaXMubW9kdWxlc0J5SWQsdGhpcy5jaHVua0J5TW9kdWxlLHRoaXMuZXh0ZXJuYWxDaHVua0J5TW9kdWxlLHRoaXMuZmFjYWRlQ2h1bmtCeU1vZHVsZSx0aGlzLmluY2x1ZGVkTmFtZXNwYWNlcyxpLHMsdGhpcy5nZXRQbGFjZWhvbGRlcix0aGlzLmJ1bmRsZSx0aGlzLmlucHV0QmFzZSx0aGlzLnNuaXBwZXRzKSk7fWZvcihjb25zdCBlIG9mIHRoaXMuZHluYW1pY0VudHJ5TW9kdWxlcyllLmluZm8uc3ludGhldGljTmFtZWRFeHBvcnRzfHwoIXRoaXMuZmFjYWRlTW9kdWxlJiZ0aGlzLmNhbk1vZHVsZUJlRmFjYWRlKGUscyk/KHRoaXMuZmFjYWRlTW9kdWxlPWUsdGhpcy5mYWNhZGVDaHVua0J5TW9kdWxlLnNldChlLHRoaXMpLHRoaXMuc3RyaWN0RmFjYWRlPSEwLHRoaXMuZHluYW1pY05hbWU9UmEoZSkpOnRoaXMuZmFjYWRlTW9kdWxlPT09ZSYmIXRoaXMuc3RyaWN0RmFjYWRlJiZ0aGlzLmNhbk1vZHVsZUJlRmFjYWRlKGUscyk/dGhpcy5zdHJpY3RGYWNhZGU9ITA6dGhpcy5mYWNhZGVDaHVua0J5TW9kdWxlLmdldChlKT8uc3RyaWN0RmFjYWRlfHwodGhpcy5pbmNsdWRlZE5hbWVzcGFjZXMuYWRkKGUpLHRoaXMuZXhwb3J0cy5hZGQoZS5uYW1lc3BhY2UpKSk7cmV0dXJuIHRoaXMub3V0cHV0T3B0aW9ucy5wcmVzZXJ2ZU1vZHVsZXN8fHRoaXMuYWRkTmVjZXNzYXJ5SW1wb3J0c0ZvckZhY2FkZXMoKSxlfWdldENodW5rTmFtZSgpe3JldHVybiB0aGlzLm5hbWU/Pyh0aGlzLm5hbWU9dGhpcy5vdXRwdXRPcHRpb25zLnNhbml0aXplRmlsZU5hbWUodGhpcy5nZXRGYWxsYmFja0NodW5rTmFtZSgpKSl9Z2V0RXhwb3J0TmFtZXMoKXtyZXR1cm4gdGhpcy5zb3J0ZWRFeHBvcnROYW1lcz8/KHRoaXMuc29ydGVkRXhwb3J0TmFtZXM9Wy4uLnRoaXMuZXhwb3J0c0J5TmFtZS5rZXlzKCldLnNvcnQoKSl9Z2V0RmlsZU5hbWUoKXtyZXR1cm4gdGhpcy5maWxlTmFtZXx8dGhpcy5nZXRQcmVsaW1pbmFyeUZpbGVOYW1lKCkuZmlsZU5hbWV9Z2V0SW1wb3J0UGF0aChlKXtyZXR1cm4gTyhCKGUsdGhpcy5nZXRGaWxlTmFtZSgpLCJhbWQiPT09dGhpcy5vdXRwdXRPcHRpb25zLmZvcm1hdCYmIXRoaXMub3V0cHV0T3B0aW9ucy5hbWQuZm9yY2VKc0V4dGVuc2lvbkZvckltcG9ydHMsITApKX1nZXRQcmVsaW1pbmFyeUZpbGVOYW1lKCl7aWYodGhpcy5wcmVsaW1pbmFyeUZpbGVOYW1lKXJldHVybiB0aGlzLnByZWxpbWluYXJ5RmlsZU5hbWU7bGV0IGUsdD1udWxsO2NvbnN0e2NodW5rRmlsZU5hbWVzOnMsZW50cnlGaWxlTmFtZXM6aSxmaWxlOm4sZm9ybWF0OnIscHJlc2VydmVNb2R1bGVzOm99PXRoaXMub3V0cHV0T3B0aW9ucztpZihuKWU9dyhuKTtlbHNlIGlmKG51bGw9PT10aGlzLmZpbGVOYW1lKXtjb25zdFtuLGFdPW98fHRoaXMuZmFjYWRlTW9kdWxlPy5pc1VzZXJEZWZpbmVkRW50cnlQb2ludD9baSwib3V0cHV0LmVudHJ5RmlsZU5hbWVzIl06W3MsIm91dHB1dC5jaHVua0ZpbGVOYW1lcyJdO2U9UGEoImZ1bmN0aW9uIj09dHlwZW9mIG4/bih0aGlzLmdldFByZVJlbmRlcmVkQ2h1bmtJbmZvKCkpOm4sYSx7Zm9ybWF0OigpPT5yLGhhc2g6ZT0+dHx8KHQ9dGhpcy5nZXRQbGFjZWhvbGRlcihhLGUpKSxuYW1lOigpPT50aGlzLmdldENodW5rTmFtZSgpfSksdHx8KGU9Q2EoZSx0aGlzLmJ1bmRsZSkpO31lbHNlIGU9dGhpcy5maWxlTmFtZTtyZXR1cm4gdHx8KHRoaXMuYnVuZGxlW2VdPXdhKSx0aGlzLnByZWxpbWluYXJ5RmlsZU5hbWU9e2ZpbGVOYW1lOmUsaGFzaFBsYWNlaG9sZGVyOnR9fWdldFJlbmRlcmVkQ2h1bmtJbmZvKCl7cmV0dXJuIHRoaXMucmVuZGVyZWRDaHVua0luZm8/dGhpcy5yZW5kZXJlZENodW5rSW5mbzp0aGlzLnJlbmRlcmVkQ2h1bmtJbmZvPXsuLi50aGlzLmdldFByZVJlbmRlcmVkQ2h1bmtJbmZvKCksZHluYW1pY0ltcG9ydHM6dGhpcy5nZXREeW5hbWljRGVwZW5kZW5jaWVzKCkubWFwKExhKSxmaWxlTmFtZTp0aGlzLmdldEZpbGVOYW1lKCksaW1wbGljaXRseUxvYWRlZEJlZm9yZTpBcnJheS5mcm9tKHRoaXMuaW1wbGljaXRseUxvYWRlZEJlZm9yZSxMYSksaW1wb3J0ZWRCaW5kaW5nczpPYSh0aGlzLmdldFJlbmRlcmVkRGVwZW5kZW5jaWVzKCksTGEpLGltcG9ydHM6QXJyYXkuZnJvbSh0aGlzLmRlcGVuZGVuY2llcyxMYSksbW9kdWxlczp0aGlzLnJlbmRlcmVkTW9kdWxlcyxyZWZlcmVuY2VkRmlsZXM6dGhpcy5nZXRSZWZlcmVuY2VkRmlsZXMoKX19Z2V0VmFyaWFibGVFeHBvcnROYW1lKGUpe3JldHVybiB0aGlzLm91dHB1dE9wdGlvbnMucHJlc2VydmVNb2R1bGVzJiZlIGluc3RhbmNlb2YgcG8/IioiOnRoaXMuZXhwb3J0TmFtZXNCeVZhcmlhYmxlLmdldChlKVswXX1saW5rKCl7dGhpcy5kZXBlbmRlbmNpZXM9ZnVuY3Rpb24oZSx0LHMsaSl7Y29uc3Qgbj1bXSxyPW5ldyBTZXQ7Zm9yKGxldCBvPXQubGVuZ3RoLTE7bz49MDtvLS0pe2NvbnN0IGE9dFtvXTtpZighci5oYXMoYSkpe2NvbnN0IHQ9W107eGEoYSx0LHIsZSxzLGkpLG4udW5zaGlmdCh0KTt9fWNvbnN0IG89bmV3IFNldDtmb3IoY29uc3QgZSBvZiBuKWZvcihjb25zdCB0IG9mIGUpby5hZGQodCk7cmV0dXJuIG99KHRoaXMsdGhpcy5vcmRlcmVkTW9kdWxlcyx0aGlzLmNodW5rQnlNb2R1bGUsdGhpcy5leHRlcm5hbENodW5rQnlNb2R1bGUpO2Zvcihjb25zdCBlIG9mIHRoaXMub3JkZXJlZE1vZHVsZXMpdGhpcy5hZGRJbXBsaWNpdGx5TG9hZGVkQmVmb3JlRnJvbU1vZHVsZShlKSx0aGlzLnNldFVwQ2h1bmtJbXBvcnRzQW5kRXhwb3J0c0Zvck1vZHVsZShlKTt9YXN5bmMgcmVuZGVyKCl7Y29uc3R7ZGVwZW5kZW5jaWVzOmUsZXhwb3J0TW9kZTp0LGZhY2FkZU1vZHVsZTpzLGlucHV0T3B0aW9uczp7b25Mb2c6aX0sb3V0cHV0T3B0aW9uczpuLHBsdWdpbkRyaXZlcjpyLHNuaXBwZXRzOm99PXRoaXMse2Zvcm1hdDphLGhvaXN0VHJhbnNpdGl2ZUltcG9ydHM6bCxwcmVzZXJ2ZU1vZHVsZXM6Y309bjtpZihsJiYhYyYmbnVsbCE9PXMpZm9yKGNvbnN0IHQgb2YgZSl0IGluc3RhbmNlb2YgX2EmJnRoaXMuaW5saW5lQ2h1bmtEZXBlbmRlbmNpZXModCk7Y29uc3QgaD10aGlzLmdldFByZWxpbWluYXJ5RmlsZU5hbWUoKSx7YWNjZXNzZWRHbG9iYWxzOnUsaW5kZW50OmQsbWFnaWNTdHJpbmc6cCxyZW5kZXJlZFNvdXJjZTpmLHVzZWRNb2R1bGVzOm0sdXNlc1RvcExldmVsQXdhaXQ6Z309dGhpcy5yZW5kZXJNb2R1bGVzKGguZmlsZU5hbWUpLHk9Wy4uLnRoaXMuZ2V0UmVuZGVyZWREZXBlbmRlbmNpZXMoKS52YWx1ZXMoKV0seD0ibm9uZSI9PT10P1tdOnRoaXMuZ2V0Q2h1bmtFeHBvcnREZWNsYXJhdGlvbnMoYSk7bGV0IEU9eC5sZW5ndGg+MCxiPSExO2Zvcihjb25zdCBlIG9mIHkpe2NvbnN0e3JlZXhwb3J0czp0fT1lO3Q/Lmxlbmd0aCYmKEU9ITAsIWImJnQuc29tZSgoZT0+ImRlZmF1bHQiPT09ZS5yZWV4cG9ydGVkKSkmJihiPSEwKSwiZXMiPT09YSYmKGUucmVleHBvcnRzPXQuZmlsdGVyKCgoe3JlZXhwb3J0ZWQ6ZX0pPT4heC5maW5kKCgoe2V4cG9ydGVkOnR9KT0+dD09PWUpKSkpKSk7fWlmKCFiKWZvcihjb25zdHtleHBvcnRlZDplfW9mIHgpaWYoImRlZmF1bHQiPT09ZSl7Yj0hMDticmVha31jb25zdHtpbnRybzp2LG91dHJvOlMsYmFubmVyOkEsZm9vdGVyOmt9PWF3YWl0IHVhKG4scix0aGlzLmdldFJlbmRlcmVkQ2h1bmtJbmZvKCkpO3JldHVybiBsYVthXShmLHthY2Nlc3NlZEdsb2JhbHM6dSxkZXBlbmRlbmNpZXM6eSxleHBvcnRzOngsaGFzRGVmYXVsdEV4cG9ydDpiLGhhc0V4cG9ydHM6RSxpZDpoLmZpbGVOYW1lLGluZGVudDpkLGludHJvOnYsaXNFbnRyeUZhY2FkZTpjfHxudWxsIT09cyYmcy5pbmZvLmlzRW50cnksaXNNb2R1bGVGYWNhZGU6bnVsbCE9PXMsbG9nOmksbmFtZWRFeHBvcnRzTW9kZToiZGVmYXVsdCIhPT10LG91dHJvOlMsc25pcHBldHM6byx1c2VzVG9wTGV2ZWxBd2FpdDpnfSxuKSxBJiZwLnByZXBlbmQoQSksayYmcC5hcHBlbmQoaykse2NodW5rOnRoaXMsbWFnaWNTdHJpbmc6cCxwcmVsaW1pbmFyeUZpbGVOYW1lOmgsdXNlZE1vZHVsZXM6bX19YWRkSW1wbGljaXRseUxvYWRlZEJlZm9yZUZyb21Nb2R1bGUoZSl7Y29uc3R7Y2h1bmtCeU1vZHVsZTp0LGltcGxpY2l0bHlMb2FkZWRCZWZvcmU6c309dGhpcztmb3IoY29uc3QgaSBvZiBlLmltcGxpY2l0bHlMb2FkZWRCZWZvcmUpe2NvbnN0IGU9dC5nZXQoaSk7ZSYmZSE9PXRoaXMmJnMuYWRkKGUpO319YWRkTmVjZXNzYXJ5SW1wb3J0c0ZvckZhY2FkZXMoKXtmb3IoY29uc3RbZSx0XW9mIHRoaXMuaW5jbHVkZWRSZWV4cG9ydHNCeU1vZHVsZSlpZih0aGlzLmluY2x1ZGVkTmFtZXNwYWNlcy5oYXMoZSkpZm9yKGNvbnN0IGUgb2YgdCl0aGlzLmltcG9ydHMuYWRkKGUpO31hc3NpZ25GYWNhZGVOYW1lKHtmaWxlTmFtZTplLG5hbWU6dH0scyxpKXtlP3RoaXMuZmlsZU5hbWU9ZTp0aGlzLm5hbWU9dGhpcy5vdXRwdXRPcHRpb25zLnNhbml0aXplRmlsZU5hbWUodHx8KGk/dGhpcy5nZXRQcmVzZXJ2ZU1vZHVsZXNDaHVua05hbWVGcm9tTW9kdWxlKHMpOlJhKHMpKSk7fWNoZWNrQ2lyY3VsYXJEZXBlbmRlbmN5SW1wb3J0KGUsdCl7Y29uc3Qgcz1lLm1vZHVsZTtpZihzIGluc3RhbmNlb2YgVG8pe2NvbnN0IGw9dGhpcy5jaHVua0J5TW9kdWxlLmdldChzKTtsZXQgYztkb3tpZihjPXQuYWx0ZXJuYXRpdmVSZWV4cG9ydE1vZHVsZXMuZ2V0KGUpLGMpe3RoaXMuY2h1bmtCeU1vZHVsZS5nZXQoYykhPT1sJiZ0aGlzLmlucHV0T3B0aW9ucy5vbkxvZyh2ZSwoaT1zLmdldEV4cG9ydE5hbWVzQnlWYXJpYWJsZSgpLmdldChlKT8uWzBdfHwiKiIsbj1zLmlkLHI9Yy5pZCxvPXQuaWQsYT10aGlzLm91dHB1dE9wdGlvbnMucHJlc2VydmVNb2R1bGVzLHtjb2RlOiJDWUNMSUNfQ1JPU1NfQ0hVTktfUkVFWFBPUlQiLGV4cG9ydGVyOm4saWQ6byxtZXNzYWdlOmBFeHBvcnQgIiR7aX0iIG9mIG1vZHVsZSAiJHtMKG4pfSIgd2FzIHJlZXhwb3J0ZWQgdGhyb3VnaCBtb2R1bGUgIiR7TChyKX0iIHdoaWxlIGJvdGggbW9kdWxlcyBhcmUgZGVwZW5kZW5jaWVzIG9mIGVhY2ggb3RoZXIgYW5kIHdpbGwgZW5kIHVwIGluIGRpZmZlcmVudCBjaHVua3MgYnkgY3VycmVudCBSb2xsdXAgc2V0dGluZ3MuIFRoaXMgc2NlbmFyaW8gaXMgbm90IHdlbGwgc3VwcG9ydGVkIGF0IHRoZSBtb21lbnQgYXMgaXQgd2lsbCBwcm9kdWNlIGEgY2lyY3VsYXIgZGVwZW5kZW5jeSBiZXR3ZWVuIGNodW5rcyBhbmQgd2lsbCBsaWtlbHkgbGVhZCB0byBicm9rZW4gZXhlY3V0aW9uIG9yZGVyLlxuRWl0aGVyIGNoYW5nZSB0aGUgaW1wb3J0IGluICIke0wobyl9IiB0byBwb2ludCBkaXJlY3RseSB0byB0aGUgZXhwb3J0aW5nIG1vZHVsZSBvciAke2E/J2RvIG5vdCB1c2UgIm91dHB1dC5wcmVzZXJ2ZU1vZHVsZXMiJzoncmVjb25maWd1cmUgIm91dHB1dC5tYW51YWxDaHVua3MiJ30gdG8gZW5zdXJlIHRoZXNlIG1vZHVsZXMgZW5kIHVwIGluIHRoZSBzYW1lIGNodW5rLmAscmVleHBvcnRlcjpyfSkpLHQ9Yzt9fXdoaWxlKGMpfXZhciBpLG4scixvLGE7fWVuc3VyZVJlZXhwb3J0c0FyZUF2YWlsYWJsZUZvck1vZHVsZShlKXtjb25zdCB0PVtdLHM9ZS5nZXRFeHBvcnROYW1lc0J5VmFyaWFibGUoKTtmb3IoY29uc3QgaSBvZiBzLmtleXMoKSl7Y29uc3Qgcz1pIGluc3RhbmNlb2YgZm8sbj1zP2kuZ2V0QmFzZVZhcmlhYmxlKCk6aTtpZih0aGlzLmNoZWNrQ2lyY3VsYXJEZXBlbmRlbmN5SW1wb3J0KG4sZSksIShuIGluc3RhbmNlb2YgcG8mJnRoaXMub3V0cHV0T3B0aW9ucy5wcmVzZXJ2ZU1vZHVsZXMpKXtjb25zdCBlPW4ubW9kdWxlO2lmKGUgaW5zdGFuY2VvZiBUbyl7Y29uc3QgaT10aGlzLmNodW5rQnlNb2R1bGUuZ2V0KGUpO2kmJmkhPT10aGlzJiYoaS5leHBvcnRzLmFkZChuKSx0LnB1c2gobikscyYmdGhpcy5pbXBvcnRzLmFkZChuKSk7fX19dC5sZW5ndGg+MCYmdGhpcy5pbmNsdWRlZFJlZXhwb3J0c0J5TW9kdWxlLnNldChlLHQpO31nZW5lcmF0ZVZhcmlhYmxlTmFtZSgpe2lmKHRoaXMubWFudWFsQ2h1bmtBbGlhcylyZXR1cm4gdGhpcy5tYW51YWxDaHVua0FsaWFzO2NvbnN0IGU9dGhpcy5lbnRyeU1vZHVsZXNbMF18fHRoaXMuaW1wbGljaXRFbnRyeU1vZHVsZXNbMF18fHRoaXMuZHluYW1pY0VudHJ5TW9kdWxlc1swXXx8dGhpcy5vcmRlcmVkTW9kdWxlc1t0aGlzLm9yZGVyZWRNb2R1bGVzLmxlbmd0aC0xXTtyZXR1cm4gZT9SYShlKToiY2h1bmsifWdldENodW5rRXhwb3J0RGVjbGFyYXRpb25zKGUpe2NvbnN0IHQ9W107Zm9yKGNvbnN0IHMgb2YgdGhpcy5nZXRFeHBvcnROYW1lcygpKXtpZigiKiI9PT1zWzBdKWNvbnRpbnVlO2NvbnN0IGk9dGhpcy5leHBvcnRzQnlOYW1lLmdldChzKTtpZighKGkgaW5zdGFuY2VvZiBmbykpe2NvbnN0IHQ9aS5tb2R1bGU7aWYodCl7Y29uc3QgaT10aGlzLmNodW5rQnlNb2R1bGUuZ2V0KHQpO2lmKGkhPT10aGlzKXtpZighaXx8ImVzIiE9PWUpY29udGludWU7Y29uc3QgdD10aGlzLnJlbmRlcmVkRGVwZW5kZW5jaWVzLmdldChpKTtpZighdCljb250aW51ZTtjb25zdHtpbXBvcnRzOm4scmVleHBvcnRzOnJ9PXQsbz1yPy5maW5kKCgoe3JlZXhwb3J0ZWQ6ZX0pPT5lPT09cykpLGE9bj8uZmluZCgoKHtpbXBvcnRlZDplfSk9PmU9PT1vPy5pbXBvcnRlZCkpO2lmKCFhKWNvbnRpbnVlfX19bGV0IG49bnVsbCxyPSExLG89aS5nZXROYW1lKHRoaXMuc25pcHBldHMuZ2V0UHJvcGVydHlBY2Nlc3MpO2lmKGkgaW5zdGFuY2VvZiBJaSl7Zm9yKGNvbnN0IGUgb2YgaS5kZWNsYXJhdGlvbnMpaWYoZS5wYXJlbnQgaW5zdGFuY2VvZiB0cnx8ZSBpbnN0YW5jZW9mIHNyJiZlLmRlY2xhcmF0aW9uIGluc3RhbmNlb2YgdHIpe3I9ITA7YnJlYWt9fWVsc2UgaSBpbnN0YW5jZW9mIGZvJiYobj1vLCJlcyI9PT1lJiYobz1pLnJlbmRlck5hbWUpKTt0LnB1c2goe2V4cG9ydGVkOnMsZXhwcmVzc2lvbjpuLGhvaXN0ZWQ6cixsb2NhbDpvfSk7fXJldHVybiB0fWdldERlcGVuZGVuY2llc1RvQmVEZWNvbmZsaWN0ZWQoZSx0LHMpe2NvbnN0IGk9bmV3IFNldCxuPW5ldyBTZXQscj1uZXcgU2V0O2Zvcihjb25zdCB0IG9mIFsuLi50aGlzLmV4cG9ydE5hbWVzQnlWYXJpYWJsZS5rZXlzKCksLi4udGhpcy5pbXBvcnRzXSlpZihlfHx0LmlzTmFtZXNwYWNlKXtjb25zdCBvPXQubW9kdWxlO2lmKG8gaW5zdGFuY2VvZiBRdCl7Y29uc3QgYT10aGlzLmV4dGVybmFsQ2h1bmtCeU1vZHVsZS5nZXQobyk7aS5hZGQoYSksZSYmKCJkZWZhdWx0Ij09PXQubmFtZT95cltzKG8uaWQpXSYmbi5hZGQoYSk6IioiPT09dC5uYW1lJiZFcltzKG8uaWQpXSYmci5hZGQoYSkpO31lbHNlIHtjb25zdCBzPXRoaXMuY2h1bmtCeU1vZHVsZS5nZXQobyk7cyE9PXRoaXMmJihpLmFkZChzKSxlJiYiZGVmYXVsdCI9PT1zLmV4cG9ydE1vZGUmJnQuaXNOYW1lc3BhY2UmJnIuYWRkKHMpKTt9fWlmKHQpZm9yKGNvbnN0IGUgb2YgdGhpcy5kZXBlbmRlbmNpZXMpaS5hZGQoZSk7cmV0dXJuIHtkZWNvbmZsaWN0ZWREZWZhdWx0Om4sZGVjb25mbGljdGVkTmFtZXNwYWNlOnIsZGVwZW5kZW5jaWVzOml9fWdldER5bmFtaWNEZXBlbmRlbmNpZXMoKXtyZXR1cm4gdGhpcy5nZXRJbmNsdWRlZER5bmFtaWNJbXBvcnRzKCkubWFwKChlPT5lLmZhY2FkZUNodW5rfHxlLmNodW5rfHxlLmV4dGVybmFsQ2h1bmt8fGUucmVzb2x1dGlvbikpLmZpbHRlcigoZT0+ZSE9PXRoaXMmJihlIGluc3RhbmNlb2YgX2F8fGUgaW5zdGFuY2VvZiB6KSkpfWdldER5bmFtaWNJbXBvcnRTdHJpbmdBbmRBc3NlcnRpb25zKGUsdCl7aWYoZSBpbnN0YW5jZW9mIFF0KXtjb25zdCBzPXRoaXMuZXh0ZXJuYWxDaHVua0J5TW9kdWxlLmdldChlKTtyZXR1cm4gW2AnJHtzLmdldEltcG9ydFBhdGgodCl9J2Ascy5nZXRJbXBvcnRBc3NlcnRpb25zKHRoaXMuc25pcHBldHMpXX1yZXR1cm4gW2V8fCIiLCJlcyI9PT10aGlzLm91dHB1dE9wdGlvbnMuZm9ybWF0JiZ0aGlzLm91dHB1dE9wdGlvbnMuZXh0ZXJuYWxJbXBvcnRBc3NlcnRpb25zfHxudWxsXX1nZXRGYWxsYmFja0NodW5rTmFtZSgpe3JldHVybiB0aGlzLm1hbnVhbENodW5rQWxpYXM/dGhpcy5tYW51YWxDaHVua0FsaWFzOnRoaXMuZHluYW1pY05hbWU/dGhpcy5keW5hbWljTmFtZTp0aGlzLmZpbGVOYW1lP0QodGhpcy5maWxlTmFtZSk6RCh0aGlzLm9yZGVyZWRNb2R1bGVzW3RoaXMub3JkZXJlZE1vZHVsZXMubGVuZ3RoLTFdLmlkKX1nZXRJbXBvcnRTcGVjaWZpZXJzKCl7Y29uc3R7aW50ZXJvcDplfT10aGlzLm91dHB1dE9wdGlvbnMsdD1uZXcgTWFwO2Zvcihjb25zdCBzIG9mIHRoaXMuaW1wb3J0cyl7Y29uc3QgaT1zLm1vZHVsZTtsZXQgbixyO2lmKGkgaW5zdGFuY2VvZiBRdCl7aWYobj10aGlzLmV4dGVybmFsQ2h1bmtCeU1vZHVsZS5nZXQoaSkscj1zLm5hbWUsImRlZmF1bHQiIT09ciYmIioiIT09ciYmImRlZmF1bHRPbmx5Ij09PWUoaS5pZCkpcmV0dXJuIFllKHF0KGkuaWQsciwhMSkpfWVsc2Ugbj10aGlzLmNodW5rQnlNb2R1bGUuZ2V0KGkpLHI9bi5nZXRWYXJpYWJsZUV4cG9ydE5hbWUocyk7RiQzKHQsbixVJDIpLnB1c2goe2ltcG9ydGVkOnIsbG9jYWw6cy5nZXROYW1lKHRoaXMuc25pcHBldHMuZ2V0UHJvcGVydHlBY2Nlc3MpfSk7fXJldHVybiB0fWdldEluY2x1ZGVkRHluYW1pY0ltcG9ydHMoKXtpZih0aGlzLmluY2x1ZGVkRHluYW1pY0ltcG9ydHMpcmV0dXJuIHRoaXMuaW5jbHVkZWREeW5hbWljSW1wb3J0cztjb25zdCBlPVtdO2Zvcihjb25zdCB0IG9mIHRoaXMub3JkZXJlZE1vZHVsZXMpZm9yKGNvbnN0e25vZGU6cyxyZXNvbHV0aW9uOml9b2YgdC5keW5hbWljSW1wb3J0cylzLmluY2x1ZGVkJiZlLnB1c2goaSBpbnN0YW5jZW9mIFRvP3tjaHVuazp0aGlzLmNodW5rQnlNb2R1bGUuZ2V0KGkpLGV4dGVybmFsQ2h1bms6bnVsbCxmYWNhZGVDaHVuazp0aGlzLmZhY2FkZUNodW5rQnlNb2R1bGUuZ2V0KGkpLG5vZGU6cyxyZXNvbHV0aW9uOml9OmkgaW5zdGFuY2VvZiBRdD97Y2h1bms6bnVsbCxleHRlcm5hbENodW5rOnRoaXMuZXh0ZXJuYWxDaHVua0J5TW9kdWxlLmdldChpKSxmYWNhZGVDaHVuazpudWxsLG5vZGU6cyxyZXNvbHV0aW9uOml9OntjaHVuazpudWxsLGV4dGVybmFsQ2h1bms6bnVsbCxmYWNhZGVDaHVuazpudWxsLG5vZGU6cyxyZXNvbHV0aW9uOml9KTtyZXR1cm4gdGhpcy5pbmNsdWRlZER5bmFtaWNJbXBvcnRzPWV9Z2V0UHJlUmVuZGVyZWRDaHVua0luZm8oKXtpZih0aGlzLnByZVJlbmRlcmVkQ2h1bmtJbmZvKXJldHVybiB0aGlzLnByZVJlbmRlcmVkQ2h1bmtJbmZvO2NvbnN0e2R5bmFtaWNFbnRyeU1vZHVsZXM6ZSxmYWNhZGVNb2R1bGU6dCxpbXBsaWNpdEVudHJ5TW9kdWxlczpzLG9yZGVyZWRNb2R1bGVzOml9PXRoaXM7cmV0dXJuIHRoaXMucHJlUmVuZGVyZWRDaHVua0luZm89e2V4cG9ydHM6dGhpcy5nZXRFeHBvcnROYW1lcygpLGZhY2FkZU1vZHVsZUlkOnQmJnQuaWQsaXNEeW5hbWljRW50cnk6ZS5sZW5ndGg+MCxpc0VudHJ5OiEhdD8uaW5mby5pc0VudHJ5LGlzSW1wbGljaXRFbnRyeTpzLmxlbmd0aD4wLG1vZHVsZUlkczppLm1hcCgoKHtpZDplfSk9PmUpKSxuYW1lOnRoaXMuZ2V0Q2h1bmtOYW1lKCksdHlwZToiY2h1bmsifX1nZXRQcmVzZXJ2ZU1vZHVsZXNDaHVua05hbWVGcm9tTW9kdWxlKGUpe2NvbnN0IHQ9TWEoZSk7aWYodClyZXR1cm4gdDtjb25zdHtwcmVzZXJ2ZU1vZHVsZXNSb290OnMsc2FuaXRpemVGaWxlTmFtZTppfT10aGlzLm91dHB1dE9wdGlvbnMsbj1pKEkoZS5pZC5zcGxpdChEYSwxKVswXSkpLHI9QyhuKSxvPSRhLmhhcyhyKT9uLnNsaWNlKDAsLXIubGVuZ3RoKTpuO3JldHVybiBBKG8pP3MmJk4kNShvKS5zdGFydHNXaXRoKHMpP28uc2xpY2Uocy5sZW5ndGgpLnJlcGxhY2UoL15bL1xcXS8sIiIpOiQodGhpcy5pbnB1dEJhc2Usbyk6YF92aXJ0dWFsLyR7dyhvKX1gfWdldFJlZXhwb3J0U3BlY2lmaWVycygpe2NvbnN0e2V4dGVybmFsTGl2ZUJpbmRpbmdzOmUsaW50ZXJvcDp0fT10aGlzLm91dHB1dE9wdGlvbnMscz1uZXcgTWFwO2ZvcihsZXQgaSBvZiB0aGlzLmdldEV4cG9ydE5hbWVzKCkpe2xldCBuLHIsbz0hMTtpZigiKiI9PT1pWzBdKXtjb25zdCBzPWkuc2xpY2UoMSk7ImRlZmF1bHRPbmx5Ij09PXQocykmJnRoaXMuaW5wdXRPcHRpb25zLm9uTG9nKHZlLEh0KHMpKSxvPWUsbj10aGlzLmV4dGVybmFsQ2h1bmtCeU1vZHVsZS5nZXQodGhpcy5tb2R1bGVzQnlJZC5nZXQocykpLHI9aT0iKiI7fWVsc2Uge2NvbnN0IHM9dGhpcy5leHBvcnRzQnlOYW1lLmdldChpKTtpZihzIGluc3RhbmNlb2YgZm8pY29udGludWU7Y29uc3QgYT1zLm1vZHVsZTtpZihhIGluc3RhbmNlb2YgVG8pe2lmKG49dGhpcy5jaHVua0J5TW9kdWxlLmdldChhKSxuPT09dGhpcyljb250aW51ZTtyPW4uZ2V0VmFyaWFibGVFeHBvcnROYW1lKHMpLG89cy5pc1JlYXNzaWduZWQ7fWVsc2Uge2lmKG49dGhpcy5leHRlcm5hbENodW5rQnlNb2R1bGUuZ2V0KGEpLHI9cy5uYW1lLCJkZWZhdWx0IiE9PXImJiIqIiE9PXImJiJkZWZhdWx0T25seSI9PT10KGEuaWQpKXJldHVybiBZZShxdChhLmlkLHIsITApKTtvPWUmJigiZGVmYXVsdCIhPT1yfHx4cih0KGEuaWQpLCEwKSk7fX1GJDMocyxuLFUkMikucHVzaCh7aW1wb3J0ZWQ6cixuZWVkc0xpdmVCaW5kaW5nOm8scmVleHBvcnRlZDppfSk7fXJldHVybiBzfWdldFJlZmVyZW5jZWRGaWxlcygpe2NvbnN0IGU9bmV3IFNldDtmb3IoY29uc3QgdCBvZiB0aGlzLm9yZGVyZWRNb2R1bGVzKWZvcihjb25zdCBzIG9mIHQuaW1wb3J0TWV0YXMpe2NvbnN0IHQ9cy5nZXRSZWZlcmVuY2VkRmlsZU5hbWUodGhpcy5wbHVnaW5Ecml2ZXIpO3QmJmUuYWRkKHQpO31yZXR1cm4gWy4uLmVdfWdldFJlbmRlcmVkRGVwZW5kZW5jaWVzKCl7aWYodGhpcy5yZW5kZXJlZERlcGVuZGVuY2llcylyZXR1cm4gdGhpcy5yZW5kZXJlZERlcGVuZGVuY2llcztjb25zdCBlPXRoaXMuZ2V0SW1wb3J0U3BlY2lmaWVycygpLHQ9dGhpcy5nZXRSZWV4cG9ydFNwZWNpZmllcnMoKSxzPW5ldyBNYXAsaT10aGlzLmdldEZpbGVOYW1lKCk7Zm9yKGNvbnN0IG4gb2YgdGhpcy5kZXBlbmRlbmNpZXMpe2NvbnN0IHI9ZS5nZXQobil8fG51bGwsbz10LmdldChuKXx8bnVsbCxhPW4gaW5zdGFuY2VvZiB6fHwiZGVmYXVsdCIhPT1uLmV4cG9ydE1vZGUsbD1uLmdldEltcG9ydFBhdGgoaSk7cy5zZXQobix7YXNzZXJ0aW9uczpuIGluc3RhbmNlb2Ygej9uLmdldEltcG9ydEFzc2VydGlvbnModGhpcy5zbmlwcGV0cyk6bnVsbCxkZWZhdWx0VmFyaWFibGVOYW1lOm4uZGVmYXVsdFZhcmlhYmxlTmFtZSxnbG9iYWxOYW1lOm4gaW5zdGFuY2VvZiB6JiYoInVtZCI9PT10aGlzLm91dHB1dE9wdGlvbnMuZm9ybWF0fHwiaWlmZSI9PT10aGlzLm91dHB1dE9wdGlvbnMuZm9ybWF0KSYmTmEobix0aGlzLm91dHB1dE9wdGlvbnMuZ2xvYmFscyxudWxsIT09KHJ8fG8pLHRoaXMuaW5wdXRPcHRpb25zLm9uTG9nKSxpbXBvcnRQYXRoOmwsaW1wb3J0czpyLGlzQ2h1bms6biBpbnN0YW5jZW9mIF9hLG5hbWU6bi52YXJpYWJsZU5hbWUsbmFtZWRFeHBvcnRzTW9kZTphLG5hbWVzcGFjZVZhcmlhYmxlTmFtZTpuLm5hbWVzcGFjZVZhcmlhYmxlTmFtZSxyZWV4cG9ydHM6b30pO31yZXR1cm4gdGhpcy5yZW5kZXJlZERlcGVuZGVuY2llcz1zfWlubGluZUNodW5rRGVwZW5kZW5jaWVzKGUpe2Zvcihjb25zdCB0IG9mIGUuZGVwZW5kZW5jaWVzKXRoaXMuZGVwZW5kZW5jaWVzLmhhcyh0KXx8KHRoaXMuZGVwZW5kZW5jaWVzLmFkZCh0KSx0IGluc3RhbmNlb2YgX2EmJnRoaXMuaW5saW5lQ2h1bmtEZXBlbmRlbmNpZXModCkpO31yZW5kZXJNb2R1bGVzKGUpe2NvbnN0e2FjY2Vzc2VkR2xvYmFsc0J5U2NvcGU6dCxkZXBlbmRlbmNpZXM6cyxleHBvcnROYW1lc0J5VmFyaWFibGU6aSxpbmNsdWRlZE5hbWVzcGFjZXM6bixpbnB1dE9wdGlvbnM6e29uTG9nOnJ9LGlzRW1wdHk6byxvcmRlcmVkTW9kdWxlczphLG91dHB1dE9wdGlvbnM6aCxwbHVnaW5Ecml2ZXI6ZixyZW5kZXJlZE1vZHVsZXM6bSxzbmlwcGV0czp4fT10aGlzLHtjb21wYWN0OkUsZHluYW1pY0ltcG9ydEZ1bmN0aW9uOmIsZm9ybWF0OnYsZnJlZXplOlMsbmFtZXNwYWNlVG9TdHJpbmdUYWc6QX09aCx7XzprLGNuc3Q6SSxuOnd9PXg7dGhpcy5zZXREeW5hbWljSW1wb3J0UmVzb2x1dGlvbnMoZSksdGhpcy5zZXRJbXBvcnRNZXRhUmVzb2x1dGlvbnMoZSksdGhpcy5zZXRJZGVudGlmaWVyUmVuZGVyUmVzb2x1dGlvbnMoKTtjb25zdCBQPW5ldyBjbGFzcyBle2NvbnN0cnVjdG9yKGU9e30pe3RoaXMuaW50cm89ZS5pbnRyb3x8IiIsdGhpcy5zZXBhcmF0b3I9dm9pZCAwIT09ZS5zZXBhcmF0b3I/ZS5zZXBhcmF0b3I6IlxuIix0aGlzLnNvdXJjZXM9W10sdGhpcy51bmlxdWVTb3VyY2VzPVtdLHRoaXMudW5pcXVlU291cmNlSW5kZXhCeUZpbGVuYW1lPXt9O31hZGRTb3VyY2UoZSl7aWYoZSBpbnN0YW5jZW9mIGcpcmV0dXJuIHRoaXMuYWRkU291cmNlKHtjb250ZW50OmUsZmlsZW5hbWU6ZS5maWxlbmFtZSxzZXBhcmF0b3I6dGhpcy5zZXBhcmF0b3J9KTtpZighdShlKXx8IWUuY29udGVudCl0aHJvdyBuZXcgRXJyb3IoImJ1bmRsZS5hZGRTb3VyY2UoKSB0YWtlcyBhbiBvYmplY3Qgd2l0aCBhIGBjb250ZW50YCBwcm9wZXJ0eSwgd2hpY2ggc2hvdWxkIGJlIGFuIGluc3RhbmNlIG9mIE1hZ2ljU3RyaW5nLCBhbmQgYW4gb3B0aW9uYWwgYGZpbGVuYW1lYCIpO2lmKFsiZmlsZW5hbWUiLCJpZ25vcmVMaXN0IiwiaW5kZW50RXhjbHVzaW9uUmFuZ2VzIiwic2VwYXJhdG9yIl0uZm9yRWFjaCgodD0+e3kuY2FsbChlLHQpfHwoZVt0XT1lLmNvbnRlbnRbdF0pO30pKSx2b2lkIDA9PT1lLnNlcGFyYXRvciYmKGUuc2VwYXJhdG9yPXRoaXMuc2VwYXJhdG9yKSxlLmZpbGVuYW1lKWlmKHkuY2FsbCh0aGlzLnVuaXF1ZVNvdXJjZUluZGV4QnlGaWxlbmFtZSxlLmZpbGVuYW1lKSl7Y29uc3QgdD10aGlzLnVuaXF1ZVNvdXJjZXNbdGhpcy51bmlxdWVTb3VyY2VJbmRleEJ5RmlsZW5hbWVbZS5maWxlbmFtZV1dO2lmKGUuY29udGVudC5vcmlnaW5hbCE9PXQuY29udGVudCl0aHJvdyBuZXcgRXJyb3IoYElsbGVnYWwgc291cmNlOiBzYW1lIGZpbGVuYW1lICgke2UuZmlsZW5hbWV9KSwgZGlmZmVyZW50IGNvbnRlbnRzYCl9ZWxzZSB0aGlzLnVuaXF1ZVNvdXJjZUluZGV4QnlGaWxlbmFtZVtlLmZpbGVuYW1lXT10aGlzLnVuaXF1ZVNvdXJjZXMubGVuZ3RoLHRoaXMudW5pcXVlU291cmNlcy5wdXNoKHtmaWxlbmFtZTplLmZpbGVuYW1lLGNvbnRlbnQ6ZS5jb250ZW50Lm9yaWdpbmFsfSk7cmV0dXJuIHRoaXMuc291cmNlcy5wdXNoKGUpLHRoaXN9YXBwZW5kKGUsdCl7cmV0dXJuIHRoaXMuYWRkU291cmNlKHtjb250ZW50Om5ldyBnKGUpLHNlcGFyYXRvcjp0JiZ0LnNlcGFyYXRvcnx8IiJ9KSx0aGlzfWNsb25lKCl7Y29uc3QgdD1uZXcgZSh7aW50cm86dGhpcy5pbnRybyxzZXBhcmF0b3I6dGhpcy5zZXBhcmF0b3J9KTtyZXR1cm4gdGhpcy5zb3VyY2VzLmZvckVhY2goKGU9Pnt0LmFkZFNvdXJjZSh7ZmlsZW5hbWU6ZS5maWxlbmFtZSxjb250ZW50OmUuY29udGVudC5jbG9uZSgpLHNlcGFyYXRvcjplLnNlcGFyYXRvcn0pO30pKSx0fWdlbmVyYXRlRGVjb2RlZE1hcChlPXt9KXtjb25zdCB0PVtdO2xldCBzO3RoaXMuc291cmNlcy5mb3JFYWNoKChlPT57T2JqZWN0LmtleXMoZS5jb250ZW50LnN0b3JlZE5hbWVzKS5mb3JFYWNoKChlPT57fnQuaW5kZXhPZihlKXx8dC5wdXNoKGUpO30pKTt9KSk7Y29uc3QgaT1uZXcgcChlLmhpcmVzKTtyZXR1cm4gdGhpcy5pbnRybyYmaS5hZHZhbmNlKHRoaXMuaW50cm8pLHRoaXMuc291cmNlcy5mb3JFYWNoKCgoZSxuKT0+e24+MCYmaS5hZHZhbmNlKHRoaXMuc2VwYXJhdG9yKTtjb25zdCByPWUuZmlsZW5hbWU/dGhpcy51bmlxdWVTb3VyY2VJbmRleEJ5RmlsZW5hbWVbZS5maWxlbmFtZV06LTEsbz1lLmNvbnRlbnQsYT1kKG8ub3JpZ2luYWwpO28uaW50cm8mJmkuYWR2YW5jZShvLmludHJvKSxvLmZpcnN0Q2h1bmsuZWFjaE5leHQoKHM9Pntjb25zdCBuPWEocy5zdGFydCk7cy5pbnRyby5sZW5ndGgmJmkuYWR2YW5jZShzLmludHJvKSxlLmZpbGVuYW1lP3MuZWRpdGVkP2kuYWRkRWRpdChyLHMuY29udGVudCxuLHMuc3RvcmVOYW1lP3QuaW5kZXhPZihzLm9yaWdpbmFsKTotMSk6aS5hZGRVbmVkaXRlZENodW5rKHIscyxvLm9yaWdpbmFsLG4sby5zb3VyY2VtYXBMb2NhdGlvbnMpOmkuYWR2YW5jZShzLmNvbnRlbnQpLHMub3V0cm8ubGVuZ3RoJiZpLmFkdmFuY2Uocy5vdXRybyk7fSkpLG8ub3V0cm8mJmkuYWR2YW5jZShvLm91dHJvKSxlLmlnbm9yZUxpc3QmJi0xIT09ciYmKHZvaWQgMD09PXMmJihzPVtdKSxzLnB1c2gocikpO30pKSx7ZmlsZTplLmZpbGU/ZS5maWxlLnNwbGl0KC9bL1xcXS8pLnBvcCgpOnZvaWQgMCxzb3VyY2VzOnRoaXMudW5pcXVlU291cmNlcy5tYXAoKHQ9PmUuZmlsZT9jKGUuZmlsZSx0LmZpbGVuYW1lKTp0LmZpbGVuYW1lKSksc291cmNlc0NvbnRlbnQ6dGhpcy51bmlxdWVTb3VyY2VzLm1hcCgodD0+ZS5pbmNsdWRlQ29udGVudD90LmNvbnRlbnQ6bnVsbCkpLG5hbWVzOnQsbWFwcGluZ3M6aS5yYXcseF9nb29nbGVfaWdub3JlTGlzdDpzfX1nZW5lcmF0ZU1hcChlKXtyZXR1cm4gbmV3IGwodGhpcy5nZW5lcmF0ZURlY29kZWRNYXAoZSkpfWdldEluZGVudFN0cmluZygpe2NvbnN0IGU9e307cmV0dXJuIHRoaXMuc291cmNlcy5mb3JFYWNoKCh0PT57Y29uc3Qgcz10LmNvbnRlbnQuX2dldFJhd0luZGVudFN0cmluZygpO251bGwhPT1zJiYoZVtzXXx8KGVbc109MCksZVtzXSs9MSk7fSkpLE9iamVjdC5rZXlzKGUpLnNvcnQoKCh0LHMpPT5lW3RdLWVbc10pKVswXXx8Ilx0In1pbmRlbnQoZSl7aWYoYXJndW1lbnRzLmxlbmd0aHx8KGU9dGhpcy5nZXRJbmRlbnRTdHJpbmcoKSksIiI9PT1lKXJldHVybiB0aGlzO2xldCB0PSF0aGlzLmludHJvfHwiXG4iPT09dGhpcy5pbnRyby5zbGljZSgtMSk7cmV0dXJuIHRoaXMuc291cmNlcy5mb3JFYWNoKCgocyxpKT0+e2NvbnN0IG49dm9pZCAwIT09cy5zZXBhcmF0b3I/cy5zZXBhcmF0b3I6dGhpcy5zZXBhcmF0b3Iscj10fHxpPjAmJi9ccj9cbiQvLnRlc3Qobik7cy5jb250ZW50LmluZGVudChlLHtleGNsdWRlOnMuaW5kZW50RXhjbHVzaW9uUmFuZ2VzLGluZGVudFN0YXJ0OnJ9KSx0PSJcbiI9PT1zLmNvbnRlbnQubGFzdENoYXIoKTt9KSksdGhpcy5pbnRybyYmKHRoaXMuaW50cm89ZSt0aGlzLmludHJvLnJlcGxhY2UoL15bXlxuXS9nbSwoKHQscyk9PnM+MD9lK3Q6dCkpKSx0aGlzfXByZXBlbmQoZSl7cmV0dXJuIHRoaXMuaW50cm89ZSt0aGlzLmludHJvLHRoaXN9dG9TdHJpbmcoKXtjb25zdCBlPXRoaXMuc291cmNlcy5tYXAoKChlLHQpPT57Y29uc3Qgcz12b2lkIDAhPT1lLnNlcGFyYXRvcj9lLnNlcGFyYXRvcjp0aGlzLnNlcGFyYXRvcjtyZXR1cm4gKHQ+MD9zOiIiKStlLmNvbnRlbnQudG9TdHJpbmcoKX0pKS5qb2luKCIiKTtyZXR1cm4gdGhpcy5pbnRybytlfWlzRW1wdHkoKXtyZXR1cm4gISh0aGlzLmludHJvLmxlbmd0aCYmdGhpcy5pbnRyby50cmltKCl8fHRoaXMuc291cmNlcy5zb21lKChlPT4hZS5jb250ZW50LmlzRW1wdHkoKSkpKX1sZW5ndGgoKXtyZXR1cm4gdGhpcy5zb3VyY2VzLnJlZHVjZSgoKGUsdCk9PmUrdC5jb250ZW50Lmxlbmd0aCgpKSx0aGlzLmludHJvLmxlbmd0aCl9dHJpbUxpbmVzKCl7cmV0dXJuIHRoaXMudHJpbSgiW1xcclxcbl0iKX10cmltKGUpe3JldHVybiB0aGlzLnRyaW1TdGFydChlKS50cmltRW5kKGUpfXRyaW1TdGFydChlKXtjb25zdCB0PW5ldyBSZWdFeHAoIl4iKyhlfHwiXFxzIikrIisiKTtpZih0aGlzLmludHJvPXRoaXMuaW50cm8ucmVwbGFjZSh0LCIiKSwhdGhpcy5pbnRybyl7bGV0IHQscz0wO2Rve2lmKHQ9dGhpcy5zb3VyY2VzW3MrK10sIXQpYnJlYWt9d2hpbGUoIXQuY29udGVudC50cmltU3RhcnRBYm9ydGVkKGUpKX1yZXR1cm4gdGhpc310cmltRW5kKGUpe2NvbnN0IHQ9bmV3IFJlZ0V4cCgoZXx8IlxccyIpKyIrJCIpO2xldCBzLGk9dGhpcy5zb3VyY2VzLmxlbmd0aC0xO2Rve2lmKHM9dGhpcy5zb3VyY2VzW2ktLV0sIXMpe3RoaXMuaW50cm89dGhpcy5pbnRyby5yZXBsYWNlKHQsIiIpO2JyZWFrfX13aGlsZSghcy5jb250ZW50LnRyaW1FbmRBYm9ydGVkKGUpKTtyZXR1cm4gdGhpc319KHtzZXBhcmF0b3I6YCR7d30ke3d9YH0pLEM9ZnVuY3Rpb24oZSx0KXtpZighMCE9PXQuaW5kZW50KXJldHVybiB0LmluZGVudDtmb3IoY29uc3QgdCBvZiBlKXtjb25zdCBlPXlhKHQub3JpZ2luYWxDb2RlKTtpZihudWxsIT09ZSlyZXR1cm4gZX1yZXR1cm4gIlx0In0oYSxoKSwkPVtdO2xldCBOPSIiO2NvbnN0IF89bmV3IFNldCxSPW5ldyBNYXAsTT17ZHluYW1pY0ltcG9ydEZ1bmN0aW9uOmIsZXhwb3J0TmFtZXNCeVZhcmlhYmxlOmksZm9ybWF0OnYsZnJlZXplOlMsaW5kZW50OkMsbmFtZXNwYWNlVG9TdHJpbmdUYWc6QSxwbHVnaW5Ecml2ZXI6ZixzbmlwcGV0czp4LHVzZU9yaWdpbmFsTmFtZTpudWxsfTtsZXQgTz0hMTtmb3IoY29uc3QgZSBvZiBhKXtsZXQgcyxpPTA7aWYoZS5pc0luY2x1ZGVkKCl8fG4uaGFzKGUpKXtjb25zdCByPWUucmVuZGVyKE0pOygoe3NvdXJjZTpzfT1yKSksT3x8KE89ci51c2VzVG9wTGV2ZWxBd2FpdCksaT1zLmxlbmd0aCgpLGkmJihFJiZzLmxhc3RMaW5lKCkuaW5jbHVkZXMoIi8vIikmJnMuYXBwZW5kKCJcbiIpLFIuc2V0KGUscyksUC5hZGRTb3VyY2UocyksJC5wdXNoKGUpKTtjb25zdCBvPWUubmFtZXNwYWNlO2lmKG4uaGFzKGUpKXtjb25zdCBlPW8ucmVuZGVyQmxvY2soTSk7by5yZW5kZXJGaXJzdCgpP04rPXcrZTpQLmFkZFNvdXJjZShuZXcgZyhlKSk7fWNvbnN0IGE9dC5nZXQoZS5zY29wZSk7aWYoYSlmb3IoY29uc3QgZSBvZiBhKV8uYWRkKGUpO31jb25zdHtyZW5kZXJlZEV4cG9ydHM6cixyZW1vdmVkRXhwb3J0czpvfT1lLmdldFJlbmRlcmVkRXhwb3J0cygpO21bZS5pZF09e2dldCBjb2RlKCl7cmV0dXJuIHM/LnRvU3RyaW5nKCk/P251bGx9LG9yaWdpbmFsTGVuZ3RoOmUub3JpZ2luYWxDb2RlLmxlbmd0aCxyZW1vdmVkRXhwb3J0czpvLHJlbmRlcmVkRXhwb3J0czpyLHJlbmRlcmVkTGVuZ3RoOml9O31OJiZQLnByZXBlbmQoTit3K3cpLHRoaXMubmVlZHNFeHBvcnRzU2hpbSYmUC5wcmVwZW5kKGAke3d9JHtJfSAke2hvfSR7a309JHtrfXZvaWQgMDske3d9JHt3fWApO2NvbnN0IEQ9RT9QOlAudHJpbSgpO3ZhciBMO3JldHVybiBvJiYwPT09dGhpcy5nZXRFeHBvcnROYW1lcygpLmxlbmd0aCYmMD09PXMuc2l6ZSYmcih2ZSx7Y29kZToiRU1QVFlfQlVORExFIixtZXNzYWdlOmBHZW5lcmF0ZWQgYW4gZW1wdHkgY2h1bms6ICIke0w9dGhpcy5nZXRDaHVua05hbWUoKX0iLmAsbmFtZXM6W0xdfSkse2FjY2Vzc2VkR2xvYmFsczpfLGluZGVudDpDLG1hZ2ljU3RyaW5nOlAscmVuZGVyZWRTb3VyY2U6RCx1c2VkTW9kdWxlczokLHVzZXNUb3BMZXZlbEF3YWl0Ok99fXNldER5bmFtaWNJbXBvcnRSZXNvbHV0aW9ucyhlKXtjb25zdHthY2Nlc3NlZEdsb2JhbHNCeVNjb3BlOnQsb3V0cHV0T3B0aW9uczpzLHBsdWdpbkRyaXZlcjppLHNuaXBwZXRzOm59PXRoaXM7Zm9yKGNvbnN0IHIgb2YgdGhpcy5nZXRJbmNsdWRlZER5bmFtaWNJbXBvcnRzKCkpaWYoci5jaHVuayl7Y29uc3R7Y2h1bms6byxmYWNhZGVDaHVuazphLG5vZGU6bCxyZXNvbHV0aW9uOmN9PXI7bz09PXRoaXM/bC5zZXRJbnRlcm5hbFJlc29sdXRpb24oYy5uYW1lc3BhY2UpOmwuc2V0RXh0ZXJuYWxSZXNvbHV0aW9uKChhfHxvKS5leHBvcnRNb2RlLGMscyxuLGksdCxgJyR7KGF8fG8pLmdldEltcG9ydFBhdGgoZSl9J2AsIWE/LnN0cmljdEZhY2FkZSYmby5leHBvcnROYW1lc0J5VmFyaWFibGUuZ2V0KGMubmFtZXNwYWNlKVswXSxudWxsKTt9ZWxzZSB7Y29uc3R7bm9kZTpvLHJlc29sdXRpb246YX09cixbbCxjXT10aGlzLmdldER5bmFtaWNJbXBvcnRTdHJpbmdBbmRBc3NlcnRpb25zKGEsZSk7by5zZXRFeHRlcm5hbFJlc29sdXRpb24oImV4dGVybmFsIixhLHMsbixpLHQsbCwhMSxjKTt9fXNldElkZW50aWZpZXJSZW5kZXJSZXNvbHV0aW9ucygpe2NvbnN0e2Zvcm1hdDplLGludGVyb3A6dCxuYW1lc3BhY2VUb1N0cmluZ1RhZzpzLHByZXNlcnZlTW9kdWxlczppLGV4dGVybmFsTGl2ZUJpbmRpbmdzOm59PXRoaXMub3V0cHV0T3B0aW9ucyxyPW5ldyBTZXQ7Zm9yKGNvbnN0IHQgb2YgdGhpcy5nZXRFeHBvcnROYW1lcygpKXtjb25zdCBzPXRoaXMuZXhwb3J0c0J5TmFtZS5nZXQodCk7ImVzIiE9PWUmJiJzeXN0ZW0iIT09ZSYmcy5pc1JlYXNzaWduZWQmJiFzLmlzSWQ/cy5zZXRSZW5kZXJOYW1lcygiZXhwb3J0cyIsdCk6cyBpbnN0YW5jZW9mIGZvP3IuYWRkKHMpOnMuc2V0UmVuZGVyTmFtZXMobnVsbCxudWxsKTt9Zm9yKGNvbnN0IGUgb2YgdGhpcy5vcmRlcmVkTW9kdWxlcylpZihlLm5lZWRzRXhwb3J0U2hpbSl7dGhpcy5uZWVkc0V4cG9ydHNTaGltPSEwO2JyZWFrfWNvbnN0IG89bmV3IFNldChbIk9iamVjdCIsIlByb21pc2UiXSk7c3dpdGNoKHRoaXMubmVlZHNFeHBvcnRzU2hpbSYmby5hZGQoaG8pLHMmJm8uYWRkKCJTeW1ib2wiKSxlKXtjYXNlInN5c3RlbSI6by5hZGQoIm1vZHVsZSIpLmFkZCgiZXhwb3J0cyIpO2JyZWFrO2Nhc2UiZXMiOmJyZWFrO2Nhc2UiY2pzIjpvLmFkZCgibW9kdWxlIikuYWRkKCJyZXF1aXJlIikuYWRkKCJfX2ZpbGVuYW1lIikuYWRkKCJfX2Rpcm5hbWUiKTtkZWZhdWx0Om8uYWRkKCJleHBvcnRzIik7Zm9yKGNvbnN0IGUgb2YgRHIpby5hZGQoZSk7fXBhKHRoaXMub3JkZXJlZE1vZHVsZXMsdGhpcy5nZXREZXBlbmRlbmNpZXNUb0JlRGVjb25mbGljdGVkKCJlcyIhPT1lJiYic3lzdGVtIiE9PWUsImFtZCI9PT1lfHwidW1kIj09PWV8fCJpaWZlIj09PWUsdCksdGhpcy5pbXBvcnRzLG8sZSx0LGksbix0aGlzLmNodW5rQnlNb2R1bGUsdGhpcy5leHRlcm5hbENodW5rQnlNb2R1bGUscix0aGlzLmV4cG9ydE5hbWVzQnlWYXJpYWJsZSx0aGlzLmFjY2Vzc2VkR2xvYmFsc0J5U2NvcGUsdGhpcy5pbmNsdWRlZE5hbWVzcGFjZXMpO31zZXRJbXBvcnRNZXRhUmVzb2x1dGlvbnMoZSl7Y29uc3R7YWNjZXNzZWRHbG9iYWxzQnlTY29wZTp0LGluY2x1ZGVkTmFtZXNwYWNlczpzLG9yZGVyZWRNb2R1bGVzOmksb3V0cHV0T3B0aW9uczp7Zm9ybWF0Om59fT10aGlzO2Zvcihjb25zdCByIG9mIGkpe2Zvcihjb25zdCBzIG9mIHIuaW1wb3J0TWV0YXMpcy5zZXRSZXNvbHV0aW9uKG4sdCxlKTtzLmhhcyhyKSYmci5uYW1lc3BhY2UucHJlcGFyZSh0KTt9fXNldFVwQ2h1bmtJbXBvcnRzQW5kRXhwb3J0c0Zvck1vZHVsZShlKXtjb25zdCB0PW5ldyBTZXQoZS5pbmNsdWRlZEltcG9ydHMpO2lmKCF0aGlzLm91dHB1dE9wdGlvbnMucHJlc2VydmVNb2R1bGVzJiZ0aGlzLmluY2x1ZGVkTmFtZXNwYWNlcy5oYXMoZSkpe2NvbnN0IHM9ZS5uYW1lc3BhY2UuZ2V0TWVtYmVyVmFyaWFibGVzKCk7Zm9yKGNvbnN0IGUgb2YgT2JqZWN0LnZhbHVlcyhzKSllLmluY2x1ZGVkJiZ0LmFkZChlKTt9Zm9yKGxldCBzIG9mIHQpe3MgaW5zdGFuY2VvZiBybyYmKHM9cy5nZXRPcmlnaW5hbFZhcmlhYmxlKCkpLHMgaW5zdGFuY2VvZiBmbyYmKHM9cy5nZXRCYXNlVmFyaWFibGUoKSk7Y29uc3QgdD10aGlzLmNodW5rQnlNb2R1bGUuZ2V0KHMubW9kdWxlKTt0IT09dGhpcyYmKHRoaXMuaW1wb3J0cy5hZGQocykscy5tb2R1bGUgaW5zdGFuY2VvZiBUbyYmKHRoaXMuY2hlY2tDaXJjdWxhckRlcGVuZGVuY3lJbXBvcnQocyxlKSxzIGluc3RhbmNlb2YgcG8mJnRoaXMub3V0cHV0T3B0aW9ucy5wcmVzZXJ2ZU1vZHVsZXN8fHQuZXhwb3J0cy5hZGQocykpKTt9KHRoaXMuaW5jbHVkZWROYW1lc3BhY2VzLmhhcyhlKXx8ZS5pbmZvLmlzRW50cnkmJiExIT09ZS5wcmVzZXJ2ZVNpZ25hdHVyZXx8ZS5pbmNsdWRlZER5bmFtaWNJbXBvcnRlcnMuc29tZSgoZT0+dGhpcy5jaHVua0J5TW9kdWxlLmdldChlKSE9PXRoaXMpKSkmJnRoaXMuZW5zdXJlUmVleHBvcnRzQXJlQXZhaWxhYmxlRm9yTW9kdWxlKGUpO2Zvcihjb25zdHtub2RlOnQscmVzb2x1dGlvbjpzfW9mIGUuZHluYW1pY0ltcG9ydHMpdC5pbmNsdWRlZCYmcyBpbnN0YW5jZW9mIFRvJiZ0aGlzLmNodW5rQnlNb2R1bGUuZ2V0KHMpPT09dGhpcyYmIXRoaXMuaW5jbHVkZWROYW1lc3BhY2VzLmhhcyhzKSYmKHRoaXMuaW5jbHVkZWROYW1lc3BhY2VzLmFkZChzKSx0aGlzLmVuc3VyZVJlZXhwb3J0c0FyZUF2YWlsYWJsZUZvck1vZHVsZShzKSk7fX1mdW5jdGlvbiBSYShlKXtyZXR1cm4gTWEoZSk/P0QoZS5pZCl9ZnVuY3Rpb24gTWEoZSl7cmV0dXJuIGUuY2h1bmtOYW1lcy5maW5kKCgoe2lzVXNlckRlZmluZWQ6ZX0pPT5lKSk/Lm5hbWU/P2UuY2h1bmtOYW1lc1swXT8ubmFtZX1mdW5jdGlvbiBPYShlLHQpe2NvbnN0IHM9e307Zm9yKGNvbnN0W2ksbl1vZiBlKXtjb25zdCBlPW5ldyBTZXQ7aWYobi5pbXBvcnRzKWZvcihjb25zdHtpbXBvcnRlZDp0fW9mIG4uaW1wb3J0cyllLmFkZCh0KTtpZihuLnJlZXhwb3J0cylmb3IoY29uc3R7aW1wb3J0ZWQ6dH1vZiBuLnJlZXhwb3J0cyllLmFkZCh0KTtzW3QoaSldPVsuLi5lXTt9cmV0dXJuIHN9Y29uc3QgRGE9L1sjP10vLExhPWU9PmUuZ2V0RmlsZU5hbWUoKTtmdW5jdGlvbipUYShlKXtmb3IoY29uc3QgdCBvZiBlKXlpZWxkKnQ7fWZ1bmN0aW9uIFZhKGUsdCxzLGkpe2NvbnN0e2NodW5rRGVmaW5pdGlvbnM6bixtb2R1bGVzSW5NYW51YWxDaHVua3M6cn09ZnVuY3Rpb24oZSl7Y29uc3QgdD1bXSxzPW5ldyBTZXQoZS5rZXlzKCkpLGk9T2JqZWN0LmNyZWF0ZShudWxsKTtmb3IoY29uc3RbdCxuXW9mIGUpQmEodCxpW25dfHwoaVtuXT1bXSkscyk7Zm9yKGNvbnN0W2Usc11vZiBPYmplY3QuZW50cmllcyhpKSl0LnB1c2goe2FsaWFzOmUsbW9kdWxlczpzfSk7cmV0dXJuIHtjaHVua0RlZmluaXRpb25zOnQsbW9kdWxlc0luTWFudWFsQ2h1bmtzOnN9fSh0KSx7YWxsRW50cmllczpvLGRlcGVuZGVudEVudHJpZXNCeU1vZHVsZTphLGR5bmFtaWNhbGx5RGVwZW5kZW50RW50cmllc0J5RHluYW1pY0VudHJ5OmwsZHluYW1pY0ltcG9ydHNCeUVudHJ5OmN9PWZ1bmN0aW9uKGUpe2NvbnN0IHQ9bmV3IFNldCxzPW5ldyBNYXAsaT1bXSxuPW5ldyBTZXQoZSk7bGV0IHI9MDtmb3IoY29uc3QgZSBvZiBuKXtjb25zdCBvPW5ldyBTZXQ7aS5wdXNoKG8pO2NvbnN0IGE9bmV3IFNldChbZV0pO2Zvcihjb25zdCBlIG9mIGEpe0YkMyhzLGUsaikuYWRkKHIpO2Zvcihjb25zdCB0IG9mIGUuZ2V0RGVwZW5kZW5jaWVzVG9CZUluY2x1ZGVkKCkpdCBpbnN0YW5jZW9mIFF0fHxhLmFkZCh0KTtmb3IoY29uc3R7cmVzb2x1dGlvbjpzfW9mIGUuZHluYW1pY0ltcG9ydHMpcyBpbnN0YW5jZW9mIFRvJiZzLmluY2x1ZGVkRHluYW1pY0ltcG9ydGVycy5sZW5ndGg+MCYmIW4uaGFzKHMpJiYodC5hZGQocyksbi5hZGQocyksby5hZGQocykpO2Zvcihjb25zdCBzIG9mIGUuaW1wbGljaXRseUxvYWRlZEJlZm9yZSluLmhhcyhzKXx8KHQuYWRkKHMpLG4uYWRkKHMpKTt9cisrO31jb25zdCBvPVsuLi5uXSx7ZHluYW1pY0VudHJpZXM6YSxkeW5hbWljSW1wb3J0c0J5RW50cnk6bH09ZnVuY3Rpb24oZSx0LHMpe2NvbnN0IGk9bmV3IE1hcCxuPW5ldyBTZXQ7Zm9yKGNvbnN0W3Mscl1vZiBlLmVudHJpZXMoKSlpLnNldChyLHMpLHQuaGFzKHIpJiZuLmFkZChzKTtjb25zdCByPVtdO2Zvcihjb25zdCBlIG9mIHMpe2NvbnN0IHQ9bmV3IFNldDtmb3IoY29uc3QgcyBvZiBlKXQuYWRkKGkuZ2V0KHMpKTtyLnB1c2godCk7fXJldHVybiB7ZHluYW1pY0VudHJpZXM6bixkeW5hbWljSW1wb3J0c0J5RW50cnk6cn19KG8sdCxpKTtyZXR1cm4ge2FsbEVudHJpZXM6byxkZXBlbmRlbnRFbnRyaWVzQnlNb2R1bGU6cyxkeW5hbWljYWxseURlcGVuZGVudEVudHJpZXNCeUR5bmFtaWNFbnRyeTp6YShzLGEsbyksZHluYW1pY0ltcG9ydHNCeUVudHJ5Omx9fShlKSxoPUZhKGZ1bmN0aW9uKihlLHQpe2Zvcihjb25zdFtzLGldb2YgZSl0LmhhcyhzKXx8KHlpZWxkIHtkZXBlbmRlbnRFbnRyaWVzOmksbW9kdWxlczpbc119KTt9KGEscikpO3JldHVybiBmdW5jdGlvbihlLHQscyxpKXtjb25zdCBuPWkubWFwKCgoKT0+MG4pKSxyPWkubWFwKCgoZSxzKT0+dC5oYXMocyk/LTFuOjBuKSk7bGV0IG89MW47Zm9yKGNvbnN0e2RlcGVuZGVudEVudHJpZXM6dH1vZiBlKXtmb3IoY29uc3QgZSBvZiB0KW5bZV18PW87bzw8PTFuO31jb25zdCBhPXQ7Zm9yKGNvbnN0W2UsdF1vZiBhKXthLmRlbGV0ZShlKTtjb25zdCBpPXJbZV07bGV0IG89aTtmb3IoY29uc3QgZSBvZiB0KW8mPW5bZV18cltlXTtpZihvIT09aSl7cltlXT1vO2Zvcihjb25zdCB0IG9mIHNbZV0pRiQzKGEsdCxqKS5hZGQoZSk7fX1vPTFuO2Zvcihjb25zdHtkZXBlbmRlbnRFbnRyaWVzOnR9b2YgZSl7Zm9yKGNvbnN0IGUgb2YgdCkocltlXSZvKT09PW8mJnQuZGVsZXRlKGUpO288PD0xbjt9fShoLGwsYyxvKSxuLnB1c2goLi4uZnVuY3Rpb24oZSx0LHMsaSl7JG8oIm9wdGltaXplIGNodW5rcyIsMyk7Y29uc3Qgbj1mdW5jdGlvbihlLHQscyl7Y29uc3QgaT1bXSxuPVtdLHI9bmV3IE1hcCxvPVtdO2xldCBhPTBuLGw9MW47Zm9yKGNvbnN0e2RlcGVuZGVudEVudHJpZXM6dCxtb2R1bGVzOmN9b2YgZSl7Y29uc3QgZT17Y29udGFpbmVkQXRvbXM6bCxjb3JyZWxhdGVkQXRvbXM6MG4sZGVwZW5kZW5jaWVzOm5ldyBTZXQsZGVwZW5kZW50Q2h1bmtzOm5ldyBTZXQsZGVwZW5kZW50RW50cmllczp0LG1vZHVsZXM6YyxwdXJlOiEwLHNpemU6MH07bGV0IGg9MCx1PSEwO2Zvcihjb25zdCB0IG9mIGMpci5zZXQodCxlKSx0LmlzSW5jbHVkZWQoKSYmKHUmJih1PSF0Lmhhc0VmZmVjdHMoKSksaCs9cz4xP3QuZXN0aW1hdGVTaXplKCk6MSk7ZS5wdXJlPXUsZS5zaXplPWgsby5wdXNoKGgpLHV8fChhfD1sKSwoaDxzP2k6bikucHVzaChlKSxsPDw9MW47fWlmKDA9PT1pLmxlbmd0aClyZXR1cm4gbnVsbDtyZXR1cm4gYXw9ZnVuY3Rpb24oZSx0LHMsaSl7Y29uc3Qgbj1uZXcgTWFwO2xldCByPTBuO2NvbnN0IG89W107Zm9yKGxldCBlPTA7ZTxzO2UrKylvLnB1c2goMG4pO2Zvcihjb25zdCBzIG9mIGUpe3Muc29ydChHYSk7Zm9yKGNvbnN0IGUgb2Ygcyl7Y29uc3R7ZGVwZW5kZW5jaWVzOnMsZGVwZW5kZW50RW50cmllczphLG1vZHVsZXM6bH09ZTtmb3IoY29uc3QgbyBvZiBsKWZvcihjb25zdCBhIG9mIG8uZ2V0RGVwZW5kZW5jaWVzVG9CZUluY2x1ZGVkKCkpaWYoYSBpbnN0YW5jZW9mIFF0KWEuaW5mby5tb2R1bGVTaWRlRWZmZWN0cyYmKGUuY29udGFpbmVkQXRvbXN8PUYkMyhuLGEsKCgpPT57Y29uc3QgZT1pO3JldHVybiBpPDw9MW4scnw9ZSxlfSkpKTtlbHNlIHtjb25zdCBpPXQuZ2V0KGEpO2kmJmkhPT1lJiYocy5hZGQoaSksaS5kZXBlbmRlbnRDaHVua3MuYWRkKGUpKTt9Y29uc3R7Y29udGFpbmVkQXRvbXM6Y309ZTtmb3IoY29uc3QgZSBvZiBhKW9bZV18PWM7fX1mb3IoY29uc3QgdCBvZiBlKWZvcihjb25zdCBlIG9mIHQpe2NvbnN0e2RlcGVuZGVudEVudHJpZXM6dH09ZTtlLmNvcnJlbGF0ZWRBdG9tcz0tMW47Zm9yKGNvbnN0IHMgb2YgdCllLmNvcnJlbGF0ZWRBdG9tcyY9b1tzXTt9cmV0dXJuIHJ9KFtuLGldLHIsdCxsKSx7YmlnOm5ldyBTZXQobiksc2lkZUVmZmVjdEF0b21zOmEsc2l6ZUJ5QXRvbTpvLHNtYWxsOm5ldyBTZXQoaSl9fShlLHQscyk7aWYoIW4pcmV0dXJuIE5vKCJvcHRpbWl6ZSBjaHVua3MiLDMpLGU7cmV0dXJuIHM+MSYmaSgiaW5mbyIsVXQoZS5sZW5ndGgsbi5zbWFsbC5zaXplLCJJbml0aWFsbHkiKSksZnVuY3Rpb24oZSx0KXtjb25zdHtzbWFsbDpzfT1lO2Zvcihjb25zdCBpIG9mIHMpe2NvbnN0IG49amEoaSxlLHQ8PTE/MToxLzApO2lmKG4pe2NvbnN0e2NvbnRhaW5lZEF0b21zOnIsY29ycmVsYXRlZEF0b21zOm8sbW9kdWxlczphLHB1cmU6bCxzaXplOmN9PWk7cy5kZWxldGUoaSksVWEobix0LGUpLmRlbGV0ZShuKSxuLm1vZHVsZXMucHVzaCguLi5hKSxuLnNpemUrPWMsbi5wdXJlJiYobi5wdXJlPWwpO2NvbnN0e2RlcGVuZGVuY2llczpoLGRlcGVuZGVudENodW5rczp1LGRlcGVuZGVudEVudHJpZXM6ZH09bjtuLmNvcnJlbGF0ZWRBdG9tcyY9byxuLmNvbnRhaW5lZEF0b21zfD1yO2Zvcihjb25zdCBlIG9mIGkuZGVwZW5kZW50RW50cmllcylkLmFkZChlKTtmb3IoY29uc3QgZSBvZiBpLmRlcGVuZGVuY2llcyloLmFkZChlKSxlLmRlcGVuZGVudENodW5rcy5kZWxldGUoaSksZS5kZXBlbmRlbnRDaHVua3MuYWRkKG4pO2Zvcihjb25zdCBlIG9mIGkuZGVwZW5kZW50Q2h1bmtzKXUuYWRkKGUpLGUuZGVwZW5kZW5jaWVzLmRlbGV0ZShpKSxlLmRlcGVuZGVuY2llcy5hZGQobik7aC5kZWxldGUobiksdS5kZWxldGUobiksVWEobix0LGUpLmFkZChuKTt9fX0obixzKSxzPjEmJmkoImluZm8iLFV0KG4uc21hbGwuc2l6ZStuLmJpZy5zaXplLG4uc21hbGwuc2l6ZSwiQWZ0ZXIgbWVyZ2luZyBjaHVua3MiKSksTm8oIm9wdGltaXplIGNodW5rcyIsMyksWy4uLm4uc21hbGwsLi4ubi5iaWddfShGYShoKSxvLmxlbmd0aCxzLGkpLm1hcCgoKHttb2R1bGVzOmV9KT0+KHthbGlhczpudWxsLG1vZHVsZXM6ZX0pKSkpLG59ZnVuY3Rpb24gQmEoZSx0LHMpe2NvbnN0IGk9bmV3IFNldChbZV0pO2Zvcihjb25zdCBlIG9mIGkpe3MuYWRkKGUpLHQucHVzaChlKTtmb3IoY29uc3QgdCBvZiBlLmRlcGVuZGVuY2llcyl0IGluc3RhbmNlb2YgUXR8fHMuaGFzKHQpfHxpLmFkZCh0KTt9fWZ1bmN0aW9uIHphKGUsdCxzKXtjb25zdCBpPW5ldyBNYXA7Zm9yKGNvbnN0IG4gb2YgdCl7Y29uc3QgdD1GJDMoaSxuLGopLHI9c1tuXTtmb3IoY29uc3QgcyBvZiBUYShbci5pbmNsdWRlZER5bmFtaWNJbXBvcnRlcnMsci5pbXBsaWNpdGx5TG9hZGVkQWZ0ZXJdKSlmb3IoY29uc3QgaSBvZiBlLmdldChzKSl0LmFkZChpKTt9cmV0dXJuIGl9ZnVuY3Rpb24gRmEoZSl7dmFyIHQ7Y29uc3Qgcz1PYmplY3QuY3JlYXRlKG51bGwpO2Zvcihjb25zdHtkZXBlbmRlbnRFbnRyaWVzOmksbW9kdWxlczpufW9mIGUpe2xldCBlPTBuO2Zvcihjb25zdCB0IG9mIGkpZXw9MW48PEJpZ0ludCh0KTsoc1t0PVN0cmluZyhlKV18fChzW3RdPXtkZXBlbmRlbnRFbnRyaWVzOm5ldyBTZXQoaSksbW9kdWxlczpbXX0pKS5tb2R1bGVzLnB1c2goLi4ubik7fXJldHVybiBPYmplY3QudmFsdWVzKHMpfWZ1bmN0aW9uIGphKGUse2JpZzp0LHNpZGVFZmZlY3RBdG9tczpzLHNpemVCeUF0b206aSxzbWFsbDpufSxyKXtsZXQgbz1udWxsO2Zvcihjb25zdCBhIG9mIFRhKFtuLHRdKSl7aWYoZT09PWEpY29udGludWU7Y29uc3QgdD1XYShlLGEscixzLGkpO2lmKHQ8cil7aWYobz1hLDA9PT10KWJyZWFrO3I9dDt9fXJldHVybiBvfWZ1bmN0aW9uIFVhKGUsdCxzKXtyZXR1cm4gZS5zaXplPHQ/cy5zbWFsbDpzLmJpZ31mdW5jdGlvbiBHYSh7c2l6ZTplfSx7c2l6ZTp0fSl7cmV0dXJuIGUtdH1mdW5jdGlvbiBXYShlLHQscyxpLG4pe2NvbnN0IHI9cWEoZSx0LHMsaSxuKTtyZXR1cm4gcjxzP3IrcWEodCxlLHMtcixpLG4pOjEvMH1mdW5jdGlvbiBxYShlLHQscyxpLG4pe2NvbnN0e2NvcnJlbGF0ZWRBdG9tczpyfT10O2xldCBvPWUuY29udGFpbmVkQXRvbXM7Y29uc3QgYT1vJmk7aWYoKHImYSkhPT1hKXJldHVybiAxLzA7Y29uc3QgbD1uZXcgU2V0KGUuZGVwZW5kZW5jaWVzKTtmb3IoY29uc3R7ZGVwZW5kZW5jaWVzOmUsY29udGFpbmVkQXRvbXM6c31vZiBsKXtvfD1zO2NvbnN0IG49cyZpO2lmKChyJm4pIT09bilyZXR1cm4gMS8wO2Zvcihjb25zdCBzIG9mIGUpe2lmKHM9PT10KXJldHVybiAxLzA7bC5hZGQocyk7fX1yZXR1cm4gZnVuY3Rpb24oZSx0LHMpe2xldCBpPTAsbj0wLHI9MW47Y29uc3R7bGVuZ3RoOm99PXM7Zm9yKDtuPG87bisrKWlmKChlJnIpPT09ciYmKGkrPXNbbl0pLHI8PD0xbixpPj10KXJldHVybiAxLzA7cmV0dXJuIGl9KG8mfnIscyxuKX1jb25zdCBIYT0oZSx0KT0+ZS5leGVjSW5kZXg+dC5leGVjSW5kZXg/MTotMTtmdW5jdGlvbiBLYShlLHQscyl7Y29uc3QgaT1TeW1ib2woZS5pZCksbj1bZS5pZF07bGV0IHI9dDtmb3IoZS5jeWNsZXMuYWRkKGkpO3IhPT1lOylyLmN5Y2xlcy5hZGQoaSksbi5wdXNoKHIuaWQpLHI9cy5nZXQocik7cmV0dXJuIG4ucHVzaChuWzBdKSxuLnJldmVyc2UoKSxufWNvbnN0IFlhPShlLHQpPT50P2AoJHtlfSlgOmUsWGE9L14oPyFcZClbXHckXSskLztjbGFzcyBRYXtjb25zdHJ1Y3RvcihlLHQpe3RoaXMuaXNPcmlnaW5hbD0hMCx0aGlzLmZpbGVuYW1lPWUsdGhpcy5jb250ZW50PXQ7fXRyYWNlU2VnbWVudChlLHQscyl7cmV0dXJuIHtjb2x1bW46dCxsaW5lOmUsbmFtZTpzLHNvdXJjZTp0aGlzfX19Y2xhc3MgWmF7Y29uc3RydWN0b3IoZSx0KXt0aGlzLnNvdXJjZXM9dCx0aGlzLm5hbWVzPWUubmFtZXMsdGhpcy5tYXBwaW5ncz1lLm1hcHBpbmdzO310cmFjZU1hcHBpbmdzKCl7Y29uc3QgZT1bXSx0PW5ldyBNYXAscz1bXSxpPVtdLG49bmV3IE1hcCxyPVtdO2Zvcihjb25zdCBvIG9mIHRoaXMubWFwcGluZ3Mpe2NvbnN0IGE9W107Zm9yKGNvbnN0IHIgb2Ygbyl7aWYoMT09PXIubGVuZ3RoKWNvbnRpbnVlO2NvbnN0IG89dGhpcy5zb3VyY2VzW3JbMV1dO2lmKCFvKWNvbnRpbnVlO2NvbnN0IGw9by50cmFjZVNlZ21lbnQoclsyXSxyWzNdLDU9PT1yLmxlbmd0aD90aGlzLm5hbWVzW3JbNF1dOiIiKTtpZihsKXtjb25zdHtjb2x1bW46byxsaW5lOmMsbmFtZTpoLHNvdXJjZTp7Y29udGVudDp1LGZpbGVuYW1lOmR9fT1sO2xldCBwPXQuZ2V0KGQpO2lmKHZvaWQgMD09PXApcD1lLmxlbmd0aCxlLnB1c2goZCksdC5zZXQoZCxwKSxzW3BdPXU7ZWxzZSBpZihudWxsPT1zW3BdKXNbcF09dTtlbHNlIGlmKG51bGwhPXUmJnNbcF0hPT11KXJldHVybiBZZShXdChkKSk7Y29uc3QgZj1bclswXSxwLGMsb107aWYoaCl7bGV0IGU9bi5nZXQoaCk7dm9pZCAwPT09ZSYmKGU9aS5sZW5ndGgsaS5wdXNoKGgpLG4uc2V0KGgsZSkpLGZbNF09ZTt9YS5wdXNoKGYpO319ci5wdXNoKGEpO31yZXR1cm4ge21hcHBpbmdzOnIsbmFtZXM6aSxzb3VyY2VzOmUsc291cmNlc0NvbnRlbnQ6c319dHJhY2VTZWdtZW50KGUsdCxzKXtjb25zdCBpPXRoaXMubWFwcGluZ3NbZV07aWYoIWkpcmV0dXJuIG51bGw7bGV0IG49MCxyPWkubGVuZ3RoLTE7Zm9yKDtuPD1yOyl7Y29uc3QgZT1uK3I+PjEsbz1pW2VdO2lmKG9bMF09PT10fHxuPT09cil7aWYoMT09by5sZW5ndGgpcmV0dXJuIG51bGw7Y29uc3QgZT10aGlzLnNvdXJjZXNbb1sxXV07cmV0dXJuIGU/ZS50cmFjZVNlZ21lbnQob1syXSxvWzNdLDU9PT1vLmxlbmd0aD90aGlzLm5hbWVzW29bNF1dOnMpOm51bGx9b1swXT50P3I9ZS0xOm49ZSsxO31yZXR1cm4gbnVsbH19ZnVuY3Rpb24gSmEoZSl7cmV0dXJuIGZ1bmN0aW9uKHQscyl7cmV0dXJuIHMubWlzc2luZz8oZSh2ZSwoaT1zLnBsdWdpbix7Y29kZTpJdCxtZXNzYWdlOmBTb3VyY2VtYXAgaXMgbGlrZWx5IHRvIGJlIGluY29ycmVjdDogYSBwbHVnaW4gKCR7aX0pIHdhcyB1c2VkIHRvIHRyYW5zZm9ybSBmaWxlcywgYnV0IGRpZG4ndCBnZW5lcmF0ZSBhIHNvdXJjZW1hcCBmb3IgdGhlIHRyYW5zZm9ybWF0aW9uLiBDb25zdWx0IHRoZSBwbHVnaW4gZG9jdW1lbnRhdGlvbiBmb3IgaGVscGAscGx1Z2luOmksdXJsOk1lKERlKX0pKSxuZXcgWmEoe21hcHBpbmdzOltdLG5hbWVzOltdfSxbdF0pKTpuZXcgWmEocyxbdF0pO3ZhciBpO319ZnVuY3Rpb24gZWwoZSx0LHMsaSxuKXtsZXQgcjtpZihzKXtjb25zdCB0PXMuc291cmNlcyxpPXMuc291cmNlc0NvbnRlbnR8fFtdLG49UChlKXx8Ii4iLG89cy5zb3VyY2VSb290fHwiLiIsYT10Lm1hcCgoKGUsdCk9Pm5ldyBRYShOJDUobixvLGUpLGlbdF0pKSk7cj1uZXcgWmEocyxhKTt9ZWxzZSByPW5ldyBRYShlLHQpO3JldHVybiBpLnJlZHVjZShuLHIpfXZhciB0bD17fSxzbD1pbDtmdW5jdGlvbiBpbChlLHQpe2lmKCFlKXRocm93IG5ldyBFcnJvcih0fHwiQXNzZXJ0aW9uIGZhaWxlZCIpfWlsLmVxdWFsPWZ1bmN0aW9uKGUsdCxzKXtpZihlIT10KXRocm93IG5ldyBFcnJvcihzfHwiQXNzZXJ0aW9uIGZhaWxlZDogIitlKyIgIT0gIit0KX07dmFyIG5sPXtleHBvcnRzOnt9fTsiZnVuY3Rpb24iPT10eXBlb2YgT2JqZWN0LmNyZWF0ZT9ubC5leHBvcnRzPWZ1bmN0aW9uKGUsdCl7dCYmKGUuc3VwZXJfPXQsZS5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZSh0LnByb3RvdHlwZSx7Y29uc3RydWN0b3I6e3ZhbHVlOmUsZW51bWVyYWJsZTohMSx3cml0YWJsZTohMCxjb25maWd1cmFibGU6ITB9fSkpO306bmwuZXhwb3J0cz1mdW5jdGlvbihlLHQpe2lmKHQpe2Uuc3VwZXJfPXQ7dmFyIHM9ZnVuY3Rpb24oKXt9O3MucHJvdG90eXBlPXQucHJvdG90eXBlLGUucHJvdG90eXBlPW5ldyBzLGUucHJvdG90eXBlLmNvbnN0cnVjdG9yPWU7fX07dmFyIHJsPW5sLmV4cG9ydHMsb2w9c2wsYWw9cmw7ZnVuY3Rpb24gbGwoZSx0KXtyZXR1cm4gNTUyOTY9PSg2NDUxMiZlLmNoYXJDb2RlQXQodCkpJiYoISh0PDB8fHQrMT49ZS5sZW5ndGgpJiY1NjMyMD09KDY0NTEyJmUuY2hhckNvZGVBdCh0KzEpKSl9ZnVuY3Rpb24gY2woZSl7cmV0dXJuIChlPj4+MjR8ZT4+PjgmNjUyODB8ZTw8OCYxNjcxMTY4MHwoMjU1JmUpPDwyNCk+Pj4wfWZ1bmN0aW9uIGhsKGUpe3JldHVybiAxPT09ZS5sZW5ndGg/IjAiK2U6ZX1mdW5jdGlvbiB1bChlKXtyZXR1cm4gNz09PWUubGVuZ3RoPyIwIitlOjY9PT1lLmxlbmd0aD8iMDAiK2U6NT09PWUubGVuZ3RoPyIwMDAiK2U6ND09PWUubGVuZ3RoPyIwMDAwIitlOjM9PT1lLmxlbmd0aD8iMDAwMDAiK2U6Mj09PWUubGVuZ3RoPyIwMDAwMDAiK2U6MT09PWUubGVuZ3RoPyIwMDAwMDAwIitlOmV9dGwuaW5oZXJpdHM9YWwsdGwudG9BcnJheT1mdW5jdGlvbihlLHQpe2lmKEFycmF5LmlzQXJyYXkoZSkpcmV0dXJuIGUuc2xpY2UoKTtpZighZSlyZXR1cm4gW107dmFyIHM9W107aWYoInN0cmluZyI9PXR5cGVvZiBlKWlmKHQpe2lmKCJoZXgiPT09dClmb3IoKGU9ZS5yZXBsYWNlKC9bXmEtejAtOV0rL2dpLCIiKSkubGVuZ3RoJTIhPTAmJihlPSIwIitlKSxuPTA7bjxlLmxlbmd0aDtuKz0yKXMucHVzaChwYXJzZUludChlW25dK2VbbisxXSwxNikpO31lbHNlIGZvcih2YXIgaT0wLG49MDtuPGUubGVuZ3RoO24rKyl7dmFyIHI9ZS5jaGFyQ29kZUF0KG4pO3I8MTI4P3NbaSsrXT1yOnI8MjA0OD8oc1tpKytdPXI+PjZ8MTkyLHNbaSsrXT02MyZyfDEyOCk6bGwoZSxuKT8ocj02NTUzNisoKDEwMjMmcik8PDEwKSsoMTAyMyZlLmNoYXJDb2RlQXQoKytuKSksc1tpKytdPXI+PjE4fDI0MCxzW2krK109cj4+MTImNjN8MTI4LHNbaSsrXT1yPj42JjYzfDEyOCxzW2krK109NjMmcnwxMjgpOihzW2krK109cj4+MTJ8MjI0LHNbaSsrXT1yPj42JjYzfDEyOCxzW2krK109NjMmcnwxMjgpO31lbHNlIGZvcihuPTA7bjxlLmxlbmd0aDtuKyspc1tuXT0wfGVbbl07cmV0dXJuIHN9LHRsLnRvSGV4PWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD0iIixzPTA7czxlLmxlbmd0aDtzKyspdCs9aGwoZVtzXS50b1N0cmluZygxNikpO3JldHVybiB0fSx0bC5odG9ubD1jbCx0bC50b0hleDMyPWZ1bmN0aW9uKGUsdCl7Zm9yKHZhciBzPSIiLGk9MDtpPGUubGVuZ3RoO2krKyl7dmFyIG49ZVtpXTsibGl0dGxlIj09PXQmJihuPWNsKG4pKSxzKz11bChuLnRvU3RyaW5nKDE2KSk7fXJldHVybiBzfSx0bC56ZXJvMj1obCx0bC56ZXJvOD11bCx0bC5qb2luMzI9ZnVuY3Rpb24oZSx0LHMsaSl7dmFyIG49cy10O29sKG4lND09MCk7Zm9yKHZhciByPW5ldyBBcnJheShuLzQpLG89MCxhPXQ7bzxyLmxlbmd0aDtvKyssYSs9NCl7dmFyIGw7bD0iYmlnIj09PWk/ZVthXTw8MjR8ZVthKzFdPDwxNnxlW2ErMl08PDh8ZVthKzNdOmVbYSszXTw8MjR8ZVthKzJdPDwxNnxlW2ErMV08PDh8ZVthXSxyW29dPWw+Pj4wO31yZXR1cm4gcn0sdGwuc3BsaXQzMj1mdW5jdGlvbihlLHQpe2Zvcih2YXIgcz1uZXcgQXJyYXkoNCplLmxlbmd0aCksaT0wLG49MDtpPGUubGVuZ3RoO2krKyxuKz00KXt2YXIgcj1lW2ldOyJiaWciPT09dD8oc1tuXT1yPj4+MjQsc1tuKzFdPXI+Pj4xNiYyNTUsc1tuKzJdPXI+Pj44JjI1NSxzW24rM109MjU1JnIpOihzW24rM109cj4+PjI0LHNbbisyXT1yPj4+MTYmMjU1LHNbbisxXT1yPj4+OCYyNTUsc1tuXT0yNTUmcik7fXJldHVybiBzfSx0bC5yb3RyMzI9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZT4+PnR8ZTw8MzItdH0sdGwucm90bDMyPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIGU8PHR8ZT4+PjMyLXR9LHRsLnN1bTMyPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUrdD4+PjB9LHRsLnN1bTMyXzM9ZnVuY3Rpb24oZSx0LHMpe3JldHVybiBlK3Qrcz4+PjB9LHRsLnN1bTMyXzQ9ZnVuY3Rpb24oZSx0LHMsaSl7cmV0dXJuIGUrdCtzK2k+Pj4wfSx0bC5zdW0zMl81PWZ1bmN0aW9uKGUsdCxzLGksbil7cmV0dXJuIGUrdCtzK2krbj4+PjB9LHRsLnN1bTY0PWZ1bmN0aW9uKGUsdCxzLGkpe3ZhciBuPWVbdF0scj1pK2VbdCsxXT4+PjAsbz0ocjxpPzE6MCkrcytuO2VbdF09bz4+PjAsZVt0KzFdPXI7fSx0bC5zdW02NF9oaT1mdW5jdGlvbihlLHQscyxpKXtyZXR1cm4gKHQraT4+PjA8dD8xOjApK2Urcz4+PjB9LHRsLnN1bTY0X2xvPWZ1bmN0aW9uKGUsdCxzLGkpe3JldHVybiB0K2k+Pj4wfSx0bC5zdW02NF80X2hpPWZ1bmN0aW9uKGUsdCxzLGksbixyLG8sYSl7dmFyIGw9MCxjPXQ7cmV0dXJuIGwrPShjPWMraT4+PjApPHQ/MTowLGwrPShjPWMrcj4+PjApPHI/MTowLGUrcytuK28rKGwrPShjPWMrYT4+PjApPGE/MTowKT4+PjB9LHRsLnN1bTY0XzRfbG89ZnVuY3Rpb24oZSx0LHMsaSxuLHIsbyxhKXtyZXR1cm4gdCtpK3IrYT4+PjB9LHRsLnN1bTY0XzVfaGk9ZnVuY3Rpb24oZSx0LHMsaSxuLHIsbyxhLGwsYyl7dmFyIGg9MCx1PXQ7cmV0dXJuIGgrPSh1PXUraT4+PjApPHQ/MTowLGgrPSh1PXUrcj4+PjApPHI/MTowLGgrPSh1PXUrYT4+PjApPGE/MTowLGUrcytuK28rbCsoaCs9KHU9dStjPj4+MCk8Yz8xOjApPj4+MH0sdGwuc3VtNjRfNV9sbz1mdW5jdGlvbihlLHQscyxpLG4scixvLGEsbCxjKXtyZXR1cm4gdCtpK3IrYStjPj4+MH0sdGwucm90cjY0X2hpPWZ1bmN0aW9uKGUsdCxzKXtyZXR1cm4gKHQ8PDMyLXN8ZT4+PnMpPj4+MH0sdGwucm90cjY0X2xvPWZ1bmN0aW9uKGUsdCxzKXtyZXR1cm4gKGU8PDMyLXN8dD4+PnMpPj4+MH0sdGwuc2hyNjRfaGk9ZnVuY3Rpb24oZSx0LHMpe3JldHVybiBlPj4+c30sdGwuc2hyNjRfbG89ZnVuY3Rpb24oZSx0LHMpe3JldHVybiAoZTw8MzItc3x0Pj4+cyk+Pj4wfTt2YXIgZGw9e30scGw9dGwsZmw9c2w7ZnVuY3Rpb24gbWwoKXt0aGlzLnBlbmRpbmc9bnVsbCx0aGlzLnBlbmRpbmdUb3RhbD0wLHRoaXMuYmxvY2tTaXplPXRoaXMuY29uc3RydWN0b3IuYmxvY2tTaXplLHRoaXMub3V0U2l6ZT10aGlzLmNvbnN0cnVjdG9yLm91dFNpemUsdGhpcy5obWFjU3RyZW5ndGg9dGhpcy5jb25zdHJ1Y3Rvci5obWFjU3RyZW5ndGgsdGhpcy5wYWRMZW5ndGg9dGhpcy5jb25zdHJ1Y3Rvci5wYWRMZW5ndGgvOCx0aGlzLmVuZGlhbj0iYmlnIix0aGlzLl9kZWx0YTg9dGhpcy5ibG9ja1NpemUvOCx0aGlzLl9kZWx0YTMyPXRoaXMuYmxvY2tTaXplLzMyO31kbC5CbG9ja0hhc2g9bWwsbWwucHJvdG90eXBlLnVwZGF0ZT1mdW5jdGlvbihlLHQpe2lmKGU9cGwudG9BcnJheShlLHQpLHRoaXMucGVuZGluZz90aGlzLnBlbmRpbmc9dGhpcy5wZW5kaW5nLmNvbmNhdChlKTp0aGlzLnBlbmRpbmc9ZSx0aGlzLnBlbmRpbmdUb3RhbCs9ZS5sZW5ndGgsdGhpcy5wZW5kaW5nLmxlbmd0aD49dGhpcy5fZGVsdGE4KXt2YXIgcz0oZT10aGlzLnBlbmRpbmcpLmxlbmd0aCV0aGlzLl9kZWx0YTg7dGhpcy5wZW5kaW5nPWUuc2xpY2UoZS5sZW5ndGgtcyxlLmxlbmd0aCksMD09PXRoaXMucGVuZGluZy5sZW5ndGgmJih0aGlzLnBlbmRpbmc9bnVsbCksZT1wbC5qb2luMzIoZSwwLGUubGVuZ3RoLXMsdGhpcy5lbmRpYW4pO2Zvcih2YXIgaT0wO2k8ZS5sZW5ndGg7aSs9dGhpcy5fZGVsdGEzMil0aGlzLl91cGRhdGUoZSxpLGkrdGhpcy5fZGVsdGEzMik7fXJldHVybiB0aGlzfSxtbC5wcm90b3R5cGUuZGlnZXN0PWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnVwZGF0ZSh0aGlzLl9wYWQoKSksZmwobnVsbD09PXRoaXMucGVuZGluZyksdGhpcy5fZGlnZXN0KGUpfSxtbC5wcm90b3R5cGUuX3BhZD1mdW5jdGlvbigpe3ZhciBlPXRoaXMucGVuZGluZ1RvdGFsLHQ9dGhpcy5fZGVsdGE4LHM9dC0oZSt0aGlzLnBhZExlbmd0aCkldCxpPW5ldyBBcnJheShzK3RoaXMucGFkTGVuZ3RoKTtpWzBdPTEyODtmb3IodmFyIG49MTtuPHM7bisrKWlbbl09MDtpZihlPDw9MywiYmlnIj09PXRoaXMuZW5kaWFuKXtmb3IodmFyIHI9ODtyPHRoaXMucGFkTGVuZ3RoO3IrKylpW24rK109MDtpW24rK109MCxpW24rK109MCxpW24rK109MCxpW24rK109MCxpW24rK109ZT4+PjI0JjI1NSxpW24rK109ZT4+PjE2JjI1NSxpW24rK109ZT4+PjgmMjU1LGlbbisrXT0yNTUmZTt9ZWxzZSBmb3IoaVtuKytdPTI1NSZlLGlbbisrXT1lPj4+OCYyNTUsaVtuKytdPWU+Pj4xNiYyNTUsaVtuKytdPWU+Pj4yNCYyNTUsaVtuKytdPTAsaVtuKytdPTAsaVtuKytdPTAsaVtuKytdPTAscj04O3I8dGhpcy5wYWRMZW5ndGg7cisrKWlbbisrXT0wO3JldHVybiBpfTt2YXIgZ2w9e30seWw9dGwucm90cjMyO2Z1bmN0aW9uIHhsKGUsdCxzKXtyZXR1cm4gZSZ0Xn5lJnN9ZnVuY3Rpb24gRWwoZSx0LHMpe3JldHVybiBlJnReZSZzXnQmc31mdW5jdGlvbiBibChlLHQscyl7cmV0dXJuIGVedF5zfWdsLmZ0XzE9ZnVuY3Rpb24oZSx0LHMsaSl7cmV0dXJuIDA9PT1lP3hsKHQscyxpKToxPT09ZXx8Mz09PWU/YmwodCxzLGkpOjI9PT1lP0VsKHQscyxpKTp2b2lkIDB9LGdsLmNoMzI9eGwsZ2wubWFqMzI9RWwsZ2wucDMyPWJsLGdsLnMwXzI1Nj1mdW5jdGlvbihlKXtyZXR1cm4geWwoZSwyKV55bChlLDEzKV55bChlLDIyKX0sZ2wuczFfMjU2PWZ1bmN0aW9uKGUpe3JldHVybiB5bChlLDYpXnlsKGUsMTEpXnlsKGUsMjUpfSxnbC5nMF8yNTY9ZnVuY3Rpb24oZSl7cmV0dXJuIHlsKGUsNyleeWwoZSwxOCleZT4+PjN9LGdsLmcxXzI1Nj1mdW5jdGlvbihlKXtyZXR1cm4geWwoZSwxNyleeWwoZSwxOSleZT4+PjEwfTt2YXIgdmw9dGwsU2w9ZGwsQWw9Z2wsa2w9c2wsSWw9dmwuc3VtMzIsd2w9dmwuc3VtMzJfNCxQbD12bC5zdW0zMl81LENsPUFsLmNoMzIsJGw9QWwubWFqMzIsTmw9QWwuczBfMjU2LF9sPUFsLnMxXzI1NixSbD1BbC5nMF8yNTYsTWw9QWwuZzFfMjU2LE9sPVNsLkJsb2NrSGFzaCxEbD1bMTExNjM1MjQwOCwxODk5NDQ3NDQxLDMwNDkzMjM0NzEsMzkyMTAwOTU3Myw5NjE5ODcxNjMsMTUwODk3MDk5MywyNDUzNjM1NzQ4LDI4NzA3NjMyMjEsMzYyNDM4MTA4MCwzMTA1OTg0MDEsNjA3MjI1Mjc4LDE0MjY4ODE5ODcsMTkyNTA3ODM4OCwyMTYyMDc4MjA2LDI2MTQ4ODgxMDMsMzI0ODIyMjU4MCwzODM1MzkwNDAxLDQwMjIyMjQ3NzQsMjY0MzQ3MDc4LDYwNDgwNzYyOCw3NzAyNTU5ODMsMTI0OTE1MDEyMiwxNTU1MDgxNjkyLDE5OTYwNjQ5ODYsMjU1NDIyMDg4MiwyODIxODM0MzQ5LDI5NTI5OTY4MDgsMzIxMDMxMzY3MSwzMzM2NTcxODkxLDM1ODQ1Mjg3MTEsMTEzOTI2OTkzLDMzODI0MTg5NSw2NjYzMDcyMDUsNzczNTI5OTEyLDEyOTQ3NTczNzIsMTM5NjE4MjI5MSwxNjk1MTgzNzAwLDE5ODY2NjEwNTEsMjE3NzAyNjM1MCwyNDU2OTU2MDM3LDI3MzA0ODU5MjEsMjgyMDMwMjQxMSwzMjU5NzMwODAwLDMzNDU3NjQ3NzEsMzUxNjA2NTgxNywzNjAwMzUyODA0LDQwOTQ1NzE5MDksMjc1NDIzMzQ0LDQzMDIyNzczNCw1MDY5NDg2MTYsNjU5MDYwNTU2LDg4Mzk5Nzg3Nyw5NTgxMzk1NzEsMTMyMjgyMjIxOCwxNTM3MDAyMDYzLDE3NDc4NzM3NzksMTk1NTU2MjIyMiwyMDI0MTA0ODE1LDIyMjc3MzA0NTIsMjM2MTg1MjQyNCwyNDI4NDM2NDc0LDI3NTY3MzQxODcsMzIwNDAzMTQ3OSwzMzI5MzI1Mjk4XTtmdW5jdGlvbiBMbCgpe2lmKCEodGhpcyBpbnN0YW5jZW9mIExsKSlyZXR1cm4gbmV3IExsO09sLmNhbGwodGhpcyksdGhpcy5oPVsxNzc5MDMzNzAzLDMxNDQxMzQyNzcsMTAxMzkwNDI0MiwyNzczNDgwNzYyLDEzNTk4OTMxMTksMjYwMDgyMjkyNCw1Mjg3MzQ2MzUsMTU0MTQ1OTIyNV0sdGhpcy5rPURsLHRoaXMuVz1uZXcgQXJyYXkoNjQpO312bC5pbmhlcml0cyhMbCxPbCk7dmFyIFRsPUxsO0xsLmJsb2NrU2l6ZT01MTIsTGwub3V0U2l6ZT0yNTYsTGwuaG1hY1N0cmVuZ3RoPTE5MixMbC5wYWRMZW5ndGg9NjQsTGwucHJvdG90eXBlLl91cGRhdGU9ZnVuY3Rpb24oZSx0KXtmb3IodmFyIHM9dGhpcy5XLGk9MDtpPDE2O2krKylzW2ldPWVbdCtpXTtmb3IoO2k8cy5sZW5ndGg7aSsrKXNbaV09d2woTWwoc1tpLTJdKSxzW2ktN10sUmwoc1tpLTE1XSksc1tpLTE2XSk7dmFyIG49dGhpcy5oWzBdLHI9dGhpcy5oWzFdLG89dGhpcy5oWzJdLGE9dGhpcy5oWzNdLGw9dGhpcy5oWzRdLGM9dGhpcy5oWzVdLGg9dGhpcy5oWzZdLHU9dGhpcy5oWzddO2ZvcihrbCh0aGlzLmsubGVuZ3RoPT09cy5sZW5ndGgpLGk9MDtpPHMubGVuZ3RoO2krKyl7dmFyIGQ9UGwodSxfbChsKSxDbChsLGMsaCksdGhpcy5rW2ldLHNbaV0pLHA9SWwoTmwobiksJGwobixyLG8pKTt1PWgsaD1jLGM9bCxsPUlsKGEsZCksYT1vLG89cixyPW4sbj1JbChkLHApO310aGlzLmhbMF09SWwodGhpcy5oWzBdLG4pLHRoaXMuaFsxXT1JbCh0aGlzLmhbMV0sciksdGhpcy5oWzJdPUlsKHRoaXMuaFsyXSxvKSx0aGlzLmhbM109SWwodGhpcy5oWzNdLGEpLHRoaXMuaFs0XT1JbCh0aGlzLmhbNF0sbCksdGhpcy5oWzVdPUlsKHRoaXMuaFs1XSxjKSx0aGlzLmhbNl09SWwodGhpcy5oWzZdLGgpLHRoaXMuaFs3XT1JbCh0aGlzLmhbN10sdSk7fSxMbC5wcm90b3R5cGUuX2RpZ2VzdD1mdW5jdGlvbihlKXtyZXR1cm4gImhleCI9PT1lP3ZsLnRvSGV4MzIodGhpcy5oLCJiaWciKTp2bC5zcGxpdDMyKHRoaXMuaCwiYmlnIil9O3ZhciBWbD10KFRsKTtjb25zdCBCbD0oKT0+VmwoKTthc3luYyBmdW5jdGlvbiB6bChlLHQscyxpLG4peyRvKCJyZW5kZXIgY2h1bmtzIiwyKSxmdW5jdGlvbihlKXtmb3IoY29uc3QgdCBvZiBlKXQuZmFjYWRlTW9kdWxlJiZ0LmZhY2FkZU1vZHVsZS5pc1VzZXJEZWZpbmVkRW50cnlQb2ludCYmdC5nZXRQcmVsaW1pbmFyeUZpbGVOYW1lKCk7fShlKTtjb25zdCByPWF3YWl0IFByb21pc2UuYWxsKGUubWFwKChlPT5lLnJlbmRlcigpKSkpO05vKCJyZW5kZXIgY2h1bmtzIiwyKSwkbygidHJhbnNmb3JtIGNodW5rcyIsMik7Y29uc3Qgbz1mdW5jdGlvbihlKXtyZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKGUubWFwKChlPT57Y29uc3QgdD1lLmdldFJlbmRlcmVkQ2h1bmtJbmZvKCk7cmV0dXJuIFt0LmZpbGVOYW1lLHRdfSkpKX0oZSkse25vbkhhc2hlZENodW5rc1dpdGhQbGFjZWhvbGRlcnM6YSxyZW5kZXJlZENodW5rc0J5UGxhY2Vob2xkZXI6bCxoYXNoRGVwZW5kZW5jaWVzQnlQbGFjZWhvbGRlcjpjfT1hd2FpdCBhc3luYyBmdW5jdGlvbihlLHQscyxpLG4pe2NvbnN0IHI9W10sbz1uZXcgTWFwLGE9bmV3IE1hcCxsPW5ldyBTZXQ7Zm9yKGNvbnN0e3ByZWxpbWluYXJ5RmlsZU5hbWU6e2hhc2hQbGFjZWhvbGRlcjp0fX1vZiBlKXQmJmwuYWRkKHQpO3JldHVybiBhd2FpdCBQcm9taXNlLmFsbChlLm1hcCgoYXN5bmMoe2NodW5rOmUscHJlbGltaW5hcnlGaWxlTmFtZTp7ZmlsZU5hbWU6YyxoYXNoUGxhY2Vob2xkZXI6aH0sbWFnaWNTdHJpbmc6dSx1c2VkTW9kdWxlczpkfSk9Pntjb25zdCBwPXtjaHVuazplLGZpbGVOYW1lOmMsLi4uYXdhaXQgRmwodSxjLGQsdCxzLGksbil9LHtjb2RlOmZ9PXA7aWYoaCl7Y29uc3R7Y29udGFpbmVkUGxhY2Vob2xkZXJzOnQsdHJhbnNmb3JtZWRDb2RlOnN9PWthKGYsbCksbj1CbCgpLnVwZGF0ZShzKSxyPWkuaG9va1JlZHVjZVZhbHVlU3luYygiYXVnbWVudENodW5rSGFzaCIsIiIsW2UuZ2V0UmVuZGVyZWRDaHVua0luZm8oKV0sKChlLHQpPT4odCYmKGUrPXQpLGUpKSk7ciYmbi51cGRhdGUociksby5zZXQoaCxwKSxhLnNldChoLHtjb250YWluZWRQbGFjZWhvbGRlcnM6dCxjb250ZW50SGFzaDpuLmRpZ2VzdCgiaGV4Iil9KTt9ZWxzZSByLnB1c2gocCk7fSkpKSx7aGFzaERlcGVuZGVuY2llc0J5UGxhY2Vob2xkZXI6YSxub25IYXNoZWRDaHVua3NXaXRoUGxhY2Vob2xkZXJzOnIscmVuZGVyZWRDaHVua3NCeVBsYWNlaG9sZGVyOm99fShyLG8saSxzLG4pLGg9ZnVuY3Rpb24oZSx0LHMpe2NvbnN0IGk9bmV3IE1hcDtmb3IoY29uc3Rbbix7ZmlsZU5hbWU6cn1db2YgZSl7bGV0IGU9QmwoKTtjb25zdCBvPW5ldyBTZXQoW25dKTtmb3IoY29uc3QgcyBvZiBvKXtjb25zdHtjb250YWluZWRQbGFjZWhvbGRlcnM6aSxjb250ZW50SGFzaDpufT10LmdldChzKTtlLnVwZGF0ZShuKTtmb3IoY29uc3QgZSBvZiBpKW8uYWRkKGUpO31sZXQgYSxsO2Rve2wmJihlPUJsKCkudXBkYXRlKGwpKSxsPWUuZGlnZXN0KCJoZXgiKS5zbGljZSgwLG4ubGVuZ3RoKSxhPUFhKHIsbixsKTt9d2hpbGUoc1tJYV0uaGFzKGEudG9Mb3dlckNhc2UoKSkpO3NbYV09d2EsaS5zZXQobixsKTt9cmV0dXJuIGl9KGwsYyx0KTshZnVuY3Rpb24oZSx0LHMsaSxuLHIpe2Zvcihjb25zdHtjaHVuazppLGNvZGU6byxmaWxlTmFtZTphLG1hcDpsfW9mIGUudmFsdWVzKCkpe2xldCBlPVNhKG8sdCk7Y29uc3QgYz1TYShhLHQpO2wmJihsLmZpbGU9U2EobC5maWxlLHQpLGUrPWpsKGMsbCxuLHIpKSxzW2NdPWkuZmluYWxpemVDaHVuayhlLGwsdCk7fWZvcihjb25zdHtjaHVuazplLGNvZGU6byxmaWxlTmFtZTphLG1hcDpsfW9mIGkpe2xldCBpPXQuc2l6ZT4wP1NhKG8sdCk6bztsJiYoaSs9amwoYSxsLG4scikpLHNbYV09ZS5maW5hbGl6ZUNodW5rKGksbCx0KTt9fShsLGgsdCxhLHMsaSksTm8oInRyYW5zZm9ybSBjaHVua3MiLDIpO31hc3luYyBmdW5jdGlvbiBGbChlLHQscyxpLG4scixvKXtsZXQgYT1udWxsO2NvbnN0IGM9W107bGV0IGg9YXdhaXQgci5ob29rUmVkdWNlQXJnMCgicmVuZGVyQ2h1bmsiLFtlLnRvU3RyaW5nKCksaVt0XSxuLHtjaHVua3M6aX1dLCgoZSx0LHMpPT57aWYobnVsbD09dClyZXR1cm4gZTtpZigic3RyaW5nIj09dHlwZW9mIHQmJih0PXtjb2RlOnQsbWFwOnZvaWQgMH0pLG51bGwhPT10Lm1hcCl7Y29uc3QgZT14byh0Lm1hcCk7Yy5wdXNoKGV8fHttaXNzaW5nOiEwLHBsdWdpbjpzLm5hbWV9KTt9cmV0dXJuIHQuY29kZX0pKTtjb25zdHtjb21wYWN0OnUsZGlyOmQsZmlsZTpwLHNvdXJjZW1hcDpmLHNvdXJjZW1hcEV4Y2x1ZGVTb3VyY2VzOm0sc291cmNlbWFwRmlsZTpnLHNvdXJjZW1hcFBhdGhUcmFuc2Zvcm06eSxzb3VyY2VtYXBJZ25vcmVMaXN0Onh9PW47aWYodXx8IlxuIj09PWhbaC5sZW5ndGgtMV18fChoKz0iXG4iKSxmKXtsZXQgaTskbygic291cmNlbWFwcyIsMyksaT1wP04kNShnfHxwKTpkP04kNShkLHQpOk4kNSh0KTthPWZ1bmN0aW9uKGUsdCxzLGksbixyKXtjb25zdCBvPUphKHIpLGE9cy5maWx0ZXIoKGU9PiFlLmV4Y2x1ZGVGcm9tU291cmNlbWFwKSkubWFwKChlPT5lbChlLmlkLGUub3JpZ2luYWxDb2RlLGUub3JpZ2luYWxTb3VyY2VtYXAsZS5zb3VyY2VtYXBDaGFpbixvKSkpLGM9bmV3IFphKHQsYSksaD1pLnJlZHVjZShvLGMpO2xldHtzb3VyY2VzOnUsc291cmNlc0NvbnRlbnQ6ZCxuYW1lczpwLG1hcHBpbmdzOmZ9PWgudHJhY2VNYXBwaW5ncygpO2lmKGUpe2NvbnN0IHQ9UChlKTt1PXUubWFwKChlPT4kKHQsZSkpKSxlPXcoZSk7fWQ9bj9udWxsOmQ7Zm9yKGNvbnN0IGUgb2Ygcyl5byhlLm9yaWdpbmFsU291cmNlbWFwLGUuc291cmNlbWFwQ2hhaW4pO3JldHVybiBuZXcgbCh7ZmlsZTplLG1hcHBpbmdzOmYsbmFtZXM6cCxzb3VyY2VzOnUsc291cmNlc0NvbnRlbnQ6ZH0pfShpLGUuZ2VuZXJhdGVEZWNvZGVkTWFwKHt9KSxzLGMsbSxvKTtmb3IobGV0IGU9MDtlPGEuc291cmNlcy5sZW5ndGg7KytlKXtsZXQgdD1hLnNvdXJjZXNbZV07Y29uc3Qgcz1gJHtpfS5tYXBgLG49eCh0LHMpOyJib29sZWFuIiE9dHlwZW9mIG4mJlllKEt0KCJzb3VyY2VtYXBJZ25vcmVMaXN0IGZ1bmN0aW9uIG11c3QgcmV0dXJuIGEgYm9vbGVhbi4iKSksbiYmKHZvaWQgMD09PWEueF9nb29nbGVfaWdub3JlTGlzdCYmKGEueF9nb29nbGVfaWdub3JlTGlzdD1bXSksYS54X2dvb2dsZV9pZ25vcmVMaXN0LmluY2x1ZGVzKGUpfHxhLnhfZ29vZ2xlX2lnbm9yZUxpc3QucHVzaChlKSkseSYmKHQ9eSh0LHMpLCJzdHJpbmciIT10eXBlb2YgdCYmWWUoS3QoInNvdXJjZW1hcFBhdGhUcmFuc2Zvcm0gZnVuY3Rpb24gbXVzdCByZXR1cm4gYSBzdHJpbmcuIikpKSxhLnNvdXJjZXNbZV09SSh0KTt9Tm8oInNvdXJjZW1hcHMiLDMpO31yZXR1cm4ge2NvZGU6aCxtYXA6YX19ZnVuY3Rpb24gamwoZSx0LHMse3NvdXJjZW1hcDppLHNvdXJjZW1hcEJhc2VVcmw6bn0pe2xldCByO2lmKCJpbmxpbmUiPT09aSlyPXQudG9VcmwoKTtlbHNlIHtjb25zdCBpPWAke3coZSl9Lm1hcGA7cj1uP25ldyBVUkwoaSxuKS50b1N0cmluZygpOmkscy5lbWl0RmlsZSh7ZmlsZU5hbWU6YCR7ZX0ubWFwYCxzb3VyY2U6dC50b1N0cmluZygpLHR5cGU6ImFzc2V0In0pO31yZXR1cm4gImhpZGRlbiI9PT1pPyIiOmAvLyMgJHtCc309JHtyfVxuYH1jbGFzcyBVbHtjb25zdHJ1Y3RvcihlLHQscyxpLG4pe3RoaXMub3V0cHV0T3B0aW9ucz1lLHRoaXMudW5zZXRPcHRpb25zPXQsdGhpcy5pbnB1dE9wdGlvbnM9cyx0aGlzLnBsdWdpbkRyaXZlcj1pLHRoaXMuZ3JhcGg9bix0aGlzLmZhY2FkZUNodW5rQnlNb2R1bGU9bmV3IE1hcCx0aGlzLmluY2x1ZGVkTmFtZXNwYWNlcz1uZXcgU2V0O31hc3luYyBnZW5lcmF0ZShlKXskbygiR0VORVJBVEUiLDEpO2NvbnN0IHQ9T2JqZWN0LmNyZWF0ZShudWxsKSxzPShlPT57Y29uc3QgdD1uZXcgU2V0O3JldHVybiBuZXcgUHJveHkoZSx7ZGVsZXRlUHJvcGVydHk6KGUscyk9Pigic3RyaW5nIj09dHlwZW9mIHMmJnQuZGVsZXRlKHMudG9Mb3dlckNhc2UoKSksUmVmbGVjdC5kZWxldGVQcm9wZXJ0eShlLHMpKSxnZXQ6KGUscyk9PnM9PT1JYT90OlJlZmxlY3QuZ2V0KGUscyksc2V0OihlLHMsaSk9Pigic3RyaW5nIj09dHlwZW9mIHMmJnQuYWRkKHMudG9Mb3dlckNhc2UoKSksUmVmbGVjdC5zZXQoZSxzLGkpKX0pfSkodCk7dGhpcy5wbHVnaW5Ecml2ZXIuc2V0T3V0cHV0QnVuZGxlKHMsdGhpcy5vdXRwdXRPcHRpb25zKTt0cnl7JG8oImluaXRpYWxpemUgcmVuZGVyIiwyKSxhd2FpdCB0aGlzLnBsdWdpbkRyaXZlci5ob29rUGFyYWxsZWwoInJlbmRlclN0YXJ0IixbdGhpcy5vdXRwdXRPcHRpb25zLHRoaXMuaW5wdXRPcHRpb25zXSksTm8oImluaXRpYWxpemUgcmVuZGVyIiwyKSwkbygiZ2VuZXJhdGUgY2h1bmtzIiwyKTtjb25zdCBlPSgoKT0+e2xldCBlPTA7cmV0dXJuICh0LHM9OCk9PntpZihzPjY0KXJldHVybiBZZShLdChgSGFzaGVzIGNhbm5vdCBiZSBsb25nZXIgdGhhbiA2NCBjaGFyYWN0ZXJzLCByZWNlaXZlZCAke3N9LiBDaGVjayB0aGUgIiR7dH0iIG9wdGlvbi5gKSk7Y29uc3QgaT1gJHtFYX0ke01pKCsrZSkucGFkU3RhcnQocy01LCIwIil9JHtiYX1gO3JldHVybiBpLmxlbmd0aD5zP1llKEt0KGBUbyBnZW5lcmF0ZSBoYXNoZXMgZm9yIHRoaXMgbnVtYmVyIG9mIGNodW5rcyAoY3VycmVudGx5ICR7ZX0pLCB5b3UgbmVlZCBhIG1pbmltdW0gaGFzaCBzaXplIG9mICR7aS5sZW5ndGh9LCByZWNlaXZlZCAke3N9LiBDaGVjayB0aGUgIiR7dH0iIG9wdGlvbi5gKSk6aX19KSgpLHQ9YXdhaXQgdGhpcy5nZW5lcmF0ZUNodW5rcyhzLGUpO3QubGVuZ3RoPjEmJmZ1bmN0aW9uKGUsdCl7aWYoInVtZCI9PT1lLmZvcm1hdHx8ImlpZmUiPT09ZS5mb3JtYXQpcmV0dXJuIFllKHp0KCJvdXRwdXQuZm9ybWF0Iix6ZSwiVU1EIGFuZCBJSUZFIG91dHB1dCBmb3JtYXRzIGFyZSBub3Qgc3VwcG9ydGVkIGZvciBjb2RlLXNwbGl0dGluZyBidWlsZHMiLGUuZm9ybWF0KSk7aWYoInN0cmluZyI9PXR5cGVvZiBlLmZpbGUpcmV0dXJuIFllKHp0KCJvdXRwdXQuZmlsZSIsVGUsJ3doZW4gYnVpbGRpbmcgbXVsdGlwbGUgY2h1bmtzLCB0aGUgIm91dHB1dC5kaXIiIG9wdGlvbiBtdXN0IGJlIHVzZWQsIG5vdCAib3V0cHV0LmZpbGUiLiBUbyBpbmxpbmUgZHluYW1pYyBpbXBvcnRzLCBzZXQgdGhlICJpbmxpbmVEeW5hbWljSW1wb3J0cyIgb3B0aW9uJykpO2lmKGUuc291cmNlbWFwRmlsZSlyZXR1cm4gWWUoenQoIm91dHB1dC5zb3VyY2VtYXBGaWxlIixIZSwnIm91dHB1dC5zb3VyY2VtYXBGaWxlIiBpcyBvbmx5IHN1cHBvcnRlZCBmb3Igc2luZ2xlLWZpbGUgYnVpbGRzJykpOyFlLmFtZC5hdXRvSWQmJmUuYW1kLmlkJiZ0KHZlLHp0KCJvdXRwdXQuYW1kLmlkIixMZSwndGhpcyBvcHRpb24gaXMgb25seSBwcm9wZXJseSBzdXBwb3J0ZWQgZm9yIHNpbmdsZS1maWxlIGJ1aWxkcy4gVXNlICJvdXRwdXQuYW1kLmF1dG9JZCIgYW5kICJvdXRwdXQuYW1kLmJhc2VQYXRoIiBpbnN0ZWFkJykpO30odGhpcy5vdXRwdXRPcHRpb25zLHRoaXMuaW5wdXRPcHRpb25zLm9uTG9nKSx0aGlzLnBsdWdpbkRyaXZlci5zZXRDaHVua0luZm9ybWF0aW9uKHRoaXMuZmFjYWRlQ2h1bmtCeU1vZHVsZSk7Zm9yKGNvbnN0IGUgb2YgdCllLmdlbmVyYXRlRXhwb3J0cygpO05vKCJnZW5lcmF0ZSBjaHVua3MiLDIpLGF3YWl0IHpsKHQscyx0aGlzLnBsdWdpbkRyaXZlcix0aGlzLm91dHB1dE9wdGlvbnMsdGhpcy5pbnB1dE9wdGlvbnMub25Mb2cpO31jYXRjaChlKXt0aHJvdyBhd2FpdCB0aGlzLnBsdWdpbkRyaXZlci5ob29rUGFyYWxsZWwoInJlbmRlckVycm9yIixbZV0pLGV9cmV0dXJuIChlPT57Y29uc3QgdD1uZXcgU2V0LHM9T2JqZWN0LnZhbHVlcyhlKTtmb3IoY29uc3QgZSBvZiBzKSJhc3NldCI9PT1lLnR5cGUmJmUubmVlZHNDb2RlUmVmZXJlbmNlJiZ0LmFkZChlLmZpbGVOYW1lKTtmb3IoY29uc3QgZSBvZiBzKWlmKCJjaHVuayI9PT1lLnR5cGUpZm9yKGNvbnN0IHMgb2YgZS5yZWZlcmVuY2VkRmlsZXMpdC5oYXMocykmJnQuZGVsZXRlKHMpO2Zvcihjb25zdCBzIG9mIHQpZGVsZXRlIGVbc107fSkocyksJG8oImdlbmVyYXRlIGJ1bmRsZSIsMiksYXdhaXQgdGhpcy5wbHVnaW5Ecml2ZXIuaG9va1NlcSgiZ2VuZXJhdGVCdW5kbGUiLFt0aGlzLm91dHB1dE9wdGlvbnMscyxlXSksdGhpcy5maW5hbGlzZUFzc2V0cyhzKSxObygiZ2VuZXJhdGUgYnVuZGxlIiwyKSxObygiR0VORVJBVEUiLDEpLHR9YXN5bmMgYWRkTWFudWFsQ2h1bmtzKGUpe2NvbnN0IHQ9bmV3IE1hcCxzPWF3YWl0IFByb21pc2UuYWxsKE9iamVjdC5lbnRyaWVzKGUpLm1hcCgoYXN5bmMoW2UsdF0pPT4oe2FsaWFzOmUsZW50cmllczphd2FpdCB0aGlzLmdyYXBoLm1vZHVsZUxvYWRlci5hZGRBZGRpdGlvbmFsTW9kdWxlcyh0LCEwKX0pKSkpO2Zvcihjb25zdHthbGlhczplLGVudHJpZXM6aX1vZiBzKWZvcihjb25zdCBzIG9mIGkpR2woZSxzLHQpO3JldHVybiB0fWFzc2lnbk1hbnVhbENodW5rcyhlKXtjb25zdCB0PVtdLHM9e2dldE1vZHVsZUlkczooKT0+dGhpcy5ncmFwaC5tb2R1bGVzQnlJZC5rZXlzKCksZ2V0TW9kdWxlSW5mbzp0aGlzLmdyYXBoLmdldE1vZHVsZUluZm99O2Zvcihjb25zdCBpIG9mIHRoaXMuZ3JhcGgubW9kdWxlc0J5SWQudmFsdWVzKCkpaWYoaSBpbnN0YW5jZW9mIFRvKXtjb25zdCBuPWUoaS5pZCxzKTsic3RyaW5nIj09dHlwZW9mIG4mJnQucHVzaChbbixpXSk7fXQuc29ydCgoKFtlXSxbdF0pPT5lPnQ/MTplPHQ/LTE6MCkpO2NvbnN0IGk9bmV3IE1hcDtmb3IoY29uc3RbZSxzXW9mIHQpR2woZSxzLGkpO3JldHVybiBpfWZpbmFsaXNlQXNzZXRzKGUpe2lmKHRoaXMub3V0cHV0T3B0aW9ucy52YWxpZGF0ZSlmb3IoY29uc3QgdCBvZiBPYmplY3QudmFsdWVzKGUpKWlmKCJjb2RlImluIHQpdHJ5e3RoaXMuZ3JhcGguY29udGV4dFBhcnNlKHQuY29kZSx7ZWNtYVZlcnNpb246ImxhdGVzdCJ9KTt9Y2F0Y2goZSl7dGhpcy5pbnB1dE9wdGlvbnMub25Mb2codmUsTXQodCxlKSk7fXRoaXMucGx1Z2luRHJpdmVyLmZpbmFsaXNlQXNzZXRzKCk7fWFzeW5jIGdlbmVyYXRlQ2h1bmtzKGUsdCl7Y29uc3R7ZXhwZXJpbWVudGFsTWluQ2h1bmtTaXplOnMsaW5saW5lRHluYW1pY0ltcG9ydHM6aSxtYW51YWxDaHVua3M6bixwcmVzZXJ2ZU1vZHVsZXM6cn09dGhpcy5vdXRwdXRPcHRpb25zLG89Im9iamVjdCI9PXR5cGVvZiBuP2F3YWl0IHRoaXMuYWRkTWFudWFsQ2h1bmtzKG4pOnRoaXMuYXNzaWduTWFudWFsQ2h1bmtzKG4pLGE9ZnVuY3Rpb24oe2NvbXBhY3Q6ZSxnZW5lcmF0ZWRDb2RlOnthcnJvd0Z1bmN0aW9uczp0LGNvbnN0QmluZGluZ3M6cyxvYmplY3RTaG9ydGhhbmQ6aSxyZXNlcnZlZE5hbWVzQXNQcm9wczpufX0pe2NvbnN0e186cixuOm8sczphfT1lP3tfOiIiLG46IiIsczoiIn06e186IiAiLG46IlxuIixzOiI7In0sbD1zPyJjb25zdCI6InZhciIsYz0oZSx7aXNBc3luYzp0LG5hbWU6c30pPT5gJHt0PyJhc3luYyAiOiIifWZ1bmN0aW9uJHtzP2AgJHtzfWA6IiJ9JHtyfSgke2Uuam9pbihgLCR7cn1gKX0pJHtyfWAsaD10PyhlLHtpc0FzeW5jOnQsbmFtZTpzfSk9Pntjb25zdCBpPTE9PT1lLmxlbmd0aDtyZXR1cm4gYCR7cz9gJHtsfSAke3N9JHtyfT0ke3J9YDoiIn0ke3Q/YGFzeW5jJHtpPyIgIjpyfWA6IiJ9JHtpP2VbMF06YCgke2Uuam9pbihgLCR7cn1gKX0pYH0ke3J9PT4ke3J9YH06Yyx1PShlLHtmdW5jdGlvblJldHVybjpzLGxpbmVCcmVha0luZGVudDppLG5hbWU6bn0pPT5bYCR7aChlLHtpc0FzeW5jOiExLG5hbWU6bn0pfSR7dD9pP2Ake299JHtpLmJhc2V9JHtpLnR9YDoiIjpgeyR7aT9gJHtvfSR7aS5iYXNlfSR7aS50fWA6cn0ke3M/InJldHVybiAiOiIifWB9YCx0P2Ake24/IjsiOiIifSR7aT9gJHtvfSR7aS5iYXNlfWA6IiJ9YDpgJHthfSR7aT9gJHtvfSR7aS5iYXNlfWA6cn19YF0sZD1uP2U9PlhhLnRlc3QoZSk6ZT0+IXllLmhhcyhlKSYmWGEudGVzdChlKTtyZXR1cm4ge186cixjbnN0OmwsZ2V0RGlyZWN0UmV0dXJuRnVuY3Rpb246dSxnZXREaXJlY3RSZXR1cm5JaWZlTGVmdDooZSxzLHtuZWVkc0Fycm93UmV0dXJuUGFyZW5zOmksbmVlZHNXcmFwcGVkRnVuY3Rpb246bn0pPT57Y29uc3RbcixvXT11KGUse2Z1bmN0aW9uUmV0dXJuOiEwLGxpbmVCcmVha0luZGVudDpudWxsLG5hbWU6bnVsbH0pO3JldHVybiBgJHtZYShgJHtyfSR7WWEocyx0JiZpKX0ke299YCx0fHxuKX0oYH0sZ2V0RnVuY3Rpb25JbnRybzpoLGdldE5vbkFycm93RnVuY3Rpb25JbnRybzpjLGdldE9iamVjdChlLHtsaW5lQnJlYWtJbmRlbnQ6dH0pe2NvbnN0IHM9dD9gJHtvfSR7dC5iYXNlfSR7dC50fWA6cjtyZXR1cm4gYHske2UubWFwKCgoW2UsdF0pPT57aWYobnVsbD09PWUpcmV0dXJuIGAke3N9JHt0fWA7Y29uc3Qgbj0hZChlKTtyZXR1cm4gZT09PXQmJmkmJiFuP3MrZTpgJHtzfSR7bj9gJyR7ZX0nYDplfToke3J9JHt0fWB9KSkuam9pbigiLCIpfSR7MD09PWUubGVuZ3RoPyIiOnQ/YCR7b30ke3QuYmFzZX1gOnJ9fWB9LGdldFByb3BlcnR5QWNjZXNzOmU9PmQoZSk/YC4ke2V9YDpgWyR7SlNPTi5zdHJpbmdpZnkoZSl9XWAsbjpvLHM6YX19KHRoaXMub3V0cHV0T3B0aW9ucyksbD1mdW5jdGlvbihlKXtjb25zdCB0PVtdO2Zvcihjb25zdCBzIG9mIGUudmFsdWVzKCkpcyBpbnN0YW5jZW9mIFRvJiYocy5pc0luY2x1ZGVkKCl8fHMuaW5mby5pc0VudHJ5fHxzLmluY2x1ZGVkRHluYW1pY0ltcG9ydGVycy5sZW5ndGg+MCkmJnQucHVzaChzKTtyZXR1cm4gdH0odGhpcy5ncmFwaC5tb2R1bGVzQnlJZCksYz1mdW5jdGlvbihlKXtpZigwPT09ZS5sZW5ndGgpcmV0dXJuICIvIjtpZigxPT09ZS5sZW5ndGgpcmV0dXJuIFAoZVswXSk7Y29uc3QgdD1lLnNsaWNlKDEpLnJlZHVjZSgoKGUsdCk9Pntjb25zdCBzPXQuc3BsaXQoL1wvK3xcXCsvKTtsZXQgaTtmb3IoaT0wO2VbaV09PT1zW2ldJiZpPE1hdGgubWluKGUubGVuZ3RoLHMubGVuZ3RoKTtpKyspO3JldHVybiBlLnNsaWNlKDAsaSl9KSxlWzBdLnNwbGl0KC9cLyt8XFwrLykpO3JldHVybiB0Lmxlbmd0aD4xP3Quam9pbigiLyIpOiIvIn0oZnVuY3Rpb24oZSx0KXtjb25zdCBzPVtdO2Zvcihjb25zdCBpIG9mIGUpKGkuaW5mby5pc0VudHJ5fHx0KSYmQShpLmlkKSYmcy5wdXNoKGkuaWQpO3JldHVybiBzfShsLHIpKSxoPWZ1bmN0aW9uKGUsdCxzKXtjb25zdCBpPW5ldyBNYXA7Zm9yKGNvbnN0IG4gb2YgZS52YWx1ZXMoKSluIGluc3RhbmNlb2YgUXQmJmkuc2V0KG4sbmV3IHoobix0LHMpKTtyZXR1cm4gaX0odGhpcy5ncmFwaC5tb2R1bGVzQnlJZCx0aGlzLm91dHB1dE9wdGlvbnMsYyksdT1bXSxkPW5ldyBNYXA7Zm9yKGNvbnN0e2FsaWFzOm4sbW9kdWxlczpwfW9mIGk/W3thbGlhczpudWxsLG1vZHVsZXM6bH1dOnI/bC5tYXAoKGU9Pih7YWxpYXM6bnVsbCxtb2R1bGVzOltlXX0pKSk6VmEodGhpcy5ncmFwaC5lbnRyeU1vZHVsZXMsbyxzLHRoaXMuaW5wdXRPcHRpb25zLm9uTG9nKSl7cC5zb3J0KEhhKTtjb25zdCBzPW5ldyBfYShwLHRoaXMuaW5wdXRPcHRpb25zLHRoaXMub3V0cHV0T3B0aW9ucyx0aGlzLnVuc2V0T3B0aW9ucyx0aGlzLnBsdWdpbkRyaXZlcix0aGlzLmdyYXBoLm1vZHVsZXNCeUlkLGQsaCx0aGlzLmZhY2FkZUNodW5rQnlNb2R1bGUsdGhpcy5pbmNsdWRlZE5hbWVzcGFjZXMsbix0LGUsYyxhKTt1LnB1c2gocyk7fWZvcihjb25zdCBlIG9mIHUpZS5saW5rKCk7Y29uc3QgcD1bXTtmb3IoY29uc3QgZSBvZiB1KXAucHVzaCguLi5lLmdlbmVyYXRlRmFjYWRlcygpKTtyZXR1cm4gWy4uLnUsLi4ucF19fWZ1bmN0aW9uIEdsKGUsdCxzKXtjb25zdCBpPXMuZ2V0KHQpO2lmKCJzdHJpbmciPT10eXBlb2YgaSYmaSE9PWUpcmV0dXJuIFllKChuPXQuaWQscj1lLG89aSx7Y29kZTpsdCxtZXNzYWdlOmBDYW5ub3QgYXNzaWduICIke0wobil9IiB0byB0aGUgIiR7cn0iIGNodW5rIGFzIGl0IGlzIGFscmVhZHkgaW4gdGhlICIke299IiBjaHVuay5gfSkpO3ZhciBuLHIsbztzLnNldCh0LGUpO312YXIgV2w9WzUwOSwwLDIyNywwLDE1MCw0LDI5NCw5LDEzNjgsMiwyLDEsNiwzLDQxLDIsNSwwLDE2NiwxLDU3NCwzLDksOSwzNzAsMSw4MSwyLDcxLDEwLDUwLDMsMTIzLDIsNTQsMTQsMzIsMTAsMywxLDExLDMsNDYsMTAsOCwwLDQ2LDksNywyLDM3LDEzLDIsOSw2LDEsNDUsMCwxMywyLDQ5LDEzLDksMywyLDExLDgzLDExLDcsMCwzLDAsMTU4LDExLDYsOSw3LDMsNTYsMSwyLDYsMywxLDMsMiwxMCwwLDExLDEsMyw2LDQsNCwxOTMsMTcsMTAsOSw1LDAsODIsMTksMTMsOSwyMTQsNiwzLDgsMjgsMSw4MywxNiwxNiw5LDgyLDEyLDksOSw4NCwxNCw1LDksMjQzLDE0LDE2Niw5LDcxLDUsMiwxLDMsMywyLDAsMiwxLDEzLDksMTIwLDYsMyw2LDQsMCwyOSw5LDQxLDYsMiwzLDksMCwxMCwxMCw0NywxNSw0MDYsNywyLDcsMTcsOSw1NywyMSwyLDEzLDEyMyw1LDQsMCwyLDEsMiw2LDIsMCw5LDksNDksNCwyLDEsMiw0LDksOSwzMzAsMywxMCwxLDIsMCw0OSw2LDQsNCwxNCw5LDUzNTEsMCw3LDE0LDEzODM1LDksODcsOSwzOSw0LDYwLDYsMjYsOSwxMDE0LDAsMiw1NCw4LDMsODIsMCwxMiwxLDE5NjI4LDEsNDcwNiw0NSwzLDIyLDU0Myw0LDQsNSw5LDcsMyw2LDMxLDMsMTQ5LDIsMTQxOCw0OSw1MTMsNTQsNSw0OSw5LDAsMTUsMCwyMyw0LDIsMTQsMTM2MSw2LDIsMTYsMyw2LDIsMSwyLDQsMTAxLDAsMTYxLDYsMTAsOSwzNTcsMCw2MiwxMyw0OTksMTMsOTgzLDYsMTEwLDYsNiw5LDQ3NTksOSw3ODc3MTksMjM5XSxxbD1bMCwxMSwyLDI1LDIsMTgsMiwxLDIsMTQsMywxMywzNSwxMjIsNzAsNTIsMjY4LDI4LDQsNDgsNDgsMzEsMTQsMjksNiwzNywxMSwyOSwzLDM1LDUsNywyLDQsNDMsMTU3LDE5LDM1LDUsMzUsNSwzOSw5LDUxLDEzLDEwLDIsMTQsMiw2LDIsMSwyLDEwLDIsMTQsMiw2LDIsMSw2OCwzMTAsMTAsMjEsMTEsNywyNSw1LDIsNDEsMiw4LDcwLDUsMywwLDIsNDMsMiwxLDQsMCwzLDIyLDExLDIyLDEwLDMwLDY2LDE4LDIsMSwxMSwyMSwxMSwyNSw3MSw1NSw3LDEsNjUsMCwxNiwzLDIsMiwyLDI4LDQzLDI4LDQsMjgsMzYsNywyLDI3LDI4LDUzLDExLDIxLDExLDE4LDE0LDE3LDExMSw3Miw1Niw1MCwxNCw1MCwxNCwzNSwzNDksNDEsNywxLDc5LDI4LDExLDAsOSwyMSw0MywxNyw0NywyMCwyOCwyMiwxMyw1Miw1OCwxLDMsMCwxNCw0NCwzMywyNCwyNywzNSwzMCwwLDMsMCw5LDM0LDQsMCwxMyw0NywxNSwzLDIyLDAsMiwwLDM2LDE3LDIsMjQsMjAsMSw2NCw2LDIsMCwyLDMsMiwxNCwyLDksOCw0NiwzOSw3LDMsMSwzLDIxLDIsNiwyLDEsMiw0LDQsMCwxOSwwLDEzLDQsMTU5LDUyLDE5LDMsMjEsMiwzMSw0NywyMSwxLDIsMCwxODUsNDYsNDIsMywzNyw0NywyMSwwLDYwLDQyLDE0LDAsNzIsMjYsMzgsNiwxODYsNDMsMTE3LDYzLDMyLDcsMywwLDMsNywyLDEsMiwyMywxNiwwLDIsMCw5NSw3LDMsMzgsMTcsMCwyLDAsMjksMCwxMSwzOSw4LDAsMjIsMCwxMiw0NSwyMCwwLDE5LDcyLDI2NCw4LDIsMzYsMTgsMCw1MCwyOSwxMTMsNiwyLDEsMiwzNywyMiwwLDI2LDUsMiwxLDIsMzEsMTUsMCwzMjgsMTgsMTYsMCwyLDEyLDIsMzMsMTI1LDAsODAsOTIxLDEwMywxMTAsMTgsMTk1LDI2MzcsOTYsMTYsMTA3MSwxOCw1LDQwMjYsNTgyLDg2MzQsNTY4LDgsMzAsMTgsNzgsMTgsMjksMTksNDcsMTcsMywzMiwyMCw2LDE4LDY4OSw2MywxMjksNzQsNiwwLDY3LDEyLDY1LDEsMiwwLDI5LDYxMzUsOSwxMjM3LDQzLDgsODkzNiwzLDIsNiwyLDEsMiwyOTAsMTYsMCwzMCwyLDMsMCwxNSwzLDksMzk1LDIzMDksMTA2LDYsMTIsNCw4LDgsOSw1OTkxLDg0LDIsNzAsMiwxLDMsMCwzLDEsMywzLDIsMTEsMiwwLDIsNiwyLDY0LDIsMywzLDcsMiw2LDIsMjcsMiwzLDIsNCwyLDAsNCw2LDIsMzM5LDMsMjQsMiwyNCwyLDMwLDIsMjQsMiwzMCwyLDI0LDIsMzAsMiwyNCwyLDMwLDIsMjQsMiw3LDE4NDUsMzAsNyw1LDI2Miw2MSwxNDcsNDQsMTEsNiwxNywwLDMyMiwyOSwxOSw0Myw0ODUsMjcsNzU3LDYsMiwzLDIsMSwyLDE0LDIsMTk2LDYwLDY3LDgsMCwxMjA1LDMsMiwyNiwyLDEsMiwwLDMsMCwyLDksMiwzLDIsMCwyLDAsNywwLDUsMCwyLDAsMiwwLDIsMiwyLDEsMiwwLDMsMCwyLDAsMiwwLDIsMCwyLDAsMiwxLDIsMCwzLDMsMiw2LDIsMywyLDMsMiwwLDIsOSwyLDE2LDYsMiwyLDQsMiwxNiw0NDIxLDQyNzE5LDMzLDQxNTMsNywyMjEsMyw1NzYxLDE1LDc0NzIsMzEwNCw1NDEsMTUwNyw0OTM4LDYsNDE5MV0sSGw9IsKqwrXCusOALcOWw5gtw7bDuC3LgcuGLcuRy6Aty6TLrMuuzbAtzbTNts23zbotzb3Nv86GzogtzorOjM6OLc6hzqMtz7XPty3SgdKKLdSv1LEt1ZbVmdWgLdaI15At16rXry3XstigLdmK2a7Zr9mxLduT25Xbpdum267br9u6Ldu827/ckNySLdyv3Y0t3qXesd+KLd+q37Tftd+64KCALeCgleCgmuCgpOCgqOChgC3goZjgoaAt4KGq4KGwLeCih+CiiS3goo7goqAt4KOJ4KSELeCkueCkveClkOClmC3gpaHgpbEt4KaA4KaFLeCmjOCmj+CmkOCmky3gpqjgpqot4Kaw4Kay4Ka2LeCmueCmveCnjuCnnOCnneCnny3gp6Hgp7Dgp7Hgp7zgqIUt4KiK4KiP4KiQ4KiTLeCoqOCoqi3gqLDgqLLgqLPgqLXgqLbgqLjgqLngqZkt4Kmc4Kme4KmyLeCptOCqhS3gqo3gqo8t4KqR4KqTLeCqqOCqqi3gqrDgqrLgqrPgqrUt4Kq54Kq94KuQ4Kug4Kuh4Ku54KyFLeCsjOCsj+CskOCsky3grKjgrKot4Kyw4Kyy4Kyz4Ky1LeCsueCsveCtnOCtneCtny3graHgrbHgroPgroUt4K6K4K6OLeCukOCuki3grpXgrpngrprgrpzgrp7grp/grqPgrqTgrqgt4K6q4K6uLeCuueCvkOCwhS3gsIzgsI4t4LCQ4LCSLeCwqOCwqi3gsLngsL3gsZgt4LGa4LGd4LGg4LGh4LKA4LKFLeCyjOCyji3gspDgspIt4LKo4LKqLeCys+CytS3gsrngsr3gs53gs57gs6Dgs6Hgs7Hgs7LgtIQt4LSM4LSOLeC0kOC0ki3gtLrgtL3gtY7gtZQt4LWW4LWfLeC1oeC1ui3gtb/gtoUt4LaW4LaaLeC2seC2sy3gtrvgtr3gt4At4LeG4LiBLeC4sOC4suC4s+C5gC3guYbguoHguoLguoTguoYt4LqK4LqMLeC6o+C6peC6py3gurDgurLgurPgur3gu4At4LuE4LuG4LucLeC7n+C8gOC9gC3gvYfgvYkt4L2s4L6ILeC+jOGAgC3hgKrhgL/hgZAt4YGV4YGaLeGBneGBoeGBpeGBpuGBri3hgbDhgbUt4YKB4YKO4YKgLeGDheGDh+GDjeGDkC3hg7rhg7wt4YmI4YmKLeGJjeGJkC3hiZbhiZjhiZot4Ymd4YmgLeGKiOGKii3hio3hipAt4Yqw4YqyLeGKteGKuC3hir7hi4Dhi4It4YuF4YuILeGLluGLmC3hjJDhjJIt4YyV4YyYLeGNmuGOgC3hjo/hjqAt4Y+14Y+4LeGPveGQgS3hmazhma8t4Zm/4ZqBLeGamuGaoC3hm6rhm64t4Zu44ZyALeGckeGcny3hnLHhnYAt4Z2R4Z2gLeGdrOGdri3hnbDhnoAt4Z6z4Z+X4Z+c4aCgLeGhuOGigC3hoqjhoqrhorAt4aO14aSALeGknuGlkC3hpa3hpbAt4aW04aaALeGmq+GmsC3hp4nhqIAt4aiW4aigLeGplOGqp+GshS3hrLPhrYUt4a2M4a6DLeGuoOGuruGur+Guui3hr6XhsIAt4bCj4bGNLeGxj+Gxmi3hsb3hsoAt4bKI4bKQLeGyuuGyvS3hsr/hs6kt4bOs4bOuLeGzs+GzteGztuGzuuG0gC3htr/huIAt4byV4byYLeG8neG8oC3hvYXhvYgt4b2N4b2QLeG9l+G9meG9m+G9neG9ny3hvb3hvoAt4b604b62LeG+vOG+vuG/gi3hv4Thv4Yt4b+M4b+QLeG/k+G/li3hv5vhv6At4b+s4b+yLeG/tOG/ti3hv7zigbHigb/igpAt4oKc4oSC4oSH4oSKLeKEk+KEleKEmC3ihJ3ihKTihKbihKjihKot4oS54oS8LeKEv+KFhS3ihYnihY7ihaAt4oaI4rCALeKzpOKzqy3is67is7Lis7PitIAt4rSl4rSn4rSt4rSwLeK1p+K1r+K2gC3itpbitqAt4ram4raoLeK2ruK2sC3itrbitrgt4ra+4reALeK3huK3iC3it47it5At4reW4reYLeK3nuOAhS3jgIfjgKEt44Cp44CxLeOAteOAuC3jgLzjgYEt44KW44KbLeOCn+OCoS3jg7rjg7wt44O/44SFLeOEr+OEsS3jho7jhqAt44a/44ewLeOHv+OQgC3ktr/kuIAt6pKM6pOQLeqTveqUgC3qmIzqmJAt6pif6piq6pir6pmALeqZruqZvy3qmp3qmqAt6puv6pyXLeqcn+qcoi3qnojqnost6p+K6p+Q6p+R6p+T6p+VLeqfmeqfsi3qoIHqoIMt6qCF6qCHLeqgiuqgjC3qoKLqoYAt6qGz6qKCLeqis+qjsi3qo7fqo7vqo73qo77qpIot6qSl6qSwLeqlhuqloC3qpbzqpoQt6qay6qeP6qegLeqnpOqnpi3qp6/qp7ot6qe+6qiALeqoqOqpgC3qqYLqqYQt6qmL6qmgLeqptuqpuuqpvi3qqq/qqrHqqrXqqrbqqrkt6qq96quA6quC6qubLeqrneqroC3qq6rqq7It6qu06qyBLeqshuqsiS3qrI7qrJEt6qyW6qygLeqspuqsqC3qrK7qrLAt6q2a6q2cLeqtqeqtsC3qr6LqsIAt7Z6j7Z6wLe2fhu2fiy3tn7vvpIAt76mt76mwLe+rme+sgC3vrIbvrJMt76yX76yd76yfLe+sqO+sqi3vrLbvrLgt76y876y+762A762B762D762E762GLe+use+vky3vtL3vtZAt77aP77aSLe+3h++3sC3vt7vvubAt77m077m2Le+7vO+8oS3vvLrvvYEt772a772mLe++vu+/gi3vv4fvv4ot77+P77+SLe+/l++/mi3vv5wiLEtsPXszOiJhYnN0cmFjdCBib29sZWFuIGJ5dGUgY2hhciBjbGFzcyBkb3VibGUgZW51bSBleHBvcnQgZXh0ZW5kcyBmaW5hbCBmbG9hdCBnb3RvIGltcGxlbWVudHMgaW1wb3J0IGludCBpbnRlcmZhY2UgbG9uZyBuYXRpdmUgcGFja2FnZSBwcml2YXRlIHByb3RlY3RlZCBwdWJsaWMgc2hvcnQgc3RhdGljIHN1cGVyIHN5bmNocm9uaXplZCB0aHJvd3MgdHJhbnNpZW50IHZvbGF0aWxlIiw1OiJjbGFzcyBlbnVtIGV4dGVuZHMgc3VwZXIgY29uc3QgZXhwb3J0IGltcG9ydCIsNjoiZW51bSIsc3RyaWN0OiJpbXBsZW1lbnRzIGludGVyZmFjZSBsZXQgcGFja2FnZSBwcml2YXRlIHByb3RlY3RlZCBwdWJsaWMgc3RhdGljIHlpZWxkIixzdHJpY3RCaW5kOiJldmFsIGFyZ3VtZW50cyJ9LFlsPSJicmVhayBjYXNlIGNhdGNoIGNvbnRpbnVlIGRlYnVnZ2VyIGRlZmF1bHQgZG8gZWxzZSBmaW5hbGx5IGZvciBmdW5jdGlvbiBpZiByZXR1cm4gc3dpdGNoIHRocm93IHRyeSB2YXIgd2hpbGUgd2l0aCBudWxsIHRydWUgZmFsc2UgaW5zdGFuY2VvZiB0eXBlb2Ygdm9pZCBkZWxldGUgbmV3IGluIHRoaXMiLFhsPXs1OllsLCI1bW9kdWxlIjpZbCsiIGV4cG9ydCBpbXBvcnQiLDY6WWwrIiBjb25zdCBjbGFzcyBleHRlbmRzIGV4cG9ydCBpbXBvcnQgc3VwZXIifSxRbD0vXmluKHN0YW5jZW9mKT8kLyxabD1uZXcgUmVnRXhwKCJbIitIbCsiXSIpLEpsPW5ldyBSZWdFeHAoIlsiK0hsKyLigIzigI3Ct8yALc2vzofSgy3Sh9aRLda91r/XgdeC14TXhdeH2JAt2JrZiy3Zqdmw25Yt25zbny3bpNun26jbqi3brduwLdu53JHcsC3dit6mLd6w34At34nfqy3fs9+94KCWLeCgmeCgmy3goKPgoKUt4KCn4KCpLeCgreChmS3goZvgopgt4KKf4KOKLeCjoeCjoy3gpIPgpLot4KS84KS+LeClj+ClkS3gpZfgpaLgpaPgpaYt4KWv4KaBLeCmg+CmvOCmvi3gp4Tgp4fgp4jgp4st4KeN4KeX4Kei4Kej4KemLeCnr+CnvuCogS3gqIPgqLzgqL4t4KmC4KmH4KmI4KmLLeCpjeCpkeCppi3gqbHgqbXgqoEt4KqD4Kq84Kq+LeCrheCrhy3gq4ngq4st4KuN4Kui4Kuj4KumLeCrr+Crui3gq7/grIEt4KyD4Ky84Ky+LeCthOCth+CtiOCtiy3grY3grZUt4K2X4K2i4K2j4K2mLeCtr+CuguCuvi3gr4Lgr4Yt4K+I4K+KLeCvjeCvl+Cvpi3gr6/gsIAt4LCE4LC84LC+LeCxhOCxhi3gsYjgsYot4LGN4LGV4LGW4LGi4LGj4LGmLeCxr+CygS3gsoPgsrzgsr4t4LOE4LOGLeCziOCzii3gs43gs5Xgs5bgs6Lgs6Pgs6Yt4LOv4LOz4LSALeC0g+C0u+C0vOC0vi3gtYTgtYYt4LWI4LWKLeC1jeC1l+C1ouC1o+C1pi3gta/gtoEt4LaD4LeK4LePLeC3lOC3luC3mC3gt5/gt6Yt4Lev4Ley4Lez4Lix4Li0LeC4uuC5hy3guY7guZAt4LmZ4Lqx4Lq0LeC6vOC7iC3gu47gu5At4LuZ4LyY4LyZ4LygLeC8qeC8teC8t+C8ueC8vuC8v+C9sS3gvoTgvobgvofgvo0t4L6X4L6ZLeC+vOC/huGAqy3hgL7hgYAt4YGJ4YGWLeGBmeGBni3hgaDhgaIt4YGk4YGnLeGBreGBsS3hgbThgoIt4YKN4YKPLeGCneGNnS3hjZ/hjakt4Y2x4ZySLeGcleGcsi3hnLThnZLhnZPhnbLhnbPhnrQt4Z+T4Z+d4Z+gLeGfqeGgiy3hoI3hoI8t4aCZ4aKp4aSgLeGkq+GksC3hpLvhpYYt4aWP4aeQLeGnmuGoly3hqJvhqZUt4ame4amgLeGpvOGpvy3hqonhqpAt4aqZ4aqwLeGqveGqvy3hq47hrIAt4ayE4ay0LeGthOGtkC3hrZnhrast4a2z4a6ALeGuguGuoS3hrq3hrrAt4a654a+mLeGvs+GwpC3hsLfhsYAt4bGJ4bGQLeGxmeGzkC3hs5Lhs5Qt4bOo4bOt4bO04bO3LeGzueG3gC3ht7/igL/igYDigZTig5At4oOc4oOh4oOlLeKDsOKzry3is7Hitb/it6At4re/44CqLeOAr+OCmeOCmuqYoC3qmKnqma/qmbQt6pm96pqe6pqf6puw6pux6qCC6qCG6qCL6qCjLeqgp+qgrOqigOqigeqitC3qo4Xqo5At6qOZ6qOgLeqjseqjvy3qpInqpKYt6qSt6qWHLeqlk+qmgC3qpoPqprMt6qeA6qeQLeqnmeqnpeqnsC3qp7nqqKkt6qi26qmD6qmM6qmN6qmQLeqpmeqpuy3qqb3qqrDqqrIt6qq06qq36qq46qq+6qq/6quB6qurLeqrr+qrteqrtuqvoy3qr6rqr6zqr63qr7At6q+576ye77iALe+4j++4oC3vuK/vuLPvuLTvuY0t77mP77yQLe+8me+8v10iKTtmdW5jdGlvbiBlYyhlLHQpe2Zvcih2YXIgcz02NTUzNixpPTA7aTx0Lmxlbmd0aDtpKz0yKXtpZigocys9dFtpXSk+ZSlyZXR1cm4gITE7aWYoKHMrPXRbaSsxXSk+PWUpcmV0dXJuICEwfXJldHVybiAhMX1mdW5jdGlvbiB0YyhlLHQpe3JldHVybiBlPDY1PzM2PT09ZTplPDkxfHwoZTw5Nz85NT09PWU6ZTwxMjN8fChlPD02NTUzNT9lPj0xNzAmJlpsLnRlc3QoU3RyaW5nLmZyb21DaGFyQ29kZShlKSk6ITEhPT10JiZlYyhlLHFsKSkpfWZ1bmN0aW9uIHNjKGUsdCl7cmV0dXJuIGU8NDg/MzY9PT1lOmU8NTh8fCEoZTw2NSkmJihlPDkxfHwoZTw5Nz85NT09PWU6ZTwxMjN8fChlPD02NTUzNT9lPj0xNzAmJkpsLnRlc3QoU3RyaW5nLmZyb21DaGFyQ29kZShlKSk6ITEhPT10JiYoZWMoZSxxbCl8fGVjKGUsV2wpKSkpKX12YXIgaWM9ZnVuY3Rpb24oZSx0KXt2b2lkIDA9PT10JiYodD17fSksdGhpcy5sYWJlbD1lLHRoaXMua2V5d29yZD10LmtleXdvcmQsdGhpcy5iZWZvcmVFeHByPSEhdC5iZWZvcmVFeHByLHRoaXMuc3RhcnRzRXhwcj0hIXQuc3RhcnRzRXhwcix0aGlzLmlzTG9vcD0hIXQuaXNMb29wLHRoaXMuaXNBc3NpZ249ISF0LmlzQXNzaWduLHRoaXMucHJlZml4PSEhdC5wcmVmaXgsdGhpcy5wb3N0Zml4PSEhdC5wb3N0Zml4LHRoaXMuYmlub3A9dC5iaW5vcHx8bnVsbCx0aGlzLnVwZGF0ZUNvbnRleHQ9bnVsbDt9O2Z1bmN0aW9uIG5jKGUsdCl7cmV0dXJuIG5ldyBpYyhlLHtiZWZvcmVFeHByOiEwLGJpbm9wOnR9KX12YXIgcmM9e2JlZm9yZUV4cHI6ITB9LG9jPXtzdGFydHNFeHByOiEwfSxhYz17fTtmdW5jdGlvbiBsYyhlLHQpe3JldHVybiB2b2lkIDA9PT10JiYodD17fSksdC5rZXl3b3JkPWUsYWNbZV09bmV3IGljKGUsdCl9dmFyIGNjPXtudW06bmV3IGljKCJudW0iLG9jKSxyZWdleHA6bmV3IGljKCJyZWdleHAiLG9jKSxzdHJpbmc6bmV3IGljKCJzdHJpbmciLG9jKSxuYW1lOm5ldyBpYygibmFtZSIsb2MpLHByaXZhdGVJZDpuZXcgaWMoInByaXZhdGVJZCIsb2MpLGVvZjpuZXcgaWMoImVvZiIpLGJyYWNrZXRMOm5ldyBpYygiWyIse2JlZm9yZUV4cHI6ITAsc3RhcnRzRXhwcjohMH0pLGJyYWNrZXRSOm5ldyBpYygiXSIpLGJyYWNlTDpuZXcgaWMoInsiLHtiZWZvcmVFeHByOiEwLHN0YXJ0c0V4cHI6ITB9KSxicmFjZVI6bmV3IGljKCJ9IikscGFyZW5MOm5ldyBpYygiKCIse2JlZm9yZUV4cHI6ITAsc3RhcnRzRXhwcjohMH0pLHBhcmVuUjpuZXcgaWMoIikiKSxjb21tYTpuZXcgaWMoIiwiLHJjKSxzZW1pOm5ldyBpYygiOyIscmMpLGNvbG9uOm5ldyBpYygiOiIscmMpLGRvdDpuZXcgaWMoIi4iKSxxdWVzdGlvbjpuZXcgaWMoIj8iLHJjKSxxdWVzdGlvbkRvdDpuZXcgaWMoIj8uIiksYXJyb3c6bmV3IGljKCI9PiIscmMpLHRlbXBsYXRlOm5ldyBpYygidGVtcGxhdGUiKSxpbnZhbGlkVGVtcGxhdGU6bmV3IGljKCJpbnZhbGlkVGVtcGxhdGUiKSxlbGxpcHNpczpuZXcgaWMoIi4uLiIscmMpLGJhY2tRdW90ZTpuZXcgaWMoImAiLG9jKSxkb2xsYXJCcmFjZUw6bmV3IGljKCIkeyIse2JlZm9yZUV4cHI6ITAsc3RhcnRzRXhwcjohMH0pLGVxOm5ldyBpYygiPSIse2JlZm9yZUV4cHI6ITAsaXNBc3NpZ246ITB9KSxhc3NpZ246bmV3IGljKCJfPSIse2JlZm9yZUV4cHI6ITAsaXNBc3NpZ246ITB9KSxpbmNEZWM6bmV3IGljKCIrKy8tLSIse3ByZWZpeDohMCxwb3N0Zml4OiEwLHN0YXJ0c0V4cHI6ITB9KSxwcmVmaXg6bmV3IGljKCIhL34iLHtiZWZvcmVFeHByOiEwLHByZWZpeDohMCxzdGFydHNFeHByOiEwfSksbG9naWNhbE9SOm5jKCJ8fCIsMSksbG9naWNhbEFORDpuYygiJiYiLDIpLGJpdHdpc2VPUjpuYygifCIsMyksYml0d2lzZVhPUjpuYygiXiIsNCksYml0d2lzZUFORDpuYygiJiIsNSksZXF1YWxpdHk6bmMoIj09LyE9Lz09PS8hPT0iLDYpLHJlbGF0aW9uYWw6bmMoIjwvPi88PS8+PSIsNyksYml0U2hpZnQ6bmMoIjw8Lz4+Lz4+PiIsOCkscGx1c01pbjpuZXcgaWMoIisvLSIse2JlZm9yZUV4cHI6ITAsYmlub3A6OSxwcmVmaXg6ITAsc3RhcnRzRXhwcjohMH0pLG1vZHVsbzpuYygiJSIsMTApLHN0YXI6bmMoIioiLDEwKSxzbGFzaDpuYygiLyIsMTApLHN0YXJzdGFyOm5ldyBpYygiKioiLHtiZWZvcmVFeHByOiEwfSksY29hbGVzY2U6bmMoIj8/IiwxKSxfYnJlYWs6bGMoImJyZWFrIiksX2Nhc2U6bGMoImNhc2UiLHJjKSxfY2F0Y2g6bGMoImNhdGNoIiksX2NvbnRpbnVlOmxjKCJjb250aW51ZSIpLF9kZWJ1Z2dlcjpsYygiZGVidWdnZXIiKSxfZGVmYXVsdDpsYygiZGVmYXVsdCIscmMpLF9kbzpsYygiZG8iLHtpc0xvb3A6ITAsYmVmb3JlRXhwcjohMH0pLF9lbHNlOmxjKCJlbHNlIixyYyksX2ZpbmFsbHk6bGMoImZpbmFsbHkiKSxfZm9yOmxjKCJmb3IiLHtpc0xvb3A6ITB9KSxfZnVuY3Rpb246bGMoImZ1bmN0aW9uIixvYyksX2lmOmxjKCJpZiIpLF9yZXR1cm46bGMoInJldHVybiIscmMpLF9zd2l0Y2g6bGMoInN3aXRjaCIpLF90aHJvdzpsYygidGhyb3ciLHJjKSxfdHJ5OmxjKCJ0cnkiKSxfdmFyOmxjKCJ2YXIiKSxfY29uc3Q6bGMoImNvbnN0IiksX3doaWxlOmxjKCJ3aGlsZSIse2lzTG9vcDohMH0pLF93aXRoOmxjKCJ3aXRoIiksX25ldzpsYygibmV3Iix7YmVmb3JlRXhwcjohMCxzdGFydHNFeHByOiEwfSksX3RoaXM6bGMoInRoaXMiLG9jKSxfc3VwZXI6bGMoInN1cGVyIixvYyksX2NsYXNzOmxjKCJjbGFzcyIsb2MpLF9leHRlbmRzOmxjKCJleHRlbmRzIixyYyksX2V4cG9ydDpsYygiZXhwb3J0IiksX2ltcG9ydDpsYygiaW1wb3J0IixvYyksX251bGw6bGMoIm51bGwiLG9jKSxfdHJ1ZTpsYygidHJ1ZSIsb2MpLF9mYWxzZTpsYygiZmFsc2UiLG9jKSxfaW46bGMoImluIix7YmVmb3JlRXhwcjohMCxiaW5vcDo3fSksX2luc3RhbmNlb2Y6bGMoImluc3RhbmNlb2YiLHtiZWZvcmVFeHByOiEwLGJpbm9wOjd9KSxfdHlwZW9mOmxjKCJ0eXBlb2YiLHtiZWZvcmVFeHByOiEwLHByZWZpeDohMCxzdGFydHNFeHByOiEwfSksX3ZvaWQ6bGMoInZvaWQiLHtiZWZvcmVFeHByOiEwLHByZWZpeDohMCxzdGFydHNFeHByOiEwfSksX2RlbGV0ZTpsYygiZGVsZXRlIix7YmVmb3JlRXhwcjohMCxwcmVmaXg6ITAsc3RhcnRzRXhwcjohMH0pfSxoYz0vXHJcbj98XG58XHUyMDI4fFx1MjAyOS8sdWM9bmV3IFJlZ0V4cChoYy5zb3VyY2UsImciKTtmdW5jdGlvbiBkYyhlKXtyZXR1cm4gMTA9PT1lfHwxMz09PWV8fDgyMzI9PT1lfHw4MjMzPT09ZX1mdW5jdGlvbiBwYyhlLHQscyl7dm9pZCAwPT09cyYmKHM9ZS5sZW5ndGgpO2Zvcih2YXIgaT10O2k8cztpKyspe3ZhciBuPWUuY2hhckNvZGVBdChpKTtpZihkYyhuKSlyZXR1cm4gaTxzLTEmJjEzPT09biYmMTA9PT1lLmNoYXJDb2RlQXQoaSsxKT9pKzI6aSsxfXJldHVybiAtMX12YXIgZmM9L1tcdTE2ODBcdTIwMDAtXHUyMDBhXHUyMDJmXHUyMDVmXHUzMDAwXHVmZWZmXS8sbWM9Lyg/OlxzfFwvXC8uKnxcL1wqW15dKj9cKlwvKSovZyxnYz1PYmplY3QucHJvdG90eXBlLHljPWdjLmhhc093blByb3BlcnR5LHhjPWdjLnRvU3RyaW5nLEVjPU9iamVjdC5oYXNPd258fGZ1bmN0aW9uKGUsdCl7cmV0dXJuIHljLmNhbGwoZSx0KX0sYmM9QXJyYXkuaXNBcnJheXx8ZnVuY3Rpb24oZSl7cmV0dXJuICJbb2JqZWN0IEFycmF5XSI9PT14Yy5jYWxsKGUpfTtmdW5jdGlvbiB2YyhlKXtyZXR1cm4gbmV3IFJlZ0V4cCgiXig/OiIrZS5yZXBsYWNlKC8gL2csInwiKSsiKSQiKX1mdW5jdGlvbiBTYyhlKXtyZXR1cm4gZTw9NjU1MzU/U3RyaW5nLmZyb21DaGFyQ29kZShlKTooZS09NjU1MzYsU3RyaW5nLmZyb21DaGFyQ29kZSg1NTI5NisoZT4+MTApLDU2MzIwKygxMDIzJmUpKSl9dmFyIEFjPS8oPzpbXHVEODAwLVx1REJGRl0oPyFbXHVEQzAwLVx1REZGRl0pfCg/OlteXHVEODAwLVx1REJGRl18XilbXHVEQzAwLVx1REZGRl0pLyxrYz1mdW5jdGlvbihlLHQpe3RoaXMubGluZT1lLHRoaXMuY29sdW1uPXQ7fTtrYy5wcm90b3R5cGUub2Zmc2V0PWZ1bmN0aW9uKGUpe3JldHVybiBuZXcga2ModGhpcy5saW5lLHRoaXMuY29sdW1uK2UpfTt2YXIgSWM9ZnVuY3Rpb24oZSx0LHMpe3RoaXMuc3RhcnQ9dCx0aGlzLmVuZD1zLG51bGwhPT1lLnNvdXJjZUZpbGUmJih0aGlzLnNvdXJjZT1lLnNvdXJjZUZpbGUpO307ZnVuY3Rpb24gd2MoZSx0KXtmb3IodmFyIHM9MSxpPTA7Oyl7dmFyIG49cGMoZSxpLHQpO2lmKG48MClyZXR1cm4gbmV3IGtjKHMsdC1pKTsrK3MsaT1uO319dmFyIFBjPXtlY21hVmVyc2lvbjpudWxsLHNvdXJjZVR5cGU6InNjcmlwdCIsb25JbnNlcnRlZFNlbWljb2xvbjpudWxsLG9uVHJhaWxpbmdDb21tYTpudWxsLGFsbG93UmVzZXJ2ZWQ6bnVsbCxhbGxvd1JldHVybk91dHNpZGVGdW5jdGlvbjohMSxhbGxvd0ltcG9ydEV4cG9ydEV2ZXJ5d2hlcmU6ITEsYWxsb3dBd2FpdE91dHNpZGVGdW5jdGlvbjpudWxsLGFsbG93U3VwZXJPdXRzaWRlTWV0aG9kOm51bGwsYWxsb3dIYXNoQmFuZzohMSxjaGVja1ByaXZhdGVGaWVsZHM6ITAsbG9jYXRpb25zOiExLG9uVG9rZW46bnVsbCxvbkNvbW1lbnQ6bnVsbCxyYW5nZXM6ITEscHJvZ3JhbTpudWxsLHNvdXJjZUZpbGU6bnVsbCxkaXJlY3RTb3VyY2VGaWxlOm51bGwscHJlc2VydmVQYXJlbnM6ITF9LENjPSExO2Z1bmN0aW9uICRjKGUpe3ZhciB0PXt9O2Zvcih2YXIgcyBpbiBQYyl0W3NdPWUmJkVjKGUscyk/ZVtzXTpQY1tzXTtpZigibGF0ZXN0Ij09PXQuZWNtYVZlcnNpb24/dC5lY21hVmVyc2lvbj0xZTg6bnVsbD09dC5lY21hVmVyc2lvbj8oIUNjJiYib2JqZWN0Ij09dHlwZW9mIGNvbnNvbGUmJmNvbnNvbGUud2FybiYmKENjPSEwLGNvbnNvbGUud2FybigiU2luY2UgQWNvcm4gOC4wLjAsIG9wdGlvbnMuZWNtYVZlcnNpb24gaXMgcmVxdWlyZWQuXG5EZWZhdWx0aW5nIHRvIDIwMjAsIGJ1dCB0aGlzIHdpbGwgc3RvcCB3b3JraW5nIGluIHRoZSBmdXR1cmUuIikpLHQuZWNtYVZlcnNpb249MTEpOnQuZWNtYVZlcnNpb24+PTIwMTUmJih0LmVjbWFWZXJzaW9uLT0yMDA5KSxudWxsPT10LmFsbG93UmVzZXJ2ZWQmJih0LmFsbG93UmVzZXJ2ZWQ9dC5lY21hVmVyc2lvbjw1KSxlJiZudWxsIT1lLmFsbG93SGFzaEJhbmd8fCh0LmFsbG93SGFzaEJhbmc9dC5lY21hVmVyc2lvbj49MTQpLGJjKHQub25Ub2tlbikpe3ZhciBpPXQub25Ub2tlbjt0Lm9uVG9rZW49ZnVuY3Rpb24oZSl7cmV0dXJuIGkucHVzaChlKX07fXJldHVybiBiYyh0Lm9uQ29tbWVudCkmJih0Lm9uQ29tbWVudD1mdW5jdGlvbihlLHQpe3JldHVybiBmdW5jdGlvbihzLGksbixyLG8sYSl7dmFyIGw9e3R5cGU6cz8iQmxvY2siOiJMaW5lIix2YWx1ZTppLHN0YXJ0Om4sZW5kOnJ9O2UubG9jYXRpb25zJiYobC5sb2M9bmV3IEljKHRoaXMsbyxhKSksZS5yYW5nZXMmJihsLnJhbmdlPVtuLHJdKSx0LnB1c2gobCk7fX0odCx0Lm9uQ29tbWVudCkpLHR9dmFyIE5jPTI1NjtmdW5jdGlvbiBfYyhlLHQpe3JldHVybiAyfChlPzQ6MCl8KHQ/ODowKX12YXIgUmM9ZnVuY3Rpb24oZSx0LHMpe3RoaXMub3B0aW9ucz1lPSRjKGUpLHRoaXMuc291cmNlRmlsZT1lLnNvdXJjZUZpbGUsdGhpcy5rZXl3b3Jkcz12YyhYbFtlLmVjbWFWZXJzaW9uPj02PzY6Im1vZHVsZSI9PT1lLnNvdXJjZVR5cGU/IjVtb2R1bGUiOjVdKTt2YXIgaT0iIjshMCE9PWUuYWxsb3dSZXNlcnZlZCYmKGk9S2xbZS5lY21hVmVyc2lvbj49Nj82OjU9PT1lLmVjbWFWZXJzaW9uPzU6M10sIm1vZHVsZSI9PT1lLnNvdXJjZVR5cGUmJihpKz0iIGF3YWl0IikpLHRoaXMucmVzZXJ2ZWRXb3Jkcz12YyhpKTt2YXIgbj0oaT9pKyIgIjoiIikrS2wuc3RyaWN0O3RoaXMucmVzZXJ2ZWRXb3Jkc1N0cmljdD12YyhuKSx0aGlzLnJlc2VydmVkV29yZHNTdHJpY3RCaW5kPXZjKG4rIiAiK0tsLnN0cmljdEJpbmQpLHRoaXMuaW5wdXQ9U3RyaW5nKHQpLHRoaXMuY29udGFpbnNFc2M9ITEscz8odGhpcy5wb3M9cyx0aGlzLmxpbmVTdGFydD10aGlzLmlucHV0Lmxhc3RJbmRleE9mKCJcbiIscy0xKSsxLHRoaXMuY3VyTGluZT10aGlzLmlucHV0LnNsaWNlKDAsdGhpcy5saW5lU3RhcnQpLnNwbGl0KGhjKS5sZW5ndGgpOih0aGlzLnBvcz10aGlzLmxpbmVTdGFydD0wLHRoaXMuY3VyTGluZT0xKSx0aGlzLnR5cGU9Y2MuZW9mLHRoaXMudmFsdWU9bnVsbCx0aGlzLnN0YXJ0PXRoaXMuZW5kPXRoaXMucG9zLHRoaXMuc3RhcnRMb2M9dGhpcy5lbmRMb2M9dGhpcy5jdXJQb3NpdGlvbigpLHRoaXMubGFzdFRva0VuZExvYz10aGlzLmxhc3RUb2tTdGFydExvYz1udWxsLHRoaXMubGFzdFRva1N0YXJ0PXRoaXMubGFzdFRva0VuZD10aGlzLnBvcyx0aGlzLmNvbnRleHQ9dGhpcy5pbml0aWFsQ29udGV4dCgpLHRoaXMuZXhwckFsbG93ZWQ9ITAsdGhpcy5pbk1vZHVsZT0ibW9kdWxlIj09PWUuc291cmNlVHlwZSx0aGlzLnN0cmljdD10aGlzLmluTW9kdWxlfHx0aGlzLnN0cmljdERpcmVjdGl2ZSh0aGlzLnBvcyksdGhpcy5wb3RlbnRpYWxBcnJvd0F0PS0xLHRoaXMucG90ZW50aWFsQXJyb3dJbkZvckF3YWl0PSExLHRoaXMueWllbGRQb3M9dGhpcy5hd2FpdFBvcz10aGlzLmF3YWl0SWRlbnRQb3M9MCx0aGlzLmxhYmVscz1bXSx0aGlzLnVuZGVmaW5lZEV4cG9ydHM9T2JqZWN0LmNyZWF0ZShudWxsKSwwPT09dGhpcy5wb3MmJmUuYWxsb3dIYXNoQmFuZyYmIiMhIj09PXRoaXMuaW5wdXQuc2xpY2UoMCwyKSYmdGhpcy5za2lwTGluZUNvbW1lbnQoMiksdGhpcy5zY29wZVN0YWNrPVtdLHRoaXMuZW50ZXJTY29wZSgxKSx0aGlzLnJlZ2V4cFN0YXRlPW51bGwsdGhpcy5wcml2YXRlTmFtZVN0YWNrPVtdO30sTWM9e2luRnVuY3Rpb246e2NvbmZpZ3VyYWJsZTohMH0saW5HZW5lcmF0b3I6e2NvbmZpZ3VyYWJsZTohMH0saW5Bc3luYzp7Y29uZmlndXJhYmxlOiEwfSxjYW5Bd2FpdDp7Y29uZmlndXJhYmxlOiEwfSxhbGxvd1N1cGVyOntjb25maWd1cmFibGU6ITB9LGFsbG93RGlyZWN0U3VwZXI6e2NvbmZpZ3VyYWJsZTohMH0sdHJlYXRGdW5jdGlvbnNBc1Zhcjp7Y29uZmlndXJhYmxlOiEwfSxhbGxvd05ld0RvdFRhcmdldDp7Y29uZmlndXJhYmxlOiEwfSxpbkNsYXNzU3RhdGljQmxvY2s6e2NvbmZpZ3VyYWJsZTohMH19O1JjLnByb3RvdHlwZS5wYXJzZT1mdW5jdGlvbigpe3ZhciBlPXRoaXMub3B0aW9ucy5wcm9ncmFtfHx0aGlzLnN0YXJ0Tm9kZSgpO3JldHVybiB0aGlzLm5leHRUb2tlbigpLHRoaXMucGFyc2VUb3BMZXZlbChlKX0sTWMuaW5GdW5jdGlvbi5nZXQ9ZnVuY3Rpb24oKXtyZXR1cm4gKDImdGhpcy5jdXJyZW50VmFyU2NvcGUoKS5mbGFncyk+MH0sTWMuaW5HZW5lcmF0b3IuZ2V0PWZ1bmN0aW9uKCl7cmV0dXJuICg4JnRoaXMuY3VycmVudFZhclNjb3BlKCkuZmxhZ3MpPjAmJiF0aGlzLmN1cnJlbnRWYXJTY29wZSgpLmluQ2xhc3NGaWVsZEluaXR9LE1jLmluQXN5bmMuZ2V0PWZ1bmN0aW9uKCl7cmV0dXJuICg0JnRoaXMuY3VycmVudFZhclNjb3BlKCkuZmxhZ3MpPjAmJiF0aGlzLmN1cnJlbnRWYXJTY29wZSgpLmluQ2xhc3NGaWVsZEluaXR9LE1jLmNhbkF3YWl0LmdldD1mdW5jdGlvbigpe2Zvcih2YXIgZT10aGlzLnNjb3BlU3RhY2subGVuZ3RoLTE7ZT49MDtlLS0pe3ZhciB0PXRoaXMuc2NvcGVTdGFja1tlXTtpZih0LmluQ2xhc3NGaWVsZEluaXR8fHQuZmxhZ3MmTmMpcmV0dXJuICExO2lmKDImdC5mbGFncylyZXR1cm4gKDQmdC5mbGFncyk+MH1yZXR1cm4gdGhpcy5pbk1vZHVsZSYmdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj0xM3x8dGhpcy5vcHRpb25zLmFsbG93QXdhaXRPdXRzaWRlRnVuY3Rpb259LE1jLmFsbG93U3VwZXIuZ2V0PWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5jdXJyZW50VGhpc1Njb3BlKCksdD1lLmZsYWdzLHM9ZS5pbkNsYXNzRmllbGRJbml0O3JldHVybiAoNjQmdCk+MHx8c3x8dGhpcy5vcHRpb25zLmFsbG93U3VwZXJPdXRzaWRlTWV0aG9kfSxNYy5hbGxvd0RpcmVjdFN1cGVyLmdldD1mdW5jdGlvbigpe3JldHVybiAoMTI4JnRoaXMuY3VycmVudFRoaXNTY29wZSgpLmZsYWdzKT4wfSxNYy50cmVhdEZ1bmN0aW9uc0FzVmFyLmdldD1mdW5jdGlvbigpe3JldHVybiB0aGlzLnRyZWF0RnVuY3Rpb25zQXNWYXJJblNjb3BlKHRoaXMuY3VycmVudFNjb3BlKCkpfSxNYy5hbGxvd05ld0RvdFRhcmdldC5nZXQ9ZnVuY3Rpb24oKXt2YXIgZT10aGlzLmN1cnJlbnRUaGlzU2NvcGUoKSx0PWUuZmxhZ3Mscz1lLmluQ2xhc3NGaWVsZEluaXQ7cmV0dXJuICgyNTgmdCk+MHx8c30sTWMuaW5DbGFzc1N0YXRpY0Jsb2NrLmdldD1mdW5jdGlvbigpe3JldHVybiAodGhpcy5jdXJyZW50VmFyU2NvcGUoKS5mbGFncyZOYyk+MH0sUmMuZXh0ZW5kPWZ1bmN0aW9uKCl7Zm9yKHZhciBlPVtdLHQ9YXJndW1lbnRzLmxlbmd0aDt0LS07KWVbdF09YXJndW1lbnRzW3RdO2Zvcih2YXIgcz10aGlzLGk9MDtpPGUubGVuZ3RoO2krKylzPWVbaV0ocyk7cmV0dXJuIHN9LFJjLnBhcnNlPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIG5ldyB0aGlzKHQsZSkucGFyc2UoKX0sUmMucGFyc2VFeHByZXNzaW9uQXQ9ZnVuY3Rpb24oZSx0LHMpe3ZhciBpPW5ldyB0aGlzKHMsZSx0KTtyZXR1cm4gaS5uZXh0VG9rZW4oKSxpLnBhcnNlRXhwcmVzc2lvbigpfSxSYy50b2tlbml6ZXI9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gbmV3IHRoaXModCxlKX0sT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoUmMucHJvdG90eXBlLE1jKTt2YXIgT2M9UmMucHJvdG90eXBlLERjPS9eKD86JygoPzpcXC58W14nXFxdKSo/KSd8IigoPzpcXC58W14iXFxdKSo/KSIpLztPYy5zdHJpY3REaXJlY3RpdmU9ZnVuY3Rpb24oZSl7aWYodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPDUpcmV0dXJuICExO2Zvcig7Oyl7bWMubGFzdEluZGV4PWUsZSs9bWMuZXhlYyh0aGlzLmlucHV0KVswXS5sZW5ndGg7dmFyIHQ9RGMuZXhlYyh0aGlzLmlucHV0LnNsaWNlKGUpKTtpZighdClyZXR1cm4gITE7aWYoInVzZSBzdHJpY3QiPT09KHRbMV18fHRbMl0pKXttYy5sYXN0SW5kZXg9ZSt0WzBdLmxlbmd0aDt2YXIgcz1tYy5leGVjKHRoaXMuaW5wdXQpLGk9cy5pbmRleCtzWzBdLmxlbmd0aCxuPXRoaXMuaW5wdXQuY2hhckF0KGkpO3JldHVybiAiOyI9PT1ufHwifSI9PT1ufHxoYy50ZXN0KHNbMF0pJiYhKC9bKGAuWytcLS8qJTw+PSw/XiZdLy50ZXN0KG4pfHwiISI9PT1uJiYiPSI9PT10aGlzLmlucHV0LmNoYXJBdChpKzEpKX1lKz10WzBdLmxlbmd0aCxtYy5sYXN0SW5kZXg9ZSxlKz1tYy5leGVjKHRoaXMuaW5wdXQpWzBdLmxlbmd0aCwiOyI9PT10aGlzLmlucHV0W2VdJiZlKys7fX0sT2MuZWF0PWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnR5cGU9PT1lJiYodGhpcy5uZXh0KCksITApfSxPYy5pc0NvbnRleHR1YWw9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMudHlwZT09PWNjLm5hbWUmJnRoaXMudmFsdWU9PT1lJiYhdGhpcy5jb250YWluc0VzY30sT2MuZWF0Q29udGV4dHVhbD1mdW5jdGlvbihlKXtyZXR1cm4gISF0aGlzLmlzQ29udGV4dHVhbChlKSYmKHRoaXMubmV4dCgpLCEwKX0sT2MuZXhwZWN0Q29udGV4dHVhbD1mdW5jdGlvbihlKXt0aGlzLmVhdENvbnRleHR1YWwoZSl8fHRoaXMudW5leHBlY3RlZCgpO30sT2MuY2FuSW5zZXJ0U2VtaWNvbG9uPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMudHlwZT09PWNjLmVvZnx8dGhpcy50eXBlPT09Y2MuYnJhY2VSfHxoYy50ZXN0KHRoaXMuaW5wdXQuc2xpY2UodGhpcy5sYXN0VG9rRW5kLHRoaXMuc3RhcnQpKX0sT2MuaW5zZXJ0U2VtaWNvbG9uPWZ1bmN0aW9uKCl7aWYodGhpcy5jYW5JbnNlcnRTZW1pY29sb24oKSlyZXR1cm4gdGhpcy5vcHRpb25zLm9uSW5zZXJ0ZWRTZW1pY29sb24mJnRoaXMub3B0aW9ucy5vbkluc2VydGVkU2VtaWNvbG9uKHRoaXMubGFzdFRva0VuZCx0aGlzLmxhc3RUb2tFbmRMb2MpLCEwfSxPYy5zZW1pY29sb249ZnVuY3Rpb24oKXt0aGlzLmVhdChjYy5zZW1pKXx8dGhpcy5pbnNlcnRTZW1pY29sb24oKXx8dGhpcy51bmV4cGVjdGVkKCk7fSxPYy5hZnRlclRyYWlsaW5nQ29tbWE9ZnVuY3Rpb24oZSx0KXtpZih0aGlzLnR5cGU9PT1lKXJldHVybiB0aGlzLm9wdGlvbnMub25UcmFpbGluZ0NvbW1hJiZ0aGlzLm9wdGlvbnMub25UcmFpbGluZ0NvbW1hKHRoaXMubGFzdFRva1N0YXJ0LHRoaXMubGFzdFRva1N0YXJ0TG9jKSx0fHx0aGlzLm5leHQoKSwhMH0sT2MuZXhwZWN0PWZ1bmN0aW9uKGUpe3RoaXMuZWF0KGUpfHx0aGlzLnVuZXhwZWN0ZWQoKTt9LE9jLnVuZXhwZWN0ZWQ9ZnVuY3Rpb24oZSl7dGhpcy5yYWlzZShudWxsIT1lP2U6dGhpcy5zdGFydCwiVW5leHBlY3RlZCB0b2tlbiIpO307dmFyIExjPWZ1bmN0aW9uKCl7dGhpcy5zaG9ydGhhbmRBc3NpZ249dGhpcy50cmFpbGluZ0NvbW1hPXRoaXMucGFyZW50aGVzaXplZEFzc2lnbj10aGlzLnBhcmVudGhlc2l6ZWRCaW5kPXRoaXMuZG91YmxlUHJvdG89LTE7fTtPYy5jaGVja1BhdHRlcm5FcnJvcnM9ZnVuY3Rpb24oZSx0KXtpZihlKXtlLnRyYWlsaW5nQ29tbWE+LTEmJnRoaXMucmFpc2VSZWNvdmVyYWJsZShlLnRyYWlsaW5nQ29tbWEsIkNvbW1hIGlzIG5vdCBwZXJtaXR0ZWQgYWZ0ZXIgdGhlIHJlc3QgZWxlbWVudCIpO3ZhciBzPXQ/ZS5wYXJlbnRoZXNpemVkQXNzaWduOmUucGFyZW50aGVzaXplZEJpbmQ7cz4tMSYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKHMsdD8iQXNzaWduaW5nIHRvIHJ2YWx1ZSI6IlBhcmVudGhlc2l6ZWQgcGF0dGVybiIpO319LE9jLmNoZWNrRXhwcmVzc2lvbkVycm9ycz1mdW5jdGlvbihlLHQpe2lmKCFlKXJldHVybiAhMTt2YXIgcz1lLnNob3J0aGFuZEFzc2lnbixpPWUuZG91YmxlUHJvdG87aWYoIXQpcmV0dXJuIHM+PTB8fGk+PTA7cz49MCYmdGhpcy5yYWlzZShzLCJTaG9ydGhhbmQgcHJvcGVydHkgYXNzaWdubWVudHMgYXJlIHZhbGlkIG9ubHkgaW4gZGVzdHJ1Y3R1cmluZyBwYXR0ZXJucyIpLGk+PTAmJnRoaXMucmFpc2VSZWNvdmVyYWJsZShpLCJSZWRlZmluaXRpb24gb2YgX19wcm90b19fIHByb3BlcnR5Iik7fSxPYy5jaGVja1lpZWxkQXdhaXRJbkRlZmF1bHRQYXJhbXM9ZnVuY3Rpb24oKXt0aGlzLnlpZWxkUG9zJiYoIXRoaXMuYXdhaXRQb3N8fHRoaXMueWllbGRQb3M8dGhpcy5hd2FpdFBvcykmJnRoaXMucmFpc2UodGhpcy55aWVsZFBvcywiWWllbGQgZXhwcmVzc2lvbiBjYW5ub3QgYmUgYSBkZWZhdWx0IHZhbHVlIiksdGhpcy5hd2FpdFBvcyYmdGhpcy5yYWlzZSh0aGlzLmF3YWl0UG9zLCJBd2FpdCBleHByZXNzaW9uIGNhbm5vdCBiZSBhIGRlZmF1bHQgdmFsdWUiKTt9LE9jLmlzU2ltcGxlQXNzaWduVGFyZ2V0PWZ1bmN0aW9uKGUpe3JldHVybiAiUGFyZW50aGVzaXplZEV4cHJlc3Npb24iPT09ZS50eXBlP3RoaXMuaXNTaW1wbGVBc3NpZ25UYXJnZXQoZS5leHByZXNzaW9uKToiSWRlbnRpZmllciI9PT1lLnR5cGV8fCJNZW1iZXJFeHByZXNzaW9uIj09PWUudHlwZX07dmFyIFRjPVJjLnByb3RvdHlwZTtUYy5wYXJzZVRvcExldmVsPWZ1bmN0aW9uKGUpe3ZhciB0PU9iamVjdC5jcmVhdGUobnVsbCk7Zm9yKGUuYm9keXx8KGUuYm9keT1bXSk7dGhpcy50eXBlIT09Y2MuZW9mOyl7dmFyIHM9dGhpcy5wYXJzZVN0YXRlbWVudChudWxsLCEwLHQpO2UuYm9keS5wdXNoKHMpO31pZih0aGlzLmluTW9kdWxlKWZvcih2YXIgaT0wLG49T2JqZWN0LmtleXModGhpcy51bmRlZmluZWRFeHBvcnRzKTtpPG4ubGVuZ3RoO2krPTEpe3ZhciByPW5baV07dGhpcy5yYWlzZVJlY292ZXJhYmxlKHRoaXMudW5kZWZpbmVkRXhwb3J0c1tyXS5zdGFydCwiRXhwb3J0ICciK3IrIicgaXMgbm90IGRlZmluZWQiKTt9cmV0dXJuIHRoaXMuYWRhcHREaXJlY3RpdmVQcm9sb2d1ZShlLmJvZHkpLHRoaXMubmV4dCgpLGUuc291cmNlVHlwZT10aGlzLm9wdGlvbnMuc291cmNlVHlwZSx0aGlzLmZpbmlzaE5vZGUoZSwiUHJvZ3JhbSIpfTt2YXIgVmM9e2tpbmQ6Imxvb3AifSxCYz17a2luZDoic3dpdGNoIn07VGMuaXNMZXQ9ZnVuY3Rpb24oZSl7aWYodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPDZ8fCF0aGlzLmlzQ29udGV4dHVhbCgibGV0IikpcmV0dXJuICExO21jLmxhc3RJbmRleD10aGlzLnBvczt2YXIgdD1tYy5leGVjKHRoaXMuaW5wdXQpLHM9dGhpcy5wb3MrdFswXS5sZW5ndGgsaT10aGlzLmlucHV0LmNoYXJDb2RlQXQocyk7aWYoOTE9PT1pfHw5Mj09PWkpcmV0dXJuICEwO2lmKGUpcmV0dXJuICExO2lmKDEyMz09PWl8fGk+NTUyOTUmJmk8NTYzMjApcmV0dXJuICEwO2lmKHRjKGksITApKXtmb3IodmFyIG49cysxO3NjKGk9dGhpcy5pbnB1dC5jaGFyQ29kZUF0KG4pLCEwKTspKytuO2lmKDkyPT09aXx8aT41NTI5NSYmaTw1NjMyMClyZXR1cm4gITA7dmFyIHI9dGhpcy5pbnB1dC5zbGljZShzLG4pO2lmKCFRbC50ZXN0KHIpKXJldHVybiAhMH1yZXR1cm4gITF9LFRjLmlzQXN5bmNGdW5jdGlvbj1mdW5jdGlvbigpe2lmKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbjw4fHwhdGhpcy5pc0NvbnRleHR1YWwoImFzeW5jIikpcmV0dXJuICExO21jLmxhc3RJbmRleD10aGlzLnBvczt2YXIgZSx0PW1jLmV4ZWModGhpcy5pbnB1dCkscz10aGlzLnBvcyt0WzBdLmxlbmd0aDtyZXR1cm4gIShoYy50ZXN0KHRoaXMuaW5wdXQuc2xpY2UodGhpcy5wb3MscykpfHwiZnVuY3Rpb24iIT09dGhpcy5pbnB1dC5zbGljZShzLHMrOCl8fHMrOCE9PXRoaXMuaW5wdXQubGVuZ3RoJiYoc2MoZT10aGlzLmlucHV0LmNoYXJDb2RlQXQocys4KSl8fGU+NTUyOTUmJmU8NTYzMjApKX0sVGMucGFyc2VTdGF0ZW1lbnQ9ZnVuY3Rpb24oZSx0LHMpe3ZhciBpLG49dGhpcy50eXBlLHI9dGhpcy5zdGFydE5vZGUoKTtzd2l0Y2godGhpcy5pc0xldChlKSYmKG49Y2MuX3ZhcixpPSJsZXQiKSxuKXtjYXNlIGNjLl9icmVhazpjYXNlIGNjLl9jb250aW51ZTpyZXR1cm4gdGhpcy5wYXJzZUJyZWFrQ29udGludWVTdGF0ZW1lbnQocixuLmtleXdvcmQpO2Nhc2UgY2MuX2RlYnVnZ2VyOnJldHVybiB0aGlzLnBhcnNlRGVidWdnZXJTdGF0ZW1lbnQocik7Y2FzZSBjYy5fZG86cmV0dXJuIHRoaXMucGFyc2VEb1N0YXRlbWVudChyKTtjYXNlIGNjLl9mb3I6cmV0dXJuIHRoaXMucGFyc2VGb3JTdGF0ZW1lbnQocik7Y2FzZSBjYy5fZnVuY3Rpb246cmV0dXJuIGUmJih0aGlzLnN0cmljdHx8ImlmIiE9PWUmJiJsYWJlbCIhPT1lKSYmdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj02JiZ0aGlzLnVuZXhwZWN0ZWQoKSx0aGlzLnBhcnNlRnVuY3Rpb25TdGF0ZW1lbnQociwhMSwhZSk7Y2FzZSBjYy5fY2xhc3M6cmV0dXJuIGUmJnRoaXMudW5leHBlY3RlZCgpLHRoaXMucGFyc2VDbGFzcyhyLCEwKTtjYXNlIGNjLl9pZjpyZXR1cm4gdGhpcy5wYXJzZUlmU3RhdGVtZW50KHIpO2Nhc2UgY2MuX3JldHVybjpyZXR1cm4gdGhpcy5wYXJzZVJldHVyblN0YXRlbWVudChyKTtjYXNlIGNjLl9zd2l0Y2g6cmV0dXJuIHRoaXMucGFyc2VTd2l0Y2hTdGF0ZW1lbnQocik7Y2FzZSBjYy5fdGhyb3c6cmV0dXJuIHRoaXMucGFyc2VUaHJvd1N0YXRlbWVudChyKTtjYXNlIGNjLl90cnk6cmV0dXJuIHRoaXMucGFyc2VUcnlTdGF0ZW1lbnQocik7Y2FzZSBjYy5fY29uc3Q6Y2FzZSBjYy5fdmFyOnJldHVybiBpPWl8fHRoaXMudmFsdWUsZSYmInZhciIhPT1pJiZ0aGlzLnVuZXhwZWN0ZWQoKSx0aGlzLnBhcnNlVmFyU3RhdGVtZW50KHIsaSk7Y2FzZSBjYy5fd2hpbGU6cmV0dXJuIHRoaXMucGFyc2VXaGlsZVN0YXRlbWVudChyKTtjYXNlIGNjLl93aXRoOnJldHVybiB0aGlzLnBhcnNlV2l0aFN0YXRlbWVudChyKTtjYXNlIGNjLmJyYWNlTDpyZXR1cm4gdGhpcy5wYXJzZUJsb2NrKCEwLHIpO2Nhc2UgY2Muc2VtaTpyZXR1cm4gdGhpcy5wYXJzZUVtcHR5U3RhdGVtZW50KHIpO2Nhc2UgY2MuX2V4cG9ydDpjYXNlIGNjLl9pbXBvcnQ6aWYodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPjEwJiZuPT09Y2MuX2ltcG9ydCl7bWMubGFzdEluZGV4PXRoaXMucG9zO3ZhciBvPW1jLmV4ZWModGhpcy5pbnB1dCksYT10aGlzLnBvcytvWzBdLmxlbmd0aCxsPXRoaXMuaW5wdXQuY2hhckNvZGVBdChhKTtpZig0MD09PWx8fDQ2PT09bClyZXR1cm4gdGhpcy5wYXJzZUV4cHJlc3Npb25TdGF0ZW1lbnQocix0aGlzLnBhcnNlRXhwcmVzc2lvbigpKX1yZXR1cm4gdGhpcy5vcHRpb25zLmFsbG93SW1wb3J0RXhwb3J0RXZlcnl3aGVyZXx8KHR8fHRoaXMucmFpc2UodGhpcy5zdGFydCwiJ2ltcG9ydCcgYW5kICdleHBvcnQnIG1heSBvbmx5IGFwcGVhciBhdCB0aGUgdG9wIGxldmVsIiksdGhpcy5pbk1vZHVsZXx8dGhpcy5yYWlzZSh0aGlzLnN0YXJ0LCInaW1wb3J0JyBhbmQgJ2V4cG9ydCcgbWF5IGFwcGVhciBvbmx5IHdpdGggJ3NvdXJjZVR5cGU6IG1vZHVsZSciKSksbj09PWNjLl9pbXBvcnQ/dGhpcy5wYXJzZUltcG9ydChyKTp0aGlzLnBhcnNlRXhwb3J0KHIscyk7ZGVmYXVsdDppZih0aGlzLmlzQXN5bmNGdW5jdGlvbigpKXJldHVybiBlJiZ0aGlzLnVuZXhwZWN0ZWQoKSx0aGlzLm5leHQoKSx0aGlzLnBhcnNlRnVuY3Rpb25TdGF0ZW1lbnQociwhMCwhZSk7dmFyIGM9dGhpcy52YWx1ZSxoPXRoaXMucGFyc2VFeHByZXNzaW9uKCk7cmV0dXJuIG49PT1jYy5uYW1lJiYiSWRlbnRpZmllciI9PT1oLnR5cGUmJnRoaXMuZWF0KGNjLmNvbG9uKT90aGlzLnBhcnNlTGFiZWxlZFN0YXRlbWVudChyLGMsaCxlKTp0aGlzLnBhcnNlRXhwcmVzc2lvblN0YXRlbWVudChyLGgpfX0sVGMucGFyc2VCcmVha0NvbnRpbnVlU3RhdGVtZW50PWZ1bmN0aW9uKGUsdCl7dmFyIHM9ImJyZWFrIj09PXQ7dGhpcy5uZXh0KCksdGhpcy5lYXQoY2Muc2VtaSl8fHRoaXMuaW5zZXJ0U2VtaWNvbG9uKCk/ZS5sYWJlbD1udWxsOnRoaXMudHlwZSE9PWNjLm5hbWU/dGhpcy51bmV4cGVjdGVkKCk6KGUubGFiZWw9dGhpcy5wYXJzZUlkZW50KCksdGhpcy5zZW1pY29sb24oKSk7Zm9yKHZhciBpPTA7aTx0aGlzLmxhYmVscy5sZW5ndGg7KytpKXt2YXIgbj10aGlzLmxhYmVsc1tpXTtpZihudWxsPT1lLmxhYmVsfHxuLm5hbWU9PT1lLmxhYmVsLm5hbWUpe2lmKG51bGwhPW4ua2luZCYmKHN8fCJsb29wIj09PW4ua2luZCkpYnJlYWs7aWYoZS5sYWJlbCYmcylicmVha319cmV0dXJuIGk9PT10aGlzLmxhYmVscy5sZW5ndGgmJnRoaXMucmFpc2UoZS5zdGFydCwiVW5zeW50YWN0aWMgIit0KSx0aGlzLmZpbmlzaE5vZGUoZSxzPyJCcmVha1N0YXRlbWVudCI6IkNvbnRpbnVlU3RhdGVtZW50Iil9LFRjLnBhcnNlRGVidWdnZXJTdGF0ZW1lbnQ9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMubmV4dCgpLHRoaXMuc2VtaWNvbG9uKCksdGhpcy5maW5pc2hOb2RlKGUsIkRlYnVnZ2VyU3RhdGVtZW50Iil9LFRjLnBhcnNlRG9TdGF0ZW1lbnQ9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMubmV4dCgpLHRoaXMubGFiZWxzLnB1c2goVmMpLGUuYm9keT10aGlzLnBhcnNlU3RhdGVtZW50KCJkbyIpLHRoaXMubGFiZWxzLnBvcCgpLHRoaXMuZXhwZWN0KGNjLl93aGlsZSksZS50ZXN0PXRoaXMucGFyc2VQYXJlbkV4cHJlc3Npb24oKSx0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTY/dGhpcy5lYXQoY2Muc2VtaSk6dGhpcy5zZW1pY29sb24oKSx0aGlzLmZpbmlzaE5vZGUoZSwiRG9XaGlsZVN0YXRlbWVudCIpfSxUYy5wYXJzZUZvclN0YXRlbWVudD1mdW5jdGlvbihlKXt0aGlzLm5leHQoKTt2YXIgdD10aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTkmJnRoaXMuY2FuQXdhaXQmJnRoaXMuZWF0Q29udGV4dHVhbCgiYXdhaXQiKT90aGlzLmxhc3RUb2tTdGFydDotMTtpZih0aGlzLmxhYmVscy5wdXNoKFZjKSx0aGlzLmVudGVyU2NvcGUoMCksdGhpcy5leHBlY3QoY2MucGFyZW5MKSx0aGlzLnR5cGU9PT1jYy5zZW1pKXJldHVybiB0Pi0xJiZ0aGlzLnVuZXhwZWN0ZWQodCksdGhpcy5wYXJzZUZvcihlLG51bGwpO3ZhciBzPXRoaXMuaXNMZXQoKTtpZih0aGlzLnR5cGU9PT1jYy5fdmFyfHx0aGlzLnR5cGU9PT1jYy5fY29uc3R8fHMpe3ZhciBpPXRoaXMuc3RhcnROb2RlKCksbj1zPyJsZXQiOnRoaXMudmFsdWU7cmV0dXJuIHRoaXMubmV4dCgpLHRoaXMucGFyc2VWYXIoaSwhMCxuKSx0aGlzLmZpbmlzaE5vZGUoaSwiVmFyaWFibGVEZWNsYXJhdGlvbiIpLCh0aGlzLnR5cGU9PT1jYy5faW58fHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49NiYmdGhpcy5pc0NvbnRleHR1YWwoIm9mIikpJiYxPT09aS5kZWNsYXJhdGlvbnMubGVuZ3RoPyh0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTkmJih0aGlzLnR5cGU9PT1jYy5faW4/dD4tMSYmdGhpcy51bmV4cGVjdGVkKHQpOmUuYXdhaXQ9dD4tMSksdGhpcy5wYXJzZUZvckluKGUsaSkpOih0Pi0xJiZ0aGlzLnVuZXhwZWN0ZWQodCksdGhpcy5wYXJzZUZvcihlLGkpKX12YXIgcj10aGlzLmlzQ29udGV4dHVhbCgibGV0Iiksbz0hMSxhPW5ldyBMYyxsPXRoaXMucGFyc2VFeHByZXNzaW9uKCEodD4tMSl8fCJhd2FpdCIsYSk7cmV0dXJuIHRoaXMudHlwZT09PWNjLl9pbnx8KG89dGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj02JiZ0aGlzLmlzQ29udGV4dHVhbCgib2YiKSk/KHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49OSYmKHRoaXMudHlwZT09PWNjLl9pbj90Pi0xJiZ0aGlzLnVuZXhwZWN0ZWQodCk6ZS5hd2FpdD10Pi0xKSxyJiZvJiZ0aGlzLnJhaXNlKGwuc3RhcnQsIlRoZSBsZWZ0LWhhbmQgc2lkZSBvZiBhIGZvci1vZiBsb29wIG1heSBub3Qgc3RhcnQgd2l0aCAnbGV0Jy4iKSx0aGlzLnRvQXNzaWduYWJsZShsLCExLGEpLHRoaXMuY2hlY2tMVmFsUGF0dGVybihsKSx0aGlzLnBhcnNlRm9ySW4oZSxsKSk6KHRoaXMuY2hlY2tFeHByZXNzaW9uRXJyb3JzKGEsITApLHQ+LTEmJnRoaXMudW5leHBlY3RlZCh0KSx0aGlzLnBhcnNlRm9yKGUsbCkpfSxUYy5wYXJzZUZ1bmN0aW9uU3RhdGVtZW50PWZ1bmN0aW9uKGUsdCxzKXtyZXR1cm4gdGhpcy5uZXh0KCksdGhpcy5wYXJzZUZ1bmN0aW9uKGUsRmN8KHM/MDpqYyksITEsdCl9LFRjLnBhcnNlSWZTdGF0ZW1lbnQ9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMubmV4dCgpLGUudGVzdD10aGlzLnBhcnNlUGFyZW5FeHByZXNzaW9uKCksZS5jb25zZXF1ZW50PXRoaXMucGFyc2VTdGF0ZW1lbnQoImlmIiksZS5hbHRlcm5hdGU9dGhpcy5lYXQoY2MuX2Vsc2UpP3RoaXMucGFyc2VTdGF0ZW1lbnQoImlmIik6bnVsbCx0aGlzLmZpbmlzaE5vZGUoZSwiSWZTdGF0ZW1lbnQiKX0sVGMucGFyc2VSZXR1cm5TdGF0ZW1lbnQ9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuaW5GdW5jdGlvbnx8dGhpcy5vcHRpb25zLmFsbG93UmV0dXJuT3V0c2lkZUZ1bmN0aW9ufHx0aGlzLnJhaXNlKHRoaXMuc3RhcnQsIidyZXR1cm4nIG91dHNpZGUgb2YgZnVuY3Rpb24iKSx0aGlzLm5leHQoKSx0aGlzLmVhdChjYy5zZW1pKXx8dGhpcy5pbnNlcnRTZW1pY29sb24oKT9lLmFyZ3VtZW50PW51bGw6KGUuYXJndW1lbnQ9dGhpcy5wYXJzZUV4cHJlc3Npb24oKSx0aGlzLnNlbWljb2xvbigpKSx0aGlzLmZpbmlzaE5vZGUoZSwiUmV0dXJuU3RhdGVtZW50Iil9LFRjLnBhcnNlU3dpdGNoU3RhdGVtZW50PWZ1bmN0aW9uKGUpe3ZhciB0O3RoaXMubmV4dCgpLGUuZGlzY3JpbWluYW50PXRoaXMucGFyc2VQYXJlbkV4cHJlc3Npb24oKSxlLmNhc2VzPVtdLHRoaXMuZXhwZWN0KGNjLmJyYWNlTCksdGhpcy5sYWJlbHMucHVzaChCYyksdGhpcy5lbnRlclNjb3BlKDApO2Zvcih2YXIgcz0hMTt0aGlzLnR5cGUhPT1jYy5icmFjZVI7KWlmKHRoaXMudHlwZT09PWNjLl9jYXNlfHx0aGlzLnR5cGU9PT1jYy5fZGVmYXVsdCl7dmFyIGk9dGhpcy50eXBlPT09Y2MuX2Nhc2U7dCYmdGhpcy5maW5pc2hOb2RlKHQsIlN3aXRjaENhc2UiKSxlLmNhc2VzLnB1c2godD10aGlzLnN0YXJ0Tm9kZSgpKSx0LmNvbnNlcXVlbnQ9W10sdGhpcy5uZXh0KCksaT90LnRlc3Q9dGhpcy5wYXJzZUV4cHJlc3Npb24oKToocyYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKHRoaXMubGFzdFRva1N0YXJ0LCJNdWx0aXBsZSBkZWZhdWx0IGNsYXVzZXMiKSxzPSEwLHQudGVzdD1udWxsKSx0aGlzLmV4cGVjdChjYy5jb2xvbik7fWVsc2UgdHx8dGhpcy51bmV4cGVjdGVkKCksdC5jb25zZXF1ZW50LnB1c2godGhpcy5wYXJzZVN0YXRlbWVudChudWxsKSk7cmV0dXJuIHRoaXMuZXhpdFNjb3BlKCksdCYmdGhpcy5maW5pc2hOb2RlKHQsIlN3aXRjaENhc2UiKSx0aGlzLm5leHQoKSx0aGlzLmxhYmVscy5wb3AoKSx0aGlzLmZpbmlzaE5vZGUoZSwiU3dpdGNoU3RhdGVtZW50Iil9LFRjLnBhcnNlVGhyb3dTdGF0ZW1lbnQ9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMubmV4dCgpLGhjLnRlc3QodGhpcy5pbnB1dC5zbGljZSh0aGlzLmxhc3RUb2tFbmQsdGhpcy5zdGFydCkpJiZ0aGlzLnJhaXNlKHRoaXMubGFzdFRva0VuZCwiSWxsZWdhbCBuZXdsaW5lIGFmdGVyIHRocm93IiksZS5hcmd1bWVudD10aGlzLnBhcnNlRXhwcmVzc2lvbigpLHRoaXMuc2VtaWNvbG9uKCksdGhpcy5maW5pc2hOb2RlKGUsIlRocm93U3RhdGVtZW50Iil9O3ZhciB6Yz1bXTtUYy5wYXJzZUNhdGNoQ2xhdXNlUGFyYW09ZnVuY3Rpb24oKXt2YXIgZT10aGlzLnBhcnNlQmluZGluZ0F0b20oKSx0PSJJZGVudGlmaWVyIj09PWUudHlwZTtyZXR1cm4gdGhpcy5lbnRlclNjb3BlKHQ/MzI6MCksdGhpcy5jaGVja0xWYWxQYXR0ZXJuKGUsdD80OjIpLHRoaXMuZXhwZWN0KGNjLnBhcmVuUiksZX0sVGMucGFyc2VUcnlTdGF0ZW1lbnQ9ZnVuY3Rpb24oZSl7aWYodGhpcy5uZXh0KCksZS5ibG9jaz10aGlzLnBhcnNlQmxvY2soKSxlLmhhbmRsZXI9bnVsbCx0aGlzLnR5cGU9PT1jYy5fY2F0Y2gpe3ZhciB0PXRoaXMuc3RhcnROb2RlKCk7dGhpcy5uZXh0KCksdGhpcy5lYXQoY2MucGFyZW5MKT90LnBhcmFtPXRoaXMucGFyc2VDYXRjaENsYXVzZVBhcmFtKCk6KHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbjwxMCYmdGhpcy51bmV4cGVjdGVkKCksdC5wYXJhbT1udWxsLHRoaXMuZW50ZXJTY29wZSgwKSksdC5ib2R5PXRoaXMucGFyc2VCbG9jayghMSksdGhpcy5leGl0U2NvcGUoKSxlLmhhbmRsZXI9dGhpcy5maW5pc2hOb2RlKHQsIkNhdGNoQ2xhdXNlIik7fXJldHVybiBlLmZpbmFsaXplcj10aGlzLmVhdChjYy5fZmluYWxseSk/dGhpcy5wYXJzZUJsb2NrKCk6bnVsbCxlLmhhbmRsZXJ8fGUuZmluYWxpemVyfHx0aGlzLnJhaXNlKGUuc3RhcnQsIk1pc3NpbmcgY2F0Y2ggb3IgZmluYWxseSBjbGF1c2UiKSx0aGlzLmZpbmlzaE5vZGUoZSwiVHJ5U3RhdGVtZW50Iil9LFRjLnBhcnNlVmFyU3RhdGVtZW50PWZ1bmN0aW9uKGUsdCxzKXtyZXR1cm4gdGhpcy5uZXh0KCksdGhpcy5wYXJzZVZhcihlLCExLHQscyksdGhpcy5zZW1pY29sb24oKSx0aGlzLmZpbmlzaE5vZGUoZSwiVmFyaWFibGVEZWNsYXJhdGlvbiIpfSxUYy5wYXJzZVdoaWxlU3RhdGVtZW50PWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLm5leHQoKSxlLnRlc3Q9dGhpcy5wYXJzZVBhcmVuRXhwcmVzc2lvbigpLHRoaXMubGFiZWxzLnB1c2goVmMpLGUuYm9keT10aGlzLnBhcnNlU3RhdGVtZW50KCJ3aGlsZSIpLHRoaXMubGFiZWxzLnBvcCgpLHRoaXMuZmluaXNoTm9kZShlLCJXaGlsZVN0YXRlbWVudCIpfSxUYy5wYXJzZVdpdGhTdGF0ZW1lbnQ9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuc3RyaWN0JiZ0aGlzLnJhaXNlKHRoaXMuc3RhcnQsIid3aXRoJyBpbiBzdHJpY3QgbW9kZSIpLHRoaXMubmV4dCgpLGUub2JqZWN0PXRoaXMucGFyc2VQYXJlbkV4cHJlc3Npb24oKSxlLmJvZHk9dGhpcy5wYXJzZVN0YXRlbWVudCgid2l0aCIpLHRoaXMuZmluaXNoTm9kZShlLCJXaXRoU3RhdGVtZW50Iil9LFRjLnBhcnNlRW1wdHlTdGF0ZW1lbnQ9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMubmV4dCgpLHRoaXMuZmluaXNoTm9kZShlLCJFbXB0eVN0YXRlbWVudCIpfSxUYy5wYXJzZUxhYmVsZWRTdGF0ZW1lbnQ9ZnVuY3Rpb24oZSx0LHMsaSl7Zm9yKHZhciBuPTAscj10aGlzLmxhYmVscztuPHIubGVuZ3RoO24rPTEpe3Jbbl0ubmFtZT09PXQmJnRoaXMucmFpc2Uocy5zdGFydCwiTGFiZWwgJyIrdCsiJyBpcyBhbHJlYWR5IGRlY2xhcmVkIik7fWZvcih2YXIgbz10aGlzLnR5cGUuaXNMb29wPyJsb29wIjp0aGlzLnR5cGU9PT1jYy5fc3dpdGNoPyJzd2l0Y2giOm51bGwsYT10aGlzLmxhYmVscy5sZW5ndGgtMTthPj0wO2EtLSl7dmFyIGw9dGhpcy5sYWJlbHNbYV07aWYobC5zdGF0ZW1lbnRTdGFydCE9PWUuc3RhcnQpYnJlYWs7bC5zdGF0ZW1lbnRTdGFydD10aGlzLnN0YXJ0LGwua2luZD1vO31yZXR1cm4gdGhpcy5sYWJlbHMucHVzaCh7bmFtZTp0LGtpbmQ6byxzdGF0ZW1lbnRTdGFydDp0aGlzLnN0YXJ0fSksZS5ib2R5PXRoaXMucGFyc2VTdGF0ZW1lbnQoaT8tMT09PWkuaW5kZXhPZigibGFiZWwiKT9pKyJsYWJlbCI6aToibGFiZWwiKSx0aGlzLmxhYmVscy5wb3AoKSxlLmxhYmVsPXMsdGhpcy5maW5pc2hOb2RlKGUsIkxhYmVsZWRTdGF0ZW1lbnQiKX0sVGMucGFyc2VFeHByZXNzaW9uU3RhdGVtZW50PWZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUuZXhwcmVzc2lvbj10LHRoaXMuc2VtaWNvbG9uKCksdGhpcy5maW5pc2hOb2RlKGUsIkV4cHJlc3Npb25TdGF0ZW1lbnQiKX0sVGMucGFyc2VCbG9jaz1mdW5jdGlvbihlLHQscyl7Zm9yKHZvaWQgMD09PWUmJihlPSEwKSx2b2lkIDA9PT10JiYodD10aGlzLnN0YXJ0Tm9kZSgpKSx0LmJvZHk9W10sdGhpcy5leHBlY3QoY2MuYnJhY2VMKSxlJiZ0aGlzLmVudGVyU2NvcGUoMCk7dGhpcy50eXBlIT09Y2MuYnJhY2VSOyl7dmFyIGk9dGhpcy5wYXJzZVN0YXRlbWVudChudWxsKTt0LmJvZHkucHVzaChpKTt9cmV0dXJuIHMmJih0aGlzLnN0cmljdD0hMSksdGhpcy5uZXh0KCksZSYmdGhpcy5leGl0U2NvcGUoKSx0aGlzLmZpbmlzaE5vZGUodCwiQmxvY2tTdGF0ZW1lbnQiKX0sVGMucGFyc2VGb3I9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZS5pbml0PXQsdGhpcy5leHBlY3QoY2Muc2VtaSksZS50ZXN0PXRoaXMudHlwZT09PWNjLnNlbWk/bnVsbDp0aGlzLnBhcnNlRXhwcmVzc2lvbigpLHRoaXMuZXhwZWN0KGNjLnNlbWkpLGUudXBkYXRlPXRoaXMudHlwZT09PWNjLnBhcmVuUj9udWxsOnRoaXMucGFyc2VFeHByZXNzaW9uKCksdGhpcy5leHBlY3QoY2MucGFyZW5SKSxlLmJvZHk9dGhpcy5wYXJzZVN0YXRlbWVudCgiZm9yIiksdGhpcy5leGl0U2NvcGUoKSx0aGlzLmxhYmVscy5wb3AoKSx0aGlzLmZpbmlzaE5vZGUoZSwiRm9yU3RhdGVtZW50Iil9LFRjLnBhcnNlRm9ySW49ZnVuY3Rpb24oZSx0KXt2YXIgcz10aGlzLnR5cGU9PT1jYy5faW47cmV0dXJuIHRoaXMubmV4dCgpLCJWYXJpYWJsZURlY2xhcmF0aW9uIj09PXQudHlwZSYmbnVsbCE9dC5kZWNsYXJhdGlvbnNbMF0uaW5pdCYmKCFzfHx0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb248OHx8dGhpcy5zdHJpY3R8fCJ2YXIiIT09dC5raW5kfHwiSWRlbnRpZmllciIhPT10LmRlY2xhcmF0aW9uc1swXS5pZC50eXBlKSYmdGhpcy5yYWlzZSh0LnN0YXJ0LChzPyJmb3ItaW4iOiJmb3Itb2YiKSsiIGxvb3AgdmFyaWFibGUgZGVjbGFyYXRpb24gbWF5IG5vdCBoYXZlIGFuIGluaXRpYWxpemVyIiksZS5sZWZ0PXQsZS5yaWdodD1zP3RoaXMucGFyc2VFeHByZXNzaW9uKCk6dGhpcy5wYXJzZU1heWJlQXNzaWduKCksdGhpcy5leHBlY3QoY2MucGFyZW5SKSxlLmJvZHk9dGhpcy5wYXJzZVN0YXRlbWVudCgiZm9yIiksdGhpcy5leGl0U2NvcGUoKSx0aGlzLmxhYmVscy5wb3AoKSx0aGlzLmZpbmlzaE5vZGUoZSxzPyJGb3JJblN0YXRlbWVudCI6IkZvck9mU3RhdGVtZW50Iil9LFRjLnBhcnNlVmFyPWZ1bmN0aW9uKGUsdCxzLGkpe2ZvcihlLmRlY2xhcmF0aW9ucz1bXSxlLmtpbmQ9czs7KXt2YXIgbj10aGlzLnN0YXJ0Tm9kZSgpO2lmKHRoaXMucGFyc2VWYXJJZChuLHMpLHRoaXMuZWF0KGNjLmVxKT9uLmluaXQ9dGhpcy5wYXJzZU1heWJlQXNzaWduKHQpOml8fCJjb25zdCIhPT1zfHx0aGlzLnR5cGU9PT1jYy5faW58fHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49NiYmdGhpcy5pc0NvbnRleHR1YWwoIm9mIik/aXx8IklkZW50aWZpZXIiPT09bi5pZC50eXBlfHx0JiYodGhpcy50eXBlPT09Y2MuX2lufHx0aGlzLmlzQ29udGV4dHVhbCgib2YiKSk/bi5pbml0PW51bGw6dGhpcy5yYWlzZSh0aGlzLmxhc3RUb2tFbmQsIkNvbXBsZXggYmluZGluZyBwYXR0ZXJucyByZXF1aXJlIGFuIGluaXRpYWxpemF0aW9uIHZhbHVlIik6dGhpcy51bmV4cGVjdGVkKCksZS5kZWNsYXJhdGlvbnMucHVzaCh0aGlzLmZpbmlzaE5vZGUobiwiVmFyaWFibGVEZWNsYXJhdG9yIikpLCF0aGlzLmVhdChjYy5jb21tYSkpYnJlYWt9cmV0dXJuIGV9LFRjLnBhcnNlVmFySWQ9ZnVuY3Rpb24oZSx0KXtlLmlkPXRoaXMucGFyc2VCaW5kaW5nQXRvbSgpLHRoaXMuY2hlY2tMVmFsUGF0dGVybihlLmlkLCJ2YXIiPT09dD8xOjIsITEpO307dmFyIEZjPTEsamM9MjtmdW5jdGlvbiBVYyhlLHQpe3ZhciBzPXQua2V5Lm5hbWUsaT1lW3NdLG49InRydWUiO3JldHVybiAiTWV0aG9kRGVmaW5pdGlvbiIhPT10LnR5cGV8fCJnZXQiIT09dC5raW5kJiYic2V0IiE9PXQua2luZHx8KG49KHQuc3RhdGljPyJzIjoiaSIpK3Qua2luZCksImlnZXQiPT09aSYmImlzZXQiPT09bnx8ImlzZXQiPT09aSYmImlnZXQiPT09bnx8InNnZXQiPT09aSYmInNzZXQiPT09bnx8InNzZXQiPT09aSYmInNnZXQiPT09bj8oZVtzXT0idHJ1ZSIsITEpOiEhaXx8KGVbc109biwhMSl9ZnVuY3Rpb24gR2MoZSx0KXt2YXIgcz1lLmNvbXB1dGVkLGk9ZS5rZXk7cmV0dXJuICFzJiYoIklkZW50aWZpZXIiPT09aS50eXBlJiZpLm5hbWU9PT10fHwiTGl0ZXJhbCI9PT1pLnR5cGUmJmkudmFsdWU9PT10KX1UYy5wYXJzZUZ1bmN0aW9uPWZ1bmN0aW9uKGUsdCxzLGksbil7dGhpcy5pbml0RnVuY3Rpb24oZSksKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49OXx8dGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj02JiYhaSkmJih0aGlzLnR5cGU9PT1jYy5zdGFyJiZ0JmpjJiZ0aGlzLnVuZXhwZWN0ZWQoKSxlLmdlbmVyYXRvcj10aGlzLmVhdChjYy5zdGFyKSksdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj04JiYoZS5hc3luYz0hIWkpLHQmRmMmJihlLmlkPTQmdCYmdGhpcy50eXBlIT09Y2MubmFtZT9udWxsOnRoaXMucGFyc2VJZGVudCgpLCFlLmlkfHx0JmpjfHx0aGlzLmNoZWNrTFZhbFNpbXBsZShlLmlkLHRoaXMuc3RyaWN0fHxlLmdlbmVyYXRvcnx8ZS5hc3luYz90aGlzLnRyZWF0RnVuY3Rpb25zQXNWYXI/MToyOjMpKTt2YXIgcj10aGlzLnlpZWxkUG9zLG89dGhpcy5hd2FpdFBvcyxhPXRoaXMuYXdhaXRJZGVudFBvcztyZXR1cm4gdGhpcy55aWVsZFBvcz0wLHRoaXMuYXdhaXRQb3M9MCx0aGlzLmF3YWl0SWRlbnRQb3M9MCx0aGlzLmVudGVyU2NvcGUoX2MoZS5hc3luYyxlLmdlbmVyYXRvcikpLHQmRmN8fChlLmlkPXRoaXMudHlwZT09PWNjLm5hbWU/dGhpcy5wYXJzZUlkZW50KCk6bnVsbCksdGhpcy5wYXJzZUZ1bmN0aW9uUGFyYW1zKGUpLHRoaXMucGFyc2VGdW5jdGlvbkJvZHkoZSxzLCExLG4pLHRoaXMueWllbGRQb3M9cix0aGlzLmF3YWl0UG9zPW8sdGhpcy5hd2FpdElkZW50UG9zPWEsdGhpcy5maW5pc2hOb2RlKGUsdCZGYz8iRnVuY3Rpb25EZWNsYXJhdGlvbiI6IkZ1bmN0aW9uRXhwcmVzc2lvbiIpfSxUYy5wYXJzZUZ1bmN0aW9uUGFyYW1zPWZ1bmN0aW9uKGUpe3RoaXMuZXhwZWN0KGNjLnBhcmVuTCksZS5wYXJhbXM9dGhpcy5wYXJzZUJpbmRpbmdMaXN0KGNjLnBhcmVuUiwhMSx0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTgpLHRoaXMuY2hlY2tZaWVsZEF3YWl0SW5EZWZhdWx0UGFyYW1zKCk7fSxUYy5wYXJzZUNsYXNzPWZ1bmN0aW9uKGUsdCl7dGhpcy5uZXh0KCk7dmFyIHM9dGhpcy5zdHJpY3Q7dGhpcy5zdHJpY3Q9ITAsdGhpcy5wYXJzZUNsYXNzSWQoZSx0KSx0aGlzLnBhcnNlQ2xhc3NTdXBlcihlKTt2YXIgaT10aGlzLmVudGVyQ2xhc3NCb2R5KCksbj10aGlzLnN0YXJ0Tm9kZSgpLHI9ITE7Zm9yKG4uYm9keT1bXSx0aGlzLmV4cGVjdChjYy5icmFjZUwpO3RoaXMudHlwZSE9PWNjLmJyYWNlUjspe3ZhciBvPXRoaXMucGFyc2VDbGFzc0VsZW1lbnQobnVsbCE9PWUuc3VwZXJDbGFzcyk7byYmKG4uYm9keS5wdXNoKG8pLCJNZXRob2REZWZpbml0aW9uIj09PW8udHlwZSYmImNvbnN0cnVjdG9yIj09PW8ua2luZD8ociYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKG8uc3RhcnQsIkR1cGxpY2F0ZSBjb25zdHJ1Y3RvciBpbiB0aGUgc2FtZSBjbGFzcyIpLHI9ITApOm8ua2V5JiYiUHJpdmF0ZUlkZW50aWZpZXIiPT09by5rZXkudHlwZSYmVWMoaSxvKSYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKG8ua2V5LnN0YXJ0LCJJZGVudGlmaWVyICcjIitvLmtleS5uYW1lKyInIGhhcyBhbHJlYWR5IGJlZW4gZGVjbGFyZWQiKSk7fXJldHVybiB0aGlzLnN0cmljdD1zLHRoaXMubmV4dCgpLGUuYm9keT10aGlzLmZpbmlzaE5vZGUobiwiQ2xhc3NCb2R5IiksdGhpcy5leGl0Q2xhc3NCb2R5KCksdGhpcy5maW5pc2hOb2RlKGUsdD8iQ2xhc3NEZWNsYXJhdGlvbiI6IkNsYXNzRXhwcmVzc2lvbiIpfSxUYy5wYXJzZUNsYXNzRWxlbWVudD1mdW5jdGlvbihlKXtpZih0aGlzLmVhdChjYy5zZW1pKSlyZXR1cm4gbnVsbDt2YXIgdD10aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24scz10aGlzLnN0YXJ0Tm9kZSgpLGk9IiIsbj0hMSxyPSExLG89Im1ldGhvZCIsYT0hMTtpZih0aGlzLmVhdENvbnRleHR1YWwoInN0YXRpYyIpKXtpZih0Pj0xMyYmdGhpcy5lYXQoY2MuYnJhY2VMKSlyZXR1cm4gdGhpcy5wYXJzZUNsYXNzU3RhdGljQmxvY2socyksczt0aGlzLmlzQ2xhc3NFbGVtZW50TmFtZVN0YXJ0KCl8fHRoaXMudHlwZT09PWNjLnN0YXI/YT0hMDppPSJzdGF0aWMiO31pZihzLnN0YXRpYz1hLCFpJiZ0Pj04JiZ0aGlzLmVhdENvbnRleHR1YWwoImFzeW5jIikmJighdGhpcy5pc0NsYXNzRWxlbWVudE5hbWVTdGFydCgpJiZ0aGlzLnR5cGUhPT1jYy5zdGFyfHx0aGlzLmNhbkluc2VydFNlbWljb2xvbigpP2k9ImFzeW5jIjpyPSEwKSwhaSYmKHQ+PTl8fCFyKSYmdGhpcy5lYXQoY2Muc3RhcikmJihuPSEwKSwhaSYmIXImJiFuKXt2YXIgbD10aGlzLnZhbHVlOyh0aGlzLmVhdENvbnRleHR1YWwoImdldCIpfHx0aGlzLmVhdENvbnRleHR1YWwoInNldCIpKSYmKHRoaXMuaXNDbGFzc0VsZW1lbnROYW1lU3RhcnQoKT9vPWw6aT1sKTt9aWYoaT8ocy5jb21wdXRlZD0hMSxzLmtleT10aGlzLnN0YXJ0Tm9kZUF0KHRoaXMubGFzdFRva1N0YXJ0LHRoaXMubGFzdFRva1N0YXJ0TG9jKSxzLmtleS5uYW1lPWksdGhpcy5maW5pc2hOb2RlKHMua2V5LCJJZGVudGlmaWVyIikpOnRoaXMucGFyc2VDbGFzc0VsZW1lbnROYW1lKHMpLHQ8MTN8fHRoaXMudHlwZT09PWNjLnBhcmVuTHx8Im1ldGhvZCIhPT1vfHxufHxyKXt2YXIgYz0hcy5zdGF0aWMmJkdjKHMsImNvbnN0cnVjdG9yIiksaD1jJiZlO2MmJiJtZXRob2QiIT09byYmdGhpcy5yYWlzZShzLmtleS5zdGFydCwiQ29uc3RydWN0b3IgY2FuJ3QgaGF2ZSBnZXQvc2V0IG1vZGlmaWVyIikscy5raW5kPWM/ImNvbnN0cnVjdG9yIjpvLHRoaXMucGFyc2VDbGFzc01ldGhvZChzLG4scixoKTt9ZWxzZSB0aGlzLnBhcnNlQ2xhc3NGaWVsZChzKTtyZXR1cm4gc30sVGMuaXNDbGFzc0VsZW1lbnROYW1lU3RhcnQ9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy50eXBlPT09Y2MubmFtZXx8dGhpcy50eXBlPT09Y2MucHJpdmF0ZUlkfHx0aGlzLnR5cGU9PT1jYy5udW18fHRoaXMudHlwZT09PWNjLnN0cmluZ3x8dGhpcy50eXBlPT09Y2MuYnJhY2tldEx8fHRoaXMudHlwZS5rZXl3b3JkfSxUYy5wYXJzZUNsYXNzRWxlbWVudE5hbWU9ZnVuY3Rpb24oZSl7dGhpcy50eXBlPT09Y2MucHJpdmF0ZUlkPygiY29uc3RydWN0b3IiPT09dGhpcy52YWx1ZSYmdGhpcy5yYWlzZSh0aGlzLnN0YXJ0LCJDbGFzc2VzIGNhbid0IGhhdmUgYW4gZWxlbWVudCBuYW1lZCAnI2NvbnN0cnVjdG9yJyIpLGUuY29tcHV0ZWQ9ITEsZS5rZXk9dGhpcy5wYXJzZVByaXZhdGVJZGVudCgpKTp0aGlzLnBhcnNlUHJvcGVydHlOYW1lKGUpO30sVGMucGFyc2VDbGFzc01ldGhvZD1mdW5jdGlvbihlLHQscyxpKXt2YXIgbj1lLmtleTsiY29uc3RydWN0b3IiPT09ZS5raW5kPyh0JiZ0aGlzLnJhaXNlKG4uc3RhcnQsIkNvbnN0cnVjdG9yIGNhbid0IGJlIGEgZ2VuZXJhdG9yIikscyYmdGhpcy5yYWlzZShuLnN0YXJ0LCJDb25zdHJ1Y3RvciBjYW4ndCBiZSBhbiBhc3luYyBtZXRob2QiKSk6ZS5zdGF0aWMmJkdjKGUsInByb3RvdHlwZSIpJiZ0aGlzLnJhaXNlKG4uc3RhcnQsIkNsYXNzZXMgbWF5IG5vdCBoYXZlIGEgc3RhdGljIHByb3BlcnR5IG5hbWVkIHByb3RvdHlwZSIpO3ZhciByPWUudmFsdWU9dGhpcy5wYXJzZU1ldGhvZCh0LHMsaSk7cmV0dXJuICJnZXQiPT09ZS5raW5kJiYwIT09ci5wYXJhbXMubGVuZ3RoJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUoci5zdGFydCwiZ2V0dGVyIHNob3VsZCBoYXZlIG5vIHBhcmFtcyIpLCJzZXQiPT09ZS5raW5kJiYxIT09ci5wYXJhbXMubGVuZ3RoJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUoci5zdGFydCwic2V0dGVyIHNob3VsZCBoYXZlIGV4YWN0bHkgb25lIHBhcmFtIiksInNldCI9PT1lLmtpbmQmJiJSZXN0RWxlbWVudCI9PT1yLnBhcmFtc1swXS50eXBlJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUoci5wYXJhbXNbMF0uc3RhcnQsIlNldHRlciBjYW5ub3QgdXNlIHJlc3QgcGFyYW1zIiksdGhpcy5maW5pc2hOb2RlKGUsIk1ldGhvZERlZmluaXRpb24iKX0sVGMucGFyc2VDbGFzc0ZpZWxkPWZ1bmN0aW9uKGUpe2lmKEdjKGUsImNvbnN0cnVjdG9yIik/dGhpcy5yYWlzZShlLmtleS5zdGFydCwiQ2xhc3NlcyBjYW4ndCBoYXZlIGEgZmllbGQgbmFtZWQgJ2NvbnN0cnVjdG9yJyIpOmUuc3RhdGljJiZHYyhlLCJwcm90b3R5cGUiKSYmdGhpcy5yYWlzZShlLmtleS5zdGFydCwiQ2xhc3NlcyBjYW4ndCBoYXZlIGEgc3RhdGljIGZpZWxkIG5hbWVkICdwcm90b3R5cGUnIiksdGhpcy5lYXQoY2MuZXEpKXt2YXIgdD10aGlzLmN1cnJlbnRUaGlzU2NvcGUoKSxzPXQuaW5DbGFzc0ZpZWxkSW5pdDt0LmluQ2xhc3NGaWVsZEluaXQ9ITAsZS52YWx1ZT10aGlzLnBhcnNlTWF5YmVBc3NpZ24oKSx0LmluQ2xhc3NGaWVsZEluaXQ9czt9ZWxzZSBlLnZhbHVlPW51bGw7cmV0dXJuIHRoaXMuc2VtaWNvbG9uKCksdGhpcy5maW5pc2hOb2RlKGUsIlByb3BlcnR5RGVmaW5pdGlvbiIpfSxUYy5wYXJzZUNsYXNzU3RhdGljQmxvY2s9ZnVuY3Rpb24oZSl7ZS5ib2R5PVtdO3ZhciB0PXRoaXMubGFiZWxzO2Zvcih0aGlzLmxhYmVscz1bXSx0aGlzLmVudGVyU2NvcGUoMzIwKTt0aGlzLnR5cGUhPT1jYy5icmFjZVI7KXt2YXIgcz10aGlzLnBhcnNlU3RhdGVtZW50KG51bGwpO2UuYm9keS5wdXNoKHMpO31yZXR1cm4gdGhpcy5uZXh0KCksdGhpcy5leGl0U2NvcGUoKSx0aGlzLmxhYmVscz10LHRoaXMuZmluaXNoTm9kZShlLCJTdGF0aWNCbG9jayIpfSxUYy5wYXJzZUNsYXNzSWQ9ZnVuY3Rpb24oZSx0KXt0aGlzLnR5cGU9PT1jYy5uYW1lPyhlLmlkPXRoaXMucGFyc2VJZGVudCgpLHQmJnRoaXMuY2hlY2tMVmFsU2ltcGxlKGUuaWQsMiwhMSkpOighMD09PXQmJnRoaXMudW5leHBlY3RlZCgpLGUuaWQ9bnVsbCk7fSxUYy5wYXJzZUNsYXNzU3VwZXI9ZnVuY3Rpb24oZSl7ZS5zdXBlckNsYXNzPXRoaXMuZWF0KGNjLl9leHRlbmRzKT90aGlzLnBhcnNlRXhwclN1YnNjcmlwdHMobnVsbCwhMSk6bnVsbDt9LFRjLmVudGVyQ2xhc3NCb2R5PWZ1bmN0aW9uKCl7dmFyIGU9e2RlY2xhcmVkOk9iamVjdC5jcmVhdGUobnVsbCksdXNlZDpbXX07cmV0dXJuIHRoaXMucHJpdmF0ZU5hbWVTdGFjay5wdXNoKGUpLGUuZGVjbGFyZWR9LFRjLmV4aXRDbGFzc0JvZHk9ZnVuY3Rpb24oKXt2YXIgZT10aGlzLnByaXZhdGVOYW1lU3RhY2sucG9wKCksdD1lLmRlY2xhcmVkLHM9ZS51c2VkO2lmKHRoaXMub3B0aW9ucy5jaGVja1ByaXZhdGVGaWVsZHMpZm9yKHZhciBpPXRoaXMucHJpdmF0ZU5hbWVTdGFjay5sZW5ndGgsbj0wPT09aT9udWxsOnRoaXMucHJpdmF0ZU5hbWVTdGFja1tpLTFdLHI9MDtyPHMubGVuZ3RoOysrcil7dmFyIG89c1tyXTtFYyh0LG8ubmFtZSl8fChuP24udXNlZC5wdXNoKG8pOnRoaXMucmFpc2VSZWNvdmVyYWJsZShvLnN0YXJ0LCJQcml2YXRlIGZpZWxkICcjIitvLm5hbWUrIicgbXVzdCBiZSBkZWNsYXJlZCBpbiBhbiBlbmNsb3NpbmcgY2xhc3MiKSk7fX0sVGMucGFyc2VFeHBvcnRBbGxEZWNsYXJhdGlvbj1mdW5jdGlvbihlLHQpe3JldHVybiB0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTExJiYodGhpcy5lYXRDb250ZXh0dWFsKCJhcyIpPyhlLmV4cG9ydGVkPXRoaXMucGFyc2VNb2R1bGVFeHBvcnROYW1lKCksdGhpcy5jaGVja0V4cG9ydCh0LGUuZXhwb3J0ZWQsdGhpcy5sYXN0VG9rU3RhcnQpKTplLmV4cG9ydGVkPW51bGwpLHRoaXMuZXhwZWN0Q29udGV4dHVhbCgiZnJvbSIpLHRoaXMudHlwZSE9PWNjLnN0cmluZyYmdGhpcy51bmV4cGVjdGVkKCksZS5zb3VyY2U9dGhpcy5wYXJzZUV4cHJBdG9tKCksdGhpcy5zZW1pY29sb24oKSx0aGlzLmZpbmlzaE5vZGUoZSwiRXhwb3J0QWxsRGVjbGFyYXRpb24iKX0sVGMucGFyc2VFeHBvcnQ9ZnVuY3Rpb24oZSx0KXtpZih0aGlzLm5leHQoKSx0aGlzLmVhdChjYy5zdGFyKSlyZXR1cm4gdGhpcy5wYXJzZUV4cG9ydEFsbERlY2xhcmF0aW9uKGUsdCk7aWYodGhpcy5lYXQoY2MuX2RlZmF1bHQpKXJldHVybiB0aGlzLmNoZWNrRXhwb3J0KHQsImRlZmF1bHQiLHRoaXMubGFzdFRva1N0YXJ0KSxlLmRlY2xhcmF0aW9uPXRoaXMucGFyc2VFeHBvcnREZWZhdWx0RGVjbGFyYXRpb24oKSx0aGlzLmZpbmlzaE5vZGUoZSwiRXhwb3J0RGVmYXVsdERlY2xhcmF0aW9uIik7aWYodGhpcy5zaG91bGRQYXJzZUV4cG9ydFN0YXRlbWVudCgpKWUuZGVjbGFyYXRpb249dGhpcy5wYXJzZUV4cG9ydERlY2xhcmF0aW9uKGUpLCJWYXJpYWJsZURlY2xhcmF0aW9uIj09PWUuZGVjbGFyYXRpb24udHlwZT90aGlzLmNoZWNrVmFyaWFibGVFeHBvcnQodCxlLmRlY2xhcmF0aW9uLmRlY2xhcmF0aW9ucyk6dGhpcy5jaGVja0V4cG9ydCh0LGUuZGVjbGFyYXRpb24uaWQsZS5kZWNsYXJhdGlvbi5pZC5zdGFydCksZS5zcGVjaWZpZXJzPVtdLGUuc291cmNlPW51bGw7ZWxzZSB7aWYoZS5kZWNsYXJhdGlvbj1udWxsLGUuc3BlY2lmaWVycz10aGlzLnBhcnNlRXhwb3J0U3BlY2lmaWVycyh0KSx0aGlzLmVhdENvbnRleHR1YWwoImZyb20iKSl0aGlzLnR5cGUhPT1jYy5zdHJpbmcmJnRoaXMudW5leHBlY3RlZCgpLGUuc291cmNlPXRoaXMucGFyc2VFeHByQXRvbSgpO2Vsc2Uge2Zvcih2YXIgcz0wLGk9ZS5zcGVjaWZpZXJzO3M8aS5sZW5ndGg7cys9MSl7dmFyIG49aVtzXTt0aGlzLmNoZWNrVW5yZXNlcnZlZChuLmxvY2FsKSx0aGlzLmNoZWNrTG9jYWxFeHBvcnQobi5sb2NhbCksIkxpdGVyYWwiPT09bi5sb2NhbC50eXBlJiZ0aGlzLnJhaXNlKG4ubG9jYWwuc3RhcnQsIkEgc3RyaW5nIGxpdGVyYWwgY2Fubm90IGJlIHVzZWQgYXMgYW4gZXhwb3J0ZWQgYmluZGluZyB3aXRob3V0IGBmcm9tYC4iKTt9ZS5zb3VyY2U9bnVsbDt9dGhpcy5zZW1pY29sb24oKTt9cmV0dXJuIHRoaXMuZmluaXNoTm9kZShlLCJFeHBvcnROYW1lZERlY2xhcmF0aW9uIil9LFRjLnBhcnNlRXhwb3J0RGVjbGFyYXRpb249ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMucGFyc2VTdGF0ZW1lbnQobnVsbCl9LFRjLnBhcnNlRXhwb3J0RGVmYXVsdERlY2xhcmF0aW9uPWZ1bmN0aW9uKCl7dmFyIGU7aWYodGhpcy50eXBlPT09Y2MuX2Z1bmN0aW9ufHwoZT10aGlzLmlzQXN5bmNGdW5jdGlvbigpKSl7dmFyIHQ9dGhpcy5zdGFydE5vZGUoKTtyZXR1cm4gdGhpcy5uZXh0KCksZSYmdGhpcy5uZXh0KCksdGhpcy5wYXJzZUZ1bmN0aW9uKHQsNHxGYywhMSxlKX1pZih0aGlzLnR5cGU9PT1jYy5fY2xhc3Mpe3ZhciBzPXRoaXMuc3RhcnROb2RlKCk7cmV0dXJuIHRoaXMucGFyc2VDbGFzcyhzLCJudWxsYWJsZUlEIil9dmFyIGk9dGhpcy5wYXJzZU1heWJlQXNzaWduKCk7cmV0dXJuIHRoaXMuc2VtaWNvbG9uKCksaX0sVGMuY2hlY2tFeHBvcnQ9ZnVuY3Rpb24oZSx0LHMpe2UmJigic3RyaW5nIiE9dHlwZW9mIHQmJih0PSJJZGVudGlmaWVyIj09PXQudHlwZT90Lm5hbWU6dC52YWx1ZSksRWMoZSx0KSYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKHMsIkR1cGxpY2F0ZSBleHBvcnQgJyIrdCsiJyIpLGVbdF09ITApO30sVGMuY2hlY2tQYXR0ZXJuRXhwb3J0PWZ1bmN0aW9uKGUsdCl7dmFyIHM9dC50eXBlO2lmKCJJZGVudGlmaWVyIj09PXMpdGhpcy5jaGVja0V4cG9ydChlLHQsdC5zdGFydCk7ZWxzZSBpZigiT2JqZWN0UGF0dGVybiI9PT1zKWZvcih2YXIgaT0wLG49dC5wcm9wZXJ0aWVzO2k8bi5sZW5ndGg7aSs9MSl7dmFyIHI9bltpXTt0aGlzLmNoZWNrUGF0dGVybkV4cG9ydChlLHIpO31lbHNlIGlmKCJBcnJheVBhdHRlcm4iPT09cylmb3IodmFyIG89MCxhPXQuZWxlbWVudHM7bzxhLmxlbmd0aDtvKz0xKXt2YXIgbD1hW29dO2wmJnRoaXMuY2hlY2tQYXR0ZXJuRXhwb3J0KGUsbCk7fWVsc2UgIlByb3BlcnR5Ij09PXM/dGhpcy5jaGVja1BhdHRlcm5FeHBvcnQoZSx0LnZhbHVlKToiQXNzaWdubWVudFBhdHRlcm4iPT09cz90aGlzLmNoZWNrUGF0dGVybkV4cG9ydChlLHQubGVmdCk6IlJlc3RFbGVtZW50Ij09PXM/dGhpcy5jaGVja1BhdHRlcm5FeHBvcnQoZSx0LmFyZ3VtZW50KToiUGFyZW50aGVzaXplZEV4cHJlc3Npb24iPT09cyYmdGhpcy5jaGVja1BhdHRlcm5FeHBvcnQoZSx0LmV4cHJlc3Npb24pO30sVGMuY2hlY2tWYXJpYWJsZUV4cG9ydD1mdW5jdGlvbihlLHQpe2lmKGUpZm9yKHZhciBzPTAsaT10O3M8aS5sZW5ndGg7cys9MSl7dmFyIG49aVtzXTt0aGlzLmNoZWNrUGF0dGVybkV4cG9ydChlLG4uaWQpO319LFRjLnNob3VsZFBhcnNlRXhwb3J0U3RhdGVtZW50PWZ1bmN0aW9uKCl7cmV0dXJuICJ2YXIiPT09dGhpcy50eXBlLmtleXdvcmR8fCJjb25zdCI9PT10aGlzLnR5cGUua2V5d29yZHx8ImNsYXNzIj09PXRoaXMudHlwZS5rZXl3b3JkfHwiZnVuY3Rpb24iPT09dGhpcy50eXBlLmtleXdvcmR8fHRoaXMuaXNMZXQoKXx8dGhpcy5pc0FzeW5jRnVuY3Rpb24oKX0sVGMucGFyc2VFeHBvcnRTcGVjaWZpZXI9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5zdGFydE5vZGUoKTtyZXR1cm4gdC5sb2NhbD10aGlzLnBhcnNlTW9kdWxlRXhwb3J0TmFtZSgpLHQuZXhwb3J0ZWQ9dGhpcy5lYXRDb250ZXh0dWFsKCJhcyIpP3RoaXMucGFyc2VNb2R1bGVFeHBvcnROYW1lKCk6dC5sb2NhbCx0aGlzLmNoZWNrRXhwb3J0KGUsdC5leHBvcnRlZCx0LmV4cG9ydGVkLnN0YXJ0KSx0aGlzLmZpbmlzaE5vZGUodCwiRXhwb3J0U3BlY2lmaWVyIil9LFRjLnBhcnNlRXhwb3J0U3BlY2lmaWVycz1mdW5jdGlvbihlKXt2YXIgdD1bXSxzPSEwO2Zvcih0aGlzLmV4cGVjdChjYy5icmFjZUwpOyF0aGlzLmVhdChjYy5icmFjZVIpOyl7aWYocylzPSExO2Vsc2UgaWYodGhpcy5leHBlY3QoY2MuY29tbWEpLHRoaXMuYWZ0ZXJUcmFpbGluZ0NvbW1hKGNjLmJyYWNlUikpYnJlYWs7dC5wdXNoKHRoaXMucGFyc2VFeHBvcnRTcGVjaWZpZXIoZSkpO31yZXR1cm4gdH0sVGMucGFyc2VJbXBvcnQ9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMubmV4dCgpLHRoaXMudHlwZT09PWNjLnN0cmluZz8oZS5zcGVjaWZpZXJzPXpjLGUuc291cmNlPXRoaXMucGFyc2VFeHByQXRvbSgpKTooZS5zcGVjaWZpZXJzPXRoaXMucGFyc2VJbXBvcnRTcGVjaWZpZXJzKCksdGhpcy5leHBlY3RDb250ZXh0dWFsKCJmcm9tIiksZS5zb3VyY2U9dGhpcy50eXBlPT09Y2Muc3RyaW5nP3RoaXMucGFyc2VFeHByQXRvbSgpOnRoaXMudW5leHBlY3RlZCgpKSx0aGlzLnNlbWljb2xvbigpLHRoaXMuZmluaXNoTm9kZShlLCJJbXBvcnREZWNsYXJhdGlvbiIpfSxUYy5wYXJzZUltcG9ydFNwZWNpZmllcj1mdW5jdGlvbigpe3ZhciBlPXRoaXMuc3RhcnROb2RlKCk7cmV0dXJuIGUuaW1wb3J0ZWQ9dGhpcy5wYXJzZU1vZHVsZUV4cG9ydE5hbWUoKSx0aGlzLmVhdENvbnRleHR1YWwoImFzIik/ZS5sb2NhbD10aGlzLnBhcnNlSWRlbnQoKToodGhpcy5jaGVja1VucmVzZXJ2ZWQoZS5pbXBvcnRlZCksZS5sb2NhbD1lLmltcG9ydGVkKSx0aGlzLmNoZWNrTFZhbFNpbXBsZShlLmxvY2FsLDIpLHRoaXMuZmluaXNoTm9kZShlLCJJbXBvcnRTcGVjaWZpZXIiKX0sVGMucGFyc2VJbXBvcnREZWZhdWx0U3BlY2lmaWVyPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5zdGFydE5vZGUoKTtyZXR1cm4gZS5sb2NhbD10aGlzLnBhcnNlSWRlbnQoKSx0aGlzLmNoZWNrTFZhbFNpbXBsZShlLmxvY2FsLDIpLHRoaXMuZmluaXNoTm9kZShlLCJJbXBvcnREZWZhdWx0U3BlY2lmaWVyIil9LFRjLnBhcnNlSW1wb3J0TmFtZXNwYWNlU3BlY2lmaWVyPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5zdGFydE5vZGUoKTtyZXR1cm4gdGhpcy5uZXh0KCksdGhpcy5leHBlY3RDb250ZXh0dWFsKCJhcyIpLGUubG9jYWw9dGhpcy5wYXJzZUlkZW50KCksdGhpcy5jaGVja0xWYWxTaW1wbGUoZS5sb2NhbCwyKSx0aGlzLmZpbmlzaE5vZGUoZSwiSW1wb3J0TmFtZXNwYWNlU3BlY2lmaWVyIil9LFRjLnBhcnNlSW1wb3J0U3BlY2lmaWVycz1mdW5jdGlvbigpe3ZhciBlPVtdLHQ9ITA7aWYodGhpcy50eXBlPT09Y2MubmFtZSYmKGUucHVzaCh0aGlzLnBhcnNlSW1wb3J0RGVmYXVsdFNwZWNpZmllcigpKSwhdGhpcy5lYXQoY2MuY29tbWEpKSlyZXR1cm4gZTtpZih0aGlzLnR5cGU9PT1jYy5zdGFyKXJldHVybiBlLnB1c2godGhpcy5wYXJzZUltcG9ydE5hbWVzcGFjZVNwZWNpZmllcigpKSxlO2Zvcih0aGlzLmV4cGVjdChjYy5icmFjZUwpOyF0aGlzLmVhdChjYy5icmFjZVIpOyl7aWYodCl0PSExO2Vsc2UgaWYodGhpcy5leHBlY3QoY2MuY29tbWEpLHRoaXMuYWZ0ZXJUcmFpbGluZ0NvbW1hKGNjLmJyYWNlUikpYnJlYWs7ZS5wdXNoKHRoaXMucGFyc2VJbXBvcnRTcGVjaWZpZXIoKSk7fXJldHVybiBlfSxUYy5wYXJzZU1vZHVsZUV4cG9ydE5hbWU9ZnVuY3Rpb24oKXtpZih0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTEzJiZ0aGlzLnR5cGU9PT1jYy5zdHJpbmcpe3ZhciBlPXRoaXMucGFyc2VMaXRlcmFsKHRoaXMudmFsdWUpO3JldHVybiBBYy50ZXN0KGUudmFsdWUpJiZ0aGlzLnJhaXNlKGUuc3RhcnQsIkFuIGV4cG9ydCBuYW1lIGNhbm5vdCBpbmNsdWRlIGEgbG9uZSBzdXJyb2dhdGUuIiksZX1yZXR1cm4gdGhpcy5wYXJzZUlkZW50KCEwKX0sVGMuYWRhcHREaXJlY3RpdmVQcm9sb2d1ZT1mdW5jdGlvbihlKXtmb3IodmFyIHQ9MDt0PGUubGVuZ3RoJiZ0aGlzLmlzRGlyZWN0aXZlQ2FuZGlkYXRlKGVbdF0pOysrdCllW3RdLmRpcmVjdGl2ZT1lW3RdLmV4cHJlc3Npb24ucmF3LnNsaWNlKDEsLTEpO30sVGMuaXNEaXJlY3RpdmVDYW5kaWRhdGU9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49NSYmIkV4cHJlc3Npb25TdGF0ZW1lbnQiPT09ZS50eXBlJiYiTGl0ZXJhbCI9PT1lLmV4cHJlc3Npb24udHlwZSYmInN0cmluZyI9PXR5cGVvZiBlLmV4cHJlc3Npb24udmFsdWUmJignIic9PT10aGlzLmlucHV0W2Uuc3RhcnRdfHwiJyI9PT10aGlzLmlucHV0W2Uuc3RhcnRdKX07dmFyIFdjPVJjLnByb3RvdHlwZTtXYy50b0Fzc2lnbmFibGU9ZnVuY3Rpb24oZSx0LHMpe2lmKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49NiYmZSlzd2l0Y2goZS50eXBlKXtjYXNlIklkZW50aWZpZXIiOnRoaXMuaW5Bc3luYyYmImF3YWl0Ij09PWUubmFtZSYmdGhpcy5yYWlzZShlLnN0YXJ0LCJDYW5ub3QgdXNlICdhd2FpdCcgYXMgaWRlbnRpZmllciBpbnNpZGUgYW4gYXN5bmMgZnVuY3Rpb24iKTticmVhaztjYXNlIk9iamVjdFBhdHRlcm4iOmNhc2UiQXJyYXlQYXR0ZXJuIjpjYXNlIkFzc2lnbm1lbnRQYXR0ZXJuIjpjYXNlIlJlc3RFbGVtZW50IjpicmVhaztjYXNlIk9iamVjdEV4cHJlc3Npb24iOmUudHlwZT0iT2JqZWN0UGF0dGVybiIscyYmdGhpcy5jaGVja1BhdHRlcm5FcnJvcnMocywhMCk7Zm9yKHZhciBpPTAsbj1lLnByb3BlcnRpZXM7aTxuLmxlbmd0aDtpKz0xKXt2YXIgcj1uW2ldO3RoaXMudG9Bc3NpZ25hYmxlKHIsdCksIlJlc3RFbGVtZW50IiE9PXIudHlwZXx8IkFycmF5UGF0dGVybiIhPT1yLmFyZ3VtZW50LnR5cGUmJiJPYmplY3RQYXR0ZXJuIiE9PXIuYXJndW1lbnQudHlwZXx8dGhpcy5yYWlzZShyLmFyZ3VtZW50LnN0YXJ0LCJVbmV4cGVjdGVkIHRva2VuIik7fWJyZWFrO2Nhc2UiUHJvcGVydHkiOiJpbml0IiE9PWUua2luZCYmdGhpcy5yYWlzZShlLmtleS5zdGFydCwiT2JqZWN0IHBhdHRlcm4gY2FuJ3QgY29udGFpbiBnZXR0ZXIgb3Igc2V0dGVyIiksdGhpcy50b0Fzc2lnbmFibGUoZS52YWx1ZSx0KTticmVhaztjYXNlIkFycmF5RXhwcmVzc2lvbiI6ZS50eXBlPSJBcnJheVBhdHRlcm4iLHMmJnRoaXMuY2hlY2tQYXR0ZXJuRXJyb3JzKHMsITApLHRoaXMudG9Bc3NpZ25hYmxlTGlzdChlLmVsZW1lbnRzLHQpO2JyZWFrO2Nhc2UiU3ByZWFkRWxlbWVudCI6ZS50eXBlPSJSZXN0RWxlbWVudCIsdGhpcy50b0Fzc2lnbmFibGUoZS5hcmd1bWVudCx0KSwiQXNzaWdubWVudFBhdHRlcm4iPT09ZS5hcmd1bWVudC50eXBlJiZ0aGlzLnJhaXNlKGUuYXJndW1lbnQuc3RhcnQsIlJlc3QgZWxlbWVudHMgY2Fubm90IGhhdmUgYSBkZWZhdWx0IHZhbHVlIik7YnJlYWs7Y2FzZSJBc3NpZ25tZW50RXhwcmVzc2lvbiI6Ij0iIT09ZS5vcGVyYXRvciYmdGhpcy5yYWlzZShlLmxlZnQuZW5kLCJPbmx5ICc9JyBvcGVyYXRvciBjYW4gYmUgdXNlZCBmb3Igc3BlY2lmeWluZyBkZWZhdWx0IHZhbHVlLiIpLGUudHlwZT0iQXNzaWdubWVudFBhdHRlcm4iLGRlbGV0ZSBlLm9wZXJhdG9yLHRoaXMudG9Bc3NpZ25hYmxlKGUubGVmdCx0KTticmVhaztjYXNlIlBhcmVudGhlc2l6ZWRFeHByZXNzaW9uIjp0aGlzLnRvQXNzaWduYWJsZShlLmV4cHJlc3Npb24sdCxzKTticmVhaztjYXNlIkNoYWluRXhwcmVzc2lvbiI6dGhpcy5yYWlzZVJlY292ZXJhYmxlKGUuc3RhcnQsIk9wdGlvbmFsIGNoYWluaW5nIGNhbm5vdCBhcHBlYXIgaW4gbGVmdC1oYW5kIHNpZGUiKTticmVhaztjYXNlIk1lbWJlckV4cHJlc3Npb24iOmlmKCF0KWJyZWFrO2RlZmF1bHQ6dGhpcy5yYWlzZShlLnN0YXJ0LCJBc3NpZ25pbmcgdG8gcnZhbHVlIik7fWVsc2UgcyYmdGhpcy5jaGVja1BhdHRlcm5FcnJvcnMocywhMCk7cmV0dXJuIGV9LFdjLnRvQXNzaWduYWJsZUxpc3Q9ZnVuY3Rpb24oZSx0KXtmb3IodmFyIHM9ZS5sZW5ndGgsaT0wO2k8cztpKyspe3ZhciBuPWVbaV07biYmdGhpcy50b0Fzc2lnbmFibGUobix0KTt9aWYocyl7dmFyIHI9ZVtzLTFdOzY9PT10aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24mJnQmJnImJiJSZXN0RWxlbWVudCI9PT1yLnR5cGUmJiJJZGVudGlmaWVyIiE9PXIuYXJndW1lbnQudHlwZSYmdGhpcy51bmV4cGVjdGVkKHIuYXJndW1lbnQuc3RhcnQpO31yZXR1cm4gZX0sV2MucGFyc2VTcHJlYWQ9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5zdGFydE5vZGUoKTtyZXR1cm4gdGhpcy5uZXh0KCksdC5hcmd1bWVudD10aGlzLnBhcnNlTWF5YmVBc3NpZ24oITEsZSksdGhpcy5maW5pc2hOb2RlKHQsIlNwcmVhZEVsZW1lbnQiKX0sV2MucGFyc2VSZXN0QmluZGluZz1mdW5jdGlvbigpe3ZhciBlPXRoaXMuc3RhcnROb2RlKCk7cmV0dXJuIHRoaXMubmV4dCgpLDY9PT10aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24mJnRoaXMudHlwZSE9PWNjLm5hbWUmJnRoaXMudW5leHBlY3RlZCgpLGUuYXJndW1lbnQ9dGhpcy5wYXJzZUJpbmRpbmdBdG9tKCksdGhpcy5maW5pc2hOb2RlKGUsIlJlc3RFbGVtZW50Iil9LFdjLnBhcnNlQmluZGluZ0F0b209ZnVuY3Rpb24oKXtpZih0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTYpc3dpdGNoKHRoaXMudHlwZSl7Y2FzZSBjYy5icmFja2V0TDp2YXIgZT10aGlzLnN0YXJ0Tm9kZSgpO3JldHVybiB0aGlzLm5leHQoKSxlLmVsZW1lbnRzPXRoaXMucGFyc2VCaW5kaW5nTGlzdChjYy5icmFja2V0UiwhMCwhMCksdGhpcy5maW5pc2hOb2RlKGUsIkFycmF5UGF0dGVybiIpO2Nhc2UgY2MuYnJhY2VMOnJldHVybiB0aGlzLnBhcnNlT2JqKCEwKX1yZXR1cm4gdGhpcy5wYXJzZUlkZW50KCl9LFdjLnBhcnNlQmluZGluZ0xpc3Q9ZnVuY3Rpb24oZSx0LHMsaSl7Zm9yKHZhciBuPVtdLHI9ITA7IXRoaXMuZWF0KGUpOylpZihyP3I9ITE6dGhpcy5leHBlY3QoY2MuY29tbWEpLHQmJnRoaXMudHlwZT09PWNjLmNvbW1hKW4ucHVzaChudWxsKTtlbHNlIHtpZihzJiZ0aGlzLmFmdGVyVHJhaWxpbmdDb21tYShlKSlicmVhaztpZih0aGlzLnR5cGU9PT1jYy5lbGxpcHNpcyl7dmFyIG89dGhpcy5wYXJzZVJlc3RCaW5kaW5nKCk7dGhpcy5wYXJzZUJpbmRpbmdMaXN0SXRlbShvKSxuLnB1c2gobyksdGhpcy50eXBlPT09Y2MuY29tbWEmJnRoaXMucmFpc2VSZWNvdmVyYWJsZSh0aGlzLnN0YXJ0LCJDb21tYSBpcyBub3QgcGVybWl0dGVkIGFmdGVyIHRoZSByZXN0IGVsZW1lbnQiKSx0aGlzLmV4cGVjdChlKTticmVha31uLnB1c2godGhpcy5wYXJzZUFzc2lnbmFibGVMaXN0SXRlbShpKSk7fXJldHVybiBufSxXYy5wYXJzZUFzc2lnbmFibGVMaXN0SXRlbT1mdW5jdGlvbihlKXt2YXIgdD10aGlzLnBhcnNlTWF5YmVEZWZhdWx0KHRoaXMuc3RhcnQsdGhpcy5zdGFydExvYyk7cmV0dXJuIHRoaXMucGFyc2VCaW5kaW5nTGlzdEl0ZW0odCksdH0sV2MucGFyc2VCaW5kaW5nTGlzdEl0ZW09ZnVuY3Rpb24oZSl7cmV0dXJuIGV9LFdjLnBhcnNlTWF5YmVEZWZhdWx0PWZ1bmN0aW9uKGUsdCxzKXtpZihzPXN8fHRoaXMucGFyc2VCaW5kaW5nQXRvbSgpLHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbjw2fHwhdGhpcy5lYXQoY2MuZXEpKXJldHVybiBzO3ZhciBpPXRoaXMuc3RhcnROb2RlQXQoZSx0KTtyZXR1cm4gaS5sZWZ0PXMsaS5yaWdodD10aGlzLnBhcnNlTWF5YmVBc3NpZ24oKSx0aGlzLmZpbmlzaE5vZGUoaSwiQXNzaWdubWVudFBhdHRlcm4iKX0sV2MuY2hlY2tMVmFsU2ltcGxlPWZ1bmN0aW9uKGUsdCxzKXt2b2lkIDA9PT10JiYodD0wKTt2YXIgaT0wIT09dDtzd2l0Y2goZS50eXBlKXtjYXNlIklkZW50aWZpZXIiOnRoaXMuc3RyaWN0JiZ0aGlzLnJlc2VydmVkV29yZHNTdHJpY3RCaW5kLnRlc3QoZS5uYW1lKSYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKGUuc3RhcnQsKGk/IkJpbmRpbmcgIjoiQXNzaWduaW5nIHRvICIpK2UubmFtZSsiIGluIHN0cmljdCBtb2RlIiksaSYmKDI9PT10JiYibGV0Ij09PWUubmFtZSYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKGUuc3RhcnQsImxldCBpcyBkaXNhbGxvd2VkIGFzIGEgbGV4aWNhbGx5IGJvdW5kIG5hbWUiKSxzJiYoRWMocyxlLm5hbWUpJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUoZS5zdGFydCwiQXJndW1lbnQgbmFtZSBjbGFzaCIpLHNbZS5uYW1lXT0hMCksNSE9PXQmJnRoaXMuZGVjbGFyZU5hbWUoZS5uYW1lLHQsZS5zdGFydCkpO2JyZWFrO2Nhc2UiQ2hhaW5FeHByZXNzaW9uIjp0aGlzLnJhaXNlUmVjb3ZlcmFibGUoZS5zdGFydCwiT3B0aW9uYWwgY2hhaW5pbmcgY2Fubm90IGFwcGVhciBpbiBsZWZ0LWhhbmQgc2lkZSIpO2JyZWFrO2Nhc2UiTWVtYmVyRXhwcmVzc2lvbiI6aSYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKGUuc3RhcnQsIkJpbmRpbmcgbWVtYmVyIGV4cHJlc3Npb24iKTticmVhaztjYXNlIlBhcmVudGhlc2l6ZWRFeHByZXNzaW9uIjpyZXR1cm4gaSYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKGUuc3RhcnQsIkJpbmRpbmcgcGFyZW50aGVzaXplZCBleHByZXNzaW9uIiksdGhpcy5jaGVja0xWYWxTaW1wbGUoZS5leHByZXNzaW9uLHQscyk7ZGVmYXVsdDp0aGlzLnJhaXNlKGUuc3RhcnQsKGk/IkJpbmRpbmciOiJBc3NpZ25pbmcgdG8iKSsiIHJ2YWx1ZSIpO319LFdjLmNoZWNrTFZhbFBhdHRlcm49ZnVuY3Rpb24oZSx0LHMpe3N3aXRjaCh2b2lkIDA9PT10JiYodD0wKSxlLnR5cGUpe2Nhc2UiT2JqZWN0UGF0dGVybiI6Zm9yKHZhciBpPTAsbj1lLnByb3BlcnRpZXM7aTxuLmxlbmd0aDtpKz0xKXt2YXIgcj1uW2ldO3RoaXMuY2hlY2tMVmFsSW5uZXJQYXR0ZXJuKHIsdCxzKTt9YnJlYWs7Y2FzZSJBcnJheVBhdHRlcm4iOmZvcih2YXIgbz0wLGE9ZS5lbGVtZW50cztvPGEubGVuZ3RoO28rPTEpe3ZhciBsPWFbb107bCYmdGhpcy5jaGVja0xWYWxJbm5lclBhdHRlcm4obCx0LHMpO31icmVhaztkZWZhdWx0OnRoaXMuY2hlY2tMVmFsU2ltcGxlKGUsdCxzKTt9fSxXYy5jaGVja0xWYWxJbm5lclBhdHRlcm49ZnVuY3Rpb24oZSx0LHMpe3N3aXRjaCh2b2lkIDA9PT10JiYodD0wKSxlLnR5cGUpe2Nhc2UiUHJvcGVydHkiOnRoaXMuY2hlY2tMVmFsSW5uZXJQYXR0ZXJuKGUudmFsdWUsdCxzKTticmVhaztjYXNlIkFzc2lnbm1lbnRQYXR0ZXJuIjp0aGlzLmNoZWNrTFZhbFBhdHRlcm4oZS5sZWZ0LHQscyk7YnJlYWs7Y2FzZSJSZXN0RWxlbWVudCI6dGhpcy5jaGVja0xWYWxQYXR0ZXJuKGUuYXJndW1lbnQsdCxzKTticmVhaztkZWZhdWx0OnRoaXMuY2hlY2tMVmFsUGF0dGVybihlLHQscyk7fX07dmFyIHFjPWZ1bmN0aW9uKGUsdCxzLGksbil7dGhpcy50b2tlbj1lLHRoaXMuaXNFeHByPSEhdCx0aGlzLnByZXNlcnZlU3BhY2U9ISFzLHRoaXMub3ZlcnJpZGU9aSx0aGlzLmdlbmVyYXRvcj0hIW47fSxIYz17Yl9zdGF0Om5ldyBxYygieyIsITEpLGJfZXhwcjpuZXcgcWMoInsiLCEwKSxiX3RtcGw6bmV3IHFjKCIkeyIsITEpLHBfc3RhdDpuZXcgcWMoIigiLCExKSxwX2V4cHI6bmV3IHFjKCIoIiwhMCkscV90bXBsOm5ldyBxYygiYCIsITAsITAsKGZ1bmN0aW9uKGUpe3JldHVybiBlLnRyeVJlYWRUZW1wbGF0ZVRva2VuKCl9KSksZl9zdGF0Om5ldyBxYygiZnVuY3Rpb24iLCExKSxmX2V4cHI6bmV3IHFjKCJmdW5jdGlvbiIsITApLGZfZXhwcl9nZW46bmV3IHFjKCJmdW5jdGlvbiIsITAsITEsbnVsbCwhMCksZl9nZW46bmV3IHFjKCJmdW5jdGlvbiIsITEsITEsbnVsbCwhMCl9LEtjPVJjLnByb3RvdHlwZTtLYy5pbml0aWFsQ29udGV4dD1mdW5jdGlvbigpe3JldHVybiBbSGMuYl9zdGF0XX0sS2MuY3VyQ29udGV4dD1mdW5jdGlvbigpe3JldHVybiB0aGlzLmNvbnRleHRbdGhpcy5jb250ZXh0Lmxlbmd0aC0xXX0sS2MuYnJhY2VJc0Jsb2NrPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuY3VyQ29udGV4dCgpO3JldHVybiB0PT09SGMuZl9leHByfHx0PT09SGMuZl9zdGF0fHwoZSE9PWNjLmNvbG9ufHx0IT09SGMuYl9zdGF0JiZ0IT09SGMuYl9leHByP2U9PT1jYy5fcmV0dXJufHxlPT09Y2MubmFtZSYmdGhpcy5leHByQWxsb3dlZD9oYy50ZXN0KHRoaXMuaW5wdXQuc2xpY2UodGhpcy5sYXN0VG9rRW5kLHRoaXMuc3RhcnQpKTplPT09Y2MuX2Vsc2V8fGU9PT1jYy5zZW1pfHxlPT09Y2MuZW9mfHxlPT09Y2MucGFyZW5SfHxlPT09Y2MuYXJyb3d8fChlPT09Y2MuYnJhY2VMP3Q9PT1IYy5iX3N0YXQ6ZSE9PWNjLl92YXImJmUhPT1jYy5fY29uc3QmJmUhPT1jYy5uYW1lJiYhdGhpcy5leHByQWxsb3dlZCk6IXQuaXNFeHByKX0sS2MuaW5HZW5lcmF0b3JDb250ZXh0PWZ1bmN0aW9uKCl7Zm9yKHZhciBlPXRoaXMuY29udGV4dC5sZW5ndGgtMTtlPj0xO2UtLSl7dmFyIHQ9dGhpcy5jb250ZXh0W2VdO2lmKCJmdW5jdGlvbiI9PT10LnRva2VuKXJldHVybiB0LmdlbmVyYXRvcn1yZXR1cm4gITF9LEtjLnVwZGF0ZUNvbnRleHQ9ZnVuY3Rpb24oZSl7dmFyIHQscz10aGlzLnR5cGU7cy5rZXl3b3JkJiZlPT09Y2MuZG90P3RoaXMuZXhwckFsbG93ZWQ9ITE6KHQ9cy51cGRhdGVDb250ZXh0KT90LmNhbGwodGhpcyxlKTp0aGlzLmV4cHJBbGxvd2VkPXMuYmVmb3JlRXhwcjt9LEtjLm92ZXJyaWRlQ29udGV4dD1mdW5jdGlvbihlKXt0aGlzLmN1ckNvbnRleHQoKSE9PWUmJih0aGlzLmNvbnRleHRbdGhpcy5jb250ZXh0Lmxlbmd0aC0xXT1lKTt9LGNjLnBhcmVuUi51cGRhdGVDb250ZXh0PWNjLmJyYWNlUi51cGRhdGVDb250ZXh0PWZ1bmN0aW9uKCl7aWYoMSE9PXRoaXMuY29udGV4dC5sZW5ndGgpe3ZhciBlPXRoaXMuY29udGV4dC5wb3AoKTtlPT09SGMuYl9zdGF0JiYiZnVuY3Rpb24iPT09dGhpcy5jdXJDb250ZXh0KCkudG9rZW4mJihlPXRoaXMuY29udGV4dC5wb3AoKSksdGhpcy5leHByQWxsb3dlZD0hZS5pc0V4cHI7fWVsc2UgdGhpcy5leHByQWxsb3dlZD0hMDt9LGNjLmJyYWNlTC51cGRhdGVDb250ZXh0PWZ1bmN0aW9uKGUpe3RoaXMuY29udGV4dC5wdXNoKHRoaXMuYnJhY2VJc0Jsb2NrKGUpP0hjLmJfc3RhdDpIYy5iX2V4cHIpLHRoaXMuZXhwckFsbG93ZWQ9ITA7fSxjYy5kb2xsYXJCcmFjZUwudXBkYXRlQ29udGV4dD1mdW5jdGlvbigpe3RoaXMuY29udGV4dC5wdXNoKEhjLmJfdG1wbCksdGhpcy5leHByQWxsb3dlZD0hMDt9LGNjLnBhcmVuTC51cGRhdGVDb250ZXh0PWZ1bmN0aW9uKGUpe3ZhciB0PWU9PT1jYy5faWZ8fGU9PT1jYy5fZm9yfHxlPT09Y2MuX3dpdGh8fGU9PT1jYy5fd2hpbGU7dGhpcy5jb250ZXh0LnB1c2godD9IYy5wX3N0YXQ6SGMucF9leHByKSx0aGlzLmV4cHJBbGxvd2VkPSEwO30sY2MuaW5jRGVjLnVwZGF0ZUNvbnRleHQ9ZnVuY3Rpb24oKXt9LGNjLl9mdW5jdGlvbi51cGRhdGVDb250ZXh0PWNjLl9jbGFzcy51cGRhdGVDb250ZXh0PWZ1bmN0aW9uKGUpeyFlLmJlZm9yZUV4cHJ8fGU9PT1jYy5fZWxzZXx8ZT09PWNjLnNlbWkmJnRoaXMuY3VyQ29udGV4dCgpIT09SGMucF9zdGF0fHxlPT09Y2MuX3JldHVybiYmaGMudGVzdCh0aGlzLmlucHV0LnNsaWNlKHRoaXMubGFzdFRva0VuZCx0aGlzLnN0YXJ0KSl8fChlPT09Y2MuY29sb258fGU9PT1jYy5icmFjZUwpJiZ0aGlzLmN1ckNvbnRleHQoKT09PUhjLmJfc3RhdD90aGlzLmNvbnRleHQucHVzaChIYy5mX3N0YXQpOnRoaXMuY29udGV4dC5wdXNoKEhjLmZfZXhwciksdGhpcy5leHByQWxsb3dlZD0hMTt9LGNjLmJhY2tRdW90ZS51cGRhdGVDb250ZXh0PWZ1bmN0aW9uKCl7dGhpcy5jdXJDb250ZXh0KCk9PT1IYy5xX3RtcGw/dGhpcy5jb250ZXh0LnBvcCgpOnRoaXMuY29udGV4dC5wdXNoKEhjLnFfdG1wbCksdGhpcy5leHByQWxsb3dlZD0hMTt9LGNjLnN0YXIudXBkYXRlQ29udGV4dD1mdW5jdGlvbihlKXtpZihlPT09Y2MuX2Z1bmN0aW9uKXt2YXIgdD10aGlzLmNvbnRleHQubGVuZ3RoLTE7dGhpcy5jb250ZXh0W3RdPT09SGMuZl9leHByP3RoaXMuY29udGV4dFt0XT1IYy5mX2V4cHJfZ2VuOnRoaXMuY29udGV4dFt0XT1IYy5mX2dlbjt9dGhpcy5leHByQWxsb3dlZD0hMDt9LGNjLm5hbWUudXBkYXRlQ29udGV4dD1mdW5jdGlvbihlKXt2YXIgdD0hMTt0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTYmJmUhPT1jYy5kb3QmJigib2YiPT09dGhpcy52YWx1ZSYmIXRoaXMuZXhwckFsbG93ZWR8fCJ5aWVsZCI9PT10aGlzLnZhbHVlJiZ0aGlzLmluR2VuZXJhdG9yQ29udGV4dCgpKSYmKHQ9ITApLHRoaXMuZXhwckFsbG93ZWQ9dDt9O3ZhciBZYz1SYy5wcm90b3R5cGU7ZnVuY3Rpb24gWGMoZSl7cmV0dXJuICJNZW1iZXJFeHByZXNzaW9uIj09PWUudHlwZSYmIlByaXZhdGVJZGVudGlmaWVyIj09PWUucHJvcGVydHkudHlwZXx8IkNoYWluRXhwcmVzc2lvbiI9PT1lLnR5cGUmJlhjKGUuZXhwcmVzc2lvbil9WWMuY2hlY2tQcm9wQ2xhc2g9ZnVuY3Rpb24oZSx0LHMpe2lmKCEodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj05JiYiU3ByZWFkRWxlbWVudCI9PT1lLnR5cGV8fHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49NiYmKGUuY29tcHV0ZWR8fGUubWV0aG9kfHxlLnNob3J0aGFuZCkpKXt2YXIgaSxuPWUua2V5O3N3aXRjaChuLnR5cGUpe2Nhc2UiSWRlbnRpZmllciI6aT1uLm5hbWU7YnJlYWs7Y2FzZSJMaXRlcmFsIjppPVN0cmluZyhuLnZhbHVlKTticmVhaztkZWZhdWx0OnJldHVybn12YXIgcj1lLmtpbmQ7aWYodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj02KSJfX3Byb3RvX18iPT09aSYmImluaXQiPT09ciYmKHQucHJvdG8mJihzP3MuZG91YmxlUHJvdG88MCYmKHMuZG91YmxlUHJvdG89bi5zdGFydCk6dGhpcy5yYWlzZVJlY292ZXJhYmxlKG4uc3RhcnQsIlJlZGVmaW5pdGlvbiBvZiBfX3Byb3RvX18gcHJvcGVydHkiKSksdC5wcm90bz0hMCk7ZWxzZSB7dmFyIG89dFtpPSIkIitpXTtpZihvKSgiaW5pdCI9PT1yP3RoaXMuc3RyaWN0JiZvLmluaXR8fG8uZ2V0fHxvLnNldDpvLmluaXR8fG9bcl0pJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUobi5zdGFydCwiUmVkZWZpbml0aW9uIG9mIHByb3BlcnR5Iik7ZWxzZSBvPXRbaV09e2luaXQ6ITEsZ2V0OiExLHNldDohMX07b1tyXT0hMDt9fX0sWWMucGFyc2VFeHByZXNzaW9uPWZ1bmN0aW9uKGUsdCl7dmFyIHM9dGhpcy5zdGFydCxpPXRoaXMuc3RhcnRMb2Msbj10aGlzLnBhcnNlTWF5YmVBc3NpZ24oZSx0KTtpZih0aGlzLnR5cGU9PT1jYy5jb21tYSl7dmFyIHI9dGhpcy5zdGFydE5vZGVBdChzLGkpO2ZvcihyLmV4cHJlc3Npb25zPVtuXTt0aGlzLmVhdChjYy5jb21tYSk7KXIuZXhwcmVzc2lvbnMucHVzaCh0aGlzLnBhcnNlTWF5YmVBc3NpZ24oZSx0KSk7cmV0dXJuIHRoaXMuZmluaXNoTm9kZShyLCJTZXF1ZW5jZUV4cHJlc3Npb24iKX1yZXR1cm4gbn0sWWMucGFyc2VNYXliZUFzc2lnbj1mdW5jdGlvbihlLHQscyl7aWYodGhpcy5pc0NvbnRleHR1YWwoInlpZWxkIikpe2lmKHRoaXMuaW5HZW5lcmF0b3IpcmV0dXJuIHRoaXMucGFyc2VZaWVsZChlKTt0aGlzLmV4cHJBbGxvd2VkPSExO312YXIgaT0hMSxuPS0xLHI9LTEsbz0tMTt0PyhuPXQucGFyZW50aGVzaXplZEFzc2lnbixyPXQudHJhaWxpbmdDb21tYSxvPXQuZG91YmxlUHJvdG8sdC5wYXJlbnRoZXNpemVkQXNzaWduPXQudHJhaWxpbmdDb21tYT0tMSk6KHQ9bmV3IExjLGk9ITApO3ZhciBhPXRoaXMuc3RhcnQsbD10aGlzLnN0YXJ0TG9jO3RoaXMudHlwZSE9PWNjLnBhcmVuTCYmdGhpcy50eXBlIT09Y2MubmFtZXx8KHRoaXMucG90ZW50aWFsQXJyb3dBdD10aGlzLnN0YXJ0LHRoaXMucG90ZW50aWFsQXJyb3dJbkZvckF3YWl0PSJhd2FpdCI9PT1lKTt2YXIgYz10aGlzLnBhcnNlTWF5YmVDb25kaXRpb25hbChlLHQpO2lmKHMmJihjPXMuY2FsbCh0aGlzLGMsYSxsKSksdGhpcy50eXBlLmlzQXNzaWduKXt2YXIgaD10aGlzLnN0YXJ0Tm9kZUF0KGEsbCk7cmV0dXJuIGgub3BlcmF0b3I9dGhpcy52YWx1ZSx0aGlzLnR5cGU9PT1jYy5lcSYmKGM9dGhpcy50b0Fzc2lnbmFibGUoYywhMSx0KSksaXx8KHQucGFyZW50aGVzaXplZEFzc2lnbj10LnRyYWlsaW5nQ29tbWE9dC5kb3VibGVQcm90bz0tMSksdC5zaG9ydGhhbmRBc3NpZ24+PWMuc3RhcnQmJih0LnNob3J0aGFuZEFzc2lnbj0tMSksdGhpcy50eXBlPT09Y2MuZXE/dGhpcy5jaGVja0xWYWxQYXR0ZXJuKGMpOnRoaXMuY2hlY2tMVmFsU2ltcGxlKGMpLGgubGVmdD1jLHRoaXMubmV4dCgpLGgucmlnaHQ9dGhpcy5wYXJzZU1heWJlQXNzaWduKGUpLG8+LTEmJih0LmRvdWJsZVByb3RvPW8pLHRoaXMuZmluaXNoTm9kZShoLCJBc3NpZ25tZW50RXhwcmVzc2lvbiIpfXJldHVybiBpJiZ0aGlzLmNoZWNrRXhwcmVzc2lvbkVycm9ycyh0LCEwKSxuPi0xJiYodC5wYXJlbnRoZXNpemVkQXNzaWduPW4pLHI+LTEmJih0LnRyYWlsaW5nQ29tbWE9ciksY30sWWMucGFyc2VNYXliZUNvbmRpdGlvbmFsPWZ1bmN0aW9uKGUsdCl7dmFyIHM9dGhpcy5zdGFydCxpPXRoaXMuc3RhcnRMb2Msbj10aGlzLnBhcnNlRXhwck9wcyhlLHQpO2lmKHRoaXMuY2hlY2tFeHByZXNzaW9uRXJyb3JzKHQpKXJldHVybiBuO2lmKHRoaXMuZWF0KGNjLnF1ZXN0aW9uKSl7dmFyIHI9dGhpcy5zdGFydE5vZGVBdChzLGkpO3JldHVybiByLnRlc3Q9bixyLmNvbnNlcXVlbnQ9dGhpcy5wYXJzZU1heWJlQXNzaWduKCksdGhpcy5leHBlY3QoY2MuY29sb24pLHIuYWx0ZXJuYXRlPXRoaXMucGFyc2VNYXliZUFzc2lnbihlKSx0aGlzLmZpbmlzaE5vZGUociwiQ29uZGl0aW9uYWxFeHByZXNzaW9uIil9cmV0dXJuIG59LFljLnBhcnNlRXhwck9wcz1mdW5jdGlvbihlLHQpe3ZhciBzPXRoaXMuc3RhcnQsaT10aGlzLnN0YXJ0TG9jLG49dGhpcy5wYXJzZU1heWJlVW5hcnkodCwhMSwhMSxlKTtyZXR1cm4gdGhpcy5jaGVja0V4cHJlc3Npb25FcnJvcnModCl8fG4uc3RhcnQ9PT1zJiYiQXJyb3dGdW5jdGlvbkV4cHJlc3Npb24iPT09bi50eXBlP246dGhpcy5wYXJzZUV4cHJPcChuLHMsaSwtMSxlKX0sWWMucGFyc2VFeHByT3A9ZnVuY3Rpb24oZSx0LHMsaSxuKXt2YXIgcj10aGlzLnR5cGUuYmlub3A7aWYobnVsbCE9ciYmKCFufHx0aGlzLnR5cGUhPT1jYy5faW4pJiZyPmkpe3ZhciBvPXRoaXMudHlwZT09PWNjLmxvZ2ljYWxPUnx8dGhpcy50eXBlPT09Y2MubG9naWNhbEFORCxhPXRoaXMudHlwZT09PWNjLmNvYWxlc2NlO2EmJihyPWNjLmxvZ2ljYWxBTkQuYmlub3ApO3ZhciBsPXRoaXMudmFsdWU7dGhpcy5uZXh0KCk7dmFyIGM9dGhpcy5zdGFydCxoPXRoaXMuc3RhcnRMb2MsdT10aGlzLnBhcnNlRXhwck9wKHRoaXMucGFyc2VNYXliZVVuYXJ5KG51bGwsITEsITEsbiksYyxoLHIsbiksZD10aGlzLmJ1aWxkQmluYXJ5KHQscyxlLHUsbCxvfHxhKTtyZXR1cm4gKG8mJnRoaXMudHlwZT09PWNjLmNvYWxlc2NlfHxhJiYodGhpcy50eXBlPT09Y2MubG9naWNhbE9SfHx0aGlzLnR5cGU9PT1jYy5sb2dpY2FsQU5EKSkmJnRoaXMucmFpc2VSZWNvdmVyYWJsZSh0aGlzLnN0YXJ0LCJMb2dpY2FsIGV4cHJlc3Npb25zIGFuZCBjb2FsZXNjZSBleHByZXNzaW9ucyBjYW5ub3QgYmUgbWl4ZWQuIFdyYXAgZWl0aGVyIGJ5IHBhcmVudGhlc2VzIiksdGhpcy5wYXJzZUV4cHJPcChkLHQscyxpLG4pfXJldHVybiBlfSxZYy5idWlsZEJpbmFyeT1mdW5jdGlvbihlLHQscyxpLG4scil7IlByaXZhdGVJZGVudGlmaWVyIj09PWkudHlwZSYmdGhpcy5yYWlzZShpLnN0YXJ0LCJQcml2YXRlIGlkZW50aWZpZXIgY2FuIG9ubHkgYmUgbGVmdCBzaWRlIG9mIGJpbmFyeSBleHByZXNzaW9uIik7dmFyIG89dGhpcy5zdGFydE5vZGVBdChlLHQpO3JldHVybiBvLmxlZnQ9cyxvLm9wZXJhdG9yPW4sby5yaWdodD1pLHRoaXMuZmluaXNoTm9kZShvLHI/IkxvZ2ljYWxFeHByZXNzaW9uIjoiQmluYXJ5RXhwcmVzc2lvbiIpfSxZYy5wYXJzZU1heWJlVW5hcnk9ZnVuY3Rpb24oZSx0LHMsaSl7dmFyIG4scj10aGlzLnN0YXJ0LG89dGhpcy5zdGFydExvYztpZih0aGlzLmlzQ29udGV4dHVhbCgiYXdhaXQiKSYmdGhpcy5jYW5Bd2FpdCluPXRoaXMucGFyc2VBd2FpdChpKSx0PSEwO2Vsc2UgaWYodGhpcy50eXBlLnByZWZpeCl7dmFyIGE9dGhpcy5zdGFydE5vZGUoKSxsPXRoaXMudHlwZT09PWNjLmluY0RlYzthLm9wZXJhdG9yPXRoaXMudmFsdWUsYS5wcmVmaXg9ITAsdGhpcy5uZXh0KCksYS5hcmd1bWVudD10aGlzLnBhcnNlTWF5YmVVbmFyeShudWxsLCEwLGwsaSksdGhpcy5jaGVja0V4cHJlc3Npb25FcnJvcnMoZSwhMCksbD90aGlzLmNoZWNrTFZhbFNpbXBsZShhLmFyZ3VtZW50KTp0aGlzLnN0cmljdCYmImRlbGV0ZSI9PT1hLm9wZXJhdG9yJiYiSWRlbnRpZmllciI9PT1hLmFyZ3VtZW50LnR5cGU/dGhpcy5yYWlzZVJlY292ZXJhYmxlKGEuc3RhcnQsIkRlbGV0aW5nIGxvY2FsIHZhcmlhYmxlIGluIHN0cmljdCBtb2RlIik6ImRlbGV0ZSI9PT1hLm9wZXJhdG9yJiZYYyhhLmFyZ3VtZW50KT90aGlzLnJhaXNlUmVjb3ZlcmFibGUoYS5zdGFydCwiUHJpdmF0ZSBmaWVsZHMgY2FuIG5vdCBiZSBkZWxldGVkIik6dD0hMCxuPXRoaXMuZmluaXNoTm9kZShhLGw/IlVwZGF0ZUV4cHJlc3Npb24iOiJVbmFyeUV4cHJlc3Npb24iKTt9ZWxzZSBpZih0fHx0aGlzLnR5cGUhPT1jYy5wcml2YXRlSWQpe2lmKG49dGhpcy5wYXJzZUV4cHJTdWJzY3JpcHRzKGUsaSksdGhpcy5jaGVja0V4cHJlc3Npb25FcnJvcnMoZSkpcmV0dXJuIG47Zm9yKDt0aGlzLnR5cGUucG9zdGZpeCYmIXRoaXMuY2FuSW5zZXJ0U2VtaWNvbG9uKCk7KXt2YXIgYz10aGlzLnN0YXJ0Tm9kZUF0KHIsbyk7Yy5vcGVyYXRvcj10aGlzLnZhbHVlLGMucHJlZml4PSExLGMuYXJndW1lbnQ9bix0aGlzLmNoZWNrTFZhbFNpbXBsZShuKSx0aGlzLm5leHQoKSxuPXRoaXMuZmluaXNoTm9kZShjLCJVcGRhdGVFeHByZXNzaW9uIik7fX1lbHNlIChpfHwwPT09dGhpcy5wcml2YXRlTmFtZVN0YWNrLmxlbmd0aCkmJnRoaXMub3B0aW9ucy5jaGVja1ByaXZhdGVGaWVsZHMmJnRoaXMudW5leHBlY3RlZCgpLG49dGhpcy5wYXJzZVByaXZhdGVJZGVudCgpLHRoaXMudHlwZSE9PWNjLl9pbiYmdGhpcy51bmV4cGVjdGVkKCk7cmV0dXJuIHN8fCF0aGlzLmVhdChjYy5zdGFyc3Rhcik/bjp0P3ZvaWQgdGhpcy51bmV4cGVjdGVkKHRoaXMubGFzdFRva1N0YXJ0KTp0aGlzLmJ1aWxkQmluYXJ5KHIsbyxuLHRoaXMucGFyc2VNYXliZVVuYXJ5KG51bGwsITEsITEsaSksIioqIiwhMSl9LFljLnBhcnNlRXhwclN1YnNjcmlwdHM9ZnVuY3Rpb24oZSx0KXt2YXIgcz10aGlzLnN0YXJ0LGk9dGhpcy5zdGFydExvYyxuPXRoaXMucGFyc2VFeHByQXRvbShlLHQpO2lmKCJBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbiI9PT1uLnR5cGUmJiIpIiE9PXRoaXMuaW5wdXQuc2xpY2UodGhpcy5sYXN0VG9rU3RhcnQsdGhpcy5sYXN0VG9rRW5kKSlyZXR1cm4gbjt2YXIgcj10aGlzLnBhcnNlU3Vic2NyaXB0cyhuLHMsaSwhMSx0KTtyZXR1cm4gZSYmIk1lbWJlckV4cHJlc3Npb24iPT09ci50eXBlJiYoZS5wYXJlbnRoZXNpemVkQXNzaWduPj1yLnN0YXJ0JiYoZS5wYXJlbnRoZXNpemVkQXNzaWduPS0xKSxlLnBhcmVudGhlc2l6ZWRCaW5kPj1yLnN0YXJ0JiYoZS5wYXJlbnRoZXNpemVkQmluZD0tMSksZS50cmFpbGluZ0NvbW1hPj1yLnN0YXJ0JiYoZS50cmFpbGluZ0NvbW1hPS0xKSkscn0sWWMucGFyc2VTdWJzY3JpcHRzPWZ1bmN0aW9uKGUsdCxzLGksbil7Zm9yKHZhciByPXRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49OCYmIklkZW50aWZpZXIiPT09ZS50eXBlJiYiYXN5bmMiPT09ZS5uYW1lJiZ0aGlzLmxhc3RUb2tFbmQ9PT1lLmVuZCYmIXRoaXMuY2FuSW5zZXJ0U2VtaWNvbG9uKCkmJmUuZW5kLWUuc3RhcnQ9PTUmJnRoaXMucG90ZW50aWFsQXJyb3dBdD09PWUuc3RhcnQsbz0hMTs7KXt2YXIgYT10aGlzLnBhcnNlU3Vic2NyaXB0KGUsdCxzLGkscixvLG4pO2lmKGEub3B0aW9uYWwmJihvPSEwKSxhPT09ZXx8IkFycm93RnVuY3Rpb25FeHByZXNzaW9uIj09PWEudHlwZSl7aWYobyl7dmFyIGw9dGhpcy5zdGFydE5vZGVBdCh0LHMpO2wuZXhwcmVzc2lvbj1hLGE9dGhpcy5maW5pc2hOb2RlKGwsIkNoYWluRXhwcmVzc2lvbiIpO31yZXR1cm4gYX1lPWE7fX0sWWMuc2hvdWxkUGFyc2VBc3luY0Fycm93PWZ1bmN0aW9uKCl7cmV0dXJuICF0aGlzLmNhbkluc2VydFNlbWljb2xvbigpJiZ0aGlzLmVhdChjYy5hcnJvdyl9LFljLnBhcnNlU3Vic2NyaXB0QXN5bmNBcnJvdz1mdW5jdGlvbihlLHQscyxpKXtyZXR1cm4gdGhpcy5wYXJzZUFycm93RXhwcmVzc2lvbih0aGlzLnN0YXJ0Tm9kZUF0KGUsdCkscywhMCxpKX0sWWMucGFyc2VTdWJzY3JpcHQ9ZnVuY3Rpb24oZSx0LHMsaSxuLHIsbyl7dmFyIGE9dGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj0xMSxsPWEmJnRoaXMuZWF0KGNjLnF1ZXN0aW9uRG90KTtpJiZsJiZ0aGlzLnJhaXNlKHRoaXMubGFzdFRva1N0YXJ0LCJPcHRpb25hbCBjaGFpbmluZyBjYW5ub3QgYXBwZWFyIGluIHRoZSBjYWxsZWUgb2YgbmV3IGV4cHJlc3Npb25zIik7dmFyIGM9dGhpcy5lYXQoY2MuYnJhY2tldEwpO2lmKGN8fGwmJnRoaXMudHlwZSE9PWNjLnBhcmVuTCYmdGhpcy50eXBlIT09Y2MuYmFja1F1b3RlfHx0aGlzLmVhdChjYy5kb3QpKXt2YXIgaD10aGlzLnN0YXJ0Tm9kZUF0KHQscyk7aC5vYmplY3Q9ZSxjPyhoLnByb3BlcnR5PXRoaXMucGFyc2VFeHByZXNzaW9uKCksdGhpcy5leHBlY3QoY2MuYnJhY2tldFIpKTp0aGlzLnR5cGU9PT1jYy5wcml2YXRlSWQmJiJTdXBlciIhPT1lLnR5cGU/aC5wcm9wZXJ0eT10aGlzLnBhcnNlUHJpdmF0ZUlkZW50KCk6aC5wcm9wZXJ0eT10aGlzLnBhcnNlSWRlbnQoIm5ldmVyIiE9PXRoaXMub3B0aW9ucy5hbGxvd1Jlc2VydmVkKSxoLmNvbXB1dGVkPSEhYyxhJiYoaC5vcHRpb25hbD1sKSxlPXRoaXMuZmluaXNoTm9kZShoLCJNZW1iZXJFeHByZXNzaW9uIik7fWVsc2UgaWYoIWkmJnRoaXMuZWF0KGNjLnBhcmVuTCkpe3ZhciB1PW5ldyBMYyxkPXRoaXMueWllbGRQb3MscD10aGlzLmF3YWl0UG9zLGY9dGhpcy5hd2FpdElkZW50UG9zO3RoaXMueWllbGRQb3M9MCx0aGlzLmF3YWl0UG9zPTAsdGhpcy5hd2FpdElkZW50UG9zPTA7dmFyIG09dGhpcy5wYXJzZUV4cHJMaXN0KGNjLnBhcmVuUix0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTgsITEsdSk7aWYobiYmIWwmJnRoaXMuc2hvdWxkUGFyc2VBc3luY0Fycm93KCkpcmV0dXJuIHRoaXMuY2hlY2tQYXR0ZXJuRXJyb3JzKHUsITEpLHRoaXMuY2hlY2tZaWVsZEF3YWl0SW5EZWZhdWx0UGFyYW1zKCksdGhpcy5hd2FpdElkZW50UG9zPjAmJnRoaXMucmFpc2UodGhpcy5hd2FpdElkZW50UG9zLCJDYW5ub3QgdXNlICdhd2FpdCcgYXMgaWRlbnRpZmllciBpbnNpZGUgYW4gYXN5bmMgZnVuY3Rpb24iKSx0aGlzLnlpZWxkUG9zPWQsdGhpcy5hd2FpdFBvcz1wLHRoaXMuYXdhaXRJZGVudFBvcz1mLHRoaXMucGFyc2VTdWJzY3JpcHRBc3luY0Fycm93KHQscyxtLG8pO3RoaXMuY2hlY2tFeHByZXNzaW9uRXJyb3JzKHUsITApLHRoaXMueWllbGRQb3M9ZHx8dGhpcy55aWVsZFBvcyx0aGlzLmF3YWl0UG9zPXB8fHRoaXMuYXdhaXRQb3MsdGhpcy5hd2FpdElkZW50UG9zPWZ8fHRoaXMuYXdhaXRJZGVudFBvczt2YXIgZz10aGlzLnN0YXJ0Tm9kZUF0KHQscyk7Zy5jYWxsZWU9ZSxnLmFyZ3VtZW50cz1tLGEmJihnLm9wdGlvbmFsPWwpLGU9dGhpcy5maW5pc2hOb2RlKGcsIkNhbGxFeHByZXNzaW9uIik7fWVsc2UgaWYodGhpcy50eXBlPT09Y2MuYmFja1F1b3RlKXsobHx8cikmJnRoaXMucmFpc2UodGhpcy5zdGFydCwiT3B0aW9uYWwgY2hhaW5pbmcgY2Fubm90IGFwcGVhciBpbiB0aGUgdGFnIG9mIHRhZ2dlZCB0ZW1wbGF0ZSBleHByZXNzaW9ucyIpO3ZhciB5PXRoaXMuc3RhcnROb2RlQXQodCxzKTt5LnRhZz1lLHkucXVhc2k9dGhpcy5wYXJzZVRlbXBsYXRlKHtpc1RhZ2dlZDohMH0pLGU9dGhpcy5maW5pc2hOb2RlKHksIlRhZ2dlZFRlbXBsYXRlRXhwcmVzc2lvbiIpO31yZXR1cm4gZX0sWWMucGFyc2VFeHByQXRvbT1mdW5jdGlvbihlLHQscyl7dGhpcy50eXBlPT09Y2Muc2xhc2gmJnRoaXMucmVhZFJlZ2V4cCgpO3ZhciBpLG49dGhpcy5wb3RlbnRpYWxBcnJvd0F0PT09dGhpcy5zdGFydDtzd2l0Y2godGhpcy50eXBlKXtjYXNlIGNjLl9zdXBlcjpyZXR1cm4gdGhpcy5hbGxvd1N1cGVyfHx0aGlzLnJhaXNlKHRoaXMuc3RhcnQsIidzdXBlcicga2V5d29yZCBvdXRzaWRlIGEgbWV0aG9kIiksaT10aGlzLnN0YXJ0Tm9kZSgpLHRoaXMubmV4dCgpLHRoaXMudHlwZSE9PWNjLnBhcmVuTHx8dGhpcy5hbGxvd0RpcmVjdFN1cGVyfHx0aGlzLnJhaXNlKGkuc3RhcnQsInN1cGVyKCkgY2FsbCBvdXRzaWRlIGNvbnN0cnVjdG9yIG9mIGEgc3ViY2xhc3MiKSx0aGlzLnR5cGUhPT1jYy5kb3QmJnRoaXMudHlwZSE9PWNjLmJyYWNrZXRMJiZ0aGlzLnR5cGUhPT1jYy5wYXJlbkwmJnRoaXMudW5leHBlY3RlZCgpLHRoaXMuZmluaXNoTm9kZShpLCJTdXBlciIpO2Nhc2UgY2MuX3RoaXM6cmV0dXJuIGk9dGhpcy5zdGFydE5vZGUoKSx0aGlzLm5leHQoKSx0aGlzLmZpbmlzaE5vZGUoaSwiVGhpc0V4cHJlc3Npb24iKTtjYXNlIGNjLm5hbWU6dmFyIHI9dGhpcy5zdGFydCxvPXRoaXMuc3RhcnRMb2MsYT10aGlzLmNvbnRhaW5zRXNjLGw9dGhpcy5wYXJzZUlkZW50KCExKTtpZih0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTgmJiFhJiYiYXN5bmMiPT09bC5uYW1lJiYhdGhpcy5jYW5JbnNlcnRTZW1pY29sb24oKSYmdGhpcy5lYXQoY2MuX2Z1bmN0aW9uKSlyZXR1cm4gdGhpcy5vdmVycmlkZUNvbnRleHQoSGMuZl9leHByKSx0aGlzLnBhcnNlRnVuY3Rpb24odGhpcy5zdGFydE5vZGVBdChyLG8pLDAsITEsITAsdCk7aWYobiYmIXRoaXMuY2FuSW5zZXJ0U2VtaWNvbG9uKCkpe2lmKHRoaXMuZWF0KGNjLmFycm93KSlyZXR1cm4gdGhpcy5wYXJzZUFycm93RXhwcmVzc2lvbih0aGlzLnN0YXJ0Tm9kZUF0KHIsbyksW2xdLCExLHQpO2lmKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49OCYmImFzeW5jIj09PWwubmFtZSYmdGhpcy50eXBlPT09Y2MubmFtZSYmIWEmJighdGhpcy5wb3RlbnRpYWxBcnJvd0luRm9yQXdhaXR8fCJvZiIhPT10aGlzLnZhbHVlfHx0aGlzLmNvbnRhaW5zRXNjKSlyZXR1cm4gbD10aGlzLnBhcnNlSWRlbnQoITEpLCF0aGlzLmNhbkluc2VydFNlbWljb2xvbigpJiZ0aGlzLmVhdChjYy5hcnJvdyl8fHRoaXMudW5leHBlY3RlZCgpLHRoaXMucGFyc2VBcnJvd0V4cHJlc3Npb24odGhpcy5zdGFydE5vZGVBdChyLG8pLFtsXSwhMCx0KX1yZXR1cm4gbDtjYXNlIGNjLnJlZ2V4cDp2YXIgYz10aGlzLnZhbHVlO3JldHVybiAoaT10aGlzLnBhcnNlTGl0ZXJhbChjLnZhbHVlKSkucmVnZXg9e3BhdHRlcm46Yy5wYXR0ZXJuLGZsYWdzOmMuZmxhZ3N9LGk7Y2FzZSBjYy5udW06Y2FzZSBjYy5zdHJpbmc6cmV0dXJuIHRoaXMucGFyc2VMaXRlcmFsKHRoaXMudmFsdWUpO2Nhc2UgY2MuX251bGw6Y2FzZSBjYy5fdHJ1ZTpjYXNlIGNjLl9mYWxzZTpyZXR1cm4gKGk9dGhpcy5zdGFydE5vZGUoKSkudmFsdWU9dGhpcy50eXBlPT09Y2MuX251bGw/bnVsbDp0aGlzLnR5cGU9PT1jYy5fdHJ1ZSxpLnJhdz10aGlzLnR5cGUua2V5d29yZCx0aGlzLm5leHQoKSx0aGlzLmZpbmlzaE5vZGUoaSwiTGl0ZXJhbCIpO2Nhc2UgY2MucGFyZW5MOnZhciBoPXRoaXMuc3RhcnQsdT10aGlzLnBhcnNlUGFyZW5BbmREaXN0aW5ndWlzaEV4cHJlc3Npb24obix0KTtyZXR1cm4gZSYmKGUucGFyZW50aGVzaXplZEFzc2lnbjwwJiYhdGhpcy5pc1NpbXBsZUFzc2lnblRhcmdldCh1KSYmKGUucGFyZW50aGVzaXplZEFzc2lnbj1oKSxlLnBhcmVudGhlc2l6ZWRCaW5kPDAmJihlLnBhcmVudGhlc2l6ZWRCaW5kPWgpKSx1O2Nhc2UgY2MuYnJhY2tldEw6cmV0dXJuIGk9dGhpcy5zdGFydE5vZGUoKSx0aGlzLm5leHQoKSxpLmVsZW1lbnRzPXRoaXMucGFyc2VFeHByTGlzdChjYy5icmFja2V0UiwhMCwhMCxlKSx0aGlzLmZpbmlzaE5vZGUoaSwiQXJyYXlFeHByZXNzaW9uIik7Y2FzZSBjYy5icmFjZUw6cmV0dXJuIHRoaXMub3ZlcnJpZGVDb250ZXh0KEhjLmJfZXhwciksdGhpcy5wYXJzZU9iaighMSxlKTtjYXNlIGNjLl9mdW5jdGlvbjpyZXR1cm4gaT10aGlzLnN0YXJ0Tm9kZSgpLHRoaXMubmV4dCgpLHRoaXMucGFyc2VGdW5jdGlvbihpLDApO2Nhc2UgY2MuX2NsYXNzOnJldHVybiB0aGlzLnBhcnNlQ2xhc3ModGhpcy5zdGFydE5vZGUoKSwhMSk7Y2FzZSBjYy5fbmV3OnJldHVybiB0aGlzLnBhcnNlTmV3KCk7Y2FzZSBjYy5iYWNrUXVvdGU6cmV0dXJuIHRoaXMucGFyc2VUZW1wbGF0ZSgpO2Nhc2UgY2MuX2ltcG9ydDpyZXR1cm4gdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj0xMT90aGlzLnBhcnNlRXhwckltcG9ydChzKTp0aGlzLnVuZXhwZWN0ZWQoKTtkZWZhdWx0OnJldHVybiB0aGlzLnBhcnNlRXhwckF0b21EZWZhdWx0KCl9fSxZYy5wYXJzZUV4cHJBdG9tRGVmYXVsdD1mdW5jdGlvbigpe3RoaXMudW5leHBlY3RlZCgpO30sWWMucGFyc2VFeHBySW1wb3J0PWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuc3RhcnROb2RlKCk7dGhpcy5jb250YWluc0VzYyYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKHRoaXMuc3RhcnQsIkVzY2FwZSBzZXF1ZW5jZSBpbiBrZXl3b3JkIGltcG9ydCIpO3ZhciBzPXRoaXMucGFyc2VJZGVudCghMCk7cmV0dXJuIHRoaXMudHlwZSE9PWNjLnBhcmVuTHx8ZT90aGlzLnR5cGU9PT1jYy5kb3Q/KHQubWV0YT1zLHRoaXMucGFyc2VJbXBvcnRNZXRhKHQpKTp2b2lkIHRoaXMudW5leHBlY3RlZCgpOnRoaXMucGFyc2VEeW5hbWljSW1wb3J0KHQpfSxZYy5wYXJzZUR5bmFtaWNJbXBvcnQ9ZnVuY3Rpb24oZSl7aWYodGhpcy5uZXh0KCksZS5zb3VyY2U9dGhpcy5wYXJzZU1heWJlQXNzaWduKCksIXRoaXMuZWF0KGNjLnBhcmVuUikpe3ZhciB0PXRoaXMuc3RhcnQ7dGhpcy5lYXQoY2MuY29tbWEpJiZ0aGlzLmVhdChjYy5wYXJlblIpP3RoaXMucmFpc2VSZWNvdmVyYWJsZSh0LCJUcmFpbGluZyBjb21tYSBpcyBub3QgYWxsb3dlZCBpbiBpbXBvcnQoKSIpOnRoaXMudW5leHBlY3RlZCh0KTt9cmV0dXJuIHRoaXMuZmluaXNoTm9kZShlLCJJbXBvcnRFeHByZXNzaW9uIil9LFljLnBhcnNlSW1wb3J0TWV0YT1mdW5jdGlvbihlKXt0aGlzLm5leHQoKTt2YXIgdD10aGlzLmNvbnRhaW5zRXNjO3JldHVybiBlLnByb3BlcnR5PXRoaXMucGFyc2VJZGVudCghMCksIm1ldGEiIT09ZS5wcm9wZXJ0eS5uYW1lJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUoZS5wcm9wZXJ0eS5zdGFydCwiVGhlIG9ubHkgdmFsaWQgbWV0YSBwcm9wZXJ0eSBmb3IgaW1wb3J0IGlzICdpbXBvcnQubWV0YSciKSx0JiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUoZS5zdGFydCwiJ2ltcG9ydC5tZXRhJyBtdXN0IG5vdCBjb250YWluIGVzY2FwZWQgY2hhcmFjdGVycyIpLCJtb2R1bGUiPT09dGhpcy5vcHRpb25zLnNvdXJjZVR5cGV8fHRoaXMub3B0aW9ucy5hbGxvd0ltcG9ydEV4cG9ydEV2ZXJ5d2hlcmV8fHRoaXMucmFpc2VSZWNvdmVyYWJsZShlLnN0YXJ0LCJDYW5ub3QgdXNlICdpbXBvcnQubWV0YScgb3V0c2lkZSBhIG1vZHVsZSIpLHRoaXMuZmluaXNoTm9kZShlLCJNZXRhUHJvcGVydHkiKX0sWWMucGFyc2VMaXRlcmFsPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuc3RhcnROb2RlKCk7cmV0dXJuIHQudmFsdWU9ZSx0LnJhdz10aGlzLmlucHV0LnNsaWNlKHRoaXMuc3RhcnQsdGhpcy5lbmQpLDExMD09PXQucmF3LmNoYXJDb2RlQXQodC5yYXcubGVuZ3RoLTEpJiYodC5iaWdpbnQ9dC5yYXcuc2xpY2UoMCwtMSkucmVwbGFjZSgvXy9nLCIiKSksdGhpcy5uZXh0KCksdGhpcy5maW5pc2hOb2RlKHQsIkxpdGVyYWwiKX0sWWMucGFyc2VQYXJlbkV4cHJlc3Npb249ZnVuY3Rpb24oKXt0aGlzLmV4cGVjdChjYy5wYXJlbkwpO3ZhciBlPXRoaXMucGFyc2VFeHByZXNzaW9uKCk7cmV0dXJuIHRoaXMuZXhwZWN0KGNjLnBhcmVuUiksZX0sWWMuc2hvdWxkUGFyc2VBcnJvdz1mdW5jdGlvbihlKXtyZXR1cm4gIXRoaXMuY2FuSW5zZXJ0U2VtaWNvbG9uKCl9LFljLnBhcnNlUGFyZW5BbmREaXN0aW5ndWlzaEV4cHJlc3Npb249ZnVuY3Rpb24oZSx0KXt2YXIgcyxpPXRoaXMuc3RhcnQsbj10aGlzLnN0YXJ0TG9jLHI9dGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj04O2lmKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49Nil7dGhpcy5uZXh0KCk7dmFyIG8sYT10aGlzLnN0YXJ0LGw9dGhpcy5zdGFydExvYyxjPVtdLGg9ITAsdT0hMSxkPW5ldyBMYyxwPXRoaXMueWllbGRQb3MsZj10aGlzLmF3YWl0UG9zO2Zvcih0aGlzLnlpZWxkUG9zPTAsdGhpcy5hd2FpdFBvcz0wO3RoaXMudHlwZSE9PWNjLnBhcmVuUjspe2lmKGg/aD0hMTp0aGlzLmV4cGVjdChjYy5jb21tYSksciYmdGhpcy5hZnRlclRyYWlsaW5nQ29tbWEoY2MucGFyZW5SLCEwKSl7dT0hMDticmVha31pZih0aGlzLnR5cGU9PT1jYy5lbGxpcHNpcyl7bz10aGlzLnN0YXJ0LGMucHVzaCh0aGlzLnBhcnNlUGFyZW5JdGVtKHRoaXMucGFyc2VSZXN0QmluZGluZygpKSksdGhpcy50eXBlPT09Y2MuY29tbWEmJnRoaXMucmFpc2VSZWNvdmVyYWJsZSh0aGlzLnN0YXJ0LCJDb21tYSBpcyBub3QgcGVybWl0dGVkIGFmdGVyIHRoZSByZXN0IGVsZW1lbnQiKTticmVha31jLnB1c2godGhpcy5wYXJzZU1heWJlQXNzaWduKCExLGQsdGhpcy5wYXJzZVBhcmVuSXRlbSkpO312YXIgbT10aGlzLmxhc3RUb2tFbmQsZz10aGlzLmxhc3RUb2tFbmRMb2M7aWYodGhpcy5leHBlY3QoY2MucGFyZW5SKSxlJiZ0aGlzLnNob3VsZFBhcnNlQXJyb3coYykmJnRoaXMuZWF0KGNjLmFycm93KSlyZXR1cm4gdGhpcy5jaGVja1BhdHRlcm5FcnJvcnMoZCwhMSksdGhpcy5jaGVja1lpZWxkQXdhaXRJbkRlZmF1bHRQYXJhbXMoKSx0aGlzLnlpZWxkUG9zPXAsdGhpcy5hd2FpdFBvcz1mLHRoaXMucGFyc2VQYXJlbkFycm93TGlzdChpLG4sYyx0KTtjLmxlbmd0aCYmIXV8fHRoaXMudW5leHBlY3RlZCh0aGlzLmxhc3RUb2tTdGFydCksbyYmdGhpcy51bmV4cGVjdGVkKG8pLHRoaXMuY2hlY2tFeHByZXNzaW9uRXJyb3JzKGQsITApLHRoaXMueWllbGRQb3M9cHx8dGhpcy55aWVsZFBvcyx0aGlzLmF3YWl0UG9zPWZ8fHRoaXMuYXdhaXRQb3MsYy5sZW5ndGg+MT8oKHM9dGhpcy5zdGFydE5vZGVBdChhLGwpKS5leHByZXNzaW9ucz1jLHRoaXMuZmluaXNoTm9kZUF0KHMsIlNlcXVlbmNlRXhwcmVzc2lvbiIsbSxnKSk6cz1jWzBdO31lbHNlIHM9dGhpcy5wYXJzZVBhcmVuRXhwcmVzc2lvbigpO2lmKHRoaXMub3B0aW9ucy5wcmVzZXJ2ZVBhcmVucyl7dmFyIHk9dGhpcy5zdGFydE5vZGVBdChpLG4pO3JldHVybiB5LmV4cHJlc3Npb249cyx0aGlzLmZpbmlzaE5vZGUoeSwiUGFyZW50aGVzaXplZEV4cHJlc3Npb24iKX1yZXR1cm4gc30sWWMucGFyc2VQYXJlbkl0ZW09ZnVuY3Rpb24oZSl7cmV0dXJuIGV9LFljLnBhcnNlUGFyZW5BcnJvd0xpc3Q9ZnVuY3Rpb24oZSx0LHMsaSl7cmV0dXJuIHRoaXMucGFyc2VBcnJvd0V4cHJlc3Npb24odGhpcy5zdGFydE5vZGVBdChlLHQpLHMsITEsaSl9O3ZhciBRYz1bXTtZYy5wYXJzZU5ldz1mdW5jdGlvbigpe3RoaXMuY29udGFpbnNFc2MmJnRoaXMucmFpc2VSZWNvdmVyYWJsZSh0aGlzLnN0YXJ0LCJFc2NhcGUgc2VxdWVuY2UgaW4ga2V5d29yZCBuZXciKTt2YXIgZT10aGlzLnN0YXJ0Tm9kZSgpLHQ9dGhpcy5wYXJzZUlkZW50KCEwKTtpZih0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTYmJnRoaXMuZWF0KGNjLmRvdCkpe2UubWV0YT10O3ZhciBzPXRoaXMuY29udGFpbnNFc2M7cmV0dXJuIGUucHJvcGVydHk9dGhpcy5wYXJzZUlkZW50KCEwKSwidGFyZ2V0IiE9PWUucHJvcGVydHkubmFtZSYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKGUucHJvcGVydHkuc3RhcnQsIlRoZSBvbmx5IHZhbGlkIG1ldGEgcHJvcGVydHkgZm9yIG5ldyBpcyAnbmV3LnRhcmdldCciKSxzJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUoZS5zdGFydCwiJ25ldy50YXJnZXQnIG11c3Qgbm90IGNvbnRhaW4gZXNjYXBlZCBjaGFyYWN0ZXJzIiksdGhpcy5hbGxvd05ld0RvdFRhcmdldHx8dGhpcy5yYWlzZVJlY292ZXJhYmxlKGUuc3RhcnQsIiduZXcudGFyZ2V0JyBjYW4gb25seSBiZSB1c2VkIGluIGZ1bmN0aW9ucyBhbmQgY2xhc3Mgc3RhdGljIGJsb2NrIiksdGhpcy5maW5pc2hOb2RlKGUsIk1ldGFQcm9wZXJ0eSIpfXZhciBpPXRoaXMuc3RhcnQsbj10aGlzLnN0YXJ0TG9jO3JldHVybiBlLmNhbGxlZT10aGlzLnBhcnNlU3Vic2NyaXB0cyh0aGlzLnBhcnNlRXhwckF0b20obnVsbCwhMSwhMCksaSxuLCEwLCExKSx0aGlzLmVhdChjYy5wYXJlbkwpP2UuYXJndW1lbnRzPXRoaXMucGFyc2VFeHByTGlzdChjYy5wYXJlblIsdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj04LCExKTplLmFyZ3VtZW50cz1RYyx0aGlzLmZpbmlzaE5vZGUoZSwiTmV3RXhwcmVzc2lvbiIpfSxZYy5wYXJzZVRlbXBsYXRlRWxlbWVudD1mdW5jdGlvbihlKXt2YXIgdD1lLmlzVGFnZ2VkLHM9dGhpcy5zdGFydE5vZGUoKTtyZXR1cm4gdGhpcy50eXBlPT09Y2MuaW52YWxpZFRlbXBsYXRlPyh0fHx0aGlzLnJhaXNlUmVjb3ZlcmFibGUodGhpcy5zdGFydCwiQmFkIGVzY2FwZSBzZXF1ZW5jZSBpbiB1bnRhZ2dlZCB0ZW1wbGF0ZSBsaXRlcmFsIikscy52YWx1ZT17cmF3OnRoaXMudmFsdWUsY29va2VkOm51bGx9KTpzLnZhbHVlPXtyYXc6dGhpcy5pbnB1dC5zbGljZSh0aGlzLnN0YXJ0LHRoaXMuZW5kKS5yZXBsYWNlKC9cclxuPy9nLCJcbiIpLGNvb2tlZDp0aGlzLnZhbHVlfSx0aGlzLm5leHQoKSxzLnRhaWw9dGhpcy50eXBlPT09Y2MuYmFja1F1b3RlLHRoaXMuZmluaXNoTm9kZShzLCJUZW1wbGF0ZUVsZW1lbnQiKX0sWWMucGFyc2VUZW1wbGF0ZT1mdW5jdGlvbihlKXt2b2lkIDA9PT1lJiYoZT17fSk7dmFyIHQ9ZS5pc1RhZ2dlZDt2b2lkIDA9PT10JiYodD0hMSk7dmFyIHM9dGhpcy5zdGFydE5vZGUoKTt0aGlzLm5leHQoKSxzLmV4cHJlc3Npb25zPVtdO3ZhciBpPXRoaXMucGFyc2VUZW1wbGF0ZUVsZW1lbnQoe2lzVGFnZ2VkOnR9KTtmb3Iocy5xdWFzaXM9W2ldOyFpLnRhaWw7KXRoaXMudHlwZT09PWNjLmVvZiYmdGhpcy5yYWlzZSh0aGlzLnBvcywiVW50ZXJtaW5hdGVkIHRlbXBsYXRlIGxpdGVyYWwiKSx0aGlzLmV4cGVjdChjYy5kb2xsYXJCcmFjZUwpLHMuZXhwcmVzc2lvbnMucHVzaCh0aGlzLnBhcnNlRXhwcmVzc2lvbigpKSx0aGlzLmV4cGVjdChjYy5icmFjZVIpLHMucXVhc2lzLnB1c2goaT10aGlzLnBhcnNlVGVtcGxhdGVFbGVtZW50KHtpc1RhZ2dlZDp0fSkpO3JldHVybiB0aGlzLm5leHQoKSx0aGlzLmZpbmlzaE5vZGUocywiVGVtcGxhdGVMaXRlcmFsIil9LFljLmlzQXN5bmNQcm9wPWZ1bmN0aW9uKGUpe3JldHVybiAhZS5jb21wdXRlZCYmIklkZW50aWZpZXIiPT09ZS5rZXkudHlwZSYmImFzeW5jIj09PWUua2V5Lm5hbWUmJih0aGlzLnR5cGU9PT1jYy5uYW1lfHx0aGlzLnR5cGU9PT1jYy5udW18fHRoaXMudHlwZT09PWNjLnN0cmluZ3x8dGhpcy50eXBlPT09Y2MuYnJhY2tldEx8fHRoaXMudHlwZS5rZXl3b3JkfHx0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTkmJnRoaXMudHlwZT09PWNjLnN0YXIpJiYhaGMudGVzdCh0aGlzLmlucHV0LnNsaWNlKHRoaXMubGFzdFRva0VuZCx0aGlzLnN0YXJ0KSl9LFljLnBhcnNlT2JqPWZ1bmN0aW9uKGUsdCl7dmFyIHM9dGhpcy5zdGFydE5vZGUoKSxpPSEwLG49e307Zm9yKHMucHJvcGVydGllcz1bXSx0aGlzLm5leHQoKTshdGhpcy5lYXQoY2MuYnJhY2VSKTspe2lmKGkpaT0hMTtlbHNlIGlmKHRoaXMuZXhwZWN0KGNjLmNvbW1hKSx0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTUmJnRoaXMuYWZ0ZXJUcmFpbGluZ0NvbW1hKGNjLmJyYWNlUikpYnJlYWs7dmFyIHI9dGhpcy5wYXJzZVByb3BlcnR5KGUsdCk7ZXx8dGhpcy5jaGVja1Byb3BDbGFzaChyLG4sdCkscy5wcm9wZXJ0aWVzLnB1c2gocik7fXJldHVybiB0aGlzLmZpbmlzaE5vZGUocyxlPyJPYmplY3RQYXR0ZXJuIjoiT2JqZWN0RXhwcmVzc2lvbiIpfSxZYy5wYXJzZVByb3BlcnR5PWZ1bmN0aW9uKGUsdCl7dmFyIHMsaSxuLHIsbz10aGlzLnN0YXJ0Tm9kZSgpO2lmKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49OSYmdGhpcy5lYXQoY2MuZWxsaXBzaXMpKXJldHVybiBlPyhvLmFyZ3VtZW50PXRoaXMucGFyc2VJZGVudCghMSksdGhpcy50eXBlPT09Y2MuY29tbWEmJnRoaXMucmFpc2VSZWNvdmVyYWJsZSh0aGlzLnN0YXJ0LCJDb21tYSBpcyBub3QgcGVybWl0dGVkIGFmdGVyIHRoZSByZXN0IGVsZW1lbnQiKSx0aGlzLmZpbmlzaE5vZGUobywiUmVzdEVsZW1lbnQiKSk6KG8uYXJndW1lbnQ9dGhpcy5wYXJzZU1heWJlQXNzaWduKCExLHQpLHRoaXMudHlwZT09PWNjLmNvbW1hJiZ0JiZ0LnRyYWlsaW5nQ29tbWE8MCYmKHQudHJhaWxpbmdDb21tYT10aGlzLnN0YXJ0KSx0aGlzLmZpbmlzaE5vZGUobywiU3ByZWFkRWxlbWVudCIpKTt0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTYmJihvLm1ldGhvZD0hMSxvLnNob3J0aGFuZD0hMSwoZXx8dCkmJihuPXRoaXMuc3RhcnQscj10aGlzLnN0YXJ0TG9jKSxlfHwocz10aGlzLmVhdChjYy5zdGFyKSkpO3ZhciBhPXRoaXMuY29udGFpbnNFc2M7cmV0dXJuIHRoaXMucGFyc2VQcm9wZXJ0eU5hbWUobyksIWUmJiFhJiZ0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTgmJiFzJiZ0aGlzLmlzQXN5bmNQcm9wKG8pPyhpPSEwLHM9dGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj05JiZ0aGlzLmVhdChjYy5zdGFyKSx0aGlzLnBhcnNlUHJvcGVydHlOYW1lKG8pKTppPSExLHRoaXMucGFyc2VQcm9wZXJ0eVZhbHVlKG8sZSxzLGksbixyLHQsYSksdGhpcy5maW5pc2hOb2RlKG8sIlByb3BlcnR5Iil9LFljLnBhcnNlR2V0dGVyU2V0dGVyPWZ1bmN0aW9uKGUpe2Uua2luZD1lLmtleS5uYW1lLHRoaXMucGFyc2VQcm9wZXJ0eU5hbWUoZSksZS52YWx1ZT10aGlzLnBhcnNlTWV0aG9kKCExKTt2YXIgdD0iZ2V0Ij09PWUua2luZD8wOjE7aWYoZS52YWx1ZS5wYXJhbXMubGVuZ3RoIT09dCl7dmFyIHM9ZS52YWx1ZS5zdGFydDsiZ2V0Ij09PWUua2luZD90aGlzLnJhaXNlUmVjb3ZlcmFibGUocywiZ2V0dGVyIHNob3VsZCBoYXZlIG5vIHBhcmFtcyIpOnRoaXMucmFpc2VSZWNvdmVyYWJsZShzLCJzZXR0ZXIgc2hvdWxkIGhhdmUgZXhhY3RseSBvbmUgcGFyYW0iKTt9ZWxzZSAic2V0Ij09PWUua2luZCYmIlJlc3RFbGVtZW50Ij09PWUudmFsdWUucGFyYW1zWzBdLnR5cGUmJnRoaXMucmFpc2VSZWNvdmVyYWJsZShlLnZhbHVlLnBhcmFtc1swXS5zdGFydCwiU2V0dGVyIGNhbm5vdCB1c2UgcmVzdCBwYXJhbXMiKTt9LFljLnBhcnNlUHJvcGVydHlWYWx1ZT1mdW5jdGlvbihlLHQscyxpLG4scixvLGEpeyhzfHxpKSYmdGhpcy50eXBlPT09Y2MuY29sb24mJnRoaXMudW5leHBlY3RlZCgpLHRoaXMuZWF0KGNjLmNvbG9uKT8oZS52YWx1ZT10P3RoaXMucGFyc2VNYXliZURlZmF1bHQodGhpcy5zdGFydCx0aGlzLnN0YXJ0TG9jKTp0aGlzLnBhcnNlTWF5YmVBc3NpZ24oITEsbyksZS5raW5kPSJpbml0Iik6dGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj02JiZ0aGlzLnR5cGU9PT1jYy5wYXJlbkw/KHQmJnRoaXMudW5leHBlY3RlZCgpLGUua2luZD0iaW5pdCIsZS5tZXRob2Q9ITAsZS52YWx1ZT10aGlzLnBhcnNlTWV0aG9kKHMsaSkpOnR8fGF8fCEodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj01KXx8ZS5jb21wdXRlZHx8IklkZW50aWZpZXIiIT09ZS5rZXkudHlwZXx8ImdldCIhPT1lLmtleS5uYW1lJiYic2V0IiE9PWUua2V5Lm5hbWV8fHRoaXMudHlwZT09PWNjLmNvbW1hfHx0aGlzLnR5cGU9PT1jYy5icmFjZVJ8fHRoaXMudHlwZT09PWNjLmVxP3RoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49NiYmIWUuY29tcHV0ZWQmJiJJZGVudGlmaWVyIj09PWUua2V5LnR5cGU/KChzfHxpKSYmdGhpcy51bmV4cGVjdGVkKCksdGhpcy5jaGVja1VucmVzZXJ2ZWQoZS5rZXkpLCJhd2FpdCIhPT1lLmtleS5uYW1lfHx0aGlzLmF3YWl0SWRlbnRQb3N8fCh0aGlzLmF3YWl0SWRlbnRQb3M9biksZS5raW5kPSJpbml0Iix0P2UudmFsdWU9dGhpcy5wYXJzZU1heWJlRGVmYXVsdChuLHIsdGhpcy5jb3B5Tm9kZShlLmtleSkpOnRoaXMudHlwZT09PWNjLmVxJiZvPyhvLnNob3J0aGFuZEFzc2lnbjwwJiYoby5zaG9ydGhhbmRBc3NpZ249dGhpcy5zdGFydCksZS52YWx1ZT10aGlzLnBhcnNlTWF5YmVEZWZhdWx0KG4scix0aGlzLmNvcHlOb2RlKGUua2V5KSkpOmUudmFsdWU9dGhpcy5jb3B5Tm9kZShlLmtleSksZS5zaG9ydGhhbmQ9ITApOnRoaXMudW5leHBlY3RlZCgpOigoc3x8aSkmJnRoaXMudW5leHBlY3RlZCgpLHRoaXMucGFyc2VHZXR0ZXJTZXR0ZXIoZSkpO30sWWMucGFyc2VQcm9wZXJ0eU5hbWU9ZnVuY3Rpb24oZSl7aWYodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj02KXtpZih0aGlzLmVhdChjYy5icmFja2V0TCkpcmV0dXJuIGUuY29tcHV0ZWQ9ITAsZS5rZXk9dGhpcy5wYXJzZU1heWJlQXNzaWduKCksdGhpcy5leHBlY3QoY2MuYnJhY2tldFIpLGUua2V5O2UuY29tcHV0ZWQ9ITE7fXJldHVybiBlLmtleT10aGlzLnR5cGU9PT1jYy5udW18fHRoaXMudHlwZT09PWNjLnN0cmluZz90aGlzLnBhcnNlRXhwckF0b20oKTp0aGlzLnBhcnNlSWRlbnQoIm5ldmVyIiE9PXRoaXMub3B0aW9ucy5hbGxvd1Jlc2VydmVkKX0sWWMuaW5pdEZ1bmN0aW9uPWZ1bmN0aW9uKGUpe2UuaWQ9bnVsbCx0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTYmJihlLmdlbmVyYXRvcj1lLmV4cHJlc3Npb249ITEpLHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49OCYmKGUuYXN5bmM9ITEpO30sWWMucGFyc2VNZXRob2Q9ZnVuY3Rpb24oZSx0LHMpe3ZhciBpPXRoaXMuc3RhcnROb2RlKCksbj10aGlzLnlpZWxkUG9zLHI9dGhpcy5hd2FpdFBvcyxvPXRoaXMuYXdhaXRJZGVudFBvcztyZXR1cm4gdGhpcy5pbml0RnVuY3Rpb24oaSksdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj02JiYoaS5nZW5lcmF0b3I9ZSksdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj04JiYoaS5hc3luYz0hIXQpLHRoaXMueWllbGRQb3M9MCx0aGlzLmF3YWl0UG9zPTAsdGhpcy5hd2FpdElkZW50UG9zPTAsdGhpcy5lbnRlclNjb3BlKDY0fF9jKHQsaS5nZW5lcmF0b3IpfChzPzEyODowKSksdGhpcy5leHBlY3QoY2MucGFyZW5MKSxpLnBhcmFtcz10aGlzLnBhcnNlQmluZGluZ0xpc3QoY2MucGFyZW5SLCExLHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49OCksdGhpcy5jaGVja1lpZWxkQXdhaXRJbkRlZmF1bHRQYXJhbXMoKSx0aGlzLnBhcnNlRnVuY3Rpb25Cb2R5KGksITEsITAsITEpLHRoaXMueWllbGRQb3M9bix0aGlzLmF3YWl0UG9zPXIsdGhpcy5hd2FpdElkZW50UG9zPW8sdGhpcy5maW5pc2hOb2RlKGksIkZ1bmN0aW9uRXhwcmVzc2lvbiIpfSxZYy5wYXJzZUFycm93RXhwcmVzc2lvbj1mdW5jdGlvbihlLHQscyxpKXt2YXIgbj10aGlzLnlpZWxkUG9zLHI9dGhpcy5hd2FpdFBvcyxvPXRoaXMuYXdhaXRJZGVudFBvcztyZXR1cm4gdGhpcy5lbnRlclNjb3BlKDE2fF9jKHMsITEpKSx0aGlzLmluaXRGdW5jdGlvbihlKSx0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTgmJihlLmFzeW5jPSEhcyksdGhpcy55aWVsZFBvcz0wLHRoaXMuYXdhaXRQb3M9MCx0aGlzLmF3YWl0SWRlbnRQb3M9MCxlLnBhcmFtcz10aGlzLnRvQXNzaWduYWJsZUxpc3QodCwhMCksdGhpcy5wYXJzZUZ1bmN0aW9uQm9keShlLCEwLCExLGkpLHRoaXMueWllbGRQb3M9bix0aGlzLmF3YWl0UG9zPXIsdGhpcy5hd2FpdElkZW50UG9zPW8sdGhpcy5maW5pc2hOb2RlKGUsIkFycm93RnVuY3Rpb25FeHByZXNzaW9uIil9LFljLnBhcnNlRnVuY3Rpb25Cb2R5PWZ1bmN0aW9uKGUsdCxzLGkpe3ZhciBuPXQmJnRoaXMudHlwZSE9PWNjLmJyYWNlTCxyPXRoaXMuc3RyaWN0LG89ITE7aWYobillLmJvZHk9dGhpcy5wYXJzZU1heWJlQXNzaWduKGkpLGUuZXhwcmVzc2lvbj0hMCx0aGlzLmNoZWNrUGFyYW1zKGUsITEpO2Vsc2Uge3ZhciBhPXRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49NyYmIXRoaXMuaXNTaW1wbGVQYXJhbUxpc3QoZS5wYXJhbXMpO3ImJiFhfHwobz10aGlzLnN0cmljdERpcmVjdGl2ZSh0aGlzLmVuZCkpJiZhJiZ0aGlzLnJhaXNlUmVjb3ZlcmFibGUoZS5zdGFydCwiSWxsZWdhbCAndXNlIHN0cmljdCcgZGlyZWN0aXZlIGluIGZ1bmN0aW9uIHdpdGggbm9uLXNpbXBsZSBwYXJhbWV0ZXIgbGlzdCIpO3ZhciBsPXRoaXMubGFiZWxzO3RoaXMubGFiZWxzPVtdLG8mJih0aGlzLnN0cmljdD0hMCksdGhpcy5jaGVja1BhcmFtcyhlLCFyJiYhbyYmIXQmJiFzJiZ0aGlzLmlzU2ltcGxlUGFyYW1MaXN0KGUucGFyYW1zKSksdGhpcy5zdHJpY3QmJmUuaWQmJnRoaXMuY2hlY2tMVmFsU2ltcGxlKGUuaWQsNSksZS5ib2R5PXRoaXMucGFyc2VCbG9jayghMSx2b2lkIDAsbyYmIXIpLGUuZXhwcmVzc2lvbj0hMSx0aGlzLmFkYXB0RGlyZWN0aXZlUHJvbG9ndWUoZS5ib2R5LmJvZHkpLHRoaXMubGFiZWxzPWw7fXRoaXMuZXhpdFNjb3BlKCk7fSxZYy5pc1NpbXBsZVBhcmFtTGlzdD1mdW5jdGlvbihlKXtmb3IodmFyIHQ9MCxzPWU7dDxzLmxlbmd0aDt0Kz0xKXtpZigiSWRlbnRpZmllciIhPT1zW3RdLnR5cGUpcmV0dXJuICExfXJldHVybiAhMH0sWWMuY2hlY2tQYXJhbXM9ZnVuY3Rpb24oZSx0KXtmb3IodmFyIHM9T2JqZWN0LmNyZWF0ZShudWxsKSxpPTAsbj1lLnBhcmFtcztpPG4ubGVuZ3RoO2krPTEpe3ZhciByPW5baV07dGhpcy5jaGVja0xWYWxJbm5lclBhdHRlcm4ociwxLHQ/bnVsbDpzKTt9fSxZYy5wYXJzZUV4cHJMaXN0PWZ1bmN0aW9uKGUsdCxzLGkpe2Zvcih2YXIgbj1bXSxyPSEwOyF0aGlzLmVhdChlKTspe2lmKHIpcj0hMTtlbHNlIGlmKHRoaXMuZXhwZWN0KGNjLmNvbW1hKSx0JiZ0aGlzLmFmdGVyVHJhaWxpbmdDb21tYShlKSlicmVhazt2YXIgbz12b2lkIDA7cyYmdGhpcy50eXBlPT09Y2MuY29tbWE/bz1udWxsOnRoaXMudHlwZT09PWNjLmVsbGlwc2lzPyhvPXRoaXMucGFyc2VTcHJlYWQoaSksaSYmdGhpcy50eXBlPT09Y2MuY29tbWEmJmkudHJhaWxpbmdDb21tYTwwJiYoaS50cmFpbGluZ0NvbW1hPXRoaXMuc3RhcnQpKTpvPXRoaXMucGFyc2VNYXliZUFzc2lnbighMSxpKSxuLnB1c2gobyk7fXJldHVybiBufSxZYy5jaGVja1VucmVzZXJ2ZWQ9ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5zdGFydCxzPWUuZW5kLGk9ZS5uYW1lOyh0aGlzLmluR2VuZXJhdG9yJiYieWllbGQiPT09aSYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKHQsIkNhbm5vdCB1c2UgJ3lpZWxkJyBhcyBpZGVudGlmaWVyIGluc2lkZSBhIGdlbmVyYXRvciIpLHRoaXMuaW5Bc3luYyYmImF3YWl0Ij09PWkmJnRoaXMucmFpc2VSZWNvdmVyYWJsZSh0LCJDYW5ub3QgdXNlICdhd2FpdCcgYXMgaWRlbnRpZmllciBpbnNpZGUgYW4gYXN5bmMgZnVuY3Rpb24iKSx0aGlzLmN1cnJlbnRUaGlzU2NvcGUoKS5pbkNsYXNzRmllbGRJbml0JiYiYXJndW1lbnRzIj09PWkmJnRoaXMucmFpc2VSZWNvdmVyYWJsZSh0LCJDYW5ub3QgdXNlICdhcmd1bWVudHMnIGluIGNsYXNzIGZpZWxkIGluaXRpYWxpemVyIiksIXRoaXMuaW5DbGFzc1N0YXRpY0Jsb2NrfHwiYXJndW1lbnRzIiE9PWkmJiJhd2FpdCIhPT1pfHx0aGlzLnJhaXNlKHQsIkNhbm5vdCB1c2UgIitpKyIgaW4gY2xhc3Mgc3RhdGljIGluaXRpYWxpemF0aW9uIGJsb2NrIiksdGhpcy5rZXl3b3Jkcy50ZXN0KGkpJiZ0aGlzLnJhaXNlKHQsIlVuZXhwZWN0ZWQga2V5d29yZCAnIitpKyInIiksdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPDYmJi0xIT09dGhpcy5pbnB1dC5zbGljZSh0LHMpLmluZGV4T2YoIlxcIikpfHwodGhpcy5zdHJpY3Q/dGhpcy5yZXNlcnZlZFdvcmRzU3RyaWN0OnRoaXMucmVzZXJ2ZWRXb3JkcykudGVzdChpKSYmKHRoaXMuaW5Bc3luY3x8ImF3YWl0IiE9PWl8fHRoaXMucmFpc2VSZWNvdmVyYWJsZSh0LCJDYW5ub3QgdXNlIGtleXdvcmQgJ2F3YWl0JyBvdXRzaWRlIGFuIGFzeW5jIGZ1bmN0aW9uIiksdGhpcy5yYWlzZVJlY292ZXJhYmxlKHQsIlRoZSBrZXl3b3JkICciK2krIicgaXMgcmVzZXJ2ZWQiKSk7fSxZYy5wYXJzZUlkZW50PWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMucGFyc2VJZGVudE5vZGUoKTtyZXR1cm4gdGhpcy5uZXh0KCEhZSksdGhpcy5maW5pc2hOb2RlKHQsIklkZW50aWZpZXIiKSxlfHwodGhpcy5jaGVja1VucmVzZXJ2ZWQodCksImF3YWl0IiE9PXQubmFtZXx8dGhpcy5hd2FpdElkZW50UG9zfHwodGhpcy5hd2FpdElkZW50UG9zPXQuc3RhcnQpKSx0fSxZYy5wYXJzZUlkZW50Tm9kZT1mdW5jdGlvbigpe3ZhciBlPXRoaXMuc3RhcnROb2RlKCk7cmV0dXJuIHRoaXMudHlwZT09PWNjLm5hbWU/ZS5uYW1lPXRoaXMudmFsdWU6dGhpcy50eXBlLmtleXdvcmQ/KGUubmFtZT10aGlzLnR5cGUua2V5d29yZCwiY2xhc3MiIT09ZS5uYW1lJiYiZnVuY3Rpb24iIT09ZS5uYW1lfHx0aGlzLmxhc3RUb2tFbmQ9PT10aGlzLmxhc3RUb2tTdGFydCsxJiY0Nj09PXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLmxhc3RUb2tTdGFydCl8fHRoaXMuY29udGV4dC5wb3AoKSk6dGhpcy51bmV4cGVjdGVkKCksZX0sWWMucGFyc2VQcml2YXRlSWRlbnQ9ZnVuY3Rpb24oKXt2YXIgZT10aGlzLnN0YXJ0Tm9kZSgpO3JldHVybiB0aGlzLnR5cGU9PT1jYy5wcml2YXRlSWQ/ZS5uYW1lPXRoaXMudmFsdWU6dGhpcy51bmV4cGVjdGVkKCksdGhpcy5uZXh0KCksdGhpcy5maW5pc2hOb2RlKGUsIlByaXZhdGVJZGVudGlmaWVyIiksdGhpcy5vcHRpb25zLmNoZWNrUHJpdmF0ZUZpZWxkcyYmKDA9PT10aGlzLnByaXZhdGVOYW1lU3RhY2subGVuZ3RoP3RoaXMucmFpc2UoZS5zdGFydCwiUHJpdmF0ZSBmaWVsZCAnIyIrZS5uYW1lKyInIG11c3QgYmUgZGVjbGFyZWQgaW4gYW4gZW5jbG9zaW5nIGNsYXNzIik6dGhpcy5wcml2YXRlTmFtZVN0YWNrW3RoaXMucHJpdmF0ZU5hbWVTdGFjay5sZW5ndGgtMV0udXNlZC5wdXNoKGUpKSxlfSxZYy5wYXJzZVlpZWxkPWZ1bmN0aW9uKGUpe3RoaXMueWllbGRQb3N8fCh0aGlzLnlpZWxkUG9zPXRoaXMuc3RhcnQpO3ZhciB0PXRoaXMuc3RhcnROb2RlKCk7cmV0dXJuIHRoaXMubmV4dCgpLHRoaXMudHlwZT09PWNjLnNlbWl8fHRoaXMuY2FuSW5zZXJ0U2VtaWNvbG9uKCl8fHRoaXMudHlwZSE9PWNjLnN0YXImJiF0aGlzLnR5cGUuc3RhcnRzRXhwcj8odC5kZWxlZ2F0ZT0hMSx0LmFyZ3VtZW50PW51bGwpOih0LmRlbGVnYXRlPXRoaXMuZWF0KGNjLnN0YXIpLHQuYXJndW1lbnQ9dGhpcy5wYXJzZU1heWJlQXNzaWduKGUpKSx0aGlzLmZpbmlzaE5vZGUodCwiWWllbGRFeHByZXNzaW9uIil9LFljLnBhcnNlQXdhaXQ9ZnVuY3Rpb24oZSl7dGhpcy5hd2FpdFBvc3x8KHRoaXMuYXdhaXRQb3M9dGhpcy5zdGFydCk7dmFyIHQ9dGhpcy5zdGFydE5vZGUoKTtyZXR1cm4gdGhpcy5uZXh0KCksdC5hcmd1bWVudD10aGlzLnBhcnNlTWF5YmVVbmFyeShudWxsLCEwLCExLGUpLHRoaXMuZmluaXNoTm9kZSh0LCJBd2FpdEV4cHJlc3Npb24iKX07dmFyIFpjPVJjLnByb3RvdHlwZTtaYy5yYWlzZT1mdW5jdGlvbihlLHQpe3ZhciBzPXdjKHRoaXMuaW5wdXQsZSk7dCs9IiAoIitzLmxpbmUrIjoiK3MuY29sdW1uKyIpIjt2YXIgaT1uZXcgU3ludGF4RXJyb3IodCk7dGhyb3cgaS5wb3M9ZSxpLmxvYz1zLGkucmFpc2VkQXQ9dGhpcy5wb3MsaX0sWmMucmFpc2VSZWNvdmVyYWJsZT1aYy5yYWlzZSxaYy5jdXJQb3NpdGlvbj1mdW5jdGlvbigpe2lmKHRoaXMub3B0aW9ucy5sb2NhdGlvbnMpcmV0dXJuIG5ldyBrYyh0aGlzLmN1ckxpbmUsdGhpcy5wb3MtdGhpcy5saW5lU3RhcnQpfTt2YXIgSmM9UmMucHJvdG90eXBlLGVoPWZ1bmN0aW9uKGUpe3RoaXMuZmxhZ3M9ZSx0aGlzLnZhcj1bXSx0aGlzLmxleGljYWw9W10sdGhpcy5mdW5jdGlvbnM9W10sdGhpcy5pbkNsYXNzRmllbGRJbml0PSExO307SmMuZW50ZXJTY29wZT1mdW5jdGlvbihlKXt0aGlzLnNjb3BlU3RhY2sucHVzaChuZXcgZWgoZSkpO30sSmMuZXhpdFNjb3BlPWZ1bmN0aW9uKCl7dGhpcy5zY29wZVN0YWNrLnBvcCgpO30sSmMudHJlYXRGdW5jdGlvbnNBc1ZhckluU2NvcGU9ZnVuY3Rpb24oZSl7cmV0dXJuIDImZS5mbGFnc3x8IXRoaXMuaW5Nb2R1bGUmJjEmZS5mbGFnc30sSmMuZGVjbGFyZU5hbWU9ZnVuY3Rpb24oZSx0LHMpe3ZhciBpPSExO2lmKDI9PT10KXt2YXIgbj10aGlzLmN1cnJlbnRTY29wZSgpO2k9bi5sZXhpY2FsLmluZGV4T2YoZSk+LTF8fG4uZnVuY3Rpb25zLmluZGV4T2YoZSk+LTF8fG4udmFyLmluZGV4T2YoZSk+LTEsbi5sZXhpY2FsLnB1c2goZSksdGhpcy5pbk1vZHVsZSYmMSZuLmZsYWdzJiZkZWxldGUgdGhpcy51bmRlZmluZWRFeHBvcnRzW2VdO31lbHNlIGlmKDQ9PT10KXt0aGlzLmN1cnJlbnRTY29wZSgpLmxleGljYWwucHVzaChlKTt9ZWxzZSBpZigzPT09dCl7dmFyIHI9dGhpcy5jdXJyZW50U2NvcGUoKTtpPXRoaXMudHJlYXRGdW5jdGlvbnNBc1Zhcj9yLmxleGljYWwuaW5kZXhPZihlKT4tMTpyLmxleGljYWwuaW5kZXhPZihlKT4tMXx8ci52YXIuaW5kZXhPZihlKT4tMSxyLmZ1bmN0aW9ucy5wdXNoKGUpO31lbHNlIGZvcih2YXIgbz10aGlzLnNjb3BlU3RhY2subGVuZ3RoLTE7bz49MDstLW8pe3ZhciBhPXRoaXMuc2NvcGVTdGFja1tvXTtpZihhLmxleGljYWwuaW5kZXhPZihlKT4tMSYmISgzMiZhLmZsYWdzJiZhLmxleGljYWxbMF09PT1lKXx8IXRoaXMudHJlYXRGdW5jdGlvbnNBc1ZhckluU2NvcGUoYSkmJmEuZnVuY3Rpb25zLmluZGV4T2YoZSk+LTEpe2k9ITA7YnJlYWt9aWYoYS52YXIucHVzaChlKSx0aGlzLmluTW9kdWxlJiYxJmEuZmxhZ3MmJmRlbGV0ZSB0aGlzLnVuZGVmaW5lZEV4cG9ydHNbZV0sMjU5JmEuZmxhZ3MpYnJlYWt9aSYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKHMsIklkZW50aWZpZXIgJyIrZSsiJyBoYXMgYWxyZWFkeSBiZWVuIGRlY2xhcmVkIik7fSxKYy5jaGVja0xvY2FsRXhwb3J0PWZ1bmN0aW9uKGUpey0xPT09dGhpcy5zY29wZVN0YWNrWzBdLmxleGljYWwuaW5kZXhPZihlLm5hbWUpJiYtMT09PXRoaXMuc2NvcGVTdGFja1swXS52YXIuaW5kZXhPZihlLm5hbWUpJiYodGhpcy51bmRlZmluZWRFeHBvcnRzW2UubmFtZV09ZSk7fSxKYy5jdXJyZW50U2NvcGU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zY29wZVN0YWNrW3RoaXMuc2NvcGVTdGFjay5sZW5ndGgtMV19LEpjLmN1cnJlbnRWYXJTY29wZT1mdW5jdGlvbigpe2Zvcih2YXIgZT10aGlzLnNjb3BlU3RhY2subGVuZ3RoLTE7O2UtLSl7dmFyIHQ9dGhpcy5zY29wZVN0YWNrW2VdO2lmKDI1OSZ0LmZsYWdzKXJldHVybiB0fX0sSmMuY3VycmVudFRoaXNTY29wZT1mdW5jdGlvbigpe2Zvcih2YXIgZT10aGlzLnNjb3BlU3RhY2subGVuZ3RoLTE7O2UtLSl7dmFyIHQ9dGhpcy5zY29wZVN0YWNrW2VdO2lmKDI1OSZ0LmZsYWdzJiYhKDE2JnQuZmxhZ3MpKXJldHVybiB0fX07dmFyIHRoPWZ1bmN0aW9uKGUsdCxzKXt0aGlzLnR5cGU9IiIsdGhpcy5zdGFydD10LHRoaXMuZW5kPTAsZS5vcHRpb25zLmxvY2F0aW9ucyYmKHRoaXMubG9jPW5ldyBJYyhlLHMpKSxlLm9wdGlvbnMuZGlyZWN0U291cmNlRmlsZSYmKHRoaXMuc291cmNlRmlsZT1lLm9wdGlvbnMuZGlyZWN0U291cmNlRmlsZSksZS5vcHRpb25zLnJhbmdlcyYmKHRoaXMucmFuZ2U9W3QsMF0pO30sc2g9UmMucHJvdG90eXBlO2Z1bmN0aW9uIGloKGUsdCxzLGkpe3JldHVybiBlLnR5cGU9dCxlLmVuZD1zLHRoaXMub3B0aW9ucy5sb2NhdGlvbnMmJihlLmxvYy5lbmQ9aSksdGhpcy5vcHRpb25zLnJhbmdlcyYmKGUucmFuZ2VbMV09cyksZX1zaC5zdGFydE5vZGU9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IHRoKHRoaXMsdGhpcy5zdGFydCx0aGlzLnN0YXJ0TG9jKX0sc2guc3RhcnROb2RlQXQ9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gbmV3IHRoKHRoaXMsZSx0KX0sc2guZmluaXNoTm9kZT1mdW5jdGlvbihlLHQpe3JldHVybiBpaC5jYWxsKHRoaXMsZSx0LHRoaXMubGFzdFRva0VuZCx0aGlzLmxhc3RUb2tFbmRMb2MpfSxzaC5maW5pc2hOb2RlQXQ9ZnVuY3Rpb24oZSx0LHMsaSl7cmV0dXJuIGloLmNhbGwodGhpcyxlLHQscyxpKX0sc2guY29weU5vZGU9ZnVuY3Rpb24oZSl7dmFyIHQ9bmV3IHRoKHRoaXMsZS5zdGFydCx0aGlzLnN0YXJ0TG9jKTtmb3IodmFyIHMgaW4gZSl0W3NdPWVbc107cmV0dXJuIHR9O3ZhciBuaD0iQVNDSUkgQVNDSUlfSGV4X0RpZ2l0IEFIZXggQWxwaGFiZXRpYyBBbHBoYSBBbnkgQXNzaWduZWQgQmlkaV9Db250cm9sIEJpZGlfQyBCaWRpX01pcnJvcmVkIEJpZGlfTSBDYXNlX0lnbm9yYWJsZSBDSSBDYXNlZCBDaGFuZ2VzX1doZW5fQ2FzZWZvbGRlZCBDV0NGIENoYW5nZXNfV2hlbl9DYXNlbWFwcGVkIENXQ00gQ2hhbmdlc19XaGVuX0xvd2VyY2FzZWQgQ1dMIENoYW5nZXNfV2hlbl9ORktDX0Nhc2Vmb2xkZWQgQ1dLQ0YgQ2hhbmdlc19XaGVuX1RpdGxlY2FzZWQgQ1dUIENoYW5nZXNfV2hlbl9VcHBlcmNhc2VkIENXVSBEYXNoIERlZmF1bHRfSWdub3JhYmxlX0NvZGVfUG9pbnQgREkgRGVwcmVjYXRlZCBEZXAgRGlhY3JpdGljIERpYSBFbW9qaSBFbW9qaV9Db21wb25lbnQgRW1vamlfTW9kaWZpZXIgRW1vamlfTW9kaWZpZXJfQmFzZSBFbW9qaV9QcmVzZW50YXRpb24gRXh0ZW5kZXIgRXh0IEdyYXBoZW1lX0Jhc2UgR3JfQmFzZSBHcmFwaGVtZV9FeHRlbmQgR3JfRXh0IEhleF9EaWdpdCBIZXggSURTX0JpbmFyeV9PcGVyYXRvciBJRFNCIElEU19UcmluYXJ5X09wZXJhdG9yIElEU1QgSURfQ29udGludWUgSURDIElEX1N0YXJ0IElEUyBJZGVvZ3JhcGhpYyBJZGVvIEpvaW5fQ29udHJvbCBKb2luX0MgTG9naWNhbF9PcmRlcl9FeGNlcHRpb24gTE9FIExvd2VyY2FzZSBMb3dlciBNYXRoIE5vbmNoYXJhY3Rlcl9Db2RlX1BvaW50IE5DaGFyIFBhdHRlcm5fU3ludGF4IFBhdF9TeW4gUGF0dGVybl9XaGl0ZV9TcGFjZSBQYXRfV1MgUXVvdGF0aW9uX01hcmsgUU1hcmsgUmFkaWNhbCBSZWdpb25hbF9JbmRpY2F0b3IgUkkgU2VudGVuY2VfVGVybWluYWwgU1Rlcm0gU29mdF9Eb3R0ZWQgU0QgVGVybWluYWxfUHVuY3R1YXRpb24gVGVybSBVbmlmaWVkX0lkZW9ncmFwaCBVSWRlbyBVcHBlcmNhc2UgVXBwZXIgVmFyaWF0aW9uX1NlbGVjdG9yIFZTIFdoaXRlX1NwYWNlIHNwYWNlIFhJRF9Db250aW51ZSBYSURDIFhJRF9TdGFydCBYSURTIixyaD1uaCsiIEV4dGVuZGVkX1BpY3RvZ3JhcGhpYyIsb2g9cmgrIiBFQmFzZSBFQ29tcCBFTW9kIEVQcmVzIEV4dFBpY3QiLGFoPXs5Om5oLDEwOnJoLDExOnJoLDEyOm9oLDEzOm9oLDE0Om9ofSxsaD17OToiIiwxMDoiIiwxMToiIiwxMjoiIiwxMzoiIiwxNDoiQmFzaWNfRW1vamkgRW1vamlfS2V5Y2FwX1NlcXVlbmNlIFJHSV9FbW9qaV9Nb2RpZmllcl9TZXF1ZW5jZSBSR0lfRW1vamlfRmxhZ19TZXF1ZW5jZSBSR0lfRW1vamlfVGFnX1NlcXVlbmNlIFJHSV9FbW9qaV9aV0pfU2VxdWVuY2UgUkdJX0Vtb2ppIn0sY2g9IkNhc2VkX0xldHRlciBMQyBDbG9zZV9QdW5jdHVhdGlvbiBQZSBDb25uZWN0b3JfUHVuY3R1YXRpb24gUGMgQ29udHJvbCBDYyBjbnRybCBDdXJyZW5jeV9TeW1ib2wgU2MgRGFzaF9QdW5jdHVhdGlvbiBQZCBEZWNpbWFsX051bWJlciBOZCBkaWdpdCBFbmNsb3NpbmdfTWFyayBNZSBGaW5hbF9QdW5jdHVhdGlvbiBQZiBGb3JtYXQgQ2YgSW5pdGlhbF9QdW5jdHVhdGlvbiBQaSBMZXR0ZXIgTCBMZXR0ZXJfTnVtYmVyIE5sIExpbmVfU2VwYXJhdG9yIFpsIExvd2VyY2FzZV9MZXR0ZXIgTGwgTWFyayBNIENvbWJpbmluZ19NYXJrIE1hdGhfU3ltYm9sIFNtIE1vZGlmaWVyX0xldHRlciBMbSBNb2RpZmllcl9TeW1ib2wgU2sgTm9uc3BhY2luZ19NYXJrIE1uIE51bWJlciBOIE9wZW5fUHVuY3R1YXRpb24gUHMgT3RoZXIgQyBPdGhlcl9MZXR0ZXIgTG8gT3RoZXJfTnVtYmVyIE5vIE90aGVyX1B1bmN0dWF0aW9uIFBvIE90aGVyX1N5bWJvbCBTbyBQYXJhZ3JhcGhfU2VwYXJhdG9yIFpwIFByaXZhdGVfVXNlIENvIFB1bmN0dWF0aW9uIFAgcHVuY3QgU2VwYXJhdG9yIFogU3BhY2VfU2VwYXJhdG9yIFpzIFNwYWNpbmdfTWFyayBNYyBTdXJyb2dhdGUgQ3MgU3ltYm9sIFMgVGl0bGVjYXNlX0xldHRlciBMdCBVbmFzc2lnbmVkIENuIFVwcGVyY2FzZV9MZXR0ZXIgTHUiLGhoPSJBZGxhbSBBZGxtIEFob20gQW5hdG9saWFuX0hpZXJvZ2x5cGhzIEhsdXcgQXJhYmljIEFyYWIgQXJtZW5pYW4gQXJtbiBBdmVzdGFuIEF2c3QgQmFsaW5lc2UgQmFsaSBCYW11bSBCYW11IEJhc3NhX1ZhaCBCYXNzIEJhdGFrIEJhdGsgQmVuZ2FsaSBCZW5nIEJoYWlrc3VraSBCaGtzIEJvcG9tb2ZvIEJvcG8gQnJhaG1pIEJyYWggQnJhaWxsZSBCcmFpIEJ1Z2luZXNlIEJ1Z2kgQnVoaWQgQnVoZCBDYW5hZGlhbl9BYm9yaWdpbmFsIENhbnMgQ2FyaWFuIENhcmkgQ2F1Y2FzaWFuX0FsYmFuaWFuIEFnaGIgQ2hha21hIENha20gQ2hhbSBDaGFtIENoZXJva2VlIENoZXIgQ29tbW9uIFp5eXkgQ29wdGljIENvcHQgUWFhYyBDdW5laWZvcm0gWHN1eCBDeXByaW90IENwcnQgQ3lyaWxsaWMgQ3lybCBEZXNlcmV0IERzcnQgRGV2YW5hZ2FyaSBEZXZhIER1cGxveWFuIER1cGwgRWd5cHRpYW5fSGllcm9nbHlwaHMgRWd5cCBFbGJhc2FuIEVsYmEgRXRoaW9waWMgRXRoaSBHZW9yZ2lhbiBHZW9yIEdsYWdvbGl0aWMgR2xhZyBHb3RoaWMgR290aCBHcmFudGhhIEdyYW4gR3JlZWsgR3JlayBHdWphcmF0aSBHdWpyIEd1cm11a2hpIEd1cnUgSGFuIEhhbmkgSGFuZ3VsIEhhbmcgSGFudW5vbyBIYW5vIEhhdHJhbiBIYXRyIEhlYnJldyBIZWJyIEhpcmFnYW5hIEhpcmEgSW1wZXJpYWxfQXJhbWFpYyBBcm1pIEluaGVyaXRlZCBaaW5oIFFhYWkgSW5zY3JpcHRpb25hbF9QYWhsYXZpIFBobGkgSW5zY3JpcHRpb25hbF9QYXJ0aGlhbiBQcnRpIEphdmFuZXNlIEphdmEgS2FpdGhpIEt0aGkgS2FubmFkYSBLbmRhIEthdGFrYW5hIEthbmEgS2F5YWhfTGkgS2FsaSBLaGFyb3NodGhpIEtoYXIgS2htZXIgS2htciBLaG9qa2kgS2hvaiBLaHVkYXdhZGkgU2luZCBMYW8gTGFvbyBMYXRpbiBMYXRuIExlcGNoYSBMZXBjIExpbWJ1IExpbWIgTGluZWFyX0EgTGluYSBMaW5lYXJfQiBMaW5iIExpc3UgTGlzdSBMeWNpYW4gTHljaSBMeWRpYW4gTHlkaSBNYWhhamFuaSBNYWhqIE1hbGF5YWxhbSBNbHltIE1hbmRhaWMgTWFuZCBNYW5pY2hhZWFuIE1hbmkgTWFyY2hlbiBNYXJjIE1hc2FyYW1fR29uZGkgR29ubSBNZWV0ZWlfTWF5ZWsgTXRlaSBNZW5kZV9LaWtha3VpIE1lbmQgTWVyb2l0aWNfQ3Vyc2l2ZSBNZXJjIE1lcm9pdGljX0hpZXJvZ2x5cGhzIE1lcm8gTWlhbyBQbHJkIE1vZGkgTW9uZ29saWFuIE1vbmcgTXJvIE1yb28gTXVsdGFuaSBNdWx0IE15YW5tYXIgTXltciBOYWJhdGFlYW4gTmJhdCBOZXdfVGFpX0x1ZSBUYWx1IE5ld2EgTmV3YSBOa28gTmtvbyBOdXNodSBOc2h1IE9naGFtIE9nYW0gT2xfQ2hpa2kgT2xjayBPbGRfSHVuZ2FyaWFuIEh1bmcgT2xkX0l0YWxpYyBJdGFsIE9sZF9Ob3J0aF9BcmFiaWFuIE5hcmIgT2xkX1Blcm1pYyBQZXJtIE9sZF9QZXJzaWFuIFhwZW8gT2xkX1NvdXRoX0FyYWJpYW4gU2FyYiBPbGRfVHVya2ljIE9ya2ggT3JpeWEgT3J5YSBPc2FnZSBPc2dlIE9zbWFueWEgT3NtYSBQYWhhd2hfSG1vbmcgSG1uZyBQYWxteXJlbmUgUGFsbSBQYXVfQ2luX0hhdSBQYXVjIFBoYWdzX1BhIFBoYWcgUGhvZW5pY2lhbiBQaG54IFBzYWx0ZXJfUGFobGF2aSBQaGxwIFJlamFuZyBSam5nIFJ1bmljIFJ1bnIgU2FtYXJpdGFuIFNhbXIgU2F1cmFzaHRyYSBTYXVyIFNoYXJhZGEgU2hyZCBTaGF2aWFuIFNoYXcgU2lkZGhhbSBTaWRkIFNpZ25Xcml0aW5nIFNnbncgU2luaGFsYSBTaW5oIFNvcmFfU29tcGVuZyBTb3JhIFNveW9tYm8gU295byBTdW5kYW5lc2UgU3VuZCBTeWxvdGlfTmFncmkgU3lsbyBTeXJpYWMgU3lyYyBUYWdhbG9nIFRnbGcgVGFnYmFud2EgVGFnYiBUYWlfTGUgVGFsZSBUYWlfVGhhbSBMYW5hIFRhaV9WaWV0IFRhdnQgVGFrcmkgVGFrciBUYW1pbCBUYW1sIFRhbmd1dCBUYW5nIFRlbHVndSBUZWx1IFRoYWFuYSBUaGFhIFRoYWkgVGhhaSBUaWJldGFuIFRpYnQgVGlmaW5hZ2ggVGZuZyBUaXJodXRhIFRpcmggVWdhcml0aWMgVWdhciBWYWkgVmFpaSBXYXJhbmdfQ2l0aSBXYXJhIFlpIFlpaWkgWmFuYWJhemFyX1NxdWFyZSBaYW5iIix1aD1oaCsiIERvZ3JhIERvZ3IgR3VuamFsYV9Hb25kaSBHb25nIEhhbmlmaV9Sb2hpbmd5YSBSb2hnIE1ha2FzYXIgTWFrYSBNZWRlZmFpZHJpbiBNZWRmIE9sZF9Tb2dkaWFuIFNvZ28gU29nZGlhbiBTb2dkIixkaD11aCsiIEVseW1haWMgRWx5bSBOYW5kaW5hZ2FyaSBOYW5kIE55aWFrZW5nX1B1YWNodWVfSG1vbmcgSG1ucCBXYW5jaG8gV2NobyIscGg9ZGgrIiBDaG9yYXNtaWFuIENocnMgRGlhayBEaXZlc19Ba3VydSBLaGl0YW5fU21hbGxfU2NyaXB0IEtpdHMgWWV6aSBZZXppZGkiLGZoPXBoKyIgQ3lwcm9fTWlub2FuIENwbW4gT2xkX1V5Z2h1ciBPdWdyIFRhbmdzYSBUbnNhIFRvdG8gVml0aGt1cWkgVml0aCIsbWg9ezk6aGgsMTA6dWgsMTE6ZGgsMTI6cGgsMTM6ZmgsMTQ6ZmgrIiBIcmt0IEthdGFrYW5hX09yX0hpcmFnYW5hIEthd2kgTmFnX011bmRhcmkgTmFnbSBVbmtub3duIFp6enoifSxnaD17fTtmdW5jdGlvbiB5aChlKXt2YXIgdD1naFtlXT17YmluYXJ5OnZjKGFoW2VdKyIgIitjaCksYmluYXJ5T2ZTdHJpbmdzOnZjKGxoW2VdKSxub25CaW5hcnk6e0dlbmVyYWxfQ2F0ZWdvcnk6dmMoY2gpLFNjcmlwdDp2YyhtaFtlXSl9fTt0Lm5vbkJpbmFyeS5TY3JpcHRfRXh0ZW5zaW9ucz10Lm5vbkJpbmFyeS5TY3JpcHQsdC5ub25CaW5hcnkuZ2M9dC5ub25CaW5hcnkuR2VuZXJhbF9DYXRlZ29yeSx0Lm5vbkJpbmFyeS5zYz10Lm5vbkJpbmFyeS5TY3JpcHQsdC5ub25CaW5hcnkuc2N4PXQubm9uQmluYXJ5LlNjcmlwdF9FeHRlbnNpb25zO31mb3IodmFyIHhoPTAsRWg9WzksMTAsMTEsMTIsMTMsMTRdO3hoPEVoLmxlbmd0aDt4aCs9MSl7eWgoRWhbeGhdKTt9dmFyIGJoPVJjLnByb3RvdHlwZSx2aD1mdW5jdGlvbihlKXt0aGlzLnBhcnNlcj1lLHRoaXMudmFsaWRGbGFncz0iZ2ltIisoZS5vcHRpb25zLmVjbWFWZXJzaW9uPj02PyJ1eSI6IiIpKyhlLm9wdGlvbnMuZWNtYVZlcnNpb24+PTk/InMiOiIiKSsoZS5vcHRpb25zLmVjbWFWZXJzaW9uPj0xMz8iZCI6IiIpKyhlLm9wdGlvbnMuZWNtYVZlcnNpb24+PTE1PyJ2IjoiIiksdGhpcy51bmljb2RlUHJvcGVydGllcz1naFtlLm9wdGlvbnMuZWNtYVZlcnNpb24+PTE0PzE0OmUub3B0aW9ucy5lY21hVmVyc2lvbl0sdGhpcy5zb3VyY2U9IiIsdGhpcy5mbGFncz0iIix0aGlzLnN0YXJ0PTAsdGhpcy5zd2l0Y2hVPSExLHRoaXMuc3dpdGNoVj0hMSx0aGlzLnN3aXRjaE49ITEsdGhpcy5wb3M9MCx0aGlzLmxhc3RJbnRWYWx1ZT0wLHRoaXMubGFzdFN0cmluZ1ZhbHVlPSIiLHRoaXMubGFzdEFzc2VydGlvbklzUXVhbnRpZmlhYmxlPSExLHRoaXMubnVtQ2FwdHVyaW5nUGFyZW5zPTAsdGhpcy5tYXhCYWNrUmVmZXJlbmNlPTAsdGhpcy5ncm91cE5hbWVzPVtdLHRoaXMuYmFja1JlZmVyZW5jZU5hbWVzPVtdO307ZnVuY3Rpb24gU2goZSl7cmV0dXJuIDM2PT09ZXx8ZT49NDAmJmU8PTQzfHw0Nj09PWV8fDYzPT09ZXx8ZT49OTEmJmU8PTk0fHxlPj0xMjMmJmU8PTEyNX1mdW5jdGlvbiBBaChlKXtyZXR1cm4gZT49NjUmJmU8PTkwfHxlPj05NyYmZTw9MTIyfXZoLnByb3RvdHlwZS5yZXNldD1mdW5jdGlvbihlLHQscyl7dmFyIGk9LTEhPT1zLmluZGV4T2YoInYiKSxuPS0xIT09cy5pbmRleE9mKCJ1Iik7dGhpcy5zdGFydD0wfGUsdGhpcy5zb3VyY2U9dCsiIix0aGlzLmZsYWdzPXMsaSYmdGhpcy5wYXJzZXIub3B0aW9ucy5lY21hVmVyc2lvbj49MTU/KHRoaXMuc3dpdGNoVT0hMCx0aGlzLnN3aXRjaFY9ITAsdGhpcy5zd2l0Y2hOPSEwKToodGhpcy5zd2l0Y2hVPW4mJnRoaXMucGFyc2VyLm9wdGlvbnMuZWNtYVZlcnNpb24+PTYsdGhpcy5zd2l0Y2hWPSExLHRoaXMuc3dpdGNoTj1uJiZ0aGlzLnBhcnNlci5vcHRpb25zLmVjbWFWZXJzaW9uPj05KTt9LHZoLnByb3RvdHlwZS5yYWlzZT1mdW5jdGlvbihlKXt0aGlzLnBhcnNlci5yYWlzZVJlY292ZXJhYmxlKHRoaXMuc3RhcnQsIkludmFsaWQgcmVndWxhciBleHByZXNzaW9uOiAvIit0aGlzLnNvdXJjZSsiLzogIitlKTt9LHZoLnByb3RvdHlwZS5hdD1mdW5jdGlvbihlLHQpe3ZvaWQgMD09PXQmJih0PSExKTt2YXIgcz10aGlzLnNvdXJjZSxpPXMubGVuZ3RoO2lmKGU+PWkpcmV0dXJuIC0xO3ZhciBuPXMuY2hhckNvZGVBdChlKTtpZighdCYmIXRoaXMuc3dpdGNoVXx8bjw9NTUyOTV8fG4+PTU3MzQ0fHxlKzE+PWkpcmV0dXJuIG47dmFyIHI9cy5jaGFyQ29kZUF0KGUrMSk7cmV0dXJuIHI+PTU2MzIwJiZyPD01NzM0Mz8objw8MTApK3ItNTY2MTM4ODg6bn0sdmgucHJvdG90eXBlLm5leHRJbmRleD1mdW5jdGlvbihlLHQpe3ZvaWQgMD09PXQmJih0PSExKTt2YXIgcz10aGlzLnNvdXJjZSxpPXMubGVuZ3RoO2lmKGU+PWkpcmV0dXJuIGk7dmFyIG4scj1zLmNoYXJDb2RlQXQoZSk7cmV0dXJuICF0JiYhdGhpcy5zd2l0Y2hVfHxyPD01NTI5NXx8cj49NTczNDR8fGUrMT49aXx8KG49cy5jaGFyQ29kZUF0KGUrMSkpPDU2MzIwfHxuPjU3MzQzP2UrMTplKzJ9LHZoLnByb3RvdHlwZS5jdXJyZW50PWZ1bmN0aW9uKGUpe3JldHVybiB2b2lkIDA9PT1lJiYoZT0hMSksdGhpcy5hdCh0aGlzLnBvcyxlKX0sdmgucHJvdG90eXBlLmxvb2thaGVhZD1mdW5jdGlvbihlKXtyZXR1cm4gdm9pZCAwPT09ZSYmKGU9ITEpLHRoaXMuYXQodGhpcy5uZXh0SW5kZXgodGhpcy5wb3MsZSksZSl9LHZoLnByb3RvdHlwZS5hZHZhbmNlPWZ1bmN0aW9uKGUpe3ZvaWQgMD09PWUmJihlPSExKSx0aGlzLnBvcz10aGlzLm5leHRJbmRleCh0aGlzLnBvcyxlKTt9LHZoLnByb3RvdHlwZS5lYXQ9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdm9pZCAwPT09dCYmKHQ9ITEpLHRoaXMuY3VycmVudCh0KT09PWUmJih0aGlzLmFkdmFuY2UodCksITApfSx2aC5wcm90b3R5cGUuZWF0Q2hhcnM9ZnVuY3Rpb24oZSx0KXt2b2lkIDA9PT10JiYodD0hMSk7Zm9yKHZhciBzPXRoaXMucG9zLGk9MCxuPWU7aTxuLmxlbmd0aDtpKz0xKXt2YXIgcj1uW2ldLG89dGhpcy5hdChzLHQpO2lmKC0xPT09b3x8byE9PXIpcmV0dXJuICExO3M9dGhpcy5uZXh0SW5kZXgocyx0KTt9cmV0dXJuIHRoaXMucG9zPXMsITB9LGJoLnZhbGlkYXRlUmVnRXhwRmxhZ3M9ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PWUudmFsaWRGbGFncyxzPWUuZmxhZ3MsaT0hMSxuPSExLHI9MDtyPHMubGVuZ3RoO3IrKyl7dmFyIG89cy5jaGFyQXQocik7LTE9PT10LmluZGV4T2YobykmJnRoaXMucmFpc2UoZS5zdGFydCwiSW52YWxpZCByZWd1bGFyIGV4cHJlc3Npb24gZmxhZyIpLHMuaW5kZXhPZihvLHIrMSk+LTEmJnRoaXMucmFpc2UoZS5zdGFydCwiRHVwbGljYXRlIHJlZ3VsYXIgZXhwcmVzc2lvbiBmbGFnIiksInUiPT09byYmKGk9ITApLCJ2Ij09PW8mJihuPSEwKTt9dGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj0xNSYmaSYmbiYmdGhpcy5yYWlzZShlLnN0YXJ0LCJJbnZhbGlkIHJlZ3VsYXIgZXhwcmVzc2lvbiBmbGFnIik7fSxiaC52YWxpZGF0ZVJlZ0V4cFBhdHRlcm49ZnVuY3Rpb24oZSl7dGhpcy5yZWdleHBfcGF0dGVybihlKSwhZS5zd2l0Y2hOJiZ0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTkmJmUuZ3JvdXBOYW1lcy5sZW5ndGg+MCYmKGUuc3dpdGNoTj0hMCx0aGlzLnJlZ2V4cF9wYXR0ZXJuKGUpKTt9LGJoLnJlZ2V4cF9wYXR0ZXJuPWZ1bmN0aW9uKGUpe2UucG9zPTAsZS5sYXN0SW50VmFsdWU9MCxlLmxhc3RTdHJpbmdWYWx1ZT0iIixlLmxhc3RBc3NlcnRpb25Jc1F1YW50aWZpYWJsZT0hMSxlLm51bUNhcHR1cmluZ1BhcmVucz0wLGUubWF4QmFja1JlZmVyZW5jZT0wLGUuZ3JvdXBOYW1lcy5sZW5ndGg9MCxlLmJhY2tSZWZlcmVuY2VOYW1lcy5sZW5ndGg9MCx0aGlzLnJlZ2V4cF9kaXNqdW5jdGlvbihlKSxlLnBvcyE9PWUuc291cmNlLmxlbmd0aCYmKGUuZWF0KDQxKSYmZS5yYWlzZSgiVW5tYXRjaGVkICcpJyIpLChlLmVhdCg5Myl8fGUuZWF0KDEyNSkpJiZlLnJhaXNlKCJMb25lIHF1YW50aWZpZXIgYnJhY2tldHMiKSksZS5tYXhCYWNrUmVmZXJlbmNlPmUubnVtQ2FwdHVyaW5nUGFyZW5zJiZlLnJhaXNlKCJJbnZhbGlkIGVzY2FwZSIpO2Zvcih2YXIgdD0wLHM9ZS5iYWNrUmVmZXJlbmNlTmFtZXM7dDxzLmxlbmd0aDt0Kz0xKXt2YXIgaT1zW3RdOy0xPT09ZS5ncm91cE5hbWVzLmluZGV4T2YoaSkmJmUucmFpc2UoIkludmFsaWQgbmFtZWQgY2FwdHVyZSByZWZlcmVuY2VkIik7fX0sYmgucmVnZXhwX2Rpc2p1bmN0aW9uPWZ1bmN0aW9uKGUpe2Zvcih0aGlzLnJlZ2V4cF9hbHRlcm5hdGl2ZShlKTtlLmVhdCgxMjQpOyl0aGlzLnJlZ2V4cF9hbHRlcm5hdGl2ZShlKTt0aGlzLnJlZ2V4cF9lYXRRdWFudGlmaWVyKGUsITApJiZlLnJhaXNlKCJOb3RoaW5nIHRvIHJlcGVhdCIpLGUuZWF0KDEyMykmJmUucmFpc2UoIkxvbmUgcXVhbnRpZmllciBicmFja2V0cyIpO30sYmgucmVnZXhwX2FsdGVybmF0aXZlPWZ1bmN0aW9uKGUpe2Zvcig7ZS5wb3M8ZS5zb3VyY2UubGVuZ3RoJiZ0aGlzLnJlZ2V4cF9lYXRUZXJtKGUpOyk7fSxiaC5yZWdleHBfZWF0VGVybT1mdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5yZWdleHBfZWF0QXNzZXJ0aW9uKGUpPyhlLmxhc3RBc3NlcnRpb25Jc1F1YW50aWZpYWJsZSYmdGhpcy5yZWdleHBfZWF0UXVhbnRpZmllcihlKSYmZS5zd2l0Y2hVJiZlLnJhaXNlKCJJbnZhbGlkIHF1YW50aWZpZXIiKSwhMCk6ISEoZS5zd2l0Y2hVP3RoaXMucmVnZXhwX2VhdEF0b20oZSk6dGhpcy5yZWdleHBfZWF0RXh0ZW5kZWRBdG9tKGUpKSYmKHRoaXMucmVnZXhwX2VhdFF1YW50aWZpZXIoZSksITApfSxiaC5yZWdleHBfZWF0QXNzZXJ0aW9uPWZ1bmN0aW9uKGUpe3ZhciB0PWUucG9zO2lmKGUubGFzdEFzc2VydGlvbklzUXVhbnRpZmlhYmxlPSExLGUuZWF0KDk0KXx8ZS5lYXQoMzYpKXJldHVybiAhMDtpZihlLmVhdCg5Mikpe2lmKGUuZWF0KDY2KXx8ZS5lYXQoOTgpKXJldHVybiAhMDtlLnBvcz10O31pZihlLmVhdCg0MCkmJmUuZWF0KDYzKSl7dmFyIHM9ITE7aWYodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj05JiYocz1lLmVhdCg2MCkpLGUuZWF0KDYxKXx8ZS5lYXQoMzMpKXJldHVybiB0aGlzLnJlZ2V4cF9kaXNqdW5jdGlvbihlKSxlLmVhdCg0MSl8fGUucmFpc2UoIlVudGVybWluYXRlZCBncm91cCIpLGUubGFzdEFzc2VydGlvbklzUXVhbnRpZmlhYmxlPSFzLCEwfXJldHVybiBlLnBvcz10LCExfSxiaC5yZWdleHBfZWF0UXVhbnRpZmllcj1mdW5jdGlvbihlLHQpe3JldHVybiB2b2lkIDA9PT10JiYodD0hMSksISF0aGlzLnJlZ2V4cF9lYXRRdWFudGlmaWVyUHJlZml4KGUsdCkmJihlLmVhdCg2MyksITApfSxiaC5yZWdleHBfZWF0UXVhbnRpZmllclByZWZpeD1mdW5jdGlvbihlLHQpe3JldHVybiBlLmVhdCg0Mil8fGUuZWF0KDQzKXx8ZS5lYXQoNjMpfHx0aGlzLnJlZ2V4cF9lYXRCcmFjZWRRdWFudGlmaWVyKGUsdCl9LGJoLnJlZ2V4cF9lYXRCcmFjZWRRdWFudGlmaWVyPWZ1bmN0aW9uKGUsdCl7dmFyIHM9ZS5wb3M7aWYoZS5lYXQoMTIzKSl7dmFyIGk9MCxuPS0xO2lmKHRoaXMucmVnZXhwX2VhdERlY2ltYWxEaWdpdHMoZSkmJihpPWUubGFzdEludFZhbHVlLGUuZWF0KDQ0KSYmdGhpcy5yZWdleHBfZWF0RGVjaW1hbERpZ2l0cyhlKSYmKG49ZS5sYXN0SW50VmFsdWUpLGUuZWF0KDEyNSkpKXJldHVybiAtMSE9PW4mJm48aSYmIXQmJmUucmFpc2UoIm51bWJlcnMgb3V0IG9mIG9yZGVyIGluIHt9IHF1YW50aWZpZXIiKSwhMDtlLnN3aXRjaFUmJiF0JiZlLnJhaXNlKCJJbmNvbXBsZXRlIHF1YW50aWZpZXIiKSxlLnBvcz1zO31yZXR1cm4gITF9LGJoLnJlZ2V4cF9lYXRBdG9tPWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnJlZ2V4cF9lYXRQYXR0ZXJuQ2hhcmFjdGVycyhlKXx8ZS5lYXQoNDYpfHx0aGlzLnJlZ2V4cF9lYXRSZXZlcnNlU29saWR1c0F0b21Fc2NhcGUoZSl8fHRoaXMucmVnZXhwX2VhdENoYXJhY3RlckNsYXNzKGUpfHx0aGlzLnJlZ2V4cF9lYXRVbmNhcHR1cmluZ0dyb3VwKGUpfHx0aGlzLnJlZ2V4cF9lYXRDYXB0dXJpbmdHcm91cChlKX0sYmgucmVnZXhwX2VhdFJldmVyc2VTb2xpZHVzQXRvbUVzY2FwZT1mdW5jdGlvbihlKXt2YXIgdD1lLnBvcztpZihlLmVhdCg5Mikpe2lmKHRoaXMucmVnZXhwX2VhdEF0b21Fc2NhcGUoZSkpcmV0dXJuICEwO2UucG9zPXQ7fXJldHVybiAhMX0sYmgucmVnZXhwX2VhdFVuY2FwdHVyaW5nR3JvdXA9ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5wb3M7aWYoZS5lYXQoNDApKXtpZihlLmVhdCg2MykmJmUuZWF0KDU4KSl7aWYodGhpcy5yZWdleHBfZGlzanVuY3Rpb24oZSksZS5lYXQoNDEpKXJldHVybiAhMDtlLnJhaXNlKCJVbnRlcm1pbmF0ZWQgZ3JvdXAiKTt9ZS5wb3M9dDt9cmV0dXJuICExfSxiaC5yZWdleHBfZWF0Q2FwdHVyaW5nR3JvdXA9ZnVuY3Rpb24oZSl7aWYoZS5lYXQoNDApKXtpZih0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTk/dGhpcy5yZWdleHBfZ3JvdXBTcGVjaWZpZXIoZSk6NjM9PT1lLmN1cnJlbnQoKSYmZS5yYWlzZSgiSW52YWxpZCBncm91cCIpLHRoaXMucmVnZXhwX2Rpc2p1bmN0aW9uKGUpLGUuZWF0KDQxKSlyZXR1cm4gZS5udW1DYXB0dXJpbmdQYXJlbnMrPTEsITA7ZS5yYWlzZSgiVW50ZXJtaW5hdGVkIGdyb3VwIik7fXJldHVybiAhMX0sYmgucmVnZXhwX2VhdEV4dGVuZGVkQXRvbT1mdW5jdGlvbihlKXtyZXR1cm4gZS5lYXQoNDYpfHx0aGlzLnJlZ2V4cF9lYXRSZXZlcnNlU29saWR1c0F0b21Fc2NhcGUoZSl8fHRoaXMucmVnZXhwX2VhdENoYXJhY3RlckNsYXNzKGUpfHx0aGlzLnJlZ2V4cF9lYXRVbmNhcHR1cmluZ0dyb3VwKGUpfHx0aGlzLnJlZ2V4cF9lYXRDYXB0dXJpbmdHcm91cChlKXx8dGhpcy5yZWdleHBfZWF0SW52YWxpZEJyYWNlZFF1YW50aWZpZXIoZSl8fHRoaXMucmVnZXhwX2VhdEV4dGVuZGVkUGF0dGVybkNoYXJhY3RlcihlKX0sYmgucmVnZXhwX2VhdEludmFsaWRCcmFjZWRRdWFudGlmaWVyPWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnJlZ2V4cF9lYXRCcmFjZWRRdWFudGlmaWVyKGUsITApJiZlLnJhaXNlKCJOb3RoaW5nIHRvIHJlcGVhdCIpLCExfSxiaC5yZWdleHBfZWF0U3ludGF4Q2hhcmFjdGVyPWZ1bmN0aW9uKGUpe3ZhciB0PWUuY3VycmVudCgpO3JldHVybiAhIVNoKHQpJiYoZS5sYXN0SW50VmFsdWU9dCxlLmFkdmFuY2UoKSwhMCl9LGJoLnJlZ2V4cF9lYXRQYXR0ZXJuQ2hhcmFjdGVycz1mdW5jdGlvbihlKXtmb3IodmFyIHQ9ZS5wb3Mscz0wOy0xIT09KHM9ZS5jdXJyZW50KCkpJiYhU2gocyk7KWUuYWR2YW5jZSgpO3JldHVybiBlLnBvcyE9PXR9LGJoLnJlZ2V4cF9lYXRFeHRlbmRlZFBhdHRlcm5DaGFyYWN0ZXI9ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5jdXJyZW50KCk7cmV0dXJuICEoLTE9PT10fHwzNj09PXR8fHQ+PTQwJiZ0PD00M3x8NDY9PT10fHw2Mz09PXR8fDkxPT09dHx8OTQ9PT10fHwxMjQ9PT10KSYmKGUuYWR2YW5jZSgpLCEwKX0sYmgucmVnZXhwX2dyb3VwU3BlY2lmaWVyPWZ1bmN0aW9uKGUpe2lmKGUuZWF0KDYzKSl7aWYodGhpcy5yZWdleHBfZWF0R3JvdXBOYW1lKGUpKXJldHVybiAtMSE9PWUuZ3JvdXBOYW1lcy5pbmRleE9mKGUubGFzdFN0cmluZ1ZhbHVlKSYmZS5yYWlzZSgiRHVwbGljYXRlIGNhcHR1cmUgZ3JvdXAgbmFtZSIpLHZvaWQgZS5ncm91cE5hbWVzLnB1c2goZS5sYXN0U3RyaW5nVmFsdWUpO2UucmFpc2UoIkludmFsaWQgZ3JvdXAiKTt9fSxiaC5yZWdleHBfZWF0R3JvdXBOYW1lPWZ1bmN0aW9uKGUpe2lmKGUubGFzdFN0cmluZ1ZhbHVlPSIiLGUuZWF0KDYwKSl7aWYodGhpcy5yZWdleHBfZWF0UmVnRXhwSWRlbnRpZmllck5hbWUoZSkmJmUuZWF0KDYyKSlyZXR1cm4gITA7ZS5yYWlzZSgiSW52YWxpZCBjYXB0dXJlIGdyb3VwIG5hbWUiKTt9cmV0dXJuICExfSxiaC5yZWdleHBfZWF0UmVnRXhwSWRlbnRpZmllck5hbWU9ZnVuY3Rpb24oZSl7aWYoZS5sYXN0U3RyaW5nVmFsdWU9IiIsdGhpcy5yZWdleHBfZWF0UmVnRXhwSWRlbnRpZmllclN0YXJ0KGUpKXtmb3IoZS5sYXN0U3RyaW5nVmFsdWUrPVNjKGUubGFzdEludFZhbHVlKTt0aGlzLnJlZ2V4cF9lYXRSZWdFeHBJZGVudGlmaWVyUGFydChlKTspZS5sYXN0U3RyaW5nVmFsdWUrPVNjKGUubGFzdEludFZhbHVlKTtyZXR1cm4gITB9cmV0dXJuICExfSxiaC5yZWdleHBfZWF0UmVnRXhwSWRlbnRpZmllclN0YXJ0PWZ1bmN0aW9uKGUpe3ZhciB0PWUucG9zLHM9dGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj0xMSxpPWUuY3VycmVudChzKTtyZXR1cm4gZS5hZHZhbmNlKHMpLDkyPT09aSYmdGhpcy5yZWdleHBfZWF0UmVnRXhwVW5pY29kZUVzY2FwZVNlcXVlbmNlKGUscykmJihpPWUubGFzdEludFZhbHVlKSxmdW5jdGlvbihlKXtyZXR1cm4gdGMoZSwhMCl8fDM2PT09ZXx8OTU9PT1lfShpKT8oZS5sYXN0SW50VmFsdWU9aSwhMCk6KGUucG9zPXQsITEpfSxiaC5yZWdleHBfZWF0UmVnRXhwSWRlbnRpZmllclBhcnQ9ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5wb3Mscz10aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTExLGk9ZS5jdXJyZW50KHMpO3JldHVybiBlLmFkdmFuY2UocyksOTI9PT1pJiZ0aGlzLnJlZ2V4cF9lYXRSZWdFeHBVbmljb2RlRXNjYXBlU2VxdWVuY2UoZSxzKSYmKGk9ZS5sYXN0SW50VmFsdWUpLGZ1bmN0aW9uKGUpe3JldHVybiBzYyhlLCEwKXx8MzY9PT1lfHw5NT09PWV8fDgyMDQ9PT1lfHw4MjA1PT09ZX0oaSk/KGUubGFzdEludFZhbHVlPWksITApOihlLnBvcz10LCExKX0sYmgucmVnZXhwX2VhdEF0b21Fc2NhcGU9ZnVuY3Rpb24oZSl7cmV0dXJuICEhKHRoaXMucmVnZXhwX2VhdEJhY2tSZWZlcmVuY2UoZSl8fHRoaXMucmVnZXhwX2VhdENoYXJhY3RlckNsYXNzRXNjYXBlKGUpfHx0aGlzLnJlZ2V4cF9lYXRDaGFyYWN0ZXJFc2NhcGUoZSl8fGUuc3dpdGNoTiYmdGhpcy5yZWdleHBfZWF0S0dyb3VwTmFtZShlKSl8fChlLnN3aXRjaFUmJig5OT09PWUuY3VycmVudCgpJiZlLnJhaXNlKCJJbnZhbGlkIHVuaWNvZGUgZXNjYXBlIiksZS5yYWlzZSgiSW52YWxpZCBlc2NhcGUiKSksITEpfSxiaC5yZWdleHBfZWF0QmFja1JlZmVyZW5jZT1mdW5jdGlvbihlKXt2YXIgdD1lLnBvcztpZih0aGlzLnJlZ2V4cF9lYXREZWNpbWFsRXNjYXBlKGUpKXt2YXIgcz1lLmxhc3RJbnRWYWx1ZTtpZihlLnN3aXRjaFUpcmV0dXJuIHM+ZS5tYXhCYWNrUmVmZXJlbmNlJiYoZS5tYXhCYWNrUmVmZXJlbmNlPXMpLCEwO2lmKHM8PWUubnVtQ2FwdHVyaW5nUGFyZW5zKXJldHVybiAhMDtlLnBvcz10O31yZXR1cm4gITF9LGJoLnJlZ2V4cF9lYXRLR3JvdXBOYW1lPWZ1bmN0aW9uKGUpe2lmKGUuZWF0KDEwNykpe2lmKHRoaXMucmVnZXhwX2VhdEdyb3VwTmFtZShlKSlyZXR1cm4gZS5iYWNrUmVmZXJlbmNlTmFtZXMucHVzaChlLmxhc3RTdHJpbmdWYWx1ZSksITA7ZS5yYWlzZSgiSW52YWxpZCBuYW1lZCByZWZlcmVuY2UiKTt9cmV0dXJuICExfSxiaC5yZWdleHBfZWF0Q2hhcmFjdGVyRXNjYXBlPWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnJlZ2V4cF9lYXRDb250cm9sRXNjYXBlKGUpfHx0aGlzLnJlZ2V4cF9lYXRDQ29udHJvbExldHRlcihlKXx8dGhpcy5yZWdleHBfZWF0WmVybyhlKXx8dGhpcy5yZWdleHBfZWF0SGV4RXNjYXBlU2VxdWVuY2UoZSl8fHRoaXMucmVnZXhwX2VhdFJlZ0V4cFVuaWNvZGVFc2NhcGVTZXF1ZW5jZShlLCExKXx8IWUuc3dpdGNoVSYmdGhpcy5yZWdleHBfZWF0TGVnYWN5T2N0YWxFc2NhcGVTZXF1ZW5jZShlKXx8dGhpcy5yZWdleHBfZWF0SWRlbnRpdHlFc2NhcGUoZSl9LGJoLnJlZ2V4cF9lYXRDQ29udHJvbExldHRlcj1mdW5jdGlvbihlKXt2YXIgdD1lLnBvcztpZihlLmVhdCg5OSkpe2lmKHRoaXMucmVnZXhwX2VhdENvbnRyb2xMZXR0ZXIoZSkpcmV0dXJuICEwO2UucG9zPXQ7fXJldHVybiAhMX0sYmgucmVnZXhwX2VhdFplcm89ZnVuY3Rpb24oZSl7cmV0dXJuIDQ4PT09ZS5jdXJyZW50KCkmJiF3aChlLmxvb2thaGVhZCgpKSYmKGUubGFzdEludFZhbHVlPTAsZS5hZHZhbmNlKCksITApfSxiaC5yZWdleHBfZWF0Q29udHJvbEVzY2FwZT1mdW5jdGlvbihlKXt2YXIgdD1lLmN1cnJlbnQoKTtyZXR1cm4gMTE2PT09dD8oZS5sYXN0SW50VmFsdWU9OSxlLmFkdmFuY2UoKSwhMCk6MTEwPT09dD8oZS5sYXN0SW50VmFsdWU9MTAsZS5hZHZhbmNlKCksITApOjExOD09PXQ/KGUubGFzdEludFZhbHVlPTExLGUuYWR2YW5jZSgpLCEwKToxMDI9PT10PyhlLmxhc3RJbnRWYWx1ZT0xMixlLmFkdmFuY2UoKSwhMCk6MTE0PT09dCYmKGUubGFzdEludFZhbHVlPTEzLGUuYWR2YW5jZSgpLCEwKX0sYmgucmVnZXhwX2VhdENvbnRyb2xMZXR0ZXI9ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5jdXJyZW50KCk7cmV0dXJuICEhQWgodCkmJihlLmxhc3RJbnRWYWx1ZT10JTMyLGUuYWR2YW5jZSgpLCEwKX0sYmgucmVnZXhwX2VhdFJlZ0V4cFVuaWNvZGVFc2NhcGVTZXF1ZW5jZT1mdW5jdGlvbihlLHQpe3ZvaWQgMD09PXQmJih0PSExKTt2YXIgcyxpPWUucG9zLG49dHx8ZS5zd2l0Y2hVO2lmKGUuZWF0KDExNykpe2lmKHRoaXMucmVnZXhwX2VhdEZpeGVkSGV4RGlnaXRzKGUsNCkpe3ZhciByPWUubGFzdEludFZhbHVlO2lmKG4mJnI+PTU1Mjk2JiZyPD01NjMxOSl7dmFyIG89ZS5wb3M7aWYoZS5lYXQoOTIpJiZlLmVhdCgxMTcpJiZ0aGlzLnJlZ2V4cF9lYXRGaXhlZEhleERpZ2l0cyhlLDQpKXt2YXIgYT1lLmxhc3RJbnRWYWx1ZTtpZihhPj01NjMyMCYmYTw9NTczNDMpcmV0dXJuIGUubGFzdEludFZhbHVlPTEwMjQqKHItNTUyOTYpKyhhLTU2MzIwKSs2NTUzNiwhMH1lLnBvcz1vLGUubGFzdEludFZhbHVlPXI7fXJldHVybiAhMH1pZihuJiZlLmVhdCgxMjMpJiZ0aGlzLnJlZ2V4cF9lYXRIZXhEaWdpdHMoZSkmJmUuZWF0KDEyNSkmJigocz1lLmxhc3RJbnRWYWx1ZSk+PTAmJnM8PTExMTQxMTEpKXJldHVybiAhMDtuJiZlLnJhaXNlKCJJbnZhbGlkIHVuaWNvZGUgZXNjYXBlIiksZS5wb3M9aTt9cmV0dXJuICExfSxiaC5yZWdleHBfZWF0SWRlbnRpdHlFc2NhcGU9ZnVuY3Rpb24oZSl7aWYoZS5zd2l0Y2hVKXJldHVybiAhIXRoaXMucmVnZXhwX2VhdFN5bnRheENoYXJhY3RlcihlKXx8ISFlLmVhdCg0NykmJihlLmxhc3RJbnRWYWx1ZT00NywhMCk7dmFyIHQ9ZS5jdXJyZW50KCk7cmV0dXJuICEoOTk9PT10fHxlLnN3aXRjaE4mJjEwNz09PXQpJiYoZS5sYXN0SW50VmFsdWU9dCxlLmFkdmFuY2UoKSwhMCl9LGJoLnJlZ2V4cF9lYXREZWNpbWFsRXNjYXBlPWZ1bmN0aW9uKGUpe2UubGFzdEludFZhbHVlPTA7dmFyIHQ9ZS5jdXJyZW50KCk7aWYodD49NDkmJnQ8PTU3KXtkb3tlLmxhc3RJbnRWYWx1ZT0xMCplLmxhc3RJbnRWYWx1ZSsodC00OCksZS5hZHZhbmNlKCk7fXdoaWxlKCh0PWUuY3VycmVudCgpKT49NDgmJnQ8PTU3KTtyZXR1cm4gITB9cmV0dXJuICExfTtmdW5jdGlvbiBraChlKXtyZXR1cm4gQWgoZSl8fDk1PT09ZX1mdW5jdGlvbiBJaChlKXtyZXR1cm4ga2goZSl8fHdoKGUpfWZ1bmN0aW9uIHdoKGUpe3JldHVybiBlPj00OCYmZTw9NTd9ZnVuY3Rpb24gUGgoZSl7cmV0dXJuIGU+PTQ4JiZlPD01N3x8ZT49NjUmJmU8PTcwfHxlPj05NyYmZTw9MTAyfWZ1bmN0aW9uIENoKGUpe3JldHVybiBlPj02NSYmZTw9NzA/ZS02NSsxMDplPj05NyYmZTw9MTAyP2UtOTcrMTA6ZS00OH1mdW5jdGlvbiAkaChlKXtyZXR1cm4gZT49NDgmJmU8PTU1fWJoLnJlZ2V4cF9lYXRDaGFyYWN0ZXJDbGFzc0VzY2FwZT1mdW5jdGlvbihlKXt2YXIgdD1lLmN1cnJlbnQoKTtpZihmdW5jdGlvbihlKXtyZXR1cm4gMTAwPT09ZXx8Njg9PT1lfHwxMTU9PT1lfHw4Mz09PWV8fDExOT09PWV8fDg3PT09ZX0odCkpcmV0dXJuIGUubGFzdEludFZhbHVlPS0xLGUuYWR2YW5jZSgpLDE7dmFyIHM9ITE7aWYoZS5zd2l0Y2hVJiZ0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTkmJigocz04MD09PXQpfHwxMTI9PT10KSl7dmFyIGk7aWYoZS5sYXN0SW50VmFsdWU9LTEsZS5hZHZhbmNlKCksZS5lYXQoMTIzKSYmKGk9dGhpcy5yZWdleHBfZWF0VW5pY29kZVByb3BlcnR5VmFsdWVFeHByZXNzaW9uKGUpKSYmZS5lYXQoMTI1KSlyZXR1cm4gcyYmMj09PWkmJmUucmFpc2UoIkludmFsaWQgcHJvcGVydHkgbmFtZSIpLGk7ZS5yYWlzZSgiSW52YWxpZCBwcm9wZXJ0eSBuYW1lIik7fXJldHVybiAwfSxiaC5yZWdleHBfZWF0VW5pY29kZVByb3BlcnR5VmFsdWVFeHByZXNzaW9uPWZ1bmN0aW9uKGUpe3ZhciB0PWUucG9zO2lmKHRoaXMucmVnZXhwX2VhdFVuaWNvZGVQcm9wZXJ0eU5hbWUoZSkmJmUuZWF0KDYxKSl7dmFyIHM9ZS5sYXN0U3RyaW5nVmFsdWU7aWYodGhpcy5yZWdleHBfZWF0VW5pY29kZVByb3BlcnR5VmFsdWUoZSkpe3ZhciBpPWUubGFzdFN0cmluZ1ZhbHVlO3JldHVybiB0aGlzLnJlZ2V4cF92YWxpZGF0ZVVuaWNvZGVQcm9wZXJ0eU5hbWVBbmRWYWx1ZShlLHMsaSksMX19aWYoZS5wb3M9dCx0aGlzLnJlZ2V4cF9lYXRMb25lVW5pY29kZVByb3BlcnR5TmFtZU9yVmFsdWUoZSkpe3ZhciBuPWUubGFzdFN0cmluZ1ZhbHVlO3JldHVybiB0aGlzLnJlZ2V4cF92YWxpZGF0ZVVuaWNvZGVQcm9wZXJ0eU5hbWVPclZhbHVlKGUsbil9cmV0dXJuIDB9LGJoLnJlZ2V4cF92YWxpZGF0ZVVuaWNvZGVQcm9wZXJ0eU5hbWVBbmRWYWx1ZT1mdW5jdGlvbihlLHQscyl7RWMoZS51bmljb2RlUHJvcGVydGllcy5ub25CaW5hcnksdCl8fGUucmFpc2UoIkludmFsaWQgcHJvcGVydHkgbmFtZSIpLGUudW5pY29kZVByb3BlcnRpZXMubm9uQmluYXJ5W3RdLnRlc3Qocyl8fGUucmFpc2UoIkludmFsaWQgcHJvcGVydHkgdmFsdWUiKTt9LGJoLnJlZ2V4cF92YWxpZGF0ZVVuaWNvZGVQcm9wZXJ0eU5hbWVPclZhbHVlPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUudW5pY29kZVByb3BlcnRpZXMuYmluYXJ5LnRlc3QodCk/MTplLnN3aXRjaFYmJmUudW5pY29kZVByb3BlcnRpZXMuYmluYXJ5T2ZTdHJpbmdzLnRlc3QodCk/Mjp2b2lkIGUucmFpc2UoIkludmFsaWQgcHJvcGVydHkgbmFtZSIpfSxiaC5yZWdleHBfZWF0VW5pY29kZVByb3BlcnR5TmFtZT1mdW5jdGlvbihlKXt2YXIgdD0wO2ZvcihlLmxhc3RTdHJpbmdWYWx1ZT0iIjtraCh0PWUuY3VycmVudCgpKTspZS5sYXN0U3RyaW5nVmFsdWUrPVNjKHQpLGUuYWR2YW5jZSgpO3JldHVybiAiIiE9PWUubGFzdFN0cmluZ1ZhbHVlfSxiaC5yZWdleHBfZWF0VW5pY29kZVByb3BlcnR5VmFsdWU9ZnVuY3Rpb24oZSl7dmFyIHQ9MDtmb3IoZS5sYXN0U3RyaW5nVmFsdWU9IiI7SWgodD1lLmN1cnJlbnQoKSk7KWUubGFzdFN0cmluZ1ZhbHVlKz1TYyh0KSxlLmFkdmFuY2UoKTtyZXR1cm4gIiIhPT1lLmxhc3RTdHJpbmdWYWx1ZX0sYmgucmVnZXhwX2VhdExvbmVVbmljb2RlUHJvcGVydHlOYW1lT3JWYWx1ZT1mdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5yZWdleHBfZWF0VW5pY29kZVByb3BlcnR5VmFsdWUoZSl9LGJoLnJlZ2V4cF9lYXRDaGFyYWN0ZXJDbGFzcz1mdW5jdGlvbihlKXtpZihlLmVhdCg5MSkpe3ZhciB0PWUuZWF0KDk0KSxzPXRoaXMucmVnZXhwX2NsYXNzQ29udGVudHMoZSk7cmV0dXJuIGUuZWF0KDkzKXx8ZS5yYWlzZSgiVW50ZXJtaW5hdGVkIGNoYXJhY3RlciBjbGFzcyIpLHQmJjI9PT1zJiZlLnJhaXNlKCJOZWdhdGVkIGNoYXJhY3RlciBjbGFzcyBtYXkgY29udGFpbiBzdHJpbmdzIiksITB9cmV0dXJuICExfSxiaC5yZWdleHBfY2xhc3NDb250ZW50cz1mdW5jdGlvbihlKXtyZXR1cm4gOTM9PT1lLmN1cnJlbnQoKT8xOmUuc3dpdGNoVj90aGlzLnJlZ2V4cF9jbGFzc1NldEV4cHJlc3Npb24oZSk6KHRoaXMucmVnZXhwX25vbkVtcHR5Q2xhc3NSYW5nZXMoZSksMSl9LGJoLnJlZ2V4cF9ub25FbXB0eUNsYXNzUmFuZ2VzPWZ1bmN0aW9uKGUpe2Zvcig7dGhpcy5yZWdleHBfZWF0Q2xhc3NBdG9tKGUpOyl7dmFyIHQ9ZS5sYXN0SW50VmFsdWU7aWYoZS5lYXQoNDUpJiZ0aGlzLnJlZ2V4cF9lYXRDbGFzc0F0b20oZSkpe3ZhciBzPWUubGFzdEludFZhbHVlOyFlLnN3aXRjaFV8fC0xIT09dCYmLTEhPT1zfHxlLnJhaXNlKCJJbnZhbGlkIGNoYXJhY3RlciBjbGFzcyIpLC0xIT09dCYmLTEhPT1zJiZ0PnMmJmUucmFpc2UoIlJhbmdlIG91dCBvZiBvcmRlciBpbiBjaGFyYWN0ZXIgY2xhc3MiKTt9fX0sYmgucmVnZXhwX2VhdENsYXNzQXRvbT1mdW5jdGlvbihlKXt2YXIgdD1lLnBvcztpZihlLmVhdCg5Mikpe2lmKHRoaXMucmVnZXhwX2VhdENsYXNzRXNjYXBlKGUpKXJldHVybiAhMDtpZihlLnN3aXRjaFUpe3ZhciBzPWUuY3VycmVudCgpOyg5OT09PXN8fCRoKHMpKSYmZS5yYWlzZSgiSW52YWxpZCBjbGFzcyBlc2NhcGUiKSxlLnJhaXNlKCJJbnZhbGlkIGVzY2FwZSIpO31lLnBvcz10O312YXIgaT1lLmN1cnJlbnQoKTtyZXR1cm4gOTMhPT1pJiYoZS5sYXN0SW50VmFsdWU9aSxlLmFkdmFuY2UoKSwhMCl9LGJoLnJlZ2V4cF9lYXRDbGFzc0VzY2FwZT1mdW5jdGlvbihlKXt2YXIgdD1lLnBvcztpZihlLmVhdCg5OCkpcmV0dXJuIGUubGFzdEludFZhbHVlPTgsITA7aWYoZS5zd2l0Y2hVJiZlLmVhdCg0NSkpcmV0dXJuIGUubGFzdEludFZhbHVlPTQ1LCEwO2lmKCFlLnN3aXRjaFUmJmUuZWF0KDk5KSl7aWYodGhpcy5yZWdleHBfZWF0Q2xhc3NDb250cm9sTGV0dGVyKGUpKXJldHVybiAhMDtlLnBvcz10O31yZXR1cm4gdGhpcy5yZWdleHBfZWF0Q2hhcmFjdGVyQ2xhc3NFc2NhcGUoZSl8fHRoaXMucmVnZXhwX2VhdENoYXJhY3RlckVzY2FwZShlKX0sYmgucmVnZXhwX2NsYXNzU2V0RXhwcmVzc2lvbj1mdW5jdGlvbihlKXt2YXIgdCxzPTE7aWYodGhpcy5yZWdleHBfZWF0Q2xhc3NTZXRSYW5nZShlKSk7ZWxzZSBpZih0PXRoaXMucmVnZXhwX2VhdENsYXNzU2V0T3BlcmFuZChlKSl7Mj09PXQmJihzPTIpO2Zvcih2YXIgaT1lLnBvcztlLmVhdENoYXJzKFszOCwzOF0pOykzOCE9PWUuY3VycmVudCgpJiYodD10aGlzLnJlZ2V4cF9lYXRDbGFzc1NldE9wZXJhbmQoZSkpPzIhPT10JiYocz0xKTplLnJhaXNlKCJJbnZhbGlkIGNoYXJhY3RlciBpbiBjaGFyYWN0ZXIgY2xhc3MiKTtpZihpIT09ZS5wb3MpcmV0dXJuIHM7Zm9yKDtlLmVhdENoYXJzKFs0NSw0NV0pOyl0aGlzLnJlZ2V4cF9lYXRDbGFzc1NldE9wZXJhbmQoZSl8fGUucmFpc2UoIkludmFsaWQgY2hhcmFjdGVyIGluIGNoYXJhY3RlciBjbGFzcyIpO2lmKGkhPT1lLnBvcylyZXR1cm4gc31lbHNlIGUucmFpc2UoIkludmFsaWQgY2hhcmFjdGVyIGluIGNoYXJhY3RlciBjbGFzcyIpO2Zvcig7OylpZighdGhpcy5yZWdleHBfZWF0Q2xhc3NTZXRSYW5nZShlKSl7aWYoISh0PXRoaXMucmVnZXhwX2VhdENsYXNzU2V0T3BlcmFuZChlKSkpcmV0dXJuIHM7Mj09PXQmJihzPTIpO319LGJoLnJlZ2V4cF9lYXRDbGFzc1NldFJhbmdlPWZ1bmN0aW9uKGUpe3ZhciB0PWUucG9zO2lmKHRoaXMucmVnZXhwX2VhdENsYXNzU2V0Q2hhcmFjdGVyKGUpKXt2YXIgcz1lLmxhc3RJbnRWYWx1ZTtpZihlLmVhdCg0NSkmJnRoaXMucmVnZXhwX2VhdENsYXNzU2V0Q2hhcmFjdGVyKGUpKXt2YXIgaT1lLmxhc3RJbnRWYWx1ZTtyZXR1cm4gLTEhPT1zJiYtMSE9PWkmJnM+aSYmZS5yYWlzZSgiUmFuZ2Ugb3V0IG9mIG9yZGVyIGluIGNoYXJhY3RlciBjbGFzcyIpLCEwfWUucG9zPXQ7fXJldHVybiAhMX0sYmgucmVnZXhwX2VhdENsYXNzU2V0T3BlcmFuZD1mdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5yZWdleHBfZWF0Q2xhc3NTZXRDaGFyYWN0ZXIoZSk/MTp0aGlzLnJlZ2V4cF9lYXRDbGFzc1N0cmluZ0Rpc2p1bmN0aW9uKGUpfHx0aGlzLnJlZ2V4cF9lYXROZXN0ZWRDbGFzcyhlKX0sYmgucmVnZXhwX2VhdE5lc3RlZENsYXNzPWZ1bmN0aW9uKGUpe3ZhciB0PWUucG9zO2lmKGUuZWF0KDkxKSl7dmFyIHM9ZS5lYXQoOTQpLGk9dGhpcy5yZWdleHBfY2xhc3NDb250ZW50cyhlKTtpZihlLmVhdCg5MykpcmV0dXJuIHMmJjI9PT1pJiZlLnJhaXNlKCJOZWdhdGVkIGNoYXJhY3RlciBjbGFzcyBtYXkgY29udGFpbiBzdHJpbmdzIiksaTtlLnBvcz10O31pZihlLmVhdCg5Mikpe3ZhciBuPXRoaXMucmVnZXhwX2VhdENoYXJhY3RlckNsYXNzRXNjYXBlKGUpO2lmKG4pcmV0dXJuIG47ZS5wb3M9dDt9cmV0dXJuIG51bGx9LGJoLnJlZ2V4cF9lYXRDbGFzc1N0cmluZ0Rpc2p1bmN0aW9uPWZ1bmN0aW9uKGUpe3ZhciB0PWUucG9zO2lmKGUuZWF0Q2hhcnMoWzkyLDExM10pKXtpZihlLmVhdCgxMjMpKXt2YXIgcz10aGlzLnJlZ2V4cF9jbGFzc1N0cmluZ0Rpc2p1bmN0aW9uQ29udGVudHMoZSk7aWYoZS5lYXQoMTI1KSlyZXR1cm4gc31lbHNlIGUucmFpc2UoIkludmFsaWQgZXNjYXBlIik7ZS5wb3M9dDt9cmV0dXJuIG51bGx9LGJoLnJlZ2V4cF9jbGFzc1N0cmluZ0Rpc2p1bmN0aW9uQ29udGVudHM9ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PXRoaXMucmVnZXhwX2NsYXNzU3RyaW5nKGUpO2UuZWF0KDEyNCk7KTI9PT10aGlzLnJlZ2V4cF9jbGFzc1N0cmluZyhlKSYmKHQ9Mik7cmV0dXJuIHR9LGJoLnJlZ2V4cF9jbGFzc1N0cmluZz1mdW5jdGlvbihlKXtmb3IodmFyIHQ9MDt0aGlzLnJlZ2V4cF9lYXRDbGFzc1NldENoYXJhY3RlcihlKTspdCsrO3JldHVybiAxPT09dD8xOjJ9LGJoLnJlZ2V4cF9lYXRDbGFzc1NldENoYXJhY3Rlcj1mdW5jdGlvbihlKXt2YXIgdD1lLnBvcztpZihlLmVhdCg5MikpcmV0dXJuICEoIXRoaXMucmVnZXhwX2VhdENoYXJhY3RlckVzY2FwZShlKSYmIXRoaXMucmVnZXhwX2VhdENsYXNzU2V0UmVzZXJ2ZWRQdW5jdHVhdG9yKGUpKXx8KGUuZWF0KDk4KT8oZS5sYXN0SW50VmFsdWU9OCwhMCk6KGUucG9zPXQsITEpKTt2YXIgcz1lLmN1cnJlbnQoKTtyZXR1cm4gIShzPDB8fHM9PT1lLmxvb2thaGVhZCgpJiZmdW5jdGlvbihlKXtyZXR1cm4gMzM9PT1lfHxlPj0zNSYmZTw9Mzh8fGU+PTQyJiZlPD00NHx8NDY9PT1lfHxlPj01OCYmZTw9NjR8fDk0PT09ZXx8OTY9PT1lfHwxMjY9PT1lfShzKSkmJighZnVuY3Rpb24oZSl7cmV0dXJuIDQwPT09ZXx8NDE9PT1lfHw0NT09PWV8fDQ3PT09ZXx8ZT49OTEmJmU8PTkzfHxlPj0xMjMmJmU8PTEyNX0ocykmJihlLmFkdmFuY2UoKSxlLmxhc3RJbnRWYWx1ZT1zLCEwKSl9LGJoLnJlZ2V4cF9lYXRDbGFzc1NldFJlc2VydmVkUHVuY3R1YXRvcj1mdW5jdGlvbihlKXt2YXIgdD1lLmN1cnJlbnQoKTtyZXR1cm4gISFmdW5jdGlvbihlKXtyZXR1cm4gMzM9PT1lfHwzNT09PWV8fDM3PT09ZXx8Mzg9PT1lfHw0ND09PWV8fDQ1PT09ZXx8ZT49NTgmJmU8PTYyfHw2ND09PWV8fDk2PT09ZXx8MTI2PT09ZX0odCkmJihlLmxhc3RJbnRWYWx1ZT10LGUuYWR2YW5jZSgpLCEwKX0sYmgucmVnZXhwX2VhdENsYXNzQ29udHJvbExldHRlcj1mdW5jdGlvbihlKXt2YXIgdD1lLmN1cnJlbnQoKTtyZXR1cm4gISghd2godCkmJjk1IT09dCkmJihlLmxhc3RJbnRWYWx1ZT10JTMyLGUuYWR2YW5jZSgpLCEwKX0sYmgucmVnZXhwX2VhdEhleEVzY2FwZVNlcXVlbmNlPWZ1bmN0aW9uKGUpe3ZhciB0PWUucG9zO2lmKGUuZWF0KDEyMCkpe2lmKHRoaXMucmVnZXhwX2VhdEZpeGVkSGV4RGlnaXRzKGUsMikpcmV0dXJuICEwO2Uuc3dpdGNoVSYmZS5yYWlzZSgiSW52YWxpZCBlc2NhcGUiKSxlLnBvcz10O31yZXR1cm4gITF9LGJoLnJlZ2V4cF9lYXREZWNpbWFsRGlnaXRzPWZ1bmN0aW9uKGUpe3ZhciB0PWUucG9zLHM9MDtmb3IoZS5sYXN0SW50VmFsdWU9MDt3aChzPWUuY3VycmVudCgpKTspZS5sYXN0SW50VmFsdWU9MTAqZS5sYXN0SW50VmFsdWUrKHMtNDgpLGUuYWR2YW5jZSgpO3JldHVybiBlLnBvcyE9PXR9LGJoLnJlZ2V4cF9lYXRIZXhEaWdpdHM9ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5wb3Mscz0wO2ZvcihlLmxhc3RJbnRWYWx1ZT0wO1BoKHM9ZS5jdXJyZW50KCkpOyllLmxhc3RJbnRWYWx1ZT0xNiplLmxhc3RJbnRWYWx1ZStDaChzKSxlLmFkdmFuY2UoKTtyZXR1cm4gZS5wb3MhPT10fSxiaC5yZWdleHBfZWF0TGVnYWN5T2N0YWxFc2NhcGVTZXF1ZW5jZT1mdW5jdGlvbihlKXtpZih0aGlzLnJlZ2V4cF9lYXRPY3RhbERpZ2l0KGUpKXt2YXIgdD1lLmxhc3RJbnRWYWx1ZTtpZih0aGlzLnJlZ2V4cF9lYXRPY3RhbERpZ2l0KGUpKXt2YXIgcz1lLmxhc3RJbnRWYWx1ZTt0PD0zJiZ0aGlzLnJlZ2V4cF9lYXRPY3RhbERpZ2l0KGUpP2UubGFzdEludFZhbHVlPTY0KnQrOCpzK2UubGFzdEludFZhbHVlOmUubGFzdEludFZhbHVlPTgqdCtzO31lbHNlIGUubGFzdEludFZhbHVlPXQ7cmV0dXJuICEwfXJldHVybiAhMX0sYmgucmVnZXhwX2VhdE9jdGFsRGlnaXQ9ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5jdXJyZW50KCk7cmV0dXJuICRoKHQpPyhlLmxhc3RJbnRWYWx1ZT10LTQ4LGUuYWR2YW5jZSgpLCEwKTooZS5sYXN0SW50VmFsdWU9MCwhMSl9LGJoLnJlZ2V4cF9lYXRGaXhlZEhleERpZ2l0cz1mdW5jdGlvbihlLHQpe3ZhciBzPWUucG9zO2UubGFzdEludFZhbHVlPTA7Zm9yKHZhciBpPTA7aTx0OysraSl7dmFyIG49ZS5jdXJyZW50KCk7aWYoIVBoKG4pKXJldHVybiBlLnBvcz1zLCExO2UubGFzdEludFZhbHVlPTE2KmUubGFzdEludFZhbHVlK0NoKG4pLGUuYWR2YW5jZSgpO31yZXR1cm4gITB9O3ZhciBOaD1mdW5jdGlvbihlKXt0aGlzLnR5cGU9ZS50eXBlLHRoaXMudmFsdWU9ZS52YWx1ZSx0aGlzLnN0YXJ0PWUuc3RhcnQsdGhpcy5lbmQ9ZS5lbmQsZS5vcHRpb25zLmxvY2F0aW9ucyYmKHRoaXMubG9jPW5ldyBJYyhlLGUuc3RhcnRMb2MsZS5lbmRMb2MpKSxlLm9wdGlvbnMucmFuZ2VzJiYodGhpcy5yYW5nZT1bZS5zdGFydCxlLmVuZF0pO30sX2g9UmMucHJvdG90eXBlO2Z1bmN0aW9uIFJoKGUpe3JldHVybiAiZnVuY3Rpb24iIT10eXBlb2YgQmlnSW50P251bGw6QmlnSW50KGUucmVwbGFjZSgvXy9nLCIiKSl9X2gubmV4dD1mdW5jdGlvbihlKXshZSYmdGhpcy50eXBlLmtleXdvcmQmJnRoaXMuY29udGFpbnNFc2MmJnRoaXMucmFpc2VSZWNvdmVyYWJsZSh0aGlzLnN0YXJ0LCJFc2NhcGUgc2VxdWVuY2UgaW4ga2V5d29yZCAiK3RoaXMudHlwZS5rZXl3b3JkKSx0aGlzLm9wdGlvbnMub25Ub2tlbiYmdGhpcy5vcHRpb25zLm9uVG9rZW4obmV3IE5oKHRoaXMpKSx0aGlzLmxhc3RUb2tFbmQ9dGhpcy5lbmQsdGhpcy5sYXN0VG9rU3RhcnQ9dGhpcy5zdGFydCx0aGlzLmxhc3RUb2tFbmRMb2M9dGhpcy5lbmRMb2MsdGhpcy5sYXN0VG9rU3RhcnRMb2M9dGhpcy5zdGFydExvYyx0aGlzLm5leHRUb2tlbigpO30sX2guZ2V0VG9rZW49ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5uZXh0KCksbmV3IE5oKHRoaXMpfSwidW5kZWZpbmVkIiE9dHlwZW9mIFN5bWJvbCYmKF9oW1N5bWJvbC5pdGVyYXRvcl09ZnVuY3Rpb24oKXt2YXIgZT10aGlzO3JldHVybiB7bmV4dDpmdW5jdGlvbigpe3ZhciB0PWUuZ2V0VG9rZW4oKTtyZXR1cm4ge2RvbmU6dC50eXBlPT09Y2MuZW9mLHZhbHVlOnR9fX19KSxfaC5uZXh0VG9rZW49ZnVuY3Rpb24oKXt2YXIgZT10aGlzLmN1ckNvbnRleHQoKTtyZXR1cm4gZSYmZS5wcmVzZXJ2ZVNwYWNlfHx0aGlzLnNraXBTcGFjZSgpLHRoaXMuc3RhcnQ9dGhpcy5wb3MsdGhpcy5vcHRpb25zLmxvY2F0aW9ucyYmKHRoaXMuc3RhcnRMb2M9dGhpcy5jdXJQb3NpdGlvbigpKSx0aGlzLnBvcz49dGhpcy5pbnB1dC5sZW5ndGg/dGhpcy5maW5pc2hUb2tlbihjYy5lb2YpOmUub3ZlcnJpZGU/ZS5vdmVycmlkZSh0aGlzKTp2b2lkIHRoaXMucmVhZFRva2VuKHRoaXMuZnVsbENoYXJDb2RlQXRQb3MoKSl9LF9oLnJlYWRUb2tlbj1mdW5jdGlvbihlKXtyZXR1cm4gdGMoZSx0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTYpfHw5Mj09PWU/dGhpcy5yZWFkV29yZCgpOnRoaXMuZ2V0VG9rZW5Gcm9tQ29kZShlKX0sX2guZnVsbENoYXJDb2RlQXRQb3M9ZnVuY3Rpb24oKXt2YXIgZT10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MpO2lmKGU8PTU1Mjk1fHxlPj01NjMyMClyZXR1cm4gZTt2YXIgdD10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MrMSk7cmV0dXJuIHQ8PTU2MzE5fHx0Pj01NzM0ND9lOihlPDwxMCkrdC01NjYxMzg4OH0sX2guc2tpcEJsb2NrQ29tbWVudD1mdW5jdGlvbigpe3ZhciBlPXRoaXMub3B0aW9ucy5vbkNvbW1lbnQmJnRoaXMuY3VyUG9zaXRpb24oKSx0PXRoaXMucG9zLHM9dGhpcy5pbnB1dC5pbmRleE9mKCIqLyIsdGhpcy5wb3MrPTIpO2lmKC0xPT09cyYmdGhpcy5yYWlzZSh0aGlzLnBvcy0yLCJVbnRlcm1pbmF0ZWQgY29tbWVudCIpLHRoaXMucG9zPXMrMix0aGlzLm9wdGlvbnMubG9jYXRpb25zKWZvcih2YXIgaT12b2lkIDAsbj10OyhpPXBjKHRoaXMuaW5wdXQsbix0aGlzLnBvcykpPi0xOykrK3RoaXMuY3VyTGluZSxuPXRoaXMubGluZVN0YXJ0PWk7dGhpcy5vcHRpb25zLm9uQ29tbWVudCYmdGhpcy5vcHRpb25zLm9uQ29tbWVudCghMCx0aGlzLmlucHV0LnNsaWNlKHQrMixzKSx0LHRoaXMucG9zLGUsdGhpcy5jdXJQb3NpdGlvbigpKTt9LF9oLnNraXBMaW5lQ29tbWVudD1mdW5jdGlvbihlKXtmb3IodmFyIHQ9dGhpcy5wb3Mscz10aGlzLm9wdGlvbnMub25Db21tZW50JiZ0aGlzLmN1clBvc2l0aW9uKCksaT10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MrPWUpO3RoaXMucG9zPHRoaXMuaW5wdXQubGVuZ3RoJiYhZGMoaSk7KWk9dGhpcy5pbnB1dC5jaGFyQ29kZUF0KCsrdGhpcy5wb3MpO3RoaXMub3B0aW9ucy5vbkNvbW1lbnQmJnRoaXMub3B0aW9ucy5vbkNvbW1lbnQoITEsdGhpcy5pbnB1dC5zbGljZSh0K2UsdGhpcy5wb3MpLHQsdGhpcy5wb3Mscyx0aGlzLmN1clBvc2l0aW9uKCkpO30sX2guc2tpcFNwYWNlPWZ1bmN0aW9uKCl7ZTpmb3IoO3RoaXMucG9zPHRoaXMuaW5wdXQubGVuZ3RoOyl7dmFyIGU9dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKTtzd2l0Y2goZSl7Y2FzZSAzMjpjYXNlIDE2MDorK3RoaXMucG9zO2JyZWFrO2Nhc2UgMTM6MTA9PT10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MrMSkmJisrdGhpcy5wb3M7Y2FzZSAxMDpjYXNlIDgyMzI6Y2FzZSA4MjMzOisrdGhpcy5wb3MsdGhpcy5vcHRpb25zLmxvY2F0aW9ucyYmKCsrdGhpcy5jdXJMaW5lLHRoaXMubGluZVN0YXJ0PXRoaXMucG9zKTticmVhaztjYXNlIDQ3OnN3aXRjaCh0aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MrMSkpe2Nhc2UgNDI6dGhpcy5za2lwQmxvY2tDb21tZW50KCk7YnJlYWs7Y2FzZSA0Nzp0aGlzLnNraXBMaW5lQ29tbWVudCgyKTticmVhaztkZWZhdWx0OmJyZWFrIGV9YnJlYWs7ZGVmYXVsdDppZighKGU+OCYmZTwxNHx8ZT49NTc2MCYmZmMudGVzdChTdHJpbmcuZnJvbUNoYXJDb2RlKGUpKSkpYnJlYWsgZTsrK3RoaXMucG9zO319fSxfaC5maW5pc2hUb2tlbj1mdW5jdGlvbihlLHQpe3RoaXMuZW5kPXRoaXMucG9zLHRoaXMub3B0aW9ucy5sb2NhdGlvbnMmJih0aGlzLmVuZExvYz10aGlzLmN1clBvc2l0aW9uKCkpO3ZhciBzPXRoaXMudHlwZTt0aGlzLnR5cGU9ZSx0aGlzLnZhbHVlPXQsdGhpcy51cGRhdGVDb250ZXh0KHMpO30sX2gucmVhZFRva2VuX2RvdD1mdW5jdGlvbigpe3ZhciBlPXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcysxKTtpZihlPj00OCYmZTw9NTcpcmV0dXJuIHRoaXMucmVhZE51bWJlcighMCk7dmFyIHQ9dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKzIpO3JldHVybiB0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTYmJjQ2PT09ZSYmNDY9PT10Pyh0aGlzLnBvcys9Myx0aGlzLmZpbmlzaFRva2VuKGNjLmVsbGlwc2lzKSk6KCsrdGhpcy5wb3MsdGhpcy5maW5pc2hUb2tlbihjYy5kb3QpKX0sX2gucmVhZFRva2VuX3NsYXNoPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKzEpO3JldHVybiB0aGlzLmV4cHJBbGxvd2VkPygrK3RoaXMucG9zLHRoaXMucmVhZFJlZ2V4cCgpKTo2MT09PWU/dGhpcy5maW5pc2hPcChjYy5hc3NpZ24sMik6dGhpcy5maW5pc2hPcChjYy5zbGFzaCwxKX0sX2gucmVhZFRva2VuX211bHRfbW9kdWxvX2V4cD1mdW5jdGlvbihlKXt2YXIgdD10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MrMSkscz0xLGk9NDI9PT1lP2NjLnN0YXI6Y2MubW9kdWxvO3JldHVybiB0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTcmJjQyPT09ZSYmNDI9PT10JiYoKytzLGk9Y2Muc3RhcnN0YXIsdD10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MrMikpLDYxPT09dD90aGlzLmZpbmlzaE9wKGNjLmFzc2lnbixzKzEpOnRoaXMuZmluaXNoT3AoaSxzKX0sX2gucmVhZFRva2VuX3BpcGVfYW1wPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcysxKTtpZih0PT09ZSl7aWYodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj0xMilpZig2MT09PXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcysyKSlyZXR1cm4gdGhpcy5maW5pc2hPcChjYy5hc3NpZ24sMyk7cmV0dXJuIHRoaXMuZmluaXNoT3AoMTI0PT09ZT9jYy5sb2dpY2FsT1I6Y2MubG9naWNhbEFORCwyKX1yZXR1cm4gNjE9PT10P3RoaXMuZmluaXNoT3AoY2MuYXNzaWduLDIpOnRoaXMuZmluaXNoT3AoMTI0PT09ZT9jYy5iaXR3aXNlT1I6Y2MuYml0d2lzZUFORCwxKX0sX2gucmVhZFRva2VuX2NhcmV0PWZ1bmN0aW9uKCl7cmV0dXJuIDYxPT09dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKzEpP3RoaXMuZmluaXNoT3AoY2MuYXNzaWduLDIpOnRoaXMuZmluaXNoT3AoY2MuYml0d2lzZVhPUiwxKX0sX2gucmVhZFRva2VuX3BsdXNfbWluPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcysxKTtyZXR1cm4gdD09PWU/NDUhPT10fHx0aGlzLmluTW9kdWxlfHw2MiE9PXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcysyKXx8MCE9PXRoaXMubGFzdFRva0VuZCYmIWhjLnRlc3QodGhpcy5pbnB1dC5zbGljZSh0aGlzLmxhc3RUb2tFbmQsdGhpcy5wb3MpKT90aGlzLmZpbmlzaE9wKGNjLmluY0RlYywyKToodGhpcy5za2lwTGluZUNvbW1lbnQoMyksdGhpcy5za2lwU3BhY2UoKSx0aGlzLm5leHRUb2tlbigpKTo2MT09PXQ/dGhpcy5maW5pc2hPcChjYy5hc3NpZ24sMik6dGhpcy5maW5pc2hPcChjYy5wbHVzTWluLDEpfSxfaC5yZWFkVG9rZW5fbHRfZ3Q9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKzEpLHM9MTtyZXR1cm4gdD09PWU/KHM9NjI9PT1lJiY2Mj09PXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcysyKT8zOjIsNjE9PT10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3Mrcyk/dGhpcy5maW5pc2hPcChjYy5hc3NpZ24scysxKTp0aGlzLmZpbmlzaE9wKGNjLmJpdFNoaWZ0LHMpKTozMyE9PXR8fDYwIT09ZXx8dGhpcy5pbk1vZHVsZXx8NDUhPT10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MrMil8fDQ1IT09dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKzMpPyg2MT09PXQmJihzPTIpLHRoaXMuZmluaXNoT3AoY2MucmVsYXRpb25hbCxzKSk6KHRoaXMuc2tpcExpbmVDb21tZW50KDQpLHRoaXMuc2tpcFNwYWNlKCksdGhpcy5uZXh0VG9rZW4oKSl9LF9oLnJlYWRUb2tlbl9lcV9leGNsPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcysxKTtyZXR1cm4gNjE9PT10P3RoaXMuZmluaXNoT3AoY2MuZXF1YWxpdHksNjE9PT10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MrMik/MzoyKTo2MT09PWUmJjYyPT09dCYmdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj02Pyh0aGlzLnBvcys9Mix0aGlzLmZpbmlzaFRva2VuKGNjLmFycm93KSk6dGhpcy5maW5pc2hPcCg2MT09PWU/Y2MuZXE6Y2MucHJlZml4LDEpfSxfaC5yZWFkVG9rZW5fcXVlc3Rpb249ZnVuY3Rpb24oKXt2YXIgZT10aGlzLm9wdGlvbnMuZWNtYVZlcnNpb247aWYoZT49MTEpe3ZhciB0PXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcysxKTtpZig0Nj09PXQpe3ZhciBzPXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcysyKTtpZihzPDQ4fHxzPjU3KXJldHVybiB0aGlzLmZpbmlzaE9wKGNjLnF1ZXN0aW9uRG90LDIpfWlmKDYzPT09dCl7aWYoZT49MTIpaWYoNjE9PT10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MrMikpcmV0dXJuIHRoaXMuZmluaXNoT3AoY2MuYXNzaWduLDMpO3JldHVybiB0aGlzLmZpbmlzaE9wKGNjLmNvYWxlc2NlLDIpfX1yZXR1cm4gdGhpcy5maW5pc2hPcChjYy5xdWVzdGlvbiwxKX0sX2gucmVhZFRva2VuX251bWJlclNpZ249ZnVuY3Rpb24oKXt2YXIgZT0zNTtpZih0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTEzJiYoKyt0aGlzLnBvcyx0YyhlPXRoaXMuZnVsbENoYXJDb2RlQXRQb3MoKSwhMCl8fDkyPT09ZSkpcmV0dXJuIHRoaXMuZmluaXNoVG9rZW4oY2MucHJpdmF0ZUlkLHRoaXMucmVhZFdvcmQxKCkpO3RoaXMucmFpc2UodGhpcy5wb3MsIlVuZXhwZWN0ZWQgY2hhcmFjdGVyICciK1NjKGUpKyInIik7fSxfaC5nZXRUb2tlbkZyb21Db2RlPWZ1bmN0aW9uKGUpe3N3aXRjaChlKXtjYXNlIDQ2OnJldHVybiB0aGlzLnJlYWRUb2tlbl9kb3QoKTtjYXNlIDQwOnJldHVybiArK3RoaXMucG9zLHRoaXMuZmluaXNoVG9rZW4oY2MucGFyZW5MKTtjYXNlIDQxOnJldHVybiArK3RoaXMucG9zLHRoaXMuZmluaXNoVG9rZW4oY2MucGFyZW5SKTtjYXNlIDU5OnJldHVybiArK3RoaXMucG9zLHRoaXMuZmluaXNoVG9rZW4oY2Muc2VtaSk7Y2FzZSA0NDpyZXR1cm4gKyt0aGlzLnBvcyx0aGlzLmZpbmlzaFRva2VuKGNjLmNvbW1hKTtjYXNlIDkxOnJldHVybiArK3RoaXMucG9zLHRoaXMuZmluaXNoVG9rZW4oY2MuYnJhY2tldEwpO2Nhc2UgOTM6cmV0dXJuICsrdGhpcy5wb3MsdGhpcy5maW5pc2hUb2tlbihjYy5icmFja2V0Uik7Y2FzZSAxMjM6cmV0dXJuICsrdGhpcy5wb3MsdGhpcy5maW5pc2hUb2tlbihjYy5icmFjZUwpO2Nhc2UgMTI1OnJldHVybiArK3RoaXMucG9zLHRoaXMuZmluaXNoVG9rZW4oY2MuYnJhY2VSKTtjYXNlIDU4OnJldHVybiArK3RoaXMucG9zLHRoaXMuZmluaXNoVG9rZW4oY2MuY29sb24pO2Nhc2UgOTY6aWYodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPDYpYnJlYWs7cmV0dXJuICsrdGhpcy5wb3MsdGhpcy5maW5pc2hUb2tlbihjYy5iYWNrUXVvdGUpO2Nhc2UgNDg6dmFyIHQ9dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKzEpO2lmKDEyMD09PXR8fDg4PT09dClyZXR1cm4gdGhpcy5yZWFkUmFkaXhOdW1iZXIoMTYpO2lmKHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49Nil7aWYoMTExPT09dHx8Nzk9PT10KXJldHVybiB0aGlzLnJlYWRSYWRpeE51bWJlcig4KTtpZig5OD09PXR8fDY2PT09dClyZXR1cm4gdGhpcy5yZWFkUmFkaXhOdW1iZXIoMil9Y2FzZSA0OTpjYXNlIDUwOmNhc2UgNTE6Y2FzZSA1MjpjYXNlIDUzOmNhc2UgNTQ6Y2FzZSA1NTpjYXNlIDU2OmNhc2UgNTc6cmV0dXJuIHRoaXMucmVhZE51bWJlcighMSk7Y2FzZSAzNDpjYXNlIDM5OnJldHVybiB0aGlzLnJlYWRTdHJpbmcoZSk7Y2FzZSA0NzpyZXR1cm4gdGhpcy5yZWFkVG9rZW5fc2xhc2goKTtjYXNlIDM3OmNhc2UgNDI6cmV0dXJuIHRoaXMucmVhZFRva2VuX211bHRfbW9kdWxvX2V4cChlKTtjYXNlIDEyNDpjYXNlIDM4OnJldHVybiB0aGlzLnJlYWRUb2tlbl9waXBlX2FtcChlKTtjYXNlIDk0OnJldHVybiB0aGlzLnJlYWRUb2tlbl9jYXJldCgpO2Nhc2UgNDM6Y2FzZSA0NTpyZXR1cm4gdGhpcy5yZWFkVG9rZW5fcGx1c19taW4oZSk7Y2FzZSA2MDpjYXNlIDYyOnJldHVybiB0aGlzLnJlYWRUb2tlbl9sdF9ndChlKTtjYXNlIDYxOmNhc2UgMzM6cmV0dXJuIHRoaXMucmVhZFRva2VuX2VxX2V4Y2woZSk7Y2FzZSA2MzpyZXR1cm4gdGhpcy5yZWFkVG9rZW5fcXVlc3Rpb24oKTtjYXNlIDEyNjpyZXR1cm4gdGhpcy5maW5pc2hPcChjYy5wcmVmaXgsMSk7Y2FzZSAzNTpyZXR1cm4gdGhpcy5yZWFkVG9rZW5fbnVtYmVyU2lnbigpfXRoaXMucmFpc2UodGhpcy5wb3MsIlVuZXhwZWN0ZWQgY2hhcmFjdGVyICciK1NjKGUpKyInIik7fSxfaC5maW5pc2hPcD1mdW5jdGlvbihlLHQpe3ZhciBzPXRoaXMuaW5wdXQuc2xpY2UodGhpcy5wb3MsdGhpcy5wb3MrdCk7cmV0dXJuIHRoaXMucG9zKz10LHRoaXMuZmluaXNoVG9rZW4oZSxzKX0sX2gucmVhZFJlZ2V4cD1mdW5jdGlvbigpe2Zvcih2YXIgZSx0LHM9dGhpcy5wb3M7Oyl7dGhpcy5wb3M+PXRoaXMuaW5wdXQubGVuZ3RoJiZ0aGlzLnJhaXNlKHMsIlVudGVybWluYXRlZCByZWd1bGFyIGV4cHJlc3Npb24iKTt2YXIgaT10aGlzLmlucHV0LmNoYXJBdCh0aGlzLnBvcyk7aWYoaGMudGVzdChpKSYmdGhpcy5yYWlzZShzLCJVbnRlcm1pbmF0ZWQgcmVndWxhciBleHByZXNzaW9uIiksZSllPSExO2Vsc2Uge2lmKCJbIj09PWkpdD0hMDtlbHNlIGlmKCJdIj09PWkmJnQpdD0hMTtlbHNlIGlmKCIvIj09PWkmJiF0KWJyZWFrO2U9IlxcIj09PWk7fSsrdGhpcy5wb3M7fXZhciBuPXRoaXMuaW5wdXQuc2xpY2Uocyx0aGlzLnBvcyk7Kyt0aGlzLnBvczt2YXIgcj10aGlzLnBvcyxvPXRoaXMucmVhZFdvcmQxKCk7dGhpcy5jb250YWluc0VzYyYmdGhpcy51bmV4cGVjdGVkKHIpO3ZhciBhPXRoaXMucmVnZXhwU3RhdGV8fCh0aGlzLnJlZ2V4cFN0YXRlPW5ldyB2aCh0aGlzKSk7YS5yZXNldChzLG4sbyksdGhpcy52YWxpZGF0ZVJlZ0V4cEZsYWdzKGEpLHRoaXMudmFsaWRhdGVSZWdFeHBQYXR0ZXJuKGEpO3ZhciBsPW51bGw7dHJ5e2w9bmV3IFJlZ0V4cChuLG8pO31jYXRjaChlKXt9cmV0dXJuIHRoaXMuZmluaXNoVG9rZW4oY2MucmVnZXhwLHtwYXR0ZXJuOm4sZmxhZ3M6byx2YWx1ZTpsfSl9LF9oLnJlYWRJbnQ9ZnVuY3Rpb24oZSx0LHMpe2Zvcih2YXIgaT10aGlzLm9wdGlvbnMuZWNtYVZlcnNpb24+PTEyJiZ2b2lkIDA9PT10LG49cyYmNDg9PT10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MpLHI9dGhpcy5wb3Msbz0wLGE9MCxsPTAsYz1udWxsPT10PzEvMDp0O2w8YzsrK2wsKyt0aGlzLnBvcyl7dmFyIGg9dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKSx1PXZvaWQgMDtpZihpJiY5NT09PWgpbiYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKHRoaXMucG9zLCJOdW1lcmljIHNlcGFyYXRvciBpcyBub3QgYWxsb3dlZCBpbiBsZWdhY3kgb2N0YWwgbnVtZXJpYyBsaXRlcmFscyIpLDk1PT09YSYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKHRoaXMucG9zLCJOdW1lcmljIHNlcGFyYXRvciBtdXN0IGJlIGV4YWN0bHkgb25lIHVuZGVyc2NvcmUiKSwwPT09bCYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKHRoaXMucG9zLCJOdW1lcmljIHNlcGFyYXRvciBpcyBub3QgYWxsb3dlZCBhdCB0aGUgZmlyc3Qgb2YgZGlnaXRzIiksYT1oO2Vsc2Uge2lmKCh1PWg+PTk3P2gtOTcrMTA6aD49NjU/aC02NSsxMDpoPj00OCYmaDw9NTc/aC00ODoxLzApPj1lKWJyZWFrO2E9aCxvPW8qZSt1O319cmV0dXJuIGkmJjk1PT09YSYmdGhpcy5yYWlzZVJlY292ZXJhYmxlKHRoaXMucG9zLTEsIk51bWVyaWMgc2VwYXJhdG9yIGlzIG5vdCBhbGxvd2VkIGF0IHRoZSBsYXN0IG9mIGRpZ2l0cyIpLHRoaXMucG9zPT09cnx8bnVsbCE9dCYmdGhpcy5wb3MtciE9PXQ/bnVsbDpvfSxfaC5yZWFkUmFkaXhOdW1iZXI9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5wb3M7dGhpcy5wb3MrPTI7dmFyIHM9dGhpcy5yZWFkSW50KGUpO3JldHVybiBudWxsPT1zJiZ0aGlzLnJhaXNlKHRoaXMuc3RhcnQrMiwiRXhwZWN0ZWQgbnVtYmVyIGluIHJhZGl4ICIrZSksdGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj0xMSYmMTEwPT09dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKT8ocz1SaCh0aGlzLmlucHV0LnNsaWNlKHQsdGhpcy5wb3MpKSwrK3RoaXMucG9zKTp0Yyh0aGlzLmZ1bGxDaGFyQ29kZUF0UG9zKCkpJiZ0aGlzLnJhaXNlKHRoaXMucG9zLCJJZGVudGlmaWVyIGRpcmVjdGx5IGFmdGVyIG51bWJlciIpLHRoaXMuZmluaXNoVG9rZW4oY2MubnVtLHMpfSxfaC5yZWFkTnVtYmVyPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMucG9zO2V8fG51bGwhPT10aGlzLnJlYWRJbnQoMTAsdm9pZCAwLCEwKXx8dGhpcy5yYWlzZSh0LCJJbnZhbGlkIG51bWJlciIpO3ZhciBzPXRoaXMucG9zLXQ+PTImJjQ4PT09dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHQpO3MmJnRoaXMuc3RyaWN0JiZ0aGlzLnJhaXNlKHQsIkludmFsaWQgbnVtYmVyIik7dmFyIGk9dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKTtpZighcyYmIWUmJnRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49MTEmJjExMD09PWkpe3ZhciBuPVJoKHRoaXMuaW5wdXQuc2xpY2UodCx0aGlzLnBvcykpO3JldHVybiArK3RoaXMucG9zLHRjKHRoaXMuZnVsbENoYXJDb2RlQXRQb3MoKSkmJnRoaXMucmFpc2UodGhpcy5wb3MsIklkZW50aWZpZXIgZGlyZWN0bHkgYWZ0ZXIgbnVtYmVyIiksdGhpcy5maW5pc2hUb2tlbihjYy5udW0sbil9cyYmL1s4OV0vLnRlc3QodGhpcy5pbnB1dC5zbGljZSh0LHRoaXMucG9zKSkmJihzPSExKSw0NiE9PWl8fHN8fCgrK3RoaXMucG9zLHRoaXMucmVhZEludCgxMCksaT10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MpKSw2OSE9PWkmJjEwMSE9PWl8fHN8fCg0MyE9PShpPXRoaXMuaW5wdXQuY2hhckNvZGVBdCgrK3RoaXMucG9zKSkmJjQ1IT09aXx8Kyt0aGlzLnBvcyxudWxsPT09dGhpcy5yZWFkSW50KDEwKSYmdGhpcy5yYWlzZSh0LCJJbnZhbGlkIG51bWJlciIpKSx0Yyh0aGlzLmZ1bGxDaGFyQ29kZUF0UG9zKCkpJiZ0aGlzLnJhaXNlKHRoaXMucG9zLCJJZGVudGlmaWVyIGRpcmVjdGx5IGFmdGVyIG51bWJlciIpO3ZhciByLG89KHI9dGhpcy5pbnB1dC5zbGljZSh0LHRoaXMucG9zKSxzP3BhcnNlSW50KHIsOCk6cGFyc2VGbG9hdChyLnJlcGxhY2UoL18vZywiIikpKTtyZXR1cm4gdGhpcy5maW5pc2hUb2tlbihjYy5udW0sbyl9LF9oLnJlYWRDb2RlUG9pbnQ9ZnVuY3Rpb24oKXt2YXIgZTtpZigxMjM9PT10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MpKXt0aGlzLm9wdGlvbnMuZWNtYVZlcnNpb248NiYmdGhpcy51bmV4cGVjdGVkKCk7dmFyIHQ9Kyt0aGlzLnBvcztlPXRoaXMucmVhZEhleENoYXIodGhpcy5pbnB1dC5pbmRleE9mKCJ9Iix0aGlzLnBvcyktdGhpcy5wb3MpLCsrdGhpcy5wb3MsZT4xMTE0MTExJiZ0aGlzLmludmFsaWRTdHJpbmdUb2tlbih0LCJDb2RlIHBvaW50IG91dCBvZiBib3VuZHMiKTt9ZWxzZSBlPXRoaXMucmVhZEhleENoYXIoNCk7cmV0dXJuIGV9LF9oLnJlYWRTdHJpbmc9ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PSIiLHM9Kyt0aGlzLnBvczs7KXt0aGlzLnBvcz49dGhpcy5pbnB1dC5sZW5ndGgmJnRoaXMucmFpc2UodGhpcy5zdGFydCwiVW50ZXJtaW5hdGVkIHN0cmluZyBjb25zdGFudCIpO3ZhciBpPXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcyk7aWYoaT09PWUpYnJlYWs7OTI9PT1pPyh0Kz10aGlzLmlucHV0LnNsaWNlKHMsdGhpcy5wb3MpLHQrPXRoaXMucmVhZEVzY2FwZWRDaGFyKCExKSxzPXRoaXMucG9zKTo4MjMyPT09aXx8ODIzMz09PWk/KHRoaXMub3B0aW9ucy5lY21hVmVyc2lvbjwxMCYmdGhpcy5yYWlzZSh0aGlzLnN0YXJ0LCJVbnRlcm1pbmF0ZWQgc3RyaW5nIGNvbnN0YW50IiksKyt0aGlzLnBvcyx0aGlzLm9wdGlvbnMubG9jYXRpb25zJiYodGhpcy5jdXJMaW5lKyssdGhpcy5saW5lU3RhcnQ9dGhpcy5wb3MpKTooZGMoaSkmJnRoaXMucmFpc2UodGhpcy5zdGFydCwiVW50ZXJtaW5hdGVkIHN0cmluZyBjb25zdGFudCIpLCsrdGhpcy5wb3MpO31yZXR1cm4gdCs9dGhpcy5pbnB1dC5zbGljZShzLHRoaXMucG9zKyspLHRoaXMuZmluaXNoVG9rZW4oY2Muc3RyaW5nLHQpfTt2YXIgTWg9e307X2gudHJ5UmVhZFRlbXBsYXRlVG9rZW49ZnVuY3Rpb24oKXt0aGlzLmluVGVtcGxhdGVFbGVtZW50PSEwO3RyeXt0aGlzLnJlYWRUbXBsVG9rZW4oKTt9Y2F0Y2goZSl7aWYoZSE9PU1oKXRocm93IGU7dGhpcy5yZWFkSW52YWxpZFRlbXBsYXRlVG9rZW4oKTt9dGhpcy5pblRlbXBsYXRlRWxlbWVudD0hMTt9LF9oLmludmFsaWRTdHJpbmdUb2tlbj1mdW5jdGlvbihlLHQpe2lmKHRoaXMuaW5UZW1wbGF0ZUVsZW1lbnQmJnRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49OSl0aHJvdyBNaDt0aGlzLnJhaXNlKGUsdCk7fSxfaC5yZWFkVG1wbFRva2VuPWZ1bmN0aW9uKCl7Zm9yKHZhciBlPSIiLHQ9dGhpcy5wb3M7Oyl7dGhpcy5wb3M+PXRoaXMuaW5wdXQubGVuZ3RoJiZ0aGlzLnJhaXNlKHRoaXMuc3RhcnQsIlVudGVybWluYXRlZCB0ZW1wbGF0ZSIpO3ZhciBzPXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcyk7aWYoOTY9PT1zfHwzNj09PXMmJjEyMz09PXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcysxKSlyZXR1cm4gdGhpcy5wb3MhPT10aGlzLnN0YXJ0fHx0aGlzLnR5cGUhPT1jYy50ZW1wbGF0ZSYmdGhpcy50eXBlIT09Y2MuaW52YWxpZFRlbXBsYXRlPyhlKz10aGlzLmlucHV0LnNsaWNlKHQsdGhpcy5wb3MpLHRoaXMuZmluaXNoVG9rZW4oY2MudGVtcGxhdGUsZSkpOjM2PT09cz8odGhpcy5wb3MrPTIsdGhpcy5maW5pc2hUb2tlbihjYy5kb2xsYXJCcmFjZUwpKTooKyt0aGlzLnBvcyx0aGlzLmZpbmlzaFRva2VuKGNjLmJhY2tRdW90ZSkpO2lmKDkyPT09cyllKz10aGlzLmlucHV0LnNsaWNlKHQsdGhpcy5wb3MpLGUrPXRoaXMucmVhZEVzY2FwZWRDaGFyKCEwKSx0PXRoaXMucG9zO2Vsc2UgaWYoZGMocykpe3N3aXRjaChlKz10aGlzLmlucHV0LnNsaWNlKHQsdGhpcy5wb3MpLCsrdGhpcy5wb3Mscyl7Y2FzZSAxMzoxMD09PXRoaXMuaW5wdXQuY2hhckNvZGVBdCh0aGlzLnBvcykmJisrdGhpcy5wb3M7Y2FzZSAxMDplKz0iXG4iO2JyZWFrO2RlZmF1bHQ6ZSs9U3RyaW5nLmZyb21DaGFyQ29kZShzKTt9dGhpcy5vcHRpb25zLmxvY2F0aW9ucyYmKCsrdGhpcy5jdXJMaW5lLHRoaXMubGluZVN0YXJ0PXRoaXMucG9zKSx0PXRoaXMucG9zO31lbHNlICsrdGhpcy5wb3M7fX0sX2gucmVhZEludmFsaWRUZW1wbGF0ZVRva2VuPWZ1bmN0aW9uKCl7Zm9yKDt0aGlzLnBvczx0aGlzLmlucHV0Lmxlbmd0aDt0aGlzLnBvcysrKXN3aXRjaCh0aGlzLmlucHV0W3RoaXMucG9zXSl7Y2FzZSJcXCI6Kyt0aGlzLnBvczticmVhaztjYXNlIiQiOmlmKCJ7IiE9PXRoaXMuaW5wdXRbdGhpcy5wb3MrMV0pYnJlYWs7Y2FzZSJgIjpyZXR1cm4gdGhpcy5maW5pc2hUb2tlbihjYy5pbnZhbGlkVGVtcGxhdGUsdGhpcy5pbnB1dC5zbGljZSh0aGlzLnN0YXJ0LHRoaXMucG9zKSl9dGhpcy5yYWlzZSh0aGlzLnN0YXJ0LCJVbnRlcm1pbmF0ZWQgdGVtcGxhdGUiKTt9LF9oLnJlYWRFc2NhcGVkQ2hhcj1mdW5jdGlvbihlKXt2YXIgdD10aGlzLmlucHV0LmNoYXJDb2RlQXQoKyt0aGlzLnBvcyk7c3dpdGNoKCsrdGhpcy5wb3MsdCl7Y2FzZSAxMTA6cmV0dXJuICJcbiI7Y2FzZSAxMTQ6cmV0dXJuICJcciI7Y2FzZSAxMjA6cmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUodGhpcy5yZWFkSGV4Q2hhcigyKSk7Y2FzZSAxMTc6cmV0dXJuIFNjKHRoaXMucmVhZENvZGVQb2ludCgpKTtjYXNlIDExNjpyZXR1cm4gIlx0IjtjYXNlIDk4OnJldHVybiAiXGIiO2Nhc2UgMTE4OnJldHVybiAiXHYiO2Nhc2UgMTAyOnJldHVybiAiXGYiO2Nhc2UgMTM6MTA9PT10aGlzLmlucHV0LmNoYXJDb2RlQXQodGhpcy5wb3MpJiYrK3RoaXMucG9zO2Nhc2UgMTA6cmV0dXJuIHRoaXMub3B0aW9ucy5sb2NhdGlvbnMmJih0aGlzLmxpbmVTdGFydD10aGlzLnBvcywrK3RoaXMuY3VyTGluZSksIiI7Y2FzZSA1NjpjYXNlIDU3OmlmKHRoaXMuc3RyaWN0JiZ0aGlzLmludmFsaWRTdHJpbmdUb2tlbih0aGlzLnBvcy0xLCJJbnZhbGlkIGVzY2FwZSBzZXF1ZW5jZSIpLGUpe3ZhciBzPXRoaXMucG9zLTE7dGhpcy5pbnZhbGlkU3RyaW5nVG9rZW4ocywiSW52YWxpZCBlc2NhcGUgc2VxdWVuY2UgaW4gdGVtcGxhdGUgc3RyaW5nIik7fWRlZmF1bHQ6aWYodD49NDgmJnQ8PTU1KXt2YXIgaT10aGlzLmlucHV0LnN1YnN0cih0aGlzLnBvcy0xLDMpLm1hdGNoKC9eWzAtN10rLylbMF0sbj1wYXJzZUludChpLDgpO3JldHVybiBuPjI1NSYmKGk9aS5zbGljZSgwLC0xKSxuPXBhcnNlSW50KGksOCkpLHRoaXMucG9zKz1pLmxlbmd0aC0xLHQ9dGhpcy5pbnB1dC5jaGFyQ29kZUF0KHRoaXMucG9zKSwiMCI9PT1pJiY1NiE9PXQmJjU3IT09dHx8IXRoaXMuc3RyaWN0JiYhZXx8dGhpcy5pbnZhbGlkU3RyaW5nVG9rZW4odGhpcy5wb3MtMS1pLmxlbmd0aCxlPyJPY3RhbCBsaXRlcmFsIGluIHRlbXBsYXRlIHN0cmluZyI6Ik9jdGFsIGxpdGVyYWwgaW4gc3RyaWN0IG1vZGUiKSxTdHJpbmcuZnJvbUNoYXJDb2RlKG4pfXJldHVybiBkYyh0KT8iIjpTdHJpbmcuZnJvbUNoYXJDb2RlKHQpfX0sX2gucmVhZEhleENoYXI9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5wb3Mscz10aGlzLnJlYWRJbnQoMTYsZSk7cmV0dXJuIG51bGw9PT1zJiZ0aGlzLmludmFsaWRTdHJpbmdUb2tlbih0LCJCYWQgY2hhcmFjdGVyIGVzY2FwZSBzZXF1ZW5jZSIpLHN9LF9oLnJlYWRXb3JkMT1mdW5jdGlvbigpe3RoaXMuY29udGFpbnNFc2M9ITE7Zm9yKHZhciBlPSIiLHQ9ITAscz10aGlzLnBvcyxpPXRoaXMub3B0aW9ucy5lY21hVmVyc2lvbj49Njt0aGlzLnBvczx0aGlzLmlucHV0Lmxlbmd0aDspe3ZhciBuPXRoaXMuZnVsbENoYXJDb2RlQXRQb3MoKTtpZihzYyhuLGkpKXRoaXMucG9zKz1uPD02NTUzNT8xOjI7ZWxzZSB7aWYoOTIhPT1uKWJyZWFrO3RoaXMuY29udGFpbnNFc2M9ITAsZSs9dGhpcy5pbnB1dC5zbGljZShzLHRoaXMucG9zKTt2YXIgcj10aGlzLnBvczsxMTchPT10aGlzLmlucHV0LmNoYXJDb2RlQXQoKyt0aGlzLnBvcykmJnRoaXMuaW52YWxpZFN0cmluZ1Rva2VuKHRoaXMucG9zLCJFeHBlY3RpbmcgVW5pY29kZSBlc2NhcGUgc2VxdWVuY2UgXFx1WFhYWCIpLCsrdGhpcy5wb3M7dmFyIG89dGhpcy5yZWFkQ29kZVBvaW50KCk7KHQ/dGM6c2MpKG8saSl8fHRoaXMuaW52YWxpZFN0cmluZ1Rva2VuKHIsIkludmFsaWQgVW5pY29kZSBlc2NhcGUiKSxlKz1TYyhvKSxzPXRoaXMucG9zO310PSExO31yZXR1cm4gZSt0aGlzLmlucHV0LnNsaWNlKHMsdGhpcy5wb3MpfSxfaC5yZWFkV29yZD1mdW5jdGlvbigpe3ZhciBlPXRoaXMucmVhZFdvcmQxKCksdD1jYy5uYW1lO3JldHVybiB0aGlzLmtleXdvcmRzLnRlc3QoZSkmJih0PWFjW2VdKSx0aGlzLmZpbmlzaFRva2VuKHQsZSl9O3ZhciBPaD0iOC4xMC4wIjtSYy5hY29ybj17UGFyc2VyOlJjLHZlcnNpb246T2gsZGVmYXVsdE9wdGlvbnM6UGMsUG9zaXRpb246a2MsU291cmNlTG9jYXRpb246SWMsZ2V0TGluZUluZm86d2MsTm9kZTp0aCxUb2tlblR5cGU6aWMsdG9rVHlwZXM6Y2Msa2V5d29yZFR5cGVzOmFjLFRva0NvbnRleHQ6cWMsdG9rQ29udGV4dHM6SGMsaXNJZGVudGlmaWVyQ2hhcjpzYyxpc0lkZW50aWZpZXJTdGFydDp0YyxUb2tlbjpOaCxpc05ld0xpbmU6ZGMsbGluZUJyZWFrOmhjLGxpbmVCcmVha0c6dWMsbm9uQVNDSUl3aGl0ZXNwYWNlOmZjfTt2YXIgRGg9T2JqZWN0LmZyZWV6ZSh7X19wcm90b19fOm51bGwsTm9kZTp0aCxQYXJzZXI6UmMsUG9zaXRpb246a2MsU291cmNlTG9jYXRpb246SWMsVG9rQ29udGV4dDpxYyxUb2tlbjpOaCxUb2tlblR5cGU6aWMsZGVmYXVsdE9wdGlvbnM6UGMsZ2V0TGluZUluZm86d2MsaXNJZGVudGlmaWVyQ2hhcjpzYyxpc0lkZW50aWZpZXJTdGFydDp0Yyxpc05ld0xpbmU6ZGMsa2V5d29yZFR5cGVzOmFjLGxpbmVCcmVhazpoYyxsaW5lQnJlYWtHOnVjLG5vbkFTQ0lJd2hpdGVzcGFjZTpmYyxwYXJzZTpmdW5jdGlvbihlLHQpe3JldHVybiBSYy5wYXJzZShlLHQpfSxwYXJzZUV4cHJlc3Npb25BdDpmdW5jdGlvbihlLHQscyl7cmV0dXJuIFJjLnBhcnNlRXhwcmVzc2lvbkF0KGUsdCxzKX0sdG9rQ29udGV4dHM6SGMsdG9rVHlwZXM6Y2MsdG9rZW5pemVyOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIFJjLnRva2VuaXplcihlLHQpfSx2ZXJzaW9uOk9ofSk7Y29uc3QgTGg9ZT0+KCk9PlllKGZ1bmN0aW9uKGUpe3JldHVybiB7Y29kZToiTk9fRlNfSU5fQlJPV1NFUiIsbWVzc2FnZTpgQ2Fubm90IGFjY2VzcyB0aGUgZmlsZSBzeXN0ZW0gKHZpYSAiJHtlfSIpIHdoZW4gdXNpbmcgdGhlIGJyb3dzZXIgYnVpbGQgb2YgUm9sbHVwLiBNYWtlIHN1cmUgeW91IHN1cHBseSBhIHBsdWdpbiB3aXRoIGN1c3RvbSByZXNvbHZlSWQgYW5kIGxvYWQgaG9va3MgdG8gUm9sbHVwLmAsdXJsOk1lKCJwbHVnaW4tZGV2ZWxvcG1lbnQvI2Etc2ltcGxlLWV4YW1wbGUiKX19KGUpKSxUaD1MaCgiZnMubWtkaXIiKSxWaD1MaCgiZnMucmVhZEZpbGUiKSxCaD1MaCgiZnMud3JpdGVGaWxlIik7YXN5bmMgZnVuY3Rpb24gemgoZSx0LHMsaSxuLHIsbyxhLGwpe2NvbnN0IGM9YXdhaXQgZnVuY3Rpb24oZSx0LHMsaSxuLHIsbyxhKXtsZXQgbD1udWxsLGM9bnVsbDtpZihuKXtsPW5ldyBTZXQ7Zm9yKGNvbnN0IHMgb2YgbillPT09cy5zb3VyY2UmJnQ9PT1zLmltcG9ydGVyJiZsLmFkZChzLnBsdWdpbik7Yz0oZSx0KT0+KHsuLi5lLHJlc29sdmU6KGUscyx7YXNzZXJ0aW9uczpyLGN1c3RvbTpvLGlzRW50cnk6YSxza2lwU2VsZjpsfT1wZSk9PmkoZSxzLG8sYSxyfHxmZSxsP1suLi5uLHtpbXBvcnRlcjpzLHBsdWdpbjp0LHNvdXJjZTplfV06bil9KTt9cmV0dXJuIHMuaG9va0ZpcnN0QW5kR2V0UGx1Z2luKCJyZXNvbHZlSWQiLFtlLHQse2Fzc2VydGlvbnM6YSxjdXN0b206cixpc0VudHJ5Om99XSxjLGwpfShlLHQsaSxuLHIsbyxhLGwpO3JldHVybiBudWxsPT1jP0xoKCJwYXRoLnJlc29sdmUiKSgpOmNbMF19Y29uc3QgRmg9ImF0IHBvc2l0aW9uICIsamg9ImF0IG91dHB1dCBwb3NpdGlvbiAiO2NvbnN0IFVoPXtkZWxldGU6KCk9PiExLGdldCgpe30saGFzOigpPT4hMSxzZXQoKXt9fTtmdW5jdGlvbiBHaChlKXtyZXR1cm4gZS5zdGFydHNXaXRoKEZoKXx8ZS5zdGFydHNXaXRoKGpoKT9ZZSh7Y29kZTpKZSxtZXNzYWdlOiJBIHBsdWdpbiBpcyB0cnlpbmcgdG8gdXNlIHRoZSBSb2xsdXAgY2FjaGUgYnV0IGlzIG5vdCBkZWNsYXJpbmcgYSBwbHVnaW4gbmFtZSBvciBjYWNoZUtleS4ifSk6WWUoe2NvZGU6cnQsbWVzc2FnZTpgVGhlIHBsdWdpbiBuYW1lICR7ZX0gaXMgYmVpbmcgdXNlZCB0d2ljZSBpbiB0aGUgc2FtZSBidWlsZC4gUGx1Z2luIG5hbWVzIG11c3QgYmUgZGlzdGluY3Qgb3IgcHJvdmlkZSBhIGNhY2hlS2V5IChwbGVhc2UgcG9zdCBhbiBpc3N1ZSB0byB0aGUgcGx1Z2luIGlmIHlvdSBhcmUgYSBwbHVnaW4gdXNlcikuYH0pfWNvbnN0IFdoPShlLHQscz1YaCk9Pntjb25zdHtvbndhcm46aSxvbkxvZzpufT1lLHI9cWgocyxpKTtpZihuKXtjb25zdCBlPWtlW3RdO3JldHVybiAodCxzKT0+bih0LEhoKHMpLCgodCxzKT0+e2lmKCJlcnJvciI9PT10KXJldHVybiBZZShLaChzKSk7a2VbdF0+PWUmJnIodCxLaChzKSk7fSkpfXJldHVybiByfSxxaD0oZSx0KT0+dD8ocyxpKT0+e3M9PT12ZT90KEhoKGkpLCh0PT5lKHZlLEtoKHQpKSkpOmUocyxpKTt9OmUsSGg9ZT0+KE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJ0b1N0cmluZyIse3ZhbHVlOigpPT5ZaChlKSx3cml0YWJsZTohMH0pLGUpLEtoPWU9PiJzdHJpbmciPT10eXBlb2YgZT97bWVzc2FnZTplfToiZnVuY3Rpb24iPT10eXBlb2YgZT9LaChlKCkpOmUsWWg9ZT0+e2xldCB0PSIiO3JldHVybiBlLnBsdWdpbiYmKHQrPWAoJHtlLnBsdWdpbn0gcGx1Z2luKSBgKSxlLmxvYyYmKHQrPWAke0woZS5sb2MuZmlsZSl9ICgke2UubG9jLmxpbmV9OiR7ZS5sb2MuY29sdW1ufSkgYCksdCtlLm1lc3NhZ2V9LFhoPShlLHQpPT57Y29uc3Qgcz1ZaCh0KTtzd2l0Y2goZSl7Y2FzZSB2ZTpyZXR1cm4gY29uc29sZS53YXJuKHMpO2Nhc2UgQWU6cmV0dXJuIGNvbnNvbGUuZGVidWcocyk7ZGVmYXVsdDpyZXR1cm4gY29uc29sZS5pbmZvKHMpfX07ZnVuY3Rpb24gUWgoZSx0LHMsaSxuPS8kLi8pe2NvbnN0IHI9bmV3IFNldCh0KSxvPU9iamVjdC5rZXlzKGUpLmZpbHRlcigoZT0+IShyLmhhcyhlKXx8bi50ZXN0KGUpKSkpO28ubGVuZ3RoPjAmJmkodmUsZnVuY3Rpb24oZSx0LHMpe3JldHVybiB7Y29kZTpQdCxtZXNzYWdlOmBVbmtub3duICR7ZX06ICR7dC5qb2luKCIsICIpfS4gQWxsb3dlZCBvcHRpb25zOiAke3Muam9pbigiLCAiKX1gfX0ocyxvLFsuLi5yXS5zb3J0KCkpKTt9Y29uc3QgWmg9e3JlY29tbWVuZGVkOnthbm5vdGF0aW9uczohMCxjb3JyZWN0VmFyVmFsdWVCZWZvcmVEZWNsYXJhdGlvbjohMSxtYW51YWxQdXJlRnVuY3Rpb25zOm1lLG1vZHVsZVNpZGVFZmZlY3RzOigpPT4hMCxwcm9wZXJ0eVJlYWRTaWRlRWZmZWN0czohMCx0cnlDYXRjaERlb3B0aW1pemF0aW9uOiEwLHVua25vd25HbG9iYWxTaWRlRWZmZWN0czohMX0sc2FmZXN0Onthbm5vdGF0aW9uczohMCxjb3JyZWN0VmFyVmFsdWVCZWZvcmVEZWNsYXJhdGlvbjohMCxtYW51YWxQdXJlRnVuY3Rpb25zOm1lLG1vZHVsZVNpZGVFZmZlY3RzOigpPT4hMCxwcm9wZXJ0eVJlYWRTaWRlRWZmZWN0czohMCx0cnlDYXRjaERlb3B0aW1pemF0aW9uOiEwLHVua25vd25HbG9iYWxTaWRlRWZmZWN0czohMH0sc21hbGxlc3Q6e2Fubm90YXRpb25zOiEwLGNvcnJlY3RWYXJWYWx1ZUJlZm9yZURlY2xhcmF0aW9uOiExLG1hbnVhbFB1cmVGdW5jdGlvbnM6bWUsbW9kdWxlU2lkZUVmZmVjdHM6KCk9PiExLHByb3BlcnR5UmVhZFNpZGVFZmZlY3RzOiExLHRyeUNhdGNoRGVvcHRpbWl6YXRpb246ITEsdW5rbm93bkdsb2JhbFNpZGVFZmZlY3RzOiExfX0sSmg9e2VzMjAxNTp7YXJyb3dGdW5jdGlvbnM6ITAsY29uc3RCaW5kaW5nczohMCxvYmplY3RTaG9ydGhhbmQ6ITAscmVzZXJ2ZWROYW1lc0FzUHJvcHM6ITAsc3ltYm9sczohMH0sZXM1OnthcnJvd0Z1bmN0aW9uczohMSxjb25zdEJpbmRpbmdzOiExLG9iamVjdFNob3J0aGFuZDohMSxyZXNlcnZlZE5hbWVzQXNQcm9wczohMCxzeW1ib2xzOiExfX0sZXU9KGUsdCxzLGksbik9Pntjb25zdCByPWU/LnByZXNldDtpZihyKXtjb25zdCBuPXRbcl07aWYobilyZXR1cm4gey4uLm4sLi4uZX07WWUoenQoYCR7c30ucHJlc2V0YCxpLGB2YWxpZCB2YWx1ZXMgYXJlICR7UmUoT2JqZWN0LmtleXModCkpfWAscikpO31yZXR1cm4gKChlLHQscyxpKT0+bj0+e2lmKCJzdHJpbmciPT10eXBlb2Ygbil7Y29uc3Qgcj1lW25dO2lmKHIpcmV0dXJuIHI7WWUoenQodCxzLGB2YWxpZCB2YWx1ZXMgYXJlICR7aX0ke1JlKE9iamVjdC5rZXlzKGUpKX0uIFlvdSBjYW4gYWxzbyBzdXBwbHkgYW4gb2JqZWN0IGZvciBtb3JlIGZpbmUtZ3JhaW5lZCBjb250cm9sYCxuKSk7fXJldHVybiAoZT0+ZSYmIm9iamVjdCI9PXR5cGVvZiBlP2U6e30pKG4pfSkodCxzLGksbikoZSl9LHR1PWFzeW5jIGU9Pihhd2FpdCBhc3luYyBmdW5jdGlvbihlKXtkb3tlPShhd2FpdCBQcm9taXNlLmFsbChlKSkuZmxhdCgxLzApO313aGlsZShlLnNvbWUoKGU9PmU/LnRoZW4pKSk7cmV0dXJuIGV9KFtlXSkpLmZpbHRlcihCb29sZWFuKTthc3luYyBmdW5jdGlvbiBzdShlLHQscyxpKXtjb25zdCBuPXQuaWQscj1bXTtsZXQgbz1udWxsPT09ZS5tYXA/bnVsbDp4byhlLm1hcCk7Y29uc3QgYT1lLmNvZGU7bGV0IGM9ZS5hc3Q7Y29uc3QgaD1bXSx1PVtdO2xldCBkPSExO2NvbnN0IHA9KCk9PmQ9ITA7bGV0IGY9IiIsbT1lLmNvZGU7Y29uc3QgeT1lPT4odCxzKT0+e3Q9S2godCkscyYmWGUodCxzLG0sbiksdC5pZD1uLHQuaG9vaz0idHJhbnNmb3JtIixlKHQpO307bGV0IHg7dHJ5e3g9YXdhaXQgcy5ob29rUmVkdWNlQXJnMCgidHJhbnNmb3JtIixbbSxuXSwoZnVuY3Rpb24oZSxzLG4pe2xldCBvLGE7aWYoInN0cmluZyI9PXR5cGVvZiBzKW89cztlbHNlIHtpZighc3x8Im9iamVjdCIhPXR5cGVvZiBzKXJldHVybiBlO2lmKHQudXBkYXRlT3B0aW9ucyhzKSxudWxsPT1zLmNvZGUpcmV0dXJuIChzLm1hcHx8cy5hc3QpJiZpKHZlLGZ1bmN0aW9uKGUpe3JldHVybiB7Y29kZTpTdCxtZXNzYWdlOmBUaGUgcGx1Z2luICIke2V9IiByZXR1cm5lZCBhICJtYXAiIG9yICJhc3QiIHdpdGhvdXQgcmV0dXJuaW5nIGEgImNvZGUiLiBUaGlzIHdpbGwgYmUgaWdub3JlZC5gfX0obi5uYW1lKSksZTsoe2NvZGU6byxtYXA6YSxhc3Q6Y309cyk7fXJldHVybiBudWxsIT09YSYmci5wdXNoKHhvKCJzdHJpbmciPT10eXBlb2YgYT9KU09OLnBhcnNlKGEpOmEpfHx7bWlzc2luZzohMCxwbHVnaW46bi5uYW1lfSksbT1vLG99KSwoKGUsdCk9PntyZXR1cm4gZj10Lm5hbWUsey4uLmUsYWRkV2F0Y2hGaWxlKHQpe2gucHVzaCh0KSxlLmFkZFdhdGNoRmlsZSh0KTt9LGNhY2hlOmQ/ZS5jYWNoZTooYz1lLmNhY2hlLHg9cCx7ZGVsZXRlOmU9Pih4KCksYy5kZWxldGUoZSkpLGdldDplPT4oeCgpLGMuZ2V0KGUpKSxoYXM6ZT0+KHgoKSxjLmhhcyhlKSksc2V0OihlLHQpPT4oeCgpLGMuc2V0KGUsdCkpfSksZGVidWc6eShlLmRlYnVnKSxlbWl0RmlsZTplPT4odS5wdXNoKGUpLHMuZW1pdEZpbGUoZSkpLGVycm9yOih0LHMpPT4oInN0cmluZyI9PXR5cGVvZiB0JiYodD17bWVzc2FnZTp0fSkscyYmWGUodCxzLG0sbiksdC5pZD1uLHQuaG9vaz0idHJhbnNmb3JtIixlLmVycm9yKHQpKSxnZXRDb21iaW5lZFNvdXJjZW1hcCgpe2NvbnN0IGU9ZnVuY3Rpb24oZSx0LHMsaSxuKXtyZXR1cm4gMD09PWkubGVuZ3RoP3M6eG8oe3ZlcnNpb246MywuLi5lbChlLHQscyxpLEphKG4pKS50cmFjZU1hcHBpbmdzKCl9KX0obixhLG8scixpKTtpZighZSl7cmV0dXJuIG5ldyBnKGEpLmdlbmVyYXRlTWFwKHtoaXJlczohMCxpbmNsdWRlQ29udGVudDohMCxzb3VyY2U6bn0pfXJldHVybiBvIT09ZSYmKG89ZSxyLmxlbmd0aD0wKSxuZXcgbCh7Li4uZSxmaWxlOm51bGwsc291cmNlc0NvbnRlbnQ6ZS5zb3VyY2VzQ29udGVudH0pfSxpbmZvOnkoZS5pbmZvKSxzZXRBc3NldFNvdXJjZSgpe3JldHVybiB0aGlzLmVycm9yKHtjb2RlOmZ0LG1lc3NhZ2U6InNldEFzc2V0U291cmNlIGNhbm5vdCBiZSBjYWxsZWQgaW4gdHJhbnNmb3JtIGZvciBjYWNoaW5nIHJlYXNvbnMuIFVzZSBlbWl0RmlsZSB3aXRoIGEgc291cmNlLCBvciBjYWxsIHNldEFzc2V0U291cmNlIGluIGFub3RoZXIgaG9vay4ifSl9LHdhcm46eShlLndhcm4pfTt2YXIgYyx4O30pKTt9Y2F0Y2goZSl7cmV0dXJuIFllKEd0KGUsZix7aG9vazoidHJhbnNmb3JtIixpZDpufSkpfXJldHVybiAhZCYmdS5sZW5ndGg+MCYmKHQudHJhbnNmb3JtRmlsZXM9dSkse2FzdDpjLGNvZGU6eCxjdXN0b21UcmFuc2Zvcm1DYWNoZTpkLG9yaWdpbmFsQ29kZTphLG9yaWdpbmFsU291cmNlbWFwOm8sc291cmNlbWFwQ2hhaW46cix0cmFuc2Zvcm1EZXBlbmRlbmNpZXM6aH19Y29uc3QgaXU9InJlc29sdmVEZXBlbmRlbmNpZXMiO2NsYXNzIG51e2NvbnN0cnVjdG9yKGUsdCxzLGkpe3RoaXMuZ3JhcGg9ZSx0aGlzLm1vZHVsZXNCeUlkPXQsdGhpcy5vcHRpb25zPXMsdGhpcy5wbHVnaW5Ecml2ZXI9aSx0aGlzLmltcGxpY2l0RW50cnlNb2R1bGVzPW5ldyBTZXQsdGhpcy5pbmRleGVkRW50cnlNb2R1bGVzPVtdLHRoaXMubGF0ZXN0TG9hZE1vZHVsZXNQcm9taXNlPVByb21pc2UucmVzb2x2ZSgpLHRoaXMubW9kdWxlTG9hZFByb21pc2VzPW5ldyBNYXAsdGhpcy5tb2R1bGVzV2l0aExvYWRlZERlcGVuZGVuY2llcz1uZXcgU2V0LHRoaXMubmV4dENodW5rTmFtZVByaW9yaXR5PTAsdGhpcy5uZXh0RW50cnlNb2R1bGVJbmRleD0wLHRoaXMucmVzb2x2ZUlkPWFzeW5jKGUsdCxzLGksbixyPW51bGwpPT50aGlzLmdldFJlc29sdmVkSWRXaXRoRGVmYXVsdHModGhpcy5nZXROb3JtYWxpemVkUmVzb2x2ZWRJZFdpdGhvdXREZWZhdWx0cyghdGhpcy5vcHRpb25zLmV4dGVybmFsKGUsdCwhMSkmJmF3YWl0IHpoKGUsdCx0aGlzLm9wdGlvbnMucHJlc2VydmVTeW1saW5rcyx0aGlzLnBsdWdpbkRyaXZlcix0aGlzLnJlc29sdmVJZCxyLHMsImJvb2xlYW4iPT10eXBlb2YgaT9pOiF0LG4pLHQsZSksbiksdGhpcy5oYXNNb2R1bGVTaWRlRWZmZWN0cz1zLnRyZWVzaGFrZT9zLnRyZWVzaGFrZS5tb2R1bGVTaWRlRWZmZWN0czooKT0+ITA7fWFzeW5jIGFkZEFkZGl0aW9uYWxNb2R1bGVzKGUsdCl7Y29uc3Qgcz10aGlzLmV4dGVuZExvYWRNb2R1bGVzUHJvbWlzZShQcm9taXNlLmFsbChlLm1hcCgoZT0+dGhpcy5sb2FkRW50cnlNb2R1bGUoZSwhMSx2b2lkIDAsbnVsbCx0KSkpKSk7cmV0dXJuIGF3YWl0IHRoaXMuYXdhaXRMb2FkTW9kdWxlc1Byb21pc2UoKSxzfWFzeW5jIGFkZEVudHJ5TW9kdWxlcyhlLHQpe2NvbnN0IHM9dGhpcy5uZXh0RW50cnlNb2R1bGVJbmRleDt0aGlzLm5leHRFbnRyeU1vZHVsZUluZGV4Kz1lLmxlbmd0aDtjb25zdCBpPXRoaXMubmV4dENodW5rTmFtZVByaW9yaXR5O3RoaXMubmV4dENodW5rTmFtZVByaW9yaXR5Kz1lLmxlbmd0aDtjb25zdCBuPWF3YWl0IHRoaXMuZXh0ZW5kTG9hZE1vZHVsZXNQcm9taXNlKFByb21pc2UuYWxsKGUubWFwKCgoe2lkOmUsaW1wb3J0ZXI6dH0pPT50aGlzLmxvYWRFbnRyeU1vZHVsZShlLCEwLHQsbnVsbCkpKSkudGhlbigobj0+e2Zvcihjb25zdFtyLG9db2Ygbi5lbnRyaWVzKCkpe28uaXNVc2VyRGVmaW5lZEVudHJ5UG9pbnQ9by5pc1VzZXJEZWZpbmVkRW50cnlQb2ludHx8dCxvdShvLGVbcl0sdCxpK3IpO2NvbnN0IG49dGhpcy5pbmRleGVkRW50cnlNb2R1bGVzLmZpbmQoKGU9PmUubW9kdWxlPT09bykpO24/bi5pbmRleD1NYXRoLm1pbihuLmluZGV4LHMrcik6dGhpcy5pbmRleGVkRW50cnlNb2R1bGVzLnB1c2goe2luZGV4OnMrcixtb2R1bGU6b30pO31yZXR1cm4gdGhpcy5pbmRleGVkRW50cnlNb2R1bGVzLnNvcnQoKCh7aW5kZXg6ZX0se2luZGV4OnR9KT0+ZT50PzE6LTEpKSxufSkpKTtyZXR1cm4gYXdhaXQgdGhpcy5hd2FpdExvYWRNb2R1bGVzUHJvbWlzZSgpLHtlbnRyeU1vZHVsZXM6dGhpcy5pbmRleGVkRW50cnlNb2R1bGVzLm1hcCgoKHttb2R1bGU6ZX0pPT5lKSksaW1wbGljaXRFbnRyeU1vZHVsZXM6Wy4uLnRoaXMuaW1wbGljaXRFbnRyeU1vZHVsZXNdLG5ld0VudHJ5TW9kdWxlczpufX1hc3luYyBlbWl0Q2h1bmsoe2ZpbGVOYW1lOmUsaWQ6dCxpbXBvcnRlcjpzLG5hbWU6aSxpbXBsaWNpdGx5TG9hZGVkQWZ0ZXJPbmVPZjpuLHByZXNlcnZlU2lnbmF0dXJlOnJ9KXtjb25zdCBvPXtmaWxlTmFtZTplfHxudWxsLGlkOnQsaW1wb3J0ZXI6cyxuYW1lOml8fG51bGx9LGE9bj9hd2FpdCB0aGlzLmFkZEVudHJ5V2l0aEltcGxpY2l0RGVwZW5kYW50cyhvLG4pOihhd2FpdCB0aGlzLmFkZEVudHJ5TW9kdWxlcyhbb10sITEpKS5uZXdFbnRyeU1vZHVsZXNbMF07cmV0dXJuIG51bGwhPXImJihhLnByZXNlcnZlU2lnbmF0dXJlPXIpLGF9YXN5bmMgcHJlbG9hZE1vZHVsZShlKXtyZXR1cm4gKGF3YWl0IHRoaXMuZmV0Y2hNb2R1bGUodGhpcy5nZXRSZXNvbHZlZElkV2l0aERlZmF1bHRzKGUsZmUpLHZvaWQgMCwhMSwhZS5yZXNvbHZlRGVwZW5kZW5jaWVzfHxpdSkpLmluZm99YWRkRW50cnlXaXRoSW1wbGljaXREZXBlbmRhbnRzKGUsdCl7Y29uc3Qgcz10aGlzLm5leHRDaHVua05hbWVQcmlvcml0eSsrO3JldHVybiB0aGlzLmV4dGVuZExvYWRNb2R1bGVzUHJvbWlzZSh0aGlzLmxvYWRFbnRyeU1vZHVsZShlLmlkLCExLGUuaW1wb3J0ZXIsbnVsbCkudGhlbigoYXN5bmMgaT0+e2lmKG91KGksZSwhMSxzKSwhaS5pbmZvLmlzRW50cnkpe3RoaXMuaW1wbGljaXRFbnRyeU1vZHVsZXMuYWRkKGkpO2NvbnN0IHM9YXdhaXQgUHJvbWlzZS5hbGwodC5tYXAoKHQ9PnRoaXMubG9hZEVudHJ5TW9kdWxlKHQsITEsZS5pbXBvcnRlcixpLmlkKSkpKTtmb3IoY29uc3QgZSBvZiBzKWkuaW1wbGljaXRseUxvYWRlZEFmdGVyLmFkZChlKTtmb3IoY29uc3QgZSBvZiBpLmltcGxpY2l0bHlMb2FkZWRBZnRlcillLmltcGxpY2l0bHlMb2FkZWRCZWZvcmUuYWRkKGkpO31yZXR1cm4gaX0pKSl9YXN5bmMgYWRkTW9kdWxlU291cmNlKGUsdCxzKXtsZXQgaTt0cnl7aT1hd2FpdCB0aGlzLmdyYXBoLmZpbGVPcGVyYXRpb25RdWV1ZS5ydW4oKGFzeW5jKCk9PmF3YWl0IHRoaXMucGx1Z2luRHJpdmVyLmhvb2tGaXJzdCgibG9hZCIsW2VdKT8/YXdhaXQgVmgoZSwidXRmOCIpKSk7fWNhdGNoKHMpe2xldCBpPWBDb3VsZCBub3QgbG9hZCAke2V9YDt0aHJvdyB0JiYoaSs9YCAoaW1wb3J0ZWQgYnkgJHtMKHQpfSlgKSxpKz1gOiAke3MubWVzc2FnZX1gLHMubWVzc2FnZT1pLHN9Y29uc3Qgbj0ic3RyaW5nIj09dHlwZW9mIGk/e2NvZGU6aX06bnVsbCE9aSYmIm9iamVjdCI9PXR5cGVvZiBpJiYic3RyaW5nIj09dHlwZW9mIGkuY29kZT9pOlllKGZ1bmN0aW9uKGUpe3JldHVybiB7Y29kZToiQkFEX0xPQURFUiIsbWVzc2FnZTpgRXJyb3IgbG9hZGluZyAiJHtMKGUpfSI6IHBsdWdpbiBsb2FkIGhvb2sgc2hvdWxkIHJldHVybiBhIHN0cmluZywgYSB7IGNvZGUsIG1hcCB9IG9iamVjdCwgb3Igbm90aGluZy9udWxsLmB9fShlKSkscj10aGlzLmdyYXBoLmNhY2hlZE1vZHVsZXMuZ2V0KGUpO2lmKCFyfHxyLmN1c3RvbVRyYW5zZm9ybUNhY2hlfHxyLm9yaWdpbmFsQ29kZSE9PW4uY29kZXx8YXdhaXQgdGhpcy5wbHVnaW5Ecml2ZXIuaG9va0ZpcnN0KCJzaG91bGRUcmFuc2Zvcm1DYWNoZWRNb2R1bGUiLFt7YXN0OnIuYXN0LGNvZGU6ci5jb2RlLGlkOnIuaWQsbWV0YTpyLm1ldGEsbW9kdWxlU2lkZUVmZmVjdHM6ci5tb2R1bGVTaWRlRWZmZWN0cyxyZXNvbHZlZFNvdXJjZXM6ci5yZXNvbHZlZElkcyxzeW50aGV0aWNOYW1lZEV4cG9ydHM6ci5zeW50aGV0aWNOYW1lZEV4cG9ydHN9XSkpcy51cGRhdGVPcHRpb25zKG4pLHMuc2V0U291cmNlKGF3YWl0IHN1KG4scyx0aGlzLnBsdWdpbkRyaXZlcix0aGlzLm9wdGlvbnMub25Mb2cpKTtlbHNlIHtpZihyLnRyYW5zZm9ybUZpbGVzKWZvcihjb25zdCBlIG9mIHIudHJhbnNmb3JtRmlsZXMpdGhpcy5wbHVnaW5Ecml2ZXIuZW1pdEZpbGUoZSk7cy5zZXRTb3VyY2Uocik7fX1hc3luYyBhd2FpdExvYWRNb2R1bGVzUHJvbWlzZSgpe2xldCBlO2Rve2U9dGhpcy5sYXRlc3RMb2FkTW9kdWxlc1Byb21pc2UsYXdhaXQgZTt9d2hpbGUoZSE9PXRoaXMubGF0ZXN0TG9hZE1vZHVsZXNQcm9taXNlKX1leHRlbmRMb2FkTW9kdWxlc1Byb21pc2UoZSl7cmV0dXJuIHRoaXMubGF0ZXN0TG9hZE1vZHVsZXNQcm9taXNlPVByb21pc2UuYWxsKFtlLHRoaXMubGF0ZXN0TG9hZE1vZHVsZXNQcm9taXNlXSksdGhpcy5sYXRlc3RMb2FkTW9kdWxlc1Byb21pc2UuY2F0Y2goKCgpPT57fSkpLGV9YXN5bmMgZmV0Y2hEeW5hbWljRGVwZW5kZW5jaWVzKGUsdCl7Y29uc3Qgcz1hd2FpdCBQcm9taXNlLmFsbCh0Lm1hcCgodD0+dC50aGVuKChhc3luYyhbdCxzXSk9Pm51bGw9PT1zP251bGw6InN0cmluZyI9PXR5cGVvZiBzPyh0LnJlc29sdXRpb249cyxudWxsKTp0LnJlc29sdXRpb249YXdhaXQgdGhpcy5mZXRjaFJlc29sdmVkRGVwZW5kZW5jeShMKHMuaWQpLGUuaWQscykpKSkpKTtmb3IoY29uc3QgdCBvZiBzKXQmJihlLmR5bmFtaWNEZXBlbmRlbmNpZXMuYWRkKHQpLHQuZHluYW1pY0ltcG9ydGVycy5wdXNoKGUuaWQpKTt9YXN5bmMgZmV0Y2hNb2R1bGUoe2Fzc2VydGlvbnM6ZSxpZDp0LG1ldGE6cyxtb2R1bGVTaWRlRWZmZWN0czppLHN5bnRoZXRpY05hbWVkRXhwb3J0czpufSxyLG8sYSl7Y29uc3QgbD10aGlzLm1vZHVsZXNCeUlkLmdldCh0KTtpZihsIGluc3RhbmNlb2YgVG8pcmV0dXJuIHImJnZvKGUsbC5pbmZvLmFzc2VydGlvbnMpJiZ0aGlzLm9wdGlvbnMub25Mb2codmUsVHQobC5pbmZvLmFzc2VydGlvbnMsZSx0LHIpKSxhd2FpdCB0aGlzLmhhbmRsZUV4aXN0aW5nTW9kdWxlKGwsbyxhKSxsO2lmKGwgaW5zdGFuY2VvZiBRdClyZXR1cm4gWWUoe2NvZGU6IkVYVEVSTkFMX01PRFVMRVNfQ0FOTk9UX0JFX1RSQU5TRk9STUVEX1RPX01PRFVMRVMiLG1lc3NhZ2U6YCR7bC5pZH0gaXMgcmVzb2x2ZWQgYXMgYSBtb2R1bGUgbm93LCBidXQgaXQgd2FzIGFuIGV4dGVybmFsIG1vZHVsZSBiZWZvcmUuIFBsZWFzZSBjaGVjayB3aGV0aGVyIHRoZXJlIGFyZSBjb25mbGljdHMgaW4geW91ciBSb2xsdXAgb3B0aW9ucyAiZXh0ZXJuYWwiIGFuZCAibWFudWFsQ2h1bmtzIiwgbWFudWFsQ2h1bmtzIGNhbm5vdCBpbmNsdWRlIGV4dGVybmFsIG1vZHVsZXMuYH0pO2NvbnN0IGM9bmV3IFRvKHRoaXMuZ3JhcGgsdCx0aGlzLm9wdGlvbnMsbyxpLG4scyxlKTt0aGlzLm1vZHVsZXNCeUlkLnNldCh0LGMpLHRoaXMuZ3JhcGgud2F0Y2hGaWxlc1t0XT0hMDtjb25zdCBoPXRoaXMuYWRkTW9kdWxlU291cmNlKHQscixjKS50aGVuKCgoKT0+W3RoaXMuZ2V0UmVzb2x2ZVN0YXRpY0RlcGVuZGVuY3lQcm9taXNlcyhjKSx0aGlzLmdldFJlc29sdmVEeW5hbWljSW1wb3J0UHJvbWlzZXMoYyksdV0pKSx1PWx1KGgpLnRoZW4oKCgpPT50aGlzLnBsdWdpbkRyaXZlci5ob29rUGFyYWxsZWwoIm1vZHVsZVBhcnNlZCIsW2MuaW5mb10pKSk7dS5jYXRjaCgoKCk9Pnt9KSksdGhpcy5tb2R1bGVMb2FkUHJvbWlzZXMuc2V0KGMsaCk7Y29uc3QgZD1hd2FpdCBoO3JldHVybiBhP2E9PT1pdSYmYXdhaXQgdTphd2FpdCB0aGlzLmZldGNoTW9kdWxlRGVwZW5kZW5jaWVzKGMsLi4uZCksY31hc3luYyBmZXRjaE1vZHVsZURlcGVuZGVuY2llcyhlLHQscyxpKXt0aGlzLm1vZHVsZXNXaXRoTG9hZGVkRGVwZW5kZW5jaWVzLmhhcyhlKXx8KHRoaXMubW9kdWxlc1dpdGhMb2FkZWREZXBlbmRlbmNpZXMuYWRkKGUpLGF3YWl0IFByb21pc2UuYWxsKFt0aGlzLmZldGNoU3RhdGljRGVwZW5kZW5jaWVzKGUsdCksdGhpcy5mZXRjaER5bmFtaWNEZXBlbmRlbmNpZXMoZSxzKV0pLGUubGlua0ltcG9ydHMoKSxhd2FpdCBpKTt9ZmV0Y2hSZXNvbHZlZERlcGVuZGVuY3koZSx0LHMpe2lmKHMuZXh0ZXJuYWwpe2NvbnN0e2Fzc2VydGlvbnM6aSxleHRlcm5hbDpuLGlkOnIsbW9kdWxlU2lkZUVmZmVjdHM6byxtZXRhOmF9PXM7bGV0IGw9dGhpcy5tb2R1bGVzQnlJZC5nZXQocik7aWYobCl7aWYoIShsIGluc3RhbmNlb2YgUXQpKXJldHVybiBZZShmdW5jdGlvbihlLHQpe3JldHVybiB7Y29kZToiSU5WQUxJRF9FWFRFUk5BTF9JRCIsbWVzc2FnZTpgIiR7ZX0iIGlzIGltcG9ydGVkIGFzIGFuIGV4dGVybmFsIGJ5ICIke0wodCl9IiwgYnV0IGlzIGFscmVhZHkgYW4gZXhpc3Rpbmcgbm9uLWV4dGVybmFsIG1vZHVsZSBpZC5gfX0oZSx0KSk7dm8obC5pbmZvLmFzc2VydGlvbnMsaSkmJnRoaXMub3B0aW9ucy5vbkxvZyh2ZSxUdChsLmluZm8uYXNzZXJ0aW9ucyxpLGUsdCkpO31lbHNlIGw9bmV3IFF0KHRoaXMub3B0aW9ucyxyLG8sYSwiYWJzb2x1dGUiIT09biYmQShyKSxpKSx0aGlzLm1vZHVsZXNCeUlkLnNldChyLGwpO3JldHVybiBQcm9taXNlLnJlc29sdmUobCl9cmV0dXJuIHRoaXMuZmV0Y2hNb2R1bGUocyx0LCExLCExKX1hc3luYyBmZXRjaFN0YXRpY0RlcGVuZGVuY2llcyhlLHQpe2Zvcihjb25zdCBzIG9mIGF3YWl0IFByb21pc2UuYWxsKHQubWFwKCh0PT50LnRoZW4oKChbdCxzXSk9PnRoaXMuZmV0Y2hSZXNvbHZlZERlcGVuZGVuY3kodCxlLmlkLHMpKSkpKSkpZS5kZXBlbmRlbmNpZXMuYWRkKHMpLHMuaW1wb3J0ZXJzLnB1c2goZS5pZCk7aWYoIXRoaXMub3B0aW9ucy50cmVlc2hha2V8fCJuby10cmVlc2hha2UiPT09ZS5pbmZvLm1vZHVsZVNpZGVFZmZlY3RzKWZvcihjb25zdCB0IG9mIGUuZGVwZW5kZW5jaWVzKXQgaW5zdGFuY2VvZiBUbyYmKHQuaW1wb3J0ZWRGcm9tTm90VHJlZXNoYWtlbj0hMCk7fWdldE5vcm1hbGl6ZWRSZXNvbHZlZElkV2l0aG91dERlZmF1bHRzKGUsdCxzKXtjb25zdHttYWtlQWJzb2x1dGVFeHRlcm5hbHNSZWxhdGl2ZTppfT10aGlzLm9wdGlvbnM7aWYoZSl7aWYoIm9iamVjdCI9PXR5cGVvZiBlKXtjb25zdCBuPWUuZXh0ZXJuYWx8fHRoaXMub3B0aW9ucy5leHRlcm5hbChlLmlkLHQsITApO3JldHVybiB7Li4uZSxleHRlcm5hbDpuJiYoInJlbGF0aXZlIj09PW58fCFBKGUuaWQpfHwhMD09PW4mJmF1KGUuaWQscyxpKXx8ImFic29sdXRlIil9fWNvbnN0IG49dGhpcy5vcHRpb25zLmV4dGVybmFsKGUsdCwhMCk7cmV0dXJuIHtleHRlcm5hbDpuJiYoYXUoZSxzLGkpfHwiYWJzb2x1dGUiKSxpZDpuJiZpP3J1KGUsdCk6ZX19Y29uc3Qgbj1pP3J1KHMsdCk6cztyZXR1cm4gITE9PT1lfHx0aGlzLm9wdGlvbnMuZXh0ZXJuYWwobix0LCEwKT97ZXh0ZXJuYWw6YXUobixzLGkpfHwiYWJzb2x1dGUiLGlkOm59Om51bGx9Z2V0UmVzb2x2ZUR5bmFtaWNJbXBvcnRQcm9taXNlcyhlKXtyZXR1cm4gZS5keW5hbWljSW1wb3J0cy5tYXAoKGFzeW5jIHQ9Pntjb25zdCBzPWF3YWl0IHRoaXMucmVzb2x2ZUR5bmFtaWNJbXBvcnQoZSwic3RyaW5nIj09dHlwZW9mIHQuYXJndW1lbnQ/dC5hcmd1bWVudDp0LmFyZ3VtZW50LmVzVHJlZU5vZGUsZS5pZCxmdW5jdGlvbihlKXtjb25zdCB0PWUuYXJndW1lbnRzPy5bMF0/LnByb3BlcnRpZXMuZmluZCgoZT0+ImFzc2VydCI9PT1ibyhlKSkpPy52YWx1ZTtpZighdClyZXR1cm4gZmU7Y29uc3Qgcz10LnByb3BlcnRpZXMubWFwKChlPT57Y29uc3QgdD1ibyhlKTtyZXR1cm4gInN0cmluZyI9PXR5cGVvZiB0JiYic3RyaW5nIj09dHlwZW9mIGUudmFsdWUudmFsdWU/W3QsZS52YWx1ZS52YWx1ZV06bnVsbH0pKS5maWx0ZXIoKGU9PiEhZSkpO3JldHVybiBzLmxlbmd0aD4wP09iamVjdC5mcm9tRW50cmllcyhzKTpmZX0odC5ub2RlKSk7cmV0dXJuIHMmJiJvYmplY3QiPT10eXBlb2YgcyYmKHQuaWQ9cy5pZCksW3Qsc119KSl9Z2V0UmVzb2x2ZVN0YXRpY0RlcGVuZGVuY3lQcm9taXNlcyhlKXtyZXR1cm4gQXJyYXkuZnJvbShlLnNvdXJjZXNXaXRoQXNzZXJ0aW9ucywoYXN5bmMoW3Qsc10pPT5bdCxlLnJlc29sdmVkSWRzW3RdPWUucmVzb2x2ZWRJZHNbdF18fHRoaXMuaGFuZGxlSW52YWxpZFJlc29sdmVkSWQoYXdhaXQgdGhpcy5yZXNvbHZlSWQodCxlLmlkLGZlLCExLHMpLHQsZS5pZCxzKV0pKX1nZXRSZXNvbHZlZElkV2l0aERlZmF1bHRzKGUsdCl7aWYoIWUpcmV0dXJuIG51bGw7Y29uc3Qgcz1lLmV4dGVybmFsfHwhMTtyZXR1cm4ge2Fzc2VydGlvbnM6ZS5hc3NlcnRpb25zfHx0LGV4dGVybmFsOnMsaWQ6ZS5pZCxtZXRhOmUubWV0YXx8e30sbW9kdWxlU2lkZUVmZmVjdHM6ZS5tb2R1bGVTaWRlRWZmZWN0cz8/dGhpcy5oYXNNb2R1bGVTaWRlRWZmZWN0cyhlLmlkLCEhcykscmVzb2x2ZWRCeTplLnJlc29sdmVkQnk/PyJyb2xsdXAiLHN5bnRoZXRpY05hbWVkRXhwb3J0czplLnN5bnRoZXRpY05hbWVkRXhwb3J0cz8/ITF9fWFzeW5jIGhhbmRsZUV4aXN0aW5nTW9kdWxlKGUsdCxzKXtjb25zdCBpPXRoaXMubW9kdWxlTG9hZFByb21pc2VzLmdldChlKTtpZihzKXJldHVybiBzPT09aXU/bHUoaSk6aTtpZih0KXtlLmluZm8uaXNFbnRyeT0hMCx0aGlzLmltcGxpY2l0RW50cnlNb2R1bGVzLmRlbGV0ZShlKTtmb3IoY29uc3QgdCBvZiBlLmltcGxpY2l0bHlMb2FkZWRBZnRlcil0LmltcGxpY2l0bHlMb2FkZWRCZWZvcmUuZGVsZXRlKGUpO2UuaW1wbGljaXRseUxvYWRlZEFmdGVyLmNsZWFyKCk7fXJldHVybiB0aGlzLmZldGNoTW9kdWxlRGVwZW5kZW5jaWVzKGUsLi4uYXdhaXQgaSl9aGFuZGxlSW52YWxpZFJlc29sdmVkSWQoZSx0LHMsaSl7cmV0dXJuIG51bGw9PT1lP2sodCk/WWUoZnVuY3Rpb24oZSx0KXtyZXR1cm4ge2NvZGU6JHQsZXhwb3J0ZXI6ZSxpZDp0LG1lc3NhZ2U6YENvdWxkIG5vdCByZXNvbHZlICIke2V9IiBmcm9tICIke0wodCl9ImB9fSh0LHMpKToodGhpcy5vcHRpb25zLm9uTG9nKHZlLGZ1bmN0aW9uKGUsdCl7cmV0dXJuIHtjb2RlOiR0LGV4cG9ydGVyOmUsaWQ6dCxtZXNzYWdlOmAiJHtlfSIgaXMgaW1wb3J0ZWQgYnkgIiR7TCh0KX0iLCBidXQgY291bGQgbm90IGJlIHJlc29sdmVkIOKAkyB0cmVhdGluZyBpdCBhcyBhbiBleHRlcm5hbCBkZXBlbmRlbmN5LmAsdXJsOk1lKCJ0cm91Ymxlc2hvb3RpbmcvI3dhcm5pbmctdHJlYXRpbmctbW9kdWxlLWFzLWV4dGVybmFsLWRlcGVuZGVuY3kiKX19KHQscykpLHthc3NlcnRpb25zOmksZXh0ZXJuYWw6ITAsaWQ6dCxtZXRhOnt9LG1vZHVsZVNpZGVFZmZlY3RzOnRoaXMuaGFzTW9kdWxlU2lkZUVmZmVjdHModCwhMCkscmVzb2x2ZWRCeToicm9sbHVwIixzeW50aGV0aWNOYW1lZEV4cG9ydHM6ITF9KTooZS5leHRlcm5hbCYmZS5zeW50aGV0aWNOYW1lZEV4cG9ydHMmJnRoaXMub3B0aW9ucy5vbkxvZyh2ZSxmdW5jdGlvbihlLHQpe3JldHVybiB7Y29kZToiRVhURVJOQUxfU1lOVEhFVElDX0VYUE9SVFMiLGV4cG9ydGVyOmUsbWVzc2FnZTpgRXh0ZXJuYWwgIiR7ZX0iIGNhbm5vdCBoYXZlICJzeW50aGV0aWNOYW1lZEV4cG9ydHMiIGVuYWJsZWQgKGltcG9ydGVkIGJ5ICIke0wodCl9IikuYH19KHQscykpLGUpfWFzeW5jIGxvYWRFbnRyeU1vZHVsZShlLHQscyxpLG49ITEpe2NvbnN0IHI9YXdhaXQgemgoZSxzLHRoaXMub3B0aW9ucy5wcmVzZXJ2ZVN5bWxpbmtzLHRoaXMucGx1Z2luRHJpdmVyLHRoaXMucmVzb2x2ZUlkLG51bGwsZmUsITAsZmUpO2lmKG51bGw9PXIpcmV0dXJuIFllKG51bGw9PT1pP2Z1bmN0aW9uKGUpe3JldHVybiB7Y29kZTpDdCxtZXNzYWdlOmBDb3VsZCBub3QgcmVzb2x2ZSBlbnRyeSBtb2R1bGUgIiR7TChlKX0iLmB9fShlKTpmdW5jdGlvbihlLHQpe3JldHVybiB7Y29kZTp5dCxtZXNzYWdlOmBNb2R1bGUgIiR7TChlKX0iIHRoYXQgc2hvdWxkIGJlIGltcGxpY2l0bHkgbG9hZGVkIGJlZm9yZSAiJHtMKHQpfSIgY291bGQgbm90IGJlIHJlc29sdmVkLmB9fShlLGkpKTtjb25zdCBvPSJvYmplY3QiPT10eXBlb2YgciYmci5leHRlcm5hbDtyZXR1cm4gITE9PT1yfHxvP1llKG51bGw9PT1pP28mJm4/e2NvZGU6IkVYVEVSTkFMX01PRFVMRVNfQ0FOTk9UX0JFX0lOQ0xVREVEX0lOX01BTlVBTF9DSFVOS1MiLG1lc3NhZ2U6YCIke2V9IiBjYW5ub3QgYmUgaW5jbHVkZWQgaW4gbWFudWFsQ2h1bmtzIGJlY2F1c2UgaXQgaXMgcmVzb2x2ZWQgYXMgYW4gZXh0ZXJuYWwgbW9kdWxlIGJ5IHRoZSAiZXh0ZXJuYWwiIG9wdGlvbiBvciBwbHVnaW5zLmB9OmZ1bmN0aW9uKGUpe3JldHVybiB7Y29kZTpDdCxtZXNzYWdlOmBFbnRyeSBtb2R1bGUgIiR7TChlKX0iIGNhbm5vdCBiZSBleHRlcm5hbC5gfX0oZSk6ZnVuY3Rpb24oZSx0KXtyZXR1cm4ge2NvZGU6eXQsbWVzc2FnZTpgTW9kdWxlICIke0woZSl9IiB0aGF0IHNob3VsZCBiZSBpbXBsaWNpdGx5IGxvYWRlZCBiZWZvcmUgIiR7TCh0KX0iIGNhbm5vdCBiZSBleHRlcm5hbC5gfX0oZSxpKSk6dGhpcy5mZXRjaE1vZHVsZSh0aGlzLmdldFJlc29sdmVkSWRXaXRoRGVmYXVsdHMoIm9iamVjdCI9PXR5cGVvZiByP3I6e2lkOnJ9LGZlKSx2b2lkIDAsdCwhMSl9YXN5bmMgcmVzb2x2ZUR5bmFtaWNJbXBvcnQoZSx0LHMsaSl7Y29uc3Qgbj1hd2FpdCB0aGlzLnBsdWdpbkRyaXZlci5ob29rRmlyc3QoInJlc29sdmVEeW5hbWljSW1wb3J0IixbdCxzLHthc3NlcnRpb25zOml9XSk7aWYoInN0cmluZyIhPXR5cGVvZiB0KXJldHVybiAic3RyaW5nIj09dHlwZW9mIG4/bjpuP3RoaXMuZ2V0UmVzb2x2ZWRJZFdpdGhEZWZhdWx0cyhuLGkpOm51bGw7aWYobnVsbD09bil7Y29uc3Qgbj1lLnJlc29sdmVkSWRzW3RdO3JldHVybiBuPyh2byhuLmFzc2VydGlvbnMsaSkmJnRoaXMub3B0aW9ucy5vbkxvZyh2ZSxUdChuLmFzc2VydGlvbnMsaSx0LHMpKSxuKTplLnJlc29sdmVkSWRzW3RdPXRoaXMuaGFuZGxlSW52YWxpZFJlc29sdmVkSWQoYXdhaXQgdGhpcy5yZXNvbHZlSWQodCxlLmlkLGZlLCExLGkpLHQsZS5pZCxpKX1yZXR1cm4gdGhpcy5oYW5kbGVJbnZhbGlkUmVzb2x2ZWRJZCh0aGlzLmdldFJlc29sdmVkSWRXaXRoRGVmYXVsdHModGhpcy5nZXROb3JtYWxpemVkUmVzb2x2ZWRJZFdpdGhvdXREZWZhdWx0cyhuLHMsdCksaSksdCxzLGkpfX1mdW5jdGlvbiBydShlLHQpe3JldHVybiBrKGUpP3Q/TiQ1KHQsIi4uIixlKTpOJDUoZSk6ZX1mdW5jdGlvbiBvdShlLHtmaWxlTmFtZTp0LG5hbWU6c30saSxuKXtpZihudWxsIT09dCllLmNodW5rRmlsZU5hbWVzLmFkZCh0KTtlbHNlIGlmKG51bGwhPT1zKXtsZXQgdD0wO2Zvcig7ZS5jaHVua05hbWVzW3RdPy5wcmlvcml0eTxuOyl0Kys7ZS5jaHVua05hbWVzLnNwbGljZSh0LDAse2lzVXNlckRlZmluZWQ6aSxuYW1lOnMscHJpb3JpdHk6bn0pO319ZnVuY3Rpb24gYXUoZSx0LHMpe3JldHVybiAhMD09PXN8fCJpZlJlbGF0aXZlU291cmNlIj09PXMmJmsodCl8fCFBKGUpfWFzeW5jIGZ1bmN0aW9uIGx1KGUpe2NvbnN0W3Qsc109YXdhaXQgZTtyZXR1cm4gUHJvbWlzZS5hbGwoWy4uLnQsLi4uc10pfWNsYXNzIGN1IGV4dGVuZHMgRGl7Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMucGFyZW50PW51bGwsdGhpcy52YXJpYWJsZXMuc2V0KCJ1bmRlZmluZWQiLG5ldyBubyk7fWZpbmRWYXJpYWJsZShlKXtsZXQgdD10aGlzLnZhcmlhYmxlcy5nZXQoZSk7cmV0dXJuIHR8fCh0PW5ldyBybihlKSx0aGlzLnZhcmlhYmxlcy5zZXQoZSx0KSksdH19ZnVuY3Rpb24gaHUoZSl7cmV0dXJuIEJsKCkudXBkYXRlKGUpLmRpZ2VzdCgiaGV4Iil9ZnVuY3Rpb24gdXUoZSx0LHMsaSxuKXtjb25zdCByPWkuc2FuaXRpemVGaWxlTmFtZShlfHwiYXNzZXQiKTtyZXR1cm4gQ2EoUGEoImZ1bmN0aW9uIj09dHlwZW9mIGkuYXNzZXRGaWxlTmFtZXM/aS5hc3NldEZpbGVOYW1lcyh7bmFtZTplLHNvdXJjZTp0LHR5cGU6ImFzc2V0In0pOmkuYXNzZXRGaWxlTmFtZXMsIm91dHB1dC5hc3NldEZpbGVOYW1lcyIse2V4dDooKT0+QyhyKS5zbGljZSgxKSxleHRuYW1lOigpPT5DKHIpLGhhc2g6ZT0+cy5zbGljZSgwLE1hdGgubWF4KDAsZXx8OCkpLG5hbWU6KCk9PnIuc2xpY2UoMCxNYXRoLm1heCgwLHIubGVuZ3RoLUMocikubGVuZ3RoKSl9KSxuKX1mdW5jdGlvbiBkdShlLHtidW5kbGU6dH0scyl7dFtJYV0uaGFzKGUudG9Mb3dlckNhc2UoKSk/cyh2ZSxmdW5jdGlvbihlKXtyZXR1cm4ge2NvZGU6b3QsbWVzc2FnZTpgVGhlIGVtaXR0ZWQgZmlsZSAiJHtlfSIgb3ZlcndyaXRlcyBhIHByZXZpb3VzbHkgZW1pdHRlZCBmaWxlIG9mIHRoZSBzYW1lIG5hbWUuYH19KGUpKTp0W2VdPXdhO31jb25zdCBwdT1uZXcgU2V0KFsiY2h1bmsiLCJhc3NldCIsInByZWJ1aWx0LWNodW5rIl0pO2Z1bmN0aW9uIGZ1KGUsdCxzKXtpZighKCJzdHJpbmciPT10eXBlb2YgZXx8ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpKXtjb25zdCBlPXQuZmlsZU5hbWV8fHQubmFtZXx8cztyZXR1cm4gWWUoS3QoYENvdWxkIG5vdCBzZXQgc291cmNlIGZvciAkeyJzdHJpbmciPT10eXBlb2YgZT9gYXNzZXQgIiR7ZX0iYDoidW5uYW1lZCBhc3NldCJ9LCBhc3NldCBzb3VyY2UgbmVlZHMgdG8gYmUgYSBzdHJpbmcsIFVpbnQ4QXJyYXkgb3IgQnVmZmVyLmApKX1yZXR1cm4gZX1mdW5jdGlvbiBtdShlLHQpe3JldHVybiAic3RyaW5nIiE9dHlwZW9mIGUuZmlsZU5hbWU/WWUoKHM9ZS5uYW1lfHx0LHtjb2RlOmV0LG1lc3NhZ2U6YFBsdWdpbiBlcnJvciAtIFVuYWJsZSB0byBnZXQgZmlsZSBuYW1lIGZvciBhc3NldCAiJHtzfSIuIEVuc3VyZSB0aGF0IHRoZSBzb3VyY2UgaXMgc2V0IGFuZCB0aGF0IGdlbmVyYXRlIGlzIGNhbGxlZCBmaXJzdC4gSWYgeW91IHJlZmVyZW5jZSBhc3NldHMgdmlhIGltcG9ydC5tZXRhLlJPTExVUF9GSUxFX1VSTF88cmVmZXJlbmNlSWQ+LCB5b3UgbmVlZCB0byBlaXRoZXIgaGF2ZSBzZXQgdGhlaXIgc291cmNlIGFmdGVyICJyZW5kZXJTdGFydCIgb3IgbmVlZCB0byBwcm92aWRlIGFuIGV4cGxpY2l0ICJmaWxlTmFtZSIgd2hlbiBlbWl0dGluZyB0aGVtLmB9KSk6ZS5maWxlTmFtZTt2YXIgczt9ZnVuY3Rpb24gZ3UoZSx0KXtyZXR1cm4gZS5maWxlTmFtZT9lLmZpbGVOYW1lOnQ/dC5nZXQoZS5tb2R1bGUpLmdldEZpbGVOYW1lKCk6WWUoKHM9ZS5maWxlTmFtZXx8ZS5uYW1lLHtjb2RlOnN0LG1lc3NhZ2U6YFBsdWdpbiBlcnJvciAtIFVuYWJsZSB0byBnZXQgZmlsZSBuYW1lIGZvciBlbWl0dGVkIGNodW5rICIke3N9Ii4gWW91IGNhbiBvbmx5IGdldCBmaWxlIG5hbWVzIG9uY2UgY2h1bmtzIGhhdmUgYmVlbiBnZW5lcmF0ZWQgYWZ0ZXIgdGhlICJyZW5kZXJTdGFydCIgaG9vay5gfSkpO3ZhciBzO31jbGFzcyB5dXtjb25zdHJ1Y3RvcihlLHQscyl7dGhpcy5ncmFwaD1lLHRoaXMub3B0aW9ucz10LHRoaXMuZmFjYWRlQ2h1bmtCeU1vZHVsZT1udWxsLHRoaXMubmV4dElkQmFzZT0xLHRoaXMub3V0cHV0PW51bGwsdGhpcy5vdXRwdXRGaWxlRW1pdHRlcnM9W10sdGhpcy5lbWl0RmlsZT1lPT5mdW5jdGlvbihlKXtyZXR1cm4gQm9vbGVhbihlJiZwdS5oYXMoZS50eXBlKSl9KGUpPyJwcmVidWlsdC1jaHVuayI9PT1lLnR5cGU/dGhpcy5lbWl0UHJlYnVpbHRDaHVuayhlKTpmdW5jdGlvbihlKXtjb25zdCB0PWUuZmlsZU5hbWV8fGUubmFtZTtyZXR1cm4gIXR8fCJzdHJpbmciPT10eXBlb2YgdCYmIVQodCl9KGUpPyJjaHVuayI9PT1lLnR5cGU/dGhpcy5lbWl0Q2h1bmsoZSk6dGhpcy5lbWl0QXNzZXQoZSk6WWUoS3QoYFRoZSAiZmlsZU5hbWUiIG9yICJuYW1lIiBwcm9wZXJ0aWVzIG9mIGVtaXR0ZWQgY2h1bmtzIGFuZCBhc3NldHMgbXVzdCBiZSBzdHJpbmdzIHRoYXQgYXJlIG5laXRoZXIgYWJzb2x1dGUgbm9yIHJlbGF0aXZlIHBhdGhzLCByZWNlaXZlZCAiJHtlLmZpbGVOYW1lfHxlLm5hbWV9Ii5gKSk6WWUoS3QoYEVtaXR0ZWQgZmlsZXMgbXVzdCBiZSBvZiB0eXBlICJhc3NldCIsICJjaHVuayIgb3IgInByZWJ1aWx0LWNodW5rIiwgcmVjZWl2ZWQgIiR7ZSYmZS50eXBlfSIuYCkpLHRoaXMuZmluYWxpc2VBc3NldHM9KCk9Pntmb3IoY29uc3RbZSx0XW9mIHRoaXMuZmlsZXNCeVJlZmVyZW5jZUlkKWlmKCJhc3NldCI9PT10LnR5cGUmJiJzdHJpbmciIT10eXBlb2YgdC5maWxlTmFtZSlyZXR1cm4gWWUoe2NvZGU6IkFTU0VUX1NPVVJDRV9NSVNTSU5HIixtZXNzYWdlOmBQbHVnaW4gZXJyb3IgY3JlYXRpbmcgYXNzZXQgIiR7dC5uYW1lfHxlfSIgLSBubyBhc3NldCBzb3VyY2Ugc2V0LmB9KX0sdGhpcy5nZXRGaWxlTmFtZT1lPT57Y29uc3QgdD10aGlzLmZpbGVzQnlSZWZlcmVuY2VJZC5nZXQoZSk7cmV0dXJuIHQ/ImNodW5rIj09PXQudHlwZT9ndSh0LHRoaXMuZmFjYWRlQ2h1bmtCeU1vZHVsZSk6InByZWJ1aWx0LWNodW5rIj09PXQudHlwZT90LmZpbGVOYW1lOm11KHQsZSk6WWUoe2NvZGU6IkZJTEVfTk9UX0ZPVU5EIixtZXNzYWdlOmBQbHVnaW4gZXJyb3IgLSBVbmFibGUgdG8gZ2V0IGZpbGUgbmFtZSBmb3IgdW5rbm93biBmaWxlICIke2V9Ii5gfSl9LHRoaXMuc2V0QXNzZXRTb3VyY2U9KGUsdCk9Pntjb25zdCBzPXRoaXMuZmlsZXNCeVJlZmVyZW5jZUlkLmdldChlKTtpZighcylyZXR1cm4gWWUoe2NvZGU6IkFTU0VUX05PVF9GT1VORCIsbWVzc2FnZTpgUGx1Z2luIGVycm9yIC0gVW5hYmxlIHRvIHNldCB0aGUgc291cmNlIGZvciB1bmtub3duIGFzc2V0ICIke2V9Ii5gfSk7aWYoImFzc2V0IiE9PXMudHlwZSlyZXR1cm4gWWUoS3QoYEFzc2V0IHNvdXJjZXMgY2FuIG9ubHkgYmUgc2V0IGZvciBlbWl0dGVkIGFzc2V0cyBidXQgIiR7ZX0iIGlzIGFuIGVtaXR0ZWQgY2h1bmsuYCkpO2lmKHZvaWQgMCE9PXMuc291cmNlKXJldHVybiBZZSh7Y29kZToiQVNTRVRfU09VUkNFX0FMUkVBRFlfU0VUIixtZXNzYWdlOmBVbmFibGUgdG8gc2V0IHRoZSBzb3VyY2UgZm9yIGFzc2V0ICIke3MubmFtZXx8ZX0iLCBzb3VyY2UgYWxyZWFkeSBzZXQuYH0pO2NvbnN0IGk9ZnUodCxzLGUpO2lmKHRoaXMub3V0cHV0KXRoaXMuZmluYWxpemVBZGRpdGlvbmFsQXNzZXQocyxpLHRoaXMub3V0cHV0KTtlbHNlIHtzLnNvdXJjZT1pO2Zvcihjb25zdCBlIG9mIHRoaXMub3V0cHV0RmlsZUVtaXR0ZXJzKWUuZmluYWxpemVBZGRpdGlvbmFsQXNzZXQocyxpLGUub3V0cHV0KTt9fSx0aGlzLnNldENodW5rSW5mb3JtYXRpb249ZT0+e3RoaXMuZmFjYWRlQ2h1bmtCeU1vZHVsZT1lO30sdGhpcy5zZXRPdXRwdXRCdW5kbGU9KGUsdCk9Pntjb25zdCBzPXRoaXMub3V0cHV0PXtidW5kbGU6ZSxmaWxlTmFtZXNCeVNvdXJjZTpuZXcgTWFwLG91dHB1dE9wdGlvbnM6dH07Zm9yKGNvbnN0IGUgb2YgdGhpcy5maWxlc0J5UmVmZXJlbmNlSWQudmFsdWVzKCkpZS5maWxlTmFtZSYmZHUoZS5maWxlTmFtZSxzLHRoaXMub3B0aW9ucy5vbkxvZyk7Y29uc3QgaT1uZXcgTWFwO2Zvcihjb25zdCBlIG9mIHRoaXMuZmlsZXNCeVJlZmVyZW5jZUlkLnZhbHVlcygpKWlmKCJhc3NldCI9PT1lLnR5cGUmJnZvaWQgMCE9PWUuc291cmNlKWlmKGUuZmlsZU5hbWUpdGhpcy5maW5hbGl6ZUFkZGl0aW9uYWxBc3NldChlLGUuc291cmNlLHMpO2Vsc2Uge0YkMyhpLGh1KGUuc291cmNlKSwoKCk9PltdKSkucHVzaChlKTt9ZWxzZSAicHJlYnVpbHQtY2h1bmsiPT09ZS50eXBlJiYodGhpcy5vdXRwdXQuYnVuZGxlW2UuZmlsZU5hbWVdPXRoaXMuY3JlYXRlUHJlYnVpbHRDaHVuayhlKSk7Zm9yKGNvbnN0W2UsdF1vZiBpKXRoaXMuZmluYWxpemVBc3NldHNXaXRoU2FtZVNvdXJjZSh0LGUscyk7fSx0aGlzLmZpbGVzQnlSZWZlcmVuY2VJZD1zP25ldyBNYXAocy5maWxlc0J5UmVmZXJlbmNlSWQpOm5ldyBNYXAscz8uYWRkT3V0cHV0RmlsZUVtaXR0ZXIodGhpcyk7fWFkZE91dHB1dEZpbGVFbWl0dGVyKGUpe3RoaXMub3V0cHV0RmlsZUVtaXR0ZXJzLnB1c2goZSk7fWFzc2lnblJlZmVyZW5jZUlkKGUsdCl7bGV0IHM9dDtkb3tzPUJsKCkudXBkYXRlKHMpLmRpZ2VzdCgiaGV4Iikuc2xpY2UoMCw4KTt9d2hpbGUodGhpcy5maWxlc0J5UmVmZXJlbmNlSWQuaGFzKHMpfHx0aGlzLm91dHB1dEZpbGVFbWl0dGVycy5zb21lKCgoe2ZpbGVzQnlSZWZlcmVuY2VJZDplfSk9PmUuaGFzKHMpKSkpO2UucmVmZXJlbmNlSWQ9cyx0aGlzLmZpbGVzQnlSZWZlcmVuY2VJZC5zZXQocyxlKTtmb3IoY29uc3R7ZmlsZXNCeVJlZmVyZW5jZUlkOnR9b2YgdGhpcy5vdXRwdXRGaWxlRW1pdHRlcnMpdC5zZXQocyxlKTtyZXR1cm4gc31jcmVhdGVQcmVidWlsdENodW5rKGUpe3JldHVybiB7Y29kZTplLmNvZGUsZHluYW1pY0ltcG9ydHM6W10sZXhwb3J0czplLmV4cG9ydHN8fFtdLGZhY2FkZU1vZHVsZUlkOm51bGwsZmlsZU5hbWU6ZS5maWxlTmFtZSxpbXBsaWNpdGx5TG9hZGVkQmVmb3JlOltdLGltcG9ydGVkQmluZGluZ3M6e30saW1wb3J0czpbXSxpc0R5bmFtaWNFbnRyeTohMSxpc0VudHJ5OiExLGlzSW1wbGljaXRFbnRyeTohMSxtYXA6ZS5tYXB8fG51bGwsbW9kdWxlSWRzOltdLG1vZHVsZXM6e30sbmFtZTplLmZpbGVOYW1lLHByZWxpbWluYXJ5RmlsZU5hbWU6ZS5maWxlTmFtZSxyZWZlcmVuY2VkRmlsZXM6W10sdHlwZToiY2h1bmsifX1lbWl0QXNzZXQoZSl7Y29uc3QgdD12b2lkIDA9PT1lLnNvdXJjZT92b2lkIDA6ZnUoZS5zb3VyY2UsZSxudWxsKSxzPXtmaWxlTmFtZTplLmZpbGVOYW1lLG5hbWU6ZS5uYW1lLG5lZWRzQ29kZVJlZmVyZW5jZTohIWUubmVlZHNDb2RlUmVmZXJlbmNlLHJlZmVyZW5jZUlkOiIiLHNvdXJjZTp0LHR5cGU6ImFzc2V0In0saT10aGlzLmFzc2lnblJlZmVyZW5jZUlkKHMsZS5maWxlTmFtZXx8ZS5uYW1lfHxTdHJpbmcodGhpcy5uZXh0SWRCYXNlKyspKTtpZih0aGlzLm91dHB1dCl0aGlzLmVtaXRBc3NldFdpdGhSZWZlcmVuY2VJZChzLHRoaXMub3V0cHV0KTtlbHNlIGZvcihjb25zdCBlIG9mIHRoaXMub3V0cHV0RmlsZUVtaXR0ZXJzKWUuZW1pdEFzc2V0V2l0aFJlZmVyZW5jZUlkKHMsZS5vdXRwdXQpO3JldHVybiBpfWVtaXRBc3NldFdpdGhSZWZlcmVuY2VJZChlLHQpe2NvbnN0e2ZpbGVOYW1lOnMsc291cmNlOml9PWU7cyYmZHUocyx0LHRoaXMub3B0aW9ucy5vbkxvZyksdm9pZCAwIT09aSYmdGhpcy5maW5hbGl6ZUFkZGl0aW9uYWxBc3NldChlLGksdCk7fWVtaXRDaHVuayhlKXtpZih0aGlzLmdyYXBoLnBoYXNlPm1vLkxPQURfQU5EX1BBUlNFKXJldHVybiBZZSh7Y29kZTpwdCxtZXNzYWdlOiJDYW5ub3QgZW1pdCBjaHVua3MgYWZ0ZXIgbW9kdWxlIGxvYWRpbmcgaGFzIGZpbmlzaGVkLiJ9KTtpZigic3RyaW5nIiE9dHlwZW9mIGUuaWQpcmV0dXJuIFllKEt0KGBFbWl0dGVkIGNodW5rcyBuZWVkIHRvIGhhdmUgYSB2YWxpZCBzdHJpbmcgaWQsIHJlY2VpdmVkICIke2UuaWR9ImApKTtjb25zdCB0PXtmaWxlTmFtZTplLmZpbGVOYW1lLG1vZHVsZTpudWxsLG5hbWU6ZS5uYW1lfHxlLmlkLHJlZmVyZW5jZUlkOiIiLHR5cGU6ImNodW5rIn07cmV0dXJuIHRoaXMuZ3JhcGgubW9kdWxlTG9hZGVyLmVtaXRDaHVuayhlKS50aGVuKChlPT50Lm1vZHVsZT1lKSkuY2F0Y2goKCgpPT57fSkpLHRoaXMuYXNzaWduUmVmZXJlbmNlSWQodCxlLmlkKX1lbWl0UHJlYnVpbHRDaHVuayhlKXtpZigic3RyaW5nIiE9dHlwZW9mIGUuY29kZSlyZXR1cm4gWWUoS3QoYEVtaXR0ZWQgcHJlYnVpbHQgY2h1bmtzIG5lZWQgdG8gaGF2ZSBhIHZhbGlkIHN0cmluZyBjb2RlLCByZWNlaXZlZCAiJHtlLmNvZGV9Ii5gKSk7aWYoInN0cmluZyIhPXR5cGVvZiBlLmZpbGVOYW1lfHxUKGUuZmlsZU5hbWUpKXJldHVybiBZZShLdChgVGhlICJmaWxlTmFtZSIgcHJvcGVydHkgb2YgZW1pdHRlZCBwcmVidWlsdCBjaHVua3MgbXVzdCBiZSBzdHJpbmdzIHRoYXQgYXJlIG5laXRoZXIgYWJzb2x1dGUgbm9yIHJlbGF0aXZlIHBhdGhzLCByZWNlaXZlZCAiJHtlLmZpbGVOYW1lfSIuYCkpO2NvbnN0IHQ9e2NvZGU6ZS5jb2RlLGV4cG9ydHM6ZS5leHBvcnRzLGZpbGVOYW1lOmUuZmlsZU5hbWUsbWFwOmUubWFwLHJlZmVyZW5jZUlkOiIiLHR5cGU6InByZWJ1aWx0LWNodW5rIn0scz10aGlzLmFzc2lnblJlZmVyZW5jZUlkKHQsdC5maWxlTmFtZSk7cmV0dXJuIHRoaXMub3V0cHV0JiYodGhpcy5vdXRwdXQuYnVuZGxlW3QuZmlsZU5hbWVdPXRoaXMuY3JlYXRlUHJlYnVpbHRDaHVuayh0KSksc31maW5hbGl6ZUFkZGl0aW9uYWxBc3NldChlLHQse2J1bmRsZTpzLGZpbGVOYW1lc0J5U291cmNlOmksb3V0cHV0T3B0aW9uczpufSl7bGV0e2ZpbGVOYW1lOnIsbmVlZHNDb2RlUmVmZXJlbmNlOm8scmVmZXJlbmNlSWQ6YX09ZTtpZighcil7Y29uc3Qgbz1odSh0KTtyPWkuZ2V0KG8pLHJ8fChyPXV1KGUubmFtZSx0LG8sbixzKSxpLnNldChvLHIpKTt9Y29uc3QgbD17Li4uZSxmaWxlTmFtZTpyLHNvdXJjZTp0fTt0aGlzLmZpbGVzQnlSZWZlcmVuY2VJZC5zZXQoYSxsKTtjb25zdCBjPXNbcl07ImFzc2V0Ij09PWM/LnR5cGU/Yy5uZWVkc0NvZGVSZWZlcmVuY2UmJihjLm5lZWRzQ29kZVJlZmVyZW5jZT1vKTpzW3JdPXtmaWxlTmFtZTpyLG5hbWU6ZS5uYW1lLG5lZWRzQ29kZVJlZmVyZW5jZTpvLHNvdXJjZTp0LHR5cGU6ImFzc2V0In07fWZpbmFsaXplQXNzZXRzV2l0aFNhbWVTb3VyY2UoZSx0LHtidW5kbGU6cyxmaWxlTmFtZXNCeVNvdXJjZTppLG91dHB1dE9wdGlvbnM6bn0pe2xldCByLG89IiIsYT0hMDtmb3IoY29uc3QgaSBvZiBlKXthJiYoYT1pLm5lZWRzQ29kZVJlZmVyZW5jZSk7Y29uc3QgZT11dShpLm5hbWUsaS5zb3VyY2UsdCxuLHMpOyghb3x8ZS5sZW5ndGg8by5sZW5ndGh8fGUubGVuZ3RoPT09by5sZW5ndGgmJmU8bykmJihvPWUscj1pKTt9aS5zZXQodCxvKTtmb3IoY29uc3QgdCBvZiBlKXtjb25zdCBlPXsuLi50LGZpbGVOYW1lOm99O3RoaXMuZmlsZXNCeVJlZmVyZW5jZUlkLnNldCh0LnJlZmVyZW5jZUlkLGUpO31zW29dPXtmaWxlTmFtZTpvLG5hbWU6ci5uYW1lLG5lZWRzQ29kZVJlZmVyZW5jZTphLHNvdXJjZTpyLnNvdXJjZSx0eXBlOiJhc3NldCJ9O319ZnVuY3Rpb24geHUoZSx0LHMsaSxuKXtyZXR1cm4ga2VbZV08a2Vbbl0/Rmk6KG4scik9PntudWxsIT1yJiZzKHZlLHtjb2RlOmh0LG1lc3NhZ2U6YFBsdWdpbiAiJHtpfSIgdHJpZWQgdG8gYWRkIGEgZmlsZSBwb3NpdGlvbiB0byBhIGxvZyBvciB3YXJuaW5nLiBUaGlzIGlzIG9ubHkgc3VwcG9ydGVkIGluIHRoZSAidHJhbnNmb3JtIiBob29rIGF0IHRoZSBtb21lbnQgYW5kIHdpbGwgYmUgaWdub3JlZC5gfSksKG49S2gobikpLmNvZGUmJiFuLnBsdWdpbkNvZGUmJihuLnBsdWdpbkNvZGU9bi5jb2RlKSxuLmNvZGU9dCxuLnBsdWdpbj1pLHMoZSxuKTt9fWZ1bmN0aW9uIEV1KHQscyxpLG4scixvKXtjb25zdHtsb2dMZXZlbDphLG9uTG9nOmx9PW47bGV0IGMsaD0hMDtpZigic3RyaW5nIiE9dHlwZW9mIHQuY2FjaGVLZXkmJih0Lm5hbWUuc3RhcnRzV2l0aChGaCl8fHQubmFtZS5zdGFydHNXaXRoKGpoKXx8by5oYXModC5uYW1lKT9oPSExOm8uYWRkKHQubmFtZSkpLHMpaWYoaCl7Y29uc3QgZT10LmNhY2hlS2V5fHx0Lm5hbWU7ZD1zW2VdfHwoc1tlXT1PYmplY3QuY3JlYXRlKG51bGwpKSxjPXtkZWxldGU6ZT0+ZGVsZXRlIGRbZV0sZ2V0KGUpe2NvbnN0IHQ9ZFtlXTtpZih0KXJldHVybiB0WzBdPTAsdFsxXX0saGFzKGUpe2NvbnN0IHQ9ZFtlXTtyZXR1cm4gISF0JiYodFswXT0wLCEwKX0sc2V0KGUsdCl7ZFtlXT1bMCx0XTt9fTt9ZWxzZSB1PXQubmFtZSxjPXtkZWxldGU6KCk9PkdoKHUpLGdldDooKT0+R2godSksaGFzOigpPT5HaCh1KSxzZXQ6KCk9PkdoKHUpfTtlbHNlIGM9VWg7dmFyIHUsZDtyZXR1cm4ge2FkZFdhdGNoRmlsZShlKXtpZihpLnBoYXNlPj1tby5HRU5FUkFURSlyZXR1cm4gdGhpcy5lcnJvcih7Y29kZTpwdCxtZXNzYWdlOidDYW5ub3QgY2FsbCAiYWRkV2F0Y2hGaWxlIiBhZnRlciB0aGUgYnVpbGQgaGFzIGZpbmlzaGVkLid9KTtpLndhdGNoRmlsZXNbZV09ITA7fSxjYWNoZTpjLGRlYnVnOnh1KEFlLCJQTFVHSU5fTE9HIixsLHQubmFtZSxhKSxlbWl0RmlsZTpyLmVtaXRGaWxlLmJpbmQociksZXJyb3I6ZT0+WWUoR3QoS2goZSksdC5uYW1lKSksZ2V0RmlsZU5hbWU6ci5nZXRGaWxlTmFtZSxnZXRNb2R1bGVJZHM6KCk9PmkubW9kdWxlc0J5SWQua2V5cygpLGdldE1vZHVsZUluZm86aS5nZXRNb2R1bGVJbmZvLGdldFdhdGNoRmlsZXM6KCk9Pk9iamVjdC5rZXlzKGkud2F0Y2hGaWxlcyksaW5mbzp4dShTZSwiUExVR0lOX0xPRyIsbCx0Lm5hbWUsYSksbG9hZDplPT5pLm1vZHVsZUxvYWRlci5wcmVsb2FkTW9kdWxlKGUpLG1ldGE6e3JvbGx1cFZlcnNpb246ZSx3YXRjaE1vZGU6aS53YXRjaE1vZGV9LGdldCBtb2R1bGVJZHMoKXtjb25zdCBlPWkubW9kdWxlc0J5SWQua2V5cygpO3JldHVybiBmdW5jdGlvbiooKXtZdChgQWNjZXNzaW5nICJ0aGlzLm1vZHVsZUlkcyIgb24gdGhlIHBsdWdpbiBjb250ZXh0IGJ5IHBsdWdpbiAke3QubmFtZX0gaXMgZGVwcmVjYXRlZC4gVGhlICJ0aGlzLmdldE1vZHVsZUlkcyIgcGx1Z2luIGNvbnRleHQgZnVuY3Rpb24gc2hvdWxkIGJlIHVzZWQgaW5zdGVhZC5gLCJwbHVnaW4tZGV2ZWxvcG1lbnQvI3RoaXMtZ2V0bW9kdWxlaWRzIiwhMCxuLHQubmFtZSkseWllbGQqZTt9KCl9LHBhcnNlOmkuY29udGV4dFBhcnNlLmJpbmQoaSkscmVzb2x2ZTooZSxzLHthc3NlcnRpb25zOm4sY3VzdG9tOnIsaXNFbnRyeTpvLHNraXBTZWxmOmF9PXBlKT0+aS5tb2R1bGVMb2FkZXIucmVzb2x2ZUlkKGUscyxyLG8sbnx8ZmUsYT9be2ltcG9ydGVyOnMscGx1Z2luOnQsc291cmNlOmV9XTpudWxsKSxzZXRBc3NldFNvdXJjZTpyLnNldEFzc2V0U291cmNlLHdhcm46eHUodmUsIlBMVUdJTl9XQVJOSU5HIixsLHQubmFtZSxhKX19Y29uc3QgYnU9T2JqZWN0LmtleXMoe2J1aWxkRW5kOjEsYnVpbGRTdGFydDoxLGNsb3NlQnVuZGxlOjEsY2xvc2VXYXRjaGVyOjEsbG9hZDoxLG1vZHVsZVBhcnNlZDoxLG9uTG9nOjEsb3B0aW9uczoxLHJlc29sdmVEeW5hbWljSW1wb3J0OjEscmVzb2x2ZUlkOjEsc2hvdWxkVHJhbnNmb3JtQ2FjaGVkTW9kdWxlOjEsdHJhbnNmb3JtOjEsd2F0Y2hDaGFuZ2U6MX0pO2NsYXNzIHZ1e2NvbnN0cnVjdG9yKGUsdCxzLGksbil7dGhpcy5ncmFwaD1lLHRoaXMub3B0aW9ucz10LHRoaXMucGx1Z2luQ2FjaGU9aSx0aGlzLnNvcnRlZFBsdWdpbnM9bmV3IE1hcCx0aGlzLnVuZnVsZmlsbGVkQWN0aW9ucz1uZXcgU2V0LHRoaXMuZmlsZUVtaXR0ZXI9bmV3IHl1KGUsdCxuJiZuLmZpbGVFbWl0dGVyKSx0aGlzLmVtaXRGaWxlPXRoaXMuZmlsZUVtaXR0ZXIuZW1pdEZpbGUuYmluZCh0aGlzLmZpbGVFbWl0dGVyKSx0aGlzLmdldEZpbGVOYW1lPXRoaXMuZmlsZUVtaXR0ZXIuZ2V0RmlsZU5hbWUuYmluZCh0aGlzLmZpbGVFbWl0dGVyKSx0aGlzLmZpbmFsaXNlQXNzZXRzPXRoaXMuZmlsZUVtaXR0ZXIuZmluYWxpc2VBc3NldHMuYmluZCh0aGlzLmZpbGVFbWl0dGVyKSx0aGlzLnNldENodW5rSW5mb3JtYXRpb249dGhpcy5maWxlRW1pdHRlci5zZXRDaHVua0luZm9ybWF0aW9uLmJpbmQodGhpcy5maWxlRW1pdHRlciksdGhpcy5zZXRPdXRwdXRCdW5kbGU9dGhpcy5maWxlRW1pdHRlci5zZXRPdXRwdXRCdW5kbGUuYmluZCh0aGlzLmZpbGVFbWl0dGVyKSx0aGlzLnBsdWdpbnM9Wy4uLm4/bi5wbHVnaW5zOltdLC4uLnNdO2NvbnN0IHI9bmV3IFNldDtpZih0aGlzLnBsdWdpbkNvbnRleHRzPW5ldyBNYXAodGhpcy5wbHVnaW5zLm1hcCgocz0+W3MsRXUocyxpLGUsdCx0aGlzLmZpbGVFbWl0dGVyLHIpXSkpKSxuKWZvcihjb25zdCBlIG9mIHMpZm9yKGNvbnN0IHMgb2YgYnUpcyBpbiBlJiZ0Lm9uTG9nKHZlLChvPWUubmFtZSx7Y29kZToiSU5QVVRfSE9PS19JTl9PVVRQVVRfUExVR0lOIixtZXNzYWdlOmBUaGUgIiR7c30iIGhvb2sgdXNlZCBieSB0aGUgb3V0cHV0IHBsdWdpbiAke299IGlzIGEgYnVpbGQgdGltZSBob29rIGFuZCB3aWxsIG5vdCBiZSBydW4gZm9yIHRoYXQgcGx1Z2luLiBFaXRoZXIgdGhpcyBwbHVnaW4gY2Fubm90IGJlIHVzZWQgYXMgYW4gb3V0cHV0IHBsdWdpbiwgb3IgaXQgc2hvdWxkIGhhdmUgYW4gb3B0aW9uIHRvIGNvbmZpZ3VyZSBpdCBhcyBhbiBvdXRwdXQgcGx1Z2luLmB9KSk7dmFyIG87fWNyZWF0ZU91dHB1dFBsdWdpbkRyaXZlcihlKXtyZXR1cm4gbmV3IHZ1KHRoaXMuZ3JhcGgsdGhpcy5vcHRpb25zLGUsdGhpcy5wbHVnaW5DYWNoZSx0aGlzKX1nZXRVbmZ1bGZpbGxlZEhvb2tBY3Rpb25zKCl7cmV0dXJuIHRoaXMudW5mdWxmaWxsZWRBY3Rpb25zfWhvb2tGaXJzdChlLHQscyxpKXtyZXR1cm4gdGhpcy5ob29rRmlyc3RBbmRHZXRQbHVnaW4oZSx0LHMsaSkudGhlbigoZT0+ZSYmZVswXSkpfWFzeW5jIGhvb2tGaXJzdEFuZEdldFBsdWdpbihlLHQscyxpKXtmb3IoY29uc3QgbiBvZiB0aGlzLmdldFNvcnRlZFBsdWdpbnMoZSkpe2lmKGk/LmhhcyhuKSljb250aW51ZTtjb25zdCByPWF3YWl0IHRoaXMucnVuSG9vayhlLHQsbixzKTtpZihudWxsIT1yKXJldHVybiBbcixuXX1yZXR1cm4gbnVsbH1ob29rRmlyc3RTeW5jKGUsdCxzKXtmb3IoY29uc3QgaSBvZiB0aGlzLmdldFNvcnRlZFBsdWdpbnMoZSkpe2NvbnN0IG49dGhpcy5ydW5Ib29rU3luYyhlLHQsaSxzKTtpZihudWxsIT1uKXJldHVybiBufXJldHVybiBudWxsfWFzeW5jIGhvb2tQYXJhbGxlbChlLHQscyl7Y29uc3QgaT1bXTtmb3IoY29uc3QgbiBvZiB0aGlzLmdldFNvcnRlZFBsdWdpbnMoZSkpbltlXS5zZXF1ZW50aWFsPyhhd2FpdCBQcm9taXNlLmFsbChpKSxpLmxlbmd0aD0wLGF3YWl0IHRoaXMucnVuSG9vayhlLHQsbixzKSk6aS5wdXNoKHRoaXMucnVuSG9vayhlLHQsbixzKSk7YXdhaXQgUHJvbWlzZS5hbGwoaSk7fWhvb2tSZWR1Y2VBcmcwKGUsW3QsLi4uc10saSxuKXtsZXQgcj1Qcm9taXNlLnJlc29sdmUodCk7Zm9yKGNvbnN0IHQgb2YgdGhpcy5nZXRTb3J0ZWRQbHVnaW5zKGUpKXI9ci50aGVuKChyPT50aGlzLnJ1bkhvb2soZSxbciwuLi5zXSx0LG4pLnRoZW4oKGU9PmkuY2FsbCh0aGlzLnBsdWdpbkNvbnRleHRzLmdldCh0KSxyLGUsdCkpKSkpO3JldHVybiByfWhvb2tSZWR1Y2VBcmcwU3luYyhlLFt0LC4uLnNdLGksbil7Zm9yKGNvbnN0IHIgb2YgdGhpcy5nZXRTb3J0ZWRQbHVnaW5zKGUpKXtjb25zdCBvPVt0LC4uLnNdLGE9dGhpcy5ydW5Ib29rU3luYyhlLG8scixuKTt0PWkuY2FsbCh0aGlzLnBsdWdpbkNvbnRleHRzLmdldChyKSx0LGEscik7fXJldHVybiB0fWFzeW5jIGhvb2tSZWR1Y2VWYWx1ZShlLHQscyxpKXtjb25zdCBuPVtdLHI9W107Zm9yKGNvbnN0IHQgb2YgdGhpcy5nZXRTb3J0ZWRQbHVnaW5zKGUsa3UpKXRbZV0uc2VxdWVudGlhbD8obi5wdXNoKC4uLmF3YWl0IFByb21pc2UuYWxsKHIpKSxyLmxlbmd0aD0wLG4ucHVzaChhd2FpdCB0aGlzLnJ1bkhvb2soZSxzLHQpKSk6ci5wdXNoKHRoaXMucnVuSG9vayhlLHMsdCkpO3JldHVybiBuLnB1c2goLi4uYXdhaXQgUHJvbWlzZS5hbGwocikpLG4ucmVkdWNlKGksYXdhaXQgdCl9aG9va1JlZHVjZVZhbHVlU3luYyhlLHQscyxpLG4pe2xldCByPXQ7Zm9yKGNvbnN0IHQgb2YgdGhpcy5nZXRTb3J0ZWRQbHVnaW5zKGUpKXtjb25zdCBvPXRoaXMucnVuSG9va1N5bmMoZSxzLHQsbik7cj1pLmNhbGwodGhpcy5wbHVnaW5Db250ZXh0cy5nZXQodCkscixvLHQpO31yZXR1cm4gcn1ob29rU2VxKGUsdCxzKXtsZXQgaT1Qcm9taXNlLnJlc29sdmUoKTtmb3IoY29uc3QgbiBvZiB0aGlzLmdldFNvcnRlZFBsdWdpbnMoZSkpaT1pLnRoZW4oKCgpPT50aGlzLnJ1bkhvb2soZSx0LG4scykpKTtyZXR1cm4gaS50aGVuKEl1KX1nZXRTb3J0ZWRQbHVnaW5zKGUsdCl7cmV0dXJuIEYkMyh0aGlzLnNvcnRlZFBsdWdpbnMsZSwoKCk9PlN1KGUsdGhpcy5wbHVnaW5zLHQpKSl9cnVuSG9vayhlLHQscyxpKXtjb25zdCBuPXNbZV0scj0ib2JqZWN0Ij09dHlwZW9mIG4/bi5oYW5kbGVyOm47bGV0IG89dGhpcy5wbHVnaW5Db250ZXh0cy5nZXQocyk7aSYmKG89aShvLHMpKTtsZXQgYT1udWxsO3JldHVybiBQcm9taXNlLnJlc29sdmUoKS50aGVuKCgoKT0+e2lmKCJmdW5jdGlvbiIhPXR5cGVvZiByKXJldHVybiByO2NvbnN0IGk9ci5hcHBseShvLHQpO3JldHVybiBpPy50aGVuPyhhPVtzLm5hbWUsZSx0XSx0aGlzLnVuZnVsZmlsbGVkQWN0aW9ucy5hZGQoYSksUHJvbWlzZS5yZXNvbHZlKGkpLnRoZW4oKGU9Pih0aGlzLnVuZnVsZmlsbGVkQWN0aW9ucy5kZWxldGUoYSksZSkpKSk6aX0pKS5jYXRjaCgodD0+KG51bGwhPT1hJiZ0aGlzLnVuZnVsZmlsbGVkQWN0aW9ucy5kZWxldGUoYSksWWUoR3QodCxzLm5hbWUse2hvb2s6ZX0pKSkpKX1ydW5Ib29rU3luYyhlLHQscyxpKXtjb25zdCBuPXNbZV0scj0ib2JqZWN0Ij09dHlwZW9mIG4/bi5oYW5kbGVyOm47bGV0IG89dGhpcy5wbHVnaW5Db250ZXh0cy5nZXQocyk7aSYmKG89aShvLHMpKTt0cnl7cmV0dXJuIHIuYXBwbHkobyx0KX1jYXRjaCh0KXtyZXR1cm4gWWUoR3QodCxzLm5hbWUse2hvb2s6ZX0pKX19fWZ1bmN0aW9uIFN1KGUsdCxzPUF1KXtjb25zdCBpPVtdLG49W10scj1bXTtmb3IoY29uc3QgbyBvZiB0KXtjb25zdCB0PW9bZV07aWYodCl7aWYoIm9iamVjdCI9PXR5cGVvZiB0KXtpZihzKHQuaGFuZGxlcixlLG8pLCJwcmUiPT09dC5vcmRlcil7aS5wdXNoKG8pO2NvbnRpbnVlfWlmKCJwb3N0Ij09PXQub3JkZXIpe3IucHVzaChvKTtjb250aW51ZX19ZWxzZSBzKHQsZSxvKTtuLnB1c2gobyk7fX1yZXR1cm4gWy4uLmksLi4ubiwuLi5yXX1mdW5jdGlvbiBBdShlLHQscyl7ImZ1bmN0aW9uIiE9dHlwZW9mIGUmJlllKGZ1bmN0aW9uKGUsdCl7cmV0dXJuIHtjb2RlOmR0LGhvb2s6ZSxtZXNzYWdlOmBFcnJvciBydW5uaW5nIHBsdWdpbiBob29rICIke2V9IiBmb3IgcGx1Z2luICIke3R9IiwgZXhwZWN0ZWQgYSBmdW5jdGlvbiBob29rIG9yIGFuIG9iamVjdCB3aXRoIGEgImhhbmRsZXIiIGZ1bmN0aW9uLmAscGx1Z2luOnR9fSh0LHMubmFtZSkpO31mdW5jdGlvbiBrdShlLHQscyl7aWYoInN0cmluZyIhPXR5cGVvZiBlJiYiZnVuY3Rpb24iIT10eXBlb2YgZSlyZXR1cm4gWWUoZnVuY3Rpb24oZSx0KXtyZXR1cm4ge2NvZGU6ZHQsaG9vazplLG1lc3NhZ2U6YEVycm9yIHJ1bm5pbmcgcGx1Z2luIGhvb2sgIiR7ZX0iIGZvciBwbHVnaW4gIiR7dH0iLCBleHBlY3RlZCBhIHN0cmluZywgYSBmdW5jdGlvbiBob29rIG9yIGFuIG9iamVjdCB3aXRoIGEgImhhbmRsZXIiIHN0cmluZyBvciBmdW5jdGlvbi5gLHBsdWdpbjp0fX0odCxzLm5hbWUpKX1mdW5jdGlvbiBJdSgpe31jbGFzcyB3dXtjb25zdHJ1Y3RvcihlKXt0aGlzLm1heFBhcmFsbGVsPWUsdGhpcy5xdWV1ZT1bXSx0aGlzLndvcmtlckNvdW50PTA7fXJ1bihlKXtyZXR1cm4gbmV3IFByb21pc2UoKCh0LHMpPT57dGhpcy5xdWV1ZS5wdXNoKHtyZWplY3Q6cyxyZXNvbHZlOnQsdGFzazplfSksdGhpcy53b3JrKCk7fSkpfWFzeW5jIHdvcmsoKXtpZih0aGlzLndvcmtlckNvdW50Pj10aGlzLm1heFBhcmFsbGVsKXJldHVybjtsZXQgZTtmb3IodGhpcy53b3JrZXJDb3VudCsrO2U9dGhpcy5xdWV1ZS5zaGlmdCgpOyl7Y29uc3R7cmVqZWN0OnQscmVzb2x2ZTpzLHRhc2s6aX09ZTt0cnl7cyhhd2FpdCBpKCkpO31jYXRjaChlKXt0KGUpO319dGhpcy53b3JrZXJDb3VudC0tO319Y2xhc3MgUHV7Y29uc3RydWN0b3IoZSx0KXtpZih0aGlzLm9wdGlvbnM9ZSx0aGlzLmFzdExydT1mdW5jdGlvbihlKXt2YXIgdCxzLGksbj1lfHwxO2Z1bmN0aW9uIHIoZSxyKXsrK3Q+biYmKGk9cyxvKDEpLCsrdCksc1tlXT1yO31mdW5jdGlvbiBvKGUpe3Q9MCxzPU9iamVjdC5jcmVhdGUobnVsbCksZXx8KGk9T2JqZWN0LmNyZWF0ZShudWxsKSk7fXJldHVybiBvKCkse2NsZWFyOm8saGFzOmZ1bmN0aW9uKGUpe3JldHVybiB2b2lkIDAhPT1zW2VdfHx2b2lkIDAhPT1pW2VdfSxnZXQ6ZnVuY3Rpb24oZSl7dmFyIHQ9c1tlXTtyZXR1cm4gdm9pZCAwIT09dD90OnZvaWQgMCE9PSh0PWlbZV0pPyhyKGUsdCksdCk6dm9pZCAwfSxzZXQ6ZnVuY3Rpb24oZSx0KXt2b2lkIDAhPT1zW2VdP3NbZV09dDpyKGUsdCk7fX19KDUpLHRoaXMuY2FjaGVkTW9kdWxlcz1uZXcgTWFwLHRoaXMuZGVvcHRpbWl6YXRpb25UcmFja2VyPW5ldyBKLHRoaXMuZW50cnlNb2R1bGVzPVtdLHRoaXMubW9kdWxlc0J5SWQ9bmV3IE1hcCx0aGlzLm5lZWRzVHJlZXNoYWtpbmdQYXNzPSExLHRoaXMucGhhc2U9bW8uTE9BRF9BTkRfUEFSU0UsdGhpcy5zY29wZT1uZXcgY3UsdGhpcy53YXRjaEZpbGVzPU9iamVjdC5jcmVhdGUobnVsbCksdGhpcy53YXRjaE1vZGU9ITEsdGhpcy5leHRlcm5hbE1vZHVsZXM9W10sdGhpcy5pbXBsaWNpdEVudHJ5TW9kdWxlcz1bXSx0aGlzLm1vZHVsZXM9W10sdGhpcy5nZXRNb2R1bGVJbmZvPWU9Pntjb25zdCB0PXRoaXMubW9kdWxlc0J5SWQuZ2V0KGUpO3JldHVybiB0P3QuaW5mbzpudWxsfSwhMSE9PWUuY2FjaGUpe2lmKGUuY2FjaGU/Lm1vZHVsZXMpZm9yKGNvbnN0IHQgb2YgZS5jYWNoZS5tb2R1bGVzKXRoaXMuY2FjaGVkTW9kdWxlcy5zZXQodC5pZCx0KTt0aGlzLnBsdWdpbkNhY2hlPWUuY2FjaGU/LnBsdWdpbnN8fE9iamVjdC5jcmVhdGUobnVsbCk7Zm9yKGNvbnN0IGUgaW4gdGhpcy5wbHVnaW5DYWNoZSl7Y29uc3QgdD10aGlzLnBsdWdpbkNhY2hlW2VdO2Zvcihjb25zdCBlIG9mIE9iamVjdC52YWx1ZXModCkpZVswXSsrO319aWYodCl7dGhpcy53YXRjaE1vZGU9ITA7Y29uc3QgZT0oLi4uZSk9PnRoaXMucGx1Z2luRHJpdmVyLmhvb2tQYXJhbGxlbCgid2F0Y2hDaGFuZ2UiLGUpLHM9KCk9PnRoaXMucGx1Z2luRHJpdmVyLmhvb2tQYXJhbGxlbCgiY2xvc2VXYXRjaGVyIixbXSk7dC5vbkN1cnJlbnRSdW4oImNoYW5nZSIsZSksdC5vbkN1cnJlbnRSdW4oImNsb3NlIixzKTt9dGhpcy5wbHVnaW5Ecml2ZXI9bmV3IHZ1KHRoaXMsZSxlLnBsdWdpbnMsdGhpcy5wbHVnaW5DYWNoZSksdGhpcy5hY29yblBhcnNlcj1SYy5leHRlbmQoLi4uZS5hY29ybkluamVjdFBsdWdpbnMpLHRoaXMubW9kdWxlTG9hZGVyPW5ldyBudSh0aGlzLHRoaXMubW9kdWxlc0J5SWQsdGhpcy5vcHRpb25zLHRoaXMucGx1Z2luRHJpdmVyKSx0aGlzLmZpbGVPcGVyYXRpb25RdWV1ZT1uZXcgd3UoZS5tYXhQYXJhbGxlbEZpbGVPcHMpLHRoaXMucHVyZUZ1bmN0aW9ucz0oKHt0cmVlc2hha2U6ZX0pPT57Y29uc3QgdD1PYmplY3QuY3JlYXRlKG51bGwpO2Zvcihjb25zdCBzIG9mIGU/ZS5tYW51YWxQdXJlRnVuY3Rpb25zOltdKXtsZXQgZT10O2Zvcihjb25zdCB0IG9mIHMuc3BsaXQoIi4iKSllPWVbdF18fChlW3RdPU9iamVjdC5jcmVhdGUobnVsbCkpO2VbemldPSEwO31yZXR1cm4gdH0pKGUpO31hc3luYyBidWlsZCgpeyRvKCJnZW5lcmF0ZSBtb2R1bGUgZ3JhcGgiLDIpLGF3YWl0IHRoaXMuZ2VuZXJhdGVNb2R1bGVHcmFwaCgpLE5vKCJnZW5lcmF0ZSBtb2R1bGUgZ3JhcGgiLDIpLCRvKCJzb3J0IGFuZCBiaW5kIG1vZHVsZXMiLDIpLHRoaXMucGhhc2U9bW8uQU5BTFlTRSx0aGlzLnNvcnRNb2R1bGVzKCksTm8oInNvcnQgYW5kIGJpbmQgbW9kdWxlcyIsMiksJG8oIm1hcmsgaW5jbHVkZWQgc3RhdGVtZW50cyIsMiksdGhpcy5pbmNsdWRlU3RhdGVtZW50cygpLE5vKCJtYXJrIGluY2x1ZGVkIHN0YXRlbWVudHMiLDIpLHRoaXMucGhhc2U9bW8uR0VORVJBVEU7fWNvbnRleHRQYXJzZShlLHQ9e30pe2NvbnN0IHM9dC5vbkNvbW1lbnQsaT1bXTt0Lm9uQ29tbWVudD1zJiYiZnVuY3Rpb24iPT10eXBlb2Ygcz8oZSxuLHIsbywuLi5hKT0+KGkucHVzaCh7ZW5kOm8sc3RhcnQ6cix0eXBlOmU/IkJsb2NrIjoiTGluZSIsdmFsdWU6bn0pLHMuY2FsbCh0LGUsbixyLG8sLi4uYSkpOmk7Y29uc3Qgbj10aGlzLmFjb3JuUGFyc2VyLnBhcnNlKGUsey4uLnRoaXMub3B0aW9ucy5hY29ybiwuLi50fSk7cmV0dXJuICJvYmplY3QiPT10eXBlb2YgcyYmcy5wdXNoKC4uLmkpLHQub25Db21tZW50PXMsZnVuY3Rpb24oZSx0LHMpe2NvbnN0IGk9W10sbj1bXTtmb3IoY29uc3QgdCBvZiBlKXtmb3IoY29uc3RbZSxzXW9mIEtzKXMudGVzdCh0LnZhbHVlKSYmaS5wdXNoKHsuLi50LGFubm90YXRpb25UeXBlOmV9KTt6cy50ZXN0KHQudmFsdWUpJiZuLnB1c2godCk7fWZvcihjb25zdCBlIG9mIG4pWXModCxlLCExKTtVcyh0LHthbm5vdGF0aW9uSW5kZXg6MCxhbm5vdGF0aW9uczppLGNvZGU6c30pO30oaSxuLGUpLG59Z2V0Q2FjaGUoKXtmb3IoY29uc3QgZSBpbiB0aGlzLnBsdWdpbkNhY2hlKXtjb25zdCB0PXRoaXMucGx1Z2luQ2FjaGVbZV07bGV0IHM9ITA7Zm9yKGNvbnN0W2UsaV1vZiBPYmplY3QuZW50cmllcyh0KSlpWzBdPj10aGlzLm9wdGlvbnMuZXhwZXJpbWVudGFsQ2FjaGVFeHBpcnk/ZGVsZXRlIHRbZV06cz0hMTtzJiZkZWxldGUgdGhpcy5wbHVnaW5DYWNoZVtlXTt9cmV0dXJuIHttb2R1bGVzOnRoaXMubW9kdWxlcy5tYXAoKGU9PmUudG9KU09OKCkpKSxwbHVnaW5zOnRoaXMucGx1Z2luQ2FjaGV9fWFzeW5jIGdlbmVyYXRlTW9kdWxlR3JhcGgoKXt2YXIgZTtpZigoe2VudHJ5TW9kdWxlczp0aGlzLmVudHJ5TW9kdWxlcyxpbXBsaWNpdEVudHJ5TW9kdWxlczp0aGlzLmltcGxpY2l0RW50cnlNb2R1bGVzfT1hd2FpdCB0aGlzLm1vZHVsZUxvYWRlci5hZGRFbnRyeU1vZHVsZXMoKGU9dGhpcy5vcHRpb25zLmlucHV0LEFycmF5LmlzQXJyYXkoZSk/ZS5tYXAoKGU9Pih7ZmlsZU5hbWU6bnVsbCxpZDplLGltcGxpY2l0bHlMb2FkZWRBZnRlcjpbXSxpbXBvcnRlcjp2b2lkIDAsbmFtZTpudWxsfSkpKTpPYmplY3QuZW50cmllcyhlKS5tYXAoKChbZSx0XSk9Pih7ZmlsZU5hbWU6bnVsbCxpZDp0LGltcGxpY2l0bHlMb2FkZWRBZnRlcjpbXSxpbXBvcnRlcjp2b2lkIDAsbmFtZTplfSkpKSksITApKSwwPT09dGhpcy5lbnRyeU1vZHVsZXMubGVuZ3RoKXRocm93IG5ldyBFcnJvcigiWW91IG11c3Qgc3VwcGx5IG9wdGlvbnMuaW5wdXQgdG8gcm9sbHVwIik7Zm9yKGNvbnN0IGUgb2YgdGhpcy5tb2R1bGVzQnlJZC52YWx1ZXMoKSllIGluc3RhbmNlb2YgVG8/dGhpcy5tb2R1bGVzLnB1c2goZSk6dGhpcy5leHRlcm5hbE1vZHVsZXMucHVzaChlKTt9aW5jbHVkZVN0YXRlbWVudHMoKXtjb25zdCBlPVsuLi50aGlzLmVudHJ5TW9kdWxlcywuLi50aGlzLmltcGxpY2l0RW50cnlNb2R1bGVzXTtmb3IoY29uc3QgdCBvZiBlKU1vKHQpO2lmKHRoaXMub3B0aW9ucy50cmVlc2hha2Upe2xldCB0PTE7ZG97JG8oYHRyZWVzaGFraW5nIHBhc3MgJHt0fWAsMyksdGhpcy5uZWVkc1RyZWVzaGFraW5nUGFzcz0hMTtmb3IoY29uc3QgZSBvZiB0aGlzLm1vZHVsZXMpZS5pc0V4ZWN1dGVkJiYoIm5vLXRyZWVzaGFrZSI9PT1lLmluZm8ubW9kdWxlU2lkZUVmZmVjdHM/ZS5pbmNsdWRlQWxsSW5CdW5kbGUoKTplLmluY2x1ZGUoKSk7aWYoMT09PXQpZm9yKGNvbnN0IHQgb2YgZSkhMSE9PXQucHJlc2VydmVTaWduYXR1cmUmJih0LmluY2x1ZGVBbGxFeHBvcnRzKCExKSx0aGlzLm5lZWRzVHJlZXNoYWtpbmdQYXNzPSEwKTtObygidHJlZXNoYWtpbmcgcGFzcyAiK3QrKywzKTt9d2hpbGUodGhpcy5uZWVkc1RyZWVzaGFraW5nUGFzcyl9ZWxzZSBmb3IoY29uc3QgZSBvZiB0aGlzLm1vZHVsZXMpZS5pbmNsdWRlQWxsSW5CdW5kbGUoKTtmb3IoY29uc3QgZSBvZiB0aGlzLmV4dGVybmFsTW9kdWxlcyllLndhcm5VbnVzZWRJbXBvcnRzKCk7Zm9yKGNvbnN0IGUgb2YgdGhpcy5pbXBsaWNpdEVudHJ5TW9kdWxlcylmb3IoY29uc3QgdCBvZiBlLmltcGxpY2l0bHlMb2FkZWRBZnRlcil0LmluZm8uaXNFbnRyeXx8dC5pc0luY2x1ZGVkKCl8fFllKGp0KHQpKTt9c29ydE1vZHVsZXMoKXtjb25zdHtvcmRlcmVkTW9kdWxlczplLGN5Y2xlUGF0aHM6dH09ZnVuY3Rpb24oZSl7bGV0IHQ9MDtjb25zdCBzPVtdLGk9bmV3IFNldCxuPW5ldyBTZXQscj1uZXcgTWFwLG89W10sYT1lPT57aWYoZSBpbnN0YW5jZW9mIFRvKXtmb3IoY29uc3QgdCBvZiBlLmRlcGVuZGVuY2llcylyLmhhcyh0KT9pLmhhcyh0KXx8cy5wdXNoKEthKHQsZSxyKSk6KHIuc2V0KHQsZSksYSh0KSk7Zm9yKGNvbnN0IHQgb2YgZS5pbXBsaWNpdGx5TG9hZGVkQmVmb3JlKW4uYWRkKHQpO2Zvcihjb25zdHtyZXNvbHV0aW9uOnR9b2YgZS5keW5hbWljSW1wb3J0cyl0IGluc3RhbmNlb2YgVG8mJm4uYWRkKHQpO28ucHVzaChlKTt9ZS5leGVjSW5kZXg9dCsrLGkuYWRkKGUpO307Zm9yKGNvbnN0IHQgb2YgZSlyLmhhcyh0KXx8KHIuc2V0KHQsbnVsbCksYSh0KSk7Zm9yKGNvbnN0IGUgb2YgbilyLmhhcyhlKXx8KHIuc2V0KGUsbnVsbCksYShlKSk7cmV0dXJuIHtjeWNsZVBhdGhzOnMsb3JkZXJlZE1vZHVsZXM6b319KHRoaXMuZW50cnlNb2R1bGVzKTtmb3IoY29uc3QgZSBvZiB0KXRoaXMub3B0aW9ucy5vbkxvZyh2ZSxPdChlKSk7dGhpcy5tb2R1bGVzPWU7Zm9yKGNvbnN0IGUgb2YgdGhpcy5tb2R1bGVzKWUuYmluZFJlZmVyZW5jZXMoKTt0aGlzLndhcm5Gb3JNaXNzaW5nRXhwb3J0cygpO313YXJuRm9yTWlzc2luZ0V4cG9ydHMoKXtmb3IoY29uc3QgZSBvZiB0aGlzLm1vZHVsZXMpZm9yKGNvbnN0IHQgb2YgZS5pbXBvcnREZXNjcmlwdGlvbnMudmFsdWVzKCkpIioiPT09dC5uYW1lfHx0Lm1vZHVsZS5nZXRWYXJpYWJsZUZvckV4cG9ydE5hbWUodC5uYW1lKVswXXx8ZS5sb2codmUsRnQodC5uYW1lLGUuaWQsdC5tb2R1bGUuaWQpLHQuc3RhcnQpO319ZnVuY3Rpb24gQ3UoZSx0KXtyZXR1cm4gdCgpfWZ1bmN0aW9uICR1KHQscyxpLG4pe3Q9U3UoIm9uTG9nIix0KTtjb25zdCByPWtlW25dLG89KG4sYSxsPWdlKT0+e2lmKCEoa2Vbbl08cikpe2Zvcihjb25zdCBzIG9mIHQpe2lmKGwuaGFzKHMpKWNvbnRpbnVlO2NvbnN0e29uTG9nOnR9PXMsYz1lPT5rZVtlXTxyP0ZpOnQ9Pm8oZSxLaCh0KSxuZXcgU2V0KGwpLmFkZChzKSk7aWYoITE9PT0oImhhbmRsZXIiaW4gdD90LmhhbmRsZXI6dCkuY2FsbCh7ZGVidWc6YyhBZSksZXJyb3I6ZT0+WWUoS2goZSkpLGluZm86YyhTZSksbWV0YTp7cm9sbHVwVmVyc2lvbjplLHdhdGNoTW9kZTppfSx3YXJuOmModmUpfSxuLGEpKXJldHVybn1zKG4sYSk7fX07cmV0dXJuIG99Y29uc3QgTnU9InsiLmNoYXJDb2RlQXQoMCksX3U9IiAiLmNoYXJDb2RlQXQoMCksUnU9ImFzc2VydCI7ZnVuY3Rpb24gTXUoZSl7Y29uc3QgdD1lLmFjb3JufHxEaCx7dG9rVHlwZXM6cyxUb2tlblR5cGU6aX09dDtyZXR1cm4gY2xhc3MgZXh0ZW5kcyBle2NvbnN0cnVjdG9yKC4uLmUpe3N1cGVyKC4uLmUpLHRoaXMuYXNzZXJ0VG9rZW49bmV3IGkoUnUpO31fY29kZUF0KGUpe3JldHVybiB0aGlzLmlucHV0LmNoYXJDb2RlQXQoZSl9X2VhdChlKXt0aGlzLnR5cGUhPT1lJiZ0aGlzLnVuZXhwZWN0ZWQoKSx0aGlzLm5leHQoKTt9cmVhZFRva2VuKGUpe2xldCB0PTA7Zm9yKDt0PDY7dCsrKWlmKHRoaXMuX2NvZGVBdCh0aGlzLnBvcyt0KSE9PVJ1LmNoYXJDb2RlQXQodCkpcmV0dXJuIHN1cGVyLnJlYWRUb2tlbihlKTtmb3IoO3RoaXMuX2NvZGVBdCh0aGlzLnBvcyt0KSE9PU51O3QrKylpZih0aGlzLl9jb2RlQXQodGhpcy5wb3MrdCkhPT1fdSlyZXR1cm4gc3VwZXIucmVhZFRva2VuKGUpO3JldHVybiAieyI9PT10aGlzLnR5cGUubGFiZWw/c3VwZXIucmVhZFRva2VuKGUpOih0aGlzLnBvcys9Nix0aGlzLmZpbmlzaFRva2VuKHRoaXMuYXNzZXJ0VG9rZW4pKX1wYXJzZUR5bmFtaWNJbXBvcnQoZSl7aWYodGhpcy5uZXh0KCksZS5zb3VyY2U9dGhpcy5wYXJzZU1heWJlQXNzaWduKCksdGhpcy5lYXQocy5jb21tYSkpe2NvbnN0IHQ9dGhpcy5wYXJzZU9iaighMSk7ZS5hcmd1bWVudHM9W3RdO31yZXR1cm4gdGhpcy5fZWF0KHMucGFyZW5SKSx0aGlzLmZpbmlzaE5vZGUoZSwiSW1wb3J0RXhwcmVzc2lvbiIpfXBhcnNlRXhwb3J0KGUsdCl7aWYodGhpcy5uZXh0KCksdGhpcy5lYXQocy5zdGFyKSl7aWYodGhpcy5vcHRpb25zLmVjbWFWZXJzaW9uPj0xMSYmKHRoaXMuZWF0Q29udGV4dHVhbCgiYXMiKT8oZS5leHBvcnRlZD10aGlzLnBhcnNlSWRlbnQoITApLHRoaXMuY2hlY2tFeHBvcnQodCxlLmV4cG9ydGVkLm5hbWUsdGhpcy5sYXN0VG9rU3RhcnQpKTplLmV4cG9ydGVkPW51bGwpLHRoaXMuZXhwZWN0Q29udGV4dHVhbCgiZnJvbSIpLHRoaXMudHlwZSE9PXMuc3RyaW5nJiZ0aGlzLnVuZXhwZWN0ZWQoKSxlLnNvdXJjZT10aGlzLnBhcnNlRXhwckF0b20oKSx0aGlzLnR5cGU9PT10aGlzLmFzc2VydFRva2VufHx0aGlzLnR5cGU9PT1zLl93aXRoKXt0aGlzLm5leHQoKTtjb25zdCB0PXRoaXMucGFyc2VJbXBvcnRBc3NlcnRpb25zKCk7dCYmKGUuYXNzZXJ0aW9ucz10KTt9cmV0dXJuIHRoaXMuc2VtaWNvbG9uKCksdGhpcy5maW5pc2hOb2RlKGUsIkV4cG9ydEFsbERlY2xhcmF0aW9uIil9aWYodGhpcy5lYXQocy5fZGVmYXVsdCkpe3ZhciBpO2lmKHRoaXMuY2hlY2tFeHBvcnQodCwiZGVmYXVsdCIsdGhpcy5sYXN0VG9rU3RhcnQpLHRoaXMudHlwZT09PXMuX2Z1bmN0aW9ufHwoaT10aGlzLmlzQXN5bmNGdW5jdGlvbigpKSl7dmFyIG49dGhpcy5zdGFydE5vZGUoKTt0aGlzLm5leHQoKSxpJiZ0aGlzLm5leHQoKSxlLmRlY2xhcmF0aW9uPXRoaXMucGFyc2VGdW5jdGlvbihuLDUsITEsaSk7fWVsc2UgaWYodGhpcy50eXBlPT09cy5fY2xhc3Mpe3ZhciByPXRoaXMuc3RhcnROb2RlKCk7ZS5kZWNsYXJhdGlvbj10aGlzLnBhcnNlQ2xhc3MociwibnVsbGFibGVJRCIpO31lbHNlIGUuZGVjbGFyYXRpb249dGhpcy5wYXJzZU1heWJlQXNzaWduKCksdGhpcy5zZW1pY29sb24oKTtyZXR1cm4gdGhpcy5maW5pc2hOb2RlKGUsIkV4cG9ydERlZmF1bHREZWNsYXJhdGlvbiIpfWlmKHRoaXMuc2hvdWxkUGFyc2VFeHBvcnRTdGF0ZW1lbnQoKSllLmRlY2xhcmF0aW9uPXRoaXMucGFyc2VTdGF0ZW1lbnQobnVsbCksIlZhcmlhYmxlRGVjbGFyYXRpb24iPT09ZS5kZWNsYXJhdGlvbi50eXBlP3RoaXMuY2hlY2tWYXJpYWJsZUV4cG9ydCh0LGUuZGVjbGFyYXRpb24uZGVjbGFyYXRpb25zKTp0aGlzLmNoZWNrRXhwb3J0KHQsZS5kZWNsYXJhdGlvbi5pZC5uYW1lLGUuZGVjbGFyYXRpb24uaWQuc3RhcnQpLGUuc3BlY2lmaWVycz1bXSxlLnNvdXJjZT1udWxsO2Vsc2Uge2lmKGUuZGVjbGFyYXRpb249bnVsbCxlLnNwZWNpZmllcnM9dGhpcy5wYXJzZUV4cG9ydFNwZWNpZmllcnModCksdGhpcy5lYXRDb250ZXh0dWFsKCJmcm9tIikpe2lmKHRoaXMudHlwZSE9PXMuc3RyaW5nJiZ0aGlzLnVuZXhwZWN0ZWQoKSxlLnNvdXJjZT10aGlzLnBhcnNlRXhwckF0b20oKSx0aGlzLnR5cGU9PT10aGlzLmFzc2VydFRva2VufHx0aGlzLnR5cGU9PT1zLl93aXRoKXt0aGlzLm5leHQoKTtjb25zdCB0PXRoaXMucGFyc2VJbXBvcnRBc3NlcnRpb25zKCk7dCYmKGUuYXNzZXJ0aW9ucz10KTt9fWVsc2Uge2Zvcih2YXIgbz0wLGE9ZS5zcGVjaWZpZXJzO288YS5sZW5ndGg7bys9MSl7dmFyIGw9YVtvXTt0aGlzLmNoZWNrVW5yZXNlcnZlZChsLmxvY2FsKSx0aGlzLmNoZWNrTG9jYWxFeHBvcnQobC5sb2NhbCk7fWUuc291cmNlPW51bGw7fXRoaXMuc2VtaWNvbG9uKCk7fXJldHVybiB0aGlzLmZpbmlzaE5vZGUoZSwiRXhwb3J0TmFtZWREZWNsYXJhdGlvbiIpfXBhcnNlSW1wb3J0KGUpe2lmKHRoaXMubmV4dCgpLHRoaXMudHlwZT09PXMuc3RyaW5nPyhlLnNwZWNpZmllcnM9W10sZS5zb3VyY2U9dGhpcy5wYXJzZUV4cHJBdG9tKCkpOihlLnNwZWNpZmllcnM9dGhpcy5wYXJzZUltcG9ydFNwZWNpZmllcnMoKSx0aGlzLmV4cGVjdENvbnRleHR1YWwoImZyb20iKSxlLnNvdXJjZT10aGlzLnR5cGU9PT1zLnN0cmluZz90aGlzLnBhcnNlRXhwckF0b20oKTp0aGlzLnVuZXhwZWN0ZWQoKSksdGhpcy50eXBlPT09dGhpcy5hc3NlcnRUb2tlbnx8dGhpcy50eXBlPT1zLl93aXRoKXt0aGlzLm5leHQoKTtjb25zdCB0PXRoaXMucGFyc2VJbXBvcnRBc3NlcnRpb25zKCk7dCYmKGUuYXNzZXJ0aW9ucz10KTt9cmV0dXJuIHRoaXMuc2VtaWNvbG9uKCksdGhpcy5maW5pc2hOb2RlKGUsIkltcG9ydERlY2xhcmF0aW9uIil9cGFyc2VJbXBvcnRBc3NlcnRpb25zKCl7dGhpcy5fZWF0KHMuYnJhY2VMKTtjb25zdCBlPXRoaXMucGFyc2VBc3NlcnRFbnRyaWVzKCk7cmV0dXJuIHRoaXMuX2VhdChzLmJyYWNlUiksZX1wYXJzZUFzc2VydEVudHJpZXMoKXtjb25zdCBlPVtdLHQ9bmV3IFNldDtkb3tpZih0aGlzLnR5cGU9PT1zLmJyYWNlUilicmVhaztjb25zdCBpPXRoaXMuc3RhcnROb2RlKCk7bGV0IG47bj10aGlzLnR5cGU9PT1zLnN0cmluZz90aGlzLnBhcnNlTGl0ZXJhbCh0aGlzLnZhbHVlKTp0aGlzLnBhcnNlSWRlbnQoITApLHRoaXMubmV4dCgpLGkua2V5PW4sdC5oYXMoaS5rZXkubmFtZSkmJnRoaXMucmFpc2UodGhpcy5wb3MsIkR1cGxpY2F0ZWQga2V5IGluIGFzc2VydGlvbnMiKSx0LmFkZChpLmtleS5uYW1lKSx0aGlzLnR5cGUhPT1zLnN0cmluZyYmdGhpcy5yYWlzZSh0aGlzLnBvcywiT25seSBzdHJpbmcgaXMgc3VwcG9ydGVkIGFzIGFuIGFzc2VydGlvbiB2YWx1ZSIpLGkudmFsdWU9dGhpcy5wYXJzZUxpdGVyYWwodGhpcy52YWx1ZSksZS5wdXNoKHRoaXMuZmluaXNoTm9kZShpLCJJbXBvcnRBdHRyaWJ1dGUiKSk7fXdoaWxlKHRoaXMuZWF0KHMuY29tbWEpKTtyZXR1cm4gZX19fWZ1bmN0aW9uIE91KGUpe3JldHVybiBBcnJheS5pc0FycmF5KGUpP2UuZmlsdGVyKEJvb2xlYW4pOmU/W2VdOltdfWNvbnN0IER1PWU9Pih7ZWNtYVZlcnNpb246ImxhdGVzdCIsc291cmNlVHlwZToibW9kdWxlIiwuLi5lLmFjb3JufSksTHU9ZT0+W011LC4uLk91KGUuYWNvcm5JbmplY3RQbHVnaW5zKV0sVHU9ZT0+ITA9PT1lLmNhY2hlP3ZvaWQgMDplLmNhY2hlPy5jYWNoZXx8ZS5jYWNoZSxWdT1lPT57aWYoITA9PT1lKXJldHVybiAoKT0+ITA7aWYoImZ1bmN0aW9uIj09dHlwZW9mIGUpcmV0dXJuICh0LC4uLnMpPT4hdC5zdGFydHNXaXRoKCJcMCIpJiZlKHQsLi4ucyl8fCExO2lmKGUpe2NvbnN0IHQ9bmV3IFNldCxzPVtdO2Zvcihjb25zdCBpIG9mIE91KGUpKWkgaW5zdGFuY2VvZiBSZWdFeHA/cy5wdXNoKGkpOnQuYWRkKGkpO3JldHVybiAoZSwuLi5pKT0+dC5oYXMoZSl8fHMuc29tZSgodD0+dC50ZXN0KGUpKSl9cmV0dXJuICgpPT4hMX0sQnU9KGUsdCxzKT0+e2NvbnN0IGk9ZS5pbmxpbmVEeW5hbWljSW1wb3J0cztyZXR1cm4gaSYmWHQoJ1RoZSAiaW5saW5lRHluYW1pY0ltcG9ydHMiIG9wdGlvbiBpcyBkZXByZWNhdGVkLiBVc2UgdGhlICJvdXRwdXQuaW5saW5lRHluYW1pY0ltcG9ydHMiIG9wdGlvbiBpbnN0ZWFkLicsVWUsITAsdCxzKSxpfSx6dT1lPT57Y29uc3QgdD1lLmlucHV0O3JldHVybiBudWxsPT10P1tdOiJzdHJpbmciPT10eXBlb2YgdD9bdF06dH0sRnU9KGUsdCxzKT0+e2NvbnN0IGk9ZS5tYW51YWxDaHVua3M7cmV0dXJuIGkmJlh0KCdUaGUgIm1hbnVhbENodW5rcyIgb3B0aW9uIGlzIGRlcHJlY2F0ZWQuIFVzZSB0aGUgIm91dHB1dC5tYW51YWxDaHVua3MiIG9wdGlvbiBpbnN0ZWFkLicsV2UsITAsdCxzKSxpfSxqdT0oZSx0LHMpPT57Y29uc3QgaT1lLm1heFBhcmFsbGVsRmlsZVJlYWRzOyJudW1iZXIiPT10eXBlb2YgaSYmWHQoJ1RoZSAibWF4UGFyYWxsZWxGaWxlUmVhZHMiIG9wdGlvbiBpcyBkZXByZWNhdGVkLiBVc2UgdGhlICJtYXhQYXJhbGxlbEZpbGVPcHMiIG9wdGlvbiBpbnN0ZWFkLicsImNvbmZpZ3VyYXRpb24tb3B0aW9ucy8jbWF4cGFyYWxsZWxmaWxlb3BzIiwhMCx0LHMpO2NvbnN0IG49ZS5tYXhQYXJhbGxlbEZpbGVPcHM/P2k7cmV0dXJuICJudW1iZXIiPT10eXBlb2Ygbj9uPD0wPzEvMDpuOjIwfSxVdT0oZSx0KT0+e2NvbnN0IHM9ZS5tb2R1bGVDb250ZXh0O2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBzKXJldHVybiBlPT5zKGUpPz90O2lmKHMpe2NvbnN0IGU9T2JqZWN0LmNyZWF0ZShudWxsKTtmb3IoY29uc3RbdCxpXW9mIE9iamVjdC5lbnRyaWVzKHMpKWVbTiQ1KHQpXT1pO3JldHVybiBzPT5lW3NdPz90fXJldHVybiAoKT0+dH0sR3U9KGUsdCxzKT0+e2NvbnN0IGk9ZS5wcmVzZXJ2ZU1vZHVsZXM7cmV0dXJuIGkmJlh0KCdUaGUgInByZXNlcnZlTW9kdWxlcyIgb3B0aW9uIGlzIGRlcHJlY2F0ZWQuIFVzZSB0aGUgIm91dHB1dC5wcmVzZXJ2ZU1vZHVsZXMiIG9wdGlvbiBpbnN0ZWFkLicsImNvbmZpZ3VyYXRpb24tb3B0aW9ucy8jb3V0cHV0LXByZXNlcnZlbW9kdWxlcyIsITAsdCxzKSxpfSxXdT1lPT57aWYoITE9PT1lLnRyZWVzaGFrZSlyZXR1cm4gITE7Y29uc3QgdD1ldShlLnRyZWVzaGFrZSxaaCwidHJlZXNoYWtlIiwiY29uZmlndXJhdGlvbi1vcHRpb25zLyN0cmVlc2hha2UiLCJmYWxzZSwgdHJ1ZSwgIik7cmV0dXJuIHthbm5vdGF0aW9uczohMSE9PXQuYW5ub3RhdGlvbnMsY29ycmVjdFZhclZhbHVlQmVmb3JlRGVjbGFyYXRpb246ITA9PT10LmNvcnJlY3RWYXJWYWx1ZUJlZm9yZURlY2xhcmF0aW9uLG1hbnVhbFB1cmVGdW5jdGlvbnM6dC5tYW51YWxQdXJlRnVuY3Rpb25zPz9tZSxtb2R1bGVTaWRlRWZmZWN0czpxdSh0Lm1vZHVsZVNpZGVFZmZlY3RzKSxwcm9wZXJ0eVJlYWRTaWRlRWZmZWN0czoiYWx3YXlzIj09PXQucHJvcGVydHlSZWFkU2lkZUVmZmVjdHM/ImFsd2F5cyI6ITEhPT10LnByb3BlcnR5UmVhZFNpZGVFZmZlY3RzLHRyeUNhdGNoRGVvcHRpbWl6YXRpb246ITEhPT10LnRyeUNhdGNoRGVvcHRpbWl6YXRpb24sdW5rbm93bkdsb2JhbFNpZGVFZmZlY3RzOiExIT09dC51bmtub3duR2xvYmFsU2lkZUVmZmVjdHN9fSxxdT1lPT57aWYoImJvb2xlYW4iPT10eXBlb2YgZSlyZXR1cm4gKCk9PmU7aWYoIm5vLWV4dGVybmFsIj09PWUpcmV0dXJuIChlLHQpPT4hdDtpZigiZnVuY3Rpb24iPT10eXBlb2YgZSlyZXR1cm4gKHQscyk9PiEhdC5zdGFydHNXaXRoKCJcMCIpfHwhMSE9PWUodCxzKTtpZihBcnJheS5pc0FycmF5KGUpKXtjb25zdCB0PW5ldyBTZXQoZSk7cmV0dXJuIGU9PnQuaGFzKGUpfXJldHVybiBlJiZZZSh6dCgidHJlZXNoYWtlLm1vZHVsZVNpZGVFZmZlY3RzIiwiY29uZmlndXJhdGlvbi1vcHRpb25zLyN0cmVlc2hha2UtbW9kdWxlc2lkZWVmZmVjdHMiLCdwbGVhc2UgdXNlIG9uZSBvZiBmYWxzZSwgIm5vLWV4dGVybmFsIiwgYSBmdW5jdGlvbiBvciBhbiBhcnJheScpKSwoKT0+ITB9LEh1PS9bXHUwMDAwLVx1MDAxRiIjJCYqKyw6Ozw9Pj9bXF1eYHt8fVx1MDA3Rl0vZyxLdT0vXlthLXpdOi9pO2Z1bmN0aW9uIFl1KGUpe2NvbnN0IHQ9S3UuZXhlYyhlKSxzPXQ/dFswXToiIjtyZXR1cm4gcytlLnNsaWNlKHMubGVuZ3RoKS5yZXBsYWNlKEh1LCJfIil9Y29uc3QgWHU9KGUsdCxzKT0+e2NvbnN0e2ZpbGU6aX09ZTtpZigic3RyaW5nIj09dHlwZW9mIGkpe2lmKHQpcmV0dXJuIFllKHp0KCJvdXRwdXQuZmlsZSIsVGUsJ3lvdSBtdXN0IHNldCAib3V0cHV0LmRpciIgaW5zdGVhZCBvZiAib3V0cHV0LmZpbGUiIHdoZW4gdXNpbmcgdGhlICJvdXRwdXQucHJlc2VydmVNb2R1bGVzIiBvcHRpb24nKSk7aWYoIUFycmF5LmlzQXJyYXkocy5pbnB1dCkpcmV0dXJuIFllKHp0KCJvdXRwdXQuZmlsZSIsVGUsJ3lvdSBtdXN0IHNldCAib3V0cHV0LmRpciIgaW5zdGVhZCBvZiAib3V0cHV0LmZpbGUiIHdoZW4gcHJvdmlkaW5nIG5hbWVkIGlucHV0cycpKX1yZXR1cm4gaX0sUXU9ZT0+e2NvbnN0IHQ9ZS5mb3JtYXQ7c3dpdGNoKHQpe2Nhc2Ugdm9pZCAwOmNhc2UiZXMiOmNhc2UiZXNtIjpjYXNlIm1vZHVsZSI6cmV0dXJuICJlcyI7Y2FzZSJjanMiOmNhc2UiY29tbW9uanMiOnJldHVybiAiY2pzIjtjYXNlInN5c3RlbSI6Y2FzZSJzeXN0ZW1qcyI6cmV0dXJuICJzeXN0ZW0iO2Nhc2UiYW1kIjpjYXNlImlpZmUiOmNhc2UidW1kIjpyZXR1cm4gdDtkZWZhdWx0OnJldHVybiBZZSh6dCgib3V0cHV0LmZvcm1hdCIsemUsJ1ZhbGlkIHZhbHVlcyBhcmUgImFtZCIsICJjanMiLCAic3lzdGVtIiwgImVzIiwgImlpZmUiIG9yICJ1bWQiJyx0KSl9fSxadT0oZSx0KT0+e2NvbnN0IHM9KGUuaW5saW5lRHluYW1pY0ltcG9ydHM/P3QuaW5saW5lRHluYW1pY0ltcG9ydHMpfHwhMSx7aW5wdXQ6aX09dDtyZXR1cm4gcyYmKEFycmF5LmlzQXJyYXkoaSk/aTpPYmplY3Qua2V5cyhpKSkubGVuZ3RoPjE/WWUoenQoIm91dHB1dC5pbmxpbmVEeW5hbWljSW1wb3J0cyIsVWUsJ211bHRpcGxlIGlucHV0cyBhcmUgbm90IHN1cHBvcnRlZCB3aGVuICJvdXRwdXQuaW5saW5lRHluYW1pY0ltcG9ydHMiIGlzIHRydWUnKSk6c30sSnU9KGUsdCxzKT0+e2NvbnN0IGk9KGUucHJlc2VydmVNb2R1bGVzPz9zLnByZXNlcnZlTW9kdWxlcyl8fCExO2lmKGkpe2lmKHQpcmV0dXJuIFllKHp0KCJvdXRwdXQuaW5saW5lRHluYW1pY0ltcG9ydHMiLFVlLCd0aGlzIG9wdGlvbiBpcyBub3Qgc3VwcG9ydGVkIGZvciAib3V0cHV0LnByZXNlcnZlTW9kdWxlcyInKSk7aWYoITE9PT1zLnByZXNlcnZlRW50cnlTaWduYXR1cmVzKXJldHVybiBZZSh6dCgicHJlc2VydmVFbnRyeVNpZ25hdHVyZXMiLCJjb25maWd1cmF0aW9uLW9wdGlvbnMvI3ByZXNlcnZlZW50cnlzaWduYXR1cmVzIiwnc2V0dGluZyB0aGlzIG9wdGlvbiB0byBmYWxzZSBpcyBub3Qgc3VwcG9ydGVkIGZvciAib3V0cHV0LnByZXNlcnZlTW9kdWxlcyInKSl9cmV0dXJuIGl9LGVkPShlLHQpPT57Y29uc3Qgcz1lLnByZWZlckNvbnN0O3JldHVybiBudWxsIT1zJiZZdCgnVGhlICJvdXRwdXQucHJlZmVyQ29uc3QiIG9wdGlvbiBpcyBkZXByZWNhdGVkLiBVc2UgdGhlICJvdXRwdXQuZ2VuZXJhdGVkQ29kZS5jb25zdEJpbmRpbmdzIiBvcHRpb24gaW5zdGVhZC4nLCJjb25maWd1cmF0aW9uLW9wdGlvbnMvI291dHB1dC1nZW5lcmF0ZWRjb2RlLWNvbnN0YmluZGluZ3MiLCEwLHQpLCEhc30sdGQ9ZT0+e2NvbnN0e3ByZXNlcnZlTW9kdWxlc1Jvb3Q6dH09ZTtpZihudWxsIT10KXJldHVybiBOJDUodCl9LHNkPWU9Pntjb25zdCB0PXthdXRvSWQ6ITEsYmFzZVBhdGg6IiIsZGVmaW5lOiJkZWZpbmUiLGZvcmNlSnNFeHRlbnNpb25Gb3JJbXBvcnRzOiExLC4uLmUuYW1kfTtyZXR1cm4gKHQuYXV0b0lkfHx0LmJhc2VQYXRoKSYmdC5pZD9ZZSh6dCgib3V0cHV0LmFtZC5pZCIsTGUsJ3RoaXMgb3B0aW9uIGNhbm5vdCBiZSB1c2VkIHRvZ2V0aGVyIHdpdGggIm91dHB1dC5hbWQuYXV0b0lkIi8ib3V0cHV0LmFtZC5iYXNlUGF0aCInKSk6dC5iYXNlUGF0aCYmIXQuYXV0b0lkP1llKHp0KCJvdXRwdXQuYW1kLmJhc2VQYXRoIiwiY29uZmlndXJhdGlvbi1vcHRpb25zLyNvdXRwdXQtYW1kLWJhc2VwYXRoIiwndGhpcyBvcHRpb24gb25seSB3b3JrcyB3aXRoICJvdXRwdXQuYW1kLmF1dG9JZCInKSk6dC5hdXRvSWQ/e2F1dG9JZDohMCxiYXNlUGF0aDp0LmJhc2VQYXRoLGRlZmluZTp0LmRlZmluZSxmb3JjZUpzRXh0ZW5zaW9uRm9ySW1wb3J0czp0LmZvcmNlSnNFeHRlbnNpb25Gb3JJbXBvcnRzfTp7YXV0b0lkOiExLGRlZmluZTp0LmRlZmluZSxmb3JjZUpzRXh0ZW5zaW9uRm9ySW1wb3J0czp0LmZvcmNlSnNFeHRlbnNpb25Gb3JJbXBvcnRzLGlkOnQuaWR9fSxpZD0oZSx0KT0+e2NvbnN0IHM9ZVt0XTtyZXR1cm4gImZ1bmN0aW9uIj09dHlwZW9mIHM/czooKT0+c3x8IiJ9LG5kPShlLHQpPT57Y29uc3R7ZGlyOnN9PWU7cmV0dXJuICJzdHJpbmciPT10eXBlb2YgcyYmInN0cmluZyI9PXR5cGVvZiB0P1llKHp0KCJvdXRwdXQuZGlyIixUZSwneW91IG11c3Qgc2V0IGVpdGhlciAib3V0cHV0LmZpbGUiIGZvciBhIHNpbmdsZS1maWxlIGJ1aWxkIG9yICJvdXRwdXQuZGlyIiB3aGVuIGdlbmVyYXRpbmcgbXVsdGlwbGUgY2h1bmtzJykpOnN9LHJkPShlLHQscyk9Pntjb25zdCBpPWUuZHluYW1pY0ltcG9ydEZ1bmN0aW9uO3JldHVybiBpJiYoWXQoJ1RoZSAib3V0cHV0LmR5bmFtaWNJbXBvcnRGdW5jdGlvbiIgb3B0aW9uIGlzIGRlcHJlY2F0ZWQuIFVzZSB0aGUgInJlbmRlckR5bmFtaWNJbXBvcnQiIHBsdWdpbiBob29rIGluc3RlYWQuJywicGx1Z2luLWRldmVsb3BtZW50LyNyZW5kZXJkeW5hbWljaW1wb3J0IiwhMCx0KSwiZXMiIT09cyYmdC5vbkxvZyh2ZSx6dCgib3V0cHV0LmR5bmFtaWNJbXBvcnRGdW5jdGlvbiIsImNvbmZpZ3VyYXRpb24tb3B0aW9ucy8jb3V0cHV0LWR5bmFtaWNpbXBvcnRmdW5jdGlvbiIsJ3RoaXMgb3B0aW9uIGlzIGlnbm9yZWQgZm9yIGZvcm1hdHMgb3RoZXIgdGhhbiAiZXMiJykpKSxpfSxvZD0oZSx0KT0+e2NvbnN0IHM9ZS5lbnRyeUZpbGVOYW1lcztyZXR1cm4gbnVsbD09cyYmdC5hZGQoImVudHJ5RmlsZU5hbWVzIikscz8/IltuYW1lXS5qcyJ9O2Z1bmN0aW9uIGFkKGUsdCl7Y29uc3Qgcz1lLmV4cGVyaW1lbnRhbERlZXBEeW5hbWljQ2h1bmtPcHRpbWl6YXRpb247cmV0dXJuIG51bGwhPXMmJll0KCdUaGUgIm91dHB1dC5leHBlcmltZW50YWxEZWVwRHluYW1pY0NodW5rT3B0aW1pemF0aW9uIiBvcHRpb24gaXMgZGVwcmVjYXRlZCBhcyBSb2xsdXAgYWx3YXlzIHJ1bnMgdGhlIGZ1bGwgY2h1bmtpbmcgYWxnb3JpdGhtIG5vdy4gVGhlIG9wdGlvbiBzaG91bGQgYmUgcmVtb3ZlZC4nLEZlLCEwLHQpLHN8fCExfWZ1bmN0aW9uIGxkKGUsdCl7Y29uc3Qgcz1lLmV4cG9ydHM7aWYobnVsbD09cyl0LmFkZCgiZXhwb3J0cyIpO2Vsc2UgaWYoIVsiZGVmYXVsdCIsIm5hbWVkIiwibm9uZSIsImF1dG8iXS5pbmNsdWRlcyhzKSlyZXR1cm4gWWUoe2NvZGU6Y3QsbWVzc2FnZTpgIm91dHB1dC5leHBvcnRzIiBtdXN0IGJlICJkZWZhdWx0IiwgIm5hbWVkIiwgIm5vbmUiLCAiYXV0byIsIG9yIGxlZnQgdW5zcGVjaWZpZWQgKGRlZmF1bHRzIHRvICJhdXRvIiksIHJlY2VpdmVkICIke3N9Ii5gLHVybDpNZShWZSl9KTtyZXR1cm4gc3x8ImF1dG8ifWNvbnN0IGNkPShlLHQpPT57Y29uc3Qgcz1ldShlLmdlbmVyYXRlZENvZGUsSmgsIm91dHB1dC5nZW5lcmF0ZWRDb2RlIiwiY29uZmlndXJhdGlvbi1vcHRpb25zLyNvdXRwdXQtZ2VuZXJhdGVkY29kZSIsIiIpO3JldHVybiB7YXJyb3dGdW5jdGlvbnM6ITA9PT1zLmFycm93RnVuY3Rpb25zLGNvbnN0QmluZGluZ3M6ITA9PT1zLmNvbnN0QmluZGluZ3N8fHQsb2JqZWN0U2hvcnRoYW5kOiEwPT09cy5vYmplY3RTaG9ydGhhbmQscmVzZXJ2ZWROYW1lc0FzUHJvcHM6ITEhPT1zLnJlc2VydmVkTmFtZXNBc1Byb3BzLHN5bWJvbHM6ITA9PT1zLnN5bWJvbHN9fSxoZD0oZSx0KT0+e2lmKHQpcmV0dXJuICIiO2NvbnN0IHM9ZS5pbmRlbnQ7cmV0dXJuICExPT09cz8iIjpzPz8hMH0sdWQ9bmV3IFNldChbImNvbXBhdCIsImF1dG8iLCJlc01vZHVsZSIsImRlZmF1bHQiLCJkZWZhdWx0T25seSJdKSxkZD1lPT57Y29uc3QgdD1lLmludGVyb3A7aWYoImZ1bmN0aW9uIj09dHlwZW9mIHQpe2NvbnN0IGU9T2JqZWN0LmNyZWF0ZShudWxsKTtsZXQgcz1udWxsO3JldHVybiBpPT5udWxsPT09aT9zfHxwZChzPXQoaSkpOmkgaW4gZT9lW2ldOnBkKGVbaV09dChpKSl9cmV0dXJuIHZvaWQgMD09PXQ/KCk9PiJkZWZhdWx0IjooKT0+cGQodCl9LHBkPWU9PnVkLmhhcyhlKT9lOlllKHp0KCJvdXRwdXQuaW50ZXJvcCIsR2UsYHVzZSBvbmUgb2YgJHtBcnJheS5mcm9tKHVkLChlPT5KU09OLnN0cmluZ2lmeShlKSkpLmpvaW4oIiwgIil9YCxlKSksZmQ9KGUsdCxzLGkpPT57Y29uc3Qgbj1lLm1hbnVhbENodW5rc3x8aS5tYW51YWxDaHVua3M7aWYobil7aWYodClyZXR1cm4gWWUoenQoIm91dHB1dC5tYW51YWxDaHVua3MiLFdlLCd0aGlzIG9wdGlvbiBpcyBub3Qgc3VwcG9ydGVkIGZvciAib3V0cHV0LmlubGluZUR5bmFtaWNJbXBvcnRzIicpKTtpZihzKXJldHVybiBZZSh6dCgib3V0cHV0Lm1hbnVhbENodW5rcyIsV2UsJ3RoaXMgb3B0aW9uIGlzIG5vdCBzdXBwb3J0ZWQgZm9yICJvdXRwdXQucHJlc2VydmVNb2R1bGVzIicpKX1yZXR1cm4gbnx8e319LG1kPShlLHQscyk9PmUubWluaWZ5SW50ZXJuYWxFeHBvcnRzPz8oc3x8ImVzIj09PXR8fCJzeXN0ZW0iPT09dCksZ2Q9KGUsdCxzKT0+e2NvbnN0IGk9ZS5uYW1lc3BhY2VUb1N0cmluZ1RhZztyZXR1cm4gbnVsbCE9aT8oWXQoJ1RoZSAib3V0cHV0Lm5hbWVzcGFjZVRvU3RyaW5nVGFnIiBvcHRpb24gaXMgZGVwcmVjYXRlZC4gVXNlIHRoZSAib3V0cHV0LmdlbmVyYXRlZENvZGUuc3ltYm9scyIgb3B0aW9uIGluc3RlYWQuJywiY29uZmlndXJhdGlvbi1vcHRpb25zLyNvdXRwdXQtZ2VuZXJhdGVkY29kZS1zeW1ib2xzIiwhMCxzKSxpKTp0LnN5bWJvbHN8fCExfSx5ZD1lPT57Y29uc3R7c291cmNlbWFwQmFzZVVybDp0fT1lO2lmKHQpcmV0dXJuIGZ1bmN0aW9uKGUpe3RyeXtuZXcgVVJMKGUpO31jYXRjaHtyZXR1cm4gITF9cmV0dXJuICEwfSh0KT8ocz10KS5lbmRzV2l0aCgiLyIpP3M6cysiLyI6WWUoenQoIm91dHB1dC5zb3VyY2VtYXBCYXNlVXJsIiwiY29uZmlndXJhdGlvbi1vcHRpb25zLyNvdXRwdXQtc291cmNlbWFwYmFzZXVybCIsYG11c3QgYmUgYSB2YWxpZCBVUkwsIHJlY2VpdmVkICR7SlNPTi5zdHJpbmdpZnkodCl9YCkpO3ZhciBzO307ZnVuY3Rpb24geGQodCl7cmV0dXJuIGFzeW5jIGZ1bmN0aW9uKHQscyl7Y29uc3R7b3B0aW9uczppLHVuc2V0T3B0aW9uczpufT1hd2FpdCBhc3luYyBmdW5jdGlvbih0LHMpe2lmKCF0KXRocm93IG5ldyBFcnJvcigiWW91IG11c3Qgc3VwcGx5IGFuIG9wdGlvbnMgb2JqZWN0IHRvIHJvbGx1cCIpO2NvbnN0IGk9YXdhaXQgYXN5bmMgZnVuY3Rpb24odCxzKXtjb25zdCBpPVN1KCJvcHRpb25zIixhd2FpdCB0dSh0LnBsdWdpbnMpKSxuPXQubG9nTGV2ZWx8fFNlLHI9JHUoaSxXaCh0LG4pLHMsbik7Zm9yKGNvbnN0IG8gb2YgaSl7Y29uc3R7bmFtZTppLG9wdGlvbnM6YX09byxsPSJoYW5kbGVyImluIGE/YS5oYW5kbGVyOmEsYz1hd2FpdCBsLmNhbGwoe2RlYnVnOnh1KEFlLCJQTFVHSU5fTE9HIixyLGksbiksZXJyb3I6ZT0+WWUoR3QoS2goZSksaSx7aG9vazoib25Mb2cifSkpLGluZm86eHUoU2UsIlBMVUdJTl9MT0ciLHIsaSxuKSxtZXRhOntyb2xsdXBWZXJzaW9uOmUsd2F0Y2hNb2RlOnN9LHdhcm46eHUodmUsIlBMVUdJTl9XQVJOSU5HIixyLGksbil9LHQpO2MmJih0PWMpO31yZXR1cm4gdH0odCxzKSx7b3B0aW9uczpuLHVuc2V0T3B0aW9uczpyfT1hd2FpdCBhc3luYyBmdW5jdGlvbihlLHQpe2NvbnN0IHM9bmV3IFNldCxpPWUuY29udGV4dD8/InVuZGVmaW5lZCIsbj1hd2FpdCB0dShlLnBsdWdpbnMpLHI9ZS5sb2dMZXZlbHx8U2Usbz0kdShuLFdoKGUsciksdCxyKSxhPWUuc3RyaWN0RGVwcmVjYXRpb25zfHwhMSxsPWp1KGUsbyxhKSxjPXthY29ybjpEdShlKSxhY29ybkluamVjdFBsdWdpbnM6THUoZSksY2FjaGU6VHUoZSksY29udGV4dDppLGV4cGVyaW1lbnRhbENhY2hlRXhwaXJ5OmUuZXhwZXJpbWVudGFsQ2FjaGVFeHBpcnk/PzEwLGV4cGVyaW1lbnRhbExvZ1NpZGVFZmZlY3RzOmUuZXhwZXJpbWVudGFsTG9nU2lkZUVmZmVjdHN8fCExLGV4dGVybmFsOlZ1KGUuZXh0ZXJuYWwpLGlubGluZUR5bmFtaWNJbXBvcnRzOkJ1KGUsbyxhKSxpbnB1dDp6dShlKSxsb2dMZXZlbDpyLG1ha2VBYnNvbHV0ZUV4dGVybmFsc1JlbGF0aXZlOmUubWFrZUFic29sdXRlRXh0ZXJuYWxzUmVsYXRpdmU/PyJpZlJlbGF0aXZlU291cmNlIixtYW51YWxDaHVua3M6RnUoZSxvLGEpLG1heFBhcmFsbGVsRmlsZU9wczpsLG1heFBhcmFsbGVsRmlsZVJlYWRzOmwsbW9kdWxlQ29udGV4dDpVdShlLGkpLG9uTG9nOm8sb253YXJuOmU9Pm8odmUsZSkscGVyZjplLnBlcmZ8fCExLHBsdWdpbnM6bixwcmVzZXJ2ZUVudHJ5U2lnbmF0dXJlczplLnByZXNlcnZlRW50cnlTaWduYXR1cmVzPz8iZXhwb3J0cy1vbmx5IixwcmVzZXJ2ZU1vZHVsZXM6R3UoZSxvLGEpLHByZXNlcnZlU3ltbGlua3M6ZS5wcmVzZXJ2ZVN5bWxpbmtzfHwhMSxzaGltTWlzc2luZ0V4cG9ydHM6ZS5zaGltTWlzc2luZ0V4cG9ydHN8fCExLHN0cmljdERlcHJlY2F0aW9uczphLHRyZWVzaGFrZTpXdShlKX07cmV0dXJuIFFoKGUsWy4uLk9iamVjdC5rZXlzKGMpLCJ3YXRjaCJdLCJpbnB1dCBvcHRpb25zIixvLC9eKG91dHB1dCkkLykse29wdGlvbnM6Yyx1bnNldE9wdGlvbnM6c319KGkscyk7cmV0dXJuIEVkKG4ucGx1Z2lucyxGaCkse29wdGlvbnM6bix1bnNldE9wdGlvbnM6cn19KHQsbnVsbCE9PXMpOyFmdW5jdGlvbihlKXtlLnBlcmY/KGtvPW5ldyBNYXAsJG89d28sTm89UG8sZS5wbHVnaW5zPWUucGx1Z2lucy5tYXAoUm8pKTooJG89RmksTm89RmkpO30oaSk7Y29uc3Qgcj1uZXcgUHUoaSxzKSxvPSExIT09dC5jYWNoZTt0LmNhY2hlJiYoaS5jYWNoZT12b2lkIDAsdC5jYWNoZT12b2lkIDApOyRvKCJCVUlMRCIsMSksYXdhaXQgQ3Uoci5wbHVnaW5Ecml2ZXIsKGFzeW5jKCk9Pnt0cnl7JG8oImluaXRpYWxpemUiLDIpLGF3YWl0IHIucGx1Z2luRHJpdmVyLmhvb2tQYXJhbGxlbCgiYnVpbGRTdGFydCIsW2ldKSxObygiaW5pdGlhbGl6ZSIsMiksYXdhaXQgci5idWlsZCgpO31jYXRjaChlKXtjb25zdCB0PU9iamVjdC5rZXlzKHIud2F0Y2hGaWxlcyk7dGhyb3cgdC5sZW5ndGg+MCYmKGUud2F0Y2hGaWxlcz10KSxhd2FpdCByLnBsdWdpbkRyaXZlci5ob29rUGFyYWxsZWwoImJ1aWxkRW5kIixbZV0pLGF3YWl0IHIucGx1Z2luRHJpdmVyLmhvb2tQYXJhbGxlbCgiY2xvc2VCdW5kbGUiLFtdKSxlfWF3YWl0IHIucGx1Z2luRHJpdmVyLmhvb2tQYXJhbGxlbCgiYnVpbGRFbmQiLFtdKTt9KSksTm8oIkJVSUxEIiwxKTtjb25zdCBhPXtjYWNoZTpvP3IuZ2V0Q2FjaGUoKTp2b2lkIDAsYXN5bmMgY2xvc2UoKXthLmNsb3NlZHx8KGEuY2xvc2VkPSEwLGF3YWl0IHIucGx1Z2luRHJpdmVyLmhvb2tQYXJhbGxlbCgiY2xvc2VCdW5kbGUiLFtdKSk7fSxjbG9zZWQ6ITEsZ2VuZXJhdGU6YXN5bmMgZT0+YS5jbG9zZWQ/WWUoX3QoKSk6YmQoITEsaSxuLGUsciksd2F0Y2hGaWxlczpPYmplY3Qua2V5cyhyLndhdGNoRmlsZXMpLHdyaXRlOmFzeW5jIGU9PmEuY2xvc2VkP1llKF90KCkpOmJkKCEwLGksbixlLHIpfTtpLnBlcmYmJihhLmdldFRpbWluZ3M9Q28pO3JldHVybiBhfSh0LG51bGwpfWZ1bmN0aW9uIEVkKGUsdCl7Zm9yKGNvbnN0W3MsaV1vZiBlLmVudHJpZXMoKSlpLm5hbWV8fChpLm5hbWU9YCR7dH0ke3MrMX1gKTt9YXN5bmMgZnVuY3Rpb24gYmQoZSx0LHMsaSxuKXtjb25zdHtvcHRpb25zOnIsb3V0cHV0UGx1Z2luRHJpdmVyOm8sdW5zZXRPcHRpb25zOmF9PWF3YWl0IGFzeW5jIGZ1bmN0aW9uKGUsdCxzLGkpe2lmKCFlKXRocm93IG5ldyBFcnJvcigiWW91IG11c3Qgc3VwcGx5IGFuIG9wdGlvbnMgb2JqZWN0Iik7Y29uc3Qgbj1hd2FpdCB0dShlLnBsdWdpbnMpO0VkKG4samgpO2NvbnN0IHI9dC5jcmVhdGVPdXRwdXRQbHVnaW5Ecml2ZXIobik7cmV0dXJuIHsuLi5hd2FpdCB2ZChzLGksZSxyKSxvdXRwdXRQbHVnaW5Ecml2ZXI6cn19KGksbi5wbHVnaW5Ecml2ZXIsdCxzKTtyZXR1cm4gQ3UoMCwoYXN5bmMoKT0+e2NvbnN0IHM9bmV3IFVsKHIsYSx0LG8sbiksaT1hd2FpdCBzLmdlbmVyYXRlKGUpO2lmKGUpe2lmKCRvKCJXUklURSIsMSksIXIuZGlyJiYhci5maWxlKXJldHVybiBZZSh7Y29kZTpidCxtZXNzYWdlOidZb3UgbXVzdCBzcGVjaWZ5ICJvdXRwdXQuZmlsZSIgb3IgIm91dHB1dC5kaXIiIGZvciB0aGUgYnVpbGQuJyx1cmw6TWUoVGUpfSk7YXdhaXQgUHJvbWlzZS5hbGwoT2JqZWN0LnZhbHVlcyhpKS5tYXAoKGU9Pm4uZmlsZU9wZXJhdGlvblF1ZXVlLnJ1bigoKCk9PmFzeW5jIGZ1bmN0aW9uKGUsdCl7Y29uc3Qgcz1OJDUodC5kaXJ8fFAodC5maWxlKSxlLmZpbGVOYW1lKTtyZXR1cm4gYXdhaXQgVGgoUChzKSx7cmVjdXJzaXZlOiEwfSksQmgocywiYXNzZXQiPT09ZS50eXBlP2Uuc291cmNlOmUuY29kZSl9KGUscikpKSkpKSxhd2FpdCBvLmhvb2tQYXJhbGxlbCgid3JpdGVCdW5kbGUiLFtyLGldKSxObygiV1JJVEUiLDEpO31yZXR1cm4gbD1pLHtvdXRwdXQ6T2JqZWN0LnZhbHVlcyhsKS5maWx0ZXIoKGU9Pk9iamVjdC5rZXlzKGUpLmxlbmd0aD4wKSkuc29ydCgoKGUsdCk9PkFkKGUpLUFkKHQpKSl9O3ZhciBsO30pKX1mdW5jdGlvbiB2ZChlLHQscyxpKXtyZXR1cm4gYXN5bmMgZnVuY3Rpb24oZSx0LHMpe2NvbnN0IGk9bmV3IFNldChzKSxuPWUuY29tcGFjdHx8ITEscj1RdShlKSxvPVp1KGUsdCksYT1KdShlLG8sdCksbD1YdShlLGEsdCksYz1lZChlLHQpLGg9Y2QoZSxjKSx1PXthbWQ6c2QoZSksYXNzZXRGaWxlTmFtZXM6ZS5hc3NldEZpbGVOYW1lcz8/ImFzc2V0cy9bbmFtZV0tW2hhc2hdW2V4dG5hbWVdIixiYW5uZXI6aWQoZSwiYmFubmVyIiksY2h1bmtGaWxlTmFtZXM6ZS5jaHVua0ZpbGVOYW1lcz8/IltuYW1lXS1baGFzaF0uanMiLGNvbXBhY3Q6bixkaXI6bmQoZSxsKSxkeW5hbWljSW1wb3J0RnVuY3Rpb246cmQoZSx0LHIpLGR5bmFtaWNJbXBvcnRJbkNqczplLmR5bmFtaWNJbXBvcnRJbkNqcz8/ITAsZW50cnlGaWxlTmFtZXM6b2QoZSxpKSxlc01vZHVsZTplLmVzTW9kdWxlPz8iaWYtZGVmYXVsdC1wcm9wIixleHBlcmltZW50YWxEZWVwRHluYW1pY0NodW5rT3B0aW1pemF0aW9uOmFkKGUsdCksZXhwZXJpbWVudGFsTWluQ2h1bmtTaXplOmUuZXhwZXJpbWVudGFsTWluQ2h1bmtTaXplPz8xLGV4cG9ydHM6bGQoZSxpKSxleHRlbmQ6ZS5leHRlbmR8fCExLGV4dGVybmFsSW1wb3J0QXNzZXJ0aW9uczplLmV4dGVybmFsSW1wb3J0QXNzZXJ0aW9ucz8/ITAsZXh0ZXJuYWxMaXZlQmluZGluZ3M6ZS5leHRlcm5hbExpdmVCaW5kaW5ncz8/ITAsZmlsZTpsLGZvb3RlcjppZChlLCJmb290ZXIiKSxmb3JtYXQ6cixmcmVlemU6ZS5mcmVlemU/PyEwLGdlbmVyYXRlZENvZGU6aCxnbG9iYWxzOmUuZ2xvYmFsc3x8e30saG9pc3RUcmFuc2l0aXZlSW1wb3J0czplLmhvaXN0VHJhbnNpdGl2ZUltcG9ydHM/PyEwLGluZGVudDpoZChlLG4pLGlubGluZUR5bmFtaWNJbXBvcnRzOm8saW50ZXJvcDpkZChlKSxpbnRybzppZChlLCJpbnRybyIpLG1hbnVhbENodW5rczpmZChlLG8sYSx0KSxtaW5pZnlJbnRlcm5hbEV4cG9ydHM6bWQoZSxyLG4pLG5hbWU6ZS5uYW1lLG5hbWVzcGFjZVRvU3RyaW5nVGFnOmdkKGUsaCx0KSxub0NvbmZsaWN0OmUubm9Db25mbGljdHx8ITEsb3V0cm86aWQoZSwib3V0cm8iKSxwYXRoczplLnBhdGhzfHx7fSxwbHVnaW5zOmF3YWl0IHR1KGUucGx1Z2lucykscHJlZmVyQ29uc3Q6YyxwcmVzZXJ2ZU1vZHVsZXM6YSxwcmVzZXJ2ZU1vZHVsZXNSb290OnRkKGUpLHNhbml0aXplRmlsZU5hbWU6ImZ1bmN0aW9uIj09dHlwZW9mIGUuc2FuaXRpemVGaWxlTmFtZT9lLnNhbml0aXplRmlsZU5hbWU6ITE9PT1lLnNhbml0aXplRmlsZU5hbWU/ZT0+ZTpZdSxzb3VyY2VtYXA6ZS5zb3VyY2VtYXB8fCExLHNvdXJjZW1hcEJhc2VVcmw6eWQoZSksc291cmNlbWFwRXhjbHVkZVNvdXJjZXM6ZS5zb3VyY2VtYXBFeGNsdWRlU291cmNlc3x8ITEsc291cmNlbWFwRmlsZTplLnNvdXJjZW1hcEZpbGUsc291cmNlbWFwSWdub3JlTGlzdDoiZnVuY3Rpb24iPT10eXBlb2YgZS5zb3VyY2VtYXBJZ25vcmVMaXN0P2Uuc291cmNlbWFwSWdub3JlTGlzdDohMT09PWUuc291cmNlbWFwSWdub3JlTGlzdD8oKT0+ITE6ZT0+ZS5pbmNsdWRlcygibm9kZV9tb2R1bGVzIiksc291cmNlbWFwUGF0aFRyYW5zZm9ybTplLnNvdXJjZW1hcFBhdGhUcmFuc2Zvcm0sc3RyaWN0OmUuc3RyaWN0Pz8hMCxzeXN0ZW1OdWxsU2V0dGVyczplLnN5c3RlbU51bGxTZXR0ZXJzPz8hMCx2YWxpZGF0ZTplLnZhbGlkYXRlfHwhMX07cmV0dXJuIFFoKGUsT2JqZWN0LmtleXModSksIm91dHB1dCBvcHRpb25zIix0Lm9uTG9nKSx7b3B0aW9uczp1LHVuc2V0T3B0aW9uczppfX0oaS5ob29rUmVkdWNlQXJnMFN5bmMoIm91dHB1dE9wdGlvbnMiLFtzXSwoKGUsdCk9PnR8fGUpLChlPT57Y29uc3QgdD0oKT0+ZS5lcnJvcih7Y29kZTp0dCxtZXNzYWdlOidDYW5ub3QgZW1pdCBmaWxlcyBvciBzZXQgYXNzZXQgc291cmNlcyBpbiB0aGUgIm91dHB1dE9wdGlvbnMiIGhvb2ssIHVzZSB0aGUgInJlbmRlclN0YXJ0IiBob29rIGluc3RlYWQuJ30pO3JldHVybiB7Li4uZSxlbWl0RmlsZTp0LHNldEFzc2V0U291cmNlOnR9fSkpLGUsdCl9dmFyIFNkO2Z1bmN0aW9uIEFkKGUpe3JldHVybiAiYXNzZXQiPT09ZS50eXBlP1NkLkFTU0VUOmUuaXNFbnRyeT9TZC5FTlRSWV9DSFVOSzpTZC5TRUNPTkRBUllfQ0hVTkt9IWZ1bmN0aW9uKGUpe2VbZS5FTlRSWV9DSFVOSz0wXT0iRU5UUllfQ0hVTksiLGVbZS5TRUNPTkRBUllfQ0hVTks9MV09IlNFQ09OREFSWV9DSFVOSyIsZVtlLkFTU0VUPTJdPSJBU1NFVCI7fShTZHx8KFNkPXt9KSk7Cgphc3luYyBmdW5jdGlvbiByZXdyaXRlTW9kdWxlKHNvdXJjZSwgcmVsYXRpdmVQYXRoLCB3aW4pIHsKICBjb25zb2xlLmxvZyhyZWxhdGl2ZVBhdGgpOwogIGNvbnN0IHByZSA9IHdpbltzTG9jYXRpb25dOwogIHdpbltzTG9jYXRpb25dID0gcmVsYXRpdmVQYXRoOwogIGNvbnN0IHByb3RvRG9tID0gbmV3IHdpbi5ET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoCiAgICAiIiwKICAgICJ0ZXh0L2h0bWwiCiAgKTsKICBjb25zdCBiYXNlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYmFzZSIpOwogIGJhc2UuaHJlZiA9IHJlbGF0aXZlUGF0aC50b1N0cmluZygpOwogIHByb3RvRG9tLmhlYWQuYXBwZW5kKGJhc2UpOwogIHdpbi5kb2N1bWVudC5oZWFkLmFwcGVuZChiYXNlLmNsb25lTm9kZSgpKTsKICBjb25zdCB2aXJ0dWFsU291cmNlTWFwID0ge307CiAgY29uc3QgcHVzaFZpcnR1YWxTb3VyY2UgPSAoc291cmNlMikgPT4gewogICAgY29uc3QgaiA9IE9iamVjdC5rZXlzKHZpcnR1YWxTb3VyY2VNYXApLmxlbmd0aDsKICAgIGNvbnN0IGtleSA9IGBcMHZpcnR1YWw6JHtqfWA7CiAgICB2aXJ0dWFsU291cmNlTWFwW2tleV0gPSBzb3VyY2UyOwogICAgcmV0dXJuIGtleTsKICB9OwogIGNvbnN0IGVudHJ5SW1wb3J0ID0gcHVzaFZpcnR1YWxTb3VyY2Uoc291cmNlKTsKICBjb25zdCB2aXJ0dWFsUGx1Z2luID0gewogICAgbmFtZTogImFzZHNkIiwKICAgIC8vIEB0cy1pZ25vcmUKICAgIGFzeW5jIHJlc29sdmVJZChpbXBvcnRlZSkgewogICAgICBpZiAoIShpbXBvcnRlZSBpbiB2aXJ0dWFsU291cmNlTWFwKSkKICAgICAgICB0cnkgewogICAgICAgICAgY29uc3QgdmlydHVhbHRhZyA9IHByb3RvRG9tLmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOwogICAgICAgICAgdmlydHVhbHRhZy5zcmMgPSBpbXBvcnRlZTsKICAgICAgICAgIGNvbnNvbGUubG9nKHZpcnR1YWx0YWcuc3JjKTsKICAgICAgICAgIGNvbnN0IHJlcSA9IGF3YWl0IHJlcXVlc3QobmV3IFJlcXVlc3QodmlydHVhbHRhZy5zcmMpLCAic2NyaXB0Iiwgd2luKTsKICAgICAgICAgIHZpcnR1YWx0YWcucmVtb3ZlKCk7CiAgICAgICAgICB2aXJ0dWFsU291cmNlTWFwW2ltcG9ydGVlXSA9IGF3YWl0IHJlcS50ZXh0KCk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICB9CiAgICAgIHJldHVybiB7CiAgICAgICAgaWQ6IGltcG9ydGVlLAogICAgICAgIGV4dGVybmFsOiAhKGltcG9ydGVlIGluIHZpcnR1YWxTb3VyY2VNYXApCiAgICAgIH07CiAgICB9LAogICAgbG9hZChpZCkgewogICAgICBjb25zb2xlLmxvZyhgbG9hZGluZyB2OiR7aWR9YCk7CiAgICAgIHJldHVybiB2aXJ0dWFsU291cmNlTWFwW2lkXTsKICAgIH0KICB9OwogIGNvbnN0IGJ1bmRsZSA9IGF3YWl0IHhkKHsKICAgIGlucHV0OiBlbnRyeUltcG9ydCwKICAgIHBsdWdpbnM6IFt2aXJ0dWFsUGx1Z2luXQogIH0pOwogIGNvbnN0IG91dCA9IGF3YWl0IGJ1bmRsZS5nZW5lcmF0ZSh7CiAgICBuYW1lOiBlbnRyeUltcG9ydCwKICAgIGZvcm1hdDogImVzIiwKICAgIHNvdXJjZW1hcDogdHJ1ZQogIH0pOwogIHdpbmRvd1siZiJdID0gb3V0OwogIGNvbnN0IGZpcnN0ID0gb3V0Lm91dHB1dFswXTsKICB3aW5bc0xvY2F0aW9uXSA9IHByZTsKICByZXR1cm4gZmlyc3QuY29kZTsKfQoKLyoqClRoaXMgcmVnZXggcmVwcmVzZW50cyBhIGxvb3NlIHJ1bGUgb2YgYW4g4oCcaW1hZ2UgY2FuZGlkYXRlIHN0cmluZ+KAnS4KCkBzZWUgaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2UvaW1hZ2VzLmh0bWwjc3Jjc2V0LWF0dHJpYnV0ZQoKQW4g4oCcaW1hZ2UgY2FuZGlkYXRlIHN0cmluZ+KAnSByb3VnaGx5IGNvbnNpc3RzIG9mIHRoZSBmb2xsb3dpbmc6CjEuIFplcm8gb3IgbW9yZSB3aGl0ZXNwYWNlIGNoYXJhY3RlcnMuCjIuIEEgbm9uLWVtcHR5IFVSTCB0aGF0IGRvZXMgbm90IHN0YXJ0IG9yIGVuZCB3aXRoIGAsYC4KMy4gWmVybyBvciBtb3JlIHdoaXRlc3BhY2UgY2hhcmFjdGVycy4KNC4gQW4gb3B0aW9uYWwg4oCcZGVzY3JpcHRvcuKAnSB0aGF0IHN0YXJ0cyB3aXRoIGEgd2hpdGVzcGFjZSBjaGFyYWN0ZXIuCjUuIFplcm8gb3IgbW9yZSB3aGl0ZXNwYWNlIGNoYXJhY3RlcnMuCjYuIEVhY2ggaW1hZ2UgY2FuZGlkYXRlIHN0cmluZyBpcyBzZXBhcmF0ZWQgYnkgYSBgLGAuCgpXZSBpbnRlbnRpb25hbGx5IGltcGxlbWVudCBhIGxvb3NlIHJ1bGUgaGVyZSBzbyB0aGF0IHdlIGNhbiBwZXJmb3JtIG1vcmUgYWdncmVzc2l2ZSBlcnJvciBoYW5kbGluZyBhbmQgcmVwb3J0aW5nIGluIHRoZSBiZWxvdyBjb2RlLgoqLwpjb25zdCBpbWFnZUNhbmRpZGF0ZVJlZ2V4ID0gL1xzKihbXixdXFMqW14sXSg/OlxzK1teLF0rKT8pXHMqKD86LHwkKS87Cgpjb25zdCBkdXBsaWNhdGVEZXNjcmlwdG9yQ2hlY2sgPSAoYWxsRGVzY3JpcHRvcnMsIHZhbHVlLCBwb3N0Zml4KSA9PiB7CglhbGxEZXNjcmlwdG9yc1twb3N0Zml4XSA9IGFsbERlc2NyaXB0b3JzW3Bvc3RmaXhdIHx8IHt9OwoJaWYgKGFsbERlc2NyaXB0b3JzW3Bvc3RmaXhdW3ZhbHVlXSkgewoJCXRocm93IG5ldyBFcnJvcihgTm8gbW9yZSB0aGFuIG9uZSBpbWFnZSBjYW5kaWRhdGUgaXMgYWxsb3dlZCBmb3IgYSBnaXZlbiBkZXNjcmlwdG9yOiAke3ZhbHVlfSR7cG9zdGZpeH1gKTsKCX0KCglhbGxEZXNjcmlwdG9yc1twb3N0Zml4XVt2YWx1ZV0gPSB0cnVlOwp9OwoKY29uc3QgZmFsbGJhY2tEZXNjcmlwdG9yRHVwbGljYXRlQ2hlY2sgPSBhbGxEZXNjcmlwdG9ycyA9PiB7CglpZiAoYWxsRGVzY3JpcHRvcnMuZmFsbGJhY2spIHsKCQl0aHJvdyBuZXcgRXJyb3IoJ09ubHkgb25lIGZhbGxiYWNrIGltYWdlIGNhbmRpZGF0ZSBpcyBhbGxvd2VkJyk7Cgl9CgoJaWYgKGFsbERlc2NyaXB0b3JzLnhbJzEnXSkgewoJCXRocm93IG5ldyBFcnJvcignQSBmYWxsYmFjayBpbWFnZSBpcyBlcXVpdmFsZW50IHRvIGEgMXggZGVzY3JpcHRvciwgcHJvdmlkaW5nIGJvdGggaXMgaW52YWxpZC4nKTsKCX0KCglhbGxEZXNjcmlwdG9ycy5mYWxsYmFjayA9IHRydWU7Cn07Cgpjb25zdCBkZXNjcmlwdG9yQ291bnRDaGVjayA9IChhbGxEZXNjcmlwdG9ycywgY3VycmVudERlc2NyaXB0b3JzKSA9PiB7CglpZiAoY3VycmVudERlc2NyaXB0b3JzLmxlbmd0aCA9PT0gMCkgewoJCWZhbGxiYWNrRGVzY3JpcHRvckR1cGxpY2F0ZUNoZWNrKGFsbERlc2NyaXB0b3JzKTsKCX0gZWxzZSBpZiAoY3VycmVudERlc2NyaXB0b3JzLmxlbmd0aCA+IDEpIHsKCQl0aHJvdyBuZXcgRXJyb3IoYEltYWdlIGNhbmRpZGF0ZSBtYXkgaGF2ZSBubyBtb3JlIHRoYW4gb25lIGRlc2NyaXB0b3IsIGZvdW5kICR7Y3VycmVudERlc2NyaXB0b3JzLmxlbmd0aH06ICR7Y3VycmVudERlc2NyaXB0b3JzLmpvaW4oJyAnKX1gKTsKCX0KfTsKCmNvbnN0IHZhbGlkRGVzY3JpcHRvckNoZWNrID0gKHZhbHVlLCBwb3N0Zml4LCBkZXNjcmlwdG9yKSA9PiB7CglpZiAoTnVtYmVyLmlzTmFOKHZhbHVlKSkgewoJCXRocm93IG5ldyBUeXBlRXJyb3IoYCR7ZGVzY3JpcHRvciB8fCB2YWx1ZX0gaXMgbm90IGEgdmFsaWQgbnVtYmVyYCk7Cgl9CgoJc3dpdGNoIChwb3N0Zml4KSB7CgkJY2FzZSAndyc6IHsKCQkJaWYgKHZhbHVlIDw9IDApIHsKCQkJCXRocm93IG5ldyBFcnJvcignV2lkdGggZGVzY3JpcHRvciBtdXN0IGJlIGdyZWF0ZXIgdGhhbiB6ZXJvJyk7CgkJCX0gZWxzZSBpZiAoIU51bWJlci5pc0ludGVnZXIodmFsdWUpKSB7CgkJCQl0aHJvdyBuZXcgVHlwZUVycm9yKCdXaWR0aCBkZXNjcmlwdG9yIG11c3QgYmUgYW4gaW50ZWdlcicpOwoJCQl9CgoJCQlicmVhazsKCQl9CgoJCWNhc2UgJ3gnOiB7CgkJCWlmICh2YWx1ZSA8PSAwKSB7CgkJCQl0aHJvdyBuZXcgRXJyb3IoJ1BpeGVsIGRlbnNpdHkgZGVzY3JpcHRvciBtdXN0IGJlIGdyZWF0ZXIgdGhhbiB6ZXJvJyk7CgkJCX0KCgkJCWJyZWFrOwoJCX0KCgkJY2FzZSAnaCc6IHsKCQkJdGhyb3cgbmV3IEVycm9yKCdIZWlnaHQgZGVzY3JpcHRvciBpcyBubyBsb25nZXIgYWxsb3dlZCcpOwoJCX0KCgkJZGVmYXVsdDogewoJCQl0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgc3Jjc2V0IGRlc2NyaXB0b3I6ICR7ZGVzY3JpcHRvcn1gKTsKCQl9Cgl9Cn07CgpmdW5jdGlvbiBwYXJzZVNyY3NldChzdHJpbmcsIHtzdHJpY3QgPSBmYWxzZX0gPSB7fSkgewoJY29uc3QgYWxsRGVzY3JpcHRvcnMgPSBzdHJpY3QgPyB7fSA6IHVuZGVmaW5lZDsKCglyZXR1cm4gc3RyaW5nLnNwbGl0KGltYWdlQ2FuZGlkYXRlUmVnZXgpCgkJLmZpbHRlcigocGFydCwgaW5kZXgpID0+IGluZGV4ICUgMiA9PT0gMSkKCQkubWFwKHBhcnQgPT4gewoJCQljb25zdCBbdXJsLCAuLi5kZXNjcmlwdG9yc10gPSBwYXJ0LnRyaW0oKS5zcGxpdCgvXHMrLyk7CgoJCQljb25zdCByZXN1bHQgPSB7dXJsfTsKCgkJCWlmIChzdHJpY3QpIHsKCQkJCWRlc2NyaXB0b3JDb3VudENoZWNrKGFsbERlc2NyaXB0b3JzLCBkZXNjcmlwdG9ycyk7CgkJCX0KCgkJCWZvciAoY29uc3QgZGVzY3JpcHRvciBvZiBkZXNjcmlwdG9ycykgewoJCQkJY29uc3QgcG9zdGZpeCA9IGRlc2NyaXB0b3JbZGVzY3JpcHRvci5sZW5ndGggLSAxXTsKCQkJCWNvbnN0IHZhbHVlID0gTnVtYmVyLnBhcnNlRmxvYXQoZGVzY3JpcHRvci5zbGljZSgwLCAtMSkpOwoKCQkJCWlmIChzdHJpY3QpIHsKCQkJCQl2YWxpZERlc2NyaXB0b3JDaGVjayh2YWx1ZSwgcG9zdGZpeCwgZGVzY3JpcHRvcik7CgkJCQkJZHVwbGljYXRlRGVzY3JpcHRvckNoZWNrKGFsbERlc2NyaXB0b3JzLCB2YWx1ZSwgcG9zdGZpeCk7CgkJCQl9CgoJCQkJc3dpdGNoIChwb3N0Zml4KSB7CgkJCQkJY2FzZSAndyc6IHsKCQkJCQkJcmVzdWx0LndpZHRoID0gdmFsdWU7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCgkJCQkJY2FzZSAnaCc6IHsKCQkJCQkJcmVzdWx0LmhlaWdodCA9IHZhbHVlOwoJCQkJCQlicmVhazsKCQkJCQl9CgoJCQkJCWNhc2UgJ3gnOiB7CgkJCQkJCXJlc3VsdC5kZW5zaXR5ID0gdmFsdWU7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCgkJCQkJLy8gTm8gZGVmYXVsdAoJCQkJfQoJCQl9CgoJCQlyZXR1cm4gcmVzdWx0OwoJCX0pOwp9Cgpjb25zdCBrbm93bkRlc2NyaXB0b3JzID0gbmV3IFNldChbJ3dpZHRoJywgJ2hlaWdodCcsICdkZW5zaXR5J10pOwoKZnVuY3Rpb24gc3RyaW5naWZ5U3Jjc2V0KGFycmF5LCB7c3RyaWN0ID0gZmFsc2V9ID0ge30pIHsKCWNvbnN0IGFsbERlc2NyaXB0b3JzID0gc3RyaWN0ID8ge30gOiB1bmRlZmluZWQ7CgoJcmV0dXJuIGFycmF5Lm1hcChlbGVtZW50ID0+IHsKCQlpZiAoIWVsZW1lbnQudXJsKSB7CgkJCWlmIChzdHJpY3QpIHsKCQkJCXRocm93IG5ldyBFcnJvcignVVJMIGlzIHJlcXVpcmVkJyk7CgkJCX0KCgkJCXJldHVybiAnJzsKCQl9CgoJCWNvbnN0IGRlc2NyaXB0b3JLZXlzID0gT2JqZWN0LmtleXMoZWxlbWVudCkuZmlsdGVyKGtleSA9PiBrbm93bkRlc2NyaXB0b3JzLmhhcyhrZXkpKTsKCgkJaWYgKHN0cmljdCkgewoJCQlkZXNjcmlwdG9yQ291bnRDaGVjayhhbGxEZXNjcmlwdG9ycywgZGVzY3JpcHRvcktleXMpOwoJCX0KCgkJY29uc3QgcmVzdWx0ID0gW2VsZW1lbnQudXJsXTsKCgkJZm9yIChjb25zdCBkZXNjcmlwdG9yS2V5IG9mIGRlc2NyaXB0b3JLZXlzKSB7CgkJCWNvbnN0IHZhbHVlID0gZWxlbWVudFtkZXNjcmlwdG9yS2V5XTsKCQkJbGV0IHBvc3RmaXg7CgkJCXN3aXRjaCAoZGVzY3JpcHRvcktleSkgewoJCQkJY2FzZSAnd2lkdGgnOiB7CgkJCQkJcG9zdGZpeCA9ICd3JzsKCgkJCQkJYnJlYWs7CgkJCQl9CgoJCQkJY2FzZSAnaGVpZ2h0JzogewoJCQkJCXBvc3RmaXggPSAnaCc7CgoJCQkJCWJyZWFrOwoJCQkJfQoKCQkJCWNhc2UgJ2RlbnNpdHknOiB7CgkJCQkJcG9zdGZpeCA9ICd4JzsKCgkJCQkJYnJlYWs7CgkJCQl9CgkJCS8vIE5vIGRlZmF1bHQKCQkJfQoKCQkJY29uc3QgZGVzY3JpcHRvciA9IGAke3ZhbHVlfSR7cG9zdGZpeH1gOwoKCQkJaWYgKHN0cmljdCkgewoJCQkJdmFsaWREZXNjcmlwdG9yQ2hlY2sodmFsdWUsIHBvc3RmaXgpOwoJCQkJZHVwbGljYXRlRGVzY3JpcHRvckNoZWNrKGFsbERlc2NyaXB0b3JzLCB2YWx1ZSwgcG9zdGZpeCk7CgkJCX0KCgkJCXJlc3VsdC5wdXNoKGRlc2NyaXB0b3IpOwoJCX0KCgkJcmV0dXJuIHJlc3VsdC5qb2luKCcgJyk7Cgl9KS5qb2luKCcsICcpOwp9CgovLyBDU1MgU3ludGF4IE1vZHVsZSBMZXZlbCAzCi8vIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9jc3Mtc3ludGF4LTMvCmNvbnN0IEVPRiQxID0gMDsgICAgICAgICAgICAgICAgIC8vIDxFT0YtdG9rZW4+CmNvbnN0IElkZW50ID0gMTsgICAgICAgICAgICAgICAvLyA8aWRlbnQtdG9rZW4+CmNvbnN0IEZ1bmN0aW9uJDIgPSAyOyAgICAgICAgICAgIC8vIDxmdW5jdGlvbi10b2tlbj4KY29uc3QgQXRLZXl3b3JkID0gMzsgICAgICAgICAgIC8vIDxhdC1rZXl3b3JkLXRva2VuPgpjb25zdCBIYXNoJDEgPSA0OyAgICAgICAgICAgICAgICAvLyA8aGFzaC10b2tlbj4KY29uc3QgU3RyaW5nJDIgPSA1OyAgICAgICAgICAgICAgLy8gPHN0cmluZy10b2tlbj4KY29uc3QgQmFkU3RyaW5nID0gNjsgICAgICAgICAgIC8vIDxiYWQtc3RyaW5nLXRva2VuPgpjb25zdCBVcmwkMSA9IDc7ICAgICAgICAgICAgICAgICAvLyA8dXJsLXRva2VuPgpjb25zdCBCYWRVcmwgPSA4OyAgICAgICAgICAgICAgLy8gPGJhZC11cmwtdG9rZW4+CmNvbnN0IERlbGltID0gOTsgICAgICAgICAgICAgICAvLyA8ZGVsaW0tdG9rZW4+CmNvbnN0IE51bWJlciQyID0gMTA7ICAgICAgICAgICAgIC8vIDxudW1iZXItdG9rZW4+CmNvbnN0IFBlcmNlbnRhZ2UkMSA9IDExOyAgICAgICAgIC8vIDxwZXJjZW50YWdlLXRva2VuPgpjb25zdCBEaW1lbnNpb24kMSA9IDEyOyAgICAgICAgICAvLyA8ZGltZW5zaW9uLXRva2VuPgpjb25zdCBXaGl0ZVNwYWNlJDEgPSAxMzsgICAgICAgICAvLyA8d2hpdGVzcGFjZS10b2tlbj4KY29uc3QgQ0RPJDEgPSAxNDsgICAgICAgICAgICAgICAgLy8gPENETy10b2tlbj4KY29uc3QgQ0RDJDEgPSAxNTsgICAgICAgICAgICAgICAgLy8gPENEQy10b2tlbj4KY29uc3QgQ29sb24gPSAxNjsgICAgICAgICAgICAgIC8vIDxjb2xvbi10b2tlbj4gICAgIDoKY29uc3QgU2VtaWNvbG9uID0gMTc7ICAgICAgICAgIC8vIDxzZW1pY29sb24tdG9rZW4+IDsKY29uc3QgQ29tbWEgPSAxODsgICAgICAgICAgICAgIC8vIDxjb21tYS10b2tlbj4gICAgICwKY29uc3QgTGVmdFNxdWFyZUJyYWNrZXQgPSAxOTsgIC8vIDxbLXRva2VuPgpjb25zdCBSaWdodFNxdWFyZUJyYWNrZXQgPSAyMDsgLy8gPF0tdG9rZW4+CmNvbnN0IExlZnRQYXJlbnRoZXNpcyA9IDIxOyAgICAvLyA8KC10b2tlbj4KY29uc3QgUmlnaHRQYXJlbnRoZXNpcyA9IDIyOyAgIC8vIDwpLXRva2VuPgpjb25zdCBMZWZ0Q3VybHlCcmFja2V0ID0gMjM7ICAgLy8gPHstdG9rZW4+CmNvbnN0IFJpZ2h0Q3VybHlCcmFja2V0ID0gMjQ7ICAvLyA8fS10b2tlbj4KY29uc3QgQ29tbWVudCQxID0gMjU7Cgpjb25zdCBFT0YgPSAwOwoKLy8gaHR0cHM6Ly9kcmFmdHMuY3Nzd2cub3JnL2Nzcy1zeW50YXgtMy8KLy8gwqcgNC4yLiBEZWZpbml0aW9ucwoKLy8gZGlnaXQKLy8gQSBjb2RlIHBvaW50IGJldHdlZW4gVSswMDMwIERJR0lUIFpFUk8gKDApIGFuZCBVKzAwMzkgRElHSVQgTklORSAoOSkuCmZ1bmN0aW9uIGlzRGlnaXQoY29kZSkgewogICAgcmV0dXJuIGNvZGUgPj0gMHgwMDMwICYmIGNvZGUgPD0gMHgwMDM5Owp9CgovLyBoZXggZGlnaXQKLy8gQSBkaWdpdCwgb3IgYSBjb2RlIHBvaW50IGJldHdlZW4gVSswMDQxIExBVElOIENBUElUQUwgTEVUVEVSIEEgKEEpIGFuZCBVKzAwNDYgTEFUSU4gQ0FQSVRBTCBMRVRURVIgRiAoRiksCi8vIG9yIGEgY29kZSBwb2ludCBiZXR3ZWVuIFUrMDA2MSBMQVRJTiBTTUFMTCBMRVRURVIgQSAoYSkgYW5kIFUrMDA2NiBMQVRJTiBTTUFMTCBMRVRURVIgRiAoZikuCmZ1bmN0aW9uIGlzSGV4RGlnaXQoY29kZSkgewogICAgcmV0dXJuICgKICAgICAgICBpc0RpZ2l0KGNvZGUpIHx8IC8vIDAgLi4gOQogICAgICAgIChjb2RlID49IDB4MDA0MSAmJiBjb2RlIDw9IDB4MDA0NikgfHwgLy8gQSAuLiBGCiAgICAgICAgKGNvZGUgPj0gMHgwMDYxICYmIGNvZGUgPD0gMHgwMDY2KSAgICAvLyBhIC4uIGYKICAgICk7Cn0KCi8vIHVwcGVyY2FzZSBsZXR0ZXIKLy8gQSBjb2RlIHBvaW50IGJldHdlZW4gVSswMDQxIExBVElOIENBUElUQUwgTEVUVEVSIEEgKEEpIGFuZCBVKzAwNUEgTEFUSU4gQ0FQSVRBTCBMRVRURVIgWiAoWikuCmZ1bmN0aW9uIGlzVXBwZXJjYXNlTGV0dGVyKGNvZGUpIHsKICAgIHJldHVybiBjb2RlID49IDB4MDA0MSAmJiBjb2RlIDw9IDB4MDA1QTsKfQoKLy8gbG93ZXJjYXNlIGxldHRlcgovLyBBIGNvZGUgcG9pbnQgYmV0d2VlbiBVKzAwNjEgTEFUSU4gU01BTEwgTEVUVEVSIEEgKGEpIGFuZCBVKzAwN0EgTEFUSU4gU01BTEwgTEVUVEVSIFogKHopLgpmdW5jdGlvbiBpc0xvd2VyY2FzZUxldHRlcihjb2RlKSB7CiAgICByZXR1cm4gY29kZSA+PSAweDAwNjEgJiYgY29kZSA8PSAweDAwN0E7Cn0KCi8vIGxldHRlcgovLyBBbiB1cHBlcmNhc2UgbGV0dGVyIG9yIGEgbG93ZXJjYXNlIGxldHRlci4KZnVuY3Rpb24gaXNMZXR0ZXIoY29kZSkgewogICAgcmV0dXJuIGlzVXBwZXJjYXNlTGV0dGVyKGNvZGUpIHx8IGlzTG93ZXJjYXNlTGV0dGVyKGNvZGUpOwp9CgovLyBub24tQVNDSUkgY29kZSBwb2ludAovLyBBIGNvZGUgcG9pbnQgd2l0aCBhIHZhbHVlIGVxdWFsIHRvIG9yIGdyZWF0ZXIgdGhhbiBVKzAwODAgPGNvbnRyb2w+LgpmdW5jdGlvbiBpc05vbkFzY2lpKGNvZGUpIHsKICAgIHJldHVybiBjb2RlID49IDB4MDA4MDsKfQoKLy8gbmFtZS1zdGFydCBjb2RlIHBvaW50Ci8vIEEgbGV0dGVyLCBhIG5vbi1BU0NJSSBjb2RlIHBvaW50LCBvciBVKzAwNUYgTE9XIExJTkUgKF8pLgpmdW5jdGlvbiBpc05hbWVTdGFydChjb2RlKSB7CiAgICByZXR1cm4gaXNMZXR0ZXIoY29kZSkgfHwgaXNOb25Bc2NpaShjb2RlKSB8fCBjb2RlID09PSAweDAwNUY7Cn0KCi8vIG5hbWUgY29kZSBwb2ludAovLyBBIG5hbWUtc3RhcnQgY29kZSBwb2ludCwgYSBkaWdpdCwgb3IgVSswMDJEIEhZUEhFTi1NSU5VUyAoLSkuCmZ1bmN0aW9uIGlzTmFtZShjb2RlKSB7CiAgICByZXR1cm4gaXNOYW1lU3RhcnQoY29kZSkgfHwgaXNEaWdpdChjb2RlKSB8fCBjb2RlID09PSAweDAwMkQ7Cn0KCi8vIG5vbi1wcmludGFibGUgY29kZSBwb2ludAovLyBBIGNvZGUgcG9pbnQgYmV0d2VlbiBVKzAwMDAgTlVMTCBhbmQgVSswMDA4IEJBQ0tTUEFDRSwgb3IgVSswMDBCIExJTkUgVEFCVUxBVElPTiwKLy8gb3IgYSBjb2RlIHBvaW50IGJldHdlZW4gVSswMDBFIFNISUZUIE9VVCBhbmQgVSswMDFGIElORk9STUFUSU9OIFNFUEFSQVRPUiBPTkUsIG9yIFUrMDA3RiBERUxFVEUuCmZ1bmN0aW9uIGlzTm9uUHJpbnRhYmxlKGNvZGUpIHsKICAgIHJldHVybiAoCiAgICAgICAgKGNvZGUgPj0gMHgwMDAwICYmIGNvZGUgPD0gMHgwMDA4KSB8fAogICAgICAgIChjb2RlID09PSAweDAwMEIpIHx8CiAgICAgICAgKGNvZGUgPj0gMHgwMDBFICYmIGNvZGUgPD0gMHgwMDFGKSB8fAogICAgICAgIChjb2RlID09PSAweDAwN0YpCiAgICApOwp9CgovLyBuZXdsaW5lCi8vIFUrMDAwQSBMSU5FIEZFRUQuIE5vdGUgdGhhdCBVKzAwMEQgQ0FSUklBR0UgUkVUVVJOIGFuZCBVKzAwMEMgRk9STSBGRUVEIGFyZSBub3QgaW5jbHVkZWQgaW4gdGhpcyBkZWZpbml0aW9uLAovLyBhcyB0aGV5IGFyZSBjb252ZXJ0ZWQgdG8gVSswMDBBIExJTkUgRkVFRCBkdXJpbmcgcHJlcHJvY2Vzc2luZy4KLy8gVE9ETzogd2UgZG9lc24ndCBkbyBhIHByZXByb2Nlc3NpbmcsIHNvIGNoZWNrIGEgY29kZSBwb2ludCBmb3IgVSswMDBEIENBUlJJQUdFIFJFVFVSTiBhbmQgVSswMDBDIEZPUk0gRkVFRApmdW5jdGlvbiBpc05ld2xpbmUoY29kZSkgewogICAgcmV0dXJuIGNvZGUgPT09IDB4MDAwQSB8fCBjb2RlID09PSAweDAwMEQgfHwgY29kZSA9PT0gMHgwMDBDOwp9CgovLyB3aGl0ZXNwYWNlCi8vIEEgbmV3bGluZSwgVSswMDA5IENIQVJBQ1RFUiBUQUJVTEFUSU9OLCBvciBVKzAwMjAgU1BBQ0UuCmZ1bmN0aW9uIGlzV2hpdGVTcGFjZShjb2RlKSB7CiAgICByZXR1cm4gaXNOZXdsaW5lKGNvZGUpIHx8IGNvZGUgPT09IDB4MDAyMCB8fCBjb2RlID09PSAweDAwMDk7Cn0KCi8vIMKnIDQuMy44LiBDaGVjayBpZiB0d28gY29kZSBwb2ludHMgYXJlIGEgdmFsaWQgZXNjYXBlCmZ1bmN0aW9uIGlzVmFsaWRFc2NhcGUoZmlyc3QsIHNlY29uZCkgewogICAgLy8gSWYgdGhlIGZpcnN0IGNvZGUgcG9pbnQgaXMgbm90IFUrMDA1QyBSRVZFUlNFIFNPTElEVVMgKFwpLCByZXR1cm4gZmFsc2UuCiAgICBpZiAoZmlyc3QgIT09IDB4MDA1QykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyBPdGhlcndpc2UsIGlmIHRoZSBzZWNvbmQgY29kZSBwb2ludCBpcyBhIG5ld2xpbmUgb3IgRU9GLCByZXR1cm4gZmFsc2UuCiAgICBpZiAoaXNOZXdsaW5lKHNlY29uZCkgfHwgc2Vjb25kID09PSBFT0YpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8gT3RoZXJ3aXNlLCByZXR1cm4gdHJ1ZS4KICAgIHJldHVybiB0cnVlOwp9CgovLyDCpyA0LjMuOS4gQ2hlY2sgaWYgdGhyZWUgY29kZSBwb2ludHMgd291bGQgc3RhcnQgYW4gaWRlbnRpZmllcgpmdW5jdGlvbiBpc0lkZW50aWZpZXJTdGFydChmaXJzdCwgc2Vjb25kLCB0aGlyZCkgewogICAgLy8gTG9vayBhdCB0aGUgZmlyc3QgY29kZSBwb2ludDoKCiAgICAvLyBVKzAwMkQgSFlQSEVOLU1JTlVTCiAgICBpZiAoZmlyc3QgPT09IDB4MDAyRCkgewogICAgICAgIC8vIElmIHRoZSBzZWNvbmQgY29kZSBwb2ludCBpcyBhIG5hbWUtc3RhcnQgY29kZSBwb2ludCBvciBhIFUrMDAyRCBIWVBIRU4tTUlOVVMsCiAgICAgICAgLy8gb3IgdGhlIHNlY29uZCBhbmQgdGhpcmQgY29kZSBwb2ludHMgYXJlIGEgdmFsaWQgZXNjYXBlLCByZXR1cm4gdHJ1ZS4gT3RoZXJ3aXNlLCByZXR1cm4gZmFsc2UuCiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgaXNOYW1lU3RhcnQoc2Vjb25kKSB8fAogICAgICAgICAgICBzZWNvbmQgPT09IDB4MDAyRCB8fAogICAgICAgICAgICBpc1ZhbGlkRXNjYXBlKHNlY29uZCwgdGhpcmQpCiAgICAgICAgKTsKICAgIH0KCiAgICAvLyBuYW1lLXN0YXJ0IGNvZGUgcG9pbnQKICAgIGlmIChpc05hbWVTdGFydChmaXJzdCkpIHsKICAgICAgICAvLyBSZXR1cm4gdHJ1ZS4KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLyBVKzAwNUMgUkVWRVJTRSBTT0xJRFVTIChcKQogICAgaWYgKGZpcnN0ID09PSAweDAwNUMpIHsKICAgICAgICAvLyBJZiB0aGUgZmlyc3QgYW5kIHNlY29uZCBjb2RlIHBvaW50cyBhcmUgYSB2YWxpZCBlc2NhcGUsIHJldHVybiB0cnVlLiBPdGhlcndpc2UsIHJldHVybiBmYWxzZS4KICAgICAgICByZXR1cm4gaXNWYWxpZEVzY2FwZShmaXJzdCwgc2Vjb25kKTsKICAgIH0KCiAgICAvLyBhbnl0aGluZyBlbHNlCiAgICAvLyBSZXR1cm4gZmFsc2UuCiAgICByZXR1cm4gZmFsc2U7Cn0KCi8vIMKnIDQuMy4xMC4gQ2hlY2sgaWYgdGhyZWUgY29kZSBwb2ludHMgd291bGQgc3RhcnQgYSBudW1iZXIKZnVuY3Rpb24gaXNOdW1iZXJTdGFydChmaXJzdCwgc2Vjb25kLCB0aGlyZCkgewogICAgLy8gTG9vayBhdCB0aGUgZmlyc3QgY29kZSBwb2ludDoKCiAgICAvLyBVKzAwMkIgUExVUyBTSUdOICgrKQogICAgLy8gVSswMDJEIEhZUEhFTi1NSU5VUyAoLSkKICAgIGlmIChmaXJzdCA9PT0gMHgwMDJCIHx8IGZpcnN0ID09PSAweDAwMkQpIHsKICAgICAgICAvLyBJZiB0aGUgc2Vjb25kIGNvZGUgcG9pbnQgaXMgYSBkaWdpdCwgcmV0dXJuIHRydWUuCiAgICAgICAgaWYgKGlzRGlnaXQoc2Vjb25kKSkgewogICAgICAgICAgICByZXR1cm4gMjsKICAgICAgICB9CgogICAgICAgIC8vIE90aGVyd2lzZSwgaWYgdGhlIHNlY29uZCBjb2RlIHBvaW50IGlzIGEgVSswMDJFIEZVTEwgU1RPUCAoLikKICAgICAgICAvLyBhbmQgdGhlIHRoaXJkIGNvZGUgcG9pbnQgaXMgYSBkaWdpdCwgcmV0dXJuIHRydWUuCiAgICAgICAgLy8gT3RoZXJ3aXNlLCByZXR1cm4gZmFsc2UuCiAgICAgICAgcmV0dXJuIHNlY29uZCA9PT0gMHgwMDJFICYmIGlzRGlnaXQodGhpcmQpID8gMyA6IDA7CiAgICB9CgogICAgLy8gVSswMDJFIEZVTEwgU1RPUCAoLikKICAgIGlmIChmaXJzdCA9PT0gMHgwMDJFKSB7CiAgICAgICAgLy8gSWYgdGhlIHNlY29uZCBjb2RlIHBvaW50IGlzIGEgZGlnaXQsIHJldHVybiB0cnVlLiBPdGhlcndpc2UsIHJldHVybiBmYWxzZS4KICAgICAgICByZXR1cm4gaXNEaWdpdChzZWNvbmQpID8gMiA6IDA7CiAgICB9CgogICAgLy8gZGlnaXQKICAgIGlmIChpc0RpZ2l0KGZpcnN0KSkgewogICAgICAgIC8vIFJldHVybiB0cnVlLgogICAgICAgIHJldHVybiAxOwogICAgfQoKICAgIC8vIGFueXRoaW5nIGVsc2UKICAgIC8vIFJldHVybiBmYWxzZS4KICAgIHJldHVybiAwOwp9CgovLwovLyBNaXNjCi8vCgovLyBkZXRlY3QgQk9NIChodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9CeXRlX29yZGVyX21hcmspCmZ1bmN0aW9uIGlzQk9NKGNvZGUpIHsKICAgIC8vIFVURi0xNkJFCiAgICBpZiAoY29kZSA9PT0gMHhGRUZGKSB7CiAgICAgICAgcmV0dXJuIDE7CiAgICB9CgogICAgLy8gVVRGLTE2TEUKICAgIGlmIChjb2RlID09PSAweEZGRkUpIHsKICAgICAgICByZXR1cm4gMTsKICAgIH0KCiAgICByZXR1cm4gMDsKfQoKLy8gRmFzdCBjb2RlIGNhdGVnb3J5Ci8vIE9ubHkgQVNDSUkgY29kZSBwb2ludHMgaGFzIGEgc3BlY2lhbCBtZWFuaW5nLCB0aGF0J3Mgd2h5IHdlIGRlZmluZSBhIG1hcHMgZm9yIDAuLjEyNyBjb2RlcyBvbmx5CmNvbnN0IENBVEVHT1JZID0gbmV3IEFycmF5KDB4ODApOwpjb25zdCBFb2ZDYXRlZ29yeSA9IDB4ODA7CmNvbnN0IFdoaXRlU3BhY2VDYXRlZ29yeSA9IDB4ODI7CmNvbnN0IERpZ2l0Q2F0ZWdvcnkgPSAweDgzOwpjb25zdCBOYW1lU3RhcnRDYXRlZ29yeSA9IDB4ODQ7CmNvbnN0IE5vblByaW50YWJsZUNhdGVnb3J5ID0gMHg4NTsKCmZvciAobGV0IGkgPSAwOyBpIDwgQ0FURUdPUlkubGVuZ3RoOyBpKyspIHsKICAgIENBVEVHT1JZW2ldID0KICAgICAgICBpc1doaXRlU3BhY2UoaSkgJiYgV2hpdGVTcGFjZUNhdGVnb3J5IHx8CiAgICAgICAgaXNEaWdpdChpKSAmJiBEaWdpdENhdGVnb3J5IHx8CiAgICAgICAgaXNOYW1lU3RhcnQoaSkgJiYgTmFtZVN0YXJ0Q2F0ZWdvcnkgfHwKICAgICAgICBpc05vblByaW50YWJsZShpKSAmJiBOb25QcmludGFibGVDYXRlZ29yeSB8fAogICAgICAgIGkgfHwgRW9mQ2F0ZWdvcnk7Cn0KCmZ1bmN0aW9uIGNoYXJDb2RlQ2F0ZWdvcnkoY29kZSkgewogICAgcmV0dXJuIGNvZGUgPCAweDgwID8gQ0FURUdPUllbY29kZV0gOiBOYW1lU3RhcnRDYXRlZ29yeTsKfQoKZnVuY3Rpb24gZ2V0Q2hhckNvZGUoc291cmNlLCBvZmZzZXQpIHsKICAgIHJldHVybiBvZmZzZXQgPCBzb3VyY2UubGVuZ3RoID8gc291cmNlLmNoYXJDb2RlQXQob2Zmc2V0KSA6IDA7Cn0KCmZ1bmN0aW9uIGdldE5ld2xpbmVMZW5ndGgoc291cmNlLCBvZmZzZXQsIGNvZGUpIHsKICAgIGlmIChjb2RlID09PSAxMyAvKiBcciAqLyAmJiBnZXRDaGFyQ29kZShzb3VyY2UsIG9mZnNldCArIDEpID09PSAxMCAvKiBcbiAqLykgewogICAgICAgIHJldHVybiAyOwogICAgfQoKICAgIHJldHVybiAxOwp9CgpmdW5jdGlvbiBjbXBDaGFyKHRlc3RTdHIsIG9mZnNldCwgcmVmZXJlbmNlQ29kZSkgewogICAgbGV0IGNvZGUgPSB0ZXN0U3RyLmNoYXJDb2RlQXQob2Zmc2V0KTsKCiAgICAvLyBjb2RlLnRvTG93ZXJDYXNlKCkgZm9yIEEuLloKICAgIGlmIChpc1VwcGVyY2FzZUxldHRlcihjb2RlKSkgewogICAgICAgIGNvZGUgPSBjb2RlIHwgMzI7CiAgICB9CgogICAgcmV0dXJuIGNvZGUgPT09IHJlZmVyZW5jZUNvZGU7Cn0KCmZ1bmN0aW9uIGNtcFN0cih0ZXN0U3RyLCBzdGFydCwgZW5kLCByZWZlcmVuY2VTdHIpIHsKICAgIGlmIChlbmQgLSBzdGFydCAhPT0gcmVmZXJlbmNlU3RyLmxlbmd0aCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAoc3RhcnQgPCAwIHx8IGVuZCA+IHRlc3RTdHIubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8IGVuZDsgaSsrKSB7CiAgICAgICAgY29uc3QgcmVmZXJlbmNlQ29kZSA9IHJlZmVyZW5jZVN0ci5jaGFyQ29kZUF0KGkgLSBzdGFydCk7CiAgICAgICAgbGV0IHRlc3RDb2RlID0gdGVzdFN0ci5jaGFyQ29kZUF0KGkpOwoKICAgICAgICAvLyB0ZXN0Q29kZS50b0xvd2VyQ2FzZSgpIGZvciBBLi5aCiAgICAgICAgaWYgKGlzVXBwZXJjYXNlTGV0dGVyKHRlc3RDb2RlKSkgewogICAgICAgICAgICB0ZXN0Q29kZSA9IHRlc3RDb2RlIHwgMzI7CiAgICAgICAgfQoKICAgICAgICBpZiAodGVzdENvZGUgIT09IHJlZmVyZW5jZUNvZGUpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gZmluZFdoaXRlU3BhY2VTdGFydChzb3VyY2UsIG9mZnNldCkgewogICAgZm9yICg7IG9mZnNldCA+PSAwOyBvZmZzZXQtLSkgewogICAgICAgIGlmICghaXNXaGl0ZVNwYWNlKHNvdXJjZS5jaGFyQ29kZUF0KG9mZnNldCkpKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gb2Zmc2V0ICsgMTsKfQoKZnVuY3Rpb24gZmluZFdoaXRlU3BhY2VFbmQoc291cmNlLCBvZmZzZXQpIHsKICAgIGZvciAoOyBvZmZzZXQgPCBzb3VyY2UubGVuZ3RoOyBvZmZzZXQrKykgewogICAgICAgIGlmICghaXNXaGl0ZVNwYWNlKHNvdXJjZS5jaGFyQ29kZUF0KG9mZnNldCkpKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gb2Zmc2V0Owp9CgpmdW5jdGlvbiBmaW5kRGVjaW1hbE51bWJlckVuZChzb3VyY2UsIG9mZnNldCkgewogICAgZm9yICg7IG9mZnNldCA8IHNvdXJjZS5sZW5ndGg7IG9mZnNldCsrKSB7CiAgICAgICAgaWYgKCFpc0RpZ2l0KHNvdXJjZS5jaGFyQ29kZUF0KG9mZnNldCkpKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gb2Zmc2V0Owp9CgovLyDCpyA0LjMuNy4gQ29uc3VtZSBhbiBlc2NhcGVkIGNvZGUgcG9pbnQKZnVuY3Rpb24gY29uc3VtZUVzY2FwZWQoc291cmNlLCBvZmZzZXQpIHsKICAgIC8vIEl0IGFzc3VtZXMgdGhhdCB0aGUgVSswMDVDIFJFVkVSU0UgU09MSURVUyAoXCkgaGFzIGFscmVhZHkgYmVlbiBjb25zdW1lZCBhbmQKICAgIC8vIHRoYXQgdGhlIG5leHQgaW5wdXQgY29kZSBwb2ludCBoYXMgYWxyZWFkeSBiZWVuIHZlcmlmaWVkIHRvIGJlIHBhcnQgb2YgYSB2YWxpZCBlc2NhcGUuCiAgICBvZmZzZXQgKz0gMjsKCiAgICAvLyBoZXggZGlnaXQKICAgIGlmIChpc0hleERpZ2l0KGdldENoYXJDb2RlKHNvdXJjZSwgb2Zmc2V0IC0gMSkpKSB7CiAgICAgICAgLy8gQ29uc3VtZSBhcyBtYW55IGhleCBkaWdpdHMgYXMgcG9zc2libGUsIGJ1dCBubyBtb3JlIHRoYW4gNS4KICAgICAgICAvLyBOb3RlIHRoYXQgdGhpcyBtZWFucyAxLTYgaGV4IGRpZ2l0cyBoYXZlIGJlZW4gY29uc3VtZWQgaW4gdG90YWwuCiAgICAgICAgZm9yIChjb25zdCBtYXhPZmZzZXQgPSBNYXRoLm1pbihzb3VyY2UubGVuZ3RoLCBvZmZzZXQgKyA1KTsgb2Zmc2V0IDwgbWF4T2Zmc2V0OyBvZmZzZXQrKykgewogICAgICAgICAgICBpZiAoIWlzSGV4RGlnaXQoZ2V0Q2hhckNvZGUoc291cmNlLCBvZmZzZXQpKSkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIElmIHRoZSBuZXh0IGlucHV0IGNvZGUgcG9pbnQgaXMgd2hpdGVzcGFjZSwgY29uc3VtZSBpdCBhcyB3ZWxsLgogICAgICAgIGNvbnN0IGNvZGUgPSBnZXRDaGFyQ29kZShzb3VyY2UsIG9mZnNldCk7CiAgICAgICAgaWYgKGlzV2hpdGVTcGFjZShjb2RlKSkgewogICAgICAgICAgICBvZmZzZXQgKz0gZ2V0TmV3bGluZUxlbmd0aChzb3VyY2UsIG9mZnNldCwgY29kZSk7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBvZmZzZXQ7Cn0KCi8vIMKnNC4zLjExLiBDb25zdW1lIGEgbmFtZQovLyBOb3RlOiBUaGlzIGFsZ29yaXRobSBkb2VzIG5vdCBkbyB0aGUgdmVyaWZpY2F0aW9uIG9mIHRoZSBmaXJzdCBmZXcgY29kZSBwb2ludHMgdGhhdCBhcmUgbmVjZXNzYXJ5Ci8vIHRvIGVuc3VyZSB0aGUgcmV0dXJuZWQgY29kZSBwb2ludHMgd291bGQgY29uc3RpdHV0ZSBhbiA8aWRlbnQtdG9rZW4+LiBJZiB0aGF0IGlzIHRoZSBpbnRlbmRlZCB1c2UsCi8vIGVuc3VyZSB0aGF0IHRoZSBzdHJlYW0gc3RhcnRzIHdpdGggYW4gaWRlbnRpZmllciBiZWZvcmUgY2FsbGluZyB0aGlzIGFsZ29yaXRobS4KZnVuY3Rpb24gY29uc3VtZU5hbWUoc291cmNlLCBvZmZzZXQpIHsKICAgIC8vIExldCByZXN1bHQgaW5pdGlhbGx5IGJlIGFuIGVtcHR5IHN0cmluZy4KICAgIC8vIFJlcGVhdGVkbHkgY29uc3VtZSB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50IGZyb20gdGhlIHN0cmVhbToKICAgIGZvciAoOyBvZmZzZXQgPCBzb3VyY2UubGVuZ3RoOyBvZmZzZXQrKykgewogICAgICAgIGNvbnN0IGNvZGUgPSBzb3VyY2UuY2hhckNvZGVBdChvZmZzZXQpOwoKICAgICAgICAvLyBuYW1lIGNvZGUgcG9pbnQKICAgICAgICBpZiAoaXNOYW1lKGNvZGUpKSB7CiAgICAgICAgICAgIC8vIEFwcGVuZCB0aGUgY29kZSBwb2ludCB0byByZXN1bHQuCiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgLy8gdGhlIHN0cmVhbSBzdGFydHMgd2l0aCBhIHZhbGlkIGVzY2FwZQogICAgICAgIGlmIChpc1ZhbGlkRXNjYXBlKGNvZGUsIGdldENoYXJDb2RlKHNvdXJjZSwgb2Zmc2V0ICsgMSkpKSB7CiAgICAgICAgICAgIC8vIENvbnN1bWUgYW4gZXNjYXBlZCBjb2RlIHBvaW50LiBBcHBlbmQgdGhlIHJldHVybmVkIGNvZGUgcG9pbnQgdG8gcmVzdWx0LgogICAgICAgICAgICBvZmZzZXQgPSBjb25zdW1lRXNjYXBlZChzb3VyY2UsIG9mZnNldCkgLSAxOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIC8vIGFueXRoaW5nIGVsc2UKICAgICAgICAvLyBSZWNvbnN1bWUgdGhlIGN1cnJlbnQgaW5wdXQgY29kZSBwb2ludC4gUmV0dXJuIHJlc3VsdC4KICAgICAgICBicmVhazsKICAgIH0KCiAgICByZXR1cm4gb2Zmc2V0Owp9CgovLyDCpzQuMy4xMi4gQ29uc3VtZSBhIG51bWJlcgpmdW5jdGlvbiBjb25zdW1lTnVtYmVyJDEoc291cmNlLCBvZmZzZXQpIHsKICAgIGxldCBjb2RlID0gc291cmNlLmNoYXJDb2RlQXQob2Zmc2V0KTsKCiAgICAvLyAyLiBJZiB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50IGlzIFUrMDAyQiBQTFVTIFNJR04gKCspIG9yIFUrMDAyRCBIWVBIRU4tTUlOVVMgKC0pLAogICAgLy8gY29uc3VtZSBpdCBhbmQgYXBwZW5kIGl0IHRvIHJlcHIuCiAgICBpZiAoY29kZSA9PT0gMHgwMDJCIHx8IGNvZGUgPT09IDB4MDAyRCkgewogICAgICAgIGNvZGUgPSBzb3VyY2UuY2hhckNvZGVBdChvZmZzZXQgKz0gMSk7CiAgICB9CgogICAgLy8gMy4gV2hpbGUgdGhlIG5leHQgaW5wdXQgY29kZSBwb2ludCBpcyBhIGRpZ2l0LCBjb25zdW1lIGl0IGFuZCBhcHBlbmQgaXQgdG8gcmVwci4KICAgIGlmIChpc0RpZ2l0KGNvZGUpKSB7CiAgICAgICAgb2Zmc2V0ID0gZmluZERlY2ltYWxOdW1iZXJFbmQoc291cmNlLCBvZmZzZXQgKyAxKTsKICAgICAgICBjb2RlID0gc291cmNlLmNoYXJDb2RlQXQob2Zmc2V0KTsKICAgIH0KCiAgICAvLyA0LiBJZiB0aGUgbmV4dCAyIGlucHV0IGNvZGUgcG9pbnRzIGFyZSBVKzAwMkUgRlVMTCBTVE9QICguKSBmb2xsb3dlZCBieSBhIGRpZ2l0LCB0aGVuOgogICAgaWYgKGNvZGUgPT09IDB4MDAyRSAmJiBpc0RpZ2l0KHNvdXJjZS5jaGFyQ29kZUF0KG9mZnNldCArIDEpKSkgewogICAgICAgIC8vIDQuMSBDb25zdW1lIHRoZW0uCiAgICAgICAgLy8gNC4yIEFwcGVuZCB0aGVtIHRvIHJlcHIuCiAgICAgICAgb2Zmc2V0ICs9IDI7CgogICAgICAgIC8vIDQuMyBTZXQgdHlwZSB0byAibnVtYmVyIi4KICAgICAgICAvLyBUT0RPCgogICAgICAgIC8vIDQuNCBXaGlsZSB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50IGlzIGEgZGlnaXQsIGNvbnN1bWUgaXQgYW5kIGFwcGVuZCBpdCB0byByZXByLgoKICAgICAgICBvZmZzZXQgPSBmaW5kRGVjaW1hbE51bWJlckVuZChzb3VyY2UsIG9mZnNldCk7CiAgICB9CgogICAgLy8gNS4gSWYgdGhlIG5leHQgMiBvciAzIGlucHV0IGNvZGUgcG9pbnRzIGFyZSBVKzAwNDUgTEFUSU4gQ0FQSVRBTCBMRVRURVIgRSAoRSkKICAgIC8vIG9yIFUrMDA2NSBMQVRJTiBTTUFMTCBMRVRURVIgRSAoZSksIC4uLiAsIGZvbGxvd2VkIGJ5IGEgZGlnaXQsIHRoZW46CiAgICBpZiAoY21wQ2hhcihzb3VyY2UsIG9mZnNldCwgMTAxIC8qIGUgKi8pKSB7CiAgICAgICAgbGV0IHNpZ24gPSAwOwogICAgICAgIGNvZGUgPSBzb3VyY2UuY2hhckNvZGVBdChvZmZzZXQgKyAxKTsKCiAgICAgICAgLy8gLi4uIG9wdGlvbmFsbHkgZm9sbG93ZWQgYnkgVSswMDJEIEhZUEhFTi1NSU5VUyAoLSkgb3IgVSswMDJCIFBMVVMgU0lHTiAoKykgLi4uCiAgICAgICAgaWYgKGNvZGUgPT09IDB4MDAyRCB8fCBjb2RlID09PSAweDAwMkIpIHsKICAgICAgICAgICAgc2lnbiA9IDE7CiAgICAgICAgICAgIGNvZGUgPSBzb3VyY2UuY2hhckNvZGVBdChvZmZzZXQgKyAyKTsKICAgICAgICB9CgogICAgICAgIC8vIC4uLiBmb2xsb3dlZCBieSBhIGRpZ2l0CiAgICAgICAgaWYgKGlzRGlnaXQoY29kZSkpIHsKICAgICAgICAgICAgLy8gNS4xIENvbnN1bWUgdGhlbS4KICAgICAgICAgICAgLy8gNS4yIEFwcGVuZCB0aGVtIHRvIHJlcHIuCgogICAgICAgICAgICAvLyA1LjMgU2V0IHR5cGUgdG8gIm51bWJlciIuCiAgICAgICAgICAgIC8vIFRPRE8KCiAgICAgICAgICAgIC8vIDUuNCBXaGlsZSB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50IGlzIGEgZGlnaXQsIGNvbnN1bWUgaXQgYW5kIGFwcGVuZCBpdCB0byByZXByLgogICAgICAgICAgICBvZmZzZXQgPSBmaW5kRGVjaW1hbE51bWJlckVuZChzb3VyY2UsIG9mZnNldCArIDEgKyBzaWduICsgMSk7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBvZmZzZXQ7Cn0KCi8vIMKnIDQuMy4xNC4gQ29uc3VtZSB0aGUgcmVtbmFudHMgb2YgYSBiYWQgdXJsCi8vIC4uLiBpdHMgc29sZSB1c2UgaXMgdG8gY29uc3VtZSBlbm91Z2ggb2YgdGhlIGlucHV0IHN0cmVhbSB0byByZWFjaCBhIHJlY292ZXJ5IHBvaW50Ci8vIHdoZXJlIG5vcm1hbCB0b2tlbml6aW5nIGNhbiByZXN1bWUuCmZ1bmN0aW9uIGNvbnN1bWVCYWRVcmxSZW1uYW50cyhzb3VyY2UsIG9mZnNldCkgewogICAgLy8gUmVwZWF0ZWRseSBjb25zdW1lIHRoZSBuZXh0IGlucHV0IGNvZGUgcG9pbnQgZnJvbSB0aGUgc3RyZWFtOgogICAgZm9yICg7IG9mZnNldCA8IHNvdXJjZS5sZW5ndGg7IG9mZnNldCsrKSB7CiAgICAgICAgY29uc3QgY29kZSA9IHNvdXJjZS5jaGFyQ29kZUF0KG9mZnNldCk7CgogICAgICAgIC8vIFUrMDAyOSBSSUdIVCBQQVJFTlRIRVNJUyAoKSkKICAgICAgICAvLyBFT0YKICAgICAgICBpZiAoY29kZSA9PT0gMHgwMDI5KSB7CiAgICAgICAgICAgIC8vIFJldHVybi4KICAgICAgICAgICAgb2Zmc2V0Kys7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzVmFsaWRFc2NhcGUoY29kZSwgZ2V0Q2hhckNvZGUoc291cmNlLCBvZmZzZXQgKyAxKSkpIHsKICAgICAgICAgICAgLy8gQ29uc3VtZSBhbiBlc2NhcGVkIGNvZGUgcG9pbnQuCiAgICAgICAgICAgIC8vIE5vdGU6IFRoaXMgYWxsb3dzIGFuIGVzY2FwZWQgcmlnaHQgcGFyZW50aGVzaXMgKCJcKSIpIHRvIGJlIGVuY291bnRlcmVkCiAgICAgICAgICAgIC8vIHdpdGhvdXQgZW5kaW5nIHRoZSA8YmFkLXVybC10b2tlbj4uIFRoaXMgaXMgb3RoZXJ3aXNlIGlkZW50aWNhbCB0bwogICAgICAgICAgICAvLyB0aGUgImFueXRoaW5nIGVsc2UiIGNsYXVzZS4KICAgICAgICAgICAgb2Zmc2V0ID0gY29uc3VtZUVzY2FwZWQoc291cmNlLCBvZmZzZXQpOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gb2Zmc2V0Owp9CgovLyDCpyA0LjMuNy4gQ29uc3VtZSBhbiBlc2NhcGVkIGNvZGUgcG9pbnQKLy8gTm90ZTogVGhpcyBhbGdvcml0aG0gYXNzdW1lcyB0aGF0IGVzY2FwZWQgaXMgdmFsaWQgd2l0aG91dCBsZWFkaW5nIFUrMDA1QyBSRVZFUlNFIFNPTElEVVMgKFwpCmZ1bmN0aW9uIGRlY29kZUVzY2FwZWQoZXNjYXBlZCkgewogICAgLy8gU2luZ2xlIGNoYXIgZXNjYXBlZCB0aGF0J3Mgbm90IGEgaGV4IGRpZ2l0CiAgICBpZiAoZXNjYXBlZC5sZW5ndGggPT09IDEgJiYgIWlzSGV4RGlnaXQoZXNjYXBlZC5jaGFyQ29kZUF0KDApKSkgewogICAgICAgIHJldHVybiBlc2NhcGVkWzBdOwogICAgfQoKICAgIC8vIEludGVycHJldCB0aGUgaGV4IGRpZ2l0cyBhcyBhIGhleGFkZWNpbWFsIG51bWJlci4KICAgIGxldCBjb2RlID0gcGFyc2VJbnQoZXNjYXBlZCwgMTYpOwoKICAgIGlmICgKICAgICAgICAoY29kZSA9PT0gMCkgfHwgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgbnVtYmVyIGlzIHplcm8sCiAgICAgICAgKGNvZGUgPj0gMHhEODAwICYmIGNvZGUgPD0gMHhERkZGKSB8fCAvLyBvciBpcyBmb3IgYSBzdXJyb2dhdGUsCiAgICAgICAgKGNvZGUgPiAweDEwRkZGRikgICAgICAgICAgICAgICAgICAgICAvLyBvciBpcyBncmVhdGVyIHRoYW4gdGhlIG1heGltdW0gYWxsb3dlZCBjb2RlIHBvaW50CiAgICApIHsKICAgICAgICAvLyAuLi4gcmV0dXJuIFUrRkZGRCBSRVBMQUNFTUVOVCBDSEFSQUNURVIKICAgICAgICBjb2RlID0gMHhGRkZEOwogICAgfQoKICAgIC8vIE90aGVyd2lzZSwgcmV0dXJuIHRoZSBjb2RlIHBvaW50IHdpdGggdGhhdCB2YWx1ZS4KICAgIHJldHVybiBTdHJpbmcuZnJvbUNvZGVQb2ludChjb2RlKTsKfQoKY29uc3QgdG9rZW5OYW1lcyA9IFsKICAgICdFT0YtdG9rZW4nLAogICAgJ2lkZW50LXRva2VuJywKICAgICdmdW5jdGlvbi10b2tlbicsCiAgICAnYXQta2V5d29yZC10b2tlbicsCiAgICAnaGFzaC10b2tlbicsCiAgICAnc3RyaW5nLXRva2VuJywKICAgICdiYWQtc3RyaW5nLXRva2VuJywKICAgICd1cmwtdG9rZW4nLAogICAgJ2JhZC11cmwtdG9rZW4nLAogICAgJ2RlbGltLXRva2VuJywKICAgICdudW1iZXItdG9rZW4nLAogICAgJ3BlcmNlbnRhZ2UtdG9rZW4nLAogICAgJ2RpbWVuc2lvbi10b2tlbicsCiAgICAnd2hpdGVzcGFjZS10b2tlbicsCiAgICAnQ0RPLXRva2VuJywKICAgICdDREMtdG9rZW4nLAogICAgJ2NvbG9uLXRva2VuJywKICAgICdzZW1pY29sb24tdG9rZW4nLAogICAgJ2NvbW1hLXRva2VuJywKICAgICdbLXRva2VuJywKICAgICddLXRva2VuJywKICAgICcoLXRva2VuJywKICAgICcpLXRva2VuJywKICAgICd7LXRva2VuJywKICAgICd9LXRva2VuJwpdOwoKY29uc3QgTUlOX1NJWkUgPSAxNiAqIDEwMjQ7CgpmdW5jdGlvbiBhZG9wdEJ1ZmZlcihidWZmZXIgPSBudWxsLCBzaXplKSB7CiAgICBpZiAoYnVmZmVyID09PSBudWxsIHx8IGJ1ZmZlci5sZW5ndGggPCBzaXplKSB7CiAgICAgICAgcmV0dXJuIG5ldyBVaW50MzJBcnJheShNYXRoLm1heChzaXplICsgMTAyNCwgTUlOX1NJWkUpKTsKICAgIH0KCiAgICByZXR1cm4gYnVmZmVyOwp9Cgpjb25zdCBOJDQgPSAxMDsKY29uc3QgRiQyID0gMTI7CmNvbnN0IFIkMiA9IDEzOwoKZnVuY3Rpb24gY29tcHV0ZUxpbmVzQW5kQ29sdW1ucyhob3N0KSB7CiAgICBjb25zdCBzb3VyY2UgPSBob3N0LnNvdXJjZTsKICAgIGNvbnN0IHNvdXJjZUxlbmd0aCA9IHNvdXJjZS5sZW5ndGg7CiAgICBjb25zdCBzdGFydE9mZnNldCA9IHNvdXJjZS5sZW5ndGggPiAwID8gaXNCT00oc291cmNlLmNoYXJDb2RlQXQoMCkpIDogMDsKICAgIGNvbnN0IGxpbmVzID0gYWRvcHRCdWZmZXIoaG9zdC5saW5lcywgc291cmNlTGVuZ3RoKTsKICAgIGNvbnN0IGNvbHVtbnMgPSBhZG9wdEJ1ZmZlcihob3N0LmNvbHVtbnMsIHNvdXJjZUxlbmd0aCk7CiAgICBsZXQgbGluZSA9IGhvc3Quc3RhcnRMaW5lOwogICAgbGV0IGNvbHVtbiA9IGhvc3Quc3RhcnRDb2x1bW47CgogICAgZm9yIChsZXQgaSA9IHN0YXJ0T2Zmc2V0OyBpIDwgc291cmNlTGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBjb2RlID0gc291cmNlLmNoYXJDb2RlQXQoaSk7CgogICAgICAgIGxpbmVzW2ldID0gbGluZTsKICAgICAgICBjb2x1bW5zW2ldID0gY29sdW1uKys7CgogICAgICAgIGlmIChjb2RlID09PSBOJDQgfHwgY29kZSA9PT0gUiQyIHx8IGNvZGUgPT09IEYkMikgewogICAgICAgICAgICBpZiAoY29kZSA9PT0gUiQyICYmIGkgKyAxIDwgc291cmNlTGVuZ3RoICYmIHNvdXJjZS5jaGFyQ29kZUF0KGkgKyAxKSA9PT0gTiQ0KSB7CiAgICAgICAgICAgICAgICBpKys7CiAgICAgICAgICAgICAgICBsaW5lc1tpXSA9IGxpbmU7CiAgICAgICAgICAgICAgICBjb2x1bW5zW2ldID0gY29sdW1uOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsaW5lKys7CiAgICAgICAgICAgIGNvbHVtbiA9IDE7CiAgICAgICAgfQogICAgfQoKICAgIGxpbmVzW3NvdXJjZUxlbmd0aF0gPSBsaW5lOwogICAgY29sdW1uc1tzb3VyY2VMZW5ndGhdID0gY29sdW1uOwoKICAgIGhvc3QubGluZXMgPSBsaW5lczsKICAgIGhvc3QuY29sdW1ucyA9IGNvbHVtbnM7CiAgICBob3N0LmNvbXB1dGVkID0gdHJ1ZTsKfQoKY2xhc3MgT2Zmc2V0VG9Mb2NhdGlvbiB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICB0aGlzLmxpbmVzID0gbnVsbDsKICAgICAgICB0aGlzLmNvbHVtbnMgPSBudWxsOwogICAgICAgIHRoaXMuY29tcHV0ZWQgPSBmYWxzZTsKICAgIH0KICAgIHNldFNvdXJjZShzb3VyY2UsIHN0YXJ0T2Zmc2V0ID0gMCwgc3RhcnRMaW5lID0gMSwgc3RhcnRDb2x1bW4gPSAxKSB7CiAgICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7CiAgICAgICAgdGhpcy5zdGFydE9mZnNldCA9IHN0YXJ0T2Zmc2V0OwogICAgICAgIHRoaXMuc3RhcnRMaW5lID0gc3RhcnRMaW5lOwogICAgICAgIHRoaXMuc3RhcnRDb2x1bW4gPSBzdGFydENvbHVtbjsKICAgICAgICB0aGlzLmNvbXB1dGVkID0gZmFsc2U7CiAgICB9CiAgICBnZXRMb2NhdGlvbihvZmZzZXQsIGZpbGVuYW1lKSB7CiAgICAgICAgaWYgKCF0aGlzLmNvbXB1dGVkKSB7CiAgICAgICAgICAgIGNvbXB1dGVMaW5lc0FuZENvbHVtbnModGhpcyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzb3VyY2U6IGZpbGVuYW1lLAogICAgICAgICAgICBvZmZzZXQ6IHRoaXMuc3RhcnRPZmZzZXQgKyBvZmZzZXQsCiAgICAgICAgICAgIGxpbmU6IHRoaXMubGluZXNbb2Zmc2V0XSwKICAgICAgICAgICAgY29sdW1uOiB0aGlzLmNvbHVtbnNbb2Zmc2V0XQogICAgICAgIH07CiAgICB9CiAgICBnZXRMb2NhdGlvblJhbmdlKHN0YXJ0LCBlbmQsIGZpbGVuYW1lKSB7CiAgICAgICAgaWYgKCF0aGlzLmNvbXB1dGVkKSB7CiAgICAgICAgICAgIGNvbXB1dGVMaW5lc0FuZENvbHVtbnModGhpcyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzb3VyY2U6IGZpbGVuYW1lLAogICAgICAgICAgICBzdGFydDogewogICAgICAgICAgICAgICAgb2Zmc2V0OiB0aGlzLnN0YXJ0T2Zmc2V0ICsgc3RhcnQsCiAgICAgICAgICAgICAgICBsaW5lOiB0aGlzLmxpbmVzW3N0YXJ0XSwKICAgICAgICAgICAgICAgIGNvbHVtbjogdGhpcy5jb2x1bW5zW3N0YXJ0XQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbmQ6IHsKICAgICAgICAgICAgICAgIG9mZnNldDogdGhpcy5zdGFydE9mZnNldCArIGVuZCwKICAgICAgICAgICAgICAgIGxpbmU6IHRoaXMubGluZXNbZW5kXSwKICAgICAgICAgICAgICAgIGNvbHVtbjogdGhpcy5jb2x1bW5zW2VuZF0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9Cn0KCmNvbnN0IE9GRlNFVF9NQVNLID0gMHgwMEZGRkZGRjsKY29uc3QgVFlQRV9TSElGVCA9IDI0Owpjb25zdCBiYWxhbmNlUGFpciQxID0gbmV3IE1hcChbCiAgICBbRnVuY3Rpb24kMiwgUmlnaHRQYXJlbnRoZXNpc10sCiAgICBbTGVmdFBhcmVudGhlc2lzLCBSaWdodFBhcmVudGhlc2lzXSwKICAgIFtMZWZ0U3F1YXJlQnJhY2tldCwgUmlnaHRTcXVhcmVCcmFja2V0XSwKICAgIFtMZWZ0Q3VybHlCcmFja2V0LCBSaWdodEN1cmx5QnJhY2tldF0KXSk7CgpjbGFzcyBUb2tlblN0cmVhbSB7CiAgICBjb25zdHJ1Y3Rvcihzb3VyY2UsIHRva2VuaXplKSB7CiAgICAgICAgdGhpcy5zZXRTb3VyY2Uoc291cmNlLCB0b2tlbml6ZSk7CiAgICB9CiAgICByZXNldCgpIHsKICAgICAgICB0aGlzLmVvZiA9IGZhbHNlOwogICAgICAgIHRoaXMudG9rZW5JbmRleCA9IC0xOwogICAgICAgIHRoaXMudG9rZW5UeXBlID0gMDsKICAgICAgICB0aGlzLnRva2VuU3RhcnQgPSB0aGlzLmZpcnN0Q2hhck9mZnNldDsKICAgICAgICB0aGlzLnRva2VuRW5kID0gdGhpcy5maXJzdENoYXJPZmZzZXQ7CiAgICB9CiAgICBzZXRTb3VyY2Uoc291cmNlID0gJycsIHRva2VuaXplID0gKCkgPT4ge30pIHsKICAgICAgICBzb3VyY2UgPSBTdHJpbmcoc291cmNlIHx8ICcnKTsKCiAgICAgICAgY29uc3Qgc291cmNlTGVuZ3RoID0gc291cmNlLmxlbmd0aDsKICAgICAgICBjb25zdCBvZmZzZXRBbmRUeXBlID0gYWRvcHRCdWZmZXIodGhpcy5vZmZzZXRBbmRUeXBlLCBzb3VyY2UubGVuZ3RoICsgMSk7IC8vICsxIGJlY2F1c2Ugb2YgZW9mLXRva2VuCiAgICAgICAgY29uc3QgYmFsYW5jZSA9IGFkb3B0QnVmZmVyKHRoaXMuYmFsYW5jZSwgc291cmNlLmxlbmd0aCArIDEpOwogICAgICAgIGxldCB0b2tlbkNvdW50ID0gMDsKICAgICAgICBsZXQgYmFsYW5jZUNsb3NlVHlwZSA9IDA7CiAgICAgICAgbGV0IGJhbGFuY2VTdGFydCA9IDA7CiAgICAgICAgbGV0IGZpcnN0Q2hhck9mZnNldCA9IC0xOwoKICAgICAgICAvLyBjYXB0dXJlIGJ1ZmZlcnMKICAgICAgICB0aGlzLm9mZnNldEFuZFR5cGUgPSBudWxsOwogICAgICAgIHRoaXMuYmFsYW5jZSA9IG51bGw7CgogICAgICAgIHRva2VuaXplKHNvdXJjZSwgKHR5cGUsIHN0YXJ0LCBlbmQpID0+IHsKICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIGJhbGFuY2VbdG9rZW5Db3VudF0gPSBzb3VyY2VMZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSBiYWxhbmNlQ2xvc2VUeXBlOiB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGJhbGFuY2VQcmV2ID0gYmFsYW5jZVN0YXJ0ICYgT0ZGU0VUX01BU0s7CiAgICAgICAgICAgICAgICAgICAgYmFsYW5jZVN0YXJ0ID0gYmFsYW5jZVtiYWxhbmNlUHJldl07CiAgICAgICAgICAgICAgICAgICAgYmFsYW5jZUNsb3NlVHlwZSA9IGJhbGFuY2VTdGFydCA+PiBUWVBFX1NISUZUOwogICAgICAgICAgICAgICAgICAgIGJhbGFuY2VbdG9rZW5Db3VudF0gPSBiYWxhbmNlUHJldjsKICAgICAgICAgICAgICAgICAgICBiYWxhbmNlW2JhbGFuY2VQcmV2KytdID0gdG9rZW5Db3VudDsKICAgICAgICAgICAgICAgICAgICBmb3IgKDsgYmFsYW5jZVByZXYgPCB0b2tlbkNvdW50OyBiYWxhbmNlUHJldisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiYWxhbmNlW2JhbGFuY2VQcmV2XSA9PT0gc291cmNlTGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWxhbmNlW2JhbGFuY2VQcmV2XSA9IHRva2VuQ291bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY2FzZSBMZWZ0UGFyZW50aGVzaXM6CiAgICAgICAgICAgICAgICBjYXNlIEZ1bmN0aW9uJDI6CiAgICAgICAgICAgICAgICBjYXNlIExlZnRTcXVhcmVCcmFja2V0OgogICAgICAgICAgICAgICAgY2FzZSBMZWZ0Q3VybHlCcmFja2V0OgogICAgICAgICAgICAgICAgICAgIGJhbGFuY2VbdG9rZW5Db3VudF0gPSBiYWxhbmNlU3RhcnQ7CiAgICAgICAgICAgICAgICAgICAgYmFsYW5jZUNsb3NlVHlwZSA9IGJhbGFuY2VQYWlyJDEuZ2V0KHR5cGUpOwogICAgICAgICAgICAgICAgICAgIGJhbGFuY2VTdGFydCA9IChiYWxhbmNlQ2xvc2VUeXBlIDw8IFRZUEVfU0hJRlQpIHwgdG9rZW5Db3VudDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgb2Zmc2V0QW5kVHlwZVt0b2tlbkNvdW50KytdID0gKHR5cGUgPDwgVFlQRV9TSElGVCkgfCBlbmQ7CiAgICAgICAgICAgIGlmIChmaXJzdENoYXJPZmZzZXQgPT09IC0xKSB7CiAgICAgICAgICAgICAgICBmaXJzdENoYXJPZmZzZXQgPSBzdGFydDsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvLyBmaW5hbGl6ZSBidWZmZXJzCiAgICAgICAgb2Zmc2V0QW5kVHlwZVt0b2tlbkNvdW50XSA9IChFT0YkMSA8PCBUWVBFX1NISUZUKSB8IHNvdXJjZUxlbmd0aDsgLy8gPEVPRi10b2tlbj4KICAgICAgICBiYWxhbmNlW3Rva2VuQ291bnRdID0gc291cmNlTGVuZ3RoOwogICAgICAgIGJhbGFuY2Vbc291cmNlTGVuZ3RoXSA9IHNvdXJjZUxlbmd0aDsgLy8gcHJldmVudHMgZmFsc2UgcG9zaXRpdmUgYmFsYW5jZSBtYXRjaCB3aXRoIGFueSB0b2tlbgogICAgICAgIHdoaWxlIChiYWxhbmNlU3RhcnQgIT09IDApIHsKICAgICAgICAgICAgY29uc3QgYmFsYW5jZVByZXYgPSBiYWxhbmNlU3RhcnQgJiBPRkZTRVRfTUFTSzsKICAgICAgICAgICAgYmFsYW5jZVN0YXJ0ID0gYmFsYW5jZVtiYWxhbmNlUHJldl07CiAgICAgICAgICAgIGJhbGFuY2VbYmFsYW5jZVByZXZdID0gc291cmNlTGVuZ3RoOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7CiAgICAgICAgdGhpcy5maXJzdENoYXJPZmZzZXQgPSBmaXJzdENoYXJPZmZzZXQgPT09IC0xID8gMCA6IGZpcnN0Q2hhck9mZnNldDsKICAgICAgICB0aGlzLnRva2VuQ291bnQgPSB0b2tlbkNvdW50OwogICAgICAgIHRoaXMub2Zmc2V0QW5kVHlwZSA9IG9mZnNldEFuZFR5cGU7CiAgICAgICAgdGhpcy5iYWxhbmNlID0gYmFsYW5jZTsKCiAgICAgICAgdGhpcy5yZXNldCgpOwogICAgICAgIHRoaXMubmV4dCgpOwogICAgfQoKICAgIGxvb2t1cFR5cGUob2Zmc2V0KSB7CiAgICAgICAgb2Zmc2V0ICs9IHRoaXMudG9rZW5JbmRleDsKCiAgICAgICAgaWYgKG9mZnNldCA8IHRoaXMudG9rZW5Db3VudCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5vZmZzZXRBbmRUeXBlW29mZnNldF0gPj4gVFlQRV9TSElGVDsKICAgICAgICB9CgogICAgICAgIHJldHVybiBFT0YkMTsKICAgIH0KICAgIGxvb2t1cE9mZnNldChvZmZzZXQpIHsKICAgICAgICBvZmZzZXQgKz0gdGhpcy50b2tlbkluZGV4OwoKICAgICAgICBpZiAob2Zmc2V0IDwgdGhpcy50b2tlbkNvdW50KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm9mZnNldEFuZFR5cGVbb2Zmc2V0IC0gMV0gJiBPRkZTRVRfTUFTSzsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5sZW5ndGg7CiAgICB9CiAgICBsb29rdXBWYWx1ZShvZmZzZXQsIHJlZmVyZW5jZVN0cikgewogICAgICAgIG9mZnNldCArPSB0aGlzLnRva2VuSW5kZXg7CgogICAgICAgIGlmIChvZmZzZXQgPCB0aGlzLnRva2VuQ291bnQpIHsKICAgICAgICAgICAgcmV0dXJuIGNtcFN0cigKICAgICAgICAgICAgICAgIHRoaXMuc291cmNlLAogICAgICAgICAgICAgICAgdGhpcy5vZmZzZXRBbmRUeXBlW29mZnNldCAtIDFdICYgT0ZGU0VUX01BU0ssCiAgICAgICAgICAgICAgICB0aGlzLm9mZnNldEFuZFR5cGVbb2Zmc2V0XSAmIE9GRlNFVF9NQVNLLAogICAgICAgICAgICAgICAgcmVmZXJlbmNlU3RyCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBnZXRUb2tlblN0YXJ0KHRva2VuSW5kZXgpIHsKICAgICAgICBpZiAodG9rZW5JbmRleCA9PT0gdGhpcy50b2tlbkluZGV4KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRva2VuU3RhcnQ7CiAgICAgICAgfQoKICAgICAgICBpZiAodG9rZW5JbmRleCA+IDApIHsKICAgICAgICAgICAgcmV0dXJuIHRva2VuSW5kZXggPCB0aGlzLnRva2VuQ291bnQKICAgICAgICAgICAgICAgID8gdGhpcy5vZmZzZXRBbmRUeXBlW3Rva2VuSW5kZXggLSAxXSAmIE9GRlNFVF9NQVNLCiAgICAgICAgICAgICAgICA6IHRoaXMub2Zmc2V0QW5kVHlwZVt0aGlzLnRva2VuQ291bnRdICYgT0ZGU0VUX01BU0s7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpcy5maXJzdENoYXJPZmZzZXQ7CiAgICB9CiAgICBzdWJzdHJUb0N1cnNvcihzdGFydCkgewogICAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzdHJpbmcoc3RhcnQsIHRoaXMudG9rZW5TdGFydCk7CiAgICB9CgogICAgaXNCYWxhbmNlRWRnZShwb3MpIHsKICAgICAgICByZXR1cm4gdGhpcy5iYWxhbmNlW3RoaXMudG9rZW5JbmRleF0gPCBwb3M7CiAgICB9CiAgICBpc0RlbGltKGNvZGUsIG9mZnNldCkgewogICAgICAgIGlmIChvZmZzZXQpIHsKICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgIHRoaXMubG9va3VwVHlwZShvZmZzZXQpID09PSBEZWxpbSAmJgogICAgICAgICAgICAgICAgdGhpcy5zb3VyY2UuY2hhckNvZGVBdCh0aGlzLmxvb2t1cE9mZnNldChvZmZzZXQpKSA9PT0gY29kZQogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgdGhpcy50b2tlblR5cGUgPT09IERlbGltICYmCiAgICAgICAgICAgIHRoaXMuc291cmNlLmNoYXJDb2RlQXQodGhpcy50b2tlblN0YXJ0KSA9PT0gY29kZQogICAgICAgICk7CiAgICB9CgogICAgc2tpcCh0b2tlbkNvdW50KSB7CiAgICAgICAgbGV0IG5leHQgPSB0aGlzLnRva2VuSW5kZXggKyB0b2tlbkNvdW50OwoKICAgICAgICBpZiAobmV4dCA8IHRoaXMudG9rZW5Db3VudCkgewogICAgICAgICAgICB0aGlzLnRva2VuSW5kZXggPSBuZXh0OwogICAgICAgICAgICB0aGlzLnRva2VuU3RhcnQgPSB0aGlzLm9mZnNldEFuZFR5cGVbbmV4dCAtIDFdICYgT0ZGU0VUX01BU0s7CiAgICAgICAgICAgIG5leHQgPSB0aGlzLm9mZnNldEFuZFR5cGVbbmV4dF07CiAgICAgICAgICAgIHRoaXMudG9rZW5UeXBlID0gbmV4dCA+PiBUWVBFX1NISUZUOwogICAgICAgICAgICB0aGlzLnRva2VuRW5kID0gbmV4dCAmIE9GRlNFVF9NQVNLOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMudG9rZW5JbmRleCA9IHRoaXMudG9rZW5Db3VudDsKICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgfQogICAgfQogICAgbmV4dCgpIHsKICAgICAgICBsZXQgbmV4dCA9IHRoaXMudG9rZW5JbmRleCArIDE7CgogICAgICAgIGlmIChuZXh0IDwgdGhpcy50b2tlbkNvdW50KSB7CiAgICAgICAgICAgIHRoaXMudG9rZW5JbmRleCA9IG5leHQ7CiAgICAgICAgICAgIHRoaXMudG9rZW5TdGFydCA9IHRoaXMudG9rZW5FbmQ7CiAgICAgICAgICAgIG5leHQgPSB0aGlzLm9mZnNldEFuZFR5cGVbbmV4dF07CiAgICAgICAgICAgIHRoaXMudG9rZW5UeXBlID0gbmV4dCA+PiBUWVBFX1NISUZUOwogICAgICAgICAgICB0aGlzLnRva2VuRW5kID0gbmV4dCAmIE9GRlNFVF9NQVNLOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy50b2tlbkluZGV4ID0gdGhpcy50b2tlbkNvdW50OwogICAgICAgICAgICB0aGlzLnRva2VuVHlwZSA9IEVPRiQxOwogICAgICAgICAgICB0aGlzLnRva2VuU3RhcnQgPSB0aGlzLnRva2VuRW5kID0gdGhpcy5zb3VyY2UubGVuZ3RoOwogICAgICAgIH0KICAgIH0KICAgIHNraXBTQygpIHsKICAgICAgICB3aGlsZSAodGhpcy50b2tlblR5cGUgPT09IFdoaXRlU3BhY2UkMSB8fCB0aGlzLnRva2VuVHlwZSA9PT0gQ29tbWVudCQxKSB7CiAgICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgIH0KICAgIH0KICAgIHNraXBVbnRpbEJhbGFuY2VkKHN0YXJ0VG9rZW4sIHN0b3BDb25zdW1lKSB7CiAgICAgICAgbGV0IGN1cnNvciA9IHN0YXJ0VG9rZW47CiAgICAgICAgbGV0IGJhbGFuY2VFbmQ7CiAgICAgICAgbGV0IG9mZnNldDsKCiAgICAgICAgbG9vcDoKICAgICAgICBmb3IgKDsgY3Vyc29yIDwgdGhpcy50b2tlbkNvdW50OyBjdXJzb3IrKykgewogICAgICAgICAgICBiYWxhbmNlRW5kID0gdGhpcy5iYWxhbmNlW2N1cnNvcl07CgogICAgICAgICAgICAvLyBzdG9wIHNjYW5uaW5nIG9uIGJhbGFuY2UgZWRnZSB0aGF0IHBvaW50cyB0byBvZmZzZXQgYmVmb3JlIHN0YXJ0IHRva2VuCiAgICAgICAgICAgIGlmIChiYWxhbmNlRW5kIDwgc3RhcnRUb2tlbikgewogICAgICAgICAgICAgICAgYnJlYWsgbG9vcDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgb2Zmc2V0ID0gY3Vyc29yID4gMCA/IHRoaXMub2Zmc2V0QW5kVHlwZVtjdXJzb3IgLSAxXSAmIE9GRlNFVF9NQVNLIDogdGhpcy5maXJzdENoYXJPZmZzZXQ7CgogICAgICAgICAgICAvLyBjaGVjayBzdG9wIGNvbmRpdGlvbgogICAgICAgICAgICBzd2l0Y2ggKHN0b3BDb25zdW1lKHRoaXMuc291cmNlLmNoYXJDb2RlQXQob2Zmc2V0KSkpIHsKICAgICAgICAgICAgICAgIGNhc2UgMTogLy8ganVzdCBzdG9wCiAgICAgICAgICAgICAgICAgICAgYnJlYWsgbG9vcDsKCiAgICAgICAgICAgICAgICBjYXNlIDI6IC8vIHN0b3AgJiBpbmNsdWRlZAogICAgICAgICAgICAgICAgICAgIGN1cnNvcisrOwogICAgICAgICAgICAgICAgICAgIGJyZWFrIGxvb3A7CgogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAvLyBmYXN0IGZvcndhcmQgdG8gdGhlIGVuZCBvZiBiYWxhbmNlZCBibG9jawogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmJhbGFuY2VbYmFsYW5jZUVuZF0gPT09IGN1cnNvcikgewogICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3IgPSBiYWxhbmNlRW5kOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5za2lwKGN1cnNvciAtIHRoaXMudG9rZW5JbmRleCk7CiAgICB9CgogICAgZm9yRWFjaFRva2VuKGZuKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIG9mZnNldCA9IHRoaXMuZmlyc3RDaGFyT2Zmc2V0OyBpIDwgdGhpcy50b2tlbkNvdW50OyBpKyspIHsKICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSBvZmZzZXQ7CiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLm9mZnNldEFuZFR5cGVbaV07CiAgICAgICAgICAgIGNvbnN0IGVuZCA9IGl0ZW0gJiBPRkZTRVRfTUFTSzsKICAgICAgICAgICAgY29uc3QgdHlwZSA9IGl0ZW0gPj4gVFlQRV9TSElGVDsKCiAgICAgICAgICAgIG9mZnNldCA9IGVuZDsKCiAgICAgICAgICAgIGZuKHR5cGUsIHN0YXJ0LCBlbmQsIGkpOwogICAgICAgIH0KICAgIH0KICAgIGR1bXAoKSB7CiAgICAgICAgY29uc3QgdG9rZW5zID0gbmV3IEFycmF5KHRoaXMudG9rZW5Db3VudCk7CgogICAgICAgIHRoaXMuZm9yRWFjaFRva2VuKCh0eXBlLCBzdGFydCwgZW5kLCBpbmRleCkgPT4gewogICAgICAgICAgICB0b2tlbnNbaW5kZXhdID0gewogICAgICAgICAgICAgICAgaWR4OiBpbmRleCwKICAgICAgICAgICAgICAgIHR5cGU6IHRva2VuTmFtZXNbdHlwZV0sCiAgICAgICAgICAgICAgICBjaHVuazogdGhpcy5zb3VyY2Uuc3Vic3RyaW5nKHN0YXJ0LCBlbmQpLAogICAgICAgICAgICAgICAgYmFsYW5jZTogdGhpcy5iYWxhbmNlW2luZGV4XQogICAgICAgICAgICB9OwogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gdG9rZW5zOwogICAgfQp9CgpmdW5jdGlvbiB0b2tlbml6ZSQxKHNvdXJjZSwgb25Ub2tlbikgewogICAgZnVuY3Rpb24gZ2V0Q2hhckNvZGUob2Zmc2V0KSB7CiAgICAgICAgcmV0dXJuIG9mZnNldCA8IHNvdXJjZUxlbmd0aCA/IHNvdXJjZS5jaGFyQ29kZUF0KG9mZnNldCkgOiAwOwogICAgfQoKICAgIC8vIMKnIDQuMy4zLiBDb25zdW1lIGEgbnVtZXJpYyB0b2tlbgogICAgZnVuY3Rpb24gY29uc3VtZU51bWVyaWNUb2tlbigpIHsKICAgICAgICAvLyBDb25zdW1lIGEgbnVtYmVyIGFuZCBsZXQgbnVtYmVyIGJlIHRoZSByZXN1bHQuCiAgICAgICAgb2Zmc2V0ID0gY29uc3VtZU51bWJlciQxKHNvdXJjZSwgb2Zmc2V0KTsKCiAgICAgICAgLy8gSWYgdGhlIG5leHQgMyBpbnB1dCBjb2RlIHBvaW50cyB3b3VsZCBzdGFydCBhbiBpZGVudGlmaWVyLCB0aGVuOgogICAgICAgIGlmIChpc0lkZW50aWZpZXJTdGFydChnZXRDaGFyQ29kZShvZmZzZXQpLCBnZXRDaGFyQ29kZShvZmZzZXQgKyAxKSwgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMikpKSB7CiAgICAgICAgICAgIC8vIENyZWF0ZSBhIDxkaW1lbnNpb24tdG9rZW4+IHdpdGggdGhlIHNhbWUgdmFsdWUgYW5kIHR5cGUgZmxhZyBhcyBudW1iZXIsIGFuZCBhIHVuaXQgc2V0IGluaXRpYWxseSB0byB0aGUgZW1wdHkgc3RyaW5nLgogICAgICAgICAgICAvLyBDb25zdW1lIGEgbmFtZS4gU2V0IHRoZSA8ZGltZW5zaW9uLXRva2VuPuKAmXMgdW5pdCB0byB0aGUgcmV0dXJuZWQgdmFsdWUuCiAgICAgICAgICAgIC8vIFJldHVybiB0aGUgPGRpbWVuc2lvbi10b2tlbj4uCiAgICAgICAgICAgIHR5cGUgPSBEaW1lbnNpb24kMTsKICAgICAgICAgICAgb2Zmc2V0ID0gY29uc3VtZU5hbWUoc291cmNlLCBvZmZzZXQpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBPdGhlcndpc2UsIGlmIHRoZSBuZXh0IGlucHV0IGNvZGUgcG9pbnQgaXMgVSswMDI1IFBFUkNFTlRBR0UgU0lHTiAoJSksIGNvbnN1bWUgaXQuCiAgICAgICAgaWYgKGdldENoYXJDb2RlKG9mZnNldCkgPT09IDB4MDAyNSkgewogICAgICAgICAgICAvLyBDcmVhdGUgYSA8cGVyY2VudGFnZS10b2tlbj4gd2l0aCB0aGUgc2FtZSB2YWx1ZSBhcyBudW1iZXIsIGFuZCByZXR1cm4gaXQuCiAgICAgICAgICAgIHR5cGUgPSBQZXJjZW50YWdlJDE7CiAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBPdGhlcndpc2UsIGNyZWF0ZSBhIDxudW1iZXItdG9rZW4+IHdpdGggdGhlIHNhbWUgdmFsdWUgYW5kIHR5cGUgZmxhZyBhcyBudW1iZXIsIGFuZCByZXR1cm4gaXQuCiAgICAgICAgdHlwZSA9IE51bWJlciQyOwogICAgfQoKICAgIC8vIMKnIDQuMy40LiBDb25zdW1lIGFuIGlkZW50LWxpa2UgdG9rZW4KICAgIGZ1bmN0aW9uIGNvbnN1bWVJZGVudExpa2VUb2tlbigpIHsKICAgICAgICBjb25zdCBuYW1lU3RhcnRPZmZzZXQgPSBvZmZzZXQ7CgogICAgICAgIC8vIENvbnN1bWUgYSBuYW1lLCBhbmQgbGV0IHN0cmluZyBiZSB0aGUgcmVzdWx0LgogICAgICAgIG9mZnNldCA9IGNvbnN1bWVOYW1lKHNvdXJjZSwgb2Zmc2V0KTsKCiAgICAgICAgLy8gSWYgc3RyaW5n4oCZcyB2YWx1ZSBpcyBhbiBBU0NJSSBjYXNlLWluc2Vuc2l0aXZlIG1hdGNoIGZvciAidXJsIiwKICAgICAgICAvLyBhbmQgdGhlIG5leHQgaW5wdXQgY29kZSBwb2ludCBpcyBVKzAwMjggTEVGVCBQQVJFTlRIRVNJUyAoKCksIGNvbnN1bWUgaXQuCiAgICAgICAgaWYgKGNtcFN0cihzb3VyY2UsIG5hbWVTdGFydE9mZnNldCwgb2Zmc2V0LCAndXJsJykgJiYgZ2V0Q2hhckNvZGUob2Zmc2V0KSA9PT0gMHgwMDI4KSB7CiAgICAgICAgICAgIC8vIFdoaWxlIHRoZSBuZXh0IHR3byBpbnB1dCBjb2RlIHBvaW50cyBhcmUgd2hpdGVzcGFjZSwgY29uc3VtZSB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50LgogICAgICAgICAgICBvZmZzZXQgPSBmaW5kV2hpdGVTcGFjZUVuZChzb3VyY2UsIG9mZnNldCArIDEpOwoKICAgICAgICAgICAgLy8gSWYgdGhlIG5leHQgb25lIG9yIHR3byBpbnB1dCBjb2RlIHBvaW50cyBhcmUgVSswMDIyIFFVT1RBVElPTiBNQVJLICgiKSwgVSswMDI3IEFQT1NUUk9QSEUgKCcpLAogICAgICAgICAgICAvLyBvciB3aGl0ZXNwYWNlIGZvbGxvd2VkIGJ5IFUrMDAyMiBRVU9UQVRJT04gTUFSSyAoIikgb3IgVSswMDI3IEFQT1NUUk9QSEUgKCcpLAogICAgICAgICAgICAvLyB0aGVuIGNyZWF0ZSBhIDxmdW5jdGlvbi10b2tlbj4gd2l0aCBpdHMgdmFsdWUgc2V0IHRvIHN0cmluZyBhbmQgcmV0dXJuIGl0LgogICAgICAgICAgICBpZiAoZ2V0Q2hhckNvZGUob2Zmc2V0KSA9PT0gMHgwMDIyIHx8CiAgICAgICAgICAgICAgICBnZXRDaGFyQ29kZShvZmZzZXQpID09PSAweDAwMjcpIHsKICAgICAgICAgICAgICAgIHR5cGUgPSBGdW5jdGlvbiQyOwogICAgICAgICAgICAgICAgb2Zmc2V0ID0gbmFtZVN0YXJ0T2Zmc2V0ICsgNDsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCBjb25zdW1lIGEgdXJsIHRva2VuLCBhbmQgcmV0dXJuIGl0LgogICAgICAgICAgICBjb25zdW1lVXJsVG9rZW4oKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gT3RoZXJ3aXNlLCBpZiB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50IGlzIFUrMDAyOCBMRUZUIFBBUkVOVEhFU0lTICgoKSwgY29uc3VtZSBpdC4KICAgICAgICAvLyBDcmVhdGUgYSA8ZnVuY3Rpb24tdG9rZW4+IHdpdGggaXRzIHZhbHVlIHNldCB0byBzdHJpbmcgYW5kIHJldHVybiBpdC4KICAgICAgICBpZiAoZ2V0Q2hhckNvZGUob2Zmc2V0KSA9PT0gMHgwMDI4KSB7CiAgICAgICAgICAgIHR5cGUgPSBGdW5jdGlvbiQyOwogICAgICAgICAgICBvZmZzZXQrKzsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gT3RoZXJ3aXNlLCBjcmVhdGUgYW4gPGlkZW50LXRva2VuPiB3aXRoIGl0cyB2YWx1ZSBzZXQgdG8gc3RyaW5nIGFuZCByZXR1cm4gaXQuCiAgICAgICAgdHlwZSA9IElkZW50OwogICAgfQoKICAgIC8vIMKnIDQuMy41LiBDb25zdW1lIGEgc3RyaW5nIHRva2VuCiAgICBmdW5jdGlvbiBjb25zdW1lU3RyaW5nVG9rZW4oZW5kaW5nQ29kZVBvaW50KSB7CiAgICAgICAgLy8gVGhpcyBhbGdvcml0aG0gbWF5IGJlIGNhbGxlZCB3aXRoIGFuIGVuZGluZyBjb2RlIHBvaW50LCB3aGljaCBkZW5vdGVzIHRoZSBjb2RlIHBvaW50CiAgICAgICAgLy8gdGhhdCBlbmRzIHRoZSBzdHJpbmcuIElmIGFuIGVuZGluZyBjb2RlIHBvaW50IGlzIG5vdCBzcGVjaWZpZWQsCiAgICAgICAgLy8gdGhlIGN1cnJlbnQgaW5wdXQgY29kZSBwb2ludCBpcyB1c2VkLgogICAgICAgIGlmICghZW5kaW5nQ29kZVBvaW50KSB7CiAgICAgICAgICAgIGVuZGluZ0NvZGVQb2ludCA9IGdldENoYXJDb2RlKG9mZnNldCsrKTsKICAgICAgICB9CgogICAgICAgIC8vIEluaXRpYWxseSBjcmVhdGUgYSA8c3RyaW5nLXRva2VuPiB3aXRoIGl0cyB2YWx1ZSBzZXQgdG8gdGhlIGVtcHR5IHN0cmluZy4KICAgICAgICB0eXBlID0gU3RyaW5nJDI7CgogICAgICAgIC8vIFJlcGVhdGVkbHkgY29uc3VtZSB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50IGZyb20gdGhlIHN0cmVhbToKICAgICAgICBmb3IgKDsgb2Zmc2V0IDwgc291cmNlLmxlbmd0aDsgb2Zmc2V0KyspIHsKICAgICAgICAgICAgY29uc3QgY29kZSA9IHNvdXJjZS5jaGFyQ29kZUF0KG9mZnNldCk7CgogICAgICAgICAgICBzd2l0Y2ggKGNoYXJDb2RlQ2F0ZWdvcnkoY29kZSkpIHsKICAgICAgICAgICAgICAgIC8vIGVuZGluZyBjb2RlIHBvaW50CiAgICAgICAgICAgICAgICBjYXNlIGVuZGluZ0NvZGVQb2ludDoKICAgICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdGhlIDxzdHJpbmctdG9rZW4+LgogICAgICAgICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAgICAgICAgLy8gRU9GCiAgICAgICAgICAgICAgICAgICAgLy8gY2FzZSBFb2ZDYXRlZ29yeToKICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGEgcGFyc2UgZXJyb3IuIFJldHVybiB0aGUgPHN0cmluZy10b2tlbj4uCiAgICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuOwoKICAgICAgICAgICAgICAgIC8vIG5ld2xpbmUKICAgICAgICAgICAgICAgIGNhc2UgV2hpdGVTcGFjZUNhdGVnb3J5OgogICAgICAgICAgICAgICAgICAgIGlmIChpc05ld2xpbmUoY29kZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIHBhcnNlIGVycm9yLiBSZWNvbnN1bWUgdGhlIGN1cnJlbnQgaW5wdXQgY29kZSBwb2ludCwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY3JlYXRlIGEgPGJhZC1zdHJpbmctdG9rZW4+LCBhbmQgcmV0dXJuIGl0LgogICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQgKz0gZ2V0TmV3bGluZUxlbmd0aChzb3VyY2UsIG9mZnNldCwgY29kZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSBCYWRTdHJpbmc7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgLy8gVSswMDVDIFJFVkVSU0UgU09MSURVUyAoXCkKICAgICAgICAgICAgICAgIGNhc2UgMHgwMDVDOgogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBuZXh0IGlucHV0IGNvZGUgcG9pbnQgaXMgRU9GLCBkbyBub3RoaW5nLgogICAgICAgICAgICAgICAgICAgIGlmIChvZmZzZXQgPT09IHNvdXJjZS5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV4dENvZGUgPSBnZXRDaGFyQ29kZShvZmZzZXQgKyAxKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCBpZiB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50IGlzIGEgbmV3bGluZSwgY29uc3VtZSBpdC4KICAgICAgICAgICAgICAgICAgICBpZiAoaXNOZXdsaW5lKG5leHRDb2RlKSkgewogICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQgKz0gZ2V0TmV3bGluZUxlbmd0aChzb3VyY2UsIG9mZnNldCArIDEsIG5leHRDb2RlKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzVmFsaWRFc2NhcGUoY29kZSwgbmV4dENvZGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgKHRoZSBzdHJlYW0gc3RhcnRzIHdpdGggYSB2YWxpZCBlc2NhcGUpIGNvbnN1bWUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW4gZXNjYXBlZCBjb2RlIHBvaW50IGFuZCBhcHBlbmQgdGhlIHJldHVybmVkIGNvZGUgcG9pbnQgdG8KICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIDxzdHJpbmctdG9rZW4+4oCZcyB2YWx1ZS4KICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gY29uc3VtZUVzY2FwZWQoc291cmNlLCBvZmZzZXQpIC0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgLy8gYW55dGhpbmcgZWxzZQogICAgICAgICAgICAgICAgLy8gQXBwZW5kIHRoZSBjdXJyZW50IGlucHV0IGNvZGUgcG9pbnQgdG8gdGhlIDxzdHJpbmctdG9rZW4+4oCZcyB2YWx1ZS4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLyDCpyA0LjMuNi4gQ29uc3VtZSBhIHVybCB0b2tlbgogICAgLy8gTm90ZTogVGhpcyBhbGdvcml0aG0gYXNzdW1lcyB0aGF0IHRoZSBpbml0aWFsICJ1cmwoIiBoYXMgYWxyZWFkeSBiZWVuIGNvbnN1bWVkLgogICAgLy8gVGhpcyBhbGdvcml0aG0gYWxzbyBhc3N1bWVzIHRoYXQgaXTigJlzIGJlaW5nIGNhbGxlZCB0byBjb25zdW1lIGFuICJ1bnF1b3RlZCIgdmFsdWUsIGxpa2UgdXJsKGZvbykuCiAgICAvLyBBIHF1b3RlZCB2YWx1ZSwgbGlrZSB1cmwoImZvbyIpLCBpcyBwYXJzZWQgYXMgYSA8ZnVuY3Rpb24tdG9rZW4+LiBDb25zdW1lIGFuIGlkZW50LWxpa2UgdG9rZW4KICAgIC8vIGF1dG9tYXRpY2FsbHkgaGFuZGxlcyB0aGlzIGRpc3RpbmN0aW9uOyB0aGlzIGFsZ29yaXRobSBzaG91bGRu4oCZdCBiZSBjYWxsZWQgZGlyZWN0bHkgb3RoZXJ3aXNlLgogICAgZnVuY3Rpb24gY29uc3VtZVVybFRva2VuKCkgewogICAgICAgIC8vIEluaXRpYWxseSBjcmVhdGUgYSA8dXJsLXRva2VuPiB3aXRoIGl0cyB2YWx1ZSBzZXQgdG8gdGhlIGVtcHR5IHN0cmluZy4KICAgICAgICB0eXBlID0gVXJsJDE7CgogICAgICAgIC8vIENvbnN1bWUgYXMgbXVjaCB3aGl0ZXNwYWNlIGFzIHBvc3NpYmxlLgogICAgICAgIG9mZnNldCA9IGZpbmRXaGl0ZVNwYWNlRW5kKHNvdXJjZSwgb2Zmc2V0KTsKCiAgICAgICAgLy8gUmVwZWF0ZWRseSBjb25zdW1lIHRoZSBuZXh0IGlucHV0IGNvZGUgcG9pbnQgZnJvbSB0aGUgc3RyZWFtOgogICAgICAgIGZvciAoOyBvZmZzZXQgPCBzb3VyY2UubGVuZ3RoOyBvZmZzZXQrKykgewogICAgICAgICAgICBjb25zdCBjb2RlID0gc291cmNlLmNoYXJDb2RlQXQob2Zmc2V0KTsKCiAgICAgICAgICAgIHN3aXRjaCAoY2hhckNvZGVDYXRlZ29yeShjb2RlKSkgewogICAgICAgICAgICAgICAgLy8gVSswMDI5IFJJR0hUIFBBUkVOVEhFU0lTICgpKQogICAgICAgICAgICAgICAgY2FzZSAweDAwMjk6CiAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSA8dXJsLXRva2VuPi4KICAgICAgICAgICAgICAgICAgICBvZmZzZXQrKzsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgICAgIC8vIEVPRgogICAgICAgICAgICAgICAgICAgIC8vIGNhc2UgRW9mQ2F0ZWdvcnk6CiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIHBhcnNlIGVycm9yLiBSZXR1cm4gdGhlIDx1cmwtdG9rZW4+LgogICAgICAgICAgICAgICAgICAgIC8vIHJldHVybjsKCiAgICAgICAgICAgICAgICAvLyB3aGl0ZXNwYWNlCiAgICAgICAgICAgICAgICBjYXNlIFdoaXRlU3BhY2VDYXRlZ29yeToKICAgICAgICAgICAgICAgICAgICAvLyBDb25zdW1lIGFzIG11Y2ggd2hpdGVzcGFjZSBhcyBwb3NzaWJsZS4KICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSBmaW5kV2hpdGVTcGFjZUVuZChzb3VyY2UsIG9mZnNldCk7CgogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBuZXh0IGlucHV0IGNvZGUgcG9pbnQgaXMgVSswMDI5IFJJR0hUIFBBUkVOVEhFU0lTICgpKSBvciBFT0YsCiAgICAgICAgICAgICAgICAgICAgLy8gY29uc3VtZSBpdCBhbmQgcmV0dXJuIHRoZSA8dXJsLXRva2VuPgogICAgICAgICAgICAgICAgICAgIC8vIChpZiBFT0Ygd2FzIGVuY291bnRlcmVkLCB0aGlzIGlzIGEgcGFyc2UgZXJyb3IpOwogICAgICAgICAgICAgICAgICAgIGlmIChnZXRDaGFyQ29kZShvZmZzZXQpID09PSAweDAwMjkgfHwgb2Zmc2V0ID49IHNvdXJjZS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9mZnNldCA8IHNvdXJjZS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSwgY29uc3VtZSB0aGUgcmVtbmFudHMgb2YgYSBiYWQgdXJsLCBjcmVhdGUgYSA8YmFkLXVybC10b2tlbj4sCiAgICAgICAgICAgICAgICAgICAgLy8gYW5kIHJldHVybiBpdC4KICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSBjb25zdW1lQmFkVXJsUmVtbmFudHMoc291cmNlLCBvZmZzZXQpOwogICAgICAgICAgICAgICAgICAgIHR5cGUgPSBCYWRVcmw7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICAgICAgICAgIC8vIFUrMDAyMiBRVU9UQVRJT04gTUFSSyAoIikKICAgICAgICAgICAgICAgIC8vIFUrMDAyNyBBUE9TVFJPUEhFICgnKQogICAgICAgICAgICAgICAgLy8gVSswMDI4IExFRlQgUEFSRU5USEVTSVMgKCgpCiAgICAgICAgICAgICAgICAvLyBub24tcHJpbnRhYmxlIGNvZGUgcG9pbnQKICAgICAgICAgICAgICAgIGNhc2UgMHgwMDIyOgogICAgICAgICAgICAgICAgY2FzZSAweDAwMjc6CiAgICAgICAgICAgICAgICBjYXNlIDB4MDAyODoKICAgICAgICAgICAgICAgIGNhc2UgTm9uUHJpbnRhYmxlQ2F0ZWdvcnk6CiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIHBhcnNlIGVycm9yLiBDb25zdW1lIHRoZSByZW1uYW50cyBvZiBhIGJhZCB1cmwsCiAgICAgICAgICAgICAgICAgICAgLy8gY3JlYXRlIGEgPGJhZC11cmwtdG9rZW4+LCBhbmQgcmV0dXJuIGl0LgogICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IGNvbnN1bWVCYWRVcmxSZW1uYW50cyhzb3VyY2UsIG9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IEJhZFVybDsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgLy8gVSswMDVDIFJFVkVSU0UgU09MSURVUyAoXCkKICAgICAgICAgICAgICAgIGNhc2UgMHgwMDVDOgogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBzdHJlYW0gc3RhcnRzIHdpdGggYSB2YWxpZCBlc2NhcGUsIGNvbnN1bWUgYW4gZXNjYXBlZCBjb2RlIHBvaW50IGFuZAogICAgICAgICAgICAgICAgICAgIC8vIGFwcGVuZCB0aGUgcmV0dXJuZWQgY29kZSBwb2ludCB0byB0aGUgPHVybC10b2tlbj7igJlzIHZhbHVlLgogICAgICAgICAgICAgICAgICAgIGlmIChpc1ZhbGlkRXNjYXBlKGNvZGUsIGdldENoYXJDb2RlKG9mZnNldCArIDEpKSkgewogICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSBjb25zdW1lRXNjYXBlZChzb3VyY2UsIG9mZnNldCkgLSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgdGhpcyBpcyBhIHBhcnNlIGVycm9yLiBDb25zdW1lIHRoZSByZW1uYW50cyBvZiBhIGJhZCB1cmwsCiAgICAgICAgICAgICAgICAgICAgLy8gY3JlYXRlIGEgPGJhZC11cmwtdG9rZW4+LCBhbmQgcmV0dXJuIGl0LgogICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IGNvbnN1bWVCYWRVcmxSZW1uYW50cyhzb3VyY2UsIG9mZnNldCk7CiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IEJhZFVybDsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CgogICAgICAgICAgICAgICAgLy8gYW55dGhpbmcgZWxzZQogICAgICAgICAgICAgICAgLy8gQXBwZW5kIHRoZSBjdXJyZW50IGlucHV0IGNvZGUgcG9pbnQgdG8gdGhlIDx1cmwtdG9rZW4+4oCZcyB2YWx1ZS4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLyBlbnN1cmUgc291cmNlIGlzIGEgc3RyaW5nCiAgICBzb3VyY2UgPSBTdHJpbmcoc291cmNlIHx8ICcnKTsKCiAgICBjb25zdCBzb3VyY2VMZW5ndGggPSBzb3VyY2UubGVuZ3RoOwogICAgbGV0IHN0YXJ0ID0gaXNCT00oZ2V0Q2hhckNvZGUoMCkpOwogICAgbGV0IG9mZnNldCA9IHN0YXJ0OwogICAgbGV0IHR5cGU7CgogICAgLy8gaHR0cHM6Ly9kcmFmdHMuY3Nzd2cub3JnL2Nzcy1zeW50YXgtMy8jY29uc3VtZS10b2tlbgogICAgLy8gwqcgNC4zLjEuIENvbnN1bWUgYSB0b2tlbgogICAgd2hpbGUgKG9mZnNldCA8IHNvdXJjZUxlbmd0aCkgewogICAgICAgIGNvbnN0IGNvZGUgPSBzb3VyY2UuY2hhckNvZGVBdChvZmZzZXQpOwoKICAgICAgICBzd2l0Y2ggKGNoYXJDb2RlQ2F0ZWdvcnkoY29kZSkpIHsKICAgICAgICAgICAgLy8gd2hpdGVzcGFjZQogICAgICAgICAgICBjYXNlIFdoaXRlU3BhY2VDYXRlZ29yeToKICAgICAgICAgICAgICAgIC8vIENvbnN1bWUgYXMgbXVjaCB3aGl0ZXNwYWNlIGFzIHBvc3NpYmxlLiBSZXR1cm4gYSA8d2hpdGVzcGFjZS10b2tlbj4uCiAgICAgICAgICAgICAgICB0eXBlID0gV2hpdGVTcGFjZSQxOwogICAgICAgICAgICAgICAgb2Zmc2V0ID0gZmluZFdoaXRlU3BhY2VFbmQoc291cmNlLCBvZmZzZXQgKyAxKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgLy8gVSswMDIyIFFVT1RBVElPTiBNQVJLICgiKQogICAgICAgICAgICBjYXNlIDB4MDAyMjoKICAgICAgICAgICAgICAgIC8vIENvbnN1bWUgYSBzdHJpbmcgdG9rZW4gYW5kIHJldHVybiBpdC4KICAgICAgICAgICAgICAgIGNvbnN1bWVTdHJpbmdUb2tlbigpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBVKzAwMjMgTlVNQkVSIFNJR04gKCMpCiAgICAgICAgICAgIGNhc2UgMHgwMDIzOgogICAgICAgICAgICAgICAgLy8gSWYgdGhlIG5leHQgaW5wdXQgY29kZSBwb2ludCBpcyBhIG5hbWUgY29kZSBwb2ludCBvciB0aGUgbmV4dCB0d28gaW5wdXQgY29kZSBwb2ludHMgYXJlIGEgdmFsaWQgZXNjYXBlLCB0aGVuOgogICAgICAgICAgICAgICAgaWYgKGlzTmFtZShnZXRDaGFyQ29kZShvZmZzZXQgKyAxKSkgfHwgaXNWYWxpZEVzY2FwZShnZXRDaGFyQ29kZShvZmZzZXQgKyAxKSwgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMikpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGEgPGhhc2gtdG9rZW4+LgogICAgICAgICAgICAgICAgICAgIHR5cGUgPSBIYXNoJDE7CgogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBuZXh0IDMgaW5wdXQgY29kZSBwb2ludHMgd291bGQgc3RhcnQgYW4gaWRlbnRpZmllciwgc2V0IHRoZSA8aGFzaC10b2tlbj7igJlzIHR5cGUgZmxhZyB0byAiaWQiLgogICAgICAgICAgICAgICAgICAgIC8vIGlmIChpc0lkZW50aWZpZXJTdGFydChnZXRDaGFyQ29kZShvZmZzZXQgKyAxKSwgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMiksIGdldENoYXJDb2RlKG9mZnNldCArIDMpKSkgewogICAgICAgICAgICAgICAgICAgIC8vICAgICAvLyBUT0RPOiBzZXQgaWQgZmxhZwogICAgICAgICAgICAgICAgICAgIC8vIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gQ29uc3VtZSBhIG5hbWUsIGFuZCBzZXQgdGhlIDxoYXNoLXRva2VuPuKAmXMgdmFsdWUgdG8gdGhlIHJldHVybmVkIHN0cmluZy4KICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSBjb25zdW1lTmFtZShzb3VyY2UsIG9mZnNldCArIDEpOwoKICAgICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gdGhlIDxoYXNoLXRva2VuPi4KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCByZXR1cm4gYSA8ZGVsaW0tdG9rZW4+IHdpdGggaXRzIHZhbHVlIHNldCB0byB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LgogICAgICAgICAgICAgICAgICAgIHR5cGUgPSBEZWxpbTsKICAgICAgICAgICAgICAgICAgICBvZmZzZXQrKzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIC8vIFUrMDAyNyBBUE9TVFJPUEhFICgnKQogICAgICAgICAgICBjYXNlIDB4MDAyNzoKICAgICAgICAgICAgICAgIC8vIENvbnN1bWUgYSBzdHJpbmcgdG9rZW4gYW5kIHJldHVybiBpdC4KICAgICAgICAgICAgICAgIGNvbnN1bWVTdHJpbmdUb2tlbigpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBVKzAwMjggTEVGVCBQQVJFTlRIRVNJUyAoKCkKICAgICAgICAgICAgY2FzZSAweDAwMjg6CiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gYSA8KC10b2tlbj4uCiAgICAgICAgICAgICAgICB0eXBlID0gTGVmdFBhcmVudGhlc2lzOwogICAgICAgICAgICAgICAgb2Zmc2V0Kys7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIC8vIFUrMDAyOSBSSUdIVCBQQVJFTlRIRVNJUyAoKSkKICAgICAgICAgICAgY2FzZSAweDAwMjk6CiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gYSA8KS10b2tlbj4uCiAgICAgICAgICAgICAgICB0eXBlID0gUmlnaHRQYXJlbnRoZXNpczsKICAgICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBVKzAwMkIgUExVUyBTSUdOICgrKQogICAgICAgICAgICBjYXNlIDB4MDAyQjoKICAgICAgICAgICAgICAgIC8vIElmIHRoZSBpbnB1dCBzdHJlYW0gc3RhcnRzIHdpdGggYSBudW1iZXIsIC4uLgogICAgICAgICAgICAgICAgaWYgKGlzTnVtYmVyU3RhcnQoY29kZSwgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMSksIGdldENoYXJDb2RlKG9mZnNldCArIDIpKSkgewogICAgICAgICAgICAgICAgICAgIC8vIC4uLiByZWNvbnN1bWUgdGhlIGN1cnJlbnQgaW5wdXQgY29kZSBwb2ludCwgY29uc3VtZSBhIG51bWVyaWMgdG9rZW4sIGFuZCByZXR1cm4gaXQuCiAgICAgICAgICAgICAgICAgICAgY29uc3VtZU51bWVyaWNUb2tlbigpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UsIHJldHVybiBhIDxkZWxpbS10b2tlbj4gd2l0aCBpdHMgdmFsdWUgc2V0IHRvIHRoZSBjdXJyZW50IGlucHV0IGNvZGUgcG9pbnQuCiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IERlbGltOwogICAgICAgICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBVKzAwMkMgQ09NTUEgKCwpCiAgICAgICAgICAgIGNhc2UgMHgwMDJDOgogICAgICAgICAgICAgICAgLy8gUmV0dXJuIGEgPGNvbW1hLXRva2VuPi4KICAgICAgICAgICAgICAgIHR5cGUgPSBDb21tYTsKICAgICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBVKzAwMkQgSFlQSEVOLU1JTlVTICgtKQogICAgICAgICAgICBjYXNlIDB4MDAyRDoKICAgICAgICAgICAgICAgIC8vIElmIHRoZSBpbnB1dCBzdHJlYW0gc3RhcnRzIHdpdGggYSBudW1iZXIsIHJlY29uc3VtZSB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LCBjb25zdW1lIGEgbnVtZXJpYyB0b2tlbiwgYW5kIHJldHVybiBpdC4KICAgICAgICAgICAgICAgIGlmIChpc051bWJlclN0YXJ0KGNvZGUsIGdldENoYXJDb2RlKG9mZnNldCArIDEpLCBnZXRDaGFyQ29kZShvZmZzZXQgKyAyKSkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdW1lTnVtZXJpY1Rva2VuKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgaWYgdGhlIG5leHQgMiBpbnB1dCBjb2RlIHBvaW50cyBhcmUgVSswMDJEIEhZUEhFTi1NSU5VUyBVKzAwM0UgR1JFQVRFUi1USEFOIFNJR04gKC0+KSwgY29uc3VtZSB0aGVtIGFuZCByZXR1cm4gYSA8Q0RDLXRva2VuPi4KICAgICAgICAgICAgICAgICAgICBpZiAoZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMSkgPT09IDB4MDAyRCAmJgogICAgICAgICAgICAgICAgICAgICAgICBnZXRDaGFyQ29kZShvZmZzZXQgKyAyKSA9PT0gMHgwMDNFKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSBDREMkMTsKICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0ICsgMzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UsIGlmIHRoZSBpbnB1dCBzdHJlYW0gc3RhcnRzIHdpdGggYW4gaWRlbnRpZmllciwgLi4uCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0lkZW50aWZpZXJTdGFydChjb2RlLCBnZXRDaGFyQ29kZShvZmZzZXQgKyAxKSwgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMikpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAuLi4gcmVjb25zdW1lIHRoZSBjdXJyZW50IGlucHV0IGNvZGUgcG9pbnQsIGNvbnN1bWUgYW4gaWRlbnQtbGlrZSB0b2tlbiwgYW5kIHJldHVybiBpdC4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN1bWVJZGVudExpa2VUb2tlbigpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCByZXR1cm4gYSA8ZGVsaW0tdG9rZW4+IHdpdGggaXRzIHZhbHVlIHNldCB0byB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9IERlbGltOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0Kys7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIC8vIFUrMDAyRSBGVUxMIFNUT1AgKC4pCiAgICAgICAgICAgIGNhc2UgMHgwMDJFOgogICAgICAgICAgICAgICAgLy8gSWYgdGhlIGlucHV0IHN0cmVhbSBzdGFydHMgd2l0aCBhIG51bWJlciwgLi4uCiAgICAgICAgICAgICAgICBpZiAoaXNOdW1iZXJTdGFydChjb2RlLCBnZXRDaGFyQ29kZShvZmZzZXQgKyAxKSwgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMikpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLi4uIHJlY29uc3VtZSB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LCBjb25zdW1lIGEgbnVtZXJpYyB0b2tlbiwgYW5kIHJldHVybiBpdC4KICAgICAgICAgICAgICAgICAgICBjb25zdW1lTnVtZXJpY1Rva2VuKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgcmV0dXJuIGEgPGRlbGltLXRva2VuPiB3aXRoIGl0cyB2YWx1ZSBzZXQgdG8gdGhlIGN1cnJlbnQgaW5wdXQgY29kZSBwb2ludC4KICAgICAgICAgICAgICAgICAgICB0eXBlID0gRGVsaW07CiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0Kys7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBVKzAwMkYgU09MSURVUyAoLykKICAgICAgICAgICAgY2FzZSAweDAwMkY6CiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgbmV4dCB0d28gaW5wdXQgY29kZSBwb2ludCBhcmUgVSswMDJGIFNPTElEVVMgKC8pIGZvbGxvd2VkIGJ5IGEgVSswMDJBIEFTVEVSSVNLICgqKSwKICAgICAgICAgICAgICAgIGlmIChnZXRDaGFyQ29kZShvZmZzZXQgKyAxKSA9PT0gMHgwMDJBKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLi4uIGNvbnN1bWUgdGhlbSBhbmQgYWxsIGZvbGxvd2luZyBjb2RlIHBvaW50cyB1cCB0byBhbmQgaW5jbHVkaW5nIHRoZSBmaXJzdCBVKzAwMkEgQVNURVJJU0sgKCopCiAgICAgICAgICAgICAgICAgICAgLy8gZm9sbG93ZWQgYnkgYSBVKzAwMkYgU09MSURVUyAoLyksIG9yIHVwIHRvIGFuIEVPRiBjb2RlIHBvaW50LgogICAgICAgICAgICAgICAgICAgIHR5cGUgPSBDb21tZW50JDE7CiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gc291cmNlLmluZGV4T2YoJyovJywgb2Zmc2V0ICsgMik7CiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0ID09PSAtMSA/IHNvdXJjZS5sZW5ndGggOiBvZmZzZXQgKyAyOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0eXBlID0gRGVsaW07CiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0Kys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIC8vIFUrMDAzQSBDT0xPTiAoOikKICAgICAgICAgICAgY2FzZSAweDAwM0E6CiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gYSA8Y29sb24tdG9rZW4+LgogICAgICAgICAgICAgICAgdHlwZSA9IENvbG9uOwogICAgICAgICAgICAgICAgb2Zmc2V0Kys7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIC8vIFUrMDAzQiBTRU1JQ09MT04gKDspCiAgICAgICAgICAgIGNhc2UgMHgwMDNCOgogICAgICAgICAgICAgICAgLy8gUmV0dXJuIGEgPHNlbWljb2xvbi10b2tlbj4uCiAgICAgICAgICAgICAgICB0eXBlID0gU2VtaWNvbG9uOwogICAgICAgICAgICAgICAgb2Zmc2V0Kys7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIC8vIFUrMDAzQyBMRVNTLVRIQU4gU0lHTiAoPCkKICAgICAgICAgICAgY2FzZSAweDAwM0M6CiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgbmV4dCAzIGlucHV0IGNvZGUgcG9pbnRzIGFyZSBVKzAwMjEgRVhDTEFNQVRJT04gTUFSSyBVKzAwMkQgSFlQSEVOLU1JTlVTIFUrMDAyRCBIWVBIRU4tTUlOVVMgKCEtLSksIC4uLgogICAgICAgICAgICAgICAgaWYgKGdldENoYXJDb2RlKG9mZnNldCArIDEpID09PSAweDAwMjEgJiYKICAgICAgICAgICAgICAgICAgICBnZXRDaGFyQ29kZShvZmZzZXQgKyAyKSA9PT0gMHgwMDJEICYmCiAgICAgICAgICAgICAgICAgICAgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMykgPT09IDB4MDAyRCkgewogICAgICAgICAgICAgICAgICAgIC8vIC4uLiBjb25zdW1lIHRoZW0gYW5kIHJldHVybiBhIDxDRE8tdG9rZW4+LgogICAgICAgICAgICAgICAgICAgIHR5cGUgPSBDRE8kMTsKICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSBvZmZzZXQgKyA0OwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UsIHJldHVybiBhIDxkZWxpbS10b2tlbj4gd2l0aCBpdHMgdmFsdWUgc2V0IHRvIHRoZSBjdXJyZW50IGlucHV0IGNvZGUgcG9pbnQuCiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IERlbGltOwogICAgICAgICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgLy8gVSswMDQwIENPTU1FUkNJQUwgQVQgKEApCiAgICAgICAgICAgIGNhc2UgMHgwMDQwOgogICAgICAgICAgICAgICAgLy8gSWYgdGhlIG5leHQgMyBpbnB1dCBjb2RlIHBvaW50cyB3b3VsZCBzdGFydCBhbiBpZGVudGlmaWVyLCAuLi4KICAgICAgICAgICAgICAgIGlmIChpc0lkZW50aWZpZXJTdGFydChnZXRDaGFyQ29kZShvZmZzZXQgKyAxKSwgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMiksIGdldENoYXJDb2RlKG9mZnNldCArIDMpKSkgewogICAgICAgICAgICAgICAgICAgIC8vIC4uLiBjb25zdW1lIGEgbmFtZSwgY3JlYXRlIGFuIDxhdC1rZXl3b3JkLXRva2VuPiB3aXRoIGl0cyB2YWx1ZSBzZXQgdG8gdGhlIHJldHVybmVkIHZhbHVlLCBhbmQgcmV0dXJuIGl0LgogICAgICAgICAgICAgICAgICAgIHR5cGUgPSBBdEtleXdvcmQ7CiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gY29uc3VtZU5hbWUoc291cmNlLCBvZmZzZXQgKyAxKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCByZXR1cm4gYSA8ZGVsaW0tdG9rZW4+IHdpdGggaXRzIHZhbHVlIHNldCB0byB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LgogICAgICAgICAgICAgICAgICAgIHR5cGUgPSBEZWxpbTsKICAgICAgICAgICAgICAgICAgICBvZmZzZXQrKzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIC8vIFUrMDA1QiBMRUZUIFNRVUFSRSBCUkFDS0VUIChbKQogICAgICAgICAgICBjYXNlIDB4MDA1QjoKICAgICAgICAgICAgICAgIC8vIFJldHVybiBhIDxbLXRva2VuPi4KICAgICAgICAgICAgICAgIHR5cGUgPSBMZWZ0U3F1YXJlQnJhY2tldDsKICAgICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBVKzAwNUMgUkVWRVJTRSBTT0xJRFVTIChcKQogICAgICAgICAgICBjYXNlIDB4MDA1QzoKICAgICAgICAgICAgICAgIC8vIElmIHRoZSBpbnB1dCBzdHJlYW0gc3RhcnRzIHdpdGggYSB2YWxpZCBlc2NhcGUsIC4uLgogICAgICAgICAgICAgICAgaWYgKGlzVmFsaWRFc2NhcGUoY29kZSwgZ2V0Q2hhckNvZGUob2Zmc2V0ICsgMSkpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLi4uIHJlY29uc3VtZSB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LCBjb25zdW1lIGFuIGlkZW50LWxpa2UgdG9rZW4sIGFuZCByZXR1cm4gaXQuCiAgICAgICAgICAgICAgICAgICAgY29uc3VtZUlkZW50TGlrZVRva2VuKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgdGhpcyBpcyBhIHBhcnNlIGVycm9yLiBSZXR1cm4gYSA8ZGVsaW0tdG9rZW4+IHdpdGggaXRzIHZhbHVlIHNldCB0byB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LgogICAgICAgICAgICAgICAgICAgIHR5cGUgPSBEZWxpbTsKICAgICAgICAgICAgICAgICAgICBvZmZzZXQrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgLy8gVSswMDVEIFJJR0hUIFNRVUFSRSBCUkFDS0VUIChdKQogICAgICAgICAgICBjYXNlIDB4MDA1RDoKICAgICAgICAgICAgICAgIC8vIFJldHVybiBhIDxdLXRva2VuPi4KICAgICAgICAgICAgICAgIHR5cGUgPSBSaWdodFNxdWFyZUJyYWNrZXQ7CiAgICAgICAgICAgICAgICBvZmZzZXQrKzsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgLy8gVSswMDdCIExFRlQgQ1VSTFkgQlJBQ0tFVCAoeykKICAgICAgICAgICAgY2FzZSAweDAwN0I6CiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gYSA8ey10b2tlbj4uCiAgICAgICAgICAgICAgICB0eXBlID0gTGVmdEN1cmx5QnJhY2tldDsKICAgICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBVKzAwN0QgUklHSFQgQ1VSTFkgQlJBQ0tFVCAofSkKICAgICAgICAgICAgY2FzZSAweDAwN0Q6CiAgICAgICAgICAgICAgICAvLyBSZXR1cm4gYSA8fS10b2tlbj4uCiAgICAgICAgICAgICAgICB0eXBlID0gUmlnaHRDdXJseUJyYWNrZXQ7CiAgICAgICAgICAgICAgICBvZmZzZXQrKzsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgLy8gZGlnaXQKICAgICAgICAgICAgY2FzZSBEaWdpdENhdGVnb3J5OgogICAgICAgICAgICAgICAgLy8gUmVjb25zdW1lIHRoZSBjdXJyZW50IGlucHV0IGNvZGUgcG9pbnQsIGNvbnN1bWUgYSBudW1lcmljIHRva2VuLCBhbmQgcmV0dXJuIGl0LgogICAgICAgICAgICAgICAgY29uc3VtZU51bWVyaWNUb2tlbigpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBuYW1lLXN0YXJ0IGNvZGUgcG9pbnQKICAgICAgICAgICAgY2FzZSBOYW1lU3RhcnRDYXRlZ29yeToKICAgICAgICAgICAgICAgIC8vIFJlY29uc3VtZSB0aGUgY3VycmVudCBpbnB1dCBjb2RlIHBvaW50LCBjb25zdW1lIGFuIGlkZW50LWxpa2UgdG9rZW4sIGFuZCByZXR1cm4gaXQuCiAgICAgICAgICAgICAgICBjb25zdW1lSWRlbnRMaWtlVG9rZW4oKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIC8vIEVPRgogICAgICAgICAgICAgICAgLy8gY2FzZSBFb2ZDYXRlZ29yeToKICAgICAgICAgICAgICAgIC8vIFJldHVybiBhbiA8RU9GLXRva2VuPi4KICAgICAgICAgICAgICAgIC8vIGJyZWFrOwoKICAgICAgICAgICAgLy8gYW55dGhpbmcgZWxzZQogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgLy8gUmV0dXJuIGEgPGRlbGltLXRva2VuPiB3aXRoIGl0cyB2YWx1ZSBzZXQgdG8gdGhlIGN1cnJlbnQgaW5wdXQgY29kZSBwb2ludC4KICAgICAgICAgICAgICAgIHR5cGUgPSBEZWxpbTsKICAgICAgICAgICAgICAgIG9mZnNldCsrOwogICAgICAgIH0KCiAgICAgICAgLy8gcHV0IHRva2VuIHRvIHN0cmVhbQogICAgICAgIG9uVG9rZW4odHlwZSwgc3RhcnQsIHN0YXJ0ID0gb2Zmc2V0KTsKICAgIH0KfQoKLy8KLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0Ci8vICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKUjOKUgOKUgOKUgOKUgOKUgOKUgOKUkAovLyAgICAgICAgICAgICDilIzilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilLzilIBoZWFkIOKUggovLyAgICAgICAgICAgICDilIIgICAgICAgICAgICAgIOKUgiB0YWls4pSA4pS84pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSQCi8vICAgICAgICAgICAgIOKUgiAgICAgICAgICAgICAg4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSYICAgICAgICAgICAgICDilIIKLy8gICAgICAgICAgICAg4pa8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg4pa8Ci8vICAgICAgICAgICAgaXRlbSAgICAgICAgaXRlbSAgICAgICAgaXRlbSAgICAgICAgaXRlbQovLyAgICAgICAgICDilIzilIDilIDilIDilIDilIDilIDilJAgICAg4pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSQICAgIOKUjOKUgOKUgOKUgOKUgOKUgOKUgOKUkCAgICDilIzilIDilIDilIDilIDilIDilIDilJAKLy8gIG51bGwg4peA4pSA4pSA4pS84pSAcHJldiDilILil4DilIDilIDilIDilLzilIBwcmV2IOKUguKXgOKUgOKUgOKUgOKUvOKUgHByZXYg4pSC4peA4pSA4pSA4pSA4pS84pSAcHJldiDilIIKLy8gICAgICAgICAg4pSCIG5leHTilIDilLzilIDilIDilIDilrbilIIgbmV4dOKUgOKUvOKUgOKUgOKUgOKWtuKUgiBuZXh04pSA4pS84pSA4pSA4pSA4pa24pSCIG5leHTilIDilLzilIDilIDilrYgbnVsbAovLyAgICAgICAgICDilJzilIDilIDilIDilIDilIDilIDilKQgICAg4pSc4pSA4pSA4pSA4pSA4pSA4pSA4pSkICAgIOKUnOKUgOKUgOKUgOKUgOKUgOKUgOKUpCAgICDilJzilIDilIDilIDilIDilIDilIDilKQKLy8gICAgICAgICAg4pSCIGRhdGEg4pSCICAgIOKUgiBkYXRhIOKUgiAgICDilIIgZGF0YSDilIIgICAg4pSCIGRhdGEg4pSCCi8vICAgICAgICAgIOKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUmCAgICDilJTilIDilIDilIDilIDilIDilIDilJggICAg4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSYICAgIOKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUmAovLwoKbGV0IHJlbGVhc2VkQ3Vyc29ycyA9IG51bGw7CgpjbGFzcyBMaXN0IHsKICAgIHN0YXRpYyBjcmVhdGVJdGVtKGRhdGEpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBwcmV2OiBudWxsLAogICAgICAgICAgICBuZXh0OiBudWxsLAogICAgICAgICAgICBkYXRhCiAgICAgICAgfTsKICAgIH0KCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICB0aGlzLmhlYWQgPSBudWxsOwogICAgICAgIHRoaXMudGFpbCA9IG51bGw7CiAgICAgICAgdGhpcy5jdXJzb3IgPSBudWxsOwogICAgfQogICAgY3JlYXRlSXRlbShkYXRhKSB7CiAgICAgICAgcmV0dXJuIExpc3QuY3JlYXRlSXRlbShkYXRhKTsKICAgIH0KCiAgICAvLyBjdXJzb3IgaGVscGVycwogICAgYWxsb2NhdGVDdXJzb3IocHJldiwgbmV4dCkgewogICAgICAgIGxldCBjdXJzb3I7CgogICAgICAgIGlmIChyZWxlYXNlZEN1cnNvcnMgIT09IG51bGwpIHsKICAgICAgICAgICAgY3Vyc29yID0gcmVsZWFzZWRDdXJzb3JzOwogICAgICAgICAgICByZWxlYXNlZEN1cnNvcnMgPSByZWxlYXNlZEN1cnNvcnMuY3Vyc29yOwogICAgICAgICAgICBjdXJzb3IucHJldiA9IHByZXY7CiAgICAgICAgICAgIGN1cnNvci5uZXh0ID0gbmV4dDsKICAgICAgICAgICAgY3Vyc29yLmN1cnNvciA9IHRoaXMuY3Vyc29yOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN1cnNvciA9IHsKICAgICAgICAgICAgICAgIHByZXYsCiAgICAgICAgICAgICAgICBuZXh0LAogICAgICAgICAgICAgICAgY3Vyc29yOiB0aGlzLmN1cnNvcgogICAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jdXJzb3IgPSBjdXJzb3I7CgogICAgICAgIHJldHVybiBjdXJzb3I7CiAgICB9CiAgICByZWxlYXNlQ3Vyc29yKCkgewogICAgICAgIGNvbnN0IHsgY3Vyc29yIH0gPSB0aGlzOwoKICAgICAgICB0aGlzLmN1cnNvciA9IGN1cnNvci5jdXJzb3I7CiAgICAgICAgY3Vyc29yLnByZXYgPSBudWxsOwogICAgICAgIGN1cnNvci5uZXh0ID0gbnVsbDsKICAgICAgICBjdXJzb3IuY3Vyc29yID0gcmVsZWFzZWRDdXJzb3JzOwogICAgICAgIHJlbGVhc2VkQ3Vyc29ycyA9IGN1cnNvcjsKICAgIH0KICAgIHVwZGF0ZUN1cnNvcnMocHJldk9sZCwgcHJldk5ldywgbmV4dE9sZCwgbmV4dE5ldykgewogICAgICAgIGxldCB7IGN1cnNvciB9ID0gdGhpczsKCiAgICAgICAgd2hpbGUgKGN1cnNvciAhPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoY3Vyc29yLnByZXYgPT09IHByZXZPbGQpIHsKICAgICAgICAgICAgICAgIGN1cnNvci5wcmV2ID0gcHJldk5ldzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGN1cnNvci5uZXh0ID09PSBuZXh0T2xkKSB7CiAgICAgICAgICAgICAgICBjdXJzb3IubmV4dCA9IG5leHROZXc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGN1cnNvciA9IGN1cnNvci5jdXJzb3I7CiAgICAgICAgfQogICAgfQogICAgKltTeW1ib2wuaXRlcmF0b3JdKCkgewogICAgICAgIGZvciAobGV0IGN1cnNvciA9IHRoaXMuaGVhZDsgY3Vyc29yICE9PSBudWxsOyBjdXJzb3IgPSBjdXJzb3IubmV4dCkgewogICAgICAgICAgICB5aWVsZCBjdXJzb3IuZGF0YTsKICAgICAgICB9CiAgICB9CgogICAgLy8gZ2V0dGVycwogICAgZ2V0IHNpemUoKSB7CiAgICAgICAgbGV0IHNpemUgPSAwOwoKICAgICAgICBmb3IgKGxldCBjdXJzb3IgPSB0aGlzLmhlYWQ7IGN1cnNvciAhPT0gbnVsbDsgY3Vyc29yID0gY3Vyc29yLm5leHQpIHsKICAgICAgICAgICAgc2l6ZSsrOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHNpemU7CiAgICB9CiAgICBnZXQgaXNFbXB0eSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5oZWFkID09PSBudWxsOwogICAgfQogICAgZ2V0IGZpcnN0KCkgewogICAgICAgIHJldHVybiB0aGlzLmhlYWQgJiYgdGhpcy5oZWFkLmRhdGE7CiAgICB9CiAgICBnZXQgbGFzdCgpIHsKICAgICAgICByZXR1cm4gdGhpcy50YWlsICYmIHRoaXMudGFpbC5kYXRhOwogICAgfQoKICAgIC8vIGNvbnZlcnRvcnMKICAgIGZyb21BcnJheShhcnJheSkgewogICAgICAgIGxldCBjdXJzb3IgPSBudWxsOwogICAgICAgIHRoaXMuaGVhZCA9IG51bGw7CgogICAgICAgIGZvciAobGV0IGRhdGEgb2YgYXJyYXkpIHsKICAgICAgICAgICAgY29uc3QgaXRlbSA9IExpc3QuY3JlYXRlSXRlbShkYXRhKTsKCiAgICAgICAgICAgIGlmIChjdXJzb3IgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGN1cnNvci5uZXh0ID0gaXRlbTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuaGVhZCA9IGl0ZW07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGl0ZW0ucHJldiA9IGN1cnNvcjsKICAgICAgICAgICAgY3Vyc29yID0gaXRlbTsKICAgICAgICB9CgogICAgICAgIHRoaXMudGFpbCA9IGN1cnNvcjsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHRvQXJyYXkoKSB7CiAgICAgICAgcmV0dXJuIFsuLi50aGlzXTsKICAgIH0KICAgIHRvSlNPTigpIHsKICAgICAgICByZXR1cm4gWy4uLnRoaXNdOwogICAgfQoKICAgIC8vIGFycmF5LWxpa2UgbWV0aG9kcwogICAgZm9yRWFjaChmbiwgdGhpc0FyZyA9IHRoaXMpIHsKICAgICAgICAvLyBwdXNoIGN1cnNvcgogICAgICAgIGNvbnN0IGN1cnNvciA9IHRoaXMuYWxsb2NhdGVDdXJzb3IobnVsbCwgdGhpcy5oZWFkKTsKCiAgICAgICAgd2hpbGUgKGN1cnNvci5uZXh0ICE9PSBudWxsKSB7CiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBjdXJzb3IubmV4dDsKICAgICAgICAgICAgY3Vyc29yLm5leHQgPSBpdGVtLm5leHQ7CiAgICAgICAgICAgIGZuLmNhbGwodGhpc0FyZywgaXRlbS5kYXRhLCBpdGVtLCB0aGlzKTsKICAgICAgICB9CgogICAgICAgIC8vIHBvcCBjdXJzb3IKICAgICAgICB0aGlzLnJlbGVhc2VDdXJzb3IoKTsKICAgIH0KICAgIGZvckVhY2hSaWdodChmbiwgdGhpc0FyZyA9IHRoaXMpIHsKICAgICAgICAvLyBwdXNoIGN1cnNvcgogICAgICAgIGNvbnN0IGN1cnNvciA9IHRoaXMuYWxsb2NhdGVDdXJzb3IodGhpcy50YWlsLCBudWxsKTsKCiAgICAgICAgd2hpbGUgKGN1cnNvci5wcmV2ICE9PSBudWxsKSB7CiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBjdXJzb3IucHJldjsKICAgICAgICAgICAgY3Vyc29yLnByZXYgPSBpdGVtLnByZXY7CiAgICAgICAgICAgIGZuLmNhbGwodGhpc0FyZywgaXRlbS5kYXRhLCBpdGVtLCB0aGlzKTsKICAgICAgICB9CgogICAgICAgIC8vIHBvcCBjdXJzb3IKICAgICAgICB0aGlzLnJlbGVhc2VDdXJzb3IoKTsKICAgIH0KICAgIHJlZHVjZShmbiwgaW5pdGlhbFZhbHVlLCB0aGlzQXJnID0gdGhpcykgewogICAgICAgIC8vIHB1c2ggY3Vyc29yCiAgICAgICAgbGV0IGN1cnNvciA9IHRoaXMuYWxsb2NhdGVDdXJzb3IobnVsbCwgdGhpcy5oZWFkKTsKICAgICAgICBsZXQgYWNjID0gaW5pdGlhbFZhbHVlOwogICAgICAgIGxldCBpdGVtOwoKICAgICAgICB3aGlsZSAoY3Vyc29yLm5leHQgIT09IG51bGwpIHsKICAgICAgICAgICAgaXRlbSA9IGN1cnNvci5uZXh0OwogICAgICAgICAgICBjdXJzb3IubmV4dCA9IGl0ZW0ubmV4dDsKCiAgICAgICAgICAgIGFjYyA9IGZuLmNhbGwodGhpc0FyZywgYWNjLCBpdGVtLmRhdGEsIGl0ZW0sIHRoaXMpOwogICAgICAgIH0KCiAgICAgICAgLy8gcG9wIGN1cnNvcgogICAgICAgIHRoaXMucmVsZWFzZUN1cnNvcigpOwoKICAgICAgICByZXR1cm4gYWNjOwogICAgfQogICAgcmVkdWNlUmlnaHQoZm4sIGluaXRpYWxWYWx1ZSwgdGhpc0FyZyA9IHRoaXMpIHsKICAgICAgICAvLyBwdXNoIGN1cnNvcgogICAgICAgIGxldCBjdXJzb3IgPSB0aGlzLmFsbG9jYXRlQ3Vyc29yKHRoaXMudGFpbCwgbnVsbCk7CiAgICAgICAgbGV0IGFjYyA9IGluaXRpYWxWYWx1ZTsKICAgICAgICBsZXQgaXRlbTsKCiAgICAgICAgd2hpbGUgKGN1cnNvci5wcmV2ICE9PSBudWxsKSB7CiAgICAgICAgICAgIGl0ZW0gPSBjdXJzb3IucHJldjsKICAgICAgICAgICAgY3Vyc29yLnByZXYgPSBpdGVtLnByZXY7CgogICAgICAgICAgICBhY2MgPSBmbi5jYWxsKHRoaXNBcmcsIGFjYywgaXRlbS5kYXRhLCBpdGVtLCB0aGlzKTsKICAgICAgICB9CgogICAgICAgIC8vIHBvcCBjdXJzb3IKICAgICAgICB0aGlzLnJlbGVhc2VDdXJzb3IoKTsKCiAgICAgICAgcmV0dXJuIGFjYzsKICAgIH0KICAgIHNvbWUoZm4sIHRoaXNBcmcgPSB0aGlzKSB7CiAgICAgICAgZm9yIChsZXQgY3Vyc29yID0gdGhpcy5oZWFkOyBjdXJzb3IgIT09IG51bGw7IGN1cnNvciA9IGN1cnNvci5uZXh0KSB7CiAgICAgICAgICAgIGlmIChmbi5jYWxsKHRoaXNBcmcsIGN1cnNvci5kYXRhLCBjdXJzb3IsIHRoaXMpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgbWFwKGZuLCB0aGlzQXJnID0gdGhpcykgewogICAgICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBMaXN0KCk7CgogICAgICAgIGZvciAobGV0IGN1cnNvciA9IHRoaXMuaGVhZDsgY3Vyc29yICE9PSBudWxsOyBjdXJzb3IgPSBjdXJzb3IubmV4dCkgewogICAgICAgICAgICByZXN1bHQuYXBwZW5kRGF0YShmbi5jYWxsKHRoaXNBcmcsIGN1cnNvci5kYXRhLCBjdXJzb3IsIHRoaXMpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICBmaWx0ZXIoZm4sIHRoaXNBcmcgPSB0aGlzKSB7CiAgICAgICAgY29uc3QgcmVzdWx0ID0gbmV3IExpc3QoKTsKCiAgICAgICAgZm9yIChsZXQgY3Vyc29yID0gdGhpcy5oZWFkOyBjdXJzb3IgIT09IG51bGw7IGN1cnNvciA9IGN1cnNvci5uZXh0KSB7CiAgICAgICAgICAgIGlmIChmbi5jYWxsKHRoaXNBcmcsIGN1cnNvci5kYXRhLCBjdXJzb3IsIHRoaXMpKSB7CiAgICAgICAgICAgICAgICByZXN1bHQuYXBwZW5kRGF0YShjdXJzb3IuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogICAgbmV4dFVudGlsKHN0YXJ0LCBmbiwgdGhpc0FyZyA9IHRoaXMpIHsKICAgICAgICBpZiAoc3RhcnQgPT09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gcHVzaCBjdXJzb3IKICAgICAgICBjb25zdCBjdXJzb3IgPSB0aGlzLmFsbG9jYXRlQ3Vyc29yKG51bGwsIHN0YXJ0KTsKCiAgICAgICAgd2hpbGUgKGN1cnNvci5uZXh0ICE9PSBudWxsKSB7CiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBjdXJzb3IubmV4dDsKICAgICAgICAgICAgY3Vyc29yLm5leHQgPSBpdGVtLm5leHQ7CiAgICAgICAgICAgIGlmIChmbi5jYWxsKHRoaXNBcmcsIGl0ZW0uZGF0YSwgaXRlbSwgdGhpcykpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBwb3AgY3Vyc29yCiAgICAgICAgdGhpcy5yZWxlYXNlQ3Vyc29yKCk7CiAgICB9CiAgICBwcmV2VW50aWwoc3RhcnQsIGZuLCB0aGlzQXJnID0gdGhpcykgewogICAgICAgIGlmIChzdGFydCA9PT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBwdXNoIGN1cnNvcgogICAgICAgIGNvbnN0IGN1cnNvciA9IHRoaXMuYWxsb2NhdGVDdXJzb3Ioc3RhcnQsIG51bGwpOwoKICAgICAgICB3aGlsZSAoY3Vyc29yLnByZXYgIT09IG51bGwpIHsKICAgICAgICAgICAgY29uc3QgaXRlbSA9IGN1cnNvci5wcmV2OwogICAgICAgICAgICBjdXJzb3IucHJldiA9IGl0ZW0ucHJldjsKICAgICAgICAgICAgaWYgKGZuLmNhbGwodGhpc0FyZywgaXRlbS5kYXRhLCBpdGVtLCB0aGlzKSkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIHBvcCBjdXJzb3IKICAgICAgICB0aGlzLnJlbGVhc2VDdXJzb3IoKTsKICAgIH0KCiAgICAvLyBtdXRhdGlvbgogICAgY2xlYXIoKSB7CiAgICAgICAgdGhpcy5oZWFkID0gbnVsbDsKICAgICAgICB0aGlzLnRhaWwgPSBudWxsOwogICAgfQogICAgY29weSgpIHsKICAgICAgICBjb25zdCByZXN1bHQgPSBuZXcgTGlzdCgpOwoKICAgICAgICBmb3IgKGxldCBkYXRhIG9mIHRoaXMpIHsKICAgICAgICAgICAgcmVzdWx0LmFwcGVuZERhdGEoZGF0YSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgcHJlcGVuZChpdGVtKSB7CiAgICAgICAgLy8gICAgICBoZWFkCiAgICAgICAgLy8gICAgXgogICAgICAgIC8vIGl0ZW0KICAgICAgICB0aGlzLnVwZGF0ZUN1cnNvcnMobnVsbCwgaXRlbSwgdGhpcy5oZWFkLCBpdGVtKTsKCiAgICAgICAgLy8gaW5zZXJ0IHRvIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGxpc3QKICAgICAgICBpZiAodGhpcy5oZWFkICE9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIG5ldyBpdGVtIDwtIGZpcnN0IGl0ZW0KICAgICAgICAgICAgdGhpcy5oZWFkLnByZXYgPSBpdGVtOwogICAgICAgICAgICAvLyBuZXcgaXRlbSAtPiBmaXJzdCBpdGVtCiAgICAgICAgICAgIGl0ZW0ubmV4dCA9IHRoaXMuaGVhZDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBpZiBsaXN0IGhhcyBubyBoZWFkLCB0aGVuIGl0IGFsc28gaGFzIG5vIHRhaWwKICAgICAgICAgICAgLy8gaW4gdGhpcyBjYXNlIHRhaWwgcG9pbnRzIHRvIHRoZSBuZXcgaXRlbQogICAgICAgICAgICB0aGlzLnRhaWwgPSBpdGVtOwogICAgICAgIH0KCiAgICAgICAgLy8gaGVhZCBhbHdheXMgcG9pbnRzIHRvIG5ldyBpdGVtCiAgICAgICAgdGhpcy5oZWFkID0gaXRlbTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHByZXBlbmREYXRhKGRhdGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5wcmVwZW5kKExpc3QuY3JlYXRlSXRlbShkYXRhKSk7CiAgICB9CiAgICBhcHBlbmQoaXRlbSkgewogICAgICAgIHJldHVybiB0aGlzLmluc2VydChpdGVtKTsKICAgIH0KICAgIGFwcGVuZERhdGEoZGF0YSkgewogICAgICAgIHJldHVybiB0aGlzLmluc2VydChMaXN0LmNyZWF0ZUl0ZW0oZGF0YSkpOwogICAgfQogICAgaW5zZXJ0KGl0ZW0sIGJlZm9yZSA9IG51bGwpIHsKICAgICAgICBpZiAoYmVmb3JlICE9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIHByZXYgICBiZWZvcmUKICAgICAgICAgICAgLy8gICAgICBeCiAgICAgICAgICAgIC8vICAgICBpdGVtCiAgICAgICAgICAgIHRoaXMudXBkYXRlQ3Vyc29ycyhiZWZvcmUucHJldiwgaXRlbSwgYmVmb3JlLCBpdGVtKTsKCiAgICAgICAgICAgIGlmIChiZWZvcmUucHJldiA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgLy8gaW5zZXJ0IHRvIHRoZSBiZWdpbm5pbmcgb2YgbGlzdAogICAgICAgICAgICAgICAgaWYgKHRoaXMuaGVhZCAhPT0gYmVmb3JlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdiZWZvcmUgZG9lc25cJ3QgYmVsb25nIHRvIGxpc3QnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIHNpbmNlIGhlYWQgcG9pbnRzIHRvIGJlZm9yZSB0aGVyZWZvcmUgbGlzdCBkb2Vzbid0IGVtcHR5CiAgICAgICAgICAgICAgICAvLyBubyBuZWVkIHRvIGNoZWNrIHRhaWwKICAgICAgICAgICAgICAgIHRoaXMuaGVhZCA9IGl0ZW07CiAgICAgICAgICAgICAgICBiZWZvcmUucHJldiA9IGl0ZW07CiAgICAgICAgICAgICAgICBpdGVtLm5leHQgPSBiZWZvcmU7CiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUN1cnNvcnMobnVsbCwgaXRlbSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBpbnNlcnQgYmV0d2VlbiB0d28gaXRlbXMKICAgICAgICAgICAgICAgIGJlZm9yZS5wcmV2Lm5leHQgPSBpdGVtOwogICAgICAgICAgICAgICAgaXRlbS5wcmV2ID0gYmVmb3JlLnByZXY7CiAgICAgICAgICAgICAgICBiZWZvcmUucHJldiA9IGl0ZW07CiAgICAgICAgICAgICAgICBpdGVtLm5leHQgPSBiZWZvcmU7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyB0YWlsCiAgICAgICAgICAgIC8vICAgICAgXgogICAgICAgICAgICAvLyAgICAgIGl0ZW0KICAgICAgICAgICAgdGhpcy51cGRhdGVDdXJzb3JzKHRoaXMudGFpbCwgaXRlbSwgbnVsbCwgaXRlbSk7CgogICAgICAgICAgICAvLyBpbnNlcnQgdG8gdGhlIGVuZGluZyBvZiB0aGUgbGlzdAogICAgICAgICAgICBpZiAodGhpcy50YWlsICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBsYXN0IGl0ZW0gLT4gbmV3IGl0ZW0KICAgICAgICAgICAgICAgIHRoaXMudGFpbC5uZXh0ID0gaXRlbTsKICAgICAgICAgICAgICAgIC8vIGxhc3QgaXRlbSA8LSBuZXcgaXRlbQogICAgICAgICAgICAgICAgaXRlbS5wcmV2ID0gdGhpcy50YWlsOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gaWYgbGlzdCBoYXMgbm8gdGFpbCwgdGhlbiBpdCBhbHNvIGhhcyBubyBoZWFkCiAgICAgICAgICAgICAgICAvLyBpbiB0aGlzIGNhc2UgaGVhZCBwb2ludHMgdG8gbmV3IGl0ZW0KICAgICAgICAgICAgICAgIHRoaXMuaGVhZCA9IGl0ZW07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHRhaWwgYWx3YXlzIHBvaW50cyB0byBuZXcgaXRlbQogICAgICAgICAgICB0aGlzLnRhaWwgPSBpdGVtOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBpbnNlcnREYXRhKGRhdGEsIGJlZm9yZSkgewogICAgICAgIHJldHVybiB0aGlzLmluc2VydChMaXN0LmNyZWF0ZUl0ZW0oZGF0YSksIGJlZm9yZSk7CiAgICB9CiAgICByZW1vdmUoaXRlbSkgewogICAgICAgIC8vICAgICAgaXRlbQogICAgICAgIC8vICAgICAgIF4KICAgICAgICAvLyBwcmV2ICAgICBuZXh0CiAgICAgICAgdGhpcy51cGRhdGVDdXJzb3JzKGl0ZW0sIGl0ZW0ucHJldiwgaXRlbSwgaXRlbS5uZXh0KTsKCiAgICAgICAgaWYgKGl0ZW0ucHJldiAhPT0gbnVsbCkgewogICAgICAgICAgICBpdGVtLnByZXYubmV4dCA9IGl0ZW0ubmV4dDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodGhpcy5oZWFkICE9PSBpdGVtKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2l0ZW0gZG9lc25cJ3QgYmVsb25nIHRvIGxpc3QnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5oZWFkID0gaXRlbS5uZXh0OwogICAgICAgIH0KCiAgICAgICAgaWYgKGl0ZW0ubmV4dCAhPT0gbnVsbCkgewogICAgICAgICAgICBpdGVtLm5leHQucHJldiA9IGl0ZW0ucHJldjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodGhpcy50YWlsICE9PSBpdGVtKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2l0ZW0gZG9lc25cJ3QgYmVsb25nIHRvIGxpc3QnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy50YWlsID0gaXRlbS5wcmV2OwogICAgICAgIH0KCiAgICAgICAgaXRlbS5wcmV2ID0gbnVsbDsKICAgICAgICBpdGVtLm5leHQgPSBudWxsOwoKICAgICAgICByZXR1cm4gaXRlbTsKICAgIH0KICAgIHB1c2goZGF0YSkgewogICAgICAgIHRoaXMuaW5zZXJ0KExpc3QuY3JlYXRlSXRlbShkYXRhKSk7CiAgICB9CiAgICBwb3AoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudGFpbCAhPT0gbnVsbCA/IHRoaXMucmVtb3ZlKHRoaXMudGFpbCkgOiBudWxsOwogICAgfQogICAgdW5zaGlmdChkYXRhKSB7CiAgICAgICAgdGhpcy5wcmVwZW5kKExpc3QuY3JlYXRlSXRlbShkYXRhKSk7CiAgICB9CiAgICBzaGlmdCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5oZWFkICE9PSBudWxsID8gdGhpcy5yZW1vdmUodGhpcy5oZWFkKSA6IG51bGw7CiAgICB9CiAgICBwcmVwZW5kTGlzdChsaXN0KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaW5zZXJ0TGlzdChsaXN0LCB0aGlzLmhlYWQpOwogICAgfQogICAgYXBwZW5kTGlzdChsaXN0KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaW5zZXJ0TGlzdChsaXN0KTsKICAgIH0KICAgIGluc2VydExpc3QobGlzdCwgYmVmb3JlKSB7CiAgICAgICAgLy8gaWdub3JlIGVtcHR5IGxpc3RzCiAgICAgICAgaWYgKGxpc3QuaGVhZCA9PT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIGlmIChiZWZvcmUgIT09IHVuZGVmaW5lZCAmJiBiZWZvcmUgIT09IG51bGwpIHsKICAgICAgICAgICAgdGhpcy51cGRhdGVDdXJzb3JzKGJlZm9yZS5wcmV2LCBsaXN0LnRhaWwsIGJlZm9yZSwgbGlzdC5oZWFkKTsKCiAgICAgICAgICAgIC8vIGluc2VydCBpbiB0aGUgbWlkZGxlIG9mIGRpc3QgbGlzdAogICAgICAgICAgICBpZiAoYmVmb3JlLnByZXYgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIGJlZm9yZS5wcmV2IDwtPiBsaXN0LmhlYWQKICAgICAgICAgICAgICAgIGJlZm9yZS5wcmV2Lm5leHQgPSBsaXN0LmhlYWQ7CiAgICAgICAgICAgICAgICBsaXN0LmhlYWQucHJldiA9IGJlZm9yZS5wcmV2OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5oZWFkID0gbGlzdC5oZWFkOwogICAgICAgICAgICB9CgogICAgICAgICAgICBiZWZvcmUucHJldiA9IGxpc3QudGFpbDsKICAgICAgICAgICAgbGlzdC50YWlsLm5leHQgPSBiZWZvcmU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy51cGRhdGVDdXJzb3JzKHRoaXMudGFpbCwgbGlzdC50YWlsLCBudWxsLCBsaXN0LmhlYWQpOwoKICAgICAgICAgICAgLy8gaW5zZXJ0IHRvIGVuZCBvZiB0aGUgbGlzdAogICAgICAgICAgICBpZiAodGhpcy50YWlsICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBpZiBkZXN0aW5hdGlvbiBsaXN0IGhhcyBhIHRhaWwsIHRoZW4gaXQgYWxzbyBoYXMgYSBoZWFkLAogICAgICAgICAgICAgICAgLy8gYnV0IGhlYWQgZG9lc24ndCBjaGFuZ2UKICAgICAgICAgICAgICAgIC8vIGRlc3QgdGFpbCAtPiBzb3VyY2UgaGVhZAogICAgICAgICAgICAgICAgdGhpcy50YWlsLm5leHQgPSBsaXN0LmhlYWQ7CiAgICAgICAgICAgICAgICAvLyBkZXN0IHRhaWwgPC0gc291cmNlIGhlYWQKICAgICAgICAgICAgICAgIGxpc3QuaGVhZC5wcmV2ID0gdGhpcy50YWlsOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gaWYgbGlzdCBoYXMgbm8gYSB0YWlsLCB0aGVuIGl0IGFsc28gaGFzIG5vIGEgaGVhZAogICAgICAgICAgICAgICAgLy8gaW4gdGhpcyBjYXNlIHBvaW50cyBoZWFkIHRvIG5ldyBpdGVtCiAgICAgICAgICAgICAgICB0aGlzLmhlYWQgPSBsaXN0LmhlYWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHRhaWwgYWx3YXlzIHN0YXJ0IHBvaW50IHRvIG5ldyBpdGVtCiAgICAgICAgICAgIHRoaXMudGFpbCA9IGxpc3QudGFpbDsKICAgICAgICB9CgogICAgICAgIGxpc3QuaGVhZCA9IG51bGw7CiAgICAgICAgbGlzdC50YWlsID0gbnVsbDsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHJlcGxhY2Uob2xkSXRlbSwgbmV3SXRlbU9yTGlzdCkgewogICAgICAgIGlmICgnaGVhZCcgaW4gbmV3SXRlbU9yTGlzdCkgewogICAgICAgICAgICB0aGlzLmluc2VydExpc3QobmV3SXRlbU9yTGlzdCwgb2xkSXRlbSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5pbnNlcnQobmV3SXRlbU9yTGlzdCwgb2xkSXRlbSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnJlbW92ZShvbGRJdGVtKTsKICAgIH0KfQoKZnVuY3Rpb24gY3JlYXRlQ3VzdG9tRXJyb3IobmFtZSwgbWVzc2FnZSkgewogICAgLy8gdXNlIE9iamVjdC5jcmVhdGUoKSwgYmVjYXVzZSBzb21lIFZNcyBwcmV2ZW50IHNldHRpbmcgbGluZS9jb2x1bW4gb3RoZXJ3aXNlCiAgICAvLyAoaU9TIFNhZmFyaSAxMCBldmVuIHRocm93cyBhbiBleGNlcHRpb24pCiAgICBjb25zdCBlcnJvciA9IE9iamVjdC5jcmVhdGUoU3ludGF4RXJyb3IucHJvdG90eXBlKTsKICAgIGNvbnN0IGVycm9yU3RhY2sgPSBuZXcgRXJyb3IoKTsKCiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihlcnJvciwgewogICAgICAgIG5hbWUsCiAgICAgICAgbWVzc2FnZSwKICAgICAgICBnZXQgc3RhY2soKSB7CiAgICAgICAgICAgIHJldHVybiAoZXJyb3JTdGFjay5zdGFjayB8fCAnJykucmVwbGFjZSgvXiguK1xuKXsxLDN9LywgYCR7bmFtZX06ICR7bWVzc2FnZX1cbmApOwogICAgICAgIH0KICAgIH0pOwp9Cgpjb25zdCBNQVhfTElORV9MRU5HVEggPSAxMDA7CmNvbnN0IE9GRlNFVF9DT1JSRUNUSU9OID0gNjA7CmNvbnN0IFRBQl9SRVBMQUNFTUVOVCA9ICcgICAgJzsKCmZ1bmN0aW9uIHNvdXJjZUZyYWdtZW50KHsgc291cmNlLCBsaW5lLCBjb2x1bW4gfSwgZXh0cmFMaW5lcykgewogICAgZnVuY3Rpb24gcHJvY2Vzc0xpbmVzKHN0YXJ0LCBlbmQpIHsKICAgICAgICByZXR1cm4gbGluZXMKICAgICAgICAgICAgLnNsaWNlKHN0YXJ0LCBlbmQpCiAgICAgICAgICAgIC5tYXAoKGxpbmUsIGlkeCkgPT4KICAgICAgICAgICAgICAgIFN0cmluZyhzdGFydCArIGlkeCArIDEpLnBhZFN0YXJ0KG1heE51bUxlbmd0aCkgKyAnIHwnICsgbGluZQogICAgICAgICAgICApLmpvaW4oJ1xuJyk7CiAgICB9CgogICAgY29uc3QgbGluZXMgPSBzb3VyY2Uuc3BsaXQoL1xyXG4/fFxufFxmLyk7CiAgICBjb25zdCBzdGFydExpbmUgPSBNYXRoLm1heCgxLCBsaW5lIC0gZXh0cmFMaW5lcykgLSAxOwogICAgY29uc3QgZW5kTGluZSA9IE1hdGgubWluKGxpbmUgKyBleHRyYUxpbmVzLCBsaW5lcy5sZW5ndGggKyAxKTsKICAgIGNvbnN0IG1heE51bUxlbmd0aCA9IE1hdGgubWF4KDQsIFN0cmluZyhlbmRMaW5lKS5sZW5ndGgpICsgMTsKICAgIGxldCBjdXRMZWZ0ID0gMDsKCiAgICAvLyBjb2x1bW4gY29ycmVjdGlvbiBhY2NvcmRpbmcgdG8gcmVwbGFjZWQgdGFiIGJlZm9yZSBjb2x1bW4KICAgIGNvbHVtbiArPSAoVEFCX1JFUExBQ0VNRU5ULmxlbmd0aCAtIDEpICogKGxpbmVzW2xpbmUgLSAxXS5zdWJzdHIoMCwgY29sdW1uIC0gMSkubWF0Y2goL1x0L2cpIHx8IFtdKS5sZW5ndGg7CgogICAgaWYgKGNvbHVtbiA+IE1BWF9MSU5FX0xFTkdUSCkgewogICAgICAgIGN1dExlZnQgPSBjb2x1bW4gLSBPRkZTRVRfQ09SUkVDVElPTiArIDM7CiAgICAgICAgY29sdW1uID0gT0ZGU0VUX0NPUlJFQ1RJT04gLSAyOwogICAgfQoKICAgIGZvciAobGV0IGkgPSBzdGFydExpbmU7IGkgPD0gZW5kTGluZTsgaSsrKSB7CiAgICAgICAgaWYgKGkgPj0gMCAmJiBpIDwgbGluZXMubGVuZ3RoKSB7CiAgICAgICAgICAgIGxpbmVzW2ldID0gbGluZXNbaV0ucmVwbGFjZSgvXHQvZywgVEFCX1JFUExBQ0VNRU5UKTsKICAgICAgICAgICAgbGluZXNbaV0gPQogICAgICAgICAgICAgICAgKGN1dExlZnQgPiAwICYmIGxpbmVzW2ldLmxlbmd0aCA+IGN1dExlZnQgPyAnXHUyMDI2JyA6ICcnKSArCiAgICAgICAgICAgICAgICBsaW5lc1tpXS5zdWJzdHIoY3V0TGVmdCwgTUFYX0xJTkVfTEVOR1RIIC0gMikgKwogICAgICAgICAgICAgICAgKGxpbmVzW2ldLmxlbmd0aCA+IGN1dExlZnQgKyBNQVhfTElORV9MRU5HVEggLSAxID8gJ1x1MjAyNicgOiAnJyk7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBbCiAgICAgICAgcHJvY2Vzc0xpbmVzKHN0YXJ0TGluZSwgbGluZSksCiAgICAgICAgbmV3IEFycmF5KGNvbHVtbiArIG1heE51bUxlbmd0aCArIDIpLmpvaW4oJy0nKSArICdeJywKICAgICAgICBwcm9jZXNzTGluZXMobGluZSwgZW5kTGluZSkKICAgIF0uZmlsdGVyKEJvb2xlYW4pLmpvaW4oJ1xuJyk7Cn0KCmZ1bmN0aW9uIFN5bnRheEVycm9yJDIobWVzc2FnZSwgc291cmNlLCBvZmZzZXQsIGxpbmUsIGNvbHVtbikgewogICAgY29uc3QgZXJyb3IgPSBPYmplY3QuYXNzaWduKGNyZWF0ZUN1c3RvbUVycm9yKCdTeW50YXhFcnJvcicsIG1lc3NhZ2UpLCB7CiAgICAgICAgc291cmNlLAogICAgICAgIG9mZnNldCwKICAgICAgICBsaW5lLAogICAgICAgIGNvbHVtbiwKICAgICAgICBzb3VyY2VGcmFnbWVudChleHRyYUxpbmVzKSB7CiAgICAgICAgICAgIHJldHVybiBzb3VyY2VGcmFnbWVudCh7IHNvdXJjZSwgbGluZSwgY29sdW1uIH0sIGlzTmFOKGV4dHJhTGluZXMpID8gMCA6IGV4dHJhTGluZXMpOwogICAgICAgIH0sCiAgICAgICAgZ2V0IGZvcm1hdHRlZE1lc3NhZ2UoKSB7CiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICBgUGFyc2UgZXJyb3I6ICR7bWVzc2FnZX1cbmAgKwogICAgICAgICAgICAgICAgc291cmNlRnJhZ21lbnQoeyBzb3VyY2UsIGxpbmUsIGNvbHVtbiB9LCAyKQogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBlcnJvcjsKfQoKZnVuY3Rpb24gcmVhZFNlcXVlbmNlJDEocmVjb2duaXplcikgewogICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNyZWF0ZUxpc3QoKTsKICAgIGxldCBzcGFjZSA9IGZhbHNlOwogICAgY29uc3QgY29udGV4dCA9IHsKICAgICAgICByZWNvZ25pemVyCiAgICB9OwoKICAgIHdoaWxlICghdGhpcy5lb2YpIHsKICAgICAgICBzd2l0Y2ggKHRoaXMudG9rZW5UeXBlKSB7CiAgICAgICAgICAgIGNhc2UgQ29tbWVudCQxOgogICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGNhc2UgV2hpdGVTcGFjZSQxOgogICAgICAgICAgICAgICAgc3BhY2UgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIGxldCBjaGlsZCA9IHJlY29nbml6ZXIuZ2V0Tm9kZS5jYWxsKHRoaXMsIGNvbnRleHQpOwoKICAgICAgICBpZiAoY2hpbGQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIGlmIChzcGFjZSkgewogICAgICAgICAgICBpZiAocmVjb2duaXplci5vbldoaXRlU3BhY2UpIHsKICAgICAgICAgICAgICAgIHJlY29nbml6ZXIub25XaGl0ZVNwYWNlLmNhbGwodGhpcywgY2hpbGQsIGNoaWxkcmVuLCBjb250ZXh0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzcGFjZSA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgY2hpbGRyZW4ucHVzaChjaGlsZCk7CiAgICB9CgogICAgaWYgKHNwYWNlICYmIHJlY29nbml6ZXIub25XaGl0ZVNwYWNlKSB7CiAgICAgICAgcmVjb2duaXplci5vbldoaXRlU3BhY2UuY2FsbCh0aGlzLCBudWxsLCBjaGlsZHJlbiwgY29udGV4dCk7CiAgICB9CgogICAgcmV0dXJuIGNoaWxkcmVuOwp9Cgpjb25zdCBOT09QID0gKCkgPT4ge307CmNvbnN0IEVYQ0xBTUFUSU9OTUFSSyQzID0gMHgwMDIxOyAgLy8gVSswMDIxIEVYQ0xBTUFUSU9OIE1BUksgKCEpCmNvbnN0IE5VTUJFUlNJR04kNCA9IDB4MDAyMzsgICAgICAgLy8gVSswMDIzIE5VTUJFUiBTSUdOICgjKQpjb25zdCBTRU1JQ09MT04gPSAweDAwM0I7ICAgICAgICAvLyBVKzAwM0IgU0VNSUNPTE9OICg7KQpjb25zdCBMRUZUQ1VSTFlCUkFDS0VUJDEgPSAweDAwN0I7IC8vIFUrMDA3QiBMRUZUIENVUkxZIEJSQUNLRVQgKHspCmNvbnN0IE5VTEwgPSAwOwoKZnVuY3Rpb24gY3JlYXRlUGFyc2VDb250ZXh0KG5hbWUpIHsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpc1tuYW1lXSgpOwogICAgfTsKfQoKZnVuY3Rpb24gZmV0Y2hQYXJzZVZhbHVlcyhkaWN0KSB7CiAgICBjb25zdCByZXN1bHQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwoKICAgIGZvciAoY29uc3QgbmFtZSBpbiBkaWN0KSB7CiAgICAgICAgY29uc3QgaXRlbSA9IGRpY3RbbmFtZV07CiAgICAgICAgY29uc3QgZm4gPSBpdGVtLnBhcnNlIHx8IGl0ZW07CgogICAgICAgIGlmIChmbikgewogICAgICAgICAgICByZXN1bHRbbmFtZV0gPSBmbjsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIHJlc3VsdDsKfQoKZnVuY3Rpb24gcHJvY2Vzc0NvbmZpZyhjb25maWcpIHsKICAgIGNvbnN0IHBhcnNlQ29uZmlnID0gewogICAgICAgIGNvbnRleHQ6IE9iamVjdC5jcmVhdGUobnVsbCksCiAgICAgICAgc2NvcGU6IE9iamVjdC5hc3NpZ24oT2JqZWN0LmNyZWF0ZShudWxsKSwgY29uZmlnLnNjb3BlKSwKICAgICAgICBhdHJ1bGU6IGZldGNoUGFyc2VWYWx1ZXMoY29uZmlnLmF0cnVsZSksCiAgICAgICAgcHNldWRvOiBmZXRjaFBhcnNlVmFsdWVzKGNvbmZpZy5wc2V1ZG8pLAogICAgICAgIG5vZGU6IGZldGNoUGFyc2VWYWx1ZXMoY29uZmlnLm5vZGUpCiAgICB9OwoKICAgIGZvciAoY29uc3QgbmFtZSBpbiBjb25maWcucGFyc2VDb250ZXh0KSB7CiAgICAgICAgc3dpdGNoICh0eXBlb2YgY29uZmlnLnBhcnNlQ29udGV4dFtuYW1lXSkgewogICAgICAgICAgICBjYXNlICdmdW5jdGlvbic6CiAgICAgICAgICAgICAgICBwYXJzZUNvbmZpZy5jb250ZXh0W25hbWVdID0gY29uZmlnLnBhcnNlQ29udGV4dFtuYW1lXTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzoKICAgICAgICAgICAgICAgIHBhcnNlQ29uZmlnLmNvbnRleHRbbmFtZV0gPSBjcmVhdGVQYXJzZUNvbnRleHQoY29uZmlnLnBhcnNlQ29udGV4dFtuYW1lXSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICBjb25maWc6IHBhcnNlQ29uZmlnLAogICAgICAgIC4uLnBhcnNlQ29uZmlnLAogICAgICAgIC4uLnBhcnNlQ29uZmlnLm5vZGUKICAgIH07Cn0KCmZ1bmN0aW9uIGNyZWF0ZVBhcnNlcihjb25maWcpIHsKICAgIGxldCBzb3VyY2UgPSAnJzsKICAgIGxldCBmaWxlbmFtZSA9ICc8dW5rbm93bj4nOwogICAgbGV0IG5lZWRQb3NpdGlvbnMgPSBmYWxzZTsKICAgIGxldCBvblBhcnNlRXJyb3IgPSBOT09QOwogICAgbGV0IG9uUGFyc2VFcnJvclRocm93ID0gZmFsc2U7CgogICAgY29uc3QgbG9jYXRpb25NYXAgPSBuZXcgT2Zmc2V0VG9Mb2NhdGlvbigpOwogICAgY29uc3QgcGFyc2VyID0gT2JqZWN0LmFzc2lnbihuZXcgVG9rZW5TdHJlYW0oKSwgcHJvY2Vzc0NvbmZpZyhjb25maWcgfHwge30pLCB7CiAgICAgICAgcGFyc2VBdHJ1bGVQcmVsdWRlOiB0cnVlLAogICAgICAgIHBhcnNlUnVsZVByZWx1ZGU6IHRydWUsCiAgICAgICAgcGFyc2VWYWx1ZTogdHJ1ZSwKICAgICAgICBwYXJzZUN1c3RvbVByb3BlcnR5OiBmYWxzZSwKCiAgICAgICAgcmVhZFNlcXVlbmNlOiByZWFkU2VxdWVuY2UkMSwKCiAgICAgICAgY29uc3VtZVVudGlsQmFsYW5jZUVuZDogKCkgPT4gMCwKICAgICAgICBjb25zdW1lVW50aWxMZWZ0Q3VybHlCcmFja2V0KGNvZGUpIHsKICAgICAgICAgICAgcmV0dXJuIGNvZGUgPT09IExFRlRDVVJMWUJSQUNLRVQkMSA/IDEgOiAwOwogICAgICAgIH0sCiAgICAgICAgY29uc3VtZVVudGlsTGVmdEN1cmx5QnJhY2tldE9yU2VtaWNvbG9uKGNvZGUpIHsKICAgICAgICAgICAgcmV0dXJuIGNvZGUgPT09IExFRlRDVVJMWUJSQUNLRVQkMSB8fCBjb2RlID09PSBTRU1JQ09MT04gPyAxIDogMDsKICAgICAgICB9LAogICAgICAgIGNvbnN1bWVVbnRpbEV4Y2xhbWF0aW9uTWFya09yU2VtaWNvbG9uKGNvZGUpIHsKICAgICAgICAgICAgcmV0dXJuIGNvZGUgPT09IEVYQ0xBTUFUSU9OTUFSSyQzIHx8IGNvZGUgPT09IFNFTUlDT0xPTiA/IDEgOiAwOwogICAgICAgIH0sCiAgICAgICAgY29uc3VtZVVudGlsU2VtaWNvbG9uSW5jbHVkZWQoY29kZSkgewogICAgICAgICAgICByZXR1cm4gY29kZSA9PT0gU0VNSUNPTE9OID8gMiA6IDA7CiAgICAgICAgfSwKCiAgICAgICAgY3JlYXRlTGlzdCgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBMaXN0KCk7CiAgICAgICAgfSwKICAgICAgICBjcmVhdGVTaW5nbGVOb2RlTGlzdChub2RlKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgTGlzdCgpLmFwcGVuZERhdGEobm9kZSk7CiAgICAgICAgfSwKICAgICAgICBnZXRGaXJzdExpc3ROb2RlKGxpc3QpIHsKICAgICAgICAgICAgcmV0dXJuIGxpc3QgJiYgbGlzdC5maXJzdDsKICAgICAgICB9LAogICAgICAgIGdldExhc3RMaXN0Tm9kZShsaXN0KSB7CiAgICAgICAgICAgIHJldHVybiBsaXN0ICYmIGxpc3QubGFzdDsKICAgICAgICB9LAoKICAgICAgICBwYXJzZVdpdGhGYWxsYmFjayhjb25zdW1lciwgZmFsbGJhY2spIHsKICAgICAgICAgICAgY29uc3Qgc3RhcnRUb2tlbiA9IHRoaXMudG9rZW5JbmRleDsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY29uc3VtZXIuY2FsbCh0aGlzKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgaWYgKG9uUGFyc2VFcnJvclRocm93KSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCBmYWxsYmFja05vZGUgPSBmYWxsYmFjay5jYWxsKHRoaXMsIHN0YXJ0VG9rZW4pOwoKICAgICAgICAgICAgICAgIG9uUGFyc2VFcnJvclRocm93ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIG9uUGFyc2VFcnJvcihlLCBmYWxsYmFja05vZGUpOwogICAgICAgICAgICAgICAgb25QYXJzZUVycm9yVGhyb3cgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsbGJhY2tOb2RlOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgbG9va3VwTm9uV1NUeXBlKG9mZnNldCkgewogICAgICAgICAgICBsZXQgdHlwZTsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIHR5cGUgPSB0aGlzLmxvb2t1cFR5cGUob2Zmc2V0KyspOwogICAgICAgICAgICAgICAgaWYgKHR5cGUgIT09IFdoaXRlU3BhY2UkMSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0eXBlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IHdoaWxlICh0eXBlICE9PSBOVUxMKTsKCiAgICAgICAgICAgIHJldHVybiBOVUxMOwogICAgICAgIH0sCgogICAgICAgIGNoYXJDb2RlQXQob2Zmc2V0KSB7CiAgICAgICAgICAgIHJldHVybiBvZmZzZXQgPj0gMCAmJiBvZmZzZXQgPCBzb3VyY2UubGVuZ3RoID8gc291cmNlLmNoYXJDb2RlQXQob2Zmc2V0KSA6IDA7CiAgICAgICAgfSwKICAgICAgICBzdWJzdHJpbmcob2Zmc2V0U3RhcnQsIG9mZnNldEVuZCkgewogICAgICAgICAgICByZXR1cm4gc291cmNlLnN1YnN0cmluZyhvZmZzZXRTdGFydCwgb2Zmc2V0RW5kKTsKICAgICAgICB9LAogICAgICAgIHN1YnN0clRvQ3Vyc29yKHN0YXJ0KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnNvdXJjZS5zdWJzdHJpbmcoc3RhcnQsIHRoaXMudG9rZW5TdGFydCk7CiAgICAgICAgfSwKCiAgICAgICAgY21wQ2hhcihvZmZzZXQsIGNoYXJDb2RlKSB7CiAgICAgICAgICAgIHJldHVybiBjbXBDaGFyKHNvdXJjZSwgb2Zmc2V0LCBjaGFyQ29kZSk7CiAgICAgICAgfSwKICAgICAgICBjbXBTdHIob2Zmc2V0U3RhcnQsIG9mZnNldEVuZCwgc3RyKSB7CiAgICAgICAgICAgIHJldHVybiBjbXBTdHIoc291cmNlLCBvZmZzZXRTdGFydCwgb2Zmc2V0RW5kLCBzdHIpOwogICAgICAgIH0sCgogICAgICAgIGNvbnN1bWUodG9rZW5UeXBlKSB7CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwoKICAgICAgICAgICAgdGhpcy5lYXQodG9rZW5UeXBlKTsKCiAgICAgICAgICAgIHJldHVybiB0aGlzLnN1YnN0clRvQ3Vyc29yKHN0YXJ0KTsKICAgICAgICB9LAogICAgICAgIGNvbnN1bWVGdW5jdGlvbk5hbWUoKSB7CiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBzb3VyY2Uuc3Vic3RyaW5nKHRoaXMudG9rZW5TdGFydCwgdGhpcy50b2tlbkVuZCAtIDEpOwoKICAgICAgICAgICAgdGhpcy5lYXQoRnVuY3Rpb24kMik7CgogICAgICAgICAgICByZXR1cm4gbmFtZTsKICAgICAgICB9LAogICAgICAgIGNvbnN1bWVOdW1iZXIodHlwZSkgewogICAgICAgICAgICBjb25zdCBudW1iZXIgPSBzb3VyY2Uuc3Vic3RyaW5nKHRoaXMudG9rZW5TdGFydCwgY29uc3VtZU51bWJlciQxKHNvdXJjZSwgdGhpcy50b2tlblN0YXJ0KSk7CgogICAgICAgICAgICB0aGlzLmVhdCh0eXBlKTsKCiAgICAgICAgICAgIHJldHVybiBudW1iZXI7CiAgICAgICAgfSwKCiAgICAgICAgZWF0KHRva2VuVHlwZSkgewogICAgICAgICAgICBpZiAodGhpcy50b2tlblR5cGUgIT09IHRva2VuVHlwZSkgewogICAgICAgICAgICAgICAgY29uc3QgdG9rZW5OYW1lID0gdG9rZW5OYW1lc1t0b2tlblR5cGVdLnNsaWNlKDAsIC02KS5yZXBsYWNlKC8tL2csICcgJykucmVwbGFjZSgvXi4vLCBtID0+IG0udG9VcHBlckNhc2UoKSk7CiAgICAgICAgICAgICAgICBsZXQgbWVzc2FnZSA9IGAkey9bW1xdKCl7fV0vLnRlc3QodG9rZW5OYW1lKSA/IGAiJHt0b2tlbk5hbWV9ImAgOiB0b2tlbk5hbWV9IGlzIGV4cGVjdGVkYDsKICAgICAgICAgICAgICAgIGxldCBvZmZzZXQgPSB0aGlzLnRva2VuU3RhcnQ7CgogICAgICAgICAgICAgICAgLy8gdHdlYWsgbWVzc2FnZSBhbmQgb2Zmc2V0CiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRva2VuVHlwZSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgSWRlbnQ6CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdoZW4gaWRlbnRpZmllciBpcyBleHBlY3RlZCBidXQgdGhlcmUgaXMgYSBmdW5jdGlvbiBvciB1cmwKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudG9rZW5UeXBlID09PSBGdW5jdGlvbiQyIHx8IHRoaXMudG9rZW5UeXBlID09PSBVcmwkMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gdGhpcy50b2tlbkVuZCAtIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gJ0lkZW50aWZpZXIgaXMgZXhwZWN0ZWQgYnV0IGZ1bmN0aW9uIGZvdW5kJzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSAnSWRlbnRpZmllciBpcyBleHBlY3RlZCc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgIGNhc2UgSGFzaCQxOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0RlbGltKE5VTUJFUlNJR04kNCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0Kys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gJ05hbWUgaXMgZXhwZWN0ZWQnOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICBjYXNlIFBlcmNlbnRhZ2UkMToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudG9rZW5UeXBlID09PSBOdW1iZXIkMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gdGhpcy50b2tlbkVuZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSAnUGVyY2VudCBzaWduIGlzIGV4cGVjdGVkJzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLmVycm9yKG1lc3NhZ2UsIG9mZnNldCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgIH0sCiAgICAgICAgZWF0SWRlbnQobmFtZSkgewogICAgICAgICAgICBpZiAodGhpcy50b2tlblR5cGUgIT09IElkZW50IHx8IHRoaXMubG9va3VwVmFsdWUoMCwgbmFtZSkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICB0aGlzLmVycm9yKGBJZGVudGlmaWVyICIke25hbWV9IiBpcyBleHBlY3RlZGApOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLm5leHQoKTsKICAgICAgICB9LAogICAgICAgIGVhdERlbGltKGNvZGUpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLmlzRGVsaW0oY29kZSkpIHsKICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IoYERlbGltICIke1N0cmluZy5mcm9tQ2hhckNvZGUoY29kZSl9IiBpcyBleHBlY3RlZGApOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLm5leHQoKTsKICAgICAgICB9LAoKICAgICAgICBnZXRMb2NhdGlvbihzdGFydCwgZW5kKSB7CiAgICAgICAgICAgIGlmIChuZWVkUG9zaXRpb25zKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbG9jYXRpb25NYXAuZ2V0TG9jYXRpb25SYW5nZSgKICAgICAgICAgICAgICAgICAgICBzdGFydCwKICAgICAgICAgICAgICAgICAgICBlbmQsCiAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWUKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0sCiAgICAgICAgZ2V0TG9jYXRpb25Gcm9tTGlzdChsaXN0KSB7CiAgICAgICAgICAgIGlmIChuZWVkUG9zaXRpb25zKSB7CiAgICAgICAgICAgICAgICBjb25zdCBoZWFkID0gdGhpcy5nZXRGaXJzdExpc3ROb2RlKGxpc3QpOwogICAgICAgICAgICAgICAgY29uc3QgdGFpbCA9IHRoaXMuZ2V0TGFzdExpc3ROb2RlKGxpc3QpOwogICAgICAgICAgICAgICAgcmV0dXJuIGxvY2F0aW9uTWFwLmdldExvY2F0aW9uUmFuZ2UoCiAgICAgICAgICAgICAgICAgICAgaGVhZCAhPT0gbnVsbCA/IGhlYWQubG9jLnN0YXJ0Lm9mZnNldCAtIGxvY2F0aW9uTWFwLnN0YXJ0T2Zmc2V0IDogdGhpcy50b2tlblN0YXJ0LAogICAgICAgICAgICAgICAgICAgIHRhaWwgIT09IG51bGwgPyB0YWlsLmxvYy5lbmQub2Zmc2V0IC0gbG9jYXRpb25NYXAuc3RhcnRPZmZzZXQgOiB0aGlzLnRva2VuU3RhcnQsCiAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWUKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0sCgogICAgICAgIGVycm9yKG1lc3NhZ2UsIG9mZnNldCkgewogICAgICAgICAgICBjb25zdCBsb2NhdGlvbiA9IHR5cGVvZiBvZmZzZXQgIT09ICd1bmRlZmluZWQnICYmIG9mZnNldCA8IHNvdXJjZS5sZW5ndGgKICAgICAgICAgICAgICAgID8gbG9jYXRpb25NYXAuZ2V0TG9jYXRpb24ob2Zmc2V0KQogICAgICAgICAgICAgICAgOiB0aGlzLmVvZgogICAgICAgICAgICAgICAgICAgID8gbG9jYXRpb25NYXAuZ2V0TG9jYXRpb24oZmluZFdoaXRlU3BhY2VTdGFydChzb3VyY2UsIHNvdXJjZS5sZW5ndGggLSAxKSkKICAgICAgICAgICAgICAgICAgICA6IGxvY2F0aW9uTWFwLmdldExvY2F0aW9uKHRoaXMudG9rZW5TdGFydCk7CgogICAgICAgICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IkMigKICAgICAgICAgICAgICAgIG1lc3NhZ2UgfHwgJ1VuZXhwZWN0ZWQgaW5wdXQnLAogICAgICAgICAgICAgICAgc291cmNlLAogICAgICAgICAgICAgICAgbG9jYXRpb24ub2Zmc2V0LAogICAgICAgICAgICAgICAgbG9jYXRpb24ubGluZSwKICAgICAgICAgICAgICAgIGxvY2F0aW9uLmNvbHVtbgogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0pOwoKICAgIGNvbnN0IHBhcnNlID0gZnVuY3Rpb24oc291cmNlXywgb3B0aW9ucykgewogICAgICAgIHNvdXJjZSA9IHNvdXJjZV87CiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgogICAgICAgIHBhcnNlci5zZXRTb3VyY2Uoc291cmNlLCB0b2tlbml6ZSQxKTsKICAgICAgICBsb2NhdGlvbk1hcC5zZXRTb3VyY2UoCiAgICAgICAgICAgIHNvdXJjZSwKICAgICAgICAgICAgb3B0aW9ucy5vZmZzZXQsCiAgICAgICAgICAgIG9wdGlvbnMubGluZSwKICAgICAgICAgICAgb3B0aW9ucy5jb2x1bW4KICAgICAgICApOwoKICAgICAgICBmaWxlbmFtZSA9IG9wdGlvbnMuZmlsZW5hbWUgfHwgJzx1bmtub3duPic7CiAgICAgICAgbmVlZFBvc2l0aW9ucyA9IEJvb2xlYW4ob3B0aW9ucy5wb3NpdGlvbnMpOwogICAgICAgIG9uUGFyc2VFcnJvciA9IHR5cGVvZiBvcHRpb25zLm9uUGFyc2VFcnJvciA9PT0gJ2Z1bmN0aW9uJyA/IG9wdGlvbnMub25QYXJzZUVycm9yIDogTk9PUDsKICAgICAgICBvblBhcnNlRXJyb3JUaHJvdyA9IGZhbHNlOwoKICAgICAgICBwYXJzZXIucGFyc2VBdHJ1bGVQcmVsdWRlID0gJ3BhcnNlQXRydWxlUHJlbHVkZScgaW4gb3B0aW9ucyA/IEJvb2xlYW4ob3B0aW9ucy5wYXJzZUF0cnVsZVByZWx1ZGUpIDogdHJ1ZTsKICAgICAgICBwYXJzZXIucGFyc2VSdWxlUHJlbHVkZSA9ICdwYXJzZVJ1bGVQcmVsdWRlJyBpbiBvcHRpb25zID8gQm9vbGVhbihvcHRpb25zLnBhcnNlUnVsZVByZWx1ZGUpIDogdHJ1ZTsKICAgICAgICBwYXJzZXIucGFyc2VWYWx1ZSA9ICdwYXJzZVZhbHVlJyBpbiBvcHRpb25zID8gQm9vbGVhbihvcHRpb25zLnBhcnNlVmFsdWUpIDogdHJ1ZTsKICAgICAgICBwYXJzZXIucGFyc2VDdXN0b21Qcm9wZXJ0eSA9ICdwYXJzZUN1c3RvbVByb3BlcnR5JyBpbiBvcHRpb25zID8gQm9vbGVhbihvcHRpb25zLnBhcnNlQ3VzdG9tUHJvcGVydHkpIDogZmFsc2U7CgogICAgICAgIGNvbnN0IHsgY29udGV4dCA9ICdkZWZhdWx0Jywgb25Db21tZW50IH0gPSBvcHRpb25zOwoKICAgICAgICBpZiAoY29udGV4dCBpbiBwYXJzZXIuY29udGV4dCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIGNvbnRleHQgYCcgKyBjb250ZXh0ICsgJ2AnKTsKICAgICAgICB9CgogICAgICAgIGlmICh0eXBlb2Ygb25Db21tZW50ID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIHBhcnNlci5mb3JFYWNoVG9rZW4oKHR5cGUsIHN0YXJ0LCBlbmQpID0+IHsKICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSBDb21tZW50JDEpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsb2MgPSBwYXJzZXIuZ2V0TG9jYXRpb24oc3RhcnQsIGVuZCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBjbXBTdHIoc291cmNlLCBlbmQgLSAyLCBlbmQsICcqLycpCiAgICAgICAgICAgICAgICAgICAgICAgID8gc291cmNlLnNsaWNlKHN0YXJ0ICsgMiwgZW5kIC0gMikKICAgICAgICAgICAgICAgICAgICAgICAgOiBzb3VyY2Uuc2xpY2Uoc3RhcnQgKyAyLCBlbmQpOwoKICAgICAgICAgICAgICAgICAgICBvbkNvbW1lbnQodmFsdWUsIGxvYyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgYXN0ID0gcGFyc2VyLmNvbnRleHRbY29udGV4dF0uY2FsbChwYXJzZXIsIG9wdGlvbnMpOwoKICAgICAgICBpZiAoIXBhcnNlci5lb2YpIHsKICAgICAgICAgICAgcGFyc2VyLmVycm9yKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYXN0OwogICAgfTsKCiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihwYXJzZSwgewogICAgICAgIFN5bnRheEVycm9yOiBTeW50YXhFcnJvciQyLAogICAgICAgIGNvbmZpZzogcGFyc2VyLmNvbmZpZwogICAgfSk7Cn0KCnZhciBiYXNlNjRWbHEgPSB7fTsKCnZhciBiYXNlNjQkMSA9IHt9OwoKLyogLSotIE1vZGU6IGpzOyBqcy1pbmRlbnQtbGV2ZWw6IDI7IC0qLSAqLwoKLyoKICogQ29weXJpZ2h0IDIwMTEgTW96aWxsYSBGb3VuZGF0aW9uIGFuZCBjb250cmlidXRvcnMKICogTGljZW5zZWQgdW5kZXIgdGhlIE5ldyBCU0QgbGljZW5zZS4gU2VlIExJQ0VOU0Ugb3I6CiAqIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9CU0QtMy1DbGF1c2UKICovCgp2YXIgaW50VG9DaGFyTWFwID0gJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky8nLnNwbGl0KCcnKTsKCi8qKgogKiBFbmNvZGUgYW4gaW50ZWdlciBpbiB0aGUgcmFuZ2Ugb2YgMCB0byA2MyB0byBhIHNpbmdsZSBiYXNlIDY0IGRpZ2l0LgogKi8KYmFzZTY0JDEuZW5jb2RlID0gZnVuY3Rpb24gKG51bWJlcikgewogIGlmICgwIDw9IG51bWJlciAmJiBudW1iZXIgPCBpbnRUb0NoYXJNYXAubGVuZ3RoKSB7CiAgICByZXR1cm4gaW50VG9DaGFyTWFwW251bWJlcl07CiAgfQogIHRocm93IG5ldyBUeXBlRXJyb3IoIk11c3QgYmUgYmV0d2VlbiAwIGFuZCA2MzogIiArIG51bWJlcik7Cn07CgovKioKICogRGVjb2RlIGEgc2luZ2xlIGJhc2UgNjQgY2hhcmFjdGVyIGNvZGUgZGlnaXQgdG8gYW4gaW50ZWdlci4gUmV0dXJucyAtMSBvbgogKiBmYWlsdXJlLgogKi8KYmFzZTY0JDEuZGVjb2RlID0gZnVuY3Rpb24gKGNoYXJDb2RlKSB7CiAgdmFyIGJpZ0EgPSA2NTsgICAgIC8vICdBJwogIHZhciBiaWdaID0gOTA7ICAgICAvLyAnWicKCiAgdmFyIGxpdHRsZUEgPSA5NzsgIC8vICdhJwogIHZhciBsaXR0bGVaID0gMTIyOyAvLyAneicKCiAgdmFyIHplcm8gPSA0ODsgICAgIC8vICcwJwogIHZhciBuaW5lID0gNTc7ICAgICAvLyAnOScKCiAgdmFyIHBsdXMgPSA0MzsgICAgIC8vICcrJwogIHZhciBzbGFzaCA9IDQ3OyAgICAvLyAnLycKCiAgdmFyIGxpdHRsZU9mZnNldCA9IDI2OwogIHZhciBudW1iZXJPZmZzZXQgPSA1MjsKCiAgLy8gMCAtIDI1OiBBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWgogIGlmIChiaWdBIDw9IGNoYXJDb2RlICYmIGNoYXJDb2RlIDw9IGJpZ1opIHsKICAgIHJldHVybiAoY2hhckNvZGUgLSBiaWdBKTsKICB9CgogIC8vIDI2IC0gNTE6IGFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6CiAgaWYgKGxpdHRsZUEgPD0gY2hhckNvZGUgJiYgY2hhckNvZGUgPD0gbGl0dGxlWikgewogICAgcmV0dXJuIChjaGFyQ29kZSAtIGxpdHRsZUEgKyBsaXR0bGVPZmZzZXQpOwogIH0KCiAgLy8gNTIgLSA2MTogMDEyMzQ1Njc4OQogIGlmICh6ZXJvIDw9IGNoYXJDb2RlICYmIGNoYXJDb2RlIDw9IG5pbmUpIHsKICAgIHJldHVybiAoY2hhckNvZGUgLSB6ZXJvICsgbnVtYmVyT2Zmc2V0KTsKICB9CgogIC8vIDYyOiArCiAgaWYgKGNoYXJDb2RlID09IHBsdXMpIHsKICAgIHJldHVybiA2MjsKICB9CgogIC8vIDYzOiAvCiAgaWYgKGNoYXJDb2RlID09IHNsYXNoKSB7CiAgICByZXR1cm4gNjM7CiAgfQoKICAvLyBJbnZhbGlkIGJhc2U2NCBkaWdpdC4KICByZXR1cm4gLTE7Cn07CgovKiAtKi0gTW9kZToganM7IGpzLWluZGVudC1sZXZlbDogMjsgLSotICovCgovKgogKiBDb3B5cmlnaHQgMjAxMSBNb3ppbGxhIEZvdW5kYXRpb24gYW5kIGNvbnRyaWJ1dG9ycwogKiBMaWNlbnNlZCB1bmRlciB0aGUgTmV3IEJTRCBsaWNlbnNlLiBTZWUgTElDRU5TRSBvcjoKICogaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL0JTRC0zLUNsYXVzZQogKgogKiBCYXNlZCBvbiB0aGUgQmFzZSA2NCBWTFEgaW1wbGVtZW50YXRpb24gaW4gQ2xvc3VyZSBDb21waWxlcjoKICogaHR0cHM6Ly9jb2RlLmdvb2dsZS5jb20vcC9jbG9zdXJlLWNvbXBpbGVyL3NvdXJjZS9icm93c2UvdHJ1bmsvc3JjL2NvbS9nb29nbGUvZGVidWdnaW5nL3NvdXJjZW1hcC9CYXNlNjRWTFEuamF2YQogKgogKiBDb3B5cmlnaHQgMjAxMSBUaGUgQ2xvc3VyZSBDb21waWxlciBBdXRob3JzLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQKICogbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZQogKiBtZXQ6CiAqCiAqICAqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0CiAqICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KICogICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZQogKiAgICBjb3B5cmlnaHQgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZwogKiAgICBkaXNjbGFpbWVyIGluIHRoZSBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQKICogICAgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLgogKiAgKiBOZWl0aGVyIHRoZSBuYW1lIG9mIEdvb2dsZSBJbmMuIG5vciB0aGUgbmFtZXMgb2YgaXRzCiAqICAgIGNvbnRyaWJ1dG9ycyBtYXkgYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHMgZGVyaXZlZAogKiAgICBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uCiAqCiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMKICogIkFTIElTIiBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QKICogTElNSVRFRCBUTywgVEhFIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SCiAqIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUCiAqIE9XTkVSIE9SIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLAogKiBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyAoSU5DTFVESU5HLCBCVVQgTk9UCiAqIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7IExPU1MgT0YgVVNFLAogKiBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkKICogVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVAogKiAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UKICogT0YgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4KICovCgp2YXIgYmFzZTY0ID0gYmFzZTY0JDE7CgovLyBBIHNpbmdsZSBiYXNlIDY0IGRpZ2l0IGNhbiBjb250YWluIDYgYml0cyBvZiBkYXRhLiBGb3IgdGhlIGJhc2UgNjQgdmFyaWFibGUKLy8gbGVuZ3RoIHF1YW50aXRpZXMgd2UgdXNlIGluIHRoZSBzb3VyY2UgbWFwIHNwZWMsIHRoZSBmaXJzdCBiaXQgaXMgdGhlIHNpZ24sCi8vIHRoZSBuZXh0IGZvdXIgYml0cyBhcmUgdGhlIGFjdHVhbCB2YWx1ZSwgYW5kIHRoZSA2dGggYml0IGlzIHRoZQovLyBjb250aW51YXRpb24gYml0LiBUaGUgY29udGludWF0aW9uIGJpdCB0ZWxscyB1cyB3aGV0aGVyIHRoZXJlIGFyZSBtb3JlCi8vIGRpZ2l0cyBpbiB0aGlzIHZhbHVlIGZvbGxvd2luZyB0aGlzIGRpZ2l0LgovLwovLyAgIENvbnRpbnVhdGlvbgovLyAgIHwgICAgU2lnbgovLyAgIHwgICAgfAovLyAgIFYgICAgVgovLyAgIDEwMTAxMQoKdmFyIFZMUV9CQVNFX1NISUZUID0gNTsKCi8vIGJpbmFyeTogMTAwMDAwCnZhciBWTFFfQkFTRSA9IDEgPDwgVkxRX0JBU0VfU0hJRlQ7CgovLyBiaW5hcnk6IDAxMTExMQp2YXIgVkxRX0JBU0VfTUFTSyA9IFZMUV9CQVNFIC0gMTsKCi8vIGJpbmFyeTogMTAwMDAwCnZhciBWTFFfQ09OVElOVUFUSU9OX0JJVCA9IFZMUV9CQVNFOwoKLyoqCiAqIENvbnZlcnRzIGZyb20gYSB0d28tY29tcGxlbWVudCB2YWx1ZSB0byBhIHZhbHVlIHdoZXJlIHRoZSBzaWduIGJpdCBpcwogKiBwbGFjZWQgaW4gdGhlIGxlYXN0IHNpZ25pZmljYW50IGJpdC4gIEZvciBleGFtcGxlLCBhcyBkZWNpbWFsczoKICogICAxIGJlY29tZXMgMiAoMTAgYmluYXJ5KSwgLTEgYmVjb21lcyAzICgxMSBiaW5hcnkpCiAqICAgMiBiZWNvbWVzIDQgKDEwMCBiaW5hcnkpLCAtMiBiZWNvbWVzIDUgKDEwMSBiaW5hcnkpCiAqLwpmdW5jdGlvbiB0b1ZMUVNpZ25lZChhVmFsdWUpIHsKICByZXR1cm4gYVZhbHVlIDwgMAogICAgPyAoKC1hVmFsdWUpIDw8IDEpICsgMQogICAgOiAoYVZhbHVlIDw8IDEpICsgMDsKfQoKLyoqCiAqIENvbnZlcnRzIHRvIGEgdHdvLWNvbXBsZW1lbnQgdmFsdWUgZnJvbSBhIHZhbHVlIHdoZXJlIHRoZSBzaWduIGJpdCBpcwogKiBwbGFjZWQgaW4gdGhlIGxlYXN0IHNpZ25pZmljYW50IGJpdC4gIEZvciBleGFtcGxlLCBhcyBkZWNpbWFsczoKICogICAyICgxMCBiaW5hcnkpIGJlY29tZXMgMSwgMyAoMTEgYmluYXJ5KSBiZWNvbWVzIC0xCiAqICAgNCAoMTAwIGJpbmFyeSkgYmVjb21lcyAyLCA1ICgxMDEgYmluYXJ5KSBiZWNvbWVzIC0yCiAqLwpmdW5jdGlvbiBmcm9tVkxRU2lnbmVkKGFWYWx1ZSkgewogIHZhciBpc05lZ2F0aXZlID0gKGFWYWx1ZSAmIDEpID09PSAxOwogIHZhciBzaGlmdGVkID0gYVZhbHVlID4+IDE7CiAgcmV0dXJuIGlzTmVnYXRpdmUKICAgID8gLXNoaWZ0ZWQKICAgIDogc2hpZnRlZDsKfQoKLyoqCiAqIFJldHVybnMgdGhlIGJhc2UgNjQgVkxRIGVuY29kZWQgdmFsdWUuCiAqLwpiYXNlNjRWbHEuZW5jb2RlID0gZnVuY3Rpb24gYmFzZTY0VkxRX2VuY29kZShhVmFsdWUpIHsKICB2YXIgZW5jb2RlZCA9ICIiOwogIHZhciBkaWdpdDsKCiAgdmFyIHZscSA9IHRvVkxRU2lnbmVkKGFWYWx1ZSk7CgogIGRvIHsKICAgIGRpZ2l0ID0gdmxxICYgVkxRX0JBU0VfTUFTSzsKICAgIHZscSA+Pj49IFZMUV9CQVNFX1NISUZUOwogICAgaWYgKHZscSA+IDApIHsKICAgICAgLy8gVGhlcmUgYXJlIHN0aWxsIG1vcmUgZGlnaXRzIGluIHRoaXMgdmFsdWUsIHNvIHdlIG11c3QgbWFrZSBzdXJlIHRoZQogICAgICAvLyBjb250aW51YXRpb24gYml0IGlzIG1hcmtlZC4KICAgICAgZGlnaXQgfD0gVkxRX0NPTlRJTlVBVElPTl9CSVQ7CiAgICB9CiAgICBlbmNvZGVkICs9IGJhc2U2NC5lbmNvZGUoZGlnaXQpOwogIH0gd2hpbGUgKHZscSA+IDApOwoKICByZXR1cm4gZW5jb2RlZDsKfTsKCi8qKgogKiBEZWNvZGVzIHRoZSBuZXh0IGJhc2UgNjQgVkxRIHZhbHVlIGZyb20gdGhlIGdpdmVuIHN0cmluZyBhbmQgcmV0dXJucyB0aGUKICogdmFsdWUgYW5kIHRoZSByZXN0IG9mIHRoZSBzdHJpbmcgdmlhIHRoZSBvdXQgcGFyYW1ldGVyLgogKi8KYmFzZTY0VmxxLmRlY29kZSA9IGZ1bmN0aW9uIGJhc2U2NFZMUV9kZWNvZGUoYVN0ciwgYUluZGV4LCBhT3V0UGFyYW0pIHsKICB2YXIgc3RyTGVuID0gYVN0ci5sZW5ndGg7CiAgdmFyIHJlc3VsdCA9IDA7CiAgdmFyIHNoaWZ0ID0gMDsKICB2YXIgY29udGludWF0aW9uLCBkaWdpdDsKCiAgZG8gewogICAgaWYgKGFJbmRleCA+PSBzdHJMZW4pIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJFeHBlY3RlZCBtb3JlIGRpZ2l0cyBpbiBiYXNlIDY0IFZMUSB2YWx1ZS4iKTsKICAgIH0KCiAgICBkaWdpdCA9IGJhc2U2NC5kZWNvZGUoYVN0ci5jaGFyQ29kZUF0KGFJbmRleCsrKSk7CiAgICBpZiAoZGlnaXQgPT09IC0xKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBiYXNlNjQgZGlnaXQ6ICIgKyBhU3RyLmNoYXJBdChhSW5kZXggLSAxKSk7CiAgICB9CgogICAgY29udGludWF0aW9uID0gISEoZGlnaXQgJiBWTFFfQ09OVElOVUFUSU9OX0JJVCk7CiAgICBkaWdpdCAmPSBWTFFfQkFTRV9NQVNLOwogICAgcmVzdWx0ID0gcmVzdWx0ICsgKGRpZ2l0IDw8IHNoaWZ0KTsKICAgIHNoaWZ0ICs9IFZMUV9CQVNFX1NISUZUOwogIH0gd2hpbGUgKGNvbnRpbnVhdGlvbik7CgogIGFPdXRQYXJhbS52YWx1ZSA9IGZyb21WTFFTaWduZWQocmVzdWx0KTsKICBhT3V0UGFyYW0ucmVzdCA9IGFJbmRleDsKfTsKCnZhciB1dGlsJDMgPSB7fTsKCi8qIC0qLSBNb2RlOiBqczsganMtaW5kZW50LWxldmVsOiAyOyAtKi0gKi8KCihmdW5jdGlvbiAoZXhwb3J0cykgewoJLyoKCSAqIENvcHlyaWdodCAyMDExIE1vemlsbGEgRm91bmRhdGlvbiBhbmQgY29udHJpYnV0b3JzCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgTmV3IEJTRCBsaWNlbnNlLiBTZWUgTElDRU5TRSBvcjoKCSAqIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9CU0QtMy1DbGF1c2UKCSAqLwoKCS8qKgoJICogVGhpcyBpcyBhIGhlbHBlciBmdW5jdGlvbiBmb3IgZ2V0dGluZyB2YWx1ZXMgZnJvbSBwYXJhbWV0ZXIvb3B0aW9ucwoJICogb2JqZWN0cy4KCSAqCgkgKiBAcGFyYW0gYXJncyBUaGUgb2JqZWN0IHdlIGFyZSBleHRyYWN0aW5nIHZhbHVlcyBmcm9tCgkgKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSBvZiB0aGUgcHJvcGVydHkgd2UgYXJlIGdldHRpbmcuCgkgKiBAcGFyYW0gZGVmYXVsdFZhbHVlIEFuIG9wdGlvbmFsIHZhbHVlIHRvIHJldHVybiBpZiB0aGUgcHJvcGVydHkgaXMgbWlzc2luZwoJICogZnJvbSB0aGUgb2JqZWN0LiBJZiB0aGlzIGlzIG5vdCBzcGVjaWZpZWQgYW5kIHRoZSBwcm9wZXJ0eSBpcyBtaXNzaW5nLCBhbgoJICogZXJyb3Igd2lsbCBiZSB0aHJvd24uCgkgKi8KCWZ1bmN0aW9uIGdldEFyZyhhQXJncywgYU5hbWUsIGFEZWZhdWx0VmFsdWUpIHsKCSAgaWYgKGFOYW1lIGluIGFBcmdzKSB7CgkgICAgcmV0dXJuIGFBcmdzW2FOYW1lXTsKCSAgfSBlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAzKSB7CgkgICAgcmV0dXJuIGFEZWZhdWx0VmFsdWU7CgkgIH0gZWxzZSB7CgkgICAgdGhyb3cgbmV3IEVycm9yKCciJyArIGFOYW1lICsgJyIgaXMgYSByZXF1aXJlZCBhcmd1bWVudC4nKTsKCSAgfQoJfQoJZXhwb3J0cy5nZXRBcmcgPSBnZXRBcmc7CgoJdmFyIHVybFJlZ2V4cCA9IC9eKD86KFtcdytcLS5dKyk6KT9cL1wvKD86KFx3KzpcdyspQCk/KFtcdy4tXSopKD86OihcZCspKT8oLiopJC87Cgl2YXIgZGF0YVVybFJlZ2V4cCA9IC9eZGF0YTouK1wsLiskLzsKCglmdW5jdGlvbiB1cmxQYXJzZShhVXJsKSB7CgkgIHZhciBtYXRjaCA9IGFVcmwubWF0Y2godXJsUmVnZXhwKTsKCSAgaWYgKCFtYXRjaCkgewoJICAgIHJldHVybiBudWxsOwoJICB9CgkgIHJldHVybiB7CgkgICAgc2NoZW1lOiBtYXRjaFsxXSwKCSAgICBhdXRoOiBtYXRjaFsyXSwKCSAgICBob3N0OiBtYXRjaFszXSwKCSAgICBwb3J0OiBtYXRjaFs0XSwKCSAgICBwYXRoOiBtYXRjaFs1XQoJICB9OwoJfQoJZXhwb3J0cy51cmxQYXJzZSA9IHVybFBhcnNlOwoKCWZ1bmN0aW9uIHVybEdlbmVyYXRlKGFQYXJzZWRVcmwpIHsKCSAgdmFyIHVybCA9ICcnOwoJICBpZiAoYVBhcnNlZFVybC5zY2hlbWUpIHsKCSAgICB1cmwgKz0gYVBhcnNlZFVybC5zY2hlbWUgKyAnOic7CgkgIH0KCSAgdXJsICs9ICcvLyc7CgkgIGlmIChhUGFyc2VkVXJsLmF1dGgpIHsKCSAgICB1cmwgKz0gYVBhcnNlZFVybC5hdXRoICsgJ0AnOwoJICB9CgkgIGlmIChhUGFyc2VkVXJsLmhvc3QpIHsKCSAgICB1cmwgKz0gYVBhcnNlZFVybC5ob3N0OwoJICB9CgkgIGlmIChhUGFyc2VkVXJsLnBvcnQpIHsKCSAgICB1cmwgKz0gIjoiICsgYVBhcnNlZFVybC5wb3J0OwoJICB9CgkgIGlmIChhUGFyc2VkVXJsLnBhdGgpIHsKCSAgICB1cmwgKz0gYVBhcnNlZFVybC5wYXRoOwoJICB9CgkgIHJldHVybiB1cmw7Cgl9CglleHBvcnRzLnVybEdlbmVyYXRlID0gdXJsR2VuZXJhdGU7CgoJdmFyIE1BWF9DQUNIRURfSU5QVVRTID0gMzI7CgoJLyoqCgkgKiBUYWtlcyBzb21lIGZ1bmN0aW9uIGBmKGlucHV0KSAtPiByZXN1bHRgIGFuZCByZXR1cm5zIGEgbWVtb2l6ZWQgdmVyc2lvbiBvZgoJICogYGZgLgoJICoKCSAqIFdlIGtlZXAgYXQgbW9zdCBgTUFYX0NBQ0hFRF9JTlBVVFNgIG1lbW9pemVkIHJlc3VsdHMgb2YgYGZgIGFsaXZlLiBUaGUKCSAqIG1lbW9pemF0aW9uIGlzIGEgZHVtYi1zaW1wbGUsIGxpbmVhciBsZWFzdC1yZWNlbnRseS11c2VkIGNhY2hlLgoJICovCglmdW5jdGlvbiBscnVNZW1vaXplKGYpIHsKCSAgdmFyIGNhY2hlID0gW107CgoJICByZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHsKCSAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNhY2hlLmxlbmd0aDsgaSsrKSB7CgkgICAgICBpZiAoY2FjaGVbaV0uaW5wdXQgPT09IGlucHV0KSB7CgkgICAgICAgIHZhciB0ZW1wID0gY2FjaGVbMF07CgkgICAgICAgIGNhY2hlWzBdID0gY2FjaGVbaV07CgkgICAgICAgIGNhY2hlW2ldID0gdGVtcDsKCSAgICAgICAgcmV0dXJuIGNhY2hlWzBdLnJlc3VsdDsKCSAgICAgIH0KCSAgICB9CgoJICAgIHZhciByZXN1bHQgPSBmKGlucHV0KTsKCgkgICAgY2FjaGUudW5zaGlmdCh7CgkgICAgICBpbnB1dCwKCSAgICAgIHJlc3VsdCwKCSAgICB9KTsKCgkgICAgaWYgKGNhY2hlLmxlbmd0aCA+IE1BWF9DQUNIRURfSU5QVVRTKSB7CgkgICAgICBjYWNoZS5wb3AoKTsKCSAgICB9CgoJICAgIHJldHVybiByZXN1bHQ7CgkgIH07Cgl9CgoJLyoqCgkgKiBOb3JtYWxpemVzIGEgcGF0aCwgb3IgdGhlIHBhdGggcG9ydGlvbiBvZiBhIFVSTDoKCSAqCgkgKiAtIFJlcGxhY2VzIGNvbnNlY3V0aXZlIHNsYXNoZXMgd2l0aCBvbmUgc2xhc2guCgkgKiAtIFJlbW92ZXMgdW5uZWNlc3NhcnkgJy4nIHBhcnRzLgoJICogLSBSZW1vdmVzIHVubmVjZXNzYXJ5ICc8ZGlyPi8uLicgcGFydHMuCgkgKgoJICogQmFzZWQgb24gY29kZSBpbiB0aGUgTm9kZS5qcyAncGF0aCcgY29yZSBtb2R1bGUuCgkgKgoJICogQHBhcmFtIGFQYXRoIFRoZSBwYXRoIG9yIHVybCB0byBub3JtYWxpemUuCgkgKi8KCXZhciBub3JtYWxpemUgPSBscnVNZW1vaXplKGZ1bmN0aW9uIG5vcm1hbGl6ZShhUGF0aCkgewoJICB2YXIgcGF0aCA9IGFQYXRoOwoJICB2YXIgdXJsID0gdXJsUGFyc2UoYVBhdGgpOwoJICBpZiAodXJsKSB7CgkgICAgaWYgKCF1cmwucGF0aCkgewoJICAgICAgcmV0dXJuIGFQYXRoOwoJICAgIH0KCSAgICBwYXRoID0gdXJsLnBhdGg7CgkgIH0KCSAgdmFyIGlzQWJzb2x1dGUgPSBleHBvcnRzLmlzQWJzb2x1dGUocGF0aCk7CgkgIC8vIFNwbGl0IHRoZSBwYXRoIGludG8gcGFydHMgYmV0d2VlbiBgL2AgY2hhcmFjdGVycy4gVGhpcyBpcyBtdWNoIGZhc3RlciB0aGFuCgkgIC8vIHVzaW5nIGAuc3BsaXQoL1wvKy9nKWAuCgkgIHZhciBwYXJ0cyA9IFtdOwoJICB2YXIgc3RhcnQgPSAwOwoJICB2YXIgaSA9IDA7CgkgIHdoaWxlICh0cnVlKSB7CgkgICAgc3RhcnQgPSBpOwoJICAgIGkgPSBwYXRoLmluZGV4T2YoIi8iLCBzdGFydCk7CgkgICAgaWYgKGkgPT09IC0xKSB7CgkgICAgICBwYXJ0cy5wdXNoKHBhdGguc2xpY2Uoc3RhcnQpKTsKCSAgICAgIGJyZWFrOwoJICAgIH0gZWxzZSB7CgkgICAgICBwYXJ0cy5wdXNoKHBhdGguc2xpY2Uoc3RhcnQsIGkpKTsKCSAgICAgIHdoaWxlIChpIDwgcGF0aC5sZW5ndGggJiYgcGF0aFtpXSA9PT0gIi8iKSB7CgkgICAgICAgIGkrKzsKCSAgICAgIH0KCSAgICB9CgkgIH0KCgkgIGZvciAodmFyIHBhcnQsIHVwID0gMCwgaSA9IHBhcnRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CgkgICAgcGFydCA9IHBhcnRzW2ldOwoJICAgIGlmIChwYXJ0ID09PSAnLicpIHsKCSAgICAgIHBhcnRzLnNwbGljZShpLCAxKTsKCSAgICB9IGVsc2UgaWYgKHBhcnQgPT09ICcuLicpIHsKCSAgICAgIHVwKys7CgkgICAgfSBlbHNlIGlmICh1cCA+IDApIHsKCSAgICAgIGlmIChwYXJ0ID09PSAnJykgewoJICAgICAgICAvLyBUaGUgZmlyc3QgcGFydCBpcyBibGFuayBpZiB0aGUgcGF0aCBpcyBhYnNvbHV0ZS4gVHJ5aW5nIHRvIGdvCgkgICAgICAgIC8vIGFib3ZlIHRoZSByb290IGlzIGEgbm8tb3AuIFRoZXJlZm9yZSB3ZSBjYW4gcmVtb3ZlIGFsbCAnLi4nIHBhcnRzCgkgICAgICAgIC8vIGRpcmVjdGx5IGFmdGVyIHRoZSByb290LgoJICAgICAgICBwYXJ0cy5zcGxpY2UoaSArIDEsIHVwKTsKCSAgICAgICAgdXAgPSAwOwoJICAgICAgfSBlbHNlIHsKCSAgICAgICAgcGFydHMuc3BsaWNlKGksIDIpOwoJICAgICAgICB1cC0tOwoJICAgICAgfQoJICAgIH0KCSAgfQoJICBwYXRoID0gcGFydHMuam9pbignLycpOwoKCSAgaWYgKHBhdGggPT09ICcnKSB7CgkgICAgcGF0aCA9IGlzQWJzb2x1dGUgPyAnLycgOiAnLic7CgkgIH0KCgkgIGlmICh1cmwpIHsKCSAgICB1cmwucGF0aCA9IHBhdGg7CgkgICAgcmV0dXJuIHVybEdlbmVyYXRlKHVybCk7CgkgIH0KCSAgcmV0dXJuIHBhdGg7Cgl9KTsKCWV4cG9ydHMubm9ybWFsaXplID0gbm9ybWFsaXplOwoKCS8qKgoJICogSm9pbnMgdHdvIHBhdGhzL1VSTHMuCgkgKgoJICogQHBhcmFtIGFSb290IFRoZSByb290IHBhdGggb3IgVVJMLgoJICogQHBhcmFtIGFQYXRoIFRoZSBwYXRoIG9yIFVSTCB0byBiZSBqb2luZWQgd2l0aCB0aGUgcm9vdC4KCSAqCgkgKiAtIElmIGFQYXRoIGlzIGEgVVJMIG9yIGEgZGF0YSBVUkksIGFQYXRoIGlzIHJldHVybmVkLCB1bmxlc3MgYVBhdGggaXMgYQoJICogICBzY2hlbWUtcmVsYXRpdmUgVVJMOiBUaGVuIHRoZSBzY2hlbWUgb2YgYVJvb3QsIGlmIGFueSwgaXMgcHJlcGVuZGVkCgkgKiAgIGZpcnN0LgoJICogLSBPdGhlcndpc2UgYVBhdGggaXMgYSBwYXRoLiBJZiBhUm9vdCBpcyBhIFVSTCwgdGhlbiBpdHMgcGF0aCBwb3J0aW9uCgkgKiAgIGlzIHVwZGF0ZWQgd2l0aCB0aGUgcmVzdWx0IGFuZCBhUm9vdCBpcyByZXR1cm5lZC4gT3RoZXJ3aXNlIHRoZSByZXN1bHQKCSAqICAgaXMgcmV0dXJuZWQuCgkgKiAgIC0gSWYgYVBhdGggaXMgYWJzb2x1dGUsIHRoZSByZXN1bHQgaXMgYVBhdGguCgkgKiAgIC0gT3RoZXJ3aXNlIHRoZSB0d28gcGF0aHMgYXJlIGpvaW5lZCB3aXRoIGEgc2xhc2guCgkgKiAtIEpvaW5pbmcgZm9yIGV4YW1wbGUgJ2h0dHA6Ly8nIGFuZCAnd3d3LmV4YW1wbGUuY29tJyBpcyBhbHNvIHN1cHBvcnRlZC4KCSAqLwoJZnVuY3Rpb24gam9pbihhUm9vdCwgYVBhdGgpIHsKCSAgaWYgKGFSb290ID09PSAiIikgewoJICAgIGFSb290ID0gIi4iOwoJICB9CgkgIGlmIChhUGF0aCA9PT0gIiIpIHsKCSAgICBhUGF0aCA9ICIuIjsKCSAgfQoJICB2YXIgYVBhdGhVcmwgPSB1cmxQYXJzZShhUGF0aCk7CgkgIHZhciBhUm9vdFVybCA9IHVybFBhcnNlKGFSb290KTsKCSAgaWYgKGFSb290VXJsKSB7CgkgICAgYVJvb3QgPSBhUm9vdFVybC5wYXRoIHx8ICcvJzsKCSAgfQoKCSAgLy8gYGpvaW4oZm9vLCAnLy93d3cuZXhhbXBsZS5vcmcnKWAKCSAgaWYgKGFQYXRoVXJsICYmICFhUGF0aFVybC5zY2hlbWUpIHsKCSAgICBpZiAoYVJvb3RVcmwpIHsKCSAgICAgIGFQYXRoVXJsLnNjaGVtZSA9IGFSb290VXJsLnNjaGVtZTsKCSAgICB9CgkgICAgcmV0dXJuIHVybEdlbmVyYXRlKGFQYXRoVXJsKTsKCSAgfQoKCSAgaWYgKGFQYXRoVXJsIHx8IGFQYXRoLm1hdGNoKGRhdGFVcmxSZWdleHApKSB7CgkgICAgcmV0dXJuIGFQYXRoOwoJICB9CgoJICAvLyBgam9pbignaHR0cDovLycsICd3d3cuZXhhbXBsZS5jb20nKWAKCSAgaWYgKGFSb290VXJsICYmICFhUm9vdFVybC5ob3N0ICYmICFhUm9vdFVybC5wYXRoKSB7CgkgICAgYVJvb3RVcmwuaG9zdCA9IGFQYXRoOwoJICAgIHJldHVybiB1cmxHZW5lcmF0ZShhUm9vdFVybCk7CgkgIH0KCgkgIHZhciBqb2luZWQgPSBhUGF0aC5jaGFyQXQoMCkgPT09ICcvJwoJICAgID8gYVBhdGgKCSAgICA6IG5vcm1hbGl6ZShhUm9vdC5yZXBsYWNlKC9cLyskLywgJycpICsgJy8nICsgYVBhdGgpOwoKCSAgaWYgKGFSb290VXJsKSB7CgkgICAgYVJvb3RVcmwucGF0aCA9IGpvaW5lZDsKCSAgICByZXR1cm4gdXJsR2VuZXJhdGUoYVJvb3RVcmwpOwoJICB9CgkgIHJldHVybiBqb2luZWQ7Cgl9CglleHBvcnRzLmpvaW4gPSBqb2luOwoKCWV4cG9ydHMuaXNBYnNvbHV0ZSA9IGZ1bmN0aW9uIChhUGF0aCkgewoJICByZXR1cm4gYVBhdGguY2hhckF0KDApID09PSAnLycgfHwgdXJsUmVnZXhwLnRlc3QoYVBhdGgpOwoJfTsKCgkvKioKCSAqIE1ha2UgYSBwYXRoIHJlbGF0aXZlIHRvIGEgVVJMIG9yIGFub3RoZXIgcGF0aC4KCSAqCgkgKiBAcGFyYW0gYVJvb3QgVGhlIHJvb3QgcGF0aCBvciBVUkwuCgkgKiBAcGFyYW0gYVBhdGggVGhlIHBhdGggb3IgVVJMIHRvIGJlIG1hZGUgcmVsYXRpdmUgdG8gYVJvb3QuCgkgKi8KCWZ1bmN0aW9uIHJlbGF0aXZlKGFSb290LCBhUGF0aCkgewoJICBpZiAoYVJvb3QgPT09ICIiKSB7CgkgICAgYVJvb3QgPSAiLiI7CgkgIH0KCgkgIGFSb290ID0gYVJvb3QucmVwbGFjZSgvXC8kLywgJycpOwoKCSAgLy8gSXQgaXMgcG9zc2libGUgZm9yIHRoZSBwYXRoIHRvIGJlIGFib3ZlIHRoZSByb290LiBJbiB0aGlzIGNhc2UsIHNpbXBseQoJICAvLyBjaGVja2luZyB3aGV0aGVyIHRoZSByb290IGlzIGEgcHJlZml4IG9mIHRoZSBwYXRoIHdvbid0IHdvcmsuIEluc3RlYWQsIHdlCgkgIC8vIG5lZWQgdG8gcmVtb3ZlIGNvbXBvbmVudHMgZnJvbSB0aGUgcm9vdCBvbmUgYnkgb25lLCB1bnRpbCBlaXRoZXIgd2UgZmluZAoJICAvLyBhIHByZWZpeCB0aGF0IGZpdHMsIG9yIHdlIHJ1biBvdXQgb2YgY29tcG9uZW50cyB0byByZW1vdmUuCgkgIHZhciBsZXZlbCA9IDA7CgkgIHdoaWxlIChhUGF0aC5pbmRleE9mKGFSb290ICsgJy8nKSAhPT0gMCkgewoJICAgIHZhciBpbmRleCA9IGFSb290Lmxhc3RJbmRleE9mKCIvIik7CgkgICAgaWYgKGluZGV4IDwgMCkgewoJICAgICAgcmV0dXJuIGFQYXRoOwoJICAgIH0KCgkgICAgLy8gSWYgdGhlIG9ubHkgcGFydCBvZiB0aGUgcm9vdCB0aGF0IGlzIGxlZnQgaXMgdGhlIHNjaGVtZSAoaS5lLiBodHRwOi8vLAoJICAgIC8vIGZpbGU6Ly8vLCBldGMuKSwgb25lIG9yIG1vcmUgc2xhc2hlcyAoLyksIG9yIHNpbXBseSBub3RoaW5nIGF0IGFsbCwgd2UKCSAgICAvLyBoYXZlIGV4aGF1c3RlZCBhbGwgY29tcG9uZW50cywgc28gdGhlIHBhdGggaXMgbm90IHJlbGF0aXZlIHRvIHRoZSByb290LgoJICAgIGFSb290ID0gYVJvb3Quc2xpY2UoMCwgaW5kZXgpOwoJICAgIGlmIChhUm9vdC5tYXRjaCgvXihbXlwvXSs6XC8pP1wvKiQvKSkgewoJICAgICAgcmV0dXJuIGFQYXRoOwoJICAgIH0KCgkgICAgKytsZXZlbDsKCSAgfQoKCSAgLy8gTWFrZSBzdXJlIHdlIGFkZCBhICIuLi8iIGZvciBlYWNoIGNvbXBvbmVudCB3ZSByZW1vdmVkIGZyb20gdGhlIHJvb3QuCgkgIHJldHVybiBBcnJheShsZXZlbCArIDEpLmpvaW4oIi4uLyIpICsgYVBhdGguc3Vic3RyKGFSb290Lmxlbmd0aCArIDEpOwoJfQoJZXhwb3J0cy5yZWxhdGl2ZSA9IHJlbGF0aXZlOwoKCXZhciBzdXBwb3J0c051bGxQcm90byA9IChmdW5jdGlvbiAoKSB7CgkgIHZhciBvYmogPSBPYmplY3QuY3JlYXRlKG51bGwpOwoJICByZXR1cm4gISgnX19wcm90b19fJyBpbiBvYmopOwoJfSgpKTsKCglmdW5jdGlvbiBpZGVudGl0eSAocykgewoJICByZXR1cm4gczsKCX0KCgkvKioKCSAqIEJlY2F1c2UgYmVoYXZpb3IgZ29lcyB3YWNreSB3aGVuIHlvdSBzZXQgYF9fcHJvdG9fX2Agb24gb2JqZWN0cywgd2UKCSAqIGhhdmUgdG8gcHJlZml4IGFsbCB0aGUgc3RyaW5ncyBpbiBvdXIgc2V0IHdpdGggYW4gYXJiaXRyYXJ5IGNoYXJhY3Rlci4KCSAqCgkgKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL21vemlsbGEvc291cmNlLW1hcC9wdWxsLzMxIGFuZAoJICogaHR0cHM6Ly9naXRodWIuY29tL21vemlsbGEvc291cmNlLW1hcC9pc3N1ZXMvMzAKCSAqCgkgKiBAcGFyYW0gU3RyaW5nIGFTdHIKCSAqLwoJZnVuY3Rpb24gdG9TZXRTdHJpbmcoYVN0cikgewoJICBpZiAoaXNQcm90b1N0cmluZyhhU3RyKSkgewoJICAgIHJldHVybiAnJCcgKyBhU3RyOwoJICB9CgoJICByZXR1cm4gYVN0cjsKCX0KCWV4cG9ydHMudG9TZXRTdHJpbmcgPSBzdXBwb3J0c051bGxQcm90byA/IGlkZW50aXR5IDogdG9TZXRTdHJpbmc7CgoJZnVuY3Rpb24gZnJvbVNldFN0cmluZyhhU3RyKSB7CgkgIGlmIChpc1Byb3RvU3RyaW5nKGFTdHIpKSB7CgkgICAgcmV0dXJuIGFTdHIuc2xpY2UoMSk7CgkgIH0KCgkgIHJldHVybiBhU3RyOwoJfQoJZXhwb3J0cy5mcm9tU2V0U3RyaW5nID0gc3VwcG9ydHNOdWxsUHJvdG8gPyBpZGVudGl0eSA6IGZyb21TZXRTdHJpbmc7CgoJZnVuY3Rpb24gaXNQcm90b1N0cmluZyhzKSB7CgkgIGlmICghcykgewoJICAgIHJldHVybiBmYWxzZTsKCSAgfQoKCSAgdmFyIGxlbmd0aCA9IHMubGVuZ3RoOwoKCSAgaWYgKGxlbmd0aCA8IDkgLyogIl9fcHJvdG9fXyIubGVuZ3RoICovKSB7CgkgICAgcmV0dXJuIGZhbHNlOwoJICB9CgoJICBpZiAocy5jaGFyQ29kZUF0KGxlbmd0aCAtIDEpICE9PSA5NSAgLyogJ18nICovIHx8CgkgICAgICBzLmNoYXJDb2RlQXQobGVuZ3RoIC0gMikgIT09IDk1ICAvKiAnXycgKi8gfHwKCSAgICAgIHMuY2hhckNvZGVBdChsZW5ndGggLSAzKSAhPT0gMTExIC8qICdvJyAqLyB8fAoJICAgICAgcy5jaGFyQ29kZUF0KGxlbmd0aCAtIDQpICE9PSAxMTYgLyogJ3QnICovIHx8CgkgICAgICBzLmNoYXJDb2RlQXQobGVuZ3RoIC0gNSkgIT09IDExMSAvKiAnbycgKi8gfHwKCSAgICAgIHMuY2hhckNvZGVBdChsZW5ndGggLSA2KSAhPT0gMTE0IC8qICdyJyAqLyB8fAoJICAgICAgcy5jaGFyQ29kZUF0KGxlbmd0aCAtIDcpICE9PSAxMTIgLyogJ3AnICovIHx8CgkgICAgICBzLmNoYXJDb2RlQXQobGVuZ3RoIC0gOCkgIT09IDk1ICAvKiAnXycgKi8gfHwKCSAgICAgIHMuY2hhckNvZGVBdChsZW5ndGggLSA5KSAhPT0gOTUgIC8qICdfJyAqLykgewoJICAgIHJldHVybiBmYWxzZTsKCSAgfQoKCSAgZm9yICh2YXIgaSA9IGxlbmd0aCAtIDEwOyBpID49IDA7IGktLSkgewoJICAgIGlmIChzLmNoYXJDb2RlQXQoaSkgIT09IDM2IC8qICckJyAqLykgewoJICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH0KCSAgfQoKCSAgcmV0dXJuIHRydWU7Cgl9CgoJLyoqCgkgKiBDb21wYXJhdG9yIGJldHdlZW4gdHdvIG1hcHBpbmdzIHdoZXJlIHRoZSBvcmlnaW5hbCBwb3NpdGlvbnMgYXJlIGNvbXBhcmVkLgoJICoKCSAqIE9wdGlvbmFsbHkgcGFzcyBpbiBgdHJ1ZWAgYXMgYG9ubHlDb21wYXJlR2VuZXJhdGVkYCB0byBjb25zaWRlciB0d28KCSAqIG1hcHBpbmdzIHdpdGggdGhlIHNhbWUgb3JpZ2luYWwgc291cmNlL2xpbmUvY29sdW1uLCBidXQgZGlmZmVyZW50IGdlbmVyYXRlZAoJICogbGluZSBhbmQgY29sdW1uIHRoZSBzYW1lLiBVc2VmdWwgd2hlbiBzZWFyY2hpbmcgZm9yIGEgbWFwcGluZyB3aXRoIGEKCSAqIHN0dWJiZWQgb3V0IG1hcHBpbmcuCgkgKi8KCWZ1bmN0aW9uIGNvbXBhcmVCeU9yaWdpbmFsUG9zaXRpb25zKG1hcHBpbmdBLCBtYXBwaW5nQiwgb25seUNvbXBhcmVPcmlnaW5hbCkgewoJICB2YXIgY21wID0gc3RyY21wKG1hcHBpbmdBLnNvdXJjZSwgbWFwcGluZ0Iuc291cmNlKTsKCSAgaWYgKGNtcCAhPT0gMCkgewoJICAgIHJldHVybiBjbXA7CgkgIH0KCgkgIGNtcCA9IG1hcHBpbmdBLm9yaWdpbmFsTGluZSAtIG1hcHBpbmdCLm9yaWdpbmFsTGluZTsKCSAgaWYgKGNtcCAhPT0gMCkgewoJICAgIHJldHVybiBjbXA7CgkgIH0KCgkgIGNtcCA9IG1hcHBpbmdBLm9yaWdpbmFsQ29sdW1uIC0gbWFwcGluZ0Iub3JpZ2luYWxDb2x1bW47CgkgIGlmIChjbXAgIT09IDAgfHwgb25seUNvbXBhcmVPcmlnaW5hbCkgewoJICAgIHJldHVybiBjbXA7CgkgIH0KCgkgIGNtcCA9IG1hcHBpbmdBLmdlbmVyYXRlZENvbHVtbiAtIG1hcHBpbmdCLmdlbmVyYXRlZENvbHVtbjsKCSAgaWYgKGNtcCAhPT0gMCkgewoJICAgIHJldHVybiBjbXA7CgkgIH0KCgkgIGNtcCA9IG1hcHBpbmdBLmdlbmVyYXRlZExpbmUgLSBtYXBwaW5nQi5nZW5lcmF0ZWRMaW5lOwoJICBpZiAoY21wICE9PSAwKSB7CgkgICAgcmV0dXJuIGNtcDsKCSAgfQoKCSAgcmV0dXJuIHN0cmNtcChtYXBwaW5nQS5uYW1lLCBtYXBwaW5nQi5uYW1lKTsKCX0KCWV4cG9ydHMuY29tcGFyZUJ5T3JpZ2luYWxQb3NpdGlvbnMgPSBjb21wYXJlQnlPcmlnaW5hbFBvc2l0aW9uczsKCglmdW5jdGlvbiBjb21wYXJlQnlPcmlnaW5hbFBvc2l0aW9uc05vU291cmNlKG1hcHBpbmdBLCBtYXBwaW5nQiwgb25seUNvbXBhcmVPcmlnaW5hbCkgewoJICB2YXIgY21wOwoKCSAgY21wID0gbWFwcGluZ0Eub3JpZ2luYWxMaW5lIC0gbWFwcGluZ0Iub3JpZ2luYWxMaW5lOwoJICBpZiAoY21wICE9PSAwKSB7CgkgICAgcmV0dXJuIGNtcDsKCSAgfQoKCSAgY21wID0gbWFwcGluZ0Eub3JpZ2luYWxDb2x1bW4gLSBtYXBwaW5nQi5vcmlnaW5hbENvbHVtbjsKCSAgaWYgKGNtcCAhPT0gMCB8fCBvbmx5Q29tcGFyZU9yaWdpbmFsKSB7CgkgICAgcmV0dXJuIGNtcDsKCSAgfQoKCSAgY21wID0gbWFwcGluZ0EuZ2VuZXJhdGVkQ29sdW1uIC0gbWFwcGluZ0IuZ2VuZXJhdGVkQ29sdW1uOwoJICBpZiAoY21wICE9PSAwKSB7CgkgICAgcmV0dXJuIGNtcDsKCSAgfQoKCSAgY21wID0gbWFwcGluZ0EuZ2VuZXJhdGVkTGluZSAtIG1hcHBpbmdCLmdlbmVyYXRlZExpbmU7CgkgIGlmIChjbXAgIT09IDApIHsKCSAgICByZXR1cm4gY21wOwoJICB9CgoJICByZXR1cm4gc3RyY21wKG1hcHBpbmdBLm5hbWUsIG1hcHBpbmdCLm5hbWUpOwoJfQoJZXhwb3J0cy5jb21wYXJlQnlPcmlnaW5hbFBvc2l0aW9uc05vU291cmNlID0gY29tcGFyZUJ5T3JpZ2luYWxQb3NpdGlvbnNOb1NvdXJjZTsKCgkvKioKCSAqIENvbXBhcmF0b3IgYmV0d2VlbiB0d28gbWFwcGluZ3Mgd2l0aCBkZWZsYXRlZCBzb3VyY2UgYW5kIG5hbWUgaW5kaWNlcyB3aGVyZQoJICogdGhlIGdlbmVyYXRlZCBwb3NpdGlvbnMgYXJlIGNvbXBhcmVkLgoJICoKCSAqIE9wdGlvbmFsbHkgcGFzcyBpbiBgdHJ1ZWAgYXMgYG9ubHlDb21wYXJlR2VuZXJhdGVkYCB0byBjb25zaWRlciB0d28KCSAqIG1hcHBpbmdzIHdpdGggdGhlIHNhbWUgZ2VuZXJhdGVkIGxpbmUgYW5kIGNvbHVtbiwgYnV0IGRpZmZlcmVudAoJICogc291cmNlL25hbWUvb3JpZ2luYWwgbGluZSBhbmQgY29sdW1uIHRoZSBzYW1lLiBVc2VmdWwgd2hlbiBzZWFyY2hpbmcgZm9yIGEKCSAqIG1hcHBpbmcgd2l0aCBhIHN0dWJiZWQgb3V0IG1hcHBpbmcuCgkgKi8KCWZ1bmN0aW9uIGNvbXBhcmVCeUdlbmVyYXRlZFBvc2l0aW9uc0RlZmxhdGVkKG1hcHBpbmdBLCBtYXBwaW5nQiwgb25seUNvbXBhcmVHZW5lcmF0ZWQpIHsKCSAgdmFyIGNtcCA9IG1hcHBpbmdBLmdlbmVyYXRlZExpbmUgLSBtYXBwaW5nQi5nZW5lcmF0ZWRMaW5lOwoJICBpZiAoY21wICE9PSAwKSB7CgkgICAgcmV0dXJuIGNtcDsKCSAgfQoKCSAgY21wID0gbWFwcGluZ0EuZ2VuZXJhdGVkQ29sdW1uIC0gbWFwcGluZ0IuZ2VuZXJhdGVkQ29sdW1uOwoJICBpZiAoY21wICE9PSAwIHx8IG9ubHlDb21wYXJlR2VuZXJhdGVkKSB7CgkgICAgcmV0dXJuIGNtcDsKCSAgfQoKCSAgY21wID0gc3RyY21wKG1hcHBpbmdBLnNvdXJjZSwgbWFwcGluZ0Iuc291cmNlKTsKCSAgaWYgKGNtcCAhPT0gMCkgewoJICAgIHJldHVybiBjbXA7CgkgIH0KCgkgIGNtcCA9IG1hcHBpbmdBLm9yaWdpbmFsTGluZSAtIG1hcHBpbmdCLm9yaWdpbmFsTGluZTsKCSAgaWYgKGNtcCAhPT0gMCkgewoJICAgIHJldHVybiBjbXA7CgkgIH0KCgkgIGNtcCA9IG1hcHBpbmdBLm9yaWdpbmFsQ29sdW1uIC0gbWFwcGluZ0Iub3JpZ2luYWxDb2x1bW47CgkgIGlmIChjbXAgIT09IDApIHsKCSAgICByZXR1cm4gY21wOwoJICB9CgoJICByZXR1cm4gc3RyY21wKG1hcHBpbmdBLm5hbWUsIG1hcHBpbmdCLm5hbWUpOwoJfQoJZXhwb3J0cy5jb21wYXJlQnlHZW5lcmF0ZWRQb3NpdGlvbnNEZWZsYXRlZCA9IGNvbXBhcmVCeUdlbmVyYXRlZFBvc2l0aW9uc0RlZmxhdGVkOwoKCWZ1bmN0aW9uIGNvbXBhcmVCeUdlbmVyYXRlZFBvc2l0aW9uc0RlZmxhdGVkTm9MaW5lKG1hcHBpbmdBLCBtYXBwaW5nQiwgb25seUNvbXBhcmVHZW5lcmF0ZWQpIHsKCSAgdmFyIGNtcCA9IG1hcHBpbmdBLmdlbmVyYXRlZENvbHVtbiAtIG1hcHBpbmdCLmdlbmVyYXRlZENvbHVtbjsKCSAgaWYgKGNtcCAhPT0gMCB8fCBvbmx5Q29tcGFyZUdlbmVyYXRlZCkgewoJICAgIHJldHVybiBjbXA7CgkgIH0KCgkgIGNtcCA9IHN0cmNtcChtYXBwaW5nQS5zb3VyY2UsIG1hcHBpbmdCLnNvdXJjZSk7CgkgIGlmIChjbXAgIT09IDApIHsKCSAgICByZXR1cm4gY21wOwoJICB9CgoJICBjbXAgPSBtYXBwaW5nQS5vcmlnaW5hbExpbmUgLSBtYXBwaW5nQi5vcmlnaW5hbExpbmU7CgkgIGlmIChjbXAgIT09IDApIHsKCSAgICByZXR1cm4gY21wOwoJICB9CgoJICBjbXAgPSBtYXBwaW5nQS5vcmlnaW5hbENvbHVtbiAtIG1hcHBpbmdCLm9yaWdpbmFsQ29sdW1uOwoJICBpZiAoY21wICE9PSAwKSB7CgkgICAgcmV0dXJuIGNtcDsKCSAgfQoKCSAgcmV0dXJuIHN0cmNtcChtYXBwaW5nQS5uYW1lLCBtYXBwaW5nQi5uYW1lKTsKCX0KCWV4cG9ydHMuY29tcGFyZUJ5R2VuZXJhdGVkUG9zaXRpb25zRGVmbGF0ZWROb0xpbmUgPSBjb21wYXJlQnlHZW5lcmF0ZWRQb3NpdGlvbnNEZWZsYXRlZE5vTGluZTsKCglmdW5jdGlvbiBzdHJjbXAoYVN0cjEsIGFTdHIyKSB7CgkgIGlmIChhU3RyMSA9PT0gYVN0cjIpIHsKCSAgICByZXR1cm4gMDsKCSAgfQoKCSAgaWYgKGFTdHIxID09PSBudWxsKSB7CgkgICAgcmV0dXJuIDE7IC8vIGFTdHIyICE9PSBudWxsCgkgIH0KCgkgIGlmIChhU3RyMiA9PT0gbnVsbCkgewoJICAgIHJldHVybiAtMTsgLy8gYVN0cjEgIT09IG51bGwKCSAgfQoKCSAgaWYgKGFTdHIxID4gYVN0cjIpIHsKCSAgICByZXR1cm4gMTsKCSAgfQoKCSAgcmV0dXJuIC0xOwoJfQoKCS8qKgoJICogQ29tcGFyYXRvciBiZXR3ZWVuIHR3byBtYXBwaW5ncyB3aXRoIGluZmxhdGVkIHNvdXJjZSBhbmQgbmFtZSBzdHJpbmdzIHdoZXJlCgkgKiB0aGUgZ2VuZXJhdGVkIHBvc2l0aW9ucyBhcmUgY29tcGFyZWQuCgkgKi8KCWZ1bmN0aW9uIGNvbXBhcmVCeUdlbmVyYXRlZFBvc2l0aW9uc0luZmxhdGVkKG1hcHBpbmdBLCBtYXBwaW5nQikgewoJICB2YXIgY21wID0gbWFwcGluZ0EuZ2VuZXJhdGVkTGluZSAtIG1hcHBpbmdCLmdlbmVyYXRlZExpbmU7CgkgIGlmIChjbXAgIT09IDApIHsKCSAgICByZXR1cm4gY21wOwoJICB9CgoJICBjbXAgPSBtYXBwaW5nQS5nZW5lcmF0ZWRDb2x1bW4gLSBtYXBwaW5nQi5nZW5lcmF0ZWRDb2x1bW47CgkgIGlmIChjbXAgIT09IDApIHsKCSAgICByZXR1cm4gY21wOwoJICB9CgoJICBjbXAgPSBzdHJjbXAobWFwcGluZ0Euc291cmNlLCBtYXBwaW5nQi5zb3VyY2UpOwoJICBpZiAoY21wICE9PSAwKSB7CgkgICAgcmV0dXJuIGNtcDsKCSAgfQoKCSAgY21wID0gbWFwcGluZ0Eub3JpZ2luYWxMaW5lIC0gbWFwcGluZ0Iub3JpZ2luYWxMaW5lOwoJICBpZiAoY21wICE9PSAwKSB7CgkgICAgcmV0dXJuIGNtcDsKCSAgfQoKCSAgY21wID0gbWFwcGluZ0Eub3JpZ2luYWxDb2x1bW4gLSBtYXBwaW5nQi5vcmlnaW5hbENvbHVtbjsKCSAgaWYgKGNtcCAhPT0gMCkgewoJICAgIHJldHVybiBjbXA7CgkgIH0KCgkgIHJldHVybiBzdHJjbXAobWFwcGluZ0EubmFtZSwgbWFwcGluZ0IubmFtZSk7Cgl9CglleHBvcnRzLmNvbXBhcmVCeUdlbmVyYXRlZFBvc2l0aW9uc0luZmxhdGVkID0gY29tcGFyZUJ5R2VuZXJhdGVkUG9zaXRpb25zSW5mbGF0ZWQ7CgoJLyoqCgkgKiBTdHJpcCBhbnkgSlNPTiBYU1NJIGF2b2lkYW5jZSBwcmVmaXggZnJvbSB0aGUgc3RyaW5nIChhcyBkb2N1bWVudGVkCgkgKiBpbiB0aGUgc291cmNlIG1hcHMgc3BlY2lmaWNhdGlvbiksIGFuZCB0aGVuIHBhcnNlIHRoZSBzdHJpbmcgYXMKCSAqIEpTT04uCgkgKi8KCWZ1bmN0aW9uIHBhcnNlU291cmNlTWFwSW5wdXQoc3RyKSB7CgkgIHJldHVybiBKU09OLnBhcnNlKHN0ci5yZXBsYWNlKC9eXCldfSdbXlxuXSpcbi8sICcnKSk7Cgl9CglleHBvcnRzLnBhcnNlU291cmNlTWFwSW5wdXQgPSBwYXJzZVNvdXJjZU1hcElucHV0OwoKCS8qKgoJICogQ29tcHV0ZSB0aGUgVVJMIG9mIGEgc291cmNlIGdpdmVuIHRoZSB0aGUgc291cmNlIHJvb3QsIHRoZSBzb3VyY2UncwoJICogVVJMLCBhbmQgdGhlIHNvdXJjZSBtYXAncyBVUkwuCgkgKi8KCWZ1bmN0aW9uIGNvbXB1dGVTb3VyY2VVUkwoc291cmNlUm9vdCwgc291cmNlVVJMLCBzb3VyY2VNYXBVUkwpIHsKCSAgc291cmNlVVJMID0gc291cmNlVVJMIHx8ICcnOwoKCSAgaWYgKHNvdXJjZVJvb3QpIHsKCSAgICAvLyBUaGlzIGZvbGxvd3Mgd2hhdCBDaHJvbWUgZG9lcy4KCSAgICBpZiAoc291cmNlUm9vdFtzb3VyY2VSb290Lmxlbmd0aCAtIDFdICE9PSAnLycgJiYgc291cmNlVVJMWzBdICE9PSAnLycpIHsKCSAgICAgIHNvdXJjZVJvb3QgKz0gJy8nOwoJICAgIH0KCSAgICAvLyBUaGUgc3BlYyBzYXlzOgoJICAgIC8vICAgTGluZSA0OiBBbiBvcHRpb25hbCBzb3VyY2Ugcm9vdCwgdXNlZnVsIGZvciByZWxvY2F0aW5nIHNvdXJjZQoJICAgIC8vICAgZmlsZXMgb24gYSBzZXJ2ZXIgb3IgcmVtb3ZpbmcgcmVwZWF0ZWQgdmFsdWVzIGluIHRoZQoJICAgIC8vICAg4oCcc291cmNlc+KAnSBlbnRyeS4gIFRoaXMgdmFsdWUgaXMgcHJlcGVuZGVkIHRvIHRoZSBpbmRpdmlkdWFsCgkgICAgLy8gICBlbnRyaWVzIGluIHRoZSDigJxzb3VyY2XigJ0gZmllbGQuCgkgICAgc291cmNlVVJMID0gc291cmNlUm9vdCArIHNvdXJjZVVSTDsKCSAgfQoKCSAgLy8gSGlzdG9yaWNhbGx5LCBTb3VyY2VNYXBDb25zdW1lciBkaWQgbm90IHRha2UgdGhlIHNvdXJjZU1hcFVSTCBhcwoJICAvLyBhIHBhcmFtZXRlci4gIFRoaXMgbW9kZSBpcyBzdGlsbCBzb21ld2hhdCBzdXBwb3J0ZWQsIHdoaWNoIGlzIHdoeQoJICAvLyB0aGlzIGNvZGUgYmxvY2sgaXMgY29uZGl0aW9uYWwuICBIb3dldmVyLCBpdCdzIHByZWZlcmFibGUgdG8gcGFzcwoJICAvLyB0aGUgc291cmNlIG1hcCBVUkwgdG8gU291cmNlTWFwQ29uc3VtZXIsIHNvIHRoYXQgdGhpcyBmdW5jdGlvbgoJICAvLyBjYW4gaW1wbGVtZW50IHRoZSBzb3VyY2UgVVJMIHJlc29sdXRpb24gYWxnb3JpdGhtIGFzIG91dGxpbmVkIGluCgkgIC8vIHRoZSBzcGVjLiAgVGhpcyBibG9jayBpcyBiYXNpY2FsbHkgdGhlIGVxdWl2YWxlbnQgb2Y6CgkgIC8vICAgIG5ldyBVUkwoc291cmNlVVJMLCBzb3VyY2VNYXBVUkwpLnRvU3RyaW5nKCkKCSAgLy8gLi4uIGV4Y2VwdCBpdCBhdm9pZHMgdXNpbmcgVVJMLCB3aGljaCB3YXNuJ3QgYXZhaWxhYmxlIGluIHRoZQoJICAvLyBvbGRlciByZWxlYXNlcyBvZiBub2RlIHN0aWxsIHN1cHBvcnRlZCBieSB0aGlzIGxpYnJhcnkuCgkgIC8vCgkgIC8vIFRoZSBzcGVjIHNheXM6CgkgIC8vICAgSWYgdGhlIHNvdXJjZXMgYXJlIG5vdCBhYnNvbHV0ZSBVUkxzIGFmdGVyIHByZXBlbmRpbmcgb2YgdGhlCgkgIC8vICAg4oCcc291cmNlUm9vdOKAnSwgdGhlIHNvdXJjZXMgYXJlIHJlc29sdmVkIHJlbGF0aXZlIHRvIHRoZQoJICAvLyAgIFNvdXJjZU1hcCAobGlrZSByZXNvbHZpbmcgc2NyaXB0IHNyYyBpbiBhIGh0bWwgZG9jdW1lbnQpLgoJICBpZiAoc291cmNlTWFwVVJMKSB7CgkgICAgdmFyIHBhcnNlZCA9IHVybFBhcnNlKHNvdXJjZU1hcFVSTCk7CgkgICAgaWYgKCFwYXJzZWQpIHsKCSAgICAgIHRocm93IG5ldyBFcnJvcigic291cmNlTWFwVVJMIGNvdWxkIG5vdCBiZSBwYXJzZWQiKTsKCSAgICB9CgkgICAgaWYgKHBhcnNlZC5wYXRoKSB7CgkgICAgICAvLyBTdHJpcCB0aGUgbGFzdCBwYXRoIGNvbXBvbmVudCwgYnV0IGtlZXAgdGhlICIvIi4KCSAgICAgIHZhciBpbmRleCA9IHBhcnNlZC5wYXRoLmxhc3RJbmRleE9mKCcvJyk7CgkgICAgICBpZiAoaW5kZXggPj0gMCkgewoJICAgICAgICBwYXJzZWQucGF0aCA9IHBhcnNlZC5wYXRoLnN1YnN0cmluZygwLCBpbmRleCArIDEpOwoJICAgICAgfQoJICAgIH0KCSAgICBzb3VyY2VVUkwgPSBqb2luKHVybEdlbmVyYXRlKHBhcnNlZCksIHNvdXJjZVVSTCk7CgkgIH0KCgkgIHJldHVybiBub3JtYWxpemUoc291cmNlVVJMKTsKCX0KCWV4cG9ydHMuY29tcHV0ZVNvdXJjZVVSTCA9IGNvbXB1dGVTb3VyY2VVUkw7IAp9ICh1dGlsJDMpKTsKCnZhciBhcnJheVNldCA9IHt9OwoKLyogLSotIE1vZGU6IGpzOyBqcy1pbmRlbnQtbGV2ZWw6IDI7IC0qLSAqLwoKLyoKICogQ29weXJpZ2h0IDIwMTEgTW96aWxsYSBGb3VuZGF0aW9uIGFuZCBjb250cmlidXRvcnMKICogTGljZW5zZWQgdW5kZXIgdGhlIE5ldyBCU0QgbGljZW5zZS4gU2VlIExJQ0VOU0Ugb3I6CiAqIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9CU0QtMy1DbGF1c2UKICovCgp2YXIgdXRpbCQyID0gdXRpbCQzOwp2YXIgaGFzID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKdmFyIGhhc05hdGl2ZU1hcCA9IHR5cGVvZiBNYXAgIT09ICJ1bmRlZmluZWQiOwoKLyoqCiAqIEEgZGF0YSBzdHJ1Y3R1cmUgd2hpY2ggaXMgYSBjb21iaW5hdGlvbiBvZiBhbiBhcnJheSBhbmQgYSBzZXQuIEFkZGluZyBhIG5ldwogKiBtZW1iZXIgaXMgTygxKSwgdGVzdGluZyBmb3IgbWVtYmVyc2hpcCBpcyBPKDEpLCBhbmQgZmluZGluZyB0aGUgaW5kZXggb2YgYW4KICogZWxlbWVudCBpcyBPKDEpLiBSZW1vdmluZyBlbGVtZW50cyBmcm9tIHRoZSBzZXQgaXMgbm90IHN1cHBvcnRlZC4gT25seQogKiBzdHJpbmdzIGFyZSBzdXBwb3J0ZWQgZm9yIG1lbWJlcnNoaXAuCiAqLwpmdW5jdGlvbiBBcnJheVNldCQxKCkgewogIHRoaXMuX2FycmF5ID0gW107CiAgdGhpcy5fc2V0ID0gaGFzTmF0aXZlTWFwID8gbmV3IE1hcCgpIDogT2JqZWN0LmNyZWF0ZShudWxsKTsKfQoKLyoqCiAqIFN0YXRpYyBtZXRob2QgZm9yIGNyZWF0aW5nIEFycmF5U2V0IGluc3RhbmNlcyBmcm9tIGFuIGV4aXN0aW5nIGFycmF5LgogKi8KQXJyYXlTZXQkMS5mcm9tQXJyYXkgPSBmdW5jdGlvbiBBcnJheVNldF9mcm9tQXJyYXkoYUFycmF5LCBhQWxsb3dEdXBsaWNhdGVzKSB7CiAgdmFyIHNldCA9IG5ldyBBcnJheVNldCQxKCk7CiAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGFBcnJheS5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgc2V0LmFkZChhQXJyYXlbaV0sIGFBbGxvd0R1cGxpY2F0ZXMpOwogIH0KICByZXR1cm4gc2V0Owp9OwoKLyoqCiAqIFJldHVybiBob3cgbWFueSB1bmlxdWUgaXRlbXMgYXJlIGluIHRoaXMgQXJyYXlTZXQuIElmIGR1cGxpY2F0ZXMgaGF2ZSBiZWVuCiAqIGFkZGVkLCB0aGFuIHRob3NlIGRvIG5vdCBjb3VudCB0b3dhcmRzIHRoZSBzaXplLgogKgogKiBAcmV0dXJucyBOdW1iZXIKICovCkFycmF5U2V0JDEucHJvdG90eXBlLnNpemUgPSBmdW5jdGlvbiBBcnJheVNldF9zaXplKCkgewogIHJldHVybiBoYXNOYXRpdmVNYXAgPyB0aGlzLl9zZXQuc2l6ZSA6IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRoaXMuX3NldCkubGVuZ3RoOwp9OwoKLyoqCiAqIEFkZCB0aGUgZ2l2ZW4gc3RyaW5nIHRvIHRoaXMgc2V0LgogKgogKiBAcGFyYW0gU3RyaW5nIGFTdHIKICovCkFycmF5U2V0JDEucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIEFycmF5U2V0X2FkZChhU3RyLCBhQWxsb3dEdXBsaWNhdGVzKSB7CiAgdmFyIHNTdHIgPSBoYXNOYXRpdmVNYXAgPyBhU3RyIDogdXRpbCQyLnRvU2V0U3RyaW5nKGFTdHIpOwogIHZhciBpc0R1cGxpY2F0ZSA9IGhhc05hdGl2ZU1hcCA/IHRoaXMuaGFzKGFTdHIpIDogaGFzLmNhbGwodGhpcy5fc2V0LCBzU3RyKTsKICB2YXIgaWR4ID0gdGhpcy5fYXJyYXkubGVuZ3RoOwogIGlmICghaXNEdXBsaWNhdGUgfHwgYUFsbG93RHVwbGljYXRlcykgewogICAgdGhpcy5fYXJyYXkucHVzaChhU3RyKTsKICB9CiAgaWYgKCFpc0R1cGxpY2F0ZSkgewogICAgaWYgKGhhc05hdGl2ZU1hcCkgewogICAgICB0aGlzLl9zZXQuc2V0KGFTdHIsIGlkeCk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLl9zZXRbc1N0cl0gPSBpZHg7CiAgICB9CiAgfQp9OwoKLyoqCiAqIElzIHRoZSBnaXZlbiBzdHJpbmcgYSBtZW1iZXIgb2YgdGhpcyBzZXQ/CiAqCiAqIEBwYXJhbSBTdHJpbmcgYVN0cgogKi8KQXJyYXlTZXQkMS5wcm90b3R5cGUuaGFzID0gZnVuY3Rpb24gQXJyYXlTZXRfaGFzKGFTdHIpIHsKICBpZiAoaGFzTmF0aXZlTWFwKSB7CiAgICByZXR1cm4gdGhpcy5fc2V0LmhhcyhhU3RyKTsKICB9IGVsc2UgewogICAgdmFyIHNTdHIgPSB1dGlsJDIudG9TZXRTdHJpbmcoYVN0cik7CiAgICByZXR1cm4gaGFzLmNhbGwodGhpcy5fc2V0LCBzU3RyKTsKICB9Cn07CgovKioKICogV2hhdCBpcyB0aGUgaW5kZXggb2YgdGhlIGdpdmVuIHN0cmluZyBpbiB0aGUgYXJyYXk/CiAqCiAqIEBwYXJhbSBTdHJpbmcgYVN0cgogKi8KQXJyYXlTZXQkMS5wcm90b3R5cGUuaW5kZXhPZiA9IGZ1bmN0aW9uIEFycmF5U2V0X2luZGV4T2YoYVN0cikgewogIGlmIChoYXNOYXRpdmVNYXApIHsKICAgIHZhciBpZHggPSB0aGlzLl9zZXQuZ2V0KGFTdHIpOwogICAgaWYgKGlkeCA+PSAwKSB7CiAgICAgICAgcmV0dXJuIGlkeDsKICAgIH0KICB9IGVsc2UgewogICAgdmFyIHNTdHIgPSB1dGlsJDIudG9TZXRTdHJpbmcoYVN0cik7CiAgICBpZiAoaGFzLmNhbGwodGhpcy5fc2V0LCBzU3RyKSkgewogICAgICByZXR1cm4gdGhpcy5fc2V0W3NTdHJdOwogICAgfQogIH0KCiAgdGhyb3cgbmV3IEVycm9yKCciJyArIGFTdHIgKyAnIiBpcyBub3QgaW4gdGhlIHNldC4nKTsKfTsKCi8qKgogKiBXaGF0IGlzIHRoZSBlbGVtZW50IGF0IHRoZSBnaXZlbiBpbmRleD8KICoKICogQHBhcmFtIE51bWJlciBhSWR4CiAqLwpBcnJheVNldCQxLnByb3RvdHlwZS5hdCA9IGZ1bmN0aW9uIEFycmF5U2V0X2F0KGFJZHgpIHsKICBpZiAoYUlkeCA+PSAwICYmIGFJZHggPCB0aGlzLl9hcnJheS5sZW5ndGgpIHsKICAgIHJldHVybiB0aGlzLl9hcnJheVthSWR4XTsKICB9CiAgdGhyb3cgbmV3IEVycm9yKCdObyBlbGVtZW50IGluZGV4ZWQgYnkgJyArIGFJZHgpOwp9OwoKLyoqCiAqIFJldHVybnMgdGhlIGFycmF5IHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgc2V0ICh3aGljaCBoYXMgdGhlIHByb3BlciBpbmRpY2VzCiAqIGluZGljYXRlZCBieSBpbmRleE9mKS4gTm90ZSB0aGF0IHRoaXMgaXMgYSBjb3B5IG9mIHRoZSBpbnRlcm5hbCBhcnJheSB1c2VkCiAqIGZvciBzdG9yaW5nIHRoZSBtZW1iZXJzIHNvIHRoYXQgbm8gb25lIGNhbiBtZXNzIHdpdGggaW50ZXJuYWwgc3RhdGUuCiAqLwpBcnJheVNldCQxLnByb3RvdHlwZS50b0FycmF5ID0gZnVuY3Rpb24gQXJyYXlTZXRfdG9BcnJheSgpIHsKICByZXR1cm4gdGhpcy5fYXJyYXkuc2xpY2UoKTsKfTsKCmFycmF5U2V0LkFycmF5U2V0ID0gQXJyYXlTZXQkMTsKCnZhciBtYXBwaW5nTGlzdCA9IHt9OwoKLyogLSotIE1vZGU6IGpzOyBqcy1pbmRlbnQtbGV2ZWw6IDI7IC0qLSAqLwoKLyoKICogQ29weXJpZ2h0IDIwMTQgTW96aWxsYSBGb3VuZGF0aW9uIGFuZCBjb250cmlidXRvcnMKICogTGljZW5zZWQgdW5kZXIgdGhlIE5ldyBCU0QgbGljZW5zZS4gU2VlIExJQ0VOU0Ugb3I6CiAqIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9CU0QtMy1DbGF1c2UKICovCgp2YXIgdXRpbCQxID0gdXRpbCQzOwoKLyoqCiAqIERldGVybWluZSB3aGV0aGVyIG1hcHBpbmdCIGlzIGFmdGVyIG1hcHBpbmdBIHdpdGggcmVzcGVjdCB0byBnZW5lcmF0ZWQKICogcG9zaXRpb24uCiAqLwpmdW5jdGlvbiBnZW5lcmF0ZWRQb3NpdGlvbkFmdGVyKG1hcHBpbmdBLCBtYXBwaW5nQikgewogIC8vIE9wdGltaXplZCBmb3IgbW9zdCBjb21tb24gY2FzZQogIHZhciBsaW5lQSA9IG1hcHBpbmdBLmdlbmVyYXRlZExpbmU7CiAgdmFyIGxpbmVCID0gbWFwcGluZ0IuZ2VuZXJhdGVkTGluZTsKICB2YXIgY29sdW1uQSA9IG1hcHBpbmdBLmdlbmVyYXRlZENvbHVtbjsKICB2YXIgY29sdW1uQiA9IG1hcHBpbmdCLmdlbmVyYXRlZENvbHVtbjsKICByZXR1cm4gbGluZUIgPiBsaW5lQSB8fCBsaW5lQiA9PSBsaW5lQSAmJiBjb2x1bW5CID49IGNvbHVtbkEgfHwKICAgICAgICAgdXRpbCQxLmNvbXBhcmVCeUdlbmVyYXRlZFBvc2l0aW9uc0luZmxhdGVkKG1hcHBpbmdBLCBtYXBwaW5nQikgPD0gMDsKfQoKLyoqCiAqIEEgZGF0YSBzdHJ1Y3R1cmUgdG8gcHJvdmlkZSBhIHNvcnRlZCB2aWV3IG9mIGFjY3VtdWxhdGVkIG1hcHBpbmdzIGluIGEKICogcGVyZm9ybWFuY2UgY29uc2Npb3VzIG1hbm5lci4gSXQgdHJhZGVzIGEgbmVnbGliYWJsZSBvdmVyaGVhZCBpbiBnZW5lcmFsCiAqIGNhc2UgZm9yIGEgbGFyZ2Ugc3BlZWR1cCBpbiBjYXNlIG9mIG1hcHBpbmdzIGJlaW5nIGFkZGVkIGluIG9yZGVyLgogKi8KZnVuY3Rpb24gTWFwcGluZ0xpc3QkMSgpIHsKICB0aGlzLl9hcnJheSA9IFtdOwogIHRoaXMuX3NvcnRlZCA9IHRydWU7CiAgLy8gU2VydmVzIGFzIGluZmltdW0KICB0aGlzLl9sYXN0ID0ge2dlbmVyYXRlZExpbmU6IC0xLCBnZW5lcmF0ZWRDb2x1bW46IDB9Owp9CgovKioKICogSXRlcmF0ZSB0aHJvdWdoIGludGVybmFsIGl0ZW1zLiBUaGlzIG1ldGhvZCB0YWtlcyB0aGUgc2FtZSBhcmd1bWVudHMgdGhhdAogKiBgQXJyYXkucHJvdG90eXBlLmZvckVhY2hgIHRha2VzLgogKgogKiBOT1RFOiBUaGUgb3JkZXIgb2YgdGhlIG1hcHBpbmdzIGlzIE5PVCBndWFyYW50ZWVkLgogKi8KTWFwcGluZ0xpc3QkMS5wcm90b3R5cGUudW5zb3J0ZWRGb3JFYWNoID0KICBmdW5jdGlvbiBNYXBwaW5nTGlzdF9mb3JFYWNoKGFDYWxsYmFjaywgYVRoaXNBcmcpIHsKICAgIHRoaXMuX2FycmF5LmZvckVhY2goYUNhbGxiYWNrLCBhVGhpc0FyZyk7CiAgfTsKCi8qKgogKiBBZGQgdGhlIGdpdmVuIHNvdXJjZSBtYXBwaW5nLgogKgogKiBAcGFyYW0gT2JqZWN0IGFNYXBwaW5nCiAqLwpNYXBwaW5nTGlzdCQxLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiBNYXBwaW5nTGlzdF9hZGQoYU1hcHBpbmcpIHsKICBpZiAoZ2VuZXJhdGVkUG9zaXRpb25BZnRlcih0aGlzLl9sYXN0LCBhTWFwcGluZykpIHsKICAgIHRoaXMuX2xhc3QgPSBhTWFwcGluZzsKICAgIHRoaXMuX2FycmF5LnB1c2goYU1hcHBpbmcpOwogIH0gZWxzZSB7CiAgICB0aGlzLl9zb3J0ZWQgPSBmYWxzZTsKICAgIHRoaXMuX2FycmF5LnB1c2goYU1hcHBpbmcpOwogIH0KfTsKCi8qKgogKiBSZXR1cm5zIHRoZSBmbGF0LCBzb3J0ZWQgYXJyYXkgb2YgbWFwcGluZ3MuIFRoZSBtYXBwaW5ncyBhcmUgc29ydGVkIGJ5CiAqIGdlbmVyYXRlZCBwb3NpdGlvbi4KICoKICogV0FSTklORzogVGhpcyBtZXRob2QgcmV0dXJucyBpbnRlcm5hbCBkYXRhIHdpdGhvdXQgY29weWluZywgZm9yCiAqIHBlcmZvcm1hbmNlLiBUaGUgcmV0dXJuIHZhbHVlIG11c3QgTk9UIGJlIG11dGF0ZWQsIGFuZCBzaG91bGQgYmUgdHJlYXRlZCBhcwogKiBhbiBpbW11dGFibGUgYm9ycm93LiBJZiB5b3Ugd2FudCB0byB0YWtlIG93bmVyc2hpcCwgeW91IG11c3QgbWFrZSB5b3VyIG93bgogKiBjb3B5LgogKi8KTWFwcGluZ0xpc3QkMS5wcm90b3R5cGUudG9BcnJheSA9IGZ1bmN0aW9uIE1hcHBpbmdMaXN0X3RvQXJyYXkoKSB7CiAgaWYgKCF0aGlzLl9zb3J0ZWQpIHsKICAgIHRoaXMuX2FycmF5LnNvcnQodXRpbCQxLmNvbXBhcmVCeUdlbmVyYXRlZFBvc2l0aW9uc0luZmxhdGVkKTsKICAgIHRoaXMuX3NvcnRlZCA9IHRydWU7CiAgfQogIHJldHVybiB0aGlzLl9hcnJheTsKfTsKCm1hcHBpbmdMaXN0Lk1hcHBpbmdMaXN0ID0gTWFwcGluZ0xpc3QkMTsKCi8qIC0qLSBNb2RlOiBqczsganMtaW5kZW50LWxldmVsOiAyOyAtKi0gKi8KCi8qCiAqIENvcHlyaWdodCAyMDExIE1vemlsbGEgRm91bmRhdGlvbiBhbmQgY29udHJpYnV0b3JzCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBOZXcgQlNEIGxpY2Vuc2UuIFNlZSBMSUNFTlNFIG9yOgogKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvQlNELTMtQ2xhdXNlCiAqLwoKdmFyIGJhc2U2NFZMUSA9IGJhc2U2NFZscTsKdmFyIHV0aWwgPSB1dGlsJDM7CnZhciBBcnJheVNldCA9IGFycmF5U2V0LkFycmF5U2V0Owp2YXIgTWFwcGluZ0xpc3QgPSBtYXBwaW5nTGlzdC5NYXBwaW5nTGlzdDsKCi8qKgogKiBBbiBpbnN0YW5jZSBvZiB0aGUgU291cmNlTWFwR2VuZXJhdG9yIHJlcHJlc2VudHMgYSBzb3VyY2UgbWFwIHdoaWNoIGlzCiAqIGJlaW5nIGJ1aWx0IGluY3JlbWVudGFsbHkuIFlvdSBtYXkgcGFzcyBhbiBvYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nCiAqIHByb3BlcnRpZXM6CiAqCiAqICAgLSBmaWxlOiBUaGUgZmlsZW5hbWUgb2YgdGhlIGdlbmVyYXRlZCBzb3VyY2UuCiAqICAgLSBzb3VyY2VSb290OiBBIHJvb3QgZm9yIGFsbCByZWxhdGl2ZSBVUkxzIGluIHRoaXMgc291cmNlIG1hcC4KICovCmZ1bmN0aW9uIFNvdXJjZU1hcEdlbmVyYXRvcihhQXJncykgewogIGlmICghYUFyZ3MpIHsKICAgIGFBcmdzID0ge307CiAgfQogIHRoaXMuX2ZpbGUgPSB1dGlsLmdldEFyZyhhQXJncywgJ2ZpbGUnLCBudWxsKTsKICB0aGlzLl9zb3VyY2VSb290ID0gdXRpbC5nZXRBcmcoYUFyZ3MsICdzb3VyY2VSb290JywgbnVsbCk7CiAgdGhpcy5fc2tpcFZhbGlkYXRpb24gPSB1dGlsLmdldEFyZyhhQXJncywgJ3NraXBWYWxpZGF0aW9uJywgZmFsc2UpOwogIHRoaXMuX3NvdXJjZXMgPSBuZXcgQXJyYXlTZXQoKTsKICB0aGlzLl9uYW1lcyA9IG5ldyBBcnJheVNldCgpOwogIHRoaXMuX21hcHBpbmdzID0gbmV3IE1hcHBpbmdMaXN0KCk7CiAgdGhpcy5fc291cmNlc0NvbnRlbnRzID0gbnVsbDsKfQoKU291cmNlTWFwR2VuZXJhdG9yLnByb3RvdHlwZS5fdmVyc2lvbiA9IDM7CgovKioKICogQ3JlYXRlcyBhIG5ldyBTb3VyY2VNYXBHZW5lcmF0b3IgYmFzZWQgb24gYSBTb3VyY2VNYXBDb25zdW1lcgogKgogKiBAcGFyYW0gYVNvdXJjZU1hcENvbnN1bWVyIFRoZSBTb3VyY2VNYXAuCiAqLwpTb3VyY2VNYXBHZW5lcmF0b3IuZnJvbVNvdXJjZU1hcCA9CiAgZnVuY3Rpb24gU291cmNlTWFwR2VuZXJhdG9yX2Zyb21Tb3VyY2VNYXAoYVNvdXJjZU1hcENvbnN1bWVyKSB7CiAgICB2YXIgc291cmNlUm9vdCA9IGFTb3VyY2VNYXBDb25zdW1lci5zb3VyY2VSb290OwogICAgdmFyIGdlbmVyYXRvciA9IG5ldyBTb3VyY2VNYXBHZW5lcmF0b3IoewogICAgICBmaWxlOiBhU291cmNlTWFwQ29uc3VtZXIuZmlsZSwKICAgICAgc291cmNlUm9vdDogc291cmNlUm9vdAogICAgfSk7CiAgICBhU291cmNlTWFwQ29uc3VtZXIuZWFjaE1hcHBpbmcoZnVuY3Rpb24gKG1hcHBpbmcpIHsKICAgICAgdmFyIG5ld01hcHBpbmcgPSB7CiAgICAgICAgZ2VuZXJhdGVkOiB7CiAgICAgICAgICBsaW5lOiBtYXBwaW5nLmdlbmVyYXRlZExpbmUsCiAgICAgICAgICBjb2x1bW46IG1hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uCiAgICAgICAgfQogICAgICB9OwoKICAgICAgaWYgKG1hcHBpbmcuc291cmNlICE9IG51bGwpIHsKICAgICAgICBuZXdNYXBwaW5nLnNvdXJjZSA9IG1hcHBpbmcuc291cmNlOwogICAgICAgIGlmIChzb3VyY2VSb290ICE9IG51bGwpIHsKICAgICAgICAgIG5ld01hcHBpbmcuc291cmNlID0gdXRpbC5yZWxhdGl2ZShzb3VyY2VSb290LCBuZXdNYXBwaW5nLnNvdXJjZSk7CiAgICAgICAgfQoKICAgICAgICBuZXdNYXBwaW5nLm9yaWdpbmFsID0gewogICAgICAgICAgbGluZTogbWFwcGluZy5vcmlnaW5hbExpbmUsCiAgICAgICAgICBjb2x1bW46IG1hcHBpbmcub3JpZ2luYWxDb2x1bW4KICAgICAgICB9OwoKICAgICAgICBpZiAobWFwcGluZy5uYW1lICE9IG51bGwpIHsKICAgICAgICAgIG5ld01hcHBpbmcubmFtZSA9IG1hcHBpbmcubmFtZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGdlbmVyYXRvci5hZGRNYXBwaW5nKG5ld01hcHBpbmcpOwogICAgfSk7CiAgICBhU291cmNlTWFwQ29uc3VtZXIuc291cmNlcy5mb3JFYWNoKGZ1bmN0aW9uIChzb3VyY2VGaWxlKSB7CiAgICAgIHZhciBzb3VyY2VSZWxhdGl2ZSA9IHNvdXJjZUZpbGU7CiAgICAgIGlmIChzb3VyY2VSb290ICE9PSBudWxsKSB7CiAgICAgICAgc291cmNlUmVsYXRpdmUgPSB1dGlsLnJlbGF0aXZlKHNvdXJjZVJvb3QsIHNvdXJjZUZpbGUpOwogICAgICB9CgogICAgICBpZiAoIWdlbmVyYXRvci5fc291cmNlcy5oYXMoc291cmNlUmVsYXRpdmUpKSB7CiAgICAgICAgZ2VuZXJhdG9yLl9zb3VyY2VzLmFkZChzb3VyY2VSZWxhdGl2ZSk7CiAgICAgIH0KCiAgICAgIHZhciBjb250ZW50ID0gYVNvdXJjZU1hcENvbnN1bWVyLnNvdXJjZUNvbnRlbnRGb3Ioc291cmNlRmlsZSk7CiAgICAgIGlmIChjb250ZW50ICE9IG51bGwpIHsKICAgICAgICBnZW5lcmF0b3Iuc2V0U291cmNlQ29udGVudChzb3VyY2VGaWxlLCBjb250ZW50KTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gZ2VuZXJhdG9yOwogIH07CgovKioKICogQWRkIGEgc2luZ2xlIG1hcHBpbmcgZnJvbSBvcmlnaW5hbCBzb3VyY2UgbGluZSBhbmQgY29sdW1uIHRvIHRoZSBnZW5lcmF0ZWQKICogc291cmNlJ3MgbGluZSBhbmQgY29sdW1uIGZvciB0aGlzIHNvdXJjZSBtYXAgYmVpbmcgY3JlYXRlZC4gVGhlIG1hcHBpbmcKICogb2JqZWN0IHNob3VsZCBoYXZlIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczoKICoKICogICAtIGdlbmVyYXRlZDogQW4gb2JqZWN0IHdpdGggdGhlIGdlbmVyYXRlZCBsaW5lIGFuZCBjb2x1bW4gcG9zaXRpb25zLgogKiAgIC0gb3JpZ2luYWw6IEFuIG9iamVjdCB3aXRoIHRoZSBvcmlnaW5hbCBsaW5lIGFuZCBjb2x1bW4gcG9zaXRpb25zLgogKiAgIC0gc291cmNlOiBUaGUgb3JpZ2luYWwgc291cmNlIGZpbGUgKHJlbGF0aXZlIHRvIHRoZSBzb3VyY2VSb290KS4KICogICAtIG5hbWU6IEFuIG9wdGlvbmFsIG9yaWdpbmFsIHRva2VuIG5hbWUgZm9yIHRoaXMgbWFwcGluZy4KICovClNvdXJjZU1hcEdlbmVyYXRvci5wcm90b3R5cGUuYWRkTWFwcGluZyA9CiAgZnVuY3Rpb24gU291cmNlTWFwR2VuZXJhdG9yX2FkZE1hcHBpbmcoYUFyZ3MpIHsKICAgIHZhciBnZW5lcmF0ZWQgPSB1dGlsLmdldEFyZyhhQXJncywgJ2dlbmVyYXRlZCcpOwogICAgdmFyIG9yaWdpbmFsID0gdXRpbC5nZXRBcmcoYUFyZ3MsICdvcmlnaW5hbCcsIG51bGwpOwogICAgdmFyIHNvdXJjZSA9IHV0aWwuZ2V0QXJnKGFBcmdzLCAnc291cmNlJywgbnVsbCk7CiAgICB2YXIgbmFtZSA9IHV0aWwuZ2V0QXJnKGFBcmdzLCAnbmFtZScsIG51bGwpOwoKICAgIGlmICghdGhpcy5fc2tpcFZhbGlkYXRpb24pIHsKICAgICAgdGhpcy5fdmFsaWRhdGVNYXBwaW5nKGdlbmVyYXRlZCwgb3JpZ2luYWwsIHNvdXJjZSwgbmFtZSk7CiAgICB9CgogICAgaWYgKHNvdXJjZSAhPSBudWxsKSB7CiAgICAgIHNvdXJjZSA9IFN0cmluZyhzb3VyY2UpOwogICAgICBpZiAoIXRoaXMuX3NvdXJjZXMuaGFzKHNvdXJjZSkpIHsKICAgICAgICB0aGlzLl9zb3VyY2VzLmFkZChzb3VyY2UpOwogICAgICB9CiAgICB9CgogICAgaWYgKG5hbWUgIT0gbnVsbCkgewogICAgICBuYW1lID0gU3RyaW5nKG5hbWUpOwogICAgICBpZiAoIXRoaXMuX25hbWVzLmhhcyhuYW1lKSkgewogICAgICAgIHRoaXMuX25hbWVzLmFkZChuYW1lKTsKICAgICAgfQogICAgfQoKICAgIHRoaXMuX21hcHBpbmdzLmFkZCh7CiAgICAgIGdlbmVyYXRlZExpbmU6IGdlbmVyYXRlZC5saW5lLAogICAgICBnZW5lcmF0ZWRDb2x1bW46IGdlbmVyYXRlZC5jb2x1bW4sCiAgICAgIG9yaWdpbmFsTGluZTogb3JpZ2luYWwgIT0gbnVsbCAmJiBvcmlnaW5hbC5saW5lLAogICAgICBvcmlnaW5hbENvbHVtbjogb3JpZ2luYWwgIT0gbnVsbCAmJiBvcmlnaW5hbC5jb2x1bW4sCiAgICAgIHNvdXJjZTogc291cmNlLAogICAgICBuYW1lOiBuYW1lCiAgICB9KTsKICB9OwoKLyoqCiAqIFNldCB0aGUgc291cmNlIGNvbnRlbnQgZm9yIGEgc291cmNlIGZpbGUuCiAqLwpTb3VyY2VNYXBHZW5lcmF0b3IucHJvdG90eXBlLnNldFNvdXJjZUNvbnRlbnQgPQogIGZ1bmN0aW9uIFNvdXJjZU1hcEdlbmVyYXRvcl9zZXRTb3VyY2VDb250ZW50KGFTb3VyY2VGaWxlLCBhU291cmNlQ29udGVudCkgewogICAgdmFyIHNvdXJjZSA9IGFTb3VyY2VGaWxlOwogICAgaWYgKHRoaXMuX3NvdXJjZVJvb3QgIT0gbnVsbCkgewogICAgICBzb3VyY2UgPSB1dGlsLnJlbGF0aXZlKHRoaXMuX3NvdXJjZVJvb3QsIHNvdXJjZSk7CiAgICB9CgogICAgaWYgKGFTb3VyY2VDb250ZW50ICE9IG51bGwpIHsKICAgICAgLy8gQWRkIHRoZSBzb3VyY2UgY29udGVudCB0byB0aGUgX3NvdXJjZXNDb250ZW50cyBtYXAuCiAgICAgIC8vIENyZWF0ZSBhIG5ldyBfc291cmNlc0NvbnRlbnRzIG1hcCBpZiB0aGUgcHJvcGVydHkgaXMgbnVsbC4KICAgICAgaWYgKCF0aGlzLl9zb3VyY2VzQ29udGVudHMpIHsKICAgICAgICB0aGlzLl9zb3VyY2VzQ29udGVudHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICB9CiAgICAgIHRoaXMuX3NvdXJjZXNDb250ZW50c1t1dGlsLnRvU2V0U3RyaW5nKHNvdXJjZSldID0gYVNvdXJjZUNvbnRlbnQ7CiAgICB9IGVsc2UgaWYgKHRoaXMuX3NvdXJjZXNDb250ZW50cykgewogICAgICAvLyBSZW1vdmUgdGhlIHNvdXJjZSBmaWxlIGZyb20gdGhlIF9zb3VyY2VzQ29udGVudHMgbWFwLgogICAgICAvLyBJZiB0aGUgX3NvdXJjZXNDb250ZW50cyBtYXAgaXMgZW1wdHksIHNldCB0aGUgcHJvcGVydHkgdG8gbnVsbC4KICAgICAgZGVsZXRlIHRoaXMuX3NvdXJjZXNDb250ZW50c1t1dGlsLnRvU2V0U3RyaW5nKHNvdXJjZSldOwogICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5fc291cmNlc0NvbnRlbnRzKS5sZW5ndGggPT09IDApIHsKICAgICAgICB0aGlzLl9zb3VyY2VzQ29udGVudHMgPSBudWxsOwogICAgICB9CiAgICB9CiAgfTsKCi8qKgogKiBBcHBsaWVzIHRoZSBtYXBwaW5ncyBvZiBhIHN1Yi1zb3VyY2UtbWFwIGZvciBhIHNwZWNpZmljIHNvdXJjZSBmaWxlIHRvIHRoZQogKiBzb3VyY2UgbWFwIGJlaW5nIGdlbmVyYXRlZC4gRWFjaCBtYXBwaW5nIHRvIHRoZSBzdXBwbGllZCBzb3VyY2UgZmlsZSBpcwogKiByZXdyaXR0ZW4gdXNpbmcgdGhlIHN1cHBsaWVkIHNvdXJjZSBtYXAuIE5vdGU6IFRoZSByZXNvbHV0aW9uIGZvciB0aGUKICogcmVzdWx0aW5nIG1hcHBpbmdzIGlzIHRoZSBtaW5pbWl1bSBvZiB0aGlzIG1hcCBhbmQgdGhlIHN1cHBsaWVkIG1hcC4KICoKICogQHBhcmFtIGFTb3VyY2VNYXBDb25zdW1lciBUaGUgc291cmNlIG1hcCB0byBiZSBhcHBsaWVkLgogKiBAcGFyYW0gYVNvdXJjZUZpbGUgT3B0aW9uYWwuIFRoZSBmaWxlbmFtZSBvZiB0aGUgc291cmNlIGZpbGUuCiAqICAgICAgICBJZiBvbWl0dGVkLCBTb3VyY2VNYXBDb25zdW1lcidzIGZpbGUgcHJvcGVydHkgd2lsbCBiZSB1c2VkLgogKiBAcGFyYW0gYVNvdXJjZU1hcFBhdGggT3B0aW9uYWwuIFRoZSBkaXJuYW1lIG9mIHRoZSBwYXRoIHRvIHRoZSBzb3VyY2UgbWFwCiAqICAgICAgICB0byBiZSBhcHBsaWVkLiBJZiByZWxhdGl2ZSwgaXQgaXMgcmVsYXRpdmUgdG8gdGhlIFNvdXJjZU1hcENvbnN1bWVyLgogKiAgICAgICAgVGhpcyBwYXJhbWV0ZXIgaXMgbmVlZGVkIHdoZW4gdGhlIHR3byBzb3VyY2UgbWFwcyBhcmVuJ3QgaW4gdGhlIHNhbWUKICogICAgICAgIGRpcmVjdG9yeSwgYW5kIHRoZSBzb3VyY2UgbWFwIHRvIGJlIGFwcGxpZWQgY29udGFpbnMgcmVsYXRpdmUgc291cmNlCiAqICAgICAgICBwYXRocy4gSWYgc28sIHRob3NlIHJlbGF0aXZlIHNvdXJjZSBwYXRocyBuZWVkIHRvIGJlIHJld3JpdHRlbgogKiAgICAgICAgcmVsYXRpdmUgdG8gdGhlIFNvdXJjZU1hcEdlbmVyYXRvci4KICovClNvdXJjZU1hcEdlbmVyYXRvci5wcm90b3R5cGUuYXBwbHlTb3VyY2VNYXAgPQogIGZ1bmN0aW9uIFNvdXJjZU1hcEdlbmVyYXRvcl9hcHBseVNvdXJjZU1hcChhU291cmNlTWFwQ29uc3VtZXIsIGFTb3VyY2VGaWxlLCBhU291cmNlTWFwUGF0aCkgewogICAgdmFyIHNvdXJjZUZpbGUgPSBhU291cmNlRmlsZTsKICAgIC8vIElmIGFTb3VyY2VGaWxlIGlzIG9taXR0ZWQsIHdlIHdpbGwgdXNlIHRoZSBmaWxlIHByb3BlcnR5IG9mIHRoZSBTb3VyY2VNYXAKICAgIGlmIChhU291cmNlRmlsZSA9PSBudWxsKSB7CiAgICAgIGlmIChhU291cmNlTWFwQ29uc3VtZXIuZmlsZSA9PSBudWxsKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgICAgJ1NvdXJjZU1hcEdlbmVyYXRvci5wcm90b3R5cGUuYXBwbHlTb3VyY2VNYXAgcmVxdWlyZXMgZWl0aGVyIGFuIGV4cGxpY2l0IHNvdXJjZSBmaWxlLCAnICsKICAgICAgICAgICdvciB0aGUgc291cmNlIG1hcFwncyAiZmlsZSIgcHJvcGVydHkuIEJvdGggd2VyZSBvbWl0dGVkLicKICAgICAgICApOwogICAgICB9CiAgICAgIHNvdXJjZUZpbGUgPSBhU291cmNlTWFwQ29uc3VtZXIuZmlsZTsKICAgIH0KICAgIHZhciBzb3VyY2VSb290ID0gdGhpcy5fc291cmNlUm9vdDsKICAgIC8vIE1ha2UgInNvdXJjZUZpbGUiIHJlbGF0aXZlIGlmIGFuIGFic29sdXRlIFVybCBpcyBwYXNzZWQuCiAgICBpZiAoc291cmNlUm9vdCAhPSBudWxsKSB7CiAgICAgIHNvdXJjZUZpbGUgPSB1dGlsLnJlbGF0aXZlKHNvdXJjZVJvb3QsIHNvdXJjZUZpbGUpOwogICAgfQogICAgLy8gQXBwbHlpbmcgdGhlIFNvdXJjZU1hcCBjYW4gYWRkIGFuZCByZW1vdmUgaXRlbXMgZnJvbSB0aGUgc291cmNlcyBhbmQKICAgIC8vIHRoZSBuYW1lcyBhcnJheS4KICAgIHZhciBuZXdTb3VyY2VzID0gbmV3IEFycmF5U2V0KCk7CiAgICB2YXIgbmV3TmFtZXMgPSBuZXcgQXJyYXlTZXQoKTsKCiAgICAvLyBGaW5kIG1hcHBpbmdzIGZvciB0aGUgInNvdXJjZUZpbGUiCiAgICB0aGlzLl9tYXBwaW5ncy51bnNvcnRlZEZvckVhY2goZnVuY3Rpb24gKG1hcHBpbmcpIHsKICAgICAgaWYgKG1hcHBpbmcuc291cmNlID09PSBzb3VyY2VGaWxlICYmIG1hcHBpbmcub3JpZ2luYWxMaW5lICE9IG51bGwpIHsKICAgICAgICAvLyBDaGVjayBpZiBpdCBjYW4gYmUgbWFwcGVkIGJ5IHRoZSBzb3VyY2UgbWFwLCB0aGVuIHVwZGF0ZSB0aGUgbWFwcGluZy4KICAgICAgICB2YXIgb3JpZ2luYWwgPSBhU291cmNlTWFwQ29uc3VtZXIub3JpZ2luYWxQb3NpdGlvbkZvcih7CiAgICAgICAgICBsaW5lOiBtYXBwaW5nLm9yaWdpbmFsTGluZSwKICAgICAgICAgIGNvbHVtbjogbWFwcGluZy5vcmlnaW5hbENvbHVtbgogICAgICAgIH0pOwogICAgICAgIGlmIChvcmlnaW5hbC5zb3VyY2UgIT0gbnVsbCkgewogICAgICAgICAgLy8gQ29weSBtYXBwaW5nCiAgICAgICAgICBtYXBwaW5nLnNvdXJjZSA9IG9yaWdpbmFsLnNvdXJjZTsKICAgICAgICAgIGlmIChhU291cmNlTWFwUGF0aCAhPSBudWxsKSB7CiAgICAgICAgICAgIG1hcHBpbmcuc291cmNlID0gdXRpbC5qb2luKGFTb3VyY2VNYXBQYXRoLCBtYXBwaW5nLnNvdXJjZSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc291cmNlUm9vdCAhPSBudWxsKSB7CiAgICAgICAgICAgIG1hcHBpbmcuc291cmNlID0gdXRpbC5yZWxhdGl2ZShzb3VyY2VSb290LCBtYXBwaW5nLnNvdXJjZSk7CiAgICAgICAgICB9CiAgICAgICAgICBtYXBwaW5nLm9yaWdpbmFsTGluZSA9IG9yaWdpbmFsLmxpbmU7CiAgICAgICAgICBtYXBwaW5nLm9yaWdpbmFsQ29sdW1uID0gb3JpZ2luYWwuY29sdW1uOwogICAgICAgICAgaWYgKG9yaWdpbmFsLm5hbWUgIT0gbnVsbCkgewogICAgICAgICAgICBtYXBwaW5nLm5hbWUgPSBvcmlnaW5hbC5uYW1lOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIHNvdXJjZSA9IG1hcHBpbmcuc291cmNlOwogICAgICBpZiAoc291cmNlICE9IG51bGwgJiYgIW5ld1NvdXJjZXMuaGFzKHNvdXJjZSkpIHsKICAgICAgICBuZXdTb3VyY2VzLmFkZChzb3VyY2UpOwogICAgICB9CgogICAgICB2YXIgbmFtZSA9IG1hcHBpbmcubmFtZTsKICAgICAgaWYgKG5hbWUgIT0gbnVsbCAmJiAhbmV3TmFtZXMuaGFzKG5hbWUpKSB7CiAgICAgICAgbmV3TmFtZXMuYWRkKG5hbWUpOwogICAgICB9CgogICAgfSwgdGhpcyk7CiAgICB0aGlzLl9zb3VyY2VzID0gbmV3U291cmNlczsKICAgIHRoaXMuX25hbWVzID0gbmV3TmFtZXM7CgogICAgLy8gQ29weSBzb3VyY2VzQ29udGVudHMgb2YgYXBwbGllZCBtYXAuCiAgICBhU291cmNlTWFwQ29uc3VtZXIuc291cmNlcy5mb3JFYWNoKGZ1bmN0aW9uIChzb3VyY2VGaWxlKSB7CiAgICAgIHZhciBjb250ZW50ID0gYVNvdXJjZU1hcENvbnN1bWVyLnNvdXJjZUNvbnRlbnRGb3Ioc291cmNlRmlsZSk7CiAgICAgIGlmIChjb250ZW50ICE9IG51bGwpIHsKICAgICAgICBpZiAoYVNvdXJjZU1hcFBhdGggIT0gbnVsbCkgewogICAgICAgICAgc291cmNlRmlsZSA9IHV0aWwuam9pbihhU291cmNlTWFwUGF0aCwgc291cmNlRmlsZSk7CiAgICAgICAgfQogICAgICAgIGlmIChzb3VyY2VSb290ICE9IG51bGwpIHsKICAgICAgICAgIHNvdXJjZUZpbGUgPSB1dGlsLnJlbGF0aXZlKHNvdXJjZVJvb3QsIHNvdXJjZUZpbGUpOwogICAgICAgIH0KICAgICAgICB0aGlzLnNldFNvdXJjZUNvbnRlbnQoc291cmNlRmlsZSwgY29udGVudCk7CiAgICAgIH0KICAgIH0sIHRoaXMpOwogIH07CgovKioKICogQSBtYXBwaW5nIGNhbiBoYXZlIG9uZSBvZiB0aGUgdGhyZWUgbGV2ZWxzIG9mIGRhdGE6CiAqCiAqICAgMS4gSnVzdCB0aGUgZ2VuZXJhdGVkIHBvc2l0aW9uLgogKiAgIDIuIFRoZSBHZW5lcmF0ZWQgcG9zaXRpb24sIG9yaWdpbmFsIHBvc2l0aW9uLCBhbmQgb3JpZ2luYWwgc291cmNlLgogKiAgIDMuIEdlbmVyYXRlZCBhbmQgb3JpZ2luYWwgcG9zaXRpb24sIG9yaWdpbmFsIHNvdXJjZSwgYXMgd2VsbCBhcyBhIG5hbWUKICogICAgICB0b2tlbi4KICoKICogVG8gbWFpbnRhaW4gY29uc2lzdGVuY3ksIHdlIHZhbGlkYXRlIHRoYXQgYW55IG5ldyBtYXBwaW5nIGJlaW5nIGFkZGVkIGZhbGxzCiAqIGluIHRvIG9uZSBvZiB0aGVzZSBjYXRlZ29yaWVzLgogKi8KU291cmNlTWFwR2VuZXJhdG9yLnByb3RvdHlwZS5fdmFsaWRhdGVNYXBwaW5nID0KICBmdW5jdGlvbiBTb3VyY2VNYXBHZW5lcmF0b3JfdmFsaWRhdGVNYXBwaW5nKGFHZW5lcmF0ZWQsIGFPcmlnaW5hbCwgYVNvdXJjZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFOYW1lKSB7CiAgICAvLyBXaGVuIGFPcmlnaW5hbCBpcyB0cnV0aHkgYnV0IGhhcyBlbXB0eSB2YWx1ZXMgZm9yIC5saW5lIGFuZCAuY29sdW1uLAogICAgLy8gaXQgaXMgbW9zdCBsaWtlbHkgYSBwcm9ncmFtbWVyIGVycm9yLiBJbiB0aGlzIGNhc2Ugd2UgdGhyb3cgYSB2ZXJ5CiAgICAvLyBzcGVjaWZpYyBlcnJvciBtZXNzYWdlIHRvIHRyeSB0byBndWlkZSB0aGVtIHRoZSByaWdodCB3YXkuCiAgICAvLyBGb3IgZXhhbXBsZTogaHR0cHM6Ly9naXRodWIuY29tL1BvbHltZXIvcG9seW1lci1idW5kbGVyL3B1bGwvNTE5CiAgICBpZiAoYU9yaWdpbmFsICYmIHR5cGVvZiBhT3JpZ2luYWwubGluZSAhPT0gJ251bWJlcicgJiYgdHlwZW9mIGFPcmlnaW5hbC5jb2x1bW4gIT09ICdudW1iZXInKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgICAgICAnb3JpZ2luYWwubGluZSBhbmQgb3JpZ2luYWwuY29sdW1uIGFyZSBub3QgbnVtYmVycyAtLSB5b3UgcHJvYmFibHkgbWVhbnQgdG8gb21pdCAnICsKICAgICAgICAgICAgJ3RoZSBvcmlnaW5hbCBtYXBwaW5nIGVudGlyZWx5IGFuZCBvbmx5IG1hcCB0aGUgZ2VuZXJhdGVkIHBvc2l0aW9uLiBJZiBzbywgcGFzcyAnICsKICAgICAgICAgICAgJ251bGwgZm9yIHRoZSBvcmlnaW5hbCBtYXBwaW5nIGluc3RlYWQgb2YgYW4gb2JqZWN0IHdpdGggZW1wdHkgb3IgbnVsbCB2YWx1ZXMuJwogICAgICAgICk7CiAgICB9CgogICAgaWYgKGFHZW5lcmF0ZWQgJiYgJ2xpbmUnIGluIGFHZW5lcmF0ZWQgJiYgJ2NvbHVtbicgaW4gYUdlbmVyYXRlZAogICAgICAgICYmIGFHZW5lcmF0ZWQubGluZSA+IDAgJiYgYUdlbmVyYXRlZC5jb2x1bW4gPj0gMAogICAgICAgICYmICFhT3JpZ2luYWwgJiYgIWFTb3VyY2UgJiYgIWFOYW1lKSB7CiAgICAgIC8vIENhc2UgMS4KICAgICAgcmV0dXJuOwogICAgfQogICAgZWxzZSBpZiAoYUdlbmVyYXRlZCAmJiAnbGluZScgaW4gYUdlbmVyYXRlZCAmJiAnY29sdW1uJyBpbiBhR2VuZXJhdGVkCiAgICAgICAgICAgICAmJiBhT3JpZ2luYWwgJiYgJ2xpbmUnIGluIGFPcmlnaW5hbCAmJiAnY29sdW1uJyBpbiBhT3JpZ2luYWwKICAgICAgICAgICAgICYmIGFHZW5lcmF0ZWQubGluZSA+IDAgJiYgYUdlbmVyYXRlZC5jb2x1bW4gPj0gMAogICAgICAgICAgICAgJiYgYU9yaWdpbmFsLmxpbmUgPiAwICYmIGFPcmlnaW5hbC5jb2x1bW4gPj0gMAogICAgICAgICAgICAgJiYgYVNvdXJjZSkgewogICAgICAvLyBDYXNlcyAyIGFuZCAzLgogICAgICByZXR1cm47CiAgICB9CiAgICBlbHNlIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIG1hcHBpbmc6ICcgKyBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgZ2VuZXJhdGVkOiBhR2VuZXJhdGVkLAogICAgICAgIHNvdXJjZTogYVNvdXJjZSwKICAgICAgICBvcmlnaW5hbDogYU9yaWdpbmFsLAogICAgICAgIG5hbWU6IGFOYW1lCiAgICAgIH0pKTsKICAgIH0KICB9OwoKLyoqCiAqIFNlcmlhbGl6ZSB0aGUgYWNjdW11bGF0ZWQgbWFwcGluZ3MgaW4gdG8gdGhlIHN0cmVhbSBvZiBiYXNlIDY0IFZMUXMKICogc3BlY2lmaWVkIGJ5IHRoZSBzb3VyY2UgbWFwIGZvcm1hdC4KICovClNvdXJjZU1hcEdlbmVyYXRvci5wcm90b3R5cGUuX3NlcmlhbGl6ZU1hcHBpbmdzID0KICBmdW5jdGlvbiBTb3VyY2VNYXBHZW5lcmF0b3Jfc2VyaWFsaXplTWFwcGluZ3MoKSB7CiAgICB2YXIgcHJldmlvdXNHZW5lcmF0ZWRDb2x1bW4gPSAwOwogICAgdmFyIHByZXZpb3VzR2VuZXJhdGVkTGluZSA9IDE7CiAgICB2YXIgcHJldmlvdXNPcmlnaW5hbENvbHVtbiA9IDA7CiAgICB2YXIgcHJldmlvdXNPcmlnaW5hbExpbmUgPSAwOwogICAgdmFyIHByZXZpb3VzTmFtZSA9IDA7CiAgICB2YXIgcHJldmlvdXNTb3VyY2UgPSAwOwogICAgdmFyIHJlc3VsdCA9ICcnOwogICAgdmFyIG5leHQ7CiAgICB2YXIgbWFwcGluZzsKICAgIHZhciBuYW1lSWR4OwogICAgdmFyIHNvdXJjZUlkeDsKCiAgICB2YXIgbWFwcGluZ3MgPSB0aGlzLl9tYXBwaW5ncy50b0FycmF5KCk7CiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gbWFwcGluZ3MubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgbWFwcGluZyA9IG1hcHBpbmdzW2ldOwogICAgICBuZXh0ID0gJyc7CgogICAgICBpZiAobWFwcGluZy5nZW5lcmF0ZWRMaW5lICE9PSBwcmV2aW91c0dlbmVyYXRlZExpbmUpIHsKICAgICAgICBwcmV2aW91c0dlbmVyYXRlZENvbHVtbiA9IDA7CiAgICAgICAgd2hpbGUgKG1hcHBpbmcuZ2VuZXJhdGVkTGluZSAhPT0gcHJldmlvdXNHZW5lcmF0ZWRMaW5lKSB7CiAgICAgICAgICBuZXh0ICs9ICc7JzsKICAgICAgICAgIHByZXZpb3VzR2VuZXJhdGVkTGluZSsrOwogICAgICAgIH0KICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICBpZiAoaSA+IDApIHsKICAgICAgICAgIGlmICghdXRpbC5jb21wYXJlQnlHZW5lcmF0ZWRQb3NpdGlvbnNJbmZsYXRlZChtYXBwaW5nLCBtYXBwaW5nc1tpIC0gMV0pKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgbmV4dCArPSAnLCc7CiAgICAgICAgfQogICAgICB9CgogICAgICBuZXh0ICs9IGJhc2U2NFZMUS5lbmNvZGUobWFwcGluZy5nZW5lcmF0ZWRDb2x1bW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLSBwcmV2aW91c0dlbmVyYXRlZENvbHVtbik7CiAgICAgIHByZXZpb3VzR2VuZXJhdGVkQ29sdW1uID0gbWFwcGluZy5nZW5lcmF0ZWRDb2x1bW47CgogICAgICBpZiAobWFwcGluZy5zb3VyY2UgIT0gbnVsbCkgewogICAgICAgIHNvdXJjZUlkeCA9IHRoaXMuX3NvdXJjZXMuaW5kZXhPZihtYXBwaW5nLnNvdXJjZSk7CiAgICAgICAgbmV4dCArPSBiYXNlNjRWTFEuZW5jb2RlKHNvdXJjZUlkeCAtIHByZXZpb3VzU291cmNlKTsKICAgICAgICBwcmV2aW91c1NvdXJjZSA9IHNvdXJjZUlkeDsKCiAgICAgICAgLy8gbGluZXMgYXJlIHN0b3JlZCAwLWJhc2VkIGluIFNvdXJjZU1hcCBzcGVjIHZlcnNpb24gMwogICAgICAgIG5leHQgKz0gYmFzZTY0VkxRLmVuY29kZShtYXBwaW5nLm9yaWdpbmFsTGluZSAtIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtIHByZXZpb3VzT3JpZ2luYWxMaW5lKTsKICAgICAgICBwcmV2aW91c09yaWdpbmFsTGluZSA9IG1hcHBpbmcub3JpZ2luYWxMaW5lIC0gMTsKCiAgICAgICAgbmV4dCArPSBiYXNlNjRWTFEuZW5jb2RlKG1hcHBpbmcub3JpZ2luYWxDb2x1bW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtIHByZXZpb3VzT3JpZ2luYWxDb2x1bW4pOwogICAgICAgIHByZXZpb3VzT3JpZ2luYWxDb2x1bW4gPSBtYXBwaW5nLm9yaWdpbmFsQ29sdW1uOwoKICAgICAgICBpZiAobWFwcGluZy5uYW1lICE9IG51bGwpIHsKICAgICAgICAgIG5hbWVJZHggPSB0aGlzLl9uYW1lcy5pbmRleE9mKG1hcHBpbmcubmFtZSk7CiAgICAgICAgICBuZXh0ICs9IGJhc2U2NFZMUS5lbmNvZGUobmFtZUlkeCAtIHByZXZpb3VzTmFtZSk7CiAgICAgICAgICBwcmV2aW91c05hbWUgPSBuYW1lSWR4OwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmVzdWx0ICs9IG5leHQ7CiAgICB9CgogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKU291cmNlTWFwR2VuZXJhdG9yLnByb3RvdHlwZS5fZ2VuZXJhdGVTb3VyY2VzQ29udGVudCA9CiAgZnVuY3Rpb24gU291cmNlTWFwR2VuZXJhdG9yX2dlbmVyYXRlU291cmNlc0NvbnRlbnQoYVNvdXJjZXMsIGFTb3VyY2VSb290KSB7CiAgICByZXR1cm4gYVNvdXJjZXMubWFwKGZ1bmN0aW9uIChzb3VyY2UpIHsKICAgICAgaWYgKCF0aGlzLl9zb3VyY2VzQ29udGVudHMpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBpZiAoYVNvdXJjZVJvb3QgIT0gbnVsbCkgewogICAgICAgIHNvdXJjZSA9IHV0aWwucmVsYXRpdmUoYVNvdXJjZVJvb3QsIHNvdXJjZSk7CiAgICAgIH0KICAgICAgdmFyIGtleSA9IHV0aWwudG9TZXRTdHJpbmcoc291cmNlKTsKICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLl9zb3VyY2VzQ29udGVudHMsIGtleSkKICAgICAgICA/IHRoaXMuX3NvdXJjZXNDb250ZW50c1trZXldCiAgICAgICAgOiBudWxsOwogICAgfSwgdGhpcyk7CiAgfTsKCi8qKgogKiBFeHRlcm5hbGl6ZSB0aGUgc291cmNlIG1hcC4KICovClNvdXJjZU1hcEdlbmVyYXRvci5wcm90b3R5cGUudG9KU09OID0KICBmdW5jdGlvbiBTb3VyY2VNYXBHZW5lcmF0b3JfdG9KU09OKCkgewogICAgdmFyIG1hcCA9IHsKICAgICAgdmVyc2lvbjogdGhpcy5fdmVyc2lvbiwKICAgICAgc291cmNlczogdGhpcy5fc291cmNlcy50b0FycmF5KCksCiAgICAgIG5hbWVzOiB0aGlzLl9uYW1lcy50b0FycmF5KCksCiAgICAgIG1hcHBpbmdzOiB0aGlzLl9zZXJpYWxpemVNYXBwaW5ncygpCiAgICB9OwogICAgaWYgKHRoaXMuX2ZpbGUgIT0gbnVsbCkgewogICAgICBtYXAuZmlsZSA9IHRoaXMuX2ZpbGU7CiAgICB9CiAgICBpZiAodGhpcy5fc291cmNlUm9vdCAhPSBudWxsKSB7CiAgICAgIG1hcC5zb3VyY2VSb290ID0gdGhpcy5fc291cmNlUm9vdDsKICAgIH0KICAgIGlmICh0aGlzLl9zb3VyY2VzQ29udGVudHMpIHsKICAgICAgbWFwLnNvdXJjZXNDb250ZW50ID0gdGhpcy5fZ2VuZXJhdGVTb3VyY2VzQ29udGVudChtYXAuc291cmNlcywgbWFwLnNvdXJjZVJvb3QpOwogICAgfQoKICAgIHJldHVybiBtYXA7CiAgfTsKCi8qKgogKiBSZW5kZXIgdGhlIHNvdXJjZSBtYXAgYmVpbmcgZ2VuZXJhdGVkIHRvIGEgc3RyaW5nLgogKi8KU291cmNlTWFwR2VuZXJhdG9yLnByb3RvdHlwZS50b1N0cmluZyA9CiAgZnVuY3Rpb24gU291cmNlTWFwR2VuZXJhdG9yX3RvU3RyaW5nKCkgewogICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMudG9KU09OKCkpOwogIH07Cgp2YXIgU291cmNlTWFwR2VuZXJhdG9yXzEgPSBTb3VyY2VNYXBHZW5lcmF0b3I7Cgpjb25zdCB0cmFja05vZGVzID0gbmV3IFNldChbJ0F0cnVsZScsICdTZWxlY3RvcicsICdEZWNsYXJhdGlvbiddKTsKCmZ1bmN0aW9uIGdlbmVyYXRlU291cmNlTWFwKGhhbmRsZXJzKSB7CiAgICBjb25zdCBtYXAgPSBuZXcgU291cmNlTWFwR2VuZXJhdG9yXzEoKTsKICAgIGNvbnN0IGdlbmVyYXRlZCA9IHsKICAgICAgICBsaW5lOiAxLAogICAgICAgIGNvbHVtbjogMAogICAgfTsKICAgIGNvbnN0IG9yaWdpbmFsID0gewogICAgICAgIGxpbmU6IDAsIC8vIHNob3VsZCBiZSB6ZXJvIHRvIGFkZCBmaXJzdCBtYXBwaW5nCiAgICAgICAgY29sdW1uOiAwCiAgICB9OwogICAgY29uc3QgYWN0aXZhdGVkR2VuZXJhdGVkID0gewogICAgICAgIGxpbmU6IDEsCiAgICAgICAgY29sdW1uOiAwCiAgICB9OwogICAgY29uc3QgYWN0aXZhdGVkTWFwcGluZyA9IHsKICAgICAgICBnZW5lcmF0ZWQ6IGFjdGl2YXRlZEdlbmVyYXRlZAogICAgfTsKICAgIGxldCBsaW5lID0gMTsKICAgIGxldCBjb2x1bW4gPSAwOwogICAgbGV0IHNvdXJjZU1hcHBpbmdBY3RpdmUgPSBmYWxzZTsKCiAgICBjb25zdCBvcmlnSGFuZGxlcnNOb2RlID0gaGFuZGxlcnMubm9kZTsKICAgIGhhbmRsZXJzLm5vZGUgPSBmdW5jdGlvbihub2RlKSB7CiAgICAgICAgaWYgKG5vZGUubG9jICYmIG5vZGUubG9jLnN0YXJ0ICYmIHRyYWNrTm9kZXMuaGFzKG5vZGUudHlwZSkpIHsKICAgICAgICAgICAgY29uc3Qgbm9kZUxpbmUgPSBub2RlLmxvYy5zdGFydC5saW5lOwogICAgICAgICAgICBjb25zdCBub2RlQ29sdW1uID0gbm9kZS5sb2Muc3RhcnQuY29sdW1uIC0gMTsKCiAgICAgICAgICAgIGlmIChvcmlnaW5hbC5saW5lICE9PSBub2RlTGluZSB8fAogICAgICAgICAgICAgICAgb3JpZ2luYWwuY29sdW1uICE9PSBub2RlQ29sdW1uKSB7CiAgICAgICAgICAgICAgICBvcmlnaW5hbC5saW5lID0gbm9kZUxpbmU7CiAgICAgICAgICAgICAgICBvcmlnaW5hbC5jb2x1bW4gPSBub2RlQ29sdW1uOwoKICAgICAgICAgICAgICAgIGdlbmVyYXRlZC5saW5lID0gbGluZTsKICAgICAgICAgICAgICAgIGdlbmVyYXRlZC5jb2x1bW4gPSBjb2x1bW47CgogICAgICAgICAgICAgICAgaWYgKHNvdXJjZU1hcHBpbmdBY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICBzb3VyY2VNYXBwaW5nQWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaWYgKGdlbmVyYXRlZC5saW5lICE9PSBhY3RpdmF0ZWRHZW5lcmF0ZWQubGluZSB8fAogICAgICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZWQuY29sdW1uICE9PSBhY3RpdmF0ZWRHZW5lcmF0ZWQuY29sdW1uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hcC5hZGRNYXBwaW5nKGFjdGl2YXRlZE1hcHBpbmcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBzb3VyY2VNYXBwaW5nQWN0aXZlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIG1hcC5hZGRNYXBwaW5nKHsKICAgICAgICAgICAgICAgICAgICBzb3VyY2U6IG5vZGUubG9jLnNvdXJjZSwKICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbCwKICAgICAgICAgICAgICAgICAgICBnZW5lcmF0ZWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBvcmlnSGFuZGxlcnNOb2RlLmNhbGwodGhpcywgbm9kZSk7CgogICAgICAgIGlmIChzb3VyY2VNYXBwaW5nQWN0aXZlICYmIHRyYWNrTm9kZXMuaGFzKG5vZGUudHlwZSkpIHsKICAgICAgICAgICAgYWN0aXZhdGVkR2VuZXJhdGVkLmxpbmUgPSBsaW5lOwogICAgICAgICAgICBhY3RpdmF0ZWRHZW5lcmF0ZWQuY29sdW1uID0gY29sdW1uOwogICAgICAgIH0KICAgIH07CgogICAgY29uc3Qgb3JpZ0hhbmRsZXJzRW1pdCA9IGhhbmRsZXJzLmVtaXQ7CiAgICBoYW5kbGVycy5lbWl0ID0gZnVuY3Rpb24odmFsdWUsIHR5cGUsIGF1dG8pIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZhbHVlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICh2YWx1ZS5jaGFyQ29kZUF0KGkpID09PSAxMCkgeyAvLyBcbgogICAgICAgICAgICAgICAgbGluZSsrOwogICAgICAgICAgICAgICAgY29sdW1uID0gMDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbHVtbisrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBvcmlnSGFuZGxlcnNFbWl0KHZhbHVlLCB0eXBlLCBhdXRvKTsKICAgIH07CgogICAgY29uc3Qgb3JpZ0hhbmRsZXJzUmVzdWx0ID0gaGFuZGxlcnMucmVzdWx0OwogICAgaGFuZGxlcnMucmVzdWx0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHNvdXJjZU1hcHBpbmdBY3RpdmUpIHsKICAgICAgICAgICAgbWFwLmFkZE1hcHBpbmcoYWN0aXZhdGVkTWFwcGluZyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBjc3M6IG9yaWdIYW5kbGVyc1Jlc3VsdCgpLAogICAgICAgICAgICBtYXAKICAgICAgICB9OwogICAgfTsKCiAgICByZXR1cm4gaGFuZGxlcnM7Cn0KCmNvbnN0IFBMVVNTSUdOJDkgPSAweDAwMkI7ICAgIC8vIFUrMDAyQiBQTFVTIFNJR04gKCspCmNvbnN0IEhZUEhFTk1JTlVTJDYgPSAweDAwMkQ7IC8vIFUrMDAyRCBIWVBIRU4tTUlOVVMgKC0pCgpjb25zdCBjb2RlID0gKHR5cGUsIHZhbHVlKSA9PiB7CiAgICBpZiAodHlwZSA9PT0gRGVsaW0pIHsKICAgICAgICB0eXBlID0gdmFsdWU7CiAgICB9CgogICAgaWYgKHR5cGVvZiB0eXBlID09PSAnc3RyaW5nJykgewogICAgICAgIGNvbnN0IGNoYXJDb2RlID0gdHlwZS5jaGFyQ29kZUF0KDApOwogICAgICAgIHJldHVybiBjaGFyQ29kZSA+IDB4N0YgPyAweDgwMDAgOiBjaGFyQ29kZSA8PCA4OwogICAgfQoKICAgIHJldHVybiB0eXBlOwp9OwoKLy8gaHR0cHM6Ly93d3cudzMub3JnL1RSL2Nzcy1zeW50YXgtMy8jc2VyaWFsaXphdGlvbgovLyBUaGUgb25seSByZXF1aXJlbWVudCBmb3Igc2VyaWFsaXphdGlvbiBpcyB0aGF0IGl0IG11c3QgInJvdW5kLXRyaXAiIHdpdGggcGFyc2luZywKLy8gdGhhdCBpcywgcGFyc2luZyB0aGUgc3R5bGVzaGVldCBtdXN0IHByb2R1Y2UgdGhlIHNhbWUgZGF0YSBzdHJ1Y3R1cmVzIGFzIHBhcnNpbmcsCi8vIHNlcmlhbGl6aW5nLCBhbmQgcGFyc2luZyBhZ2FpbiwgZXhjZXB0IGZvciBjb25zZWN1dGl2ZSA8d2hpdGVzcGFjZS10b2tlbj5zLAovLyB3aGljaCBtYXkgYmUgY29sbGFwc2VkIGludG8gYSBzaW5nbGUgdG9rZW4uCgpjb25zdCBzcGVjUGFpcnMgPSBbCiAgICBbSWRlbnQsIElkZW50XSwKICAgIFtJZGVudCwgRnVuY3Rpb24kMl0sCiAgICBbSWRlbnQsIFVybCQxXSwKICAgIFtJZGVudCwgQmFkVXJsXSwKICAgIFtJZGVudCwgJy0nXSwKICAgIFtJZGVudCwgTnVtYmVyJDJdLAogICAgW0lkZW50LCBQZXJjZW50YWdlJDFdLAogICAgW0lkZW50LCBEaW1lbnNpb24kMV0sCiAgICBbSWRlbnQsIENEQyQxXSwKICAgIFtJZGVudCwgTGVmdFBhcmVudGhlc2lzXSwKCiAgICBbQXRLZXl3b3JkLCBJZGVudF0sCiAgICBbQXRLZXl3b3JkLCBGdW5jdGlvbiQyXSwKICAgIFtBdEtleXdvcmQsIFVybCQxXSwKICAgIFtBdEtleXdvcmQsIEJhZFVybF0sCiAgICBbQXRLZXl3b3JkLCAnLSddLAogICAgW0F0S2V5d29yZCwgTnVtYmVyJDJdLAogICAgW0F0S2V5d29yZCwgUGVyY2VudGFnZSQxXSwKICAgIFtBdEtleXdvcmQsIERpbWVuc2lvbiQxXSwKICAgIFtBdEtleXdvcmQsIENEQyQxXSwKCiAgICBbSGFzaCQxLCBJZGVudF0sCiAgICBbSGFzaCQxLCBGdW5jdGlvbiQyXSwKICAgIFtIYXNoJDEsIFVybCQxXSwKICAgIFtIYXNoJDEsIEJhZFVybF0sCiAgICBbSGFzaCQxLCAnLSddLAogICAgW0hhc2gkMSwgTnVtYmVyJDJdLAogICAgW0hhc2gkMSwgUGVyY2VudGFnZSQxXSwKICAgIFtIYXNoJDEsIERpbWVuc2lvbiQxXSwKICAgIFtIYXNoJDEsIENEQyQxXSwKCiAgICBbRGltZW5zaW9uJDEsIElkZW50XSwKICAgIFtEaW1lbnNpb24kMSwgRnVuY3Rpb24kMl0sCiAgICBbRGltZW5zaW9uJDEsIFVybCQxXSwKICAgIFtEaW1lbnNpb24kMSwgQmFkVXJsXSwKICAgIFtEaW1lbnNpb24kMSwgJy0nXSwKICAgIFtEaW1lbnNpb24kMSwgTnVtYmVyJDJdLAogICAgW0RpbWVuc2lvbiQxLCBQZXJjZW50YWdlJDFdLAogICAgW0RpbWVuc2lvbiQxLCBEaW1lbnNpb24kMV0sCiAgICBbRGltZW5zaW9uJDEsIENEQyQxXSwKCiAgICBbJyMnLCBJZGVudF0sCiAgICBbJyMnLCBGdW5jdGlvbiQyXSwKICAgIFsnIycsIFVybCQxXSwKICAgIFsnIycsIEJhZFVybF0sCiAgICBbJyMnLCAnLSddLAogICAgWycjJywgTnVtYmVyJDJdLAogICAgWycjJywgUGVyY2VudGFnZSQxXSwKICAgIFsnIycsIERpbWVuc2lvbiQxXSwKICAgIFsnIycsIENEQyQxXSwgLy8gaHR0cHM6Ly9naXRodWIuY29tL3czYy9jc3N3Zy1kcmFmdHMvcHVsbC82ODc0CgogICAgWyctJywgSWRlbnRdLAogICAgWyctJywgRnVuY3Rpb24kMl0sCiAgICBbJy0nLCBVcmwkMV0sCiAgICBbJy0nLCBCYWRVcmxdLAogICAgWyctJywgJy0nXSwKICAgIFsnLScsIE51bWJlciQyXSwKICAgIFsnLScsIFBlcmNlbnRhZ2UkMV0sCiAgICBbJy0nLCBEaW1lbnNpb24kMV0sCiAgICBbJy0nLCBDREMkMV0sIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS93M2MvY3Nzd2ctZHJhZnRzL3B1bGwvNjg3NAoKICAgIFtOdW1iZXIkMiwgSWRlbnRdLAogICAgW051bWJlciQyLCBGdW5jdGlvbiQyXSwKICAgIFtOdW1iZXIkMiwgVXJsJDFdLAogICAgW051bWJlciQyLCBCYWRVcmxdLAogICAgW051bWJlciQyLCBOdW1iZXIkMl0sCiAgICBbTnVtYmVyJDIsIFBlcmNlbnRhZ2UkMV0sCiAgICBbTnVtYmVyJDIsIERpbWVuc2lvbiQxXSwKICAgIFtOdW1iZXIkMiwgJyUnXSwKICAgIFtOdW1iZXIkMiwgQ0RDJDFdLCAvLyBodHRwczovL2dpdGh1Yi5jb20vdzNjL2Nzc3dnLWRyYWZ0cy9wdWxsLzY4NzQKCiAgICBbJ0AnLCBJZGVudF0sCiAgICBbJ0AnLCBGdW5jdGlvbiQyXSwKICAgIFsnQCcsIFVybCQxXSwKICAgIFsnQCcsIEJhZFVybF0sCiAgICBbJ0AnLCAnLSddLAogICAgWydAJywgQ0RDJDFdLCAvLyBodHRwczovL2dpdGh1Yi5jb20vdzNjL2Nzc3dnLWRyYWZ0cy9wdWxsLzY4NzQKCiAgICBbJy4nLCBOdW1iZXIkMl0sCiAgICBbJy4nLCBQZXJjZW50YWdlJDFdLAogICAgWycuJywgRGltZW5zaW9uJDFdLAoKICAgIFsnKycsIE51bWJlciQyXSwKICAgIFsnKycsIFBlcmNlbnRhZ2UkMV0sCiAgICBbJysnLCBEaW1lbnNpb24kMV0sCgogICAgWycvJywgJyonXQpdOwovLyB2YWxpZGF0ZSB3aXRoIHNjcmlwdHMvZ2VuZXJhdGUtc2FmZQpjb25zdCBzYWZlUGFpcnMgPSBzcGVjUGFpcnMuY29uY2F0KFsKICAgIFtJZGVudCwgSGFzaCQxXSwKCiAgICBbRGltZW5zaW9uJDEsIEhhc2gkMV0sCgogICAgW0hhc2gkMSwgSGFzaCQxXSwKCiAgICBbQXRLZXl3b3JkLCBMZWZ0UGFyZW50aGVzaXNdLAogICAgW0F0S2V5d29yZCwgU3RyaW5nJDJdLAogICAgW0F0S2V5d29yZCwgQ29sb25dLAoKICAgIFtQZXJjZW50YWdlJDEsIFBlcmNlbnRhZ2UkMV0sCiAgICBbUGVyY2VudGFnZSQxLCBEaW1lbnNpb24kMV0sCiAgICBbUGVyY2VudGFnZSQxLCBGdW5jdGlvbiQyXSwKICAgIFtQZXJjZW50YWdlJDEsICctJ10sCgogICAgW1JpZ2h0UGFyZW50aGVzaXMsIElkZW50XSwKICAgIFtSaWdodFBhcmVudGhlc2lzLCBGdW5jdGlvbiQyXSwKICAgIFtSaWdodFBhcmVudGhlc2lzLCBQZXJjZW50YWdlJDFdLAogICAgW1JpZ2h0UGFyZW50aGVzaXMsIERpbWVuc2lvbiQxXSwKICAgIFtSaWdodFBhcmVudGhlc2lzLCBIYXNoJDFdLAogICAgW1JpZ2h0UGFyZW50aGVzaXMsICctJ10KXSk7CgpmdW5jdGlvbiBjcmVhdGVNYXAocGFpcnMpIHsKICAgIGNvbnN0IGlzV2hpdGVTcGFjZVJlcXVpcmVkID0gbmV3IFNldCgKICAgICAgICBwYWlycy5tYXAoKFtwcmV2LCBuZXh0XSkgPT4gKGNvZGUocHJldikgPDwgMTYgfCBjb2RlKG5leHQpKSkKICAgICk7CgogICAgcmV0dXJuIGZ1bmN0aW9uKHByZXZDb2RlLCB0eXBlLCB2YWx1ZSkgewogICAgICAgIGNvbnN0IG5leHRDb2RlID0gY29kZSh0eXBlLCB2YWx1ZSk7CiAgICAgICAgY29uc3QgbmV4dENoYXJDb2RlID0gdmFsdWUuY2hhckNvZGVBdCgwKTsKICAgICAgICBjb25zdCBlbWl0V3MgPQogICAgICAgICAgICAobmV4dENoYXJDb2RlID09PSBIWVBIRU5NSU5VUyQ2ICYmCiAgICAgICAgICAgICAgICB0eXBlICE9PSBJZGVudCAmJgogICAgICAgICAgICAgICAgdHlwZSAhPT0gRnVuY3Rpb24kMiAmJgogICAgICAgICAgICAgICAgdHlwZSAhPT0gQ0RDJDEpIHx8CiAgICAgICAgICAgIChuZXh0Q2hhckNvZGUgPT09IFBMVVNTSUdOJDkpCiAgICAgICAgICAgICAgICA/IGlzV2hpdGVTcGFjZVJlcXVpcmVkLmhhcyhwcmV2Q29kZSA8PCAxNiB8IG5leHRDaGFyQ29kZSA8PCA4KQogICAgICAgICAgICAgICAgOiBpc1doaXRlU3BhY2VSZXF1aXJlZC5oYXMocHJldkNvZGUgPDwgMTYgfCBuZXh0Q29kZSk7CgogICAgICAgIGlmIChlbWl0V3MpIHsKICAgICAgICAgICAgdGhpcy5lbWl0KCcgJywgV2hpdGVTcGFjZSQxLCB0cnVlKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBuZXh0Q29kZTsKICAgIH07Cn0KCmNvbnN0IHNwZWMgPSBjcmVhdGVNYXAoc3BlY1BhaXJzKTsKY29uc3Qgc2FmZSA9IGNyZWF0ZU1hcChzYWZlUGFpcnMpOwoKY29uc3QgdG9rZW5CZWZvcmUgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIHNhZmUsCiAgICBzcGVjCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgUkVWRVJTRVNPTElEVVMgPSAweDAwNWM7IC8vIFUrMDA1QyBSRVZFUlNFIFNPTElEVVMgKFwpCgpmdW5jdGlvbiBwcm9jZXNzQ2hpbGRyZW4obm9kZSwgZGVsaW1ldGVyKSB7CiAgICBpZiAodHlwZW9mIGRlbGltZXRlciA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIGxldCBwcmV2ID0gbnVsbDsKCiAgICAgICAgbm9kZS5jaGlsZHJlbi5mb3JFYWNoKG5vZGUgPT4gewogICAgICAgICAgICBpZiAocHJldiAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgZGVsaW1ldGVyLmNhbGwodGhpcywgcHJldik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMubm9kZShub2RlKTsKICAgICAgICAgICAgcHJldiA9IG5vZGU7CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBub2RlLmNoaWxkcmVuLmZvckVhY2godGhpcy5ub2RlLCB0aGlzKTsKfQoKZnVuY3Rpb24gcHJvY2Vzc0NodW5rKGNodW5rKSB7CiAgICB0b2tlbml6ZSQxKGNodW5rLCAodHlwZSwgc3RhcnQsIGVuZCkgPT4gewogICAgICAgIHRoaXMudG9rZW4odHlwZSwgY2h1bmsuc2xpY2Uoc3RhcnQsIGVuZCkpOwogICAgfSk7Cn0KCmZ1bmN0aW9uIGNyZWF0ZUdlbmVyYXRvcihjb25maWcpIHsKICAgIGNvbnN0IHR5cGVzID0gbmV3IE1hcCgpOwoKICAgIGZvciAobGV0IG5hbWUgaW4gY29uZmlnLm5vZGUpIHsKICAgICAgICBjb25zdCBpdGVtID0gY29uZmlnLm5vZGVbbmFtZV07CiAgICAgICAgY29uc3QgZm4gPSBpdGVtLmdlbmVyYXRlIHx8IGl0ZW07CgogICAgICAgIGlmICh0eXBlb2YgZm4gPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgdHlwZXMuc2V0KG5hbWUsIGl0ZW0uZ2VuZXJhdGUgfHwgaXRlbSk7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBmdW5jdGlvbihub2RlLCBvcHRpb25zKSB7CiAgICAgICAgbGV0IGJ1ZmZlciA9ICcnOwogICAgICAgIGxldCBwcmV2Q29kZSA9IDA7CiAgICAgICAgbGV0IGhhbmRsZXJzID0gewogICAgICAgICAgICBub2RlKG5vZGUpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlcy5oYXMobm9kZS50eXBlKSkgewogICAgICAgICAgICAgICAgICAgIHR5cGVzLmdldChub2RlLnR5cGUpLmNhbGwocHVibGljQXBpLCBub2RlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIG5vZGUgdHlwZTogJyArIG5vZGUudHlwZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRva2VuQmVmb3JlOiBzYWZlLAogICAgICAgICAgICB0b2tlbih0eXBlLCB2YWx1ZSkgewogICAgICAgICAgICAgICAgcHJldkNvZGUgPSB0aGlzLnRva2VuQmVmb3JlKHByZXZDb2RlLCB0eXBlLCB2YWx1ZSk7CgogICAgICAgICAgICAgICAgdGhpcy5lbWl0KHZhbHVlLCB0eXBlLCBmYWxzZSk7CgogICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09IERlbGltICYmIHZhbHVlLmNoYXJDb2RlQXQoMCkgPT09IFJFVkVSU0VTT0xJRFVTKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KCdcbicsIFdoaXRlU3BhY2UkMSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVtaXQodmFsdWUpIHsKICAgICAgICAgICAgICAgIGJ1ZmZlciArPSB2YWx1ZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmVzdWx0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJ1ZmZlcjsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGlmIChvcHRpb25zKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5kZWNvcmF0b3IgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgIGhhbmRsZXJzID0gb3B0aW9ucy5kZWNvcmF0b3IoaGFuZGxlcnMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAob3B0aW9ucy5zb3VyY2VNYXApIHsKICAgICAgICAgICAgICAgIGhhbmRsZXJzID0gZ2VuZXJhdGVTb3VyY2VNYXAoaGFuZGxlcnMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAob3B0aW9ucy5tb2RlIGluIHRva2VuQmVmb3JlKSB7CiAgICAgICAgICAgICAgICBoYW5kbGVycy50b2tlbkJlZm9yZSA9IHRva2VuQmVmb3JlW29wdGlvbnMubW9kZV07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IHB1YmxpY0FwaSA9IHsKICAgICAgICAgICAgbm9kZTogKG5vZGUpID0+IGhhbmRsZXJzLm5vZGUobm9kZSksCiAgICAgICAgICAgIGNoaWxkcmVuOiBwcm9jZXNzQ2hpbGRyZW4sCiAgICAgICAgICAgIHRva2VuOiAodHlwZSwgdmFsdWUpID0+IGhhbmRsZXJzLnRva2VuKHR5cGUsIHZhbHVlKSwKICAgICAgICAgICAgdG9rZW5pemU6IHByb2Nlc3NDaHVuawogICAgICAgIH07CgogICAgICAgIGhhbmRsZXJzLm5vZGUobm9kZSk7CgogICAgICAgIHJldHVybiBoYW5kbGVycy5yZXN1bHQoKTsKICAgIH07Cn0KCmZ1bmN0aW9uIGNyZWF0ZUNvbnZlcnRvcih3YWxrKSB7CiAgICByZXR1cm4gewogICAgICAgIGZyb21QbGFpbk9iamVjdChhc3QpIHsKICAgICAgICAgICAgd2Fsayhhc3QsIHsKICAgICAgICAgICAgICAgIGVudGVyKG5vZGUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5jaGlsZHJlbiAmJiBub2RlLmNoaWxkcmVuIGluc3RhbmNlb2YgTGlzdCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5jaGlsZHJlbiA9IG5ldyBMaXN0KCkuZnJvbUFycmF5KG5vZGUuY2hpbGRyZW4pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXR1cm4gYXN0OwogICAgICAgIH0sCiAgICAgICAgdG9QbGFpbk9iamVjdChhc3QpIHsKICAgICAgICAgICAgd2Fsayhhc3QsIHsKICAgICAgICAgICAgICAgIGxlYXZlKG5vZGUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5jaGlsZHJlbiAmJiBub2RlLmNoaWxkcmVuIGluc3RhbmNlb2YgTGlzdCkgewogICAgICAgICAgICAgICAgICAgICAgICBub2RlLmNoaWxkcmVuID0gbm9kZS5jaGlsZHJlbi50b0FycmF5KCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiBhc3Q7CiAgICAgICAgfQogICAgfTsKfQoKY29uc3QgeyBoYXNPd25Qcm9wZXJ0eTogaGFzT3duUHJvcGVydHkkMyB9ID0gT2JqZWN0LnByb3RvdHlwZTsKY29uc3Qgbm9vcCQyID0gZnVuY3Rpb24oKSB7fTsKCmZ1bmN0aW9uIGVuc3VyZUZ1bmN0aW9uJDEodmFsdWUpIHsKICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicgPyB2YWx1ZSA6IG5vb3AkMjsKfQoKZnVuY3Rpb24gaW52b2tlRm9yVHlwZShmbiwgdHlwZSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKG5vZGUsIGl0ZW0sIGxpc3QpIHsKICAgICAgICBpZiAobm9kZS50eXBlID09PSB0eXBlKSB7CiAgICAgICAgICAgIGZuLmNhbGwodGhpcywgbm9kZSwgaXRlbSwgbGlzdCk7CiAgICAgICAgfQogICAgfTsKfQoKZnVuY3Rpb24gZ2V0V2Fsa2Vyc0Zyb21TdHJ1Y3R1cmUobmFtZSwgbm9kZVR5cGUpIHsKICAgIGNvbnN0IHN0cnVjdHVyZSA9IG5vZGVUeXBlLnN0cnVjdHVyZTsKICAgIGNvbnN0IHdhbGtlcnMgPSBbXTsKCiAgICBmb3IgKGNvbnN0IGtleSBpbiBzdHJ1Y3R1cmUpIHsKICAgICAgICBpZiAoaGFzT3duUHJvcGVydHkkMy5jYWxsKHN0cnVjdHVyZSwga2V5KSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICBsZXQgZmllbGRUeXBlcyA9IHN0cnVjdHVyZVtrZXldOwogICAgICAgIGNvbnN0IHdhbGtlciA9IHsKICAgICAgICAgICAgbmFtZToga2V5LAogICAgICAgICAgICB0eXBlOiBmYWxzZSwKICAgICAgICAgICAgbnVsbGFibGU6IGZhbHNlCiAgICAgICAgfTsKCiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGZpZWxkVHlwZXMpKSB7CiAgICAgICAgICAgIGZpZWxkVHlwZXMgPSBbZmllbGRUeXBlc107CiAgICAgICAgfQoKICAgICAgICBmb3IgKGNvbnN0IGZpZWxkVHlwZSBvZiBmaWVsZFR5cGVzKSB7CiAgICAgICAgICAgIGlmIChmaWVsZFR5cGUgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIHdhbGtlci5udWxsYWJsZSA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGZpZWxkVHlwZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgIHdhbGtlci50eXBlID0gJ25vZGUnOwogICAgICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoZmllbGRUeXBlKSkgewogICAgICAgICAgICAgICAgd2Fsa2VyLnR5cGUgPSAnbGlzdCc7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh3YWxrZXIudHlwZSkgewogICAgICAgICAgICB3YWxrZXJzLnB1c2god2Fsa2VyKTsKICAgICAgICB9CiAgICB9CgogICAgaWYgKHdhbGtlcnMubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgY29udGV4dDogbm9kZVR5cGUud2Fsa0NvbnRleHQsCiAgICAgICAgICAgIGZpZWxkczogd2Fsa2VycwogICAgICAgIH07CiAgICB9CgogICAgcmV0dXJuIG51bGw7Cn0KCmZ1bmN0aW9uIGdldFR5cGVzRnJvbUNvbmZpZyhjb25maWcpIHsKICAgIGNvbnN0IHR5cGVzID0ge307CgogICAgZm9yIChjb25zdCBuYW1lIGluIGNvbmZpZy5ub2RlKSB7CiAgICAgICAgaWYgKGhhc093blByb3BlcnR5JDMuY2FsbChjb25maWcubm9kZSwgbmFtZSkpIHsKICAgICAgICAgICAgY29uc3Qgbm9kZVR5cGUgPSBjb25maWcubm9kZVtuYW1lXTsKCiAgICAgICAgICAgIGlmICghbm9kZVR5cGUuc3RydWN0dXJlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NlZCBgc3RydWN0dXJlYCBmaWVsZCBpbiBgJyArIG5hbWUgKyAnYCBub2RlIHR5cGUgZGVmaW5pdGlvbicpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0eXBlc1tuYW1lXSA9IGdldFdhbGtlcnNGcm9tU3RydWN0dXJlKG5hbWUsIG5vZGVUeXBlKTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIHR5cGVzOwp9CgpmdW5jdGlvbiBjcmVhdGVUeXBlSXRlcmF0b3IoY29uZmlnLCByZXZlcnNlKSB7CiAgICBjb25zdCBmaWVsZHMgPSBjb25maWcuZmllbGRzLnNsaWNlKCk7CiAgICBjb25zdCBjb250ZXh0TmFtZSA9IGNvbmZpZy5jb250ZXh0OwogICAgY29uc3QgdXNlQ29udGV4dCA9IHR5cGVvZiBjb250ZXh0TmFtZSA9PT0gJ3N0cmluZyc7CgogICAgaWYgKHJldmVyc2UpIHsKICAgICAgICBmaWVsZHMucmV2ZXJzZSgpOwogICAgfQoKICAgIHJldHVybiBmdW5jdGlvbihub2RlLCBjb250ZXh0LCB3YWxrLCB3YWxrUmVkdWNlcikgewogICAgICAgIGxldCBwcmV2Q29udGV4dFZhbHVlOwoKICAgICAgICBpZiAodXNlQ29udGV4dCkgewogICAgICAgICAgICBwcmV2Q29udGV4dFZhbHVlID0gY29udGV4dFtjb250ZXh0TmFtZV07CiAgICAgICAgICAgIGNvbnRleHRbY29udGV4dE5hbWVdID0gbm9kZTsKICAgICAgICB9CgogICAgICAgIGZvciAoY29uc3QgZmllbGQgb2YgZmllbGRzKSB7CiAgICAgICAgICAgIGNvbnN0IHJlZiA9IG5vZGVbZmllbGQubmFtZV07CgogICAgICAgICAgICBpZiAoIWZpZWxkLm51bGxhYmxlIHx8IHJlZikgewogICAgICAgICAgICAgICAgaWYgKGZpZWxkLnR5cGUgPT09ICdsaXN0JykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJyZWFrV2FsayA9IHJldmVyc2UKICAgICAgICAgICAgICAgICAgICAgICAgPyByZWYucmVkdWNlUmlnaHQod2Fsa1JlZHVjZXIsIGZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICA6IHJlZi5yZWR1Y2Uod2Fsa1JlZHVjZXIsIGZhbHNlKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGJyZWFrV2FsaykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHdhbGsocmVmKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodXNlQ29udGV4dCkgewogICAgICAgICAgICBjb250ZXh0W2NvbnRleHROYW1lXSA9IHByZXZDb250ZXh0VmFsdWU7CiAgICAgICAgfQogICAgfTsKfQoKZnVuY3Rpb24gY3JlYXRlRmFzdFRyYXZlcmFsTWFwKHsKICAgIFN0eWxlU2hlZXQsCiAgICBBdHJ1bGUsCiAgICBSdWxlLAogICAgQmxvY2ssCiAgICBEZWNsYXJhdGlvbkxpc3QKfSkgewogICAgcmV0dXJuIHsKICAgICAgICBBdHJ1bGU6IHsKICAgICAgICAgICAgU3R5bGVTaGVldCwKICAgICAgICAgICAgQXRydWxlLAogICAgICAgICAgICBSdWxlLAogICAgICAgICAgICBCbG9jawogICAgICAgIH0sCiAgICAgICAgUnVsZTogewogICAgICAgICAgICBTdHlsZVNoZWV0LAogICAgICAgICAgICBBdHJ1bGUsCiAgICAgICAgICAgIFJ1bGUsCiAgICAgICAgICAgIEJsb2NrCiAgICAgICAgfSwKICAgICAgICBEZWNsYXJhdGlvbjogewogICAgICAgICAgICBTdHlsZVNoZWV0LAogICAgICAgICAgICBBdHJ1bGUsCiAgICAgICAgICAgIFJ1bGUsCiAgICAgICAgICAgIEJsb2NrLAogICAgICAgICAgICBEZWNsYXJhdGlvbkxpc3QKICAgICAgICB9CiAgICB9Owp9CgpmdW5jdGlvbiBjcmVhdGVXYWxrZXIoY29uZmlnKSB7CiAgICBjb25zdCB0eXBlcyA9IGdldFR5cGVzRnJvbUNvbmZpZyhjb25maWcpOwogICAgY29uc3QgaXRlcmF0b3JzTmF0dXJhbCA9IHt9OwogICAgY29uc3QgaXRlcmF0b3JzUmV2ZXJzZSA9IHt9OwogICAgY29uc3QgYnJlYWtXYWxrID0gU3ltYm9sKCdicmVhay13YWxrJyk7CiAgICBjb25zdCBza2lwTm9kZSA9IFN5bWJvbCgnc2tpcC1ub2RlJyk7CgogICAgZm9yIChjb25zdCBuYW1lIGluIHR5cGVzKSB7CiAgICAgICAgaWYgKGhhc093blByb3BlcnR5JDMuY2FsbCh0eXBlcywgbmFtZSkgJiYgdHlwZXNbbmFtZV0gIT09IG51bGwpIHsKICAgICAgICAgICAgaXRlcmF0b3JzTmF0dXJhbFtuYW1lXSA9IGNyZWF0ZVR5cGVJdGVyYXRvcih0eXBlc1tuYW1lXSwgZmFsc2UpOwogICAgICAgICAgICBpdGVyYXRvcnNSZXZlcnNlW25hbWVdID0gY3JlYXRlVHlwZUl0ZXJhdG9yKHR5cGVzW25hbWVdLCB0cnVlKTsKICAgICAgICB9CiAgICB9CgogICAgY29uc3QgZmFzdFRyYXZlcnNhbEl0ZXJhdG9yc05hdHVyYWwgPSBjcmVhdGVGYXN0VHJhdmVyYWxNYXAoaXRlcmF0b3JzTmF0dXJhbCk7CiAgICBjb25zdCBmYXN0VHJhdmVyc2FsSXRlcmF0b3JzUmV2ZXJzZSA9IGNyZWF0ZUZhc3RUcmF2ZXJhbE1hcChpdGVyYXRvcnNSZXZlcnNlKTsKCiAgICBjb25zdCB3YWxrID0gZnVuY3Rpb24ocm9vdCwgb3B0aW9ucykgewogICAgICAgIGZ1bmN0aW9uIHdhbGtOb2RlKG5vZGUsIGl0ZW0sIGxpc3QpIHsKICAgICAgICAgICAgY29uc3QgZW50ZXJSZXQgPSBlbnRlci5jYWxsKGNvbnRleHQsIG5vZGUsIGl0ZW0sIGxpc3QpOwoKICAgICAgICAgICAgaWYgKGVudGVyUmV0ID09PSBicmVha1dhbGspIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZW50ZXJSZXQgPT09IHNraXBOb2RlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpdGVyYXRvcnMuaGFzT3duUHJvcGVydHkobm9kZS50eXBlKSkgewogICAgICAgICAgICAgICAgaWYgKGl0ZXJhdG9yc1tub2RlLnR5cGVdKG5vZGUsIGNvbnRleHQsIHdhbGtOb2RlLCB3YWxrUmVkdWNlcikpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGxlYXZlLmNhbGwoY29udGV4dCwgbm9kZSwgaXRlbSwgbGlzdCkgPT09IGJyZWFrV2FsaykgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGxldCBlbnRlciA9IG5vb3AkMjsKICAgICAgICBsZXQgbGVhdmUgPSBub29wJDI7CiAgICAgICAgbGV0IGl0ZXJhdG9ycyA9IGl0ZXJhdG9yc05hdHVyYWw7CiAgICAgICAgbGV0IHdhbGtSZWR1Y2VyID0gKHJldCwgZGF0YSwgaXRlbSwgbGlzdCkgPT4gcmV0IHx8IHdhbGtOb2RlKGRhdGEsIGl0ZW0sIGxpc3QpOwogICAgICAgIGNvbnN0IGNvbnRleHQgPSB7CiAgICAgICAgICAgIGJyZWFrOiBicmVha1dhbGssCiAgICAgICAgICAgIHNraXA6IHNraXBOb2RlLAoKICAgICAgICAgICAgcm9vdCwKICAgICAgICAgICAgc3R5bGVzaGVldDogbnVsbCwKICAgICAgICAgICAgYXRydWxlOiBudWxsLAogICAgICAgICAgICBhdHJ1bGVQcmVsdWRlOiBudWxsLAogICAgICAgICAgICBydWxlOiBudWxsLAogICAgICAgICAgICBzZWxlY3RvcjogbnVsbCwKICAgICAgICAgICAgYmxvY2s6IG51bGwsCiAgICAgICAgICAgIGRlY2xhcmF0aW9uOiBudWxsLAogICAgICAgICAgICBmdW5jdGlvbjogbnVsbAogICAgICAgIH07CgogICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICBlbnRlciA9IG9wdGlvbnM7CiAgICAgICAgfSBlbHNlIGlmIChvcHRpb25zKSB7CiAgICAgICAgICAgIGVudGVyID0gZW5zdXJlRnVuY3Rpb24kMShvcHRpb25zLmVudGVyKTsKICAgICAgICAgICAgbGVhdmUgPSBlbnN1cmVGdW5jdGlvbiQxKG9wdGlvbnMubGVhdmUpOwoKICAgICAgICAgICAgaWYgKG9wdGlvbnMucmV2ZXJzZSkgewogICAgICAgICAgICAgICAgaXRlcmF0b3JzID0gaXRlcmF0b3JzUmV2ZXJzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG9wdGlvbnMudmlzaXQpIHsKICAgICAgICAgICAgICAgIGlmIChmYXN0VHJhdmVyc2FsSXRlcmF0b3JzTmF0dXJhbC5oYXNPd25Qcm9wZXJ0eShvcHRpb25zLnZpc2l0KSkgewogICAgICAgICAgICAgICAgICAgIGl0ZXJhdG9ycyA9IG9wdGlvbnMucmV2ZXJzZQogICAgICAgICAgICAgICAgICAgICAgICA/IGZhc3RUcmF2ZXJzYWxJdGVyYXRvcnNSZXZlcnNlW29wdGlvbnMudmlzaXRdCiAgICAgICAgICAgICAgICAgICAgICAgIDogZmFzdFRyYXZlcnNhbEl0ZXJhdG9yc05hdHVyYWxbb3B0aW9ucy52aXNpdF07CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF0eXBlcy5oYXNPd25Qcm9wZXJ0eShvcHRpb25zLnZpc2l0KSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQmFkIHZhbHVlIGAnICsgb3B0aW9ucy52aXNpdCArICdgIGZvciBgdmlzaXRgIG9wdGlvbiAoc2hvdWxkIGJlOiAnICsgT2JqZWN0LmtleXModHlwZXMpLnNvcnQoKS5qb2luKCcsICcpICsgJyknKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBlbnRlciA9IGludm9rZUZvclR5cGUoZW50ZXIsIG9wdGlvbnMudmlzaXQpOwogICAgICAgICAgICAgICAgbGVhdmUgPSBpbnZva2VGb3JUeXBlKGxlYXZlLCBvcHRpb25zLnZpc2l0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVudGVyID09PSBub29wJDIgJiYgbGVhdmUgPT09IG5vb3AkMikgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05laXRoZXIgYGVudGVyYCBub3IgYGxlYXZlYCB3YWxrZXIgaGFuZGxlciBpcyBzZXQgb3IgYm90aCBhcmVuXCd0IGEgZnVuY3Rpb24nKTsKICAgICAgICB9CgogICAgICAgIHdhbGtOb2RlKHJvb3QpOwogICAgfTsKCiAgICB3YWxrLmJyZWFrID0gYnJlYWtXYWxrOwogICAgd2Fsay5za2lwID0gc2tpcE5vZGU7CgogICAgd2Fsay5maW5kID0gZnVuY3Rpb24oYXN0LCBmbikgewogICAgICAgIGxldCBmb3VuZCA9IG51bGw7CgogICAgICAgIHdhbGsoYXN0LCBmdW5jdGlvbihub2RlLCBpdGVtLCBsaXN0KSB7CiAgICAgICAgICAgIGlmIChmbi5jYWxsKHRoaXMsIG5vZGUsIGl0ZW0sIGxpc3QpKSB7CiAgICAgICAgICAgICAgICBmb3VuZCA9IG5vZGU7CiAgICAgICAgICAgICAgICByZXR1cm4gYnJlYWtXYWxrOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBmb3VuZDsKICAgIH07CgogICAgd2Fsay5maW5kTGFzdCA9IGZ1bmN0aW9uKGFzdCwgZm4pIHsKICAgICAgICBsZXQgZm91bmQgPSBudWxsOwoKICAgICAgICB3YWxrKGFzdCwgewogICAgICAgICAgICByZXZlcnNlOiB0cnVlLAogICAgICAgICAgICBlbnRlcihub2RlLCBpdGVtLCBsaXN0KSB7CiAgICAgICAgICAgICAgICBpZiAoZm4uY2FsbCh0aGlzLCBub2RlLCBpdGVtLCBsaXN0KSkgewogICAgICAgICAgICAgICAgICAgIGZvdW5kID0gbm9kZTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYnJlYWtXYWxrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBmb3VuZDsKICAgIH07CgogICAgd2Fsay5maW5kQWxsID0gZnVuY3Rpb24oYXN0LCBmbikgewogICAgICAgIGNvbnN0IGZvdW5kID0gW107CgogICAgICAgIHdhbGsoYXN0LCBmdW5jdGlvbihub2RlLCBpdGVtLCBsaXN0KSB7CiAgICAgICAgICAgIGlmIChmbi5jYWxsKHRoaXMsIG5vZGUsIGl0ZW0sIGxpc3QpKSB7CiAgICAgICAgICAgICAgICBmb3VuZC5wdXNoKG5vZGUpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBmb3VuZDsKICAgIH07CgogICAgcmV0dXJuIHdhbGs7Cn0KCmZ1bmN0aW9uIG5vb3AkMSh2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlOwp9CgpmdW5jdGlvbiBnZW5lcmF0ZU11bHRpcGxpZXIobXVsdGlwbGllcikgewogICAgY29uc3QgeyBtaW4sIG1heCwgY29tbWEgfSA9IG11bHRpcGxpZXI7CgogICAgaWYgKG1pbiA9PT0gMCAmJiBtYXggPT09IDApIHsKICAgICAgICByZXR1cm4gY29tbWEgPyAnIz8nIDogJyonOwogICAgfQoKICAgIGlmIChtaW4gPT09IDAgJiYgbWF4ID09PSAxKSB7CiAgICAgICAgcmV0dXJuICc/JzsKICAgIH0KCiAgICBpZiAobWluID09PSAxICYmIG1heCA9PT0gMCkgewogICAgICAgIHJldHVybiBjb21tYSA/ICcjJyA6ICcrJzsKICAgIH0KCiAgICBpZiAobWluID09PSAxICYmIG1heCA9PT0gMSkgewogICAgICAgIHJldHVybiAnJzsKICAgIH0KCiAgICByZXR1cm4gKAogICAgICAgIChjb21tYSA/ICcjJyA6ICcnKSArCiAgICAgICAgKG1pbiA9PT0gbWF4CiAgICAgICAgICAgID8gJ3snICsgbWluICsgJ30nCiAgICAgICAgICAgIDogJ3snICsgbWluICsgJywnICsgKG1heCAhPT0gMCA/IG1heCA6ICcnKSArICd9JwogICAgICAgICkKICAgICk7Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlVHlwZU9wdHMobm9kZSkgewogICAgc3dpdGNoIChub2RlLnR5cGUpIHsKICAgICAgICBjYXNlICdSYW5nZSc6CiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAnIFsnICsKICAgICAgICAgICAgICAgIChub2RlLm1pbiA9PT0gbnVsbCA/ICct4oieJyA6IG5vZGUubWluKSArCiAgICAgICAgICAgICAgICAnLCcgKwogICAgICAgICAgICAgICAgKG5vZGUubWF4ID09PSBudWxsID8gJ+KInicgOiBub2RlLm1heCkgKwogICAgICAgICAgICAgICAgJ10nCiAgICAgICAgICAgICk7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5rbm93biBub2RlIHR5cGUgYCcgKyBub2RlLnR5cGUgKyAnYCcpOwogICAgfQp9CgpmdW5jdGlvbiBnZW5lcmF0ZVNlcXVlbmNlKG5vZGUsIGRlY29yYXRlLCBmb3JjZUJyYWNlcywgY29tcGFjdCkgewogICAgY29uc3QgY29tYmluYXRvciA9IG5vZGUuY29tYmluYXRvciA9PT0gJyAnIHx8IGNvbXBhY3QgPyBub2RlLmNvbWJpbmF0b3IgOiAnICcgKyBub2RlLmNvbWJpbmF0b3IgKyAnICc7CiAgICBjb25zdCByZXN1bHQgPSBub2RlLnRlcm1zCiAgICAgICAgLm1hcCh0ZXJtID0+IGludGVybmFsR2VuZXJhdGUodGVybSwgZGVjb3JhdGUsIGZvcmNlQnJhY2VzLCBjb21wYWN0KSkKICAgICAgICAuam9pbihjb21iaW5hdG9yKTsKCiAgICBpZiAobm9kZS5leHBsaWNpdCB8fCBmb3JjZUJyYWNlcykgewogICAgICAgIHJldHVybiAoY29tcGFjdCB8fCByZXN1bHRbMF0gPT09ICcsJyA/ICdbJyA6ICdbICcpICsgcmVzdWx0ICsgKGNvbXBhY3QgPyAnXScgOiAnIF0nKTsKICAgIH0KCiAgICByZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiBpbnRlcm5hbEdlbmVyYXRlKG5vZGUsIGRlY29yYXRlLCBmb3JjZUJyYWNlcywgY29tcGFjdCkgewogICAgbGV0IHJlc3VsdDsKCiAgICBzd2l0Y2ggKG5vZGUudHlwZSkgewogICAgICAgIGNhc2UgJ0dyb3VwJzoKICAgICAgICAgICAgcmVzdWx0ID0KICAgICAgICAgICAgICAgIGdlbmVyYXRlU2VxdWVuY2Uobm9kZSwgZGVjb3JhdGUsIGZvcmNlQnJhY2VzLCBjb21wYWN0KSArCiAgICAgICAgICAgICAgICAobm9kZS5kaXNhbGxvd0VtcHR5ID8gJyEnIDogJycpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnTXVsdGlwbGllcic6CiAgICAgICAgICAgIC8vIHJldHVybiBzaW5jZSBub2RlIGlzIGEgY29tcG9zaXRpb24KICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgIGludGVybmFsR2VuZXJhdGUobm9kZS50ZXJtLCBkZWNvcmF0ZSwgZm9yY2VCcmFjZXMsIGNvbXBhY3QpICsKICAgICAgICAgICAgICAgIGRlY29yYXRlKGdlbmVyYXRlTXVsdGlwbGllcihub2RlKSwgbm9kZSkKICAgICAgICAgICAgKTsKCiAgICAgICAgY2FzZSAnVHlwZSc6CiAgICAgICAgICAgIHJlc3VsdCA9ICc8JyArIG5vZGUubmFtZSArIChub2RlLm9wdHMgPyBkZWNvcmF0ZShnZW5lcmF0ZVR5cGVPcHRzKG5vZGUub3B0cyksIG5vZGUub3B0cykgOiAnJykgKyAnPic7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdQcm9wZXJ0eSc6CiAgICAgICAgICAgIHJlc3VsdCA9ICc8XCcnICsgbm9kZS5uYW1lICsgJ1wnPic7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdLZXl3b3JkJzoKICAgICAgICAgICAgcmVzdWx0ID0gbm9kZS5uYW1lOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnQXRLZXl3b3JkJzoKICAgICAgICAgICAgcmVzdWx0ID0gJ0AnICsgbm9kZS5uYW1lOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAnRnVuY3Rpb24nOgogICAgICAgICAgICByZXN1bHQgPSBub2RlLm5hbWUgKyAnKCc7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICdTdHJpbmcnOgogICAgICAgIGNhc2UgJ1Rva2VuJzoKICAgICAgICAgICAgcmVzdWx0ID0gbm9kZS52YWx1ZTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgJ0NvbW1hJzoKICAgICAgICAgICAgcmVzdWx0ID0gJywnOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIG5vZGUgdHlwZSBgJyArIG5vZGUudHlwZSArICdgJyk7CiAgICB9CgogICAgcmV0dXJuIGRlY29yYXRlKHJlc3VsdCwgbm9kZSk7Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJEcobm9kZSwgb3B0aW9ucykgewogICAgbGV0IGRlY29yYXRlID0gbm9vcCQxOwogICAgbGV0IGZvcmNlQnJhY2VzID0gZmFsc2U7CiAgICBsZXQgY29tcGFjdCA9IGZhbHNlOwoKICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIGRlY29yYXRlID0gb3B0aW9uczsKICAgIH0gZWxzZSBpZiAob3B0aW9ucykgewogICAgICAgIGZvcmNlQnJhY2VzID0gQm9vbGVhbihvcHRpb25zLmZvcmNlQnJhY2VzKTsKICAgICAgICBjb21wYWN0ID0gQm9vbGVhbihvcHRpb25zLmNvbXBhY3QpOwogICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5kZWNvcmF0ZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICBkZWNvcmF0ZSA9IG9wdGlvbnMuZGVjb3JhdGU7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBpbnRlcm5hbEdlbmVyYXRlKG5vZGUsIGRlY29yYXRlLCBmb3JjZUJyYWNlcywgY29tcGFjdCk7Cn0KCmNvbnN0IGRlZmF1bHRMb2MgPSB7IG9mZnNldDogMCwgbGluZTogMSwgY29sdW1uOiAxIH07CgpmdW5jdGlvbiBsb2NhdGVNaXNtYXRjaChtYXRjaFJlc3VsdCwgbm9kZSkgewogICAgY29uc3QgdG9rZW5zID0gbWF0Y2hSZXN1bHQudG9rZW5zOwogICAgY29uc3QgbG9uZ2VzdE1hdGNoID0gbWF0Y2hSZXN1bHQubG9uZ2VzdE1hdGNoOwogICAgY29uc3QgbWlzbWF0Y2hOb2RlID0gbG9uZ2VzdE1hdGNoIDwgdG9rZW5zLmxlbmd0aCA/IHRva2Vuc1tsb25nZXN0TWF0Y2hdLm5vZGUgfHwgbnVsbCA6IG51bGw7CiAgICBjb25zdCBiYWROb2RlID0gbWlzbWF0Y2hOb2RlICE9PSBub2RlID8gbWlzbWF0Y2hOb2RlIDogbnVsbDsKICAgIGxldCBtaXNtYXRjaE9mZnNldCA9IDA7CiAgICBsZXQgbWlzbWF0Y2hMZW5ndGggPSAwOwogICAgbGV0IGVudHJpZXMgPSAwOwogICAgbGV0IGNzcyA9ICcnOwogICAgbGV0IHN0YXJ0OwogICAgbGV0IGVuZDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IHRva2VuID0gdG9rZW5zW2ldLnZhbHVlOwoKICAgICAgICBpZiAoaSA9PT0gbG9uZ2VzdE1hdGNoKSB7CiAgICAgICAgICAgIG1pc21hdGNoTGVuZ3RoID0gdG9rZW4ubGVuZ3RoOwogICAgICAgICAgICBtaXNtYXRjaE9mZnNldCA9IGNzcy5sZW5ndGg7CiAgICAgICAgfQoKICAgICAgICBpZiAoYmFkTm9kZSAhPT0gbnVsbCAmJiB0b2tlbnNbaV0ubm9kZSA9PT0gYmFkTm9kZSkgewogICAgICAgICAgICBpZiAoaSA8PSBsb25nZXN0TWF0Y2gpIHsKICAgICAgICAgICAgICAgIGVudHJpZXMrKzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGVudHJpZXMgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBjc3MgKz0gdG9rZW47CiAgICB9CgogICAgaWYgKGxvbmdlc3RNYXRjaCA9PT0gdG9rZW5zLmxlbmd0aCB8fCBlbnRyaWVzID4gMSkgeyAvLyBsYXN0CiAgICAgICAgc3RhcnQgPSBmcm9tTG9jKGJhZE5vZGUgfHwgbm9kZSwgJ2VuZCcpIHx8IGJ1aWxkTG9jKGRlZmF1bHRMb2MsIGNzcyk7CiAgICAgICAgZW5kID0gYnVpbGRMb2Moc3RhcnQpOwogICAgfSBlbHNlIHsKICAgICAgICBzdGFydCA9IGZyb21Mb2MoYmFkTm9kZSwgJ3N0YXJ0JykgfHwKICAgICAgICAgICAgYnVpbGRMb2MoZnJvbUxvYyhub2RlLCAnc3RhcnQnKSB8fCBkZWZhdWx0TG9jLCBjc3Muc2xpY2UoMCwgbWlzbWF0Y2hPZmZzZXQpKTsKICAgICAgICBlbmQgPSBmcm9tTG9jKGJhZE5vZGUsICdlbmQnKSB8fAogICAgICAgICAgICBidWlsZExvYyhzdGFydCwgY3NzLnN1YnN0cihtaXNtYXRjaE9mZnNldCwgbWlzbWF0Y2hMZW5ndGgpKTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIGNzcywKICAgICAgICBtaXNtYXRjaE9mZnNldCwKICAgICAgICBtaXNtYXRjaExlbmd0aCwKICAgICAgICBzdGFydCwKICAgICAgICBlbmQKICAgIH07Cn0KCmZ1bmN0aW9uIGZyb21Mb2Mobm9kZSwgcG9pbnQpIHsKICAgIGNvbnN0IHZhbHVlID0gbm9kZSAmJiBub2RlLmxvYyAmJiBub2RlLmxvY1twb2ludF07CgogICAgaWYgKHZhbHVlKSB7CiAgICAgICAgcmV0dXJuICdsaW5lJyBpbiB2YWx1ZSA/IGJ1aWxkTG9jKHZhbHVlKSA6IHZhbHVlOwogICAgfQoKICAgIHJldHVybiBudWxsOwp9CgpmdW5jdGlvbiBidWlsZExvYyh7IG9mZnNldCwgbGluZSwgY29sdW1uIH0sIGV4dHJhKSB7CiAgICBjb25zdCBsb2MgPSB7CiAgICAgICAgb2Zmc2V0LAogICAgICAgIGxpbmUsCiAgICAgICAgY29sdW1uCiAgICB9OwoKICAgIGlmIChleHRyYSkgewogICAgICAgIGNvbnN0IGxpbmVzID0gZXh0cmEuc3BsaXQoL1xufFxyXG4/fFxmLyk7CgogICAgICAgIGxvYy5vZmZzZXQgKz0gZXh0cmEubGVuZ3RoOwogICAgICAgIGxvYy5saW5lICs9IGxpbmVzLmxlbmd0aCAtIDE7CiAgICAgICAgbG9jLmNvbHVtbiA9IGxpbmVzLmxlbmd0aCA9PT0gMSA/IGxvYy5jb2x1bW4gKyBleHRyYS5sZW5ndGggOiBsaW5lcy5wb3AoKS5sZW5ndGggKyAxOwogICAgfQoKICAgIHJldHVybiBsb2M7Cn0KCmNvbnN0IFN5bnRheFJlZmVyZW5jZUVycm9yID0gZnVuY3Rpb24odHlwZSwgcmVmZXJlbmNlTmFtZSkgewogICAgY29uc3QgZXJyb3IgPSBjcmVhdGVDdXN0b21FcnJvcigKICAgICAgICAnU3ludGF4UmVmZXJlbmNlRXJyb3InLAogICAgICAgIHR5cGUgKyAocmVmZXJlbmNlTmFtZSA/ICcgYCcgKyByZWZlcmVuY2VOYW1lICsgJ2AnIDogJycpCiAgICApOwoKICAgIGVycm9yLnJlZmVyZW5jZSA9IHJlZmVyZW5jZU5hbWU7CgogICAgcmV0dXJuIGVycm9yOwp9OwoKY29uc3QgU3ludGF4TWF0Y2hFcnJvciA9IGZ1bmN0aW9uKG1lc3NhZ2UsIHN5bnRheCwgbm9kZSwgbWF0Y2hSZXN1bHQpIHsKICAgIGNvbnN0IGVycm9yID0gY3JlYXRlQ3VzdG9tRXJyb3IoJ1N5bnRheE1hdGNoRXJyb3InLCBtZXNzYWdlKTsKICAgIGNvbnN0IHsKICAgICAgICBjc3MsCiAgICAgICAgbWlzbWF0Y2hPZmZzZXQsCiAgICAgICAgbWlzbWF0Y2hMZW5ndGgsCiAgICAgICAgc3RhcnQsCiAgICAgICAgZW5kCiAgICB9ID0gbG9jYXRlTWlzbWF0Y2gobWF0Y2hSZXN1bHQsIG5vZGUpOwoKICAgIGVycm9yLnJhd01lc3NhZ2UgPSBtZXNzYWdlOwogICAgZXJyb3Iuc3ludGF4ID0gc3ludGF4ID8gZ2VuZXJhdGUkRyhzeW50YXgpIDogJzxnZW5lcmljPic7CiAgICBlcnJvci5jc3MgPSBjc3M7CiAgICBlcnJvci5taXNtYXRjaE9mZnNldCA9IG1pc21hdGNoT2Zmc2V0OwogICAgZXJyb3IubWlzbWF0Y2hMZW5ndGggPSBtaXNtYXRjaExlbmd0aDsKICAgIGVycm9yLm1lc3NhZ2UgPSBtZXNzYWdlICsgJ1xuJyArCiAgICAgICAgJyAgc3ludGF4OiAnICsgZXJyb3Iuc3ludGF4ICsgJ1xuJyArCiAgICAgICAgJyAgIHZhbHVlOiAnICsgKGNzcyB8fCAnPGVtcHR5IHN0cmluZz4nKSArICdcbicgKwogICAgICAgICcgIC0tLS0tLS0tJyArIG5ldyBBcnJheShlcnJvci5taXNtYXRjaE9mZnNldCArIDEpLmpvaW4oJy0nKSArICdeJzsKCiAgICBPYmplY3QuYXNzaWduKGVycm9yLCBzdGFydCk7CiAgICBlcnJvci5sb2MgPSB7CiAgICAgICAgc291cmNlOiAobm9kZSAmJiBub2RlLmxvYyAmJiBub2RlLmxvYy5zb3VyY2UpIHx8ICc8dW5rbm93bj4nLAogICAgICAgIHN0YXJ0LAogICAgICAgIGVuZAogICAgfTsKCiAgICByZXR1cm4gZXJyb3I7Cn07Cgpjb25zdCBrZXl3b3JkcyA9IG5ldyBNYXAoKTsKY29uc3QgcHJvcGVydGllcyA9IG5ldyBNYXAoKTsKY29uc3QgSFlQSEVOTUlOVVMkNSA9IDQ1OyAvLyAnLScuY2hhckNvZGVBdCgpCgpjb25zdCBrZXl3b3JkID0gZ2V0S2V5d29yZERlc2NyaXB0b3I7CmNvbnN0IHByb3BlcnR5ID0gZ2V0UHJvcGVydHlEZXNjcmlwdG9yOwpmdW5jdGlvbiBpc0N1c3RvbVByb3BlcnR5KHN0ciwgb2Zmc2V0KSB7CiAgICBvZmZzZXQgPSBvZmZzZXQgfHwgMDsKCiAgICByZXR1cm4gc3RyLmxlbmd0aCAtIG9mZnNldCA+PSAyICYmCiAgICAgICAgICAgc3RyLmNoYXJDb2RlQXQob2Zmc2V0KSA9PT0gSFlQSEVOTUlOVVMkNSAmJgogICAgICAgICAgIHN0ci5jaGFyQ29kZUF0KG9mZnNldCArIDEpID09PSBIWVBIRU5NSU5VUyQ1Owp9CgpmdW5jdGlvbiBnZXRWZW5kb3JQcmVmaXgoc3RyLCBvZmZzZXQpIHsKICAgIG9mZnNldCA9IG9mZnNldCB8fCAwOwoKICAgIC8vIHZlcmRvciBwcmVmaXggc2hvdWxkIGJlIGF0IGxlYXN0IDMgY2hhcnMgbGVuZ3RoCiAgICBpZiAoc3RyLmxlbmd0aCAtIG9mZnNldCA+PSAzKSB7CiAgICAgICAgLy8gdmVuZG9yIHByZWZpeCBzdGFydHMgd2l0aCBoeXBlciBtaW51cyBmb2xsb3dpbmcgbm9uLWh5cGVyIG1pbnVzCiAgICAgICAgaWYgKHN0ci5jaGFyQ29kZUF0KG9mZnNldCkgPT09IEhZUEhFTk1JTlVTJDUgJiYKICAgICAgICAgICAgc3RyLmNoYXJDb2RlQXQob2Zmc2V0ICsgMSkgIT09IEhZUEhFTk1JTlVTJDUpIHsKICAgICAgICAgICAgLy8gdmVuZG9yIHByZWZpeCBzaG91bGQgY29udGFpbiBhIGh5cGVyIG1pbnVzIGF0IHRoZSBlbmRpbmcKICAgICAgICAgICAgY29uc3Qgc2Vjb25kRGFzaEluZGV4ID0gc3RyLmluZGV4T2YoJy0nLCBvZmZzZXQgKyAyKTsKCiAgICAgICAgICAgIGlmIChzZWNvbmREYXNoSW5kZXggIT09IC0xKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3RyLnN1YnN0cmluZyhvZmZzZXQsIHNlY29uZERhc2hJbmRleCArIDEpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiAnJzsKfQoKZnVuY3Rpb24gZ2V0S2V5d29yZERlc2NyaXB0b3Ioa2V5d29yZCkgewogICAgaWYgKGtleXdvcmRzLmhhcyhrZXl3b3JkKSkgewogICAgICAgIHJldHVybiBrZXl3b3Jkcy5nZXQoa2V5d29yZCk7CiAgICB9CgogICAgY29uc3QgbmFtZSA9IGtleXdvcmQudG9Mb3dlckNhc2UoKTsKICAgIGxldCBkZXNjcmlwdG9yID0ga2V5d29yZHMuZ2V0KG5hbWUpOwoKICAgIGlmIChkZXNjcmlwdG9yID09PSB1bmRlZmluZWQpIHsKICAgICAgICBjb25zdCBjdXN0b20gPSBpc0N1c3RvbVByb3BlcnR5KG5hbWUsIDApOwogICAgICAgIGNvbnN0IHZlbmRvciA9ICFjdXN0b20gPyBnZXRWZW5kb3JQcmVmaXgobmFtZSwgMCkgOiAnJzsKICAgICAgICBkZXNjcmlwdG9yID0gT2JqZWN0LmZyZWV6ZSh7CiAgICAgICAgICAgIGJhc2VuYW1lOiBuYW1lLnN1YnN0cih2ZW5kb3IubGVuZ3RoKSwKICAgICAgICAgICAgbmFtZSwKICAgICAgICAgICAgcHJlZml4OiB2ZW5kb3IsCiAgICAgICAgICAgIHZlbmRvciwKICAgICAgICAgICAgY3VzdG9tCiAgICAgICAgfSk7CiAgICB9CgogICAga2V5d29yZHMuc2V0KGtleXdvcmQsIGRlc2NyaXB0b3IpOwoKICAgIHJldHVybiBkZXNjcmlwdG9yOwp9CgpmdW5jdGlvbiBnZXRQcm9wZXJ0eURlc2NyaXB0b3IocHJvcGVydHkpIHsKICAgIGlmIChwcm9wZXJ0aWVzLmhhcyhwcm9wZXJ0eSkpIHsKICAgICAgICByZXR1cm4gcHJvcGVydGllcy5nZXQocHJvcGVydHkpOwogICAgfQoKICAgIGxldCBuYW1lID0gcHJvcGVydHk7CiAgICBsZXQgaGFjayA9IHByb3BlcnR5WzBdOwoKICAgIGlmIChoYWNrID09PSAnLycpIHsKICAgICAgICBoYWNrID0gcHJvcGVydHlbMV0gPT09ICcvJyA/ICcvLycgOiAnLyc7CiAgICB9IGVsc2UgaWYgKGhhY2sgIT09ICdfJyAmJgogICAgICAgICAgICAgICBoYWNrICE9PSAnKicgJiYKICAgICAgICAgICAgICAgaGFjayAhPT0gJyQnICYmCiAgICAgICAgICAgICAgIGhhY2sgIT09ICcjJyAmJgogICAgICAgICAgICAgICBoYWNrICE9PSAnKycgJiYKICAgICAgICAgICAgICAgaGFjayAhPT0gJyYnKSB7CiAgICAgICAgaGFjayA9ICcnOwogICAgfQoKICAgIGNvbnN0IGN1c3RvbSA9IGlzQ3VzdG9tUHJvcGVydHkobmFtZSwgaGFjay5sZW5ndGgpOwoKICAgIC8vIHJlLXVzZSByZXN1bHQgd2hlbiBwb3NzaWJsZSAodGhlIHNhbWUgYXMgZm9yIGxvd2VyIGNhc2UpCiAgICBpZiAoIWN1c3RvbSkgewogICAgICAgIG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgaWYgKHByb3BlcnRpZXMuaGFzKG5hbWUpKSB7CiAgICAgICAgICAgIGNvbnN0IGRlc2NyaXB0b3IgPSBwcm9wZXJ0aWVzLmdldChuYW1lKTsKICAgICAgICAgICAgcHJvcGVydGllcy5zZXQocHJvcGVydHksIGRlc2NyaXB0b3IpOwogICAgICAgICAgICByZXR1cm4gZGVzY3JpcHRvcjsKICAgICAgICB9CiAgICB9CgogICAgY29uc3QgdmVuZG9yID0gIWN1c3RvbSA/IGdldFZlbmRvclByZWZpeChuYW1lLCBoYWNrLmxlbmd0aCkgOiAnJzsKICAgIGNvbnN0IHByZWZpeCA9IG5hbWUuc3Vic3RyKDAsIGhhY2subGVuZ3RoICsgdmVuZG9yLmxlbmd0aCk7CiAgICBjb25zdCBkZXNjcmlwdG9yID0gT2JqZWN0LmZyZWV6ZSh7CiAgICAgICAgYmFzZW5hbWU6IG5hbWUuc3Vic3RyKHByZWZpeC5sZW5ndGgpLAogICAgICAgIG5hbWU6IG5hbWUuc3Vic3RyKGhhY2subGVuZ3RoKSwKICAgICAgICBoYWNrLAogICAgICAgIHZlbmRvciwKICAgICAgICBwcmVmaXgsCiAgICAgICAgY3VzdG9tCiAgICB9KTsKCiAgICBwcm9wZXJ0aWVzLnNldChwcm9wZXJ0eSwgZGVzY3JpcHRvcik7CgogICAgcmV0dXJuIGRlc2NyaXB0b3I7Cn0KCi8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3MtY2FzY2FkZS01Lwpjb25zdCBjc3NXaWRlS2V5d29yZHMgPSBbCiAgICAnaW5pdGlhbCcsCiAgICAnaW5oZXJpdCcsCiAgICAndW5zZXQnLAogICAgJ3JldmVydCcsCiAgICAncmV2ZXJ0LWxheWVyJwpdOwoKY29uc3QgUExVU1NJR04kOCA9IDB4MDAyQjsgICAgLy8gVSswMDJCIFBMVVMgU0lHTiAoKykKY29uc3QgSFlQSEVOTUlOVVMkNCA9IDB4MDAyRDsgLy8gVSswMDJEIEhZUEhFTi1NSU5VUyAoLSkKY29uc3QgTiQzID0gMHgwMDZFOyAgICAgICAgICAgLy8gVSswMDZFIExBVElOIFNNQUxMIExFVFRFUiBOIChuKQpjb25zdCBESVNBTExPV19TSUdOJDEgPSB0cnVlOwpjb25zdCBBTExPV19TSUdOJDEgPSBmYWxzZTsKCmZ1bmN0aW9uIGlzRGVsaW0kMSh0b2tlbiwgY29kZSkgewogICAgcmV0dXJuIHRva2VuICE9PSBudWxsICYmIHRva2VuLnR5cGUgPT09IERlbGltICYmIHRva2VuLnZhbHVlLmNoYXJDb2RlQXQoMCkgPT09IGNvZGU7Cn0KCmZ1bmN0aW9uIHNraXBTQyh0b2tlbiwgb2Zmc2V0LCBnZXROZXh0VG9rZW4pIHsKICAgIHdoaWxlICh0b2tlbiAhPT0gbnVsbCAmJiAodG9rZW4udHlwZSA9PT0gV2hpdGVTcGFjZSQxIHx8IHRva2VuLnR5cGUgPT09IENvbW1lbnQkMSkpIHsKICAgICAgICB0b2tlbiA9IGdldE5leHRUb2tlbigrK29mZnNldCk7CiAgICB9CgogICAgcmV0dXJuIG9mZnNldDsKfQoKZnVuY3Rpb24gY2hlY2tJbnRlZ2VyJDEodG9rZW4sIHZhbHVlT2Zmc2V0LCBkaXNhbGxvd1NpZ24sIG9mZnNldCkgewogICAgaWYgKCF0b2tlbikgewogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIGNvbnN0IGNvZGUgPSB0b2tlbi52YWx1ZS5jaGFyQ29kZUF0KHZhbHVlT2Zmc2V0KTsKCiAgICBpZiAoY29kZSA9PT0gUExVU1NJR04kOCB8fCBjb2RlID09PSBIWVBIRU5NSU5VUyQ0KSB7CiAgICAgICAgaWYgKGRpc2FsbG93U2lnbikgewogICAgICAgICAgICAvLyBOdW1iZXIgc2lnbiBpcyBub3QgYWxsb3dlZAogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgdmFsdWVPZmZzZXQrKzsKICAgIH0KCiAgICBmb3IgKDsgdmFsdWVPZmZzZXQgPCB0b2tlbi52YWx1ZS5sZW5ndGg7IHZhbHVlT2Zmc2V0KyspIHsKICAgICAgICBpZiAoIWlzRGlnaXQodG9rZW4udmFsdWUuY2hhckNvZGVBdCh2YWx1ZU9mZnNldCkpKSB7CiAgICAgICAgICAgIC8vIEludGVnZXIgaXMgZXhwZWN0ZWQKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBvZmZzZXQgKyAxOwp9CgovLyAuLi4gPHNpZ25lZC1pbnRlZ2VyPgovLyAuLi4gWycrJyB8ICctJ10gPHNpZ25sZXNzLWludGVnZXI+CmZ1bmN0aW9uIGNvbnN1bWVCJDEodG9rZW4sIG9mZnNldF8sIGdldE5leHRUb2tlbikgewogICAgbGV0IHNpZ24gPSBmYWxzZTsKICAgIGxldCBvZmZzZXQgPSBza2lwU0ModG9rZW4sIG9mZnNldF8sIGdldE5leHRUb2tlbik7CgogICAgdG9rZW4gPSBnZXROZXh0VG9rZW4ob2Zmc2V0KTsKCiAgICBpZiAodG9rZW4gPT09IG51bGwpIHsKICAgICAgICByZXR1cm4gb2Zmc2V0XzsKICAgIH0KCiAgICBpZiAodG9rZW4udHlwZSAhPT0gTnVtYmVyJDIpIHsKICAgICAgICBpZiAoaXNEZWxpbSQxKHRva2VuLCBQTFVTU0lHTiQ4KSB8fCBpc0RlbGltJDEodG9rZW4sIEhZUEhFTk1JTlVTJDQpKSB7CiAgICAgICAgICAgIHNpZ24gPSB0cnVlOwogICAgICAgICAgICBvZmZzZXQgPSBza2lwU0MoZ2V0TmV4dFRva2VuKCsrb2Zmc2V0KSwgb2Zmc2V0LCBnZXROZXh0VG9rZW4pOwogICAgICAgICAgICB0b2tlbiA9IGdldE5leHRUb2tlbihvZmZzZXQpOwoKICAgICAgICAgICAgaWYgKHRva2VuID09PSBudWxsIHx8IHRva2VuLnR5cGUgIT09IE51bWJlciQyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBvZmZzZXRfOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoIXNpZ24pIHsKICAgICAgICBjb25zdCBjb2RlID0gdG9rZW4udmFsdWUuY2hhckNvZGVBdCgwKTsKICAgICAgICBpZiAoY29kZSAhPT0gUExVU1NJR04kOCAmJiBjb2RlICE9PSBIWVBIRU5NSU5VUyQ0KSB7CiAgICAgICAgICAgIC8vIE51bWJlciBzaWduIGlzIGV4cGVjdGVkCiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gY2hlY2tJbnRlZ2VyJDEodG9rZW4sIHNpZ24gPyAwIDogMSwgc2lnbiwgb2Zmc2V0KTsKfQoKLy8gQW4rQiBtaWNyb3N5bnRheCBodHRwczovL3d3dy53My5vcmcvVFIvY3NzLXN5bnRheC0zLyNhbmIKZnVuY3Rpb24gYW5QbHVzQih0b2tlbiwgZ2V0TmV4dFRva2VuKSB7CiAgICAvKiBlc2xpbnQtZGlzYWJsZSBicmFjZS1zdHlsZSovCiAgICBsZXQgb2Zmc2V0ID0gMDsKCiAgICBpZiAoIXRva2VuKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgLy8gPGludGVnZXI+CiAgICBpZiAodG9rZW4udHlwZSA9PT0gTnVtYmVyJDIpIHsKICAgICAgICByZXR1cm4gY2hlY2tJbnRlZ2VyJDEodG9rZW4sIDAsIEFMTE9XX1NJR04kMSwgb2Zmc2V0KTsgLy8gYgogICAgfQoKICAgIC8vIC1uCiAgICAvLyAtbiA8c2lnbmVkLWludGVnZXI+CiAgICAvLyAtbiBbJysnIHwgJy0nXSA8c2lnbmxlc3MtaW50ZWdlcj4KICAgIC8vIC1uLSA8c2lnbmxlc3MtaW50ZWdlcj4KICAgIC8vIDxkYXNobmRhc2hkaWdpdC1pZGVudD4KICAgIGVsc2UgaWYgKHRva2VuLnR5cGUgPT09IElkZW50ICYmIHRva2VuLnZhbHVlLmNoYXJDb2RlQXQoMCkgPT09IEhZUEhFTk1JTlVTJDQpIHsKICAgICAgICAvLyBleHBlY3QgMXN0IGNoYXIgaXMgTgogICAgICAgIGlmICghY21wQ2hhcih0b2tlbi52YWx1ZSwgMSwgTiQzKSkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIHN3aXRjaCAodG9rZW4udmFsdWUubGVuZ3RoKSB7CiAgICAgICAgICAgIC8vIC1uCiAgICAgICAgICAgIC8vIC1uIDxzaWduZWQtaW50ZWdlcj4KICAgICAgICAgICAgLy8gLW4gWycrJyB8ICctJ10gPHNpZ25sZXNzLWludGVnZXI+CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHJldHVybiBjb25zdW1lQiQxKGdldE5leHRUb2tlbigrK29mZnNldCksIG9mZnNldCwgZ2V0TmV4dFRva2VuKTsKCiAgICAgICAgICAgIC8vIC1uLSA8c2lnbmxlc3MtaW50ZWdlcj4KICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgaWYgKHRva2VuLnZhbHVlLmNoYXJDb2RlQXQoMikgIT09IEhZUEhFTk1JTlVTJDQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBvZmZzZXQgPSBza2lwU0MoZ2V0TmV4dFRva2VuKCsrb2Zmc2V0KSwgb2Zmc2V0LCBnZXROZXh0VG9rZW4pOwogICAgICAgICAgICAgICAgdG9rZW4gPSBnZXROZXh0VG9rZW4ob2Zmc2V0KTsKCiAgICAgICAgICAgICAgICByZXR1cm4gY2hlY2tJbnRlZ2VyJDEodG9rZW4sIDAsIERJU0FMTE9XX1NJR04kMSwgb2Zmc2V0KTsKCiAgICAgICAgICAgIC8vIDxkYXNobmRhc2hkaWdpdC1pZGVudD4KICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGlmICh0b2tlbi52YWx1ZS5jaGFyQ29kZUF0KDIpICE9PSBIWVBIRU5NSU5VUyQ0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIGNoZWNrSW50ZWdlciQxKHRva2VuLCAzLCBESVNBTExPV19TSUdOJDEsIG9mZnNldCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vICcrJz8gbgogICAgLy8gJysnPyBuIDxzaWduZWQtaW50ZWdlcj4KICAgIC8vICcrJz8gbiBbJysnIHwgJy0nXSA8c2lnbmxlc3MtaW50ZWdlcj4KICAgIC8vICcrJz8gbi0gPHNpZ25sZXNzLWludGVnZXI+CiAgICAvLyAnKyc/IDxuZGFzaGRpZ2l0LWlkZW50PgogICAgZWxzZSBpZiAodG9rZW4udHlwZSA9PT0gSWRlbnQgfHwgKGlzRGVsaW0kMSh0b2tlbiwgUExVU1NJR04kOCkgJiYgZ2V0TmV4dFRva2VuKG9mZnNldCArIDEpLnR5cGUgPT09IElkZW50KSkgewogICAgICAgIC8vIGp1c3QgaWdub3JlIGEgcGx1cwogICAgICAgIGlmICh0b2tlbi50eXBlICE9PSBJZGVudCkgewogICAgICAgICAgICB0b2tlbiA9IGdldE5leHRUb2tlbigrK29mZnNldCk7CiAgICAgICAgfQoKICAgICAgICBpZiAodG9rZW4gPT09IG51bGwgfHwgIWNtcENoYXIodG9rZW4udmFsdWUsIDAsIE4kMykpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICBzd2l0Y2ggKHRva2VuLnZhbHVlLmxlbmd0aCkgewogICAgICAgICAgICAvLyAnKyc/IG4KICAgICAgICAgICAgLy8gJysnPyBuIDxzaWduZWQtaW50ZWdlcj4KICAgICAgICAgICAgLy8gJysnPyBuIFsnKycgfCAnLSddIDxzaWdubGVzcy1pbnRlZ2VyPgogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICByZXR1cm4gY29uc3VtZUIkMShnZXROZXh0VG9rZW4oKytvZmZzZXQpLCBvZmZzZXQsIGdldE5leHRUb2tlbik7CgogICAgICAgICAgICAvLyAnKyc/IG4tIDxzaWdubGVzcy1pbnRlZ2VyPgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBpZiAodG9rZW4udmFsdWUuY2hhckNvZGVBdCgxKSAhPT0gSFlQSEVOTUlOVVMkNCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG9mZnNldCA9IHNraXBTQyhnZXROZXh0VG9rZW4oKytvZmZzZXQpLCBvZmZzZXQsIGdldE5leHRUb2tlbik7CiAgICAgICAgICAgICAgICB0b2tlbiA9IGdldE5leHRUb2tlbihvZmZzZXQpOwoKICAgICAgICAgICAgICAgIHJldHVybiBjaGVja0ludGVnZXIkMSh0b2tlbiwgMCwgRElTQUxMT1dfU0lHTiQxLCBvZmZzZXQpOwoKICAgICAgICAgICAgLy8gJysnPyA8bmRhc2hkaWdpdC1pZGVudD4KICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGlmICh0b2tlbi52YWx1ZS5jaGFyQ29kZUF0KDEpICE9PSBIWVBIRU5NSU5VUyQ0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIGNoZWNrSW50ZWdlciQxKHRva2VuLCAyLCBESVNBTExPV19TSUdOJDEsIG9mZnNldCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIDxuZGFzaGRpZ2l0LWRpbWVuc2lvbj4KICAgIC8vIDxuZGFzaC1kaW1lbnNpb24+IDxzaWdubGVzcy1pbnRlZ2VyPgogICAgLy8gPG4tZGltZW5zaW9uPgogICAgLy8gPG4tZGltZW5zaW9uPiA8c2lnbmVkLWludGVnZXI+CiAgICAvLyA8bi1kaW1lbnNpb24+IFsnKycgfCAnLSddIDxzaWdubGVzcy1pbnRlZ2VyPgogICAgZWxzZSBpZiAodG9rZW4udHlwZSA9PT0gRGltZW5zaW9uJDEpIHsKICAgICAgICBsZXQgY29kZSA9IHRva2VuLnZhbHVlLmNoYXJDb2RlQXQoMCk7CiAgICAgICAgbGV0IHNpZ24gPSBjb2RlID09PSBQTFVTU0lHTiQ4IHx8IGNvZGUgPT09IEhZUEhFTk1JTlVTJDQgPyAxIDogMDsKICAgICAgICBsZXQgaSA9IHNpZ247CgogICAgICAgIGZvciAoOyBpIDwgdG9rZW4udmFsdWUubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFpc0RpZ2l0KHRva2VuLnZhbHVlLmNoYXJDb2RlQXQoaSkpKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGkgPT09IHNpZ24pIHsKICAgICAgICAgICAgLy8gSW50ZWdlciBpcyBleHBlY3RlZAogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIGlmICghY21wQ2hhcih0b2tlbi52YWx1ZSwgaSwgTiQzKSkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIC8vIDxuLWRpbWVuc2lvbj4KICAgICAgICAvLyA8bi1kaW1lbnNpb24+IDxzaWduZWQtaW50ZWdlcj4KICAgICAgICAvLyA8bi1kaW1lbnNpb24+IFsnKycgfCAnLSddIDxzaWdubGVzcy1pbnRlZ2VyPgogICAgICAgIGlmIChpICsgMSA9PT0gdG9rZW4udmFsdWUubGVuZ3RoKSB7CiAgICAgICAgICAgIHJldHVybiBjb25zdW1lQiQxKGdldE5leHRUb2tlbigrK29mZnNldCksIG9mZnNldCwgZ2V0TmV4dFRva2VuKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodG9rZW4udmFsdWUuY2hhckNvZGVBdChpICsgMSkgIT09IEhZUEhFTk1JTlVTJDQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyA8bmRhc2gtZGltZW5zaW9uPiA8c2lnbmxlc3MtaW50ZWdlcj4KICAgICAgICAgICAgaWYgKGkgKyAyID09PSB0b2tlbi52YWx1ZS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIG9mZnNldCA9IHNraXBTQyhnZXROZXh0VG9rZW4oKytvZmZzZXQpLCBvZmZzZXQsIGdldE5leHRUb2tlbik7CiAgICAgICAgICAgICAgICB0b2tlbiA9IGdldE5leHRUb2tlbihvZmZzZXQpOwoKICAgICAgICAgICAgICAgIHJldHVybiBjaGVja0ludGVnZXIkMSh0b2tlbiwgMCwgRElTQUxMT1dfU0lHTiQxLCBvZmZzZXQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIDxuZGFzaGRpZ2l0LWRpbWVuc2lvbj4KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2hlY2tJbnRlZ2VyJDEodG9rZW4sIGkgKyAyLCBESVNBTExPV19TSUdOJDEsIG9mZnNldCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIDA7Cn0KCmNvbnN0IFBMVVNTSUdOJDcgPSAweDAwMkI7ICAgICAvLyBVKzAwMkIgUExVUyBTSUdOICgrKQpjb25zdCBIWVBIRU5NSU5VUyQzID0gMHgwMDJEOyAgLy8gVSswMDJEIEhZUEhFTi1NSU5VUyAoLSkKY29uc3QgUVVFU1RJT05NQVJLJDIgPSAweDAwM0Y7IC8vIFUrMDAzRiBRVUVTVElPTiBNQVJLICg/KQpjb25zdCBVJDEgPSAweDAwNzU7ICAgICAgICAgICAgLy8gVSswMDc1IExBVElOIFNNQUxMIExFVFRFUiBVICh1KQoKZnVuY3Rpb24gaXNEZWxpbSh0b2tlbiwgY29kZSkgewogICAgcmV0dXJuIHRva2VuICE9PSBudWxsICYmIHRva2VuLnR5cGUgPT09IERlbGltICYmIHRva2VuLnZhbHVlLmNoYXJDb2RlQXQoMCkgPT09IGNvZGU7Cn0KCmZ1bmN0aW9uIHN0YXJ0c1dpdGgkMSh0b2tlbiwgY29kZSkgewogICAgcmV0dXJuIHRva2VuLnZhbHVlLmNoYXJDb2RlQXQoMCkgPT09IGNvZGU7Cn0KCmZ1bmN0aW9uIGhleFNlcXVlbmNlKHRva2VuLCBvZmZzZXQsIGFsbG93RGFzaCkgewogICAgbGV0IGhleGxlbiA9IDA7CgogICAgZm9yIChsZXQgcG9zID0gb2Zmc2V0OyBwb3MgPCB0b2tlbi52YWx1ZS5sZW5ndGg7IHBvcysrKSB7CiAgICAgICAgY29uc3QgY29kZSA9IHRva2VuLnZhbHVlLmNoYXJDb2RlQXQocG9zKTsKCiAgICAgICAgaWYgKGNvZGUgPT09IEhZUEhFTk1JTlVTJDMgJiYgYWxsb3dEYXNoICYmIGhleGxlbiAhPT0gMCkgewogICAgICAgICAgICBoZXhTZXF1ZW5jZSh0b2tlbiwgb2Zmc2V0ICsgaGV4bGVuICsgMSwgZmFsc2UpOwogICAgICAgICAgICByZXR1cm4gNjsgLy8gZGlzc2FsbG93IGZvbGxvd2luZyBxdWVzdGlvbiBtYXJrcwogICAgICAgIH0KCiAgICAgICAgaWYgKCFpc0hleERpZ2l0KGNvZGUpKSB7CiAgICAgICAgICAgIHJldHVybiAwOyAvLyBub3QgYSBoZXggZGlnaXQKICAgICAgICB9CgogICAgICAgIGlmICgrK2hleGxlbiA+IDYpIHsKICAgICAgICAgICAgcmV0dXJuIDA7IC8vIHRvbyBtYW55IGhleCBkaWdpdHMKICAgICAgICB9ICAgIH0KCiAgICByZXR1cm4gaGV4bGVuOwp9CgpmdW5jdGlvbiB3aXRoUXVlc3Rpb25NYXJrU2VxdWVuY2UoY29uc3VtZWQsIGxlbmd0aCwgZ2V0TmV4dFRva2VuKSB7CiAgICBpZiAoIWNvbnN1bWVkKSB7CiAgICAgICAgcmV0dXJuIDA7IC8vIG5vdGhpbmcgY29uc3VtZWQKICAgIH0KCiAgICB3aGlsZSAoaXNEZWxpbShnZXROZXh0VG9rZW4obGVuZ3RoKSwgUVVFU1RJT05NQVJLJDIpKSB7CiAgICAgICAgaWYgKCsrY29uc3VtZWQgPiA2KSB7CiAgICAgICAgICAgIHJldHVybiAwOyAvLyB0b28gbWFueSBxdWVzdGlvbiBtYXJrcwogICAgICAgIH0KCiAgICAgICAgbGVuZ3RoKys7CiAgICB9CgogICAgcmV0dXJuIGxlbmd0aDsKfQoKLy8gaHR0cHM6Ly9kcmFmdHMuY3Nzd2cub3JnL2Nzcy1zeW50YXgvI3VyYW5nZQovLyBJbmZvcm1hbGx5LCB0aGUgPHVyYW5nZT4gcHJvZHVjdGlvbiBoYXMgdGhyZWUgZm9ybXM6Ci8vIFUrMDAwMQovLyAgICAgIERlZmluZXMgYSByYW5nZSBjb25zaXN0aW5nIG9mIGEgc2luZ2xlIGNvZGUgcG9pbnQsIGluIHRoaXMgY2FzZSB0aGUgY29kZSBwb2ludCAiMSIuCi8vIFUrMDAwMS0wMGZmCi8vICAgICAgRGVmaW5lcyBhIHJhbmdlIG9mIGNvZGVwb2ludHMgYmV0d2VlbiB0aGUgZmlyc3QgYW5kIHRoZSBzZWNvbmQgdmFsdWUsIGluIHRoaXMgY2FzZQovLyAgICAgIHRoZSByYW5nZSBiZXR3ZWVuICIxIiBhbmQgImZmIiAoMjU1IGluIGRlY2ltYWwpIGluY2x1c2l2ZS4KLy8gVSswMD8/Ci8vICAgICAgRGVmaW5lcyBhIHJhbmdlIG9mIGNvZGVwb2ludHMgd2hlcmUgdGhlICI/IiBjaGFyYWN0ZXJzIHJhbmdlIG92ZXIgYWxsIGhleCBkaWdpdHMsCi8vICAgICAgaW4gdGhpcyBjYXNlIGRlZmluaW5nIHRoZSBzYW1lIGFzIHRoZSB2YWx1ZSBVKzAwMDAtMDBmZi4KLy8gSW4gZWFjaCBmb3JtLCBhIG1heGltdW0gb2YgNiBkaWdpdHMgaXMgYWxsb3dlZCBmb3IgZWFjaCBoZXhhZGVjaW1hbCBudW1iZXIgKGlmIHlvdSB0cmVhdCAiPyIgYXMgYSBoZXhhZGVjaW1hbCBkaWdpdCkuCi8vCi8vIDx1cmFuZ2U+ID0KLy8gICB1ICcrJyA8aWRlbnQtdG9rZW4+ICc/JyogfAovLyAgIHUgPGRpbWVuc2lvbi10b2tlbj4gJz8nKiB8Ci8vICAgdSA8bnVtYmVyLXRva2VuPiAnPycqIHwKLy8gICB1IDxudW1iZXItdG9rZW4+IDxkaW1lbnNpb24tdG9rZW4+IHwKLy8gICB1IDxudW1iZXItdG9rZW4+IDxudW1iZXItdG9rZW4+IHwKLy8gICB1ICcrJyAnPycrCmZ1bmN0aW9uIHVyYW5nZSh0b2tlbiwgZ2V0TmV4dFRva2VuKSB7CiAgICBsZXQgbGVuZ3RoID0gMDsKCiAgICAvLyBzaG91bGQgc3RhcnQgd2l0aCBgdWAgb3IgYFVgCiAgICBpZiAodG9rZW4gPT09IG51bGwgfHwgdG9rZW4udHlwZSAhPT0gSWRlbnQgfHwgIWNtcENoYXIodG9rZW4udmFsdWUsIDAsIFUkMSkpIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICB0b2tlbiA9IGdldE5leHRUb2tlbigrK2xlbmd0aCk7CiAgICBpZiAodG9rZW4gPT09IG51bGwpIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAvLyB1ICcrJyA8aWRlbnQtdG9rZW4+ICc/JyoKICAgIC8vIHUgJysnICc/JysKICAgIGlmIChpc0RlbGltKHRva2VuLCBQTFVTU0lHTiQ3KSkgewogICAgICAgIHRva2VuID0gZ2V0TmV4dFRva2VuKCsrbGVuZ3RoKTsKICAgICAgICBpZiAodG9rZW4gPT09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICBpZiAodG9rZW4udHlwZSA9PT0gSWRlbnQpIHsKICAgICAgICAgICAgLy8gdSAnKycgPGlkZW50LXRva2VuPiAnPycqCiAgICAgICAgICAgIHJldHVybiB3aXRoUXVlc3Rpb25NYXJrU2VxdWVuY2UoaGV4U2VxdWVuY2UodG9rZW4sIDAsIHRydWUpLCArK2xlbmd0aCwgZ2V0TmV4dFRva2VuKTsKICAgICAgICB9CgogICAgICAgIGlmIChpc0RlbGltKHRva2VuLCBRVUVTVElPTk1BUkskMikpIHsKICAgICAgICAgICAgLy8gdSAnKycgJz8nKwogICAgICAgICAgICByZXR1cm4gd2l0aFF1ZXN0aW9uTWFya1NlcXVlbmNlKDEsICsrbGVuZ3RoLCBnZXROZXh0VG9rZW4pOwogICAgICAgIH0KCiAgICAgICAgLy8gSGV4IGRpZ2l0IG9yIHF1ZXN0aW9uIG1hcmsgaXMgZXhwZWN0ZWQKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAvLyB1IDxudW1iZXItdG9rZW4+ICc/JyoKICAgIC8vIHUgPG51bWJlci10b2tlbj4gPGRpbWVuc2lvbi10b2tlbj4KICAgIC8vIHUgPG51bWJlci10b2tlbj4gPG51bWJlci10b2tlbj4KICAgIGlmICh0b2tlbi50eXBlID09PSBOdW1iZXIkMikgewogICAgICAgIGNvbnN0IGNvbnN1bWVkSGV4TGVuZ3RoID0gaGV4U2VxdWVuY2UodG9rZW4sIDEsIHRydWUpOwogICAgICAgIGlmIChjb25zdW1lZEhleExlbmd0aCA9PT0gMCkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIHRva2VuID0gZ2V0TmV4dFRva2VuKCsrbGVuZ3RoKTsKICAgICAgICBpZiAodG9rZW4gPT09IG51bGwpIHsKICAgICAgICAgICAgLy8gdSA8bnVtYmVyLXRva2VuPiA8ZW9mPgogICAgICAgICAgICByZXR1cm4gbGVuZ3RoOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRva2VuLnR5cGUgPT09IERpbWVuc2lvbiQxIHx8IHRva2VuLnR5cGUgPT09IE51bWJlciQyKSB7CiAgICAgICAgICAgIC8vIHUgPG51bWJlci10b2tlbj4gPGRpbWVuc2lvbi10b2tlbj4KICAgICAgICAgICAgLy8gdSA8bnVtYmVyLXRva2VuPiA8bnVtYmVyLXRva2VuPgogICAgICAgICAgICBpZiAoIXN0YXJ0c1dpdGgkMSh0b2tlbiwgSFlQSEVOTUlOVVMkMykgfHwgIWhleFNlcXVlbmNlKHRva2VuLCAxLCBmYWxzZSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbGVuZ3RoICsgMTsKICAgICAgICB9CgogICAgICAgIC8vIHUgPG51bWJlci10b2tlbj4gJz8nKgogICAgICAgIHJldHVybiB3aXRoUXVlc3Rpb25NYXJrU2VxdWVuY2UoY29uc3VtZWRIZXhMZW5ndGgsIGxlbmd0aCwgZ2V0TmV4dFRva2VuKTsKICAgIH0KCiAgICAvLyB1IDxkaW1lbnNpb24tdG9rZW4+ICc/JyoKICAgIGlmICh0b2tlbi50eXBlID09PSBEaW1lbnNpb24kMSkgewogICAgICAgIHJldHVybiB3aXRoUXVlc3Rpb25NYXJrU2VxdWVuY2UoaGV4U2VxdWVuY2UodG9rZW4sIDEsIHRydWUpLCArK2xlbmd0aCwgZ2V0TmV4dFRva2VuKTsKICAgIH0KCiAgICByZXR1cm4gMDsKfQoKY29uc3QgY2FsY0Z1bmN0aW9uTmFtZXMgPSBbJ2NhbGMoJywgJy1tb3otY2FsYygnLCAnLXdlYmtpdC1jYWxjKCddOwpjb25zdCBiYWxhbmNlUGFpciA9IG5ldyBNYXAoWwogICAgW0Z1bmN0aW9uJDIsIFJpZ2h0UGFyZW50aGVzaXNdLAogICAgW0xlZnRQYXJlbnRoZXNpcywgUmlnaHRQYXJlbnRoZXNpc10sCiAgICBbTGVmdFNxdWFyZUJyYWNrZXQsIFJpZ2h0U3F1YXJlQnJhY2tldF0sCiAgICBbTGVmdEN1cmx5QnJhY2tldCwgUmlnaHRDdXJseUJyYWNrZXRdCl0pOwoKLy8gc2FmZSBjaGFyIGNvZGUgZ2V0dGVyCmZ1bmN0aW9uIGNoYXJDb2RlQXQoc3RyLCBpbmRleCkgewogICAgcmV0dXJuIGluZGV4IDwgc3RyLmxlbmd0aCA/IHN0ci5jaGFyQ29kZUF0KGluZGV4KSA6IDA7Cn0KCmZ1bmN0aW9uIGVxU3RyKGFjdHVhbCwgZXhwZWN0ZWQpIHsKICAgIHJldHVybiBjbXBTdHIoYWN0dWFsLCAwLCBhY3R1YWwubGVuZ3RoLCBleHBlY3RlZCk7Cn0KCmZ1bmN0aW9uIGVxU3RyQW55KGFjdHVhbCwgZXhwZWN0ZWQpIHsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZXhwZWN0ZWQubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoZXFTdHIoYWN0dWFsLCBleHBlY3RlZFtpXSkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKfQoKLy8gSUUgcG9zdGZpeCBoYWNrLCBpLmUuIDEyM1wwIG9yIDEyM3B4XDkKZnVuY3Rpb24gaXNQb3N0Zml4SWVIYWNrKHN0ciwgb2Zmc2V0KSB7CiAgICBpZiAob2Zmc2V0ICE9PSBzdHIubGVuZ3RoIC0gMikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gKAogICAgICAgIGNoYXJDb2RlQXQoc3RyLCBvZmZzZXQpID09PSAweDAwNUMgJiYgIC8vIFUrMDA1QyBSRVZFUlNFIFNPTElEVVMgKFwpCiAgICAgICAgaXNEaWdpdChjaGFyQ29kZUF0KHN0ciwgb2Zmc2V0ICsgMSkpCiAgICApOwp9CgpmdW5jdGlvbiBvdXRPZlJhbmdlKG9wdHMsIHZhbHVlLCBudW1FbmQpIHsKICAgIGlmIChvcHRzICYmIG9wdHMudHlwZSA9PT0gJ1JhbmdlJykgewogICAgICAgIGNvbnN0IG51bSA9IE51bWJlcigKICAgICAgICAgICAgbnVtRW5kICE9PSB1bmRlZmluZWQgJiYgbnVtRW5kICE9PSB2YWx1ZS5sZW5ndGgKICAgICAgICAgICAgICAgID8gdmFsdWUuc3Vic3RyKDAsIG51bUVuZCkKICAgICAgICAgICAgICAgIDogdmFsdWUKICAgICAgICApOwoKICAgICAgICBpZiAoaXNOYU4obnVtKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIC8vIEZJWE1FOiB3aGVuIG9wdHMubWluIGlzIGEgc3RyaW5nIGl0J3MgYSBkaW1lbnNpb24sIHNraXAgYSByYW5nZSB2YWxpZGF0aW9uCiAgICAgICAgLy8gZm9yIG5vdyBzaW5jZSBpdCByZXF1aXJlcyBhIHR5cGUgY292ZXJ0YXRpb24gd2hpY2ggaXMgbm90IGltcGxtZW50ZWQgeWV0CiAgICAgICAgaWYgKG9wdHMubWluICE9PSBudWxsICYmIG51bSA8IG9wdHMubWluICYmIHR5cGVvZiBvcHRzLm1pbiAhPT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICAvLyBGSVhNRTogd2hlbiBvcHRzLm1heCBpcyBhIHN0cmluZyBpdCdzIGEgZGltZW5zaW9uLCBza2lwIGEgcmFuZ2UgdmFsaWRhdGlvbgogICAgICAgIC8vIGZvciBub3cgc2luY2UgaXQgcmVxdWlyZXMgYSB0eXBlIGNvdmVydGF0aW9uIHdoaWNoIGlzIG5vdCBpbXBsbWVudGVkIHlldAogICAgICAgIGlmIChvcHRzLm1heCAhPT0gbnVsbCAmJiBudW0gPiBvcHRzLm1heCAmJiB0eXBlb2Ygb3B0cy5tYXggIT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZmFsc2U7Cn0KCmZ1bmN0aW9uIGNvbnN1bWVGdW5jdGlvbih0b2tlbiwgZ2V0TmV4dFRva2VuKSB7CiAgICBsZXQgYmFsYW5jZUNsb3NlVHlwZSA9IDA7CiAgICBsZXQgYmFsYW5jZVN0YXNoID0gW107CiAgICBsZXQgbGVuZ3RoID0gMDsKCiAgICAvLyBiYWxhbmNlZCB0b2tlbiBjb25zdW1pbmcKICAgIHNjYW46CiAgICBkbyB7CiAgICAgICAgc3dpdGNoICh0b2tlbi50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgUmlnaHRDdXJseUJyYWNrZXQ6CiAgICAgICAgICAgIGNhc2UgUmlnaHRQYXJlbnRoZXNpczoKICAgICAgICAgICAgY2FzZSBSaWdodFNxdWFyZUJyYWNrZXQ6CiAgICAgICAgICAgICAgICBpZiAodG9rZW4udHlwZSAhPT0gYmFsYW5jZUNsb3NlVHlwZSkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrIHNjYW47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYmFsYW5jZUNsb3NlVHlwZSA9IGJhbGFuY2VTdGFzaC5wb3AoKTsKCiAgICAgICAgICAgICAgICBpZiAoYmFsYW5jZVN0YXNoLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGxlbmd0aCsrOwogICAgICAgICAgICAgICAgICAgIGJyZWFrIHNjYW47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIEZ1bmN0aW9uJDI6CiAgICAgICAgICAgIGNhc2UgTGVmdFBhcmVudGhlc2lzOgogICAgICAgICAgICBjYXNlIExlZnRTcXVhcmVCcmFja2V0OgogICAgICAgICAgICBjYXNlIExlZnRDdXJseUJyYWNrZXQ6CiAgICAgICAgICAgICAgICBiYWxhbmNlU3Rhc2gucHVzaChiYWxhbmNlQ2xvc2VUeXBlKTsKICAgICAgICAgICAgICAgIGJhbGFuY2VDbG9zZVR5cGUgPSBiYWxhbmNlUGFpci5nZXQodG9rZW4udHlwZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIGxlbmd0aCsrOwogICAgfSB3aGlsZSAodG9rZW4gPSBnZXROZXh0VG9rZW4obGVuZ3RoKSk7CgogICAgcmV0dXJuIGxlbmd0aDsKfQoKLy8gVE9ETzogaW1wbGVtZW50Ci8vIGNhbiBiZSB1c2VkIHdoZXJldmVyIDxsZW5ndGg+LCA8ZnJlcXVlbmN5PiwgPGFuZ2xlPiwgPHRpbWU+LCA8cGVyY2VudGFnZT4sIDxudW1iZXI+LCBvciA8aW50ZWdlcj4gdmFsdWVzIGFyZSBhbGxvd2VkCi8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3MtdmFsdWVzLyNjYWxjLW5vdGF0aW9uCmZ1bmN0aW9uIGNhbGMobmV4dCkgewogICAgcmV0dXJuIGZ1bmN0aW9uKHRva2VuLCBnZXROZXh0VG9rZW4sIG9wdHMpIHsKICAgICAgICBpZiAodG9rZW4gPT09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICBpZiAodG9rZW4udHlwZSA9PT0gRnVuY3Rpb24kMiAmJiBlcVN0ckFueSh0b2tlbi52YWx1ZSwgY2FsY0Z1bmN0aW9uTmFtZXMpKSB7CiAgICAgICAgICAgIHJldHVybiBjb25zdW1lRnVuY3Rpb24odG9rZW4sIGdldE5leHRUb2tlbik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbmV4dCh0b2tlbiwgZ2V0TmV4dFRva2VuLCBvcHRzKTsKICAgIH07Cn0KCmZ1bmN0aW9uIHRva2VuVHlwZShleHBlY3RlZFRva2VuVHlwZSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKHRva2VuKSB7CiAgICAgICAgaWYgKHRva2VuID09PSBudWxsIHx8IHRva2VuLnR5cGUgIT09IGV4cGVjdGVkVG9rZW5UeXBlKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIDE7CiAgICB9Owp9CgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIENvbXBsZXggdHlwZXMKLy8KCi8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3MtdmFsdWVzLTQvI2N1c3RvbS1pZGVudHMKLy8gNC4yLiBBdXRob3ItZGVmaW5lZCBJZGVudGlmaWVyczogdGhlIDxjdXN0b20taWRlbnQ+IHR5cGUKLy8gU29tZSBwcm9wZXJ0aWVzIGFjY2VwdCBhcmJpdHJhcnkgYXV0aG9yLWRlZmluZWQgaWRlbnRpZmllcnMgYXMgYSBjb21wb25lbnQgdmFsdWUuCi8vIFRoaXMgZ2VuZXJpYyBkYXRhIHR5cGUgaXMgZGVub3RlZCBieSA8Y3VzdG9tLWlkZW50PiwgYW5kIHJlcHJlc2VudHMgYW55IHZhbGlkIENTUyBpZGVudGlmaWVyCi8vIHRoYXQgd291bGQgbm90IGJlIG1pc2ludGVycHJldGVkIGFzIGEgcHJlLWRlZmluZWQga2V5d29yZCBpbiB0aGF0IHByb3BlcnR54oCZcyB2YWx1ZSBkZWZpbml0aW9uLgovLwovLyBTZWUgYWxzbzogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQ1NTL2N1c3RvbS1pZGVudApmdW5jdGlvbiBjdXN0b21JZGVudCh0b2tlbikgewogICAgaWYgKHRva2VuID09PSBudWxsIHx8IHRva2VuLnR5cGUgIT09IElkZW50KSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgY29uc3QgbmFtZSA9IHRva2VuLnZhbHVlLnRvTG93ZXJDYXNlKCk7CgogICAgLy8gVGhlIENTUy13aWRlIGtleXdvcmRzIGFyZSBub3QgdmFsaWQgPGN1c3RvbS1pZGVudD5zCiAgICBpZiAoZXFTdHJBbnkobmFtZSwgY3NzV2lkZUtleXdvcmRzKSkgewogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIC8vIFRoZSBkZWZhdWx0IGtleXdvcmQgaXMgcmVzZXJ2ZWQgYW5kIGlzIGFsc28gbm90IGEgdmFsaWQgPGN1c3RvbS1pZGVudD4KICAgIGlmIChlcVN0cihuYW1lLCAnZGVmYXVsdCcpKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgLy8gVE9ETzogaWdub3JlIHByb3BlcnR5IHNwZWNpZmljIGtleXdvcmRzIChhcyBkZXNjcmliZWQgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQ1NTL2N1c3RvbS1pZGVudCkKICAgIC8vIFNwZWNpZmljYXRpb25zIHVzaW5nIDxjdXN0b20taWRlbnQ+IG11c3Qgc3BlY2lmeSBjbGVhcmx5IHdoYXQgb3RoZXIga2V5d29yZHMKICAgIC8vIGFyZSBleGNsdWRlZCBmcm9tIDxjdXN0b20taWRlbnQ+LCBpZiBhbnnigJRmb3IgZXhhbXBsZSBieSBzYXlpbmcgdGhhdCBhbnkgcHJlLWRlZmluZWQga2V5d29yZHMKICAgIC8vIGluIHRoYXQgcHJvcGVydHnigJlzIHZhbHVlIGRlZmluaXRpb24gYXJlIGV4Y2x1ZGVkLiBFeGNsdWRlZCBrZXl3b3JkcyBhcmUgZXhjbHVkZWQKICAgIC8vIGluIGFsbCBBU0NJSSBjYXNlIHBlcm11dGF0aW9ucy4KCiAgICByZXR1cm4gMTsKfQoKLy8gaHR0cHM6Ly9kcmFmdHMuY3Nzd2cub3JnL2Nzcy12YXJpYWJsZXMvI3R5cGVkZWYtY3VzdG9tLXByb3BlcnR5LW5hbWUKLy8gQSBjdXN0b20gcHJvcGVydHkgaXMgYW55IHByb3BlcnR5IHdob3NlIG5hbWUgc3RhcnRzIHdpdGggdHdvIGRhc2hlcyAoVSswMDJEIEhZUEhFTi1NSU5VUyksIGxpa2UgLS1mb28uCi8vIFRoZSA8Y3VzdG9tLXByb3BlcnR5LW5hbWU+IHByb2R1Y3Rpb24gY29ycmVzcG9uZHMgdG8gdGhpczogaXTigJlzIGRlZmluZWQgYXMgYW55IHZhbGlkIGlkZW50aWZpZXIKLy8gdGhhdCBzdGFydHMgd2l0aCB0d28gZGFzaGVzLCBleGNlcHQgLS0gaXRzZWxmLCB3aGljaCBpcyByZXNlcnZlZCBmb3IgZnV0dXJlIHVzZSBieSBDU1MuCi8vIE5PVEU6IEN1cnJlbnQgaW1wbGVtZW50YXRpb24gdHJlYXQgYC0tYCBhcyBhIHZhbGlkIG5hbWUgc2luY2UgbW9zdCAoYWxsPykgbWFqb3IgYnJvd3NlcnMgdHJlYXQgaXQgYXMgdmFsaWQuCmZ1bmN0aW9uIGN1c3RvbVByb3BlcnR5TmFtZSh0b2tlbikgewogICAgLy8gLi4uIGRlZmluZWQgYXMgYW55IHZhbGlkIGlkZW50aWZpZXIKICAgIGlmICh0b2tlbiA9PT0gbnVsbCB8fCB0b2tlbi50eXBlICE9PSBJZGVudCkgewogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIC8vIC4uLiB0aGF0IHN0YXJ0cyB3aXRoIHR3byBkYXNoZXMgKFUrMDAyRCBIWVBIRU4tTUlOVVMpCiAgICBpZiAoY2hhckNvZGVBdCh0b2tlbi52YWx1ZSwgMCkgIT09IDB4MDAyRCB8fCBjaGFyQ29kZUF0KHRva2VuLnZhbHVlLCAxKSAhPT0gMHgwMDJEKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgcmV0dXJuIDE7Cn0KCi8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3MtY29sb3ItNC8jaGV4LW5vdGF0aW9uCi8vIFRoZSBzeW50YXggb2YgYSA8aGV4LWNvbG9yPiBpcyBhIDxoYXNoLXRva2VuPiB0b2tlbiB3aG9zZSB2YWx1ZSBjb25zaXN0cyBvZiAzLCA0LCA2LCBvciA4IGhleGFkZWNpbWFsIGRpZ2l0cy4KLy8gSW4gb3RoZXIgd29yZHMsIGEgaGV4IGNvbG9yIGlzIHdyaXR0ZW4gYXMgYSBoYXNoIGNoYXJhY3RlciwgIiMiLCBmb2xsb3dlZCBieSBzb21lIG51bWJlciBvZiBkaWdpdHMgMC05IG9yCi8vIGxldHRlcnMgYS1mICh0aGUgY2FzZSBvZiB0aGUgbGV0dGVycyBkb2VzbuKAmXQgbWF0dGVyIC0gIzAwZmYwMCBpcyBpZGVudGljYWwgdG8gIzAwRkYwMCkuCmZ1bmN0aW9uIGhleENvbG9yKHRva2VuKSB7CiAgICBpZiAodG9rZW4gPT09IG51bGwgfHwgdG9rZW4udHlwZSAhPT0gSGFzaCQxKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgY29uc3QgbGVuZ3RoID0gdG9rZW4udmFsdWUubGVuZ3RoOwoKICAgIC8vIHZhbGlkIHZhbHVlcyAobGVuZ3RoKTogI3JnYiAoNCksICNyZ2JhICg1KSwgI3JyZ2diYiAoNyksICNycmdnYmJhYSAoOSkKICAgIGlmIChsZW5ndGggIT09IDQgJiYgbGVuZ3RoICE9PSA1ICYmIGxlbmd0aCAhPT0gNyAmJiBsZW5ndGggIT09IDkpIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBmb3IgKGxldCBpID0gMTsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKCFpc0hleERpZ2l0KGNoYXJDb2RlQXQodG9rZW4udmFsdWUsIGkpKSkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIDE7Cn0KCmZ1bmN0aW9uIGlkU2VsZWN0b3IodG9rZW4pIHsKICAgIGlmICh0b2tlbiA9PT0gbnVsbCB8fCB0b2tlbi50eXBlICE9PSBIYXNoJDEpIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBpZiAoIWlzSWRlbnRpZmllclN0YXJ0KGNoYXJDb2RlQXQodG9rZW4udmFsdWUsIDEpLCBjaGFyQ29kZUF0KHRva2VuLnZhbHVlLCAyKSwgY2hhckNvZGVBdCh0b2tlbi52YWx1ZSwgMykpKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgcmV0dXJuIDE7Cn0KCi8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3Mtc3ludGF4LyNhbnktdmFsdWUKLy8gSXQgcmVwcmVzZW50cyB0aGUgZW50aXJldHkgb2Ygd2hhdCBhIHZhbGlkIGRlY2xhcmF0aW9uIGNhbiBoYXZlIGFzIGl0cyB2YWx1ZS4KZnVuY3Rpb24gZGVjbGFyYXRpb25WYWx1ZSh0b2tlbiwgZ2V0TmV4dFRva2VuKSB7CiAgICBpZiAoIXRva2VuKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgbGV0IGJhbGFuY2VDbG9zZVR5cGUgPSAwOwogICAgbGV0IGJhbGFuY2VTdGFzaCA9IFtdOwogICAgbGV0IGxlbmd0aCA9IDA7CgogICAgLy8gVGhlIDxkZWNsYXJhdGlvbi12YWx1ZT4gcHJvZHVjdGlvbiBtYXRjaGVzIGFueSBzZXF1ZW5jZSBvZiBvbmUgb3IgbW9yZSB0b2tlbnMsCiAgICAvLyBzbyBsb25nIGFzIHRoZSBzZXF1ZW5jZSBkb2VzIG5vdCBjb250YWluIC4uLgogICAgc2NhbjoKICAgIGRvIHsKICAgICAgICBzd2l0Y2ggKHRva2VuLnR5cGUpIHsKICAgICAgICAgICAgLy8gLi4uIDxiYWQtc3RyaW5nLXRva2VuPiwgPGJhZC11cmwtdG9rZW4+LAogICAgICAgICAgICBjYXNlIEJhZFN0cmluZzoKICAgICAgICAgICAgY2FzZSBCYWRVcmw6CiAgICAgICAgICAgICAgICBicmVhayBzY2FuOwoKICAgICAgICAgICAgLy8gLi4uIHVubWF0Y2hlZCA8KS10b2tlbj4sIDxdLXRva2VuPiwgb3IgPH0tdG9rZW4+LAogICAgICAgICAgICBjYXNlIFJpZ2h0Q3VybHlCcmFja2V0OgogICAgICAgICAgICBjYXNlIFJpZ2h0UGFyZW50aGVzaXM6CiAgICAgICAgICAgIGNhc2UgUmlnaHRTcXVhcmVCcmFja2V0OgogICAgICAgICAgICAgICAgaWYgKHRva2VuLnR5cGUgIT09IGJhbGFuY2VDbG9zZVR5cGUpIHsKICAgICAgICAgICAgICAgICAgICBicmVhayBzY2FuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJhbGFuY2VDbG9zZVR5cGUgPSBiYWxhbmNlU3Rhc2gucG9wKCk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIC8vIC4uLiBvciB0b3AtbGV2ZWwgPHNlbWljb2xvbi10b2tlbj4gdG9rZW5zCiAgICAgICAgICAgIGNhc2UgU2VtaWNvbG9uOgogICAgICAgICAgICAgICAgaWYgKGJhbGFuY2VDbG9zZVR5cGUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBicmVhayBzY2FuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgLy8gLi4uIG9yIDxkZWxpbS10b2tlbj4gdG9rZW5zIHdpdGggYSB2YWx1ZSBvZiAiISIKICAgICAgICAgICAgY2FzZSBEZWxpbToKICAgICAgICAgICAgICAgIGlmIChiYWxhbmNlQ2xvc2VUeXBlID09PSAwICYmIHRva2VuLnZhbHVlID09PSAnIScpIHsKICAgICAgICAgICAgICAgICAgICBicmVhayBzY2FuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBGdW5jdGlvbiQyOgogICAgICAgICAgICBjYXNlIExlZnRQYXJlbnRoZXNpczoKICAgICAgICAgICAgY2FzZSBMZWZ0U3F1YXJlQnJhY2tldDoKICAgICAgICAgICAgY2FzZSBMZWZ0Q3VybHlCcmFja2V0OgogICAgICAgICAgICAgICAgYmFsYW5jZVN0YXNoLnB1c2goYmFsYW5jZUNsb3NlVHlwZSk7CiAgICAgICAgICAgICAgICBiYWxhbmNlQ2xvc2VUeXBlID0gYmFsYW5jZVBhaXIuZ2V0KHRva2VuLnR5cGUpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBsZW5ndGgrKzsKICAgIH0gd2hpbGUgKHRva2VuID0gZ2V0TmV4dFRva2VuKGxlbmd0aCkpOwoKICAgIHJldHVybiBsZW5ndGg7Cn0KCi8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3Mtc3ludGF4LyNhbnktdmFsdWUKLy8gVGhlIDxhbnktdmFsdWU+IHByb2R1Y3Rpb24gaXMgaWRlbnRpY2FsIHRvIDxkZWNsYXJhdGlvbi12YWx1ZT4sIGJ1dCBhbHNvCi8vIGFsbG93cyB0b3AtbGV2ZWwgPHNlbWljb2xvbi10b2tlbj4gdG9rZW5zIGFuZCA8ZGVsaW0tdG9rZW4+IHRva2VucwovLyB3aXRoIGEgdmFsdWUgb2YgIiEiLiBJdCByZXByZXNlbnRzIHRoZSBlbnRpcmV0eSBvZiB3aGF0IHZhbGlkIENTUyBjYW4gYmUgaW4gYW55IGNvbnRleHQuCmZ1bmN0aW9uIGFueVZhbHVlKHRva2VuLCBnZXROZXh0VG9rZW4pIHsKICAgIGlmICghdG9rZW4pIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBsZXQgYmFsYW5jZUNsb3NlVHlwZSA9IDA7CiAgICBsZXQgYmFsYW5jZVN0YXNoID0gW107CiAgICBsZXQgbGVuZ3RoID0gMDsKCiAgICAvLyBUaGUgPGFueS12YWx1ZT4gcHJvZHVjdGlvbiBtYXRjaGVzIGFueSBzZXF1ZW5jZSBvZiBvbmUgb3IgbW9yZSB0b2tlbnMsCiAgICAvLyBzbyBsb25nIGFzIHRoZSBzZXF1ZW5jZSAuLi4KICAgIHNjYW46CiAgICBkbyB7CiAgICAgICAgc3dpdGNoICh0b2tlbi50eXBlKSB7CiAgICAgICAgICAgIC8vIC4uLiBkb2VzIG5vdCBjb250YWluIDxiYWQtc3RyaW5nLXRva2VuPiwgPGJhZC11cmwtdG9rZW4+LAogICAgICAgICAgICBjYXNlIEJhZFN0cmluZzoKICAgICAgICAgICAgY2FzZSBCYWRVcmw6CiAgICAgICAgICAgICAgICBicmVhayBzY2FuOwoKICAgICAgICAgICAgLy8gLi4uIHVubWF0Y2hlZCA8KS10b2tlbj4sIDxdLXRva2VuPiwgb3IgPH0tdG9rZW4+LAogICAgICAgICAgICBjYXNlIFJpZ2h0Q3VybHlCcmFja2V0OgogICAgICAgICAgICBjYXNlIFJpZ2h0UGFyZW50aGVzaXM6CiAgICAgICAgICAgIGNhc2UgUmlnaHRTcXVhcmVCcmFja2V0OgogICAgICAgICAgICAgICAgaWYgKHRva2VuLnR5cGUgIT09IGJhbGFuY2VDbG9zZVR5cGUpIHsKICAgICAgICAgICAgICAgICAgICBicmVhayBzY2FuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJhbGFuY2VDbG9zZVR5cGUgPSBiYWxhbmNlU3Rhc2gucG9wKCk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgRnVuY3Rpb24kMjoKICAgICAgICAgICAgY2FzZSBMZWZ0UGFyZW50aGVzaXM6CiAgICAgICAgICAgIGNhc2UgTGVmdFNxdWFyZUJyYWNrZXQ6CiAgICAgICAgICAgIGNhc2UgTGVmdEN1cmx5QnJhY2tldDoKICAgICAgICAgICAgICAgIGJhbGFuY2VTdGFzaC5wdXNoKGJhbGFuY2VDbG9zZVR5cGUpOwogICAgICAgICAgICAgICAgYmFsYW5jZUNsb3NlVHlwZSA9IGJhbGFuY2VQYWlyLmdldCh0b2tlbi50eXBlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgbGVuZ3RoKys7CiAgICB9IHdoaWxlICh0b2tlbiA9IGdldE5leHRUb2tlbihsZW5ndGgpKTsKCiAgICByZXR1cm4gbGVuZ3RoOwp9CgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIERpbWVuc2lvbnMKLy8KCmZ1bmN0aW9uIGRpbWVuc2lvbih0eXBlKSB7CiAgICBpZiAodHlwZSkgewogICAgICAgIHR5cGUgPSBuZXcgU2V0KHR5cGUpOwogICAgfQoKICAgIHJldHVybiBmdW5jdGlvbih0b2tlbiwgZ2V0TmV4dFRva2VuLCBvcHRzKSB7CiAgICAgICAgaWYgKHRva2VuID09PSBudWxsIHx8IHRva2VuLnR5cGUgIT09IERpbWVuc2lvbiQxKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgbnVtYmVyRW5kID0gY29uc3VtZU51bWJlciQxKHRva2VuLnZhbHVlLCAwKTsKCiAgICAgICAgLy8gY2hlY2sgdW5pdAogICAgICAgIGlmICh0eXBlICE9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIGNoZWNrIGZvciBJRSBwb3N0Zml4IGhhY2ssIGkuZS4gMTIzcHhcMCBvciAxMjNweFw5CiAgICAgICAgICAgIGNvbnN0IHJldmVyc2VTb2xpZHVzT2Zmc2V0ID0gdG9rZW4udmFsdWUuaW5kZXhPZignXFwnLCBudW1iZXJFbmQpOwogICAgICAgICAgICBjb25zdCB1bml0ID0gcmV2ZXJzZVNvbGlkdXNPZmZzZXQgPT09IC0xIHx8ICFpc1Bvc3RmaXhJZUhhY2sodG9rZW4udmFsdWUsIHJldmVyc2VTb2xpZHVzT2Zmc2V0KQogICAgICAgICAgICAgICAgPyB0b2tlbi52YWx1ZS5zdWJzdHIobnVtYmVyRW5kKQogICAgICAgICAgICAgICAgOiB0b2tlbi52YWx1ZS5zdWJzdHJpbmcobnVtYmVyRW5kLCByZXZlcnNlU29saWR1c09mZnNldCk7CgogICAgICAgICAgICBpZiAodHlwZS5oYXModW5pdC50b0xvd2VyQ2FzZSgpKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBjaGVjayByYW5nZSBpZiBzcGVjaWZpZWQKICAgICAgICBpZiAob3V0T2ZSYW5nZShvcHRzLCB0b2tlbi52YWx1ZSwgbnVtYmVyRW5kKSkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CgogICAgICAgIHJldHVybiAxOwogICAgfTsKfQoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PQovLyBQZXJjZW50YWdlCi8vCgovLyDCpzUuNS4gUGVyY2VudGFnZXM6IHRoZSA8cGVyY2VudGFnZT4gdHlwZQovLyBodHRwczovL2RyYWZ0cy5jc3N3Zy5vcmcvY3NzLXZhbHVlcy00LyNwZXJjZW50YWdlcwpmdW5jdGlvbiBwZXJjZW50YWdlKHRva2VuLCBnZXROZXh0VG9rZW4sIG9wdHMpIHsKICAgIC8vIC4uLiBjb3JyZXNwb25kcyB0byB0aGUgPHBlcmNlbnRhZ2UtdG9rZW4+IHByb2R1Y3Rpb24KICAgIGlmICh0b2tlbiA9PT0gbnVsbCB8fCB0b2tlbi50eXBlICE9PSBQZXJjZW50YWdlJDEpIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAvLyBjaGVjayByYW5nZSBpZiBzcGVjaWZpZWQKICAgIGlmIChvdXRPZlJhbmdlKG9wdHMsIHRva2VuLnZhbHVlLCB0b2tlbi52YWx1ZS5sZW5ndGggLSAxKSkgewogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIHJldHVybiAxOwp9CgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIE51bWVyaWMKLy8KCi8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3MtdmFsdWVzLTQvI251bWJlcnMKLy8gVGhlIHZhbHVlIDx6ZXJvPiByZXByZXNlbnRzIGEgbGl0ZXJhbCBudW1iZXIgd2l0aCB0aGUgdmFsdWUgMC4gRXhwcmVzc2lvbnMgdGhhdCBtZXJlbHkKLy8gZXZhbHVhdGUgdG8gYSA8bnVtYmVyPiB3aXRoIHRoZSB2YWx1ZSAwIChmb3IgZXhhbXBsZSwgY2FsYygwKSkgZG8gbm90IG1hdGNoIDx6ZXJvPjsKLy8gb25seSBsaXRlcmFsIDxudW1iZXItdG9rZW4+cyBkby4KZnVuY3Rpb24gemVybyhuZXh0KSB7CiAgICBpZiAodHlwZW9mIG5leHQgIT09ICdmdW5jdGlvbicpIHsKICAgICAgICBuZXh0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH07CiAgICB9CgogICAgcmV0dXJuIGZ1bmN0aW9uKHRva2VuLCBnZXROZXh0VG9rZW4sIG9wdHMpIHsKICAgICAgICBpZiAodG9rZW4gIT09IG51bGwgJiYgdG9rZW4udHlwZSA9PT0gTnVtYmVyJDIpIHsKICAgICAgICAgICAgaWYgKE51bWJlcih0b2tlbi52YWx1ZSkgPT09IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbmV4dCh0b2tlbiwgZ2V0TmV4dFRva2VuLCBvcHRzKTsKICAgIH07Cn0KCi8vIMKnIDUuMy4gUmVhbCBOdW1iZXJzOiB0aGUgPG51bWJlcj4gdHlwZQovLyBodHRwczovL2RyYWZ0cy5jc3N3Zy5vcmcvY3NzLXZhbHVlcy00LyNudW1iZXJzCi8vIE51bWJlciB2YWx1ZXMgYXJlIGRlbm90ZWQgYnkgPG51bWJlcj4sIGFuZCByZXByZXNlbnQgcmVhbCBudW1iZXJzLCBwb3NzaWJseSB3aXRoIGEgZnJhY3Rpb25hbCBjb21wb25lbnQuCi8vIC4uLiBJdCBjb3JyZXNwb25kcyB0byB0aGUgPG51bWJlci10b2tlbj4gcHJvZHVjdGlvbgpmdW5jdGlvbiBudW1iZXIodG9rZW4sIGdldE5leHRUb2tlbiwgb3B0cykgewogICAgaWYgKHRva2VuID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgY29uc3QgbnVtYmVyRW5kID0gY29uc3VtZU51bWJlciQxKHRva2VuLnZhbHVlLCAwKTsKICAgIGNvbnN0IGlzTnVtYmVyID0gbnVtYmVyRW5kID09PSB0b2tlbi52YWx1ZS5sZW5ndGg7CiAgICBpZiAoIWlzTnVtYmVyICYmICFpc1Bvc3RmaXhJZUhhY2sodG9rZW4udmFsdWUsIG51bWJlckVuZCkpIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAvLyBjaGVjayByYW5nZSBpZiBzcGVjaWZpZWQKICAgIGlmIChvdXRPZlJhbmdlKG9wdHMsIHRva2VuLnZhbHVlLCBudW1iZXJFbmQpKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgcmV0dXJuIDE7Cn0KCi8vIMKnNS4yLiBJbnRlZ2VyczogdGhlIDxpbnRlZ2VyPiB0eXBlCi8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3MtdmFsdWVzLTQvI2ludGVnZXJzCmZ1bmN0aW9uIGludGVnZXIodG9rZW4sIGdldE5leHRUb2tlbiwgb3B0cykgewogICAgLy8gLi4uIGNvcnJlc3BvbmRzIHRvIGEgc3Vic2V0IG9mIHRoZSA8bnVtYmVyLXRva2VuPiBwcm9kdWN0aW9uCiAgICBpZiAodG9rZW4gPT09IG51bGwgfHwgdG9rZW4udHlwZSAhPT0gTnVtYmVyJDIpIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAvLyBUaGUgZmlyc3QgZGlnaXQgb2YgYW4gaW50ZWdlciBtYXkgYmUgaW1tZWRpYXRlbHkgcHJlY2VkZWQgYnkgYC1gIG9yIGArYCB0byBpbmRpY2F0ZSB0aGUgaW50ZWdlcuKAmXMgc2lnbi4KICAgIGxldCBpID0gY2hhckNvZGVBdCh0b2tlbi52YWx1ZSwgMCkgPT09IDB4MDAyQiB8fCAgICAgICAvLyBVKzAwMkIgUExVUyBTSUdOICgrKQogICAgICAgICAgICBjaGFyQ29kZUF0KHRva2VuLnZhbHVlLCAwKSA9PT0gMHgwMDJEID8gMSA6IDA7IC8vIFUrMDAyRCBIWVBIRU4tTUlOVVMgKC0pCgogICAgLy8gV2hlbiB3cml0dGVuIGxpdGVyYWxseSwgYW4gaW50ZWdlciBpcyBvbmUgb3IgbW9yZSBkZWNpbWFsIGRpZ2l0cyAwIHRocm91Z2ggOSAuLi4KICAgIGZvciAoOyBpIDwgdG9rZW4udmFsdWUubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoIWlzRGlnaXQoY2hhckNvZGVBdCh0b2tlbi52YWx1ZSwgaSkpKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBjaGVjayByYW5nZSBpZiBzcGVjaWZpZWQKICAgIGlmIChvdXRPZlJhbmdlKG9wdHMsIHRva2VuLnZhbHVlLCBpKSkgewogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgIHJldHVybiAxOwp9CgovLyB0b2tlbiB0eXBlcwpjb25zdCB0b2tlblR5cGVzID0gewogICAgJ2lkZW50LXRva2VuJzogdG9rZW5UeXBlKElkZW50KSwKICAgICdmdW5jdGlvbi10b2tlbic6IHRva2VuVHlwZShGdW5jdGlvbiQyKSwKICAgICdhdC1rZXl3b3JkLXRva2VuJzogdG9rZW5UeXBlKEF0S2V5d29yZCksCiAgICAnaGFzaC10b2tlbic6IHRva2VuVHlwZShIYXNoJDEpLAogICAgJ3N0cmluZy10b2tlbic6IHRva2VuVHlwZShTdHJpbmckMiksCiAgICAnYmFkLXN0cmluZy10b2tlbic6IHRva2VuVHlwZShCYWRTdHJpbmcpLAogICAgJ3VybC10b2tlbic6IHRva2VuVHlwZShVcmwkMSksCiAgICAnYmFkLXVybC10b2tlbic6IHRva2VuVHlwZShCYWRVcmwpLAogICAgJ2RlbGltLXRva2VuJzogdG9rZW5UeXBlKERlbGltKSwKICAgICdudW1iZXItdG9rZW4nOiB0b2tlblR5cGUoTnVtYmVyJDIpLAogICAgJ3BlcmNlbnRhZ2UtdG9rZW4nOiB0b2tlblR5cGUoUGVyY2VudGFnZSQxKSwKICAgICdkaW1lbnNpb24tdG9rZW4nOiB0b2tlblR5cGUoRGltZW5zaW9uJDEpLAogICAgJ3doaXRlc3BhY2UtdG9rZW4nOiB0b2tlblR5cGUoV2hpdGVTcGFjZSQxKSwKICAgICdDRE8tdG9rZW4nOiB0b2tlblR5cGUoQ0RPJDEpLAogICAgJ0NEQy10b2tlbic6IHRva2VuVHlwZShDREMkMSksCiAgICAnY29sb24tdG9rZW4nOiB0b2tlblR5cGUoQ29sb24pLAogICAgJ3NlbWljb2xvbi10b2tlbic6IHRva2VuVHlwZShTZW1pY29sb24pLAogICAgJ2NvbW1hLXRva2VuJzogdG9rZW5UeXBlKENvbW1hKSwKICAgICdbLXRva2VuJzogdG9rZW5UeXBlKExlZnRTcXVhcmVCcmFja2V0KSwKICAgICddLXRva2VuJzogdG9rZW5UeXBlKFJpZ2h0U3F1YXJlQnJhY2tldCksCiAgICAnKC10b2tlbic6IHRva2VuVHlwZShMZWZ0UGFyZW50aGVzaXMpLAogICAgJyktdG9rZW4nOiB0b2tlblR5cGUoUmlnaHRQYXJlbnRoZXNpcyksCiAgICAney10b2tlbic6IHRva2VuVHlwZShMZWZ0Q3VybHlCcmFja2V0KSwKICAgICd9LXRva2VuJzogdG9rZW5UeXBlKFJpZ2h0Q3VybHlCcmFja2V0KQp9OwoKLy8gdG9rZW4gcHJvZHVjdGlvbiB0eXBlcwpjb25zdCBwcm9kdWN0aW9uVHlwZXMgPSB7CiAgICAvLyB0b2tlbiB0eXBlIGFsaWFzZXMKICAgICdzdHJpbmcnOiB0b2tlblR5cGUoU3RyaW5nJDIpLAogICAgJ2lkZW50JzogdG9rZW5UeXBlKElkZW50KSwKCiAgICAvLyBwZXJjZW50YWdlCiAgICAncGVyY2VudGFnZSc6IGNhbGMocGVyY2VudGFnZSksCgogICAgLy8gbnVtZXJpYwogICAgJ3plcm8nOiB6ZXJvKCksCiAgICAnbnVtYmVyJzogY2FsYyhudW1iZXIpLAogICAgJ2ludGVnZXInOiBjYWxjKGludGVnZXIpLAoKICAgIC8vIGNvbXBsZXggdHlwZXMKICAgICdjdXN0b20taWRlbnQnOiBjdXN0b21JZGVudCwKICAgICdjdXN0b20tcHJvcGVydHktbmFtZSc6IGN1c3RvbVByb3BlcnR5TmFtZSwKICAgICdoZXgtY29sb3InOiBoZXhDb2xvciwKICAgICdpZC1zZWxlY3Rvcic6IGlkU2VsZWN0b3IsIC8vIGVsZW1lbnQoIDxpZC1zZWxlY3Rvcj4gKQogICAgJ2FuLXBsdXMtYic6IGFuUGx1c0IsCiAgICAndXJhbmdlJzogdXJhbmdlLAogICAgJ2RlY2xhcmF0aW9uLXZhbHVlJzogZGVjbGFyYXRpb25WYWx1ZSwKICAgICdhbnktdmFsdWUnOiBhbnlWYWx1ZQp9OwoKLy8gZGltZW5zaW9ucyB0eXBlcyBkZXBlbmQgb24gdW5pdHMgc2V0CmZ1bmN0aW9uIGNyZWF0ZURlbWVuc2lvblR5cGVzKHVuaXRzKSB7CiAgICBjb25zdCB7CiAgICAgICAgYW5nbGUsCiAgICAgICAgZGVjaWJlbCwKICAgICAgICBmcmVxdWVuY3ksCiAgICAgICAgZmxleCwKICAgICAgICBsZW5ndGgsCiAgICAgICAgcmVzb2x1dGlvbiwKICAgICAgICBzZW1pdG9uZXMsCiAgICAgICAgdGltZQogICAgfSA9IHVuaXRzIHx8IHt9OwoKICAgIHJldHVybiB7CiAgICAgICAgJ2RpbWVuc2lvbic6IGNhbGMoZGltZW5zaW9uKG51bGwpKSwKICAgICAgICAnYW5nbGUnOiBjYWxjKGRpbWVuc2lvbihhbmdsZSkpLAogICAgICAgICdkZWNpYmVsJzogY2FsYyhkaW1lbnNpb24oZGVjaWJlbCkpLAogICAgICAgICdmcmVxdWVuY3knOiBjYWxjKGRpbWVuc2lvbihmcmVxdWVuY3kpKSwKICAgICAgICAnZmxleCc6IGNhbGMoZGltZW5zaW9uKGZsZXgpKSwKICAgICAgICAnbGVuZ3RoJzogY2FsYyh6ZXJvKGRpbWVuc2lvbihsZW5ndGgpKSksCiAgICAgICAgJ3Jlc29sdXRpb24nOiBjYWxjKGRpbWVuc2lvbihyZXNvbHV0aW9uKSksCiAgICAgICAgJ3NlbWl0b25lcyc6IGNhbGMoZGltZW5zaW9uKHNlbWl0b25lcykpLAogICAgICAgICd0aW1lJzogY2FsYyhkaW1lbnNpb24odGltZSkpCiAgICB9Owp9CgpmdW5jdGlvbiBjcmVhdGVHZW5lcmljVHlwZXModW5pdHMpIHsKICAgIHJldHVybiB7CiAgICAgICAgLi4udG9rZW5UeXBlcywKICAgICAgICAuLi5wcm9kdWN0aW9uVHlwZXMsCiAgICAgICAgLi4uY3JlYXRlRGVtZW5zaW9uVHlwZXModW5pdHMpCiAgICB9Owp9Cgpjb25zdCBsZW5ndGggPSBbCiAgICAvLyBhYnNvbHV0ZSBsZW5ndGggdW5pdHMgaHR0cHM6Ly93d3cudzMub3JnL1RSL2Nzcy12YWx1ZXMtMy8jbGVuZ3RocwogICAgJ2NtJywgJ21tJywgJ3EnLCAnaW4nLCAncHQnLCAncGMnLCAncHgnLAogICAgLy8gZm9udC1yZWxhdGl2ZSBsZW5ndGggdW5pdHMgaHR0cHM6Ly9kcmFmdHMuY3Nzd2cub3JnL2Nzcy12YWx1ZXMtNC8jZm9udC1yZWxhdGl2ZS1sZW5ndGhzCiAgICAnZW0nLCAncmVtJywKICAgICdleCcsICdyZXgnLAogICAgJ2NhcCcsICdyY2FwJywKICAgICdjaCcsICdyY2gnLAogICAgJ2ljJywgJ3JpYycsCiAgICAnbGgnLCAncmxoJywKICAgIC8vIHZpZXdwb3J0LXBlcmNlbnRhZ2UgbGVuZ3RocyBodHRwczovL2RyYWZ0cy5jc3N3Zy5vcmcvY3NzLXZhbHVlcy00LyN2aWV3cG9ydC1yZWxhdGl2ZS1sZW5ndGhzCiAgICAndncnLCAnc3Z3JywgJ2x2dycsICdkdncnLAogICAgJ3ZoJywgJ3N2aCcsICdsdmgnLCAnZHZoJywKICAgICd2aScsICdzdmknLCAnbHZpJywgJ2R2aScsCiAgICAndmInLCAnc3ZiJywgJ2x2YicsICdkdmInLAogICAgJ3ZtaW4nLCAnc3ZtaW4nLCAnbHZtaW4nLCAnZHZtaW4nLAogICAgJ3ZtYXgnLCAnc3ZtYXgnLCAnbHZtYXgnLCAnZHZtYXgnLAogICAgLy8gY29udGFpbmVyIHJlbGF0aXZlIGxlbmd0aHMgaHR0cHM6Ly9kcmFmdHMuY3Nzd2cub3JnL2Nzcy1jb250YWluLTMvI2NvbnRhaW5lci1sZW5ndGhzCiAgICAnY3F3JywgJ2NxaCcsICdjcWknLCAnY3FiJywgJ2NxbWluJywgJ2NxbWF4JwpdOwpjb25zdCBhbmdsZSA9IFsnZGVnJywgJ2dyYWQnLCAncmFkJywgJ3R1cm4nXTsgICAgLy8gaHR0cHM6Ly93d3cudzMub3JnL1RSL2Nzcy12YWx1ZXMtMy8jYW5nbGVzCmNvbnN0IHRpbWUgPSBbJ3MnLCAnbXMnXTsgICAgICAgICAgICAgICAgICAgICAgICAvLyBodHRwczovL3d3dy53My5vcmcvVFIvY3NzLXZhbHVlcy0zLyN0aW1lCmNvbnN0IGZyZXF1ZW5jeSA9IFsnaHonLCAna2h6J107ICAgICAgICAgICAgICAgICAvLyBodHRwczovL3d3dy53My5vcmcvVFIvY3NzLXZhbHVlcy0zLyNmcmVxdWVuY3kKY29uc3QgcmVzb2x1dGlvbiA9IFsnZHBpJywgJ2RwY20nLCAnZHBweCcsICd4J107IC8vIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9jc3MtdmFsdWVzLTMvI3Jlc29sdXRpb24KY29uc3QgZmxleCA9IFsnZnInXTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3MtZ3JpZC8jZnItdW5pdApjb25zdCBkZWNpYmVsID0gWydkYiddOyAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaHR0cHM6Ly93d3cudzMub3JnL1RSL2NzczMtc3BlZWNoLyNtaXhpbmctcHJvcHMtdm9pY2Utdm9sdW1lCmNvbnN0IHNlbWl0b25lcyA9IFsnc3QnXTsgICAgICAgICAgICAgICAgICAgICAgICAvLyBodHRwczovL3d3dy53My5vcmcvVFIvY3NzMy1zcGVlY2gvI3ZvaWNlLXByb3BzLXZvaWNlLXBpdGNoCgpjb25zdCB1bml0cyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgYW5nbGUsCiAgICBkZWNpYmVsLAogICAgZmxleCwKICAgIGZyZXF1ZW5jeSwKICAgIGxlbmd0aCwKICAgIHJlc29sdXRpb24sCiAgICBzZW1pdG9uZXMsCiAgICB0aW1lCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKZnVuY3Rpb24gU3ludGF4RXJyb3IkMShtZXNzYWdlLCBpbnB1dCwgb2Zmc2V0KSB7CiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihjcmVhdGVDdXN0b21FcnJvcignU3ludGF4RXJyb3InLCBtZXNzYWdlKSwgewogICAgICAgIGlucHV0LAogICAgICAgIG9mZnNldCwKICAgICAgICByYXdNZXNzYWdlOiBtZXNzYWdlLAogICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UgKyAnXG4nICsKICAgICAgICAgICAgJyAgJyArIGlucHV0ICsgJ1xuJyArCiAgICAgICAgICAgICctLScgKyBuZXcgQXJyYXkoKG9mZnNldCB8fCBpbnB1dC5sZW5ndGgpICsgMSkuam9pbignLScpICsgJ14nCiAgICB9KTsKfQoKY29uc3QgVEFCJDEgPSA5Owpjb25zdCBOJDIgPSAxMDsKY29uc3QgRiQxID0gMTI7CmNvbnN0IFIkMSA9IDEzOwpjb25zdCBTUEFDRSQzID0gMzI7CgpjbGFzcyBUb2tlbml6ZXIgewogICAgY29uc3RydWN0b3Ioc3RyKSB7CiAgICAgICAgdGhpcy5zdHIgPSBzdHI7CiAgICAgICAgdGhpcy5wb3MgPSAwOwogICAgfQogICAgY2hhckNvZGVBdChwb3MpIHsKICAgICAgICByZXR1cm4gcG9zIDwgdGhpcy5zdHIubGVuZ3RoID8gdGhpcy5zdHIuY2hhckNvZGVBdChwb3MpIDogMDsKICAgIH0KICAgIGNoYXJDb2RlKCkgewogICAgICAgIHJldHVybiB0aGlzLmNoYXJDb2RlQXQodGhpcy5wb3MpOwogICAgfQogICAgbmV4dENoYXJDb2RlKCkgewogICAgICAgIHJldHVybiB0aGlzLmNoYXJDb2RlQXQodGhpcy5wb3MgKyAxKTsKICAgIH0KICAgIG5leHROb25Xc0NvZGUocG9zKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY2hhckNvZGVBdCh0aGlzLmZpbmRXc0VuZChwb3MpKTsKICAgIH0KICAgIGZpbmRXc0VuZChwb3MpIHsKICAgICAgICBmb3IgKDsgcG9zIDwgdGhpcy5zdHIubGVuZ3RoOyBwb3MrKykgewogICAgICAgICAgICBjb25zdCBjb2RlID0gdGhpcy5zdHIuY2hhckNvZGVBdChwb3MpOwogICAgICAgICAgICBpZiAoY29kZSAhPT0gUiQxICYmIGNvZGUgIT09IE4kMiAmJiBjb2RlICE9PSBGJDEgJiYgY29kZSAhPT0gU1BBQ0UkMyAmJiBjb2RlICE9PSBUQUIkMSkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBwb3M7CiAgICB9CiAgICBzdWJzdHJpbmdUb1BvcyhlbmQpIHsKICAgICAgICByZXR1cm4gdGhpcy5zdHIuc3Vic3RyaW5nKHRoaXMucG9zLCB0aGlzLnBvcyA9IGVuZCk7CiAgICB9CiAgICBlYXQoY29kZSkgewogICAgICAgIGlmICh0aGlzLmNoYXJDb2RlKCkgIT09IGNvZGUpIHsKICAgICAgICAgICAgdGhpcy5lcnJvcignRXhwZWN0IGAnICsgU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlKSArICdgJyk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBvcysrOwogICAgfQogICAgcGVlaygpIHsKICAgICAgICByZXR1cm4gdGhpcy5wb3MgPCB0aGlzLnN0ci5sZW5ndGggPyB0aGlzLnN0ci5jaGFyQXQodGhpcy5wb3MrKykgOiAnJzsKICAgIH0KICAgIGVycm9yKG1lc3NhZ2UpIHsKICAgICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IkMShtZXNzYWdlLCB0aGlzLnN0ciwgdGhpcy5wb3MpOwogICAgfQp9Cgpjb25zdCBUQUIgPSA5Owpjb25zdCBOJDEgPSAxMDsKY29uc3QgRiA9IDEyOwpjb25zdCBSID0gMTM7CmNvbnN0IFNQQUNFJDIgPSAzMjsKY29uc3QgRVhDTEFNQVRJT05NQVJLJDIgPSAzMzsgICAgLy8gIQpjb25zdCBOVU1CRVJTSUdOJDMgPSAzNTsgICAgICAgICAvLyAjCmNvbnN0IEFNUEVSU0FORCQ1ID0gMzg7ICAgICAgICAgIC8vICYKY29uc3QgQVBPU1RST1BIRSQyID0gMzk7ICAgICAgICAgLy8gJwpjb25zdCBMRUZUUEFSRU5USEVTSVMkMiA9IDQwOyAgICAvLyAoCmNvbnN0IFJJR0hUUEFSRU5USEVTSVMkMiA9IDQxOyAgIC8vICkKY29uc3QgQVNURVJJU0skNiA9IDQyOyAgICAgICAgICAgLy8gKgpjb25zdCBQTFVTU0lHTiQ2ID0gNDM7ICAgICAgICAgICAvLyArCmNvbnN0IENPTU1BID0gNDQ7ICAgICAgICAgICAgICAvLyAsCmNvbnN0IEhZUEVSTUlOVVMgPSA0NTsgICAgICAgICAvLyAtCmNvbnN0IExFU1NUSEFOU0lHTiA9IDYwOyAgICAgICAvLyA8CmNvbnN0IEdSRUFURVJUSEFOU0lHTiQyID0gNjI7ICAgIC8vID4KY29uc3QgUVVFU1RJT05NQVJLJDEgPSA2MzsgICAgICAgLy8gPwpjb25zdCBDT01NRVJDSUFMQVQgPSA2NDsgICAgICAgLy8gQApjb25zdCBMRUZUU1FVQVJFQlJBQ0tFVCA9IDkxOyAgLy8gWwpjb25zdCBSSUdIVFNRVUFSRUJSQUNLRVQgPSA5MzsgLy8gXQpjb25zdCBMRUZUQ1VSTFlCUkFDS0VUID0gMTIzOyAgLy8gewpjb25zdCBWRVJUSUNBTExJTkUkMyA9IDEyNDsgICAgICAvLyB8CmNvbnN0IFJJR0hUQ1VSTFlCUkFDS0VUID0gMTI1OyAvLyB9CmNvbnN0IElORklOSVRZID0gODczNDsgICAgICAgICAvLyDiiJ4KY29uc3QgTkFNRV9DSEFSID0gbmV3IFVpbnQ4QXJyYXkoMTI4KS5tYXAoKF8sIGlkeCkgPT4KICAgIC9bYS16QS1aMC05XC1dLy50ZXN0KFN0cmluZy5mcm9tQ2hhckNvZGUoaWR4KSkgPyAxIDogMAopOwpjb25zdCBDT01CSU5BVE9SX1BSRUNFREVOQ0UgPSB7CiAgICAnICc6IDEsCiAgICAnJiYnOiAyLAogICAgJ3x8JzogMywKICAgICd8JzogNAp9OwoKZnVuY3Rpb24gc2NhblNwYWNlcyh0b2tlbml6ZXIpIHsKICAgIHJldHVybiB0b2tlbml6ZXIuc3Vic3RyaW5nVG9Qb3MoCiAgICAgICAgdG9rZW5pemVyLmZpbmRXc0VuZCh0b2tlbml6ZXIucG9zKQogICAgKTsKfQoKZnVuY3Rpb24gc2NhbldvcmQodG9rZW5pemVyKSB7CiAgICBsZXQgZW5kID0gdG9rZW5pemVyLnBvczsKCiAgICBmb3IgKDsgZW5kIDwgdG9rZW5pemVyLnN0ci5sZW5ndGg7IGVuZCsrKSB7CiAgICAgICAgY29uc3QgY29kZSA9IHRva2VuaXplci5zdHIuY2hhckNvZGVBdChlbmQpOwogICAgICAgIGlmIChjb2RlID49IDEyOCB8fCBOQU1FX0NIQVJbY29kZV0gPT09IDApIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAgIGlmICh0b2tlbml6ZXIucG9zID09PSBlbmQpIHsKICAgICAgICB0b2tlbml6ZXIuZXJyb3IoJ0V4cGVjdCBhIGtleXdvcmQnKTsKICAgIH0KCiAgICByZXR1cm4gdG9rZW5pemVyLnN1YnN0cmluZ1RvUG9zKGVuZCk7Cn0KCmZ1bmN0aW9uIHNjYW5OdW1iZXIodG9rZW5pemVyKSB7CiAgICBsZXQgZW5kID0gdG9rZW5pemVyLnBvczsKCiAgICBmb3IgKDsgZW5kIDwgdG9rZW5pemVyLnN0ci5sZW5ndGg7IGVuZCsrKSB7CiAgICAgICAgY29uc3QgY29kZSA9IHRva2VuaXplci5zdHIuY2hhckNvZGVBdChlbmQpOwogICAgICAgIGlmIChjb2RlIDwgNDggfHwgY29kZSA+IDU3KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAodG9rZW5pemVyLnBvcyA9PT0gZW5kKSB7CiAgICAgICAgdG9rZW5pemVyLmVycm9yKCdFeHBlY3QgYSBudW1iZXInKTsKICAgIH0KCiAgICByZXR1cm4gdG9rZW5pemVyLnN1YnN0cmluZ1RvUG9zKGVuZCk7Cn0KCmZ1bmN0aW9uIHNjYW5TdHJpbmcodG9rZW5pemVyKSB7CiAgICBjb25zdCBlbmQgPSB0b2tlbml6ZXIuc3RyLmluZGV4T2YoJ1wnJywgdG9rZW5pemVyLnBvcyArIDEpOwoKICAgIGlmIChlbmQgPT09IC0xKSB7CiAgICAgICAgdG9rZW5pemVyLnBvcyA9IHRva2VuaXplci5zdHIubGVuZ3RoOwogICAgICAgIHRva2VuaXplci5lcnJvcignRXhwZWN0IGFuIGFwb3N0cm9waGUnKTsKICAgIH0KCiAgICByZXR1cm4gdG9rZW5pemVyLnN1YnN0cmluZ1RvUG9zKGVuZCArIDEpOwp9CgpmdW5jdGlvbiByZWFkTXVsdGlwbGllclJhbmdlKHRva2VuaXplcikgewogICAgbGV0IG1pbiA9IG51bGw7CiAgICBsZXQgbWF4ID0gbnVsbDsKCiAgICB0b2tlbml6ZXIuZWF0KExFRlRDVVJMWUJSQUNLRVQpOwoKICAgIG1pbiA9IHNjYW5OdW1iZXIodG9rZW5pemVyKTsKCiAgICBpZiAodG9rZW5pemVyLmNoYXJDb2RlKCkgPT09IENPTU1BKSB7CiAgICAgICAgdG9rZW5pemVyLnBvcysrOwogICAgICAgIGlmICh0b2tlbml6ZXIuY2hhckNvZGUoKSAhPT0gUklHSFRDVVJMWUJSQUNLRVQpIHsKICAgICAgICAgICAgbWF4ID0gc2Nhbk51bWJlcih0b2tlbml6ZXIpOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgbWF4ID0gbWluOwogICAgfQoKICAgIHRva2VuaXplci5lYXQoUklHSFRDVVJMWUJSQUNLRVQpOwoKICAgIHJldHVybiB7CiAgICAgICAgbWluOiBOdW1iZXIobWluKSwKICAgICAgICBtYXg6IG1heCA/IE51bWJlcihtYXgpIDogMAogICAgfTsKfQoKZnVuY3Rpb24gcmVhZE11bHRpcGxpZXIodG9rZW5pemVyKSB7CiAgICBsZXQgcmFuZ2UgPSBudWxsOwogICAgbGV0IGNvbW1hID0gZmFsc2U7CgogICAgc3dpdGNoICh0b2tlbml6ZXIuY2hhckNvZGUoKSkgewogICAgICAgIGNhc2UgQVNURVJJU0skNjoKICAgICAgICAgICAgdG9rZW5pemVyLnBvcysrOwoKICAgICAgICAgICAgcmFuZ2UgPSB7CiAgICAgICAgICAgICAgICBtaW46IDAsCiAgICAgICAgICAgICAgICBtYXg6IDAKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIFBMVVNTSUdOJDY6CiAgICAgICAgICAgIHRva2VuaXplci5wb3MrKzsKCiAgICAgICAgICAgIHJhbmdlID0gewogICAgICAgICAgICAgICAgbWluOiAxLAogICAgICAgICAgICAgICAgbWF4OiAwCiAgICAgICAgICAgIH07CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBRVUVTVElPTk1BUkskMToKICAgICAgICAgICAgdG9rZW5pemVyLnBvcysrOwoKICAgICAgICAgICAgcmFuZ2UgPSB7CiAgICAgICAgICAgICAgICBtaW46IDAsCiAgICAgICAgICAgICAgICBtYXg6IDEKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIE5VTUJFUlNJR04kMzoKICAgICAgICAgICAgdG9rZW5pemVyLnBvcysrOwoKICAgICAgICAgICAgY29tbWEgPSB0cnVlOwoKICAgICAgICAgICAgaWYgKHRva2VuaXplci5jaGFyQ29kZSgpID09PSBMRUZUQ1VSTFlCUkFDS0VUKSB7CiAgICAgICAgICAgICAgICByYW5nZSA9IHJlYWRNdWx0aXBsaWVyUmFuZ2UodG9rZW5pemVyKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0b2tlbml6ZXIuY2hhckNvZGUoKSA9PT0gUVVFU1RJT05NQVJLJDEpIHsKICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9jc3MtdmFsdWVzLTQvI2NvbXBvbmVudC1tdWx0aXBsaWVycwogICAgICAgICAgICAgICAgLy8gPiB0aGUgIyBhbmQgPyBtdWx0aXBsaWVycyBtYXkgYmUgc3RhY2tlZCBhcyAjPwogICAgICAgICAgICAgICAgLy8gSW4gdGhpcyBjYXNlIGp1c3QgdHJlYXQgIiM/IiBhcyBhIHNpbmdsZSBtdWx0aXBsaWVyCiAgICAgICAgICAgICAgICAvLyB7IG1pbjogMCwgbWF4OiAwLCBjb21tYTogdHJ1ZSB9CiAgICAgICAgICAgICAgICB0b2tlbml6ZXIucG9zKys7CiAgICAgICAgICAgICAgICByYW5nZSA9IHsKICAgICAgICAgICAgICAgICAgICBtaW46IDAsCiAgICAgICAgICAgICAgICAgICAgbWF4OiAwCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmFuZ2UgPSB7CiAgICAgICAgICAgICAgICAgICAgbWluOiAxLAogICAgICAgICAgICAgICAgICAgIG1heDogMAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgTEVGVENVUkxZQlJBQ0tFVDoKICAgICAgICAgICAgcmFuZ2UgPSByZWFkTXVsdGlwbGllclJhbmdlKHRva2VuaXplcik7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdNdWx0aXBsaWVyJywKICAgICAgICBjb21tYSwKICAgICAgICBtaW46IHJhbmdlLm1pbiwKICAgICAgICBtYXg6IHJhbmdlLm1heCwKICAgICAgICB0ZXJtOiBudWxsCiAgICB9Owp9CgpmdW5jdGlvbiBtYXliZU11bHRpcGxpZWQodG9rZW5pemVyLCBub2RlKSB7CiAgICBjb25zdCBtdWx0aXBsaWVyID0gcmVhZE11bHRpcGxpZXIodG9rZW5pemVyKTsKCiAgICBpZiAobXVsdGlwbGllciAhPT0gbnVsbCkgewogICAgICAgIG11bHRpcGxpZXIudGVybSA9IG5vZGU7CgogICAgICAgIC8vIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9jc3MtdmFsdWVzLTQvI2NvbXBvbmVudC1tdWx0aXBsaWVycwogICAgICAgIC8vID4gVGhlICsgYW5kICMgbXVsdGlwbGllcnMgbWF5IGJlIHN0YWNrZWQgYXMgKyM7CiAgICAgICAgLy8gUmVwcmVzZW50ICIrIyIgYXMgbmVzdGVkIG11bHRpcGxpZXJzOgogICAgICAgIC8vIHsgLi4uPG11bHRpcGxpZXIgIz4sCiAgICAgICAgLy8gICB0ZXJtOiB7CiAgICAgICAgLy8gICAgIC4uLjxtdWx0aXBsZXIgKz4sCiAgICAgICAgLy8gICAgIHRlcm06IG5vZGUKICAgICAgICAvLyAgIH0KICAgICAgICAvLyB9CiAgICAgICAgaWYgKHRva2VuaXplci5jaGFyQ29kZSgpID09PSBOVU1CRVJTSUdOJDMgJiYKICAgICAgICAgICAgdG9rZW5pemVyLmNoYXJDb2RlQXQodG9rZW5pemVyLnBvcyAtIDEpID09PSBQTFVTU0lHTiQ2KSB7CiAgICAgICAgICAgIHJldHVybiBtYXliZU11bHRpcGxpZWQodG9rZW5pemVyLCBtdWx0aXBsaWVyKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBtdWx0aXBsaWVyOwogICAgfQoKICAgIHJldHVybiBub2RlOwp9CgpmdW5jdGlvbiBtYXliZVRva2VuKHRva2VuaXplcikgewogICAgY29uc3QgY2ggPSB0b2tlbml6ZXIucGVlaygpOwoKICAgIGlmIChjaCA9PT0gJycpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdUb2tlbicsCiAgICAgICAgdmFsdWU6IGNoCiAgICB9Owp9CgpmdW5jdGlvbiByZWFkUHJvcGVydHkkMSh0b2tlbml6ZXIpIHsKICAgIGxldCBuYW1lOwoKICAgIHRva2VuaXplci5lYXQoTEVTU1RIQU5TSUdOKTsKICAgIHRva2VuaXplci5lYXQoQVBPU1RST1BIRSQyKTsKCiAgICBuYW1lID0gc2NhbldvcmQodG9rZW5pemVyKTsKCiAgICB0b2tlbml6ZXIuZWF0KEFQT1NUUk9QSEUkMik7CiAgICB0b2tlbml6ZXIuZWF0KEdSRUFURVJUSEFOU0lHTiQyKTsKCiAgICByZXR1cm4gbWF5YmVNdWx0aXBsaWVkKHRva2VuaXplciwgewogICAgICAgIHR5cGU6ICdQcm9wZXJ0eScsCiAgICAgICAgbmFtZQogICAgfSk7Cn0KCi8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3MtdmFsdWVzLTMvI251bWVyaWMtcmFuZ2VzCi8vIDQuMS4gUmFuZ2UgUmVzdHJpY3Rpb25zIGFuZCBSYW5nZSBEZWZpbml0aW9uIE5vdGF0aW9uCi8vCi8vIFJhbmdlIHJlc3RyaWN0aW9ucyBjYW4gYmUgYW5ub3RhdGVkIGluIHRoZSBudW1lcmljIHR5cGUgbm90YXRpb24gdXNpbmcgQ1NTIGJyYWNrZXRlZAovLyByYW5nZSBub3RhdGlvbuKAlFttaW4sbWF4XeKAlHdpdGhpbiB0aGUgYW5nbGUgYnJhY2tldHMsIGFmdGVyIHRoZSBpZGVudGlmeWluZyBrZXl3b3JkLAovLyBpbmRpY2F0aW5nIGEgY2xvc2VkIHJhbmdlIGJldHdlZW4gKGFuZCBpbmNsdWRpbmcpIG1pbiBhbmQgbWF4LgovLyBGb3IgZXhhbXBsZSwgPGludGVnZXIgWzAsIDEwXT4gaW5kaWNhdGVzIGFuIGludGVnZXIgYmV0d2VlbiAwIGFuZCAxMCwgaW5jbHVzaXZlLgpmdW5jdGlvbiByZWFkVHlwZVJhbmdlKHRva2VuaXplcikgewogICAgLy8gdXNlIG51bGwgZm9yIEluZmluaXR5IHRvIG1ha2UgQVNUIGZvcm1hdCBKU09OIHNlcmlhbGl6YWJsZS9kZXNlcmlhbGl6YWJsZQogICAgbGV0IG1pbiA9IG51bGw7IC8vIC1JbmZpbml0eQogICAgbGV0IG1heCA9IG51bGw7IC8vIEluZmluaXR5CiAgICBsZXQgc2lnbiA9IDE7CgogICAgdG9rZW5pemVyLmVhdChMRUZUU1FVQVJFQlJBQ0tFVCk7CgogICAgaWYgKHRva2VuaXplci5jaGFyQ29kZSgpID09PSBIWVBFUk1JTlVTKSB7CiAgICAgICAgdG9rZW5pemVyLnBlZWsoKTsKICAgICAgICBzaWduID0gLTE7CiAgICB9CgogICAgaWYgKHNpZ24gPT0gLTEgJiYgdG9rZW5pemVyLmNoYXJDb2RlKCkgPT09IElORklOSVRZKSB7CiAgICAgICAgdG9rZW5pemVyLnBlZWsoKTsKICAgIH0gZWxzZSB7CiAgICAgICAgbWluID0gc2lnbiAqIE51bWJlcihzY2FuTnVtYmVyKHRva2VuaXplcikpOwoKICAgICAgICBpZiAoTkFNRV9DSEFSW3Rva2VuaXplci5jaGFyQ29kZSgpXSAhPT0gMCkgewogICAgICAgICAgICBtaW4gKz0gc2NhbldvcmQodG9rZW5pemVyKTsKICAgICAgICB9CiAgICB9CgogICAgc2NhblNwYWNlcyh0b2tlbml6ZXIpOwogICAgdG9rZW5pemVyLmVhdChDT01NQSk7CiAgICBzY2FuU3BhY2VzKHRva2VuaXplcik7CgogICAgaWYgKHRva2VuaXplci5jaGFyQ29kZSgpID09PSBJTkZJTklUWSkgewogICAgICAgIHRva2VuaXplci5wZWVrKCk7CiAgICB9IGVsc2UgewogICAgICAgIHNpZ24gPSAxOwoKICAgICAgICBpZiAodG9rZW5pemVyLmNoYXJDb2RlKCkgPT09IEhZUEVSTUlOVVMpIHsKICAgICAgICAgICAgdG9rZW5pemVyLnBlZWsoKTsKICAgICAgICAgICAgc2lnbiA9IC0xOwogICAgICAgIH0KCiAgICAgICAgbWF4ID0gc2lnbiAqIE51bWJlcihzY2FuTnVtYmVyKHRva2VuaXplcikpOwoKICAgICAgICBpZiAoTkFNRV9DSEFSW3Rva2VuaXplci5jaGFyQ29kZSgpXSAhPT0gMCkgewogICAgICAgICAgICBtYXggKz0gc2NhbldvcmQodG9rZW5pemVyKTsKICAgICAgICB9CiAgICB9CgogICAgdG9rZW5pemVyLmVhdChSSUdIVFNRVUFSRUJSQUNLRVQpOwoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ1JhbmdlJywKICAgICAgICBtaW4sCiAgICAgICAgbWF4CiAgICB9Owp9CgpmdW5jdGlvbiByZWFkVHlwZSh0b2tlbml6ZXIpIHsKICAgIGxldCBuYW1lOwogICAgbGV0IG9wdHMgPSBudWxsOwoKICAgIHRva2VuaXplci5lYXQoTEVTU1RIQU5TSUdOKTsKICAgIG5hbWUgPSBzY2FuV29yZCh0b2tlbml6ZXIpOwoKICAgIGlmICh0b2tlbml6ZXIuY2hhckNvZGUoKSA9PT0gTEVGVFBBUkVOVEhFU0lTJDIgJiYKICAgICAgICB0b2tlbml6ZXIubmV4dENoYXJDb2RlKCkgPT09IFJJR0hUUEFSRU5USEVTSVMkMikgewogICAgICAgIHRva2VuaXplci5wb3MgKz0gMjsKICAgICAgICBuYW1lICs9ICcoKSc7CiAgICB9CgogICAgaWYgKHRva2VuaXplci5jaGFyQ29kZUF0KHRva2VuaXplci5maW5kV3NFbmQodG9rZW5pemVyLnBvcykpID09PSBMRUZUU1FVQVJFQlJBQ0tFVCkgewogICAgICAgIHNjYW5TcGFjZXModG9rZW5pemVyKTsKICAgICAgICBvcHRzID0gcmVhZFR5cGVSYW5nZSh0b2tlbml6ZXIpOwogICAgfQoKICAgIHRva2VuaXplci5lYXQoR1JFQVRFUlRIQU5TSUdOJDIpOwoKICAgIHJldHVybiBtYXliZU11bHRpcGxpZWQodG9rZW5pemVyLCB7CiAgICAgICAgdHlwZTogJ1R5cGUnLAogICAgICAgIG5hbWUsCiAgICAgICAgb3B0cwogICAgfSk7Cn0KCmZ1bmN0aW9uIHJlYWRLZXl3b3JkT3JGdW5jdGlvbih0b2tlbml6ZXIpIHsKICAgIGNvbnN0IG5hbWUgPSBzY2FuV29yZCh0b2tlbml6ZXIpOwoKICAgIGlmICh0b2tlbml6ZXIuY2hhckNvZGUoKSA9PT0gTEVGVFBBUkVOVEhFU0lTJDIpIHsKICAgICAgICB0b2tlbml6ZXIucG9zKys7CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHR5cGU6ICdGdW5jdGlvbicsCiAgICAgICAgICAgIG5hbWUKICAgICAgICB9OwogICAgfQoKICAgIHJldHVybiBtYXliZU11bHRpcGxpZWQodG9rZW5pemVyLCB7CiAgICAgICAgdHlwZTogJ0tleXdvcmQnLAogICAgICAgIG5hbWUKICAgIH0pOwp9CgpmdW5jdGlvbiByZWdyb3VwVGVybXModGVybXMsIGNvbWJpbmF0b3JzKSB7CiAgICBmdW5jdGlvbiBjcmVhdGVHcm91cCh0ZXJtcywgY29tYmluYXRvcikgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHR5cGU6ICdHcm91cCcsCiAgICAgICAgICAgIHRlcm1zLAogICAgICAgICAgICBjb21iaW5hdG9yLAogICAgICAgICAgICBkaXNhbGxvd0VtcHR5OiBmYWxzZSwKICAgICAgICAgICAgZXhwbGljaXQ6IGZhbHNlCiAgICAgICAgfTsKICAgIH0KCiAgICBsZXQgY29tYmluYXRvcjsKCiAgICBjb21iaW5hdG9ycyA9IE9iamVjdC5rZXlzKGNvbWJpbmF0b3JzKQogICAgICAgIC5zb3J0KChhLCBiKSA9PiBDT01CSU5BVE9SX1BSRUNFREVOQ0VbYV0gLSBDT01CSU5BVE9SX1BSRUNFREVOQ0VbYl0pOwoKICAgIHdoaWxlIChjb21iaW5hdG9ycy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29tYmluYXRvciA9IGNvbWJpbmF0b3JzLnNoaWZ0KCk7CgogICAgICAgIGxldCBpID0gMDsKICAgICAgICBsZXQgc3ViZ3JvdXBTdGFydCA9IDA7CgogICAgICAgIGZvciAoOyBpIDwgdGVybXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgdGVybSA9IHRlcm1zW2ldOwoKICAgICAgICAgICAgaWYgKHRlcm0udHlwZSA9PT0gJ0NvbWJpbmF0b3InKSB7CiAgICAgICAgICAgICAgICBpZiAodGVybS52YWx1ZSA9PT0gY29tYmluYXRvcikgewogICAgICAgICAgICAgICAgICAgIGlmIChzdWJncm91cFN0YXJ0ID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICBzdWJncm91cFN0YXJ0ID0gaSAtIDE7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRlcm1zLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgICAgICAgICBpLS07CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChzdWJncm91cFN0YXJ0ICE9PSAtMSAmJiBpIC0gc3ViZ3JvdXBTdGFydCA+IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGVybXMuc3BsaWNlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViZ3JvdXBTdGFydCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgLSBzdWJncm91cFN0YXJ0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlR3JvdXAodGVybXMuc2xpY2Uoc3ViZ3JvdXBTdGFydCwgaSksIGNvbWJpbmF0b3IpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIGkgPSBzdWJncm91cFN0YXJ0ICsgMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc3ViZ3JvdXBTdGFydCA9IC0xOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoc3ViZ3JvdXBTdGFydCAhPT0gLTEgJiYgY29tYmluYXRvcnMubGVuZ3RoKSB7CiAgICAgICAgICAgIHRlcm1zLnNwbGljZSgKICAgICAgICAgICAgICAgIHN1Ymdyb3VwU3RhcnQsCiAgICAgICAgICAgICAgICBpIC0gc3ViZ3JvdXBTdGFydCwKICAgICAgICAgICAgICAgIGNyZWF0ZUdyb3VwKHRlcm1zLnNsaWNlKHN1Ymdyb3VwU3RhcnQsIGkpLCBjb21iaW5hdG9yKQogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gY29tYmluYXRvcjsKfQoKZnVuY3Rpb24gcmVhZEltcGxpY2l0R3JvdXAodG9rZW5pemVyKSB7CiAgICBjb25zdCB0ZXJtcyA9IFtdOwogICAgY29uc3QgY29tYmluYXRvcnMgPSB7fTsKICAgIGxldCB0b2tlbjsKICAgIGxldCBwcmV2VG9rZW4gPSBudWxsOwogICAgbGV0IHByZXZUb2tlblBvcyA9IHRva2VuaXplci5wb3M7CgogICAgd2hpbGUgKHRva2VuID0gcGVlayh0b2tlbml6ZXIpKSB7CiAgICAgICAgaWYgKHRva2VuLnR5cGUgIT09ICdTcGFjZXMnKSB7CiAgICAgICAgICAgIGlmICh0b2tlbi50eXBlID09PSAnQ29tYmluYXRvcicpIHsKICAgICAgICAgICAgICAgIC8vIGNoZWNrIGZvciBjb21iaW5hdG9yIGluIGdyb3VwIGJlZ2lubmluZyBhbmQgZG91YmxlIGNvbWJpbmF0b3Igc2VxdWVuY2UKICAgICAgICAgICAgICAgIGlmIChwcmV2VG9rZW4gPT09IG51bGwgfHwgcHJldlRva2VuLnR5cGUgPT09ICdDb21iaW5hdG9yJykgewogICAgICAgICAgICAgICAgICAgIHRva2VuaXplci5wb3MgPSBwcmV2VG9rZW5Qb3M7CiAgICAgICAgICAgICAgICAgICAgdG9rZW5pemVyLmVycm9yKCdVbmV4cGVjdGVkIGNvbWJpbmF0b3InKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb21iaW5hdG9yc1t0b2tlbi52YWx1ZV0gPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgaWYgKHByZXZUb2tlbiAhPT0gbnVsbCAmJiBwcmV2VG9rZW4udHlwZSAhPT0gJ0NvbWJpbmF0b3InKSB7CiAgICAgICAgICAgICAgICBjb21iaW5hdG9yc1snICddID0gdHJ1ZTsgIC8vIGEgYgogICAgICAgICAgICAgICAgdGVybXMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0NvbWJpbmF0b3InLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnICcKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0ZXJtcy5wdXNoKHRva2VuKTsKICAgICAgICAgICAgcHJldlRva2VuID0gdG9rZW47CiAgICAgICAgICAgIHByZXZUb2tlblBvcyA9IHRva2VuaXplci5wb3M7CiAgICAgICAgfQogICAgfQoKICAgIC8vIGNoZWNrIGZvciBjb21iaW5hdG9yIGluIGdyb3VwIGVuZGluZwogICAgaWYgKHByZXZUb2tlbiAhPT0gbnVsbCAmJiBwcmV2VG9rZW4udHlwZSA9PT0gJ0NvbWJpbmF0b3InKSB7CiAgICAgICAgdG9rZW5pemVyLnBvcyAtPSBwcmV2VG9rZW5Qb3M7CiAgICAgICAgdG9rZW5pemVyLmVycm9yKCdVbmV4cGVjdGVkIGNvbWJpbmF0b3InKTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdHcm91cCcsCiAgICAgICAgdGVybXMsCiAgICAgICAgY29tYmluYXRvcjogcmVncm91cFRlcm1zKHRlcm1zLCBjb21iaW5hdG9ycykgfHwgJyAnLAogICAgICAgIGRpc2FsbG93RW1wdHk6IGZhbHNlLAogICAgICAgIGV4cGxpY2l0OiBmYWxzZQogICAgfTsKfQoKZnVuY3Rpb24gcmVhZEdyb3VwKHRva2VuaXplcikgewogICAgbGV0IHJlc3VsdDsKCiAgICB0b2tlbml6ZXIuZWF0KExFRlRTUVVBUkVCUkFDS0VUKTsKICAgIHJlc3VsdCA9IHJlYWRJbXBsaWNpdEdyb3VwKHRva2VuaXplcik7CiAgICB0b2tlbml6ZXIuZWF0KFJJR0hUU1FVQVJFQlJBQ0tFVCk7CgogICAgcmVzdWx0LmV4cGxpY2l0ID0gdHJ1ZTsKCiAgICBpZiAodG9rZW5pemVyLmNoYXJDb2RlKCkgPT09IEVYQ0xBTUFUSU9OTUFSSyQyKSB7CiAgICAgICAgdG9rZW5pemVyLnBvcysrOwogICAgICAgIHJlc3VsdC5kaXNhbGxvd0VtcHR5ID0gdHJ1ZTsKICAgIH0KCiAgICByZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiBwZWVrKHRva2VuaXplcikgewogICAgbGV0IGNvZGUgPSB0b2tlbml6ZXIuY2hhckNvZGUoKTsKCiAgICBpZiAoY29kZSA8IDEyOCAmJiBOQU1FX0NIQVJbY29kZV0gPT09IDEpIHsKICAgICAgICByZXR1cm4gcmVhZEtleXdvcmRPckZ1bmN0aW9uKHRva2VuaXplcik7CiAgICB9CgogICAgc3dpdGNoIChjb2RlKSB7CiAgICAgICAgY2FzZSBSSUdIVFNRVUFSRUJSQUNLRVQ6CiAgICAgICAgICAgIC8vIGRvbid0IGVhdCwgc3RvcCBzY2FuIGEgZ3JvdXAKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgTEVGVFNRVUFSRUJSQUNLRVQ6CiAgICAgICAgICAgIHJldHVybiBtYXliZU11bHRpcGxpZWQodG9rZW5pemVyLCByZWFkR3JvdXAodG9rZW5pemVyKSk7CgogICAgICAgIGNhc2UgTEVTU1RIQU5TSUdOOgogICAgICAgICAgICByZXR1cm4gdG9rZW5pemVyLm5leHRDaGFyQ29kZSgpID09PSBBUE9TVFJPUEhFJDIKICAgICAgICAgICAgICAgID8gcmVhZFByb3BlcnR5JDEodG9rZW5pemVyKQogICAgICAgICAgICAgICAgOiByZWFkVHlwZSh0b2tlbml6ZXIpOwoKICAgICAgICBjYXNlIFZFUlRJQ0FMTElORSQzOgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgdHlwZTogJ0NvbWJpbmF0b3InLAogICAgICAgICAgICAgICAgdmFsdWU6IHRva2VuaXplci5zdWJzdHJpbmdUb1BvcygKICAgICAgICAgICAgICAgICAgICB0b2tlbml6ZXIucG9zICsgKHRva2VuaXplci5uZXh0Q2hhckNvZGUoKSA9PT0gVkVSVElDQUxMSU5FJDMgPyAyIDogMSkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgfTsKCiAgICAgICAgY2FzZSBBTVBFUlNBTkQkNToKICAgICAgICAgICAgdG9rZW5pemVyLnBvcysrOwogICAgICAgICAgICB0b2tlbml6ZXIuZWF0KEFNUEVSU0FORCQ1KTsKCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0eXBlOiAnQ29tYmluYXRvcicsCiAgICAgICAgICAgICAgICB2YWx1ZTogJyYmJwogICAgICAgICAgICB9OwoKICAgICAgICBjYXNlIENPTU1BOgogICAgICAgICAgICB0b2tlbml6ZXIucG9zKys7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0eXBlOiAnQ29tbWEnCiAgICAgICAgICAgIH07CgogICAgICAgIGNhc2UgQVBPU1RST1BIRSQyOgogICAgICAgICAgICByZXR1cm4gbWF5YmVNdWx0aXBsaWVkKHRva2VuaXplciwgewogICAgICAgICAgICAgICAgdHlwZTogJ1N0cmluZycsCiAgICAgICAgICAgICAgICB2YWx1ZTogc2NhblN0cmluZyh0b2tlbml6ZXIpCiAgICAgICAgICAgIH0pOwoKICAgICAgICBjYXNlIFNQQUNFJDI6CiAgICAgICAgY2FzZSBUQUI6CiAgICAgICAgY2FzZSBOJDE6CiAgICAgICAgY2FzZSBSOgogICAgICAgIGNhc2UgRjoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHR5cGU6ICdTcGFjZXMnLAogICAgICAgICAgICAgICAgdmFsdWU6IHNjYW5TcGFjZXModG9rZW5pemVyKQogICAgICAgICAgICB9OwoKICAgICAgICBjYXNlIENPTU1FUkNJQUxBVDoKICAgICAgICAgICAgY29kZSA9IHRva2VuaXplci5uZXh0Q2hhckNvZGUoKTsKCiAgICAgICAgICAgIGlmIChjb2RlIDwgMTI4ICYmIE5BTUVfQ0hBUltjb2RlXSA9PT0gMSkgewogICAgICAgICAgICAgICAgdG9rZW5pemVyLnBvcysrOwogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnQXRLZXl3b3JkJywKICAgICAgICAgICAgICAgICAgICBuYW1lOiBzY2FuV29yZCh0b2tlbml6ZXIpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbWF5YmVUb2tlbih0b2tlbml6ZXIpOwoKICAgICAgICBjYXNlIEFTVEVSSVNLJDY6CiAgICAgICAgY2FzZSBQTFVTU0lHTiQ2OgogICAgICAgIGNhc2UgUVVFU1RJT05NQVJLJDE6CiAgICAgICAgY2FzZSBOVU1CRVJTSUdOJDM6CiAgICAgICAgY2FzZSBFWENMQU1BVElPTk1BUkskMjoKICAgICAgICAgICAgLy8gcHJvaGliaXRlZCB0b2tlbnMgKHVzZWQgYXMgYSBtdWx0aXBsaWVyIHN0YXJ0KQogICAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBMRUZUQ1VSTFlCUkFDS0VUOgogICAgICAgICAgICAvLyBMRUZUQ1VSTFlCUkFDS0VUIGlzIGFsbG93ZWQgc2luY2UgbWRuL2RhdGEgdXNlcyBpdCB3L28gcXVvdGluZwogICAgICAgICAgICAvLyBjaGVjayBuZXh0IGNoYXIgaXNuJ3QgYSBudW1iZXIsIGJlY2F1c2UgaXQncyBsaWtlbHkgYSBkaXNqb2luZWQgbXVsdGlwbGllcgogICAgICAgICAgICBjb2RlID0gdG9rZW5pemVyLm5leHRDaGFyQ29kZSgpOwoKICAgICAgICAgICAgaWYgKGNvZGUgPCA0OCB8fCBjb2RlID4gNTcpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXliZVRva2VuKHRva2VuaXplcik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICByZXR1cm4gbWF5YmVUb2tlbih0b2tlbml6ZXIpOwogICAgfQp9CgpmdW5jdGlvbiBwYXJzZSRHKHNvdXJjZSkgewogICAgY29uc3QgdG9rZW5pemVyID0gbmV3IFRva2VuaXplcihzb3VyY2UpOwogICAgY29uc3QgcmVzdWx0ID0gcmVhZEltcGxpY2l0R3JvdXAodG9rZW5pemVyKTsKCiAgICBpZiAodG9rZW5pemVyLnBvcyAhPT0gc291cmNlLmxlbmd0aCkgewogICAgICAgIHRva2VuaXplci5lcnJvcignVW5leHBlY3RlZCBpbnB1dCcpOwogICAgfQoKICAgIC8vIHJlZHVjZSByZWR1bmRhbnQgZ3JvdXBzIHdpdGggc2luZ2xlIGdyb3VwIHRlcm0KICAgIGlmIChyZXN1bHQudGVybXMubGVuZ3RoID09PSAxICYmIHJlc3VsdC50ZXJtc1swXS50eXBlID09PSAnR3JvdXAnKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdC50ZXJtc1swXTsKICAgIH0KCiAgICByZXR1cm4gcmVzdWx0Owp9Cgpjb25zdCBub29wID0gZnVuY3Rpb24oKSB7fTsKCmZ1bmN0aW9uIGVuc3VyZUZ1bmN0aW9uKHZhbHVlKSB7CiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nID8gdmFsdWUgOiBub29wOwp9CgpmdW5jdGlvbiB3YWxrJDEobm9kZSwgb3B0aW9ucywgY29udGV4dCkgewogICAgZnVuY3Rpb24gd2Fsayhub2RlKSB7CiAgICAgICAgZW50ZXIuY2FsbChjb250ZXh0LCBub2RlKTsKCiAgICAgICAgc3dpdGNoIChub2RlLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAnR3JvdXAnOgogICAgICAgICAgICAgICAgbm9kZS50ZXJtcy5mb3JFYWNoKHdhbGspOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICdNdWx0aXBsaWVyJzoKICAgICAgICAgICAgICAgIHdhbGsobm9kZS50ZXJtKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAnVHlwZSc6CiAgICAgICAgICAgIGNhc2UgJ1Byb3BlcnR5JzoKICAgICAgICAgICAgY2FzZSAnS2V5d29yZCc6CiAgICAgICAgICAgIGNhc2UgJ0F0S2V5d29yZCc6CiAgICAgICAgICAgIGNhc2UgJ0Z1bmN0aW9uJzoKICAgICAgICAgICAgY2FzZSAnU3RyaW5nJzoKICAgICAgICAgICAgY2FzZSAnVG9rZW4nOgogICAgICAgICAgICBjYXNlICdDb21tYSc6CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gdHlwZTogJyArIG5vZGUudHlwZSk7CiAgICAgICAgfQoKICAgICAgICBsZWF2ZS5jYWxsKGNvbnRleHQsIG5vZGUpOwogICAgfQoKICAgIGxldCBlbnRlciA9IG5vb3A7CiAgICBsZXQgbGVhdmUgPSBub29wOwoKICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIGVudGVyID0gb3B0aW9uczsKICAgIH0gZWxzZSBpZiAob3B0aW9ucykgewogICAgICAgIGVudGVyID0gZW5zdXJlRnVuY3Rpb24ob3B0aW9ucy5lbnRlcik7CiAgICAgICAgbGVhdmUgPSBlbnN1cmVGdW5jdGlvbihvcHRpb25zLmxlYXZlKTsKICAgIH0KCiAgICBpZiAoZW50ZXIgPT09IG5vb3AgJiYgbGVhdmUgPT09IG5vb3ApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05laXRoZXIgYGVudGVyYCBub3IgYGxlYXZlYCB3YWxrZXIgaGFuZGxlciBpcyBzZXQgb3IgYm90aCBhcmVuXCd0IGEgZnVuY3Rpb24nKTsKICAgIH0KCiAgICB3YWxrKG5vZGUpOwp9Cgpjb25zdCBhc3RUb1Rva2VucyA9IHsKICAgIGRlY29yYXRvcihoYW5kbGVycykgewogICAgICAgIGNvbnN0IHRva2VucyA9IFtdOwogICAgICAgIGxldCBjdXJOb2RlID0gbnVsbDsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgLi4uaGFuZGxlcnMsCiAgICAgICAgICAgIG5vZGUobm9kZSkgewogICAgICAgICAgICAgICAgY29uc3QgdG1wID0gY3VyTm9kZTsKICAgICAgICAgICAgICAgIGN1ck5vZGUgPSBub2RlOwogICAgICAgICAgICAgICAgaGFuZGxlcnMubm9kZS5jYWxsKHRoaXMsIG5vZGUpOwogICAgICAgICAgICAgICAgY3VyTm9kZSA9IHRtcDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW1pdCh2YWx1ZSwgdHlwZSwgYXV0bykgewogICAgICAgICAgICAgICAgdG9rZW5zLnB1c2goewogICAgICAgICAgICAgICAgICAgIHR5cGUsCiAgICAgICAgICAgICAgICAgICAgdmFsdWUsCiAgICAgICAgICAgICAgICAgICAgbm9kZTogYXV0byA/IG51bGwgOiBjdXJOb2RlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmVzdWx0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRva2VuczsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9Cn07CgpmdW5jdGlvbiBzdHJpbmdUb1Rva2VucyhzdHIpIHsKICAgIGNvbnN0IHRva2VucyA9IFtdOwoKICAgIHRva2VuaXplJDEoc3RyLCAodHlwZSwgc3RhcnQsIGVuZCkgPT4KICAgICAgICB0b2tlbnMucHVzaCh7CiAgICAgICAgICAgIHR5cGUsCiAgICAgICAgICAgIHZhbHVlOiBzdHIuc2xpY2Uoc3RhcnQsIGVuZCksCiAgICAgICAgICAgIG5vZGU6IG51bGwKICAgICAgICB9KQogICAgKTsKCiAgICByZXR1cm4gdG9rZW5zOwp9CgpmdW5jdGlvbiBwcmVwYXJlVG9rZW5zKHZhbHVlLCBzeW50YXgpIHsKICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgcmV0dXJuIHN0cmluZ1RvVG9rZW5zKHZhbHVlKTsKICAgIH0KCiAgICByZXR1cm4gc3ludGF4LmdlbmVyYXRlKHZhbHVlLCBhc3RUb1Rva2Vucyk7Cn0KCmNvbnN0IE1BVENIID0geyB0eXBlOiAnTWF0Y2gnIH07CmNvbnN0IE1JU01BVENIID0geyB0eXBlOiAnTWlzbWF0Y2gnIH07CmNvbnN0IERJU0FMTE9XX0VNUFRZID0geyB0eXBlOiAnRGlzYWxsb3dFbXB0eScgfTsKCmNvbnN0IExFRlRQQVJFTlRIRVNJUyQxID0gNDA7ICAvLyAoCmNvbnN0IFJJR0hUUEFSRU5USEVTSVMkMSA9IDQxOyAvLyApCgpmdW5jdGlvbiBjcmVhdGVDb25kaXRpb24obWF0Y2gsIHRoZW5CcmFuY2gsIGVsc2VCcmFuY2gpIHsKICAgIC8vIHJlZHVjZSBub2RlIGNvdW50CiAgICBpZiAodGhlbkJyYW5jaCA9PT0gTUFUQ0ggJiYgZWxzZUJyYW5jaCA9PT0gTUlTTUFUQ0gpIHsKICAgICAgICByZXR1cm4gbWF0Y2g7CiAgICB9CgogICAgaWYgKG1hdGNoID09PSBNQVRDSCAmJiB0aGVuQnJhbmNoID09PSBNQVRDSCAmJiBlbHNlQnJhbmNoID09PSBNQVRDSCkgewogICAgICAgIHJldHVybiBtYXRjaDsKICAgIH0KCiAgICBpZiAobWF0Y2gudHlwZSA9PT0gJ0lmJyAmJiBtYXRjaC5lbHNlID09PSBNSVNNQVRDSCAmJiB0aGVuQnJhbmNoID09PSBNQVRDSCkgewogICAgICAgIHRoZW5CcmFuY2ggPSBtYXRjaC50aGVuOwogICAgICAgIG1hdGNoID0gbWF0Y2gubWF0Y2g7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnSWYnLAogICAgICAgIG1hdGNoLAogICAgICAgIHRoZW46IHRoZW5CcmFuY2gsCiAgICAgICAgZWxzZTogZWxzZUJyYW5jaAogICAgfTsKfQoKZnVuY3Rpb24gaXNGdW5jdGlvblR5cGUobmFtZSkgewogICAgcmV0dXJuICgKICAgICAgICBuYW1lLmxlbmd0aCA+IDIgJiYKICAgICAgICBuYW1lLmNoYXJDb2RlQXQobmFtZS5sZW5ndGggLSAyKSA9PT0gTEVGVFBBUkVOVEhFU0lTJDEgJiYKICAgICAgICBuYW1lLmNoYXJDb2RlQXQobmFtZS5sZW5ndGggLSAxKSA9PT0gUklHSFRQQVJFTlRIRVNJUyQxCiAgICApOwp9CgpmdW5jdGlvbiBpc0VudW1DYXBhdGlibGUodGVybSkgewogICAgcmV0dXJuICgKICAgICAgICB0ZXJtLnR5cGUgPT09ICdLZXl3b3JkJyB8fAogICAgICAgIHRlcm0udHlwZSA9PT0gJ0F0S2V5d29yZCcgfHwKICAgICAgICB0ZXJtLnR5cGUgPT09ICdGdW5jdGlvbicgfHwKICAgICAgICB0ZXJtLnR5cGUgPT09ICdUeXBlJyAmJiBpc0Z1bmN0aW9uVHlwZSh0ZXJtLm5hbWUpCiAgICApOwp9CgpmdW5jdGlvbiBidWlsZEdyb3VwTWF0Y2hHcmFwaChjb21iaW5hdG9yLCB0ZXJtcywgYXRMZWFzdE9uZVRlcm1NYXRjaGVkKSB7CiAgICBzd2l0Y2ggKGNvbWJpbmF0b3IpIHsKICAgICAgICBjYXNlICcgJzogewogICAgICAgICAgICAvLyBKdXh0YXBvc2luZyBjb21wb25lbnRzIG1lYW5zIHRoYXQgYWxsIG9mIHRoZW0gbXVzdCBvY2N1ciwgaW4gdGhlIGdpdmVuIG9yZGVyLgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBhIGIgYwogICAgICAgICAgICAvLyA9CiAgICAgICAgICAgIC8vIG1hdGNoIGEKICAgICAgICAgICAgLy8gICB0aGVuIG1hdGNoIGIKICAgICAgICAgICAgLy8gICAgIHRoZW4gbWF0Y2ggYwogICAgICAgICAgICAvLyAgICAgICB0aGVuIE1BVENICiAgICAgICAgICAgIC8vICAgICAgIGVsc2UgTUlTTUFUQ0gKICAgICAgICAgICAgLy8gICAgIGVsc2UgTUlTTUFUQ0gKICAgICAgICAgICAgLy8gICBlbHNlIE1JU01BVENICiAgICAgICAgICAgIGxldCByZXN1bHQgPSBNQVRDSDsKCiAgICAgICAgICAgIGZvciAobGV0IGkgPSB0ZXJtcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgY29uc3QgdGVybSA9IHRlcm1zW2ldOwoKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNyZWF0ZUNvbmRpdGlvbigKICAgICAgICAgICAgICAgICAgICB0ZXJtLAogICAgICAgICAgICAgICAgICAgIHJlc3VsdCwKICAgICAgICAgICAgICAgICAgICBNSVNNQVRDSAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgY2FzZSAnfCc6IHsKICAgICAgICAgICAgLy8gQSBiYXIgKHwpIHNlcGFyYXRlcyB0d28gb3IgbW9yZSBhbHRlcm5hdGl2ZXM6IGV4YWN0bHkgb25lIG9mIHRoZW0gbXVzdCBvY2N1ci4KICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gYSB8IGIgfCBjCiAgICAgICAgICAgIC8vID0KICAgICAgICAgICAgLy8gbWF0Y2ggYQogICAgICAgICAgICAvLyAgIHRoZW4gTUFUQ0gKICAgICAgICAgICAgLy8gICBlbHNlIG1hdGNoIGIKICAgICAgICAgICAgLy8gICAgIHRoZW4gTUFUQ0gKICAgICAgICAgICAgLy8gICAgIGVsc2UgbWF0Y2ggYwogICAgICAgICAgICAvLyAgICAgICB0aGVuIE1BVENICiAgICAgICAgICAgIC8vICAgICAgIGVsc2UgTUlTTUFUQ0gKCiAgICAgICAgICAgIGxldCByZXN1bHQgPSBNSVNNQVRDSDsKICAgICAgICAgICAgbGV0IG1hcCA9IG51bGw7CgogICAgICAgICAgICBmb3IgKGxldCBpID0gdGVybXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgIGxldCB0ZXJtID0gdGVybXNbaV07CgogICAgICAgICAgICAgICAgLy8gcmVkdWNlIHNlcXVlbmNlIG9mIGtleXdvcmRzIGludG8gYSBFbnVtCiAgICAgICAgICAgICAgICBpZiAoaXNFbnVtQ2FwYXRpYmxlKHRlcm0pKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1hcCA9PT0gbnVsbCAmJiBpID4gMCAmJiBpc0VudW1DYXBhdGlibGUodGVybXNbaSAtIDFdKSkgewogICAgICAgICAgICAgICAgICAgICAgICBtYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBjcmVhdGVDb25kaXRpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0VudW0nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1BVENILAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAobWFwICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IChpc0Z1bmN0aW9uVHlwZSh0ZXJtLm5hbWUpID8gdGVybS5uYW1lLnNsaWNlKDAsIC0xKSA6IHRlcm0ubmFtZSkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSBpbiBtYXAgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXBba2V5XSA9IHRlcm07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBtYXAgPSBudWxsOwoKICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBhIG5ldyBjb25kaXRvbmFsIG5vZGUKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNyZWF0ZUNvbmRpdGlvbigKICAgICAgICAgICAgICAgICAgICB0ZXJtLAogICAgICAgICAgICAgICAgICAgIE1BVENILAogICAgICAgICAgICAgICAgICAgIHJlc3VsdAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgY2FzZSAnJiYnOiB7CiAgICAgICAgICAgIC8vIEEgZG91YmxlIGFtcGVyc2FuZCAoJiYpIHNlcGFyYXRlcyB0d28gb3IgbW9yZSBjb21wb25lbnRzLAogICAgICAgICAgICAvLyBhbGwgb2Ygd2hpY2ggbXVzdCBvY2N1ciwgaW4gYW55IG9yZGVyLgoKICAgICAgICAgICAgLy8gVXNlIE1hdGNoT25jZSBmb3IgZ3JvdXBzIHdpdGggYSBsYXJnZSBudW1iZXIgb2YgdGVybXMsCiAgICAgICAgICAgIC8vIHNpbmNlICYmLWdyb3VwcyBwcm9kdWNlcyBhdCBsZWFzdCBOIS1ub2RlIHRyZWVzCiAgICAgICAgICAgIGlmICh0ZXJtcy5sZW5ndGggPiA1KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdNYXRjaE9uY2UnLAogICAgICAgICAgICAgICAgICAgIHRlcm1zLAogICAgICAgICAgICAgICAgICAgIGFsbDogdHJ1ZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVXNlIGEgY29tYmluYXRpb24gdHJlZSBmb3IgZ3JvdXBzIHdpdGggc21hbGwgbnVtYmVyIG9mIHRlcm1zCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIGEgJiYgYiAmJiBjCiAgICAgICAgICAgIC8vID0KICAgICAgICAgICAgLy8gbWF0Y2ggYQogICAgICAgICAgICAvLyAgIHRoZW4gW2IgJiYgY10KICAgICAgICAgICAgLy8gICBlbHNlIG1hdGNoIGIKICAgICAgICAgICAgLy8gICAgIHRoZW4gW2EgJiYgY10KICAgICAgICAgICAgLy8gICAgIGVsc2UgbWF0Y2ggYwogICAgICAgICAgICAvLyAgICAgICB0aGVuIFthICYmIGJdCiAgICAgICAgICAgIC8vICAgICAgIGVsc2UgTUlTTUFUQ0gKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gYSAmJiBiCiAgICAgICAgICAgIC8vID0KICAgICAgICAgICAgLy8gbWF0Y2ggYQogICAgICAgICAgICAvLyAgIHRoZW4gbWF0Y2ggYgogICAgICAgICAgICAvLyAgICAgdGhlbiBNQVRDSAogICAgICAgICAgICAvLyAgICAgZWxzZSBNSVNNQVRDSAogICAgICAgICAgICAvLyAgIGVsc2UgbWF0Y2ggYgogICAgICAgICAgICAvLyAgICAgdGhlbiBtYXRjaCBhCiAgICAgICAgICAgIC8vICAgICAgIHRoZW4gTUFUQ0gKICAgICAgICAgICAgLy8gICAgICAgZWxzZSBNSVNNQVRDSAogICAgICAgICAgICAvLyAgICAgZWxzZSBNSVNNQVRDSAogICAgICAgICAgICBsZXQgcmVzdWx0ID0gTUlTTUFUQ0g7CgogICAgICAgICAgICBmb3IgKGxldCBpID0gdGVybXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRlcm0gPSB0ZXJtc1tpXTsKICAgICAgICAgICAgICAgIGxldCB0aGVuQ2xhdXNlOwoKICAgICAgICAgICAgICAgIGlmICh0ZXJtcy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgdGhlbkNsYXVzZSA9IGJ1aWxkR3JvdXBNYXRjaEdyYXBoKAogICAgICAgICAgICAgICAgICAgICAgICBjb21iaW5hdG9yLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXJtcy5maWx0ZXIoZnVuY3Rpb24obmV3R3JvdXBUZXJtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3R3JvdXBUZXJtICE9PSB0ZXJtOwogICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGVuQ2xhdXNlID0gTUFUQ0g7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmVzdWx0ID0gY3JlYXRlQ29uZGl0aW9uKAogICAgICAgICAgICAgICAgICAgIHRlcm0sCiAgICAgICAgICAgICAgICAgICAgdGhlbkNsYXVzZSwKICAgICAgICAgICAgICAgICAgICByZXN1bHQKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CgogICAgICAgIGNhc2UgJ3x8JzogewogICAgICAgICAgICAvLyBBIGRvdWJsZSBiYXIgKHx8KSBzZXBhcmF0ZXMgdHdvIG9yIG1vcmUgb3B0aW9uczoKICAgICAgICAgICAgLy8gb25lIG9yIG1vcmUgb2YgdGhlbSBtdXN0IG9jY3VyLCBpbiBhbnkgb3JkZXIuCgogICAgICAgICAgICAvLyBVc2UgTWF0Y2hPbmNlIGZvciBncm91cHMgd2l0aCBhIGxhcmdlIG51bWJlciBvZiB0ZXJtcywKICAgICAgICAgICAgLy8gc2luY2UgfHwtZ3JvdXBzIHByb2R1Y2VzIGF0IGxlYXN0IE4hLW5vZGUgdHJlZXMKICAgICAgICAgICAgaWYgKHRlcm1zLmxlbmd0aCA+IDUpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ01hdGNoT25jZScsCiAgICAgICAgICAgICAgICAgICAgdGVybXMsCiAgICAgICAgICAgICAgICAgICAgYWxsOiBmYWxzZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVXNlIGEgY29tYmluYXRpb24gdHJlZSBmb3IgZ3JvdXBzIHdpdGggc21hbGwgbnVtYmVyIG9mIHRlcm1zCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIGEgfHwgYiB8fCBjCiAgICAgICAgICAgIC8vID0KICAgICAgICAgICAgLy8gbWF0Y2ggYQogICAgICAgICAgICAvLyAgIHRoZW4gW2IgfHwgY10KICAgICAgICAgICAgLy8gICBlbHNlIG1hdGNoIGIKICAgICAgICAgICAgLy8gICAgIHRoZW4gW2EgfHwgY10KICAgICAgICAgICAgLy8gICAgIGVsc2UgbWF0Y2ggYwogICAgICAgICAgICAvLyAgICAgICB0aGVuIFthIHx8IGJdCiAgICAgICAgICAgIC8vICAgICAgIGVsc2UgTUlTTUFUQ0gKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gYSB8fCBiCiAgICAgICAgICAgIC8vID0KICAgICAgICAgICAgLy8gbWF0Y2ggYQogICAgICAgICAgICAvLyAgIHRoZW4gbWF0Y2ggYgogICAgICAgICAgICAvLyAgICAgdGhlbiBNQVRDSAogICAgICAgICAgICAvLyAgICAgZWxzZSBNQVRDSAogICAgICAgICAgICAvLyAgIGVsc2UgbWF0Y2ggYgogICAgICAgICAgICAvLyAgICAgdGhlbiBtYXRjaCBhCiAgICAgICAgICAgIC8vICAgICAgIHRoZW4gTUFUQ0gKICAgICAgICAgICAgLy8gICAgICAgZWxzZSBNQVRDSAogICAgICAgICAgICAvLyAgICAgZWxzZSBNSVNNQVRDSAogICAgICAgICAgICBsZXQgcmVzdWx0ID0gYXRMZWFzdE9uZVRlcm1NYXRjaGVkID8gTUFUQ0ggOiBNSVNNQVRDSDsKCiAgICAgICAgICAgIGZvciAobGV0IGkgPSB0ZXJtcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgY29uc3QgdGVybSA9IHRlcm1zW2ldOwogICAgICAgICAgICAgICAgbGV0IHRoZW5DbGF1c2U7CgogICAgICAgICAgICAgICAgaWYgKHRlcm1zLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgICAgICB0aGVuQ2xhdXNlID0gYnVpbGRHcm91cE1hdGNoR3JhcGgoCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbWJpbmF0b3IsCiAgICAgICAgICAgICAgICAgICAgICAgIHRlcm1zLmZpbHRlcihmdW5jdGlvbihuZXdHcm91cFRlcm0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXdHcm91cFRlcm0gIT09IHRlcm07CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgICB0cnVlCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhlbkNsYXVzZSA9IE1BVENIOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNyZWF0ZUNvbmRpdGlvbigKICAgICAgICAgICAgICAgICAgICB0ZXJtLAogICAgICAgICAgICAgICAgICAgIHRoZW5DbGF1c2UsCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0CiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgfQp9CgpmdW5jdGlvbiBidWlsZE11bHRpcGxpZXJNYXRjaEdyYXBoKG5vZGUpIHsKICAgIGxldCByZXN1bHQgPSBNQVRDSDsKICAgIGxldCBtYXRjaFRlcm0gPSBidWlsZE1hdGNoR3JhcGhJbnRlcm5hbChub2RlLnRlcm0pOwoKICAgIGlmIChub2RlLm1heCA9PT0gMCkgewogICAgICAgIC8vIGRpc2FibGUgcmVwZWF0aW5nIG9mIGVtcHR5IG1hdGNoIHRvIHByZXZlbnQgaW5maW5pdGUgbG9vcAogICAgICAgIG1hdGNoVGVybSA9IGNyZWF0ZUNvbmRpdGlvbigKICAgICAgICAgICAgbWF0Y2hUZXJtLAogICAgICAgICAgICBESVNBTExPV19FTVBUWSwKICAgICAgICAgICAgTUlTTUFUQ0gKICAgICAgICApOwoKICAgICAgICAvLyBhbiBvY2N1cnJlbmNlIGNvdW50IGlzIG5vdCBsaW1pdGVkLCBtYWtlIGEgY3ljbGU7CiAgICAgICAgLy8gdG8gY29sbGVjdCBtb3JlIHRlcm1zIG9uIGVhY2ggZm9sbG93aW5nIG1hdGNoaW5nIG1pc21hdGNoCiAgICAgICAgcmVzdWx0ID0gY3JlYXRlQ29uZGl0aW9uKAogICAgICAgICAgICBtYXRjaFRlcm0sCiAgICAgICAgICAgIG51bGwsIC8vIHdpbGwgYmUgYSBsb29wCiAgICAgICAgICAgIE1JU01BVENICiAgICAgICAgKTsKCiAgICAgICAgcmVzdWx0LnRoZW4gPSBjcmVhdGVDb25kaXRpb24oCiAgICAgICAgICAgIE1BVENILAogICAgICAgICAgICBNQVRDSCwKICAgICAgICAgICAgcmVzdWx0IC8vIG1ha2UgYSBsb29wCiAgICAgICAgKTsKCiAgICAgICAgaWYgKG5vZGUuY29tbWEpIHsKICAgICAgICAgICAgcmVzdWx0LnRoZW4uZWxzZSA9IGNyZWF0ZUNvbmRpdGlvbigKICAgICAgICAgICAgICAgIHsgdHlwZTogJ0NvbW1hJywgc3ludGF4OiBub2RlIH0sCiAgICAgICAgICAgICAgICByZXN1bHQsCiAgICAgICAgICAgICAgICBNSVNNQVRDSAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgLy8gY3JlYXRlIGEgbWF0Y2ggbm9kZSBjaGFpbiBmb3IgW21pbiAuLiBtYXhdIGludGVydmFsIHdpdGggb3B0aW9uYWwgbWF0Y2hlcwogICAgICAgIGZvciAobGV0IGkgPSBub2RlLm1pbiB8fCAxOyBpIDw9IG5vZGUubWF4OyBpKyspIHsKICAgICAgICAgICAgaWYgKG5vZGUuY29tbWEgJiYgcmVzdWx0ICE9PSBNQVRDSCkgewogICAgICAgICAgICAgICAgcmVzdWx0ID0gY3JlYXRlQ29uZGl0aW9uKAogICAgICAgICAgICAgICAgICAgIHsgdHlwZTogJ0NvbW1hJywgc3ludGF4OiBub2RlIH0sCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LAogICAgICAgICAgICAgICAgICAgIE1JU01BVENICiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXN1bHQgPSBjcmVhdGVDb25kaXRpb24oCiAgICAgICAgICAgICAgICBtYXRjaFRlcm0sCiAgICAgICAgICAgICAgICBjcmVhdGVDb25kaXRpb24oCiAgICAgICAgICAgICAgICAgICAgTUFUQ0gsCiAgICAgICAgICAgICAgICAgICAgTUFUQ0gsCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0CiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgTUlTTUFUQ0gKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgaWYgKG5vZGUubWluID09PSAwKSB7CiAgICAgICAgLy8gYWxsb3cgemVybyBtYXRjaAogICAgICAgIHJlc3VsdCA9IGNyZWF0ZUNvbmRpdGlvbigKICAgICAgICAgICAgTUFUQ0gsCiAgICAgICAgICAgIE1BVENILAogICAgICAgICAgICByZXN1bHQKICAgICAgICApOwogICAgfSBlbHNlIHsKICAgICAgICAvLyBjcmVhdGUgYSBtYXRjaCBub2RlIGNoYWluIHRvIGNvbGxlY3QgWzAgLi4uIG1pbiAtIDFdIHJlcXVpcmVkIG1hdGNoZXMKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5vZGUubWluIC0gMTsgaSsrKSB7CiAgICAgICAgICAgIGlmIChub2RlLmNvbW1hICYmIHJlc3VsdCAhPT0gTUFUQ0gpIHsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNyZWF0ZUNvbmRpdGlvbigKICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICdDb21tYScsIHN5bnRheDogbm9kZSB9LAogICAgICAgICAgICAgICAgICAgIHJlc3VsdCwKICAgICAgICAgICAgICAgICAgICBNSVNNQVRDSAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmVzdWx0ID0gY3JlYXRlQ29uZGl0aW9uKAogICAgICAgICAgICAgICAgbWF0Y2hUZXJtLAogICAgICAgICAgICAgICAgcmVzdWx0LAogICAgICAgICAgICAgICAgTUlTTUFUQ0gKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIHJlc3VsdDsKfQoKZnVuY3Rpb24gYnVpbGRNYXRjaEdyYXBoSW50ZXJuYWwobm9kZSkgewogICAgaWYgKHR5cGVvZiBub2RlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdHlwZTogJ0dlbmVyaWMnLAogICAgICAgICAgICBmbjogbm9kZQogICAgICAgIH07CiAgICB9CgogICAgc3dpdGNoIChub2RlLnR5cGUpIHsKICAgICAgICBjYXNlICdHcm91cCc6IHsKICAgICAgICAgICAgbGV0IHJlc3VsdCA9IGJ1aWxkR3JvdXBNYXRjaEdyYXBoKAogICAgICAgICAgICAgICAgbm9kZS5jb21iaW5hdG9yLAogICAgICAgICAgICAgICAgbm9kZS50ZXJtcy5tYXAoYnVpbGRNYXRjaEdyYXBoSW50ZXJuYWwpLAogICAgICAgICAgICAgICAgZmFsc2UKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmIChub2RlLmRpc2FsbG93RW1wdHkpIHsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNyZWF0ZUNvbmRpdGlvbigKICAgICAgICAgICAgICAgICAgICByZXN1bHQsCiAgICAgICAgICAgICAgICAgICAgRElTQUxMT1dfRU1QVFksCiAgICAgICAgICAgICAgICAgICAgTUlTTUFUQ0gKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQoKICAgICAgICBjYXNlICdNdWx0aXBsaWVyJzoKICAgICAgICAgICAgcmV0dXJuIGJ1aWxkTXVsdGlwbGllck1hdGNoR3JhcGgobm9kZSk7CgogICAgICAgIGNhc2UgJ1R5cGUnOgogICAgICAgIGNhc2UgJ1Byb3BlcnR5JzoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHR5cGU6IG5vZGUudHlwZSwKICAgICAgICAgICAgICAgIG5hbWU6IG5vZGUubmFtZSwKICAgICAgICAgICAgICAgIHN5bnRheDogbm9kZQogICAgICAgICAgICB9OwoKICAgICAgICBjYXNlICdLZXl3b3JkJzoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHR5cGU6IG5vZGUudHlwZSwKICAgICAgICAgICAgICAgIG5hbWU6IG5vZGUubmFtZS50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICAgICAgc3ludGF4OiBub2RlCiAgICAgICAgICAgIH07CgogICAgICAgIGNhc2UgJ0F0S2V5d29yZCc6CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0eXBlOiBub2RlLnR5cGUsCiAgICAgICAgICAgICAgICBuYW1lOiAnQCcgKyBub2RlLm5hbWUudG9Mb3dlckNhc2UoKSwKICAgICAgICAgICAgICAgIHN5bnRheDogbm9kZQogICAgICAgICAgICB9OwoKICAgICAgICBjYXNlICdGdW5jdGlvbic6CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0eXBlOiBub2RlLnR5cGUsCiAgICAgICAgICAgICAgICBuYW1lOiBub2RlLm5hbWUudG9Mb3dlckNhc2UoKSArICcoJywKICAgICAgICAgICAgICAgIHN5bnRheDogbm9kZQogICAgICAgICAgICB9OwoKICAgICAgICBjYXNlICdTdHJpbmcnOgogICAgICAgICAgICAvLyBjb252ZXJ0IGEgb25lIGNoYXIgbGVuZ3RoIFN0cmluZyB0byBhIFRva2VuCiAgICAgICAgICAgIGlmIChub2RlLnZhbHVlLmxlbmd0aCA9PT0gMykgewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnVG9rZW4nLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBub2RlLnZhbHVlLmNoYXJBdCgxKSwKICAgICAgICAgICAgICAgICAgICBzeW50YXg6IG5vZGUKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG90aGVyd2lzZSB1c2UgaXQgYXMgaXMKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHR5cGU6IG5vZGUudHlwZSwKICAgICAgICAgICAgICAgIHZhbHVlOiBub2RlLnZhbHVlLnN1YnN0cigxLCBub2RlLnZhbHVlLmxlbmd0aCAtIDIpLnJlcGxhY2UoL1xcJy9nLCAnXCcnKSwKICAgICAgICAgICAgICAgIHN5bnRheDogbm9kZQogICAgICAgICAgICB9OwoKICAgICAgICBjYXNlICdUb2tlbic6CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0eXBlOiBub2RlLnR5cGUsCiAgICAgICAgICAgICAgICB2YWx1ZTogbm9kZS52YWx1ZSwKICAgICAgICAgICAgICAgIHN5bnRheDogbm9kZQogICAgICAgICAgICB9OwoKICAgICAgICBjYXNlICdDb21tYSc6CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0eXBlOiBub2RlLnR5cGUsCiAgICAgICAgICAgICAgICBzeW50YXg6IG5vZGUKICAgICAgICAgICAgfTsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIG5vZGUgdHlwZTonLCBub2RlLnR5cGUpOwogICAgfQp9CgpmdW5jdGlvbiBidWlsZE1hdGNoR3JhcGgoc3ludGF4VHJlZSwgcmVmKSB7CiAgICBpZiAodHlwZW9mIHN5bnRheFRyZWUgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgc3ludGF4VHJlZSA9IHBhcnNlJEcoc3ludGF4VHJlZSk7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnTWF0Y2hHcmFwaCcsCiAgICAgICAgbWF0Y2g6IGJ1aWxkTWF0Y2hHcmFwaEludGVybmFsKHN5bnRheFRyZWUpLAogICAgICAgIHN5bnRheDogcmVmIHx8IG51bGwsCiAgICAgICAgc291cmNlOiBzeW50YXhUcmVlCiAgICB9Owp9Cgpjb25zdCB7IGhhc093blByb3BlcnR5OiBoYXNPd25Qcm9wZXJ0eSQyIH0gPSBPYmplY3QucHJvdG90eXBlOwpjb25zdCBTVFVCID0gMDsKY29uc3QgVE9LRU4gPSAxOwpjb25zdCBPUEVOX1NZTlRBWCA9IDI7CmNvbnN0IENMT1NFX1NZTlRBWCA9IDM7Cgpjb25zdCBFWElUX1JFQVNPTl9NQVRDSCA9ICdNYXRjaCc7CmNvbnN0IEVYSVRfUkVBU09OX01JU01BVENIID0gJ01pc21hdGNoJzsKY29uc3QgRVhJVF9SRUFTT05fSVRFUkFUSU9OX0xJTUlUID0gJ01heGltdW0gaXRlcmF0aW9uIG51bWJlciBleGNlZWRlZCAocGxlYXNlIGZpbGwgYW4gaXNzdWUgb24gaHR0cHM6Ly9naXRodWIuY29tL2Nzc3RyZWUvY3NzdHJlZS9pc3N1ZXMpJzsKCmNvbnN0IElURVJBVElPTl9MSU1JVCA9IDE1MDAwOwoKZnVuY3Rpb24gcmV2ZXJzZUxpc3QobGlzdCkgewogICAgbGV0IHByZXYgPSBudWxsOwogICAgbGV0IG5leHQgPSBudWxsOwogICAgbGV0IGl0ZW0gPSBsaXN0OwoKICAgIHdoaWxlIChpdGVtICE9PSBudWxsKSB7CiAgICAgICAgbmV4dCA9IGl0ZW0ucHJldjsKICAgICAgICBpdGVtLnByZXYgPSBwcmV2OwogICAgICAgIHByZXYgPSBpdGVtOwogICAgICAgIGl0ZW0gPSBuZXh0OwogICAgfQoKICAgIHJldHVybiBwcmV2Owp9CgpmdW5jdGlvbiBhcmVTdHJpbmdzRXF1YWxDYXNlSW5zZW5zaXRpdmUodGVzdFN0ciwgcmVmZXJlbmNlU3RyKSB7CiAgICBpZiAodGVzdFN0ci5sZW5ndGggIT09IHJlZmVyZW5jZVN0ci5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0ZXN0U3RyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgcmVmZXJlbmNlQ29kZSA9IHJlZmVyZW5jZVN0ci5jaGFyQ29kZUF0KGkpOwogICAgICAgIGxldCB0ZXN0Q29kZSA9IHRlc3RTdHIuY2hhckNvZGVBdChpKTsKCiAgICAgICAgLy8gdGVzdENvZGUudG9Mb3dlckNhc2UoKSBmb3IgVSswMDQxIExBVElOIENBUElUQUwgTEVUVEVSIEEgKEEpIC4uIFUrMDA1QSBMQVRJTiBDQVBJVEFMIExFVFRFUiBaIChaKS4KICAgICAgICBpZiAodGVzdENvZGUgPj0gMHgwMDQxICYmIHRlc3RDb2RlIDw9IDB4MDA1QSkgewogICAgICAgICAgICB0ZXN0Q29kZSA9IHRlc3RDb2RlIHwgMzI7CiAgICAgICAgfQoKICAgICAgICBpZiAodGVzdENvZGUgIT09IHJlZmVyZW5jZUNvZGUpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gaXNDb250ZXh0RWRnZURlbGltKHRva2VuKSB7CiAgICBpZiAodG9rZW4udHlwZSAhPT0gRGVsaW0pIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8gRml4IG1hdGNoaW5nIGZvciB1bmljb2RlLXJhbmdlOiBVKzMwPz8sIFUrRkYwMC1GRjlGCiAgICAvLyBQcm9iYWJseSB3ZSBuZWVkIHRvIGNoZWNrIG91dCBwcmV2aW91cyBtYXRjaCBpbnN0ZWFkCiAgICByZXR1cm4gdG9rZW4udmFsdWUgIT09ICc/JzsKfQoKZnVuY3Rpb24gaXNDb21tYUNvbnRleHRTdGFydCh0b2tlbikgewogICAgaWYgKHRva2VuID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcmV0dXJuICgKICAgICAgICB0b2tlbi50eXBlID09PSBDb21tYSB8fAogICAgICAgIHRva2VuLnR5cGUgPT09IEZ1bmN0aW9uJDIgfHwKICAgICAgICB0b2tlbi50eXBlID09PSBMZWZ0UGFyZW50aGVzaXMgfHwKICAgICAgICB0b2tlbi50eXBlID09PSBMZWZ0U3F1YXJlQnJhY2tldCB8fAogICAgICAgIHRva2VuLnR5cGUgPT09IExlZnRDdXJseUJyYWNrZXQgfHwKICAgICAgICBpc0NvbnRleHRFZGdlRGVsaW0odG9rZW4pCiAgICApOwp9CgpmdW5jdGlvbiBpc0NvbW1hQ29udGV4dEVuZCh0b2tlbikgewogICAgaWYgKHRva2VuID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcmV0dXJuICgKICAgICAgICB0b2tlbi50eXBlID09PSBSaWdodFBhcmVudGhlc2lzIHx8CiAgICAgICAgdG9rZW4udHlwZSA9PT0gUmlnaHRTcXVhcmVCcmFja2V0IHx8CiAgICAgICAgdG9rZW4udHlwZSA9PT0gUmlnaHRDdXJseUJyYWNrZXQgfHwKICAgICAgICAodG9rZW4udHlwZSA9PT0gRGVsaW0gJiYgdG9rZW4udmFsdWUgPT09ICcvJykKICAgICk7Cn0KCmZ1bmN0aW9uIGludGVybmFsTWF0Y2godG9rZW5zLCBzdGF0ZSwgc3ludGF4ZXMpIHsKICAgIGZ1bmN0aW9uIG1vdmVUb05leHRUb2tlbigpIHsKICAgICAgICBkbyB7CiAgICAgICAgICAgIHRva2VuSW5kZXgrKzsKICAgICAgICAgICAgdG9rZW4gPSB0b2tlbkluZGV4IDwgdG9rZW5zLmxlbmd0aCA/IHRva2Vuc1t0b2tlbkluZGV4XSA6IG51bGw7CiAgICAgICAgfSB3aGlsZSAodG9rZW4gIT09IG51bGwgJiYgKHRva2VuLnR5cGUgPT09IFdoaXRlU3BhY2UkMSB8fCB0b2tlbi50eXBlID09PSBDb21tZW50JDEpKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXROZXh0VG9rZW4ob2Zmc2V0KSB7CiAgICAgICAgY29uc3QgbmV4dEluZGV4ID0gdG9rZW5JbmRleCArIG9mZnNldDsKCiAgICAgICAgcmV0dXJuIG5leHRJbmRleCA8IHRva2Vucy5sZW5ndGggPyB0b2tlbnNbbmV4dEluZGV4XSA6IG51bGw7CiAgICB9CgogICAgZnVuY3Rpb24gc3RhdGVTbmFwc2hvdEZyb21TeW50YXgobmV4dFN0YXRlLCBwcmV2KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbmV4dFN0YXRlLAogICAgICAgICAgICBtYXRjaFN0YWNrLAogICAgICAgICAgICBzeW50YXhTdGFjaywKICAgICAgICAgICAgdGhlblN0YWNrLAogICAgICAgICAgICB0b2tlbkluZGV4LAogICAgICAgICAgICBwcmV2CiAgICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBwdXNoVGhlblN0YWNrKG5leHRTdGF0ZSkgewogICAgICAgIHRoZW5TdGFjayA9IHsKICAgICAgICAgICAgbmV4dFN0YXRlLAogICAgICAgICAgICBtYXRjaFN0YWNrLAogICAgICAgICAgICBzeW50YXhTdGFjaywKICAgICAgICAgICAgcHJldjogdGhlblN0YWNrCiAgICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBwdXNoRWxzZVN0YWNrKG5leHRTdGF0ZSkgewogICAgICAgIGVsc2VTdGFjayA9IHN0YXRlU25hcHNob3RGcm9tU3ludGF4KG5leHRTdGF0ZSwgZWxzZVN0YWNrKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGRUb2tlblRvTWF0Y2goKSB7CiAgICAgICAgbWF0Y2hTdGFjayA9IHsKICAgICAgICAgICAgdHlwZTogVE9LRU4sCiAgICAgICAgICAgIHN5bnRheDogc3RhdGUuc3ludGF4LAogICAgICAgICAgICB0b2tlbiwKICAgICAgICAgICAgcHJldjogbWF0Y2hTdGFjawogICAgICAgIH07CgogICAgICAgIG1vdmVUb05leHRUb2tlbigpOwogICAgICAgIHN5bnRheFN0YXNoID0gbnVsbDsKCiAgICAgICAgaWYgKHRva2VuSW5kZXggPiBsb25nZXN0TWF0Y2gpIHsKICAgICAgICAgICAgbG9uZ2VzdE1hdGNoID0gdG9rZW5JbmRleDsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gb3BlblN5bnRheCgpIHsKICAgICAgICBzeW50YXhTdGFjayA9IHsKICAgICAgICAgICAgc3ludGF4OiBzdGF0ZS5zeW50YXgsCiAgICAgICAgICAgIG9wdHM6IHN0YXRlLnN5bnRheC5vcHRzIHx8IChzeW50YXhTdGFjayAhPT0gbnVsbCAmJiBzeW50YXhTdGFjay5vcHRzKSB8fCBudWxsLAogICAgICAgICAgICBwcmV2OiBzeW50YXhTdGFjawogICAgICAgIH07CgogICAgICAgIG1hdGNoU3RhY2sgPSB7CiAgICAgICAgICAgIHR5cGU6IE9QRU5fU1lOVEFYLAogICAgICAgICAgICBzeW50YXg6IHN0YXRlLnN5bnRheCwKICAgICAgICAgICAgdG9rZW46IG1hdGNoU3RhY2sudG9rZW4sCiAgICAgICAgICAgIHByZXY6IG1hdGNoU3RhY2sKICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIGNsb3NlU3ludGF4KCkgewogICAgICAgIGlmIChtYXRjaFN0YWNrLnR5cGUgPT09IE9QRU5fU1lOVEFYKSB7CiAgICAgICAgICAgIG1hdGNoU3RhY2sgPSBtYXRjaFN0YWNrLnByZXY7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbWF0Y2hTdGFjayA9IHsKICAgICAgICAgICAgICAgIHR5cGU6IENMT1NFX1NZTlRBWCwKICAgICAgICAgICAgICAgIHN5bnRheDogc3ludGF4U3RhY2suc3ludGF4LAogICAgICAgICAgICAgICAgdG9rZW46IG1hdGNoU3RhY2sudG9rZW4sCiAgICAgICAgICAgICAgICBwcmV2OiBtYXRjaFN0YWNrCiAgICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICBzeW50YXhTdGFjayA9IHN5bnRheFN0YWNrLnByZXY7CiAgICB9CgogICAgbGV0IHN5bnRheFN0YWNrID0gbnVsbDsKICAgIGxldCB0aGVuU3RhY2sgPSBudWxsOwogICAgbGV0IGVsc2VTdGFjayA9IG51bGw7CgogICAgLy8gbnVsbCDigJMgc3Rhc2hpbmcgYWxsb3dlZCwgbm90aGluZyBzdGFzaGVkCiAgICAvLyBmYWxzZSDigJMgc3Rhc2hpbmcgZGlzYWJsZWQsIG5vdGhpbmcgc3Rhc2hlZAogICAgLy8gYW5pdGhpbmcgZWxzZSDigJMgZmFpbCBzdGFzaGFibGUgc3ludGF4ZXMsIHNvbWUgc3ludGF4IHN0YXNoZWQKICAgIGxldCBzeW50YXhTdGFzaCA9IG51bGw7CgogICAgbGV0IGl0ZXJhdGlvbkNvdW50ID0gMDsgLy8gY291bnQgaXRlcmF0aW9ucyBhbmQgcHJldmVudCBpbmZpbml0ZSBsb29wCiAgICBsZXQgZXhpdFJlYXNvbiA9IG51bGw7CgogICAgbGV0IHRva2VuID0gbnVsbDsKICAgIGxldCB0b2tlbkluZGV4ID0gLTE7CiAgICBsZXQgbG9uZ2VzdE1hdGNoID0gMDsKICAgIGxldCBtYXRjaFN0YWNrID0gewogICAgICAgIHR5cGU6IFNUVUIsCiAgICAgICAgc3ludGF4OiBudWxsLAogICAgICAgIHRva2VuOiBudWxsLAogICAgICAgIHByZXY6IG51bGwKICAgIH07CgogICAgbW92ZVRvTmV4dFRva2VuKCk7CgogICAgd2hpbGUgKGV4aXRSZWFzb24gPT09IG51bGwgJiYgKytpdGVyYXRpb25Db3VudCA8IElURVJBVElPTl9MSU1JVCkgewogICAgICAgIC8vIGZ1bmN0aW9uIG1hcExpc3QobGlzdCwgZm4pIHsKICAgICAgICAvLyAgICAgY29uc3QgcmVzdWx0ID0gW107CiAgICAgICAgLy8gICAgIHdoaWxlIChsaXN0KSB7CiAgICAgICAgLy8gICAgICAgICByZXN1bHQudW5zaGlmdChmbihsaXN0KSk7CiAgICAgICAgLy8gICAgICAgICBsaXN0ID0gbGlzdC5wcmV2OwogICAgICAgIC8vICAgICB9CiAgICAgICAgLy8gICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgLy8gfQogICAgICAgIC8vIGNvbnNvbGUubG9nKCctLVxuJywKICAgICAgICAvLyAgICAgJyMnICsgaXRlcmF0aW9uQ291bnQsCiAgICAgICAgLy8gICAgIHJlcXVpcmUoJ3V0aWwnKS5pbnNwZWN0KHsKICAgICAgICAvLyAgICAgICAgIG1hdGNoOiBtYXBMaXN0KG1hdGNoU3RhY2ssIHggPT4geC50eXBlID09PSBUT0tFTiA/IHgudG9rZW4gJiYgeC50b2tlbi52YWx1ZSA6IHguc3ludGF4ID8gKHsgW09QRU5fU1lOVEFYXTogJzwnLCBbQ0xPU0VfU1lOVEFYXTogJzwvJyB9W3gudHlwZV0gfHwgeC50eXBlKSArICchJyArIHguc3ludGF4Lm5hbWUgOiBudWxsKSwKICAgICAgICAvLyAgICAgICAgIHRva2VuOiB0b2tlbiAmJiB0b2tlbi52YWx1ZSwKICAgICAgICAvLyAgICAgICAgIHRva2VuSW5kZXgsCiAgICAgICAgLy8gICAgICAgICBzeW50YXg6IHN5bnRheC50eXBlICsgKHN5bnRheC5pZCA/ICcgIycgKyBzeW50YXguaWQgOiAnJykKICAgICAgICAvLyAgICAgfSwgeyBkZXB0aDogbnVsbCB9KQogICAgICAgIC8vICk7CiAgICAgICAgc3dpdGNoIChzdGF0ZS50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgJ01hdGNoJzoKICAgICAgICAgICAgICAgIGlmICh0aGVuU3RhY2sgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAvLyB0dXJuIHRvIE1JU01BVENIIHdoZW4gc29tZSB0b2tlbnMgbGVmdCB1bm1hdGNoZWQKICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW4gIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZG9lc24ndCBtaXNtYXRjaCBpZiBqdXN0IG9uZSB0b2tlbiBsZWZ0IGFuZCBpdCdzIGFuIElFIGhhY2sKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRva2VuSW5kZXggIT09IHRva2Vucy5sZW5ndGggLSAxIHx8ICh0b2tlbi52YWx1ZSAhPT0gJ1xcMCcgJiYgdG9rZW4udmFsdWUgIT09ICdcXDknKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBNSVNNQVRDSDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBicmVhayB0aGUgbWFpbiBsb29wLCByZXR1cm4gYSByZXN1bHQgLSBNQVRDSAogICAgICAgICAgICAgICAgICAgIGV4aXRSZWFzb24gPSBFWElUX1JFQVNPTl9NQVRDSDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBnbyB0byBuZXh0IHN5bnRheCAoYHRoZW5gIGJyYW5jaCkKICAgICAgICAgICAgICAgIHN0YXRlID0gdGhlblN0YWNrLm5leHRTdGF0ZTsKCiAgICAgICAgICAgICAgICAvLyBjaGVjayBtYXRjaCBpcyBub3QgZW1wdHkKICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gRElTQUxMT1dfRU1QVFkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhlblN0YWNrLm1hdGNoU3RhY2sgPT09IG1hdGNoU3RhY2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBNSVNNQVRDSDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBNQVRDSDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gY2xvc2Ugc3ludGF4IGlmIG5lZWRlZAogICAgICAgICAgICAgICAgd2hpbGUgKHRoZW5TdGFjay5zeW50YXhTdGFjayAhPT0gc3ludGF4U3RhY2spIHsKICAgICAgICAgICAgICAgICAgICBjbG9zZVN5bnRheCgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIHBvcCBzdGFjawogICAgICAgICAgICAgICAgdGhlblN0YWNrID0gdGhlblN0YWNrLnByZXY7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ01pc21hdGNoJzoKICAgICAgICAgICAgICAgIC8vIHdoZW4gc29tZSBzeW50YXggaXMgc3Rhc2hlZAogICAgICAgICAgICAgICAgaWYgKHN5bnRheFN0YXNoICE9PSBudWxsICYmIHN5bnRheFN0YXNoICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgIC8vIHRoZXJlIGlzIG5vIGVsc2UgYnJhbmNoZXMgb3IgYSBicmFuY2ggcmVkdWNlIG1hdGNoIHN0YWNrCiAgICAgICAgICAgICAgICAgICAgaWYgKGVsc2VTdGFjayA9PT0gbnVsbCB8fCB0b2tlbkluZGV4ID4gZWxzZVN0YWNrLnRva2VuSW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVzdG9yZSBzdGF0ZSBmcm9tIHRoZSBzdGFzaAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlU3RhY2sgPSBzeW50YXhTdGFzaDsKICAgICAgICAgICAgICAgICAgICAgICAgc3ludGF4U3Rhc2ggPSBmYWxzZTsgLy8gZGlzYWJsZSBzdGFzaGluZwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxzZVN0YWNrID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gbm8gZWxzZSBicmFuY2hlcyAtPiBicmVhayB0aGUgbWFpbiBsb29wCiAgICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuIGEgcmVzdWx0IC0gTUlTTUFUQ0gKICAgICAgICAgICAgICAgICAgICBleGl0UmVhc29uID0gRVhJVF9SRUFTT05fTUlTTUFUQ0g7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gZ28gdG8gbmV4dCBzeW50YXggKGBlbHNlYCBicmFuY2gpCiAgICAgICAgICAgICAgICBzdGF0ZSA9IGVsc2VTdGFjay5uZXh0U3RhdGU7CgogICAgICAgICAgICAgICAgLy8gcmVzdG9yZSBhbGwgdGhlIHJlc3Qgc3RhY2sgc3RhdGVzCiAgICAgICAgICAgICAgICB0aGVuU3RhY2sgPSBlbHNlU3RhY2sudGhlblN0YWNrOwogICAgICAgICAgICAgICAgc3ludGF4U3RhY2sgPSBlbHNlU3RhY2suc3ludGF4U3RhY2s7CiAgICAgICAgICAgICAgICBtYXRjaFN0YWNrID0gZWxzZVN0YWNrLm1hdGNoU3RhY2s7CiAgICAgICAgICAgICAgICB0b2tlbkluZGV4ID0gZWxzZVN0YWNrLnRva2VuSW5kZXg7CiAgICAgICAgICAgICAgICB0b2tlbiA9IHRva2VuSW5kZXggPCB0b2tlbnMubGVuZ3RoID8gdG9rZW5zW3Rva2VuSW5kZXhdIDogbnVsbDsKCiAgICAgICAgICAgICAgICAvLyBwb3Agc3RhY2sKICAgICAgICAgICAgICAgIGVsc2VTdGFjayA9IGVsc2VTdGFjay5wcmV2OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICdNYXRjaEdyYXBoJzoKICAgICAgICAgICAgICAgIHN0YXRlID0gc3RhdGUubWF0Y2g7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ0lmJzoKICAgICAgICAgICAgICAgIC8vIElNUE9SVEFOVDogZWxzZSBzdGFjayBwdXNoIG11c3QgZ28gZmlyc3QsCiAgICAgICAgICAgICAgICAvLyBzaW5jZSBpdCBzdG9yZXMgdGhlIHN0YXRlIG9mIHRoZW5TdGFjayBiZWZvcmUgY2hhbmdlcwogICAgICAgICAgICAgICAgaWYgKHN0YXRlLmVsc2UgIT09IE1JU01BVENIKSB7CiAgICAgICAgICAgICAgICAgICAgcHVzaEVsc2VTdGFjayhzdGF0ZS5lbHNlKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoc3RhdGUudGhlbiAhPT0gTUFUQ0gpIHsKICAgICAgICAgICAgICAgICAgICBwdXNoVGhlblN0YWNrKHN0YXRlLnRoZW4pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHN0YXRlID0gc3RhdGUubWF0Y2g7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ01hdGNoT25jZSc6CiAgICAgICAgICAgICAgICBzdGF0ZSA9IHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnTWF0Y2hPbmNlQnVmZmVyJywKICAgICAgICAgICAgICAgICAgICBzeW50YXg6IHN0YXRlLAogICAgICAgICAgICAgICAgICAgIGluZGV4OiAwLAogICAgICAgICAgICAgICAgICAgIG1hc2s6IDAKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ01hdGNoT25jZUJ1ZmZlcic6IHsKICAgICAgICAgICAgICAgIGNvbnN0IHRlcm1zID0gc3RhdGUuc3ludGF4LnRlcm1zOwoKICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5pbmRleCA9PT0gdGVybXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gbm8gbWF0Y2hlcyBhdCBhbGwgb3IgaXQncyByZXF1aXJlZCBhbGwgdGVybXMgdG8gYmUgbWF0Y2hlZAogICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5tYXNrID09PSAwIHx8IHN0YXRlLnN5bnRheC5hbGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBNSVNNQVRDSDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBhIHBhcnRpYWwgbWF0Y2ggaXMgb2sKICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IE1BVENIOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGFsbCB0ZXJtcyBhcmUgbWF0Y2hlZAogICAgICAgICAgICAgICAgaWYgKHN0YXRlLm1hc2sgPT09ICgxIDw8IHRlcm1zLmxlbmd0aCkgLSAxKSB7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBNQVRDSDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmb3IgKDsgc3RhdGUuaW5kZXggPCB0ZXJtcy5sZW5ndGg7IHN0YXRlLmluZGV4KyspIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXRjaEZsYWcgPSAxIDw8IHN0YXRlLmluZGV4OwoKICAgICAgICAgICAgICAgICAgICBpZiAoKHN0YXRlLm1hc2sgJiBtYXRjaEZsYWcpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElNUE9SVEFOVDogZWxzZSBzdGFjayBwdXNoIG11c3QgZ28gZmlyc3QsCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNpbmNlIGl0IHN0b3JlcyB0aGUgc3RhdGUgb2YgdGhlblN0YWNrIGJlZm9yZSBjaGFuZ2VzCiAgICAgICAgICAgICAgICAgICAgICAgIHB1c2hFbHNlU3RhY2soc3RhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICBwdXNoVGhlblN0YWNrKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdBZGRNYXRjaE9uY2UnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ludGF4OiBzdGF0ZS5zeW50YXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXNrOiBzdGF0ZS5tYXNrIHwgbWF0Y2hGbGFnCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWF0Y2gKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSB0ZXJtc1tzdGF0ZS5pbmRleCsrXTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNhc2UgJ0FkZE1hdGNoT25jZSc6CiAgICAgICAgICAgICAgICBzdGF0ZSA9IHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnTWF0Y2hPbmNlQnVmZmVyJywKICAgICAgICAgICAgICAgICAgICBzeW50YXg6IHN0YXRlLnN5bnRheCwKICAgICAgICAgICAgICAgICAgICBpbmRleDogMCwKICAgICAgICAgICAgICAgICAgICBtYXNrOiBzdGF0ZS5tYXNrCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICdFbnVtJzoKICAgICAgICAgICAgICAgIGlmICh0b2tlbiAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGxldCBuYW1lID0gdG9rZW4udmFsdWUudG9Mb3dlckNhc2UoKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gZHJvcCBcMCBhbmQgXDkgaGFjayBmcm9tIGtleXdvcmQgbmFtZQogICAgICAgICAgICAgICAgICAgIGlmIChuYW1lLmluZGV4T2YoJ1xcJykgIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1xcWzA5XS4qJC8sICcnKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eSQyLmNhbGwoc3RhdGUubWFwLCBuYW1lKSkgewogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IHN0YXRlLm1hcFtuYW1lXTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHN0YXRlID0gTUlTTUFUQ0g7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ0dlbmVyaWMnOiB7CiAgICAgICAgICAgICAgICBjb25zdCBvcHRzID0gc3ludGF4U3RhY2sgIT09IG51bGwgPyBzeW50YXhTdGFjay5vcHRzIDogbnVsbDsKICAgICAgICAgICAgICAgIGNvbnN0IGxhc3RUb2tlbkluZGV4ID0gdG9rZW5JbmRleCArIE1hdGguZmxvb3Ioc3RhdGUuZm4odG9rZW4sIGdldE5leHRUb2tlbiwgb3B0cykpOwoKICAgICAgICAgICAgICAgIGlmICghaXNOYU4obGFzdFRva2VuSW5kZXgpICYmIGxhc3RUb2tlbkluZGV4ID4gdG9rZW5JbmRleCkgewogICAgICAgICAgICAgICAgICAgIHdoaWxlICh0b2tlbkluZGV4IDwgbGFzdFRva2VuSW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkVG9rZW5Ub01hdGNoKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IE1BVENIOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IE1JU01BVENIOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjYXNlICdUeXBlJzoKICAgICAgICAgICAgY2FzZSAnUHJvcGVydHknOiB7CiAgICAgICAgICAgICAgICBjb25zdCBzeW50YXhEaWN0ID0gc3RhdGUudHlwZSA9PT0gJ1R5cGUnID8gJ3R5cGVzJyA6ICdwcm9wZXJ0aWVzJzsKICAgICAgICAgICAgICAgIGNvbnN0IGRpY3RTeW50YXggPSBoYXNPd25Qcm9wZXJ0eSQyLmNhbGwoc3ludGF4ZXMsIHN5bnRheERpY3QpID8gc3ludGF4ZXNbc3ludGF4RGljdF1bc3RhdGUubmFtZV0gOiBudWxsOwoKICAgICAgICAgICAgICAgIGlmICghZGljdFN5bnRheCB8fCAhZGljdFN5bnRheC5tYXRjaCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAgICAgICAgICAgICAgICAgJ0JhZCBzeW50YXggcmVmZXJlbmNlOiAnICsKICAgICAgICAgICAgICAgICAgICAgICAgKHN0YXRlLnR5cGUgPT09ICdUeXBlJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAnPCcgKyBzdGF0ZS5uYW1lICsgJz4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ICc8XCcnICsgc3RhdGUubmFtZSArICdcJz4nKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gc3Rhc2ggYSBzeW50YXggZm9yIHR5cGVzIHdpdGggbG93IHByaW9yaXR5CiAgICAgICAgICAgICAgICBpZiAoc3ludGF4U3Rhc2ggIT09IGZhbHNlICYmIHRva2VuICE9PSBudWxsICYmIHN0YXRlLnR5cGUgPT09ICdUeXBlJykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvd1ByaW9yaXR5TWF0Y2hpbmcgPQogICAgICAgICAgICAgICAgICAgICAgICAvLyBodHRwczovL2RyYWZ0cy5jc3N3Zy5vcmcvY3NzLXZhbHVlcy00LyNjdXN0b20taWRlbnRzCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdoZW4gcGFyc2luZyBwb3NpdGlvbmFsbHktYW1iaWd1b3VzIGtleXdvcmRzIGluIGEgcHJvcGVydHkgdmFsdWUsIGEgPGN1c3RvbS1pZGVudD4gcHJvZHVjdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAvLyBjYW4gb25seSBjbGFpbSB0aGUga2V5d29yZCBpZiBubyBvdGhlciB1bmZ1bGZpbGxlZCBwcm9kdWN0aW9uIGNhbiBjbGFpbSBpdC4KICAgICAgICAgICAgICAgICAgICAgICAgKHN0YXRlLm5hbWUgPT09ICdjdXN0b20taWRlbnQnICYmIHRva2VuLnR5cGUgPT09IElkZW50KSB8fAoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaHR0cHM6Ly9kcmFmdHMuY3Nzd2cub3JnL2Nzcy12YWx1ZXMtNC8jbGVuZ3RocwogICAgICAgICAgICAgICAgICAgICAgICAvLyAuLi4gaWYgYSBgMGAgY291bGQgYmUgcGFyc2VkIGFzIGVpdGhlciBhIDxudW1iZXI+IG9yIGEgPGxlbmd0aD4gaW4gYSBwcm9wZXJ0eSAoc3VjaCBhcyBsaW5lLWhlaWdodCksCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGl0IG11c3QgcGFyc2UgYXMgYSA8bnVtYmVyPgogICAgICAgICAgICAgICAgICAgICAgICAoc3RhdGUubmFtZSA9PT0gJ2xlbmd0aCcgJiYgdG9rZW4udmFsdWUgPT09ICcwJyk7CgogICAgICAgICAgICAgICAgICAgIGlmIChsb3dQcmlvcml0eU1hdGNoaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzeW50YXhTdGFzaCA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ludGF4U3Rhc2ggPSBzdGF0ZVNuYXBzaG90RnJvbVN5bnRheChzdGF0ZSwgZWxzZVN0YWNrKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBNSVNNQVRDSDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG9wZW5TeW50YXgoKTsKICAgICAgICAgICAgICAgIHN0YXRlID0gZGljdFN5bnRheC5tYXRjaDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjYXNlICdLZXl3b3JkJzogewogICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IHN0YXRlLm5hbWU7CgogICAgICAgICAgICAgICAgaWYgKHRva2VuICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGtleXdvcmROYW1lID0gdG9rZW4udmFsdWU7CgogICAgICAgICAgICAgICAgICAgIC8vIGRyb3AgXDAgYW5kIFw5IGhhY2sgZnJvbSBrZXl3b3JkIG5hbWUKICAgICAgICAgICAgICAgICAgICBpZiAoa2V5d29yZE5hbWUuaW5kZXhPZignXFwnKSAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAga2V5d29yZE5hbWUgPSBrZXl3b3JkTmFtZS5yZXBsYWNlKC9cXFswOV0uKiQvLCAnJyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoYXJlU3RyaW5nc0VxdWFsQ2FzZUluc2Vuc2l0aXZlKGtleXdvcmROYW1lLCBuYW1lKSkgewogICAgICAgICAgICAgICAgICAgICAgICBhZGRUb2tlblRvTWF0Y2goKTsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBNQVRDSDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHN0YXRlID0gTUlTTUFUQ0g7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2FzZSAnQXRLZXl3b3JkJzoKICAgICAgICAgICAgY2FzZSAnRnVuY3Rpb24nOgogICAgICAgICAgICAgICAgaWYgKHRva2VuICE9PSBudWxsICYmIGFyZVN0cmluZ3NFcXVhbENhc2VJbnNlbnNpdGl2ZSh0b2tlbi52YWx1ZSwgc3RhdGUubmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICBhZGRUb2tlblRvTWF0Y2goKTsKICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IE1BVENIOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHN0YXRlID0gTUlTTUFUQ0g7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ1Rva2VuJzoKICAgICAgICAgICAgICAgIGlmICh0b2tlbiAhPT0gbnVsbCAmJiB0b2tlbi52YWx1ZSA9PT0gc3RhdGUudmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBhZGRUb2tlblRvTWF0Y2goKTsKICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IE1BVENIOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHN0YXRlID0gTUlTTUFUQ0g7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ0NvbW1hJzoKICAgICAgICAgICAgICAgIGlmICh0b2tlbiAhPT0gbnVsbCAmJiB0b2tlbi50eXBlID09PSBDb21tYSkgewogICAgICAgICAgICAgICAgICAgIGlmIChpc0NvbW1hQ29udGV4dFN0YXJ0KG1hdGNoU3RhY2sudG9rZW4pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlID0gTUlTTUFUQ0g7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkVG9rZW5Ub01hdGNoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlID0gaXNDb21tYUNvbnRleHRFbmQodG9rZW4pID8gTUlTTUFUQ0ggOiBNQVRDSDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHN0YXRlID0gaXNDb21tYUNvbnRleHRTdGFydChtYXRjaFN0YWNrLnRva2VuKSB8fCBpc0NvbW1hQ29udGV4dEVuZCh0b2tlbikgPyBNQVRDSCA6IE1JU01BVENIOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAnU3RyaW5nJzoKICAgICAgICAgICAgICAgIGxldCBzdHJpbmcgPSAnJzsKICAgICAgICAgICAgICAgIGxldCBsYXN0VG9rZW5JbmRleCA9IHRva2VuSW5kZXg7CgogICAgICAgICAgICAgICAgZm9yICg7IGxhc3RUb2tlbkluZGV4IDwgdG9rZW5zLmxlbmd0aCAmJiBzdHJpbmcubGVuZ3RoIDwgc3RhdGUudmFsdWUubGVuZ3RoOyBsYXN0VG9rZW5JbmRleCsrKSB7CiAgICAgICAgICAgICAgICAgICAgc3RyaW5nICs9IHRva2Vuc1tsYXN0VG9rZW5JbmRleF0udmFsdWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGFyZVN0cmluZ3NFcXVhbENhc2VJbnNlbnNpdGl2ZShzdHJpbmcsIHN0YXRlLnZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIHdoaWxlICh0b2tlbkluZGV4IDwgbGFzdFRva2VuSW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkVG9rZW5Ub01hdGNoKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IE1BVENIOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IE1JU01BVENIOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5rbm93biBub2RlIHR5cGU6ICcgKyBzdGF0ZS50eXBlKTsKICAgICAgICB9CiAgICB9CgogICAgc3dpdGNoIChleGl0UmVhc29uKSB7CiAgICAgICAgY2FzZSBudWxsOgogICAgICAgICAgICBjb25zb2xlLndhcm4oJ1tjc3N0cmVlLW1hdGNoXSBCUkVBSyBhZnRlciAnICsgSVRFUkFUSU9OX0xJTUlUICsgJyBpdGVyYXRpb25zJyk7CiAgICAgICAgICAgIGV4aXRSZWFzb24gPSBFWElUX1JFQVNPTl9JVEVSQVRJT05fTElNSVQ7CiAgICAgICAgICAgIG1hdGNoU3RhY2sgPSBudWxsOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBFWElUX1JFQVNPTl9NQVRDSDoKICAgICAgICAgICAgd2hpbGUgKHN5bnRheFN0YWNrICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBjbG9zZVN5bnRheCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBtYXRjaFN0YWNrID0gbnVsbDsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHRva2VucywKICAgICAgICByZWFzb246IGV4aXRSZWFzb24sCiAgICAgICAgaXRlcmF0aW9uczogaXRlcmF0aW9uQ291bnQsCiAgICAgICAgbWF0Y2g6IG1hdGNoU3RhY2ssCiAgICAgICAgbG9uZ2VzdE1hdGNoCiAgICB9Owp9CgpmdW5jdGlvbiBtYXRjaEFzVHJlZSh0b2tlbnMsIG1hdGNoR3JhcGgsIHN5bnRheGVzKSB7CiAgICBjb25zdCBtYXRjaFJlc3VsdCA9IGludGVybmFsTWF0Y2godG9rZW5zLCBtYXRjaEdyYXBoLCBzeW50YXhlcyB8fCB7fSk7CgogICAgaWYgKG1hdGNoUmVzdWx0Lm1hdGNoID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIG1hdGNoUmVzdWx0OwogICAgfQoKICAgIGxldCBpdGVtID0gbWF0Y2hSZXN1bHQubWF0Y2g7CiAgICBsZXQgaG9zdCA9IG1hdGNoUmVzdWx0Lm1hdGNoID0gewogICAgICAgIHN5bnRheDogbWF0Y2hHcmFwaC5zeW50YXggfHwgbnVsbCwKICAgICAgICBtYXRjaDogW10KICAgIH07CiAgICBjb25zdCBob3N0U3RhY2sgPSBbaG9zdF07CgogICAgLy8gcmV2ZXJ0IGEgbGlzdCBhbmQgc3RhcnQgd2l0aCAybmQgaXRlbSBzaW5jZSAxc3QgaXMgYSBzdHViIGl0ZW0KICAgIGl0ZW0gPSByZXZlcnNlTGlzdChpdGVtKS5wcmV2OwoKICAgIC8vIGJ1aWxkIGEgdHJlZQogICAgd2hpbGUgKGl0ZW0gIT09IG51bGwpIHsKICAgICAgICBzd2l0Y2ggKGl0ZW0udHlwZSkgewogICAgICAgICAgICBjYXNlIE9QRU5fU1lOVEFYOgogICAgICAgICAgICAgICAgaG9zdC5tYXRjaC5wdXNoKGhvc3QgPSB7CiAgICAgICAgICAgICAgICAgICAgc3ludGF4OiBpdGVtLnN5bnRheCwKICAgICAgICAgICAgICAgICAgICBtYXRjaDogW10KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgaG9zdFN0YWNrLnB1c2goaG9zdCk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgQ0xPU0VfU1lOVEFYOgogICAgICAgICAgICAgICAgaG9zdFN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgaG9zdCA9IGhvc3RTdGFja1tob3N0U3RhY2subGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBob3N0Lm1hdGNoLnB1c2goewogICAgICAgICAgICAgICAgICAgIHN5bnRheDogaXRlbS5zeW50YXggfHwgbnVsbCwKICAgICAgICAgICAgICAgICAgICB0b2tlbjogaXRlbS50b2tlbi52YWx1ZSwKICAgICAgICAgICAgICAgICAgICBub2RlOiBpdGVtLnRva2VuLm5vZGUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaXRlbSA9IGl0ZW0ucHJldjsKICAgIH0KCiAgICByZXR1cm4gbWF0Y2hSZXN1bHQ7Cn0KCmZ1bmN0aW9uIGdldFRyYWNlKG5vZGUpIHsKICAgIGZ1bmN0aW9uIHNob3VsZFB1dFRvVHJhY2Uoc3ludGF4KSB7CiAgICAgICAgaWYgKHN5bnRheCA9PT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBzeW50YXgudHlwZSA9PT0gJ1R5cGUnIHx8CiAgICAgICAgICAgIHN5bnRheC50eXBlID09PSAnUHJvcGVydHknIHx8CiAgICAgICAgICAgIHN5bnRheC50eXBlID09PSAnS2V5d29yZCcKICAgICAgICApOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhc01hdGNoKG1hdGNoTm9kZSkgewogICAgICAgIGlmIChBcnJheS5pc0FycmF5KG1hdGNoTm9kZS5tYXRjaCkpIHsKICAgICAgICAgICAgLy8gdXNlIGZvci1sb29wIGZvciBiZXR0ZXIgcGVyZm9tYW5jZQogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1hdGNoTm9kZS5tYXRjaC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGhhc01hdGNoKG1hdGNoTm9kZS5tYXRjaFtpXSkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoc2hvdWxkUHV0VG9UcmFjZShtYXRjaE5vZGUuc3ludGF4KSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQudW5zaGlmdChtYXRjaE5vZGUuc3ludGF4KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChtYXRjaE5vZGUubm9kZSA9PT0gbm9kZSkgewogICAgICAgICAgICByZXN1bHQgPSBzaG91bGRQdXRUb1RyYWNlKG1hdGNoTm9kZS5zeW50YXgpCiAgICAgICAgICAgICAgICA/IFttYXRjaE5vZGUuc3ludGF4XQogICAgICAgICAgICAgICAgOiBbXTsKCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGxldCByZXN1bHQgPSBudWxsOwoKICAgIGlmICh0aGlzLm1hdGNoZWQgIT09IG51bGwpIHsKICAgICAgICBoYXNNYXRjaCh0aGlzLm1hdGNoZWQpOwogICAgfQoKICAgIHJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIGlzVHlwZShub2RlLCB0eXBlKSB7CiAgICByZXR1cm4gdGVzdE5vZGUodGhpcywgbm9kZSwgbWF0Y2ggPT4gbWF0Y2gudHlwZSA9PT0gJ1R5cGUnICYmIG1hdGNoLm5hbWUgPT09IHR5cGUpOwp9CgpmdW5jdGlvbiBpc1Byb3BlcnR5KG5vZGUsIHByb3BlcnR5KSB7CiAgICByZXR1cm4gdGVzdE5vZGUodGhpcywgbm9kZSwgbWF0Y2ggPT4gbWF0Y2gudHlwZSA9PT0gJ1Byb3BlcnR5JyAmJiBtYXRjaC5uYW1lID09PSBwcm9wZXJ0eSk7Cn0KCmZ1bmN0aW9uIGlzS2V5d29yZChub2RlKSB7CiAgICByZXR1cm4gdGVzdE5vZGUodGhpcywgbm9kZSwgbWF0Y2ggPT4gbWF0Y2gudHlwZSA9PT0gJ0tleXdvcmQnKTsKfQoKZnVuY3Rpb24gdGVzdE5vZGUobWF0Y2gsIG5vZGUsIGZuKSB7CiAgICBjb25zdCB0cmFjZSA9IGdldFRyYWNlLmNhbGwobWF0Y2gsIG5vZGUpOwoKICAgIGlmICh0cmFjZSA9PT0gbnVsbCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gdHJhY2Uuc29tZShmbik7Cn0KCmNvbnN0IHRyYWNlID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoLyojX19QVVJFX18qL09iamVjdC5kZWZpbmVQcm9wZXJ0eSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBnZXRUcmFjZSwKICAgIGlzS2V5d29yZCwKICAgIGlzUHJvcGVydHksCiAgICBpc1R5cGUKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7CgpmdW5jdGlvbiBnZXRGaXJzdE1hdGNoTm9kZShtYXRjaE5vZGUpIHsKICAgIGlmICgnbm9kZScgaW4gbWF0Y2hOb2RlKSB7CiAgICAgICAgcmV0dXJuIG1hdGNoTm9kZS5ub2RlOwogICAgfQoKICAgIHJldHVybiBnZXRGaXJzdE1hdGNoTm9kZShtYXRjaE5vZGUubWF0Y2hbMF0pOwp9CgpmdW5jdGlvbiBnZXRMYXN0TWF0Y2hOb2RlKG1hdGNoTm9kZSkgewogICAgaWYgKCdub2RlJyBpbiBtYXRjaE5vZGUpIHsKICAgICAgICByZXR1cm4gbWF0Y2hOb2RlLm5vZGU7CiAgICB9CgogICAgcmV0dXJuIGdldExhc3RNYXRjaE5vZGUobWF0Y2hOb2RlLm1hdGNoW21hdGNoTm9kZS5tYXRjaC5sZW5ndGggLSAxXSk7Cn0KCmZ1bmN0aW9uIG1hdGNoRnJhZ21lbnRzKGxleGVyLCBhc3QsIG1hdGNoLCB0eXBlLCBuYW1lKSB7CiAgICBmdW5jdGlvbiBmaW5kRnJhZ21lbnRzKG1hdGNoTm9kZSkgewogICAgICAgIGlmIChtYXRjaE5vZGUuc3ludGF4ICE9PSBudWxsICYmCiAgICAgICAgICAgIG1hdGNoTm9kZS5zeW50YXgudHlwZSA9PT0gdHlwZSAmJgogICAgICAgICAgICBtYXRjaE5vZGUuc3ludGF4Lm5hbWUgPT09IG5hbWUpIHsKICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSBnZXRGaXJzdE1hdGNoTm9kZShtYXRjaE5vZGUpOwogICAgICAgICAgICBjb25zdCBlbmQgPSBnZXRMYXN0TWF0Y2hOb2RlKG1hdGNoTm9kZSk7CgogICAgICAgICAgICBsZXhlci5zeW50YXgud2Fsayhhc3QsIGZ1bmN0aW9uKG5vZGUsIGl0ZW0sIGxpc3QpIHsKICAgICAgICAgICAgICAgIGlmIChub2RlID09PSBzdGFydCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vZGVzID0gbmV3IExpc3QoKTsKCiAgICAgICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICAgICAgICBub2Rlcy5hcHBlbmREYXRhKGl0ZW0uZGF0YSk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5kYXRhID09PSBlbmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpdGVtID0gaXRlbS5uZXh0OwogICAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKGl0ZW0gIT09IG51bGwpOwoKICAgICAgICAgICAgICAgICAgICBmcmFnbWVudHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudDogbGlzdCwKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZXMKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShtYXRjaE5vZGUubWF0Y2gpKSB7CiAgICAgICAgICAgIG1hdGNoTm9kZS5tYXRjaC5mb3JFYWNoKGZpbmRGcmFnbWVudHMpOwogICAgICAgIH0KICAgIH0KCiAgICBjb25zdCBmcmFnbWVudHMgPSBbXTsKCiAgICBpZiAobWF0Y2gubWF0Y2hlZCAhPT0gbnVsbCkgewogICAgICAgIGZpbmRGcmFnbWVudHMobWF0Y2gubWF0Y2hlZCk7CiAgICB9CgogICAgcmV0dXJuIGZyYWdtZW50czsKfQoKY29uc3QgeyBoYXNPd25Qcm9wZXJ0eTogaGFzT3duUHJvcGVydHkkMSB9ID0gT2JqZWN0LnByb3RvdHlwZTsKCmZ1bmN0aW9uIGlzVmFsaWROdW1iZXIodmFsdWUpIHsKICAgIC8vIE51bWJlci5pc0ludGVnZXIodmFsdWUpICYmIHZhbHVlID49IDAKICAgIHJldHVybiAoCiAgICAgICAgdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyAmJgogICAgICAgIGlzRmluaXRlKHZhbHVlKSAmJgogICAgICAgIE1hdGguZmxvb3IodmFsdWUpID09PSB2YWx1ZSAmJgogICAgICAgIHZhbHVlID49IDAKICAgICk7Cn0KCmZ1bmN0aW9uIGlzVmFsaWRMb2NhdGlvbihsb2MpIHsKICAgIHJldHVybiAoCiAgICAgICAgQm9vbGVhbihsb2MpICYmCiAgICAgICAgaXNWYWxpZE51bWJlcihsb2Mub2Zmc2V0KSAmJgogICAgICAgIGlzVmFsaWROdW1iZXIobG9jLmxpbmUpICYmCiAgICAgICAgaXNWYWxpZE51bWJlcihsb2MuY29sdW1uKQogICAgKTsKfQoKZnVuY3Rpb24gY3JlYXRlTm9kZVN0cnVjdHVyZUNoZWNrZXIodHlwZSwgZmllbGRzKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gY2hlY2tOb2RlKG5vZGUsIHdhcm4pIHsKICAgICAgICBpZiAoIW5vZGUgfHwgbm9kZS5jb25zdHJ1Y3RvciAhPT0gT2JqZWN0KSB7CiAgICAgICAgICAgIHJldHVybiB3YXJuKG5vZGUsICdUeXBlIG9mIG5vZGUgc2hvdWxkIGJlIGFuIE9iamVjdCcpOwogICAgICAgIH0KCiAgICAgICAgZm9yIChsZXQga2V5IGluIG5vZGUpIHsKICAgICAgICAgICAgbGV0IHZhbGlkID0gdHJ1ZTsKCiAgICAgICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eSQxLmNhbGwobm9kZSwga2V5KSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoa2V5ID09PSAndHlwZScpIHsKICAgICAgICAgICAgICAgIGlmIChub2RlLnR5cGUgIT09IHR5cGUpIHsKICAgICAgICAgICAgICAgICAgICB3YXJuKG5vZGUsICdXcm9uZyBub2RlIHR5cGUgYCcgKyBub2RlLnR5cGUgKyAnYCwgZXhwZWN0ZWQgYCcgKyB0eXBlICsgJ2AnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICdsb2MnKSB7CiAgICAgICAgICAgICAgICBpZiAobm9kZS5sb2MgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobm9kZS5sb2MgJiYgbm9kZS5sb2MuY29uc3RydWN0b3IgPT09IE9iamVjdCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygbm9kZS5sb2Muc291cmNlICE9PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICAgICAgICBrZXkgKz0gJy5zb3VyY2UnOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWlzVmFsaWRMb2NhdGlvbihub2RlLmxvYy5zdGFydCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAga2V5ICs9ICcuc3RhcnQnOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWlzVmFsaWRMb2NhdGlvbihub2RlLmxvYy5lbmQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGtleSArPSAnLmVuZCc7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhbGlkID0gZmFsc2U7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZmllbGRzLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICAgIHZhbGlkID0gZmFsc2U7CgogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7ICF2YWxpZCAmJiBpIDwgZmllbGRzW2tleV0ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWVsZFR5cGUgPSBmaWVsZHNba2V5XVtpXTsKCiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChmaWVsZFR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBTdHJpbmc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZCA9IHR5cGVvZiBub2RlW2tleV0gPT09ICdzdHJpbmcnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEJvb2xlYW46CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZCA9IHR5cGVvZiBub2RlW2tleV0gPT09ICdib29sZWFuJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBudWxsOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWQgPSBub2RlW2tleV0gPT09IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGZpZWxkVHlwZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZCA9IG5vZGVba2V5XSAmJiBub2RlW2tleV0udHlwZSA9PT0gZmllbGRUeXBlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGZpZWxkVHlwZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZCA9IG5vZGVba2V5XSBpbnN0YW5jZW9mIExpc3Q7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgd2Fybihub2RlLCAnVW5rbm93biBmaWVsZCBgJyArIGtleSArICdgIGZvciAnICsgdHlwZSArICcgbm9kZSB0eXBlJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghdmFsaWQpIHsKICAgICAgICAgICAgICAgIHdhcm4obm9kZSwgJ0JhZCB2YWx1ZSBmb3IgYCcgKyB0eXBlICsgJy4nICsga2V5ICsgJ2AnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gZmllbGRzKSB7CiAgICAgICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eSQxLmNhbGwoZmllbGRzLCBrZXkpICYmCiAgICAgICAgICAgICAgICBoYXNPd25Qcm9wZXJ0eSQxLmNhbGwobm9kZSwga2V5KSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIHdhcm4obm9kZSwgJ0ZpZWxkIGAnICsgdHlwZSArICcuJyArIGtleSArICdgIGlzIG1pc3NlZCcpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKfQoKZnVuY3Rpb24gcHJvY2Vzc1N0cnVjdHVyZShuYW1lLCBub2RlVHlwZSkgewogICAgY29uc3Qgc3RydWN0dXJlID0gbm9kZVR5cGUuc3RydWN0dXJlOwogICAgY29uc3QgZmllbGRzID0gewogICAgICAgIHR5cGU6IFN0cmluZywKICAgICAgICBsb2M6IHRydWUKICAgIH07CiAgICBjb25zdCBkb2NzID0gewogICAgICAgIHR5cGU6ICciJyArIG5hbWUgKyAnIicKICAgIH07CgogICAgZm9yIChjb25zdCBrZXkgaW4gc3RydWN0dXJlKSB7CiAgICAgICAgaWYgKGhhc093blByb3BlcnR5JDEuY2FsbChzdHJ1Y3R1cmUsIGtleSkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZG9jc1R5cGVzID0gW107CiAgICAgICAgY29uc3QgZmllbGRUeXBlcyA9IGZpZWxkc1trZXldID0gQXJyYXkuaXNBcnJheShzdHJ1Y3R1cmVba2V5XSkKICAgICAgICAgICAgPyBzdHJ1Y3R1cmVba2V5XS5zbGljZSgpCiAgICAgICAgICAgIDogW3N0cnVjdHVyZVtrZXldXTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmaWVsZFR5cGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IGZpZWxkVHlwZSA9IGZpZWxkVHlwZXNbaV07CiAgICAgICAgICAgIGlmIChmaWVsZFR5cGUgPT09IFN0cmluZyB8fCBmaWVsZFR5cGUgPT09IEJvb2xlYW4pIHsKICAgICAgICAgICAgICAgIGRvY3NUeXBlcy5wdXNoKGZpZWxkVHlwZS5uYW1lKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChmaWVsZFR5cGUgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGRvY3NUeXBlcy5wdXNoKCdudWxsJyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGZpZWxkVHlwZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgIGRvY3NUeXBlcy5wdXNoKCc8JyArIGZpZWxkVHlwZSArICc+Jyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShmaWVsZFR5cGUpKSB7CiAgICAgICAgICAgICAgICBkb2NzVHlwZXMucHVzaCgnTGlzdCcpOyAvLyBUT0RPOiB1c2UgdHlwZSBlbnVtCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1dyb25nIHZhbHVlIGAnICsgZmllbGRUeXBlICsgJ2AgaW4gYCcgKyBuYW1lICsgJy4nICsga2V5ICsgJ2Agc3RydWN0dXJlIGRlZmluaXRpb24nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZG9jc1trZXldID0gZG9jc1R5cGVzLmpvaW4oJyB8ICcpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgZG9jcywKICAgICAgICBjaGVjazogY3JlYXRlTm9kZVN0cnVjdHVyZUNoZWNrZXIobmFtZSwgZmllbGRzKQogICAgfTsKfQoKZnVuY3Rpb24gZ2V0U3RydWN0dXJlRnJvbUNvbmZpZyhjb25maWcpIHsKICAgIGNvbnN0IHN0cnVjdHVyZSA9IHt9OwoKICAgIGlmIChjb25maWcubm9kZSkgewogICAgICAgIGZvciAoY29uc3QgbmFtZSBpbiBjb25maWcubm9kZSkgewogICAgICAgICAgICBpZiAoaGFzT3duUHJvcGVydHkkMS5jYWxsKGNvbmZpZy5ub2RlLCBuYW1lKSkgewogICAgICAgICAgICAgICAgY29uc3Qgbm9kZVR5cGUgPSBjb25maWcubm9kZVtuYW1lXTsKCiAgICAgICAgICAgICAgICBpZiAobm9kZVR5cGUuc3RydWN0dXJlKSB7CiAgICAgICAgICAgICAgICAgICAgc3RydWN0dXJlW25hbWVdID0gcHJvY2Vzc1N0cnVjdHVyZShuYW1lLCBub2RlVHlwZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTWlzc2VkIGBzdHJ1Y3R1cmVgIGZpZWxkIGluIGAnICsgbmFtZSArICdgIG5vZGUgdHlwZSBkZWZpbml0aW9uJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIHN0cnVjdHVyZTsKfQoKY29uc3QgY3NzV2lkZUtleXdvcmRzU3ludGF4ID0gYnVpbGRNYXRjaEdyYXBoKGNzc1dpZGVLZXl3b3Jkcy5qb2luKCcgfCAnKSk7CgpmdW5jdGlvbiBkdW1wTWFwU3ludGF4KG1hcCwgY29tcGFjdCwgc3ludGF4QXNBc3QpIHsKICAgIGNvbnN0IHJlc3VsdCA9IHt9OwoKICAgIGZvciAoY29uc3QgbmFtZSBpbiBtYXApIHsKICAgICAgICBpZiAobWFwW25hbWVdLnN5bnRheCkgewogICAgICAgICAgICByZXN1bHRbbmFtZV0gPSBzeW50YXhBc0FzdAogICAgICAgICAgICAgICAgPyBtYXBbbmFtZV0uc3ludGF4CiAgICAgICAgICAgICAgICA6IGdlbmVyYXRlJEcobWFwW25hbWVdLnN5bnRheCwgeyBjb21wYWN0IH0pOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiBkdW1wQXRydWxlTWFwU3ludGF4KG1hcCwgY29tcGFjdCwgc3ludGF4QXNBc3QpIHsKICAgIGNvbnN0IHJlc3VsdCA9IHt9OwoKICAgIGZvciAoY29uc3QgW25hbWUsIGF0cnVsZV0gb2YgT2JqZWN0LmVudHJpZXMobWFwKSkgewogICAgICAgIHJlc3VsdFtuYW1lXSA9IHsKICAgICAgICAgICAgcHJlbHVkZTogYXRydWxlLnByZWx1ZGUgJiYgKAogICAgICAgICAgICAgICAgc3ludGF4QXNBc3QKICAgICAgICAgICAgICAgICAgICA/IGF0cnVsZS5wcmVsdWRlLnN5bnRheAogICAgICAgICAgICAgICAgICAgIDogZ2VuZXJhdGUkRyhhdHJ1bGUucHJlbHVkZS5zeW50YXgsIHsgY29tcGFjdCB9KQogICAgICAgICAgICApLAogICAgICAgICAgICBkZXNjcmlwdG9yczogYXRydWxlLmRlc2NyaXB0b3JzICYmIGR1bXBNYXBTeW50YXgoYXRydWxlLmRlc2NyaXB0b3JzLCBjb21wYWN0LCBzeW50YXhBc0FzdCkKICAgICAgICB9OwogICAgfQoKICAgIHJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIHZhbHVlSGFzVmFyKHRva2VucykgewogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b2tlbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodG9rZW5zW2ldLnZhbHVlLnRvTG93ZXJDYXNlKCkgPT09ICd2YXIoJykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwp9CgpmdW5jdGlvbiBidWlsZE1hdGNoUmVzdWx0KG1hdGNoZWQsIGVycm9yLCBpdGVyYXRpb25zKSB7CiAgICByZXR1cm4gewogICAgICAgIG1hdGNoZWQsCiAgICAgICAgaXRlcmF0aW9ucywKICAgICAgICBlcnJvciwKICAgICAgICAuLi50cmFjZQogICAgfTsKfQoKZnVuY3Rpb24gbWF0Y2hTeW50YXgobGV4ZXIsIHN5bnRheCwgdmFsdWUsIHVzZUNzc1dpZGVLZXl3b3JkcykgewogICAgY29uc3QgdG9rZW5zID0gcHJlcGFyZVRva2Vucyh2YWx1ZSwgbGV4ZXIuc3ludGF4KTsKICAgIGxldCByZXN1bHQ7CgogICAgaWYgKHZhbHVlSGFzVmFyKHRva2VucykpIHsKICAgICAgICByZXR1cm4gYnVpbGRNYXRjaFJlc3VsdChudWxsLCBuZXcgRXJyb3IoJ01hdGNoaW5nIGZvciBhIHRyZWUgd2l0aCB2YXIoKSBpcyBub3Qgc3VwcG9ydGVkJykpOwogICAgfQoKICAgIGlmICh1c2VDc3NXaWRlS2V5d29yZHMpIHsKICAgICAgICByZXN1bHQgPSBtYXRjaEFzVHJlZSh0b2tlbnMsIGxleGVyLmNzc1dpZGVLZXl3b3Jkc1N5bnRheCwgbGV4ZXIpOwogICAgfQoKICAgIGlmICghdXNlQ3NzV2lkZUtleXdvcmRzIHx8ICFyZXN1bHQubWF0Y2gpIHsKICAgICAgICByZXN1bHQgPSBtYXRjaEFzVHJlZSh0b2tlbnMsIHN5bnRheC5tYXRjaCwgbGV4ZXIpOwogICAgICAgIGlmICghcmVzdWx0Lm1hdGNoKSB7CiAgICAgICAgICAgIHJldHVybiBidWlsZE1hdGNoUmVzdWx0KAogICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgIG5ldyBTeW50YXhNYXRjaEVycm9yKHJlc3VsdC5yZWFzb24sIHN5bnRheC5zeW50YXgsIHZhbHVlLCByZXN1bHQpLAogICAgICAgICAgICAgICAgcmVzdWx0Lml0ZXJhdGlvbnMKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIGJ1aWxkTWF0Y2hSZXN1bHQocmVzdWx0Lm1hdGNoLCBudWxsLCByZXN1bHQuaXRlcmF0aW9ucyk7Cn0KCmNsYXNzIExleGVyIHsKICAgIGNvbnN0cnVjdG9yKGNvbmZpZywgc3ludGF4LCBzdHJ1Y3R1cmUpIHsKICAgICAgICB0aGlzLmNzc1dpZGVLZXl3b3Jkc1N5bnRheCA9IGNzc1dpZGVLZXl3b3Jkc1N5bnRheDsKICAgICAgICB0aGlzLnN5bnRheCA9IHN5bnRheDsKICAgICAgICB0aGlzLmdlbmVyaWMgPSBmYWxzZTsKICAgICAgICB0aGlzLnVuaXRzID0geyAuLi51bml0cyB9OwogICAgICAgIHRoaXMuYXRydWxlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgdGhpcy5wcm9wZXJ0aWVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICB0aGlzLnR5cGVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICB0aGlzLnN0cnVjdHVyZSA9IHN0cnVjdHVyZSB8fCBnZXRTdHJ1Y3R1cmVGcm9tQ29uZmlnKGNvbmZpZyk7CgogICAgICAgIGlmIChjb25maWcpIHsKICAgICAgICAgICAgaWYgKGNvbmZpZy51bml0cykgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBncm91cCBvZiBPYmplY3Qua2V5cyh1bml0cykpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjb25maWcudW5pdHNbZ3JvdXBdKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVuaXRzW2dyb3VwXSA9IGNvbmZpZy51bml0c1tncm91cF07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY29uZmlnLnR5cGVzKSB7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG5hbWUgaW4gY29uZmlnLnR5cGVzKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRUeXBlXyhuYW1lLCBjb25maWcudHlwZXNbbmFtZV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY29uZmlnLmdlbmVyaWMpIHsKICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJpYyA9IHRydWU7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtuYW1lLCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoY3JlYXRlR2VuZXJpY1R5cGVzKHRoaXMudW5pdHMpKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkVHlwZV8obmFtZSwgdmFsdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY29uZmlnLmF0cnVsZXMpIHsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbmFtZSBpbiBjb25maWcuYXRydWxlcykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkQXRydWxlXyhuYW1lLCBjb25maWcuYXRydWxlc1tuYW1lXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChjb25maWcucHJvcGVydGllcykgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBuYW1lIGluIGNvbmZpZy5wcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRQcm9wZXJ0eV8obmFtZSwgY29uZmlnLnByb3BlcnRpZXNbbmFtZV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGNoZWNrU3RydWN0dXJlKGFzdCkgewogICAgICAgIGZ1bmN0aW9uIGNvbGxlY3RXYXJuaW5nKG5vZGUsIG1lc3NhZ2UpIHsKICAgICAgICAgICAgd2FybnMucHVzaCh7IG5vZGUsIG1lc3NhZ2UgfSk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBzdHJ1Y3R1cmUgPSB0aGlzLnN0cnVjdHVyZTsKICAgICAgICBjb25zdCB3YXJucyA9IFtdOwoKICAgICAgICB0aGlzLnN5bnRheC53YWxrKGFzdCwgZnVuY3Rpb24obm9kZSkgewogICAgICAgICAgICBpZiAoc3RydWN0dXJlLmhhc093blByb3BlcnR5KG5vZGUudHlwZSkpIHsKICAgICAgICAgICAgICAgIHN0cnVjdHVyZVtub2RlLnR5cGVdLmNoZWNrKG5vZGUsIGNvbGxlY3RXYXJuaW5nKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbGxlY3RXYXJuaW5nKG5vZGUsICdVbmtub3duIG5vZGUgdHlwZSBgJyArIG5vZGUudHlwZSArICdgJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIHdhcm5zLmxlbmd0aCA/IHdhcm5zIDogZmFsc2U7CiAgICB9CgogICAgY3JlYXRlRGVzY3JpcHRvcihzeW50YXgsIHR5cGUsIG5hbWUsIHBhcmVudCA9IG51bGwpIHsKICAgICAgICBjb25zdCByZWYgPSB7CiAgICAgICAgICAgIHR5cGUsCiAgICAgICAgICAgIG5hbWUKICAgICAgICB9OwogICAgICAgIGNvbnN0IGRlc2NyaXB0b3IgPSB7CiAgICAgICAgICAgIHR5cGUsCiAgICAgICAgICAgIG5hbWUsCiAgICAgICAgICAgIHBhcmVudCwKICAgICAgICAgICAgc2VyaWFsaXphYmxlOiB0eXBlb2Ygc3ludGF4ID09PSAnc3RyaW5nJyB8fCAoc3ludGF4ICYmIHR5cGVvZiBzeW50YXgudHlwZSA9PT0gJ3N0cmluZycpLAogICAgICAgICAgICBzeW50YXg6IG51bGwsCiAgICAgICAgICAgIG1hdGNoOiBudWxsCiAgICAgICAgfTsKCiAgICAgICAgaWYgKHR5cGVvZiBzeW50YXggPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgZGVzY3JpcHRvci5tYXRjaCA9IGJ1aWxkTWF0Y2hHcmFwaChzeW50YXgsIHJlZik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBzeW50YXggPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAvLyBsYXp5IHBhcnNpbmcgb24gZmlyc3QgYWNjZXNzCiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZGVzY3JpcHRvciwgJ3N5bnRheCcsIHsKICAgICAgICAgICAgICAgICAgICBnZXQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkZXNjcmlwdG9yLCAnc3ludGF4JywgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHBhcnNlJEcoc3ludGF4KQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkZXNjcmlwdG9yLnN5bnRheDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGRlc2NyaXB0b3Iuc3ludGF4ID0gc3ludGF4OwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBsYXp5IGdyYXBoIGJ1aWxkIG9uIGZpcnN0IGFjY2VzcwogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZGVzY3JpcHRvciwgJ21hdGNoJywgewogICAgICAgICAgICAgICAgZ2V0KCkgewogICAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkZXNjcmlwdG9yLCAnbWF0Y2gnLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBidWlsZE1hdGNoR3JhcGgoZGVzY3JpcHRvci5zeW50YXgsIHJlZikKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlc2NyaXB0b3IubWF0Y2g7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGRlc2NyaXB0b3I7CiAgICB9CiAgICBhZGRBdHJ1bGVfKG5hbWUsIHN5bnRheCkgewogICAgICAgIGlmICghc3ludGF4KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHRoaXMuYXRydWxlc1tuYW1lXSA9IHsKICAgICAgICAgICAgdHlwZTogJ0F0cnVsZScsCiAgICAgICAgICAgIG5hbWU6IG5hbWUsCiAgICAgICAgICAgIHByZWx1ZGU6IHN5bnRheC5wcmVsdWRlID8gdGhpcy5jcmVhdGVEZXNjcmlwdG9yKHN5bnRheC5wcmVsdWRlLCAnQXRydWxlUHJlbHVkZScsIG5hbWUpIDogbnVsbCwKICAgICAgICAgICAgZGVzY3JpcHRvcnM6IHN5bnRheC5kZXNjcmlwdG9ycwogICAgICAgICAgICAgICAgPyBPYmplY3Qua2V5cyhzeW50YXguZGVzY3JpcHRvcnMpLnJlZHVjZSgKICAgICAgICAgICAgICAgICAgICAobWFwLCBkZXNjTmFtZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBtYXBbZGVzY05hbWVdID0gdGhpcy5jcmVhdGVEZXNjcmlwdG9yKHN5bnRheC5kZXNjcmlwdG9yc1tkZXNjTmFtZV0sICdBdHJ1bGVEZXNjcmlwdG9yJywgZGVzY05hbWUsIG5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWFwOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmNyZWF0ZShudWxsKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgOiBudWxsCiAgICAgICAgfTsKICAgIH0KICAgIGFkZFByb3BlcnR5XyhuYW1lLCBzeW50YXgpIHsKICAgICAgICBpZiAoIXN5bnRheCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB0aGlzLnByb3BlcnRpZXNbbmFtZV0gPSB0aGlzLmNyZWF0ZURlc2NyaXB0b3Ioc3ludGF4LCAnUHJvcGVydHknLCBuYW1lKTsKICAgIH0KICAgIGFkZFR5cGVfKG5hbWUsIHN5bnRheCkgewogICAgICAgIGlmICghc3ludGF4KSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHRoaXMudHlwZXNbbmFtZV0gPSB0aGlzLmNyZWF0ZURlc2NyaXB0b3Ioc3ludGF4LCAnVHlwZScsIG5hbWUpOwogICAgfQoKICAgIGNoZWNrQXRydWxlTmFtZShhdHJ1bGVOYW1lKSB7CiAgICAgICAgaWYgKCF0aGlzLmdldEF0cnVsZShhdHJ1bGVOYW1lKSkgewogICAgICAgICAgICByZXR1cm4gbmV3IFN5bnRheFJlZmVyZW5jZUVycm9yKCdVbmtub3duIGF0LXJ1bGUnLCAnQCcgKyBhdHJ1bGVOYW1lKTsKICAgICAgICB9CiAgICB9CiAgICBjaGVja0F0cnVsZVByZWx1ZGUoYXRydWxlTmFtZSwgcHJlbHVkZSkgewogICAgICAgIGNvbnN0IGVycm9yID0gdGhpcy5jaGVja0F0cnVsZU5hbWUoYXRydWxlTmFtZSk7CgogICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgICByZXR1cm4gZXJyb3I7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBhdHJ1bGUgPSB0aGlzLmdldEF0cnVsZShhdHJ1bGVOYW1lKTsKCiAgICAgICAgaWYgKCFhdHJ1bGUucHJlbHVkZSAmJiBwcmVsdWRlKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgU3ludGF4RXJyb3IoJ0F0LXJ1bGUgYEAnICsgYXRydWxlTmFtZSArICdgIHNob3VsZCBub3QgY29udGFpbiBhIHByZWx1ZGUnKTsKICAgICAgICB9CgogICAgICAgIGlmIChhdHJ1bGUucHJlbHVkZSAmJiAhcHJlbHVkZSkgewogICAgICAgICAgICBpZiAoIW1hdGNoU3ludGF4KHRoaXMsIGF0cnVsZS5wcmVsdWRlLCAnJywgZmFsc2UpLm1hdGNoZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU3ludGF4RXJyb3IoJ0F0LXJ1bGUgYEAnICsgYXRydWxlTmFtZSArICdgIHNob3VsZCBjb250YWluIGEgcHJlbHVkZScpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgY2hlY2tBdHJ1bGVEZXNjcmlwdG9yTmFtZShhdHJ1bGVOYW1lLCBkZXNjcmlwdG9yTmFtZSkgewogICAgICAgIGNvbnN0IGVycm9yID0gdGhpcy5jaGVja0F0cnVsZU5hbWUoYXRydWxlTmFtZSk7CgogICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgICByZXR1cm4gZXJyb3I7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBhdHJ1bGUgPSB0aGlzLmdldEF0cnVsZShhdHJ1bGVOYW1lKTsKICAgICAgICBjb25zdCBkZXNjcmlwdG9yID0ga2V5d29yZChkZXNjcmlwdG9yTmFtZSk7CgogICAgICAgIGlmICghYXRydWxlLmRlc2NyaXB0b3JzKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgU3ludGF4RXJyb3IoJ0F0LXJ1bGUgYEAnICsgYXRydWxlTmFtZSArICdgIGhhcyBubyBrbm93biBkZXNjcmlwdG9ycycpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFhdHJ1bGUuZGVzY3JpcHRvcnNbZGVzY3JpcHRvci5uYW1lXSAmJgogICAgICAgICAgICAhYXRydWxlLmRlc2NyaXB0b3JzW2Rlc2NyaXB0b3IuYmFzZW5hbWVdKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgU3ludGF4UmVmZXJlbmNlRXJyb3IoJ1Vua25vd24gYXQtcnVsZSBkZXNjcmlwdG9yJywgZGVzY3JpcHRvck5hbWUpOwogICAgICAgIH0KICAgIH0KICAgIGNoZWNrUHJvcGVydHlOYW1lKHByb3BlcnR5TmFtZSkgewogICAgICAgIGlmICghdGhpcy5nZXRQcm9wZXJ0eShwcm9wZXJ0eU5hbWUpKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgU3ludGF4UmVmZXJlbmNlRXJyb3IoJ1Vua25vd24gcHJvcGVydHknLCBwcm9wZXJ0eU5hbWUpOwogICAgICAgIH0KICAgIH0KCiAgICBtYXRjaEF0cnVsZVByZWx1ZGUoYXRydWxlTmFtZSwgcHJlbHVkZSkgewogICAgICAgIGNvbnN0IGVycm9yID0gdGhpcy5jaGVja0F0cnVsZVByZWx1ZGUoYXRydWxlTmFtZSwgcHJlbHVkZSk7CgogICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgICByZXR1cm4gYnVpbGRNYXRjaFJlc3VsdChudWxsLCBlcnJvcik7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBhdHJ1bGUgPSB0aGlzLmdldEF0cnVsZShhdHJ1bGVOYW1lKTsKCiAgICAgICAgaWYgKCFhdHJ1bGUucHJlbHVkZSkgewogICAgICAgICAgICByZXR1cm4gYnVpbGRNYXRjaFJlc3VsdChudWxsLCBudWxsKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBtYXRjaFN5bnRheCh0aGlzLCBhdHJ1bGUucHJlbHVkZSwgcHJlbHVkZSB8fCAnJywgZmFsc2UpOwogICAgfQogICAgbWF0Y2hBdHJ1bGVEZXNjcmlwdG9yKGF0cnVsZU5hbWUsIGRlc2NyaXB0b3JOYW1lLCB2YWx1ZSkgewogICAgICAgIGNvbnN0IGVycm9yID0gdGhpcy5jaGVja0F0cnVsZURlc2NyaXB0b3JOYW1lKGF0cnVsZU5hbWUsIGRlc2NyaXB0b3JOYW1lKTsKCiAgICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgICAgIHJldHVybiBidWlsZE1hdGNoUmVzdWx0KG51bGwsIGVycm9yKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGF0cnVsZSA9IHRoaXMuZ2V0QXRydWxlKGF0cnVsZU5hbWUpOwogICAgICAgIGNvbnN0IGRlc2NyaXB0b3IgPSBrZXl3b3JkKGRlc2NyaXB0b3JOYW1lKTsKCiAgICAgICAgcmV0dXJuIG1hdGNoU3ludGF4KHRoaXMsIGF0cnVsZS5kZXNjcmlwdG9yc1tkZXNjcmlwdG9yLm5hbWVdIHx8IGF0cnVsZS5kZXNjcmlwdG9yc1tkZXNjcmlwdG9yLmJhc2VuYW1lXSwgdmFsdWUsIGZhbHNlKTsKICAgIH0KICAgIG1hdGNoRGVjbGFyYXRpb24obm9kZSkgewogICAgICAgIGlmIChub2RlLnR5cGUgIT09ICdEZWNsYXJhdGlvbicpIHsKICAgICAgICAgICAgcmV0dXJuIGJ1aWxkTWF0Y2hSZXN1bHQobnVsbCwgbmV3IEVycm9yKCdOb3QgYSBEZWNsYXJhdGlvbiBub2RlJykpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRoaXMubWF0Y2hQcm9wZXJ0eShub2RlLnByb3BlcnR5LCBub2RlLnZhbHVlKTsKICAgIH0KICAgIG1hdGNoUHJvcGVydHkocHJvcGVydHlOYW1lLCB2YWx1ZSkgewogICAgICAgIC8vIGRvbid0IG1hdGNoIHN5bnRheCBmb3IgYSBjdXN0b20gcHJvcGVydHkgYXQgdGhlIG1vbWVudAogICAgICAgIGlmIChwcm9wZXJ0eShwcm9wZXJ0eU5hbWUpLmN1c3RvbSkgewogICAgICAgICAgICByZXR1cm4gYnVpbGRNYXRjaFJlc3VsdChudWxsLCBuZXcgRXJyb3IoJ0xleGVyIG1hdGNoaW5nIGRvZXNuXCd0IGFwcGxpY2FibGUgZm9yIGN1c3RvbSBwcm9wZXJ0aWVzJykpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZXJyb3IgPSB0aGlzLmNoZWNrUHJvcGVydHlOYW1lKHByb3BlcnR5TmFtZSk7CgogICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgICByZXR1cm4gYnVpbGRNYXRjaFJlc3VsdChudWxsLCBlcnJvcik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbWF0Y2hTeW50YXgodGhpcywgdGhpcy5nZXRQcm9wZXJ0eShwcm9wZXJ0eU5hbWUpLCB2YWx1ZSwgdHJ1ZSk7CiAgICB9CiAgICBtYXRjaFR5cGUodHlwZU5hbWUsIHZhbHVlKSB7CiAgICAgICAgY29uc3QgdHlwZVN5bnRheCA9IHRoaXMuZ2V0VHlwZSh0eXBlTmFtZSk7CgogICAgICAgIGlmICghdHlwZVN5bnRheCkgewogICAgICAgICAgICByZXR1cm4gYnVpbGRNYXRjaFJlc3VsdChudWxsLCBuZXcgU3ludGF4UmVmZXJlbmNlRXJyb3IoJ1Vua25vd24gdHlwZScsIHR5cGVOYW1lKSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbWF0Y2hTeW50YXgodGhpcywgdHlwZVN5bnRheCwgdmFsdWUsIGZhbHNlKTsKICAgIH0KICAgIG1hdGNoKHN5bnRheCwgdmFsdWUpIHsKICAgICAgICBpZiAodHlwZW9mIHN5bnRheCAhPT0gJ3N0cmluZycgJiYgKCFzeW50YXggfHwgIXN5bnRheC50eXBlKSkgewogICAgICAgICAgICByZXR1cm4gYnVpbGRNYXRjaFJlc3VsdChudWxsLCBuZXcgU3ludGF4UmVmZXJlbmNlRXJyb3IoJ0JhZCBzeW50YXgnKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZW9mIHN5bnRheCA9PT0gJ3N0cmluZycgfHwgIXN5bnRheC5tYXRjaCkgewogICAgICAgICAgICBzeW50YXggPSB0aGlzLmNyZWF0ZURlc2NyaXB0b3Ioc3ludGF4LCAnVHlwZScsICdhbm9ueW1vdXMnKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBtYXRjaFN5bnRheCh0aGlzLCBzeW50YXgsIHZhbHVlLCBmYWxzZSk7CiAgICB9CgogICAgZmluZFZhbHVlRnJhZ21lbnRzKHByb3BlcnR5TmFtZSwgdmFsdWUsIHR5cGUsIG5hbWUpIHsKICAgICAgICByZXR1cm4gbWF0Y2hGcmFnbWVudHModGhpcywgdmFsdWUsIHRoaXMubWF0Y2hQcm9wZXJ0eShwcm9wZXJ0eU5hbWUsIHZhbHVlKSwgdHlwZSwgbmFtZSk7CiAgICB9CiAgICBmaW5kRGVjbGFyYXRpb25WYWx1ZUZyYWdtZW50cyhkZWNsYXJhdGlvbiwgdHlwZSwgbmFtZSkgewogICAgICAgIHJldHVybiBtYXRjaEZyYWdtZW50cyh0aGlzLCBkZWNsYXJhdGlvbi52YWx1ZSwgdGhpcy5tYXRjaERlY2xhcmF0aW9uKGRlY2xhcmF0aW9uKSwgdHlwZSwgbmFtZSk7CiAgICB9CiAgICBmaW5kQWxsRnJhZ21lbnRzKGFzdCwgdHlwZSwgbmFtZSkgewogICAgICAgIGNvbnN0IHJlc3VsdCA9IFtdOwoKICAgICAgICB0aGlzLnN5bnRheC53YWxrKGFzdCwgewogICAgICAgICAgICB2aXNpdDogJ0RlY2xhcmF0aW9uJywKICAgICAgICAgICAgZW50ZXI6IChkZWNsYXJhdGlvbikgPT4gewogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2guYXBwbHkocmVzdWx0LCB0aGlzLmZpbmREZWNsYXJhdGlvblZhbHVlRnJhZ21lbnRzKGRlY2xhcmF0aW9uLCB0eXBlLCBuYW1lKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICBnZXRBdHJ1bGUoYXRydWxlTmFtZSwgZmFsbGJhY2tCYXNlbmFtZSA9IHRydWUpIHsKICAgICAgICBjb25zdCBhdHJ1bGUgPSBrZXl3b3JkKGF0cnVsZU5hbWUpOwogICAgICAgIGNvbnN0IGF0cnVsZUVudHJ5ID0gYXRydWxlLnZlbmRvciAmJiBmYWxsYmFja0Jhc2VuYW1lCiAgICAgICAgICAgID8gdGhpcy5hdHJ1bGVzW2F0cnVsZS5uYW1lXSB8fCB0aGlzLmF0cnVsZXNbYXRydWxlLmJhc2VuYW1lXQogICAgICAgICAgICA6IHRoaXMuYXRydWxlc1thdHJ1bGUubmFtZV07CgogICAgICAgIHJldHVybiBhdHJ1bGVFbnRyeSB8fCBudWxsOwogICAgfQogICAgZ2V0QXRydWxlUHJlbHVkZShhdHJ1bGVOYW1lLCBmYWxsYmFja0Jhc2VuYW1lID0gdHJ1ZSkgewogICAgICAgIGNvbnN0IGF0cnVsZSA9IHRoaXMuZ2V0QXRydWxlKGF0cnVsZU5hbWUsIGZhbGxiYWNrQmFzZW5hbWUpOwoKICAgICAgICByZXR1cm4gYXRydWxlICYmIGF0cnVsZS5wcmVsdWRlIHx8IG51bGw7CiAgICB9CiAgICBnZXRBdHJ1bGVEZXNjcmlwdG9yKGF0cnVsZU5hbWUsIG5hbWUpIHsKICAgICAgICByZXR1cm4gdGhpcy5hdHJ1bGVzLmhhc093blByb3BlcnR5KGF0cnVsZU5hbWUpICYmIHRoaXMuYXRydWxlcy5kZWNsYXJhdG9ycwogICAgICAgICAgICA/IHRoaXMuYXRydWxlc1thdHJ1bGVOYW1lXS5kZWNsYXJhdG9yc1tuYW1lXSB8fCBudWxsCiAgICAgICAgICAgIDogbnVsbDsKICAgIH0KICAgIGdldFByb3BlcnR5KHByb3BlcnR5TmFtZSwgZmFsbGJhY2tCYXNlbmFtZSA9IHRydWUpIHsKICAgICAgICBjb25zdCBwcm9wZXJ0eSQxID0gcHJvcGVydHkocHJvcGVydHlOYW1lKTsKICAgICAgICBjb25zdCBwcm9wZXJ0eUVudHJ5ID0gcHJvcGVydHkkMS52ZW5kb3IgJiYgZmFsbGJhY2tCYXNlbmFtZQogICAgICAgICAgICA/IHRoaXMucHJvcGVydGllc1twcm9wZXJ0eSQxLm5hbWVdIHx8IHRoaXMucHJvcGVydGllc1twcm9wZXJ0eSQxLmJhc2VuYW1lXQogICAgICAgICAgICA6IHRoaXMucHJvcGVydGllc1twcm9wZXJ0eSQxLm5hbWVdOwoKICAgICAgICByZXR1cm4gcHJvcGVydHlFbnRyeSB8fCBudWxsOwogICAgfQogICAgZ2V0VHlwZShuYW1lKSB7CiAgICAgICAgcmV0dXJuIGhhc093blByb3BlcnR5LmNhbGwodGhpcy50eXBlcywgbmFtZSkgPyB0aGlzLnR5cGVzW25hbWVdIDogbnVsbDsKICAgIH0KCiAgICB2YWxpZGF0ZSgpIHsKICAgICAgICBmdW5jdGlvbiB2YWxpZGF0ZShzeW50YXgsIG5hbWUsIGJyb2tlbiwgZGVzY3JpcHRvcikgewogICAgICAgICAgICBpZiAoYnJva2VuLmhhcyhuYW1lKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJyb2tlbi5nZXQobmFtZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyb2tlbi5zZXQobmFtZSwgZmFsc2UpOwogICAgICAgICAgICBpZiAoZGVzY3JpcHRvci5zeW50YXggIT09IG51bGwpIHsKICAgICAgICAgICAgICAgIHdhbGskMShkZXNjcmlwdG9yLnN5bnRheCwgZnVuY3Rpb24obm9kZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChub2RlLnR5cGUgIT09ICdUeXBlJyAmJiBub2RlLnR5cGUgIT09ICdQcm9wZXJ0eScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWFwID0gbm9kZS50eXBlID09PSAnVHlwZScgPyBzeW50YXgudHlwZXMgOiBzeW50YXgucHJvcGVydGllczsKICAgICAgICAgICAgICAgICAgICBjb25zdCBicm9rZW5NYXAgPSBub2RlLnR5cGUgPT09ICdUeXBlJyA/IGJyb2tlblR5cGVzIDogYnJva2VuUHJvcGVydGllczsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCFoYXNPd25Qcm9wZXJ0eS5jYWxsKG1hcCwgbm9kZS5uYW1lKSB8fCB2YWxpZGF0ZShzeW50YXgsIG5vZGUubmFtZSwgYnJva2VuTWFwLCBtYXBbbm9kZS5uYW1lXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYnJva2VuLnNldChuYW1lLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCB0aGlzKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbGV0IGJyb2tlblR5cGVzID0gbmV3IE1hcCgpOwogICAgICAgIGxldCBicm9rZW5Qcm9wZXJ0aWVzID0gbmV3IE1hcCgpOwoKICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzLnR5cGVzKSB7CiAgICAgICAgICAgIHZhbGlkYXRlKHRoaXMsIGtleSwgYnJva2VuVHlwZXMsIHRoaXMudHlwZXNba2V5XSk7CiAgICAgICAgfQoKICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzLnByb3BlcnRpZXMpIHsKICAgICAgICAgICAgdmFsaWRhdGUodGhpcywga2V5LCBicm9rZW5Qcm9wZXJ0aWVzLCB0aGlzLnByb3BlcnRpZXNba2V5XSk7CiAgICAgICAgfQoKICAgICAgICBicm9rZW5UeXBlcyA9IFsuLi5icm9rZW5UeXBlcy5rZXlzKCldLmZpbHRlcihuYW1lID0+IGJyb2tlblR5cGVzLmdldChuYW1lKSk7CiAgICAgICAgYnJva2VuUHJvcGVydGllcyA9IFsuLi5icm9rZW5Qcm9wZXJ0aWVzLmtleXMoKV0uZmlsdGVyKG5hbWUgPT4gYnJva2VuUHJvcGVydGllcy5nZXQobmFtZSkpOwoKICAgICAgICBpZiAoYnJva2VuVHlwZXMubGVuZ3RoIHx8IGJyb2tlblByb3BlcnRpZXMubGVuZ3RoKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0eXBlczogYnJva2VuVHlwZXMsCiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiBicm9rZW5Qcm9wZXJ0aWVzCiAgICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGR1bXAoc3ludGF4QXNBc3QsIHByZXR0eSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGdlbmVyaWM6IHRoaXMuZ2VuZXJpYywKICAgICAgICAgICAgdW5pdHM6IHRoaXMudW5pdHMsCiAgICAgICAgICAgIHR5cGVzOiBkdW1wTWFwU3ludGF4KHRoaXMudHlwZXMsICFwcmV0dHksIHN5bnRheEFzQXN0KSwKICAgICAgICAgICAgcHJvcGVydGllczogZHVtcE1hcFN5bnRheCh0aGlzLnByb3BlcnRpZXMsICFwcmV0dHksIHN5bnRheEFzQXN0KSwKICAgICAgICAgICAgYXRydWxlczogZHVtcEF0cnVsZU1hcFN5bnRheCh0aGlzLmF0cnVsZXMsICFwcmV0dHksIHN5bnRheEFzQXN0KQogICAgICAgIH07CiAgICB9CiAgICB0b1N0cmluZygpIHsKICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodGhpcy5kdW1wKCkpOwogICAgfQp9CgpmdW5jdGlvbiBhcHBlbmRPclNldChhLCBiKSB7CiAgICBpZiAodHlwZW9mIGIgPT09ICdzdHJpbmcnICYmIC9eXHMqXHwvLnRlc3QoYikpIHsKICAgICAgICByZXR1cm4gdHlwZW9mIGEgPT09ICdzdHJpbmcnCiAgICAgICAgICAgID8gYSArIGIKICAgICAgICAgICAgOiBiLnJlcGxhY2UoL15ccypcfFxzKi8sICcnKTsKICAgIH0KCiAgICByZXR1cm4gYiB8fCBudWxsOwp9CgpmdW5jdGlvbiBzbGljZVByb3BzKG9iaiwgcHJvcHMpIHsKICAgIGNvbnN0IHJlc3VsdCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgogICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMob2JqKSkgewogICAgICAgIGlmICh2YWx1ZSkgewogICAgICAgICAgICByZXN1bHRba2V5XSA9IHt9OwogICAgICAgICAgICBmb3IgKGNvbnN0IHByb3Agb2YgT2JqZWN0LmtleXModmFsdWUpKSB7CiAgICAgICAgICAgICAgICBpZiAocHJvcHMuaW5jbHVkZXMocHJvcCkpIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHRba2V5XVtwcm9wXSA9IHZhbHVlW3Byb3BdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIG1peChkZXN0LCBzcmMpIHsKICAgIGNvbnN0IHJlc3VsdCA9IHsgLi4uZGVzdCB9OwoKICAgIGZvciAoY29uc3QgW3Byb3AsIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhzcmMpKSB7CiAgICAgICAgc3dpdGNoIChwcm9wKSB7CiAgICAgICAgICAgIGNhc2UgJ2dlbmVyaWMnOgogICAgICAgICAgICAgICAgcmVzdWx0W3Byb3BdID0gQm9vbGVhbih2YWx1ZSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ3VuaXRzJzoKICAgICAgICAgICAgICAgIHJlc3VsdFtwcm9wXSA9IHsgLi4uZGVzdFtwcm9wXSB9OwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBbbmFtZSwgcGF0Y2hdIG9mIE9iamVjdC5lbnRyaWVzKHZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtwcm9wXVtuYW1lXSA9IEFycmF5LmlzQXJyYXkocGF0Y2gpID8gcGF0Y2ggOiBbXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAnYXRydWxlcyc6CiAgICAgICAgICAgICAgICByZXN1bHRbcHJvcF0gPSB7IC4uLmRlc3RbcHJvcF0gfTsKCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtuYW1lLCBhdHJ1bGVdIG9mIE9iamVjdC5lbnRyaWVzKHZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4aXN0cyA9IHJlc3VsdFtwcm9wXVtuYW1lXSB8fCB7fTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50ID0gcmVzdWx0W3Byb3BdW25hbWVdID0gewogICAgICAgICAgICAgICAgICAgICAgICBwcmVsdWRlOiBleGlzdHMucHJlbHVkZSB8fCBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdG9yczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uZXhpc3RzLmRlc2NyaXB0b3JzCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgICBpZiAoIWF0cnVsZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGN1cnJlbnQucHJlbHVkZSA9IGF0cnVsZS5wcmVsdWRlCiAgICAgICAgICAgICAgICAgICAgICAgID8gYXBwZW5kT3JTZXQoY3VycmVudC5wcmVsdWRlLCBhdHJ1bGUucHJlbHVkZSkKICAgICAgICAgICAgICAgICAgICAgICAgOiBjdXJyZW50LnByZWx1ZGUgfHwgbnVsbDsKCiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBbZGVzY3JpcHRvck5hbWUsIGRlc2NyaXB0b3JWYWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoYXRydWxlLmRlc2NyaXB0b3JzIHx8IHt9KSkgewogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50LmRlc2NyaXB0b3JzW2Rlc2NyaXB0b3JOYW1lXSA9IGRlc2NyaXB0b3JWYWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBhcHBlbmRPclNldChjdXJyZW50LmRlc2NyaXB0b3JzW2Rlc2NyaXB0b3JOYW1lXSwgZGVzY3JpcHRvclZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBudWxsOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKCFPYmplY3Qua2V5cyhjdXJyZW50LmRlc2NyaXB0b3JzKS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudC5kZXNjcmlwdG9ycyA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICd0eXBlcyc6CiAgICAgICAgICAgIGNhc2UgJ3Byb3BlcnRpZXMnOgogICAgICAgICAgICAgICAgcmVzdWx0W3Byb3BdID0geyAuLi5kZXN0W3Byb3BdIH07CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtuYW1lLCBzeW50YXhdIG9mIE9iamVjdC5lbnRyaWVzKHZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdFtwcm9wXVtuYW1lXSA9IGFwcGVuZE9yU2V0KHJlc3VsdFtwcm9wXVtuYW1lXSwgc3ludGF4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAnc2NvcGUnOgogICAgICAgICAgICAgICAgcmVzdWx0W3Byb3BdID0geyAuLi5kZXN0W3Byb3BdIH07CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtuYW1lLCBwcm9wc10gb2YgT2JqZWN0LmVudHJpZXModmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W3Byb3BdW25hbWVdID0geyAuLi5yZXN1bHRbcHJvcF1bbmFtZV0sIC4uLnByb3BzIH07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ3BhcnNlQ29udGV4dCc6CiAgICAgICAgICAgICAgICByZXN1bHRbcHJvcF0gPSB7CiAgICAgICAgICAgICAgICAgICAgLi4uZGVzdFtwcm9wXSwKICAgICAgICAgICAgICAgICAgICAuLi52YWx1ZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAnYXRydWxlJzoKICAgICAgICAgICAgY2FzZSAncHNldWRvJzoKICAgICAgICAgICAgICAgIHJlc3VsdFtwcm9wXSA9IHsKICAgICAgICAgICAgICAgICAgICAuLi5kZXN0W3Byb3BdLAogICAgICAgICAgICAgICAgICAgIC4uLnNsaWNlUHJvcHModmFsdWUsIFsncGFyc2UnXSkgfTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAnbm9kZSc6CiAgICAgICAgICAgICAgICByZXN1bHRbcHJvcF0gPSB7CiAgICAgICAgICAgICAgICAgICAgLi4uZGVzdFtwcm9wXSwKICAgICAgICAgICAgICAgICAgICAuLi5zbGljZVByb3BzKHZhbHVlLCBbJ25hbWUnLCAnc3RydWN0dXJlJywgJ3BhcnNlJywgJ2dlbmVyYXRlJywgJ3dhbGtDb250ZXh0J10pCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uIGNyZWF0ZVN5bnRheChjb25maWcpIHsKICAgIGNvbnN0IHBhcnNlID0gY3JlYXRlUGFyc2VyKGNvbmZpZyk7CiAgICBjb25zdCB3YWxrID0gY3JlYXRlV2Fsa2VyKGNvbmZpZyk7CiAgICBjb25zdCBnZW5lcmF0ZSA9IGNyZWF0ZUdlbmVyYXRvcihjb25maWcpOwogICAgY29uc3QgeyBmcm9tUGxhaW5PYmplY3QsIHRvUGxhaW5PYmplY3QgfSA9IGNyZWF0ZUNvbnZlcnRvcih3YWxrKTsKCiAgICBjb25zdCBzeW50YXggPSB7CiAgICAgICAgbGV4ZXI6IG51bGwsCiAgICAgICAgY3JlYXRlTGV4ZXI6IGNvbmZpZyA9PiBuZXcgTGV4ZXIoY29uZmlnLCBzeW50YXgsIHN5bnRheC5sZXhlci5zdHJ1Y3R1cmUpLAoKICAgICAgICB0b2tlbml6ZTogdG9rZW5pemUkMSwKICAgICAgICBwYXJzZSwKICAgICAgICBnZW5lcmF0ZSwKCiAgICAgICAgd2FsaywKICAgICAgICBmaW5kOiB3YWxrLmZpbmQsCiAgICAgICAgZmluZExhc3Q6IHdhbGsuZmluZExhc3QsCiAgICAgICAgZmluZEFsbDogd2Fsay5maW5kQWxsLAoKICAgICAgICBmcm9tUGxhaW5PYmplY3QsCiAgICAgICAgdG9QbGFpbk9iamVjdCwKCiAgICAgICAgZm9yayhleHRlbnNpb24pIHsKICAgICAgICAgICAgY29uc3QgYmFzZSA9IG1peCh7fSwgY29uZmlnKTsgLy8gY29weSBvZiBjb25maWcKCiAgICAgICAgICAgIHJldHVybiBjcmVhdGVTeW50YXgoCiAgICAgICAgICAgICAgICB0eXBlb2YgZXh0ZW5zaW9uID09PSAnZnVuY3Rpb24nCiAgICAgICAgICAgICAgICAgICAgPyBleHRlbnNpb24oYmFzZSwgT2JqZWN0LmFzc2lnbikKICAgICAgICAgICAgICAgICAgICA6IG1peChiYXNlLCBleHRlbnNpb24pCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfTsKCiAgICBzeW50YXgubGV4ZXIgPSBuZXcgTGV4ZXIoewogICAgICAgIGdlbmVyaWM6IHRydWUsCiAgICAgICAgdW5pdHM6IGNvbmZpZy51bml0cywKICAgICAgICB0eXBlczogY29uZmlnLnR5cGVzLAogICAgICAgIGF0cnVsZXM6IGNvbmZpZy5hdHJ1bGVzLAogICAgICAgIHByb3BlcnRpZXM6IGNvbmZpZy5wcm9wZXJ0aWVzLAogICAgICAgIG5vZGU6IGNvbmZpZy5ub2RlCiAgICB9LCBzeW50YXgpOwoKICAgIHJldHVybiBzeW50YXg7Cn0KY29uc3QgY3JlYXRlU3ludGF4JDEgPSBjb25maWcgPT4gY3JlYXRlU3ludGF4KG1peCh7fSwgY29uZmlnKSk7Cgpjb25zdCBkZWZpbml0aW9ucyA9IHsKICAgICJnZW5lcmljIjogdHJ1ZSwKICAgICJ1bml0cyI6IHsKICAgICAgICAiYW5nbGUiOiBbCiAgICAgICAgICAgICJkZWciLAogICAgICAgICAgICAiZ3JhZCIsCiAgICAgICAgICAgICJyYWQiLAogICAgICAgICAgICAidHVybiIKICAgICAgICBdLAogICAgICAgICJkZWNpYmVsIjogWwogICAgICAgICAgICAiZGIiCiAgICAgICAgXSwKICAgICAgICAiZmxleCI6IFsKICAgICAgICAgICAgImZyIgogICAgICAgIF0sCiAgICAgICAgImZyZXF1ZW5jeSI6IFsKICAgICAgICAgICAgImh6IiwKICAgICAgICAgICAgImtoeiIKICAgICAgICBdLAogICAgICAgICJsZW5ndGgiOiBbCiAgICAgICAgICAgICJjbSIsCiAgICAgICAgICAgICJtbSIsCiAgICAgICAgICAgICJxIiwKICAgICAgICAgICAgImluIiwKICAgICAgICAgICAgInB0IiwKICAgICAgICAgICAgInBjIiwKICAgICAgICAgICAgInB4IiwKICAgICAgICAgICAgImVtIiwKICAgICAgICAgICAgInJlbSIsCiAgICAgICAgICAgICJleCIsCiAgICAgICAgICAgICJyZXgiLAogICAgICAgICAgICAiY2FwIiwKICAgICAgICAgICAgInJjYXAiLAogICAgICAgICAgICAiY2giLAogICAgICAgICAgICAicmNoIiwKICAgICAgICAgICAgImljIiwKICAgICAgICAgICAgInJpYyIsCiAgICAgICAgICAgICJsaCIsCiAgICAgICAgICAgICJybGgiLAogICAgICAgICAgICAidnciLAogICAgICAgICAgICAic3Z3IiwKICAgICAgICAgICAgImx2dyIsCiAgICAgICAgICAgICJkdnciLAogICAgICAgICAgICAidmgiLAogICAgICAgICAgICAic3ZoIiwKICAgICAgICAgICAgImx2aCIsCiAgICAgICAgICAgICJkdmgiLAogICAgICAgICAgICAidmkiLAogICAgICAgICAgICAic3ZpIiwKICAgICAgICAgICAgImx2aSIsCiAgICAgICAgICAgICJkdmkiLAogICAgICAgICAgICAidmIiLAogICAgICAgICAgICAic3ZiIiwKICAgICAgICAgICAgImx2YiIsCiAgICAgICAgICAgICJkdmIiLAogICAgICAgICAgICAidm1pbiIsCiAgICAgICAgICAgICJzdm1pbiIsCiAgICAgICAgICAgICJsdm1pbiIsCiAgICAgICAgICAgICJkdm1pbiIsCiAgICAgICAgICAgICJ2bWF4IiwKICAgICAgICAgICAgInN2bWF4IiwKICAgICAgICAgICAgImx2bWF4IiwKICAgICAgICAgICAgImR2bWF4IiwKICAgICAgICAgICAgImNxdyIsCiAgICAgICAgICAgICJjcWgiLAogICAgICAgICAgICAiY3FpIiwKICAgICAgICAgICAgImNxYiIsCiAgICAgICAgICAgICJjcW1pbiIsCiAgICAgICAgICAgICJjcW1heCIKICAgICAgICBdLAogICAgICAgICJyZXNvbHV0aW9uIjogWwogICAgICAgICAgICAiZHBpIiwKICAgICAgICAgICAgImRwY20iLAogICAgICAgICAgICAiZHBweCIsCiAgICAgICAgICAgICJ4IgogICAgICAgIF0sCiAgICAgICAgInNlbWl0b25lcyI6IFsKICAgICAgICAgICAgInN0IgogICAgICAgIF0sCiAgICAgICAgInRpbWUiOiBbCiAgICAgICAgICAgICJzIiwKICAgICAgICAgICAgIm1zIgogICAgICAgIF0KICAgIH0sCiAgICAidHlwZXMiOiB7CiAgICAgICAgImFicygpIjogImFicyggPGNhbGMtc3VtPiApIiwKICAgICAgICAiYWJzb2x1dGUtc2l6ZSI6ICJ4eC1zbWFsbHx4LXNtYWxsfHNtYWxsfG1lZGl1bXxsYXJnZXx4LWxhcmdlfHh4LWxhcmdlfHh4eC1sYXJnZSIsCiAgICAgICAgImFjb3MoKSI6ICJhY29zKCA8Y2FsYy1zdW0+ICkiLAogICAgICAgICJhbHBoYS12YWx1ZSI6ICI8bnVtYmVyPnw8cGVyY2VudGFnZT4iLAogICAgICAgICJhbmdsZS1wZXJjZW50YWdlIjogIjxhbmdsZT58PHBlcmNlbnRhZ2U+IiwKICAgICAgICAiYW5ndWxhci1jb2xvci1oaW50IjogIjxhbmdsZS1wZXJjZW50YWdlPiIsCiAgICAgICAgImFuZ3VsYXItY29sb3Itc3RvcCI6ICI8Y29sb3I+JiY8Y29sb3Itc3RvcC1hbmdsZT4/IiwKICAgICAgICAiYW5ndWxhci1jb2xvci1zdG9wLWxpc3QiOiAiWzxhbmd1bGFyLWNvbG9yLXN0b3A+IFssIDxhbmd1bGFyLWNvbG9yLWhpbnQ+XT9dIyAsIDxhbmd1bGFyLWNvbG9yLXN0b3A+IiwKICAgICAgICAiYW5pbWF0ZWFibGUtZmVhdHVyZSI6ICJzY3JvbGwtcG9zaXRpb258Y29udGVudHN8PGN1c3RvbS1pZGVudD4iLAogICAgICAgICJhc2luKCkiOiAiYXNpbiggPGNhbGMtc3VtPiApIiwKICAgICAgICAiYXRhbigpIjogImF0YW4oIDxjYWxjLXN1bT4gKSIsCiAgICAgICAgImF0YW4yKCkiOiAiYXRhbjIoIDxjYWxjLXN1bT4gLCA8Y2FsYy1zdW0+ICkiLAogICAgICAgICJhdHRhY2htZW50IjogInNjcm9sbHxmaXhlZHxsb2NhbCIsCiAgICAgICAgImF0dHIoKSI6ICJhdHRyKCA8YXR0ci1uYW1lPiA8dHlwZS1vci11bml0Pj8gWywgPGF0dHItZmFsbGJhY2s+XT8gKSIsCiAgICAgICAgImF0dHItbWF0Y2hlciI6ICJbJ34nfCd8J3wnXid8JyQnfCcqJ10/ICc9JyIsCiAgICAgICAgImF0dHItbW9kaWZpZXIiOiAiaXxzIiwKICAgICAgICAiYXR0cmlidXRlLXNlbGVjdG9yIjogIidbJyA8d3EtbmFtZT4gJ10nfCdbJyA8d3EtbmFtZT4gPGF0dHItbWF0Y2hlcj4gWzxzdHJpbmctdG9rZW4+fDxpZGVudC10b2tlbj5dIDxhdHRyLW1vZGlmaWVyPj8gJ10nIiwKICAgICAgICAiYXV0by1yZXBlYXQiOiAicmVwZWF0KCBbYXV0by1maWxsfGF1dG8tZml0XSAsIFs8bGluZS1uYW1lcz4/IDxmaXhlZC1zaXplPl0rIDxsaW5lLW5hbWVzPj8gKSIsCiAgICAgICAgImF1dG8tdHJhY2stbGlzdCI6ICJbPGxpbmUtbmFtZXM+PyBbPGZpeGVkLXNpemU+fDxmaXhlZC1yZXBlYXQ+XV0qIDxsaW5lLW5hbWVzPj8gPGF1dG8tcmVwZWF0PiBbPGxpbmUtbmFtZXM+PyBbPGZpeGVkLXNpemU+fDxmaXhlZC1yZXBlYXQ+XV0qIDxsaW5lLW5hbWVzPj8iLAogICAgICAgICJheGlzIjogImJsb2NrfGlubGluZXx2ZXJ0aWNhbHxob3Jpem9udGFsIiwKICAgICAgICAiYmFzZWxpbmUtcG9zaXRpb24iOiAiW2ZpcnN0fGxhc3RdPyBiYXNlbGluZSIsCiAgICAgICAgImJhc2ljLXNoYXBlIjogIjxpbnNldCgpPnw8Y2lyY2xlKCk+fDxlbGxpcHNlKCk+fDxwb2x5Z29uKCk+fDxwYXRoKCk+IiwKICAgICAgICAiYmctaW1hZ2UiOiAibm9uZXw8aW1hZ2U+IiwKICAgICAgICAiYmctbGF5ZXIiOiAiPGJnLWltYWdlPnx8PGJnLXBvc2l0aW9uPiBbLyA8Ymctc2l6ZT5dP3x8PHJlcGVhdC1zdHlsZT58fDxhdHRhY2htZW50Pnx8PGJveD58fDxib3g+IiwKICAgICAgICAiYmctcG9zaXRpb24iOiAiW1tsZWZ0fGNlbnRlcnxyaWdodHx0b3B8Ym90dG9tfDxsZW5ndGgtcGVyY2VudGFnZT5dfFtsZWZ0fGNlbnRlcnxyaWdodHw8bGVuZ3RoLXBlcmNlbnRhZ2U+XSBbdG9wfGNlbnRlcnxib3R0b218PGxlbmd0aC1wZXJjZW50YWdlPl18W2NlbnRlcnxbbGVmdHxyaWdodF0gPGxlbmd0aC1wZXJjZW50YWdlPj9dJiZbY2VudGVyfFt0b3B8Ym90dG9tXSA8bGVuZ3RoLXBlcmNlbnRhZ2U+P11dIiwKICAgICAgICAiYmctc2l6ZSI6ICJbPGxlbmd0aC1wZXJjZW50YWdlPnxhdXRvXXsxLDJ9fGNvdmVyfGNvbnRhaW4iLAogICAgICAgICJibHVyKCkiOiAiYmx1ciggPGxlbmd0aD4gKSIsCiAgICAgICAgImJsZW5kLW1vZGUiOiAibm9ybWFsfG11bHRpcGx5fHNjcmVlbnxvdmVybGF5fGRhcmtlbnxsaWdodGVufGNvbG9yLWRvZGdlfGNvbG9yLWJ1cm58aGFyZC1saWdodHxzb2Z0LWxpZ2h0fGRpZmZlcmVuY2V8ZXhjbHVzaW9ufGh1ZXxzYXR1cmF0aW9ufGNvbG9yfGx1bWlub3NpdHkiLAogICAgICAgICJib3giOiAiYm9yZGVyLWJveHxwYWRkaW5nLWJveHxjb250ZW50LWJveCIsCiAgICAgICAgImJyaWdodG5lc3MoKSI6ICJicmlnaHRuZXNzKCA8bnVtYmVyLXBlcmNlbnRhZ2U+ICkiLAogICAgICAgICJjYWxjKCkiOiAiY2FsYyggPGNhbGMtc3VtPiApIiwKICAgICAgICAiY2FsYy1zdW0iOiAiPGNhbGMtcHJvZHVjdD4gW1snKyd8Jy0nXSA8Y2FsYy1wcm9kdWN0Pl0qIiwKICAgICAgICAiY2FsYy1wcm9kdWN0IjogIjxjYWxjLXZhbHVlPiBbJyonIDxjYWxjLXZhbHVlPnwnLycgPG51bWJlcj5dKiIsCiAgICAgICAgImNhbGMtdmFsdWUiOiAiPG51bWJlcj58PGRpbWVuc2lvbj58PHBlcmNlbnRhZ2U+fDxjYWxjLWNvbnN0YW50PnwoIDxjYWxjLXN1bT4gKSIsCiAgICAgICAgImNhbGMtY29uc3RhbnQiOiAiZXxwaXxpbmZpbml0eXwtaW5maW5pdHl8TmFOIiwKICAgICAgICAiY2YtZmluYWwtaW1hZ2UiOiAiPGltYWdlPnw8Y29sb3I+IiwKICAgICAgICAiY2YtbWl4aW5nLWltYWdlIjogIjxwZXJjZW50YWdlPj8mJjxpbWFnZT4iLAogICAgICAgICJjaXJjbGUoKSI6ICJjaXJjbGUoIFs8c2hhcGUtcmFkaXVzPl0/IFthdCA8cG9zaXRpb24+XT8gKSIsCiAgICAgICAgImNsYW1wKCkiOiAiY2xhbXAoIDxjYWxjLXN1bT4jezN9ICkiLAogICAgICAgICJjbGFzcy1zZWxlY3RvciI6ICInLicgPGlkZW50LXRva2VuPiIsCiAgICAgICAgImNsaXAtc291cmNlIjogIjx1cmw+IiwKICAgICAgICAiY29sb3IiOiAiPHJnYigpPnw8cmdiYSgpPnw8aHNsKCk+fDxoc2xhKCk+fDxod2IoKT58PGxhYigpPnw8bGNoKCk+fDxoZXgtY29sb3I+fDxuYW1lZC1jb2xvcj58Y3VycmVudGNvbG9yfDxkZXByZWNhdGVkLXN5c3RlbS1jb2xvcj4iLAogICAgICAgICJjb2xvci1zdG9wIjogIjxjb2xvci1zdG9wLWxlbmd0aD58PGNvbG9yLXN0b3AtYW5nbGU+IiwKICAgICAgICAiY29sb3Itc3RvcC1hbmdsZSI6ICI8YW5nbGUtcGVyY2VudGFnZT57MSwyfSIsCiAgICAgICAgImNvbG9yLXN0b3AtbGVuZ3RoIjogIjxsZW5ndGgtcGVyY2VudGFnZT57MSwyfSIsCiAgICAgICAgImNvbG9yLXN0b3AtbGlzdCI6ICJbPGxpbmVhci1jb2xvci1zdG9wPiBbLCA8bGluZWFyLWNvbG9yLWhpbnQ+XT9dIyAsIDxsaW5lYXItY29sb3Itc3RvcD4iLAogICAgICAgICJjb21iaW5hdG9yIjogIic+J3wnKyd8J34nfFsnfHwnXSIsCiAgICAgICAgImNvbW1vbi1saWctdmFsdWVzIjogIltjb21tb24tbGlnYXR1cmVzfG5vLWNvbW1vbi1saWdhdHVyZXNdIiwKICAgICAgICAiY29tcGF0LWF1dG8iOiAic2VhcmNoZmllbGR8dGV4dGFyZWF8cHVzaC1idXR0b258c2xpZGVyLWhvcml6b250YWx8Y2hlY2tib3h8cmFkaW98c3F1YXJlLWJ1dHRvbnxtZW51bGlzdHxsaXN0Ym94fG1ldGVyfHByb2dyZXNzLWJhcnxidXR0b24iLAogICAgICAgICJjb21wb3NpdGUtc3R5bGUiOiAiY2xlYXJ8Y29weXxzb3VyY2Utb3Zlcnxzb3VyY2UtaW58c291cmNlLW91dHxzb3VyY2UtYXRvcHxkZXN0aW5hdGlvbi1vdmVyfGRlc3RpbmF0aW9uLWlufGRlc3RpbmF0aW9uLW91dHxkZXN0aW5hdGlvbi1hdG9wfHhvciIsCiAgICAgICAgImNvbXBvc2l0aW5nLW9wZXJhdG9yIjogImFkZHxzdWJ0cmFjdHxpbnRlcnNlY3R8ZXhjbHVkZSIsCiAgICAgICAgImNvbXBvdW5kLXNlbGVjdG9yIjogIls8dHlwZS1zZWxlY3Rvcj4/IDxzdWJjbGFzcy1zZWxlY3Rvcj4qIFs8cHNldWRvLWVsZW1lbnQtc2VsZWN0b3I+IDxwc2V1ZG8tY2xhc3Mtc2VsZWN0b3I+Kl0qXSEiLAogICAgICAgICJjb21wb3VuZC1zZWxlY3Rvci1saXN0IjogIjxjb21wb3VuZC1zZWxlY3Rvcj4jIiwKICAgICAgICAiY29tcGxleC1zZWxlY3RvciI6ICI8Y29tcG91bmQtc2VsZWN0b3I+IFs8Y29tYmluYXRvcj4/IDxjb21wb3VuZC1zZWxlY3Rvcj5dKiIsCiAgICAgICAgImNvbXBsZXgtc2VsZWN0b3ItbGlzdCI6ICI8Y29tcGxleC1zZWxlY3Rvcj4jIiwKICAgICAgICAiY29uaWMtZ3JhZGllbnQoKSI6ICJjb25pYy1ncmFkaWVudCggW2Zyb20gPGFuZ2xlPl0/IFthdCA8cG9zaXRpb24+XT8gLCA8YW5ndWxhci1jb2xvci1zdG9wLWxpc3Q+ICkiLAogICAgICAgICJjb250ZXh0dWFsLWFsdC12YWx1ZXMiOiAiW2NvbnRleHR1YWx8bm8tY29udGV4dHVhbF0iLAogICAgICAgICJjb250ZW50LWRpc3RyaWJ1dGlvbiI6ICJzcGFjZS1iZXR3ZWVufHNwYWNlLWFyb3VuZHxzcGFjZS1ldmVubHl8c3RyZXRjaCIsCiAgICAgICAgImNvbnRlbnQtbGlzdCI6ICJbPHN0cmluZz58Y29udGVudHN8PGltYWdlPnw8Y291bnRlcj58PHF1b3RlPnw8dGFyZ2V0Pnw8bGVhZGVyKCk+fDxhdHRyKCk+XSsiLAogICAgICAgICJjb250ZW50LXBvc2l0aW9uIjogImNlbnRlcnxzdGFydHxlbmR8ZmxleC1zdGFydHxmbGV4LWVuZCIsCiAgICAgICAgImNvbnRlbnQtcmVwbGFjZW1lbnQiOiAiPGltYWdlPiIsCiAgICAgICAgImNvbnRyYXN0KCkiOiAiY29udHJhc3QoIFs8bnVtYmVyLXBlcmNlbnRhZ2U+XSApIiwKICAgICAgICAiY29zKCkiOiAiY29zKCA8Y2FsYy1zdW0+ICkiLAogICAgICAgICJjb3VudGVyIjogIjxjb3VudGVyKCk+fDxjb3VudGVycygpPiIsCiAgICAgICAgImNvdW50ZXIoKSI6ICJjb3VudGVyKCA8Y291bnRlci1uYW1lPiAsIDxjb3VudGVyLXN0eWxlPj8gKSIsCiAgICAgICAgImNvdW50ZXItbmFtZSI6ICI8Y3VzdG9tLWlkZW50PiIsCiAgICAgICAgImNvdW50ZXItc3R5bGUiOiAiPGNvdW50ZXItc3R5bGUtbmFtZT58c3ltYm9scyggKSIsCiAgICAgICAgImNvdW50ZXItc3R5bGUtbmFtZSI6ICI8Y3VzdG9tLWlkZW50PiIsCiAgICAgICAgImNvdW50ZXJzKCkiOiAiY291bnRlcnMoIDxjb3VudGVyLW5hbWU+ICwgPHN0cmluZz4gLCA8Y291bnRlci1zdHlsZT4/ICkiLAogICAgICAgICJjcm9zcy1mYWRlKCkiOiAiY3Jvc3MtZmFkZSggPGNmLW1peGluZy1pbWFnZT4gLCA8Y2YtZmluYWwtaW1hZ2U+PyApIiwKICAgICAgICAiY3ViaWMtYmV6aWVyLXRpbWluZy1mdW5jdGlvbiI6ICJlYXNlfGVhc2UtaW58ZWFzZS1vdXR8ZWFzZS1pbi1vdXR8Y3ViaWMtYmV6aWVyKCA8bnVtYmVyIFswLDFdPiAsIDxudW1iZXI+ICwgPG51bWJlciBbMCwxXT4gLCA8bnVtYmVyPiApIiwKICAgICAgICAiZGVwcmVjYXRlZC1zeXN0ZW0tY29sb3IiOiAiQWN0aXZlQm9yZGVyfEFjdGl2ZUNhcHRpb258QXBwV29ya3NwYWNlfEJhY2tncm91bmR8QnV0dG9uRmFjZXxCdXR0b25IaWdobGlnaHR8QnV0dG9uU2hhZG93fEJ1dHRvblRleHR8Q2FwdGlvblRleHR8R3JheVRleHR8SGlnaGxpZ2h0fEhpZ2hsaWdodFRleHR8SW5hY3RpdmVCb3JkZXJ8SW5hY3RpdmVDYXB0aW9ufEluYWN0aXZlQ2FwdGlvblRleHR8SW5mb0JhY2tncm91bmR8SW5mb1RleHR8TWVudXxNZW51VGV4dHxTY3JvbGxiYXJ8VGhyZWVERGFya1NoYWRvd3xUaHJlZURGYWNlfFRocmVlREhpZ2hsaWdodHxUaHJlZURMaWdodFNoYWRvd3xUaHJlZURTaGFkb3d8V2luZG93fFdpbmRvd0ZyYW1lfFdpbmRvd1RleHQiLAogICAgICAgICJkaXNjcmV0aW9uYXJ5LWxpZy12YWx1ZXMiOiAiW2Rpc2NyZXRpb25hcnktbGlnYXR1cmVzfG5vLWRpc2NyZXRpb25hcnktbGlnYXR1cmVzXSIsCiAgICAgICAgImRpc3BsYXktYm94IjogImNvbnRlbnRzfG5vbmUiLAogICAgICAgICJkaXNwbGF5LWluc2lkZSI6ICJmbG93fGZsb3ctcm9vdHx0YWJsZXxmbGV4fGdyaWR8cnVieSIsCiAgICAgICAgImRpc3BsYXktaW50ZXJuYWwiOiAidGFibGUtcm93LWdyb3VwfHRhYmxlLWhlYWRlci1ncm91cHx0YWJsZS1mb290ZXItZ3JvdXB8dGFibGUtcm93fHRhYmxlLWNlbGx8dGFibGUtY29sdW1uLWdyb3VwfHRhYmxlLWNvbHVtbnx0YWJsZS1jYXB0aW9ufHJ1YnktYmFzZXxydWJ5LXRleHR8cnVieS1iYXNlLWNvbnRhaW5lcnxydWJ5LXRleHQtY29udGFpbmVyIiwKICAgICAgICAiZGlzcGxheS1sZWdhY3kiOiAiaW5saW5lLWJsb2NrfGlubGluZS1saXN0LWl0ZW18aW5saW5lLXRhYmxlfGlubGluZS1mbGV4fGlubGluZS1ncmlkIiwKICAgICAgICAiZGlzcGxheS1saXN0aXRlbSI6ICI8ZGlzcGxheS1vdXRzaWRlPj8mJltmbG93fGZsb3ctcm9vdF0/JiZsaXN0LWl0ZW0iLAogICAgICAgICJkaXNwbGF5LW91dHNpZGUiOiAiYmxvY2t8aW5saW5lfHJ1bi1pbiIsCiAgICAgICAgImRyb3Atc2hhZG93KCkiOiAiZHJvcC1zaGFkb3coIDxsZW5ndGg+ezIsM30gPGNvbG9yPj8gKSIsCiAgICAgICAgImVhc3QtYXNpYW4tdmFyaWFudC12YWx1ZXMiOiAiW2ppczc4fGppczgzfGppczkwfGppczA0fHNpbXBsaWZpZWR8dHJhZGl0aW9uYWxdIiwKICAgICAgICAiZWFzdC1hc2lhbi13aWR0aC12YWx1ZXMiOiAiW2Z1bGwtd2lkdGh8cHJvcG9ydGlvbmFsLXdpZHRoXSIsCiAgICAgICAgImVsZW1lbnQoKSI6ICJlbGVtZW50KCA8Y3VzdG9tLWlkZW50PiAsIFtmaXJzdHxzdGFydHxsYXN0fGZpcnN0LWV4Y2VwdF0/ICl8ZWxlbWVudCggPGlkLXNlbGVjdG9yPiApIiwKICAgICAgICAiZWxsaXBzZSgpIjogImVsbGlwc2UoIFs8c2hhcGUtcmFkaXVzPnsyfV0/IFthdCA8cG9zaXRpb24+XT8gKSIsCiAgICAgICAgImVuZGluZy1zaGFwZSI6ICJjaXJjbGV8ZWxsaXBzZSIsCiAgICAgICAgImVudigpIjogImVudiggPGN1c3RvbS1pZGVudD4gLCA8ZGVjbGFyYXRpb24tdmFsdWU+PyApIiwKICAgICAgICAiZXhwKCkiOiAiZXhwKCA8Y2FsYy1zdW0+ICkiLAogICAgICAgICJleHBsaWNpdC10cmFjay1saXN0IjogIls8bGluZS1uYW1lcz4/IDx0cmFjay1zaXplPl0rIDxsaW5lLW5hbWVzPj8iLAogICAgICAgICJmYW1pbHktbmFtZSI6ICI8c3RyaW5nPnw8Y3VzdG9tLWlkZW50PisiLAogICAgICAgICJmZWF0dXJlLXRhZy12YWx1ZSI6ICI8c3RyaW5nPiBbPGludGVnZXI+fG9ufG9mZl0/IiwKICAgICAgICAiZmVhdHVyZS10eXBlIjogIkBzdHlsaXN0aWN8QGhpc3RvcmljYWwtZm9ybXN8QHN0eWxlc2V0fEBjaGFyYWN0ZXItdmFyaWFudHxAc3dhc2h8QG9ybmFtZW50c3xAYW5ub3RhdGlvbiIsCiAgICAgICAgImZlYXR1cmUtdmFsdWUtYmxvY2siOiAiPGZlYXR1cmUtdHlwZT4gJ3snIDxmZWF0dXJlLXZhbHVlLWRlY2xhcmF0aW9uLWxpc3Q+ICd9JyIsCiAgICAgICAgImZlYXR1cmUtdmFsdWUtYmxvY2stbGlzdCI6ICI8ZmVhdHVyZS12YWx1ZS1ibG9jaz4rIiwKICAgICAgICAiZmVhdHVyZS12YWx1ZS1kZWNsYXJhdGlvbiI6ICI8Y3VzdG9tLWlkZW50PiA6IDxpbnRlZ2VyPisgOyIsCiAgICAgICAgImZlYXR1cmUtdmFsdWUtZGVjbGFyYXRpb24tbGlzdCI6ICI8ZmVhdHVyZS12YWx1ZS1kZWNsYXJhdGlvbj4iLAogICAgICAgICJmZWF0dXJlLXZhbHVlLW5hbWUiOiAiPGN1c3RvbS1pZGVudD4iLAogICAgICAgICJmaWxsLXJ1bGUiOiAibm9uemVyb3xldmVub2RkIiwKICAgICAgICAiZmlsdGVyLWZ1bmN0aW9uIjogIjxibHVyKCk+fDxicmlnaHRuZXNzKCk+fDxjb250cmFzdCgpPnw8ZHJvcC1zaGFkb3coKT58PGdyYXlzY2FsZSgpPnw8aHVlLXJvdGF0ZSgpPnw8aW52ZXJ0KCk+fDxvcGFjaXR5KCk+fDxzYXR1cmF0ZSgpPnw8c2VwaWEoKT4iLAogICAgICAgICJmaWx0ZXItZnVuY3Rpb24tbGlzdCI6ICJbPGZpbHRlci1mdW5jdGlvbj58PHVybD5dKyIsCiAgICAgICAgImZpbmFsLWJnLWxheWVyIjogIjwnYmFja2dyb3VuZC1jb2xvcic+fHw8YmctaW1hZ2U+fHw8YmctcG9zaXRpb24+IFsvIDxiZy1zaXplPl0/fHw8cmVwZWF0LXN0eWxlPnx8PGF0dGFjaG1lbnQ+fHw8Ym94Pnx8PGJveD4iLAogICAgICAgICJmaXhlZC1icmVhZHRoIjogIjxsZW5ndGgtcGVyY2VudGFnZT4iLAogICAgICAgICJmaXhlZC1yZXBlYXQiOiAicmVwZWF0KCBbPGludGVnZXIgWzEs4oieXT5dICwgWzxsaW5lLW5hbWVzPj8gPGZpeGVkLXNpemU+XSsgPGxpbmUtbmFtZXM+PyApIiwKICAgICAgICAiZml4ZWQtc2l6ZSI6ICI8Zml4ZWQtYnJlYWR0aD58bWlubWF4KCA8Zml4ZWQtYnJlYWR0aD4gLCA8dHJhY2stYnJlYWR0aD4gKXxtaW5tYXgoIDxpbmZsZXhpYmxlLWJyZWFkdGg+ICwgPGZpeGVkLWJyZWFkdGg+ICkiLAogICAgICAgICJmb250LXN0cmV0Y2gtYWJzb2x1dGUiOiAibm9ybWFsfHVsdHJhLWNvbmRlbnNlZHxleHRyYS1jb25kZW5zZWR8Y29uZGVuc2VkfHNlbWktY29uZGVuc2VkfHNlbWktZXhwYW5kZWR8ZXhwYW5kZWR8ZXh0cmEtZXhwYW5kZWR8dWx0cmEtZXhwYW5kZWR8PHBlcmNlbnRhZ2U+IiwKICAgICAgICAiZm9udC12YXJpYW50LWNzczIxIjogIltub3JtYWx8c21hbGwtY2Fwc10iLAogICAgICAgICJmb250LXdlaWdodC1hYnNvbHV0ZSI6ICJub3JtYWx8Ym9sZHw8bnVtYmVyIFsxLDEwMDBdPiIsCiAgICAgICAgImZyZXF1ZW5jeS1wZXJjZW50YWdlIjogIjxmcmVxdWVuY3k+fDxwZXJjZW50YWdlPiIsCiAgICAgICAgImdlbmVyYWwtZW5jbG9zZWQiOiAiWzxmdW5jdGlvbi10b2tlbj4gPGFueS12YWx1ZT4gKV18KCA8aWRlbnQ+IDxhbnktdmFsdWU+ICkiLAogICAgICAgICJnZW5lcmljLWZhbWlseSI6ICJzZXJpZnxzYW5zLXNlcmlmfGN1cnNpdmV8ZmFudGFzeXxtb25vc3BhY2V8LWFwcGxlLXN5c3RlbSIsCiAgICAgICAgImdlbmVyaWMtbmFtZSI6ICJzZXJpZnxzYW5zLXNlcmlmfGN1cnNpdmV8ZmFudGFzeXxtb25vc3BhY2UiLAogICAgICAgICJnZW9tZXRyeS1ib3giOiAiPHNoYXBlLWJveD58ZmlsbC1ib3h8c3Ryb2tlLWJveHx2aWV3LWJveCIsCiAgICAgICAgImdyYWRpZW50IjogIjxsaW5lYXItZ3JhZGllbnQoKT58PHJlcGVhdGluZy1saW5lYXItZ3JhZGllbnQoKT58PHJhZGlhbC1ncmFkaWVudCgpPnw8cmVwZWF0aW5nLXJhZGlhbC1ncmFkaWVudCgpPnw8Y29uaWMtZ3JhZGllbnQoKT58PHJlcGVhdGluZy1jb25pYy1ncmFkaWVudCgpPnw8LWxlZ2FjeS1ncmFkaWVudD4iLAogICAgICAgICJncmF5c2NhbGUoKSI6ICJncmF5c2NhbGUoIDxudW1iZXItcGVyY2VudGFnZT4gKSIsCiAgICAgICAgImdyaWQtbGluZSI6ICJhdXRvfDxjdXN0b20taWRlbnQ+fFs8aW50ZWdlcj4mJjxjdXN0b20taWRlbnQ+P118W3NwYW4mJls8aW50ZWdlcj58fDxjdXN0b20taWRlbnQ+XV0iLAogICAgICAgICJoaXN0b3JpY2FsLWxpZy12YWx1ZXMiOiAiW2hpc3RvcmljYWwtbGlnYXR1cmVzfG5vLWhpc3RvcmljYWwtbGlnYXR1cmVzXSIsCiAgICAgICAgImhzbCgpIjogImhzbCggPGh1ZT4gPHBlcmNlbnRhZ2U+IDxwZXJjZW50YWdlPiBbLyA8YWxwaGEtdmFsdWU+XT8gKXxoc2woIDxodWU+ICwgPHBlcmNlbnRhZ2U+ICwgPHBlcmNlbnRhZ2U+ICwgPGFscGhhLXZhbHVlPj8gKSIsCiAgICAgICAgImhzbGEoKSI6ICJoc2xhKCA8aHVlPiA8cGVyY2VudGFnZT4gPHBlcmNlbnRhZ2U+IFsvIDxhbHBoYS12YWx1ZT5dPyApfGhzbGEoIDxodWU+ICwgPHBlcmNlbnRhZ2U+ICwgPHBlcmNlbnRhZ2U+ICwgPGFscGhhLXZhbHVlPj8gKSIsCiAgICAgICAgImh1ZSI6ICI8bnVtYmVyPnw8YW5nbGU+IiwKICAgICAgICAiaHVlLXJvdGF0ZSgpIjogImh1ZS1yb3RhdGUoIDxhbmdsZT4gKSIsCiAgICAgICAgImh3YigpIjogImh3YiggWzxodWU+fG5vbmVdIFs8cGVyY2VudGFnZT58bm9uZV0gWzxwZXJjZW50YWdlPnxub25lXSBbLyBbPGFscGhhLXZhbHVlPnxub25lXV0/ICkiLAogICAgICAgICJoeXBvdCgpIjogImh5cG90KCA8Y2FsYy1zdW0+IyApIiwKICAgICAgICAiaW1hZ2UiOiAiPHVybD58PGltYWdlKCk+fDxpbWFnZS1zZXQoKT58PGVsZW1lbnQoKT58PHBhaW50KCk+fDxjcm9zcy1mYWRlKCk+fDxncmFkaWVudD4iLAogICAgICAgICJpbWFnZSgpIjogImltYWdlKCA8aW1hZ2UtdGFncz4/IFs8aW1hZ2Utc3JjPj8gLCA8Y29sb3I+P10hICkiLAogICAgICAgICJpbWFnZS1zZXQoKSI6ICJpbWFnZS1zZXQoIDxpbWFnZS1zZXQtb3B0aW9uPiMgKSIsCiAgICAgICAgImltYWdlLXNldC1vcHRpb24iOiAiWzxpbWFnZT58PHN0cmluZz5dIFs8cmVzb2x1dGlvbj58fHR5cGUoIDxzdHJpbmc+ICldIiwKICAgICAgICAiaW1hZ2Utc3JjIjogIjx1cmw+fDxzdHJpbmc+IiwKICAgICAgICAiaW1hZ2UtdGFncyI6ICJsdHJ8cnRsIiwKICAgICAgICAiaW5mbGV4aWJsZS1icmVhZHRoIjogIjxsZW5ndGgtcGVyY2VudGFnZT58bWluLWNvbnRlbnR8bWF4LWNvbnRlbnR8YXV0byIsCiAgICAgICAgImluc2V0KCkiOiAiaW5zZXQoIDxsZW5ndGgtcGVyY2VudGFnZT57MSw0fSBbcm91bmQgPCdib3JkZXItcmFkaXVzJz5dPyApIiwKICAgICAgICAiaW52ZXJ0KCkiOiAiaW52ZXJ0KCA8bnVtYmVyLXBlcmNlbnRhZ2U+ICkiLAogICAgICAgICJrZXlmcmFtZXMtbmFtZSI6ICI8Y3VzdG9tLWlkZW50Pnw8c3RyaW5nPiIsCiAgICAgICAgImtleWZyYW1lLWJsb2NrIjogIjxrZXlmcmFtZS1zZWxlY3Rvcj4jIHsgPGRlY2xhcmF0aW9uLWxpc3Q+IH0iLAogICAgICAgICJrZXlmcmFtZS1ibG9jay1saXN0IjogIjxrZXlmcmFtZS1ibG9jaz4rIiwKICAgICAgICAia2V5ZnJhbWUtc2VsZWN0b3IiOiAiZnJvbXx0b3w8cGVyY2VudGFnZT4iLAogICAgICAgICJsYWIoKSI6ICJsYWIoIFs8cGVyY2VudGFnZT58PG51bWJlcj58bm9uZV0gWzxwZXJjZW50YWdlPnw8bnVtYmVyPnxub25lXSBbPHBlcmNlbnRhZ2U+fDxudW1iZXI+fG5vbmVdIFsvIFs8YWxwaGEtdmFsdWU+fG5vbmVdXT8gKSIsCiAgICAgICAgImxheWVyKCkiOiAibGF5ZXIoIDxsYXllci1uYW1lPiApIiwKICAgICAgICAibGF5ZXItbmFtZSI6ICI8aWRlbnQ+IFsnLicgPGlkZW50Pl0qIiwKICAgICAgICAibGNoKCkiOiAibGNoKCBbPHBlcmNlbnRhZ2U+fDxudW1iZXI+fG5vbmVdIFs8cGVyY2VudGFnZT58PG51bWJlcj58bm9uZV0gWzxodWU+fG5vbmVdIFsvIFs8YWxwaGEtdmFsdWU+fG5vbmVdXT8gKSIsCiAgICAgICAgImxlYWRlcigpIjogImxlYWRlciggPGxlYWRlci10eXBlPiApIiwKICAgICAgICAibGVhZGVyLXR5cGUiOiAiZG90dGVkfHNvbGlkfHNwYWNlfDxzdHJpbmc+IiwKICAgICAgICAibGVuZ3RoLXBlcmNlbnRhZ2UiOiAiPGxlbmd0aD58PHBlcmNlbnRhZ2U+IiwKICAgICAgICAibGluZS1uYW1lcyI6ICInWycgPGN1c3RvbS1pZGVudD4qICddJyIsCiAgICAgICAgImxpbmUtbmFtZS1saXN0IjogIls8bGluZS1uYW1lcz58PG5hbWUtcmVwZWF0Pl0rIiwKICAgICAgICAibGluZS1zdHlsZSI6ICJub25lfGhpZGRlbnxkb3R0ZWR8ZGFzaGVkfHNvbGlkfGRvdWJsZXxncm9vdmV8cmlkZ2V8aW5zZXR8b3V0c2V0IiwKICAgICAgICAibGluZS13aWR0aCI6ICI8bGVuZ3RoPnx0aGlufG1lZGl1bXx0aGljayIsCiAgICAgICAgImxpbmVhci1jb2xvci1oaW50IjogIjxsZW5ndGgtcGVyY2VudGFnZT4iLAogICAgICAgICJsaW5lYXItY29sb3Itc3RvcCI6ICI8Y29sb3I+IDxjb2xvci1zdG9wLWxlbmd0aD4/IiwKICAgICAgICAibGluZWFyLWdyYWRpZW50KCkiOiAibGluZWFyLWdyYWRpZW50KCBbPGFuZ2xlPnx0byA8c2lkZS1vci1jb3JuZXI+XT8gLCA8Y29sb3Itc3RvcC1saXN0PiApIiwKICAgICAgICAibG9nKCkiOiAibG9nKCA8Y2FsYy1zdW0+ICwgPGNhbGMtc3VtPj8gKSIsCiAgICAgICAgIm1hc2stbGF5ZXIiOiAiPG1hc2stcmVmZXJlbmNlPnx8PHBvc2l0aW9uPiBbLyA8Ymctc2l6ZT5dP3x8PHJlcGVhdC1zdHlsZT58fDxnZW9tZXRyeS1ib3g+fHxbPGdlb21ldHJ5LWJveD58bm8tY2xpcF18fDxjb21wb3NpdGluZy1vcGVyYXRvcj58fDxtYXNraW5nLW1vZGU+IiwKICAgICAgICAibWFzay1wb3NpdGlvbiI6ICJbPGxlbmd0aC1wZXJjZW50YWdlPnxsZWZ0fGNlbnRlcnxyaWdodF0gWzxsZW5ndGgtcGVyY2VudGFnZT58dG9wfGNlbnRlcnxib3R0b21dPyIsCiAgICAgICAgIm1hc2stcmVmZXJlbmNlIjogIm5vbmV8PGltYWdlPnw8bWFzay1zb3VyY2U+IiwKICAgICAgICAibWFzay1zb3VyY2UiOiAiPHVybD4iLAogICAgICAgICJtYXNraW5nLW1vZGUiOiAiYWxwaGF8bHVtaW5hbmNlfG1hdGNoLXNvdXJjZSIsCiAgICAgICAgIm1hdHJpeCgpIjogIm1hdHJpeCggPG51bWJlcj4jezZ9ICkiLAogICAgICAgICJtYXRyaXgzZCgpIjogIm1hdHJpeDNkKCA8bnVtYmVyPiN7MTZ9ICkiLAogICAgICAgICJtYXgoKSI6ICJtYXgoIDxjYWxjLXN1bT4jICkiLAogICAgICAgICJtZWRpYS1hbmQiOiAiPG1lZGlhLWluLXBhcmVucz4gW2FuZCA8bWVkaWEtaW4tcGFyZW5zPl0rIiwKICAgICAgICAibWVkaWEtY29uZGl0aW9uIjogIjxtZWRpYS1ub3Q+fDxtZWRpYS1hbmQ+fDxtZWRpYS1vcj58PG1lZGlhLWluLXBhcmVucz4iLAogICAgICAgICJtZWRpYS1jb25kaXRpb24td2l0aG91dC1vciI6ICI8bWVkaWEtbm90Pnw8bWVkaWEtYW5kPnw8bWVkaWEtaW4tcGFyZW5zPiIsCiAgICAgICAgIm1lZGlhLWZlYXR1cmUiOiAiKCBbPG1mLXBsYWluPnw8bWYtYm9vbGVhbj58PG1mLXJhbmdlPl0gKSIsCiAgICAgICAgIm1lZGlhLWluLXBhcmVucyI6ICIoIDxtZWRpYS1jb25kaXRpb24+ICl8PG1lZGlhLWZlYXR1cmU+fDxnZW5lcmFsLWVuY2xvc2VkPiIsCiAgICAgICAgIm1lZGlhLW5vdCI6ICJub3QgPG1lZGlhLWluLXBhcmVucz4iLAogICAgICAgICJtZWRpYS1vciI6ICI8bWVkaWEtaW4tcGFyZW5zPiBbb3IgPG1lZGlhLWluLXBhcmVucz5dKyIsCiAgICAgICAgIm1lZGlhLXF1ZXJ5IjogIjxtZWRpYS1jb25kaXRpb24+fFtub3R8b25seV0/IDxtZWRpYS10eXBlPiBbYW5kIDxtZWRpYS1jb25kaXRpb24td2l0aG91dC1vcj5dPyIsCiAgICAgICAgIm1lZGlhLXF1ZXJ5LWxpc3QiOiAiPG1lZGlhLXF1ZXJ5PiMiLAogICAgICAgICJtZWRpYS10eXBlIjogIjxpZGVudD4iLAogICAgICAgICJtZi1ib29sZWFuIjogIjxtZi1uYW1lPiIsCiAgICAgICAgIm1mLW5hbWUiOiAiPGlkZW50PiIsCiAgICAgICAgIm1mLXBsYWluIjogIjxtZi1uYW1lPiA6IDxtZi12YWx1ZT4iLAogICAgICAgICJtZi1yYW5nZSI6ICI8bWYtbmFtZT4gWyc8J3wnPiddPyAnPSc/IDxtZi12YWx1ZT58PG1mLXZhbHVlPiBbJzwnfCc+J10/ICc9Jz8gPG1mLW5hbWU+fDxtZi12YWx1ZT4gJzwnICc9Jz8gPG1mLW5hbWU+ICc8JyAnPSc/IDxtZi12YWx1ZT58PG1mLXZhbHVlPiAnPicgJz0nPyA8bWYtbmFtZT4gJz4nICc9Jz8gPG1mLXZhbHVlPiIsCiAgICAgICAgIm1mLXZhbHVlIjogIjxudW1iZXI+fDxkaW1lbnNpb24+fDxpZGVudD58PHJhdGlvPiIsCiAgICAgICAgIm1pbigpIjogIm1pbiggPGNhbGMtc3VtPiMgKSIsCiAgICAgICAgIm1pbm1heCgpIjogIm1pbm1heCggWzxsZW5ndGgtcGVyY2VudGFnZT58bWluLWNvbnRlbnR8bWF4LWNvbnRlbnR8YXV0b10gLCBbPGxlbmd0aC1wZXJjZW50YWdlPnw8ZmxleD58bWluLWNvbnRlbnR8bWF4LWNvbnRlbnR8YXV0b10gKSIsCiAgICAgICAgIm1vZCgpIjogIm1vZCggPGNhbGMtc3VtPiAsIDxjYWxjLXN1bT4gKSIsCiAgICAgICAgIm5hbWUtcmVwZWF0IjogInJlcGVhdCggWzxpbnRlZ2VyIFsxLOKInl0+fGF1dG8tZmlsbF0gLCA8bGluZS1uYW1lcz4rICkiLAogICAgICAgICJuYW1lZC1jb2xvciI6ICJ0cmFuc3BhcmVudHxhbGljZWJsdWV8YW50aXF1ZXdoaXRlfGFxdWF8YXF1YW1hcmluZXxhenVyZXxiZWlnZXxiaXNxdWV8YmxhY2t8YmxhbmNoZWRhbG1vbmR8Ymx1ZXxibHVldmlvbGV0fGJyb3dufGJ1cmx5d29vZHxjYWRldGJsdWV8Y2hhcnRyZXVzZXxjaG9jb2xhdGV8Y29yYWx8Y29ybmZsb3dlcmJsdWV8Y29ybnNpbGt8Y3JpbXNvbnxjeWFufGRhcmtibHVlfGRhcmtjeWFufGRhcmtnb2xkZW5yb2R8ZGFya2dyYXl8ZGFya2dyZWVufGRhcmtncmV5fGRhcmtraGFraXxkYXJrbWFnZW50YXxkYXJrb2xpdmVncmVlbnxkYXJrb3JhbmdlfGRhcmtvcmNoaWR8ZGFya3JlZHxkYXJrc2FsbW9ufGRhcmtzZWFncmVlbnxkYXJrc2xhdGVibHVlfGRhcmtzbGF0ZWdyYXl8ZGFya3NsYXRlZ3JleXxkYXJrdHVycXVvaXNlfGRhcmt2aW9sZXR8ZGVlcHBpbmt8ZGVlcHNreWJsdWV8ZGltZ3JheXxkaW1ncmV5fGRvZGdlcmJsdWV8ZmlyZWJyaWNrfGZsb3JhbHdoaXRlfGZvcmVzdGdyZWVufGZ1Y2hzaWF8Z2FpbnNib3JvfGdob3N0d2hpdGV8Z29sZHxnb2xkZW5yb2R8Z3JheXxncmVlbnxncmVlbnllbGxvd3xncmV5fGhvbmV5ZGV3fGhvdHBpbmt8aW5kaWFucmVkfGluZGlnb3xpdm9yeXxraGFraXxsYXZlbmRlcnxsYXZlbmRlcmJsdXNofGxhd25ncmVlbnxsZW1vbmNoaWZmb258bGlnaHRibHVlfGxpZ2h0Y29yYWx8bGlnaHRjeWFufGxpZ2h0Z29sZGVucm9keWVsbG93fGxpZ2h0Z3JheXxsaWdodGdyZWVufGxpZ2h0Z3JleXxsaWdodHBpbmt8bGlnaHRzYWxtb258bGlnaHRzZWFncmVlbnxsaWdodHNreWJsdWV8bGlnaHRzbGF0ZWdyYXl8bGlnaHRzbGF0ZWdyZXl8bGlnaHRzdGVlbGJsdWV8bGlnaHR5ZWxsb3d8bGltZXxsaW1lZ3JlZW58bGluZW58bWFnZW50YXxtYXJvb258bWVkaXVtYXF1YW1hcmluZXxtZWRpdW1ibHVlfG1lZGl1bW9yY2hpZHxtZWRpdW1wdXJwbGV8bWVkaXVtc2VhZ3JlZW58bWVkaXVtc2xhdGVibHVlfG1lZGl1bXNwcmluZ2dyZWVufG1lZGl1bXR1cnF1b2lzZXxtZWRpdW12aW9sZXRyZWR8bWlkbmlnaHRibHVlfG1pbnRjcmVhbXxtaXN0eXJvc2V8bW9jY2FzaW58bmF2YWpvd2hpdGV8bmF2eXxvbGRsYWNlfG9saXZlfG9saXZlZHJhYnxvcmFuZ2V8b3JhbmdlcmVkfG9yY2hpZHxwYWxlZ29sZGVucm9kfHBhbGVncmVlbnxwYWxldHVycXVvaXNlfHBhbGV2aW9sZXRyZWR8cGFwYXlhd2hpcHxwZWFjaHB1ZmZ8cGVydXxwaW5rfHBsdW18cG93ZGVyYmx1ZXxwdXJwbGV8cmViZWNjYXB1cnBsZXxyZWR8cm9zeWJyb3dufHJveWFsYmx1ZXxzYWRkbGVicm93bnxzYWxtb258c2FuZHlicm93bnxzZWFncmVlbnxzZWFzaGVsbHxzaWVubmF8c2lsdmVyfHNreWJsdWV8c2xhdGVibHVlfHNsYXRlZ3JheXxzbGF0ZWdyZXl8c25vd3xzcHJpbmdncmVlbnxzdGVlbGJsdWV8dGFufHRlYWx8dGhpc3RsZXx0b21hdG98dHVycXVvaXNlfHZpb2xldHx3aGVhdHx3aGl0ZXx3aGl0ZXNtb2tlfHllbGxvd3x5ZWxsb3dncmVlbnw8LW5vbi1zdGFuZGFyZC1jb2xvcj4iLAogICAgICAgICJuYW1lc3BhY2UtcHJlZml4IjogIjxpZGVudD4iLAogICAgICAgICJucy1wcmVmaXgiOiAiWzxpZGVudC10b2tlbj58JyonXT8gJ3wnIiwKICAgICAgICAibnVtYmVyLXBlcmNlbnRhZ2UiOiAiPG51bWJlcj58PHBlcmNlbnRhZ2U+IiwKICAgICAgICAibnVtZXJpYy1maWd1cmUtdmFsdWVzIjogIltsaW5pbmctbnVtc3xvbGRzdHlsZS1udW1zXSIsCiAgICAgICAgIm51bWVyaWMtZnJhY3Rpb24tdmFsdWVzIjogIltkaWFnb25hbC1mcmFjdGlvbnN8c3RhY2tlZC1mcmFjdGlvbnNdIiwKICAgICAgICAibnVtZXJpYy1zcGFjaW5nLXZhbHVlcyI6ICJbcHJvcG9ydGlvbmFsLW51bXN8dGFidWxhci1udW1zXSIsCiAgICAgICAgIm50aCI6ICI8YW4tcGx1cy1iPnxldmVufG9kZCIsCiAgICAgICAgIm9wYWNpdHkoKSI6ICJvcGFjaXR5KCBbPG51bWJlci1wZXJjZW50YWdlPl0gKSIsCiAgICAgICAgIm92ZXJmbG93LXBvc2l0aW9uIjogInVuc2FmZXxzYWZlIiwKICAgICAgICAib3V0bGluZS1yYWRpdXMiOiAiPGxlbmd0aD58PHBlcmNlbnRhZ2U+IiwKICAgICAgICAicGFnZS1ib2R5IjogIjxkZWNsYXJhdGlvbj4/IFs7IDxwYWdlLWJvZHk+XT98PHBhZ2UtbWFyZ2luLWJveD4gPHBhZ2UtYm9keT4iLAogICAgICAgICJwYWdlLW1hcmdpbi1ib3giOiAiPHBhZ2UtbWFyZ2luLWJveC10eXBlPiAneycgPGRlY2xhcmF0aW9uLWxpc3Q+ICd9JyIsCiAgICAgICAgInBhZ2UtbWFyZ2luLWJveC10eXBlIjogIkB0b3AtbGVmdC1jb3JuZXJ8QHRvcC1sZWZ0fEB0b3AtY2VudGVyfEB0b3AtcmlnaHR8QHRvcC1yaWdodC1jb3JuZXJ8QGJvdHRvbS1sZWZ0LWNvcm5lcnxAYm90dG9tLWxlZnR8QGJvdHRvbS1jZW50ZXJ8QGJvdHRvbS1yaWdodHxAYm90dG9tLXJpZ2h0LWNvcm5lcnxAbGVmdC10b3B8QGxlZnQtbWlkZGxlfEBsZWZ0LWJvdHRvbXxAcmlnaHQtdG9wfEByaWdodC1taWRkbGV8QHJpZ2h0LWJvdHRvbSIsCiAgICAgICAgInBhZ2Utc2VsZWN0b3ItbGlzdCI6ICJbPHBhZ2Utc2VsZWN0b3I+I10/IiwKICAgICAgICAicGFnZS1zZWxlY3RvciI6ICI8cHNldWRvLXBhZ2U+K3w8aWRlbnQ+IDxwc2V1ZG8tcGFnZT4qIiwKICAgICAgICAicGFnZS1zaXplIjogIkE1fEE0fEEzfEI1fEI0fEpJUy1CNXxKSVMtQjR8bGV0dGVyfGxlZ2FsfGxlZGdlciIsCiAgICAgICAgInBhdGgoKSI6ICJwYXRoKCBbPGZpbGwtcnVsZT4gLF0/IDxzdHJpbmc+ICkiLAogICAgICAgICJwYWludCgpIjogInBhaW50KCA8aWRlbnQ+ICwgPGRlY2xhcmF0aW9uLXZhbHVlPj8gKSIsCiAgICAgICAgInBlcnNwZWN0aXZlKCkiOiAicGVyc3BlY3RpdmUoIFs8bGVuZ3RoIFswLOKInl0+fG5vbmVdICkiLAogICAgICAgICJwb2x5Z29uKCkiOiAicG9seWdvbiggPGZpbGwtcnVsZT4/ICwgWzxsZW5ndGgtcGVyY2VudGFnZT4gPGxlbmd0aC1wZXJjZW50YWdlPl0jICkiLAogICAgICAgICJwb3NpdGlvbiI6ICJbW2xlZnR8Y2VudGVyfHJpZ2h0XXx8W3RvcHxjZW50ZXJ8Ym90dG9tXXxbbGVmdHxjZW50ZXJ8cmlnaHR8PGxlbmd0aC1wZXJjZW50YWdlPl0gW3RvcHxjZW50ZXJ8Ym90dG9tfDxsZW5ndGgtcGVyY2VudGFnZT5dP3xbW2xlZnR8cmlnaHRdIDxsZW5ndGgtcGVyY2VudGFnZT5dJiZbW3RvcHxib3R0b21dIDxsZW5ndGgtcGVyY2VudGFnZT5dXSIsCiAgICAgICAgInBvdygpIjogInBvdyggPGNhbGMtc3VtPiAsIDxjYWxjLXN1bT4gKSIsCiAgICAgICAgInBzZXVkby1jbGFzcy1zZWxlY3RvciI6ICInOicgPGlkZW50LXRva2VuPnwnOicgPGZ1bmN0aW9uLXRva2VuPiA8YW55LXZhbHVlPiAnKSciLAogICAgICAgICJwc2V1ZG8tZWxlbWVudC1zZWxlY3RvciI6ICInOicgPHBzZXVkby1jbGFzcy1zZWxlY3Rvcj4iLAogICAgICAgICJwc2V1ZG8tcGFnZSI6ICI6IFtsZWZ0fHJpZ2h0fGZpcnN0fGJsYW5rXSIsCiAgICAgICAgInF1b3RlIjogIm9wZW4tcXVvdGV8Y2xvc2UtcXVvdGV8bm8tb3Blbi1xdW90ZXxuby1jbG9zZS1xdW90ZSIsCiAgICAgICAgInJhZGlhbC1ncmFkaWVudCgpIjogInJhZGlhbC1ncmFkaWVudCggWzxlbmRpbmctc2hhcGU+fHw8c2l6ZT5dPyBbYXQgPHBvc2l0aW9uPl0/ICwgPGNvbG9yLXN0b3AtbGlzdD4gKSIsCiAgICAgICAgInJhdGlvIjogIjxudW1iZXIgWzAs4oieXT4gWy8gPG51bWJlciBbMCziiJ5dPl0/IiwKICAgICAgICAicmVsYXRpdmUtc2VsZWN0b3IiOiAiPGNvbWJpbmF0b3I+PyA8Y29tcGxleC1zZWxlY3Rvcj4iLAogICAgICAgICJyZWxhdGl2ZS1zZWxlY3Rvci1saXN0IjogIjxyZWxhdGl2ZS1zZWxlY3Rvcj4jIiwKICAgICAgICAicmVsYXRpdmUtc2l6ZSI6ICJsYXJnZXJ8c21hbGxlciIsCiAgICAgICAgInJlbSgpIjogInJlbSggPGNhbGMtc3VtPiAsIDxjYWxjLXN1bT4gKSIsCiAgICAgICAgInJlcGVhdC1zdHlsZSI6ICJyZXBlYXQteHxyZXBlYXQteXxbcmVwZWF0fHNwYWNlfHJvdW5kfG5vLXJlcGVhdF17MSwyfSIsCiAgICAgICAgInJlcGVhdGluZy1jb25pYy1ncmFkaWVudCgpIjogInJlcGVhdGluZy1jb25pYy1ncmFkaWVudCggW2Zyb20gPGFuZ2xlPl0/IFthdCA8cG9zaXRpb24+XT8gLCA8YW5ndWxhci1jb2xvci1zdG9wLWxpc3Q+ICkiLAogICAgICAgICJyZXBlYXRpbmctbGluZWFyLWdyYWRpZW50KCkiOiAicmVwZWF0aW5nLWxpbmVhci1ncmFkaWVudCggWzxhbmdsZT58dG8gPHNpZGUtb3ItY29ybmVyPl0/ICwgPGNvbG9yLXN0b3AtbGlzdD4gKSIsCiAgICAgICAgInJlcGVhdGluZy1yYWRpYWwtZ3JhZGllbnQoKSI6ICJyZXBlYXRpbmctcmFkaWFsLWdyYWRpZW50KCBbPGVuZGluZy1zaGFwZT58fDxzaXplPl0/IFthdCA8cG9zaXRpb24+XT8gLCA8Y29sb3Itc3RvcC1saXN0PiApIiwKICAgICAgICAicmV2ZXJzZWQtY291bnRlci1uYW1lIjogInJldmVyc2VkKCA8Y291bnRlci1uYW1lPiApIiwKICAgICAgICAicmdiKCkiOiAicmdiKCA8cGVyY2VudGFnZT57M30gWy8gPGFscGhhLXZhbHVlPl0/ICl8cmdiKCA8bnVtYmVyPnszfSBbLyA8YWxwaGEtdmFsdWU+XT8gKXxyZ2IoIDxwZXJjZW50YWdlPiN7M30gLCA8YWxwaGEtdmFsdWU+PyApfHJnYiggPG51bWJlcj4jezN9ICwgPGFscGhhLXZhbHVlPj8gKSIsCiAgICAgICAgInJnYmEoKSI6ICJyZ2JhKCA8cGVyY2VudGFnZT57M30gWy8gPGFscGhhLXZhbHVlPl0/ICl8cmdiYSggPG51bWJlcj57M30gWy8gPGFscGhhLXZhbHVlPl0/ICl8cmdiYSggPHBlcmNlbnRhZ2U+I3szfSAsIDxhbHBoYS12YWx1ZT4/ICl8cmdiYSggPG51bWJlcj4jezN9ICwgPGFscGhhLXZhbHVlPj8gKSIsCiAgICAgICAgInJvdGF0ZSgpIjogInJvdGF0ZSggWzxhbmdsZT58PHplcm8+XSApIiwKICAgICAgICAicm90YXRlM2QoKSI6ICJyb3RhdGUzZCggPG51bWJlcj4gLCA8bnVtYmVyPiAsIDxudW1iZXI+ICwgWzxhbmdsZT58PHplcm8+XSApIiwKICAgICAgICAicm90YXRlWCgpIjogInJvdGF0ZVgoIFs8YW5nbGU+fDx6ZXJvPl0gKSIsCiAgICAgICAgInJvdGF0ZVkoKSI6ICJyb3RhdGVZKCBbPGFuZ2xlPnw8emVybz5dICkiLAogICAgICAgICJyb3RhdGVaKCkiOiAicm90YXRlWiggWzxhbmdsZT58PHplcm8+XSApIiwKICAgICAgICAicm91bmQoKSI6ICJyb3VuZCggPHJvdW5kaW5nLXN0cmF0ZWd5Pj8gLCA8Y2FsYy1zdW0+ICwgPGNhbGMtc3VtPiApIiwKICAgICAgICAicm91bmRpbmctc3RyYXRlZ3kiOiAibmVhcmVzdHx1cHxkb3dufHRvLXplcm8iLAogICAgICAgICJzYXR1cmF0ZSgpIjogInNhdHVyYXRlKCA8bnVtYmVyLXBlcmNlbnRhZ2U+ICkiLAogICAgICAgICJzY2FsZSgpIjogInNjYWxlKCBbPG51bWJlcj58PHBlcmNlbnRhZ2U+XSN7MSwyfSApIiwKICAgICAgICAic2NhbGUzZCgpIjogInNjYWxlM2QoIFs8bnVtYmVyPnw8cGVyY2VudGFnZT5dI3szfSApIiwKICAgICAgICAic2NhbGVYKCkiOiAic2NhbGVYKCBbPG51bWJlcj58PHBlcmNlbnRhZ2U+XSApIiwKICAgICAgICAic2NhbGVZKCkiOiAic2NhbGVZKCBbPG51bWJlcj58PHBlcmNlbnRhZ2U+XSApIiwKICAgICAgICAic2NhbGVaKCkiOiAic2NhbGVaKCBbPG51bWJlcj58PHBlcmNlbnRhZ2U+XSApIiwKICAgICAgICAic2Nyb2xsZXIiOiAicm9vdHxuZWFyZXN0IiwKICAgICAgICAic2VsZi1wb3NpdGlvbiI6ICJjZW50ZXJ8c3RhcnR8ZW5kfHNlbGYtc3RhcnR8c2VsZi1lbmR8ZmxleC1zdGFydHxmbGV4LWVuZCIsCiAgICAgICAgInNoYXBlLXJhZGl1cyI6ICI8bGVuZ3RoLXBlcmNlbnRhZ2U+fGNsb3Nlc3Qtc2lkZXxmYXJ0aGVzdC1zaWRlIiwKICAgICAgICAic2lnbigpIjogInNpZ24oIDxjYWxjLXN1bT4gKSIsCiAgICAgICAgInNrZXcoKSI6ICJza2V3KCBbPGFuZ2xlPnw8emVybz5dICwgWzxhbmdsZT58PHplcm8+XT8gKSIsCiAgICAgICAgInNrZXdYKCkiOiAic2tld1goIFs8YW5nbGU+fDx6ZXJvPl0gKSIsCiAgICAgICAgInNrZXdZKCkiOiAic2tld1koIFs8YW5nbGU+fDx6ZXJvPl0gKSIsCiAgICAgICAgInNlcGlhKCkiOiAic2VwaWEoIDxudW1iZXItcGVyY2VudGFnZT4gKSIsCiAgICAgICAgInNoYWRvdyI6ICJpbnNldD8mJjxsZW5ndGg+ezIsNH0mJjxjb2xvcj4/IiwKICAgICAgICAic2hhZG93LXQiOiAiWzxsZW5ndGg+ezIsM30mJjxjb2xvcj4/XSIsCiAgICAgICAgInNoYXBlIjogInJlY3QoIDx0b3A+ICwgPHJpZ2h0PiAsIDxib3R0b20+ICwgPGxlZnQ+ICl8cmVjdCggPHRvcD4gPHJpZ2h0PiA8Ym90dG9tPiA8bGVmdD4gKSIsCiAgICAgICAgInNoYXBlLWJveCI6ICI8Ym94PnxtYXJnaW4tYm94IiwKICAgICAgICAic2lkZS1vci1jb3JuZXIiOiAiW2xlZnR8cmlnaHRdfHxbdG9wfGJvdHRvbV0iLAogICAgICAgICJzaW4oKSI6ICJzaW4oIDxjYWxjLXN1bT4gKSIsCiAgICAgICAgInNpbmdsZS1hbmltYXRpb24iOiAiPHRpbWU+fHw8ZWFzaW5nLWZ1bmN0aW9uPnx8PHRpbWU+fHw8c2luZ2xlLWFuaW1hdGlvbi1pdGVyYXRpb24tY291bnQ+fHw8c2luZ2xlLWFuaW1hdGlvbi1kaXJlY3Rpb24+fHw8c2luZ2xlLWFuaW1hdGlvbi1maWxsLW1vZGU+fHw8c2luZ2xlLWFuaW1hdGlvbi1wbGF5LXN0YXRlPnx8W25vbmV8PGtleWZyYW1lcy1uYW1lPl0iLAogICAgICAgICJzaW5nbGUtYW5pbWF0aW9uLWRpcmVjdGlvbiI6ICJub3JtYWx8cmV2ZXJzZXxhbHRlcm5hdGV8YWx0ZXJuYXRlLXJldmVyc2UiLAogICAgICAgICJzaW5nbGUtYW5pbWF0aW9uLWZpbGwtbW9kZSI6ICJub25lfGZvcndhcmRzfGJhY2t3YXJkc3xib3RoIiwKICAgICAgICAic2luZ2xlLWFuaW1hdGlvbi1pdGVyYXRpb24tY291bnQiOiAiaW5maW5pdGV8PG51bWJlcj4iLAogICAgICAgICJzaW5nbGUtYW5pbWF0aW9uLXBsYXktc3RhdGUiOiAicnVubmluZ3xwYXVzZWQiLAogICAgICAgICJzaW5nbGUtYW5pbWF0aW9uLXRpbWVsaW5lIjogImF1dG98bm9uZXw8dGltZWxpbmUtbmFtZT58c2Nyb2xsKCA8YXhpcz4/IDxzY3JvbGxlcj4/ICkiLAogICAgICAgICJzaW5nbGUtdHJhbnNpdGlvbiI6ICJbbm9uZXw8c2luZ2xlLXRyYW5zaXRpb24tcHJvcGVydHk+XXx8PHRpbWU+fHw8ZWFzaW5nLWZ1bmN0aW9uPnx8PHRpbWU+IiwKICAgICAgICAic2luZ2xlLXRyYW5zaXRpb24tcHJvcGVydHkiOiAiYWxsfDxjdXN0b20taWRlbnQ+IiwKICAgICAgICAic2l6ZSI6ICJjbG9zZXN0LXNpZGV8ZmFydGhlc3Qtc2lkZXxjbG9zZXN0LWNvcm5lcnxmYXJ0aGVzdC1jb3JuZXJ8PGxlbmd0aD58PGxlbmd0aC1wZXJjZW50YWdlPnsyfSIsCiAgICAgICAgInNxcnQoKSI6ICJzcXJ0KCA8Y2FsYy1zdW0+ICkiLAogICAgICAgICJzdGVwLXBvc2l0aW9uIjogImp1bXAtc3RhcnR8anVtcC1lbmR8anVtcC1ub25lfGp1bXAtYm90aHxzdGFydHxlbmQiLAogICAgICAgICJzdGVwLXRpbWluZy1mdW5jdGlvbiI6ICJzdGVwLXN0YXJ0fHN0ZXAtZW5kfHN0ZXBzKCA8aW50ZWdlcj4gWywgPHN0ZXAtcG9zaXRpb24+XT8gKSIsCiAgICAgICAgInN1YmNsYXNzLXNlbGVjdG9yIjogIjxpZC1zZWxlY3Rvcj58PGNsYXNzLXNlbGVjdG9yPnw8YXR0cmlidXRlLXNlbGVjdG9yPnw8cHNldWRvLWNsYXNzLXNlbGVjdG9yPiIsCiAgICAgICAgInN1cHBvcnRzLWNvbmRpdGlvbiI6ICJub3QgPHN1cHBvcnRzLWluLXBhcmVucz58PHN1cHBvcnRzLWluLXBhcmVucz4gW2FuZCA8c3VwcG9ydHMtaW4tcGFyZW5zPl0qfDxzdXBwb3J0cy1pbi1wYXJlbnM+IFtvciA8c3VwcG9ydHMtaW4tcGFyZW5zPl0qIiwKICAgICAgICAic3VwcG9ydHMtaW4tcGFyZW5zIjogIiggPHN1cHBvcnRzLWNvbmRpdGlvbj4gKXw8c3VwcG9ydHMtZmVhdHVyZT58PGdlbmVyYWwtZW5jbG9zZWQ+IiwKICAgICAgICAic3VwcG9ydHMtZmVhdHVyZSI6ICI8c3VwcG9ydHMtZGVjbD58PHN1cHBvcnRzLXNlbGVjdG9yLWZuPiIsCiAgICAgICAgInN1cHBvcnRzLWRlY2wiOiAiKCA8ZGVjbGFyYXRpb24+ICkiLAogICAgICAgICJzdXBwb3J0cy1zZWxlY3Rvci1mbiI6ICJzZWxlY3RvciggPGNvbXBsZXgtc2VsZWN0b3I+ICkiLAogICAgICAgICJzeW1ib2wiOiAiPHN0cmluZz58PGltYWdlPnw8Y3VzdG9tLWlkZW50PiIsCiAgICAgICAgInRhbigpIjogInRhbiggPGNhbGMtc3VtPiApIiwKICAgICAgICAidGFyZ2V0IjogIjx0YXJnZXQtY291bnRlcigpPnw8dGFyZ2V0LWNvdW50ZXJzKCk+fDx0YXJnZXQtdGV4dCgpPiIsCiAgICAgICAgInRhcmdldC1jb3VudGVyKCkiOiAidGFyZ2V0LWNvdW50ZXIoIFs8c3RyaW5nPnw8dXJsPl0gLCA8Y3VzdG9tLWlkZW50PiAsIDxjb3VudGVyLXN0eWxlPj8gKSIsCiAgICAgICAgInRhcmdldC1jb3VudGVycygpIjogInRhcmdldC1jb3VudGVycyggWzxzdHJpbmc+fDx1cmw+XSAsIDxjdXN0b20taWRlbnQ+ICwgPHN0cmluZz4gLCA8Y291bnRlci1zdHlsZT4/ICkiLAogICAgICAgICJ0YXJnZXQtdGV4dCgpIjogInRhcmdldC10ZXh0KCBbPHN0cmluZz58PHVybD5dICwgW2NvbnRlbnR8YmVmb3JlfGFmdGVyfGZpcnN0LWxldHRlcl0/ICkiLAogICAgICAgICJ0aW1lLXBlcmNlbnRhZ2UiOiAiPHRpbWU+fDxwZXJjZW50YWdlPiIsCiAgICAgICAgInRpbWVsaW5lLW5hbWUiOiAiPGN1c3RvbS1pZGVudD58PHN0cmluZz4iLAogICAgICAgICJlYXNpbmctZnVuY3Rpb24iOiAibGluZWFyfDxjdWJpYy1iZXppZXItdGltaW5nLWZ1bmN0aW9uPnw8c3RlcC10aW1pbmctZnVuY3Rpb24+IiwKICAgICAgICAidHJhY2stYnJlYWR0aCI6ICI8bGVuZ3RoLXBlcmNlbnRhZ2U+fDxmbGV4PnxtaW4tY29udGVudHxtYXgtY29udGVudHxhdXRvIiwKICAgICAgICAidHJhY2stbGlzdCI6ICJbPGxpbmUtbmFtZXM+PyBbPHRyYWNrLXNpemU+fDx0cmFjay1yZXBlYXQ+XV0rIDxsaW5lLW5hbWVzPj8iLAogICAgICAgICJ0cmFjay1yZXBlYXQiOiAicmVwZWF0KCBbPGludGVnZXIgWzEs4oieXT5dICwgWzxsaW5lLW5hbWVzPj8gPHRyYWNrLXNpemU+XSsgPGxpbmUtbmFtZXM+PyApIiwKICAgICAgICAidHJhY2stc2l6ZSI6ICI8dHJhY2stYnJlYWR0aD58bWlubWF4KCA8aW5mbGV4aWJsZS1icmVhZHRoPiAsIDx0cmFjay1icmVhZHRoPiApfGZpdC1jb250ZW50KCA8bGVuZ3RoLXBlcmNlbnRhZ2U+ICkiLAogICAgICAgICJ0cmFuc2Zvcm0tZnVuY3Rpb24iOiAiPG1hdHJpeCgpPnw8dHJhbnNsYXRlKCk+fDx0cmFuc2xhdGVYKCk+fDx0cmFuc2xhdGVZKCk+fDxzY2FsZSgpPnw8c2NhbGVYKCk+fDxzY2FsZVkoKT58PHJvdGF0ZSgpPnw8c2tldygpPnw8c2tld1goKT58PHNrZXdZKCk+fDxtYXRyaXgzZCgpPnw8dHJhbnNsYXRlM2QoKT58PHRyYW5zbGF0ZVooKT58PHNjYWxlM2QoKT58PHNjYWxlWigpPnw8cm90YXRlM2QoKT58PHJvdGF0ZVgoKT58PHJvdGF0ZVkoKT58PHJvdGF0ZVooKT58PHBlcnNwZWN0aXZlKCk+IiwKICAgICAgICAidHJhbnNmb3JtLWxpc3QiOiAiPHRyYW5zZm9ybS1mdW5jdGlvbj4rIiwKICAgICAgICAidHJhbnNsYXRlKCkiOiAidHJhbnNsYXRlKCA8bGVuZ3RoLXBlcmNlbnRhZ2U+ICwgPGxlbmd0aC1wZXJjZW50YWdlPj8gKSIsCiAgICAgICAgInRyYW5zbGF0ZTNkKCkiOiAidHJhbnNsYXRlM2QoIDxsZW5ndGgtcGVyY2VudGFnZT4gLCA8bGVuZ3RoLXBlcmNlbnRhZ2U+ICwgPGxlbmd0aD4gKSIsCiAgICAgICAgInRyYW5zbGF0ZVgoKSI6ICJ0cmFuc2xhdGVYKCA8bGVuZ3RoLXBlcmNlbnRhZ2U+ICkiLAogICAgICAgICJ0cmFuc2xhdGVZKCkiOiAidHJhbnNsYXRlWSggPGxlbmd0aC1wZXJjZW50YWdlPiApIiwKICAgICAgICAidHJhbnNsYXRlWigpIjogInRyYW5zbGF0ZVooIDxsZW5ndGg+ICkiLAogICAgICAgICJ0eXBlLW9yLXVuaXQiOiAic3RyaW5nfGNvbG9yfHVybHxpbnRlZ2VyfG51bWJlcnxsZW5ndGh8YW5nbGV8dGltZXxmcmVxdWVuY3l8Y2FwfGNofGVtfGV4fGljfGxofHJsaHxyZW18dmJ8dml8dnd8dmh8dm1pbnx2bWF4fG1tfFF8Y218aW58cHR8cGN8cHh8ZGVnfGdyYWR8cmFkfHR1cm58bXN8c3xIenxrSHp8JSIsCiAgICAgICAgInR5cGUtc2VsZWN0b3IiOiAiPHdxLW5hbWU+fDxucy1wcmVmaXg+PyAnKiciLAogICAgICAgICJ2YXIoKSI6ICJ2YXIoIDxjdXN0b20tcHJvcGVydHktbmFtZT4gLCA8ZGVjbGFyYXRpb24tdmFsdWU+PyApIiwKICAgICAgICAidmlld3BvcnQtbGVuZ3RoIjogImF1dG98PGxlbmd0aC1wZXJjZW50YWdlPiIsCiAgICAgICAgInZpc3VhbC1ib3giOiAiY29udGVudC1ib3h8cGFkZGluZy1ib3h8Ym9yZGVyLWJveCIsCiAgICAgICAgIndxLW5hbWUiOiAiPG5zLXByZWZpeD4/IDxpZGVudC10b2tlbj4iLAogICAgICAgICItbGVnYWN5LWdyYWRpZW50IjogIjwtd2Via2l0LWdyYWRpZW50KCk+fDwtbGVnYWN5LWxpbmVhci1ncmFkaWVudD58PC1sZWdhY3ktcmVwZWF0aW5nLWxpbmVhci1ncmFkaWVudD58PC1sZWdhY3ktcmFkaWFsLWdyYWRpZW50Pnw8LWxlZ2FjeS1yZXBlYXRpbmctcmFkaWFsLWdyYWRpZW50PiIsCiAgICAgICAgIi1sZWdhY3ktbGluZWFyLWdyYWRpZW50IjogIi1tb3otbGluZWFyLWdyYWRpZW50KCA8LWxlZ2FjeS1saW5lYXItZ3JhZGllbnQtYXJndW1lbnRzPiApfC13ZWJraXQtbGluZWFyLWdyYWRpZW50KCA8LWxlZ2FjeS1saW5lYXItZ3JhZGllbnQtYXJndW1lbnRzPiApfC1vLWxpbmVhci1ncmFkaWVudCggPC1sZWdhY3ktbGluZWFyLWdyYWRpZW50LWFyZ3VtZW50cz4gKSIsCiAgICAgICAgIi1sZWdhY3ktcmVwZWF0aW5nLWxpbmVhci1ncmFkaWVudCI6ICItbW96LXJlcGVhdGluZy1saW5lYXItZ3JhZGllbnQoIDwtbGVnYWN5LWxpbmVhci1ncmFkaWVudC1hcmd1bWVudHM+ICl8LXdlYmtpdC1yZXBlYXRpbmctbGluZWFyLWdyYWRpZW50KCA8LWxlZ2FjeS1saW5lYXItZ3JhZGllbnQtYXJndW1lbnRzPiApfC1vLXJlcGVhdGluZy1saW5lYXItZ3JhZGllbnQoIDwtbGVnYWN5LWxpbmVhci1ncmFkaWVudC1hcmd1bWVudHM+ICkiLAogICAgICAgICItbGVnYWN5LWxpbmVhci1ncmFkaWVudC1hcmd1bWVudHMiOiAiWzxhbmdsZT58PHNpZGUtb3ItY29ybmVyPl0/ICwgPGNvbG9yLXN0b3AtbGlzdD4iLAogICAgICAgICItbGVnYWN5LXJhZGlhbC1ncmFkaWVudCI6ICItbW96LXJhZGlhbC1ncmFkaWVudCggPC1sZWdhY3ktcmFkaWFsLWdyYWRpZW50LWFyZ3VtZW50cz4gKXwtd2Via2l0LXJhZGlhbC1ncmFkaWVudCggPC1sZWdhY3ktcmFkaWFsLWdyYWRpZW50LWFyZ3VtZW50cz4gKXwtby1yYWRpYWwtZ3JhZGllbnQoIDwtbGVnYWN5LXJhZGlhbC1ncmFkaWVudC1hcmd1bWVudHM+ICkiLAogICAgICAgICItbGVnYWN5LXJlcGVhdGluZy1yYWRpYWwtZ3JhZGllbnQiOiAiLW1vei1yZXBlYXRpbmctcmFkaWFsLWdyYWRpZW50KCA8LWxlZ2FjeS1yYWRpYWwtZ3JhZGllbnQtYXJndW1lbnRzPiApfC13ZWJraXQtcmVwZWF0aW5nLXJhZGlhbC1ncmFkaWVudCggPC1sZWdhY3ktcmFkaWFsLWdyYWRpZW50LWFyZ3VtZW50cz4gKXwtby1yZXBlYXRpbmctcmFkaWFsLWdyYWRpZW50KCA8LWxlZ2FjeS1yYWRpYWwtZ3JhZGllbnQtYXJndW1lbnRzPiApIiwKICAgICAgICAiLWxlZ2FjeS1yYWRpYWwtZ3JhZGllbnQtYXJndW1lbnRzIjogIls8cG9zaXRpb24+ICxdPyBbW1s8LWxlZ2FjeS1yYWRpYWwtZ3JhZGllbnQtc2hhcGU+fHw8LWxlZ2FjeS1yYWRpYWwtZ3JhZGllbnQtc2l6ZT5dfFs8bGVuZ3RoPnw8cGVyY2VudGFnZT5dezJ9XSAsXT8gPGNvbG9yLXN0b3AtbGlzdD4iLAogICAgICAgICItbGVnYWN5LXJhZGlhbC1ncmFkaWVudC1zaXplIjogImNsb3Nlc3Qtc2lkZXxjbG9zZXN0LWNvcm5lcnxmYXJ0aGVzdC1zaWRlfGZhcnRoZXN0LWNvcm5lcnxjb250YWlufGNvdmVyIiwKICAgICAgICAiLWxlZ2FjeS1yYWRpYWwtZ3JhZGllbnQtc2hhcGUiOiAiY2lyY2xlfGVsbGlwc2UiLAogICAgICAgICItbm9uLXN0YW5kYXJkLWZvbnQiOiAiLWFwcGxlLXN5c3RlbS1ib2R5fC1hcHBsZS1zeXN0ZW0taGVhZGxpbmV8LWFwcGxlLXN5c3RlbS1zdWJoZWFkbGluZXwtYXBwbGUtc3lzdGVtLWNhcHRpb24xfC1hcHBsZS1zeXN0ZW0tY2FwdGlvbjJ8LWFwcGxlLXN5c3RlbS1mb290bm90ZXwtYXBwbGUtc3lzdGVtLXNob3J0LWJvZHl8LWFwcGxlLXN5c3RlbS1zaG9ydC1oZWFkbGluZXwtYXBwbGUtc3lzdGVtLXNob3J0LXN1YmhlYWRsaW5lfC1hcHBsZS1zeXN0ZW0tc2hvcnQtY2FwdGlvbjF8LWFwcGxlLXN5c3RlbS1zaG9ydC1mb290bm90ZXwtYXBwbGUtc3lzdGVtLXRhbGwtYm9keSIsCiAgICAgICAgIi1ub24tc3RhbmRhcmQtY29sb3IiOiAiLW1vei1CdXR0b25EZWZhdWx0fC1tb3otQnV0dG9uSG92ZXJGYWNlfC1tb3otQnV0dG9uSG92ZXJUZXh0fC1tb3otQ2VsbEhpZ2hsaWdodHwtbW96LUNlbGxIaWdobGlnaHRUZXh0fC1tb3otQ29tYm9ib3h8LW1vei1Db21ib2JveFRleHR8LW1vei1EaWFsb2d8LW1vei1EaWFsb2dUZXh0fC1tb3otZHJhZ3RhcmdldHpvbmV8LW1vei1FdmVuVHJlZVJvd3wtbW96LUZpZWxkfC1tb3otRmllbGRUZXh0fC1tb3otaHRtbC1DZWxsSGlnaGxpZ2h0fC1tb3otaHRtbC1DZWxsSGlnaGxpZ2h0VGV4dHwtbW96LW1hYy1hY2NlbnRkYXJrZXN0c2hhZG93fC1tb3otbWFjLWFjY2VudGRhcmtzaGFkb3d8LW1vei1tYWMtYWNjZW50ZmFjZXwtbW96LW1hYy1hY2NlbnRsaWdodGVzdGhpZ2hsaWdodHwtbW96LW1hYy1hY2NlbnRsaWdodHNoYWRvd3wtbW96LW1hYy1hY2NlbnRyZWd1bGFyaGlnaGxpZ2h0fC1tb3otbWFjLWFjY2VudHJlZ3VsYXJzaGFkb3d8LW1vei1tYWMtY2hyb21lLWFjdGl2ZXwtbW96LW1hYy1jaHJvbWUtaW5hY3RpdmV8LW1vei1tYWMtZm9jdXNyaW5nfC1tb3otbWFjLW1lbnVzZWxlY3R8LW1vei1tYWMtbWVudXNoYWRvd3wtbW96LW1hYy1tZW51dGV4dHNlbGVjdHwtbW96LU1lbnVIb3ZlcnwtbW96LU1lbnVIb3ZlclRleHR8LW1vei1NZW51QmFyVGV4dHwtbW96LU1lbnVCYXJIb3ZlclRleHR8LW1vei1uYXRpdmVoeXBlcmxpbmt0ZXh0fC1tb3otT2RkVHJlZVJvd3wtbW96LXdpbi1jb21tdW5pY2F0aW9uc3RleHR8LW1vei13aW4tbWVkaWF0ZXh0fC1tb3otYWN0aXZlaHlwZXJsaW5rdGV4dHwtbW96LWRlZmF1bHQtYmFja2dyb3VuZC1jb2xvcnwtbW96LWRlZmF1bHQtY29sb3J8LW1vei1oeXBlcmxpbmt0ZXh0fC1tb3otdmlzaXRlZGh5cGVybGlua3RleHR8LXdlYmtpdC1hY3RpdmVsaW5rfC13ZWJraXQtZm9jdXMtcmluZy1jb2xvcnwtd2Via2l0LWxpbmt8LXdlYmtpdC10ZXh0IiwKICAgICAgICAiLW5vbi1zdGFuZGFyZC1pbWFnZS1yZW5kZXJpbmciOiAib3B0aW1pemUtY29udHJhc3R8LW1vei1jcmlzcC1lZGdlc3wtby1jcmlzcC1lZGdlc3wtd2Via2l0LW9wdGltaXplLWNvbnRyYXN0IiwKICAgICAgICAiLW5vbi1zdGFuZGFyZC1vdmVyZmxvdyI6ICItbW96LXNjcm9sbGJhcnMtbm9uZXwtbW96LXNjcm9sbGJhcnMtaG9yaXpvbnRhbHwtbW96LXNjcm9sbGJhcnMtdmVydGljYWx8LW1vei1oaWRkZW4tdW5zY3JvbGxhYmxlIiwKICAgICAgICAiLW5vbi1zdGFuZGFyZC13aWR0aCI6ICJmaWxsLWF2YWlsYWJsZXxtaW4taW50cmluc2ljfGludHJpbnNpY3wtbW96LWF2YWlsYWJsZXwtbW96LWZpdC1jb250ZW50fC1tb3otbWluLWNvbnRlbnR8LW1vei1tYXgtY29udGVudHwtd2Via2l0LW1pbi1jb250ZW50fC13ZWJraXQtbWF4LWNvbnRlbnQiLAogICAgICAgICItd2Via2l0LWdyYWRpZW50KCkiOiAiLXdlYmtpdC1ncmFkaWVudCggPC13ZWJraXQtZ3JhZGllbnQtdHlwZT4gLCA8LXdlYmtpdC1ncmFkaWVudC1wb2ludD4gWywgPC13ZWJraXQtZ3JhZGllbnQtcG9pbnQ+fCwgPC13ZWJraXQtZ3JhZGllbnQtcmFkaXVzPiAsIDwtd2Via2l0LWdyYWRpZW50LXBvaW50Pl0gWywgPC13ZWJraXQtZ3JhZGllbnQtcmFkaXVzPl0/IFssIDwtd2Via2l0LWdyYWRpZW50LWNvbG9yLXN0b3A+XSogKSIsCiAgICAgICAgIi13ZWJraXQtZ3JhZGllbnQtY29sb3Itc3RvcCI6ICJmcm9tKCA8Y29sb3I+ICl8Y29sb3Itc3RvcCggWzxudW1iZXItemVyby1vbmU+fDxwZXJjZW50YWdlPl0gLCA8Y29sb3I+ICl8dG8oIDxjb2xvcj4gKSIsCiAgICAgICAgIi13ZWJraXQtZ3JhZGllbnQtcG9pbnQiOiAiW2xlZnR8Y2VudGVyfHJpZ2h0fDxsZW5ndGgtcGVyY2VudGFnZT5dIFt0b3B8Y2VudGVyfGJvdHRvbXw8bGVuZ3RoLXBlcmNlbnRhZ2U+XSIsCiAgICAgICAgIi13ZWJraXQtZ3JhZGllbnQtcmFkaXVzIjogIjxsZW5ndGg+fDxwZXJjZW50YWdlPiIsCiAgICAgICAgIi13ZWJraXQtZ3JhZGllbnQtdHlwZSI6ICJsaW5lYXJ8cmFkaWFsIiwKICAgICAgICAiLXdlYmtpdC1tYXNrLWJveC1yZXBlYXQiOiAicmVwZWF0fHN0cmV0Y2h8cm91bmQiLAogICAgICAgICItd2Via2l0LW1hc2stY2xpcC1zdHlsZSI6ICJib3JkZXJ8Ym9yZGVyLWJveHxwYWRkaW5nfHBhZGRpbmctYm94fGNvbnRlbnR8Y29udGVudC1ib3h8dGV4dCIsCiAgICAgICAgIi1tcy1maWx0ZXItZnVuY3Rpb24tbGlzdCI6ICI8LW1zLWZpbHRlci1mdW5jdGlvbj4rIiwKICAgICAgICAiLW1zLWZpbHRlci1mdW5jdGlvbiI6ICI8LW1zLWZpbHRlci1mdW5jdGlvbi1wcm9naWQ+fDwtbXMtZmlsdGVyLWZ1bmN0aW9uLWxlZ2FjeT4iLAogICAgICAgICItbXMtZmlsdGVyLWZ1bmN0aW9uLXByb2dpZCI6ICIncHJvZ2lkOicgWzxpZGVudC10b2tlbj4gJy4nXSogWzxpZGVudC10b2tlbj58PGZ1bmN0aW9uLXRva2VuPiA8YW55LXZhbHVlPj8gKV0iLAogICAgICAgICItbXMtZmlsdGVyLWZ1bmN0aW9uLWxlZ2FjeSI6ICI8aWRlbnQtdG9rZW4+fDxmdW5jdGlvbi10b2tlbj4gPGFueS12YWx1ZT4/ICkiLAogICAgICAgICItbXMtZmlsdGVyIjogIjxzdHJpbmc+IiwKICAgICAgICAiYWdlIjogImNoaWxkfHlvdW5nfG9sZCIsCiAgICAgICAgImF0dHItbmFtZSI6ICI8d3EtbmFtZT4iLAogICAgICAgICJhdHRyLWZhbGxiYWNrIjogIjxhbnktdmFsdWU+IiwKICAgICAgICAiYmctY2xpcCI6ICI8Ym94Pnxib3JkZXJ8dGV4dCIsCiAgICAgICAgImJvdHRvbSI6ICI8bGVuZ3RoPnxhdXRvIiwKICAgICAgICAiZ2VuZXJpYy12b2ljZSI6ICJbPGFnZT4/IDxnZW5kZXI+IDxpbnRlZ2VyPj9dIiwKICAgICAgICAiZ2VuZGVyIjogIm1hbGV8ZmVtYWxlfG5ldXRyYWwiLAogICAgICAgICJsZWZ0IjogIjxsZW5ndGg+fGF1dG8iLAogICAgICAgICJtYXNrLWltYWdlIjogIjxtYXNrLXJlZmVyZW5jZT4jIiwKICAgICAgICAicGFpbnQiOiAibm9uZXw8Y29sb3I+fDx1cmw+IFtub25lfDxjb2xvcj5dP3xjb250ZXh0LWZpbGx8Y29udGV4dC1zdHJva2UiLAogICAgICAgICJyaWdodCI6ICI8bGVuZ3RoPnxhdXRvIiwKICAgICAgICAic2Nyb2xsLXRpbWVsaW5lLWF4aXMiOiAiYmxvY2t8aW5saW5lfHZlcnRpY2FsfGhvcml6b250YWwiLAogICAgICAgICJzY3JvbGwtdGltZWxpbmUtbmFtZSI6ICJub25lfDxjdXN0b20taWRlbnQ+IiwKICAgICAgICAic2luZ2xlLWFuaW1hdGlvbi1jb21wb3NpdGlvbiI6ICJyZXBsYWNlfGFkZHxhY2N1bXVsYXRlIiwKICAgICAgICAic3ZnLWxlbmd0aCI6ICI8cGVyY2VudGFnZT58PGxlbmd0aD58PG51bWJlcj4iLAogICAgICAgICJzdmctd3JpdGluZy1tb2RlIjogImxyLXRifHJsLXRifHRiLXJsfGxyfHJsfHRiIiwKICAgICAgICAidG9wIjogIjxsZW5ndGg+fGF1dG8iLAogICAgICAgICJ4IjogIjxudW1iZXI+IiwKICAgICAgICAieSI6ICI8bnVtYmVyPiIsCiAgICAgICAgImRlY2xhcmF0aW9uIjogIjxpZGVudC10b2tlbj4gOiA8ZGVjbGFyYXRpb24tdmFsdWU+PyBbJyEnIGltcG9ydGFudF0/IiwKICAgICAgICAiZGVjbGFyYXRpb24tbGlzdCI6ICJbPGRlY2xhcmF0aW9uPj8gJzsnXSogPGRlY2xhcmF0aW9uPj8iLAogICAgICAgICJ1cmwiOiAidXJsKCA8c3RyaW5nPiA8dXJsLW1vZGlmaWVyPiogKXw8dXJsLXRva2VuPiIsCiAgICAgICAgInVybC1tb2RpZmllciI6ICI8aWRlbnQ+fDxmdW5jdGlvbi10b2tlbj4gPGFueS12YWx1ZT4gKSIsCiAgICAgICAgIm51bWJlci16ZXJvLW9uZSI6ICI8bnVtYmVyIFswLDFdPiIsCiAgICAgICAgIm51bWJlci1vbmUtb3ItZ3JlYXRlciI6ICI8bnVtYmVyIFsxLOKInl0+IiwKICAgICAgICAiLW5vbi1zdGFuZGFyZC1kaXNwbGF5IjogIi1tcy1pbmxpbmUtZmxleGJveHwtbXMtZ3JpZHwtbXMtaW5saW5lLWdyaWR8LXdlYmtpdC1mbGV4fC13ZWJraXQtaW5saW5lLWZsZXh8LXdlYmtpdC1ib3h8LXdlYmtpdC1pbmxpbmUtYm94fC1tb3otaW5saW5lLXN0YWNrfC1tb3otYm94fC1tb3otaW5saW5lLWJveCIKICAgIH0sCiAgICAicHJvcGVydGllcyI6IHsKICAgICAgICAiLS0qIjogIjxkZWNsYXJhdGlvbi12YWx1ZT4iLAogICAgICAgICItbXMtYWNjZWxlcmF0b3IiOiAiZmFsc2V8dHJ1ZSIsCiAgICAgICAgIi1tcy1ibG9jay1wcm9ncmVzc2lvbiI6ICJ0YnxybHxidHxsciIsCiAgICAgICAgIi1tcy1jb250ZW50LXpvb20tY2hhaW5pbmciOiAibm9uZXxjaGFpbmVkIiwKICAgICAgICAiLW1zLWNvbnRlbnQtem9vbWluZyI6ICJub25lfHpvb20iLAogICAgICAgICItbXMtY29udGVudC16b29tLWxpbWl0IjogIjwnLW1zLWNvbnRlbnQtem9vbS1saW1pdC1taW4nPiA8Jy1tcy1jb250ZW50LXpvb20tbGltaXQtbWF4Jz4iLAogICAgICAgICItbXMtY29udGVudC16b29tLWxpbWl0LW1heCI6ICI8cGVyY2VudGFnZT4iLAogICAgICAgICItbXMtY29udGVudC16b29tLWxpbWl0LW1pbiI6ICI8cGVyY2VudGFnZT4iLAogICAgICAgICItbXMtY29udGVudC16b29tLXNuYXAiOiAiPCctbXMtY29udGVudC16b29tLXNuYXAtdHlwZSc+fHw8Jy1tcy1jb250ZW50LXpvb20tc25hcC1wb2ludHMnPiIsCiAgICAgICAgIi1tcy1jb250ZW50LXpvb20tc25hcC1wb2ludHMiOiAic25hcEludGVydmFsKCA8cGVyY2VudGFnZT4gLCA8cGVyY2VudGFnZT4gKXxzbmFwTGlzdCggPHBlcmNlbnRhZ2U+IyApIiwKICAgICAgICAiLW1zLWNvbnRlbnQtem9vbS1zbmFwLXR5cGUiOiAibm9uZXxwcm94aW1pdHl8bWFuZGF0b3J5IiwKICAgICAgICAiLW1zLWZpbHRlciI6ICI8c3RyaW5nPiIsCiAgICAgICAgIi1tcy1mbG93LWZyb20iOiAiW25vbmV8PGN1c3RvbS1pZGVudD5dIyIsCiAgICAgICAgIi1tcy1mbG93LWludG8iOiAiW25vbmV8PGN1c3RvbS1pZGVudD5dIyIsCiAgICAgICAgIi1tcy1ncmlkLWNvbHVtbnMiOiAibm9uZXw8dHJhY2stbGlzdD58PGF1dG8tdHJhY2stbGlzdD4iLAogICAgICAgICItbXMtZ3JpZC1yb3dzIjogIm5vbmV8PHRyYWNrLWxpc3Q+fDxhdXRvLXRyYWNrLWxpc3Q+IiwKICAgICAgICAiLW1zLWhpZ2gtY29udHJhc3QtYWRqdXN0IjogImF1dG98bm9uZSIsCiAgICAgICAgIi1tcy1oeXBoZW5hdGUtbGltaXQtY2hhcnMiOiAiYXV0b3w8aW50ZWdlcj57MSwzfSIsCiAgICAgICAgIi1tcy1oeXBoZW5hdGUtbGltaXQtbGluZXMiOiAibm8tbGltaXR8PGludGVnZXI+IiwKICAgICAgICAiLW1zLWh5cGhlbmF0ZS1saW1pdC16b25lIjogIjxwZXJjZW50YWdlPnw8bGVuZ3RoPiIsCiAgICAgICAgIi1tcy1pbWUtYWxpZ24iOiAiYXV0b3xhZnRlciIsCiAgICAgICAgIi1tcy1vdmVyZmxvdy1zdHlsZSI6ICJhdXRvfG5vbmV8c2Nyb2xsYmFyfC1tcy1hdXRvaGlkaW5nLXNjcm9sbGJhciIsCiAgICAgICAgIi1tcy1zY3JvbGxiYXItM2RsaWdodC1jb2xvciI6ICI8Y29sb3I+IiwKICAgICAgICAiLW1zLXNjcm9sbGJhci1hcnJvdy1jb2xvciI6ICI8Y29sb3I+IiwKICAgICAgICAiLW1zLXNjcm9sbGJhci1iYXNlLWNvbG9yIjogIjxjb2xvcj4iLAogICAgICAgICItbXMtc2Nyb2xsYmFyLWRhcmtzaGFkb3ctY29sb3IiOiAiPGNvbG9yPiIsCiAgICAgICAgIi1tcy1zY3JvbGxiYXItZmFjZS1jb2xvciI6ICI8Y29sb3I+IiwKICAgICAgICAiLW1zLXNjcm9sbGJhci1oaWdobGlnaHQtY29sb3IiOiAiPGNvbG9yPiIsCiAgICAgICAgIi1tcy1zY3JvbGxiYXItc2hhZG93LWNvbG9yIjogIjxjb2xvcj4iLAogICAgICAgICItbXMtc2Nyb2xsYmFyLXRyYWNrLWNvbG9yIjogIjxjb2xvcj4iLAogICAgICAgICItbXMtc2Nyb2xsLWNoYWluaW5nIjogImNoYWluZWR8bm9uZSIsCiAgICAgICAgIi1tcy1zY3JvbGwtbGltaXQiOiAiPCctbXMtc2Nyb2xsLWxpbWl0LXgtbWluJz4gPCctbXMtc2Nyb2xsLWxpbWl0LXktbWluJz4gPCctbXMtc2Nyb2xsLWxpbWl0LXgtbWF4Jz4gPCctbXMtc2Nyb2xsLWxpbWl0LXktbWF4Jz4iLAogICAgICAgICItbXMtc2Nyb2xsLWxpbWl0LXgtbWF4IjogImF1dG98PGxlbmd0aD4iLAogICAgICAgICItbXMtc2Nyb2xsLWxpbWl0LXgtbWluIjogIjxsZW5ndGg+IiwKICAgICAgICAiLW1zLXNjcm9sbC1saW1pdC15LW1heCI6ICJhdXRvfDxsZW5ndGg+IiwKICAgICAgICAiLW1zLXNjcm9sbC1saW1pdC15LW1pbiI6ICI8bGVuZ3RoPiIsCiAgICAgICAgIi1tcy1zY3JvbGwtcmFpbHMiOiAibm9uZXxyYWlsZWQiLAogICAgICAgICItbXMtc2Nyb2xsLXNuYXAtcG9pbnRzLXgiOiAic25hcEludGVydmFsKCA8bGVuZ3RoLXBlcmNlbnRhZ2U+ICwgPGxlbmd0aC1wZXJjZW50YWdlPiApfHNuYXBMaXN0KCA8bGVuZ3RoLXBlcmNlbnRhZ2U+IyApIiwKICAgICAgICAiLW1zLXNjcm9sbC1zbmFwLXBvaW50cy15IjogInNuYXBJbnRlcnZhbCggPGxlbmd0aC1wZXJjZW50YWdlPiAsIDxsZW5ndGgtcGVyY2VudGFnZT4gKXxzbmFwTGlzdCggPGxlbmd0aC1wZXJjZW50YWdlPiMgKSIsCiAgICAgICAgIi1tcy1zY3JvbGwtc25hcC10eXBlIjogIm5vbmV8cHJveGltaXR5fG1hbmRhdG9yeSIsCiAgICAgICAgIi1tcy1zY3JvbGwtc25hcC14IjogIjwnLW1zLXNjcm9sbC1zbmFwLXR5cGUnPiA8Jy1tcy1zY3JvbGwtc25hcC1wb2ludHMteCc+IiwKICAgICAgICAiLW1zLXNjcm9sbC1zbmFwLXkiOiAiPCctbXMtc2Nyb2xsLXNuYXAtdHlwZSc+IDwnLW1zLXNjcm9sbC1zbmFwLXBvaW50cy15Jz4iLAogICAgICAgICItbXMtc2Nyb2xsLXRyYW5zbGF0aW9uIjogIm5vbmV8dmVydGljYWwtdG8taG9yaXpvbnRhbCIsCiAgICAgICAgIi1tcy10ZXh0LWF1dG9zcGFjZSI6ICJub25lfGlkZW9ncmFwaC1hbHBoYXxpZGVvZ3JhcGgtbnVtZXJpY3xpZGVvZ3JhcGgtcGFyZW50aGVzaXN8aWRlb2dyYXBoLXNwYWNlIiwKICAgICAgICAiLW1zLXRvdWNoLXNlbGVjdCI6ICJncmlwcGVyc3xub25lIiwKICAgICAgICAiLW1zLXVzZXItc2VsZWN0IjogIm5vbmV8ZWxlbWVudHx0ZXh0IiwKICAgICAgICAiLW1zLXdyYXAtZmxvdyI6ICJhdXRvfGJvdGh8c3RhcnR8ZW5kfG1heGltdW18Y2xlYXIiLAogICAgICAgICItbXMtd3JhcC1tYXJnaW4iOiAiPGxlbmd0aD4iLAogICAgICAgICItbXMtd3JhcC10aHJvdWdoIjogIndyYXB8bm9uZSIsCiAgICAgICAgIi1tb3otYXBwZWFyYW5jZSI6ICJub25lfGJ1dHRvbnxidXR0b24tYXJyb3ctZG93bnxidXR0b24tYXJyb3ctbmV4dHxidXR0b24tYXJyb3ctcHJldmlvdXN8YnV0dG9uLWFycm93LXVwfGJ1dHRvbi1iZXZlbHxidXR0b24tZm9jdXN8Y2FyZXR8Y2hlY2tib3h8Y2hlY2tib3gtY29udGFpbmVyfGNoZWNrYm94LWxhYmVsfGNoZWNrbWVudWl0ZW18ZHVhbGJ1dHRvbnxncm91cGJveHxsaXN0Ym94fGxpc3RpdGVtfG1lbnVhcnJvd3xtZW51YmFyfG1lbnVjaGVja2JveHxtZW51aW1hZ2V8bWVudWl0ZW18bWVudWl0ZW10ZXh0fG1lbnVsaXN0fG1lbnVsaXN0LWJ1dHRvbnxtZW51bGlzdC10ZXh0fG1lbnVsaXN0LXRleHRmaWVsZHxtZW51cG9wdXB8bWVudXJhZGlvfG1lbnVzZXBhcmF0b3J8bWV0ZXJiYXJ8bWV0ZXJjaHVua3xwcm9ncmVzc2Jhcnxwcm9ncmVzc2Jhci12ZXJ0aWNhbHxwcm9ncmVzc2NodW5rfHByb2dyZXNzY2h1bmstdmVydGljYWx8cmFkaW98cmFkaW8tY29udGFpbmVyfHJhZGlvLWxhYmVsfHJhZGlvbWVudWl0ZW18cmFuZ2V8cmFuZ2UtdGh1bWJ8cmVzaXplcnxyZXNpemVycGFuZWx8c2NhbGUtaG9yaXpvbnRhbHxzY2FsZXRodW1iZW5kfHNjYWxldGh1bWItaG9yaXpvbnRhbHxzY2FsZXRodW1ic3RhcnR8c2NhbGV0aHVtYnRpY2t8c2NhbGV0aHVtYi12ZXJ0aWNhbHxzY2FsZS12ZXJ0aWNhbHxzY3JvbGxiYXJidXR0b24tZG93bnxzY3JvbGxiYXJidXR0b24tbGVmdHxzY3JvbGxiYXJidXR0b24tcmlnaHR8c2Nyb2xsYmFyYnV0dG9uLXVwfHNjcm9sbGJhcnRodW1iLWhvcml6b250YWx8c2Nyb2xsYmFydGh1bWItdmVydGljYWx8c2Nyb2xsYmFydHJhY2staG9yaXpvbnRhbHxzY3JvbGxiYXJ0cmFjay12ZXJ0aWNhbHxzZWFyY2hmaWVsZHxzZXBhcmF0b3J8c2hlZXR8c3Bpbm5lcnxzcGlubmVyLWRvd25idXR0b258c3Bpbm5lci10ZXh0ZmllbGR8c3Bpbm5lci11cGJ1dHRvbnxzcGxpdHRlcnxzdGF0dXNiYXJ8c3RhdHVzYmFycGFuZWx8dGFifHRhYnBhbmVsfHRhYnBhbmVsc3x0YWItc2Nyb2xsLWFycm93LWJhY2t8dGFiLXNjcm9sbC1hcnJvdy1mb3J3YXJkfHRleHRmaWVsZHx0ZXh0ZmllbGQtbXVsdGlsaW5lfHRvb2xiYXJ8dG9vbGJhcmJ1dHRvbnx0b29sYmFyYnV0dG9uLWRyb3Bkb3dufHRvb2xiYXJncmlwcGVyfHRvb2xib3h8dG9vbHRpcHx0cmVlaGVhZGVyfHRyZWVoZWFkZXJjZWxsfHRyZWVoZWFkZXJzb3J0YXJyb3d8dHJlZWl0ZW18dHJlZWxpbmV8dHJlZXR3aXN0eXx0cmVldHdpc3R5b3Blbnx0cmVldmlld3wtbW96LW1hYy11bmlmaWVkLXRvb2xiYXJ8LW1vei13aW4tYm9yZGVybGVzcy1nbGFzc3wtbW96LXdpbi1icm93c2VydGFiYmFyLXRvb2xib3h8LW1vei13aW4tY29tbXVuaWNhdGlvbnN0ZXh0fC1tb3otd2luLWNvbW11bmljYXRpb25zLXRvb2xib3h8LW1vei13aW4tZXhjbHVkZS1nbGFzc3wtbW96LXdpbi1nbGFzc3wtbW96LXdpbi1tZWRpYXRleHR8LW1vei13aW4tbWVkaWEtdG9vbGJveHwtbW96LXdpbmRvdy1idXR0b24tYm94fC1tb3otd2luZG93LWJ1dHRvbi1ib3gtbWF4aW1pemVkfC1tb3otd2luZG93LWJ1dHRvbi1jbG9zZXwtbW96LXdpbmRvdy1idXR0b24tbWF4aW1pemV8LW1vei13aW5kb3ctYnV0dG9uLW1pbmltaXplfC1tb3otd2luZG93LWJ1dHRvbi1yZXN0b3JlfC1tb3otd2luZG93LWZyYW1lLWJvdHRvbXwtbW96LXdpbmRvdy1mcmFtZS1sZWZ0fC1tb3otd2luZG93LWZyYW1lLXJpZ2h0fC1tb3otd2luZG93LXRpdGxlYmFyfC1tb3otd2luZG93LXRpdGxlYmFyLW1heGltaXplZCIsCiAgICAgICAgIi1tb3otYmluZGluZyI6ICI8dXJsPnxub25lIiwKICAgICAgICAiLW1vei1ib3JkZXItYm90dG9tLWNvbG9ycyI6ICI8Y29sb3I+K3xub25lIiwKICAgICAgICAiLW1vei1ib3JkZXItbGVmdC1jb2xvcnMiOiAiPGNvbG9yPit8bm9uZSIsCiAgICAgICAgIi1tb3otYm9yZGVyLXJpZ2h0LWNvbG9ycyI6ICI8Y29sb3I+K3xub25lIiwKICAgICAgICAiLW1vei1ib3JkZXItdG9wLWNvbG9ycyI6ICI8Y29sb3I+K3xub25lIiwKICAgICAgICAiLW1vei1jb250ZXh0LXByb3BlcnRpZXMiOiAibm9uZXxbZmlsbHxmaWxsLW9wYWNpdHl8c3Ryb2tlfHN0cm9rZS1vcGFjaXR5XSMiLAogICAgICAgICItbW96LWZsb2F0LWVkZ2UiOiAiYm9yZGVyLWJveHxjb250ZW50LWJveHxtYXJnaW4tYm94fHBhZGRpbmctYm94IiwKICAgICAgICAiLW1vei1mb3JjZS1icm9rZW4taW1hZ2UtaWNvbiI6ICIwfDEiLAogICAgICAgICItbW96LWltYWdlLXJlZ2lvbiI6ICI8c2hhcGU+fGF1dG8iLAogICAgICAgICItbW96LW9yaWVudCI6ICJpbmxpbmV8YmxvY2t8aG9yaXpvbnRhbHx2ZXJ0aWNhbCIsCiAgICAgICAgIi1tb3otb3V0bGluZS1yYWRpdXMiOiAiPG91dGxpbmUtcmFkaXVzPnsxLDR9IFsvIDxvdXRsaW5lLXJhZGl1cz57MSw0fV0/IiwKICAgICAgICAiLW1vei1vdXRsaW5lLXJhZGl1cy1ib3R0b21sZWZ0IjogIjxvdXRsaW5lLXJhZGl1cz4iLAogICAgICAgICItbW96LW91dGxpbmUtcmFkaXVzLWJvdHRvbXJpZ2h0IjogIjxvdXRsaW5lLXJhZGl1cz4iLAogICAgICAgICItbW96LW91dGxpbmUtcmFkaXVzLXRvcGxlZnQiOiAiPG91dGxpbmUtcmFkaXVzPiIsCiAgICAgICAgIi1tb3otb3V0bGluZS1yYWRpdXMtdG9wcmlnaHQiOiAiPG91dGxpbmUtcmFkaXVzPiIsCiAgICAgICAgIi1tb3otc3RhY2stc2l6aW5nIjogImlnbm9yZXxzdHJldGNoLXRvLWZpdCIsCiAgICAgICAgIi1tb3otdGV4dC1ibGluayI6ICJub25lfGJsaW5rIiwKICAgICAgICAiLW1vei11c2VyLWZvY3VzIjogImlnbm9yZXxub3JtYWx8c2VsZWN0LWFmdGVyfHNlbGVjdC1iZWZvcmV8c2VsZWN0LW1lbnV8c2VsZWN0LXNhbWV8c2VsZWN0LWFsbHxub25lIiwKICAgICAgICAiLW1vei11c2VyLWlucHV0IjogImF1dG98bm9uZXxlbmFibGVkfGRpc2FibGVkIiwKICAgICAgICAiLW1vei11c2VyLW1vZGlmeSI6ICJyZWFkLW9ubHl8cmVhZC13cml0ZXx3cml0ZS1vbmx5IiwKICAgICAgICAiLW1vei13aW5kb3ctZHJhZ2dpbmciOiAiZHJhZ3xuby1kcmFnIiwKICAgICAgICAiLW1vei13aW5kb3ctc2hhZG93IjogImRlZmF1bHR8bWVudXx0b29sdGlwfHNoZWV0fG5vbmUiLAogICAgICAgICItd2Via2l0LWFwcGVhcmFuY2UiOiAibm9uZXxidXR0b258YnV0dG9uLWJldmVsfGNhcHMtbG9jay1pbmRpY2F0b3J8Y2FyZXR8Y2hlY2tib3h8ZGVmYXVsdC1idXR0b258aW5uZXItc3Bpbi1idXR0b258bGlzdGJveHxsaXN0aXRlbXxtZWRpYS1jb250cm9scy1iYWNrZ3JvdW5kfG1lZGlhLWNvbnRyb2xzLWZ1bGxzY3JlZW4tYmFja2dyb3VuZHxtZWRpYS1jdXJyZW50LXRpbWUtZGlzcGxheXxtZWRpYS1lbnRlci1mdWxsc2NyZWVuLWJ1dHRvbnxtZWRpYS1leGl0LWZ1bGxzY3JlZW4tYnV0dG9ufG1lZGlhLWZ1bGxzY3JlZW4tYnV0dG9ufG1lZGlhLW11dGUtYnV0dG9ufG1lZGlhLW92ZXJsYXktcGxheS1idXR0b258bWVkaWEtcGxheS1idXR0b258bWVkaWEtc2Vlay1iYWNrLWJ1dHRvbnxtZWRpYS1zZWVrLWZvcndhcmQtYnV0dG9ufG1lZGlhLXNsaWRlcnxtZWRpYS1zbGlkZXJ0aHVtYnxtZWRpYS10aW1lLXJlbWFpbmluZy1kaXNwbGF5fG1lZGlhLXRvZ2dsZS1jbG9zZWQtY2FwdGlvbnMtYnV0dG9ufG1lZGlhLXZvbHVtZS1zbGlkZXJ8bWVkaWEtdm9sdW1lLXNsaWRlci1jb250YWluZXJ8bWVkaWEtdm9sdW1lLXNsaWRlcnRodW1ifG1lbnVsaXN0fG1lbnVsaXN0LWJ1dHRvbnxtZW51bGlzdC10ZXh0fG1lbnVsaXN0LXRleHRmaWVsZHxtZXRlcnxwcm9ncmVzcy1iYXJ8cHJvZ3Jlc3MtYmFyLXZhbHVlfHB1c2gtYnV0dG9ufHJhZGlvfHNjcm9sbGJhcmJ1dHRvbi1kb3dufHNjcm9sbGJhcmJ1dHRvbi1sZWZ0fHNjcm9sbGJhcmJ1dHRvbi1yaWdodHxzY3JvbGxiYXJidXR0b24tdXB8c2Nyb2xsYmFyZ3JpcHBlci1ob3Jpem9udGFsfHNjcm9sbGJhcmdyaXBwZXItdmVydGljYWx8c2Nyb2xsYmFydGh1bWItaG9yaXpvbnRhbHxzY3JvbGxiYXJ0aHVtYi12ZXJ0aWNhbHxzY3JvbGxiYXJ0cmFjay1ob3Jpem9udGFsfHNjcm9sbGJhcnRyYWNrLXZlcnRpY2FsfHNlYXJjaGZpZWxkfHNlYXJjaGZpZWxkLWNhbmNlbC1idXR0b258c2VhcmNoZmllbGQtZGVjb3JhdGlvbnxzZWFyY2hmaWVsZC1yZXN1bHRzLWJ1dHRvbnxzZWFyY2hmaWVsZC1yZXN1bHRzLWRlY29yYXRpb258c2xpZGVyLWhvcml6b250YWx8c2xpZGVyLXZlcnRpY2FsfHNsaWRlcnRodW1iLWhvcml6b250YWx8c2xpZGVydGh1bWItdmVydGljYWx8c3F1YXJlLWJ1dHRvbnx0ZXh0YXJlYXx0ZXh0ZmllbGR8LWFwcGxlLXBheS1idXR0b24iLAogICAgICAgICItd2Via2l0LWJvcmRlci1iZWZvcmUiOiAiPCdib3JkZXItd2lkdGgnPnx8PCdib3JkZXItc3R5bGUnPnx8PGNvbG9yPiIsCiAgICAgICAgIi13ZWJraXQtYm9yZGVyLWJlZm9yZS1jb2xvciI6ICI8Y29sb3I+IiwKICAgICAgICAiLXdlYmtpdC1ib3JkZXItYmVmb3JlLXN0eWxlIjogIjwnYm9yZGVyLXN0eWxlJz4iLAogICAgICAgICItd2Via2l0LWJvcmRlci1iZWZvcmUtd2lkdGgiOiAiPCdib3JkZXItd2lkdGgnPiIsCiAgICAgICAgIi13ZWJraXQtYm94LXJlZmxlY3QiOiAiW2Fib3ZlfGJlbG93fHJpZ2h0fGxlZnRdPyA8bGVuZ3RoPj8gPGltYWdlPj8iLAogICAgICAgICItd2Via2l0LWxpbmUtY2xhbXAiOiAibm9uZXw8aW50ZWdlcj4iLAogICAgICAgICItd2Via2l0LW1hc2siOiAiWzxtYXNrLXJlZmVyZW5jZT58fDxwb3NpdGlvbj4gWy8gPGJnLXNpemU+XT98fDxyZXBlYXQtc3R5bGU+fHxbPGJveD58Ym9yZGVyfHBhZGRpbmd8Y29udGVudHx0ZXh0XXx8Wzxib3g+fGJvcmRlcnxwYWRkaW5nfGNvbnRlbnRdXSMiLAogICAgICAgICItd2Via2l0LW1hc2stYXR0YWNobWVudCI6ICI8YXR0YWNobWVudD4jIiwKICAgICAgICAiLXdlYmtpdC1tYXNrLWNsaXAiOiAiWzxib3g+fGJvcmRlcnxwYWRkaW5nfGNvbnRlbnR8dGV4dF0jIiwKICAgICAgICAiLXdlYmtpdC1tYXNrLWNvbXBvc2l0ZSI6ICI8Y29tcG9zaXRlLXN0eWxlPiMiLAogICAgICAgICItd2Via2l0LW1hc2staW1hZ2UiOiAiPG1hc2stcmVmZXJlbmNlPiMiLAogICAgICAgICItd2Via2l0LW1hc2stb3JpZ2luIjogIls8Ym94Pnxib3JkZXJ8cGFkZGluZ3xjb250ZW50XSMiLAogICAgICAgICItd2Via2l0LW1hc2stcG9zaXRpb24iOiAiPHBvc2l0aW9uPiMiLAogICAgICAgICItd2Via2l0LW1hc2stcG9zaXRpb24teCI6ICJbPGxlbmd0aC1wZXJjZW50YWdlPnxsZWZ0fGNlbnRlcnxyaWdodF0jIiwKICAgICAgICAiLXdlYmtpdC1tYXNrLXBvc2l0aW9uLXkiOiAiWzxsZW5ndGgtcGVyY2VudGFnZT58dG9wfGNlbnRlcnxib3R0b21dIyIsCiAgICAgICAgIi13ZWJraXQtbWFzay1yZXBlYXQiOiAiPHJlcGVhdC1zdHlsZT4jIiwKICAgICAgICAiLXdlYmtpdC1tYXNrLXJlcGVhdC14IjogInJlcGVhdHxuby1yZXBlYXR8c3BhY2V8cm91bmQiLAogICAgICAgICItd2Via2l0LW1hc2stcmVwZWF0LXkiOiAicmVwZWF0fG5vLXJlcGVhdHxzcGFjZXxyb3VuZCIsCiAgICAgICAgIi13ZWJraXQtbWFzay1zaXplIjogIjxiZy1zaXplPiMiLAogICAgICAgICItd2Via2l0LW92ZXJmbG93LXNjcm9sbGluZyI6ICJhdXRvfHRvdWNoIiwKICAgICAgICAiLXdlYmtpdC10YXAtaGlnaGxpZ2h0LWNvbG9yIjogIjxjb2xvcj4iLAogICAgICAgICItd2Via2l0LXRleHQtZmlsbC1jb2xvciI6ICI8Y29sb3I+IiwKICAgICAgICAiLXdlYmtpdC10ZXh0LXN0cm9rZSI6ICI8bGVuZ3RoPnx8PGNvbG9yPiIsCiAgICAgICAgIi13ZWJraXQtdGV4dC1zdHJva2UtY29sb3IiOiAiPGNvbG9yPiIsCiAgICAgICAgIi13ZWJraXQtdGV4dC1zdHJva2Utd2lkdGgiOiAiPGxlbmd0aD4iLAogICAgICAgICItd2Via2l0LXRvdWNoLWNhbGxvdXQiOiAiZGVmYXVsdHxub25lIiwKICAgICAgICAiLXdlYmtpdC11c2VyLW1vZGlmeSI6ICJyZWFkLW9ubHl8cmVhZC13cml0ZXxyZWFkLXdyaXRlLXBsYWludGV4dC1vbmx5IiwKICAgICAgICAiYWNjZW50LWNvbG9yIjogImF1dG98PGNvbG9yPiIsCiAgICAgICAgImFsaWduLWNvbnRlbnQiOiAibm9ybWFsfDxiYXNlbGluZS1wb3NpdGlvbj58PGNvbnRlbnQtZGlzdHJpYnV0aW9uPnw8b3ZlcmZsb3ctcG9zaXRpb24+PyA8Y29udGVudC1wb3NpdGlvbj4iLAogICAgICAgICJhbGlnbi1pdGVtcyI6ICJub3JtYWx8c3RyZXRjaHw8YmFzZWxpbmUtcG9zaXRpb24+fFs8b3ZlcmZsb3ctcG9zaXRpb24+PyA8c2VsZi1wb3NpdGlvbj5dIiwKICAgICAgICAiYWxpZ24tc2VsZiI6ICJhdXRvfG5vcm1hbHxzdHJldGNofDxiYXNlbGluZS1wb3NpdGlvbj58PG92ZXJmbG93LXBvc2l0aW9uPj8gPHNlbGYtcG9zaXRpb24+IiwKICAgICAgICAiYWxpZ24tdHJhY2tzIjogIltub3JtYWx8PGJhc2VsaW5lLXBvc2l0aW9uPnw8Y29udGVudC1kaXN0cmlidXRpb24+fDxvdmVyZmxvdy1wb3NpdGlvbj4/IDxjb250ZW50LXBvc2l0aW9uPl0jIiwKICAgICAgICAiYWxsIjogImluaXRpYWx8aW5oZXJpdHx1bnNldHxyZXZlcnR8cmV2ZXJ0LWxheWVyIiwKICAgICAgICAiYW5pbWF0aW9uIjogIjxzaW5nbGUtYW5pbWF0aW9uPiMiLAogICAgICAgICJhbmltYXRpb24tY29tcG9zaXRpb24iOiAiPHNpbmdsZS1hbmltYXRpb24tY29tcG9zaXRpb24+IyIsCiAgICAgICAgImFuaW1hdGlvbi1kZWxheSI6ICI8dGltZT4jIiwKICAgICAgICAiYW5pbWF0aW9uLWRpcmVjdGlvbiI6ICI8c2luZ2xlLWFuaW1hdGlvbi1kaXJlY3Rpb24+IyIsCiAgICAgICAgImFuaW1hdGlvbi1kdXJhdGlvbiI6ICI8dGltZT4jIiwKICAgICAgICAiYW5pbWF0aW9uLWZpbGwtbW9kZSI6ICI8c2luZ2xlLWFuaW1hdGlvbi1maWxsLW1vZGU+IyIsCiAgICAgICAgImFuaW1hdGlvbi1pdGVyYXRpb24tY291bnQiOiAiPHNpbmdsZS1hbmltYXRpb24taXRlcmF0aW9uLWNvdW50PiMiLAogICAgICAgICJhbmltYXRpb24tbmFtZSI6ICJbbm9uZXw8a2V5ZnJhbWVzLW5hbWU+XSMiLAogICAgICAgICJhbmltYXRpb24tcGxheS1zdGF0ZSI6ICI8c2luZ2xlLWFuaW1hdGlvbi1wbGF5LXN0YXRlPiMiLAogICAgICAgICJhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uIjogIjxlYXNpbmctZnVuY3Rpb24+IyIsCiAgICAgICAgImFuaW1hdGlvbi10aW1lbGluZSI6ICI8c2luZ2xlLWFuaW1hdGlvbi10aW1lbGluZT4jIiwKICAgICAgICAiYXBwZWFyYW5jZSI6ICJub25lfGF1dG98dGV4dGZpZWxkfG1lbnVsaXN0LWJ1dHRvbnw8Y29tcGF0LWF1dG8+IiwKICAgICAgICAiYXNwZWN0LXJhdGlvIjogImF1dG98PHJhdGlvPiIsCiAgICAgICAgImF6aW11dGgiOiAiPGFuZ2xlPnxbW2xlZnQtc2lkZXxmYXItbGVmdHxsZWZ0fGNlbnRlci1sZWZ0fGNlbnRlcnxjZW50ZXItcmlnaHR8cmlnaHR8ZmFyLXJpZ2h0fHJpZ2h0LXNpZGVdfHxiZWhpbmRdfGxlZnR3YXJkc3xyaWdodHdhcmRzIiwKICAgICAgICAiYmFja2Ryb3AtZmlsdGVyIjogIm5vbmV8PGZpbHRlci1mdW5jdGlvbi1saXN0PiIsCiAgICAgICAgImJhY2tmYWNlLXZpc2liaWxpdHkiOiAidmlzaWJsZXxoaWRkZW4iLAogICAgICAgICJiYWNrZ3JvdW5kIjogIls8YmctbGF5ZXI+ICxdKiA8ZmluYWwtYmctbGF5ZXI+IiwKICAgICAgICAiYmFja2dyb3VuZC1hdHRhY2htZW50IjogIjxhdHRhY2htZW50PiMiLAogICAgICAgICJiYWNrZ3JvdW5kLWJsZW5kLW1vZGUiOiAiPGJsZW5kLW1vZGU+IyIsCiAgICAgICAgImJhY2tncm91bmQtY2xpcCI6ICI8YmctY2xpcD4jIiwKICAgICAgICAiYmFja2dyb3VuZC1jb2xvciI6ICI8Y29sb3I+IiwKICAgICAgICAiYmFja2dyb3VuZC1pbWFnZSI6ICI8YmctaW1hZ2U+IyIsCiAgICAgICAgImJhY2tncm91bmQtb3JpZ2luIjogIjxib3g+IyIsCiAgICAgICAgImJhY2tncm91bmQtcG9zaXRpb24iOiAiPGJnLXBvc2l0aW9uPiMiLAogICAgICAgICJiYWNrZ3JvdW5kLXBvc2l0aW9uLXgiOiAiW2NlbnRlcnxbW2xlZnR8cmlnaHR8eC1zdGFydHx4LWVuZF0/IDxsZW5ndGgtcGVyY2VudGFnZT4/XSFdIyIsCiAgICAgICAgImJhY2tncm91bmQtcG9zaXRpb24teSI6ICJbY2VudGVyfFtbdG9wfGJvdHRvbXx5LXN0YXJ0fHktZW5kXT8gPGxlbmd0aC1wZXJjZW50YWdlPj9dIV0jIiwKICAgICAgICAiYmFja2dyb3VuZC1yZXBlYXQiOiAiPHJlcGVhdC1zdHlsZT4jIiwKICAgICAgICAiYmFja2dyb3VuZC1zaXplIjogIjxiZy1zaXplPiMiLAogICAgICAgICJibG9jay1vdmVyZmxvdyI6ICJjbGlwfGVsbGlwc2lzfDxzdHJpbmc+IiwKICAgICAgICAiYmxvY2stc2l6ZSI6ICI8J3dpZHRoJz4iLAogICAgICAgICJib3JkZXIiOiAiPGxpbmUtd2lkdGg+fHw8bGluZS1zdHlsZT58fDxjb2xvcj4iLAogICAgICAgICJib3JkZXItYmxvY2siOiAiPCdib3JkZXItdG9wLXdpZHRoJz58fDwnYm9yZGVyLXRvcC1zdHlsZSc+fHw8Y29sb3I+IiwKICAgICAgICAiYm9yZGVyLWJsb2NrLWNvbG9yIjogIjwnYm9yZGVyLXRvcC1jb2xvcic+ezEsMn0iLAogICAgICAgICJib3JkZXItYmxvY2stc3R5bGUiOiAiPCdib3JkZXItdG9wLXN0eWxlJz4iLAogICAgICAgICJib3JkZXItYmxvY2std2lkdGgiOiAiPCdib3JkZXItdG9wLXdpZHRoJz4iLAogICAgICAgICJib3JkZXItYmxvY2stZW5kIjogIjwnYm9yZGVyLXRvcC13aWR0aCc+fHw8J2JvcmRlci10b3Atc3R5bGUnPnx8PGNvbG9yPiIsCiAgICAgICAgImJvcmRlci1ibG9jay1lbmQtY29sb3IiOiAiPCdib3JkZXItdG9wLWNvbG9yJz4iLAogICAgICAgICJib3JkZXItYmxvY2stZW5kLXN0eWxlIjogIjwnYm9yZGVyLXRvcC1zdHlsZSc+IiwKICAgICAgICAiYm9yZGVyLWJsb2NrLWVuZC13aWR0aCI6ICI8J2JvcmRlci10b3Atd2lkdGgnPiIsCiAgICAgICAgImJvcmRlci1ibG9jay1zdGFydCI6ICI8J2JvcmRlci10b3Atd2lkdGgnPnx8PCdib3JkZXItdG9wLXN0eWxlJz58fDxjb2xvcj4iLAogICAgICAgICJib3JkZXItYmxvY2stc3RhcnQtY29sb3IiOiAiPCdib3JkZXItdG9wLWNvbG9yJz4iLAogICAgICAgICJib3JkZXItYmxvY2stc3RhcnQtc3R5bGUiOiAiPCdib3JkZXItdG9wLXN0eWxlJz4iLAogICAgICAgICJib3JkZXItYmxvY2stc3RhcnQtd2lkdGgiOiAiPCdib3JkZXItdG9wLXdpZHRoJz4iLAogICAgICAgICJib3JkZXItYm90dG9tIjogIjxsaW5lLXdpZHRoPnx8PGxpbmUtc3R5bGU+fHw8Y29sb3I+IiwKICAgICAgICAiYm9yZGVyLWJvdHRvbS1jb2xvciI6ICI8J2JvcmRlci10b3AtY29sb3InPiIsCiAgICAgICAgImJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXMiOiAiPGxlbmd0aC1wZXJjZW50YWdlPnsxLDJ9IiwKICAgICAgICAiYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXMiOiAiPGxlbmd0aC1wZXJjZW50YWdlPnsxLDJ9IiwKICAgICAgICAiYm9yZGVyLWJvdHRvbS1zdHlsZSI6ICI8bGluZS1zdHlsZT4iLAogICAgICAgICJib3JkZXItYm90dG9tLXdpZHRoIjogIjxsaW5lLXdpZHRoPiIsCiAgICAgICAgImJvcmRlci1jb2xsYXBzZSI6ICJjb2xsYXBzZXxzZXBhcmF0ZSIsCiAgICAgICAgImJvcmRlci1jb2xvciI6ICI8Y29sb3I+ezEsNH0iLAogICAgICAgICJib3JkZXItZW5kLWVuZC1yYWRpdXMiOiAiPGxlbmd0aC1wZXJjZW50YWdlPnsxLDJ9IiwKICAgICAgICAiYm9yZGVyLWVuZC1zdGFydC1yYWRpdXMiOiAiPGxlbmd0aC1wZXJjZW50YWdlPnsxLDJ9IiwKICAgICAgICAiYm9yZGVyLWltYWdlIjogIjwnYm9yZGVyLWltYWdlLXNvdXJjZSc+fHw8J2JvcmRlci1pbWFnZS1zbGljZSc+IFsvIDwnYm9yZGVyLWltYWdlLXdpZHRoJz58LyA8J2JvcmRlci1pbWFnZS13aWR0aCc+PyAvIDwnYm9yZGVyLWltYWdlLW91dHNldCc+XT98fDwnYm9yZGVyLWltYWdlLXJlcGVhdCc+IiwKICAgICAgICAiYm9yZGVyLWltYWdlLW91dHNldCI6ICJbPGxlbmd0aD58PG51bWJlcj5dezEsNH0iLAogICAgICAgICJib3JkZXItaW1hZ2UtcmVwZWF0IjogIltzdHJldGNofHJlcGVhdHxyb3VuZHxzcGFjZV17MSwyfSIsCiAgICAgICAgImJvcmRlci1pbWFnZS1zbGljZSI6ICI8bnVtYmVyLXBlcmNlbnRhZ2U+ezEsNH0mJmZpbGw/IiwKICAgICAgICAiYm9yZGVyLWltYWdlLXNvdXJjZSI6ICJub25lfDxpbWFnZT4iLAogICAgICAgICJib3JkZXItaW1hZ2Utd2lkdGgiOiAiWzxsZW5ndGgtcGVyY2VudGFnZT58PG51bWJlcj58YXV0b117MSw0fSIsCiAgICAgICAgImJvcmRlci1pbmxpbmUiOiAiPCdib3JkZXItdG9wLXdpZHRoJz58fDwnYm9yZGVyLXRvcC1zdHlsZSc+fHw8Y29sb3I+IiwKICAgICAgICAiYm9yZGVyLWlubGluZS1lbmQiOiAiPCdib3JkZXItdG9wLXdpZHRoJz58fDwnYm9yZGVyLXRvcC1zdHlsZSc+fHw8Y29sb3I+IiwKICAgICAgICAiYm9yZGVyLWlubGluZS1jb2xvciI6ICI8J2JvcmRlci10b3AtY29sb3InPnsxLDJ9IiwKICAgICAgICAiYm9yZGVyLWlubGluZS1zdHlsZSI6ICI8J2JvcmRlci10b3Atc3R5bGUnPiIsCiAgICAgICAgImJvcmRlci1pbmxpbmUtd2lkdGgiOiAiPCdib3JkZXItdG9wLXdpZHRoJz4iLAogICAgICAgICJib3JkZXItaW5saW5lLWVuZC1jb2xvciI6ICI8J2JvcmRlci10b3AtY29sb3InPiIsCiAgICAgICAgImJvcmRlci1pbmxpbmUtZW5kLXN0eWxlIjogIjwnYm9yZGVyLXRvcC1zdHlsZSc+IiwKICAgICAgICAiYm9yZGVyLWlubGluZS1lbmQtd2lkdGgiOiAiPCdib3JkZXItdG9wLXdpZHRoJz4iLAogICAgICAgICJib3JkZXItaW5saW5lLXN0YXJ0IjogIjwnYm9yZGVyLXRvcC13aWR0aCc+fHw8J2JvcmRlci10b3Atc3R5bGUnPnx8PGNvbG9yPiIsCiAgICAgICAgImJvcmRlci1pbmxpbmUtc3RhcnQtY29sb3IiOiAiPCdib3JkZXItdG9wLWNvbG9yJz4iLAogICAgICAgICJib3JkZXItaW5saW5lLXN0YXJ0LXN0eWxlIjogIjwnYm9yZGVyLXRvcC1zdHlsZSc+IiwKICAgICAgICAiYm9yZGVyLWlubGluZS1zdGFydC13aWR0aCI6ICI8J2JvcmRlci10b3Atd2lkdGgnPiIsCiAgICAgICAgImJvcmRlci1sZWZ0IjogIjxsaW5lLXdpZHRoPnx8PGxpbmUtc3R5bGU+fHw8Y29sb3I+IiwKICAgICAgICAiYm9yZGVyLWxlZnQtY29sb3IiOiAiPGNvbG9yPiIsCiAgICAgICAgImJvcmRlci1sZWZ0LXN0eWxlIjogIjxsaW5lLXN0eWxlPiIsCiAgICAgICAgImJvcmRlci1sZWZ0LXdpZHRoIjogIjxsaW5lLXdpZHRoPiIsCiAgICAgICAgImJvcmRlci1yYWRpdXMiOiAiPGxlbmd0aC1wZXJjZW50YWdlPnsxLDR9IFsvIDxsZW5ndGgtcGVyY2VudGFnZT57MSw0fV0/IiwKICAgICAgICAiYm9yZGVyLXJpZ2h0IjogIjxsaW5lLXdpZHRoPnx8PGxpbmUtc3R5bGU+fHw8Y29sb3I+IiwKICAgICAgICAiYm9yZGVyLXJpZ2h0LWNvbG9yIjogIjxjb2xvcj4iLAogICAgICAgICJib3JkZXItcmlnaHQtc3R5bGUiOiAiPGxpbmUtc3R5bGU+IiwKICAgICAgICAiYm9yZGVyLXJpZ2h0LXdpZHRoIjogIjxsaW5lLXdpZHRoPiIsCiAgICAgICAgImJvcmRlci1zcGFjaW5nIjogIjxsZW5ndGg+IDxsZW5ndGg+PyIsCiAgICAgICAgImJvcmRlci1zdGFydC1lbmQtcmFkaXVzIjogIjxsZW5ndGgtcGVyY2VudGFnZT57MSwyfSIsCiAgICAgICAgImJvcmRlci1zdGFydC1zdGFydC1yYWRpdXMiOiAiPGxlbmd0aC1wZXJjZW50YWdlPnsxLDJ9IiwKICAgICAgICAiYm9yZGVyLXN0eWxlIjogIjxsaW5lLXN0eWxlPnsxLDR9IiwKICAgICAgICAiYm9yZGVyLXRvcCI6ICI8bGluZS13aWR0aD58fDxsaW5lLXN0eWxlPnx8PGNvbG9yPiIsCiAgICAgICAgImJvcmRlci10b3AtY29sb3IiOiAiPGNvbG9yPiIsCiAgICAgICAgImJvcmRlci10b3AtbGVmdC1yYWRpdXMiOiAiPGxlbmd0aC1wZXJjZW50YWdlPnsxLDJ9IiwKICAgICAgICAiYm9yZGVyLXRvcC1yaWdodC1yYWRpdXMiOiAiPGxlbmd0aC1wZXJjZW50YWdlPnsxLDJ9IiwKICAgICAgICAiYm9yZGVyLXRvcC1zdHlsZSI6ICI8bGluZS1zdHlsZT4iLAogICAgICAgICJib3JkZXItdG9wLXdpZHRoIjogIjxsaW5lLXdpZHRoPiIsCiAgICAgICAgImJvcmRlci13aWR0aCI6ICI8bGluZS13aWR0aD57MSw0fSIsCiAgICAgICAgImJvdHRvbSI6ICI8bGVuZ3RoPnw8cGVyY2VudGFnZT58YXV0byIsCiAgICAgICAgImJveC1hbGlnbiI6ICJzdGFydHxjZW50ZXJ8ZW5kfGJhc2VsaW5lfHN0cmV0Y2giLAogICAgICAgICJib3gtZGVjb3JhdGlvbi1icmVhayI6ICJzbGljZXxjbG9uZSIsCiAgICAgICAgImJveC1kaXJlY3Rpb24iOiAibm9ybWFsfHJldmVyc2V8aW5oZXJpdCIsCiAgICAgICAgImJveC1mbGV4IjogIjxudW1iZXI+IiwKICAgICAgICAiYm94LWZsZXgtZ3JvdXAiOiAiPGludGVnZXI+IiwKICAgICAgICAiYm94LWxpbmVzIjogInNpbmdsZXxtdWx0aXBsZSIsCiAgICAgICAgImJveC1vcmRpbmFsLWdyb3VwIjogIjxpbnRlZ2VyPiIsCiAgICAgICAgImJveC1vcmllbnQiOiAiaG9yaXpvbnRhbHx2ZXJ0aWNhbHxpbmxpbmUtYXhpc3xibG9jay1heGlzfGluaGVyaXQiLAogICAgICAgICJib3gtcGFjayI6ICJzdGFydHxjZW50ZXJ8ZW5kfGp1c3RpZnkiLAogICAgICAgICJib3gtc2hhZG93IjogIm5vbmV8PHNoYWRvdz4jIiwKICAgICAgICAiYm94LXNpemluZyI6ICJjb250ZW50LWJveHxib3JkZXItYm94IiwKICAgICAgICAiYnJlYWstYWZ0ZXIiOiAiYXV0b3xhdm9pZHxhbHdheXN8YWxsfGF2b2lkLXBhZ2V8cGFnZXxsZWZ0fHJpZ2h0fHJlY3RvfHZlcnNvfGF2b2lkLWNvbHVtbnxjb2x1bW58YXZvaWQtcmVnaW9ufHJlZ2lvbiIsCiAgICAgICAgImJyZWFrLWJlZm9yZSI6ICJhdXRvfGF2b2lkfGFsd2F5c3xhbGx8YXZvaWQtcGFnZXxwYWdlfGxlZnR8cmlnaHR8cmVjdG98dmVyc298YXZvaWQtY29sdW1ufGNvbHVtbnxhdm9pZC1yZWdpb258cmVnaW9uIiwKICAgICAgICAiYnJlYWstaW5zaWRlIjogImF1dG98YXZvaWR8YXZvaWQtcGFnZXxhdm9pZC1jb2x1bW58YXZvaWQtcmVnaW9uIiwKICAgICAgICAiY2FwdGlvbi1zaWRlIjogInRvcHxib3R0b218YmxvY2stc3RhcnR8YmxvY2stZW5kfGlubGluZS1zdGFydHxpbmxpbmUtZW5kIiwKICAgICAgICAiY2FyZXQiOiAiPCdjYXJldC1jb2xvcic+fHw8J2NhcmV0LXNoYXBlJz4iLAogICAgICAgICJjYXJldC1jb2xvciI6ICJhdXRvfDxjb2xvcj4iLAogICAgICAgICJjYXJldC1zaGFwZSI6ICJhdXRvfGJhcnxibG9ja3x1bmRlcnNjb3JlIiwKICAgICAgICAiY2xlYXIiOiAibm9uZXxsZWZ0fHJpZ2h0fGJvdGh8aW5saW5lLXN0YXJ0fGlubGluZS1lbmQiLAogICAgICAgICJjbGlwIjogIjxzaGFwZT58YXV0byIsCiAgICAgICAgImNsaXAtcGF0aCI6ICI8Y2xpcC1zb3VyY2U+fFs8YmFzaWMtc2hhcGU+fHw8Z2VvbWV0cnktYm94Pl18bm9uZSIsCiAgICAgICAgImNvbG9yIjogIjxjb2xvcj4iLAogICAgICAgICJwcmludC1jb2xvci1hZGp1c3QiOiAiZWNvbm9teXxleGFjdCIsCiAgICAgICAgImNvbG9yLXNjaGVtZSI6ICJub3JtYWx8W2xpZ2h0fGRhcmt8PGN1c3RvbS1pZGVudD5dKyYmb25seT8iLAogICAgICAgICJjb2x1bW4tY291bnQiOiAiPGludGVnZXI+fGF1dG8iLAogICAgICAgICJjb2x1bW4tZmlsbCI6ICJhdXRvfGJhbGFuY2V8YmFsYW5jZS1hbGwiLAogICAgICAgICJjb2x1bW4tZ2FwIjogIm5vcm1hbHw8bGVuZ3RoLXBlcmNlbnRhZ2U+IiwKICAgICAgICAiY29sdW1uLXJ1bGUiOiAiPCdjb2x1bW4tcnVsZS13aWR0aCc+fHw8J2NvbHVtbi1ydWxlLXN0eWxlJz58fDwnY29sdW1uLXJ1bGUtY29sb3InPiIsCiAgICAgICAgImNvbHVtbi1ydWxlLWNvbG9yIjogIjxjb2xvcj4iLAogICAgICAgICJjb2x1bW4tcnVsZS1zdHlsZSI6ICI8J2JvcmRlci1zdHlsZSc+IiwKICAgICAgICAiY29sdW1uLXJ1bGUtd2lkdGgiOiAiPCdib3JkZXItd2lkdGgnPiIsCiAgICAgICAgImNvbHVtbi1zcGFuIjogIm5vbmV8YWxsIiwKICAgICAgICAiY29sdW1uLXdpZHRoIjogIjxsZW5ndGg+fGF1dG8iLAogICAgICAgICJjb2x1bW5zIjogIjwnY29sdW1uLXdpZHRoJz58fDwnY29sdW1uLWNvdW50Jz4iLAogICAgICAgICJjb250YWluIjogIm5vbmV8c3RyaWN0fGNvbnRlbnR8W1tzaXplfHxpbmxpbmUtc2l6ZV18fGxheW91dHx8c3R5bGV8fHBhaW50XSIsCiAgICAgICAgImNvbnRhaW4taW50cmluc2ljLXNpemUiOiAiW25vbmV8PGxlbmd0aD58YXV0byA8bGVuZ3RoPl17MSwyfSIsCiAgICAgICAgImNvbnRhaW4taW50cmluc2ljLWJsb2NrLXNpemUiOiAibm9uZXw8bGVuZ3RoPnxhdXRvIDxsZW5ndGg+IiwKICAgICAgICAiY29udGFpbi1pbnRyaW5zaWMtaGVpZ2h0IjogIm5vbmV8PGxlbmd0aD58YXV0byA8bGVuZ3RoPiIsCiAgICAgICAgImNvbnRhaW4taW50cmluc2ljLWlubGluZS1zaXplIjogIm5vbmV8PGxlbmd0aD58YXV0byA8bGVuZ3RoPiIsCiAgICAgICAgImNvbnRhaW4taW50cmluc2ljLXdpZHRoIjogIm5vbmV8PGxlbmd0aD58YXV0byA8bGVuZ3RoPiIsCiAgICAgICAgImNvbnRlbnQiOiAibm9ybWFsfG5vbmV8Wzxjb250ZW50LXJlcGxhY2VtZW50Pnw8Y29udGVudC1saXN0Pl0gWy8gWzxzdHJpbmc+fDxjb3VudGVyPl0rXT8iLAogICAgICAgICJjb250ZW50LXZpc2liaWxpdHkiOiAidmlzaWJsZXxhdXRvfGhpZGRlbiIsCiAgICAgICAgImNvdW50ZXItaW5jcmVtZW50IjogIls8Y291bnRlci1uYW1lPiA8aW50ZWdlcj4/XSt8bm9uZSIsCiAgICAgICAgImNvdW50ZXItcmVzZXQiOiAiWzxjb3VudGVyLW5hbWU+IDxpbnRlZ2VyPj98PHJldmVyc2VkLWNvdW50ZXItbmFtZT4gPGludGVnZXI+P10rfG5vbmUiLAogICAgICAgICJjb3VudGVyLXNldCI6ICJbPGNvdW50ZXItbmFtZT4gPGludGVnZXI+P10rfG5vbmUiLAogICAgICAgICJjdXJzb3IiOiAiW1s8dXJsPiBbPHg+IDx5Pl0/ICxdKiBbYXV0b3xkZWZhdWx0fG5vbmV8Y29udGV4dC1tZW51fGhlbHB8cG9pbnRlcnxwcm9ncmVzc3x3YWl0fGNlbGx8Y3Jvc3NoYWlyfHRleHR8dmVydGljYWwtdGV4dHxhbGlhc3xjb3B5fG1vdmV8bm8tZHJvcHxub3QtYWxsb3dlZHxlLXJlc2l6ZXxuLXJlc2l6ZXxuZS1yZXNpemV8bnctcmVzaXplfHMtcmVzaXplfHNlLXJlc2l6ZXxzdy1yZXNpemV8dy1yZXNpemV8ZXctcmVzaXplfG5zLXJlc2l6ZXxuZXN3LXJlc2l6ZXxud3NlLXJlc2l6ZXxjb2wtcmVzaXplfHJvdy1yZXNpemV8YWxsLXNjcm9sbHx6b29tLWlufHpvb20tb3V0fGdyYWJ8Z3JhYmJpbmd8aGFuZHwtd2Via2l0LWdyYWJ8LXdlYmtpdC1ncmFiYmluZ3wtd2Via2l0LXpvb20taW58LXdlYmtpdC16b29tLW91dHwtbW96LWdyYWJ8LW1vei1ncmFiYmluZ3wtbW96LXpvb20taW58LW1vei16b29tLW91dF1dIiwKICAgICAgICAiZGlyZWN0aW9uIjogImx0cnxydGwiLAogICAgICAgICJkaXNwbGF5IjogIls8ZGlzcGxheS1vdXRzaWRlPnx8PGRpc3BsYXktaW5zaWRlPl18PGRpc3BsYXktbGlzdGl0ZW0+fDxkaXNwbGF5LWludGVybmFsPnw8ZGlzcGxheS1ib3g+fDxkaXNwbGF5LWxlZ2FjeT58PC1ub24tc3RhbmRhcmQtZGlzcGxheT4iLAogICAgICAgICJlbXB0eS1jZWxscyI6ICJzaG93fGhpZGUiLAogICAgICAgICJmaWx0ZXIiOiAibm9uZXw8ZmlsdGVyLWZ1bmN0aW9uLWxpc3Q+fDwtbXMtZmlsdGVyLWZ1bmN0aW9uLWxpc3Q+IiwKICAgICAgICAiZmxleCI6ICJub25lfFs8J2ZsZXgtZ3Jvdyc+IDwnZmxleC1zaHJpbmsnPj98fDwnZmxleC1iYXNpcyc+XSIsCiAgICAgICAgImZsZXgtYmFzaXMiOiAiY29udGVudHw8J3dpZHRoJz4iLAogICAgICAgICJmbGV4LWRpcmVjdGlvbiI6ICJyb3d8cm93LXJldmVyc2V8Y29sdW1ufGNvbHVtbi1yZXZlcnNlIiwKICAgICAgICAiZmxleC1mbG93IjogIjwnZmxleC1kaXJlY3Rpb24nPnx8PCdmbGV4LXdyYXAnPiIsCiAgICAgICAgImZsZXgtZ3JvdyI6ICI8bnVtYmVyPiIsCiAgICAgICAgImZsZXgtc2hyaW5rIjogIjxudW1iZXI+IiwKICAgICAgICAiZmxleC13cmFwIjogIm5vd3JhcHx3cmFwfHdyYXAtcmV2ZXJzZSIsCiAgICAgICAgImZsb2F0IjogImxlZnR8cmlnaHR8bm9uZXxpbmxpbmUtc3RhcnR8aW5saW5lLWVuZCIsCiAgICAgICAgImZvbnQiOiAiW1s8J2ZvbnQtc3R5bGUnPnx8PGZvbnQtdmFyaWFudC1jc3MyMT58fDwnZm9udC13ZWlnaHQnPnx8PCdmb250LXN0cmV0Y2gnPl0/IDwnZm9udC1zaXplJz4gWy8gPCdsaW5lLWhlaWdodCc+XT8gPCdmb250LWZhbWlseSc+XXxjYXB0aW9ufGljb258bWVudXxtZXNzYWdlLWJveHxzbWFsbC1jYXB0aW9ufHN0YXR1cy1iYXIiLAogICAgICAgICJmb250LWZhbWlseSI6ICJbPGZhbWlseS1uYW1lPnw8Z2VuZXJpYy1mYW1pbHk+XSMiLAogICAgICAgICJmb250LWZlYXR1cmUtc2V0dGluZ3MiOiAibm9ybWFsfDxmZWF0dXJlLXRhZy12YWx1ZT4jIiwKICAgICAgICAiZm9udC1rZXJuaW5nIjogImF1dG98bm9ybWFsfG5vbmUiLAogICAgICAgICJmb250LWxhbmd1YWdlLW92ZXJyaWRlIjogIm5vcm1hbHw8c3RyaW5nPiIsCiAgICAgICAgImZvbnQtb3B0aWNhbC1zaXppbmciOiAiYXV0b3xub25lIiwKICAgICAgICAiZm9udC12YXJpYXRpb24tc2V0dGluZ3MiOiAibm9ybWFsfFs8c3RyaW5nPiA8bnVtYmVyPl0jIiwKICAgICAgICAiZm9udC1zaXplIjogIjxhYnNvbHV0ZS1zaXplPnw8cmVsYXRpdmUtc2l6ZT58PGxlbmd0aC1wZXJjZW50YWdlPiIsCiAgICAgICAgImZvbnQtc2l6ZS1hZGp1c3QiOiAibm9uZXxbZXgtaGVpZ2h0fGNhcC1oZWlnaHR8Y2gtd2lkdGh8aWMtd2lkdGh8aWMtaGVpZ2h0XT8gW2Zyb20tZm9udHw8bnVtYmVyPl0iLAogICAgICAgICJmb250LXNtb290aCI6ICJhdXRvfG5ldmVyfGFsd2F5c3w8YWJzb2x1dGUtc2l6ZT58PGxlbmd0aD4iLAogICAgICAgICJmb250LXN0cmV0Y2giOiAiPGZvbnQtc3RyZXRjaC1hYnNvbHV0ZT4iLAogICAgICAgICJmb250LXN0eWxlIjogIm5vcm1hbHxpdGFsaWN8b2JsaXF1ZSA8YW5nbGU+PyIsCiAgICAgICAgImZvbnQtc3ludGhlc2lzIjogIm5vbmV8W3dlaWdodHx8c3R5bGV8fHNtYWxsLWNhcHNdIiwKICAgICAgICAiZm9udC12YXJpYW50IjogIm5vcm1hbHxub25lfFs8Y29tbW9uLWxpZy12YWx1ZXM+fHw8ZGlzY3JldGlvbmFyeS1saWctdmFsdWVzPnx8PGhpc3RvcmljYWwtbGlnLXZhbHVlcz58fDxjb250ZXh0dWFsLWFsdC12YWx1ZXM+fHxzdHlsaXN0aWMoIDxmZWF0dXJlLXZhbHVlLW5hbWU+ICl8fGhpc3RvcmljYWwtZm9ybXN8fHN0eWxlc2V0KCA8ZmVhdHVyZS12YWx1ZS1uYW1lPiMgKXx8Y2hhcmFjdGVyLXZhcmlhbnQoIDxmZWF0dXJlLXZhbHVlLW5hbWU+IyApfHxzd2FzaCggPGZlYXR1cmUtdmFsdWUtbmFtZT4gKXx8b3JuYW1lbnRzKCA8ZmVhdHVyZS12YWx1ZS1uYW1lPiApfHxhbm5vdGF0aW9uKCA8ZmVhdHVyZS12YWx1ZS1uYW1lPiApfHxbc21hbGwtY2Fwc3xhbGwtc21hbGwtY2Fwc3xwZXRpdGUtY2Fwc3xhbGwtcGV0aXRlLWNhcHN8dW5pY2FzZXx0aXRsaW5nLWNhcHNdfHw8bnVtZXJpYy1maWd1cmUtdmFsdWVzPnx8PG51bWVyaWMtc3BhY2luZy12YWx1ZXM+fHw8bnVtZXJpYy1mcmFjdGlvbi12YWx1ZXM+fHxvcmRpbmFsfHxzbGFzaGVkLXplcm98fDxlYXN0LWFzaWFuLXZhcmlhbnQtdmFsdWVzPnx8PGVhc3QtYXNpYW4td2lkdGgtdmFsdWVzPnx8cnVieV0iLAogICAgICAgICJmb250LXZhcmlhbnQtYWx0ZXJuYXRlcyI6ICJub3JtYWx8W3N0eWxpc3RpYyggPGZlYXR1cmUtdmFsdWUtbmFtZT4gKXx8aGlzdG9yaWNhbC1mb3Jtc3x8c3R5bGVzZXQoIDxmZWF0dXJlLXZhbHVlLW5hbWU+IyApfHxjaGFyYWN0ZXItdmFyaWFudCggPGZlYXR1cmUtdmFsdWUtbmFtZT4jICl8fHN3YXNoKCA8ZmVhdHVyZS12YWx1ZS1uYW1lPiApfHxvcm5hbWVudHMoIDxmZWF0dXJlLXZhbHVlLW5hbWU+ICl8fGFubm90YXRpb24oIDxmZWF0dXJlLXZhbHVlLW5hbWU+ICldIiwKICAgICAgICAiZm9udC12YXJpYW50LWNhcHMiOiAibm9ybWFsfHNtYWxsLWNhcHN8YWxsLXNtYWxsLWNhcHN8cGV0aXRlLWNhcHN8YWxsLXBldGl0ZS1jYXBzfHVuaWNhc2V8dGl0bGluZy1jYXBzIiwKICAgICAgICAiZm9udC12YXJpYW50LWVhc3QtYXNpYW4iOiAibm9ybWFsfFs8ZWFzdC1hc2lhbi12YXJpYW50LXZhbHVlcz58fDxlYXN0LWFzaWFuLXdpZHRoLXZhbHVlcz58fHJ1YnldIiwKICAgICAgICAiZm9udC12YXJpYW50LWxpZ2F0dXJlcyI6ICJub3JtYWx8bm9uZXxbPGNvbW1vbi1saWctdmFsdWVzPnx8PGRpc2NyZXRpb25hcnktbGlnLXZhbHVlcz58fDxoaXN0b3JpY2FsLWxpZy12YWx1ZXM+fHw8Y29udGV4dHVhbC1hbHQtdmFsdWVzPl0iLAogICAgICAgICJmb250LXZhcmlhbnQtbnVtZXJpYyI6ICJub3JtYWx8WzxudW1lcmljLWZpZ3VyZS12YWx1ZXM+fHw8bnVtZXJpYy1zcGFjaW5nLXZhbHVlcz58fDxudW1lcmljLWZyYWN0aW9uLXZhbHVlcz58fG9yZGluYWx8fHNsYXNoZWQtemVyb10iLAogICAgICAgICJmb250LXZhcmlhbnQtcG9zaXRpb24iOiAibm9ybWFsfHN1YnxzdXBlciIsCiAgICAgICAgImZvbnQtd2VpZ2h0IjogIjxmb250LXdlaWdodC1hYnNvbHV0ZT58Ym9sZGVyfGxpZ2h0ZXIiLAogICAgICAgICJmb3JjZWQtY29sb3ItYWRqdXN0IjogImF1dG98bm9uZSIsCiAgICAgICAgImdhcCI6ICI8J3Jvdy1nYXAnPiA8J2NvbHVtbi1nYXAnPj8iLAogICAgICAgICJncmlkIjogIjwnZ3JpZC10ZW1wbGF0ZSc+fDwnZ3JpZC10ZW1wbGF0ZS1yb3dzJz4gLyBbYXV0by1mbG93JiZkZW5zZT9dIDwnZ3JpZC1hdXRvLWNvbHVtbnMnPj98W2F1dG8tZmxvdyYmZGVuc2U/XSA8J2dyaWQtYXV0by1yb3dzJz4/IC8gPCdncmlkLXRlbXBsYXRlLWNvbHVtbnMnPiIsCiAgICAgICAgImdyaWQtYXJlYSI6ICI8Z3JpZC1saW5lPiBbLyA8Z3JpZC1saW5lPl17MCwzfSIsCiAgICAgICAgImdyaWQtYXV0by1jb2x1bW5zIjogIjx0cmFjay1zaXplPisiLAogICAgICAgICJncmlkLWF1dG8tZmxvdyI6ICJbcm93fGNvbHVtbl18fGRlbnNlIiwKICAgICAgICAiZ3JpZC1hdXRvLXJvd3MiOiAiPHRyYWNrLXNpemU+KyIsCiAgICAgICAgImdyaWQtY29sdW1uIjogIjxncmlkLWxpbmU+IFsvIDxncmlkLWxpbmU+XT8iLAogICAgICAgICJncmlkLWNvbHVtbi1lbmQiOiAiPGdyaWQtbGluZT4iLAogICAgICAgICJncmlkLWNvbHVtbi1nYXAiOiAiPGxlbmd0aC1wZXJjZW50YWdlPiIsCiAgICAgICAgImdyaWQtY29sdW1uLXN0YXJ0IjogIjxncmlkLWxpbmU+IiwKICAgICAgICAiZ3JpZC1nYXAiOiAiPCdncmlkLXJvdy1nYXAnPiA8J2dyaWQtY29sdW1uLWdhcCc+PyIsCiAgICAgICAgImdyaWQtcm93IjogIjxncmlkLWxpbmU+IFsvIDxncmlkLWxpbmU+XT8iLAogICAgICAgICJncmlkLXJvdy1lbmQiOiAiPGdyaWQtbGluZT4iLAogICAgICAgICJncmlkLXJvdy1nYXAiOiAiPGxlbmd0aC1wZXJjZW50YWdlPiIsCiAgICAgICAgImdyaWQtcm93LXN0YXJ0IjogIjxncmlkLWxpbmU+IiwKICAgICAgICAiZ3JpZC10ZW1wbGF0ZSI6ICJub25lfFs8J2dyaWQtdGVtcGxhdGUtcm93cyc+IC8gPCdncmlkLXRlbXBsYXRlLWNvbHVtbnMnPl18WzxsaW5lLW5hbWVzPj8gPHN0cmluZz4gPHRyYWNrLXNpemU+PyA8bGluZS1uYW1lcz4/XSsgWy8gPGV4cGxpY2l0LXRyYWNrLWxpc3Q+XT8iLAogICAgICAgICJncmlkLXRlbXBsYXRlLWFyZWFzIjogIm5vbmV8PHN0cmluZz4rIiwKICAgICAgICAiZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zIjogIm5vbmV8PHRyYWNrLWxpc3Q+fDxhdXRvLXRyYWNrLWxpc3Q+fHN1YmdyaWQgPGxpbmUtbmFtZS1saXN0Pj8iLAogICAgICAgICJncmlkLXRlbXBsYXRlLXJvd3MiOiAibm9uZXw8dHJhY2stbGlzdD58PGF1dG8tdHJhY2stbGlzdD58c3ViZ3JpZCA8bGluZS1uYW1lLWxpc3Q+PyIsCiAgICAgICAgImhhbmdpbmctcHVuY3R1YXRpb24iOiAibm9uZXxbZmlyc3R8fFtmb3JjZS1lbmR8YWxsb3ctZW5kXXx8bGFzdF0iLAogICAgICAgICJoZWlnaHQiOiAiYXV0b3w8bGVuZ3RoPnw8cGVyY2VudGFnZT58bWluLWNvbnRlbnR8bWF4LWNvbnRlbnR8Zml0LWNvbnRlbnR8Zml0LWNvbnRlbnQoIDxsZW5ndGgtcGVyY2VudGFnZT4gKSIsCiAgICAgICAgImh5cGhlbmF0ZS1jaGFyYWN0ZXIiOiAiYXV0b3w8c3RyaW5nPiIsCiAgICAgICAgImh5cGhlbnMiOiAibm9uZXxtYW51YWx8YXV0byIsCiAgICAgICAgImltYWdlLW9yaWVudGF0aW9uIjogImZyb20taW1hZ2V8PGFuZ2xlPnxbPGFuZ2xlPj8gZmxpcF0iLAogICAgICAgICJpbWFnZS1yZW5kZXJpbmciOiAiYXV0b3xjcmlzcC1lZGdlc3xwaXhlbGF0ZWR8b3B0aW1pemVTcGVlZHxvcHRpbWl6ZVF1YWxpdHl8PC1ub24tc3RhbmRhcmQtaW1hZ2UtcmVuZGVyaW5nPiIsCiAgICAgICAgImltYWdlLXJlc29sdXRpb24iOiAiW2Zyb20taW1hZ2V8fDxyZXNvbHV0aW9uPl0mJnNuYXA/IiwKICAgICAgICAiaW1lLW1vZGUiOiAiYXV0b3xub3JtYWx8YWN0aXZlfGluYWN0aXZlfGRpc2FibGVkIiwKICAgICAgICAiaW5pdGlhbC1sZXR0ZXIiOiAibm9ybWFsfFs8bnVtYmVyPiA8aW50ZWdlcj4/XSIsCiAgICAgICAgImluaXRpYWwtbGV0dGVyLWFsaWduIjogIlthdXRvfGFscGhhYmV0aWN8aGFuZ2luZ3xpZGVvZ3JhcGhpY10iLAogICAgICAgICJpbmxpbmUtc2l6ZSI6ICI8J3dpZHRoJz4iLAogICAgICAgICJpbnB1dC1zZWN1cml0eSI6ICJhdXRvfG5vbmUiLAogICAgICAgICJpbnNldCI6ICI8J3RvcCc+ezEsNH0iLAogICAgICAgICJpbnNldC1ibG9jayI6ICI8J3RvcCc+ezEsMn0iLAogICAgICAgICJpbnNldC1ibG9jay1lbmQiOiAiPCd0b3AnPiIsCiAgICAgICAgImluc2V0LWJsb2NrLXN0YXJ0IjogIjwndG9wJz4iLAogICAgICAgICJpbnNldC1pbmxpbmUiOiAiPCd0b3AnPnsxLDJ9IiwKICAgICAgICAiaW5zZXQtaW5saW5lLWVuZCI6ICI8J3RvcCc+IiwKICAgICAgICAiaW5zZXQtaW5saW5lLXN0YXJ0IjogIjwndG9wJz4iLAogICAgICAgICJpc29sYXRpb24iOiAiYXV0b3xpc29sYXRlIiwKICAgICAgICAianVzdGlmeS1jb250ZW50IjogIm5vcm1hbHw8Y29udGVudC1kaXN0cmlidXRpb24+fDxvdmVyZmxvdy1wb3NpdGlvbj4/IFs8Y29udGVudC1wb3NpdGlvbj58bGVmdHxyaWdodF0iLAogICAgICAgICJqdXN0aWZ5LWl0ZW1zIjogIm5vcm1hbHxzdHJldGNofDxiYXNlbGluZS1wb3NpdGlvbj58PG92ZXJmbG93LXBvc2l0aW9uPj8gWzxzZWxmLXBvc2l0aW9uPnxsZWZ0fHJpZ2h0XXxsZWdhY3l8bGVnYWN5JiZbbGVmdHxyaWdodHxjZW50ZXJdIiwKICAgICAgICAianVzdGlmeS1zZWxmIjogImF1dG98bm9ybWFsfHN0cmV0Y2h8PGJhc2VsaW5lLXBvc2l0aW9uPnw8b3ZlcmZsb3ctcG9zaXRpb24+PyBbPHNlbGYtcG9zaXRpb24+fGxlZnR8cmlnaHRdIiwKICAgICAgICAianVzdGlmeS10cmFja3MiOiAiW25vcm1hbHw8Y29udGVudC1kaXN0cmlidXRpb24+fDxvdmVyZmxvdy1wb3NpdGlvbj4/IFs8Y29udGVudC1wb3NpdGlvbj58bGVmdHxyaWdodF1dIyIsCiAgICAgICAgImxlZnQiOiAiPGxlbmd0aD58PHBlcmNlbnRhZ2U+fGF1dG8iLAogICAgICAgICJsZXR0ZXItc3BhY2luZyI6ICJub3JtYWx8PGxlbmd0aC1wZXJjZW50YWdlPiIsCiAgICAgICAgImxpbmUtYnJlYWsiOiAiYXV0b3xsb29zZXxub3JtYWx8c3RyaWN0fGFueXdoZXJlIiwKICAgICAgICAibGluZS1jbGFtcCI6ICJub25lfDxpbnRlZ2VyPiIsCiAgICAgICAgImxpbmUtaGVpZ2h0IjogIm5vcm1hbHw8bnVtYmVyPnw8bGVuZ3RoPnw8cGVyY2VudGFnZT4iLAogICAgICAgICJsaW5lLWhlaWdodC1zdGVwIjogIjxsZW5ndGg+IiwKICAgICAgICAibGlzdC1zdHlsZSI6ICI8J2xpc3Qtc3R5bGUtdHlwZSc+fHw8J2xpc3Qtc3R5bGUtcG9zaXRpb24nPnx8PCdsaXN0LXN0eWxlLWltYWdlJz4iLAogICAgICAgICJsaXN0LXN0eWxlLWltYWdlIjogIjxpbWFnZT58bm9uZSIsCiAgICAgICAgImxpc3Qtc3R5bGUtcG9zaXRpb24iOiAiaW5zaWRlfG91dHNpZGUiLAogICAgICAgICJsaXN0LXN0eWxlLXR5cGUiOiAiPGNvdW50ZXItc3R5bGU+fDxzdHJpbmc+fG5vbmUiLAogICAgICAgICJtYXJnaW4iOiAiWzxsZW5ndGg+fDxwZXJjZW50YWdlPnxhdXRvXXsxLDR9IiwKICAgICAgICAibWFyZ2luLWJsb2NrIjogIjwnbWFyZ2luLWxlZnQnPnsxLDJ9IiwKICAgICAgICAibWFyZ2luLWJsb2NrLWVuZCI6ICI8J21hcmdpbi1sZWZ0Jz4iLAogICAgICAgICJtYXJnaW4tYmxvY2stc3RhcnQiOiAiPCdtYXJnaW4tbGVmdCc+IiwKICAgICAgICAibWFyZ2luLWJvdHRvbSI6ICI8bGVuZ3RoPnw8cGVyY2VudGFnZT58YXV0byIsCiAgICAgICAgIm1hcmdpbi1pbmxpbmUiOiAiPCdtYXJnaW4tbGVmdCc+ezEsMn0iLAogICAgICAgICJtYXJnaW4taW5saW5lLWVuZCI6ICI8J21hcmdpbi1sZWZ0Jz4iLAogICAgICAgICJtYXJnaW4taW5saW5lLXN0YXJ0IjogIjwnbWFyZ2luLWxlZnQnPiIsCiAgICAgICAgIm1hcmdpbi1sZWZ0IjogIjxsZW5ndGg+fDxwZXJjZW50YWdlPnxhdXRvIiwKICAgICAgICAibWFyZ2luLXJpZ2h0IjogIjxsZW5ndGg+fDxwZXJjZW50YWdlPnxhdXRvIiwKICAgICAgICAibWFyZ2luLXRvcCI6ICI8bGVuZ3RoPnw8cGVyY2VudGFnZT58YXV0byIsCiAgICAgICAgIm1hcmdpbi10cmltIjogIm5vbmV8aW4tZmxvd3xhbGwiLAogICAgICAgICJtYXNrIjogIjxtYXNrLWxheWVyPiMiLAogICAgICAgICJtYXNrLWJvcmRlciI6ICI8J21hc2stYm9yZGVyLXNvdXJjZSc+fHw8J21hc2stYm9yZGVyLXNsaWNlJz4gWy8gPCdtYXNrLWJvcmRlci13aWR0aCc+PyBbLyA8J21hc2stYm9yZGVyLW91dHNldCc+XT9dP3x8PCdtYXNrLWJvcmRlci1yZXBlYXQnPnx8PCdtYXNrLWJvcmRlci1tb2RlJz4iLAogICAgICAgICJtYXNrLWJvcmRlci1tb2RlIjogImx1bWluYW5jZXxhbHBoYSIsCiAgICAgICAgIm1hc2stYm9yZGVyLW91dHNldCI6ICJbPGxlbmd0aD58PG51bWJlcj5dezEsNH0iLAogICAgICAgICJtYXNrLWJvcmRlci1yZXBlYXQiOiAiW3N0cmV0Y2h8cmVwZWF0fHJvdW5kfHNwYWNlXXsxLDJ9IiwKICAgICAgICAibWFzay1ib3JkZXItc2xpY2UiOiAiPG51bWJlci1wZXJjZW50YWdlPnsxLDR9IGZpbGw/IiwKICAgICAgICAibWFzay1ib3JkZXItc291cmNlIjogIm5vbmV8PGltYWdlPiIsCiAgICAgICAgIm1hc2stYm9yZGVyLXdpZHRoIjogIls8bGVuZ3RoLXBlcmNlbnRhZ2U+fDxudW1iZXI+fGF1dG9dezEsNH0iLAogICAgICAgICJtYXNrLWNsaXAiOiAiWzxnZW9tZXRyeS1ib3g+fG5vLWNsaXBdIyIsCiAgICAgICAgIm1hc2stY29tcG9zaXRlIjogIjxjb21wb3NpdGluZy1vcGVyYXRvcj4jIiwKICAgICAgICAibWFzay1pbWFnZSI6ICI8bWFzay1yZWZlcmVuY2U+IyIsCiAgICAgICAgIm1hc2stbW9kZSI6ICI8bWFza2luZy1tb2RlPiMiLAogICAgICAgICJtYXNrLW9yaWdpbiI6ICI8Z2VvbWV0cnktYm94PiMiLAogICAgICAgICJtYXNrLXBvc2l0aW9uIjogIjxwb3NpdGlvbj4jIiwKICAgICAgICAibWFzay1yZXBlYXQiOiAiPHJlcGVhdC1zdHlsZT4jIiwKICAgICAgICAibWFzay1zaXplIjogIjxiZy1zaXplPiMiLAogICAgICAgICJtYXNrLXR5cGUiOiAibHVtaW5hbmNlfGFscGhhIiwKICAgICAgICAibWFzb25yeS1hdXRvLWZsb3ciOiAiW3BhY2t8bmV4dF18fFtkZWZpbml0ZS1maXJzdHxvcmRlcmVkXSIsCiAgICAgICAgIm1hdGgtZGVwdGgiOiAiYXV0by1hZGR8YWRkKCA8aW50ZWdlcj4gKXw8aW50ZWdlcj4iLAogICAgICAgICJtYXRoLXNoaWZ0IjogIm5vcm1hbHxjb21wYWN0IiwKICAgICAgICAibWF0aC1zdHlsZSI6ICJub3JtYWx8Y29tcGFjdCIsCiAgICAgICAgIm1heC1ibG9jay1zaXplIjogIjwnbWF4LXdpZHRoJz4iLAogICAgICAgICJtYXgtaGVpZ2h0IjogIm5vbmV8PGxlbmd0aC1wZXJjZW50YWdlPnxtaW4tY29udGVudHxtYXgtY29udGVudHxmaXQtY29udGVudHxmaXQtY29udGVudCggPGxlbmd0aC1wZXJjZW50YWdlPiApIiwKICAgICAgICAibWF4LWlubGluZS1zaXplIjogIjwnbWF4LXdpZHRoJz4iLAogICAgICAgICJtYXgtbGluZXMiOiAibm9uZXw8aW50ZWdlcj4iLAogICAgICAgICJtYXgtd2lkdGgiOiAibm9uZXw8bGVuZ3RoLXBlcmNlbnRhZ2U+fG1pbi1jb250ZW50fG1heC1jb250ZW50fGZpdC1jb250ZW50fGZpdC1jb250ZW50KCA8bGVuZ3RoLXBlcmNlbnRhZ2U+ICl8PC1ub24tc3RhbmRhcmQtd2lkdGg+IiwKICAgICAgICAibWluLWJsb2NrLXNpemUiOiAiPCdtaW4td2lkdGgnPiIsCiAgICAgICAgIm1pbi1oZWlnaHQiOiAiYXV0b3w8bGVuZ3RoPnw8cGVyY2VudGFnZT58bWluLWNvbnRlbnR8bWF4LWNvbnRlbnR8Zml0LWNvbnRlbnR8Zml0LWNvbnRlbnQoIDxsZW5ndGgtcGVyY2VudGFnZT4gKSIsCiAgICAgICAgIm1pbi1pbmxpbmUtc2l6ZSI6ICI8J21pbi13aWR0aCc+IiwKICAgICAgICAibWluLXdpZHRoIjogImF1dG98PGxlbmd0aD58PHBlcmNlbnRhZ2U+fG1pbi1jb250ZW50fG1heC1jb250ZW50fGZpdC1jb250ZW50fGZpdC1jb250ZW50KCA8bGVuZ3RoLXBlcmNlbnRhZ2U+ICl8PC1ub24tc3RhbmRhcmQtd2lkdGg+IiwKICAgICAgICAibWl4LWJsZW5kLW1vZGUiOiAiPGJsZW5kLW1vZGU+fHBsdXMtbGlnaHRlciIsCiAgICAgICAgIm9iamVjdC1maXQiOiAiZmlsbHxjb250YWlufGNvdmVyfG5vbmV8c2NhbGUtZG93biIsCiAgICAgICAgIm9iamVjdC1wb3NpdGlvbiI6ICI8cG9zaXRpb24+IiwKICAgICAgICAib2Zmc2V0IjogIls8J29mZnNldC1wb3NpdGlvbic+PyBbPCdvZmZzZXQtcGF0aCc+IFs8J29mZnNldC1kaXN0YW5jZSc+fHw8J29mZnNldC1yb3RhdGUnPl0/XT9dISBbLyA8J29mZnNldC1hbmNob3InPl0/IiwKICAgICAgICAib2Zmc2V0LWFuY2hvciI6ICJhdXRvfDxwb3NpdGlvbj4iLAogICAgICAgICJvZmZzZXQtZGlzdGFuY2UiOiAiPGxlbmd0aC1wZXJjZW50YWdlPiIsCiAgICAgICAgIm9mZnNldC1wYXRoIjogIm5vbmV8cmF5KCBbPGFuZ2xlPiYmPHNpemU+JiZjb250YWluP10gKXw8cGF0aCgpPnw8dXJsPnxbPGJhc2ljLXNoYXBlPnx8PGdlb21ldHJ5LWJveD5dIiwKICAgICAgICAib2Zmc2V0LXBvc2l0aW9uIjogImF1dG98PHBvc2l0aW9uPiIsCiAgICAgICAgIm9mZnNldC1yb3RhdGUiOiAiW2F1dG98cmV2ZXJzZV18fDxhbmdsZT4iLAogICAgICAgICJvcGFjaXR5IjogIjxhbHBoYS12YWx1ZT4iLAogICAgICAgICJvcmRlciI6ICI8aW50ZWdlcj4iLAogICAgICAgICJvcnBoYW5zIjogIjxpbnRlZ2VyPiIsCiAgICAgICAgIm91dGxpbmUiOiAiWzwnb3V0bGluZS1jb2xvcic+fHw8J291dGxpbmUtc3R5bGUnPnx8PCdvdXRsaW5lLXdpZHRoJz5dIiwKICAgICAgICAib3V0bGluZS1jb2xvciI6ICI8Y29sb3I+fGludmVydCIsCiAgICAgICAgIm91dGxpbmUtb2Zmc2V0IjogIjxsZW5ndGg+IiwKICAgICAgICAib3V0bGluZS1zdHlsZSI6ICJhdXRvfDwnYm9yZGVyLXN0eWxlJz4iLAogICAgICAgICJvdXRsaW5lLXdpZHRoIjogIjxsaW5lLXdpZHRoPiIsCiAgICAgICAgIm92ZXJmbG93IjogIlt2aXNpYmxlfGhpZGRlbnxjbGlwfHNjcm9sbHxhdXRvXXsxLDJ9fDwtbm9uLXN0YW5kYXJkLW92ZXJmbG93PiIsCiAgICAgICAgIm92ZXJmbG93LWFuY2hvciI6ICJhdXRvfG5vbmUiLAogICAgICAgICJvdmVyZmxvdy1ibG9jayI6ICJ2aXNpYmxlfGhpZGRlbnxjbGlwfHNjcm9sbHxhdXRvIiwKICAgICAgICAib3ZlcmZsb3ctY2xpcC1ib3giOiAicGFkZGluZy1ib3h8Y29udGVudC1ib3giLAogICAgICAgICJvdmVyZmxvdy1jbGlwLW1hcmdpbiI6ICI8dmlzdWFsLWJveD58fDxsZW5ndGggWzAs4oieXT4iLAogICAgICAgICJvdmVyZmxvdy1pbmxpbmUiOiAidmlzaWJsZXxoaWRkZW58Y2xpcHxzY3JvbGx8YXV0byIsCiAgICAgICAgIm92ZXJmbG93LXdyYXAiOiAibm9ybWFsfGJyZWFrLXdvcmR8YW55d2hlcmUiLAogICAgICAgICJvdmVyZmxvdy14IjogInZpc2libGV8aGlkZGVufGNsaXB8c2Nyb2xsfGF1dG8iLAogICAgICAgICJvdmVyZmxvdy15IjogInZpc2libGV8aGlkZGVufGNsaXB8c2Nyb2xsfGF1dG8iLAogICAgICAgICJvdmVyc2Nyb2xsLWJlaGF2aW9yIjogIltjb250YWlufG5vbmV8YXV0b117MSwyfSIsCiAgICAgICAgIm92ZXJzY3JvbGwtYmVoYXZpb3ItYmxvY2siOiAiY29udGFpbnxub25lfGF1dG8iLAogICAgICAgICJvdmVyc2Nyb2xsLWJlaGF2aW9yLWlubGluZSI6ICJjb250YWlufG5vbmV8YXV0byIsCiAgICAgICAgIm92ZXJzY3JvbGwtYmVoYXZpb3IteCI6ICJjb250YWlufG5vbmV8YXV0byIsCiAgICAgICAgIm92ZXJzY3JvbGwtYmVoYXZpb3IteSI6ICJjb250YWlufG5vbmV8YXV0byIsCiAgICAgICAgInBhZGRpbmciOiAiWzxsZW5ndGg+fDxwZXJjZW50YWdlPl17MSw0fSIsCiAgICAgICAgInBhZGRpbmctYmxvY2siOiAiPCdwYWRkaW5nLWxlZnQnPnsxLDJ9IiwKICAgICAgICAicGFkZGluZy1ibG9jay1lbmQiOiAiPCdwYWRkaW5nLWxlZnQnPiIsCiAgICAgICAgInBhZGRpbmctYmxvY2stc3RhcnQiOiAiPCdwYWRkaW5nLWxlZnQnPiIsCiAgICAgICAgInBhZGRpbmctYm90dG9tIjogIjxsZW5ndGg+fDxwZXJjZW50YWdlPiIsCiAgICAgICAgInBhZGRpbmctaW5saW5lIjogIjwncGFkZGluZy1sZWZ0Jz57MSwyfSIsCiAgICAgICAgInBhZGRpbmctaW5saW5lLWVuZCI6ICI8J3BhZGRpbmctbGVmdCc+IiwKICAgICAgICAicGFkZGluZy1pbmxpbmUtc3RhcnQiOiAiPCdwYWRkaW5nLWxlZnQnPiIsCiAgICAgICAgInBhZGRpbmctbGVmdCI6ICI8bGVuZ3RoPnw8cGVyY2VudGFnZT4iLAogICAgICAgICJwYWRkaW5nLXJpZ2h0IjogIjxsZW5ndGg+fDxwZXJjZW50YWdlPiIsCiAgICAgICAgInBhZGRpbmctdG9wIjogIjxsZW5ndGg+fDxwZXJjZW50YWdlPiIsCiAgICAgICAgInBhZ2UtYnJlYWstYWZ0ZXIiOiAiYXV0b3xhbHdheXN8YXZvaWR8bGVmdHxyaWdodHxyZWN0b3x2ZXJzbyIsCiAgICAgICAgInBhZ2UtYnJlYWstYmVmb3JlIjogImF1dG98YWx3YXlzfGF2b2lkfGxlZnR8cmlnaHR8cmVjdG98dmVyc28iLAogICAgICAgICJwYWdlLWJyZWFrLWluc2lkZSI6ICJhdXRvfGF2b2lkIiwKICAgICAgICAicGFpbnQtb3JkZXIiOiAibm9ybWFsfFtmaWxsfHxzdHJva2V8fG1hcmtlcnNdIiwKICAgICAgICAicGVyc3BlY3RpdmUiOiAibm9uZXw8bGVuZ3RoPiIsCiAgICAgICAgInBlcnNwZWN0aXZlLW9yaWdpbiI6ICI8cG9zaXRpb24+IiwKICAgICAgICAicGxhY2UtY29udGVudCI6ICI8J2FsaWduLWNvbnRlbnQnPiA8J2p1c3RpZnktY29udGVudCc+PyIsCiAgICAgICAgInBsYWNlLWl0ZW1zIjogIjwnYWxpZ24taXRlbXMnPiA8J2p1c3RpZnktaXRlbXMnPj8iLAogICAgICAgICJwbGFjZS1zZWxmIjogIjwnYWxpZ24tc2VsZic+IDwnanVzdGlmeS1zZWxmJz4/IiwKICAgICAgICAicG9pbnRlci1ldmVudHMiOiAiYXV0b3xub25lfHZpc2libGVQYWludGVkfHZpc2libGVGaWxsfHZpc2libGVTdHJva2V8dmlzaWJsZXxwYWludGVkfGZpbGx8c3Ryb2tlfGFsbHxpbmhlcml0IiwKICAgICAgICAicG9zaXRpb24iOiAic3RhdGljfHJlbGF0aXZlfGFic29sdXRlfHN0aWNreXxmaXhlZHwtd2Via2l0LXN0aWNreSIsCiAgICAgICAgInF1b3RlcyI6ICJub25lfGF1dG98WzxzdHJpbmc+IDxzdHJpbmc+XSsiLAogICAgICAgICJyZXNpemUiOiAibm9uZXxib3RofGhvcml6b250YWx8dmVydGljYWx8YmxvY2t8aW5saW5lIiwKICAgICAgICAicmlnaHQiOiAiPGxlbmd0aD58PHBlcmNlbnRhZ2U+fGF1dG8iLAogICAgICAgICJyb3RhdGUiOiAibm9uZXw8YW5nbGU+fFt4fHl8enw8bnVtYmVyPnszfV0mJjxhbmdsZT4iLAogICAgICAgICJyb3ctZ2FwIjogIm5vcm1hbHw8bGVuZ3RoLXBlcmNlbnRhZ2U+IiwKICAgICAgICAicnVieS1hbGlnbiI6ICJzdGFydHxjZW50ZXJ8c3BhY2UtYmV0d2VlbnxzcGFjZS1hcm91bmQiLAogICAgICAgICJydWJ5LW1lcmdlIjogInNlcGFyYXRlfGNvbGxhcHNlfGF1dG8iLAogICAgICAgICJydWJ5LXBvc2l0aW9uIjogIlthbHRlcm5hdGV8fFtvdmVyfHVuZGVyXV18aW50ZXItY2hhcmFjdGVyIiwKICAgICAgICAic2NhbGUiOiAibm9uZXw8bnVtYmVyPnsxLDN9IiwKICAgICAgICAic2Nyb2xsYmFyLWNvbG9yIjogImF1dG98PGNvbG9yPnsyfSIsCiAgICAgICAgInNjcm9sbGJhci1ndXR0ZXIiOiAiYXV0b3xzdGFibGUmJmJvdGgtZWRnZXM/IiwKICAgICAgICAic2Nyb2xsYmFyLXdpZHRoIjogImF1dG98dGhpbnxub25lIiwKICAgICAgICAic2Nyb2xsLWJlaGF2aW9yIjogImF1dG98c21vb3RoIiwKICAgICAgICAic2Nyb2xsLW1hcmdpbiI6ICI8bGVuZ3RoPnsxLDR9IiwKICAgICAgICAic2Nyb2xsLW1hcmdpbi1ibG9jayI6ICI8bGVuZ3RoPnsxLDJ9IiwKICAgICAgICAic2Nyb2xsLW1hcmdpbi1ibG9jay1zdGFydCI6ICI8bGVuZ3RoPiIsCiAgICAgICAgInNjcm9sbC1tYXJnaW4tYmxvY2stZW5kIjogIjxsZW5ndGg+IiwKICAgICAgICAic2Nyb2xsLW1hcmdpbi1ib3R0b20iOiAiPGxlbmd0aD4iLAogICAgICAgICJzY3JvbGwtbWFyZ2luLWlubGluZSI6ICI8bGVuZ3RoPnsxLDJ9IiwKICAgICAgICAic2Nyb2xsLW1hcmdpbi1pbmxpbmUtc3RhcnQiOiAiPGxlbmd0aD4iLAogICAgICAgICJzY3JvbGwtbWFyZ2luLWlubGluZS1lbmQiOiAiPGxlbmd0aD4iLAogICAgICAgICJzY3JvbGwtbWFyZ2luLWxlZnQiOiAiPGxlbmd0aD4iLAogICAgICAgICJzY3JvbGwtbWFyZ2luLXJpZ2h0IjogIjxsZW5ndGg+IiwKICAgICAgICAic2Nyb2xsLW1hcmdpbi10b3AiOiAiPGxlbmd0aD4iLAogICAgICAgICJzY3JvbGwtcGFkZGluZyI6ICJbYXV0b3w8bGVuZ3RoLXBlcmNlbnRhZ2U+XXsxLDR9IiwKICAgICAgICAic2Nyb2xsLXBhZGRpbmctYmxvY2siOiAiW2F1dG98PGxlbmd0aC1wZXJjZW50YWdlPl17MSwyfSIsCiAgICAgICAgInNjcm9sbC1wYWRkaW5nLWJsb2NrLXN0YXJ0IjogImF1dG98PGxlbmd0aC1wZXJjZW50YWdlPiIsCiAgICAgICAgInNjcm9sbC1wYWRkaW5nLWJsb2NrLWVuZCI6ICJhdXRvfDxsZW5ndGgtcGVyY2VudGFnZT4iLAogICAgICAgICJzY3JvbGwtcGFkZGluZy1ib3R0b20iOiAiYXV0b3w8bGVuZ3RoLXBlcmNlbnRhZ2U+IiwKICAgICAgICAic2Nyb2xsLXBhZGRpbmctaW5saW5lIjogIlthdXRvfDxsZW5ndGgtcGVyY2VudGFnZT5dezEsMn0iLAogICAgICAgICJzY3JvbGwtcGFkZGluZy1pbmxpbmUtc3RhcnQiOiAiYXV0b3w8bGVuZ3RoLXBlcmNlbnRhZ2U+IiwKICAgICAgICAic2Nyb2xsLXBhZGRpbmctaW5saW5lLWVuZCI6ICJhdXRvfDxsZW5ndGgtcGVyY2VudGFnZT4iLAogICAgICAgICJzY3JvbGwtcGFkZGluZy1sZWZ0IjogImF1dG98PGxlbmd0aC1wZXJjZW50YWdlPiIsCiAgICAgICAgInNjcm9sbC1wYWRkaW5nLXJpZ2h0IjogImF1dG98PGxlbmd0aC1wZXJjZW50YWdlPiIsCiAgICAgICAgInNjcm9sbC1wYWRkaW5nLXRvcCI6ICJhdXRvfDxsZW5ndGgtcGVyY2VudGFnZT4iLAogICAgICAgICJzY3JvbGwtc25hcC1hbGlnbiI6ICJbbm9uZXxzdGFydHxlbmR8Y2VudGVyXXsxLDJ9IiwKICAgICAgICAic2Nyb2xsLXNuYXAtY29vcmRpbmF0ZSI6ICJub25lfDxwb3NpdGlvbj4jIiwKICAgICAgICAic2Nyb2xsLXNuYXAtZGVzdGluYXRpb24iOiAiPHBvc2l0aW9uPiIsCiAgICAgICAgInNjcm9sbC1zbmFwLXBvaW50cy14IjogIm5vbmV8cmVwZWF0KCA8bGVuZ3RoLXBlcmNlbnRhZ2U+ICkiLAogICAgICAgICJzY3JvbGwtc25hcC1wb2ludHMteSI6ICJub25lfHJlcGVhdCggPGxlbmd0aC1wZXJjZW50YWdlPiApIiwKICAgICAgICAic2Nyb2xsLXNuYXAtc3RvcCI6ICJub3JtYWx8YWx3YXlzIiwKICAgICAgICAic2Nyb2xsLXNuYXAtdHlwZSI6ICJub25lfFt4fHl8YmxvY2t8aW5saW5lfGJvdGhdIFttYW5kYXRvcnl8cHJveGltaXR5XT8iLAogICAgICAgICJzY3JvbGwtc25hcC10eXBlLXgiOiAibm9uZXxtYW5kYXRvcnl8cHJveGltaXR5IiwKICAgICAgICAic2Nyb2xsLXNuYXAtdHlwZS15IjogIm5vbmV8bWFuZGF0b3J5fHByb3hpbWl0eSIsCiAgICAgICAgInNjcm9sbC10aW1lbGluZSI6ICI8c2Nyb2xsLXRpbWVsaW5lLW5hbWU+fHw8c2Nyb2xsLXRpbWVsaW5lLWF4aXM+IiwKICAgICAgICAic2Nyb2xsLXRpbWVsaW5lLWF4aXMiOiAiYmxvY2t8aW5saW5lfHZlcnRpY2FsfGhvcml6b250YWwiLAogICAgICAgICJzY3JvbGwtdGltZWxpbmUtbmFtZSI6ICJub25lfDxjdXN0b20taWRlbnQ+IiwKICAgICAgICAic2hhcGUtaW1hZ2UtdGhyZXNob2xkIjogIjxhbHBoYS12YWx1ZT4iLAogICAgICAgICJzaGFwZS1tYXJnaW4iOiAiPGxlbmd0aC1wZXJjZW50YWdlPiIsCiAgICAgICAgInNoYXBlLW91dHNpZGUiOiAibm9uZXxbPHNoYXBlLWJveD58fDxiYXNpYy1zaGFwZT5dfDxpbWFnZT4iLAogICAgICAgICJ0YWItc2l6ZSI6ICI8aW50ZWdlcj58PGxlbmd0aD4iLAogICAgICAgICJ0YWJsZS1sYXlvdXQiOiAiYXV0b3xmaXhlZCIsCiAgICAgICAgInRleHQtYWxpZ24iOiAic3RhcnR8ZW5kfGxlZnR8cmlnaHR8Y2VudGVyfGp1c3RpZnl8bWF0Y2gtcGFyZW50IiwKICAgICAgICAidGV4dC1hbGlnbi1sYXN0IjogImF1dG98c3RhcnR8ZW5kfGxlZnR8cmlnaHR8Y2VudGVyfGp1c3RpZnkiLAogICAgICAgICJ0ZXh0LWNvbWJpbmUtdXByaWdodCI6ICJub25lfGFsbHxbZGlnaXRzIDxpbnRlZ2VyPj9dIiwKICAgICAgICAidGV4dC1kZWNvcmF0aW9uIjogIjwndGV4dC1kZWNvcmF0aW9uLWxpbmUnPnx8PCd0ZXh0LWRlY29yYXRpb24tc3R5bGUnPnx8PCd0ZXh0LWRlY29yYXRpb24tY29sb3InPnx8PCd0ZXh0LWRlY29yYXRpb24tdGhpY2tuZXNzJz4iLAogICAgICAgICJ0ZXh0LWRlY29yYXRpb24tY29sb3IiOiAiPGNvbG9yPiIsCiAgICAgICAgInRleHQtZGVjb3JhdGlvbi1saW5lIjogIm5vbmV8W3VuZGVybGluZXx8b3ZlcmxpbmV8fGxpbmUtdGhyb3VnaHx8YmxpbmtdfHNwZWxsaW5nLWVycm9yfGdyYW1tYXItZXJyb3IiLAogICAgICAgICJ0ZXh0LWRlY29yYXRpb24tc2tpcCI6ICJub25lfFtvYmplY3RzfHxbc3BhY2VzfFtsZWFkaW5nLXNwYWNlc3x8dHJhaWxpbmctc3BhY2VzXV18fGVkZ2VzfHxib3gtZGVjb3JhdGlvbl0iLAogICAgICAgICJ0ZXh0LWRlY29yYXRpb24tc2tpcC1pbmsiOiAiYXV0b3xhbGx8bm9uZSIsCiAgICAgICAgInRleHQtZGVjb3JhdGlvbi1zdHlsZSI6ICJzb2xpZHxkb3VibGV8ZG90dGVkfGRhc2hlZHx3YXZ5IiwKICAgICAgICAidGV4dC1kZWNvcmF0aW9uLXRoaWNrbmVzcyI6ICJhdXRvfGZyb20tZm9udHw8bGVuZ3RoPnw8cGVyY2VudGFnZT4iLAogICAgICAgICJ0ZXh0LWVtcGhhc2lzIjogIjwndGV4dC1lbXBoYXNpcy1zdHlsZSc+fHw8J3RleHQtZW1waGFzaXMtY29sb3InPiIsCiAgICAgICAgInRleHQtZW1waGFzaXMtY29sb3IiOiAiPGNvbG9yPiIsCiAgICAgICAgInRleHQtZW1waGFzaXMtcG9zaXRpb24iOiAiW292ZXJ8dW5kZXJdJiZbcmlnaHR8bGVmdF0iLAogICAgICAgICJ0ZXh0LWVtcGhhc2lzLXN0eWxlIjogIm5vbmV8W1tmaWxsZWR8b3Blbl18fFtkb3R8Y2lyY2xlfGRvdWJsZS1jaXJjbGV8dHJpYW5nbGV8c2VzYW1lXV18PHN0cmluZz4iLAogICAgICAgICJ0ZXh0LWluZGVudCI6ICI8bGVuZ3RoLXBlcmNlbnRhZ2U+JiZoYW5naW5nPyYmZWFjaC1saW5lPyIsCiAgICAgICAgInRleHQtanVzdGlmeSI6ICJhdXRvfGludGVyLWNoYXJhY3RlcnxpbnRlci13b3JkfG5vbmUiLAogICAgICAgICJ0ZXh0LW9yaWVudGF0aW9uIjogIm1peGVkfHVwcmlnaHR8c2lkZXdheXMiLAogICAgICAgICJ0ZXh0LW92ZXJmbG93IjogIltjbGlwfGVsbGlwc2lzfDxzdHJpbmc+XXsxLDJ9IiwKICAgICAgICAidGV4dC1yZW5kZXJpbmciOiAiYXV0b3xvcHRpbWl6ZVNwZWVkfG9wdGltaXplTGVnaWJpbGl0eXxnZW9tZXRyaWNQcmVjaXNpb24iLAogICAgICAgICJ0ZXh0LXNoYWRvdyI6ICJub25lfDxzaGFkb3ctdD4jIiwKICAgICAgICAidGV4dC1zaXplLWFkanVzdCI6ICJub25lfGF1dG98PHBlcmNlbnRhZ2U+IiwKICAgICAgICAidGV4dC10cmFuc2Zvcm0iOiAibm9uZXxjYXBpdGFsaXplfHVwcGVyY2FzZXxsb3dlcmNhc2V8ZnVsbC13aWR0aHxmdWxsLXNpemUta2FuYSIsCiAgICAgICAgInRleHQtdW5kZXJsaW5lLW9mZnNldCI6ICJhdXRvfDxsZW5ndGg+fDxwZXJjZW50YWdlPiIsCiAgICAgICAgInRleHQtdW5kZXJsaW5lLXBvc2l0aW9uIjogImF1dG98ZnJvbS1mb250fFt1bmRlcnx8W2xlZnR8cmlnaHRdXSIsCiAgICAgICAgInRvcCI6ICI8bGVuZ3RoPnw8cGVyY2VudGFnZT58YXV0byIsCiAgICAgICAgInRvdWNoLWFjdGlvbiI6ICJhdXRvfG5vbmV8W1twYW4teHxwYW4tbGVmdHxwYW4tcmlnaHRdfHxbcGFuLXl8cGFuLXVwfHBhbi1kb3duXXx8cGluY2gtem9vbV18bWFuaXB1bGF0aW9uIiwKICAgICAgICAidHJhbnNmb3JtIjogIm5vbmV8PHRyYW5zZm9ybS1saXN0PiIsCiAgICAgICAgInRyYW5zZm9ybS1ib3giOiAiY29udGVudC1ib3h8Ym9yZGVyLWJveHxmaWxsLWJveHxzdHJva2UtYm94fHZpZXctYm94IiwKICAgICAgICAidHJhbnNmb3JtLW9yaWdpbiI6ICJbPGxlbmd0aC1wZXJjZW50YWdlPnxsZWZ0fGNlbnRlcnxyaWdodHx0b3B8Ym90dG9tXXxbWzxsZW5ndGgtcGVyY2VudGFnZT58bGVmdHxjZW50ZXJ8cmlnaHRdJiZbPGxlbmd0aC1wZXJjZW50YWdlPnx0b3B8Y2VudGVyfGJvdHRvbV1dIDxsZW5ndGg+PyIsCiAgICAgICAgInRyYW5zZm9ybS1zdHlsZSI6ICJmbGF0fHByZXNlcnZlLTNkIiwKICAgICAgICAidHJhbnNpdGlvbiI6ICI8c2luZ2xlLXRyYW5zaXRpb24+IyIsCiAgICAgICAgInRyYW5zaXRpb24tZGVsYXkiOiAiPHRpbWU+IyIsCiAgICAgICAgInRyYW5zaXRpb24tZHVyYXRpb24iOiAiPHRpbWU+IyIsCiAgICAgICAgInRyYW5zaXRpb24tcHJvcGVydHkiOiAibm9uZXw8c2luZ2xlLXRyYW5zaXRpb24tcHJvcGVydHk+IyIsCiAgICAgICAgInRyYW5zaXRpb24tdGltaW5nLWZ1bmN0aW9uIjogIjxlYXNpbmctZnVuY3Rpb24+IyIsCiAgICAgICAgInRyYW5zbGF0ZSI6ICJub25lfDxsZW5ndGgtcGVyY2VudGFnZT4gWzxsZW5ndGgtcGVyY2VudGFnZT4gPGxlbmd0aD4/XT8iLAogICAgICAgICJ1bmljb2RlLWJpZGkiOiAibm9ybWFsfGVtYmVkfGlzb2xhdGV8YmlkaS1vdmVycmlkZXxpc29sYXRlLW92ZXJyaWRlfHBsYWludGV4dHwtbW96LWlzb2xhdGV8LW1vei1pc29sYXRlLW92ZXJyaWRlfC1tb3otcGxhaW50ZXh0fC13ZWJraXQtaXNvbGF0ZXwtd2Via2l0LWlzb2xhdGUtb3ZlcnJpZGV8LXdlYmtpdC1wbGFpbnRleHQiLAogICAgICAgICJ1c2VyLXNlbGVjdCI6ICJhdXRvfHRleHR8bm9uZXxjb250YWlufGFsbCIsCiAgICAgICAgInZlcnRpY2FsLWFsaWduIjogImJhc2VsaW5lfHN1YnxzdXBlcnx0ZXh0LXRvcHx0ZXh0LWJvdHRvbXxtaWRkbGV8dG9wfGJvdHRvbXw8cGVyY2VudGFnZT58PGxlbmd0aD4iLAogICAgICAgICJ2aXNpYmlsaXR5IjogInZpc2libGV8aGlkZGVufGNvbGxhcHNlIiwKICAgICAgICAid2hpdGUtc3BhY2UiOiAibm9ybWFsfHByZXxub3dyYXB8cHJlLXdyYXB8cHJlLWxpbmV8YnJlYWstc3BhY2VzIiwKICAgICAgICAid2lkb3dzIjogIjxpbnRlZ2VyPiIsCiAgICAgICAgIndpZHRoIjogImF1dG98PGxlbmd0aD58PHBlcmNlbnRhZ2U+fG1pbi1jb250ZW50fG1heC1jb250ZW50fGZpdC1jb250ZW50fGZpdC1jb250ZW50KCA8bGVuZ3RoLXBlcmNlbnRhZ2U+ICl8ZmlsbHxzdHJldGNofGludHJpbnNpY3wtbW96LW1heC1jb250ZW50fC13ZWJraXQtbWF4LWNvbnRlbnR8LW1vei1maXQtY29udGVudHwtd2Via2l0LWZpdC1jb250ZW50IiwKICAgICAgICAid2lsbC1jaGFuZ2UiOiAiYXV0b3w8YW5pbWF0ZWFibGUtZmVhdHVyZT4jIiwKICAgICAgICAid29yZC1icmVhayI6ICJub3JtYWx8YnJlYWstYWxsfGtlZXAtYWxsfGJyZWFrLXdvcmQiLAogICAgICAgICJ3b3JkLXNwYWNpbmciOiAibm9ybWFsfDxsZW5ndGg+IiwKICAgICAgICAid29yZC13cmFwIjogIm5vcm1hbHxicmVhay13b3JkIiwKICAgICAgICAid3JpdGluZy1tb2RlIjogImhvcml6b250YWwtdGJ8dmVydGljYWwtcmx8dmVydGljYWwtbHJ8c2lkZXdheXMtcmx8c2lkZXdheXMtbHJ8PHN2Zy13cml0aW5nLW1vZGU+IiwKICAgICAgICAiei1pbmRleCI6ICJhdXRvfDxpbnRlZ2VyPiIsCiAgICAgICAgInpvb20iOiAibm9ybWFsfHJlc2V0fDxudW1iZXI+fDxwZXJjZW50YWdlPiIsCiAgICAgICAgIi1tb3otYmFja2dyb3VuZC1jbGlwIjogInBhZGRpbmd8Ym9yZGVyIiwKICAgICAgICAiLW1vei1ib3JkZXItcmFkaXVzLWJvdHRvbWxlZnQiOiAiPCdib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzJz4iLAogICAgICAgICItbW96LWJvcmRlci1yYWRpdXMtYm90dG9tcmlnaHQiOiAiPCdib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1cyc+IiwKICAgICAgICAiLW1vei1ib3JkZXItcmFkaXVzLXRvcGxlZnQiOiAiPCdib3JkZXItdG9wLWxlZnQtcmFkaXVzJz4iLAogICAgICAgICItbW96LWJvcmRlci1yYWRpdXMtdG9wcmlnaHQiOiAiPCdib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1cyc+IiwKICAgICAgICAiLW1vei1jb250cm9sLWNoYXJhY3Rlci12aXNpYmlsaXR5IjogInZpc2libGV8aGlkZGVuIiwKICAgICAgICAiLW1vei1vc3gtZm9udC1zbW9vdGhpbmciOiAiYXV0b3xncmF5c2NhbGUiLAogICAgICAgICItbW96LXVzZXItc2VsZWN0IjogIm5vbmV8dGV4dHxhbGx8LW1vei1ub25lIiwKICAgICAgICAiLW1zLWZsZXgtYWxpZ24iOiAic3RhcnR8ZW5kfGNlbnRlcnxiYXNlbGluZXxzdHJldGNoIiwKICAgICAgICAiLW1zLWZsZXgtaXRlbS1hbGlnbiI6ICJhdXRvfHN0YXJ0fGVuZHxjZW50ZXJ8YmFzZWxpbmV8c3RyZXRjaCIsCiAgICAgICAgIi1tcy1mbGV4LWxpbmUtcGFjayI6ICJzdGFydHxlbmR8Y2VudGVyfGp1c3RpZnl8ZGlzdHJpYnV0ZXxzdHJldGNoIiwKICAgICAgICAiLW1zLWZsZXgtbmVnYXRpdmUiOiAiPCdmbGV4LXNocmluayc+IiwKICAgICAgICAiLW1zLWZsZXgtcGFjayI6ICJzdGFydHxlbmR8Y2VudGVyfGp1c3RpZnl8ZGlzdHJpYnV0ZSIsCiAgICAgICAgIi1tcy1mbGV4LW9yZGVyIjogIjxpbnRlZ2VyPiIsCiAgICAgICAgIi1tcy1mbGV4LXBvc2l0aXZlIjogIjwnZmxleC1ncm93Jz4iLAogICAgICAgICItbXMtZmxleC1wcmVmZXJyZWQtc2l6ZSI6ICI8J2ZsZXgtYmFzaXMnPiIsCiAgICAgICAgIi1tcy1pbnRlcnBvbGF0aW9uLW1vZGUiOiAibmVhcmVzdC1uZWlnaGJvcnxiaWN1YmljIiwKICAgICAgICAiLW1zLWdyaWQtY29sdW1uLWFsaWduIjogInN0YXJ0fGVuZHxjZW50ZXJ8c3RyZXRjaCIsCiAgICAgICAgIi1tcy1ncmlkLXJvdy1hbGlnbiI6ICJzdGFydHxlbmR8Y2VudGVyfHN0cmV0Y2giLAogICAgICAgICItbXMtaHlwaGVuYXRlLWxpbWl0LWxhc3QiOiAibm9uZXxhbHdheXN8Y29sdW1ufHBhZ2V8c3ByZWFkIiwKICAgICAgICAiLXdlYmtpdC1iYWNrZ3JvdW5kLWNsaXAiOiAiWzxib3g+fGJvcmRlcnxwYWRkaW5nfGNvbnRlbnR8dGV4dF0jIiwKICAgICAgICAiLXdlYmtpdC1jb2x1bW4tYnJlYWstYWZ0ZXIiOiAiYWx3YXlzfGF1dG98YXZvaWQiLAogICAgICAgICItd2Via2l0LWNvbHVtbi1icmVhay1iZWZvcmUiOiAiYWx3YXlzfGF1dG98YXZvaWQiLAogICAgICAgICItd2Via2l0LWNvbHVtbi1icmVhay1pbnNpZGUiOiAiYWx3YXlzfGF1dG98YXZvaWQiLAogICAgICAgICItd2Via2l0LWZvbnQtc21vb3RoaW5nIjogImF1dG98bm9uZXxhbnRpYWxpYXNlZHxzdWJwaXhlbC1hbnRpYWxpYXNlZCIsCiAgICAgICAgIi13ZWJraXQtbWFzay1ib3gtaW1hZ2UiOiAiWzx1cmw+fDxncmFkaWVudD58bm9uZV0gWzxsZW5ndGgtcGVyY2VudGFnZT57NH0gPC13ZWJraXQtbWFzay1ib3gtcmVwZWF0PnsyfV0/IiwKICAgICAgICAiLXdlYmtpdC1wcmludC1jb2xvci1hZGp1c3QiOiAiZWNvbm9teXxleGFjdCIsCiAgICAgICAgIi13ZWJraXQtdGV4dC1zZWN1cml0eSI6ICJub25lfGNpcmNsZXxkaXNjfHNxdWFyZSIsCiAgICAgICAgIi13ZWJraXQtdXNlci1kcmFnIjogIm5vbmV8ZWxlbWVudHxhdXRvIiwKICAgICAgICAiLXdlYmtpdC11c2VyLXNlbGVjdCI6ICJhdXRvfG5vbmV8dGV4dHxhbGwiLAogICAgICAgICJhbGlnbm1lbnQtYmFzZWxpbmUiOiAiYXV0b3xiYXNlbGluZXxiZWZvcmUtZWRnZXx0ZXh0LWJlZm9yZS1lZGdlfG1pZGRsZXxjZW50cmFsfGFmdGVyLWVkZ2V8dGV4dC1hZnRlci1lZGdlfGlkZW9ncmFwaGljfGFscGhhYmV0aWN8aGFuZ2luZ3xtYXRoZW1hdGljYWwiLAogICAgICAgICJiYXNlbGluZS1zaGlmdCI6ICJiYXNlbGluZXxzdWJ8c3VwZXJ8PHN2Zy1sZW5ndGg+IiwKICAgICAgICAiYmVoYXZpb3IiOiAiPHVybD4rIiwKICAgICAgICAiY2xpcC1ydWxlIjogIm5vbnplcm98ZXZlbm9kZCIsCiAgICAgICAgImN1ZSI6ICI8J2N1ZS1iZWZvcmUnPiA8J2N1ZS1hZnRlcic+PyIsCiAgICAgICAgImN1ZS1hZnRlciI6ICI8dXJsPiA8ZGVjaWJlbD4/fG5vbmUiLAogICAgICAgICJjdWUtYmVmb3JlIjogIjx1cmw+IDxkZWNpYmVsPj98bm9uZSIsCiAgICAgICAgImRvbWluYW50LWJhc2VsaW5lIjogImF1dG98dXNlLXNjcmlwdHxuby1jaGFuZ2V8cmVzZXQtc2l6ZXxpZGVvZ3JhcGhpY3xhbHBoYWJldGljfGhhbmdpbmd8bWF0aGVtYXRpY2FsfGNlbnRyYWx8bWlkZGxlfHRleHQtYWZ0ZXItZWRnZXx0ZXh0LWJlZm9yZS1lZGdlIiwKICAgICAgICAiZmlsbCI6ICI8cGFpbnQ+IiwKICAgICAgICAiZmlsbC1vcGFjaXR5IjogIjxudW1iZXItemVyby1vbmU+IiwKICAgICAgICAiZmlsbC1ydWxlIjogIm5vbnplcm98ZXZlbm9kZCIsCiAgICAgICAgImdseXBoLW9yaWVudGF0aW9uLWhvcml6b250YWwiOiAiPGFuZ2xlPiIsCiAgICAgICAgImdseXBoLW9yaWVudGF0aW9uLXZlcnRpY2FsIjogIjxhbmdsZT4iLAogICAgICAgICJrZXJuaW5nIjogImF1dG98PHN2Zy1sZW5ndGg+IiwKICAgICAgICAibWFya2VyIjogIm5vbmV8PHVybD4iLAogICAgICAgICJtYXJrZXItZW5kIjogIm5vbmV8PHVybD4iLAogICAgICAgICJtYXJrZXItbWlkIjogIm5vbmV8PHVybD4iLAogICAgICAgICJtYXJrZXItc3RhcnQiOiAibm9uZXw8dXJsPiIsCiAgICAgICAgInBhdXNlIjogIjwncGF1c2UtYmVmb3JlJz4gPCdwYXVzZS1hZnRlcic+PyIsCiAgICAgICAgInBhdXNlLWFmdGVyIjogIjx0aW1lPnxub25lfHgtd2Vha3x3ZWFrfG1lZGl1bXxzdHJvbmd8eC1zdHJvbmciLAogICAgICAgICJwYXVzZS1iZWZvcmUiOiAiPHRpbWU+fG5vbmV8eC13ZWFrfHdlYWt8bWVkaXVtfHN0cm9uZ3x4LXN0cm9uZyIsCiAgICAgICAgInJlc3QiOiAiPCdyZXN0LWJlZm9yZSc+IDwncmVzdC1hZnRlcic+PyIsCiAgICAgICAgInJlc3QtYWZ0ZXIiOiAiPHRpbWU+fG5vbmV8eC13ZWFrfHdlYWt8bWVkaXVtfHN0cm9uZ3x4LXN0cm9uZyIsCiAgICAgICAgInJlc3QtYmVmb3JlIjogIjx0aW1lPnxub25lfHgtd2Vha3x3ZWFrfG1lZGl1bXxzdHJvbmd8eC1zdHJvbmciLAogICAgICAgICJzaGFwZS1yZW5kZXJpbmciOiAiYXV0b3xvcHRpbWl6ZVNwZWVkfGNyaXNwRWRnZXN8Z2VvbWV0cmljUHJlY2lzaW9uIiwKICAgICAgICAic3JjIjogIls8dXJsPiBbZm9ybWF0KCA8c3RyaW5nPiMgKV0/fGxvY2FsKCA8ZmFtaWx5LW5hbWU+ICldIyIsCiAgICAgICAgInNwZWFrIjogImF1dG98bm9uZXxub3JtYWwiLAogICAgICAgICJzcGVhay1hcyI6ICJub3JtYWx8c3BlbGwtb3V0fHxkaWdpdHN8fFtsaXRlcmFsLXB1bmN0dWF0aW9ufG5vLXB1bmN0dWF0aW9uXSIsCiAgICAgICAgInN0cm9rZSI6ICI8cGFpbnQ+IiwKICAgICAgICAic3Ryb2tlLWRhc2hhcnJheSI6ICJub25lfFs8c3ZnLWxlbmd0aD4rXSMiLAogICAgICAgICJzdHJva2UtZGFzaG9mZnNldCI6ICI8c3ZnLWxlbmd0aD4iLAogICAgICAgICJzdHJva2UtbGluZWNhcCI6ICJidXR0fHJvdW5kfHNxdWFyZSIsCiAgICAgICAgInN0cm9rZS1saW5lam9pbiI6ICJtaXRlcnxyb3VuZHxiZXZlbCIsCiAgICAgICAgInN0cm9rZS1taXRlcmxpbWl0IjogIjxudW1iZXItb25lLW9yLWdyZWF0ZXI+IiwKICAgICAgICAic3Ryb2tlLW9wYWNpdHkiOiAiPG51bWJlci16ZXJvLW9uZT4iLAogICAgICAgICJzdHJva2Utd2lkdGgiOiAiPHN2Zy1sZW5ndGg+IiwKICAgICAgICAidGV4dC1hbmNob3IiOiAic3RhcnR8bWlkZGxlfGVuZCIsCiAgICAgICAgInVuaWNvZGUtcmFuZ2UiOiAiPHVyYW5nZT4jIiwKICAgICAgICAidm9pY2UtYmFsYW5jZSI6ICI8bnVtYmVyPnxsZWZ0fGNlbnRlcnxyaWdodHxsZWZ0d2FyZHN8cmlnaHR3YXJkcyIsCiAgICAgICAgInZvaWNlLWR1cmF0aW9uIjogImF1dG98PHRpbWU+IiwKICAgICAgICAidm9pY2UtZmFtaWx5IjogIltbPGZhbWlseS1uYW1lPnw8Z2VuZXJpYy12b2ljZT5dICxdKiBbPGZhbWlseS1uYW1lPnw8Z2VuZXJpYy12b2ljZT5dfHByZXNlcnZlIiwKICAgICAgICAidm9pY2UtcGl0Y2giOiAiPGZyZXF1ZW5jeT4mJmFic29sdXRlfFtbeC1sb3d8bG93fG1lZGl1bXxoaWdofHgtaGlnaF18fFs8ZnJlcXVlbmN5Pnw8c2VtaXRvbmVzPnw8cGVyY2VudGFnZT5dXSIsCiAgICAgICAgInZvaWNlLXJhbmdlIjogIjxmcmVxdWVuY3k+JiZhYnNvbHV0ZXxbW3gtbG93fGxvd3xtZWRpdW18aGlnaHx4LWhpZ2hdfHxbPGZyZXF1ZW5jeT58PHNlbWl0b25lcz58PHBlcmNlbnRhZ2U+XV0iLAogICAgICAgICJ2b2ljZS1yYXRlIjogIltub3JtYWx8eC1zbG93fHNsb3d8bWVkaXVtfGZhc3R8eC1mYXN0XXx8PHBlcmNlbnRhZ2U+IiwKICAgICAgICAidm9pY2Utc3RyZXNzIjogIm5vcm1hbHxzdHJvbmd8bW9kZXJhdGV8bm9uZXxyZWR1Y2VkIiwKICAgICAgICAidm9pY2Utdm9sdW1lIjogInNpbGVudHxbW3gtc29mdHxzb2Z0fG1lZGl1bXxsb3VkfHgtbG91ZF18fDxkZWNpYmVsPl0iCiAgICB9LAogICAgImF0cnVsZXMiOiB7CiAgICAgICAgImNoYXJzZXQiOiB7CiAgICAgICAgICAgICJwcmVsdWRlIjogIjxzdHJpbmc+IiwKICAgICAgICAgICAgImRlc2NyaXB0b3JzIjogbnVsbAogICAgICAgIH0sCiAgICAgICAgImNvdW50ZXItc3R5bGUiOiB7CiAgICAgICAgICAgICJwcmVsdWRlIjogIjxjb3VudGVyLXN0eWxlLW5hbWU+IiwKICAgICAgICAgICAgImRlc2NyaXB0b3JzIjogewogICAgICAgICAgICAgICAgImFkZGl0aXZlLXN5bWJvbHMiOiAiWzxpbnRlZ2VyPiYmPHN5bWJvbD5dIyIsCiAgICAgICAgICAgICAgICAiZmFsbGJhY2siOiAiPGNvdW50ZXItc3R5bGUtbmFtZT4iLAogICAgICAgICAgICAgICAgIm5lZ2F0aXZlIjogIjxzeW1ib2w+IDxzeW1ib2w+PyIsCiAgICAgICAgICAgICAgICAicGFkIjogIjxpbnRlZ2VyPiYmPHN5bWJvbD4iLAogICAgICAgICAgICAgICAgInByZWZpeCI6ICI8c3ltYm9sPiIsCiAgICAgICAgICAgICAgICAicmFuZ2UiOiAiW1s8aW50ZWdlcj58aW5maW5pdGVdezJ9XSN8YXV0byIsCiAgICAgICAgICAgICAgICAic3BlYWstYXMiOiAiYXV0b3xidWxsZXRzfG51bWJlcnN8d29yZHN8c3BlbGwtb3V0fDxjb3VudGVyLXN0eWxlLW5hbWU+IiwKICAgICAgICAgICAgICAgICJzdWZmaXgiOiAiPHN5bWJvbD4iLAogICAgICAgICAgICAgICAgInN5bWJvbHMiOiAiPHN5bWJvbD4rIiwKICAgICAgICAgICAgICAgICJzeXN0ZW0iOiAiY3ljbGljfG51bWVyaWN8YWxwaGFiZXRpY3xzeW1ib2xpY3xhZGRpdGl2ZXxbZml4ZWQgPGludGVnZXI+P118W2V4dGVuZHMgPGNvdW50ZXItc3R5bGUtbmFtZT5dIgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAiZG9jdW1lbnQiOiB7CiAgICAgICAgICAgICJwcmVsdWRlIjogIls8dXJsPnx1cmwtcHJlZml4KCA8c3RyaW5nPiApfGRvbWFpbiggPHN0cmluZz4gKXxtZWRpYS1kb2N1bWVudCggPHN0cmluZz4gKXxyZWdleHAoIDxzdHJpbmc+ICldIyIsCiAgICAgICAgICAgICJkZXNjcmlwdG9ycyI6IG51bGwKICAgICAgICB9LAogICAgICAgICJmb250LWZhY2UiOiB7CiAgICAgICAgICAgICJwcmVsdWRlIjogbnVsbCwKICAgICAgICAgICAgImRlc2NyaXB0b3JzIjogewogICAgICAgICAgICAgICAgImFzY2VudC1vdmVycmlkZSI6ICJub3JtYWx8PHBlcmNlbnRhZ2U+IiwKICAgICAgICAgICAgICAgICJkZXNjZW50LW92ZXJyaWRlIjogIm5vcm1hbHw8cGVyY2VudGFnZT4iLAogICAgICAgICAgICAgICAgImZvbnQtZGlzcGxheSI6ICJbYXV0b3xibG9ja3xzd2FwfGZhbGxiYWNrfG9wdGlvbmFsXSIsCiAgICAgICAgICAgICAgICAiZm9udC1mYW1pbHkiOiAiPGZhbWlseS1uYW1lPiIsCiAgICAgICAgICAgICAgICAiZm9udC1mZWF0dXJlLXNldHRpbmdzIjogIm5vcm1hbHw8ZmVhdHVyZS10YWctdmFsdWU+IyIsCiAgICAgICAgICAgICAgICAiZm9udC12YXJpYXRpb24tc2V0dGluZ3MiOiAibm9ybWFsfFs8c3RyaW5nPiA8bnVtYmVyPl0jIiwKICAgICAgICAgICAgICAgICJmb250LXN0cmV0Y2giOiAiPGZvbnQtc3RyZXRjaC1hYnNvbHV0ZT57MSwyfSIsCiAgICAgICAgICAgICAgICAiZm9udC1zdHlsZSI6ICJub3JtYWx8aXRhbGljfG9ibGlxdWUgPGFuZ2xlPnswLDJ9IiwKICAgICAgICAgICAgICAgICJmb250LXdlaWdodCI6ICI8Zm9udC13ZWlnaHQtYWJzb2x1dGU+ezEsMn0iLAogICAgICAgICAgICAgICAgImZvbnQtdmFyaWFudCI6ICJub3JtYWx8bm9uZXxbPGNvbW1vbi1saWctdmFsdWVzPnx8PGRpc2NyZXRpb25hcnktbGlnLXZhbHVlcz58fDxoaXN0b3JpY2FsLWxpZy12YWx1ZXM+fHw8Y29udGV4dHVhbC1hbHQtdmFsdWVzPnx8c3R5bGlzdGljKCA8ZmVhdHVyZS12YWx1ZS1uYW1lPiApfHxoaXN0b3JpY2FsLWZvcm1zfHxzdHlsZXNldCggPGZlYXR1cmUtdmFsdWUtbmFtZT4jICl8fGNoYXJhY3Rlci12YXJpYW50KCA8ZmVhdHVyZS12YWx1ZS1uYW1lPiMgKXx8c3dhc2goIDxmZWF0dXJlLXZhbHVlLW5hbWU+ICl8fG9ybmFtZW50cyggPGZlYXR1cmUtdmFsdWUtbmFtZT4gKXx8YW5ub3RhdGlvbiggPGZlYXR1cmUtdmFsdWUtbmFtZT4gKXx8W3NtYWxsLWNhcHN8YWxsLXNtYWxsLWNhcHN8cGV0aXRlLWNhcHN8YWxsLXBldGl0ZS1jYXBzfHVuaWNhc2V8dGl0bGluZy1jYXBzXXx8PG51bWVyaWMtZmlndXJlLXZhbHVlcz58fDxudW1lcmljLXNwYWNpbmctdmFsdWVzPnx8PG51bWVyaWMtZnJhY3Rpb24tdmFsdWVzPnx8b3JkaW5hbHx8c2xhc2hlZC16ZXJvfHw8ZWFzdC1hc2lhbi12YXJpYW50LXZhbHVlcz58fDxlYXN0LWFzaWFuLXdpZHRoLXZhbHVlcz58fHJ1YnldIiwKICAgICAgICAgICAgICAgICJsaW5lLWdhcC1vdmVycmlkZSI6ICJub3JtYWx8PHBlcmNlbnRhZ2U+IiwKICAgICAgICAgICAgICAgICJzaXplLWFkanVzdCI6ICI8cGVyY2VudGFnZT4iLAogICAgICAgICAgICAgICAgInNyYyI6ICJbPHVybD4gW2Zvcm1hdCggPHN0cmluZz4jICldP3xsb2NhbCggPGZhbWlseS1uYW1lPiApXSMiLAogICAgICAgICAgICAgICAgInVuaWNvZGUtcmFuZ2UiOiAiPHVyYW5nZT4jIgogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAiZm9udC1mZWF0dXJlLXZhbHVlcyI6IHsKICAgICAgICAgICAgInByZWx1ZGUiOiAiPGZhbWlseS1uYW1lPiMiLAogICAgICAgICAgICAiZGVzY3JpcHRvcnMiOiBudWxsCiAgICAgICAgfSwKICAgICAgICAiaW1wb3J0IjogewogICAgICAgICAgICAicHJlbHVkZSI6ICJbPHN0cmluZz58PHVybD5dIFtsYXllcnxsYXllciggPGxheWVyLW5hbWU+ICldPyBbc3VwcG9ydHMoIFs8c3VwcG9ydHMtY29uZGl0aW9uPnw8ZGVjbGFyYXRpb24+XSApXT8gPG1lZGlhLXF1ZXJ5LWxpc3Q+PyIsCiAgICAgICAgICAgICJkZXNjcmlwdG9ycyI6IG51bGwKICAgICAgICB9LAogICAgICAgICJrZXlmcmFtZXMiOiB7CiAgICAgICAgICAgICJwcmVsdWRlIjogIjxrZXlmcmFtZXMtbmFtZT4iLAogICAgICAgICAgICAiZGVzY3JpcHRvcnMiOiBudWxsCiAgICAgICAgfSwKICAgICAgICAibGF5ZXIiOiB7CiAgICAgICAgICAgICJwcmVsdWRlIjogIls8bGF5ZXItbmFtZT4jfDxsYXllci1uYW1lPj9dIiwKICAgICAgICAgICAgImRlc2NyaXB0b3JzIjogbnVsbAogICAgICAgIH0sCiAgICAgICAgIm1lZGlhIjogewogICAgICAgICAgICAicHJlbHVkZSI6ICI8bWVkaWEtcXVlcnktbGlzdD4iLAogICAgICAgICAgICAiZGVzY3JpcHRvcnMiOiBudWxsCiAgICAgICAgfSwKICAgICAgICAibmFtZXNwYWNlIjogewogICAgICAgICAgICAicHJlbHVkZSI6ICI8bmFtZXNwYWNlLXByZWZpeD4/IFs8c3RyaW5nPnw8dXJsPl0iLAogICAgICAgICAgICAiZGVzY3JpcHRvcnMiOiBudWxsCiAgICAgICAgfSwKICAgICAgICAicGFnZSI6IHsKICAgICAgICAgICAgInByZWx1ZGUiOiAiPHBhZ2Utc2VsZWN0b3ItbGlzdD4iLAogICAgICAgICAgICAiZGVzY3JpcHRvcnMiOiB7CiAgICAgICAgICAgICAgICAiYmxlZWQiOiAiYXV0b3w8bGVuZ3RoPiIsCiAgICAgICAgICAgICAgICAibWFya3MiOiAibm9uZXxbY3JvcHx8Y3Jvc3NdIiwKICAgICAgICAgICAgICAgICJzaXplIjogIjxsZW5ndGg+ezEsMn18YXV0b3xbPHBhZ2Utc2l6ZT58fFtwb3J0cmFpdHxsYW5kc2NhcGVdXSIKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgInByb3BlcnR5IjogewogICAgICAgICAgICAicHJlbHVkZSI6ICI8Y3VzdG9tLXByb3BlcnR5LW5hbWU+IiwKICAgICAgICAgICAgImRlc2NyaXB0b3JzIjogewogICAgICAgICAgICAgICAgInN5bnRheCI6ICI8c3RyaW5nPiIsCiAgICAgICAgICAgICAgICAiaW5oZXJpdHMiOiAidHJ1ZXxmYWxzZSIsCiAgICAgICAgICAgICAgICAiaW5pdGlhbC12YWx1ZSI6ICI8c3RyaW5nPiIKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgInNjcm9sbC10aW1lbGluZSI6IHsKICAgICAgICAgICAgInByZWx1ZGUiOiAiPHRpbWVsaW5lLW5hbWU+IiwKICAgICAgICAgICAgImRlc2NyaXB0b3JzIjogbnVsbAogICAgICAgIH0sCiAgICAgICAgInN1cHBvcnRzIjogewogICAgICAgICAgICAicHJlbHVkZSI6ICI8c3VwcG9ydHMtY29uZGl0aW9uPiIsCiAgICAgICAgICAgICJkZXNjcmlwdG9ycyI6IG51bGwKICAgICAgICB9LAogICAgICAgICJ2aWV3cG9ydCI6IHsKICAgICAgICAgICAgInByZWx1ZGUiOiBudWxsLAogICAgICAgICAgICAiZGVzY3JpcHRvcnMiOiB7CiAgICAgICAgICAgICAgICAiaGVpZ2h0IjogIjx2aWV3cG9ydC1sZW5ndGg+ezEsMn0iLAogICAgICAgICAgICAgICAgIm1heC1oZWlnaHQiOiAiPHZpZXdwb3J0LWxlbmd0aD4iLAogICAgICAgICAgICAgICAgIm1heC13aWR0aCI6ICI8dmlld3BvcnQtbGVuZ3RoPiIsCiAgICAgICAgICAgICAgICAibWF4LXpvb20iOiAiYXV0b3w8bnVtYmVyPnw8cGVyY2VudGFnZT4iLAogICAgICAgICAgICAgICAgIm1pbi1oZWlnaHQiOiAiPHZpZXdwb3J0LWxlbmd0aD4iLAogICAgICAgICAgICAgICAgIm1pbi13aWR0aCI6ICI8dmlld3BvcnQtbGVuZ3RoPiIsCiAgICAgICAgICAgICAgICAibWluLXpvb20iOiAiYXV0b3w8bnVtYmVyPnw8cGVyY2VudGFnZT4iLAogICAgICAgICAgICAgICAgIm9yaWVudGF0aW9uIjogImF1dG98cG9ydHJhaXR8bGFuZHNjYXBlIiwKICAgICAgICAgICAgICAgICJ1c2VyLXpvb20iOiAiem9vbXxmaXhlZCIsCiAgICAgICAgICAgICAgICAidmlld3BvcnQtZml0IjogImF1dG98Y29udGFpbnxjb3ZlciIsCiAgICAgICAgICAgICAgICAid2lkdGgiOiAiPHZpZXdwb3J0LWxlbmd0aD57MSwyfSIsCiAgICAgICAgICAgICAgICAiem9vbSI6ICJhdXRvfDxudW1iZXI+fDxwZXJjZW50YWdlPiIKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgIm5lc3QiOiB7CiAgICAgICAgICAgICJwcmVsdWRlIjogIjxjb21wbGV4LXNlbGVjdG9yLWxpc3Q+IiwKICAgICAgICAgICAgImRlc2NyaXB0b3JzIjogbnVsbAogICAgICAgIH0KICAgIH0KfTsKCmNvbnN0IFBMVVNTSUdOJDUgPSAweDAwMkI7ICAgIC8vIFUrMDAyQiBQTFVTIFNJR04gKCspCmNvbnN0IEhZUEhFTk1JTlVTJDIgPSAweDAwMkQ7IC8vIFUrMDAyRCBIWVBIRU4tTUlOVVMgKC0pCmNvbnN0IE4gPSAweDAwNkU7ICAgICAgICAgICAvLyBVKzAwNkUgTEFUSU4gU01BTEwgTEVUVEVSIE4gKG4pCmNvbnN0IERJU0FMTE9XX1NJR04gPSB0cnVlOwpjb25zdCBBTExPV19TSUdOID0gZmFsc2U7CgpmdW5jdGlvbiBjaGVja0ludGVnZXIob2Zmc2V0LCBkaXNhbGxvd1NpZ24pIHsKICAgIGxldCBwb3MgPSB0aGlzLnRva2VuU3RhcnQgKyBvZmZzZXQ7CiAgICBjb25zdCBjb2RlID0gdGhpcy5jaGFyQ29kZUF0KHBvcyk7CgogICAgaWYgKGNvZGUgPT09IFBMVVNTSUdOJDUgfHwgY29kZSA9PT0gSFlQSEVOTUlOVVMkMikgewogICAgICAgIGlmIChkaXNhbGxvd1NpZ24pIHsKICAgICAgICAgICAgdGhpcy5lcnJvcignTnVtYmVyIHNpZ24gaXMgbm90IGFsbG93ZWQnKTsKICAgICAgICB9CiAgICAgICAgcG9zKys7CiAgICB9CgogICAgZm9yICg7IHBvcyA8IHRoaXMudG9rZW5FbmQ7IHBvcysrKSB7CiAgICAgICAgaWYgKCFpc0RpZ2l0KHRoaXMuY2hhckNvZGVBdChwb3MpKSkgewogICAgICAgICAgICB0aGlzLmVycm9yKCdJbnRlZ2VyIGlzIGV4cGVjdGVkJywgcG9zKTsKICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIGNoZWNrVG9rZW5Jc0ludGVnZXIoZGlzYWxsb3dTaWduKSB7CiAgICByZXR1cm4gY2hlY2tJbnRlZ2VyLmNhbGwodGhpcywgMCwgZGlzYWxsb3dTaWduKTsKfQoKZnVuY3Rpb24gZXhwZWN0Q2hhckNvZGUob2Zmc2V0LCBjb2RlKSB7CiAgICBpZiAoIXRoaXMuY21wQ2hhcih0aGlzLnRva2VuU3RhcnQgKyBvZmZzZXQsIGNvZGUpKSB7CiAgICAgICAgbGV0IG1zZyA9ICcnOwoKICAgICAgICBzd2l0Y2ggKGNvZGUpIHsKICAgICAgICAgICAgY2FzZSBOOgogICAgICAgICAgICAgICAgbXNnID0gJ04gaXMgZXhwZWN0ZWQnOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgSFlQSEVOTUlOVVMkMjoKICAgICAgICAgICAgICAgIG1zZyA9ICdIeXBoZW5NaW51cyBpcyBleHBlY3RlZCc7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIHRoaXMuZXJyb3IobXNnLCB0aGlzLnRva2VuU3RhcnQgKyBvZmZzZXQpOwogICAgfQp9CgovLyAuLi4gPHNpZ25lZC1pbnRlZ2VyPgovLyAuLi4gWycrJyB8ICctJ10gPHNpZ25sZXNzLWludGVnZXI+CmZ1bmN0aW9uIGNvbnN1bWVCKCkgewogICAgbGV0IG9mZnNldCA9IDA7CiAgICBsZXQgc2lnbiA9IDA7CiAgICBsZXQgdHlwZSA9IHRoaXMudG9rZW5UeXBlOwoKICAgIHdoaWxlICh0eXBlID09PSBXaGl0ZVNwYWNlJDEgfHwgdHlwZSA9PT0gQ29tbWVudCQxKSB7CiAgICAgICAgdHlwZSA9IHRoaXMubG9va3VwVHlwZSgrK29mZnNldCk7CiAgICB9CgogICAgaWYgKHR5cGUgIT09IE51bWJlciQyKSB7CiAgICAgICAgaWYgKHRoaXMuaXNEZWxpbShQTFVTU0lHTiQ1LCBvZmZzZXQpIHx8CiAgICAgICAgICAgIHRoaXMuaXNEZWxpbShIWVBIRU5NSU5VUyQyLCBvZmZzZXQpKSB7CiAgICAgICAgICAgIHNpZ24gPSB0aGlzLmlzRGVsaW0oUExVU1NJR04kNSwgb2Zmc2V0KSA/IFBMVVNTSUdOJDUgOiBIWVBIRU5NSU5VUyQyOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgdHlwZSA9IHRoaXMubG9va3VwVHlwZSgrK29mZnNldCk7CiAgICAgICAgICAgIH0gd2hpbGUgKHR5cGUgPT09IFdoaXRlU3BhY2UkMSB8fCB0eXBlID09PSBDb21tZW50JDEpOwoKICAgICAgICAgICAgaWYgKHR5cGUgIT09IE51bWJlciQyKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNraXAob2Zmc2V0KTsKICAgICAgICAgICAgICAgIGNoZWNrVG9rZW5Jc0ludGVnZXIuY2FsbCh0aGlzLCBESVNBTExPV19TSUdOKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAob2Zmc2V0ID4gMCkgewogICAgICAgIHRoaXMuc2tpcChvZmZzZXQpOwogICAgfQoKICAgIGlmIChzaWduID09PSAwKSB7CiAgICAgICAgdHlwZSA9IHRoaXMuY2hhckNvZGVBdCh0aGlzLnRva2VuU3RhcnQpOwogICAgICAgIGlmICh0eXBlICE9PSBQTFVTU0lHTiQ1ICYmIHR5cGUgIT09IEhZUEhFTk1JTlVTJDIpIHsKICAgICAgICAgICAgdGhpcy5lcnJvcignTnVtYmVyIHNpZ24gaXMgZXhwZWN0ZWQnKTsKICAgICAgICB9CiAgICB9CgogICAgY2hlY2tUb2tlbklzSW50ZWdlci5jYWxsKHRoaXMsIHNpZ24gIT09IDApOwogICAgcmV0dXJuIHNpZ24gPT09IEhZUEhFTk1JTlVTJDIgPyAnLScgKyB0aGlzLmNvbnN1bWUoTnVtYmVyJDIpIDogdGhpcy5jb25zdW1lKE51bWJlciQyKTsKfQoKLy8gQW4rQiBtaWNyb3N5bnRheCBodHRwczovL3d3dy53My5vcmcvVFIvY3NzLXN5bnRheC0zLyNhbmIKY29uc3QgbmFtZSRGID0gJ0FuUGx1c0InOwpjb25zdCBzdHJ1Y3R1cmUkRSA9IHsKICAgIGE6IFtTdHJpbmcsIG51bGxdLAogICAgYjogW1N0cmluZywgbnVsbF0KfTsKCmZ1bmN0aW9uIHBhcnNlJEYoKSB7CiAgICAvKiBlc2xpbnQtZGlzYWJsZSBicmFjZS1zdHlsZSovCiAgICBjb25zdCBzdGFydCA9IHRoaXMudG9rZW5TdGFydDsKICAgIGxldCBhID0gbnVsbDsKICAgIGxldCBiID0gbnVsbDsKCiAgICAvLyA8aW50ZWdlcj4KICAgIGlmICh0aGlzLnRva2VuVHlwZSA9PT0gTnVtYmVyJDIpIHsKICAgICAgICBjaGVja1Rva2VuSXNJbnRlZ2VyLmNhbGwodGhpcywgQUxMT1dfU0lHTik7CiAgICAgICAgYiA9IHRoaXMuY29uc3VtZShOdW1iZXIkMik7CiAgICB9CgogICAgLy8gLW4KICAgIC8vIC1uIDxzaWduZWQtaW50ZWdlcj4KICAgIC8vIC1uIFsnKycgfCAnLSddIDxzaWdubGVzcy1pbnRlZ2VyPgogICAgLy8gLW4tIDxzaWdubGVzcy1pbnRlZ2VyPgogICAgLy8gPGRhc2huZGFzaGRpZ2l0LWlkZW50PgogICAgZWxzZSBpZiAodGhpcy50b2tlblR5cGUgPT09IElkZW50ICYmIHRoaXMuY21wQ2hhcih0aGlzLnRva2VuU3RhcnQsIEhZUEhFTk1JTlVTJDIpKSB7CiAgICAgICAgYSA9ICctMSc7CgogICAgICAgIGV4cGVjdENoYXJDb2RlLmNhbGwodGhpcywgMSwgTik7CgogICAgICAgIHN3aXRjaCAodGhpcy50b2tlbkVuZCAtIHRoaXMudG9rZW5TdGFydCkgewogICAgICAgICAgICAvLyAtbgogICAgICAgICAgICAvLyAtbiA8c2lnbmVkLWludGVnZXI+CiAgICAgICAgICAgIC8vIC1uIFsnKycgfCAnLSddIDxzaWdubGVzcy1pbnRlZ2VyPgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICB0aGlzLm5leHQoKTsKICAgICAgICAgICAgICAgIGIgPSBjb25zdW1lQi5jYWxsKHRoaXMpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyAtbi0gPHNpZ25sZXNzLWludGVnZXI+CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIGV4cGVjdENoYXJDb2RlLmNhbGwodGhpcywgMiwgSFlQSEVOTUlOVVMkMik7CgogICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICB0aGlzLnNraXBTQygpOwoKICAgICAgICAgICAgICAgIGNoZWNrVG9rZW5Jc0ludGVnZXIuY2FsbCh0aGlzLCBESVNBTExPV19TSUdOKTsKCiAgICAgICAgICAgICAgICBiID0gJy0nICsgdGhpcy5jb25zdW1lKE51bWJlciQyKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgLy8gPGRhc2huZGFzaGRpZ2l0LWlkZW50PgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgZXhwZWN0Q2hhckNvZGUuY2FsbCh0aGlzLCAyLCBIWVBIRU5NSU5VUyQyKTsKICAgICAgICAgICAgICAgIGNoZWNrSW50ZWdlci5jYWxsKHRoaXMsIDMsIERJU0FMTE9XX1NJR04pOwogICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CgogICAgICAgICAgICAgICAgYiA9IHRoaXMuc3Vic3RyVG9DdXJzb3Ioc3RhcnQgKyAyKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gJysnPyBuCiAgICAvLyAnKyc/IG4gPHNpZ25lZC1pbnRlZ2VyPgogICAgLy8gJysnPyBuIFsnKycgfCAnLSddIDxzaWdubGVzcy1pbnRlZ2VyPgogICAgLy8gJysnPyBuLSA8c2lnbmxlc3MtaW50ZWdlcj4KICAgIC8vICcrJz8gPG5kYXNoZGlnaXQtaWRlbnQ+CiAgICBlbHNlIGlmICh0aGlzLnRva2VuVHlwZSA9PT0gSWRlbnQgfHwgKHRoaXMuaXNEZWxpbShQTFVTU0lHTiQ1KSAmJiB0aGlzLmxvb2t1cFR5cGUoMSkgPT09IElkZW50KSkgewogICAgICAgIGxldCBzaWduID0gMDsKICAgICAgICBhID0gJzEnOwoKICAgICAgICAvLyBqdXN0IGlnbm9yZSBhIHBsdXMKICAgICAgICBpZiAodGhpcy5pc0RlbGltKFBMVVNTSUdOJDUpKSB7CiAgICAgICAgICAgIHNpZ24gPSAxOwogICAgICAgICAgICB0aGlzLm5leHQoKTsKICAgICAgICB9CgogICAgICAgIGV4cGVjdENoYXJDb2RlLmNhbGwodGhpcywgMCwgTik7CgogICAgICAgIHN3aXRjaCAodGhpcy50b2tlbkVuZCAtIHRoaXMudG9rZW5TdGFydCkgewogICAgICAgICAgICAvLyAnKyc/IG4KICAgICAgICAgICAgLy8gJysnPyBuIDxzaWduZWQtaW50ZWdlcj4KICAgICAgICAgICAgLy8gJysnPyBuIFsnKycgfCAnLSddIDxzaWdubGVzcy1pbnRlZ2VyPgogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICB0aGlzLm5leHQoKTsKICAgICAgICAgICAgICAgIGIgPSBjb25zdW1lQi5jYWxsKHRoaXMpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyAnKyc/IG4tIDxzaWdubGVzcy1pbnRlZ2VyPgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBleHBlY3RDaGFyQ29kZS5jYWxsKHRoaXMsIDEsIEhZUEhFTk1JTlVTJDIpOwoKICAgICAgICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgICAgICAgICAgdGhpcy5za2lwU0MoKTsKCiAgICAgICAgICAgICAgICBjaGVja1Rva2VuSXNJbnRlZ2VyLmNhbGwodGhpcywgRElTQUxMT1dfU0lHTik7CgogICAgICAgICAgICAgICAgYiA9ICctJyArIHRoaXMuY29uc3VtZShOdW1iZXIkMik7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIC8vICcrJz8gPG5kYXNoZGlnaXQtaWRlbnQ+CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBleHBlY3RDaGFyQ29kZS5jYWxsKHRoaXMsIDEsIEhZUEhFTk1JTlVTJDIpOwogICAgICAgICAgICAgICAgY2hlY2tJbnRlZ2VyLmNhbGwodGhpcywgMiwgRElTQUxMT1dfU0lHTik7CiAgICAgICAgICAgICAgICB0aGlzLm5leHQoKTsKCiAgICAgICAgICAgICAgICBiID0gdGhpcy5zdWJzdHJUb0N1cnNvcihzdGFydCArIHNpZ24gKyAxKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gPG5kYXNoZGlnaXQtZGltZW5zaW9uPgogICAgLy8gPG5kYXNoLWRpbWVuc2lvbj4gPHNpZ25sZXNzLWludGVnZXI+CiAgICAvLyA8bi1kaW1lbnNpb24+CiAgICAvLyA8bi1kaW1lbnNpb24+IDxzaWduZWQtaW50ZWdlcj4KICAgIC8vIDxuLWRpbWVuc2lvbj4gWycrJyB8ICctJ10gPHNpZ25sZXNzLWludGVnZXI+CiAgICBlbHNlIGlmICh0aGlzLnRva2VuVHlwZSA9PT0gRGltZW5zaW9uJDEpIHsKICAgICAgICBjb25zdCBjb2RlID0gdGhpcy5jaGFyQ29kZUF0KHRoaXMudG9rZW5TdGFydCk7CiAgICAgICAgY29uc3Qgc2lnbiA9IGNvZGUgPT09IFBMVVNTSUdOJDUgfHwgY29kZSA9PT0gSFlQSEVOTUlOVVMkMjsKICAgICAgICBsZXQgaSA9IHRoaXMudG9rZW5TdGFydCArIHNpZ247CgogICAgICAgIGZvciAoOyBpIDwgdGhpcy50b2tlbkVuZDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghaXNEaWdpdCh0aGlzLmNoYXJDb2RlQXQoaSkpKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGkgPT09IHRoaXMudG9rZW5TdGFydCArIHNpZ24pIHsKICAgICAgICAgICAgdGhpcy5lcnJvcignSW50ZWdlciBpcyBleHBlY3RlZCcsIHRoaXMudG9rZW5TdGFydCArIHNpZ24pOwogICAgICAgIH0KCiAgICAgICAgZXhwZWN0Q2hhckNvZGUuY2FsbCh0aGlzLCBpIC0gdGhpcy50b2tlblN0YXJ0LCBOKTsKICAgICAgICBhID0gdGhpcy5zdWJzdHJpbmcoc3RhcnQsIGkpOwoKICAgICAgICAvLyA8bi1kaW1lbnNpb24+CiAgICAgICAgLy8gPG4tZGltZW5zaW9uPiA8c2lnbmVkLWludGVnZXI+CiAgICAgICAgLy8gPG4tZGltZW5zaW9uPiBbJysnIHwgJy0nXSA8c2lnbmxlc3MtaW50ZWdlcj4KICAgICAgICBpZiAoaSArIDEgPT09IHRoaXMudG9rZW5FbmQpIHsKICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgIGIgPSBjb25zdW1lQi5jYWxsKHRoaXMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGV4cGVjdENoYXJDb2RlLmNhbGwodGhpcywgaSAtIHRoaXMudG9rZW5TdGFydCArIDEsIEhZUEhFTk1JTlVTJDIpOwoKICAgICAgICAgICAgLy8gPG5kYXNoLWRpbWVuc2lvbj4gPHNpZ25sZXNzLWludGVnZXI+CiAgICAgICAgICAgIGlmIChpICsgMiA9PT0gdGhpcy50b2tlbkVuZCkgewogICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICB0aGlzLnNraXBTQygpOwogICAgICAgICAgICAgICAgY2hlY2tUb2tlbklzSW50ZWdlci5jYWxsKHRoaXMsIERJU0FMTE9XX1NJR04pOwogICAgICAgICAgICAgICAgYiA9ICctJyArIHRoaXMuY29uc3VtZShOdW1iZXIkMik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gPG5kYXNoZGlnaXQtZGltZW5zaW9uPgogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGNoZWNrSW50ZWdlci5jYWxsKHRoaXMsIGkgLSB0aGlzLnRva2VuU3RhcnQgKyAyLCBESVNBTExPV19TSUdOKTsKICAgICAgICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgICAgICAgICAgYiA9IHRoaXMuc3Vic3RyVG9DdXJzb3IoaSArIDEpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmVycm9yKCk7CiAgICB9CgogICAgaWYgKGEgIT09IG51bGwgJiYgYS5jaGFyQ29kZUF0KDApID09PSBQTFVTU0lHTiQ1KSB7CiAgICAgICAgYSA9IGEuc3Vic3RyKDEpOwogICAgfQoKICAgIGlmIChiICE9PSBudWxsICYmIGIuY2hhckNvZGVBdCgwKSA9PT0gUExVU1NJR04kNSkgewogICAgICAgIGIgPSBiLnN1YnN0cigxKTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdBblBsdXNCJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMudG9rZW5TdGFydCksCiAgICAgICAgYSwKICAgICAgICBiCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSRGKG5vZGUpIHsKICAgIGlmIChub2RlLmEpIHsKICAgICAgICBjb25zdCBhID0KICAgICAgICAgICAgbm9kZS5hID09PSAnKzEnICYmICduJyB8fAogICAgICAgICAgICBub2RlLmEgPT09ICAnMScgJiYgJ24nIHx8CiAgICAgICAgICAgIG5vZGUuYSA9PT0gJy0xJyAmJiAnLW4nIHx8CiAgICAgICAgICAgIG5vZGUuYSArICduJzsKCiAgICAgICAgaWYgKG5vZGUuYikgewogICAgICAgICAgICBjb25zdCBiID0gbm9kZS5iWzBdID09PSAnLScgfHwgbm9kZS5iWzBdID09PSAnKycKICAgICAgICAgICAgICAgID8gbm9kZS5iCiAgICAgICAgICAgICAgICA6ICcrJyArIG5vZGUuYjsKICAgICAgICAgICAgdGhpcy50b2tlbml6ZShhICsgYik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy50b2tlbml6ZShhKTsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIHRoaXMudG9rZW5pemUobm9kZS5iKTsKICAgIH0KfQoKY29uc3QgQW5QbHVzQiA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJEYsCiAgICBuYW1lOiBuYW1lJEYsCiAgICBwYXJzZTogcGFyc2UkRiwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJEUKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7CgpmdW5jdGlvbiBjb25zdW1lUmF3JDUoc3RhcnRUb2tlbikgewogICAgcmV0dXJuIHRoaXMuUmF3KHN0YXJ0VG9rZW4sIHRoaXMuY29uc3VtZVVudGlsTGVmdEN1cmx5QnJhY2tldE9yU2VtaWNvbG9uLCB0cnVlKTsKfQoKZnVuY3Rpb24gaXNEZWNsYXJhdGlvbkJsb2NrQXRydWxlKCkgewogICAgZm9yIChsZXQgb2Zmc2V0ID0gMSwgdHlwZTsgdHlwZSA9IHRoaXMubG9va3VwVHlwZShvZmZzZXQpOyBvZmZzZXQrKykgewogICAgICAgIGlmICh0eXBlID09PSBSaWdodEN1cmx5QnJhY2tldCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmICh0eXBlID09PSBMZWZ0Q3VybHlCcmFja2V0IHx8CiAgICAgICAgICAgIHR5cGUgPT09IEF0S2V5d29yZCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKfQoKCmNvbnN0IG5hbWUkRSA9ICdBdHJ1bGUnOwpjb25zdCB3YWxrQ29udGV4dCQ5ID0gJ2F0cnVsZSc7CmNvbnN0IHN0cnVjdHVyZSREID0gewogICAgbmFtZTogU3RyaW5nLAogICAgcHJlbHVkZTogWydBdHJ1bGVQcmVsdWRlJywgJ1JhdycsIG51bGxdLAogICAgYmxvY2s6IFsnQmxvY2snLCBudWxsXQp9OwoKZnVuY3Rpb24gcGFyc2UkRShpc0RlY2xhcmF0aW9uID0gZmFsc2UpIHsKICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwogICAgbGV0IG5hbWU7CiAgICBsZXQgbmFtZUxvd2VyQ2FzZTsKICAgIGxldCBwcmVsdWRlID0gbnVsbDsKICAgIGxldCBibG9jayA9IG51bGw7CgogICAgdGhpcy5lYXQoQXRLZXl3b3JkKTsKCiAgICBuYW1lID0gdGhpcy5zdWJzdHJUb0N1cnNvcihzdGFydCArIDEpOwogICAgbmFtZUxvd2VyQ2FzZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKICAgIHRoaXMuc2tpcFNDKCk7CgogICAgLy8gcGFyc2UgcHJlbHVkZQogICAgaWYgKHRoaXMuZW9mID09PSBmYWxzZSAmJgogICAgICAgIHRoaXMudG9rZW5UeXBlICE9PSBMZWZ0Q3VybHlCcmFja2V0ICYmCiAgICAgICAgdGhpcy50b2tlblR5cGUgIT09IFNlbWljb2xvbikgewogICAgICAgIGlmICh0aGlzLnBhcnNlQXRydWxlUHJlbHVkZSkgewogICAgICAgICAgICBwcmVsdWRlID0gdGhpcy5wYXJzZVdpdGhGYWxsYmFjayh0aGlzLkF0cnVsZVByZWx1ZGUuYmluZCh0aGlzLCBuYW1lLCBpc0RlY2xhcmF0aW9uKSwgY29uc3VtZVJhdyQ1KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwcmVsdWRlID0gY29uc3VtZVJhdyQ1LmNhbGwodGhpcywgdGhpcy50b2tlbkluZGV4KTsKICAgICAgICB9CgogICAgICAgIHRoaXMuc2tpcFNDKCk7CiAgICB9CgogICAgc3dpdGNoICh0aGlzLnRva2VuVHlwZSkgewogICAgICAgIGNhc2UgU2VtaWNvbG9uOgogICAgICAgICAgICB0aGlzLm5leHQoKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgTGVmdEN1cmx5QnJhY2tldDoKICAgICAgICAgICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwodGhpcy5hdHJ1bGUsIG5hbWVMb3dlckNhc2UpICYmCiAgICAgICAgICAgICAgICB0eXBlb2YgdGhpcy5hdHJ1bGVbbmFtZUxvd2VyQ2FzZV0uYmxvY2sgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgIGJsb2NrID0gdGhpcy5hdHJ1bGVbbmFtZUxvd2VyQ2FzZV0uYmxvY2suY2FsbCh0aGlzLCBpc0RlY2xhcmF0aW9uKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIFRPRE86IHNob3VsZCBjb25zdW1lIGJsb2NrIGNvbnRlbnQgYXMgUmF3PwogICAgICAgICAgICAgICAgYmxvY2sgPSB0aGlzLkJsb2NrKGlzRGVjbGFyYXRpb25CbG9ja0F0cnVsZS5jYWxsKHRoaXMpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnQXRydWxlJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMudG9rZW5TdGFydCksCiAgICAgICAgbmFtZSwKICAgICAgICBwcmVsdWRlLAogICAgICAgIGJsb2NrCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSRFKG5vZGUpIHsKICAgIHRoaXMudG9rZW4oQXRLZXl3b3JkLCAnQCcgKyBub2RlLm5hbWUpOwoKICAgIGlmIChub2RlLnByZWx1ZGUgIT09IG51bGwpIHsKICAgICAgICB0aGlzLm5vZGUobm9kZS5wcmVsdWRlKTsKICAgIH0KCiAgICBpZiAobm9kZS5ibG9jaykgewogICAgICAgIHRoaXMubm9kZShub2RlLmJsb2NrKTsKICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy50b2tlbihTZW1pY29sb24sICc7Jyk7CiAgICB9Cn0KCmNvbnN0IEF0cnVsZSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJEUsCiAgICBuYW1lOiBuYW1lJEUsCiAgICBwYXJzZTogcGFyc2UkRSwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJEQsCiAgICB3YWxrQ29udGV4dDogd2Fsa0NvbnRleHQkOQp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmNvbnN0IG5hbWUkRCA9ICdBdHJ1bGVQcmVsdWRlJzsKY29uc3Qgd2Fsa0NvbnRleHQkOCA9ICdhdHJ1bGVQcmVsdWRlJzsKY29uc3Qgc3RydWN0dXJlJEMgPSB7CiAgICBjaGlsZHJlbjogW1tdXQp9OwoKZnVuY3Rpb24gcGFyc2UkRChuYW1lKSB7CiAgICBsZXQgY2hpbGRyZW4gPSBudWxsOwoKICAgIGlmIChuYW1lICE9PSBudWxsKSB7CiAgICAgICAgbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKICAgIH0KCiAgICB0aGlzLnNraXBTQygpOwoKICAgIGlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaXMuYXRydWxlLCBuYW1lKSAmJgogICAgICAgIHR5cGVvZiB0aGlzLmF0cnVsZVtuYW1lXS5wcmVsdWRlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgLy8gY3VzdG9tIGNvbnN1bWVyCiAgICAgICAgY2hpbGRyZW4gPSB0aGlzLmF0cnVsZVtuYW1lXS5wcmVsdWRlLmNhbGwodGhpcyk7CiAgICB9IGVsc2UgewogICAgICAgIC8vIGRlZmF1bHQgY29uc3VtZXIKICAgICAgICBjaGlsZHJlbiA9IHRoaXMucmVhZFNlcXVlbmNlKHRoaXMuc2NvcGUuQXRydWxlUHJlbHVkZSk7CiAgICB9CgogICAgdGhpcy5za2lwU0MoKTsKCiAgICBpZiAodGhpcy5lb2YgIT09IHRydWUgJiYKICAgICAgICB0aGlzLnRva2VuVHlwZSAhPT0gTGVmdEN1cmx5QnJhY2tldCAmJgogICAgICAgIHRoaXMudG9rZW5UeXBlICE9PSBTZW1pY29sb24pIHsKICAgICAgICB0aGlzLmVycm9yKCdTZW1pY29sb24gb3IgYmxvY2sgaXMgZXhwZWN0ZWQnKTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdBdHJ1bGVQcmVsdWRlJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb25Gcm9tTGlzdChjaGlsZHJlbiksCiAgICAgICAgY2hpbGRyZW4KICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJEQobm9kZSkgewogICAgdGhpcy5jaGlsZHJlbihub2RlKTsKfQoKY29uc3QgQXRydWxlUHJlbHVkZSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJEQsCiAgICBuYW1lOiBuYW1lJEQsCiAgICBwYXJzZTogcGFyc2UkRCwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJEMsCiAgICB3YWxrQ29udGV4dDogd2Fsa0NvbnRleHQkOAp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmNvbnN0IERPTExBUlNJR04kMSA9IDB4MDAyNDsgICAgICAgLy8gVSswMDI0IERPTExBUiBTSUdOICgkKQpjb25zdCBBU1RFUklTSyQ1ID0gMHgwMDJBOyAgICAgICAgIC8vIFUrMDAyQSBBU1RFUklTSyAoKikKY29uc3QgRVFVQUxTU0lHTiA9IDB4MDAzRDsgICAgICAgLy8gVSswMDNEIEVRVUFMUyBTSUdOICg9KQpjb25zdCBDSVJDVU1GTEVYQUNDRU5UID0gMHgwMDVFOyAvLyBVKzAwNUUgKF4pCmNvbnN0IFZFUlRJQ0FMTElORSQyID0gMHgwMDdDOyAgICAgLy8gVSswMDdDIFZFUlRJQ0FMIExJTkUgKHwpCmNvbnN0IFRJTERFJDIgPSAweDAwN0U7ICAgICAgICAgICAgLy8gVSswMDdFIFRJTERFICh+KQoKZnVuY3Rpb24gZ2V0QXR0cmlidXRlTmFtZSgpIHsKICAgIGlmICh0aGlzLmVvZikgewogICAgICAgIHRoaXMuZXJyb3IoJ1VuZXhwZWN0ZWQgZW5kIG9mIGlucHV0Jyk7CiAgICB9CgogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CiAgICBsZXQgZXhwZWN0SWRlbnQgPSBmYWxzZTsKCiAgICBpZiAodGhpcy5pc0RlbGltKEFTVEVSSVNLJDUpKSB7CiAgICAgICAgZXhwZWN0SWRlbnQgPSB0cnVlOwogICAgICAgIHRoaXMubmV4dCgpOwogICAgfSBlbHNlIGlmICghdGhpcy5pc0RlbGltKFZFUlRJQ0FMTElORSQyKSkgewogICAgICAgIHRoaXMuZWF0KElkZW50KTsKICAgIH0KCiAgICBpZiAodGhpcy5pc0RlbGltKFZFUlRJQ0FMTElORSQyKSkgewogICAgICAgIGlmICh0aGlzLmNoYXJDb2RlQXQodGhpcy50b2tlblN0YXJ0ICsgMSkgIT09IEVRVUFMU1NJR04pIHsKICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgIHRoaXMuZWF0KElkZW50KTsKICAgICAgICB9IGVsc2UgaWYgKGV4cGVjdElkZW50KSB7CiAgICAgICAgICAgIHRoaXMuZXJyb3IoJ0lkZW50aWZpZXIgaXMgZXhwZWN0ZWQnLCB0aGlzLnRva2VuRW5kKTsKICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGV4cGVjdElkZW50KSB7CiAgICAgICAgdGhpcy5lcnJvcignVmVydGljYWwgbGluZSBpcyBleHBlY3RlZCcpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ0lkZW50aWZpZXInLAogICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydCwgdGhpcy50b2tlblN0YXJ0KSwKICAgICAgICBuYW1lOiB0aGlzLnN1YnN0clRvQ3Vyc29yKHN0YXJ0KQogICAgfTsKfQoKZnVuY3Rpb24gZ2V0T3BlcmF0b3IoKSB7CiAgICBjb25zdCBzdGFydCA9IHRoaXMudG9rZW5TdGFydDsKICAgIGNvbnN0IGNvZGUgPSB0aGlzLmNoYXJDb2RlQXQoc3RhcnQpOwoKICAgIGlmIChjb2RlICE9PSBFUVVBTFNTSUdOICYmICAgICAgICAvLyA9CiAgICAgICAgY29kZSAhPT0gVElMREUkMiAmJiAgICAgICAgICAgICAvLyB+PQogICAgICAgIGNvZGUgIT09IENJUkNVTUZMRVhBQ0NFTlQgJiYgIC8vIF49CiAgICAgICAgY29kZSAhPT0gRE9MTEFSU0lHTiQxICYmICAgICAgICAvLyAkPQogICAgICAgIGNvZGUgIT09IEFTVEVSSVNLJDUgJiYgICAgICAgICAgLy8gKj0KICAgICAgICBjb2RlICE9PSBWRVJUSUNBTExJTkUkMiAgICAgICAgIC8vIHw9CiAgICApIHsKICAgICAgICB0aGlzLmVycm9yKCdBdHRyaWJ1dGUgc2VsZWN0b3IgKD0sIH49LCBePSwgJD0sICo9LCB8PSkgaXMgZXhwZWN0ZWQnKTsKICAgIH0KCiAgICB0aGlzLm5leHQoKTsKCiAgICBpZiAoY29kZSAhPT0gRVFVQUxTU0lHTikgewogICAgICAgIGlmICghdGhpcy5pc0RlbGltKEVRVUFMU1NJR04pKSB7CiAgICAgICAgICAgIHRoaXMuZXJyb3IoJ0VxdWFsIHNpZ24gaXMgZXhwZWN0ZWQnKTsKICAgICAgICB9CgogICAgICAgIHRoaXMubmV4dCgpOwogICAgfQoKICAgIHJldHVybiB0aGlzLnN1YnN0clRvQ3Vyc29yKHN0YXJ0KTsKfQoKLy8gJ1snIDx3cS1uYW1lPiAnXScKLy8gJ1snIDx3cS1uYW1lPiA8YXR0ci1tYXRjaGVyPiBbIDxzdHJpbmctdG9rZW4+IHwgPGlkZW50LXRva2VuPiBdIDxhdHRyLW1vZGlmaWVyPj8gJ10nCmNvbnN0IG5hbWUkQyA9ICdBdHRyaWJ1dGVTZWxlY3Rvcic7CmNvbnN0IHN0cnVjdHVyZSRCID0gewogICAgbmFtZTogJ0lkZW50aWZpZXInLAogICAgbWF0Y2hlcjogW1N0cmluZywgbnVsbF0sCiAgICB2YWx1ZTogWydTdHJpbmcnLCAnSWRlbnRpZmllcicsIG51bGxdLAogICAgZmxhZ3M6IFtTdHJpbmcsIG51bGxdCn07CgpmdW5jdGlvbiBwYXJzZSRDKCkgewogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CiAgICBsZXQgbmFtZTsKICAgIGxldCBtYXRjaGVyID0gbnVsbDsKICAgIGxldCB2YWx1ZSA9IG51bGw7CiAgICBsZXQgZmxhZ3MgPSBudWxsOwoKICAgIHRoaXMuZWF0KExlZnRTcXVhcmVCcmFja2V0KTsKICAgIHRoaXMuc2tpcFNDKCk7CgogICAgbmFtZSA9IGdldEF0dHJpYnV0ZU5hbWUuY2FsbCh0aGlzKTsKICAgIHRoaXMuc2tpcFNDKCk7CgogICAgaWYgKHRoaXMudG9rZW5UeXBlICE9PSBSaWdodFNxdWFyZUJyYWNrZXQpIHsKICAgICAgICAvLyBhdm9pZCBjYXNlIGBbbmFtZSBpXWAKICAgICAgICBpZiAodGhpcy50b2tlblR5cGUgIT09IElkZW50KSB7CiAgICAgICAgICAgIG1hdGNoZXIgPSBnZXRPcGVyYXRvci5jYWxsKHRoaXMpOwoKICAgICAgICAgICAgdGhpcy5za2lwU0MoKTsKCiAgICAgICAgICAgIHZhbHVlID0gdGhpcy50b2tlblR5cGUgPT09IFN0cmluZyQyCiAgICAgICAgICAgICAgICA/IHRoaXMuU3RyaW5nKCkKICAgICAgICAgICAgICAgIDogdGhpcy5JZGVudGlmaWVyKCk7CgogICAgICAgICAgICB0aGlzLnNraXBTQygpOwogICAgICAgIH0KCiAgICAgICAgLy8gYXR0cmlidXRlIGZsYWdzCiAgICAgICAgaWYgKHRoaXMudG9rZW5UeXBlID09PSBJZGVudCkgewogICAgICAgICAgICBmbGFncyA9IHRoaXMuY29uc3VtZShJZGVudCk7CgogICAgICAgICAgICB0aGlzLnNraXBTQygpOwogICAgICAgIH0KICAgIH0KCiAgICB0aGlzLmVhdChSaWdodFNxdWFyZUJyYWNrZXQpOwoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ0F0dHJpYnV0ZVNlbGVjdG9yJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMudG9rZW5TdGFydCksCiAgICAgICAgbmFtZSwKICAgICAgICBtYXRjaGVyLAogICAgICAgIHZhbHVlLAogICAgICAgIGZsYWdzCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSRDKG5vZGUpIHsKICAgIHRoaXMudG9rZW4oRGVsaW0sICdbJyk7CiAgICB0aGlzLm5vZGUobm9kZS5uYW1lKTsKCiAgICBpZiAobm9kZS5tYXRjaGVyICE9PSBudWxsKSB7CiAgICAgICAgdGhpcy50b2tlbml6ZShub2RlLm1hdGNoZXIpOwogICAgICAgIHRoaXMubm9kZShub2RlLnZhbHVlKTsKICAgIH0KCiAgICBpZiAobm9kZS5mbGFncyAhPT0gbnVsbCkgewogICAgICAgIHRoaXMudG9rZW4oSWRlbnQsIG5vZGUuZmxhZ3MpOwogICAgfQoKICAgIHRoaXMudG9rZW4oRGVsaW0sICddJyk7Cn0KCmNvbnN0IEF0dHJpYnV0ZVNlbGVjdG9yID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoLyojX19QVVJFX18qL09iamVjdC5kZWZpbmVQcm9wZXJ0eSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBnZW5lcmF0ZTogZ2VuZXJhdGUkQywKICAgIG5hbWU6IG5hbWUkQywKICAgIHBhcnNlOiBwYXJzZSRDLAogICAgc3RydWN0dXJlOiBzdHJ1Y3R1cmUkQgp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmNvbnN0IEFNUEVSU0FORCQ0ID0gMHgwMDI2OyAgICAgICAvLyBVKzAwMjYgQU1QRVJTQU5EICgmKQoKZnVuY3Rpb24gY29uc3VtZVJhdyQ0KHN0YXJ0VG9rZW4pIHsKICAgIHJldHVybiB0aGlzLlJhdyhzdGFydFRva2VuLCBudWxsLCB0cnVlKTsKfQpmdW5jdGlvbiBjb25zdW1lUnVsZSgpIHsKICAgIHJldHVybiB0aGlzLnBhcnNlV2l0aEZhbGxiYWNrKHRoaXMuUnVsZSwgY29uc3VtZVJhdyQ0KTsKfQpmdW5jdGlvbiBjb25zdW1lUmF3RGVjbGFyYXRpb24oc3RhcnRUb2tlbikgewogICAgcmV0dXJuIHRoaXMuUmF3KHN0YXJ0VG9rZW4sIHRoaXMuY29uc3VtZVVudGlsU2VtaWNvbG9uSW5jbHVkZWQsIHRydWUpOwp9CmZ1bmN0aW9uIGNvbnN1bWVEZWNsYXJhdGlvbigpIHsKICAgIGlmICh0aGlzLnRva2VuVHlwZSA9PT0gU2VtaWNvbG9uKSB7CiAgICAgICAgcmV0dXJuIGNvbnN1bWVSYXdEZWNsYXJhdGlvbi5jYWxsKHRoaXMsIHRoaXMudG9rZW5JbmRleCk7CiAgICB9CgogICAgY29uc3Qgbm9kZSA9IHRoaXMucGFyc2VXaXRoRmFsbGJhY2sodGhpcy5EZWNsYXJhdGlvbiwgY29uc3VtZVJhd0RlY2xhcmF0aW9uKTsKCiAgICBpZiAodGhpcy50b2tlblR5cGUgPT09IFNlbWljb2xvbikgewogICAgICAgIHRoaXMubmV4dCgpOwogICAgfQoKICAgIHJldHVybiBub2RlOwp9Cgpjb25zdCBuYW1lJEIgPSAnQmxvY2snOwpjb25zdCB3YWxrQ29udGV4dCQ3ID0gJ2Jsb2NrJzsKY29uc3Qgc3RydWN0dXJlJEEgPSB7CiAgICBjaGlsZHJlbjogW1sKICAgICAgICAnQXRydWxlJywKICAgICAgICAnUnVsZScsCiAgICAgICAgJ0RlY2xhcmF0aW9uJwogICAgXV0KfTsKCmZ1bmN0aW9uIHBhcnNlJEIoaXNTdHlsZUJsb2NrKSB7CiAgICBjb25zdCBjb25zdW1lciA9IGlzU3R5bGVCbG9jayA/IGNvbnN1bWVEZWNsYXJhdGlvbiA6IGNvbnN1bWVSdWxlOwogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CiAgICBsZXQgY2hpbGRyZW4gPSB0aGlzLmNyZWF0ZUxpc3QoKTsKCiAgICB0aGlzLmVhdChMZWZ0Q3VybHlCcmFja2V0KTsKCiAgICBzY2FuOgogICAgd2hpbGUgKCF0aGlzLmVvZikgewogICAgICAgIHN3aXRjaCAodGhpcy50b2tlblR5cGUpIHsKICAgICAgICAgICAgY2FzZSBSaWdodEN1cmx5QnJhY2tldDoKICAgICAgICAgICAgICAgIGJyZWFrIHNjYW47CgogICAgICAgICAgICBjYXNlIFdoaXRlU3BhY2UkMToKICAgICAgICAgICAgY2FzZSBDb21tZW50JDE6CiAgICAgICAgICAgICAgICB0aGlzLm5leHQoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBBdEtleXdvcmQ6CiAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKHRoaXMucGFyc2VXaXRoRmFsbGJhY2sodGhpcy5BdHJ1bGUuYmluZCh0aGlzLCBpc1N0eWxlQmxvY2spLCBjb25zdW1lUmF3JDQpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGlmIChpc1N0eWxlQmxvY2sgJiYgdGhpcy5pc0RlbGltKEFNUEVSU0FORCQ0KSkgIHsKICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKGNvbnN1bWVSdWxlLmNhbGwodGhpcykpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKGNvbnN1bWVyLmNhbGwodGhpcykpOwogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBpZiAoIXRoaXMuZW9mKSB7CiAgICAgICAgdGhpcy5lYXQoUmlnaHRDdXJseUJyYWNrZXQpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ0Jsb2NrJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMudG9rZW5TdGFydCksCiAgICAgICAgY2hpbGRyZW4KICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJEIobm9kZSkgewogICAgdGhpcy50b2tlbihMZWZ0Q3VybHlCcmFja2V0LCAneycpOwogICAgdGhpcy5jaGlsZHJlbihub2RlLCBwcmV2ID0+IHsKICAgICAgICBpZiAocHJldi50eXBlID09PSAnRGVjbGFyYXRpb24nKSB7CiAgICAgICAgICAgIHRoaXMudG9rZW4oU2VtaWNvbG9uLCAnOycpOwogICAgICAgIH0KICAgIH0pOwogICAgdGhpcy50b2tlbihSaWdodEN1cmx5QnJhY2tldCwgJ30nKTsKfQoKY29uc3QgQmxvY2sgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSRCLAogICAgbmFtZTogbmFtZSRCLAogICAgcGFyc2U6IHBhcnNlJEIsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSRBLAogICAgd2Fsa0NvbnRleHQ6IHdhbGtDb250ZXh0JDcKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCBuYW1lJEEgPSAnQnJhY2tldHMnOwpjb25zdCBzdHJ1Y3R1cmUkeiA9IHsKICAgIGNoaWxkcmVuOiBbW11dCn07CgpmdW5jdGlvbiBwYXJzZSRBKHJlYWRTZXF1ZW5jZSwgcmVjb2duaXplcikgewogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CiAgICBsZXQgY2hpbGRyZW4gPSBudWxsOwoKICAgIHRoaXMuZWF0KExlZnRTcXVhcmVCcmFja2V0KTsKCiAgICBjaGlsZHJlbiA9IHJlYWRTZXF1ZW5jZS5jYWxsKHRoaXMsIHJlY29nbml6ZXIpOwoKICAgIGlmICghdGhpcy5lb2YpIHsKICAgICAgICB0aGlzLmVhdChSaWdodFNxdWFyZUJyYWNrZXQpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ0JyYWNrZXRzJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMudG9rZW5TdGFydCksCiAgICAgICAgY2hpbGRyZW4KICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJEEobm9kZSkgewogICAgdGhpcy50b2tlbihEZWxpbSwgJ1snKTsKICAgIHRoaXMuY2hpbGRyZW4obm9kZSk7CiAgICB0aGlzLnRva2VuKERlbGltLCAnXScpOwp9Cgpjb25zdCBCcmFja2V0cyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJEEsCiAgICBuYW1lOiBuYW1lJEEsCiAgICBwYXJzZTogcGFyc2UkQSwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJHoKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCBuYW1lJHogPSAnQ0RDJzsKY29uc3Qgc3RydWN0dXJlJHkgPSBbXTsKCmZ1bmN0aW9uIHBhcnNlJHooKSB7CiAgICBjb25zdCBzdGFydCA9IHRoaXMudG9rZW5TdGFydDsKCiAgICB0aGlzLmVhdChDREMkMSk7IC8vIC0tPgoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ0NEQycsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnRva2VuU3RhcnQpCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSR6KCkgewogICAgdGhpcy50b2tlbihDREMkMSwgJy0tPicpOwp9Cgpjb25zdCBDREMgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSR6LAogICAgbmFtZTogbmFtZSR6LAogICAgcGFyc2U6IHBhcnNlJHosCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSR5Cn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgbmFtZSR5ID0gJ0NETyc7CmNvbnN0IHN0cnVjdHVyZSR4ID0gW107CgpmdW5jdGlvbiBwYXJzZSR5KCkgewogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CgogICAgdGhpcy5lYXQoQ0RPJDEpOyAvLyA8IS0tCgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnQ0RPJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMudG9rZW5TdGFydCkKICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJHkoKSB7CiAgICB0aGlzLnRva2VuKENETyQxLCAnPCEtLScpOwp9Cgpjb25zdCBDRE8gPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSR5LAogICAgbmFtZTogbmFtZSR5LAogICAgcGFyc2U6IHBhcnNlJHksCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSR4Cn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgRlVMTFNUT1AkMiA9IDB4MDAyRTsgLy8gVSswMDJFIEZVTEwgU1RPUCAoLikKCi8vICcuJyBpZGVudApjb25zdCBuYW1lJHggPSAnQ2xhc3NTZWxlY3Rvcic7CmNvbnN0IHN0cnVjdHVyZSR3ID0gewogICAgbmFtZTogU3RyaW5nCn07CgpmdW5jdGlvbiBwYXJzZSR4KCkgewogICAgdGhpcy5lYXREZWxpbShGVUxMU1RPUCQyKTsKCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdDbGFzc1NlbGVjdG9yJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24odGhpcy50b2tlblN0YXJ0IC0gMSwgdGhpcy50b2tlbkVuZCksCiAgICAgICAgbmFtZTogdGhpcy5jb25zdW1lKElkZW50KQogICAgfTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGUkeChub2RlKSB7CiAgICB0aGlzLnRva2VuKERlbGltLCAnLicpOwogICAgdGhpcy50b2tlbihJZGVudCwgbm9kZS5uYW1lKTsKfQoKY29uc3QgQ2xhc3NTZWxlY3RvciA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJHgsCiAgICBuYW1lOiBuYW1lJHgsCiAgICBwYXJzZTogcGFyc2UkeCwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJHcKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCBQTFVTU0lHTiQ0ID0gMHgwMDJCOyAgICAgICAgLy8gVSswMDJCIFBMVVMgU0lHTiAoKykKY29uc3QgU09MSURVUyQ1ID0gMHgwMDJGOyAgICAgICAgIC8vIFUrMDAyRiBTT0xJRFVTICgvKQpjb25zdCBHUkVBVEVSVEhBTlNJR04kMSA9IDB4MDAzRTsgLy8gVSswMDNFIEdSRUFURVItVEhBTiBTSUdOICg+KQpjb25zdCBUSUxERSQxID0gMHgwMDdFOyAgICAgICAgICAgLy8gVSswMDdFIFRJTERFICh+KQoKY29uc3QgbmFtZSR3ID0gJ0NvbWJpbmF0b3InOwpjb25zdCBzdHJ1Y3R1cmUkdiA9IHsKICAgIG5hbWU6IFN0cmluZwp9OwoKLy8gKyB8ID4gfCB+IHwgL2RlZXAvCmZ1bmN0aW9uIHBhcnNlJHcoKSB7CiAgICBjb25zdCBzdGFydCA9IHRoaXMudG9rZW5TdGFydDsKICAgIGxldCBuYW1lOwoKICAgIHN3aXRjaCAodGhpcy50b2tlblR5cGUpIHsKICAgICAgICBjYXNlIFdoaXRlU3BhY2UkMToKICAgICAgICAgICAgbmFtZSA9ICcgJzsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgRGVsaW06CiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5jaGFyQ29kZUF0KHRoaXMudG9rZW5TdGFydCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgR1JFQVRFUlRIQU5TSUdOJDE6CiAgICAgICAgICAgICAgICBjYXNlIFBMVVNTSUdOJDQ6CiAgICAgICAgICAgICAgICBjYXNlIFRJTERFJDE6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgY2FzZSBTT0xJRFVTJDU6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5lYXRJZGVudCgnZGVlcCcpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZWF0RGVsaW0oU09MSURVUyQ1KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IoJ0NvbWJpbmF0b3IgaXMgZXhwZWN0ZWQnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbmFtZSA9IHRoaXMuc3Vic3RyVG9DdXJzb3Ioc3RhcnQpOwogICAgICAgICAgICBicmVhazsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdDb21iaW5hdG9yJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMudG9rZW5TdGFydCksCiAgICAgICAgbmFtZQogICAgfTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGUkdyhub2RlKSB7CiAgICB0aGlzLnRva2VuaXplKG5vZGUubmFtZSk7Cn0KCmNvbnN0IENvbWJpbmF0b3IgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSR3LAogICAgbmFtZTogbmFtZSR3LAogICAgcGFyc2U6IHBhcnNlJHcsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSR2Cn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgQVNURVJJU0skNCA9IDB4MDAyQTsgICAgICAgIC8vIFUrMDAyQSBBU1RFUklTSyAoKikKY29uc3QgU09MSURVUyQ0ID0gMHgwMDJGOyAgICAgICAgIC8vIFUrMDAyRiBTT0xJRFVTICgvKQoKCmNvbnN0IG5hbWUkdiA9ICdDb21tZW50JzsKY29uc3Qgc3RydWN0dXJlJHUgPSB7CiAgICB2YWx1ZTogU3RyaW5nCn07CgpmdW5jdGlvbiBwYXJzZSR2KCkgewogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CiAgICBsZXQgZW5kID0gdGhpcy50b2tlbkVuZDsKCiAgICB0aGlzLmVhdChDb21tZW50JDEpOwoKICAgIGlmICgoZW5kIC0gc3RhcnQgKyAyKSA+PSAyICYmCiAgICAgICAgdGhpcy5jaGFyQ29kZUF0KGVuZCAtIDIpID09PSBBU1RFUklTSyQ0ICYmCiAgICAgICAgdGhpcy5jaGFyQ29kZUF0KGVuZCAtIDEpID09PSBTT0xJRFVTJDQpIHsKICAgICAgICBlbmQgLT0gMjsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdDb21tZW50JywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMudG9rZW5TdGFydCksCiAgICAgICAgdmFsdWU6IHRoaXMuc3Vic3RyaW5nKHN0YXJ0ICsgMiwgZW5kKQogICAgfTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGUkdihub2RlKSB7CiAgICB0aGlzLnRva2VuKENvbW1lbnQkMSwgJy8qJyArIG5vZGUudmFsdWUgKyAnKi8nKTsKfQoKY29uc3QgQ29tbWVudCA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJHYsCiAgICBuYW1lOiBuYW1lJHYsCiAgICBwYXJzZTogcGFyc2UkdiwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJHUKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCBFWENMQU1BVElPTk1BUkskMSA9IDB4MDAyMTsgLy8gVSswMDIxIEVYQ0xBTUFUSU9OIE1BUksgKCEpCmNvbnN0IE5VTUJFUlNJR04kMiA9IDB4MDAyMzsgICAgICAvLyBVKzAwMjMgTlVNQkVSIFNJR04gKCMpCmNvbnN0IERPTExBUlNJR04gPSAweDAwMjQ7ICAgICAgLy8gVSswMDI0IERPTExBUiBTSUdOICgkKQpjb25zdCBBTVBFUlNBTkQkMyA9IDB4MDAyNjsgICAgICAgLy8gVSswMDI2IEFNUEVSU0FORCAoJikKY29uc3QgQVNURVJJU0skMyA9IDB4MDAyQTsgICAgICAgIC8vIFUrMDAyQSBBU1RFUklTSyAoKikKY29uc3QgUExVU1NJR04kMyA9IDB4MDAyQjsgICAgICAgIC8vIFUrMDAyQiBQTFVTIFNJR04gKCspCmNvbnN0IFNPTElEVVMkMyA9IDB4MDAyRjsgICAgICAgICAvLyBVKzAwMkYgU09MSURVUyAoLykKCmZ1bmN0aW9uIGNvbnN1bWVWYWx1ZVJhdyhzdGFydFRva2VuKSB7CiAgICByZXR1cm4gdGhpcy5SYXcoc3RhcnRUb2tlbiwgdGhpcy5jb25zdW1lVW50aWxFeGNsYW1hdGlvbk1hcmtPclNlbWljb2xvbiwgdHJ1ZSk7Cn0KCmZ1bmN0aW9uIGNvbnN1bWVDdXN0b21Qcm9wZXJ0eVJhdyhzdGFydFRva2VuKSB7CiAgICByZXR1cm4gdGhpcy5SYXcoc3RhcnRUb2tlbiwgdGhpcy5jb25zdW1lVW50aWxFeGNsYW1hdGlvbk1hcmtPclNlbWljb2xvbiwgZmFsc2UpOwp9CgpmdW5jdGlvbiBjb25zdW1lVmFsdWUoKSB7CiAgICBjb25zdCBzdGFydFZhbHVlVG9rZW4gPSB0aGlzLnRva2VuSW5kZXg7CiAgICBjb25zdCB2YWx1ZSA9IHRoaXMuVmFsdWUoKTsKCiAgICBpZiAodmFsdWUudHlwZSAhPT0gJ1JhdycgJiYKICAgICAgICB0aGlzLmVvZiA9PT0gZmFsc2UgJiYKICAgICAgICB0aGlzLnRva2VuVHlwZSAhPT0gU2VtaWNvbG9uICYmCiAgICAgICAgdGhpcy5pc0RlbGltKEVYQ0xBTUFUSU9OTUFSSyQxKSA9PT0gZmFsc2UgJiYKICAgICAgICB0aGlzLmlzQmFsYW5jZUVkZ2Uoc3RhcnRWYWx1ZVRva2VuKSA9PT0gZmFsc2UpIHsKICAgICAgICB0aGlzLmVycm9yKCk7CiAgICB9CgogICAgcmV0dXJuIHZhbHVlOwp9Cgpjb25zdCBuYW1lJHUgPSAnRGVjbGFyYXRpb24nOwpjb25zdCB3YWxrQ29udGV4dCQ2ID0gJ2RlY2xhcmF0aW9uJzsKY29uc3Qgc3RydWN0dXJlJHQgPSB7CiAgICBpbXBvcnRhbnQ6IFtCb29sZWFuLCBTdHJpbmddLAogICAgcHJvcGVydHk6IFN0cmluZywKICAgIHZhbHVlOiBbJ1ZhbHVlJywgJ1JhdyddCn07CgpmdW5jdGlvbiBwYXJzZSR1KCkgewogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CiAgICBjb25zdCBzdGFydFRva2VuID0gdGhpcy50b2tlbkluZGV4OwogICAgY29uc3QgcHJvcGVydHkgPSByZWFkUHJvcGVydHkuY2FsbCh0aGlzKTsKICAgIGNvbnN0IGN1c3RvbVByb3BlcnR5ID0gaXNDdXN0b21Qcm9wZXJ0eShwcm9wZXJ0eSk7CiAgICBjb25zdCBwYXJzZVZhbHVlID0gY3VzdG9tUHJvcGVydHkgPyB0aGlzLnBhcnNlQ3VzdG9tUHJvcGVydHkgOiB0aGlzLnBhcnNlVmFsdWU7CiAgICBjb25zdCBjb25zdW1lUmF3ID0gY3VzdG9tUHJvcGVydHkgPyBjb25zdW1lQ3VzdG9tUHJvcGVydHlSYXcgOiBjb25zdW1lVmFsdWVSYXc7CiAgICBsZXQgaW1wb3J0YW50ID0gZmFsc2U7CiAgICBsZXQgdmFsdWU7CgogICAgdGhpcy5za2lwU0MoKTsKICAgIHRoaXMuZWF0KENvbG9uKTsKCiAgICBjb25zdCB2YWx1ZVN0YXJ0ID0gdGhpcy50b2tlbkluZGV4OwoKICAgIGlmICghY3VzdG9tUHJvcGVydHkpIHsKICAgICAgICB0aGlzLnNraXBTQygpOwogICAgfQoKICAgIGlmIChwYXJzZVZhbHVlKSB7CiAgICAgICAgdmFsdWUgPSB0aGlzLnBhcnNlV2l0aEZhbGxiYWNrKGNvbnN1bWVWYWx1ZSwgY29uc3VtZVJhdyk7CiAgICB9IGVsc2UgewogICAgICAgIHZhbHVlID0gY29uc3VtZVJhdy5jYWxsKHRoaXMsIHRoaXMudG9rZW5JbmRleCk7CiAgICB9CgogICAgaWYgKGN1c3RvbVByb3BlcnR5ICYmIHZhbHVlLnR5cGUgPT09ICdWYWx1ZScgJiYgdmFsdWUuY2hpbGRyZW4uaXNFbXB0eSkgewogICAgICAgIGZvciAobGV0IG9mZnNldCA9IHZhbHVlU3RhcnQgLSB0aGlzLnRva2VuSW5kZXg7IG9mZnNldCA8PSAwOyBvZmZzZXQrKykgewogICAgICAgICAgICBpZiAodGhpcy5sb29rdXBUeXBlKG9mZnNldCkgPT09IFdoaXRlU3BhY2UkMSkgewogICAgICAgICAgICAgICAgdmFsdWUuY2hpbGRyZW4uYXBwZW5kRGF0YSh7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1doaXRlU3BhY2UnLAogICAgICAgICAgICAgICAgICAgIGxvYzogbnVsbCwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJyAnCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGlmICh0aGlzLmlzRGVsaW0oRVhDTEFNQVRJT05NQVJLJDEpKSB7CiAgICAgICAgaW1wb3J0YW50ID0gZ2V0SW1wb3J0YW50LmNhbGwodGhpcyk7CiAgICAgICAgdGhpcy5za2lwU0MoKTsKICAgIH0KCiAgICAvLyBEbyBub3QgaW5jbHVkZSBzZW1pY29sb24gdG8gcmFuZ2UgcGVyIHNwZWMKICAgIC8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3Mtc3ludGF4LyNkZWNsYXJhdGlvbi1kaWFncmFtCgogICAgaWYgKHRoaXMuZW9mID09PSBmYWxzZSAmJgogICAgICAgIHRoaXMudG9rZW5UeXBlICE9PSBTZW1pY29sb24gJiYKICAgICAgICB0aGlzLmlzQmFsYW5jZUVkZ2Uoc3RhcnRUb2tlbikgPT09IGZhbHNlKSB7CiAgICAgICAgdGhpcy5lcnJvcigpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ0RlY2xhcmF0aW9uJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMudG9rZW5TdGFydCksCiAgICAgICAgaW1wb3J0YW50LAogICAgICAgIHByb3BlcnR5LAogICAgICAgIHZhbHVlCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSR1KG5vZGUpIHsKICAgIHRoaXMudG9rZW4oSWRlbnQsIG5vZGUucHJvcGVydHkpOwogICAgdGhpcy50b2tlbihDb2xvbiwgJzonKTsKICAgIHRoaXMubm9kZShub2RlLnZhbHVlKTsKCiAgICBpZiAobm9kZS5pbXBvcnRhbnQpIHsKICAgICAgICB0aGlzLnRva2VuKERlbGltLCAnIScpOwogICAgICAgIHRoaXMudG9rZW4oSWRlbnQsIG5vZGUuaW1wb3J0YW50ID09PSB0cnVlID8gJ2ltcG9ydGFudCcgOiBub2RlLmltcG9ydGFudCk7CiAgICB9Cn0KCmZ1bmN0aW9uIHJlYWRQcm9wZXJ0eSgpIHsKICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwoKICAgIC8vIGhhY2tzCiAgICBpZiAodGhpcy50b2tlblR5cGUgPT09IERlbGltKSB7CiAgICAgICAgc3dpdGNoICh0aGlzLmNoYXJDb2RlQXQodGhpcy50b2tlblN0YXJ0KSkgewogICAgICAgICAgICBjYXNlIEFTVEVSSVNLJDM6CiAgICAgICAgICAgIGNhc2UgRE9MTEFSU0lHTjoKICAgICAgICAgICAgY2FzZSBQTFVTU0lHTiQzOgogICAgICAgICAgICBjYXNlIE5VTUJFUlNJR04kMjoKICAgICAgICAgICAgY2FzZSBBTVBFUlNBTkQkMzoKICAgICAgICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBUT0RPOiBub3Qgc3VyZSB3ZSBzaG91bGQgc3VwcG9ydCB0aGlzIGhhY2sKICAgICAgICAgICAgY2FzZSBTT0xJRFVTJDM6CiAgICAgICAgICAgICAgICB0aGlzLm5leHQoKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzRGVsaW0oU09MSURVUyQzKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAgIGlmICh0aGlzLnRva2VuVHlwZSA9PT0gSGFzaCQxKSB7CiAgICAgICAgdGhpcy5lYXQoSGFzaCQxKTsKICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5lYXQoSWRlbnQpOwogICAgfQoKICAgIHJldHVybiB0aGlzLnN1YnN0clRvQ3Vyc29yKHN0YXJ0KTsKfQoKLy8gISB3cyogaW1wb3J0YW50CmZ1bmN0aW9uIGdldEltcG9ydGFudCgpIHsKICAgIHRoaXMuZWF0KERlbGltKTsKICAgIHRoaXMuc2tpcFNDKCk7CgogICAgY29uc3QgaW1wb3J0YW50ID0gdGhpcy5jb25zdW1lKElkZW50KTsKCiAgICAvLyBzdG9yZSBvcmlnaW5hbCB2YWx1ZSBpbiBjYXNlIGl0IGRpZmZlciBmcm9tIGBpbXBvcnRhbnRgCiAgICAvLyBmb3IgYmV0dGVyIG9yaWdpbmFsIHNvdXJjZSByZXN0b3JpbmcgYW5kIGhhY2tzIGxpa2UgYCFpZWAgc3VwcG9ydAogICAgcmV0dXJuIGltcG9ydGFudCA9PT0gJ2ltcG9ydGFudCcgPyB0cnVlIDogaW1wb3J0YW50Owp9Cgpjb25zdCBEZWNsYXJhdGlvbiA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJHUsCiAgICBuYW1lOiBuYW1lJHUsCiAgICBwYXJzZTogcGFyc2UkdSwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJHQsCiAgICB3YWxrQ29udGV4dDogd2Fsa0NvbnRleHQkNgp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmNvbnN0IEFNUEVSU0FORCQyID0gMHgwMDI2OyAgICAgICAvLyBVKzAwMjYgQU1QRVJTQU5EICgmKQoKZnVuY3Rpb24gY29uc3VtZVJhdyQzKHN0YXJ0VG9rZW4pIHsKICAgIHJldHVybiB0aGlzLlJhdyhzdGFydFRva2VuLCB0aGlzLmNvbnN1bWVVbnRpbFNlbWljb2xvbkluY2x1ZGVkLCB0cnVlKTsKfQoKY29uc3QgbmFtZSR0ID0gJ0RlY2xhcmF0aW9uTGlzdCc7CmNvbnN0IHN0cnVjdHVyZSRzID0gewogICAgY2hpbGRyZW46IFtbCiAgICAgICAgJ0RlY2xhcmF0aW9uJywKICAgICAgICAnQXRydWxlJywKICAgICAgICAnUnVsZScKICAgIF1dCn07CgpmdW5jdGlvbiBwYXJzZSR0KCkgewogICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNyZWF0ZUxpc3QoKTsKCiAgICB3aGlsZSAoIXRoaXMuZW9mKSB7CiAgICAgICAgc3dpdGNoICh0aGlzLnRva2VuVHlwZSkgewogICAgICAgICAgICBjYXNlIFdoaXRlU3BhY2UkMToKICAgICAgICAgICAgY2FzZSBDb21tZW50JDE6CiAgICAgICAgICAgIGNhc2UgU2VtaWNvbG9uOgogICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgQXRLZXl3b3JkOgogICAgICAgICAgICAgICAgY2hpbGRyZW4ucHVzaCh0aGlzLnBhcnNlV2l0aEZhbGxiYWNrKHRoaXMuQXRydWxlLmJpbmQodGhpcywgdHJ1ZSksIGNvbnN1bWVSYXckMykpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNEZWxpbShBTVBFUlNBTkQkMikpICB7CiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW4ucHVzaCh0aGlzLnBhcnNlV2l0aEZhbGxiYWNrKHRoaXMuUnVsZSwgY29uc3VtZVJhdyQzKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuLnB1c2godGhpcy5wYXJzZVdpdGhGYWxsYmFjayh0aGlzLkRlY2xhcmF0aW9uLCBjb25zdW1lUmF3JDMpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnRGVjbGFyYXRpb25MaXN0JywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb25Gcm9tTGlzdChjaGlsZHJlbiksCiAgICAgICAgY2hpbGRyZW4KICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJHQobm9kZSkgewogICAgdGhpcy5jaGlsZHJlbihub2RlLCBwcmV2ID0+IHsKICAgICAgICBpZiAocHJldi50eXBlID09PSAnRGVjbGFyYXRpb24nKSB7CiAgICAgICAgICAgIHRoaXMudG9rZW4oU2VtaWNvbG9uLCAnOycpOwogICAgICAgIH0KICAgIH0pOwp9Cgpjb25zdCBEZWNsYXJhdGlvbkxpc3QgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSR0LAogICAgbmFtZTogbmFtZSR0LAogICAgcGFyc2U6IHBhcnNlJHQsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSRzCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgbmFtZSRzID0gJ0RpbWVuc2lvbic7CmNvbnN0IHN0cnVjdHVyZSRyID0gewogICAgdmFsdWU6IFN0cmluZywKICAgIHVuaXQ6IFN0cmluZwp9OwoKZnVuY3Rpb24gcGFyc2UkcygpIHsKICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwogICAgY29uc3QgdmFsdWUgPSB0aGlzLmNvbnN1bWVOdW1iZXIoRGltZW5zaW9uJDEpOwoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ0RpbWVuc2lvbicsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnRva2VuU3RhcnQpLAogICAgICAgIHZhbHVlLAogICAgICAgIHVuaXQ6IHRoaXMuc3Vic3RyaW5nKHN0YXJ0ICsgdmFsdWUubGVuZ3RoLCB0aGlzLnRva2VuU3RhcnQpCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSRzKG5vZGUpIHsKICAgIHRoaXMudG9rZW4oRGltZW5zaW9uJDEsIG5vZGUudmFsdWUgKyBub2RlLnVuaXQpOwp9Cgpjb25zdCBEaW1lbnNpb24gPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSRzLAogICAgbmFtZTogbmFtZSRzLAogICAgcGFyc2U6IHBhcnNlJHMsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSRyCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgbmFtZSRyID0gJ0Z1bmN0aW9uJzsKY29uc3Qgd2Fsa0NvbnRleHQkNSA9ICdmdW5jdGlvbic7CmNvbnN0IHN0cnVjdHVyZSRxID0gewogICAgbmFtZTogU3RyaW5nLAogICAgY2hpbGRyZW46IFtbXV0KfTsKCi8vIDxmdW5jdGlvbi10b2tlbj4gPHNlcXVlbmNlPiApCmZ1bmN0aW9uIHBhcnNlJHIocmVhZFNlcXVlbmNlLCByZWNvZ25pemVyKSB7CiAgICBjb25zdCBzdGFydCA9IHRoaXMudG9rZW5TdGFydDsKICAgIGNvbnN0IG5hbWUgPSB0aGlzLmNvbnN1bWVGdW5jdGlvbk5hbWUoKTsKICAgIGNvbnN0IG5hbWVMb3dlckNhc2UgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CiAgICBsZXQgY2hpbGRyZW47CgogICAgY2hpbGRyZW4gPSByZWNvZ25pemVyLmhhc093blByb3BlcnR5KG5hbWVMb3dlckNhc2UpCiAgICAgICAgPyByZWNvZ25pemVyW25hbWVMb3dlckNhc2VdLmNhbGwodGhpcywgcmVjb2duaXplcikKICAgICAgICA6IHJlYWRTZXF1ZW5jZS5jYWxsKHRoaXMsIHJlY29nbml6ZXIpOwoKICAgIGlmICghdGhpcy5lb2YpIHsKICAgICAgICB0aGlzLmVhdChSaWdodFBhcmVudGhlc2lzKTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdGdW5jdGlvbicsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnRva2VuU3RhcnQpLAogICAgICAgIG5hbWUsCiAgICAgICAgY2hpbGRyZW4KICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJHIobm9kZSkgewogICAgdGhpcy50b2tlbihGdW5jdGlvbiQyLCBub2RlLm5hbWUgKyAnKCcpOwogICAgdGhpcy5jaGlsZHJlbihub2RlKTsKICAgIHRoaXMudG9rZW4oUmlnaHRQYXJlbnRoZXNpcywgJyknKTsKfQoKY29uc3QgRnVuY3Rpb24kMSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJHIsCiAgICBuYW1lOiBuYW1lJHIsCiAgICBwYXJzZTogcGFyc2UkciwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJHEsCiAgICB3YWxrQ29udGV4dDogd2Fsa0NvbnRleHQkNQp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCi8vICcjJyBpZGVudApjb25zdCB4eHggPSAnWFhYJzsKY29uc3QgbmFtZSRxID0gJ0hhc2gnOwpjb25zdCBzdHJ1Y3R1cmUkcCA9IHsKICAgIHZhbHVlOiBTdHJpbmcKfTsKZnVuY3Rpb24gcGFyc2UkcSgpIHsKICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwoKICAgIHRoaXMuZWF0KEhhc2gkMSk7CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnSGFzaCcsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnRva2VuU3RhcnQpLAogICAgICAgIHZhbHVlOiB0aGlzLnN1YnN0clRvQ3Vyc29yKHN0YXJ0ICsgMSkKICAgIH07Cn0KZnVuY3Rpb24gZ2VuZXJhdGUkcShub2RlKSB7CiAgICB0aGlzLnRva2VuKEhhc2gkMSwgJyMnICsgbm9kZS52YWx1ZSk7Cn0KCmNvbnN0IEhhc2ggPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSRxLAogICAgbmFtZTogbmFtZSRxLAogICAgcGFyc2U6IHBhcnNlJHEsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSRwLAogICAgeHh4Cn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgbmFtZSRwID0gJ0lkZW50aWZpZXInOwpjb25zdCBzdHJ1Y3R1cmUkbyA9IHsKICAgIG5hbWU6IFN0cmluZwp9OwoKZnVuY3Rpb24gcGFyc2UkcCgpIHsKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ0lkZW50aWZpZXInLAogICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbih0aGlzLnRva2VuU3RhcnQsIHRoaXMudG9rZW5FbmQpLAogICAgICAgIG5hbWU6IHRoaXMuY29uc3VtZShJZGVudCkKICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJHAobm9kZSkgewogICAgdGhpcy50b2tlbihJZGVudCwgbm9kZS5uYW1lKTsKfQoKY29uc3QgSWRlbnRpZmllciA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJHAsCiAgICBuYW1lOiBuYW1lJHAsCiAgICBwYXJzZTogcGFyc2UkcCwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJG8KfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCBuYW1lJG8gPSAnSWRTZWxlY3Rvcic7CmNvbnN0IHN0cnVjdHVyZSRuID0gewogICAgbmFtZTogU3RyaW5nCn07CgpmdW5jdGlvbiBwYXJzZSRvKCkgewogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CgogICAgLy8gVE9ETzogY2hlY2sgdmFsdWUgaXMgYW4gaWRlbnQKICAgIHRoaXMuZWF0KEhhc2gkMSk7CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnSWRTZWxlY3RvcicsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnRva2VuU3RhcnQpLAogICAgICAgIG5hbWU6IHRoaXMuc3Vic3RyVG9DdXJzb3Ioc3RhcnQgKyAxKQogICAgfTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGUkbyhub2RlKSB7CiAgICAvLyBVc2luZyBEZWxpbSBpbnN0ZWFkIG9mIEhhc2ggaXMgYSBoYWNrIHRvIGF2b2lkIGZvciBhIHdoaXRlc3BhY2UgYmV0d2VlbiBpZGVudCBhbmQgaWQtc2VsZWN0b3IKICAgIC8vIGluIHNhZmUgbW9kZSAoZS5nLiAiYSNpZCIpLCBiZWNhdXNlIElFMTEgZG9lc24ndCBhbGxvdyBhIHNlcXVlbmNlIDxpZGVudC10b2tlbj4gPGhhc2gtdG9rZW4+CiAgICAvLyB3aXRob3V0IGEgd2hpdGVzcGFjZSBpbiB2YWx1ZXMgKGUuZy4gIjFweCBzb2xpZCMwMDAiKQogICAgdGhpcy50b2tlbihEZWxpbSwgJyMnICsgbm9kZS5uYW1lKTsKfQoKY29uc3QgSWRTZWxlY3RvciA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJG8sCiAgICBuYW1lOiBuYW1lJG8sCiAgICBwYXJzZTogcGFyc2UkbywKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJG4KfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCBuYW1lJG4gPSAnTWVkaWFGZWF0dXJlJzsKY29uc3Qgc3RydWN0dXJlJG0gPSB7CiAgICBuYW1lOiBTdHJpbmcsCiAgICB2YWx1ZTogWydJZGVudGlmaWVyJywgJ051bWJlcicsICdEaW1lbnNpb24nLCAnUmF0aW8nLCBudWxsXQp9OwoKZnVuY3Rpb24gcGFyc2UkbigpIHsKICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwogICAgbGV0IG5hbWU7CiAgICBsZXQgdmFsdWUgPSBudWxsOwoKICAgIHRoaXMuZWF0KExlZnRQYXJlbnRoZXNpcyk7CiAgICB0aGlzLnNraXBTQygpOwoKICAgIG5hbWUgPSB0aGlzLmNvbnN1bWUoSWRlbnQpOwogICAgdGhpcy5za2lwU0MoKTsKCiAgICBpZiAodGhpcy50b2tlblR5cGUgIT09IFJpZ2h0UGFyZW50aGVzaXMpIHsKICAgICAgICB0aGlzLmVhdChDb2xvbik7CiAgICAgICAgdGhpcy5za2lwU0MoKTsKCiAgICAgICAgc3dpdGNoICh0aGlzLnRva2VuVHlwZSkgewogICAgICAgICAgICBjYXNlIE51bWJlciQyOgogICAgICAgICAgICAgICAgaWYgKHRoaXMubG9va3VwTm9uV1NUeXBlKDEpID09PSBEZWxpbSkgewogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdGhpcy5SYXRpbygpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHRoaXMuTnVtYmVyKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIERpbWVuc2lvbiQxOgogICAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLkRpbWVuc2lvbigpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIElkZW50OgogICAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLklkZW50aWZpZXIoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IoJ051bWJlciwgZGltZW5zaW9uLCByYXRpbyBvciBpZGVudGlmaWVyIGlzIGV4cGVjdGVkJyk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnNraXBTQygpOwogICAgfQoKICAgIHRoaXMuZWF0KFJpZ2h0UGFyZW50aGVzaXMpOwoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ01lZGlhRmVhdHVyZScsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnRva2VuU3RhcnQpLAogICAgICAgIG5hbWUsCiAgICAgICAgdmFsdWUKICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJG4obm9kZSkgewogICAgdGhpcy50b2tlbihMZWZ0UGFyZW50aGVzaXMsICcoJyk7CiAgICB0aGlzLnRva2VuKElkZW50LCBub2RlLm5hbWUpOwoKICAgIGlmIChub2RlLnZhbHVlICE9PSBudWxsKSB7CiAgICAgICAgdGhpcy50b2tlbihDb2xvbiwgJzonKTsKICAgICAgICB0aGlzLm5vZGUobm9kZS52YWx1ZSk7CiAgICB9CgogICAgdGhpcy50b2tlbihSaWdodFBhcmVudGhlc2lzLCAnKScpOwp9Cgpjb25zdCBNZWRpYUZlYXR1cmUgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSRuLAogICAgbmFtZTogbmFtZSRuLAogICAgcGFyc2U6IHBhcnNlJG4sCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSRtCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgbmFtZSRtID0gJ01lZGlhUXVlcnknOwpjb25zdCBzdHJ1Y3R1cmUkbCA9IHsKICAgIGNoaWxkcmVuOiBbWwogICAgICAgICdJZGVudGlmaWVyJywKICAgICAgICAnTWVkaWFGZWF0dXJlJywKICAgICAgICAnV2hpdGVTcGFjZScKICAgIF1dCn07CgpmdW5jdGlvbiBwYXJzZSRtKCkgewogICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNyZWF0ZUxpc3QoKTsKICAgIGxldCBjaGlsZCA9IG51bGw7CgogICAgdGhpcy5za2lwU0MoKTsKCiAgICBzY2FuOgogICAgd2hpbGUgKCF0aGlzLmVvZikgewogICAgICAgIHN3aXRjaCAodGhpcy50b2tlblR5cGUpIHsKICAgICAgICAgICAgY2FzZSBDb21tZW50JDE6CiAgICAgICAgICAgIGNhc2UgV2hpdGVTcGFjZSQxOgogICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGNhc2UgSWRlbnQ6CiAgICAgICAgICAgICAgICBjaGlsZCA9IHRoaXMuSWRlbnRpZmllcigpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIExlZnRQYXJlbnRoZXNpczoKICAgICAgICAgICAgICAgIGNoaWxkID0gdGhpcy5NZWRpYUZlYXR1cmUoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGJyZWFrIHNjYW47CiAgICAgICAgfQoKICAgICAgICBjaGlsZHJlbi5wdXNoKGNoaWxkKTsKICAgIH0KCiAgICBpZiAoY2hpbGQgPT09IG51bGwpIHsKICAgICAgICB0aGlzLmVycm9yKCdJZGVudGlmaWVyIG9yIHBhcmVudGhlc2lzIGlzIGV4cGVjdGVkJyk7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnTWVkaWFRdWVyeScsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uRnJvbUxpc3QoY2hpbGRyZW4pLAogICAgICAgIGNoaWxkcmVuCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSRtKG5vZGUpIHsKICAgIHRoaXMuY2hpbGRyZW4obm9kZSk7Cn0KCmNvbnN0IE1lZGlhUXVlcnkgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSRtLAogICAgbmFtZTogbmFtZSRtLAogICAgcGFyc2U6IHBhcnNlJG0sCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSRsCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgbmFtZSRsID0gJ01lZGlhUXVlcnlMaXN0JzsKY29uc3Qgc3RydWN0dXJlJGsgPSB7CiAgICBjaGlsZHJlbjogW1sKICAgICAgICAnTWVkaWFRdWVyeScKICAgIF1dCn07CgpmdW5jdGlvbiBwYXJzZSRsKCkgewogICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNyZWF0ZUxpc3QoKTsKCiAgICB0aGlzLnNraXBTQygpOwoKICAgIHdoaWxlICghdGhpcy5lb2YpIHsKICAgICAgICBjaGlsZHJlbi5wdXNoKHRoaXMuTWVkaWFRdWVyeSgpKTsKCiAgICAgICAgaWYgKHRoaXMudG9rZW5UeXBlICE9PSBDb21tYSkgewogICAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIHRoaXMubmV4dCgpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ01lZGlhUXVlcnlMaXN0JywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb25Gcm9tTGlzdChjaGlsZHJlbiksCiAgICAgICAgY2hpbGRyZW4KICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJGwobm9kZSkgewogICAgdGhpcy5jaGlsZHJlbihub2RlLCAoKSA9PiB0aGlzLnRva2VuKENvbW1hLCAnLCcpKTsKfQoKY29uc3QgTWVkaWFRdWVyeUxpc3QgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSRsLAogICAgbmFtZTogbmFtZSRsLAogICAgcGFyc2U6IHBhcnNlJGwsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSRrCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgQU1QRVJTQU5EJDEgPSAweDAwMjY7ICAgICAgIC8vIFUrMDAyNiBBTVBFUlNBTkQgKCYpCgpjb25zdCBuYW1lJGsgPSAnTmVzdGluZ1NlbGVjdG9yJzsKY29uc3Qgc3RydWN0dXJlJGogPSB7Cn07CgpmdW5jdGlvbiBwYXJzZSRrKCkgewogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CgogICAgdGhpcy5lYXREZWxpbShBTVBFUlNBTkQkMSk7CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnTmVzdGluZ1NlbGVjdG9yJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMudG9rZW5TdGFydCkKICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJGsoKSB7CiAgICB0aGlzLnRva2VuKERlbGltLCAnJicpOwp9Cgpjb25zdCBOZXN0aW5nU2VsZWN0b3IgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSRrLAogICAgbmFtZTogbmFtZSRrLAogICAgcGFyc2U6IHBhcnNlJGssCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSRqCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgbmFtZSRqID0gJ050aCc7CmNvbnN0IHN0cnVjdHVyZSRpID0gewogICAgbnRoOiBbJ0FuUGx1c0InLCAnSWRlbnRpZmllciddLAogICAgc2VsZWN0b3I6IFsnU2VsZWN0b3JMaXN0JywgbnVsbF0KfTsKCmZ1bmN0aW9uIHBhcnNlJGooKSB7CiAgICB0aGlzLnNraXBTQygpOwoKICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwogICAgbGV0IGVuZCA9IHN0YXJ0OwogICAgbGV0IHNlbGVjdG9yID0gbnVsbDsKICAgIGxldCBudGg7CgogICAgaWYgKHRoaXMubG9va3VwVmFsdWUoMCwgJ29kZCcpIHx8IHRoaXMubG9va3VwVmFsdWUoMCwgJ2V2ZW4nKSkgewogICAgICAgIG50aCA9IHRoaXMuSWRlbnRpZmllcigpOwogICAgfSBlbHNlIHsKICAgICAgICBudGggPSB0aGlzLkFuUGx1c0IoKTsKICAgIH0KCiAgICBlbmQgPSB0aGlzLnRva2VuU3RhcnQ7CiAgICB0aGlzLnNraXBTQygpOwoKICAgIGlmICh0aGlzLmxvb2t1cFZhbHVlKDAsICdvZicpKSB7CiAgICAgICAgdGhpcy5uZXh0KCk7CgogICAgICAgIHNlbGVjdG9yID0gdGhpcy5TZWxlY3Rvckxpc3QoKTsKICAgICAgICBlbmQgPSB0aGlzLnRva2VuU3RhcnQ7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnTnRoJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIGVuZCksCiAgICAgICAgbnRoLAogICAgICAgIHNlbGVjdG9yCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSRqKG5vZGUpIHsKICAgIHRoaXMubm9kZShub2RlLm50aCk7CiAgICBpZiAobm9kZS5zZWxlY3RvciAhPT0gbnVsbCkgewogICAgICAgIHRoaXMudG9rZW4oSWRlbnQsICdvZicpOwogICAgICAgIHRoaXMubm9kZShub2RlLnNlbGVjdG9yKTsKICAgIH0KfQoKY29uc3QgTnRoID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoLyojX19QVVJFX18qL09iamVjdC5kZWZpbmVQcm9wZXJ0eSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBnZW5lcmF0ZTogZ2VuZXJhdGUkaiwKICAgIG5hbWU6IG5hbWUkaiwKICAgIHBhcnNlOiBwYXJzZSRqLAogICAgc3RydWN0dXJlOiBzdHJ1Y3R1cmUkaQp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmNvbnN0IG5hbWUkaSA9ICdOdW1iZXInOwpjb25zdCBzdHJ1Y3R1cmUkaCA9IHsKICAgIHZhbHVlOiBTdHJpbmcKfTsKCmZ1bmN0aW9uIHBhcnNlJGkoKSB7CiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdOdW1iZXInLAogICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbih0aGlzLnRva2VuU3RhcnQsIHRoaXMudG9rZW5FbmQpLAogICAgICAgIHZhbHVlOiB0aGlzLmNvbnN1bWUoTnVtYmVyJDIpCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSRpKG5vZGUpIHsKICAgIHRoaXMudG9rZW4oTnVtYmVyJDIsIG5vZGUudmFsdWUpOwp9Cgpjb25zdCBOdW1iZXIkMSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJGksCiAgICBuYW1lOiBuYW1lJGksCiAgICBwYXJzZTogcGFyc2UkaSwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJGgKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7CgovLyAnLycgfCAnKicgfCAnLCcgfCAnOicgfCAnKycgfCAnLScKY29uc3QgbmFtZSRoID0gJ09wZXJhdG9yJzsKY29uc3Qgc3RydWN0dXJlJGcgPSB7CiAgICB2YWx1ZTogU3RyaW5nCn07CgpmdW5jdGlvbiBwYXJzZSRoKCkgewogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CgogICAgdGhpcy5uZXh0KCk7CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnT3BlcmF0b3InLAogICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydCwgdGhpcy50b2tlblN0YXJ0KSwKICAgICAgICB2YWx1ZTogdGhpcy5zdWJzdHJUb0N1cnNvcihzdGFydCkKICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJGgobm9kZSkgewogICAgdGhpcy50b2tlbml6ZShub2RlLnZhbHVlKTsKfQoKY29uc3QgT3BlcmF0b3IgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSRoLAogICAgbmFtZTogbmFtZSRoLAogICAgcGFyc2U6IHBhcnNlJGgsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSRnCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgbmFtZSRnID0gJ1BhcmVudGhlc2VzJzsKY29uc3Qgc3RydWN0dXJlJGYgPSB7CiAgICBjaGlsZHJlbjogW1tdXQp9OwoKZnVuY3Rpb24gcGFyc2UkZyhyZWFkU2VxdWVuY2UsIHJlY29nbml6ZXIpIHsKICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwogICAgbGV0IGNoaWxkcmVuID0gbnVsbDsKCiAgICB0aGlzLmVhdChMZWZ0UGFyZW50aGVzaXMpOwoKICAgIGNoaWxkcmVuID0gcmVhZFNlcXVlbmNlLmNhbGwodGhpcywgcmVjb2duaXplcik7CgogICAgaWYgKCF0aGlzLmVvZikgewogICAgICAgIHRoaXMuZWF0KFJpZ2h0UGFyZW50aGVzaXMpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ1BhcmVudGhlc2VzJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24oc3RhcnQsIHRoaXMudG9rZW5TdGFydCksCiAgICAgICAgY2hpbGRyZW4KICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJGcobm9kZSkgewogICAgdGhpcy50b2tlbihMZWZ0UGFyZW50aGVzaXMsICcoJyk7CiAgICB0aGlzLmNoaWxkcmVuKG5vZGUpOwogICAgdGhpcy50b2tlbihSaWdodFBhcmVudGhlc2lzLCAnKScpOwp9Cgpjb25zdCBQYXJlbnRoZXNlcyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJGcsCiAgICBuYW1lOiBuYW1lJGcsCiAgICBwYXJzZTogcGFyc2UkZywKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJGYKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCBuYW1lJGYgPSAnUGVyY2VudGFnZSc7CmNvbnN0IHN0cnVjdHVyZSRlID0gewogICAgdmFsdWU6IFN0cmluZwp9OwoKZnVuY3Rpb24gcGFyc2UkZigpIHsKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ1BlcmNlbnRhZ2UnLAogICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbih0aGlzLnRva2VuU3RhcnQsIHRoaXMudG9rZW5FbmQpLAogICAgICAgIHZhbHVlOiB0aGlzLmNvbnN1bWVOdW1iZXIoUGVyY2VudGFnZSQxKQogICAgfTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGUkZihub2RlKSB7CiAgICB0aGlzLnRva2VuKFBlcmNlbnRhZ2UkMSwgbm9kZS52YWx1ZSArICclJyk7Cn0KCmNvbnN0IFBlcmNlbnRhZ2UgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSRmLAogICAgbmFtZTogbmFtZSRmLAogICAgcGFyc2U6IHBhcnNlJGYsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSRlCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgbmFtZSRlID0gJ1BzZXVkb0NsYXNzU2VsZWN0b3InOwpjb25zdCB3YWxrQ29udGV4dCQ0ID0gJ2Z1bmN0aW9uJzsKY29uc3Qgc3RydWN0dXJlJGQgPSB7CiAgICBuYW1lOiBTdHJpbmcsCiAgICBjaGlsZHJlbjogW1snUmF3J10sIG51bGxdCn07CgovLyA6IFsgPGlkZW50PiB8IDxmdW5jdGlvbi10b2tlbj4gPGFueS12YWx1ZT4/ICkgXQpmdW5jdGlvbiBwYXJzZSRlKCkgewogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CiAgICBsZXQgY2hpbGRyZW4gPSBudWxsOwogICAgbGV0IG5hbWU7CiAgICBsZXQgbmFtZUxvd2VyQ2FzZTsKCiAgICB0aGlzLmVhdChDb2xvbik7CgogICAgaWYgKHRoaXMudG9rZW5UeXBlID09PSBGdW5jdGlvbiQyKSB7CiAgICAgICAgbmFtZSA9IHRoaXMuY29uc3VtZUZ1bmN0aW9uTmFtZSgpOwogICAgICAgIG5hbWVMb3dlckNhc2UgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CgogICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaXMucHNldWRvLCBuYW1lTG93ZXJDYXNlKSkgewogICAgICAgICAgICB0aGlzLnNraXBTQygpOwogICAgICAgICAgICBjaGlsZHJlbiA9IHRoaXMucHNldWRvW25hbWVMb3dlckNhc2VdLmNhbGwodGhpcyk7CiAgICAgICAgICAgIHRoaXMuc2tpcFNDKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2hpbGRyZW4gPSB0aGlzLmNyZWF0ZUxpc3QoKTsKICAgICAgICAgICAgY2hpbGRyZW4ucHVzaCgKICAgICAgICAgICAgICAgIHRoaXMuUmF3KHRoaXMudG9rZW5JbmRleCwgbnVsbCwgZmFsc2UpCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmVhdChSaWdodFBhcmVudGhlc2lzKTsKICAgIH0gZWxzZSB7CiAgICAgICAgbmFtZSA9IHRoaXMuY29uc3VtZShJZGVudCk7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnUHNldWRvQ2xhc3NTZWxlY3RvcicsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnRva2VuU3RhcnQpLAogICAgICAgIG5hbWUsCiAgICAgICAgY2hpbGRyZW4KICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJGUobm9kZSkgewogICAgdGhpcy50b2tlbihDb2xvbiwgJzonKTsKCiAgICBpZiAobm9kZS5jaGlsZHJlbiA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudG9rZW4oSWRlbnQsIG5vZGUubmFtZSk7CiAgICB9IGVsc2UgewogICAgICAgIHRoaXMudG9rZW4oRnVuY3Rpb24kMiwgbm9kZS5uYW1lICsgJygnKTsKICAgICAgICB0aGlzLmNoaWxkcmVuKG5vZGUpOwogICAgICAgIHRoaXMudG9rZW4oUmlnaHRQYXJlbnRoZXNpcywgJyknKTsKICAgIH0KfQoKY29uc3QgUHNldWRvQ2xhc3NTZWxlY3RvciA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJGUsCiAgICBuYW1lOiBuYW1lJGUsCiAgICBwYXJzZTogcGFyc2UkZSwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJGQsCiAgICB3YWxrQ29udGV4dDogd2Fsa0NvbnRleHQkNAp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmNvbnN0IG5hbWUkZCA9ICdQc2V1ZG9FbGVtZW50U2VsZWN0b3InOwpjb25zdCB3YWxrQ29udGV4dCQzID0gJ2Z1bmN0aW9uJzsKY29uc3Qgc3RydWN0dXJlJGMgPSB7CiAgICBuYW1lOiBTdHJpbmcsCiAgICBjaGlsZHJlbjogW1snUmF3J10sIG51bGxdCn07CgovLyA6OiBbIDxpZGVudD4gfCA8ZnVuY3Rpb24tdG9rZW4+IDxhbnktdmFsdWU+PyApIF0KZnVuY3Rpb24gcGFyc2UkZCgpIHsKICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwogICAgbGV0IGNoaWxkcmVuID0gbnVsbDsKICAgIGxldCBuYW1lOwogICAgbGV0IG5hbWVMb3dlckNhc2U7CgogICAgdGhpcy5lYXQoQ29sb24pOwogICAgdGhpcy5lYXQoQ29sb24pOwoKICAgIGlmICh0aGlzLnRva2VuVHlwZSA9PT0gRnVuY3Rpb24kMikgewogICAgICAgIG5hbWUgPSB0aGlzLmNvbnN1bWVGdW5jdGlvbk5hbWUoKTsKICAgICAgICBuYW1lTG93ZXJDYXNlID0gbmFtZS50b0xvd2VyQ2FzZSgpOwoKICAgICAgICBpZiAoaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLnBzZXVkbywgbmFtZUxvd2VyQ2FzZSkpIHsKICAgICAgICAgICAgdGhpcy5za2lwU0MoKTsKICAgICAgICAgICAgY2hpbGRyZW4gPSB0aGlzLnBzZXVkb1tuYW1lTG93ZXJDYXNlXS5jYWxsKHRoaXMpOwogICAgICAgICAgICB0aGlzLnNraXBTQygpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNoaWxkcmVuID0gdGhpcy5jcmVhdGVMaXN0KCk7CiAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goCiAgICAgICAgICAgICAgICB0aGlzLlJhdyh0aGlzLnRva2VuSW5kZXgsIG51bGwsIGZhbHNlKQogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5lYXQoUmlnaHRQYXJlbnRoZXNpcyk7CiAgICB9IGVsc2UgewogICAgICAgIG5hbWUgPSB0aGlzLmNvbnN1bWUoSWRlbnQpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ1BzZXVkb0VsZW1lbnRTZWxlY3RvcicsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnRva2VuU3RhcnQpLAogICAgICAgIG5hbWUsCiAgICAgICAgY2hpbGRyZW4KICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJGQobm9kZSkgewogICAgdGhpcy50b2tlbihDb2xvbiwgJzonKTsKICAgIHRoaXMudG9rZW4oQ29sb24sICc6Jyk7CgogICAgaWYgKG5vZGUuY2hpbGRyZW4gPT09IG51bGwpIHsKICAgICAgICB0aGlzLnRva2VuKElkZW50LCBub2RlLm5hbWUpOwogICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnRva2VuKEZ1bmN0aW9uJDIsIG5vZGUubmFtZSArICcoJyk7CiAgICAgICAgdGhpcy5jaGlsZHJlbihub2RlKTsKICAgICAgICB0aGlzLnRva2VuKFJpZ2h0UGFyZW50aGVzaXMsICcpJyk7CiAgICB9Cn0KCmNvbnN0IFBzZXVkb0VsZW1lbnRTZWxlY3RvciA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJGQsCiAgICBuYW1lOiBuYW1lJGQsCiAgICBwYXJzZTogcGFyc2UkZCwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJGMsCiAgICB3YWxrQ29udGV4dDogd2Fsa0NvbnRleHQkMwp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmNvbnN0IFNPTElEVVMkMiA9IDB4MDAyRjsgIC8vIFUrMDAyRiBTT0xJRFVTICgvKQpjb25zdCBGVUxMU1RPUCQxID0gMHgwMDJFOyAvLyBVKzAwMkUgRlVMTCBTVE9QICguKQoKLy8gVGVybXMgb2YgPHJhdGlvPiBzaG91bGQgYmUgYSBwb3NpdGl2ZSBudW1iZXJzIChub3QgemVybyBvciBuZWdhdGl2ZSkKLy8gKHNlZSBodHRwczovL2RyYWZ0cy5jc3N3Zy5vcmcvbWVkaWFxdWVyaWVzLTMvI3ZhbHVlcykKLy8gSG93ZXZlciwgLW8tbWluLWRldmljZS1waXhlbC1yYXRpbyB0YWtlcyBmcmFjdGlvbmFsIHZhbHVlcyBhcyBhIHJhdGlvJ3MgdGVybQovLyBhbmQgdGhpcyBpcyB1c2luZyBieSB2YXJpb3VzIHNpdGVzLiBUaGVyZWZvcmUgd2UgcmVsYXggY2hlY2tpbmcgb24gcGFyc2UKLy8gdG8gdGVzdCBhIHRlcm0gaXMgdW5zaWduZWQgbnVtYmVyIHdpdGhvdXQgYW4gZXhwb25lbnQgcGFydC4KLy8gQWRkaXRpb25hbCBjaGVja2luZyBtYXkgYmUgYXBwbGllZCBvbiBsZXhlciB2YWxpZGF0aW9uLgpmdW5jdGlvbiBjb25zdW1lTnVtYmVyKCkgewogICAgdGhpcy5za2lwU0MoKTsKCiAgICBjb25zdCB2YWx1ZSA9IHRoaXMuY29uc3VtZShOdW1iZXIkMik7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YWx1ZS5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGNvZGUgPSB2YWx1ZS5jaGFyQ29kZUF0KGkpOwogICAgICAgIGlmICghaXNEaWdpdChjb2RlKSAmJiBjb2RlICE9PSBGVUxMU1RPUCQxKSB7CiAgICAgICAgICAgIHRoaXMuZXJyb3IoJ1Vuc2lnbmVkIG51bWJlciBpcyBleHBlY3RlZCcsIHRoaXMudG9rZW5TdGFydCAtIHZhbHVlLmxlbmd0aCArIGkpOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoTnVtYmVyKHZhbHVlKSA9PT0gMCkgewogICAgICAgIHRoaXMuZXJyb3IoJ1plcm8gbnVtYmVyIGlzIG5vdCBhbGxvd2VkJywgdGhpcy50b2tlblN0YXJ0IC0gdmFsdWUubGVuZ3RoKTsKICAgIH0KCiAgICByZXR1cm4gdmFsdWU7Cn0KCmNvbnN0IG5hbWUkYyA9ICdSYXRpbyc7CmNvbnN0IHN0cnVjdHVyZSRiID0gewogICAgbGVmdDogU3RyaW5nLAogICAgcmlnaHQ6IFN0cmluZwp9OwoKLy8gPHBvc2l0aXZlLWludGVnZXI+IFMqICcvJyBTKiA8cG9zaXRpdmUtaW50ZWdlcj4KZnVuY3Rpb24gcGFyc2UkYygpIHsKICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwogICAgY29uc3QgbGVmdCA9IGNvbnN1bWVOdW1iZXIuY2FsbCh0aGlzKTsKICAgIGxldCByaWdodDsKCiAgICB0aGlzLnNraXBTQygpOwogICAgdGhpcy5lYXREZWxpbShTT0xJRFVTJDIpOwogICAgcmlnaHQgPSBjb25zdW1lTnVtYmVyLmNhbGwodGhpcyk7CgogICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiAnUmF0aW8nLAogICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydCwgdGhpcy50b2tlblN0YXJ0KSwKICAgICAgICBsZWZ0LAogICAgICAgIHJpZ2h0CiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSRjKG5vZGUpIHsKICAgIHRoaXMudG9rZW4oTnVtYmVyJDIsIG5vZGUubGVmdCk7CiAgICB0aGlzLnRva2VuKERlbGltLCAnLycpOwogICAgdGhpcy50b2tlbihOdW1iZXIkMiwgbm9kZS5yaWdodCk7Cn0KCmNvbnN0IFJhdGlvID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoLyojX19QVVJFX18qL09iamVjdC5kZWZpbmVQcm9wZXJ0eSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBnZW5lcmF0ZTogZ2VuZXJhdGUkYywKICAgIG5hbWU6IG5hbWUkYywKICAgIHBhcnNlOiBwYXJzZSRjLAogICAgc3RydWN0dXJlOiBzdHJ1Y3R1cmUkYgp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmZ1bmN0aW9uIGdldE9mZnNldEV4Y2x1ZGVXUygpIHsKICAgIGlmICh0aGlzLnRva2VuSW5kZXggPiAwKSB7CiAgICAgICAgaWYgKHRoaXMubG9va3VwVHlwZSgtMSkgPT09IFdoaXRlU3BhY2UkMSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy50b2tlbkluZGV4ID4gMQogICAgICAgICAgICAgICAgPyB0aGlzLmdldFRva2VuU3RhcnQodGhpcy50b2tlbkluZGV4IC0gMSkKICAgICAgICAgICAgICAgIDogdGhpcy5maXJzdENoYXJPZmZzZXQ7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiB0aGlzLnRva2VuU3RhcnQ7Cn0KCmNvbnN0IG5hbWUkYiA9ICdSYXcnOwpjb25zdCBzdHJ1Y3R1cmUkYSA9IHsKICAgIHZhbHVlOiBTdHJpbmcKfTsKCmZ1bmN0aW9uIHBhcnNlJGIoc3RhcnRUb2tlbiwgY29uc3VtZVVudGlsLCBleGNsdWRlV2hpdGVTcGFjZSkgewogICAgY29uc3Qgc3RhcnRPZmZzZXQgPSB0aGlzLmdldFRva2VuU3RhcnQoc3RhcnRUb2tlbik7CiAgICBsZXQgZW5kT2Zmc2V0OwoKICAgIHRoaXMuc2tpcFVudGlsQmFsYW5jZWQoc3RhcnRUb2tlbiwgY29uc3VtZVVudGlsIHx8IHRoaXMuY29uc3VtZVVudGlsQmFsYW5jZUVuZCk7CgogICAgaWYgKGV4Y2x1ZGVXaGl0ZVNwYWNlICYmIHRoaXMudG9rZW5TdGFydCA+IHN0YXJ0T2Zmc2V0KSB7CiAgICAgICAgZW5kT2Zmc2V0ID0gZ2V0T2Zmc2V0RXhjbHVkZVdTLmNhbGwodGhpcyk7CiAgICB9IGVsc2UgewogICAgICAgIGVuZE9mZnNldCA9IHRoaXMudG9rZW5TdGFydDsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdSYXcnLAogICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydE9mZnNldCwgZW5kT2Zmc2V0KSwKICAgICAgICB2YWx1ZTogdGhpcy5zdWJzdHJpbmcoc3RhcnRPZmZzZXQsIGVuZE9mZnNldCkKICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJGIobm9kZSkgewogICAgdGhpcy50b2tlbml6ZShub2RlLnZhbHVlKTsKfQoKY29uc3QgUmF3ID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoLyojX19QVVJFX18qL09iamVjdC5kZWZpbmVQcm9wZXJ0eSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBnZW5lcmF0ZTogZ2VuZXJhdGUkYiwKICAgIG5hbWU6IG5hbWUkYiwKICAgIHBhcnNlOiBwYXJzZSRiLAogICAgc3RydWN0dXJlOiBzdHJ1Y3R1cmUkYQp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmZ1bmN0aW9uIGNvbnN1bWVSYXckMihzdGFydFRva2VuKSB7CiAgICByZXR1cm4gdGhpcy5SYXcoc3RhcnRUb2tlbiwgdGhpcy5jb25zdW1lVW50aWxMZWZ0Q3VybHlCcmFja2V0LCB0cnVlKTsKfQoKZnVuY3Rpb24gY29uc3VtZVByZWx1ZGUoKSB7CiAgICBjb25zdCBwcmVsdWRlID0gdGhpcy5TZWxlY3Rvckxpc3QoKTsKCiAgICBpZiAocHJlbHVkZS50eXBlICE9PSAnUmF3JyAmJgogICAgICAgIHRoaXMuZW9mID09PSBmYWxzZSAmJgogICAgICAgIHRoaXMudG9rZW5UeXBlICE9PSBMZWZ0Q3VybHlCcmFja2V0KSB7CiAgICAgICAgdGhpcy5lcnJvcigpOwogICAgfQoKICAgIHJldHVybiBwcmVsdWRlOwp9Cgpjb25zdCBuYW1lJGEgPSAnUnVsZSc7CmNvbnN0IHdhbGtDb250ZXh0JDIgPSAncnVsZSc7CmNvbnN0IHN0cnVjdHVyZSQ5ID0gewogICAgcHJlbHVkZTogWydTZWxlY3Rvckxpc3QnLCAnUmF3J10sCiAgICBibG9jazogWydCbG9jayddCn07CgpmdW5jdGlvbiBwYXJzZSRhKCkgewogICAgY29uc3Qgc3RhcnRUb2tlbiA9IHRoaXMudG9rZW5JbmRleDsKICAgIGNvbnN0IHN0YXJ0T2Zmc2V0ID0gdGhpcy50b2tlblN0YXJ0OwogICAgbGV0IHByZWx1ZGU7CiAgICBsZXQgYmxvY2s7CgogICAgaWYgKHRoaXMucGFyc2VSdWxlUHJlbHVkZSkgewogICAgICAgIHByZWx1ZGUgPSB0aGlzLnBhcnNlV2l0aEZhbGxiYWNrKGNvbnN1bWVQcmVsdWRlLCBjb25zdW1lUmF3JDIpOwogICAgfSBlbHNlIHsKICAgICAgICBwcmVsdWRlID0gY29uc3VtZVJhdyQyLmNhbGwodGhpcywgc3RhcnRUb2tlbik7CiAgICB9CgogICAgYmxvY2sgPSB0aGlzLkJsb2NrKHRydWUpOwoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ1J1bGUnLAogICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydE9mZnNldCwgdGhpcy50b2tlblN0YXJ0KSwKICAgICAgICBwcmVsdWRlLAogICAgICAgIGJsb2NrCiAgICB9Owp9CmZ1bmN0aW9uIGdlbmVyYXRlJGEobm9kZSkgewogICAgdGhpcy5ub2RlKG5vZGUucHJlbHVkZSk7CiAgICB0aGlzLm5vZGUobm9kZS5ibG9jayk7Cn0KCmNvbnN0IFJ1bGUgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSRhLAogICAgbmFtZTogbmFtZSRhLAogICAgcGFyc2U6IHBhcnNlJGEsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSQ5LAogICAgd2Fsa0NvbnRleHQ6IHdhbGtDb250ZXh0JDIKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCBuYW1lJDkgPSAnU2VsZWN0b3InOwpjb25zdCBzdHJ1Y3R1cmUkOCA9IHsKICAgIGNoaWxkcmVuOiBbWwogICAgICAgICdUeXBlU2VsZWN0b3InLAogICAgICAgICdJZFNlbGVjdG9yJywKICAgICAgICAnQ2xhc3NTZWxlY3RvcicsCiAgICAgICAgJ0F0dHJpYnV0ZVNlbGVjdG9yJywKICAgICAgICAnUHNldWRvQ2xhc3NTZWxlY3RvcicsCiAgICAgICAgJ1BzZXVkb0VsZW1lbnRTZWxlY3RvcicsCiAgICAgICAgJ0NvbWJpbmF0b3InLAogICAgICAgICdXaGl0ZVNwYWNlJwogICAgXV0KfTsKCmZ1bmN0aW9uIHBhcnNlJDkoKSB7CiAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMucmVhZFNlcXVlbmNlKHRoaXMuc2NvcGUuU2VsZWN0b3IpOwoKICAgIC8vIG5vdGhpbmcgd2VyZSBjb25zdW1lZAogICAgaWYgKHRoaXMuZ2V0Rmlyc3RMaXN0Tm9kZShjaGlsZHJlbikgPT09IG51bGwpIHsKICAgICAgICB0aGlzLmVycm9yKCdTZWxlY3RvciBpcyBleHBlY3RlZCcpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ1NlbGVjdG9yJywKICAgICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb25Gcm9tTGlzdChjaGlsZHJlbiksCiAgICAgICAgY2hpbGRyZW4KICAgIH07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlJDkobm9kZSkgewogICAgdGhpcy5jaGlsZHJlbihub2RlKTsKfQoKY29uc3QgU2VsZWN0b3IgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSQ5LAogICAgbmFtZTogbmFtZSQ5LAogICAgcGFyc2U6IHBhcnNlJDksCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSQ4Cn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgbmFtZSQ4ID0gJ1NlbGVjdG9yTGlzdCc7CmNvbnN0IHdhbGtDb250ZXh0JDEgPSAnc2VsZWN0b3InOwpjb25zdCBzdHJ1Y3R1cmUkNyA9IHsKICAgIGNoaWxkcmVuOiBbWwogICAgICAgICdTZWxlY3RvcicsCiAgICAgICAgJ1JhdycKICAgIF1dCn07CgpmdW5jdGlvbiBwYXJzZSQ4KCkgewogICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNyZWF0ZUxpc3QoKTsKCiAgICB3aGlsZSAoIXRoaXMuZW9mKSB7CiAgICAgICAgY2hpbGRyZW4ucHVzaCh0aGlzLlNlbGVjdG9yKCkpOwoKICAgICAgICBpZiAodGhpcy50b2tlblR5cGUgPT09IENvbW1hKSB7CiAgICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIGJyZWFrOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ1NlbGVjdG9yTGlzdCcsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uRnJvbUxpc3QoY2hpbGRyZW4pLAogICAgICAgIGNoaWxkcmVuCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSQ4KG5vZGUpIHsKICAgIHRoaXMuY2hpbGRyZW4obm9kZSwgKCkgPT4gdGhpcy50b2tlbihDb21tYSwgJywnKSk7Cn0KCmNvbnN0IFNlbGVjdG9yTGlzdCA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJDgsCiAgICBuYW1lOiBuYW1lJDgsCiAgICBwYXJzZTogcGFyc2UkOCwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJDcsCiAgICB3YWxrQ29udGV4dDogd2Fsa0NvbnRleHQkMQp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmNvbnN0IFJFVkVSU0VfU09MSURVUyQxID0gMHgwMDVjOyAvLyBVKzAwNUMgUkVWRVJTRSBTT0xJRFVTIChcKQpjb25zdCBRVU9UQVRJT05fTUFSSyQxID0gMHgwMDIyOyAgLy8gIgpjb25zdCBBUE9TVFJPUEhFJDEgPSAweDAwMjc7ICAgICAgLy8gJwoKZnVuY3Rpb24gZGVjb2RlJDEoc3RyKSB7CiAgICBjb25zdCBsZW4gPSBzdHIubGVuZ3RoOwogICAgY29uc3QgZmlyc3RDaGFyID0gc3RyLmNoYXJDb2RlQXQoMCk7CiAgICBjb25zdCBzdGFydCA9IGZpcnN0Q2hhciA9PT0gUVVPVEFUSU9OX01BUkskMSB8fCBmaXJzdENoYXIgPT09IEFQT1NUUk9QSEUkMSA/IDEgOiAwOwogICAgY29uc3QgZW5kID0gc3RhcnQgPT09IDEgJiYgbGVuID4gMSAmJiBzdHIuY2hhckNvZGVBdChsZW4gLSAxKSA9PT0gZmlyc3RDaGFyID8gbGVuIC0gMiA6IGxlbiAtIDE7CiAgICBsZXQgZGVjb2RlZCA9ICcnOwoKICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8PSBlbmQ7IGkrKykgewogICAgICAgIGxldCBjb2RlID0gc3RyLmNoYXJDb2RlQXQoaSk7CgogICAgICAgIGlmIChjb2RlID09PSBSRVZFUlNFX1NPTElEVVMkMSkgewogICAgICAgICAgICAvLyBzcGVjaWFsIGNhc2UgYXQgdGhlIGVuZGluZwogICAgICAgICAgICBpZiAoaSA9PT0gZW5kKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgbmV4dCBpbnB1dCBjb2RlIHBvaW50IGlzIEVPRiwgZG8gbm90aGluZwogICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIGluY2x1ZGUgbGFzdCBxdW90ZSBhcyBlc2NhcGVkCiAgICAgICAgICAgICAgICBpZiAoaSAhPT0gbGVuIC0gMSkgewogICAgICAgICAgICAgICAgICAgIGRlY29kZWQgPSBzdHIuc3Vic3RyKGkgKyAxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb2RlID0gc3RyLmNoYXJDb2RlQXQoKytpKTsKCiAgICAgICAgICAgIC8vIGNvbnN1bWUgZXNjYXBlZAogICAgICAgICAgICBpZiAoaXNWYWxpZEVzY2FwZShSRVZFUlNFX1NPTElEVVMkMSwgY29kZSkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGVzY2FwZVN0YXJ0ID0gaSAtIDE7CiAgICAgICAgICAgICAgICBjb25zdCBlc2NhcGVFbmQgPSBjb25zdW1lRXNjYXBlZChzdHIsIGVzY2FwZVN0YXJ0KTsKCiAgICAgICAgICAgICAgICBpID0gZXNjYXBlRW5kIC0gMTsKICAgICAgICAgICAgICAgIGRlY29kZWQgKz0gZGVjb2RlRXNjYXBlZChzdHIuc3Vic3RyaW5nKGVzY2FwZVN0YXJ0ICsgMSwgZXNjYXBlRW5kKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBcclxuCiAgICAgICAgICAgICAgICBpZiAoY29kZSA9PT0gMHgwMDBkICYmIHN0ci5jaGFyQ29kZUF0KGkgKyAxKSA9PT0gMHgwMDBhKSB7CiAgICAgICAgICAgICAgICAgICAgaSsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGVjb2RlZCArPSBzdHJbaV07CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBkZWNvZGVkOwp9CgovLyBodHRwczovL2RyYWZ0cy5jc3N3Zy5vcmcvY3Nzb20vI3NlcmlhbGl6ZS1hLXN0cmluZwovLyDCpyAyLjEuIENvbW1vbiBTZXJpYWxpemluZyBJZGlvbXMKZnVuY3Rpb24gZW5jb2RlJDEoc3RyLCBhcG9zdHJvcGhlKSB7CiAgICBjb25zdCBxdW90ZSA9IGFwb3N0cm9waGUgPyAnXCcnIDogJyInOwogICAgY29uc3QgcXVvdGVDb2RlID0gYXBvc3Ryb3BoZSA/IEFQT1NUUk9QSEUkMSA6IFFVT1RBVElPTl9NQVJLJDE7CiAgICBsZXQgZW5jb2RlZCA9ICcnOwogICAgbGV0IHdzQmVmb3JlSGV4SXNOZWVkZWQgPSBmYWxzZTsKCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGNvZGUgPSBzdHIuY2hhckNvZGVBdChpKTsKCiAgICAgICAgLy8gSWYgdGhlIGNoYXJhY3RlciBpcyBOVUxMIChVKzAwMDApLCB0aGVuIHRoZSBSRVBMQUNFTUVOVCBDSEFSQUNURVIgKFUrRkZGRCkuCiAgICAgICAgaWYgKGNvZGUgPT09IDB4MDAwMCkgewogICAgICAgICAgICBlbmNvZGVkICs9ICdcdUZGRkQnOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIC8vIElmIHRoZSBjaGFyYWN0ZXIgaXMgaW4gdGhlIHJhbmdlIFtcMS1cMWZdIChVKzAwMDEgdG8gVSswMDFGKSBvciBpcyBVKzAwN0YsCiAgICAgICAgLy8gdGhlIGNoYXJhY3RlciBlc2NhcGVkIGFzIGNvZGUgcG9pbnQuCiAgICAgICAgLy8gTm90ZTogRG8gbm90IGNvbXBhcmUgd2l0aCAweDAwMDEgc2luY2UgMHgwMDAwIGlzIHByZWNlc3NlZCBiZWZvcmUKICAgICAgICBpZiAoY29kZSA8PSAweDAwMWYgfHwgY29kZSA9PT0gMHgwMDdGKSB7CiAgICAgICAgICAgIGVuY29kZWQgKz0gJ1xcJyArIGNvZGUudG9TdHJpbmcoMTYpOwogICAgICAgICAgICB3c0JlZm9yZUhleElzTmVlZGVkID0gdHJ1ZTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICAvLyBJZiB0aGUgY2hhcmFjdGVyIGlzICciJyAoVSswMDIyKSBvciAiXCIgKFUrMDA1QyksIHRoZSBlc2NhcGVkIGNoYXJhY3Rlci4KICAgICAgICBpZiAoY29kZSA9PT0gcXVvdGVDb2RlIHx8IGNvZGUgPT09IFJFVkVSU0VfU09MSURVUyQxKSB7CiAgICAgICAgICAgIGVuY29kZWQgKz0gJ1xcJyArIHN0ci5jaGFyQXQoaSk7CiAgICAgICAgICAgIHdzQmVmb3JlSGV4SXNOZWVkZWQgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAod3NCZWZvcmVIZXhJc05lZWRlZCAmJiAoaXNIZXhEaWdpdChjb2RlKSB8fCBpc1doaXRlU3BhY2UoY29kZSkpKSB7CiAgICAgICAgICAgICAgICBlbmNvZGVkICs9ICcgJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCB0aGUgY2hhcmFjdGVyIGl0c2VsZi4KICAgICAgICAgICAgZW5jb2RlZCArPSBzdHIuY2hhckF0KGkpOwogICAgICAgICAgICB3c0JlZm9yZUhleElzTmVlZGVkID0gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBxdW90ZSArIGVuY29kZWQgKyBxdW90ZTsKfQoKY29uc3QgbmFtZSQ3ID0gJ1N0cmluZyc7CmNvbnN0IHN0cnVjdHVyZSQ2ID0gewogICAgdmFsdWU6IFN0cmluZwp9OwoKZnVuY3Rpb24gcGFyc2UkNygpIHsKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ1N0cmluZycsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHRoaXMudG9rZW5TdGFydCwgdGhpcy50b2tlbkVuZCksCiAgICAgICAgdmFsdWU6IGRlY29kZSQxKHRoaXMuY29uc3VtZShTdHJpbmckMikpCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSQ3KG5vZGUpIHsKICAgIHRoaXMudG9rZW4oU3RyaW5nJDIsIGVuY29kZSQxKG5vZGUudmFsdWUpKTsKfQoKY29uc3QgU3RyaW5nJDEgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSQ3LAogICAgbmFtZTogbmFtZSQ3LAogICAgcGFyc2U6IHBhcnNlJDcsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSQ2Cn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgRVhDTEFNQVRJT05NQVJLID0gMHgwMDIxOyAvLyBVKzAwMjEgRVhDTEFNQVRJT04gTUFSSyAoISkKCmZ1bmN0aW9uIGNvbnN1bWVSYXckMShzdGFydFRva2VuKSB7CiAgICByZXR1cm4gdGhpcy5SYXcoc3RhcnRUb2tlbiwgbnVsbCwgZmFsc2UpOwp9Cgpjb25zdCBuYW1lJDYgPSAnU3R5bGVTaGVldCc7CmNvbnN0IHdhbGtDb250ZXh0ID0gJ3N0eWxlc2hlZXQnOwpjb25zdCBzdHJ1Y3R1cmUkNSA9IHsKICAgIGNoaWxkcmVuOiBbWwogICAgICAgICdDb21tZW50JywKICAgICAgICAnQ0RPJywKICAgICAgICAnQ0RDJywKICAgICAgICAnQXRydWxlJywKICAgICAgICAnUnVsZScsCiAgICAgICAgJ1JhdycKICAgIF1dCn07CgpmdW5jdGlvbiBwYXJzZSQ2KCkgewogICAgY29uc3Qgc3RhcnQgPSB0aGlzLnRva2VuU3RhcnQ7CiAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuY3JlYXRlTGlzdCgpOwogICAgbGV0IGNoaWxkOwoKICAgIHdoaWxlICghdGhpcy5lb2YpIHsKICAgICAgICBzd2l0Y2ggKHRoaXMudG9rZW5UeXBlKSB7CiAgICAgICAgICAgIGNhc2UgV2hpdGVTcGFjZSQxOgogICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGNhc2UgQ29tbWVudCQxOgogICAgICAgICAgICAgICAgLy8gaWdub3JlIGNvbW1lbnRzIGV4Y2VwdCBleGNsYW1hdGlvbiBjb21tZW50cyAoaS5lLiAvKiEgLi4gKi8pIG9uIHRvcCBsZXZlbAogICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hhckNvZGVBdCh0aGlzLnRva2VuU3RhcnQgKyAyKSAhPT0gRVhDTEFNQVRJT05NQVJLKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY2hpbGQgPSB0aGlzLkNvbW1lbnQoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBDRE8kMTogLy8gPCEtLQogICAgICAgICAgICAgICAgY2hpbGQgPSB0aGlzLkNETygpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIENEQyQxOiAvLyAtLT4KICAgICAgICAgICAgICAgIGNoaWxkID0gdGhpcy5DREMoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgLy8gQ1NTIFN5bnRheCBNb2R1bGUgTGV2ZWwgMwogICAgICAgICAgICAvLyDCpzIuMiBFcnJvciBoYW5kbGluZwogICAgICAgICAgICAvLyBBdCB0aGUgInRvcCBsZXZlbCIgb2YgYSBzdHlsZXNoZWV0LCBhbiA8YXQta2V5d29yZC10b2tlbj4gc3RhcnRzIGFuIGF0LXJ1bGUuCiAgICAgICAgICAgIGNhc2UgQXRLZXl3b3JkOgogICAgICAgICAgICAgICAgY2hpbGQgPSB0aGlzLnBhcnNlV2l0aEZhbGxiYWNrKHRoaXMuQXRydWxlLCBjb25zdW1lUmF3JDEpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAvLyBBbnl0aGluZyBlbHNlIHN0YXJ0cyBhIHF1YWxpZmllZCBydWxlIC4uLgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgY2hpbGQgPSB0aGlzLnBhcnNlV2l0aEZhbGxiYWNrKHRoaXMuUnVsZSwgY29uc3VtZVJhdyQxKTsKICAgICAgICB9CgogICAgICAgIGNoaWxkcmVuLnB1c2goY2hpbGQpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ1N0eWxlU2hlZXQnLAogICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydCwgdGhpcy50b2tlblN0YXJ0KSwKICAgICAgICBjaGlsZHJlbgogICAgfTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGUkNihub2RlKSB7CiAgICB0aGlzLmNoaWxkcmVuKG5vZGUpOwp9Cgpjb25zdCBTdHlsZVNoZWV0ID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoLyojX19QVVJFX18qL09iamVjdC5kZWZpbmVQcm9wZXJ0eSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBnZW5lcmF0ZTogZ2VuZXJhdGUkNiwKICAgIG5hbWU6IG5hbWUkNiwKICAgIHBhcnNlOiBwYXJzZSQ2LAogICAgc3RydWN0dXJlOiBzdHJ1Y3R1cmUkNSwKICAgIHdhbGtDb250ZXh0Cn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgQVNURVJJU0skMiA9IDB4MDAyQTsgICAgIC8vIFUrMDAyQSBBU1RFUklTSyAoKikKY29uc3QgVkVSVElDQUxMSU5FJDEgPSAweDAwN0M7IC8vIFUrMDA3QyBWRVJUSUNBTCBMSU5FICh8KQoKZnVuY3Rpb24gZWF0SWRlbnRpZmllck9yQXN0ZXJpc2soKSB7CiAgICBpZiAodGhpcy50b2tlblR5cGUgIT09IElkZW50ICYmCiAgICAgICAgdGhpcy5pc0RlbGltKEFTVEVSSVNLJDIpID09PSBmYWxzZSkgewogICAgICAgIHRoaXMuZXJyb3IoJ0lkZW50aWZpZXIgb3IgYXN0ZXJpc2sgaXMgZXhwZWN0ZWQnKTsKICAgIH0KCiAgICB0aGlzLm5leHQoKTsKfQoKY29uc3QgbmFtZSQ1ID0gJ1R5cGVTZWxlY3Rvcic7CmNvbnN0IHN0cnVjdHVyZSQ0ID0gewogICAgbmFtZTogU3RyaW5nCn07CgovLyBpZGVudAovLyBpZGVudHxpZGVudAovLyBpZGVudHwqCi8vICoKLy8gKnxpZGVudAovLyAqfCoKLy8gfGlkZW50Ci8vIHwqCmZ1bmN0aW9uIHBhcnNlJDUoKSB7CiAgICBjb25zdCBzdGFydCA9IHRoaXMudG9rZW5TdGFydDsKCiAgICBpZiAodGhpcy5pc0RlbGltKFZFUlRJQ0FMTElORSQxKSkgewogICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgIGVhdElkZW50aWZpZXJPckFzdGVyaXNrLmNhbGwodGhpcyk7CiAgICB9IGVsc2UgewogICAgICAgIGVhdElkZW50aWZpZXJPckFzdGVyaXNrLmNhbGwodGhpcyk7CgogICAgICAgIGlmICh0aGlzLmlzRGVsaW0oVkVSVElDQUxMSU5FJDEpKSB7CiAgICAgICAgICAgIHRoaXMubmV4dCgpOwogICAgICAgICAgICBlYXRJZGVudGlmaWVyT3JBc3Rlcmlzay5jYWxsKHRoaXMpOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdUeXBlU2VsZWN0b3InLAogICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydCwgdGhpcy50b2tlblN0YXJ0KSwKICAgICAgICBuYW1lOiB0aGlzLnN1YnN0clRvQ3Vyc29yKHN0YXJ0KQogICAgfTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGUkNShub2RlKSB7CiAgICB0aGlzLnRva2VuaXplKG5vZGUubmFtZSk7Cn0KCmNvbnN0IFR5cGVTZWxlY3RvciA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJDUsCiAgICBuYW1lOiBuYW1lJDUsCiAgICBwYXJzZTogcGFyc2UkNSwKICAgIHN0cnVjdHVyZTogc3RydWN0dXJlJDQKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCBQTFVTU0lHTiQyID0gMHgwMDJCOyAgICAgLy8gVSswMDJCIFBMVVMgU0lHTiAoKykKY29uc3QgSFlQSEVOTUlOVVMkMSA9IDB4MDAyRDsgIC8vIFUrMDAyRCBIWVBIRU4tTUlOVVMgKC0pCmNvbnN0IFFVRVNUSU9OTUFSSyA9IDB4MDAzRjsgLy8gVSswMDNGIFFVRVNUSU9OIE1BUksgKD8pCgpmdW5jdGlvbiBlYXRIZXhTZXF1ZW5jZShvZmZzZXQsIGFsbG93RGFzaCkgewogICAgbGV0IGxlbiA9IDA7CgogICAgZm9yIChsZXQgcG9zID0gdGhpcy50b2tlblN0YXJ0ICsgb2Zmc2V0OyBwb3MgPCB0aGlzLnRva2VuRW5kOyBwb3MrKykgewogICAgICAgIGNvbnN0IGNvZGUgPSB0aGlzLmNoYXJDb2RlQXQocG9zKTsKCiAgICAgICAgaWYgKGNvZGUgPT09IEhZUEhFTk1JTlVTJDEgJiYgYWxsb3dEYXNoICYmIGxlbiAhPT0gMCkgewogICAgICAgICAgICBlYXRIZXhTZXF1ZW5jZS5jYWxsKHRoaXMsIG9mZnNldCArIGxlbiArIDEsIGZhbHNlKTsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFpc0hleERpZ2l0KGNvZGUpKSB7CiAgICAgICAgICAgIHRoaXMuZXJyb3IoCiAgICAgICAgICAgICAgICBhbGxvd0Rhc2ggJiYgbGVuICE9PSAwCiAgICAgICAgICAgICAgICAgICAgPyAnSHlwaGVuIG1pbnVzJyArIChsZW4gPCA2ID8gJyBvciBoZXggZGlnaXQnIDogJycpICsgJyBpcyBleHBlY3RlZCcKICAgICAgICAgICAgICAgICAgICA6IChsZW4gPCA2ID8gJ0hleCBkaWdpdCBpcyBleHBlY3RlZCcgOiAnVW5leHBlY3RlZCBpbnB1dCcpLAogICAgICAgICAgICAgICAgcG9zCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBpZiAoKytsZW4gPiA2KSB7CiAgICAgICAgICAgIHRoaXMuZXJyb3IoJ1RvbyBtYW55IGhleCBkaWdpdHMnLCBwb3MpOwogICAgICAgIH0gICAgfQoKICAgIHRoaXMubmV4dCgpOwogICAgcmV0dXJuIGxlbjsKfQoKZnVuY3Rpb24gZWF0UXVlc3Rpb25NYXJrU2VxdWVuY2UobWF4KSB7CiAgICBsZXQgY291bnQgPSAwOwoKICAgIHdoaWxlICh0aGlzLmlzRGVsaW0oUVVFU1RJT05NQVJLKSkgewogICAgICAgIGlmICgrK2NvdW50ID4gbWF4KSB7CiAgICAgICAgICAgIHRoaXMuZXJyb3IoJ1RvbyBtYW55IHF1ZXN0aW9uIG1hcmtzJyk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLm5leHQoKTsKICAgIH0KfQoKZnVuY3Rpb24gc3RhcnRzV2l0aChjb2RlKSB7CiAgICBpZiAodGhpcy5jaGFyQ29kZUF0KHRoaXMudG9rZW5TdGFydCkgIT09IGNvZGUpIHsKICAgICAgICB0aGlzLmVycm9yKChjb2RlID09PSBQTFVTU0lHTiQyID8gJ1BsdXMgc2lnbicgOiAnSHlwaGVuIG1pbnVzJykgKyAnIGlzIGV4cGVjdGVkJyk7CiAgICB9Cn0KCi8vIGh0dHBzOi8vZHJhZnRzLmNzc3dnLm9yZy9jc3Mtc3ludGF4LyN1cmFuZ2UKLy8gSW5mb3JtYWxseSwgdGhlIDx1cmFuZ2U+IHByb2R1Y3Rpb24gaGFzIHRocmVlIGZvcm1zOgovLyBVKzAwMDEKLy8gICAgICBEZWZpbmVzIGEgcmFuZ2UgY29uc2lzdGluZyBvZiBhIHNpbmdsZSBjb2RlIHBvaW50LCBpbiB0aGlzIGNhc2UgdGhlIGNvZGUgcG9pbnQgIjEiLgovLyBVKzAwMDEtMDBmZgovLyAgICAgIERlZmluZXMgYSByYW5nZSBvZiBjb2RlcG9pbnRzIGJldHdlZW4gdGhlIGZpcnN0IGFuZCB0aGUgc2Vjb25kIHZhbHVlLCBpbiB0aGlzIGNhc2UKLy8gICAgICB0aGUgcmFuZ2UgYmV0d2VlbiAiMSIgYW5kICJmZiIgKDI1NSBpbiBkZWNpbWFsKSBpbmNsdXNpdmUuCi8vIFUrMDA/PwovLyAgICAgIERlZmluZXMgYSByYW5nZSBvZiBjb2RlcG9pbnRzIHdoZXJlIHRoZSAiPyIgY2hhcmFjdGVycyByYW5nZSBvdmVyIGFsbCBoZXggZGlnaXRzLAovLyAgICAgIGluIHRoaXMgY2FzZSBkZWZpbmluZyB0aGUgc2FtZSBhcyB0aGUgdmFsdWUgVSswMDAwLTAwZmYuCi8vIEluIGVhY2ggZm9ybSwgYSBtYXhpbXVtIG9mIDYgZGlnaXRzIGlzIGFsbG93ZWQgZm9yIGVhY2ggaGV4YWRlY2ltYWwgbnVtYmVyIChpZiB5b3UgdHJlYXQgIj8iIGFzIGEgaGV4YWRlY2ltYWwgZGlnaXQpLgovLwovLyA8dXJhbmdlPiA9Ci8vICAgdSAnKycgPGlkZW50LXRva2VuPiAnPycqIHwKLy8gICB1IDxkaW1lbnNpb24tdG9rZW4+ICc/JyogfAovLyAgIHUgPG51bWJlci10b2tlbj4gJz8nKiB8Ci8vICAgdSA8bnVtYmVyLXRva2VuPiA8ZGltZW5zaW9uLXRva2VuPiB8Ci8vICAgdSA8bnVtYmVyLXRva2VuPiA8bnVtYmVyLXRva2VuPiB8Ci8vICAgdSAnKycgJz8nKwpmdW5jdGlvbiBzY2FuVW5pY29kZVJhbmdlKCkgewogICAgbGV0IGhleExlbmd0aCA9IDA7CgogICAgc3dpdGNoICh0aGlzLnRva2VuVHlwZSkgewogICAgICAgIGNhc2UgTnVtYmVyJDI6CiAgICAgICAgICAgIC8vIHUgPG51bWJlci10b2tlbj4gJz8nKgogICAgICAgICAgICAvLyB1IDxudW1iZXItdG9rZW4+IDxkaW1lbnNpb24tdG9rZW4+CiAgICAgICAgICAgIC8vIHUgPG51bWJlci10b2tlbj4gPG51bWJlci10b2tlbj4KICAgICAgICAgICAgaGV4TGVuZ3RoID0gZWF0SGV4U2VxdWVuY2UuY2FsbCh0aGlzLCAxLCB0cnVlKTsKCiAgICAgICAgICAgIGlmICh0aGlzLmlzRGVsaW0oUVVFU1RJT05NQVJLKSkgewogICAgICAgICAgICAgICAgZWF0UXVlc3Rpb25NYXJrU2VxdWVuY2UuY2FsbCh0aGlzLCA2IC0gaGV4TGVuZ3RoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy50b2tlblR5cGUgPT09IERpbWVuc2lvbiQxIHx8CiAgICAgICAgICAgICAgICB0aGlzLnRva2VuVHlwZSA9PT0gTnVtYmVyJDIpIHsKICAgICAgICAgICAgICAgIHN0YXJ0c1dpdGguY2FsbCh0aGlzLCBIWVBIRU5NSU5VUyQxKTsKICAgICAgICAgICAgICAgIGVhdEhleFNlcXVlbmNlLmNhbGwodGhpcywgMSwgZmFsc2UpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIERpbWVuc2lvbiQxOgogICAgICAgICAgICAvLyB1IDxkaW1lbnNpb24tdG9rZW4+ICc/JyoKICAgICAgICAgICAgaGV4TGVuZ3RoID0gZWF0SGV4U2VxdWVuY2UuY2FsbCh0aGlzLCAxLCB0cnVlKTsKCiAgICAgICAgICAgIGlmIChoZXhMZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBlYXRRdWVzdGlvbk1hcmtTZXF1ZW5jZS5jYWxsKHRoaXMsIDYgLSBoZXhMZW5ndGgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgLy8gdSAnKycgPGlkZW50LXRva2VuPiAnPycqCiAgICAgICAgICAgIC8vIHUgJysnICc/JysKICAgICAgICAgICAgdGhpcy5lYXREZWxpbShQTFVTU0lHTiQyKTsKCiAgICAgICAgICAgIGlmICh0aGlzLnRva2VuVHlwZSA9PT0gSWRlbnQpIHsKICAgICAgICAgICAgICAgIGhleExlbmd0aCA9IGVhdEhleFNlcXVlbmNlLmNhbGwodGhpcywgMCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBpZiAoaGV4TGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIGVhdFF1ZXN0aW9uTWFya1NlcXVlbmNlLmNhbGwodGhpcywgNiAtIGhleExlbmd0aCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuaXNEZWxpbShRVUVTVElPTk1BUkspKSB7CiAgICAgICAgICAgICAgICB0aGlzLm5leHQoKTsKICAgICAgICAgICAgICAgIGVhdFF1ZXN0aW9uTWFya1NlcXVlbmNlLmNhbGwodGhpcywgNSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5lcnJvcignSGV4IGRpZ2l0IG9yIHF1ZXN0aW9uIG1hcmsgaXMgZXhwZWN0ZWQnKTsKICAgIH0KfQoKY29uc3QgbmFtZSQ0ID0gJ1VuaWNvZGVSYW5nZSc7CmNvbnN0IHN0cnVjdHVyZSQzID0gewogICAgdmFsdWU6IFN0cmluZwp9OwoKZnVuY3Rpb24gcGFyc2UkNCgpIHsKICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwoKICAgIC8vIFUgb3IgdQogICAgdGhpcy5lYXRJZGVudCgndScpOwogICAgc2NhblVuaWNvZGVSYW5nZS5jYWxsKHRoaXMpOwoKICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogJ1VuaWNvZGVSYW5nZScsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnRva2VuU3RhcnQpLAogICAgICAgIHZhbHVlOiB0aGlzLnN1YnN0clRvQ3Vyc29yKHN0YXJ0KQogICAgfTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGUkNChub2RlKSB7CiAgICB0aGlzLnRva2VuaXplKG5vZGUudmFsdWUpOwp9Cgpjb25zdCBVbmljb2RlUmFuZ2UgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSQ0LAogICAgbmFtZTogbmFtZSQ0LAogICAgcGFyc2U6IHBhcnNlJDQsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSQzCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgU1BBQ0UkMSA9IDB4MDAyMDsgICAgICAgICAgICAvLyBVKzAwMjAgU1BBQ0UKY29uc3QgUkVWRVJTRV9TT0xJRFVTID0gMHgwMDVjOyAgLy8gVSswMDVDIFJFVkVSU0UgU09MSURVUyAoXCkKY29uc3QgUVVPVEFUSU9OX01BUksgPSAweDAwMjI7ICAgLy8gIgpjb25zdCBBUE9TVFJPUEhFID0gMHgwMDI3OyAgICAgICAvLyAnCmNvbnN0IExFRlRQQVJFTlRIRVNJUyA9IDB4MDAyODsgIC8vIFUrMDAyOCBMRUZUIFBBUkVOVEhFU0lTICgoKQpjb25zdCBSSUdIVFBBUkVOVEhFU0lTID0gMHgwMDI5OyAvLyBVKzAwMjkgUklHSFQgUEFSRU5USEVTSVMgKCkpCgpmdW5jdGlvbiBkZWNvZGUoc3RyKSB7CiAgICBjb25zdCBsZW4gPSBzdHIubGVuZ3RoOwogICAgbGV0IHN0YXJ0ID0gNDsgLy8gbGVuZ3RoIG9mICJ1cmwoIgogICAgbGV0IGVuZCA9IHN0ci5jaGFyQ29kZUF0KGxlbiAtIDEpID09PSBSSUdIVFBBUkVOVEhFU0lTID8gbGVuIC0gMiA6IGxlbiAtIDE7CiAgICBsZXQgZGVjb2RlZCA9ICcnOwoKICAgIHdoaWxlIChzdGFydCA8IGVuZCAmJiBpc1doaXRlU3BhY2Uoc3RyLmNoYXJDb2RlQXQoc3RhcnQpKSkgewogICAgICAgIHN0YXJ0Kys7CiAgICB9CgogICAgd2hpbGUgKHN0YXJ0IDwgZW5kICYmIGlzV2hpdGVTcGFjZShzdHIuY2hhckNvZGVBdChlbmQpKSkgewogICAgICAgIGVuZC0tOwogICAgfQoKICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8PSBlbmQ7IGkrKykgewogICAgICAgIGxldCBjb2RlID0gc3RyLmNoYXJDb2RlQXQoaSk7CgogICAgICAgIGlmIChjb2RlID09PSBSRVZFUlNFX1NPTElEVVMpIHsKICAgICAgICAgICAgLy8gc3BlY2lhbCBjYXNlIGF0IHRoZSBlbmRpbmcKICAgICAgICAgICAgaWYgKGkgPT09IGVuZCkgewogICAgICAgICAgICAgICAgLy8gaWYgdGhlIG5leHQgaW5wdXQgY29kZSBwb2ludCBpcyBFT0YsIGRvIG5vdGhpbmcKICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSBpbmNsdWRlIGxhc3QgbGVmdCBwYXJlbnRoZXNpcyBhcyBlc2NhcGVkCiAgICAgICAgICAgICAgICBpZiAoaSAhPT0gbGVuIC0gMSkgewogICAgICAgICAgICAgICAgICAgIGRlY29kZWQgPSBzdHIuc3Vic3RyKGkgKyAxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb2RlID0gc3RyLmNoYXJDb2RlQXQoKytpKTsKCiAgICAgICAgICAgIC8vIGNvbnN1bWUgZXNjYXBlZAogICAgICAgICAgICBpZiAoaXNWYWxpZEVzY2FwZShSRVZFUlNFX1NPTElEVVMsIGNvZGUpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlc2NhcGVTdGFydCA9IGkgLSAxOwogICAgICAgICAgICAgICAgY29uc3QgZXNjYXBlRW5kID0gY29uc3VtZUVzY2FwZWQoc3RyLCBlc2NhcGVTdGFydCk7CgogICAgICAgICAgICAgICAgaSA9IGVzY2FwZUVuZCAtIDE7CiAgICAgICAgICAgICAgICBkZWNvZGVkICs9IGRlY29kZUVzY2FwZWQoc3RyLnN1YnN0cmluZyhlc2NhcGVTdGFydCArIDEsIGVzY2FwZUVuZCkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gXHJcbgogICAgICAgICAgICAgICAgaWYgKGNvZGUgPT09IDB4MDAwZCAmJiBzdHIuY2hhckNvZGVBdChpICsgMSkgPT09IDB4MDAwYSkgewogICAgICAgICAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRlY29kZWQgKz0gc3RyW2ldOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZGVjb2RlZDsKfQoKZnVuY3Rpb24gZW5jb2RlKHN0cikgewogICAgbGV0IGVuY29kZWQgPSAnJzsKICAgIGxldCB3c0JlZm9yZUhleElzTmVlZGVkID0gZmFsc2U7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBjb2RlID0gc3RyLmNoYXJDb2RlQXQoaSk7CgogICAgICAgIC8vIElmIHRoZSBjaGFyYWN0ZXIgaXMgTlVMTCAoVSswMDAwKSwgdGhlbiB0aGUgUkVQTEFDRU1FTlQgQ0hBUkFDVEVSIChVK0ZGRkQpLgogICAgICAgIGlmIChjb2RlID09PSAweDAwMDApIHsKICAgICAgICAgICAgZW5jb2RlZCArPSAnXHVGRkZEJzsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICAvLyBJZiB0aGUgY2hhcmFjdGVyIGlzIGluIHRoZSByYW5nZSBbXDEtXDFmXSAoVSswMDAxIHRvIFUrMDAxRikgb3IgaXMgVSswMDdGLAogICAgICAgIC8vIHRoZSBjaGFyYWN0ZXIgZXNjYXBlZCBhcyBjb2RlIHBvaW50LgogICAgICAgIC8vIE5vdGU6IERvIG5vdCBjb21wYXJlIHdpdGggMHgwMDAxIHNpbmNlIDB4MDAwMCBpcyBwcmVjZXNzZWQgYmVmb3JlCiAgICAgICAgaWYgKGNvZGUgPD0gMHgwMDFmIHx8IGNvZGUgPT09IDB4MDA3RikgewogICAgICAgICAgICBlbmNvZGVkICs9ICdcXCcgKyBjb2RlLnRvU3RyaW5nKDE2KTsKICAgICAgICAgICAgd3NCZWZvcmVIZXhJc05lZWRlZCA9IHRydWU7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNvZGUgPT09IFNQQUNFJDEgfHwKICAgICAgICAgICAgY29kZSA9PT0gUkVWRVJTRV9TT0xJRFVTIHx8CiAgICAgICAgICAgIGNvZGUgPT09IFFVT1RBVElPTl9NQVJLIHx8CiAgICAgICAgICAgIGNvZGUgPT09IEFQT1NUUk9QSEUgfHwKICAgICAgICAgICAgY29kZSA9PT0gTEVGVFBBUkVOVEhFU0lTIHx8CiAgICAgICAgICAgIGNvZGUgPT09IFJJR0hUUEFSRU5USEVTSVMpIHsKICAgICAgICAgICAgZW5jb2RlZCArPSAnXFwnICsgc3RyLmNoYXJBdChpKTsKICAgICAgICAgICAgd3NCZWZvcmVIZXhJc05lZWRlZCA9IGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh3c0JlZm9yZUhleElzTmVlZGVkICYmIGlzSGV4RGlnaXQoY29kZSkpIHsKICAgICAgICAgICAgICAgIGVuY29kZWQgKz0gJyAnOwogICAgICAgICAgICB9CgogICAgICAgICAgICBlbmNvZGVkICs9IHN0ci5jaGFyQXQoaSk7CiAgICAgICAgICAgIHdzQmVmb3JlSGV4SXNOZWVkZWQgPSBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuICd1cmwoJyArIGVuY29kZWQgKyAnKSc7Cn0KCmNvbnN0IG5hbWUkMyA9ICdVcmwnOwpjb25zdCBzdHJ1Y3R1cmUkMiA9IHsKICAgIHZhbHVlOiBTdHJpbmcKfTsKCi8vIDx1cmwtdG9rZW4+IHwgPGZ1bmN0aW9uLXRva2VuPiA8c3RyaW5nPiApCmZ1bmN0aW9uIHBhcnNlJDMoKSB7CiAgICBjb25zdCBzdGFydCA9IHRoaXMudG9rZW5TdGFydDsKICAgIGxldCB2YWx1ZTsKCiAgICBzd2l0Y2ggKHRoaXMudG9rZW5UeXBlKSB7CiAgICAgICAgY2FzZSBVcmwkMToKICAgICAgICAgICAgdmFsdWUgPSBkZWNvZGUodGhpcy5jb25zdW1lKFVybCQxKSk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIEZ1bmN0aW9uJDI6CiAgICAgICAgICAgIGlmICghdGhpcy5jbXBTdHIodGhpcy50b2tlblN0YXJ0LCB0aGlzLnRva2VuRW5kLCAndXJsKCcpKSB7CiAgICAgICAgICAgICAgICB0aGlzLmVycm9yKCdGdW5jdGlvbiBuYW1lIG11c3QgYmUgYHVybGAnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5lYXQoRnVuY3Rpb24kMik7CiAgICAgICAgICAgIHRoaXMuc2tpcFNDKCk7CiAgICAgICAgICAgIHZhbHVlID0gZGVjb2RlJDEodGhpcy5jb25zdW1lKFN0cmluZyQyKSk7CiAgICAgICAgICAgIHRoaXMuc2tpcFNDKCk7CiAgICAgICAgICAgIGlmICghdGhpcy5lb2YpIHsKICAgICAgICAgICAgICAgIHRoaXMuZWF0KFJpZ2h0UGFyZW50aGVzaXMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICB0aGlzLmVycm9yKCdVcmwgb3IgRnVuY3Rpb24gaXMgZXhwZWN0ZWQnKTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdVcmwnLAogICAgICAgIGxvYzogdGhpcy5nZXRMb2NhdGlvbihzdGFydCwgdGhpcy50b2tlblN0YXJ0KSwKICAgICAgICB2YWx1ZQogICAgfTsKfQoKZnVuY3Rpb24gZ2VuZXJhdGUkMyhub2RlKSB7CiAgICB0aGlzLnRva2VuKFVybCQxLCBlbmNvZGUobm9kZS52YWx1ZSkpOwp9Cgpjb25zdCBVcmwgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSgvKiNfX1BVUkVfXyovT2JqZWN0LmRlZmluZVByb3BlcnR5KHsKICAgIF9fcHJvdG9fXzogbnVsbCwKICAgIGdlbmVyYXRlOiBnZW5lcmF0ZSQzLAogICAgbmFtZTogbmFtZSQzLAogICAgcGFyc2U6IHBhcnNlJDMsCiAgICBzdHJ1Y3R1cmU6IHN0cnVjdHVyZSQyCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgbmFtZSQyID0gJ1ZhbHVlJzsKY29uc3Qgc3RydWN0dXJlJDEgPSB7CiAgICBjaGlsZHJlbjogW1tdXQp9OwoKZnVuY3Rpb24gcGFyc2UkMigpIHsKICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy50b2tlblN0YXJ0OwogICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLnJlYWRTZXF1ZW5jZSh0aGlzLnNjb3BlLlZhbHVlKTsKCiAgICByZXR1cm4gewogICAgICAgIHR5cGU6ICdWYWx1ZScsCiAgICAgICAgbG9jOiB0aGlzLmdldExvY2F0aW9uKHN0YXJ0LCB0aGlzLnRva2VuU3RhcnQpLAogICAgICAgIGNoaWxkcmVuCiAgICB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSQyKG5vZGUpIHsKICAgIHRoaXMuY2hpbGRyZW4obm9kZSk7Cn0KCmNvbnN0IFZhbHVlID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoLyojX19QVVJFX18qL09iamVjdC5kZWZpbmVQcm9wZXJ0eSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBnZW5lcmF0ZTogZ2VuZXJhdGUkMiwKICAgIG5hbWU6IG5hbWUkMiwKICAgIHBhcnNlOiBwYXJzZSQyLAogICAgc3RydWN0dXJlOiBzdHJ1Y3R1cmUkMQp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmNvbnN0IFNQQUNFID0gT2JqZWN0LmZyZWV6ZSh7CiAgICB0eXBlOiAnV2hpdGVTcGFjZScsCiAgICBsb2M6IG51bGwsCiAgICB2YWx1ZTogJyAnCn0pOwoKY29uc3QgbmFtZSQxID0gJ1doaXRlU3BhY2UnOwpjb25zdCBzdHJ1Y3R1cmUgPSB7CiAgICB2YWx1ZTogU3RyaW5nCn07CgpmdW5jdGlvbiBwYXJzZSQxKCkgewogICAgdGhpcy5lYXQoV2hpdGVTcGFjZSQxKTsKICAgIHJldHVybiBTUEFDRTsKCiAgICAvLyByZXR1cm4gewogICAgLy8gICAgIHR5cGU6ICdXaGl0ZVNwYWNlJywKICAgIC8vICAgICBsb2M6IHRoaXMuZ2V0TG9jYXRpb24odGhpcy50b2tlblN0YXJ0LCB0aGlzLnRva2VuRW5kKSwKICAgIC8vICAgICB2YWx1ZTogdGhpcy5jb25zdW1lKFdISVRFU1BBQ0UpCiAgICAvLyB9Owp9CgpmdW5jdGlvbiBnZW5lcmF0ZSQxKG5vZGUpIHsKICAgIHRoaXMudG9rZW4oV2hpdGVTcGFjZSQxLCBub2RlLnZhbHVlKTsKfQoKY29uc3QgV2hpdGVTcGFjZSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgZ2VuZXJhdGU6IGdlbmVyYXRlJDEsCiAgICBuYW1lOiBuYW1lJDEsCiAgICBwYXJzZTogcGFyc2UkMSwKICAgIHN0cnVjdHVyZQp9LCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pKTsKCmNvbnN0IG5vZGUkMSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgQW5QbHVzQiwKICAgIEF0cnVsZSwKICAgIEF0cnVsZVByZWx1ZGUsCiAgICBBdHRyaWJ1dGVTZWxlY3RvciwKICAgIEJsb2NrLAogICAgQnJhY2tldHMsCiAgICBDREMsCiAgICBDRE8sCiAgICBDbGFzc1NlbGVjdG9yLAogICAgQ29tYmluYXRvciwKICAgIENvbW1lbnQsCiAgICBEZWNsYXJhdGlvbiwKICAgIERlY2xhcmF0aW9uTGlzdCwKICAgIERpbWVuc2lvbiwKICAgIEZ1bmN0aW9uOiBGdW5jdGlvbiQxLAogICAgSGFzaCwKICAgIElkU2VsZWN0b3IsCiAgICBJZGVudGlmaWVyLAogICAgTWVkaWFGZWF0dXJlLAogICAgTWVkaWFRdWVyeSwKICAgIE1lZGlhUXVlcnlMaXN0LAogICAgTmVzdGluZ1NlbGVjdG9yLAogICAgTnRoLAogICAgTnVtYmVyOiBOdW1iZXIkMSwKICAgIE9wZXJhdG9yLAogICAgUGFyZW50aGVzZXMsCiAgICBQZXJjZW50YWdlLAogICAgUHNldWRvQ2xhc3NTZWxlY3RvciwKICAgIFBzZXVkb0VsZW1lbnRTZWxlY3RvciwKICAgIFJhdGlvLAogICAgUmF3LAogICAgUnVsZSwKICAgIFNlbGVjdG9yLAogICAgU2VsZWN0b3JMaXN0LAogICAgU3RyaW5nOiBTdHJpbmckMSwKICAgIFN0eWxlU2hlZXQsCiAgICBUeXBlU2VsZWN0b3IsCiAgICBVbmljb2RlUmFuZ2UsCiAgICBVcmwsCiAgICBWYWx1ZSwKICAgIFdoaXRlU3BhY2UKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCBsZXhlckNvbmZpZyA9IHsKICAgIGdlbmVyaWM6IHRydWUsCiAgICAuLi5kZWZpbml0aW9ucywKICAgIG5vZGU6IG5vZGUkMQp9OwoKY29uc3QgTlVNQkVSU0lHTiQxID0gMHgwMDIzOyAgLy8gVSswMDIzIE5VTUJFUiBTSUdOICgjKQpjb25zdCBBU1RFUklTSyQxID0gMHgwMDJBOyAgICAvLyBVKzAwMkEgQVNURVJJU0sgKCopCmNvbnN0IFBMVVNTSUdOJDEgPSAweDAwMkI7ICAgIC8vIFUrMDAyQiBQTFVTIFNJR04gKCspCmNvbnN0IEhZUEhFTk1JTlVTID0gMHgwMDJEOyAvLyBVKzAwMkQgSFlQSEVOLU1JTlVTICgtKQpjb25zdCBTT0xJRFVTJDEgPSAweDAwMkY7ICAgICAvLyBVKzAwMkYgU09MSURVUyAoLykKY29uc3QgVSA9IDB4MDA3NTsgICAgICAgICAgIC8vIFUrMDA3NSBMQVRJTiBTTUFMTCBMRVRURVIgVSAodSkKCmZ1bmN0aW9uIGRlZmF1bHRSZWNvZ25pemVyKGNvbnRleHQpIHsKICAgIHN3aXRjaCAodGhpcy50b2tlblR5cGUpIHsKICAgICAgICBjYXNlIEhhc2gkMToKICAgICAgICAgICAgcmV0dXJuIHRoaXMuSGFzaCgpOwoKICAgICAgICBjYXNlIENvbW1hOgogICAgICAgICAgICByZXR1cm4gdGhpcy5PcGVyYXRvcigpOwoKICAgICAgICBjYXNlIExlZnRQYXJlbnRoZXNpczoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuUGFyZW50aGVzZXModGhpcy5yZWFkU2VxdWVuY2UsIGNvbnRleHQucmVjb2duaXplcik7CgogICAgICAgIGNhc2UgTGVmdFNxdWFyZUJyYWNrZXQ6CiAgICAgICAgICAgIHJldHVybiB0aGlzLkJyYWNrZXRzKHRoaXMucmVhZFNlcXVlbmNlLCBjb250ZXh0LnJlY29nbml6ZXIpOwoKICAgICAgICBjYXNlIFN0cmluZyQyOgogICAgICAgICAgICByZXR1cm4gdGhpcy5TdHJpbmcoKTsKCiAgICAgICAgY2FzZSBEaW1lbnNpb24kMToKICAgICAgICAgICAgcmV0dXJuIHRoaXMuRGltZW5zaW9uKCk7CgogICAgICAgIGNhc2UgUGVyY2VudGFnZSQxOgogICAgICAgICAgICByZXR1cm4gdGhpcy5QZXJjZW50YWdlKCk7CgogICAgICAgIGNhc2UgTnVtYmVyJDI6CiAgICAgICAgICAgIHJldHVybiB0aGlzLk51bWJlcigpOwoKICAgICAgICBjYXNlIEZ1bmN0aW9uJDI6CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNtcFN0cih0aGlzLnRva2VuU3RhcnQsIHRoaXMudG9rZW5FbmQsICd1cmwoJykKICAgICAgICAgICAgICAgID8gdGhpcy5VcmwoKQogICAgICAgICAgICAgICAgOiB0aGlzLkZ1bmN0aW9uKHRoaXMucmVhZFNlcXVlbmNlLCBjb250ZXh0LnJlY29nbml6ZXIpOwoKICAgICAgICBjYXNlIFVybCQxOgogICAgICAgICAgICByZXR1cm4gdGhpcy5VcmwoKTsKCiAgICAgICAgY2FzZSBJZGVudDoKICAgICAgICAgICAgLy8gY2hlY2sgZm9yIHVuaWNvZGUgcmFuZ2UsIGl0IHNob3VsZCBzdGFydCB3aXRoIHUrIG9yIFUrCiAgICAgICAgICAgIGlmICh0aGlzLmNtcENoYXIodGhpcy50b2tlblN0YXJ0LCBVKSAmJgogICAgICAgICAgICAgICAgdGhpcy5jbXBDaGFyKHRoaXMudG9rZW5TdGFydCArIDEsIFBMVVNTSUdOJDEpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5Vbmljb2RlUmFuZ2UoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLklkZW50aWZpZXIoKTsKICAgICAgICAgICAgfQoKICAgICAgICBjYXNlIERlbGltOiB7CiAgICAgICAgICAgIGNvbnN0IGNvZGUgPSB0aGlzLmNoYXJDb2RlQXQodGhpcy50b2tlblN0YXJ0KTsKCiAgICAgICAgICAgIGlmIChjb2RlID09PSBTT0xJRFVTJDEgfHwKICAgICAgICAgICAgICAgIGNvZGUgPT09IEFTVEVSSVNLJDEgfHwKICAgICAgICAgICAgICAgIGNvZGUgPT09IFBMVVNTSUdOJDEgfHwKICAgICAgICAgICAgICAgIGNvZGUgPT09IEhZUEhFTk1JTlVTKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5PcGVyYXRvcigpOyAvLyBUT0RPOiByZXBsYWNlIHdpdGggRGVsaW0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVE9ETzogcHJvZHVjZSBhIG5vZGUgd2l0aCBEZWxpbSBub2RlIHR5cGUKCiAgICAgICAgICAgIGlmIChjb2RlID09PSBOVU1CRVJTSUdOJDEpIHsKICAgICAgICAgICAgICAgIHRoaXMuZXJyb3IoJ0hleCBvciBpZGVudGlmaWVyIGlzIGV4cGVjdGVkJywgdGhpcy50b2tlblN0YXJ0ICsgMSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KfQoKY29uc3QgYXRydWxlUHJlbHVkZSA9IHsKICAgIGdldE5vZGU6IGRlZmF1bHRSZWNvZ25pemVyCn07Cgpjb25zdCBOVU1CRVJTSUdOID0gMHgwMDIzOyAgICAgIC8vIFUrMDAyMyBOVU1CRVIgU0lHTiAoIykKY29uc3QgQU1QRVJTQU5EID0gMHgwMDI2OyAgICAgICAvLyBVKzAwMjYgQU1QRVJTQU5EICgmKQpjb25zdCBBU1RFUklTSyA9IDB4MDAyQTsgICAgICAgIC8vIFUrMDAyQSBBU1RFUklTSyAoKikKY29uc3QgUExVU1NJR04gPSAweDAwMkI7ICAgICAgICAvLyBVKzAwMkIgUExVUyBTSUdOICgrKQpjb25zdCBTT0xJRFVTID0gMHgwMDJGOyAgICAgICAgIC8vIFUrMDAyRiBTT0xJRFVTICgvKQpjb25zdCBGVUxMU1RPUCA9IDB4MDAyRTsgICAgICAgIC8vIFUrMDAyRSBGVUxMIFNUT1AgKC4pCmNvbnN0IEdSRUFURVJUSEFOU0lHTiA9IDB4MDAzRTsgLy8gVSswMDNFIEdSRUFURVItVEhBTiBTSUdOICg+KQpjb25zdCBWRVJUSUNBTExJTkUgPSAweDAwN0M7ICAgIC8vIFUrMDA3QyBWRVJUSUNBTCBMSU5FICh8KQpjb25zdCBUSUxERSA9IDB4MDA3RTsgICAgICAgICAgIC8vIFUrMDA3RSBUSUxERSAofikKCmZ1bmN0aW9uIG9uV2hpdGVTcGFjZShuZXh0LCBjaGlsZHJlbikgewogICAgaWYgKGNoaWxkcmVuLmxhc3QgIT09IG51bGwgJiYgY2hpbGRyZW4ubGFzdC50eXBlICE9PSAnQ29tYmluYXRvcicgJiYKICAgICAgICBuZXh0ICE9PSBudWxsICYmIG5leHQudHlwZSAhPT0gJ0NvbWJpbmF0b3InKSB7CiAgICAgICAgY2hpbGRyZW4ucHVzaCh7ICAvLyBGSVhNRTogdGhpcy5Db21iaW5hdG9yKCkgc2hvdWxkIGJlIHVzZWQgaW5zdGVhZAogICAgICAgICAgICB0eXBlOiAnQ29tYmluYXRvcicsCiAgICAgICAgICAgIGxvYzogbnVsbCwKICAgICAgICAgICAgbmFtZTogJyAnCiAgICAgICAgfSk7CiAgICB9Cn0KCmZ1bmN0aW9uIGdldE5vZGUoKSB7CiAgICBzd2l0Y2ggKHRoaXMudG9rZW5UeXBlKSB7CiAgICAgICAgY2FzZSBMZWZ0U3F1YXJlQnJhY2tldDoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuQXR0cmlidXRlU2VsZWN0b3IoKTsKCiAgICAgICAgY2FzZSBIYXNoJDE6CiAgICAgICAgICAgIHJldHVybiB0aGlzLklkU2VsZWN0b3IoKTsKCiAgICAgICAgY2FzZSBDb2xvbjoKICAgICAgICAgICAgaWYgKHRoaXMubG9va3VwVHlwZSgxKSA9PT0gQ29sb24pIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLlBzZXVkb0VsZW1lbnRTZWxlY3RvcigpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuUHNldWRvQ2xhc3NTZWxlY3RvcigpOwogICAgICAgICAgICB9CgogICAgICAgIGNhc2UgSWRlbnQ6CiAgICAgICAgICAgIHJldHVybiB0aGlzLlR5cGVTZWxlY3RvcigpOwoKICAgICAgICBjYXNlIE51bWJlciQyOgogICAgICAgIGNhc2UgUGVyY2VudGFnZSQxOgogICAgICAgICAgICByZXR1cm4gdGhpcy5QZXJjZW50YWdlKCk7CgogICAgICAgIGNhc2UgRGltZW5zaW9uJDE6CiAgICAgICAgICAgIC8vIHRocm93cyB3aGVuIC4xMjNpZGVudAogICAgICAgICAgICBpZiAodGhpcy5jaGFyQ29kZUF0KHRoaXMudG9rZW5TdGFydCkgPT09IEZVTExTVE9QKSB7CiAgICAgICAgICAgICAgICB0aGlzLmVycm9yKCdJZGVudGlmaWVyIGlzIGV4cGVjdGVkJywgdGhpcy50b2tlblN0YXJ0ICsgMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgRGVsaW06IHsKICAgICAgICAgICAgY29uc3QgY29kZSA9IHRoaXMuY2hhckNvZGVBdCh0aGlzLnRva2VuU3RhcnQpOwoKICAgICAgICAgICAgc3dpdGNoIChjb2RlKSB7CiAgICAgICAgICAgICAgICBjYXNlIFBMVVNTSUdOOgogICAgICAgICAgICAgICAgY2FzZSBHUkVBVEVSVEhBTlNJR046CiAgICAgICAgICAgICAgICBjYXNlIFRJTERFOgogICAgICAgICAgICAgICAgY2FzZSBTT0xJRFVTOiAgLy8gL2RlZXAvCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuQ29tYmluYXRvcigpOwoKICAgICAgICAgICAgICAgIGNhc2UgRlVMTFNUT1A6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuQ2xhc3NTZWxlY3RvcigpOwoKICAgICAgICAgICAgICAgIGNhc2UgQVNURVJJU0s6CiAgICAgICAgICAgICAgICBjYXNlIFZFUlRJQ0FMTElORToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5UeXBlU2VsZWN0b3IoKTsKCiAgICAgICAgICAgICAgICBjYXNlIE5VTUJFUlNJR046CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuSWRTZWxlY3RvcigpOwoKICAgICAgICAgICAgICAgIGNhc2UgQU1QRVJTQU5EOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLk5lc3RpbmdTZWxlY3RvcigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9Cn0KY29uc3Qgc2VsZWN0b3IkMSA9IHsKICAgIG9uV2hpdGVTcGFjZSwKICAgIGdldE5vZGUKfTsKCi8vIGxlZ2FjeSBJRSBmdW5jdGlvbgovLyBleHByZXNzaW9uKCA8YW55LXZhbHVlPiApCmZ1bmN0aW9uIGV4cHJlc3Npb25GbigpIHsKICAgIHJldHVybiB0aGlzLmNyZWF0ZVNpbmdsZU5vZGVMaXN0KAogICAgICAgIHRoaXMuUmF3KHRoaXMudG9rZW5JbmRleCwgbnVsbCwgZmFsc2UpCiAgICApOwp9CgovLyB2YXIoIDxpZGVudD4gLCA8dmFsdWU+PyApCmZ1bmN0aW9uIHZhckZuKCkgewogICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNyZWF0ZUxpc3QoKTsKCiAgICB0aGlzLnNraXBTQygpOwoKICAgIC8vIE5PVEU6IERvbid0IGNoZWNrIG1vcmUgdGhhbiBhIGZpcnN0IGFyZ3VtZW50IGlzIGFuIGlkZW50LCByZXN0IGNoZWNrcyBhcmUgZm9yIGxleGVyCiAgICBjaGlsZHJlbi5wdXNoKHRoaXMuSWRlbnRpZmllcigpKTsKCiAgICB0aGlzLnNraXBTQygpOwoKICAgIGlmICh0aGlzLnRva2VuVHlwZSA9PT0gQ29tbWEpIHsKICAgICAgICBjaGlsZHJlbi5wdXNoKHRoaXMuT3BlcmF0b3IoKSk7CgogICAgICAgIGNvbnN0IHN0YXJ0SW5kZXggPSB0aGlzLnRva2VuSW5kZXg7CiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLnBhcnNlQ3VzdG9tUHJvcGVydHkKICAgICAgICAgICAgPyB0aGlzLlZhbHVlKG51bGwpCiAgICAgICAgICAgIDogdGhpcy5SYXcodGhpcy50b2tlbkluZGV4LCB0aGlzLmNvbnN1bWVVbnRpbEV4Y2xhbWF0aW9uTWFya09yU2VtaWNvbG9uLCBmYWxzZSk7CgogICAgICAgIGlmICh2YWx1ZS50eXBlID09PSAnVmFsdWUnICYmIHZhbHVlLmNoaWxkcmVuLmlzRW1wdHkpIHsKICAgICAgICAgICAgZm9yIChsZXQgb2Zmc2V0ID0gc3RhcnRJbmRleCAtIHRoaXMudG9rZW5JbmRleDsgb2Zmc2V0IDw9IDA7IG9mZnNldCsrKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5sb29rdXBUeXBlKG9mZnNldCkgPT09IFdoaXRlU3BhY2UkMSkgewogICAgICAgICAgICAgICAgICAgIHZhbHVlLmNoaWxkcmVuLmFwcGVuZERhdGEoewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnV2hpdGVTcGFjZScsCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYzogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICcgJwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBjaGlsZHJlbi5wdXNoKHZhbHVlKTsKICAgIH0KCiAgICByZXR1cm4gY2hpbGRyZW47Cn0KCmZ1bmN0aW9uIGlzUGx1c01pbnVzT3BlcmF0b3Iobm9kZSkgewogICAgcmV0dXJuICgKICAgICAgICBub2RlICE9PSBudWxsICYmCiAgICAgICAgbm9kZS50eXBlID09PSAnT3BlcmF0b3InICYmCiAgICAgICAgKG5vZGUudmFsdWVbbm9kZS52YWx1ZS5sZW5ndGggLSAxXSA9PT0gJy0nIHx8IG5vZGUudmFsdWVbbm9kZS52YWx1ZS5sZW5ndGggLSAxXSA9PT0gJysnKQogICAgKTsKfQoKY29uc3QgdmFsdWUgPSB7CiAgICBnZXROb2RlOiBkZWZhdWx0UmVjb2duaXplciwKICAgIG9uV2hpdGVTcGFjZShuZXh0LCBjaGlsZHJlbikgewogICAgICAgIGlmIChpc1BsdXNNaW51c09wZXJhdG9yKG5leHQpKSB7CiAgICAgICAgICAgIG5leHQudmFsdWUgPSAnICcgKyBuZXh0LnZhbHVlOwogICAgICAgIH0KICAgICAgICBpZiAoaXNQbHVzTWludXNPcGVyYXRvcihjaGlsZHJlbi5sYXN0KSkgewogICAgICAgICAgICBjaGlsZHJlbi5sYXN0LnZhbHVlICs9ICcgJzsKICAgICAgICB9CiAgICB9LAogICAgJ2V4cHJlc3Npb24nOiBleHByZXNzaW9uRm4sCiAgICAndmFyJzogdmFyRm4KfTsKCmNvbnN0IHNjb3BlID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoLyojX19QVVJFX18qL09iamVjdC5kZWZpbmVQcm9wZXJ0eSh7CiAgICBfX3Byb3RvX186IG51bGwsCiAgICBBdHJ1bGVQcmVsdWRlOiBhdHJ1bGVQcmVsdWRlLAogICAgU2VsZWN0b3I6IHNlbGVjdG9yJDEsCiAgICBWYWx1ZTogdmFsdWUKfSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KSk7Cgpjb25zdCBmb250RmFjZSA9IHsKICAgIHBhcnNlOiB7CiAgICAgICAgcHJlbHVkZTogbnVsbCwKICAgICAgICBibG9jaygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuQmxvY2sodHJ1ZSk7CiAgICAgICAgfQogICAgfQp9OwoKY29uc3QgaW1wb3J0QXRydWxlID0gewogICAgcGFyc2U6IHsKICAgICAgICBwcmVsdWRlKCkgewogICAgICAgICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuY3JlYXRlTGlzdCgpOwoKICAgICAgICAgICAgdGhpcy5za2lwU0MoKTsKCiAgICAgICAgICAgIHN3aXRjaCAodGhpcy50b2tlblR5cGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgU3RyaW5nJDI6CiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW4ucHVzaCh0aGlzLlN0cmluZygpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlIFVybCQxOgogICAgICAgICAgICAgICAgY2FzZSBGdW5jdGlvbiQyOgogICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuLnB1c2godGhpcy5VcmwoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9yKCdTdHJpbmcgb3IgdXJsKCkgaXMgZXhwZWN0ZWQnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMubG9va3VwTm9uV1NUeXBlKDApID09PSBJZGVudCB8fAogICAgICAgICAgICAgICAgdGhpcy5sb29rdXBOb25XU1R5cGUoMCkgPT09IExlZnRQYXJlbnRoZXNpcykgewogICAgICAgICAgICAgICAgY2hpbGRyZW4ucHVzaCh0aGlzLk1lZGlhUXVlcnlMaXN0KCkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gY2hpbGRyZW47CiAgICAgICAgfSwKICAgICAgICBibG9jazogbnVsbAogICAgfQp9OwoKY29uc3QgbWVkaWEgPSB7CiAgICBwYXJzZTogewogICAgICAgIHByZWx1ZGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVNpbmdsZU5vZGVMaXN0KAogICAgICAgICAgICAgICAgdGhpcy5NZWRpYVF1ZXJ5TGlzdCgpCiAgICAgICAgICAgICk7CiAgICAgICAgfSwKICAgICAgICBibG9jayhpc1N0eWxlQmxvY2sgPSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5CbG9jayhpc1N0eWxlQmxvY2spOwogICAgICAgIH0KICAgIH0KfTsKCmNvbnN0IG5lc3QgPSB7CiAgICBwYXJzZTogewogICAgICAgIHByZWx1ZGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVNpbmdsZU5vZGVMaXN0KAogICAgICAgICAgICAgICAgdGhpcy5TZWxlY3Rvckxpc3QoKQogICAgICAgICAgICApOwogICAgICAgIH0sCiAgICAgICAgYmxvY2soKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkJsb2NrKHRydWUpOwogICAgICAgIH0KICAgIH0KfTsKCmNvbnN0IHBhZ2UgPSB7CiAgICBwYXJzZTogewogICAgICAgIHByZWx1ZGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVNpbmdsZU5vZGVMaXN0KAogICAgICAgICAgICAgICAgdGhpcy5TZWxlY3Rvckxpc3QoKQogICAgICAgICAgICApOwogICAgICAgIH0sCiAgICAgICAgYmxvY2soKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkJsb2NrKHRydWUpOwogICAgICAgIH0KICAgIH0KfTsKCmZ1bmN0aW9uIGNvbnN1bWVSYXcoKSB7CiAgICByZXR1cm4gdGhpcy5jcmVhdGVTaW5nbGVOb2RlTGlzdCgKICAgICAgICB0aGlzLlJhdyh0aGlzLnRva2VuSW5kZXgsIG51bGwsIGZhbHNlKQogICAgKTsKfQoKZnVuY3Rpb24gcGFyZW50aGVzZXMoKSB7CiAgICB0aGlzLnNraXBTQygpOwoKICAgIGlmICh0aGlzLnRva2VuVHlwZSA9PT0gSWRlbnQgJiYKICAgICAgICB0aGlzLmxvb2t1cE5vbldTVHlwZSgxKSA9PT0gQ29sb24pIHsKICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVTaW5nbGVOb2RlTGlzdCgKICAgICAgICAgICAgdGhpcy5EZWNsYXJhdGlvbigpCiAgICAgICAgKTsKICAgIH0KCiAgICByZXR1cm4gcmVhZFNlcXVlbmNlLmNhbGwodGhpcyk7Cn0KCmZ1bmN0aW9uIHJlYWRTZXF1ZW5jZSgpIHsKICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5jcmVhdGVMaXN0KCk7CiAgICBsZXQgY2hpbGQ7CgogICAgdGhpcy5za2lwU0MoKTsKCiAgICBzY2FuOgogICAgd2hpbGUgKCF0aGlzLmVvZikgewogICAgICAgIHN3aXRjaCAodGhpcy50b2tlblR5cGUpIHsKICAgICAgICAgICAgY2FzZSBDb21tZW50JDE6CiAgICAgICAgICAgIGNhc2UgV2hpdGVTcGFjZSQxOgogICAgICAgICAgICAgICAgdGhpcy5uZXh0KCk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAgIGNhc2UgRnVuY3Rpb24kMjoKICAgICAgICAgICAgICAgIGNoaWxkID0gdGhpcy5GdW5jdGlvbihjb25zdW1lUmF3LCB0aGlzLnNjb3BlLkF0cnVsZVByZWx1ZGUpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIElkZW50OgogICAgICAgICAgICAgICAgY2hpbGQgPSB0aGlzLklkZW50aWZpZXIoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBMZWZ0UGFyZW50aGVzaXM6CiAgICAgICAgICAgICAgICBjaGlsZCA9IHRoaXMuUGFyZW50aGVzZXMocGFyZW50aGVzZXMsIHRoaXMuc2NvcGUuQXRydWxlUHJlbHVkZSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBicmVhayBzY2FuOwogICAgICAgIH0KCiAgICAgICAgY2hpbGRyZW4ucHVzaChjaGlsZCk7CiAgICB9CgogICAgcmV0dXJuIGNoaWxkcmVuOwp9Cgpjb25zdCBzdXBwb3J0cyA9IHsKICAgIHBhcnNlOiB7CiAgICAgICAgcHJlbHVkZSgpIHsKICAgICAgICAgICAgY29uc3QgY2hpbGRyZW4gPSByZWFkU2VxdWVuY2UuY2FsbCh0aGlzKTsKCiAgICAgICAgICAgIGlmICh0aGlzLmdldEZpcnN0TGlzdE5vZGUoY2hpbGRyZW4pID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0aGlzLmVycm9yKCdDb25kaXRpb24gaXMgZXhwZWN0ZWQnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGNoaWxkcmVuOwogICAgICAgIH0sCiAgICAgICAgYmxvY2soaXNTdHlsZUJsb2NrID0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuQmxvY2soaXNTdHlsZUJsb2NrKTsKICAgICAgICB9CiAgICB9Cn07Cgpjb25zdCBhdHJ1bGUgPSB7CiAgICAnZm9udC1mYWNlJzogZm9udEZhY2UsCiAgICAnaW1wb3J0JzogaW1wb3J0QXRydWxlLAogICAgbWVkaWEsCiAgICBuZXN0LAogICAgcGFnZSwKICAgIHN1cHBvcnRzCn07Cgpjb25zdCBzZWxlY3Rvckxpc3QgPSB7CiAgICBwYXJzZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVTaW5nbGVOb2RlTGlzdCgKICAgICAgICAgICAgdGhpcy5TZWxlY3Rvckxpc3QoKQogICAgICAgICk7CiAgICB9Cn07Cgpjb25zdCBzZWxlY3RvciA9IHsKICAgIHBhcnNlKCkgewogICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVNpbmdsZU5vZGVMaXN0KAogICAgICAgICAgICB0aGlzLlNlbGVjdG9yKCkKICAgICAgICApOwogICAgfQp9OwoKY29uc3QgaWRlbnRMaXN0ID0gewogICAgcGFyc2UoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlU2luZ2xlTm9kZUxpc3QoCiAgICAgICAgICAgIHRoaXMuSWRlbnRpZmllcigpCiAgICAgICAgKTsKICAgIH0KfTsKCmNvbnN0IG50aCA9IHsKICAgIHBhcnNlKCkgewogICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVNpbmdsZU5vZGVMaXN0KAogICAgICAgICAgICB0aGlzLk50aCgpCiAgICAgICAgKTsKICAgIH0KfTsKCmNvbnN0IHBzZXVkbyA9IHsKICAgICdkaXInOiBpZGVudExpc3QsCiAgICAnaGFzJzogc2VsZWN0b3JMaXN0LAogICAgJ2xhbmcnOiBpZGVudExpc3QsCiAgICAnbWF0Y2hlcyc6IHNlbGVjdG9yTGlzdCwKICAgICdpcyc6IHNlbGVjdG9yTGlzdCwKICAgICctbW96LWFueSc6IHNlbGVjdG9yTGlzdCwKICAgICctd2Via2l0LWFueSc6IHNlbGVjdG9yTGlzdCwKICAgICd3aGVyZSc6IHNlbGVjdG9yTGlzdCwKICAgICdub3QnOiBzZWxlY3Rvckxpc3QsCiAgICAnbnRoLWNoaWxkJzogbnRoLAogICAgJ250aC1sYXN0LWNoaWxkJzogbnRoLAogICAgJ250aC1sYXN0LW9mLXR5cGUnOiBudGgsCiAgICAnbnRoLW9mLXR5cGUnOiBudGgsCiAgICAnc2xvdHRlZCc6IHNlbGVjdG9yLAogICAgJ2hvc3QnOiBzZWxlY3RvciwKICAgICdob3N0LWNvbnRleHQnOiBzZWxlY3Rvcgp9OwoKY29uc3Qgbm9kZSA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKC8qI19fUFVSRV9fKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoewogICAgX19wcm90b19fOiBudWxsLAogICAgQW5QbHVzQjogcGFyc2UkRiwKICAgIEF0cnVsZTogcGFyc2UkRSwKICAgIEF0cnVsZVByZWx1ZGU6IHBhcnNlJEQsCiAgICBBdHRyaWJ1dGVTZWxlY3RvcjogcGFyc2UkQywKICAgIEJsb2NrOiBwYXJzZSRCLAogICAgQnJhY2tldHM6IHBhcnNlJEEsCiAgICBDREM6IHBhcnNlJHosCiAgICBDRE86IHBhcnNlJHksCiAgICBDbGFzc1NlbGVjdG9yOiBwYXJzZSR4LAogICAgQ29tYmluYXRvcjogcGFyc2UkdywKICAgIENvbW1lbnQ6IHBhcnNlJHYsCiAgICBEZWNsYXJhdGlvbjogcGFyc2UkdSwKICAgIERlY2xhcmF0aW9uTGlzdDogcGFyc2UkdCwKICAgIERpbWVuc2lvbjogcGFyc2UkcywKICAgIEZ1bmN0aW9uOiBwYXJzZSRyLAogICAgSGFzaDogcGFyc2UkcSwKICAgIElkU2VsZWN0b3I6IHBhcnNlJG8sCiAgICBJZGVudGlmaWVyOiBwYXJzZSRwLAogICAgTWVkaWFGZWF0dXJlOiBwYXJzZSRuLAogICAgTWVkaWFRdWVyeTogcGFyc2UkbSwKICAgIE1lZGlhUXVlcnlMaXN0OiBwYXJzZSRsLAogICAgTmVzdGluZ1NlbGVjdG9yOiBwYXJzZSRrLAogICAgTnRoOiBwYXJzZSRqLAogICAgTnVtYmVyOiBwYXJzZSRpLAogICAgT3BlcmF0b3I6IHBhcnNlJGgsCiAgICBQYXJlbnRoZXNlczogcGFyc2UkZywKICAgIFBlcmNlbnRhZ2U6IHBhcnNlJGYsCiAgICBQc2V1ZG9DbGFzc1NlbGVjdG9yOiBwYXJzZSRlLAogICAgUHNldWRvRWxlbWVudFNlbGVjdG9yOiBwYXJzZSRkLAogICAgUmF0aW86IHBhcnNlJGMsCiAgICBSYXc6IHBhcnNlJGIsCiAgICBSdWxlOiBwYXJzZSRhLAogICAgU2VsZWN0b3I6IHBhcnNlJDksCiAgICBTZWxlY3Rvckxpc3Q6IHBhcnNlJDgsCiAgICBTdHJpbmc6IHBhcnNlJDcsCiAgICBTdHlsZVNoZWV0OiBwYXJzZSQ2LAogICAgVHlwZVNlbGVjdG9yOiBwYXJzZSQ1LAogICAgVW5pY29kZVJhbmdlOiBwYXJzZSQ0LAogICAgVXJsOiBwYXJzZSQzLAogICAgVmFsdWU6IHBhcnNlJDIsCiAgICBXaGl0ZVNwYWNlOiBwYXJzZSQxCn0sIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSkpOwoKY29uc3QgcGFyc2VyQ29uZmlnID0gewogICAgcGFyc2VDb250ZXh0OiB7CiAgICAgICAgZGVmYXVsdDogJ1N0eWxlU2hlZXQnLAogICAgICAgIHN0eWxlc2hlZXQ6ICdTdHlsZVNoZWV0JywKICAgICAgICBhdHJ1bGU6ICdBdHJ1bGUnLAogICAgICAgIGF0cnVsZVByZWx1ZGUob3B0aW9ucykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5BdHJ1bGVQcmVsdWRlKG9wdGlvbnMuYXRydWxlID8gU3RyaW5nKG9wdGlvbnMuYXRydWxlKSA6IG51bGwpOwogICAgICAgIH0sCiAgICAgICAgbWVkaWFRdWVyeUxpc3Q6ICdNZWRpYVF1ZXJ5TGlzdCcsCiAgICAgICAgbWVkaWFRdWVyeTogJ01lZGlhUXVlcnknLAogICAgICAgIHJ1bGU6ICdSdWxlJywKICAgICAgICBzZWxlY3Rvckxpc3Q6ICdTZWxlY3Rvckxpc3QnLAogICAgICAgIHNlbGVjdG9yOiAnU2VsZWN0b3InLAogICAgICAgIGJsb2NrKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5CbG9jayh0cnVlKTsKICAgICAgICB9LAogICAgICAgIGRlY2xhcmF0aW9uTGlzdDogJ0RlY2xhcmF0aW9uTGlzdCcsCiAgICAgICAgZGVjbGFyYXRpb246ICdEZWNsYXJhdGlvbicsCiAgICAgICAgdmFsdWU6ICdWYWx1ZScKICAgIH0sCiAgICBzY29wZSwKICAgIGF0cnVsZSwKICAgIHBzZXVkbywKICAgIG5vZGUKfTsKCmNvbnN0IHdhbGtlckNvbmZpZyA9IHsKICAgIG5vZGU6IG5vZGUkMQp9OwoKY29uc3Qgc3ludGF4ID0gY3JlYXRlU3ludGF4JDEoewogICAgLi4ubGV4ZXJDb25maWcsCiAgICAuLi5wYXJzZXJDb25maWcsCiAgICAuLi53YWxrZXJDb25maWcKfSk7Cgpjb25zdCB7CiAgICB0b2tlbml6ZSwKICAgIHBhcnNlLAogICAgZ2VuZXJhdGUsCiAgICBsZXhlciwKICAgIGNyZWF0ZUxleGVyLAoKICAgIHdhbGssCiAgICBmaW5kLAogICAgZmluZExhc3QsCiAgICBmaW5kQWxsLAoKICAgIHRvUGxhaW5PYmplY3QsCiAgICBmcm9tUGxhaW5PYmplY3QsCgogICAgZm9yawp9ID0gc3ludGF4OwoKYXN5bmMgZnVuY3Rpb24gZmxhdHRlbkNTUyhzY3JpcHQsIHdpbikgewogIGNvbnN0IHRyZWUgPSBwYXJzZShzY3JpcHQsIHsgcG9zaXRpb25zOiB0cnVlIH0pOwogIGNvbnN0IGFzc2V0cyA9IFtdOwogIHdhbGsodHJlZSwgZnVuY3Rpb24obm9kZSkgewogICAgaWYgKG5vZGUudHlwZSA9PT0gIlVybCIgJiYgdGhpcy5hdHJ1bGU/Lm5hbWUgPT09ICJpbXBvcnQiKQogICAgICB0cnkgewogICAgICAgIGFzc2V0cy5wdXNoKFsKICAgICAgICAgIHRoaXMuYXRydWxlLmxvYywKICAgICAgICAgIG5ldyBVUkwobm9kZS52YWx1ZSwgd2luW3NMb2NhdGlvbl0pCiAgICAgICAgXSk7CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgfQogIH0pOwogIGxldCBvZmZzZXQgPSAwOwogIGZvciAoY29uc3QgYXNzZXQgb2YgYXNzZXRzKSB7CiAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KG5ldyBSZXF1ZXN0KGFzc2V0WzFdKSwgInN0eWxlIiwgd2luKTsKICAgIGNvbnN0IGdlbmVyYXRlZCA9IGF3YWl0IGZsYXR0ZW5DU1MoYXdhaXQgcmVzLnRleHQoKSwgd2luKTsKICAgIHNjcmlwdCA9IHNjcmlwdC5zbGljZSgwLCBhc3NldFswXS5zdGFydC5vZmZzZXQgLSBvZmZzZXQpICsgZ2VuZXJhdGVkICsgc2NyaXB0LnNsaWNlKGFzc2V0WzBdLmVuZC5vZmZzZXQgLSBvZmZzZXQpOwogICAgb2Zmc2V0ICs9IGFzc2V0WzBdLmVuZC5vZmZzZXQgLSBhc3NldFswXS5zdGFydC5vZmZzZXQgLSBnZW5lcmF0ZWQubGVuZ3RoOwogIH0KICByZXR1cm4gc2NyaXB0Owp9CmFzeW5jIGZ1bmN0aW9uKiByZXdyaXRlQ1NTKHNjcmlwdCwgY29udGV4dCwgd2luKSB7CiAgaWYgKGNvbnRleHQgPT09ICJzdHlsZXNoZWV0IikKICAgIHNjcmlwdCA9IGF3YWl0IGZsYXR0ZW5DU1Moc2NyaXB0LCB3aW4pOwogIGNvbnN0IHRyZWUgPSBwYXJzZShzY3JpcHQsIHsKICAgIHBvc2l0aW9uczogdHJ1ZSwKICAgIGNvbnRleHQKICB9KTsKICBjb25zdCBhc3NldHMgPSBbXTsKICB3YWxrKHRyZWUsIChub2RlKSA9PiB7CiAgICBpZiAobm9kZS50eXBlID09PSAiVXJsIikKICAgICAgdHJ5IHsKICAgICAgICBhc3NldHMucHVzaChbCiAgICAgICAgICBub2RlLmxvYywKICAgICAgICAgIG5ldyBVUkwobm9kZS52YWx1ZSwgd2luW3NMb2NhdGlvbl0pCiAgICAgICAgXSk7CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgfQogIH0pOwogIGxldCBvZmZzZXQgPSAwOwogIGZvciAoY29uc3QgYXNzZXQgb2YgYXNzZXRzKSB7CiAgICBjb25zdCBsZW5ndGggPSBhc3NldFswXS5lbmQub2Zmc2V0IC0gYXNzZXRbMF0uc3RhcnQub2Zmc2V0OwogICAgc2NyaXB0ID0gc2NyaXB0LnNsaWNlKDAsIGFzc2V0WzBdLnN0YXJ0Lm9mZnNldCAtIG9mZnNldCkgKyAvLyBlYXN5IGxvYWRpbmcgbGFjZWhvbGRlcgogICAgIiAiLnJlcGVhdChsZW5ndGgpICsgc2NyaXB0LnNsaWNlKGFzc2V0WzBdLmVuZC5vZmZzZXQgLSBvZmZzZXQpOwogIH0KICB5aWVsZCBzY3JpcHQ7CiAgZm9yIChjb25zdCBhc3NldCBvZiBhc3NldHMpIHsKICAgIGNvbnN0IGdlbmVyYXRlZCA9IGB1cmwoJHthd2FpdCBsb2NhbGl6ZVJlc291cmNlKGFzc2V0WzFdLCAiaW1hZ2UiLCB3aW4pfSlgOwogICAgc2NyaXB0ID0gc2NyaXB0LnNsaWNlKDAsIGFzc2V0WzBdLnN0YXJ0Lm9mZnNldCAtIG9mZnNldCkgKyBnZW5lcmF0ZWQgKyBzY3JpcHQuc2xpY2UoYXNzZXRbMF0uZW5kLm9mZnNldCAtIG9mZnNldCk7CiAgICBvZmZzZXQgKz0gYXNzZXRbMF0uZW5kLm9mZnNldCAtIGFzc2V0WzBdLnN0YXJ0Lm9mZnNldCAtIGdlbmVyYXRlZC5sZW5ndGg7CiAgICB5aWVsZCBzY3JpcHQ7CiAgfQogIHJldHVybiBzY3JpcHQ7Cn0KYXN5bmMgZnVuY3Rpb24gc2ltdWxhdGVTdHlsZShzY3JpcHQsIHdpbikgewogIGNvbnN0IHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3R5bGUiKTsKICBjb25zdCBpdCA9IHJld3JpdGVDU1Moc2NyaXB0LCAic3R5bGVzaGVldCIsIHdpbik7CiAgc3R5bGUudGV4dENvbnRlbnQgPSAoYXdhaXQgaXQubmV4dCgpKS52YWx1ZTsKICAoYXN5bmMgKCkgPT4gewogICAgZm9yIGF3YWl0IChjb25zdCB2YWx1ZSBvZiBpdCkKICAgICAgc3R5bGUudGV4dENvbnRlbnQgPSB2YWx1ZTsKICB9KSgpOwogIHJldHVybiBzdHlsZTsKfQphc3luYyBmdW5jdGlvbiBzaW11bGF0ZVN0eWxlTGluayhub2RlLCB3aW4pIHsKICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KG5ldyBSZXF1ZXN0KG5vZGUuaHJlZiksICJzdHlsZSIsIHdpbik7CiAgcmV0dXJuIGF3YWl0IHNpbXVsYXRlU3R5bGUoYXdhaXQgcmVzLnRleHQoKSwgd2luKTsKfQphc3luYyBmdW5jdGlvbiByZXdyaXRlU3R5bGUoc3R5bGUsIHdpbikgewogIGZvciAobGV0IGkgPSAwOyBpIDwgc3R5bGUubGVuZ3RoOyBpKyspIHsKICAgIGNvbnN0IG5hbWUgPSBzdHlsZVtpXTsKICAgIGNvbnN0IGl0ID0gcmV3cml0ZUNTUyhzdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKG5hbWUpLCAidmFsdWUiLCB3aW4pOwogICAgc3R5bGUuc2V0UHJvcGVydHkobmFtZSwgKGF3YWl0IGl0Lm5leHQoKSkudmFsdWUpOwogICAgKGFzeW5jICgpID0+IHsKICAgICAgZm9yIGF3YWl0IChjb25zdCB2YWx1ZSBvZiBpdCkKICAgICAgICBzdHlsZS5zZXRQcm9wZXJ0eShuYW1lLCB2YWx1ZSk7CiAgICB9KSgpOwogIH0KfQoKYXN5bmMgZnVuY3Rpb24gcmV3cml0ZVNyY3NldChzcmNzZXQsIHdpbikgewogIGNvbnN0IHBhcnNlZCA9IHBhcnNlU3Jjc2V0KHNyY3NldCk7CiAgY29uc3QgbmV3U3Jjc2V0ID0gW107CiAgZm9yIChjb25zdCBzcmMgb2YgcGFyc2VkKQogICAgbmV3U3Jjc2V0LnB1c2goewogICAgICB1cmw6IGF3YWl0IGxvY2FsaXplUmVzb3VyY2UoCiAgICAgICAgbmV3IFVSTChzcmMudXJsLCB3aW5bc0xvY2F0aW9uXSksCiAgICAgICAgImltYWdlIiwKICAgICAgICB3aW4KICAgICAgKSwKICAgICAgLi4uc3JjLmRlbnNpdHkgPyB7IGRlbnNpdHk6IHNyYy5kZW5zaXR5IH0gOiB7fSwKICAgICAgLi4uc3JjLndpZHRoID8geyB3aWR0aDogc3JjLndpZHRoIH0gOiB7fQogICAgfSk7CiAgcmV0dXJuIHN0cmluZ2lmeVNyY3NldChuZXdTcmNzZXQpOwp9CmZ1bmN0aW9uIHJld3JpdGVTVkcoc3ZnLCB3aW4pIHsKICBmb3IgKGNvbnN0IGltYWdlIG9mIHN2Zy5xdWVyeVNlbGVjdG9yQWxsKCJpbWFnZSIpKSB7CiAgICBjb25zdCBocmVmID0gaW1hZ2UuZ2V0QXR0cmlidXRlKCJ4bGluazpocmVmIik7CiAgICBpZiAoaHJlZikgewogICAgICBpbWFnZS5yZW1vdmVBdHRyaWJ1dGUoInhsaW5rOmhyZWYiKTsKICAgICAgbG9jYWxpemVSZXNvdXJjZShuZXcgVVJMKGhyZWYsIHdpbltzTG9jYXRpb25dKSwgImltYWdlIiwgd2luKS50aGVuKAogICAgICAgICh1cmwpID0+IGltYWdlLnNldEF0dHJpYnV0ZSgieGxpbms6aHJlZiIsIHVybCkKICAgICAgKTsKICAgIH0KICB9Cn0KYXN5bmMgZnVuY3Rpb24gcmV3cml0ZUVsZW1lbnQobm9kZSwgd2luLCBwdXNoU2NyaXB0LCBhbmNob3JDbGljaykgewogIHN3aXRjaCAobm9kZS50YWdOYW1lLnRvVXBwZXJDYXNlKCkpIHsKICAgIGNhc2UgIk5PU0NSSVBUIjoKICAgICAgewogICAgICAgIGNvbnN0IGZyYWdtZW50ID0gbmV3IERvY3VtZW50RnJhZ21lbnQoKTsKICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIG5vZGUuY2hpbGRyZW4pCiAgICAgICAgICBmcmFnbWVudC5hcHBlbmQoY2hpbGQpOwogICAgICAgIG5vZGUucmVwbGFjZVdpdGgoZnJhZ21lbnQpOwogICAgICB9CiAgICAgIGJyZWFrOwogICAgY2FzZSAiU0NSSVBUIjoKICAgICAgewogICAgICAgIGNvbnN0IHNjcmlwdCA9IG5vZGU7CiAgICAgICAgaWYgKHNjcmlwdC5zcmMpIHsKICAgICAgICAgIGNvbnN0IHsgc3JjIH0gPSBzY3JpcHQ7CiAgICAgICAgICBjb25zdCBzc3JjID0gYXdhaXQgcmVxdWVzdChuZXcgUmVxdWVzdChzcmMpLCAic2NyaXB0Iiwgd2luKTsKICAgICAgICAgIGF3YWl0IHB1c2hTY3JpcHQoc2NyaXB0LCBhd2FpdCBzc3JjLnRleHQoKSwgc3JjLnN1YnN0cmluZygwLCBzcmMubGFzdEluZGV4T2YoIi8iKSkpOwogICAgICAgIH0KICAgICAgICBpZiAoc2NyaXB0LmlubmVySFRNTC5sZW5ndGggPiAwKSB7CiAgICAgICAgICBhd2FpdCBwdXNoU2NyaXB0KHNjcmlwdCwgc2NyaXB0LmlubmVySFRNTCwgd2luW3NMb2NhdGlvbl0udG9TdHJpbmcoKSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGJyZWFrOwogICAgY2FzZSAiTUVUQSI6CiAgICAgIHsKICAgICAgICBjb25zdCBtZXRhID0gbm9kZTsKICAgICAgICBpZiAoIVsiZW5jb2RpbmciLCAiY29udGVudC10eXBlIl0uaW5jbHVkZXMobWV0YS5odHRwRXF1aXYpKQogICAgICAgICAgbWV0YS5yZW1vdmUoKTsKICAgICAgfQogICAgICBicmVhazsKICAgIGNhc2UgIkxJTksiOgogICAgICB7CiAgICAgICAgY29uc3QgbGluayA9IG5vZGU7CiAgICAgICAgc3dpdGNoIChsaW5rLnJlbCkgewogICAgICAgICAgY2FzZSAic3R5bGVzaGVldCI6IHsKICAgICAgICAgICAgbGluay5yZXBsYWNlV2l0aChhd2FpdCBzaW11bGF0ZVN0eWxlTGluayhsaW5rLCB3aW4pKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBjYXNlICJwcmVsb2FkIjogewogICAgICAgICAgICBsaW5rLnJlbW92ZSgpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgYnJlYWs7CiAgICBjYXNlICJTVFlMRSI6CiAgICAgIHsKICAgICAgICBub2RlLnJlcGxhY2VXaXRoKGF3YWl0IHNpbXVsYXRlU3R5bGUobm9kZS50ZXh0Q29udGVudCB8fCAiIiwgd2luKSk7CiAgICAgIH0KICAgICAgYnJlYWs7CiAgICBjYXNlICJJRlJBTUUiOgogICAgICB7CiAgICAgICAgY29uc3QgZnJhbWUgPSBub2RlOwogICAgICAgIGZyYW1lW3NJZnJhbWVTcmNdID0gZnJhbWUuc3JjOwogICAgICAgIGZyYW1lLnNyYyA9ICIiOwogICAgICAgIGZyYW1lLnJlbW92ZUF0dHJpYnV0ZSgic2FuZGJveCIpOwogICAgICAgIGZyYW1lLnJlbW92ZUF0dHJpYnV0ZSgiYWxsb3ciKTsKICAgICAgfQogICAgICBicmVhazsKICAgIGNhc2UgIkEiOgogICAgICB7CiAgICAgICAgY29uc3QgYW5jaG9yID0gbm9kZTsKICAgICAgICBpZiAoYW5jaG9yLnBpbmcpCiAgICAgICAgICBhbmNob3IucGluZyA9ICIiOwogICAgICAgIGFuY2hvci5hZGRFdmVudExpc3RlbmVyKAogICAgICAgICAgImNsaWNrIiwKICAgICAgICAgIChldmVudCkgPT4gYW5jaG9yQ2xpY2soZXZlbnQsIGFuY2hvciksCiAgICAgICAgICB7CiAgICAgICAgICAgIC8vIHByZXZlbnREZWZhdWx0IHN0b3BzIG1pZGRsZSBjbGlja2luZyB3aGVuIGNhcHR1cmUgaXMgc2V0IHRvIGZhbHNlCiAgICAgICAgICAgIGNhcHR1cmU6IGZhbHNlCiAgICAgICAgICB9CiAgICAgICAgKTsKICAgICAgfQogICAgICBicmVhazsKICAgIGNhc2UgIklNRyI6CiAgICAgIHsKICAgICAgICBjb25zdCBpbWcgPSBub2RlOwogICAgICAgIGlmIChpbWcuc3JjKSB7CiAgICAgICAgICBjb25zdCB7IHNyYyB9ID0gaW1nOwogICAgICAgICAgaW1nLnNyYyA9ICIiOwogICAgICAgICAgbG9jYWxpemVSZXNvdXJjZShzcmMsICJpbWFnZSIsIHdpbikudGhlbigodXJsKSA9PiBpbWcuc3JjID0gdXJsKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgYnJlYWs7CiAgICBjYXNlICJWSURFTyI6CiAgICAgIHsKICAgICAgICBjb25zdCB2aWRlbyA9IG5vZGU7CiAgICAgICAgaWYgKHZpZGVvLnBvc3RlcikgewogICAgICAgICAgY29uc3QgeyBwb3N0ZXIgfSA9IHZpZGVvOwogICAgICAgICAgbG9jYWxpemVSZXNvdXJjZShwb3N0ZXIsICJpbWFnZSIsIHdpbikudGhlbigKICAgICAgICAgICAgKHVybCkgPT4gdmlkZW8ucG9zdGVyID0gdXJsCiAgICAgICAgICApOwogICAgICAgICAgdmlkZW8ucG9zdGVyID0gIiI7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHNvdXJjZXMgPSBbLi4udmlkZW8ucXVlcnlTZWxlY3RvckFsbCgic291cmNlIildLm1hcCgoc291cmNlMikgPT4gKHsKICAgICAgICAgIHR5cGU6IHNvdXJjZTIudHlwZSwKICAgICAgICAgIHNyYzogc291cmNlMi5zcmMKICAgICAgICB9KSk7CiAgICAgICAgZm9yIChjb25zdCB0cmFjayBvZiB2aWRlby5xdWVyeVNlbGVjdG9yQWxsKCJ0cmFjayIpKQogICAgICAgICAgaWYgKHRyYWNrLnNyYykgewogICAgICAgICAgICBjb25zdCB7IHNyYyB9ID0gdHJhY2s7CiAgICAgICAgICAgIHRyYWNrLnNyYyA9ICIiOwogICAgICAgICAgICBsb2NhbGl6ZVJlc291cmNlKHNyYywgInRyYWNrIiwgd2luKS50aGVuKCh1cmwpID0+IHRyYWNrLnNyYyA9IHVybCk7CiAgICAgICAgICB9CiAgICAgICAgZm9yIChjb25zdCBzb3VyY2UyIG9mIHZpZGVvLnF1ZXJ5U2VsZWN0b3JBbGwoInNvdXJjZSIpKQogICAgICAgICAgc291cmNlMi5yZW1vdmUoKTsKICAgICAgICBjb25zdCBzb3VyY2UgPSBzb3VyY2VzLmZpbmQoCiAgICAgICAgICAoc291cmNlMikgPT4gTWVkaWFTb3VyY2UuaXNUeXBlU3VwcG9ydGVkKHNvdXJjZTIudHlwZSkKICAgICAgICApOwogICAgICAgIGlmICghc291cmNlKQogICAgICAgICAgYnJlYWs7CiAgICAgICAgcmVxdWVzdChuZXcgUmVxdWVzdChzb3VyY2Uuc3JjKSwgInZpZGVvIiwgd2luKS50aGVuKGFzeW5jIChyZXMpID0+IHsKICAgICAgICAgIGNvbnN0IGJsb2JVcmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGF3YWl0IHJlcy5ibG9iKCkpOwogICAgICAgICAgdmlkZW8uc3JjID0gYmxvYlVybDsKICAgICAgICAgIHdpbltzQmxvYlVybHNdLnB1c2goYmxvYlVybCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgYnJlYWs7CiAgICBjYXNlICJTVkciOgogICAgICB7CiAgICAgICAgY29uc3Qgc3ZnID0gbm9kZTsKICAgICAgICByZXdyaXRlU1ZHKHN2Zywgd2luKTsKICAgICAgfQogICAgICBicmVhazsKICB9CiAgaWYgKG5vZGUgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50IHx8IG5vZGUgaW5zdGFuY2VvZiBIVE1MU291cmNlRWxlbWVudCkgewogICAgaWYgKG5vZGUuc3Jjc2V0KSB7CiAgICAgIGNvbnN0IHsgc3Jjc2V0IH0gPSBub2RlOwogICAgICBub2RlLnNyY3NldCA9ICIiOwogICAgICByZXdyaXRlU3Jjc2V0KHNyY3NldCwgd2luKS50aGVuKChzcmNzZXQyKSA9PiBub2RlLnNyY3NldCA9IHNyY3NldDIpOwogICAgfQogIH0KICBpZiAobm9kZSBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSB7CiAgICBjb25zdCBlbG0gPSBub2RlOwogICAgaWYgKGVsbS5zdHlsZSkgewogICAgICBhd2FpdCByZXdyaXRlU3R5bGUobm9kZS5zdHlsZSwgd2luKTsKICAgIH0KICB9Cn0KCmNvbnN0IGhpc3RvcnlJZCA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpOwpjb25zdCBjb250ZW50SGlzdG9yeSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7CmZ1bmN0aW9uIGdldENvbnRlbnRIaXN0b3J5SWQoKSB7CiAgZm9yIChsZXQgaSA9IDA7IDsgaSsrKSB7CiAgICBjb25zdCBpZCA9IGBQb3J0YVByb3h5XyR7aGlzdG9yeUlkfV8ke2l9YDsKICAgIGlmICghY29udGVudEhpc3RvcnkuaGFzKGlkKSkKICAgICAgcmV0dXJuIGlkOwogIH0KfQp3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicG9wc3RhdGUiLCAoZXZlbnQpID0+IHsKICBjb25zdCBkYXRhID0gY29udGVudEhpc3RvcnkuZ2V0KGV2ZW50LnN0YXRlKTsKICBpZiAoZGF0YSkKICAgIG9wZW5XaW5kb3coZGF0YS5yZXEsICJfc2VsZiIsIGRhdGEud2luLCBkYXRhLmNsaWVudCwgZmFsc2UpOwp9KTsKYXN5bmMgZnVuY3Rpb24gZGVsZXRlV2luZG93KHdpbiwgZGVsZXRlSGlzdG9yeSA9IHRydWUpIHsKICBpZiAoZGVsZXRlSGlzdG9yeSkgewogICAgZm9yIChjb25zdCBba2V5LCB2YWxdIG9mIGNvbnRlbnRIaXN0b3J5KQogICAgICBpZiAodmFsLndpbiA9PT0gd2luKQogICAgICAgIGNvbnRlbnRIaXN0b3J5LmRlbGV0ZShrZXkpOwogIH0KICBpZiAoc0Fib3J0IGluIHdpbikKICAgIHdpbltzQWJvcnRdLmFib3J0KCk7CiAgaWYgKHNCbG9iVXJscyBpbiB3aW4pCiAgICBmb3IgKGNvbnN0IHVybCBvZiB3aW5bc0Jsb2JVcmxzXSkKICAgICAgVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpOwogIGlmIChzVGltZW91dHMgaW4gd2luKQogICAgZm9yIChjb25zdCB0aW1lb3V0IG9mIHdpbltzVGltZW91dHNdKQogICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7CiAgZm9yIChjb25zdCBpZnJhbWUgb2Ygd2luLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoImlmcmFtZSIpKQogICAgaWYgKGlmcmFtZS5jb250ZW50V2luZG93KQogICAgICBkZWxldGVXaW5kb3coaWZyYW1lLmNvbnRlbnRXaW5kb3cpOwp9CmFzeW5jIGZ1bmN0aW9uIG9wZW5XaW5kb3cocmVxLCB0YXJnZXQsIHdpbiwgY2xpZW50LCBzZXRIaXN0b3J5ID0gInB1c2giKSB7CiAgd2luLnNyYyA9ICIiOwogIGNvbnN0IG4gPSB3aW4ub3Blbih2b2lkIDAsIHRhcmdldCk7CiAgaWYgKCFuKQogICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoImZhaWx1cmUiKTsKICBkZWxldGVXaW5kb3cobiwgZmFsc2UpOwogIHNldFRpbWVvdXQoKCkgPT4gewogICAgaWYgKGhpc3RvcnkpIHsKICAgICAgY29uc3QgaWQgPSBnZXRDb250ZW50SGlzdG9yeUlkKCk7CiAgICAgIGNvbnRlbnRIaXN0b3J5LnNldChpZCwgewogICAgICAgIGNsaWVudCwKICAgICAgICByZXEsCiAgICAgICAgd2luOiBuCiAgICAgIH0pOwogICAgICBpZiAoc2V0SGlzdG9yeSA9PT0gInB1c2giKQogICAgICAgIGhpc3RvcnkucHVzaFN0YXRlKGlkLCAiIiwgdm9pZCAwKTsKICAgICAgZWxzZSBpZiAoc2V0SGlzdG9yeSA9PT0gInJlcGxhY2UiKQogICAgICAgIGhpc3RvcnkucmVwbGFjZVN0YXRlKGlkLCAiIiwgdm9pZCAwKTsKICAgIH0KICAgIGxvYWRET00ocmVxLCBuLCBjbGllbnQpOwogIH0sIDEwKTsKfQphc3luYyBmdW5jdGlvbiBsb2FkRE9NKHJlcSwgd2luLCBjbGllbnQpIHsKICBpZiAoIWNsaWVudCkKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoImJhZCBjbGllbnQiKTsKICB3aW5bc0Fib3J0XSA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICB3aW5bc0NsaWVudF0gPSBjbGllbnQ7CiAgd2luW3NCbG9iVXJsc10gPSBbXTsKICB3aW5bc1RpbWVvdXRzXSA9IFtdOwogIGNvbnN0IHNjcmlwdHMgPSBbXTsKICBjb25zdCBzY3JpcHRzRGVmZXJyZWQgPSBbXTsKICBjb25zdCBwdXNoU2NyaXB0ID0gYXN5bmMgKHNjcmlwdCwgY29kZSwgcmVsYXRpdmVQYXRoKSA9PiB7CiAgICBpZiAoc2NyaXB0LnR5cGUgIT09ICJtb2R1bGUiKSB7CiAgICAgIGlmIChzY3JpcHQuZGVmZXIpCiAgICAgICAgc2NyaXB0c0RlZmVycmVkLnB1c2gocmV3cml0ZShjb2RlKSk7CiAgICAgIGVsc2UKICAgICAgICBzY3JpcHRzLnB1c2gocmV3cml0ZShjb2RlKSk7CiAgICB9IGVsc2UgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHBhY2tlZCA9IGF3YWl0IHJld3JpdGVNb2R1bGUoY29kZSwgbmV3IFVSTChgJHtyZWxhdGl2ZVBhdGh9L2R1bW15LmpzYCksIHdpbik7CiAgICAgICAgaWYgKHNjcmlwdC5kZWZlcikKICAgICAgICAgIHNjcmlwdHNEZWZlcnJlZC5wdXNoKHJld3JpdGUocGFja2VkKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgc2NyaXB0cy5wdXNoKHJld3JpdGUocGFja2VkKSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGBwYWNrZXIgZmFpbGVkISAtICR7ZX1gKTsKICAgICAgfQogICAgfQogIH07CiAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdChyZXEsICJkb2N1bWVudCIsIHdpbik7CiAgd2luW3NMb2NhdGlvbl0gPSBuZXcgVVJMKHJlcy5maW5hbFVSTCk7CiAgY29uc3QgcHJvdG9Eb20gPSBuZXcgd2luLkRPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZygKICAgIGF3YWl0IHJlcy50ZXh0KCksCiAgICAidGV4dC9odG1sIgogICk7CiAgY29uc3QgYmFzZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJhc2UiKTsKICBiYXNlLmhyZWYgPSB3aW5bc0xvY2F0aW9uXS50b1N0cmluZygpOwogIHByb3RvRG9tLmhlYWQuYXBwZW5kKGJhc2UpOwogIHdpbi5kb2N1bWVudC5oZWFkLmFwcGVuZChiYXNlLmNsb25lTm9kZSgpKTsKICBmb3IgKGNvbnN0IGVsbSBvZiBwcm90b0RvbS5xdWVyeVNlbGVjdG9yQWxsKCIqIikpIHsKICAgIGF3YWl0IHJld3JpdGVFbGVtZW50KGVsbSwgd2luLCBwdXNoU2NyaXB0LCAoZXZlbnQsIG5vZGUpID0+IHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgY29uc3QgcHJvdG9jb2wgPSBuZXcgVVJMKG5vZGUuaHJlZikucHJvdG9jb2w7CiAgICAgIGlmIChwcm90b2NvbCA9PT0gImphdmFzY3JpcHQ6IikKICAgICAgICByZXR1cm47CiAgICAgIGxldCB3aW5UYXJnZXQgPSBldmVudC5zaGlmdEtleSA/ICJuZXciIDogZXZlbnQuY3RybEtleSB8fCBldmVudC5idXR0b24gPT09IDEgPyAiX2JsYW5rIiA6IG5vZGUudGFyZ2V0IHx8ICJfc2VsZiI7CiAgICAgIGlmICh3aW5UYXJnZXQgPT09ICJfdG9wIiAmJiB3aW4udG9wID09PSB3aW5kb3cgfHwgd2luVGFyZ2V0ID09PSAiX3BhcmVudCIgJiYgd2luLnBhcmVudCA9PT0gd2luZG93KQogICAgICAgIHdpblRhcmdldCA9ICJfc2VsZiI7CiAgICAgIGlmICghdmFsaWRQcm90b2NvbHMuaW5jbHVkZXMocHJvdG9jb2wpKQogICAgICAgIHJldHVybiB3aW4ub3Blbihub2RlLmhyZWYsIHdpblRhcmdldCk7CiAgICAgIG9wZW5XaW5kb3cobmV3IFJlcXVlc3Qobm9kZS5ocmVmKSwgd2luVGFyZ2V0LCB3aW4sIGNsaWVudCk7CiAgICB9KTsKICB9CiAgY29uc3QgcmVmcmVzaEhlYWRlciA9IHByb3RvRG9tLnF1ZXJ5U2VsZWN0b3IoIm1ldGFbaHR0cC1lcXVpdj0ncmVmcmVzaCddIik/LmNvbnRlbnQgfHwgcmVzLmhlYWRlcnMuZ2V0KCJyZWZyZXNoIik7CiAgaWYgKHJlZnJlc2hIZWFkZXIpIHsKICAgIGNvbnN0IHJlZnJlc2ggPSBwYXJzZVJlZnJlc2hIZWFkZXIocmVmcmVzaEhlYWRlciwgd2luKTsKICAgIGlmIChyZWZyZXNoKQogICAgICB3aW5bc1RpbWVvdXRzXS5wdXNoKAogICAgICAgIHNldFRpbWVvdXQoCiAgICAgICAgICAoKSA9PiBvcGVuV2luZG93KG5ldyBSZXF1ZXN0KHJlZnJlc2gudXJsKSwgIl9zZWxmIiwgd2luLCBjbGllbnQpLAogICAgICAgICAgcmVmcmVzaC5kdXJhdGlvbgogICAgICAgICkKICAgICAgKTsKICB9CiAgd2luLmRvY3VtZW50Lm9wZW4oKTsKICBob29rKHdpbi53aW5kb3cpOwogIGlmIChwcm90b0RvbS5kb2N0eXBlKQogICAgd2luLmRvY3VtZW50LndyaXRlKGA8IURPQ1RZUEUgJHtwcm90b0RvbS5kb2N0eXBlLm5hbWV9PmApOwogIHdpbi5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ/LnJlbW92ZSgpOwogIHdpbi5kb2N1bWVudC5hcHBlbmQocHJvdG9Eb20uZG9jdW1lbnRFbGVtZW50KTsKICB3aW5kb3dbInNjcnMiXSA9IHNjcmlwdHM7CiAgZm9yIChjb25zdCBjb2RlIG9mIHNjcmlwdHMpIHsKICAgIHRyeSB7CiAgICAgIGNvbnN0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOwogICAgICBzY3JpcHQudHlwZSA9ICJ0ZXh0L2phdmFzY3JpcHQiOwogICAgICBzY3JpcHQuaW5uZXJIVE1MID0gY29kZTsKICAgICAgd2luLmRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgIH0KICB9CiAgd2luLmRvY3VtZW50LmNsb3NlKCk7CiAgZm9yIChjb25zdCBjb2RlIG9mIHNjcmlwdHNEZWZlcnJlZCkgewogICAgdHJ5IHsKICAgICAgY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7CiAgICAgIHNjcmlwdC50eXBlID0gInRleHQvamF2YXNjcmlwdCI7CiAgICAgIHNjcmlwdC5pbm5lckhUTUwgPSBjb2RlOwogICAgICBzY3JpcHQuZGVmZXIgPSB0cnVlOwogICAgICB3aW4uZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpOwogICAgfSBjYXRjaCAoZSkgewogICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgfQogIH0KfQoKY29uc3QgUHJveHlfc3ZlbHRlX3N2ZWx0ZV90eXBlX3N0eWxlX2xhbmcgPSAnJzsKCi8qIHNyYy9Qcm94eS5zdmVsdGUgZ2VuZXJhdGVkIGJ5IFN2ZWx0ZSB2NC4yLjAgKi8KCi8vICg5MTo0KSA8RGlhbG9nIGJpbmQ6b3Blbj17c2V0dGluZ3NlbmFibGVkfSBoZWFkbGluZT0iUHJveHkgU2V0dGluZ3MiPgpmdW5jdGlvbiBjcmVhdGVfZGVmYXVsdF9zbG90JDEoY3R4KSB7CglsZXQgaWZfYmxvY2tfYW5jaG9yOwoJbGV0IGN1cnJlbnQ7CglsZXQgaWZfYmxvY2sgPSAhIjEiIDsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWlmX2Jsb2NrX2FuY2hvciA9IGVtcHR5KCk7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIGlmX2Jsb2NrX2FuY2hvciwgYW5jaG9yKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlwKGN0eCwgZGlydHkpIHsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihpZl9ibG9jayk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dChpZl9ibG9jayk7CgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChpZl9ibG9ja19hbmNob3IpOwoJCQl9CgkJfQoJfTsKfQoKZnVuY3Rpb24gY3JlYXRlX2ZyYWdtZW50JDEoY3R4KSB7CglsZXQgZGl2NDsKCWxldCBkaXYzOwoJbGV0IGRpdjI7CglsZXQgYnV0dG9uMDsKCWxldCBpY29uMDsKCWxldCB0MDsKCWxldCBkaXYwOwoJbGV0IHQxOwoJbGV0IGJ1dHRvbjE7CglsZXQgaWNvbjE7CglsZXQgdDI7CglsZXQgYnV0dG9uMjsKCWxldCBpY29uMjsKCWxldCB0MzsKCWxldCBkaXYxOwoJbGV0IGJ1dHRvbjM7CglsZXQgaWNvbjM7CglsZXQgdDQ7CglsZXQgaW5wdXQ7CglsZXQgdDU7CglsZXQgYnV0dG9uNDsKCWxldCBpY29uNDsKCWxldCB0NjsKCWxldCBkaWFsb2c7CglsZXQgdXBkYXRpbmdfb3BlbjsKCWxldCB0NzsKCWxldCBpZnJhbWU7CglsZXQgY3VycmVudDsKCWxldCBtb3VudGVkOwoJbGV0IGRpc3Bvc2U7CglpY29uMCA9IG5ldyBJY29uKHsgcHJvcHM6IHsgaWNvbjogImZsdWVudC1tZGwyOmJhY2siIH0gfSk7CglpY29uMSA9IG5ldyBJY29uKHsgcHJvcHM6IHsgaWNvbjogImZsdWVudC1tZGwyOmZvcndhcmQiIH0gfSk7CglpY29uMiA9IG5ldyBJY29uKHsgcHJvcHM6IHsgaWNvbjogInRhYmxlcjpyZWxvYWQiIH0gfSk7CglpY29uMyA9IG5ldyBJY29uKHsgcHJvcHM6IHsgaWNvbjogImljOnJvdW5kLXNlYXJjaCIgfSB9KTsKCWljb240ID0gbmV3IEljb24oeyBwcm9wczogeyBpY29uOiAiaWM6cm91bmQtc2V0dGluZ3MiIH0gfSk7CgoJZnVuY3Rpb24gZGlhbG9nX29wZW5fYmluZGluZyh2YWx1ZSkgewoJCS8qZGlhbG9nX29wZW5fYmluZGluZyovIGN0eFsxOF0odmFsdWUpOwoJfQoKCWxldCBkaWFsb2dfcHJvcHMgPSB7CgkJaGVhZGxpbmU6ICJQcm94eSBTZXR0aW5ncyIsCgkJJCRzbG90czogeyBkZWZhdWx0OiBbY3JlYXRlX2RlZmF1bHRfc2xvdCQxXSB9LAoJCSQkc2NvcGU6IHsgY3R4IH0KCX07CgoJaWYgKC8qc2V0dGluZ3NlbmFibGVkKi8gY3R4WzNdICE9PSB2b2lkIDApIHsKCQlkaWFsb2dfcHJvcHMub3BlbiA9IC8qc2V0dGluZ3NlbmFibGVkKi8gY3R4WzNdOwoJfQoKCWRpYWxvZyA9IG5ldyBEaWFsb2ckMSh7IHByb3BzOiBkaWFsb2dfcHJvcHMgfSk7CgliaW5kaW5nX2NhbGxiYWNrcy5wdXNoKCgpID0+IGJpbmQoZGlhbG9nLCAnb3BlbicsIGRpYWxvZ19vcGVuX2JpbmRpbmcpKTsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWRpdjQgPSBlbGVtZW50KCJkaXYiKTsKCQkJZGl2MyA9IGVsZW1lbnQoImRpdiIpOwoJCQlkaXYyID0gZWxlbWVudCgiZGl2Iik7CgkJCWJ1dHRvbjAgPSBlbGVtZW50KCJidXR0b24iKTsKCQkJY3JlYXRlX2NvbXBvbmVudChpY29uMC4kJC5mcmFnbWVudCk7CgkJCXQwID0gc3BhY2UoKTsKCQkJZGl2MCA9IGVsZW1lbnQoImRpdiIpOwoJCQl0MSA9IHNwYWNlKCk7CgkJCWJ1dHRvbjEgPSBlbGVtZW50KCJidXR0b24iKTsKCQkJY3JlYXRlX2NvbXBvbmVudChpY29uMS4kJC5mcmFnbWVudCk7CgkJCXQyID0gc3BhY2UoKTsKCQkJYnV0dG9uMiA9IGVsZW1lbnQoImJ1dHRvbiIpOwoJCQljcmVhdGVfY29tcG9uZW50KGljb24yLiQkLmZyYWdtZW50KTsKCQkJdDMgPSBzcGFjZSgpOwoJCQlkaXYxID0gZWxlbWVudCgiZGl2Iik7CgkJCWJ1dHRvbjMgPSBlbGVtZW50KCJidXR0b24iKTsKCQkJY3JlYXRlX2NvbXBvbmVudChpY29uMy4kJC5mcmFnbWVudCk7CgkJCXQ0ID0gc3BhY2UoKTsKCQkJaW5wdXQgPSBlbGVtZW50KCJpbnB1dCIpOwoJCQl0NSA9IHNwYWNlKCk7CgkJCWJ1dHRvbjQgPSBlbGVtZW50KCJidXR0b24iKTsKCQkJY3JlYXRlX2NvbXBvbmVudChpY29uNC4kJC5mcmFnbWVudCk7CgkJCXQ2ID0gc3BhY2UoKTsKCQkJY3JlYXRlX2NvbXBvbmVudChkaWFsb2cuJCQuZnJhZ21lbnQpOwoJCQl0NyA9IHNwYWNlKCk7CgkJCWlmcmFtZSA9IGVsZW1lbnQoImlmcmFtZSIpOwoJCQlhdHRyKGRpdjAsICJjbGFzcyIsICJwLTIiKTsKCQkJYXR0cihidXR0b24yLCAiY2xhc3MiLCAidGV4dC0yeGwgcHgtNCIpOwoJCQlhdHRyKGJ1dHRvbjMsICJjbGFzcyIsICJ0ZXh0LTJ4bCBweC0yIik7CgkJCWF0dHIoaW5wdXQsICJ0eXBlIiwgInRleHQiKTsKCQkJYXR0cihpbnB1dCwgImNsYXNzIiwgImZsZXgtMSBzdmVsdGUtMWNrMjAxeCIpOwoJCQlhdHRyKGRpdjEsICJjbGFzcyIsICJ1cmxiYXIgZmxleCBpdGVtcy1jZW50ZXIgZmxleC0xIHN2ZWx0ZS0xY2syMDF4Iik7CgkJCWF0dHIoYnV0dG9uNCwgImNsYXNzIiwgInRleHQtMnhsIHBsLTMiKTsKCQkJYXR0cihkaXYyLCAiY2xhc3MiLCAiZmxleCB0ZXh0LXhsIGl0ZW1zLWNlbnRlciB3LWZ1bGwiKTsKCQkJYXR0cihkaXYzLCAiY2xhc3MiLCAiZmxleCBwLTIiKTsKCQkJYXR0cihpZnJhbWUsICJjbGFzcyIsICJmbGV4LTEgc3ZlbHRlLTFjazIwMXgiKTsKCQkJYXR0cihkaXY0LCAiY2xhc3MiLCAiaC1mdWxsIHctZnVsbCBmbGV4IGZsZXgtY29sIik7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIGRpdjQsIGFuY2hvcik7CgkJCWFwcGVuZChkaXY0LCBkaXYzKTsKCQkJYXBwZW5kKGRpdjMsIGRpdjIpOwoJCQlhcHBlbmQoZGl2MiwgYnV0dG9uMCk7CgkJCW1vdW50X2NvbXBvbmVudChpY29uMCwgYnV0dG9uMCwgbnVsbCk7CgkJCWFwcGVuZChkaXYyLCB0MCk7CgkJCWFwcGVuZChkaXYyLCBkaXYwKTsKCQkJYXBwZW5kKGRpdjIsIHQxKTsKCQkJYXBwZW5kKGRpdjIsIGJ1dHRvbjEpOwoJCQltb3VudF9jb21wb25lbnQoaWNvbjEsIGJ1dHRvbjEsIG51bGwpOwoJCQlhcHBlbmQoZGl2MiwgdDIpOwoJCQlhcHBlbmQoZGl2MiwgYnV0dG9uMik7CgkJCW1vdW50X2NvbXBvbmVudChpY29uMiwgYnV0dG9uMiwgbnVsbCk7CgkJCWFwcGVuZChkaXYyLCB0Myk7CgkJCWFwcGVuZChkaXYyLCBkaXYxKTsKCQkJYXBwZW5kKGRpdjEsIGJ1dHRvbjMpOwoJCQltb3VudF9jb21wb25lbnQoaWNvbjMsIGJ1dHRvbjMsIG51bGwpOwoJCQlhcHBlbmQoZGl2MSwgdDQpOwoJCQlhcHBlbmQoZGl2MSwgaW5wdXQpOwoJCQlzZXRfaW5wdXRfdmFsdWUoaW5wdXQsIC8qdXJsKi8gY3R4WzFdKTsKCQkJYXBwZW5kKGRpdjIsIHQ1KTsKCQkJYXBwZW5kKGRpdjIsIGJ1dHRvbjQpOwoJCQltb3VudF9jb21wb25lbnQoaWNvbjQsIGJ1dHRvbjQsIG51bGwpOwoJCQlhcHBlbmQoZGl2MywgdDYpOwoJCQltb3VudF9jb21wb25lbnQoZGlhbG9nLCBkaXYzLCBudWxsKTsKCQkJYXBwZW5kKGRpdjQsIHQ3KTsKCQkJYXBwZW5kKGRpdjQsIGlmcmFtZSk7CgkJCS8qaWZyYW1lX2JpbmRpbmcqLyBjdHhbMTldKGlmcmFtZSk7CgkJCWN1cnJlbnQgPSB0cnVlOwoKCQkJaWYgKCFtb3VudGVkKSB7CgkJCQlkaXNwb3NlID0gWwoJCQkJCWxpc3RlbihidXR0b24wLCAiY2xpY2siLCAvKmNsaWNrX2hhbmRsZXIqLyBjdHhbN10pLAoJCQkJCWxpc3RlbihidXR0b24xLCAiY2xpY2siLCAvKmNsaWNrX2hhbmRsZXJfMSovIGN0eFs4XSksCgkJCQkJbGlzdGVuKGJ1dHRvbjIsICJjbGljayIsIC8qY2xpY2tfaGFuZGxlcl8yKi8gY3R4WzldKSwKCQkJCQlsaXN0ZW4oYnV0dG9uMywgImNsaWNrIiwgLypjbGlja19oYW5kbGVyXzMqLyBjdHhbMTBdKSwKCQkJCQlsaXN0ZW4oaW5wdXQsICJpbnB1dCIsIC8qaW5wdXRfaW5wdXRfaGFuZGxlciovIGN0eFsxMV0pLAoJCQkJCWxpc3RlbihpbnB1dCwgImtleWRvd24iLCAvKmtleWRvd25faGFuZGxlciovIGN0eFsxMl0pLAoJCQkJCWxpc3RlbihidXR0b240LCAiY2xpY2siLCAvKmNsaWNrX2hhbmRsZXJfNCovIGN0eFsxM10pLAoJCQkJCWxpc3RlbihpZnJhbWUsICJsb2FkIiwgLypmcmFtZUxvYWQqLyBjdHhbNV0pCgkJCQldOwoKCQkJCW1vdW50ZWQgPSB0cnVlOwoJCQl9CgkJfSwKCQlwKGN0eCwgW2RpcnR5XSkgewoJCQlpZiAoZGlydHkgJiAvKnVybCovIDIgJiYgaW5wdXQudmFsdWUgIT09IC8qdXJsKi8gY3R4WzFdKSB7CgkJCQlzZXRfaW5wdXRfdmFsdWUoaW5wdXQsIC8qdXJsKi8gY3R4WzFdKTsKCQkJfQoKCQkJY29uc3QgZGlhbG9nX2NoYW5nZXMgPSB7fTsKCgkJCWlmIChkaXJ0eSAmIC8qJCRzY29wZSwgc2VhcmNoZW5naW5lLCBzZWxlY3RlZFByb3h5Ki8gMTA0ODU5MykgewoJCQkJZGlhbG9nX2NoYW5nZXMuJCRzY29wZSA9IHsgZGlydHksIGN0eCB9OwoJCQl9CgoJCQlpZiAoIXVwZGF0aW5nX29wZW4gJiYgZGlydHkgJiAvKnNldHRpbmdzZW5hYmxlZCovIDgpIHsKCQkJCXVwZGF0aW5nX29wZW4gPSB0cnVlOwoJCQkJZGlhbG9nX2NoYW5nZXMub3BlbiA9IC8qc2V0dGluZ3NlbmFibGVkKi8gY3R4WzNdOwoJCQkJYWRkX2ZsdXNoX2NhbGxiYWNrKCgpID0+IHVwZGF0aW5nX29wZW4gPSBmYWxzZSk7CgkJCX0KCgkJCWRpYWxvZy4kc2V0KGRpYWxvZ19jaGFuZ2VzKTsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihpY29uMC4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX2luKGljb24xLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25faW4oaWNvbjIuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJdHJhbnNpdGlvbl9pbihpY29uMy4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX2luKGljb240LiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25faW4oZGlhbG9nLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dChpY29uMC4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX291dChpY29uMS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX291dChpY29uMi4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX291dChpY29uMy4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX291dChpY29uNC4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX291dChkaWFsb2cuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGRpdjQpOwoJCQl9CgoJCQlkZXN0cm95X2NvbXBvbmVudChpY29uMCk7CgkJCWRlc3Ryb3lfY29tcG9uZW50KGljb24xKTsKCQkJZGVzdHJveV9jb21wb25lbnQoaWNvbjIpOwoJCQlkZXN0cm95X2NvbXBvbmVudChpY29uMyk7CgkJCWRlc3Ryb3lfY29tcG9uZW50KGljb240KTsKCQkJZGVzdHJveV9jb21wb25lbnQoZGlhbG9nKTsKCQkJLyppZnJhbWVfYmluZGluZyovIGN0eFsxOV0obnVsbCk7CgkJCW1vdW50ZWQgPSBmYWxzZTsKCQkJcnVuX2FsbChkaXNwb3NlKTsKCQl9Cgl9Owp9CgpmdW5jdGlvbiBpbnN0YW5jZSQxKCQkc2VsZiwgJCRwcm9wcywgJCRpbnZhbGlkYXRlKSB7CglsZXQgc2VsZWN0ZWRQcm94eSA9ICJ1bHRyYXZpb2xldCI7CglsZXQgdXJsID0gImh0dHA6Ly9nb29nbGUuY29tIjsKCWxldCBwcm94eUlmcmFtZTsKCWxldCBzZXR0aW5nc2VuYWJsZWQgPSBmYWxzZTsKCWxldCBzZWFyY2hlbmdpbmUgPSAiaHR0cHM6Ly9nb29nbGUuY29tL3NlYXJjaD9xPSI7CgoJZnVuY3Rpb24gZnJhbWVMb2FkKCkgewoJfQoKCWZ1bmN0aW9uIHZpc2l0VVJMKHVybCkgewoJCWlmICghdXJsLmluY2x1ZGVzKCI6Ly8iKSkgewoJCQl1cmwgPSBzZWFyY2hlbmdpbmUgKyB1cmw7CgkJfQoKCQl7CgkJCWxldCBiYXJlID0gbmV3IEJhcmVDbGllbnQoKTsKCQkJb3BlbldpbmRvdyhuZXcgUmVxdWVzdCh1cmwpLCAiX3NlbGYiLCBwcm94eUlmcmFtZS5jb250ZW50V2luZG93LCBiYXJlLCAicmVwbGFjZSIpOwoJCX0KCX0KCglvbk1vdW50KCgpID0+IHsKCQl2aXNpdFVSTCh1cmwpOwoJfSk7CgoJY29uc3QgJCRiaW5kaW5nX2dyb3VwcyA9IFtbXV07CgoJY29uc3QgY2xpY2tfaGFuZGxlciA9ICgpID0+IHsKCQlwcm94eUlmcmFtZS5jb250ZW50V2luZG93Py5oaXN0b3J5LmJhY2soKTsKCX07CgoJY29uc3QgY2xpY2tfaGFuZGxlcl8xID0gKCkgPT4gewoJCXByb3h5SWZyYW1lLmNvbnRlbnRXaW5kb3c/Lmhpc3RvcnkuZm9yd2FyZCgpOwoJfTsKCgljb25zdCBjbGlja19oYW5kbGVyXzIgPSAoKSA9PiB7CgkJdmlzaXRVUkwodXJsKTsKCX07CgoJY29uc3QgY2xpY2tfaGFuZGxlcl8zID0gKCkgPT4gewoJCXZpc2l0VVJMKHVybCk7Cgl9OwoKCWZ1bmN0aW9uIGlucHV0X2lucHV0X2hhbmRsZXIoKSB7CgkJdXJsID0gdGhpcy52YWx1ZTsKCQkkJGludmFsaWRhdGUoMSwgdXJsKTsKCX0KCgljb25zdCBrZXlkb3duX2hhbmRsZXIgPSBlID0+IHsKCQlpZiAoZS5rZXkgPT09ICJFbnRlciIpIHsKCQkJdmlzaXRVUkwodXJsKTsKCQl9Cgl9OwoKCWNvbnN0IGNsaWNrX2hhbmRsZXJfNCA9ICgpID0+ICQkaW52YWxpZGF0ZSgzLCBzZXR0aW5nc2VuYWJsZWQgPSB0cnVlKTsKCglmdW5jdGlvbiBpbnB1dDBfY2hhbmdlX2hhbmRsZXIoKSB7CgkJc2VsZWN0ZWRQcm94eSA9IHRoaXMuX192YWx1ZTsKCQkkJGludmFsaWRhdGUoMCwgc2VsZWN0ZWRQcm94eSk7Cgl9CgoJZnVuY3Rpb24gaW5wdXQxX2NoYW5nZV9oYW5kbGVyKCkgewoJCXNlbGVjdGVkUHJveHkgPSB0aGlzLl9fdmFsdWU7CgkJJCRpbnZhbGlkYXRlKDAsIHNlbGVjdGVkUHJveHkpOwoJfQoKCWZ1bmN0aW9uIHRleHRmaWVsZF92YWx1ZV9iaW5kaW5nKHZhbHVlKSB7CgkJc2VhcmNoZW5naW5lID0gdmFsdWU7CgkJJCRpbnZhbGlkYXRlKDQsIHNlYXJjaGVuZ2luZSk7Cgl9CgoJZnVuY3Rpb24gZGlhbG9nX29wZW5fYmluZGluZyh2YWx1ZSkgewoJCXNldHRpbmdzZW5hYmxlZCA9IHZhbHVlOwoJCSQkaW52YWxpZGF0ZSgzLCBzZXR0aW5nc2VuYWJsZWQpOwoJfQoKCWZ1bmN0aW9uIGlmcmFtZV9iaW5kaW5nKCQkdmFsdWUpIHsKCQliaW5kaW5nX2NhbGxiYWNrc1skJHZhbHVlID8gJ3Vuc2hpZnQnIDogJ3B1c2gnXSgoKSA9PiB7CgkJCXByb3h5SWZyYW1lID0gJCR2YWx1ZTsKCQkJJCRpbnZhbGlkYXRlKDIsIHByb3h5SWZyYW1lKTsKCQl9KTsKCX0KCglyZXR1cm4gWwoJCXNlbGVjdGVkUHJveHksCgkJdXJsLAoJCXByb3h5SWZyYW1lLAoJCXNldHRpbmdzZW5hYmxlZCwKCQlzZWFyY2hlbmdpbmUsCgkJZnJhbWVMb2FkLAoJCXZpc2l0VVJMLAoJCWNsaWNrX2hhbmRsZXIsCgkJY2xpY2tfaGFuZGxlcl8xLAoJCWNsaWNrX2hhbmRsZXJfMiwKCQljbGlja19oYW5kbGVyXzMsCgkJaW5wdXRfaW5wdXRfaGFuZGxlciwKCQlrZXlkb3duX2hhbmRsZXIsCgkJY2xpY2tfaGFuZGxlcl80LAoJCWlucHV0MF9jaGFuZ2VfaGFuZGxlciwKCQkkJGJpbmRpbmdfZ3JvdXBzLAoJCWlucHV0MV9jaGFuZ2VfaGFuZGxlciwKCQl0ZXh0ZmllbGRfdmFsdWVfYmluZGluZywKCQlkaWFsb2dfb3Blbl9iaW5kaW5nLAoJCWlmcmFtZV9iaW5kaW5nCgldOwp9CgpsZXQgUHJveHkkMSA9IGNsYXNzIFByb3h5IGV4dGVuZHMgU3ZlbHRlQ29tcG9uZW50IHsKCWNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKCQlzdXBlcigpOwoJCWluaXQodGhpcywgb3B0aW9ucywgaW5zdGFuY2UkMSwgY3JlYXRlX2ZyYWdtZW50JDEsIHNhZmVfbm90X2VxdWFsLCB7fSk7Cgl9Cn07Cgp2YXIgbmFtZSA9ICJmaXJlYmFzZSI7CnZhciB2ZXJzaW9uID0gIjEwLjEuMCI7CgovKioNCiAqIEBsaWNlbnNlDQogKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDDQogKg0KICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQNCiAqDQogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMA0KICoNCiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUNCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsDQogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQNCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLg0KICovDQpyZWdpc3RlclZlcnNpb24obmFtZSwgdmVyc2lvbiwgJ2FwcCcpOwoKbGV0IHRyYWNrZXJzID0gewogICJ1cy1jZW50cmFsLTEiOiB7CiAgICBmaXJlYmFzZTogewogICAgICBhcGlLZXk6ICJBSXphU3lDczFMT3FzYnJBanltSWNqdmJLeFBoRlFXWGxTUGlMVHMiLAogICAgICBhdXRoRG9tYWluOiAiYWRyaWZ0LTZjMWY2LmZpcmViYXNlYXBwLmNvbSIsCiAgICAgIHByb2plY3RJZDogImFkcmlmdC02YzFmNiIsCiAgICAgIHN0b3JhZ2VCdWNrZXQ6ICJhZHJpZnQtNmMxZjYuYXBwc3BvdC5jb20iLAogICAgICBtZXNzYWdpbmdTZW5kZXJJZDogIjE3NTg0NjUxMjQxNCIsCiAgICAgIGFwcElkOiAiMToxNzU4NDY1MTI0MTQ6d2ViOjVjNmUwNmQyMzFhYjU4ZTkwMjliMGYiLAogICAgICBtZWFzdXJlbWVudElkOiAiRy1MMFAyRUY2UTcyIgogICAgfSwKICAgIHRyYWNrZXI6ICJ3c3M6Ly9sYjEubWVyY3VyeXdvcmsuc2hvcCIsCiAgICBkZXNjcmlwdGlvbjogInRoZSBvZmZpY2lhbCBjZW50cmFsIHRyYWNrZXIiCiAgfSwKICAicmFmZnRyYWNrZXIiOiB7CiAgICBmaXJlYmFzZTogewogICAgICBhcGlLZXk6ICJBSXphU3lEa2NkYTByLWdkaUpvVFE3RWJPTDlxNy1OQlF3aUtsUGciLAogICAgICBhdXRoRG9tYWluOiAicmFmZnRyYWNrZXIuZmlyZWJhc2VhcHAuY29tIiwKICAgICAgZGF0YWJhc2VVUkw6ICJodHRwczovL3JhZmZ0cmFja2VyLWRlZmF1bHQtcnRkYi5maXJlYmFzZWlvLmNvbSIsCiAgICAgIHByb2plY3RJZDogInJhZmZ0cmFja2VyIiwKICAgICAgc3RvcmFnZUJ1Y2tldDogInJhZmZ0cmFja2VyLmFwcHNwb3QuY29tIiwKICAgICAgbWVzc2FnaW5nU2VuZGVySWQ6ICI5OTQ5NDgwMzkwMTQiLAogICAgICBhcHBJZDogIjE6OTk0OTQ4MDM5MDE0OndlYjpmOTY5NzBhYTRmNjI2ZTk2OWRjOGE3IiwKICAgICAgbWVhc3VyZW1lbnRJZDogIkctUEQ5NlpLWDMxRCIKICAgIH0sCiAgICB0cmFja2VyOiAid3NzOi8vcmFmZnRyYWNrZXIubWVyY3VyeXdvcmsuc2hvcCIsCiAgICBkZXNjcmlwdGlvbjogImEgc2Vjb25kIG9mZmljaWFsIGJhY2t1cCB0cmFja2VyIgogIH0KfTsKCmNvbnN0IEFwcF9zdmVsdGVfc3ZlbHRlX3R5cGVfc3R5bGVfbGFuZyA9ICcnOwoKLyogc3JjL0FwcC5zdmVsdGUgZ2VuZXJhdGVkIGJ5IFN2ZWx0ZSB2NC4yLjAgKi8KCmZ1bmN0aW9uIGdldF9lYWNoX2NvbnRleHQoY3R4LCBsaXN0LCBpKSB7Cgljb25zdCBjaGlsZF9jdHggPSBjdHguc2xpY2UoKTsKCWNoaWxkX2N0eFs0MF0gPSBsaXN0W2ldOwoJcmV0dXJuIGNoaWxkX2N0eDsKfQoKLy8gKDM3MjowKSB7OmVsc2V9CmZ1bmN0aW9uIGNyZWF0ZV9lbHNlX2Jsb2NrKGN0eCkgewoJbGV0IGRpdjsKCWxldCBjYXJkOwoJbGV0IGN1cnJlbnQ7CgoJY2FyZCA9IG5ldyBDYXJkJDEoewoJCQlwcm9wczogewoJCQkJdHlwZTogImVsZXZhdGVkIiwKCQkJCSQkc2xvdHM6IHsgZGVmYXVsdDogW2NyZWF0ZV9kZWZhdWx0X3Nsb3RfMjBdIH0sCgkJCQkkJHNjb3BlOiB7IGN0eCB9CgkJCX0KCQl9KTsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWRpdiA9IGVsZW1lbnQoImRpdiIpOwoJCQljcmVhdGVfY29tcG9uZW50KGNhcmQuJCQuZnJhZ21lbnQpOwoJCQlhdHRyKGRpdiwgImNsYXNzIiwgImZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGgtZnVsbCIpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBkaXYsIGFuY2hvcik7CgkJCW1vdW50X2NvbXBvbmVudChjYXJkLCBkaXYsIG51bGwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCXAoY3R4LCBkaXJ0eSkgewoJCQljb25zdCBjYXJkX2NoYW5nZXMgPSB7fTsKCgkJCWlmIChkaXJ0eVsxXSAmIC8qJCRzY29wZSovIDQwOTYpIHsKCQkJCWNhcmRfY2hhbmdlcy4kJHNjb3BlID0geyBkaXJ0eSwgY3R4IH07CgkJCX0KCgkJCWNhcmQuJHNldChjYXJkX2NoYW5nZXMpOwoJCX0sCgkJaShsb2NhbCkgewoJCQlpZiAoY3VycmVudCkgcmV0dXJuOwoJCQl0cmFuc2l0aW9uX2luKGNhcmQuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlvKGxvY2FsKSB7CgkJCXRyYW5zaXRpb25fb3V0KGNhcmQuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGRpdik7CgkJCX0KCgkJCWRlc3Ryb3lfY29tcG9uZW50KGNhcmQpOwoJCX0KCX07Cn0KCi8vICgxNDY6NDMpIApmdW5jdGlvbiBjcmVhdGVfaWZfYmxvY2tfMihjdHgpIHsKCWxldCBkaXY4OwoJbGV0IGRpdjM7CglsZXQgZGl2MDsKCWxldCBjYXJkMDsKCWxldCB0MDsKCWxldCBkaXYxOwoJbGV0IHQxOwoJbGV0IGRpdjI7CglsZXQgY2FyZDE7CglsZXQgdDI7CglsZXQgZGl2NzsKCWxldCBkaXY0OwoJbGV0IGNhcmQyOwoJbGV0IHQzOwoJbGV0IGRpdjU7CglsZXQgY2FyZDM7CglsZXQgdDQ7CglsZXQgZGl2NjsKCWxldCBjYXJkNDsKCWxldCBjdXJyZW50OwoKCWNhcmQwID0gbmV3IENhcmQkMSh7CgkJCXByb3BzOiB7CgkJCQl0eXBlOiAiIiwKCQkJCSQkc2xvdHM6IHsgZGVmYXVsdDogW2NyZWF0ZV9kZWZhdWx0X3Nsb3RfMTldIH0sCgkJCQkkJHNjb3BlOiB7IGN0eCB9CgkJCX0KCQl9KTsKCgljYXJkMSA9IG5ldyBDYXJkJDEoewoJCQlwcm9wczogewoJCQkJdHlwZTogImVsZXZhdGVkIiwKCQkJCSQkc2xvdHM6IHsgZGVmYXVsdDogW2NyZWF0ZV9kZWZhdWx0X3Nsb3RfMThdIH0sCgkJCQkkJHNjb3BlOiB7IGN0eCB9CgkJCX0KCQl9KTsKCgljYXJkMiA9IG5ldyBDYXJkJDEoewoJCQlwcm9wczogewoJCQkJdHlwZTogImVsZXZhdGVkIiwKCQkJCWV4dHJhT3B0aW9uczogewoJCQkJCWNsYXNzOiAibTMtY29udGFpbmVyIHR5cGUtZWxldmF0ZWQgdy05LzEyIgoJCQkJfSwKCQkJCSQkc2xvdHM6IHsgZGVmYXVsdDogW2NyZWF0ZV9kZWZhdWx0X3Nsb3RfMTVdIH0sCgkJCQkkJHNjb3BlOiB7IGN0eCB9CgkJCX0KCQl9KTsKCgljYXJkMyA9IG5ldyBDYXJkJDEoewoJCQlwcm9wczogewoJCQkJdHlwZTogImVsZXZhdGVkIiwKCQkJCWV4dHJhT3B0aW9uczogewoJCQkJCWNsYXNzOiAibTMtY29udGFpbmVyIHR5cGUtZWxldmF0ZWQgdy05LzEyIGZsZXggZmxleC1jb2wiCgkJCQl9LAoJCQkJJCRzbG90czogeyBkZWZhdWx0OiBbY3JlYXRlX2RlZmF1bHRfc2xvdF8yXSB9LAoJCQkJJCRzY29wZTogeyBjdHggfQoJCQl9CgkJfSk7CgoJY2FyZDQgPSBuZXcgQ2FyZCQxKHsKCQkJcHJvcHM6IHsKCQkJCXR5cGU6ICJlbGV2YXRlZCIsCgkJCQlleHRyYU9wdGlvbnM6IHsKCQkJCQljbGFzczogIm0zLWNvbnRhaW5lciB0eXBlLWVsZXZhdGVkIHctZnVsbCIKCQkJCX0sCgkJCQkkJHNsb3RzOiB7IGRlZmF1bHQ6IFtjcmVhdGVfZGVmYXVsdF9zbG90XzFdIH0sCgkJCQkkJHNjb3BlOiB7IGN0eCB9CgkJCX0KCQl9KTsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWRpdjggPSBlbGVtZW50KCJkaXYiKTsKCQkJZGl2MyA9IGVsZW1lbnQoImRpdiIpOwoJCQlkaXYwID0gZWxlbWVudCgiZGl2Iik7CgkJCWNyZWF0ZV9jb21wb25lbnQoY2FyZDAuJCQuZnJhZ21lbnQpOwoJCQl0MCA9IHNwYWNlKCk7CgkJCWRpdjEgPSBlbGVtZW50KCJkaXYiKTsKCQkJdDEgPSBzcGFjZSgpOwoJCQlkaXYyID0gZWxlbWVudCgiZGl2Iik7CgkJCWNyZWF0ZV9jb21wb25lbnQoY2FyZDEuJCQuZnJhZ21lbnQpOwoJCQl0MiA9IHNwYWNlKCk7CgkJCWRpdjcgPSBlbGVtZW50KCJkaXYiKTsKCQkJZGl2NCA9IGVsZW1lbnQoImRpdiIpOwoJCQljcmVhdGVfY29tcG9uZW50KGNhcmQyLiQkLmZyYWdtZW50KTsKCQkJdDMgPSBzcGFjZSgpOwoJCQlkaXY1ID0gZWxlbWVudCgiZGl2Iik7CgkJCWNyZWF0ZV9jb21wb25lbnQoY2FyZDMuJCQuZnJhZ21lbnQpOwoJCQl0NCA9IHNwYWNlKCk7CgkJCWRpdjYgPSBlbGVtZW50KCJkaXYiKTsKCQkJY3JlYXRlX2NvbXBvbmVudChjYXJkNC4kJC5mcmFnbWVudCk7CgkJCWF0dHIoZGl2MCwgImlkIiwgImxvZ28iKTsKCQkJYXR0cihkaXYxLCAiaWQiLCAibmF2Iik7CgkJCWF0dHIoZGl2MiwgImlkIiwgImxpbmtzIik7CgkJCWF0dHIoZGl2MywgImlkIiwgInRvcGJhciIpOwoJCQlhdHRyKGRpdjMsICJjbGFzcyIsICJmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgcC00Iik7CgkJCWF0dHIoZGl2NCwgImNsYXNzIiwgImZsZXggbS00Iik7CgkJCWF0dHIoZGl2NSwgImNsYXNzIiwgImZsZXggaC1mdWxsIGp1c3RpZnktZW5kIG0tNCB0cmFuc2l0aW9uLWFsbCIpOwoJCQl0b2dnbGVfY2xhc3MoZGl2NSwgIm9wYWNpdHktMCIsICEvKnNob3dUcmFja2VyTGlzdCovIGN0eFs4XSk7CgkJCWF0dHIoZGl2NiwgImNsYXNzIiwgImZsZXggbS00Iik7CgkJCWF0dHIoZGl2NywgImNsYXNzIiwgImZsZXggZmxleC1jb2wgZmxleC0xIik7CgkJCWF0dHIoZGl2OCwgImNsYXNzIiwgImZsZXggZmxleC1jb2wgaC1mdWxsIik7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIGRpdjgsIGFuY2hvcik7CgkJCWFwcGVuZChkaXY4LCBkaXYzKTsKCQkJYXBwZW5kKGRpdjMsIGRpdjApOwoJCQltb3VudF9jb21wb25lbnQoY2FyZDAsIGRpdjAsIG51bGwpOwoJCQlhcHBlbmQoZGl2MywgdDApOwoJCQlhcHBlbmQoZGl2MywgZGl2MSk7CgkJCWFwcGVuZChkaXYzLCB0MSk7CgkJCWFwcGVuZChkaXYzLCBkaXYyKTsKCQkJbW91bnRfY29tcG9uZW50KGNhcmQxLCBkaXYyLCBudWxsKTsKCQkJYXBwZW5kKGRpdjgsIHQyKTsKCQkJYXBwZW5kKGRpdjgsIGRpdjcpOwoJCQlhcHBlbmQoZGl2NywgZGl2NCk7CgkJCW1vdW50X2NvbXBvbmVudChjYXJkMiwgZGl2NCwgbnVsbCk7CgkJCWFwcGVuZChkaXY3LCB0Myk7CgkJCWFwcGVuZChkaXY3LCBkaXY1KTsKCQkJbW91bnRfY29tcG9uZW50KGNhcmQzLCBkaXY1LCBudWxsKTsKCQkJYXBwZW5kKGRpdjcsIHQ0KTsKCQkJYXBwZW5kKGRpdjcsIGRpdjYpOwoJCQltb3VudF9jb21wb25lbnQoY2FyZDQsIGRpdjYsIG51bGwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCXAoY3R4LCBkaXJ0eSkgewoJCQljb25zdCBjYXJkMF9jaGFuZ2VzID0ge307CgoJCQlpZiAoZGlydHlbMV0gJiAvKiQkc2NvcGUqLyA0MDk2KSB7CgkJCQljYXJkMF9jaGFuZ2VzLiQkc2NvcGUgPSB7IGRpcnR5LCBjdHggfTsKCQkJfQoKCQkJY2FyZDAuJHNldChjYXJkMF9jaGFuZ2VzKTsKCQkJY29uc3QgY2FyZDFfY2hhbmdlcyA9IHt9OwoKCQkJaWYgKGRpcnR5WzFdICYgLyokJHNjb3BlKi8gNDA5NikgewoJCQkJY2FyZDFfY2hhbmdlcy4kJHNjb3BlID0geyBkaXJ0eSwgY3R4IH07CgkJCX0KCgkJCWNhcmQxLiRzZXQoY2FyZDFfY2hhbmdlcyk7CgkJCWNvbnN0IGNhcmQyX2NoYW5nZXMgPSB7fTsKCgkJCWlmIChkaXJ0eVswXSAmIC8qc2hvd1RyYWNrZXJMaXN0Ki8gMjU2IHwgZGlydHlbMV0gJiAvKiQkc2NvcGUqLyA0MDk2KSB7CgkJCQljYXJkMl9jaGFuZ2VzLiQkc2NvcGUgPSB7IGRpcnR5LCBjdHggfTsKCQkJfQoKCQkJY2FyZDIuJHNldChjYXJkMl9jaGFuZ2VzKTsKCQkJY29uc3QgY2FyZDNfY2hhbmdlcyA9IHt9OwoKCQkJaWYgKGRpcnR5WzBdICYgLypjcmVhdGVhY2NvdW50LCBlbWFpbCwgcGFzc3dvcmQsIHNuYWNrYmFyLCBzaG93TG9naW4sIHNob3dTd2FybVdhcm5pbmcsIGNob3NlblRyYWNrZXIsIHRyYWNrZXJzdGF0dXNlcyovIDM4MjAgfCBkaXJ0eVsxXSAmIC8qJCRzY29wZSovIDQwOTYpIHsKCQkJCWNhcmQzX2NoYW5nZXMuJCRzY29wZSA9IHsgZGlydHksIGN0eCB9OwoJCQl9CgoJCQljYXJkMy4kc2V0KGNhcmQzX2NoYW5nZXMpOwoKCQkJaWYgKCFjdXJyZW50IHx8IGRpcnR5WzBdICYgLypzaG93VHJhY2tlckxpc3QqLyAyNTYpIHsKCQkJCXRvZ2dsZV9jbGFzcyhkaXY1LCAib3BhY2l0eS0wIiwgIS8qc2hvd1RyYWNrZXJMaXN0Ki8gY3R4WzhdKTsKCQkJfQoKCQkJY29uc3QgY2FyZDRfY2hhbmdlcyA9IHt9OwoKCQkJaWYgKGRpcnR5WzFdICYgLyokJHNjb3BlKi8gNDA5NikgewoJCQkJY2FyZDRfY2hhbmdlcy4kJHNjb3BlID0geyBkaXJ0eSwgY3R4IH07CgkJCX0KCgkJCWNhcmQ0LiRzZXQoY2FyZDRfY2hhbmdlcyk7CgkJfSwKCQlpKGxvY2FsKSB7CgkJCWlmIChjdXJyZW50KSByZXR1cm47CgkJCXRyYW5zaXRpb25faW4oY2FyZDAuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJdHJhbnNpdGlvbl9pbihjYXJkMS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX2luKGNhcmQyLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25faW4oY2FyZDMuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJdHJhbnNpdGlvbl9pbihjYXJkNC4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoY2FyZDAuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJdHJhbnNpdGlvbl9vdXQoY2FyZDEuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJdHJhbnNpdGlvbl9vdXQoY2FyZDIuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJdHJhbnNpdGlvbl9vdXQoY2FyZDMuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJdHJhbnNpdGlvbl9vdXQoY2FyZDQuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGRpdjgpOwoJCQl9CgoJCQlkZXN0cm95X2NvbXBvbmVudChjYXJkMCk7CgkJCWRlc3Ryb3lfY29tcG9uZW50KGNhcmQxKTsKCQkJZGVzdHJveV9jb21wb25lbnQoY2FyZDIpOwoJCQlkZXN0cm95X2NvbXBvbmVudChjYXJkMyk7CgkJCWRlc3Ryb3lfY29tcG9uZW50KGNhcmQ0KTsKCQl9Cgl9Owp9CgovLyAoMTI4OjQxKSAKZnVuY3Rpb24gY3JlYXRlX2lmX2Jsb2NrXzEoY3R4KSB7CglsZXQgZGl2OwoJbGV0IGNhcmQ7CglsZXQgY3VycmVudDsKCgljYXJkID0gbmV3IENhcmQkMSh7CgkJCXByb3BzOiB7CgkJCQl0eXBlOiAib3V0bGluZWQiLAoJCQkJJCRzbG90czogeyBkZWZhdWx0OiBbY3JlYXRlX2RlZmF1bHRfc2xvdF0gfSwKCQkJCSQkc2NvcGU6IHsgY3R4IH0KCQkJfQoJCX0pOwoKCXJldHVybiB7CgkJYygpIHsKCQkJZGl2ID0gZWxlbWVudCgiZGl2Iik7CgkJCWNyZWF0ZV9jb21wb25lbnQoY2FyZC4kJC5mcmFnbWVudCk7CgkJCWF0dHIoZGl2LCAiY2xhc3MiLCAiaC1mdWxsIHctZnVsbCBmbGV4IGp1c3RpZnktY2VudGVyIGl0ZW1zLWNlbnRlciIpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBkaXYsIGFuY2hvcik7CgkJCW1vdW50X2NvbXBvbmVudChjYXJkLCBkaXYsIG51bGwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCXAoY3R4LCBkaXJ0eSkgewoJCQljb25zdCBjYXJkX2NoYW5nZXMgPSB7fTsKCgkJCWlmIChkaXJ0eVswXSAmIC8qY29ubmVjdGlvblN0YXRlKi8gMTYgfCBkaXJ0eVsxXSAmIC8qJCRzY29wZSovIDQwOTYpIHsKCQkJCWNhcmRfY2hhbmdlcy4kJHNjb3BlID0geyBkaXJ0eSwgY3R4IH07CgkJCX0KCgkJCWNhcmQuJHNldChjYXJkX2NoYW5nZXMpOwoJCX0sCgkJaShsb2NhbCkgewoJCQlpZiAoY3VycmVudCkgcmV0dXJuOwoJCQl0cmFuc2l0aW9uX2luKGNhcmQuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlvKGxvY2FsKSB7CgkJCXRyYW5zaXRpb25fb3V0KGNhcmQuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGRpdik7CgkJCX0KCgkJCWRlc3Ryb3lfY29tcG9uZW50KGNhcmQpOwoJCX0KCX07Cn0KCi8vICgxMjY6MCkgeyNpZiBzdGF0ZSA9PSBSZWFkeVN0YXRlLkNvbm5lY3RlZH0KZnVuY3Rpb24gY3JlYXRlX2lmX2Jsb2NrKGN0eCkgewoJbGV0IHByb3h5OwoJbGV0IGN1cnJlbnQ7Cglwcm94eSA9IG5ldyBQcm94eSQxKHt9KTsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWNyZWF0ZV9jb21wb25lbnQocHJveHkuJCQuZnJhZ21lbnQpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQltb3VudF9jb21wb25lbnQocHJveHksIHRhcmdldCwgYW5jaG9yKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlwOiBub29wJDQsCgkJaShsb2NhbCkgewoJCQlpZiAoY3VycmVudCkgcmV0dXJuOwoJCQl0cmFuc2l0aW9uX2luKHByb3h5LiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dChwcm94eS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gZmFsc2U7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlkZXN0cm95X2NvbXBvbmVudChwcm94eSwgZGV0YWNoaW5nKTsKCQl9Cgl9Owp9CgovLyAoMzc4OjEwKSA8QnV0dG9uIHR5cGU9ImZpbGxlZCIgb246Y2xpY2s9e2Nvbm5lY3REZXZIdHRwfSAgICAgICAgICAgICA+CmZ1bmN0aW9uIGNyZWF0ZV9kZWZhdWx0X3Nsb3RfMjIoY3R4KSB7CglsZXQgdDsKCglyZXR1cm4gewoJCWMoKSB7CgkJCXQgPSB0ZXh0KCJDb25uZWN0IHdpdGggV2ViUlRDIHRyYW5zcG9ydCBvdmVyIGxvY2FsaG9zdCBIVFRQIHNpZ25hbGluZyIpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCB0LCBhbmNob3IpOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKHQpOwoJCQl9CgkJfQoJfTsKfQoKLy8gKDM4MToxMCkgPEJ1dHRvbiB0eXBlPSJmaWxsZWQiIG9uOmNsaWNrPXtjb25uZWN0RGV2V1N9ICAgICAgICAgICAgID4KZnVuY3Rpb24gY3JlYXRlX2RlZmF1bHRfc2xvdF8yMShjdHgpIHsKCWxldCB0OwoKCXJldHVybiB7CgkJYygpIHsKCQkJdCA9IHRleHQoIkNvbm5lY3Qgd2l0aCBsb2NhbGhvc3Qgd2Vic29ja2V0IHRyYW5zcG9ydCIpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCB0LCBhbmNob3IpOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKHQpOwoJCQl9CgkJfQoJfTsKfQoKLy8gKDM3NDo0KSA8Q2FyZCB0eXBlPSJlbGV2YXRlZCI+CmZ1bmN0aW9uIGNyZWF0ZV9kZWZhdWx0X3Nsb3RfMjAoY3R4KSB7CglsZXQgZGl2MTsKCWxldCBoMjsKCWxldCB0MTsKCWxldCBkaXYwOwoJbGV0IGJ1dHRvbjA7CglsZXQgdDI7CglsZXQgYnV0dG9uMTsKCWxldCBjdXJyZW50OwoKCWJ1dHRvbjAgPSBuZXcgQnV0dG9uJDEoewoJCQlwcm9wczogewoJCQkJdHlwZTogImZpbGxlZCIsCgkJCQkkJHNsb3RzOiB7IGRlZmF1bHQ6IFtjcmVhdGVfZGVmYXVsdF9zbG90XzIyXSB9LAoJCQkJJCRzY29wZTogeyBjdHggfQoJCQl9CgkJfSk7CgoJYnV0dG9uMC4kb24oImNsaWNrIiwgLypjb25uZWN0RGV2SHR0cCovIGN0eFsxNV0pOwoKCWJ1dHRvbjEgPSBuZXcgQnV0dG9uJDEoewoJCQlwcm9wczogewoJCQkJdHlwZTogImZpbGxlZCIsCgkJCQkkJHNsb3RzOiB7IGRlZmF1bHQ6IFtjcmVhdGVfZGVmYXVsdF9zbG90XzIxXSB9LAoJCQkJJCRzY29wZTogeyBjdHggfQoJCQl9CgkJfSk7CgoJYnV0dG9uMS4kb24oImNsaWNrIiwgLypjb25uZWN0RGV2V1MqLyBjdHhbMTZdKTsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWRpdjEgPSBlbGVtZW50KCJkaXYiKTsKCQkJaDIgPSBlbGVtZW50KCJoMiIpOwoJCQloMi50ZXh0Q29udGVudCA9ICJBZHJpZnQgREVWIjsKCQkJdDEgPSBzcGFjZSgpOwoJCQlkaXYwID0gZWxlbWVudCgiZGl2Iik7CgkJCWNyZWF0ZV9jb21wb25lbnQoYnV0dG9uMC4kJC5mcmFnbWVudCk7CgkJCXQyID0gc3BhY2UoKTsKCQkJY3JlYXRlX2NvbXBvbmVudChidXR0b24xLiQkLmZyYWdtZW50KTsKCQkJYXR0cihoMiwgImNsYXNzIiwgIm0zLWZvbnQtaGVhZGxpbmUtbGFyZ2UgbS0zIik7CgkJCWF0dHIoZGl2MCwgImNsYXNzIiwgImZsZXggc3BhY2UtZXZlbmx5IHBhZC1jaGlsZHJlbiIpOwoJCQlhdHRyKGRpdjEsICJjbGFzcyIsICJmbGV4IGZsZXgtY29sIGgtZnVsbCIpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBkaXYxLCBhbmNob3IpOwoJCQlhcHBlbmQoZGl2MSwgaDIpOwoJCQlhcHBlbmQoZGl2MSwgdDEpOwoJCQlhcHBlbmQoZGl2MSwgZGl2MCk7CgkJCW1vdW50X2NvbXBvbmVudChidXR0b24wLCBkaXYwLCBudWxsKTsKCQkJYXBwZW5kKGRpdjAsIHQyKTsKCQkJbW91bnRfY29tcG9uZW50KGJ1dHRvbjEsIGRpdjAsIG51bGwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCXAoY3R4LCBkaXJ0eSkgewoJCQljb25zdCBidXR0b24wX2NoYW5nZXMgPSB7fTsKCgkJCWlmIChkaXJ0eVsxXSAmIC8qJCRzY29wZSovIDQwOTYpIHsKCQkJCWJ1dHRvbjBfY2hhbmdlcy4kJHNjb3BlID0geyBkaXJ0eSwgY3R4IH07CgkJCX0KCgkJCWJ1dHRvbjAuJHNldChidXR0b24wX2NoYW5nZXMpOwoJCQljb25zdCBidXR0b24xX2NoYW5nZXMgPSB7fTsKCgkJCWlmIChkaXJ0eVsxXSAmIC8qJCRzY29wZSovIDQwOTYpIHsKCQkJCWJ1dHRvbjFfY2hhbmdlcy4kJHNjb3BlID0geyBkaXJ0eSwgY3R4IH07CgkJCX0KCgkJCWJ1dHRvbjEuJHNldChidXR0b24xX2NoYW5nZXMpOwoJCX0sCgkJaShsb2NhbCkgewoJCQlpZiAoY3VycmVudCkgcmV0dXJuOwoJCQl0cmFuc2l0aW9uX2luKGJ1dHRvbjAuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJdHJhbnNpdGlvbl9pbihidXR0b24xLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dChidXR0b24wLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25fb3V0KGJ1dHRvbjEuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGRpdjEpOwoJCQl9CgoJCQlkZXN0cm95X2NvbXBvbmVudChidXR0b24wKTsKCQkJZGVzdHJveV9jb21wb25lbnQoYnV0dG9uMSk7CgkJfQoJfTsKfQoKLy8gKDE1MDo4KSA8Q2FyZCB0eXBlPSIiPgpmdW5jdGlvbiBjcmVhdGVfZGVmYXVsdF9zbG90XzE5KGN0eCkgewoJbGV0IGRpdjsKCWxldCBpY29uOwoJbGV0IHQwOwoJbGV0IHA7CglsZXQgY3VycmVudDsKCglpY29uID0gbmV3IEljb24oewoJCQlwcm9wczogeyBpY29uOiAibWF0ZXJpYWwtc3ltYm9sczpzYWlsaW5nIiB9CgkJfSk7CgoJcmV0dXJuIHsKCQljKCkgewoJCQlkaXYgPSBlbGVtZW50KCJkaXYiKTsKCQkJY3JlYXRlX2NvbXBvbmVudChpY29uLiQkLmZyYWdtZW50KTsKCQkJdDAgPSBzcGFjZSgpOwoJCQlwID0gZWxlbWVudCgicCIpOwoJCQlwLnRleHRDb250ZW50ID0gIkFkcmlmdCI7CgkJCWF0dHIocCwgImNsYXNzIiwgInRleHQtMnhsIG1sLTMiKTsKCQkJYXR0cihkaXYsICJjbGFzcyIsICJmbGV4IGl0ZW1zLWNlbnRlciB0ZXh0LTN4bCIpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBkaXYsIGFuY2hvcik7CgkJCW1vdW50X2NvbXBvbmVudChpY29uLCBkaXYsIG51bGwpOwoJCQlhcHBlbmQoZGl2LCB0MCk7CgkJCWFwcGVuZChkaXYsIHApOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCXA6IG5vb3AkNCwKCQlpKGxvY2FsKSB7CgkJCWlmIChjdXJyZW50KSByZXR1cm47CgkJCXRyYW5zaXRpb25faW4oaWNvbi4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoaWNvbi4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gZmFsc2U7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2goZGl2KTsKCQkJfQoKCQkJZGVzdHJveV9jb21wb25lbnQoaWNvbik7CgkJfQoJfTsKfQoKLy8gKDE1OTo4KSA8Q2FyZCB0eXBlPSJlbGV2YXRlZCI+CmZ1bmN0aW9uIGNyZWF0ZV9kZWZhdWx0X3Nsb3RfMTgoY3R4KSB7CglsZXQgZGl2OwoJbGV0IGEwOwoJbGV0IGljb24wOwoJbGV0IHQwOwoJbGV0IHNwYWNlcjsKCWxldCB0MTsKCWxldCBhMTsKCWxldCBpY29uMTsKCWxldCBjdXJyZW50OwoKCWljb24wID0gbmV3IEljb24oewoJCQlwcm9wczogeyBpY29uOiBkYXRhJDEsIGNsYXNzOiAiaWNvbiIgfQoJCX0pOwoKCWljb24xID0gbmV3IEljb24oewoJCQlwcm9wczogeyBpY29uOiBkYXRhLCBjbGFzczogImljb24iIH0KCQl9KTsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWRpdiA9IGVsZW1lbnQoImRpdiIpOwoJCQlhMCA9IGVsZW1lbnQoImEiKTsKCQkJY3JlYXRlX2NvbXBvbmVudChpY29uMC4kJC5mcmFnbWVudCk7CgkJCXQwID0gc3BhY2UoKTsKCQkJc3BhY2VyID0gZWxlbWVudCgic3BhY2VyIik7CgkJCXQxID0gc3BhY2UoKTsKCQkJYTEgPSBlbGVtZW50KCJhIik7CgkJCWNyZWF0ZV9jb21wb25lbnQoaWNvbjEuJCQuZnJhZ21lbnQpOwoJCQlhdHRyKGEwLCAiaHJlZiIsICJodHRwczovL2Rpc2NvcmQuZ2cvYkFnTnlHcFhTeCIpOwoJCQlhdHRyKHNwYWNlciwgImNsYXNzIiwgInN2ZWx0ZS1tZTgzYmEiKTsKCQkJYXR0cihhMSwgImhyZWYiLCAiaHR0cHM6Ly9naXRodWIuY29tL01lcmN1cnlXb3Jrc2hvcC9hZHJpZnQiKTsKCQkJYXR0cihkaXYsICJjbGFzcyIsICJmbGV4Iik7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIGRpdiwgYW5jaG9yKTsKCQkJYXBwZW5kKGRpdiwgYTApOwoJCQltb3VudF9jb21wb25lbnQoaWNvbjAsIGEwLCBudWxsKTsKCQkJYXBwZW5kKGRpdiwgdDApOwoJCQlhcHBlbmQoZGl2LCBzcGFjZXIpOwoJCQlhcHBlbmQoZGl2LCB0MSk7CgkJCWFwcGVuZChkaXYsIGExKTsKCQkJbW91bnRfY29tcG9uZW50KGljb24xLCBhMSwgbnVsbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJcDogbm9vcCQ0LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihpY29uMC4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX2luKGljb24xLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dChpY29uMC4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX291dChpY29uMS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gZmFsc2U7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2goZGl2KTsKCQkJfQoKCQkJZGVzdHJveV9jb21wb25lbnQoaWNvbjApOwoJCQlkZXN0cm95X2NvbXBvbmVudChpY29uMSk7CgkJfQoJfTsKfQoKLy8gKDE4NToxMikgPEJ1dHRvbiB0eXBlPSJmaWxsZWQiIG9uOmNsaWNrPXsoKSA9PiAoc2hvd1RyYWNrZXJMaXN0ID0gdHJ1ZSl9ICAgICAgICAgICAgICAgPgpmdW5jdGlvbiBjcmVhdGVfZGVmYXVsdF9zbG90XzE3KGN0eCkgewoJbGV0IHQ7CgoJcmV0dXJuIHsKCQljKCkgewoJCQl0ID0gdGV4dCgiU3RhcnQgQnJvd3NpbmciKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgdCwgYW5jaG9yKTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaCh0KTsKCQkJfQoJCX0KCX07Cn0KCi8vICgxNzQ6OCkgPENhcmQgICAgICAgICAgIHR5cGU9ImVsZXZhdGVkIiAgICAgICAgICAgZXh0cmFPcHRpb25zPXt7IGNsYXNzOiAibTMtY29udGFpbmVyIHR5cGUtZWxldmF0ZWQgdy05LzEyIiB9fSAgICAgICAgID4KZnVuY3Rpb24gY3JlYXRlX2RlZmF1bHRfc2xvdF8xNShjdHgpIHsKCWxldCBkaXYwOwoJbGV0IHQzOwoJbGV0IGRpdjE7CglsZXQgYnV0dG9uOwoJbGV0IHQ0OwoJbGV0IGN1cnJlbnQ7CgoJYnV0dG9uID0gbmV3IEJ1dHRvbiQxKHsKCQkJcHJvcHM6IHsKCQkJCXR5cGU6ICJmaWxsZWQiLAoJCQkJJCRzbG90czogeyBkZWZhdWx0OiBbY3JlYXRlX2RlZmF1bHRfc2xvdF8xN10gfSwKCQkJCSQkc2NvcGU6IHsgY3R4IH0KCQkJfQoJCX0pOwoKCWJ1dHRvbi4kb24oImNsaWNrIiwgLypjbGlja19oYW5kbGVyKi8gY3R4WzE3XSk7CglsZXQgaWZfYmxvY2sgPSAhIjEiIDsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWRpdjAgPSBlbGVtZW50KCJkaXYiKTsKCQkJZGl2MC5pbm5lckhUTUwgPSBgPGgyIGNsYXNzPSJ0ZXh0LTZ4bCI+U3VyZiB0aGUgd2ViLCBBZHJpZnQ8L2gyPiA8aDIgY2xhc3M9InRleHQtMnhsIj5BIGZhc3QgYW5kIG1vZGVybiBkZWNlbnRyYWxpemVkIHByb3h5IG5ldHdvcms8L2gyPmA7CgkJCXQzID0gc3BhY2UoKTsKCQkJZGl2MSA9IGVsZW1lbnQoImRpdiIpOwoJCQljcmVhdGVfY29tcG9uZW50KGJ1dHRvbi4kJC5mcmFnbWVudCk7CgkJCXQ0ID0gc3BhY2UoKTsKCQkJYXR0cihkaXYwLCAiY2xhc3MiLCAidy1mdWxsIik7CgkJCWF0dHIoZGl2MSwgImNsYXNzIiwgIm10LTUgZmxleCBqdXN0aWZ5LWJldHdlZW4iKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgZGl2MCwgYW5jaG9yKTsKCQkJaW5zZXJ0KHRhcmdldCwgdDMsIGFuY2hvcik7CgkJCWluc2VydCh0YXJnZXQsIGRpdjEsIGFuY2hvcik7CgkJCW1vdW50X2NvbXBvbmVudChidXR0b24sIGRpdjEsIG51bGwpOwoJCQlhcHBlbmQoZGl2MSwgdDQpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCXAoY3R4LCBkaXJ0eSkgewoJCQljb25zdCBidXR0b25fY2hhbmdlcyA9IHt9OwoKCQkJaWYgKGRpcnR5WzFdICYgLyokJHNjb3BlKi8gNDA5NikgewoJCQkJYnV0dG9uX2NoYW5nZXMuJCRzY29wZSA9IHsgZGlydHksIGN0eCB9OwoJCQl9CgoJCQlidXR0b24uJHNldChidXR0b25fY2hhbmdlcyk7CgkJfSwKCQlpKGxvY2FsKSB7CgkJCWlmIChjdXJyZW50KSByZXR1cm47CgkJCXRyYW5zaXRpb25faW4oYnV0dG9uLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25faW4oaWZfYmxvY2spOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoYnV0dG9uLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25fb3V0KGlmX2Jsb2NrKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGRpdjApOwoJCQkJZGV0YWNoKHQzKTsKCQkJCWRldGFjaChkaXYxKTsKCQkJfQoKCQkJZGVzdHJveV9jb21wb25lbnQoYnV0dG9uKTsKCQl9Cgl9Owp9CgovLyAoMjE2OjIwKSA8c3ZlbHRlOmNvbXBvbmVudCB0aGlzPXtSYWRpb0FuaW0zfT4KZnVuY3Rpb24gY3JlYXRlX2RlZmF1bHRfc2xvdF8xNChjdHgpIHsKCWxldCBpbnB1dDsKCWxldCBiaW5kaW5nX2dyb3VwOwoJbGV0IG1vdW50ZWQ7CglsZXQgZGlzcG9zZTsKCWJpbmRpbmdfZ3JvdXAgPSBpbml0X2JpbmRpbmdfZ3JvdXAoLyokJGJpbmRpbmdfZ3JvdXBzKi8gY3R4WzIwXVswXSk7CgoJcmV0dXJuIHsKCQljKCkgewoJCQlpbnB1dCA9IGVsZW1lbnQoImlucHV0Iik7CgkJCWF0dHIoaW5wdXQsICJ0eXBlIiwgInJhZGlvIik7CgkJCWF0dHIoaW5wdXQsICJpZCIsIC8qdHJhY2tlciovIGN0eFs0MF0pOwoJCQlhdHRyKGlucHV0LCAibmFtZSIsICJ0YWJzIik7CgkJCWlucHV0Ll9fdmFsdWUgPSAvKnRyYWNrZXIqLyBjdHhbNDBdOwoJCQlzZXRfaW5wdXRfdmFsdWUoaW5wdXQsIGlucHV0Ll9fdmFsdWUpOwoJCQliaW5kaW5nX2dyb3VwLnAoaW5wdXQpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBpbnB1dCwgYW5jaG9yKTsKCQkJaW5wdXQuY2hlY2tlZCA9IGlucHV0Ll9fdmFsdWUgPT09IC8qY2hvc2VuVHJhY2tlciovIGN0eFs3XTsKCgkJCWlmICghbW91bnRlZCkgewoJCQkJZGlzcG9zZSA9IGxpc3RlbihpbnB1dCwgImNoYW5nZSIsIC8qaW5wdXRfY2hhbmdlX2hhbmRsZXIqLyBjdHhbMTldKTsKCQkJCW1vdW50ZWQgPSB0cnVlOwoJCQl9CgkJfSwKCQlwKGN0eCwgZGlydHkpIHsKCQkJaWYgKGRpcnR5WzBdICYgLypjaG9zZW5UcmFja2VyKi8gMTI4KSB7CgkJCQlpbnB1dC5jaGVja2VkID0gaW5wdXQuX192YWx1ZSA9PT0gLypjaG9zZW5UcmFja2VyKi8gY3R4WzddOwoJCQl9CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2goaW5wdXQpOwoJCQl9CgoJCQliaW5kaW5nX2dyb3VwLnIoKTsKCQkJbW91bnRlZCA9IGZhbHNlOwoJCQlkaXNwb3NlKCk7CgkJfQoJfTsKfQoKLy8gKDIxMzoxNCkgPENhcmQgdHlwZT0ib3V0bGluZWQiPgpmdW5jdGlvbiBjcmVhdGVfZGVmYXVsdF9zbG90XzEzKGN0eCkgewoJbGV0IGxhYmVsOwoJbGV0IGRpdjsKCWxldCBzd2l0Y2hfaW5zdGFuY2U7CglsZXQgdDA7CglsZXQgcDA7CglsZXQgdDI7CglsZXQgcDE7CglsZXQgdDQ7CglsZXQgcDI7CgoJbGV0IHQ1X3ZhbHVlID0gKC8qdHJhY2tlcnN0YXR1c2VzKi8gY3R4WzExXVsvKnRyYWNrZXIqLyBjdHhbNDBdXQoJPyAvKnRyYWNrZXJzdGF0dXNlcyovIGN0eFsxMV1bLyp0cmFja2VyKi8gY3R4WzQwXV0/Lm1lbWJlcnM/Lmxlbmd0aAoJOiAibG9hZGluZyIpICsgIiI7CgoJbGV0IHQ1OwoJbGV0IHQ2OwoJbGV0IHQ3OwoJbGV0IGN1cnJlbnQ7Cgl2YXIgc3dpdGNoX3ZhbHVlID0gUmFkaW9BbmltMyQxOwoKCWZ1bmN0aW9uIHN3aXRjaF9wcm9wcyhjdHgsIGRpcnR5KSB7CgkJcmV0dXJuIHsKCQkJcHJvcHM6IHsKCQkJCSQkc2xvdHM6IHsgZGVmYXVsdDogW2NyZWF0ZV9kZWZhdWx0X3Nsb3RfMTRdIH0sCgkJCQkkJHNjb3BlOiB7IGN0eCB9CgkJCX0KCQl9OwoJfQoKCWlmIChzd2l0Y2hfdmFsdWUpIHsKCQlzd2l0Y2hfaW5zdGFuY2UgPSBjb25zdHJ1Y3Rfc3ZlbHRlX2NvbXBvbmVudChzd2l0Y2hfdmFsdWUsIHN3aXRjaF9wcm9wcyhjdHgpKTsKCX0KCglyZXR1cm4gewoJCWMoKSB7CgkJCWxhYmVsID0gZWxlbWVudCgibGFiZWwiKTsKCQkJZGl2ID0gZWxlbWVudCgiZGl2Iik7CgkJCWlmIChzd2l0Y2hfaW5zdGFuY2UpIGNyZWF0ZV9jb21wb25lbnQoc3dpdGNoX2luc3RhbmNlLiQkLmZyYWdtZW50KTsKCQkJdDAgPSBzcGFjZSgpOwoJCQlwMCA9IGVsZW1lbnQoInAiKTsKCQkJcDAudGV4dENvbnRlbnQgPSBgJHsvKnRyYWNrZXIqLyBjdHhbNDBdfWA7CgkJCXQyID0gc3BhY2UoKTsKCQkJcDEgPSBlbGVtZW50KCJwIik7CgkJCXAxLnRleHRDb250ZW50ID0gYCR7dHJhY2tlcnNbLyp0cmFja2VyKi8gY3R4WzQwXV0uZGVzY3JpcHRpb259YDsKCQkJdDQgPSBzcGFjZSgpOwoJCQlwMiA9IGVsZW1lbnQoInAiKTsKCQkJdDUgPSB0ZXh0KHQ1X3ZhbHVlKTsKCQkJdDYgPSB0ZXh0KCIgc3dhcm0gbWVtYmVycyIpOwoJCQl0NyA9IHNwYWNlKCk7CgkJCWF0dHIocDAsICJjbGFzcyIsICJtbC0zIHRleHQteGwiKTsKCQkJYXR0cihkaXYsICJjbGFzcyIsICJmbGV4IGl0ZW1zLWNlbnRlciIpOwoJCQlhdHRyKHAyLCAiY2xhc3MiLCAib3BhY2l0eS01MCIpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBsYWJlbCwgYW5jaG9yKTsKCQkJYXBwZW5kKGxhYmVsLCBkaXYpOwoJCQlpZiAoc3dpdGNoX2luc3RhbmNlKSBtb3VudF9jb21wb25lbnQoc3dpdGNoX2luc3RhbmNlLCBkaXYsIG51bGwpOwoJCQlhcHBlbmQoZGl2LCB0MCk7CgkJCWFwcGVuZChkaXYsIHAwKTsKCQkJYXBwZW5kKGxhYmVsLCB0Mik7CgkJCWFwcGVuZChsYWJlbCwgcDEpOwoJCQlhcHBlbmQobGFiZWwsIHQ0KTsKCQkJYXBwZW5kKGxhYmVsLCBwMik7CgkJCWFwcGVuZChwMiwgdDUpOwoJCQlhcHBlbmQocDIsIHQ2KTsKCQkJaW5zZXJ0KHRhcmdldCwgdDcsIGFuY2hvcik7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJcChjdHgsIGRpcnR5KSB7CgkJCWlmIChzd2l0Y2hfdmFsdWUgIT09IChzd2l0Y2hfdmFsdWUgPSBSYWRpb0FuaW0zJDEpKSB7CgkJCQlpZiAoc3dpdGNoX2luc3RhbmNlKSB7CgkJCQkJZ3JvdXBfb3V0cm9zKCk7CgkJCQkJY29uc3Qgb2xkX2NvbXBvbmVudCA9IHN3aXRjaF9pbnN0YW5jZTsKCgkJCQkJdHJhbnNpdGlvbl9vdXQob2xkX2NvbXBvbmVudC4kJC5mcmFnbWVudCwgMSwgMCwgKCkgPT4gewoJCQkJCQlkZXN0cm95X2NvbXBvbmVudChvbGRfY29tcG9uZW50LCAxKTsKCQkJCQl9KTsKCgkJCQkJY2hlY2tfb3V0cm9zKCk7CgkJCQl9CgoJCQkJaWYgKHN3aXRjaF92YWx1ZSkgewoJCQkJCXN3aXRjaF9pbnN0YW5jZSA9IGNvbnN0cnVjdF9zdmVsdGVfY29tcG9uZW50KHN3aXRjaF92YWx1ZSwgc3dpdGNoX3Byb3BzKGN0eCkpOwoJCQkJCWNyZWF0ZV9jb21wb25lbnQoc3dpdGNoX2luc3RhbmNlLiQkLmZyYWdtZW50KTsKCQkJCQl0cmFuc2l0aW9uX2luKHN3aXRjaF9pbnN0YW5jZS4kJC5mcmFnbWVudCwgMSk7CgkJCQkJbW91bnRfY29tcG9uZW50KHN3aXRjaF9pbnN0YW5jZSwgZGl2LCB0MCk7CgkJCQl9IGVsc2UgewoJCQkJCXN3aXRjaF9pbnN0YW5jZSA9IG51bGw7CgkJCQl9CgkJCX0gZWxzZSBpZiAoc3dpdGNoX3ZhbHVlKSB7CgkJCQljb25zdCBzd2l0Y2hfaW5zdGFuY2VfY2hhbmdlcyA9IHt9OwoKCQkJCWlmIChkaXJ0eVswXSAmIC8qY2hvc2VuVHJhY2tlciovIDEyOCB8IGRpcnR5WzFdICYgLyokJHNjb3BlKi8gNDA5NikgewoJCQkJCXN3aXRjaF9pbnN0YW5jZV9jaGFuZ2VzLiQkc2NvcGUgPSB7IGRpcnR5LCBjdHggfTsKCQkJCX0KCgkJCQlzd2l0Y2hfaW5zdGFuY2UuJHNldChzd2l0Y2hfaW5zdGFuY2VfY2hhbmdlcyk7CgkJCX0KCgkJCWlmICgoIWN1cnJlbnQgfHwgZGlydHlbMF0gJiAvKnRyYWNrZXJzdGF0dXNlcyovIDIwNDgpICYmIHQ1X3ZhbHVlICE9PSAodDVfdmFsdWUgPSAoLyp0cmFja2Vyc3RhdHVzZXMqLyBjdHhbMTFdWy8qdHJhY2tlciovIGN0eFs0MF1dCgkJCT8gLyp0cmFja2Vyc3RhdHVzZXMqLyBjdHhbMTFdWy8qdHJhY2tlciovIGN0eFs0MF1dPy5tZW1iZXJzPy5sZW5ndGgKCQkJOiAibG9hZGluZyIpICsgIiIpKSBzZXRfZGF0YSh0NSwgdDVfdmFsdWUpOwoJCX0sCgkJaShsb2NhbCkgewoJCQlpZiAoY3VycmVudCkgcmV0dXJuOwoJCQlpZiAoc3dpdGNoX2luc3RhbmNlKSB0cmFuc2l0aW9uX2luKHN3aXRjaF9pbnN0YW5jZS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJaWYgKHN3aXRjaF9pbnN0YW5jZSkgdHJhbnNpdGlvbl9vdXQoc3dpdGNoX2luc3RhbmNlLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChsYWJlbCk7CgkJCQlkZXRhY2godDcpOwoJCQl9CgoJCQlpZiAoc3dpdGNoX2luc3RhbmNlKSBkZXN0cm95X2NvbXBvbmVudChzd2l0Y2hfaW5zdGFuY2UpOwoJCX0KCX07Cn0KCi8vICgyMTI6MTIpIHsjZWFjaCBPYmplY3Qua2V5cyhUcmFja2VyTGlzdCkgYXMgdHJhY2tlcn0KZnVuY3Rpb24gY3JlYXRlX2VhY2hfYmxvY2soY3R4KSB7CglsZXQgY2FyZDsKCWxldCBjdXJyZW50OwoKCWNhcmQgPSBuZXcgQ2FyZCQxKHsKCQkJcHJvcHM6IHsKCQkJCXR5cGU6ICJvdXRsaW5lZCIsCgkJCQkkJHNsb3RzOiB7IGRlZmF1bHQ6IFtjcmVhdGVfZGVmYXVsdF9zbG90XzEzXSB9LAoJCQkJJCRzY29wZTogeyBjdHggfQoJCQl9CgkJfSk7CgoJcmV0dXJuIHsKCQljKCkgewoJCQljcmVhdGVfY29tcG9uZW50KGNhcmQuJCQuZnJhZ21lbnQpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQltb3VudF9jb21wb25lbnQoY2FyZCwgdGFyZ2V0LCBhbmNob3IpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCXAoY3R4LCBkaXJ0eSkgewoJCQljb25zdCBjYXJkX2NoYW5nZXMgPSB7fTsKCgkJCWlmIChkaXJ0eVswXSAmIC8qdHJhY2tlcnN0YXR1c2VzLCBjaG9zZW5UcmFja2VyKi8gMjE3NiB8IGRpcnR5WzFdICYgLyokJHNjb3BlKi8gNDA5NikgewoJCQkJY2FyZF9jaGFuZ2VzLiQkc2NvcGUgPSB7IGRpcnR5LCBjdHggfTsKCQkJfQoKCQkJY2FyZC4kc2V0KGNhcmRfY2hhbmdlcyk7CgkJfSwKCQlpKGxvY2FsKSB7CgkJCWlmIChjdXJyZW50KSByZXR1cm47CgkJCXRyYW5zaXRpb25faW4oY2FyZC4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoY2FyZC4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gZmFsc2U7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlkZXN0cm95X2NvbXBvbmVudChjYXJkLCBkZXRhY2hpbmcpOwoJCX0KCX07Cn0KCi8vICgyNDM6MTIpIHsjaWYgY2hvc2VuVHJhY2tlcn0KZnVuY3Rpb24gY3JlYXRlX2lmX2Jsb2NrXzMoY3R4KSB7CglsZXQgYnV0dG9uMDsKCWxldCB0OwoJbGV0IGJ1dHRvbjE7CglsZXQgY3VycmVudDsKCglidXR0b24wID0gbmV3IEJ1dHRvbiQxKHsKCQkJcHJvcHM6IHsKCQkJCXR5cGU6ICJlbGV2YXRlZCIsCgkJCQkkJHNsb3RzOiB7IGRlZmF1bHQ6IFtjcmVhdGVfZGVmYXVsdF9zbG90XzEyXSB9LAoJCQkJJCRzY29wZTogeyBjdHggfQoJCQl9CgkJfSk7CgoJYnV0dG9uMC4kb24oImNsaWNrIiwgLypjbGlja19oYW5kbGVyXzIqLyBjdHhbMjFdKTsKCglidXR0b24xID0gbmV3IEJ1dHRvbiQxKHsKCQkJcHJvcHM6IHsKCQkJCXR5cGU6ICJmaWxsZWQiLAoJCQkJJCRzbG90czogeyBkZWZhdWx0OiBbY3JlYXRlX2RlZmF1bHRfc2xvdF8xMV0gfSwKCQkJCSQkc2NvcGU6IHsgY3R4IH0KCQkJfQoJCX0pOwoKCWJ1dHRvbjEuJG9uKCJjbGljayIsIC8qY2xpY2tfaGFuZGxlcl8zKi8gY3R4WzIyXSk7CgoJcmV0dXJuIHsKCQljKCkgewoJCQljcmVhdGVfY29tcG9uZW50KGJ1dHRvbjAuJCQuZnJhZ21lbnQpOwoJCQl0ID0gc3BhY2UoKTsKCQkJY3JlYXRlX2NvbXBvbmVudChidXR0b24xLiQkLmZyYWdtZW50KTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJbW91bnRfY29tcG9uZW50KGJ1dHRvbjAsIHRhcmdldCwgYW5jaG9yKTsKCQkJaW5zZXJ0KHRhcmdldCwgdCwgYW5jaG9yKTsKCQkJbW91bnRfY29tcG9uZW50KGJ1dHRvbjEsIHRhcmdldCwgYW5jaG9yKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlwKGN0eCwgZGlydHkpIHsKCQkJY29uc3QgYnV0dG9uMF9jaGFuZ2VzID0ge307CgoJCQlpZiAoZGlydHlbMV0gJiAvKiQkc2NvcGUqLyA0MDk2KSB7CgkJCQlidXR0b24wX2NoYW5nZXMuJCRzY29wZSA9IHsgZGlydHksIGN0eCB9OwoJCQl9CgoJCQlidXR0b24wLiRzZXQoYnV0dG9uMF9jaGFuZ2VzKTsKCQkJY29uc3QgYnV0dG9uMV9jaGFuZ2VzID0ge307CgoJCQlpZiAoZGlydHlbMV0gJiAvKiQkc2NvcGUqLyA0MDk2KSB7CgkJCQlidXR0b24xX2NoYW5nZXMuJCRzY29wZSA9IHsgZGlydHksIGN0eCB9OwoJCQl9CgoJCQlidXR0b24xLiRzZXQoYnV0dG9uMV9jaGFuZ2VzKTsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbihidXR0b24wLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25faW4oYnV0dG9uMS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoYnV0dG9uMC4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX291dChidXR0b24xLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaCh0KTsKCQkJfQoKCQkJZGVzdHJveV9jb21wb25lbnQoYnV0dG9uMCwgZGV0YWNoaW5nKTsKCQkJZGVzdHJveV9jb21wb25lbnQoYnV0dG9uMSwgZGV0YWNoaW5nKTsKCQl9Cgl9Owp9CgovLyAoMjQ0OjE0KSA8QnV0dG9uIHR5cGU9ImVsZXZhdGVkIiBvbjpjbGljaz17KCkgPT4gKHNob3dTd2FybVdhcm5pbmcgPSB0cnVlKX0gICAgICAgICAgICAgICAgID4KZnVuY3Rpb24gY3JlYXRlX2RlZmF1bHRfc2xvdF8xMihjdHgpIHsKCWxldCB0OwoKCXJldHVybiB7CgkJYygpIHsKCQkJdCA9IHRleHQoIkNvbm5lY3QgdG8gdGhlIHN3YXJtIik7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIHQsIGFuY2hvcik7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2godCk7CgkJCX0KCQl9Cgl9Owp9CgovLyAoMjQ3OjE0KSA8QnV0dG9uICAgICAgICAgICAgICAgICB0eXBlPSJmaWxsZWQiICAgICAgICAgICAgICAgICBvbjpjbGljaz17YXN5bmMgKCkgPT4geyAgICAgICAgICAgICAgICAgICBhd2FpdCBpbml0RmlyZWJhc2UoKTsgICAgICAgICAgICAgICAgICAgIGxldCBhdXRoID0gZ2V0QXV0aCgpOyAgICAgICAgICAgICAgICAgICBhd2FpdCBzZXRQZXJzaXN0ZW5jZShhdXRoLCBicm93c2VyTG9jYWxQZXJzaXN0ZW5jZSk7ICAgICAgICAgICAgICAgICAgICBpZiAoIWF1dGguY3VycmVudFVzZXIpIHsgICAgICAgICAgICAgICAgICAgICBzaG93TG9naW4gPSB0cnVlOyAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGNvbm5lY3RBY2NvdW50KCk7ICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgIH19PgpmdW5jdGlvbiBjcmVhdGVfZGVmYXVsdF9zbG90XzExKGN0eCkgewoJbGV0IHQ7CgoJcmV0dXJuIHsKCQljKCkgewoJCQl0ID0gdGV4dCgiQ29ubmVjdCB3aXRoIGxvZ2luIik7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIHQsIGFuY2hvcik7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2godCk7CgkJCX0KCQl9Cgl9Owp9CgovLyAoMjcyOjEyKSA8QnV0dG9uIHR5cGU9ImZpbGxlZCIgb246Y2xpY2s9eygpID0+IChzaG93TG9naW4gPSBmYWxzZSl9ICAgICAgICAgICAgICAgPgpmdW5jdGlvbiBjcmVhdGVfZGVmYXVsdF9zbG90XzEwKGN0eCkgewoJbGV0IHQ7CgoJcmV0dXJuIHsKCQljKCkgewoJCQl0ID0gdGV4dCgiQ2FuY2VsIik7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIHQsIGFuY2hvcik7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2godCk7CgkJCX0KCQl9Cgl9Owp9CgovLyAoMjc1OjEyKSA8QnV0dG9uIHR5cGU9Im91dGxpbmVkIiBvbjpjbGljaz17Y29ubmVjdFN3YXJtfSAgICAgICAgICAgICAgID4KZnVuY3Rpb24gY3JlYXRlX2RlZmF1bHRfc2xvdF85KGN0eCkgewoJbGV0IHQ7CgoJcmV0dXJuIHsKCQljKCkgewoJCQl0ID0gdGV4dCgiSSB1bmRlcnN0YW5kLCBDb25uZWN0Iik7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIHQsIGFuY2hvcik7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2godCk7CgkJCX0KCQl9Cgl9Owp9CgovLyAoMjY1OjEwKSA8RGlhbG9nIGhlYWRsaW5lPSJXQVJOSU5HIiBiaW5kOm9wZW49e3Nob3dTd2FybVdhcm5pbmd9PgpmdW5jdGlvbiBjcmVhdGVfZGVmYXVsdF9zbG90XzgoY3R4KSB7CglsZXQgaDI7CglsZXQgdDE7CglsZXQgYnI7CglsZXQgdDI7CglsZXQgYnV0dG9uMDsKCWxldCB0MzsKCWxldCBidXR0b24xOwoJbGV0IGN1cnJlbnQ7CgoJYnV0dG9uMCA9IG5ldyBCdXR0b24kMSh7CgkJCXByb3BzOiB7CgkJCQl0eXBlOiAiZmlsbGVkIiwKCQkJCSQkc2xvdHM6IHsgZGVmYXVsdDogW2NyZWF0ZV9kZWZhdWx0X3Nsb3RfMTBdIH0sCgkJCQkkJHNjb3BlOiB7IGN0eCB9CgkJCX0KCQl9KTsKCglidXR0b24wLiRvbigiY2xpY2siLCAvKmNsaWNrX2hhbmRsZXJfNCovIGN0eFsyM10pOwoKCWJ1dHRvbjEgPSBuZXcgQnV0dG9uJDEoewoJCQlwcm9wczogewoJCQkJdHlwZTogIm91dGxpbmVkIiwKCQkJCSQkc2xvdHM6IHsgZGVmYXVsdDogW2NyZWF0ZV9kZWZhdWx0X3Nsb3RfOV0gfSwKCQkJCSQkc2NvcGU6IHsgY3R4IH0KCQkJfQoJCX0pOwoKCWJ1dHRvbjEuJG9uKCJjbGljayIsIC8qY29ubmVjdFN3YXJtKi8gY3R4WzE0XSk7CgoJcmV0dXJuIHsKCQljKCkgewoJCQloMiA9IGVsZW1lbnQoImgyIik7CgkJCWgyLnRleHRDb250ZW50ID0gIlRMUyBoYXMgbm90IGN1cnJlbnRseSBiZWVuIGltcGxlbWVudGVkIGZvciB0aGUgQWRyaWZ0IFN3YXJtLiBJdFxuICAgICAgICAgICAgICB3aWxsIGxhdGVyLCBidXQgdW50aWwgdGhlbiB5b3VyIGRhdGEgd2lsbCBub3QgYmUgcHJpdmF0ZSwgYW5kIHlvdVxuICAgICAgICAgICAgICBzaG91bGQgbm90IGVudGVyIGFueSBzZW5zaXRpdmUgaW5mb3JtYXRpb24gb24gYW55IHBhZ2UiOwoJCQl0MSA9IHNwYWNlKCk7CgkJCWJyID0gZWxlbWVudCgiYnIiKTsKCQkJdDIgPSBzcGFjZSgpOwoJCQljcmVhdGVfY29tcG9uZW50KGJ1dHRvbjAuJCQuZnJhZ21lbnQpOwoJCQl0MyA9IHNwYWNlKCk7CgkJCWNyZWF0ZV9jb21wb25lbnQoYnV0dG9uMS4kJC5mcmFnbWVudCk7CgkJCWF0dHIoaDIsICJjbGFzcyIsICJ0ZXh0LTJ4bCIpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBoMiwgYW5jaG9yKTsKCQkJaW5zZXJ0KHRhcmdldCwgdDEsIGFuY2hvcik7CgkJCWluc2VydCh0YXJnZXQsIGJyLCBhbmNob3IpOwoJCQlpbnNlcnQodGFyZ2V0LCB0MiwgYW5jaG9yKTsKCQkJbW91bnRfY29tcG9uZW50KGJ1dHRvbjAsIHRhcmdldCwgYW5jaG9yKTsKCQkJaW5zZXJ0KHRhcmdldCwgdDMsIGFuY2hvcik7CgkJCW1vdW50X2NvbXBvbmVudChidXR0b24xLCB0YXJnZXQsIGFuY2hvcik7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJcChjdHgsIGRpcnR5KSB7CgkJCWNvbnN0IGJ1dHRvbjBfY2hhbmdlcyA9IHt9OwoKCQkJaWYgKGRpcnR5WzFdICYgLyokJHNjb3BlKi8gNDA5NikgewoJCQkJYnV0dG9uMF9jaGFuZ2VzLiQkc2NvcGUgPSB7IGRpcnR5LCBjdHggfTsKCQkJfQoKCQkJYnV0dG9uMC4kc2V0KGJ1dHRvbjBfY2hhbmdlcyk7CgkJCWNvbnN0IGJ1dHRvbjFfY2hhbmdlcyA9IHt9OwoKCQkJaWYgKGRpcnR5WzFdICYgLyokJHNjb3BlKi8gNDA5NikgewoJCQkJYnV0dG9uMV9jaGFuZ2VzLiQkc2NvcGUgPSB7IGRpcnR5LCBjdHggfTsKCQkJfQoKCQkJYnV0dG9uMS4kc2V0KGJ1dHRvbjFfY2hhbmdlcyk7CgkJfSwKCQlpKGxvY2FsKSB7CgkJCWlmIChjdXJyZW50KSByZXR1cm47CgkJCXRyYW5zaXRpb25faW4oYnV0dG9uMC4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX2luKGJ1dHRvbjEuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlvKGxvY2FsKSB7CgkJCXRyYW5zaXRpb25fb3V0KGJ1dHRvbjAuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJdHJhbnNpdGlvbl9vdXQoYnV0dG9uMS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gZmFsc2U7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2goaDIpOwoJCQkJZGV0YWNoKHQxKTsKCQkJCWRldGFjaChicik7CgkJCQlkZXRhY2godDIpOwoJCQkJZGV0YWNoKHQzKTsKCQkJfQoKCQkJZGVzdHJveV9jb21wb25lbnQoYnV0dG9uMCwgZGV0YWNoaW5nKTsKCQkJZGVzdHJveV9jb21wb25lbnQoYnV0dG9uMSwgZGV0YWNoaW5nKTsKCQl9Cgl9Owp9CgovLyAoMjk1OjE0KSA8QnV0dG9uIHR5cGU9Im91dGxpbmVkIiBvbjpjbGljaz17KCkgPT4gKHNob3dMb2dpbiA9IGZhbHNlKX0gICAgICAgICAgICAgICAgID4KZnVuY3Rpb24gY3JlYXRlX2RlZmF1bHRfc2xvdF83KGN0eCkgewoJbGV0IHQ7CgoJcmV0dXJuIHsKCQljKCkgewoJCQl0ID0gdGV4dCgiQ2FuY2VsIik7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIHQsIGFuY2hvcik7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2godCk7CgkJCX0KCQl9Cgl9Owp9CgovLyAoMjk4OjE0KSA8QnV0dG9uICAgICAgICAgICAgICAgICB0eXBlPSJmaWxsZWQiICAgICAgICAgICAgICAgICBvbjpjbGljaz17YXN5bmMgKCkgPT4geyAgICAgICAgICAgICAgICAgICB0cnkgeyAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHNpZ25JbldpdGhFbWFpbEFuZFBhc3N3b3JkKCAgICAgICAgICAgICAgICAgICAgICAgZ2V0QXV0aCgpLCAgICAgICAgICAgICAgICAgICAgICAgZW1haWwsICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZCAgICAgICAgICAgICAgICAgICAgICk7ICAgICAgICAgICAgICAgICAgICAgY29ubmVjdEFjY291bnQoKTsgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgeyAgICAgICAgICAgICAgICAgICAgIHNuYWNrYmFyKHsgbWVzc2FnZTogZSwgY2xvc2FibGU6IHRydWUgfSk7ICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgIH19PgpmdW5jdGlvbiBjcmVhdGVfZGVmYXVsdF9zbG90XzYoY3R4KSB7CglsZXQgdDsKCglyZXR1cm4gewoJCWMoKSB7CgkJCXQgPSB0ZXh0KCJDb25uZWN0Iik7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWluc2VydCh0YXJnZXQsIHQsIGFuY2hvcik7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2godCk7CgkJCX0KCQl9Cgl9Owp9CgovLyAoMjgwOjEwKSA8RGlhbG9nIGhlYWRsaW5lPSJMb2cgaW4gdG8gY29ubmVjdCIgYmluZDpvcGVuPXtzaG93TG9naW59PgpmdW5jdGlvbiBjcmVhdGVfZGVmYXVsdF9zbG90XzUoY3R4KSB7CglsZXQgYnV0dG9uMDsKCWxldCB0MTsKCWxldCBicjsKCWxldCB0MjsKCWxldCB0ZXh0ZmllbGQwOwoJbGV0IHVwZGF0aW5nX3ZhbHVlOwoJbGV0IHQzOwoJbGV0IHRleHRmaWVsZDE7CglsZXQgdXBkYXRpbmdfdmFsdWVfMTsKCWxldCB0NDsKCWxldCBkaXY7CglsZXQgYnV0dG9uMTsKCWxldCB0NTsKCWxldCBidXR0b24yOwoJbGV0IGN1cnJlbnQ7CglsZXQgbW91bnRlZDsKCWxldCBkaXNwb3NlOwoKCWZ1bmN0aW9uIHRleHRmaWVsZDBfdmFsdWVfYmluZGluZyh2YWx1ZSkgewoJCS8qdGV4dGZpZWxkMF92YWx1ZV9iaW5kaW5nKi8gY3R4WzI2XSh2YWx1ZSk7Cgl9CgoJbGV0IHRleHRmaWVsZDBfcHJvcHMgPSB7IG5hbWU6ICJlbWFpbCIgfTsKCglpZiAoLyplbWFpbCovIGN0eFsyXSAhPT0gdm9pZCAwKSB7CgkJdGV4dGZpZWxkMF9wcm9wcy52YWx1ZSA9IC8qZW1haWwqLyBjdHhbMl07Cgl9CgoJdGV4dGZpZWxkMCA9IG5ldyBUZXh0RmllbGQkMSh7IHByb3BzOiB0ZXh0ZmllbGQwX3Byb3BzIH0pOwoJYmluZGluZ19jYWxsYmFja3MucHVzaCgoKSA9PiBiaW5kKHRleHRmaWVsZDAsICd2YWx1ZScsIHRleHRmaWVsZDBfdmFsdWVfYmluZGluZykpOwoKCWZ1bmN0aW9uIHRleHRmaWVsZDFfdmFsdWVfYmluZGluZyh2YWx1ZSkgewoJCS8qdGV4dGZpZWxkMV92YWx1ZV9iaW5kaW5nKi8gY3R4WzI3XSh2YWx1ZSk7Cgl9CgoJbGV0IHRleHRmaWVsZDFfcHJvcHMgPSB7CgkJbmFtZTogInBhc3N3b3JkIiwKCQlleHRyYU9wdGlvbnM6IHsgdHlwZTogInBhc3N3b3JkIiB9Cgl9OwoKCWlmICgvKnBhc3N3b3JkKi8gY3R4WzNdICE9PSB2b2lkIDApIHsKCQl0ZXh0ZmllbGQxX3Byb3BzLnZhbHVlID0gLypwYXNzd29yZCovIGN0eFszXTsKCX0KCgl0ZXh0ZmllbGQxID0gbmV3IFRleHRGaWVsZCQxKHsgcHJvcHM6IHRleHRmaWVsZDFfcHJvcHMgfSk7CgliaW5kaW5nX2NhbGxiYWNrcy5wdXNoKCgpID0+IGJpbmQodGV4dGZpZWxkMSwgJ3ZhbHVlJywgdGV4dGZpZWxkMV92YWx1ZV9iaW5kaW5nKSk7CgoJYnV0dG9uMSA9IG5ldyBCdXR0b24kMSh7CgkJCXByb3BzOiB7CgkJCQl0eXBlOiAib3V0bGluZWQiLAoJCQkJJCRzbG90czogeyBkZWZhdWx0OiBbY3JlYXRlX2RlZmF1bHRfc2xvdF83XSB9LAoJCQkJJCRzY29wZTogeyBjdHggfQoJCQl9CgkJfSk7CgoJYnV0dG9uMS4kb24oImNsaWNrIiwgLypjbGlja19oYW5kbGVyXzYqLyBjdHhbMjhdKTsKCglidXR0b24yID0gbmV3IEJ1dHRvbiQxKHsKCQkJcHJvcHM6IHsKCQkJCXR5cGU6ICJmaWxsZWQiLAoJCQkJJCRzbG90czogeyBkZWZhdWx0OiBbY3JlYXRlX2RlZmF1bHRfc2xvdF82XSB9LAoJCQkJJCRzY29wZTogeyBjdHggfQoJCQl9CgkJfSk7CgoJYnV0dG9uMi4kb24oImNsaWNrIiwgLypjbGlja19oYW5kbGVyXzcqLyBjdHhbMjldKTsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWJ1dHRvbjAgPSBlbGVtZW50KCJidXR0b24iKTsKCQkJYnV0dG9uMC50ZXh0Q29udGVudCA9ICJOZXcgaGVyZT8gQ3JlYXRlIGFuIGFjY291bnQiOwoJCQl0MSA9IHNwYWNlKCk7CgkJCWJyID0gZWxlbWVudCgiYnIiKTsKCQkJdDIgPSBzcGFjZSgpOwoJCQljcmVhdGVfY29tcG9uZW50KHRleHRmaWVsZDAuJCQuZnJhZ21lbnQpOwoJCQl0MyA9IHNwYWNlKCk7CgkJCWNyZWF0ZV9jb21wb25lbnQodGV4dGZpZWxkMS4kJC5mcmFnbWVudCk7CgkJCXQ0ID0gc3BhY2UoKTsKCQkJZGl2ID0gZWxlbWVudCgiZGl2Iik7CgkJCWNyZWF0ZV9jb21wb25lbnQoYnV0dG9uMS4kJC5mcmFnbWVudCk7CgkJCXQ1ID0gc3BhY2UoKTsKCQkJY3JlYXRlX2NvbXBvbmVudChidXR0b24yLiQkLmZyYWdtZW50KTsKCQkJYXR0cihidXR0b24wLCAiY2xhc3MiLCAidGV4dC1wcmltYXJ5IG15LTMiKTsKCQkJYXR0cihkaXYsICJjbGFzcyIsICJmbGV4IG10LTUiKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgYnV0dG9uMCwgYW5jaG9yKTsKCQkJaW5zZXJ0KHRhcmdldCwgdDEsIGFuY2hvcik7CgkJCWluc2VydCh0YXJnZXQsIGJyLCBhbmNob3IpOwoJCQlpbnNlcnQodGFyZ2V0LCB0MiwgYW5jaG9yKTsKCQkJbW91bnRfY29tcG9uZW50KHRleHRmaWVsZDAsIHRhcmdldCwgYW5jaG9yKTsKCQkJaW5zZXJ0KHRhcmdldCwgdDMsIGFuY2hvcik7CgkJCW1vdW50X2NvbXBvbmVudCh0ZXh0ZmllbGQxLCB0YXJnZXQsIGFuY2hvcik7CgkJCWluc2VydCh0YXJnZXQsIHQ0LCBhbmNob3IpOwoJCQlpbnNlcnQodGFyZ2V0LCBkaXYsIGFuY2hvcik7CgkJCW1vdW50X2NvbXBvbmVudChidXR0b24xLCBkaXYsIG51bGwpOwoJCQlhcHBlbmQoZGl2LCB0NSk7CgkJCW1vdW50X2NvbXBvbmVudChidXR0b24yLCBkaXYsIG51bGwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCgkJCWlmICghbW91bnRlZCkgewoJCQkJZGlzcG9zZSA9IGxpc3RlbihidXR0b24wLCAiY2xpY2siLCAvKmNsaWNrX2hhbmRsZXJfNSovIGN0eFsyNV0pOwoJCQkJbW91bnRlZCA9IHRydWU7CgkJCX0KCQl9LAoJCXAoY3R4LCBkaXJ0eSkgewoJCQljb25zdCB0ZXh0ZmllbGQwX2NoYW5nZXMgPSB7fTsKCgkJCWlmICghdXBkYXRpbmdfdmFsdWUgJiYgZGlydHlbMF0gJiAvKmVtYWlsKi8gNCkgewoJCQkJdXBkYXRpbmdfdmFsdWUgPSB0cnVlOwoJCQkJdGV4dGZpZWxkMF9jaGFuZ2VzLnZhbHVlID0gLyplbWFpbCovIGN0eFsyXTsKCQkJCWFkZF9mbHVzaF9jYWxsYmFjaygoKSA9PiB1cGRhdGluZ192YWx1ZSA9IGZhbHNlKTsKCQkJfQoKCQkJdGV4dGZpZWxkMC4kc2V0KHRleHRmaWVsZDBfY2hhbmdlcyk7CgkJCWNvbnN0IHRleHRmaWVsZDFfY2hhbmdlcyA9IHt9OwoKCQkJaWYgKCF1cGRhdGluZ192YWx1ZV8xICYmIGRpcnR5WzBdICYgLypwYXNzd29yZCovIDgpIHsKCQkJCXVwZGF0aW5nX3ZhbHVlXzEgPSB0cnVlOwoJCQkJdGV4dGZpZWxkMV9jaGFuZ2VzLnZhbHVlID0gLypwYXNzd29yZCovIGN0eFszXTsKCQkJCWFkZF9mbHVzaF9jYWxsYmFjaygoKSA9PiB1cGRhdGluZ192YWx1ZV8xID0gZmFsc2UpOwoJCQl9CgoJCQl0ZXh0ZmllbGQxLiRzZXQodGV4dGZpZWxkMV9jaGFuZ2VzKTsKCQkJY29uc3QgYnV0dG9uMV9jaGFuZ2VzID0ge307CgoJCQlpZiAoZGlydHlbMV0gJiAvKiQkc2NvcGUqLyA0MDk2KSB7CgkJCQlidXR0b24xX2NoYW5nZXMuJCRzY29wZSA9IHsgZGlydHksIGN0eCB9OwoJCQl9CgoJCQlidXR0b24xLiRzZXQoYnV0dG9uMV9jaGFuZ2VzKTsKCQkJY29uc3QgYnV0dG9uMl9jaGFuZ2VzID0ge307CgoJCQlpZiAoZGlydHlbMV0gJiAvKiQkc2NvcGUqLyA0MDk2KSB7CgkJCQlidXR0b24yX2NoYW5nZXMuJCRzY29wZSA9IHsgZGlydHksIGN0eCB9OwoJCQl9CgoJCQlidXR0b24yLiRzZXQoYnV0dG9uMl9jaGFuZ2VzKTsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbih0ZXh0ZmllbGQwLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25faW4odGV4dGZpZWxkMS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX2luKGJ1dHRvbjEuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJdHJhbnNpdGlvbl9pbihidXR0b24yLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJbyhsb2NhbCkgewoJCQl0cmFuc2l0aW9uX291dCh0ZXh0ZmllbGQwLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25fb3V0KHRleHRmaWVsZDEuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJdHJhbnNpdGlvbl9vdXQoYnV0dG9uMS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX291dChidXR0b24yLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChidXR0b24wKTsKCQkJCWRldGFjaCh0MSk7CgkJCQlkZXRhY2goYnIpOwoJCQkJZGV0YWNoKHQyKTsKCQkJCWRldGFjaCh0Myk7CgkJCQlkZXRhY2godDQpOwoJCQkJZGV0YWNoKGRpdik7CgkJCX0KCgkJCWRlc3Ryb3lfY29tcG9uZW50KHRleHRmaWVsZDAsIGRldGFjaGluZyk7CgkJCWRlc3Ryb3lfY29tcG9uZW50KHRleHRmaWVsZDEsIGRldGFjaGluZyk7CgkJCWRlc3Ryb3lfY29tcG9uZW50KGJ1dHRvbjEpOwoJCQlkZXN0cm95X2NvbXBvbmVudChidXR0b24yKTsKCQkJbW91bnRlZCA9IGZhbHNlOwoJCQlkaXNwb3NlKCk7CgkJfQoJfTsKfQoKLy8gKDMyOToxNCkgPEJ1dHRvbiAgICAgICAgICAgICAgICAgdHlwZT0iZmlsbGVkIiAgICAgICAgICAgICAgICAgb246Y2xpY2s9e2FzeW5jICgpID0+IHsgICAgICAgICAgICAgICAgICAgdHJ5IHsgICAgICAgICAgICAgICAgICAgICBhd2FpdCBjcmVhdGVVc2VyV2l0aEVtYWlsQW5kUGFzc3dvcmQoICAgICAgICAgICAgICAgICAgICAgICBnZXRBdXRoKCksICAgICAgICAgICAgICAgICAgICAgICBlbWFpbCwgICAgICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkICAgICAgICAgICAgICAgICAgICAgKTsgICAgICAgICAgICAgICAgICAgICBjcmVhdGVhY2NvdW50ID0gZmFsc2U7ICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsgICAgICAgICAgICAgICAgICAgICBzbmFja2Jhcih7IG1lc3NhZ2U6IGUsIGNsb3NhYmxlOiB0cnVlIH0pOyAgICAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgICB9fT4KZnVuY3Rpb24gY3JlYXRlX2RlZmF1bHRfc2xvdF80KGN0eCkgewoJbGV0IHQ7CgoJcmV0dXJuIHsKCQljKCkgewoJCQl0ID0gdGV4dCgiQ3JlYXRlIEFjY291bnQiKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgdCwgYW5jaG9yKTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaCh0KTsKCQkJfQoJCX0KCX07Cn0KCi8vICgzMTU6MTApIDxEaWFsb2cgYmluZDpvcGVuPXtjcmVhdGVhY2NvdW50fSBoZWFkbGluZT0iQ3JlYXRlIGFuIGFjY291bnQiPgpmdW5jdGlvbiBjcmVhdGVfZGVmYXVsdF9zbG90XzMoY3R4KSB7CglsZXQgdGV4dGZpZWxkMDsKCWxldCB1cGRhdGluZ192YWx1ZTsKCWxldCB0MDsKCWxldCB0ZXh0ZmllbGQxOwoJbGV0IHVwZGF0aW5nX3ZhbHVlXzE7CglsZXQgdDE7CglsZXQgcDsKCWxldCB0MzsKCWxldCBkaXY7CglsZXQgYnV0dG9uOwoJbGV0IGN1cnJlbnQ7CgoJZnVuY3Rpb24gdGV4dGZpZWxkMF92YWx1ZV9iaW5kaW5nXzEodmFsdWUpIHsKCQkvKnRleHRmaWVsZDBfdmFsdWVfYmluZGluZ18xKi8gY3R4WzMxXSh2YWx1ZSk7Cgl9CgoJbGV0IHRleHRmaWVsZDBfcHJvcHMgPSB7IG5hbWU6ICJlbWFpbCIgfTsKCglpZiAoLyplbWFpbCovIGN0eFsyXSAhPT0gdm9pZCAwKSB7CgkJdGV4dGZpZWxkMF9wcm9wcy52YWx1ZSA9IC8qZW1haWwqLyBjdHhbMl07Cgl9CgoJdGV4dGZpZWxkMCA9IG5ldyBUZXh0RmllbGQkMSh7IHByb3BzOiB0ZXh0ZmllbGQwX3Byb3BzIH0pOwoJYmluZGluZ19jYWxsYmFja3MucHVzaCgoKSA9PiBiaW5kKHRleHRmaWVsZDAsICd2YWx1ZScsIHRleHRmaWVsZDBfdmFsdWVfYmluZGluZ18xKSk7CgoJZnVuY3Rpb24gdGV4dGZpZWxkMV92YWx1ZV9iaW5kaW5nXzEodmFsdWUpIHsKCQkvKnRleHRmaWVsZDFfdmFsdWVfYmluZGluZ18xKi8gY3R4WzMyXSh2YWx1ZSk7Cgl9CgoJbGV0IHRleHRmaWVsZDFfcHJvcHMgPSB7CgkJbmFtZTogInBhc3N3b3JkIiwKCQlleHRyYU9wdGlvbnM6IHsgdHlwZTogInBhc3N3b3JkIiB9Cgl9OwoKCWlmICgvKnBhc3N3b3JkKi8gY3R4WzNdICE9PSB2b2lkIDApIHsKCQl0ZXh0ZmllbGQxX3Byb3BzLnZhbHVlID0gLypwYXNzd29yZCovIGN0eFszXTsKCX0KCgl0ZXh0ZmllbGQxID0gbmV3IFRleHRGaWVsZCQxKHsgcHJvcHM6IHRleHRmaWVsZDFfcHJvcHMgfSk7CgliaW5kaW5nX2NhbGxiYWNrcy5wdXNoKCgpID0+IGJpbmQodGV4dGZpZWxkMSwgJ3ZhbHVlJywgdGV4dGZpZWxkMV92YWx1ZV9iaW5kaW5nXzEpKTsKCglidXR0b24gPSBuZXcgQnV0dG9uJDEoewoJCQlwcm9wczogewoJCQkJdHlwZTogImZpbGxlZCIsCgkJCQkkJHNsb3RzOiB7IGRlZmF1bHQ6IFtjcmVhdGVfZGVmYXVsdF9zbG90XzRdIH0sCgkJCQkkJHNjb3BlOiB7IGN0eCB9CgkJCX0KCQl9KTsKCglidXR0b24uJG9uKCJjbGljayIsIC8qY2xpY2tfaGFuZGxlcl84Ki8gY3R4WzMzXSk7CgoJcmV0dXJuIHsKCQljKCkgewoJCQljcmVhdGVfY29tcG9uZW50KHRleHRmaWVsZDAuJCQuZnJhZ21lbnQpOwoJCQl0MCA9IHNwYWNlKCk7CgkJCWNyZWF0ZV9jb21wb25lbnQodGV4dGZpZWxkMS4kJC5mcmFnbWVudCk7CgkJCXQxID0gc3BhY2UoKTsKCQkJcCA9IGVsZW1lbnQoInAiKTsKCQkJcC50ZXh0Q29udGVudCA9ICJOb3RlOiB0byBiZSBhYmxlIHRvIGNvbm5lY3QsIHlvdSdsbCBuZWVkIHRvIGRvd25sb2FkIGFuIGV4aXQgbm9kZVxuICAgICAgICAgICAgICBhbmQgcnVuIGl0IG9uIGEgY29tcHV0ZXIgd2l0aCBhbiB1bmNlbnNvcmVkIGludGVybmV0IGNvbm5lY3Rpb24iOwoJCQl0MyA9IHNwYWNlKCk7CgkJCWRpdiA9IGVsZW1lbnQoImRpdiIpOwoJCQljcmVhdGVfY29tcG9uZW50KGJ1dHRvbi4kJC5mcmFnbWVudCk7CgkJCWF0dHIoZGl2LCAiY2xhc3MiLCAiZmxleCBtdC01Iik7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCW1vdW50X2NvbXBvbmVudCh0ZXh0ZmllbGQwLCB0YXJnZXQsIGFuY2hvcik7CgkJCWluc2VydCh0YXJnZXQsIHQwLCBhbmNob3IpOwoJCQltb3VudF9jb21wb25lbnQodGV4dGZpZWxkMSwgdGFyZ2V0LCBhbmNob3IpOwoJCQlpbnNlcnQodGFyZ2V0LCB0MSwgYW5jaG9yKTsKCQkJaW5zZXJ0KHRhcmdldCwgcCwgYW5jaG9yKTsKCQkJaW5zZXJ0KHRhcmdldCwgdDMsIGFuY2hvcik7CgkJCWluc2VydCh0YXJnZXQsIGRpdiwgYW5jaG9yKTsKCQkJbW91bnRfY29tcG9uZW50KGJ1dHRvbiwgZGl2LCBudWxsKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlwKGN0eCwgZGlydHkpIHsKCQkJY29uc3QgdGV4dGZpZWxkMF9jaGFuZ2VzID0ge307CgoJCQlpZiAoIXVwZGF0aW5nX3ZhbHVlICYmIGRpcnR5WzBdICYgLyplbWFpbCovIDQpIHsKCQkJCXVwZGF0aW5nX3ZhbHVlID0gdHJ1ZTsKCQkJCXRleHRmaWVsZDBfY2hhbmdlcy52YWx1ZSA9IC8qZW1haWwqLyBjdHhbMl07CgkJCQlhZGRfZmx1c2hfY2FsbGJhY2soKCkgPT4gdXBkYXRpbmdfdmFsdWUgPSBmYWxzZSk7CgkJCX0KCgkJCXRleHRmaWVsZDAuJHNldCh0ZXh0ZmllbGQwX2NoYW5nZXMpOwoJCQljb25zdCB0ZXh0ZmllbGQxX2NoYW5nZXMgPSB7fTsKCgkJCWlmICghdXBkYXRpbmdfdmFsdWVfMSAmJiBkaXJ0eVswXSAmIC8qcGFzc3dvcmQqLyA4KSB7CgkJCQl1cGRhdGluZ192YWx1ZV8xID0gdHJ1ZTsKCQkJCXRleHRmaWVsZDFfY2hhbmdlcy52YWx1ZSA9IC8qcGFzc3dvcmQqLyBjdHhbM107CgkJCQlhZGRfZmx1c2hfY2FsbGJhY2soKCkgPT4gdXBkYXRpbmdfdmFsdWVfMSA9IGZhbHNlKTsKCQkJfQoKCQkJdGV4dGZpZWxkMS4kc2V0KHRleHRmaWVsZDFfY2hhbmdlcyk7CgkJCWNvbnN0IGJ1dHRvbl9jaGFuZ2VzID0ge307CgoJCQlpZiAoZGlydHlbMV0gJiAvKiQkc2NvcGUqLyA0MDk2KSB7CgkJCQlidXR0b25fY2hhbmdlcy4kJHNjb3BlID0geyBkaXJ0eSwgY3R4IH07CgkJCX0KCgkJCWJ1dHRvbi4kc2V0KGJ1dHRvbl9jaGFuZ2VzKTsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCQkJdHJhbnNpdGlvbl9pbih0ZXh0ZmllbGQwLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25faW4odGV4dGZpZWxkMS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX2luKGJ1dHRvbi4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQodGV4dGZpZWxkMC4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX291dCh0ZXh0ZmllbGQxLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25fb3V0KGJ1dHRvbi4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gZmFsc2U7CgkJfSwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2godDApOwoJCQkJZGV0YWNoKHQxKTsKCQkJCWRldGFjaChwKTsKCQkJCWRldGFjaCh0Myk7CgkJCQlkZXRhY2goZGl2KTsKCQkJfQoKCQkJZGVzdHJveV9jb21wb25lbnQodGV4dGZpZWxkMCwgZGV0YWNoaW5nKTsKCQkJZGVzdHJveV9jb21wb25lbnQodGV4dGZpZWxkMSwgZGV0YWNoaW5nKTsKCQkJZGVzdHJveV9jb21wb25lbnQoYnV0dG9uKTsKCQl9Cgl9Owp9CgovLyAoMjAzOjgpIDxDYXJkICAgICAgICAgICB0eXBlPSJlbGV2YXRlZCIgICAgICAgICAgIGV4dHJhT3B0aW9ucz17eyAgICAgICAgICAgICBjbGFzczogIm0zLWNvbnRhaW5lciB0eXBlLWVsZXZhdGVkIHctOS8xMiBmbGV4IGZsZXgtY29sIiwgICAgICAgICAgIH19ICAgICAgICAgPgpmdW5jdGlvbiBjcmVhdGVfZGVmYXVsdF9zbG90XzIoY3R4KSB7CglsZXQgaDIwOwoJbGV0IHQxOwoJbGV0IGgyMTsKCWxldCB0MzsKCWxldCBkaXYwOwoJbGV0IHQ0OwoJbGV0IGRpdjE7CglsZXQgdDU7CglsZXQgZGl2MjsKCWxldCB0NjsKCWxldCBkaWFsb2cwOwoJbGV0IHVwZGF0aW5nX29wZW47CglsZXQgdDc7CglsZXQgZGlhbG9nMTsKCWxldCB1cGRhdGluZ19vcGVuXzE7CglsZXQgdDg7CglsZXQgZGlhbG9nMjsKCWxldCB1cGRhdGluZ19vcGVuXzI7CglsZXQgY3VycmVudDsKCWxldCBlYWNoX3ZhbHVlID0gZW5zdXJlX2FycmF5X2xpa2UoT2JqZWN0LmtleXModHJhY2tlcnMpKTsKCWxldCBlYWNoX2Jsb2NrcyA9IFtdOwoKCWZvciAobGV0IGkgPSAwOyBpIDwgZWFjaF92YWx1ZS5sZW5ndGg7IGkgKz0gMSkgewoJCWVhY2hfYmxvY2tzW2ldID0gY3JlYXRlX2VhY2hfYmxvY2soZ2V0X2VhY2hfY29udGV4dChjdHgsIGVhY2hfdmFsdWUsIGkpKTsKCX0KCgljb25zdCBvdXQgPSBpID0+IHRyYW5zaXRpb25fb3V0KGVhY2hfYmxvY2tzW2ldLCAxLCAxLCAoKSA9PiB7CgkJZWFjaF9ibG9ja3NbaV0gPSBudWxsOwoJfSk7CgoJbGV0IGlmX2Jsb2NrID0gLypjaG9zZW5UcmFja2VyKi8gY3R4WzddICYmIGNyZWF0ZV9pZl9ibG9ja18zKGN0eCk7CgoJZnVuY3Rpb24gZGlhbG9nMF9vcGVuX2JpbmRpbmcodmFsdWUpIHsKCQkvKmRpYWxvZzBfb3Blbl9iaW5kaW5nKi8gY3R4WzI0XSh2YWx1ZSk7Cgl9CgoJbGV0IGRpYWxvZzBfcHJvcHMgPSB7CgkJaGVhZGxpbmU6ICJXQVJOSU5HIiwKCQkkJHNsb3RzOiB7IGRlZmF1bHQ6IFtjcmVhdGVfZGVmYXVsdF9zbG90XzhdIH0sCgkJJCRzY29wZTogeyBjdHggfQoJfTsKCglpZiAoLypzaG93U3dhcm1XYXJuaW5nKi8gY3R4WzVdICE9PSB2b2lkIDApIHsKCQlkaWFsb2cwX3Byb3BzLm9wZW4gPSAvKnNob3dTd2FybVdhcm5pbmcqLyBjdHhbNV07Cgl9CgoJZGlhbG9nMCA9IG5ldyBEaWFsb2ckMSh7IHByb3BzOiBkaWFsb2cwX3Byb3BzIH0pOwoJYmluZGluZ19jYWxsYmFja3MucHVzaCgoKSA9PiBiaW5kKGRpYWxvZzAsICdvcGVuJywgZGlhbG9nMF9vcGVuX2JpbmRpbmcpKTsKCglmdW5jdGlvbiBkaWFsb2cxX29wZW5fYmluZGluZyh2YWx1ZSkgewoJCS8qZGlhbG9nMV9vcGVuX2JpbmRpbmcqLyBjdHhbMzBdKHZhbHVlKTsKCX0KCglsZXQgZGlhbG9nMV9wcm9wcyA9IHsKCQloZWFkbGluZTogIkxvZyBpbiB0byBjb25uZWN0IiwKCQkkJHNsb3RzOiB7IGRlZmF1bHQ6IFtjcmVhdGVfZGVmYXVsdF9zbG90XzVdIH0sCgkJJCRzY29wZTogeyBjdHggfQoJfTsKCglpZiAoLypzaG93TG9naW4qLyBjdHhbNl0gIT09IHZvaWQgMCkgewoJCWRpYWxvZzFfcHJvcHMub3BlbiA9IC8qc2hvd0xvZ2luKi8gY3R4WzZdOwoJfQoKCWRpYWxvZzEgPSBuZXcgRGlhbG9nJDEoeyBwcm9wczogZGlhbG9nMV9wcm9wcyB9KTsKCWJpbmRpbmdfY2FsbGJhY2tzLnB1c2goKCkgPT4gYmluZChkaWFsb2cxLCAnb3BlbicsIGRpYWxvZzFfb3Blbl9iaW5kaW5nKSk7CgoJZnVuY3Rpb24gZGlhbG9nMl9vcGVuX2JpbmRpbmcodmFsdWUpIHsKCQkvKmRpYWxvZzJfb3Blbl9iaW5kaW5nKi8gY3R4WzM0XSh2YWx1ZSk7Cgl9CgoJbGV0IGRpYWxvZzJfcHJvcHMgPSB7CgkJaGVhZGxpbmU6ICJDcmVhdGUgYW4gYWNjb3VudCIsCgkJJCRzbG90czogeyBkZWZhdWx0OiBbY3JlYXRlX2RlZmF1bHRfc2xvdF8zXSB9LAoJCSQkc2NvcGU6IHsgY3R4IH0KCX07CgoJaWYgKC8qY3JlYXRlYWNjb3VudCovIGN0eFs5XSAhPT0gdm9pZCAwKSB7CgkJZGlhbG9nMl9wcm9wcy5vcGVuID0gLypjcmVhdGVhY2NvdW50Ki8gY3R4WzldOwoJfQoKCWRpYWxvZzIgPSBuZXcgRGlhbG9nJDEoeyBwcm9wczogZGlhbG9nMl9wcm9wcyB9KTsKCWJpbmRpbmdfY2FsbGJhY2tzLnB1c2goKCkgPT4gYmluZChkaWFsb2cyLCAnb3BlbicsIGRpYWxvZzJfb3Blbl9iaW5kaW5nKSk7CgoJcmV0dXJuIHsKCQljKCkgewoJCQloMjAgPSBlbGVtZW50KCJoMiIpOwoJCQloMjAudGV4dENvbnRlbnQgPSAiU2VsZWN0IGEgVHJhY2tlciI7CgkJCXQxID0gc3BhY2UoKTsKCQkJaDIxID0gZWxlbWVudCgiaDIiKTsKCQkJaDIxLnRleHRDb250ZW50ID0gIlRyYWNrZXJzIGFsbG93IHlvdSB0byBjb25uZWN0IHRvIEFkcmlmdCI7CgkJCXQzID0gc3BhY2UoKTsKCQkJZGl2MCA9IGVsZW1lbnQoImRpdiIpOwoKCQkJZm9yIChsZXQgaSA9IDA7IGkgPCBlYWNoX2Jsb2Nrcy5sZW5ndGg7IGkgKz0gMSkgewoJCQkJZWFjaF9ibG9ja3NbaV0uYygpOwoJCQl9CgoJCQl0NCA9IHNwYWNlKCk7CgkJCWRpdjEgPSBlbGVtZW50KCJkaXYiKTsKCQkJdDUgPSBzcGFjZSgpOwoJCQlkaXYyID0gZWxlbWVudCgiZGl2Iik7CgkJCWlmIChpZl9ibG9jaykgaWZfYmxvY2suYygpOwoJCQl0NiA9IHNwYWNlKCk7CgkJCWNyZWF0ZV9jb21wb25lbnQoZGlhbG9nMC4kJC5mcmFnbWVudCk7CgkJCXQ3ID0gc3BhY2UoKTsKCQkJY3JlYXRlX2NvbXBvbmVudChkaWFsb2cxLiQkLmZyYWdtZW50KTsKCQkJdDggPSBzcGFjZSgpOwoJCQljcmVhdGVfY29tcG9uZW50KGRpYWxvZzIuJCQuZnJhZ21lbnQpOwoJCQlhdHRyKGgyMCwgImNsYXNzIiwgInRleHQtNHhsIik7CgkJCWF0dHIoaDIxLCAiY2xhc3MiLCAidGV4dC0xeGwiKTsKCQkJYXR0cihkaXYwLCAiY2xhc3MiLCAibXQtNSBzcGFjZS15LTMiKTsKCQkJYXR0cihkaXYxLCAiY2xhc3MiLCAiZmxleC0xIik7CgkJCWF0dHIoZGl2MiwgImNsYXNzIiwgIm10LTUgZmxleCIpOwoJCX0sCgkJbSh0YXJnZXQsIGFuY2hvcikgewoJCQlpbnNlcnQodGFyZ2V0LCBoMjAsIGFuY2hvcik7CgkJCWluc2VydCh0YXJnZXQsIHQxLCBhbmNob3IpOwoJCQlpbnNlcnQodGFyZ2V0LCBoMjEsIGFuY2hvcik7CgkJCWluc2VydCh0YXJnZXQsIHQzLCBhbmNob3IpOwoJCQlpbnNlcnQodGFyZ2V0LCBkaXYwLCBhbmNob3IpOwoKCQkJZm9yIChsZXQgaSA9IDA7IGkgPCBlYWNoX2Jsb2Nrcy5sZW5ndGg7IGkgKz0gMSkgewoJCQkJaWYgKGVhY2hfYmxvY2tzW2ldKSB7CgkJCQkJZWFjaF9ibG9ja3NbaV0ubShkaXYwLCBudWxsKTsKCQkJCX0KCQkJfQoKCQkJaW5zZXJ0KHRhcmdldCwgdDQsIGFuY2hvcik7CgkJCWluc2VydCh0YXJnZXQsIGRpdjEsIGFuY2hvcik7CgkJCWluc2VydCh0YXJnZXQsIHQ1LCBhbmNob3IpOwoJCQlpbnNlcnQodGFyZ2V0LCBkaXYyLCBhbmNob3IpOwoJCQlpZiAoaWZfYmxvY2spIGlmX2Jsb2NrLm0oZGl2MiwgbnVsbCk7CgkJCWluc2VydCh0YXJnZXQsIHQ2LCBhbmNob3IpOwoJCQltb3VudF9jb21wb25lbnQoZGlhbG9nMCwgdGFyZ2V0LCBhbmNob3IpOwoJCQlpbnNlcnQodGFyZ2V0LCB0NywgYW5jaG9yKTsKCQkJbW91bnRfY29tcG9uZW50KGRpYWxvZzEsIHRhcmdldCwgYW5jaG9yKTsKCQkJaW5zZXJ0KHRhcmdldCwgdDgsIGFuY2hvcik7CgkJCW1vdW50X2NvbXBvbmVudChkaWFsb2cyLCB0YXJnZXQsIGFuY2hvcik7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJcChjdHgsIGRpcnR5KSB7CgkJCWlmIChkaXJ0eVswXSAmIC8qdHJhY2tlcnN0YXR1c2VzLCBjaG9zZW5UcmFja2VyKi8gMjE3NikgewoJCQkJZWFjaF92YWx1ZSA9IGVuc3VyZV9hcnJheV9saWtlKE9iamVjdC5rZXlzKHRyYWNrZXJzKSk7CgkJCQlsZXQgaTsKCgkJCQlmb3IgKGkgPSAwOyBpIDwgZWFjaF92YWx1ZS5sZW5ndGg7IGkgKz0gMSkgewoJCQkJCWNvbnN0IGNoaWxkX2N0eCA9IGdldF9lYWNoX2NvbnRleHQoY3R4LCBlYWNoX3ZhbHVlLCBpKTsKCgkJCQkJaWYgKGVhY2hfYmxvY2tzW2ldKSB7CgkJCQkJCWVhY2hfYmxvY2tzW2ldLnAoY2hpbGRfY3R4LCBkaXJ0eSk7CgkJCQkJCXRyYW5zaXRpb25faW4oZWFjaF9ibG9ja3NbaV0sIDEpOwoJCQkJCX0gZWxzZSB7CgkJCQkJCWVhY2hfYmxvY2tzW2ldID0gY3JlYXRlX2VhY2hfYmxvY2soY2hpbGRfY3R4KTsKCQkJCQkJZWFjaF9ibG9ja3NbaV0uYygpOwoJCQkJCQl0cmFuc2l0aW9uX2luKGVhY2hfYmxvY2tzW2ldLCAxKTsKCQkJCQkJZWFjaF9ibG9ja3NbaV0ubShkaXYwLCBudWxsKTsKCQkJCQl9CgkJCQl9CgoJCQkJZ3JvdXBfb3V0cm9zKCk7CgoJCQkJZm9yIChpID0gZWFjaF92YWx1ZS5sZW5ndGg7IGkgPCBlYWNoX2Jsb2Nrcy5sZW5ndGg7IGkgKz0gMSkgewoJCQkJCW91dChpKTsKCQkJCX0KCgkJCQljaGVja19vdXRyb3MoKTsKCQkJfQoKCQkJaWYgKC8qY2hvc2VuVHJhY2tlciovIGN0eFs3XSkgewoJCQkJaWYgKGlmX2Jsb2NrKSB7CgkJCQkJaWZfYmxvY2sucChjdHgsIGRpcnR5KTsKCgkJCQkJaWYgKGRpcnR5WzBdICYgLypjaG9zZW5UcmFja2VyKi8gMTI4KSB7CgkJCQkJCXRyYW5zaXRpb25faW4oaWZfYmxvY2ssIDEpOwoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJaWZfYmxvY2sgPSBjcmVhdGVfaWZfYmxvY2tfMyhjdHgpOwoJCQkJCWlmX2Jsb2NrLmMoKTsKCQkJCQl0cmFuc2l0aW9uX2luKGlmX2Jsb2NrLCAxKTsKCQkJCQlpZl9ibG9jay5tKGRpdjIsIG51bGwpOwoJCQkJfQoJCQl9IGVsc2UgaWYgKGlmX2Jsb2NrKSB7CgkJCQlncm91cF9vdXRyb3MoKTsKCgkJCQl0cmFuc2l0aW9uX291dChpZl9ibG9jaywgMSwgMSwgKCkgPT4gewoJCQkJCWlmX2Jsb2NrID0gbnVsbDsKCQkJCX0pOwoKCQkJCWNoZWNrX291dHJvcygpOwoJCQl9CgoJCQljb25zdCBkaWFsb2cwX2NoYW5nZXMgPSB7fTsKCgkJCWlmIChkaXJ0eVswXSAmIC8qc2hvd0xvZ2luKi8gNjQgfCBkaXJ0eVsxXSAmIC8qJCRzY29wZSovIDQwOTYpIHsKCQkJCWRpYWxvZzBfY2hhbmdlcy4kJHNjb3BlID0geyBkaXJ0eSwgY3R4IH07CgkJCX0KCgkJCWlmICghdXBkYXRpbmdfb3BlbiAmJiBkaXJ0eVswXSAmIC8qc2hvd1N3YXJtV2FybmluZyovIDMyKSB7CgkJCQl1cGRhdGluZ19vcGVuID0gdHJ1ZTsKCQkJCWRpYWxvZzBfY2hhbmdlcy5vcGVuID0gLypzaG93U3dhcm1XYXJuaW5nKi8gY3R4WzVdOwoJCQkJYWRkX2ZsdXNoX2NhbGxiYWNrKCgpID0+IHVwZGF0aW5nX29wZW4gPSBmYWxzZSk7CgkJCX0KCgkJCWRpYWxvZzAuJHNldChkaWFsb2cwX2NoYW5nZXMpOwoJCQljb25zdCBkaWFsb2cxX2NoYW5nZXMgPSB7fTsKCgkJCWlmIChkaXJ0eVswXSAmIC8qZW1haWwsIHBhc3N3b3JkLCBzbmFja2Jhciwgc2hvd0xvZ2luLCBjcmVhdGVhY2NvdW50Ki8gMTYxMiB8IGRpcnR5WzFdICYgLyokJHNjb3BlKi8gNDA5NikgewoJCQkJZGlhbG9nMV9jaGFuZ2VzLiQkc2NvcGUgPSB7IGRpcnR5LCBjdHggfTsKCQkJfQoKCQkJaWYgKCF1cGRhdGluZ19vcGVuXzEgJiYgZGlydHlbMF0gJiAvKnNob3dMb2dpbiovIDY0KSB7CgkJCQl1cGRhdGluZ19vcGVuXzEgPSB0cnVlOwoJCQkJZGlhbG9nMV9jaGFuZ2VzLm9wZW4gPSAvKnNob3dMb2dpbiovIGN0eFs2XTsKCQkJCWFkZF9mbHVzaF9jYWxsYmFjaygoKSA9PiB1cGRhdGluZ19vcGVuXzEgPSBmYWxzZSk7CgkJCX0KCgkJCWRpYWxvZzEuJHNldChkaWFsb2cxX2NoYW5nZXMpOwoJCQljb25zdCBkaWFsb2cyX2NoYW5nZXMgPSB7fTsKCgkJCWlmIChkaXJ0eVswXSAmIC8qZW1haWwsIHBhc3N3b3JkLCBjcmVhdGVhY2NvdW50LCBzbmFja2JhciovIDE1NDggfCBkaXJ0eVsxXSAmIC8qJCRzY29wZSovIDQwOTYpIHsKCQkJCWRpYWxvZzJfY2hhbmdlcy4kJHNjb3BlID0geyBkaXJ0eSwgY3R4IH07CgkJCX0KCgkJCWlmICghdXBkYXRpbmdfb3Blbl8yICYmIGRpcnR5WzBdICYgLypjcmVhdGVhY2NvdW50Ki8gNTEyKSB7CgkJCQl1cGRhdGluZ19vcGVuXzIgPSB0cnVlOwoJCQkJZGlhbG9nMl9jaGFuZ2VzLm9wZW4gPSAvKmNyZWF0ZWFjY291bnQqLyBjdHhbOV07CgkJCQlhZGRfZmx1c2hfY2FsbGJhY2soKCkgPT4gdXBkYXRpbmdfb3Blbl8yID0gZmFsc2UpOwoJCQl9CgoJCQlkaWFsb2cyLiRzZXQoZGlhbG9nMl9jaGFuZ2VzKTsKCQl9LAoJCWkobG9jYWwpIHsKCQkJaWYgKGN1cnJlbnQpIHJldHVybjsKCgkJCWZvciAobGV0IGkgPSAwOyBpIDwgZWFjaF92YWx1ZS5sZW5ndGg7IGkgKz0gMSkgewoJCQkJdHJhbnNpdGlvbl9pbihlYWNoX2Jsb2Nrc1tpXSk7CgkJCX0KCgkJCXRyYW5zaXRpb25faW4oaWZfYmxvY2spOwoJCQl0cmFuc2l0aW9uX2luKGRpYWxvZzAuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJdHJhbnNpdGlvbl9pbihkaWFsb2cxLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25faW4oZGlhbG9nMi4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJZWFjaF9ibG9ja3MgPSBlYWNoX2Jsb2Nrcy5maWx0ZXIoQm9vbGVhbik7CgoJCQlmb3IgKGxldCBpID0gMDsgaSA8IGVhY2hfYmxvY2tzLmxlbmd0aDsgaSArPSAxKSB7CgkJCQl0cmFuc2l0aW9uX291dChlYWNoX2Jsb2Nrc1tpXSk7CgkJCX0KCgkJCXRyYW5zaXRpb25fb3V0KGlmX2Jsb2NrKTsKCQkJdHJhbnNpdGlvbl9vdXQoZGlhbG9nMC4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX291dChkaWFsb2cxLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCXRyYW5zaXRpb25fb3V0KGRpYWxvZzIuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IGZhbHNlOwoJCX0sCgkJZChkZXRhY2hpbmcpIHsKCQkJaWYgKGRldGFjaGluZykgewoJCQkJZGV0YWNoKGgyMCk7CgkJCQlkZXRhY2godDEpOwoJCQkJZGV0YWNoKGgyMSk7CgkJCQlkZXRhY2godDMpOwoJCQkJZGV0YWNoKGRpdjApOwoJCQkJZGV0YWNoKHQ0KTsKCQkJCWRldGFjaChkaXYxKTsKCQkJCWRldGFjaCh0NSk7CgkJCQlkZXRhY2goZGl2Mik7CgkJCQlkZXRhY2godDYpOwoJCQkJZGV0YWNoKHQ3KTsKCQkJCWRldGFjaCh0OCk7CgkJCX0KCgkJCWRlc3Ryb3lfZWFjaChlYWNoX2Jsb2NrcywgZGV0YWNoaW5nKTsKCQkJaWYgKGlmX2Jsb2NrKSBpZl9ibG9jay5kKCk7CgkJCWRlc3Ryb3lfY29tcG9uZW50KGRpYWxvZzAsIGRldGFjaGluZyk7CgkJCWRlc3Ryb3lfY29tcG9uZW50KGRpYWxvZzEsIGRldGFjaGluZyk7CgkJCWRlc3Ryb3lfY29tcG9uZW50KGRpYWxvZzIsIGRldGFjaGluZyk7CgkJfQoJfTsKfQoKLy8gKDM0OTo4KSA8Q2FyZCAgICAgICAgICAgdHlwZT0iZWxldmF0ZWQiICAgICAgICAgICBleHRyYU9wdGlvbnM9e3sgY2xhc3M6ICJtMy1jb250YWluZXIgdHlwZS1lbGV2YXRlZCB3LWZ1bGwiIH19ICAgICAgICAgPgpmdW5jdGlvbiBjcmVhdGVfZGVmYXVsdF9zbG90XzEoY3R4KSB7CglsZXQgZGl2MjsKCglyZXR1cm4gewoJCWMoKSB7CgkJCWRpdjIgPSBlbGVtZW50KCJkaXYiKTsKCQkJZGl2Mi5pbm5lckhUTUwgPSBgPGEgY2xhc3M9InRleHQtMXhsIiBocmVmPSJodHRwczovL21lcmN1cnl3b3JrLnNob3AiPsKpIDIwMjMgTWVyY3VyeSBXb3Jrc2hvcDwvYT4gPGRpdiBjbGFzcz0ic3BhY2UteC0zIj48YSBjbGFzcz0idGV4dC0xeGwiIGhyZWY9Imh0dHBzOi8vZGlzY29yZC5nZy9iQWdOeUdwWFN4Ij5kaXNjb3JkPC9hPiA8YSBjbGFzcz0idGV4dC0xeGwiIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9NZXJjdXJ5V29ya3Nob3AiPmdpdGh1YjwvYT48L2Rpdj4gPGRpdj48L2Rpdj5gOwoJCQlhdHRyKGRpdjIsICJjbGFzcyIsICJmbGV4IHNwYWNlLXgtMTAiKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgZGl2MiwgYW5jaG9yKTsKCQl9LAoJCXA6IG5vb3AkNCwKCQlkKGRldGFjaGluZykgewoJCQlpZiAoZGV0YWNoaW5nKSB7CgkJCQlkZXRhY2goZGl2Mik7CgkJCX0KCQl9Cgl9Owp9CgovLyAoMTMwOjQpIDxDYXJkIHR5cGU9Im91dGxpbmVkIj4KZnVuY3Rpb24gY3JlYXRlX2RlZmF1bHRfc2xvdChjdHgpIHsKCWxldCBkaXYxOwoJbGV0IGNpcmN1bGFycHJvZ3Jlc3NpbmRldGVybWluYXRlOwoJbGV0IHQwOwoJbGV0IGRpdjA7CglsZXQgdDE7CglsZXQgaDI7CglsZXQgdDI7CglsZXQgdDM7CglsZXQgYnIwOwoJbGV0IHQ0OwoJbGV0IHA7CglsZXQgY3VycmVudDsKCWNpcmN1bGFycHJvZ3Jlc3NpbmRldGVybWluYXRlID0gbmV3IENpcmN1bGFyUHJvZ3Jlc3NJbmRldGVybWluYXRlJDEoe30pOwoKCXJldHVybiB7CgkJYygpIHsKCQkJZGl2MSA9IGVsZW1lbnQoImRpdiIpOwoJCQljcmVhdGVfY29tcG9uZW50KGNpcmN1bGFycHJvZ3Jlc3NpbmRldGVybWluYXRlLiQkLmZyYWdtZW50KTsKCQkJdDAgPSBzcGFjZSgpOwoJCQlkaXYwID0gZWxlbWVudCgiZGl2Iik7CgkJCXQxID0gc3BhY2UoKTsKCQkJaDIgPSBlbGVtZW50KCJoMiIpOwoJCQl0MiA9IHRleHQoLypjb25uZWN0aW9uU3RhdGUqLyBjdHhbNF0pOwoJCQl0MyA9IHNwYWNlKCk7CgkJCWJyMCA9IGVsZW1lbnQoImJyIik7CgkJCXQ0ID0gc3BhY2UoKTsKCQkJcCA9IGVsZW1lbnQoInAiKTsKCgkJCXAuaW5uZXJIVE1MID0gYEFkcmlmdCBpcyByb3V0aW5nIHlvdSB0byBhIHNlcnZlciBhdmFpbGFibGUgdG8gdGFrZSB5b3VyIHJlcXVlc3RzLjxici8+VGhlIGluaXRpYWwgY29ubmVjdGlvbiBtYXkgdGFrZSBzZXZlcmFsIG1pbnV0ZXMgZGVwZW5kaW5nIG9uIHNlcnZlcgogICAgICAgIGxvYWRgOwoKCQkJYXR0cihkaXYwLCAiY2xhc3MiLCAicC01Iik7CgkJCWF0dHIoaDIsICJjbGFzcyIsICJ0ZXh0LXhsIik7CgkJCWF0dHIoZGl2MSwgImNsYXNzIiwgImZsZXggaXRlbXMtY2VudGVyIHAtMiIpOwoJCQlhdHRyKHAsICJjbGFzcyIsICJ0ZXh0LXNtIG9wYWNpdHktNzAiKTsKCQl9LAoJCW0odGFyZ2V0LCBhbmNob3IpIHsKCQkJaW5zZXJ0KHRhcmdldCwgZGl2MSwgYW5jaG9yKTsKCQkJbW91bnRfY29tcG9uZW50KGNpcmN1bGFycHJvZ3Jlc3NpbmRldGVybWluYXRlLCBkaXYxLCBudWxsKTsKCQkJYXBwZW5kKGRpdjEsIHQwKTsKCQkJYXBwZW5kKGRpdjEsIGRpdjApOwoJCQlhcHBlbmQoZGl2MSwgdDEpOwoJCQlhcHBlbmQoZGl2MSwgaDIpOwoJCQlhcHBlbmQoaDIsIHQyKTsKCQkJaW5zZXJ0KHRhcmdldCwgdDMsIGFuY2hvcik7CgkJCWluc2VydCh0YXJnZXQsIGJyMCwgYW5jaG9yKTsKCQkJaW5zZXJ0KHRhcmdldCwgdDQsIGFuY2hvcik7CgkJCWluc2VydCh0YXJnZXQsIHAsIGFuY2hvcik7CgkJCWN1cnJlbnQgPSB0cnVlOwoJCX0sCgkJcChjdHgsIGRpcnR5KSB7CgkJCWlmICghY3VycmVudCB8fCBkaXJ0eVswXSAmIC8qY29ubmVjdGlvblN0YXRlKi8gMTYpIHNldF9kYXRhKHQyLCAvKmNvbm5lY3Rpb25TdGF0ZSovIGN0eFs0XSk7CgkJfSwKCQlpKGxvY2FsKSB7CgkJCWlmIChjdXJyZW50KSByZXR1cm47CgkJCXRyYW5zaXRpb25faW4oY2lyY3VsYXJwcm9ncmVzc2luZGV0ZXJtaW5hdGUuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJY3VycmVudCA9IHRydWU7CgkJfSwKCQlvKGxvY2FsKSB7CgkJCXRyYW5zaXRpb25fb3V0KGNpcmN1bGFycHJvZ3Jlc3NpbmRldGVybWluYXRlLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaChkaXYxKTsKCQkJCWRldGFjaCh0Myk7CgkJCQlkZXRhY2goYnIwKTsKCQkJCWRldGFjaCh0NCk7CgkJCQlkZXRhY2gocCk7CgkJCX0KCgkJCWRlc3Ryb3lfY29tcG9uZW50KGNpcmN1bGFycHJvZ3Jlc3NpbmRldGVybWluYXRlKTsKCQl9Cgl9Owp9CgpmdW5jdGlvbiBjcmVhdGVfZnJhZ21lbnQoY3R4KSB7CglsZXQgY3VycmVudF9ibG9ja190eXBlX2luZGV4OwoJbGV0IGlmX2Jsb2NrOwoJbGV0IHQwOwoJbGV0IHN3aXRjaF9pbnN0YW5jZTsKCWxldCB1cGRhdGluZ19zaG93OwoJbGV0IHQxOwoJbGV0IHN0eWxlZnJvbXNjaGVtZTsKCWxldCBjdXJyZW50OwoJY29uc3QgaWZfYmxvY2tfY3JlYXRvcnMgPSBbY3JlYXRlX2lmX2Jsb2NrLCBjcmVhdGVfaWZfYmxvY2tfMSwgY3JlYXRlX2lmX2Jsb2NrXzIsIGNyZWF0ZV9lbHNlX2Jsb2NrXTsKCWNvbnN0IGlmX2Jsb2NrcyA9IFtdOwoKCWZ1bmN0aW9uIHNlbGVjdF9ibG9ja190eXBlKGN0eCwgZGlydHkpIHsKCQlpZiAoLypzdGF0ZSovIGN0eFsxXSA9PSAvKlJlYWR5U3RhdGUqLyBjdHhbMF0uQ29ubmVjdGVkKSByZXR1cm4gMDsKCQlpZiAoLypzdGF0ZSovIGN0eFsxXSA9PSAvKlJlYWR5U3RhdGUqLyBjdHhbMF0uQ29ubmVjdGluZykgcmV0dXJuIDE7CgkJcmV0dXJuIDI7Cgl9CgoJY3VycmVudF9ibG9ja190eXBlX2luZGV4ID0gc2VsZWN0X2Jsb2NrX3R5cGUoY3R4KTsKCWlmX2Jsb2NrID0gaWZfYmxvY2tzW2N1cnJlbnRfYmxvY2tfdHlwZV9pbmRleF0gPSBpZl9ibG9ja19jcmVhdG9yc1tjdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXhdKGN0eCk7CgoJZnVuY3Rpb24gc3dpdGNoX2luc3RhbmNlX3Nob3dfYmluZGluZyh2YWx1ZSkgewoJCS8qc3dpdGNoX2luc3RhbmNlX3Nob3dfYmluZGluZyovIGN0eFszNV0odmFsdWUpOwoJfQoKCXZhciBzd2l0Y2hfdmFsdWUgPSBTbmFja2JhckFuaW0kMTsKCglmdW5jdGlvbiBzd2l0Y2hfcHJvcHMoY3R4LCBkaXJ0eSkgewoJCWxldCBzd2l0Y2hfaW5zdGFuY2VfcHJvcHMgPSB7fTsKCgkJaWYgKC8qc25hY2tiYXIqLyBjdHhbMTBdICE9PSB2b2lkIDApIHsKCQkJc3dpdGNoX2luc3RhbmNlX3Byb3BzLnNob3cgPSAvKnNuYWNrYmFyKi8gY3R4WzEwXTsKCQl9CgoJCXJldHVybiB7IHByb3BzOiBzd2l0Y2hfaW5zdGFuY2VfcHJvcHMgfTsKCX0KCglpZiAoc3dpdGNoX3ZhbHVlKSB7CgkJc3dpdGNoX2luc3RhbmNlID0gY29uc3RydWN0X3N2ZWx0ZV9jb21wb25lbnQoc3dpdGNoX3ZhbHVlLCBzd2l0Y2hfcHJvcHMoY3R4KSk7CgkJYmluZGluZ19jYWxsYmFja3MucHVzaCgoKSA9PiBiaW5kKHN3aXRjaF9pbnN0YW5jZSwgJ3Nob3cnLCBzd2l0Y2hfaW5zdGFuY2Vfc2hvd19iaW5kaW5nKSk7Cgl9CgoJc3R5bGVmcm9tc2NoZW1lID0gbmV3IFN0eWxlRnJvbVNjaGVtZSQxKHsKCQkJcHJvcHM6IHsKCQkJCWxpZ2h0U2NoZW1lOiB7CgkJCQkJcHJpbWFyeTogMTI4NDgzMTExOSwKCQkJCQlvblByaW1hcnk6IDQyOTQ5NjcyOTUsCgkJCQkJcHJpbWFyeUNvbnRhaW5lcjogNDI5MzUxNjc5OSwKCQkJCQlvblByaW1hcnlDb250YWluZXI6IDQyODAyOTEzOTksCgkJCQkJaW52ZXJzZVByaW1hcnk6IDQyOTE4MDQ2NzAsCgkJCQkJc2Vjb25kYXJ5OiA0Mjg0NjM2MDE3LAoJCQkJCW9uU2Vjb25kYXJ5OiA0Mjk0OTY3Mjk1LAoJCQkJCXNlY29uZGFyeUNvbnRhaW5lcjogNDI5MzQ1MTUxMiwKCQkJCQlvblNlY29uZGFyeUNvbnRhaW5lcjogNDI4MDE2MjYwMywKCQkJCQl0ZXJ0aWFyeTogNDI4NjQ2ODcwNCwKCQkJCQlvblRlcnRpYXJ5OiA0Mjk0OTY3Mjk1LAoJCQkJCXRlcnRpYXJ5Q29udGFpbmVyOiA0Mjk0OTU3NTM5LAoJCQkJCW9uVGVydGlhcnlDb250YWluZXI6IDQyODE0MDU0NjksCgkJCQkJZXJyb3I6IDQyOTAzODY0NTgsCgkJCQkJb25FcnJvcjogNDI5NDk2NzI5NSwKCQkJCQllcnJvckNvbnRhaW5lcjogNDI5NDk1Nzc4MiwKCQkJCQlvbkVycm9yQ29udGFpbmVyOiA0MjgyNDQ5OTIyLAoJCQkJCWJhY2tncm91bmQ6IDQyOTQ4MzQxNzUsCgkJCQkJb25CYWNrZ3JvdW5kOiA0MjgwMDk3NTY4LAoJCQkJCXN1cmZhY2U6IDQyOTQ4MzQxNzUsCgkJCQkJb25TdXJmYWNlOiA0MjgwMDk3NTY4LAoJCQkJCXN1cmZhY2VWYXJpYW50OiA0MjkzMzg2NDc1LAoJCQkJCW9uU3VyZmFjZVZhcmlhbnQ6IDQyODI5OTE5NTAsCgkJCQkJaW52ZXJzZVN1cmZhY2U6IDQyODE0Nzg5NjUsCgkJCQkJaW52ZXJzZU9uU3VyZmFjZTogNDI5NDMwNzgzMSwKCQkJCQlvdXRsaW5lOiA0Mjg2MjE1NTUxLAoJCQkJCW91dGxpbmVWYXJpYW50OiA0MjkxNDc4NzM1LAoJCQkJCXNoYWRvdzogNDI3ODE5MDA4MCwKCQkJCQlzY3JpbTogNDI3ODE5MDA4MCwKCQkJCQlzdXJmYWNlRGltOiA0MjkyNzk0NTkyLAoJCQkJCXN1cmZhY2VCcmlnaHQ6IDQyOTQ4MzQxNzUsCgkJCQkJc3VyZmFjZUNvbnRhaW5lckxvd2VzdDogNDI5NDk2NzI5NSwKCQkJCQlzdXJmYWNlQ29udGFpbmVyTG93OiA0Mjk0NTA1MjEwLAoJCQkJCXN1cmZhY2VDb250YWluZXI6IDQyOTQxMTA0NTIsCgkJCQkJc3VyZmFjZUNvbnRhaW5lckhpZ2g6IDQyOTM3MTU2OTQsCgkJCQkJc3VyZmFjZUNvbnRhaW5lckhpZ2hlc3Q6IDQyOTMzMjA5MzcsCgkJCQkJc3VyZmFjZVRpbnQ6IDQyODQ4MzExMTkKCQkJCX0sCgkJCQlkYXJrU2NoZW1lOiB7CgkJCQkJcHJpbWFyeTogMTI5MTgwNDY3MCwKCQkJCQlvblByaW1hcnk6IDQyODE3MzkxMDEsCgkJCQkJcHJpbWFyeUNvbnRhaW5lcjogNDI4MzI1MjA4NSwKCQkJCQlvblByaW1hcnlDb250YWluZXI6IDQyOTM1MTY3OTksCgkJCQkJaW52ZXJzZVByaW1hcnk6IDQyODQ4MzExMTksCgkJCQkJc2Vjb25kYXJ5OiA0MjkxNTQzNzcxLAoJCQkJCW9uU2Vjb25kYXJ5OiA0MjgxNTQ0MDAxLAoJCQkJCXNlY29uZGFyeUNvbnRhaW5lcjogNDI4MzA1NzI0MCwKCQkJCQlvblNlY29uZGFyeUNvbnRhaW5lcjogNDI5MzQ1MTUxMiwKCQkJCQl0ZXJ0aWFyeTogNDI5MzkwMDQ4OCwKCQkJCQlvblRlcnRpYXJ5OiA0MjgzMDQ5MjY2LAoJCQkJCXRlcnRpYXJ5Q29udGFpbmVyOiA0Mjg0NjkzMzIwLAoJCQkJCW9uVGVydGlhcnlDb250YWluZXI6IDQyOTQ5NTc1MzksCgkJCQkJZXJyb3I6IDQyOTQ5NDgwMTEsCgkJCQkJb25FcnJvcjogNDI4NTA3MTM2NSwKCQkJCQllcnJvckNvbnRhaW5lcjogNDI4NzgyMzg4MiwKCQkJCQlvbkVycm9yQ29udGFpbmVyOiA0Mjk0OTU3NzgyLAoJCQkJCWJhY2tncm91bmQ6IDQyNzk1MDU0MzIsCgkJCQkJb25CYWNrZ3JvdW5kOiA0MjkzMzIwOTM3LAoJCQkJCXN1cmZhY2U6IDQyNzk1MDU0MzIsCgkJCQkJb25TdXJmYWNlOiA0MjkzMzIwOTM3LAoJCQkJCXN1cmZhY2VWYXJpYW50OiA0MjgyOTkxOTUwLAoJCQkJCW9uU3VyZmFjZVZhcmlhbnQ6IDQyOTE0Nzg3MzUsCgkJCQkJaW52ZXJzZVN1cmZhY2U6IDQyOTMzMjA5MzcsCgkJCQkJaW52ZXJzZU9uU3VyZmFjZTogNDI4MTQ3ODk2NSwKCQkJCQlvdXRsaW5lOiA0Mjg3OTI2MTY5LAoJCQkJCW91dGxpbmVWYXJpYW50OiA0MjgyOTkxOTUwLAoJCQkJCXNoYWRvdzogNDI3ODE5MDA4MCwKCQkJCQlzY3JpbTogNDI3ODE5MDA4MCwKCQkJCQlzdXJmYWNlRGltOiA0Mjc5NTA1NDMyLAoJCQkJCXN1cmZhY2VCcmlnaHQ6IDQyODIwNzExMDIsCgkJCQkJc3VyZmFjZUNvbnRhaW5lckxvd2VzdDogNDI3OTE3NjQ2NywKCQkJCQlzdXJmYWNlQ29udGFpbmVyTG93OiA0MjgwMDk3NTY4LAoJCQkJCXN1cmZhY2VDb250YWluZXI6IDQyODAzNjA3NDAsCgkJCQkJc3VyZmFjZUNvbnRhaW5lckhpZ2g6IDQyODEwMTg2NzEsCgkJCQkJc3VyZmFjZUNvbnRhaW5lckhpZ2hlc3Q6IDQyODE3NDIzOTQsCgkJCQkJc3VyZmFjZVRpbnQ6IDQyOTE4MDQ2NzAKCQkJCX0KCQkJfQoJCX0pOwoKCXJldHVybiB7CgkJYygpIHsKCQkJaWZfYmxvY2suYygpOwoJCQl0MCA9IHNwYWNlKCk7CgkJCWlmIChzd2l0Y2hfaW5zdGFuY2UpIGNyZWF0ZV9jb21wb25lbnQoc3dpdGNoX2luc3RhbmNlLiQkLmZyYWdtZW50KTsKCQkJdDEgPSBzcGFjZSgpOwoJCQljcmVhdGVfY29tcG9uZW50KHN0eWxlZnJvbXNjaGVtZS4kJC5mcmFnbWVudCk7CgkJfSwKCQltKHRhcmdldCwgYW5jaG9yKSB7CgkJCWlmX2Jsb2Nrc1tjdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXhdLm0odGFyZ2V0LCBhbmNob3IpOwoJCQlpbnNlcnQodGFyZ2V0LCB0MCwgYW5jaG9yKTsKCQkJaWYgKHN3aXRjaF9pbnN0YW5jZSkgbW91bnRfY29tcG9uZW50KHN3aXRjaF9pbnN0YW5jZSwgdGFyZ2V0LCBhbmNob3IpOwoJCQlpbnNlcnQodGFyZ2V0LCB0MSwgYW5jaG9yKTsKCQkJbW91bnRfY29tcG9uZW50KHN0eWxlZnJvbXNjaGVtZSwgdGFyZ2V0LCBhbmNob3IpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCXAoY3R4LCBkaXJ0eSkgewoJCQlsZXQgcHJldmlvdXNfYmxvY2tfaW5kZXggPSBjdXJyZW50X2Jsb2NrX3R5cGVfaW5kZXg7CgkJCWN1cnJlbnRfYmxvY2tfdHlwZV9pbmRleCA9IHNlbGVjdF9ibG9ja190eXBlKGN0eCk7CgoJCQlpZiAoY3VycmVudF9ibG9ja190eXBlX2luZGV4ID09PSBwcmV2aW91c19ibG9ja19pbmRleCkgewoJCQkJaWZfYmxvY2tzW2N1cnJlbnRfYmxvY2tfdHlwZV9pbmRleF0ucChjdHgsIGRpcnR5KTsKCQkJfSBlbHNlIHsKCQkJCWdyb3VwX291dHJvcygpOwoKCQkJCXRyYW5zaXRpb25fb3V0KGlmX2Jsb2Nrc1twcmV2aW91c19ibG9ja19pbmRleF0sIDEsIDEsICgpID0+IHsKCQkJCQlpZl9ibG9ja3NbcHJldmlvdXNfYmxvY2tfaW5kZXhdID0gbnVsbDsKCQkJCX0pOwoKCQkJCWNoZWNrX291dHJvcygpOwoJCQkJaWZfYmxvY2sgPSBpZl9ibG9ja3NbY3VycmVudF9ibG9ja190eXBlX2luZGV4XTsKCgkJCQlpZiAoIWlmX2Jsb2NrKSB7CgkJCQkJaWZfYmxvY2sgPSBpZl9ibG9ja3NbY3VycmVudF9ibG9ja190eXBlX2luZGV4XSA9IGlmX2Jsb2NrX2NyZWF0b3JzW2N1cnJlbnRfYmxvY2tfdHlwZV9pbmRleF0oY3R4KTsKCQkJCQlpZl9ibG9jay5jKCk7CgkJCQl9IGVsc2UgewoJCQkJCWlmX2Jsb2NrLnAoY3R4LCBkaXJ0eSk7CgkJCQl9CgoJCQkJdHJhbnNpdGlvbl9pbihpZl9ibG9jaywgMSk7CgkJCQlpZl9ibG9jay5tKHQwLnBhcmVudE5vZGUsIHQwKTsKCQkJfQoKCQkJaWYgKHN3aXRjaF92YWx1ZSAhPT0gKHN3aXRjaF92YWx1ZSA9IFNuYWNrYmFyQW5pbSQxKSkgewoJCQkJaWYgKHN3aXRjaF9pbnN0YW5jZSkgewoJCQkJCWdyb3VwX291dHJvcygpOwoJCQkJCWNvbnN0IG9sZF9jb21wb25lbnQgPSBzd2l0Y2hfaW5zdGFuY2U7CgoJCQkJCXRyYW5zaXRpb25fb3V0KG9sZF9jb21wb25lbnQuJCQuZnJhZ21lbnQsIDEsIDAsICgpID0+IHsKCQkJCQkJZGVzdHJveV9jb21wb25lbnQob2xkX2NvbXBvbmVudCwgMSk7CgkJCQkJfSk7CgoJCQkJCWNoZWNrX291dHJvcygpOwoJCQkJfQoKCQkJCWlmIChzd2l0Y2hfdmFsdWUpIHsKCQkJCQlzd2l0Y2hfaW5zdGFuY2UgPSBjb25zdHJ1Y3Rfc3ZlbHRlX2NvbXBvbmVudChzd2l0Y2hfdmFsdWUsIHN3aXRjaF9wcm9wcyhjdHgpKTsKCQkJCQliaW5kaW5nX2NhbGxiYWNrcy5wdXNoKCgpID0+IGJpbmQoc3dpdGNoX2luc3RhbmNlLCAnc2hvdycsIHN3aXRjaF9pbnN0YW5jZV9zaG93X2JpbmRpbmcpKTsKCQkJCQljcmVhdGVfY29tcG9uZW50KHN3aXRjaF9pbnN0YW5jZS4kJC5mcmFnbWVudCk7CgkJCQkJdHJhbnNpdGlvbl9pbihzd2l0Y2hfaW5zdGFuY2UuJCQuZnJhZ21lbnQsIDEpOwoJCQkJCW1vdW50X2NvbXBvbmVudChzd2l0Y2hfaW5zdGFuY2UsIHQxLnBhcmVudE5vZGUsIHQxKTsKCQkJCX0gZWxzZSB7CgkJCQkJc3dpdGNoX2luc3RhbmNlID0gbnVsbDsKCQkJCX0KCQkJfSBlbHNlIGlmIChzd2l0Y2hfdmFsdWUpIHsKCQkJCWNvbnN0IHN3aXRjaF9pbnN0YW5jZV9jaGFuZ2VzID0ge307CgoJCQkJaWYgKCF1cGRhdGluZ19zaG93ICYmIGRpcnR5WzBdICYgLypzbmFja2JhciovIDEwMjQpIHsKCQkJCQl1cGRhdGluZ19zaG93ID0gdHJ1ZTsKCQkJCQlzd2l0Y2hfaW5zdGFuY2VfY2hhbmdlcy5zaG93ID0gLypzbmFja2JhciovIGN0eFsxMF07CgkJCQkJYWRkX2ZsdXNoX2NhbGxiYWNrKCgpID0+IHVwZGF0aW5nX3Nob3cgPSBmYWxzZSk7CgkJCQl9CgoJCQkJc3dpdGNoX2luc3RhbmNlLiRzZXQoc3dpdGNoX2luc3RhbmNlX2NoYW5nZXMpOwoJCQl9CgkJfSwKCQlpKGxvY2FsKSB7CgkJCWlmIChjdXJyZW50KSByZXR1cm47CgkJCXRyYW5zaXRpb25faW4oaWZfYmxvY2spOwoJCQlpZiAoc3dpdGNoX2luc3RhbmNlKSB0cmFuc2l0aW9uX2luKHN3aXRjaF9pbnN0YW5jZS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQl0cmFuc2l0aW9uX2luKHN0eWxlZnJvbXNjaGVtZS4kJC5mcmFnbWVudCwgbG9jYWwpOwoJCQljdXJyZW50ID0gdHJ1ZTsKCQl9LAoJCW8obG9jYWwpIHsKCQkJdHJhbnNpdGlvbl9vdXQoaWZfYmxvY2spOwoJCQlpZiAoc3dpdGNoX2luc3RhbmNlKSB0cmFuc2l0aW9uX291dChzd2l0Y2hfaW5zdGFuY2UuJCQuZnJhZ21lbnQsIGxvY2FsKTsKCQkJdHJhbnNpdGlvbl9vdXQoc3R5bGVmcm9tc2NoZW1lLiQkLmZyYWdtZW50LCBsb2NhbCk7CgkJCWN1cnJlbnQgPSBmYWxzZTsKCQl9LAoJCWQoZGV0YWNoaW5nKSB7CgkJCWlmIChkZXRhY2hpbmcpIHsKCQkJCWRldGFjaCh0MCk7CgkJCQlkZXRhY2godDEpOwoJCQl9CgoJCQlpZl9ibG9ja3NbY3VycmVudF9ibG9ja190eXBlX2luZGV4XS5kKGRldGFjaGluZyk7CgkJCWlmIChzd2l0Y2hfaW5zdGFuY2UpIGRlc3Ryb3lfY29tcG9uZW50KHN3aXRjaF9pbnN0YW5jZSwgZGV0YWNoaW5nKTsKCQkJZGVzdHJveV9jb21wb25lbnQoc3R5bGVmcm9tc2NoZW1lLCBkZXRhY2hpbmcpOwoJCX0KCX07Cn0KCmZ1bmN0aW9uIG9uVHJhbnNwb3J0Q2xvc2UoKSB7Cgljb25zb2xlLndhcm4oIlRyYW5zcG9ydCBjbG9zZWQiKTsKfQoKZnVuY3Rpb24gaW5zdGFuY2UoJCRzZWxmLCAkJHByb3BzLCAkJGludmFsaWRhdGUpIHsKCXZhciBSZWFkeVN0YXRlOwoKCShmdW5jdGlvbiAoUmVhZHlTdGF0ZSkgewoJCVJlYWR5U3RhdGVbUmVhZHlTdGF0ZVsiSWRsZSJdID0gMF0gPSAiSWRsZSI7CgkJUmVhZHlTdGF0ZVtSZWFkeVN0YXRlWyJDb25uZWN0aW5nIl0gPSAxXSA9ICJDb25uZWN0aW5nIjsKCQlSZWFkeVN0YXRlW1JlYWR5U3RhdGVbIkNvbm5lY3RlZCJdID0gMl0gPSAiQ29ubmVjdGVkIjsKCQlSZWFkeVN0YXRlW1JlYWR5U3RhdGVbIkFjY291bnRDcmVhdGlvbiJdID0gM10gPSAiQWNjb3VudENyZWF0aW9uIjsKCX0pKFJlYWR5U3RhdGUgfHwgKFJlYWR5U3RhdGUgPSB7fSkpOwoKCWxldCBzdGF0ZSA9IFJlYWR5U3RhdGUuSWRsZTsKCWxldCB0cmFuc3BvcnQ7CglsZXQgcnRjdHJhbnNwb3J0OwoJbGV0IGVtYWlsID0gIiI7CglsZXQgcGFzc3dvcmQgPSAiIjsKCWxldCBjb25uZWN0aW9uU3RhdGUgPSAiIjsKCWxldCBzaG93U3dhcm1XYXJuaW5nID0gZmFsc2U7CglsZXQgc2hvd0xvZ2luID0gZmFsc2U7CglsZXQgY2hvc2VuVHJhY2tlcjsKCWxldCBzaG93VHJhY2tlckxpc3QgPSBmYWxzZTsKCWxldCBjcmVhdGVhY2NvdW50ID0gZmFsc2U7CglsZXQgc25hY2tiYXI7CgoJYXN5bmMgZnVuY3Rpb24gb25UcmFuc3BvcnRPcGVuKCkgewoJCWNvbnNvbGUubG9nKCJUcmFuc3BvcnQgb3BlbmVkIik7CgkJbGV0IGNvbm5lY3Rpb24gPSBuZXcgQ29ubmVjdGlvbiQxKHRyYW5zcG9ydCk7CgkJYXdhaXQgY29ubmVjdGlvbi5pbml0aWFsaXplKCk7CgkJbGV0IGJhcmUgPSBuZXcgQWRyaWZ0QmFyZUNsaWVudChjb25uZWN0aW9uKTsKCQljb25zb2xlLmxvZyhzZXRCYXJlQ2xpZW50SW1wbGVtZW50YXRpb24kMSk7CgkJc2V0QmFyZUNsaWVudEltcGxlbWVudGF0aW9uJDEoYmFyZSk7CgkJJCRpbnZhbGlkYXRlKDEsIHN0YXRlID0gUmVhZHlTdGF0ZS5Db25uZWN0ZWQpOwoJfQoKCWZ1bmN0aW9uIGNyZWF0ZVJUQ1RyYW5zcG9ydCgpIHsKCQlsZXQgdHJhbnNwb3J0ID0gbmV3IFJUQ1RyYW5zcG9ydChvblRyYW5zcG9ydE9wZW4sCgkJb25UcmFuc3BvcnRDbG9zZSwKCQkoKSA9PiB7CgkJCQkkJGludmFsaWRhdGUoNCwgY29ubmVjdGlvblN0YXRlID0gYENvbm5lY3Rpb24gJHt0cmFuc3BvcnQucGVlci5jb25uZWN0aW9uU3RhdGV9Li4uYCk7CgkJCX0sCgkJKCkgPT4gewoJCQkJJCRpbnZhbGlkYXRlKDQsIGNvbm5lY3Rpb25TdGF0ZSA9IGBTaWduYWxpbmcgJHt0cmFuc3BvcnQucGVlci5jb25uZWN0aW9uU3RhdGV9Li4uYCk7CgkJCX0sCgkJKCkgPT4gewoJCQkJaWYgKHRyYW5zcG9ydC5wZWVyLmNvbm5lY3Rpb25TdGF0ZSA9PSAibmV3IikgewoJCQkJCSQkaW52YWxpZGF0ZSg0LCBjb25uZWN0aW9uU3RhdGUgPSBgQ3JlYXRpbmcgYW4gb2ZmZXIuLi5gKTsKCQkJCX0gZWxzZSB7CgkJCQkJJCRpbnZhbGlkYXRlKDQsIGNvbm5lY3Rpb25TdGF0ZSA9IGBHYXRoZXJpbmcgJHt0cmFuc3BvcnQucGVlci5jb25uZWN0aW9uU3RhdGV9Li4uYCk7CgkJCQl9CgkJCX0pOwoKCQlyZXR1cm4gdHJhbnNwb3J0OwoJfQoKCWFzeW5jIGZ1bmN0aW9uIGluaXRGaXJlYmFzZSgpIHsKCQlpZiAoIWNob3NlblRyYWNrZXIpIHJldHVybjsKCQlsZXQgdHJhY2tlciA9IHRyYWNrZXJzW2Nob3NlblRyYWNrZXJdOwoJCWluaXRpYWxpemVBcHAodHJhY2tlci5maXJlYmFzZSk7Cgl9CgoJYXN5bmMgZnVuY3Rpb24gY29ubmVjdEFjY291bnQoKSB7CgkJcnRjdHJhbnNwb3J0ID0gdHJhbnNwb3J0ID0gY3JlYXRlUlRDVHJhbnNwb3J0KCk7CgkJJCRpbnZhbGlkYXRlKDEsIHN0YXRlID0gUmVhZHlTdGF0ZS5Db25uZWN0aW5nKTsKCQlsZXQgb2ZmZXIgPSBhd2FpdCBydGN0cmFuc3BvcnQuY3JlYXRlT2ZmZXIoKTsKCQkkJGludmFsaWRhdGUoNCwgY29ubmVjdGlvblN0YXRlID0gIkZpbmRpbmcgeW91ciBub2RlLi4uIik7CgkJbGV0IGFuc3dlciA9IGF3YWl0IHNpZ25hbEFjY291bnQoSlNPTi5zdHJpbmdpZnkob2ZmZXIpKTsKCQkkJGludmFsaWRhdGUoNCwgY29ubmVjdGlvblN0YXRlID0gIkxpbmtpbmcgdG8gbm9kZS4uLiIpOwoKCQlhd2FpdCBuZXcgUHJvbWlzZShyID0+IHsKCQkJCXNldFRpbWVvdXQociwgMTAwMCk7CgkJCX0pOwoKCQlydGN0cmFuc3BvcnQuYW5zd2VyKGFuc3dlci5hbnN3ZXIsIGFuc3dlci5jYW5kaWRhdGVzKTsKCX0KCglhc3luYyBmdW5jdGlvbiBjb25uZWN0U3dhcm0oKSB7CgkJYXdhaXQgaW5pdEZpcmViYXNlKCk7CgkJJCRpbnZhbGlkYXRlKDEsIHN0YXRlID0gUmVhZHlTdGF0ZS5Db25uZWN0aW5nKTsKCQlydGN0cmFuc3BvcnQgPSB0cmFuc3BvcnQgPSBjcmVhdGVSVENUcmFuc3BvcnQoKTsKCQlsZXQgb2ZmZXIgPSBhd2FpdCBydGN0cmFuc3BvcnQuY3JlYXRlT2ZmZXIoKTsKCQkkJGludmFsaWRhdGUoNCwgY29ubmVjdGlvblN0YXRlID0gIlJvdXRpbmcgeW91IHRvIGFuIGF2YWlsYWJsZSBub2RlLi4uIik7CgoJCXRyeSB7CgkJCWxldCBhbnN3ZXIgPSBhd2FpdCBzaWduYWxTd2FybShKU09OLnN0cmluZ2lmeShvZmZlcikpOwoJCQkkJGludmFsaWRhdGUoNCwgY29ubmVjdGlvblN0YXRlID0gIkxpbmtpbmcgdG8gbm9kZS4uLiIpOwoKCQkJYXdhaXQgbmV3IFByb21pc2UociA9PiB7CgkJCQkJc2V0VGltZW91dChyLCA1MDApOwoJCQkJfSk7CgoJCQlydGN0cmFuc3BvcnQuYW5zd2VyKGFuc3dlci5hbnN3ZXIsIGFuc3dlci5jYW5kaWRhdGVzKTsKCQl9IGNhdGNoKGUpIHsKCQkJY29uc29sZS5lcnJvcihlKTsKCQkJJCRpbnZhbGlkYXRlKDQsIGNvbm5lY3Rpb25TdGF0ZSA9IGUpOwoJCX0KCX0KCglhc3luYyBmdW5jdGlvbiBjb25uZWN0RGV2SHR0cCgpIHsKCQlydGN0cmFuc3BvcnQgPSB0cmFuc3BvcnQgPSBjcmVhdGVSVENUcmFuc3BvcnQoKTsKCQlsZXQgb2ZmZXIgPSBhd2FpdCBydGN0cmFuc3BvcnQuY3JlYXRlT2ZmZXIoKTsKCQljb25zb2xlLmxvZygib2ZmZXIgY3JlYXRlZCIsIG9mZmVyKTsKCQljb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShvZmZlcikpOwoKCQljb25zdCByID0gYXdhaXQgZmV0Y2goImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9jb25uZWN0IiwgewoJCQltZXRob2Q6ICJQT1NUIiwKCQkJaGVhZGVyczogeyAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iIH0sCgkJCWJvZHk6IEpTT04uc3RyaW5naWZ5KG9mZmVyKQoJCX0pOwoKCQlpZiAoci5zdGF0dXMgIT0gMjAwKSB7CgkJCXRocm93IG5ldyBFcnJvcigiY29ubmVjdDogIiArIHIuc3RhdHVzICsgIiAiICsgci5zdGF0dXNUZXh0KTsKCQl9CgoJCWNvbnN0IHsgYW5zd2VyLCBjYW5kaWRhdGVzIH0gPSBhd2FpdCByLmpzb24oKTsKCQlhd2FpdCBydGN0cmFuc3BvcnQuYW5zd2VyKGFuc3dlciwgY2FuZGlkYXRlcyk7Cgl9CgoJYXN5bmMgZnVuY3Rpb24gY29ubmVjdERldldTKCkgewoJCXRyYW5zcG9ydCA9IG5ldyBEZXZXc1RyYW5zcG9ydChvblRyYW5zcG9ydE9wZW4sICgpID0+IGNvbnNvbGUubG9nKCJvbmNsb3NlIikpOwoJfQoKCWxldCB0cmFja2Vyc3RhdHVzZXMgPSB7fTsKCglmb3IgKGxldCBpZCBpbiB0cmFja2VycykgewoJCWxldCB0cmFja2VyID0gdHJhY2tlcnNbaWRdOwoJCXRyYWNrZXJzdGF0dXNlc1tpZF0gPSBudWxsOwoJCWxldCB1cmwgPSBuZXcgVVJMKGAke3RyYWNrZXIudHJhY2tlcn0vc3RhdHNgKTsKCQl1cmwucHJvdG9jb2wgPSAiaHR0cHM6Ly8iOwoKCQlmZXRjaCh1cmwpLnRoZW4oYXN5bmMgZGF0YSA9PiB7CgkJCSQkaW52YWxpZGF0ZSgxMSwgdHJhY2tlcnN0YXR1c2VzW2lkXSA9IGF3YWl0IGRhdGEuanNvbigpLCB0cmFja2Vyc3RhdHVzZXMpOwoJCQljb25zb2xlLmxvZyh0cmFja2Vyc3RhdHVzZXMpOwoJCX0pOwoJfQoKCWNvbnN0ICQkYmluZGluZ19ncm91cHMgPSBbW11dOwoJY29uc3QgY2xpY2tfaGFuZGxlciA9ICgpID0+ICQkaW52YWxpZGF0ZSg4LCBzaG93VHJhY2tlckxpc3QgPSB0cnVlKTsKCgljb25zdCBjbGlja19oYW5kbGVyXzEgPSAoKSA9PiB7CgkJZG93bmxvYWRTaG9ydGN1dCgiYWRyaWZ0Lmh0bWwiLCAiSG9tZXdvcmsiKTsKCX07CgoJZnVuY3Rpb24gaW5wdXRfY2hhbmdlX2hhbmRsZXIoKSB7CgkJY2hvc2VuVHJhY2tlciA9IHRoaXMuX192YWx1ZTsKCQkkJGludmFsaWRhdGUoNywgY2hvc2VuVHJhY2tlcik7Cgl9CgoJY29uc3QgY2xpY2tfaGFuZGxlcl8yID0gKCkgPT4gJCRpbnZhbGlkYXRlKDUsIHNob3dTd2FybVdhcm5pbmcgPSB0cnVlKTsKCgljb25zdCBjbGlja19oYW5kbGVyXzMgPSBhc3luYyAoKSA9PiB7CgkJYXdhaXQgaW5pdEZpcmViYXNlKCk7CgkJbGV0IGF1dGggPSBnZXRBdXRoKCk7CgkJYXdhaXQgc2V0UGVyc2lzdGVuY2UoYXV0aCwgYnJvd3NlckxvY2FsUGVyc2lzdGVuY2UpOwoKCQlpZiAoIWF1dGguY3VycmVudFVzZXIpIHsKCQkJJCRpbnZhbGlkYXRlKDYsIHNob3dMb2dpbiA9IHRydWUpOwoJCX0gZWxzZSB7CgkJCWF3YWl0IGNvbm5lY3RBY2NvdW50KCk7CgkJfQoJfTsKCgljb25zdCBjbGlja19oYW5kbGVyXzQgPSAoKSA9PiAkJGludmFsaWRhdGUoNiwgc2hvd0xvZ2luID0gZmFsc2UpOwoKCWZ1bmN0aW9uIGRpYWxvZzBfb3Blbl9iaW5kaW5nKHZhbHVlKSB7CgkJc2hvd1N3YXJtV2FybmluZyA9IHZhbHVlOwoJCSQkaW52YWxpZGF0ZSg1LCBzaG93U3dhcm1XYXJuaW5nKTsKCX0KCgljb25zdCBjbGlja19oYW5kbGVyXzUgPSAoKSA9PiAoJCRpbnZhbGlkYXRlKDksIGNyZWF0ZWFjY291bnQgPSB0cnVlKSwgJCRpbnZhbGlkYXRlKDYsIHNob3dMb2dpbiA9IGZhbHNlKSk7CgoJZnVuY3Rpb24gdGV4dGZpZWxkMF92YWx1ZV9iaW5kaW5nKHZhbHVlKSB7CgkJZW1haWwgPSB2YWx1ZTsKCQkkJGludmFsaWRhdGUoMiwgZW1haWwpOwoJfQoKCWZ1bmN0aW9uIHRleHRmaWVsZDFfdmFsdWVfYmluZGluZyh2YWx1ZSkgewoJCXBhc3N3b3JkID0gdmFsdWU7CgkJJCRpbnZhbGlkYXRlKDMsIHBhc3N3b3JkKTsKCX0KCgljb25zdCBjbGlja19oYW5kbGVyXzYgPSAoKSA9PiAkJGludmFsaWRhdGUoNiwgc2hvd0xvZ2luID0gZmFsc2UpOwoKCWNvbnN0IGNsaWNrX2hhbmRsZXJfNyA9IGFzeW5jICgpID0+IHsKCQl0cnkgewoJCQlhd2FpdCBzaWduSW5XaXRoRW1haWxBbmRQYXNzd29yZChnZXRBdXRoKCksIGVtYWlsLCBwYXNzd29yZCk7CgkJCWNvbm5lY3RBY2NvdW50KCk7CgkJfSBjYXRjaChlKSB7CgkJCXNuYWNrYmFyKHsgbWVzc2FnZTogZSwgY2xvc2FibGU6IHRydWUgfSk7CgkJfQoJfTsKCglmdW5jdGlvbiBkaWFsb2cxX29wZW5fYmluZGluZyh2YWx1ZSkgewoJCXNob3dMb2dpbiA9IHZhbHVlOwoJCSQkaW52YWxpZGF0ZSg2LCBzaG93TG9naW4pOwoJfQoKCWZ1bmN0aW9uIHRleHRmaWVsZDBfdmFsdWVfYmluZGluZ18xKHZhbHVlKSB7CgkJZW1haWwgPSB2YWx1ZTsKCQkkJGludmFsaWRhdGUoMiwgZW1haWwpOwoJfQoKCWZ1bmN0aW9uIHRleHRmaWVsZDFfdmFsdWVfYmluZGluZ18xKHZhbHVlKSB7CgkJcGFzc3dvcmQgPSB2YWx1ZTsKCQkkJGludmFsaWRhdGUoMywgcGFzc3dvcmQpOwoJfQoKCWNvbnN0IGNsaWNrX2hhbmRsZXJfOCA9IGFzeW5jICgpID0+IHsKCQl0cnkgewoJCQlhd2FpdCBjcmVhdGVVc2VyV2l0aEVtYWlsQW5kUGFzc3dvcmQoZ2V0QXV0aCgpLCBlbWFpbCwgcGFzc3dvcmQpOwoJCQkkJGludmFsaWRhdGUoOSwgY3JlYXRlYWNjb3VudCA9IGZhbHNlKTsKCQl9IGNhdGNoKGUpIHsKCQkJc25hY2tiYXIoeyBtZXNzYWdlOiBlLCBjbG9zYWJsZTogdHJ1ZSB9KTsKCQl9Cgl9OwoKCWZ1bmN0aW9uIGRpYWxvZzJfb3Blbl9iaW5kaW5nKHZhbHVlKSB7CgkJY3JlYXRlYWNjb3VudCA9IHZhbHVlOwoJCSQkaW52YWxpZGF0ZSg5LCBjcmVhdGVhY2NvdW50KTsKCX0KCglmdW5jdGlvbiBzd2l0Y2hfaW5zdGFuY2Vfc2hvd19iaW5kaW5nKHZhbHVlKSB7CgkJc25hY2tiYXIgPSB2YWx1ZTsKCQkkJGludmFsaWRhdGUoMTAsIHNuYWNrYmFyKTsKCX0KCglyZXR1cm4gWwoJCVJlYWR5U3RhdGUsCgkJc3RhdGUsCgkJZW1haWwsCgkJcGFzc3dvcmQsCgkJY29ubmVjdGlvblN0YXRlLAoJCXNob3dTd2FybVdhcm5pbmcsCgkJc2hvd0xvZ2luLAoJCWNob3NlblRyYWNrZXIsCgkJc2hvd1RyYWNrZXJMaXN0LAoJCWNyZWF0ZWFjY291bnQsCgkJc25hY2tiYXIsCgkJdHJhY2tlcnN0YXR1c2VzLAoJCWluaXRGaXJlYmFzZSwKCQljb25uZWN0QWNjb3VudCwKCQljb25uZWN0U3dhcm0sCgkJY29ubmVjdERldkh0dHAsCgkJY29ubmVjdERldldTLAoJCWNsaWNrX2hhbmRsZXIsCgkJY2xpY2tfaGFuZGxlcl8xLAoJCWlucHV0X2NoYW5nZV9oYW5kbGVyLAoJCSQkYmluZGluZ19ncm91cHMsCgkJY2xpY2tfaGFuZGxlcl8yLAoJCWNsaWNrX2hhbmRsZXJfMywKCQljbGlja19oYW5kbGVyXzQsCgkJZGlhbG9nMF9vcGVuX2JpbmRpbmcsCgkJY2xpY2tfaGFuZGxlcl81LAoJCXRleHRmaWVsZDBfdmFsdWVfYmluZGluZywKCQl0ZXh0ZmllbGQxX3ZhbHVlX2JpbmRpbmcsCgkJY2xpY2tfaGFuZGxlcl82LAoJCWNsaWNrX2hhbmRsZXJfNywKCQlkaWFsb2cxX29wZW5fYmluZGluZywKCQl0ZXh0ZmllbGQwX3ZhbHVlX2JpbmRpbmdfMSwKCQl0ZXh0ZmllbGQxX3ZhbHVlX2JpbmRpbmdfMSwKCQljbGlja19oYW5kbGVyXzgsCgkJZGlhbG9nMl9vcGVuX2JpbmRpbmcsCgkJc3dpdGNoX2luc3RhbmNlX3Nob3dfYmluZGluZwoJXTsKfQoKY2xhc3MgQXBwIGV4dGVuZHMgU3ZlbHRlQ29tcG9uZW50IHsKCWNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKCQlzdXBlcigpOwoJCWluaXQodGhpcywgb3B0aW9ucywgaW5zdGFuY2UsIGNyZWF0ZV9mcmFnbWVudCwgc2FmZV9ub3RfZXF1YWwsIHt9LCBudWxsLCBbLTEsIC0xXSk7Cgl9Cn0KCmNvbnN0IGluZGV4ID0gJyc7CgppZiAoKHt9KS5WSVRFX0FEUklGVF9DRE4gJiYgIjEiKSB7CiAgZG9jdW1lbnQuYm9keS5pbm5lckhUTUwgPSBgPGxpbmsgcmVsPSdzdHlsZXNoZWV0JyBocmVmPSdodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvYWRyaWZ0bmV0L3N0YXRpYy9pbmRleC04NjFkN2I4ZC5jc3MnIC8+IDxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iaHR0cHM6Ly9mb250cy5nb29nbGVhcGlzLmNvbS9jc3M/ZmFtaWx5PUNhYmluIj48ZGl2IGlkPSdhcHAnIC8+YDsKfQp7CiAgY29uc29sZS5sb2coCiAgICAiJWNBRFJJRlQgUlVOTklORyBJTiBQUk9EVUNUSU9OIE1PREUiLAogICAgImJhY2tncm91bmQ6IGJsdWU7IGNvbG9yOiB3aGl0ZTsgZm9udC1zaXplOiB4LWxhcmdlIgogICk7Cn0KbmV3IEFwcCh7CiAgdGFyZ2V0OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXBwIikKfSk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LWE5YjgyZGEyLmpzLm1hcAo=";
</script>
  <style>
:root{--m3-util-elevation-0: none;--m3-util-elevation-1: 0px 3px 1px -2px rgb(var(--m3-scheme-shadow) / .2), 0px 2px 2px 0px rgb(var(--m3-scheme-shadow) / .14), 0px 1px 5px 0px rgb(var(--m3-scheme-shadow) / .12);--m3-util-elevation-2: 0px 2px 4px -1px rgb(var(--m3-scheme-shadow) / .2), 0px 4px 5px 0px rgb(var(--m3-scheme-shadow) / .14), 0px 1px 10px 0px rgb(var(--m3-scheme-shadow) / .12);--m3-util-elevation-3: 0px 5px 5px -3px rgb(var(--m3-scheme-shadow) / .2), 0px 8px 10px 1px rgb(var(--m3-scheme-shadow) / .14), 0px 3px 14px 2px rgb(var(--m3-scheme-shadow) / .12);--m3-util-elevation-4: 0px 5px 5px -3px rgb(var(--m3-scheme-shadow) / .2), 0px 8px 10px 1px rgb(var(--m3-scheme-shadow) / .14), 0px 3px 14px 2px rgb(var(--m3-scheme-shadow) / .12);--m3-util-elevation-5: 0px 8px 10px -6px rgb(var(--m3-scheme-shadow) / .2), 0px 16px 24px 2px rgb(var(--m3-scheme-shadow) / .14), 0px 6px 30px 5px rgb(var(--m3-scheme-shadow) / .12);--m3-util-bottom-offset: 0}.m3-font-display-large,.m3-font-display-medium,.m3-font-display-small{font-family:var(--m3-font-display, Roboto, system-ui, sans-serif);font-weight:var(--m3-font-display-weight, 400)}.m3-font-display-large{font-size:var(--m3-font-display-large-size, 3.5625rem);line-height:var(--m3-font-display-large-height, 4rem);letter-spacing:var(--m3-font-display-large-tracking, 0)}.m3-font-display-medium{font-size:var(--m3-font-display-medium-size, 2.8125rem);line-height:var(--m3-font-display-medium-height, 3.25rem);letter-spacing:var(--m3-font-display-medium-tracking, 0)}.m3-font-display-small{font-size:var(--m3-font-display-small-size, 2.25rem);line-height:var(--m3-font-display-small-height, 2.75rem);letter-spacing:var(--m3-font-display-small-tracking, 0)}.m3-font-headline-large,.m3-font-headline-medium,.m3-font-headline-small{font-family:var(--m3-font-headline, Roboto, system-ui, sans-serif);font-weight:var(--m3-font-headline-weight, 400)}.m3-font-headline-large{font-size:var(--m3-font-headline-large-size, 2rem);line-height:var(--m3-font-headline-large-height, 2.5rem);letter-spacing:var(--m3-font-headline-large-tracking, 0)}.m3-font-headline-medium{font-size:var(--m3-font-headline-medium-size, 1.75rem);line-height:var(--m3-font-headline-medium-height, 2.25rem);letter-spacing:var(--m3-font-headline-medium-tracking, 0)}.m3-font-headline-small{font-size:var(--m3-font-headline-small-size, 1.5rem);line-height:var(--m3-font-headline-small-height, 2rem);letter-spacing:var(--m3-font-headline-small-tracking, 0)}.m3-font-title-large,.m3-font-title-medium,.m3-font-title-small{font-family:var(--m3-font-title, Roboto, system-ui, sans-serif);font-weight:var(--m3-font-title-weight, 400)}.m3-font-title-large{font-size:var(--m3-font-title-large-size, 1.375rem);line-height:var(--m3-font-title-large-height, 1.75rem);letter-spacing:var(--m3-font-title-large-tracking, 0)}.m3-font-title-medium{font-size:var(--m3-font-title-medium-size, 1rem);line-height:var(--m3-font-title-medium-height, 1.5rem);letter-spacing:var(--m3-font-title-medium-tracking, .15)}.m3-font-title-small{font-size:var(--m3-font-title-small-size, .875rem);line-height:var(--m3-font-title-small-height, 1.25rem);letter-spacing:var(--m3-font-title-small-tracking, .1)}.m3-font-label-large,.m3-font-label-medium,.m3-font-label-small{font-family:var(--m3-font-label, Roboto, system-ui, sans-serif);font-weight:var(--m3-font-label-weight, 500)}.m3-font-label-large{font-size:var(--m3-font-label-large-size, .875rem);line-height:var(--m3-font-label-large-height, 1.25rem);letter-spacing:var(--m3-font-label-large-tracking, .1)}.m3-font-label-medium{font-size:var(--m3-font-label-medium-size, .75rem);line-height:var(--m3-font-label-medium-height, 1rem);letter-spacing:var(--m3-font-label-medium-tracking, .5)}.m3-font-label-small{font-size:var(--m3-font-label-small-size, .6875rem);line-height:var(--m3-font-label-small-height, 1rem);letter-spacing:var(--m3-font-label-small-tracking, .5)}.m3-font-body-large,.m3-font-body-medium,.m3-font-body-small{font-family:var(--m3-font-body, Roboto, system-ui, sans-serif);font-weight:var(--m3-font-body-weight, 400)}.m3-font-body-large{font-size:var(--m3-font-body-large-size, 1rem);line-height:var(--m3-font-body-large-height, 1.5rem);letter-spacing:var(--m3-font-body-large-tracking, .5)}.m3-font-body-medium{font-size:var(--m3-font-body-medium-size, .875rem);line-height:var(--m3-font-body-medium-height, 1.25rem);letter-spacing:var(--m3-font-body-medium-tracking, .25)}.m3-font-body-small{font-size:var(--m3-font-body-small-size, .75rem);line-height:var(--m3-font-body-small-height, 1rem);letter-spacing:var(--m3-font-body-small-tracking, .4)}.m3-container{box-sizing:border-box}*,*:before,*:after{box-sizing:inherit}.m3-container a,a.m3-container{text-decoration:none}.m3-container.svelte-1nfjcdr.svelte-1nfjcdr{border:none;height:2.5rem;padding:0 1.5rem;border-radius:2.5rem;color:rgb(var(--text));transition:all .2s;align-items:center;justify-content:center;cursor:pointer;position:relative;overflow:hidden}.layer.svelte-1nfjcdr.svelte-1nfjcdr{position:absolute;inset:0;transition:all .2s}.m3-container.svelte-1nfjcdr>*{flex-shrink:0}.icon-left.svelte-1nfjcdr.svelte-1nfjcdr{padding-left:1rem;gap:.5rem}.icon-left.svelte-1nfjcdr>svg{width:1.125rem;height:1.125rem}.icon-full.svelte-1nfjcdr.svelte-1nfjcdr{width:2.5rem;padding:0}.icon-full.svelte-1nfjcdr>svg{width:1.5rem;height:1.5rem}.m3-container.svelte-1nfjcdr.svelte-1nfjcdr:disabled{background-color:rgb(var(--m3-scheme-on-surface) / .12);color:rgb(var(--m3-scheme-on-surface) / .38);cursor:auto}.m3-container:enabled.elevated.svelte-1nfjcdr.svelte-1nfjcdr{background-color:rgb(var(--m3-scheme-surface-container-low));--text:var(--m3-scheme-primary);box-shadow:var(--m3-util-elevation-1)}.m3-container:enabled.filled.svelte-1nfjcdr.svelte-1nfjcdr{background-color:rgb(var(--m3-scheme-primary));--text:var(--m3-scheme-on-primary)}.m3-container:enabled.tonal.svelte-1nfjcdr.svelte-1nfjcdr{background-color:rgb(var(--m3-scheme-secondary-container));--text:var(--m3-scheme-on-secondary-container)}.m3-container.outlined.svelte-1nfjcdr.svelte-1nfjcdr{background-color:transparent;border:.0625rem solid rgb(var(--m3-scheme-on-surface) / .12)}.m3-container:enabled.outlined.svelte-1nfjcdr.svelte-1nfjcdr{border:.0625rem solid rgb(var(--m3-scheme-outline));--text:var(--m3-scheme-primary)}.m3-container.text.svelte-1nfjcdr.svelte-1nfjcdr{background-color:transparent;padding:0 .75rem;--text:var(--m3-scheme-primary)}.m3-container.text.icon-left.svelte-1nfjcdr.svelte-1nfjcdr{padding-right:1rem}.m3-container.svelte-1nfjcdr.svelte-1nfjcdr{-webkit-tap-highlight-color:transparent}@media (hover: hover){.m3-container.svelte-1nfjcdr:enabled:hover>.layer.svelte-1nfjcdr{background-color:rgb(var(--text) / .08)}.m3-container:enabled.elevated.svelte-1nfjcdr.svelte-1nfjcdr:hover{box-shadow:var(--m3-util-elevation-2)}.m3-container:enabled.filled.svelte-1nfjcdr.svelte-1nfjcdr:hover{box-shadow:var(--m3-util-elevation-1)}.m3-container:enabled.tonal.svelte-1nfjcdr.svelte-1nfjcdr:hover{box-shadow:var(--m3-util-elevation-1)}}.m3-container.svelte-1nfjcdr:enabled:focus-visible>.layer.svelte-1nfjcdr,.m3-container.svelte-1nfjcdr:enabled:active>.layer.svelte-1nfjcdr{background-color:rgb(var(--text) / .12)}.m3-container.svelte-1nfjcdr.svelte-1nfjcdr{print-color-adjust:exact;-webkit-print-color-adjust:exact}@media screen and (forced-colors: active){.m3-container.svelte-1nfjcdr.svelte-1nfjcdr:is(.elevated,.filled,.tonal){background-color:transparent;border:.0625rem solid}.m3-container.svelte-1nfjcdr.svelte-1nfjcdr:disabled{opacity:.38}}.m3-container.svelte-czr52d{flex-direction:column;position:relative;padding:1rem;border:none;border-radius:.75rem;background-color:rgb(var(--m3-scheme-surface));color:rgb(var(--m3-scheme-on-surface));transition:all .2s}.type-elevated.svelte-czr52d{background-color:rgb(var(--m3-scheme-surface-container-low))}.type-filled.svelte-czr52d{background-color:rgb(var(--m3-scheme-surface-container-highest))}.type-outlined.svelte-czr52d{border:solid .0625rem rgb(var(--m3-scheme-outline))}.type-elevated.svelte-czr52d{box-shadow:var(--m3-util-elevation-1)}@media print,(forced-colors: active){.type-filled.svelte-czr52d{outline:solid .125rem}}@media (forced-colors: active){.type-elevated.svelte-czr52d{outline:solid .125rem}}dialog.svelte-bufvve.svelte-bufvve{background-color:rgb(var(--m3-scheme-surface-container-high));border:none;border-radius:1.75rem;min-width:17.5rem;max-width:35rem;padding:0;overflow:auto}.m3-container.svelte-bufvve.svelte-bufvve{display:flex;flex-direction:column;padding:1.5rem;width:100%}.m3-container.svelte-bufvve>svg{color:rgb(var(--m3-scheme-secondary));width:1.5rem;height:1.5rem;margin:0 auto 1rem}.headline.svelte-bufvve.svelte-bufvve{color:rgb(var(--m3-scheme-on-surface));margin-top:0;margin-bottom:1rem}.headline.center.svelte-bufvve.svelte-bufvve{text-align:center}.content.svelte-bufvve.svelte-bufvve{color:rgb(var(--m3-scheme-on-surface-variant));margin-bottom:1.5rem}.buttons.svelte-bufvve.svelte-bufvve{display:flex;justify-content:flex-end;gap:.5rem}dialog.svelte-bufvve.svelte-bufvve{position:fixed;inset:0;opacity:0;visibility:hidden;pointer-events:none;transition:opacity .2s,visibility .2s}dialog[open].svelte-bufvve.svelte-bufvve{opacity:1;visibility:visible;pointer-events:auto;animation:svelte-bufvve-dialogIn .5s cubic-bezier(.05,.7,.1,1),svelte-bufvve-opacity .1s cubic-bezier(.05,.7,.1,1)}dialog[open].svelte-bufvve .headline.svelte-bufvve{animation:svelte-bufvve-opacity .15s}dialog[open].svelte-bufvve .content.svelte-bufvve{animation:svelte-bufvve-opacity .2s}dialog[open].svelte-bufvve .buttons.svelte-bufvve{position:relative;animation:svelte-bufvve-buttonsIn .5s cubic-bezier(.05,.7,.1,1),svelte-bufvve-opacity .2s .1s backwards}dialog.svelte-bufvve.svelte-bufvve::backdrop{background-color:rgb(var(--m3-scheme-scrim) / .3);animation:svelte-bufvve-opacity .4s}@keyframes svelte-bufvve-dialogIn{0%{transform:translateY(-3rem) scaleY(.9);-webkit-clip-path:inset(0 0 100% 0 round 1.75rem);clip-path:inset(0 0 100% 0 round 1.75rem)}to{transform:translateY(0) scaleY(1);-webkit-clip-path:inset(0 0 0 0 round 1.75rem);clip-path:inset(0 0 0 0 round 1.75rem)}}@keyframes svelte-bufvve-buttonsIn{0%{bottom:100%}to{bottom:0}}@keyframes svelte-bufvve-opacity{0%{opacity:0}to{opacity:1}}@media print,(forced-colors: active){dialog.svelte-bufvve.svelte-bufvve{outline:solid .125rem canvastext}}.m3-container.svelte-l92rtn{display:flex;align-items:center;padding:0 1rem;min-width:20rem;max-width:60rem;min-height:3rem;border-radius:.25rem;box-shadow:var(--m3-util-elevation-3);background-color:rgb(var(--m3-scheme-inverse-surface));color:rgb(var(--m3-scheme-inverse-on-surface));animation:svelte-l92rtn-snackbarIn .5s cubic-bezier(.05,.7,.1,1),svelte-l92rtn-opacity .1s cubic-bezier(.05,.7,.1,1)}@keyframes svelte-l92rtn-snackbarIn{0%{-webkit-clip-path:polygon(-100% 150%,-100% calc(100% + .25rem),0% calc(100% + .25rem),.033rem calc(100% + .125rem),.125rem calc(100% + .033rem),.25rem 100%,calc(100% - .25rem) 100%,calc(100% - .125rem) calc(100% + .033rem),calc(100% - .033rem) calc(100% + .125rem),100% calc(100% + .25rem),200% calc(100% + .25rem),200% 150%);clip-path:polygon(-100% 150%,-100% calc(100% + .25rem),0% calc(100% + .25rem),.033rem calc(100% + .125rem),.125rem calc(100% + .033rem),.25rem 100%,calc(100% - .25rem) 100%,calc(100% - .125rem) calc(100% + .033rem),calc(100% - .033rem) calc(100% + .125rem),100% calc(100% + .25rem),200% calc(100% + .25rem),200% 150%)}to{-webkit-clip-path:polygon(-100% 150%,-100% .25rem,0% .25rem,.033rem .125rem,.125rem .033rem,.25rem 0%,calc(100% - .25rem) 0%,calc(100% - .125rem) .033rem,calc(100% - .033rem) .125rem,100% .25rem,200% .25rem,200% 150%);clip-path:polygon(-100% 150%,-100% .25rem,0% .25rem,.033rem .125rem,.125rem .033rem,.25rem 0%,calc(100% - .25rem) 0%,calc(100% - .125rem) .033rem,calc(100% - .033rem) .125rem,100% .25rem,200% .25rem,200% 150%)}}@keyframes svelte-l92rtn-opacity{0%{opacity:0}to{opacity:1}}.holder.svelte-kdzpyg{position:fixed;padding-bottom:1rem;bottom:var(--m3-util-bottom-offset);left:50%;transform:translate(-50%);z-index:3}p.svelte-kdzpyg{margin-right:auto}button.svelte-kdzpyg{display:flex;align-self:stretch;align-items:center;margin:0;padding:0;border:none;background-color:transparent;color:rgb(var(--text));-webkit-tap-highlight-color:transparent;cursor:pointer;transition:all .2s}button.svelte-kdzpyg svg{width:1.5rem;height:1.5rem}.action.svelte-kdzpyg{--text:var(--m3-scheme-inverse-primary);padding:0 .5rem}.close.svelte-kdzpyg{--text:var(--m3-scheme-inverse-on-surface);padding:0 .75rem;margin-right:-1rem}@media (hover: hover){button.svelte-kdzpyg:hover{background-color:rgb(var(--text) / .08)}}button.svelte-kdzpyg:focus-visible,button.svelte-kdzpyg:active{background-color:rgb(var(--text) / .12)}svg.svelte-1lrxrhm{width:3rem;height:3rem;animation:svelte-1lrxrhm-progressRotate 2.5s infinite linear}circle.svelte-1lrxrhm{transition:all .2s;animation:svelte-1lrxrhm-progressSize 2.5s infinite linear}@keyframes svelte-1lrxrhm-progressRotate{0%{transform:rotate(0)}50%{transform:rotate(360deg)}to{transform:rotate(1080deg)}}@keyframes svelte-1lrxrhm-progressSize{0%{stroke-dashoffset:125.66}50%{stroke-dashoffset:62.83}to{stroke-dashoffset:125.66}}.m3-container.svelte-1uqf70u{position:relative;width:1.25rem;height:1.25rem}.m3-container.svelte-1uqf70u input{position:absolute;opacity:0}.layer.svelte-1uqf70u{position:absolute;inset:-.625rem;width:2.5rem;height:2.5rem;border-radius:2.5rem;transition:all .2s;cursor:pointer;--color:var(--m3-scheme-on-surface-variant);-webkit-tap-highlight-color:transparent}.layer.svelte-1uqf70u:before{content:" ";display:block;position:absolute;inset:.625rem;width:1.25rem;height:1.25rem;border-radius:1.25rem;border:solid .125rem rgb(var(--color));transition:all .3s}.layer.svelte-1uqf70u:after{content:" ";display:block;position:absolute;inset:.75rem;width:1rem;height:1rem;border-radius:1rem;outline:solid 0 rgb(var(--color));transition:all .3s}@media (hover: hover){.layer.svelte-1uqf70u:hover{--color:var(--m3-scheme-on-surface);background-color:rgb(var(--color) / .08)}}.layer.svelte-1uqf70u:active,input:focus-visible+.layer.svelte-1uqf70u{--color:var(--m3-scheme-on-surface);background-color:rgb(var(--color) / .12)}input:enabled+.layer.svelte-1uqf70u:active:before{transform:scale(.9)}input:checked+.layer.svelte-1uqf70u{--color:var(--m3-scheme-primary)}input:checked+.layer.svelte-1uqf70u:after{outline-width:.3125rem;outline-offset:-.5rem}input:disabled+.layer.svelte-1uqf70u{background-color:transparent;--color:var(--m3-scheme-on-surface) / .38;pointer-events:none}.m3-container.svelte-1uqf70u{print-color-adjust:exact;-webkit-print-color-adjust:exact}@media screen and (forced-colors: active){input:checked+.layer.svelte-1uqf70u:before{border-color:selecteditem}.layer.svelte-1uqf70u:after{outline-color:selecteditem}input:disabled+.layer.svelte-1uqf70u{opacity:.38}}.m3-container.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy{position:relative;align-items:center;height:3.5rem;min-width:15rem}input.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy{position:absolute;inset:0;width:100%;height:100%;border:none;outline:none;padding:1.5rem 1rem .5rem;border-radius:.25rem .25rem 0 0;background-color:rgb(var(--m3-scheme-surface-container-highest));color:rgb(var(--m3-scheme-on-surface))}label.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy{position:absolute;left:1rem;top:1rem;color:rgb(var(--error, var(--m3-scheme-on-surface-variant)));pointer-events:none;transition:all .2s,font-size .3s,line-height .3s,letter-spacing .3s}.layer.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy{position:absolute;inset:0;border-radius:.25rem .25rem 0 0;pointer-events:none;transition:all .2s}.layer.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy:after{position:absolute;content:" ";display:block;width:100%;bottom:0;height:.0625rem;background-color:rgb(var(--error, var(--m3-scheme-on-surface-variant)));transition:all .2s}.m3-container.svelte-gav3jy svg{width:1.5rem;height:1.5rem;color:rgb(var(--m3-scheme-on-surface-variant));pointer-events:none}.m3-container.svelte-gav3jy>.leading{position:relative;margin-left:.75rem}.trailing.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy{position:absolute;padding-left:.75rem;padding-right:.75rem;height:100%;right:0;display:flex;align-items:center;justify-content:center;border:none;background-color:transparent;border-top-right-radius:.25rem;border-bottom-right-radius:.25rem;-webkit-tap-highlight-color:transparent;cursor:pointer;transition:all .2s}input.svelte-gav3jy:enabled:hover~.layer.svelte-gav3jy.svelte-gav3jy{background-color:rgb(var(--m3-scheme-on-surface) / .08)}input.svelte-gav3jy:hover~label.svelte-gav3jy.svelte-gav3jy{color:rgb(var(--error, var(--m3-scheme-on-surface)))}input.svelte-gav3jy:not(:-moz-placeholder-shown)~label.svelte-gav3jy.svelte-gav3jy{top:.5rem;font-size:var(--m3-font-body-small-size, .75rem);line-height:var(--m3-font-body-small-height, 1rem);letter-spacing:var(--m3-font-body-small-tracking, .4)}input.svelte-gav3jy:focus~label.svelte-gav3jy.svelte-gav3jy,input.svelte-gav3jy:not(:placeholder-shown)~label.svelte-gav3jy.svelte-gav3jy{top:.5rem;font-size:var(--m3-font-body-small-size, .75rem);line-height:var(--m3-font-body-small-height, 1rem);letter-spacing:var(--m3-font-body-small-tracking, .4)}input.svelte-gav3jy:focus~label.svelte-gav3jy.svelte-gav3jy{color:rgb(var(--error, var(--m3-scheme-primary)))}input.svelte-gav3jy:focus~.layer.svelte-gav3jy.svelte-gav3jy:after{height:.125rem;background-color:rgb(var(--error, var(--m3-scheme-primary)))}@media (hover: hover){button.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy:hover{background-color:rgb(var(--m3-scheme-on-surface-variant) / .08)}}button.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy:focus-visible,button.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy:active{background-color:rgb(var(--m3-scheme-on-surface-variant) / .12)}.leading-icon.svelte-gav3jy>input.svelte-gav3jy.svelte-gav3jy{padding-left:3.25rem}.leading-icon.svelte-gav3jy>label.svelte-gav3jy.svelte-gav3jy{left:3.25rem}.trailing-icon.svelte-gav3jy>input.svelte-gav3jy.svelte-gav3jy{padding-right:3.25rem}.error.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy{--error:var(--m3-scheme-error)}.error.svelte-gav3jy>input.svelte-gav3jy:hover~label.svelte-gav3jy,.error.svelte-gav3jy>input.svelte-gav3jy:hover~.layer.svelte-gav3jy{--error:var(--m3-scheme-on-error-container)}input.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy:disabled{background-color:rgb(var(--m3-scheme-on-surface) / .04);color:rgb(var(--m3-scheme-on-surface) / .38)}input.svelte-gav3jy:disabled~label.svelte-gav3jy.svelte-gav3jy{color:rgb(var(--m3-scheme-on-surface) / .38)}input.svelte-gav3jy:disabled~.layer.svelte-gav3jy.svelte-gav3jy:after{background-color:rgb(var(--m3-scheme-on-surface) / .38)}input.svelte-gav3jy:disabled~svg{color:rgb(var(--m3-scheme-on-surface) / .38)}.m3-container.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy{print-color-adjust:exact;-webkit-print-color-adjust:exact}@media screen and (forced-colors: active){input.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy{background-color:field}.layer.svelte-gav3jy.svelte-gav3jy.svelte-gav3jy:after,input.svelte-gav3jy:focus~.layer.svelte-gav3jy.svelte-gav3jy:after{background-color:canvastext}}.urlbar.svelte-1ck201x{border:solid .0625rem rgb(var(--m3-scheme-outline));padding:.25rem;border-radius:.75rem}input.svelte-1ck201x{background-color:transparent;outline:none;border:none}iframe.svelte-1ck201x{outline:none;border:none}.icon{font-size:2em}.pad-children>*{margin:2rem}#nav>*{padding:.5em}spacer.svelte-me83ba{margin:1em}body,html,#app{width:100vw;height:100vh;padding:0;margin:0;background-color:rgb(var(--m3-scheme-background));color:rgb(var(--m3-scheme-on-background))}*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}:before,:after{--tw-content: ""}html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,[type=button],[type=reset],[type=submit]{-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]{display:none}*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }.m-3{margin:.75rem}.m-4{margin:1rem}.my-3{margin-top:.75rem;margin-bottom:.75rem}.ml-3{margin-left:.75rem}.mt-5{margin-top:1.25rem}.flex{display:flex}.h-full{height:100%}.w-9\/12{width:75%}.w-full{width:100%}.flex-1{flex:1 1 0%}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.space-x-10>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(2.5rem * var(--tw-space-x-reverse));margin-left:calc(2.5rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-3>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(.75rem * var(--tw-space-x-reverse));margin-left:calc(.75rem * calc(1 - var(--tw-space-x-reverse)))}.space-y-3>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.75rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.75rem * var(--tw-space-y-reverse))}.border{border-width:1px}.p-2{padding:.5rem}.p-4{padding:1rem}.p-5{padding:1.25rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-4{padding-left:1rem;padding-right:1rem}.pl-3{padding-left:.75rem}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-6xl{font-size:3.75rem;line-height:1}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.opacity-0{opacity:0}.opacity-50{opacity:.5}.opacity-70{opacity:.7}.shadow{--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.outline{outline-style:solid}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}*{font-family:Cabin}

</style>
</head>

<body>
  <div id="app"></div>
</body>

</html>